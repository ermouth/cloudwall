["cw-Editme-4aw4","cw-S3site-Editor-4vx1","cw-S3site-Editor-1ccd","cw-Demo-ToDo-1ccd","cw-Demo-PassKeeper-1ccd","139906512016e0317z0y",{"_id": "cw-Couch-User-wu7v","_rev": "87-a4de94df2c5990ff89f3939547ecba1a","name": "Couch.User","title": "User Editor","type": "manifest","desc": "CouchDB user editor","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Couch.User","build": 87,"app": {"name": "Couch.User","title": "User Editor","version": "1.3","build": 87,"timeout": "3000","author": "ermouth","ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAUsElEQVR4XuWbe3BU133HP2d3Ja20klZPBIinQRiDsUA8bbCxjR1eIvETd9rONDNpkrGbTpu2mXTaJu7rj7RJp0mmbtJ2mjZpEscmzsOAwY4JtrGxwZKQQDwM5iWQkABJaHellbSP0znn3Lt796UH2OkfvTM70t695/H7nt/j+/udcwX/zy/xm5Bf7m3eBHIVMbEM3EtxxaaC8KaOLYeJu7sh1oqURyjwHBIPL331457fxwKA/NXxWcTCzxDlcYbD84lFb04OtxvyfWcQ8qcUeZ4TG5Z23lxHuVt9pADIPa2fIxb5CsPhGcRiyVElIGXqR/2q7qvLnoUQkPJxTFyB4fVegLy/Fo3Lvv9RAfGRACD3HP40ofC3icdLEhNTAsfjEJPgdkFNOVQUQ4UfSrygBMrLM49HImjAgsPQNwB9Iejph1gc3AJcLgOMfQnXACVlT4vN9c/fKhC3BIDc19TAQOhnROOzkVZXSuhoHPyFUDcLpldCadHNzTMwCF19cLoDAmHwuAwYWmsE5BWexV/wKfHg0uM3N0BS+SbdXu48/Dwjw7+VUHW1WtEY3FYDi+ZAeemk+xyzQV8A2i/AxR7wuI1WqcvlhsLCfxeNKz9/MwNOWgPk/iNl9IaaiUVv0wPGJUSjMG86NNRBQf7NzGPibYZHoOUMnLsCHg+4LBFcrlNUzVomHpg7PPHOJqkB8vWWRdwYPK69unJgym79PrhnCZT7JjPurT+rNOJgu2UablsbolSV1IkHll2Y6AAT1gD5ysn1DF17QwutHFwkCovnwLK6ccdSbqErCF1h6AtDbxjCURiNm6Zej/mU5ENJAcwsgjllxv+Nex0+Cac7Ic9t/IIrD6YUN4j1S4+M29YRgMZ8Vu479gn6+1/VwiuVVxJtWAY1FWO2O3ENTvXCxZARRpmtcIFH225Se41TM7iqvwoX9X9tMdzuhwXl44hy6Rq81WZ8gwbBDWVVd4uHF703HgjjYiwPHF/Nld73kJbwyuY2rYTS3Crf0g2HuiCiIqAluBJMD6bmZ41qRzb7fuK7AkPdlKDYRL4bVlTC4soxxOkPwKvNlimoQd3gL18kHl5yciwQxgRA7muZTV/oAnFLeBWGtt0DBVb8Tuv5fB+8fhGGYpZGWtFqQsJb4DhBsNspMKISfB64twZmFOcQaTAMO99NkimlckXT/WJLXSAXCGMDsOPAVeLRaq2PSvUb10BJ9pj+q7PQ3msE17ZrkTotl/VdBy7HfZsI2s+ox3SYd2iLE5C4MH53YRmsrckhktKEVw4nzUG4zojt6xdMGgC589CLDA09qb39aAQ2r4Sqsox+FC4/Pga9I2ZMW0in4E7VV8RQBxAJpXnG6SkVVzRCac6N0ST50z7DBtD6q7RBuaByL2ybaY2XPqvL1+CNNsjX3gZKfN8SW1b9cTYQsmqAfK1lBYHQ+xpuRW6WzIUlJuw7r5GYET4Qhbwcq65NWa2oogsSbiuDReUwqzSV3Tr7vRaG0wE42W80wpOlb+Ubij2wbQbkW5woZXKHT8CHiisolXRDedUcsWHRxXQZsgPw4jtdyNFpWu3Lio3TS7vUT99vg+CoGSOX2mqvHocaH2ycA77s7iOrhiqNeKMLusOQZ5uGw4HaIDw6IweYv3wHwqPG6/qKj4nGlXeNC4Dc3fx5QoHv6gdHIvDI2qx2/8M26LPUXj+bZvO2qqpVn1kCj41PF3KZKW93w5lQppbZIbMsH7ZNz9K89wbsaTKmoEJjVe028cC8Xc4nMzRAvvT2MNFIgTZKRW9XLczo+dfn4ei1pKfPJrwy9NXT4c5KY+POS0ZHoLMFrp+GQRUvh8CdD3lFUDIdpixCTK1PafPiBRiJO3yCw1EqTVjgg9VVWUB4sw2u9BpbKi6+JLaunJUTALmn6RkCwee0l1L8/qkHTQbmuC4PwAsnocCm4Vk8diQOj86HGVnyIXn5MLT/xDCixEcFfjWI8pBxiEehoBSWfRZRVqtHP9UP7/U5TEFrndQRRiKJSsnmGkG1N80hhMLwi7chP89oQWVVo3hw0W5bpBQNkC83dREOTtOrX1cLK27PgPQ/WmA4ZqXoWVRfsbhqLzyZqTgQDiL3fxU83twe0B5RcY88H+LBr+o7/cPw806Jkk8KiUt5VcdfFarVojwyrSBTDd46Cl3XzaR9vsOicdXqDADkm0fquBY8rT2/CntPrs/I7Nquwv7zkOdJsroU4mIlh8unweqp1hDxGLLpe2a1Q5chMggizSZyWf/oIGLzP+uVG4xKdnTEKHDr8hJCr74BwRSRJDEpWe7Po644LSNVidOew2biCgSvzye2rRiy1s+MLve0fptA/x8az++DTatyrr5OxXOQFeX0HpgBiyx7lNc+gMPPmVVXLMFZ2cnp9qwfFACN39ZfQlF46dKIBkALb4FgALCBkLik5NFpmXyFnx0wCZwav6TiS2JL/TdSAdjZdIWh4FQd91cuNCbguBTN/cUZ41CzcXcbEAXAuulQP8UCtvcsHPoXC4DxJHb+bhiT2Pg1fbM7HOX1nhHylQZYQttAOL9HZJy1/hJqC9OKzkfPwvGLJiPzFR0SjavXJACQr5wpYOjKcEL9n1gP3lQ1+uUpk9UlSEkW+9cZXRzunGJA0Jo1dAP2f8V4+MlcKvkqW4BY/Tnd6uTACG0DYZNRqhV3mIGh2korVBYpqc73sK4iLVN1moHbhXhivb2OIHe3bifU/4Lm/MpOHrs3Y6r/dAgKFbPMofqJyi5Q6YUnHOxb7vkyaNsdN/lMjhsbhQWPIOat1/feuhqiOzKK26n6ehEsE9C9G9OIyhiPTZ2RCfeP91msDSjPWyk+sa5Jz0juaf46gcCfaco2uwbuXpzSuOMGvHQaCmzG50xnU9JcqTEcjcEXliWFlc0/gKtt4LK4+UQ0IRKG+/4SUWqynh2dVxFS4HIlHZ+OAjp+GsFtrYgSY52/huqCwtSRXm+C60HDDEv8z4gtDd8xAOxt3stAYKO2/6XzYdHslIYHL0FTt5VgZah+MhwpVYxLyeJKwdrpSU8vO5qg/YeG7EzoUn0WID7x94mnm/pucHE4rOeeiAApgttmoKJBnDqfn0W+tAJC0yk402X8QGnpc2Lz8i9YGtDSSWBgOpEYbFgKU1Mb7joN54O2/SfDjloBpZK4kl5ZOaEn5xVQUZgkJPLoDrj87uQ0IB5H3P8sFJmthv7RUfZdv6p5WSICWKuuOYFtGpoWxZmS52OVRaISKJ6+DE0fmJX0lx4Qm5bfZwDY3RIlNODWYaLxblPodFzfb5OEYhK3sjeXRULUgLbgenAV6iWjsTifvbM4Ye3yyPPQ+S54FEGZhA9Q3nQkgNjyTcgvIo7kZ50XyHOLRBhMOEIdLpJmoAAodOXxYGVaAtLdC/taDYcvLrkotq6YY2uAJDAAo1H4lEp+Um3n31ojGle3EtgeyFbFFG8sGYnH+cwdflxWvJfvfw96Wi31nwwAypkEYdM/Irx+IlLycs+H5Ot+U23ejgCp92FT1Z2pBqeSo71NxtEX+wfF1oZi2wlKAgEDwOP3QWGqrT7XMqRpZoJ6KkrjIB9aJS3nFI3H2TbbT1WhlfcOBZCtP4Ab5ybOANW0o8PQ8PuIWpMU9QwHOXijE48QWU3AxJikQ4zGozTWLE8FIDgELx80AJT6EZsbzDLJ3S2SkKUBj62FolQN+E5rUAOgB0gjIemUVE2hyuti08ykH5GdbdDyvYk7QaX+BZWIh/4iIcAb188RiIUxrlXNI9MX2ACo39VCNNak1TFUzfDn7xg2V+xHbLUB2NUSY3DApX3A1jWmCOK4/vPYDaP+6p7DDAwFdUzEMgs1+MrqUhZa/cjei/DO1yfOBjUJqkOsfUbP4uzgdY4Gu7T66zGlMUWVFAkVdx32r0BQPsAtXDxclUbn1abrnvdsE4iJrQ2a16kw2M9AoEwDsGkFVKZy6edP9Wnnph2gLnFJE491nc7pF8z/ceLM8nlZW2P4sIwMw64vqr3+CQVBYhGYfR+i/nH9fOvARS6F+6yNkiT3T7F5WzMsAHwuL/dWpplAbz/sbTYAlFT0ii31VQaAXS3tDA4s1jxg7RKYbRF5a7p7O/roGYzoCTgTjwwurhExK6KefXz2nITAcv83YLBzYn5AFUjWfQlRNVe3f7WnlSgRU3BNeHzTdcIsLcF1dSAeo6agimVlaU7wQjccPG7CYKn/mNjccJflA5p/QijwlK4DLJ4Fd81PWammngFO9IdMDE7wbkcW5gxDVo4eicfYOG025V6TlMje8/Dm10xOoFLjrJfaCYlA+XzEfX+kn+gbDfJOXzse3camvVYUsOO/tMxBDySJEeV233xu8yUXwKjSWThpJ0SlPxKNy3/XdoJ/RWjg7zQVrq2Ce1Nrh52hMPsu9yRicDIRSXWMzgQlLuOaiq6falZRz63jfTj6AnqXKQMES/jKO+DuzyLcJooc7D1GfzSAWzubpP071d+Uk5KfaCzCmsrVVOSnJURvtEK3KjUL8Pv/XGxq+AcrDLZuJNC/VxN5tcTb789Yn/85fZZ8zUMzbd7Jw53gKC1YVVHL7BJHsS54Dfn631jEyDGMqgDVLEGs+Uzi5oXBLo4Fz5Bnr36aoHZWaEpp1jaLUBEgwpapjZk69sL+ZDZXWLFBfLL+1wlmIne8KbUGKC7wyD1QnJq+vnmlkyuDodR01BEWtT3a3MCeqIgTkzHWVc6npsja4YyEkTu/mJkeqzrgrLWIZU/piV8e6qZl4AR5LpGw/USYszTB0quU1Y8To9JTxcrKu1MBuBGC3VYESE+HtXruaj7NYKBO1wTqMxOinsEgv76iqKjLcjx2cSetOuPIytTKqAnVeitYWWXR0pEh5K4/yQJABGauQyw3ADT3tdEzehW3xfyMyuuZjvlRq7/cv5qaorR0uP08HDtvEqGiouNi22rtIZMa8ErT1wgGv6xVyVcAjfdkqNDLHSeIRKOmmJuWgDi9cSIu6y3vGNMKK1lZaRVYJwjAkb5Wuke7NaV2EpycAGhHqCrKsHGaCZ8p18vWJokC1Of/W9HY8GwqAPtaa+kPXDZVIWUG66A4tax0KdTHu9fOka93MJMe2RbYlFjMCiknKIWq2MdZVDKXBX4rxVYA7P5TdcApdYLKBGYoDdiu758JnObU4EldgTIgmBwgae9pmqC8v4ywsGQZc0vuyFT/Xe8ZBqi2yYorK8WmxX0pAGjl2tn8IUOBeToczq2BNamFEfXMa51HCUVMaSph91ZyolZArbjKx2u8Zcz11TLdl8opUD5gjyqRZQNgFaL+0ZTJdw52cCl8nt7RHlzCZeoBerKGbxjnZ9ifBzcbphkTSrkOHoOOa9bmiO+Y2LoqEeZS9wX2HPk0gYH/ShyB2b7ebCg4rkBkiNc6W8hXCFiUNC5jWvB8Tx5zfDOYX1pLvitH8WMoiHzrm+BJ+11Fgal3IO5KBcAeOipHuRj6kIuhDxiWQVxSgWFPXxKJj7CqahPV3tRiLkMj8NJbyTMNvsrtovGuHXa/Gfmp/Ok7A8RGS7UWzMksj6mG7X3nOBPq0OWoGDGmeaupK5lBVWHuIxxyJASd7dDZbHZ+svKAKFTMgdp6RNW8zJW07vSPXOdS8AQdwx/oVVezqMmfS8OUhzLbHDgKndamiPBcFdvVEYvklQnArqbfYzD43/oRtUGikqPy5AFQu+lrXW9TlldCfcVCCtxZdmO0lsbh2mnoOg6hblMRUpsiY+0N6KM4yne4YMpimHYHojg7sFEZob33LW6MdnP/9N/JFL53APa8n7T9silPiocW/nRMALR5vfh2BzIyU2+SlBbCFl1Cn/AlB3pAbYj0XTB+S+3J5aS/ObrVZ4uVV4+BtwSmLoDq2xMMcUKT2XkQBkcM8ysqPCW2rUnzjjlqVHJvez2hvtbEAQlVJFXF0jEulYDQew66P4Bo2No8tLaQJjTbsTpXYFjH8/zToXoBoqR67F7V8bkPu6xKrguqi+vEA8s/TG+Us0Yldx7+EUODv61XUB1m3rgCqjPPq8noqFnt3kvW4aRJbn9NFhxbK/ILofoORPm0zB7sIzL2Jqav5F9F44o/yDbUmEU6ueNAN/FoTeKQlPIHjoPPMnQdLrca27ZPN01WoJt9XpmIyhzLpiOmOjQ7/ZCUp+CsePyenOo7NgCvtM1gaOBS4oCksqVP3g3epNOT/Z0wcPk3D4AyueIaqJqTpLPpx+SU7/GUlItHl93IhfO4ZVq5t3UVgcChsQ5KyuEg9HdYLHDcLm92za121jGzspmIQn+yL+Xxf9VivquF+igOStq9yzeOPcz1/tfGOiqrk9GBqzASTD0wdIviJprrAeKmrOavQThDafpRWU13S1eLTUsPjzf8hJdrooeldTQYvmE4hM4LJjxErnhoQmlePnj9CHfa/uKhE2a7yz4srXhGTelHe1g6oQl7jy8mdL1ds0Tncfl1d4I/tZKsKboKh8pRqRA2aSAU11dn/PLAU5jJnZTKq+Py6jUbfU4PlepG8Pvmi4dXdIy38vbvk14e+fMjZcQG2ohJc9rKfmGibgYsnZf1hQmtvQo0dfRZn4K2zslnzFKFUM2cdN5uMsC0a3AYWtVm5VXraKouUiqbP07ljBUf6wsTzqnI3Yd/wtDwU5qpqTnrF6RiJotcNDcrfZ7oqmR9TpW02zug46pRd/vdIf3yVdF3xadWPH0z/U9aA1JA2H9sBX39vyQaSx5TtF+aKiuyXpqqyHnAetwJDwzC5V440wFq5VUG6hTcW3gab9mj4qG6E+P2leOBWwIg4Rt2vf85hoe+RSyerKBooqK4vDRnDdVrc+pFqspSU2hRwujX5uLobXm1J6H27vqC5qNem1N9qJCW8dqc5zqVFc+IDYsTae3/KQAJIF5pepqYfJaRcM0tvzhpv1Vhd65UvaDwHCLvWdG49Ic3K3B6u49EA9I7lQeO3kYo8jQxnmB4cE4KGJOZudpe8vpO4crbQb77OfHQkp7JNJ/Isx8LABmA7G5tRLIKj6ueWHQpUAOyIPHujGog5TCCLqIcwSVacfGu2NywbyJC3MozvxEAbmWCH3fb/wWkUqm5Szl9CQAAAABJRU5ErkJggg==","maskstate": ["cmd","doc._id"],"nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","width": [[350,3000]],"collapsed": [],"padding": "none","types": {"user": ["edit","create","view"]}},"params": {"delay": 10,"restyle": 1},"data": {"cmd": "","stash": {},"doc": {"_id": "","type": "user","name": "","roles": []}},"PwdKeys": ["derived_key","salt","iterations","password_scheme"],"Proxy": {"password": "","name": "","apps": [],"lang": [""],"org": "","role": [""],"other": [],"secret": {}},"P": [],"Users": {},"Roles": {},"Fields": {},"Aux": {"Title": {"inherit": ["RT"],"Doc": {},"canHandle": "function (doc) {\n  \t// Analyzes, if the add-on can accept\n    // current user doc.\n    // Returns array of props which would be affected\n    // or null if not applicable.\n    \n    // Below line means we reject docs having .title\n    // which is not string\n    \n    if (null != doc.title && typeof doc.title != 'string') return null;\n    \n    var that = this,\n        res = {\n          _affects: \t['title'],\n          _priority: \t1000,\n          _collapsed:\tdoc.title == null\n        };\n    \n    // Try to guess if this field exists\n    // in other doc with roles, same to current\n    if (null == doc.title) {\n      var expand = !!cw.lib.getref(that.Fields, ['title','s']);\n      if (expand) {\n        res._collapsed = false;\n        res.title = doc.title || '';\n      }\n    }\n    \n    return res;\n  }","data": {"name": ""},"lang": {"en": {"LBL_TITLE": "Full name","PLC_TITLE": "Enter full name","ERR_TITLE": "200 chars max","LBL_ADD": "＋ Add full name"},"ru": {"LBL_TITLE": "Полное имя","PLC_TITLE": "Введите полное имя","ERR_TITLE": "200 символов максимум","LBL_ADD": "＋ Добавить полное имя"}},"init": "function ($o) {\n  \tvar that = this,\n        d = that.data,\n        doc = that.Doc;\n    $.extend(true, doc, d);\n    d.name = doc.name;\n    if (null == doc.title) delete d.title;\n    $o.html(that.HTML.assign(that.lang));\n  }","HTML": "<div id=\"title-container\" class=\"uw-full\"><div id=\"title-label\" class=\"uw-label dib vat pr10 pt6 fs85 o70\">{LBL_TITLE}</div><div class=\"uw-input dib vat\"><input id=\"title-value\" type=\"text\" class=\"w100p\" placeholder=\"{PLC_TITLE}\"><div class=\"my-error-tip\" style=\"display:none\"></div></div></div><div id=\"title-add\" class=\"uw-full uw-pl-label fs85\"><div id=\"btn-title-add\" class=\"pseudolink tdn dib vat\">{LBL_ADD}</div></div>","ui": {"#title-container": {"css": {"hide": "function (d) {return d.title == null;}"},"watch": ["#btn-title-add"]},"#title-value": {"bind": "function (d,v) {\n      \tif (v!=null) {\n          var s = v.stripTags();\n        \tif (d.title != null) d.title = s.trim();\n          return s;\n        }\n        return d.title || '';\n      }"},"#btn-title-add": {"bind": "function (d,v) {\n      \tif (v!=null) {\n          d.title = '';\n          d._collapsed = false;\n          this.my.root().trigger('shuffle.my');\n        }\n      }","events": "click.my"}},"style": {" #title-add": "display:none;"," #title-container.hide~#title-add": "display:block;"}},"Email": {"inherit": ["RT"],"canHandle": "function (doc) {\n\t\tvar that = this,\n        affects = [],\n        props = ['email','e_mail','e-mail'],\n        prop;\n    \n    props.forEach(function(e){if(!prop && null!=doc[e]) prop = e;})\n    \n    if (prop && typeof doc[prop] != 'string') return null;\n    \n    prop = prop || props[0];\n    \n    var res = {\n      _affects: \t[prop],\n      _priority: \t900,\n      _collapsed:\tdoc[prop] == null\n    };\n    \n    // Try to guess if this field exists\n    // in other doc with roles, same to current\n    if (null == doc[prop]) {\n      var expand = !!cw.lib.getref(that.Fields, [prop,'s']);\n      if (expand) {\n        res._collapsed = false;\n        res[prop] = '';\n      }\n    }\n    \n    return res;\n  }","Doc": {},"data": {"name": ""},"lang": {"en": {"LBL_EMAIL": "E-mail","PLC_EMAIL": "Enter e-mail","ERR_EMAIL": "Valid e-mail address, please","LBL_ADD": "＋ Add e-mail","TIP_SEND": "Compose e-mail..."},"ru": {"LBL_EMAIL": "E-mail","PLC_EMAIL": "Укажите e-mail","ERR_EMAIL": "Некорректный адрес","LBL_ADD": "＋ Добавить e-mail","TIP_SEND": "Отправить письмо..."}},"init": "function ($o) {\n  \tvar that = this,\n        d = that.data,\n        doc = that.Doc;\n    \n    $.extend(true, doc, d);\n\n    if (null == doc[doc._affects[0]]) delete doc[doc._affects[0]];\n    \n    $o.html(that.HTML.assign(that.lang));\n\n  }","HTML": "<div id=\"email-container\" class=\"uw-full\"><div id=\"email-label\" class=\"uw-label dib vat pr10 pt6 fs85 o70\">{LBL_EMAIL}</div><div class=\"uw-input-btn pr5 dib vat\"><input id=\"email-value\" type=\"text\" class=\"w100p\" placeholder=\"{PLC_EMAIL}\"><div class=\"my-error-tip\" style=\"display:none\"></div></div><div class=\"uw-btn dib vat\"><a id=\"btn-email-send\" target=\"_blank\" class=\"button w100p dib vat pl0 tac pr0 br2\" title=\"{TIP_SEND}\"><span class=\"fi-mail o70\"></span></a></div></div><div id=\"email-add\" class=\"uw-full uw-pl-label fs85\"><div id=\"btn-email-add\" class=\"pseudolink tdn dib vat\">{LBL_ADD}</div></div>","style": {" #email-add": "display:none;"," #email-container.hide~#email-add": "display:block;"},"ui": {"#email-container": {"css": {"hide": "function (d) {return d[d._affects[0]] == null;}"},"watch": ["#btn-email-add"]},"#email-value": {"bind": "function (d,v) {\n      var p = d._affects[0];\n      if (v!=null) {\n        if (d[p] != null) d[p] = v.trim().replace(/\\s/g,'');\n        return v;\n      }\n      return d[p] || '';\n    }","check": "function (d,v) {\n  \t\tif (!/^(|[^@]+@[^@]{3,})$/i.test(v)) return this.lang.ERR_EMAIL;\n  \t}"},"#btn-email-add": {"bind": "function (d,v) {\n      if (v!=null) {\n        d[d._affects[0]] = '';\n        d._collapsed = false;\n        this.my.root().trigger('shuffle.my');\n      }\n    }","events": "click.my"},"#btn-email-send": {"bind": "function (d,v,$o) {\n    \tif (d[d._affects[0]] && this.my.valid()) $o.attr('href', 'mailto:'+d[d._affects[0]]);\n      else $o.attr('href','');\n    }","css": {"disabled": "function (d) {\n      \treturn !d[d._affects[0]] || !this.my.valid();\n      }"},"watch": "#email-value"}}}},"Blocks": [],"RT": "function (key) {\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t}","init": "function ($o) {\n  var that = this,\n      doc = that.data.doc,\n      pis = [],\n      _ref = cw.lib.getref;\n\n  $o.formgen('init', that.HTML.assign(that.lang));\n\n  if (that.app && !that.isUsersDB()) {\n  \treturn $.Deferred().reject(that.lang.NODB).promise();\n  }\n\n  // Save pwd related stuff\n  var p = that.Proxy;\n  that.PwdKeys.forEach(function(i){\n    if (doc[i]) p.secret[i] = doc[i];\n  });\n\n  that.data.stash = Object.clone(doc, true);\n\n  if (doc._attachments) {\n    pis.push(\n      that.db.att(doc._id).data(/\\.jp[e]?g$/)\n      .then(function(res){\n        Object.keys(res).forEach(function(k){\n          doc._attachments[k].data = res[k].data;\n          delete doc._attachments[k].stub;\n        });\n      })\n    );\n  }\n\n  if (that.app) {\n    pis.push(that.GetCounter());\n  }\n\n  return Q.all(pis)\n  .then(function(){\n  \t// Prepare aux fields\n    var blocks = [];\n    Object.keys(that.Aux).forEach(function(k){\n    \tvar man = that.Aux[k],\n          ext;\n      try{ext = man.canHandle.call(that, doc);} catch(e){}\n      if (!ext) return;\n      \n      blocks.push($.extend(true, {_aux:k}, doc, ext));\n    });\n    that.Blocks = blocks.sortBy(function(e){\n      return e._priority - (e._collapsed?1e6:0)\n    }, true);\n    \n    // Prepare stamp\n    if (!that.app || _ref(that.Fields, ['stamp','s']) || _ref(that.Fields, ['stamp','n']) && doc.stamp==null) {\n      doc.stamp = Date.now();\n    }\n  });\n\n}","lang": {"en": {"NODB": "User editor can only run for a bucket, synced with or attached to /_users.","DENIED": "You have no rights to edit users or network is down.","BTN_ADDUSER": "Add new user...","ERR_NET": "Couldn‘t save changes, see datails at console.","PLC_LOGIN": "Login","ERR_INUSE": "Login is already in use","ERR_LOGINREQ": "Login is required","ERR_LOGIN": "Login can’t contain : or start with _","PLC_PWD": "New password","ERR_PWD_REQ": "Password is required","ERR_PWD_4": "4+ characters","PLC_ROLES": "Select user roles","ERR_ROLES_": "Roles can’t start with _","MSG_STAMP": "function (d) {\n                  return 'Last saved<br>' + (!d.isThisYear()\n    \t\t\t\t\t\t\t\t? d.format('{Mon} {d}, {yyyy}', 'en')\n    \t\t\t\t\t\t\t\t: !d.isToday()\n                    ? d.format('{Mon} {d}, {h}:{mm} {tt}', 'en')\n    \t\t\t\t\t\t\t\t: d.format('today, {h}:{mm} {tt}', 'en'))\n                }","BTN_IMG": "Change…","BTN_SAVE": "Save and close","BTN_CLOSE": "Close","SAVED": "Changes saved","CROP_SELECT": "Select image...","CROP_OK": "Apply","CROP_CANCEL": "Cancel"},"ru": {"NODB": "Приложение можно запускать только из БД, привязанным к базе /_users.","DENIED": "У вас нет прав редактировать список пользователей или сеть недоступна.","BTN_ADDUSER": "Добавить пользователя...","ERR_NET": "Ошибка сохранения, детали выведены в консоль.","PLC_LOGIN": "Логин","ERR_INUSE": "Логин занят","ERR_LOGINREQ": "Логин обязателен","ERR_LOGIN": "Логин не может содержать : и начинаться с _","PLC_PWD": "Новый пароль","ERR_PWD_REQ": "Пароль обязателен","ERR_PWD_4": "4+ символа","PLC_ROLES": "Роли пользователя","ERR_ROLES_": "Роли не могут начнаться с _","MSG_STAMP": "function (d) {\n                  return 'Изменено<br>'+(!d.isThisYear()\n    \t\t\t\t\t\t\t\t? d.format('{d} {mon} {yyyy}', 'ru')\n    \t\t\t\t\t\t\t\t: !d.isToday()\n    \t\t\t\t\t\t\t\t? d.format('{d} {mon}, {H}:{mm}', 'ru')\n                    :\td.format('cегодня, {H}:{mm}', 'ru'))\n                }","BTN_IMG": "Изменить…","BTN_SAVE": "Сохранить","BTN_CLOSE": "Закрыть","SAVED": "Изменения сохранены","CROP_SELECT": "Выберите фото...","CROP_OK": "Сохранить","CROP_CANCEL": "Отмена"}},"ui": {"#uname": {"bind": "function (d,v) {\n      if (!d.doc._rev) {\n      \tif (v!=null) d.doc.name = v.trim().replace(/:/g,'').replace(/^_/,'');\n      \td.doc._id = 'org.couchdb.user:' + d.doc.name;\n        return v;\n      }\n      return d.doc.name;\n    }","check": "function (d,v) {\n      var that = this,\n          exist;\n      if (!v) return that.lang.ERR_LOGINREQ;\n      if (v.has(':') || /^_/.test(v)) return this.lang.ERR_LOGIN;\n\n      if (!d.doc._rev && !!that.Users[v.trim()]) {\n        return that.lang.ERR_INUSE;\n      }\n    }","css": {"self:gray-2": "function (d,v) {\n        return !!d.doc._rev;\n      }",":disabled": "function (d,v) {\n        return !!d.doc._rev || /^tel_/.test(v);\n      }"}},"#upass": {"bind": "function (d,v) {\n      var that = this,\n          p = that.Proxy;\n      if (v!=null) p.password = v;\n      if (p.password) {\n        d.doc.password = p.password;\n        that.PwdKeys.forEach(function(i){ delete d.doc[i] });\n      }\n      else {\n        delete d.doc.password;\n        Object.keys(p.secret).forEach(function(i){d.doc[i] = p.secret[i]});\n      }\n      return p.password;\n    }","check": "function (d,v) {\n      var s = v.trim();\n      if (!d.doc._rev && !s) return this.lang.ERR_PWD_REQ;\n      if (s && s.length<4) return this.lang.ERR_PWD_4;\n    }"},"#uroles": {"init": "function ($o) {\n      var that = this;\n    \t$o.select2({\n      \ttags:\t\t\t\t\tObject.keys(that.Roles).sort(),\n        placeholder:\tthat.lang.PLC_ROLES\n      });\n    }","bind": "function (d,v) {\n    \tif (v!=null) d.doc.roles = v;\n      return v || d.doc.roles;\n    }","check": "function (d,v) {\n    \tif (v.find(/^_/)) return this.lang.ERR_ROLES_;\n      \n    }"},"#uava": {"bind": "function (d,v) {\n      var that = this,\n          doc = d.doc,\n          img, atts;\n      \n      if (v!=null) {\n      \t$.my.modal({\n\t\t\t\t\tmanifest:'cw.Sys.Cropper.Square',\n          data:{data:'', filename:'', size:200, png:false, allowSVG:false}\n\t\t\t\t})\n        .then(function (crop) {\n          if (!crop || !crop.data) return;\t\n\n          var I = new Image();\n          I.src = 'data:' + crop.mime + ';base64,' + crop.data;\n          I.onload = function(){\n            var img = cw.lib.image(I);\n            try {\n              if (!d.doc._attachments) d.doc._attachments = {};\n              \n              d.doc._attachments['200.jpg'] = {\n                content_type:\t'image/jpeg', \n                data:\t\t\t\t\tcrop.data\n              };\n\n              d.doc._attachments['100.jpg'] = {\n                content_type:\t'image/jpeg', \n                data:\t\t\t\t\timg.resample(100).sharpen(0.2).jpeg(0.95).substr(23)\n              };\n              \n              img = cw.lib.image(I);\n              d.doc.pic = img.resample(64).brightness(1.05).contrast(1.05).sharpen(0.5).jpeg(0.8);\n              \n              that.my.recalc('#uava');\n            }\n            catch(e){console.log(e)}\t\t\t\t\t\t\t\t\n            crop.data = '';\n          }\n        });\n      }\n      \n      \n      if (atts = doc._attachments) \n        ['200.jpg', '100.jpg'].forEach(function(fname){\n          if (img) return;\n          if (atts[fname] && atts[fname].data) img = 'data:image/jpeg;base64,'+atts[fname].data;\n        });\n      else if (doc.pic && Object.isString(doc.pic) && doc.pic.to(10) == 'data:image') img = doc.pic;\n\n      return img || ('data:image/svg+xml;base64,'+btoa(that.SVG.Empty));\n    }","events": "click.my"},"#uaux": {"delay": 10,"list": "<div class=\"w100p wrow\"></div>","bind": "this.Blocks","id": ["_aux"],"hash": "function (d) {return cw.lib.sdbm(d);}","check": true,"manifest": "function (block) {\n    \tvar that = this,\n          d = that.data,\n          doc = d.doc;\n      return that.Aux[block._aux];\n      \n    }","init": "function ($o) {\n      var that = this;\n    \t/*$o.on('shuffle.my', function(){\n        //console.log(1)\n      \tthat.Blocks = that.Blocks.sortBy(function(e, i){\n          return e._priority - (e._collapsed?1e6:0)\n        }, true);\n        //console.log(Object.clone(that.Blocks, true))\n        that.my.recalc('#uaux');\n        //that.my.check('#uaux');\n      }.debounce(50));*/\n    }","watch": ["#uroles"]},"#uproxy": {"delay": 100,"bind": "function (d,v) {\n    \tvar that = this;\n      \n      that.Blocks.forEach(function(b){\n      \tb._affects.forEach(function(path){\n        \tcw.lib.unmask(d.doc, [cw.lib.getref(b, path)], [path]);\n        });\n      })\n    }","watch": ["#uaux"]},"#btn-closedoc": "function (d,v) {\n    if(v!=null) this.my.cancel();\n  }","#btn-savedoc": {"bind": "function (d,v) {\n      var that = this;\n      if(v!=null && that.app) {\n        this.db.save(d.doc)\n        .then(function(){\n        \tthat.app.close(null, true);\n        });\n      }\n    }","css": {":disabled": "function () {\n      \treturn !this.my.valid();\n      }"},"watch": ["#uname","#upass","#uroles","#uaux"]},"#ustamp": {"bind": "function (d,v) {\n    \tif (d.doc.stamp==null) return '';\n      var dt =  Date.create(+d.doc.stamp);\n      if (dt.isThisYear()) {\n      \treturn this.lang.MSG_STAMP(dt);\n      } \n      else{\n      \t\n      }\n    }","events": "click.my","css": {"hide": "function (d) {\n        return d.doc.stamp == null || !/^\\d{12,14}$/.test(d.doc.stamp+'');\n      }"},"watch": "#btn-savedoc"}},"HTML": "<div id=\"ucontainer\">\n  \n  <div class=\"uw-label pr20 dib vat tac\">\n    <img src=\"\" id=\"uava\" class=\"uw-ava br4 mb0 cp\" title=\"{BTN_IMG}\">\n  </div>\n  \n  <div class=\"uw-input dib vat mt1\">\n    <div class=\"wrow\">\n      <input type=\"text\" id=\"uname\" class=\"w100p fs110 bolder\" placeholder=\"{PLC_LOGIN}\"/>\n      <div class=\"my-error-tip\" style=\"display:none\"></div>\n    </div>\n    <div class=\"wrow\">\n      <input type=\"text\" id=\"upass\" class=\"w100p fs90\" placeholder=\"{PLC_PWD}\"/>\n      <div class=\"my-error-tip\" style=\"display:none\"></div>\n    </div>\n    <div class=\"wrow\">\n      <input type=\"text\" id=\"uroles\" class=\"w100p fs100\"/>\n      <div class=\"my-error-tip\" style=\"display:none\"></div>\n    </div>\n  </div>\n  \n  <div id=\"uaux\" class=\"uw-full oh mt15 pt20 btd\">\n  \n  </div>\n  \n  <div class=\"uw-full\"><div class=\"mt15 pt20 bts nw\">\n    \n    <div id=\"ustamp\" class=\"fs70 gray lh120 fr tar\"></div>\n    <button id=\"btn-savedoc\" class=\"mr5 green\">&nbsp;{BTN_SAVE}&nbsp;</button>\n    <button id=\"btn-closedoc\" class=\"\">{BTN_CLOSE}</button>\n    \n    <div id=\"rolesproxy\" class=\"mt15 fs80 gray w100p lh130 hide\"></div>\n \t</div></div>\n</div>\n<div id=\"uproxy\" class=\"hide\"></div>\n\n","style": {" .wrow": "margin-bottom:6px;"," input[type=\"checkbox\"], input[type=\"radio\"]": "display:inline-flex;margin-right:2px;"," input:disabled": "color:inherit; background-color:#e3e9ec; border: 1px solid transparent!important;"," .usercard": "margin:0 45px 45px 0;width:370px;"," .usercard:nth-child(3n)": "margin:0 0px 45px 0;"," ": "font-size:20px; line-height:27px;","   ": "function ($o) {\n    var css;\n    try {\n    var that = this,\n        isApp = !!that.app,\n        w = $o.width(),\n        p0 = w>400?30:20,\n        w0 = (w-p0*2).clamp(310, 640),\n        m0 = w0>400?'50px auto':'0 auto',\n        br = w>400?'4':'0',\n        wt = function(w){ return 'width:{1}px;'.assign(w)},\n        css = {\n          ' ':\t\t\t\t\t\t'font-size:{1}px; line-height:{2}px;'.assign(w0>400?20:18, w0>400?27:24),\n        \t' .uw-full':\t\twt(w0),\n          ' .uw-label':\t\twt(w0*0.24|0),\n          ' .uw-ava':\t\t\t'width:{1}px;height:{1}px;'.assign(w0*0.24 - 20 |0),\n          ' .uw-pl-label':\t\t'padding-left:'+(w0*0.24|0)+'px;',\n          ' .uw-input':\t\twt(w0 - (w0*0.24|0)),\n          ' .uw-btn':\t\t\twt((w0*0.1|0).clamp(35,50)),\n          ' .uw-input-btn': wt(w0 - (w0*0.24|0) - (w0*0.1|0).clamp(35,50)),\n          \n        };\n\n    if (isApp) $.extend(css, {\n      '':[\n        'background-color:#cdd6e7;background-image:linear-gradient(to top,#a4b2ca,#cdd6e6);',\n        'min-height:'+(window.innerHeight - $('#cw-header').height())+'px!important;'\n      ].join(''),\n      \n      ' #ucontainer':[\n        'width:'+(w0+p0*2)+'px; padding:'+p0+'px; border-radius:4px; background:white;',\n        'box-shadow:1px 8px 15px -5px rgba(9,20,47,0.11), 0 0 15px 0px rgba(5,23,69,0.06);',\n        'margin:'+m0+'; border-radius:'+br+'px;'\n      ].join('')\n    });\n    } catch(e) {console.log(e)}\n    \n    return css;\n\n  }"," .select2-container-multi .select2-choices": "padding:2px 1px 3px 1px;"," .uw-btn button": "padding-left:0;padding-right:0;"," .my-error-tip": "font-size:75%!important; padding:2px 0 3px 2px!important;"},"GetCounter": "function () {\n\tvar that = this,\n      d = that.data;\n  \n  if (!that.app) return;\n  \n  return that.db.query('rolesAndFields',{reduce:true, group_level:2})\n  .then(function(res){\n\t\tres.rows.forEach(function(row){\n    \tvar k = row.key,\n          r = k[0],\n          p = k[1],\n          v = row.value;\n      \n      if (r == '_name') {\n      \tif (!d.doc._rev || p!==d.doc.name) that.Users[p] = true;\n      }\n      else if (r == '_role') {\n      \tthat.Roles[p] = true;\n      }\n      else {\n      \tif (!that.Fields[r]) that.Fields[r] = {};\n        that.Fields[r][p] = v;\n      }\n    })\n  });\n  \n}","isUsersDB": "function () {\n  var that = this,\n      d = that.data;\n\tif (!that.app || !that.db || !Object.isFunction(that.db.settings)) return false;\n  \n  var s = that.db.settings();\n  \n  if (!/\\/_users[\\/]?$/.test(s.url) && !(s.sync||[]).find(e=>(/\\/_users[\\/]?$/).test(e.url))) return false;\n  \n  return true;\n}","SVG": {"Empty": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"100\" height=\"100\" viewBox=\"0, 0, 100, 100\">\n  <defs>\n    <clipPath id=\"Clip_1\">\n      <path d=\"M0,0 L100,0 L100,100 L0,100 L0,0 z\"/>\n    </clipPath>\n  </defs>\n  <g id=\"Layer_1\">\n    <g>\n      <path d=\"M0,0 L100,0 L100,100 L0,100 L0,0 z\" fill=\"#e4e9f0 \"/>\n      <g clip-path=\"url(#Clip_1)\">\n        <path d=\"M0.5,0.5 L100.5,100.5\" fill-opacity=\"0\" stroke=\"#ffffff\" stroke-width=\"1.414\" stroke-dasharray=\"2,2\"/>\n        <path d=\"M100.5,0.5 L0.5,100.5\" fill-opacity=\"0\" stroke=\"#ffffff\" stroke-width=\"1.414\" stroke-dasharray=\"2,2\"/>\n      </g>\n    </g>\n  </g>\n</svg>"},"queries": {"rolesAndFields": {"map": " function (doc) {\n    if(doc.type != 'user') return;\n    var keys = {}, exclude = {\n      derived_key:1,salt:1,iterations:1,\n      password_scheme:1,password:1, \n      _id:1,_rev:1,type:1,roles:1\n    };\n    Object.keys(doc).forEach(function(i){\n      if (exclude[i] || doc[i] == null) return;\n      var t = typeof doc[i];\n      keys[i] = \n        t=='string'      ? 's'\n      : t=='number'      ? 'n'\n      : t=='boolean'    ? 'b'\n      : isArray(doc[i])  ? 'a'\n      : 'o'\n    });\n\n    Object.keys(keys).forEach(function(i){\n      emit([i, keys[i]], 1);\n    });\n\n    emit (['_name',doc.name], 1);\n    \n    doc.roles.forEach(function(role){\n      emit(['_role',role], 1)\n    });\n  }","reduce": "_sum"}}},"raw": {"name": "Couch.User","title": "User Editor","version": "1.3","build": 87,"com": [{"stamp": "1484243179297","id": "Root","type": "js","data": "({\n    \n  // CloudWall CouchDB users editor\n  // (c) 2018 ermouth\n  \n\tparams:{delay:10, restyle:1},\n\tdata:{\n\t\tcmd:'',\n    stash:{},\n\t\tdoc:{\n      _id:\t\t'',\n      type:\t\t'user',\n      name:\t\t'',\n      roles:\t[]\n    }\n\t},\n\tPwdKeys:['derived_key', 'salt', 'iterations', 'password_scheme'],\n\tProxy:{\n\t\tpassword:'',\n\t\tname:'',\n\t\tapps:[],\n\t\tlang:[''],\n\t\torg:'',\n\t\trole:[''],\n\t\tother:[],\n\t\torg:'',\n\t\tsecret:{}\n\t},\n\tP:[],\n  \n\tUsers:{},\n  Roles:{},\n  Fields:{},\n  \n  \n  Aux:{ /* Aux widgets */ },\n  Blocks:[ /*Aux blocks, filtered and sorted widgets subset */],\n  \n  RT: function(key){\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t}\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1537823848404","id": ".init","type": "js","data": "(function($o) {\n  var that = this,\n      doc = that.data.doc,\n      pis = [],\n      _ref = cw.lib.getref;\n\n  $o.formgen('init', that.HTML.assign(that.lang));\n\n  if (that.app && !that.isUsersDB()) {\n  \treturn $.Deferred().reject(that.lang.NODB).promise();\n  }\n\n  // Save pwd related stuff\n  var p = that.Proxy;\n  that.PwdKeys.forEach(function(i){\n    if (doc[i]) p.secret[i] = doc[i];\n  });\n\n  that.data.stash = Object.clone(doc, true);\n\n  if (doc._attachments) {\n    pis.push(\n      that.db.att(doc._id).data(/\\.jp[e]?g$/)\n      .then(function(res){\n        Object.keys(res).forEach(function(k){\n          doc._attachments[k].data = res[k].data;\n          delete doc._attachments[k].stub;\n        });\n      })\n    );\n  }\n\n  if (that.app) {\n    pis.push(that.GetCounter());\n  }\n\n  return Q.all(pis)\n  .then(function(){\n  \t// Prepare aux fields\n    var blocks = [];\n    Object.keys(that.Aux).forEach(function(k){\n    \tvar man = that.Aux[k],\n          ext;\n      try{ext = man.canHandle.call(that, doc);} catch(e){}\n      if (!ext) return;\n      \n      blocks.push($.extend(true, {_aux:k}, doc, ext));\n    });\n    that.Blocks = blocks.sortBy(function(e){\n      return e._priority - (e._collapsed?1e6:0)\n    }, true);\n    \n    // Prepare stamp\n    if (!that.app || _ref(that.Fields, ['stamp','s']) || _ref(that.Fields, ['stamp','n']) && doc.stamp==null) {\n      doc.stamp = Date.now();\n    }\n  });\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1484252807413","id": ".lang.en","type": "js","data": "({\n\t\n  NODB:\t\t'User editor can only run for a bucket, synced with or attached to /_users.',\n\tDENIED:\t'You have no rights to edit users or network is down.',\n\n\tBTN_ADDUSER:\t'Add new user...',\n\tERR_NET:\t\t\t'Couldn‘t save changes, see datails at console.',\n\n\tPLC_LOGIN:\t\t'Login',\n  ERR_INUSE:\t\t'Login is already in use',\n\tERR_LOGINREQ:\t'Login is required',\n  ERR_LOGIN:\t\t'Login can’t contain : or start with _',\n  \n\tPLC_PWD:\t\t\t'New password',\n  ERR_PWD_REQ:\t'Password is required',\n  ERR_PWD_4:\t\t'4+ characters',\n  \n  PLC_ROLES:\t\t'Select user roles',\n  ERR_ROLES_:\t\t'Roles can’t start with _',\n  \n\tMSG_STAMP:\t\tfunction(d){\n                  return 'Last saved<br>' + (!d.isThisYear()\n    \t\t\t\t\t\t\t\t? d.format('{Mon} {d}, {yyyy}', 'en')\n    \t\t\t\t\t\t\t\t: !d.isToday()\n                    ? d.format('{Mon} {d}, {h}:{mm} {tt}', 'en')\n    \t\t\t\t\t\t\t\t: d.format('today, {h}:{mm} {tt}', 'en'))\n                },\n  \n  BTN_IMG:\t\t\t'Change…',\n\tBTN_SAVE:\t\t\t'Save and close',\n\tBTN_CLOSE:\t\t'Close',\n\tSAVED:\t\t\t\t'Changes saved',\n\t\n\tCROP_SELECT:\t'Select image...',\n\tCROP_OK:\t\t\t'Apply',\n\tCROP_CANCEL:\t'Cancel',\n\t\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1484247147241","id": ".lang.ru","type": "js","data": "({\n\t\n  NODB:\t\t'Приложение можно запускать только из БД, привязанным к базе /_users.',\n\tDENIED:\t'У вас нет прав редактировать список пользователей или сеть недоступна.',\n\n\tBTN_ADDUSER:\t'Добавить пользователя...',\n\tERR_NET:\t\t\t'Ошибка сохранения, детали выведены в консоль.',\n\n\tPLC_LOGIN:\t\t'Логин',\n  ERR_INUSE:\t\t'Логин занят',\n\tERR_LOGINREQ:\t'Логин обязателен',\n  ERR_LOGIN:\t\t'Логин не может содержать : и начинаться с _',\n  \n\tPLC_PWD:\t\t\t'Новый пароль',\n  ERR_PWD_REQ:\t'Пароль обязателен',\n  ERR_PWD_4:\t\t'4+ символа',\n  \n  PLC_ROLES:\t\t'Роли пользователя',\n  ERR_ROLES_:\t\t'Роли не могут начнаться с _',\n  \n  MSG_STAMP:\t\tfunction(d){\n                  return 'Изменено<br>'+(!d.isThisYear()\n    \t\t\t\t\t\t\t\t? d.format('{d} {mon} {yyyy}', 'ru')\n    \t\t\t\t\t\t\t\t: !d.isToday()\n    \t\t\t\t\t\t\t\t? d.format('{d} {mon}, {H}:{mm}', 'ru')\n                    :\td.format('cегодня, {H}:{mm}', 'ru'))\n                },\n\n  BTN_IMG:\t\t\t'Изменить…',\n\tBTN_SAVE:\t\t\t'Сохранить',\n\tBTN_CLOSE:\t\t'Закрыть',\n\tSAVED:\t\t\t\t'Изменения сохранены',\n\t\n\tCROP_SELECT:\t'Выберите фото...',\n\tCROP_OK:\t\t\t'Сохранить',\n\tCROP_CANCEL:\t'Отмена',\n\t\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1484353444563","id": ".ui","type": "js","data": "// name, roles, pwd\n({\n  \n  \"#uname\":{\n\n    bind:function(d,v){\n      if (!d.doc._rev) {\n      \tif (v!=null) d.doc.name = v.trim().replace(/:/g,'').replace(/^_/,'');\n      \td.doc._id = 'org.couchdb.user:' + d.doc.name;\n        return v;\n      }\n      return d.doc.name;\n    },\n    check:function(d,v){\n      var that = this,\n          exist;\n      if (!v) return that.lang.ERR_LOGINREQ;\n      if (v.has(':') || /^_/.test(v)) return this.lang.ERR_LOGIN;\n\n      if (!d.doc._rev && !!that.Users[v.trim()]) {\n        return that.lang.ERR_INUSE;\n      }\n    },\n    css:{\n      \"self:gray-2\": function(d,v){\n        return !!d.doc._rev;\n      },\n      \":disabled\": function(d,v){\n        return !!d.doc._rev || /^tel_/.test(v);\n      }\n    }\n\n  },\n\n  \"#upass\" :{\n    bind:function(d,v){\n      var that = this,\n          p = that.Proxy;\n      if (v!=null) p.password = v;\n      if (p.password) {\n        d.doc.password = p.password;\n        that.PwdKeys.forEach(function(i){ delete d.doc[i] });\n      }\n      else {\n        delete d.doc.password;\n        Object.keys(p.secret).forEach(function(i){d.doc[i] = p.secret[i]});\n      }\n      return p.password;\n    },\n    check: function(d,v){\n      var s = v.trim();\n      if (!d.doc._rev && !s) return this.lang.ERR_PWD_REQ;\n      if (s && s.length<4) return this.lang.ERR_PWD_4;\n    }\n  },\n  \n\t'#uroles':{\n  \tinit: function($o){\n      var that = this;\n    \t$o.select2({\n      \ttags:\t\t\t\t\tObject.keys(that.Roles).sort(),\n        placeholder:\tthat.lang.PLC_ROLES\n      });\n    },\n    bind: function(d,v){\n    \tif (v!=null) d.doc.roles = v;\n      return v || d.doc.roles;\n    },\n    check: function(d,v){\n    \tif (v.find(/^_/)) return this.lang.ERR_ROLES_;\n      \n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1484249329931","id": ".ui","type": "js","data": "// ava\n({\n  \n  \"#uava\": {\n    bind: function(d,v){\n      var that = this,\n          doc = d.doc,\n          img, atts;\n      \n      if (v!=null) {\n      \t$.my.modal({\n\t\t\t\t\tmanifest:'cw.Sys.Cropper.Square',\n          data:{data:'', filename:'', size:200, png:false, allowSVG:false}\n\t\t\t\t})\n        .then(function (crop) {\n          if (!crop || !crop.data) return;\t\n\n          var I = new Image();\n          I.src = 'data:' + crop.mime + ';base64,' + crop.data;\n          I.onload = function(){\n            var img = cw.lib.image(I);\n            try {\n              if (!d.doc._attachments) d.doc._attachments = {};\n              \n              d.doc._attachments['200.jpg'] = {\n                content_type:\t'image/jpeg', \n                data:\t\t\t\t\tcrop.data\n              };\n\n              d.doc._attachments['100.jpg'] = {\n                content_type:\t'image/jpeg', \n                data:\t\t\t\t\timg.resample(100).sharpen(0.2).jpeg(0.95).substr(23)\n              };\n              \n              img = cw.lib.image(I);\n              d.doc.pic = img.resample(64).brightness(1.05).contrast(1.05).sharpen(0.5).jpeg(0.8);\n              \n              that.my.recalc('#uava');\n            }\n            catch(e){console.log(e)}\t\t\t\t\t\t\t\t\n            crop.data = '';\n          }\n        });\n      }\n      \n      \n      if (atts = doc._attachments) \n        ['200.jpg', '100.jpg'].forEach(function(fname){\n          if (img) return;\n          if (atts[fname] && atts[fname].data) img = 'data:image/jpeg;base64,'+atts[fname].data;\n        });\n      else if (doc.pic && Object.isString(doc.pic) && doc.pic.to(10) == 'data:image') img = doc.pic;\n\n      return img || ('data:image/svg+xml;base64,'+btoa(that.SVG.Empty));\n    },\n    events:'click.my'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1537828266684","id": ".ui","type": "js","data": "// aux\n({\n\t'#uaux':{\n    delay:\t10,\n  \tlist:\t\t'<div class=\"w100p wrow\"></div>',\n    bind:\t\t'this.Blocks',\n    id:\t\t\t['_aux'],\n    hash: \tfunction(d){return cw.lib.sdbm(d);},\n    check:\ttrue,\n    manifest: function(block){\n    \tvar that = this,\n          d = that.data,\n          doc = d.doc;\n      return that.Aux[block._aux];\n      \n    },\n    init: function($o){\n      var that = this;\n    \t/*$o.on('shuffle.my', function(){\n        //console.log(1)\n      \tthat.Blocks = that.Blocks.sortBy(function(e, i){\n          return e._priority - (e._collapsed?1e6:0)\n        }, true);\n        //console.log(Object.clone(that.Blocks, true))\n        that.my.recalc('#uaux');\n        //that.my.check('#uaux');\n      }.debounce(50));*/\n    },\n    watch:['#uroles']\n  },\n  \n  \n  \n  '#uproxy':{\n    delay:100,\n    bind: function(d,v){\n    \tvar that = this;\n      \n      that.Blocks.forEach(function(b){\n      \tb._affects.forEach(function(path){\n        \tcw.lib.unmask(d.doc, [cw.lib.getref(b, path)], [path]);\n        });\n      })\n    },\n  \twatch:['#uaux']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1537747841893","id": ".ui","type": "js","data": "// btns, stamp\n({\n\n\t'#btn-closedoc':function(d,v){\n    if(v!=null) this.my.cancel();\n  },\n\n\t'#btn-savedoc':{\n    bind: function(d,v){\n      var that = this;\n      if(v!=null && that.app) {\n        this.db.save(d.doc)\n        .then(function(){\n        \tthat.app.close(null, true);\n        });\n      }\n    },\n    css:{\n    \t':disabled':function(){\n      \treturn !this.my.valid();\n      }\n    },\n    watch:['#uname','#upass','#uroles','#uaux']\n  },\n  \n  '#ustamp':{\n  \tbind: function(d,v){\n    \tif (d.doc.stamp==null) return '';\n      var dt =  Date.create(+d.doc.stamp);\n      if (dt.isThisYear()) {\n      \treturn this.lang.MSG_STAMP(dt);\n      } \n      else{\n      \t\n      }\n    },\n    events:'click.my',\n    css:{\n    \thide: function(d){\n        return d.doc.stamp == null || !/^\\d{12,14}$/.test(d.doc.stamp+'');\n      }\n    },\n    watch:'#btn-savedoc'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1484249034796","id": ".HTML","type": "html","data": "<div id=\"ucontainer\">\n  \n  <div class=\"uw-label pr20 dib vat tac\">\n    <img src=\"\" id=\"uava\" class=\"uw-ava br4 mb0 cp\" title=\"{BTN_IMG}\">\n  </div>\n  \n  <div class=\"uw-input dib vat mt1\">\n    <div class=\"wrow\">\n      <input type=\"text\" id=\"uname\" class=\"w100p fs110 bolder\" placeholder=\"{PLC_LOGIN}\"/>\n      <div class=\"my-error-tip\" style=\"display:none\"></div>\n    </div>\n    <div class=\"wrow\">\n      <input type=\"text\" id=\"upass\" class=\"w100p fs90\" placeholder=\"{PLC_PWD}\"/>\n      <div class=\"my-error-tip\" style=\"display:none\"></div>\n    </div>\n    <div class=\"wrow\">\n      <input type=\"text\" id=\"uroles\" class=\"w100p fs100\"/>\n      <div class=\"my-error-tip\" style=\"display:none\"></div>\n    </div>\n  </div>\n  \n  <div id=\"uaux\" class=\"uw-full oh mt15 pt20 btd\">\n  \n  </div>\n  \n  <div class=\"uw-full\"><div class=\"mt15 pt20 bts nw\">\n    \n    <div id=\"ustamp\" class=\"fs70 gray lh120 fr tar\"></div>\n    <button id=\"btn-savedoc\" class=\"mr5 green\">&nbsp;{BTN_SAVE}&nbsp;</button>\n    <button id=\"btn-closedoc\" class=\"\">{BTN_CLOSE}</button>\n    \n    <div id=\"rolesproxy\" class=\"mt15 fs80 gray w100p lh130 hide\"></div>\n \t</div></div>\n</div>\n<div id=\"uproxy\" class=\"hide\"></div>\n\n","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1484249050905","id": ".style","type": "js","data": "({\n  ' .wrow':'margin-bottom:6px;',\n  ' input[type=\"checkbox\"], input[type=\"radio\"]':'display:inline-flex;margin-right:2px;',\n  \" input:disabled\":\"color:inherit; background-color:#e3e9ec; border: 1px solid transparent!important;\",\n  \" .usercard\":\"margin:0 45px 45px 0;width:370px;\",\n  \" .usercard:nth-child(3n)\":\"margin:0 0px 45px 0;\",\n\n\n  ' ':'font-size:20px; line-height:27px;',\n  '   ': function($o){\n    var css;\n    try {\n    var that = this,\n        isApp = !!that.app,\n        w = $o.width(),\n        p0 = w>400?30:20,\n        w0 = (w-p0*2).clamp(310, 640),\n        m0 = w0>400?'50px auto':'0 auto',\n        br = w>400?'4':'0',\n        wt = function(w){ return 'width:{1}px;'.assign(w)},\n        css = {\n          ' ':\t\t\t\t\t\t'font-size:{1}px; line-height:{2}px;'.assign(w0>400?20:18, w0>400?27:24),\n        \t' .uw-full':\t\twt(w0),\n          ' .uw-label':\t\twt(w0*0.24|0),\n          ' .uw-ava':\t\t\t'width:{1}px;height:{1}px;'.assign(w0*0.24 - 20 |0),\n          ' .uw-pl-label':\t\t'padding-left:'+(w0*0.24|0)+'px;',\n          ' .uw-input':\t\twt(w0 - (w0*0.24|0)),\n          ' .uw-btn':\t\t\twt((w0*0.1|0).clamp(35,50)),\n          ' .uw-input-btn': wt(w0 - (w0*0.24|0) - (w0*0.1|0).clamp(35,50)),\n          \n        };\n\n    if (isApp) $.extend(css, {\n      '':[\n        'background-color:#cdd6e7;background-image:linear-gradient(to top,#a4b2ca,#cdd6e6);',\n        'min-height:'+(window.innerHeight - $('#cw-header').height())+'px!important;'\n      ].join(''),\n      \n      ' #ucontainer':[\n        'width:'+(w0+p0*2)+'px; padding:'+p0+'px; border-radius:4px; background:white;',\n        'box-shadow:1px 8px 15px -5px rgba(9,20,47,0.11), 0 0 15px 0px rgba(5,23,69,0.06);',\n        'margin:'+m0+'; border-radius:'+br+'px;'\n      ].join('')\n    });\n    } catch(e) {console.log(e)}\n    \n    return css;\n\n  },\n  \n  ' .select2-container-multi .select2-choices':'padding:2px 1px 3px 1px;',\n  \n  ' .uw-btn button':'padding-left:0;padding-right:0;',\n  \n  ' .my-error-tip':'font-size:75%!important; padding:2px 0 3px 2px!important;'\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1484353129677","id": ".data.doc","type": "js","data": "({\n\t//_phoneOnly:true\n\t//_rev:'1-1234',\n\tname:'erm',\n\t//state:'inactive',\n\t//title:'Ermouth',\n\t\"password_scheme\": \"pbkdf2\",\n       \"iterations\": 10,\n       \"salt\": \"92ecdceff027cb22b9095346a6\",\n       \"derived_key\": \"9f5b2b29df76d9cdf8e793b11b3a83\",\n\t\n\t//stash:{\"password_scheme\": \"pbkdf2\",\"iterations\": 5,\"salt\": \"09095346a0\",\"derived_key\": \"0f5b2b1b3a80\"}\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["red"]},{"stamp": "1537819374771","id": ".GetCounter","type": "js","data": "(function(){\n\tvar that = this,\n      d = that.data;\n  \n  if (!that.app) return;\n  \n  return that.db.query('rolesAndFields',{reduce:true, group_level:2})\n  .then(function(res){\n\t\tres.rows.forEach(function(row){\n    \tvar k = row.key,\n          r = k[0],\n          p = k[1],\n          v = row.value;\n      \n      if (r == '_name') {\n      \tif (!d.doc._rev || p!==d.doc.name) that.Users[p] = true;\n      }\n      else if (r == '_role') {\n      \tthat.Roles[p] = true;\n      }\n      else {\n      \tif (!that.Fields[r]) that.Fields[r] = {};\n        that.Fields[r][p] = v;\n      }\n    })\n  });\n  \n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1538007397221","id": ".isUsersDB","type": "js","data": "(function(){\n  var that = this,\n      d = that.data;\n\tif (!that.app || !that.db || !Object.isFunction(that.db.settings)) return false;\n  \n  var s = that.db.settings();\n  \n  if (!/\\/_users[\\/]?$/.test(s.url) && !(s.sync||[]).find(e=>(/\\/_users[\\/]?$/).test(e.url))) return false;\n  \n  return true;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1537745793685","id": ".SVG.Empty","type": "html","data": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"100\" height=\"100\" viewBox=\"0, 0, 100, 100\">\n  <defs>\n    <clipPath id=\"Clip_1\">\n      <path d=\"M0,0 L100,0 L100,100 L0,100 L0,0 z\"/>\n    </clipPath>\n  </defs>\n  <g id=\"Layer_1\">\n    <g>\n      <path d=\"M0,0 L100,0 L100,100 L0,100 L0,0 z\" fill=\"#e4e9f0 \"/>\n      <g clip-path=\"url(#Clip_1)\">\n        <path d=\"M0.5,0.5 L100.5,100.5\" fill-opacity=\"0\" stroke=\"#ffffff\" stroke-width=\"1.414\" stroke-dasharray=\"2,2\"/>\n        <path d=\"M100.5,0.5 L0.5,100.5\" fill-opacity=\"0\" stroke=\"#ffffff\" stroke-width=\"1.414\" stroke-dasharray=\"2,2\"/>\n      </g>\n    </g>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": []},{"stamp": "1537819184632","id": ".queries.rolesAndFields","type": "js","data": "({\n  map: ' '+ (function (doc) {\n    if(doc.type != 'user') return;\n    var keys = {}, exclude = {\n      derived_key:1,salt:1,iterations:1,\n      password_scheme:1,password:1, \n      _id:1,_rev:1,type:1,roles:1\n    };\n    Object.keys(doc).forEach(function(i){\n      if (exclude[i] || doc[i] == null) return;\n      var t = typeof doc[i];\n      keys[i] = \n        t=='string'\t\t\t? 's'\n      : t=='number'\t\t\t? 'n'\n      : t=='boolean'\t\t? 'b'\n      : isArray(doc[i])\t? 'a'\n      : 'o'\n    });\n\n    Object.keys(keys).forEach(function(i){\n      emit([i, keys[i]], 1);\n    });\n\n    emit (['_name',doc.name], 1);\n    \n    doc.roles.forEach(function(role){\n    \temit(['_role',role], 1)\n    });\n  })\n  .toString().replace(/\\t/g,'  '),\n  \n  reduce: '_sum'\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1537823070510","id": ".Aux.Title","type": "js","data": "({\n  inherit:['RT'],\n  \n  Doc:{ /* Receives clone of original doc */},\n\tcanHandle: function(doc){\n  \t// Analyzes, if the add-on can accept\n    // current user doc.\n    // Returns array of props which would be affected\n    // or null if not applicable.\n    \n    // Below line means we reject docs having .title\n    // which is not string\n    \n    if (null != doc.title && typeof doc.title != 'string') return null;\n    \n    var that = this,\n        res = {\n          _affects: \t['title'],\n          _priority: \t1000,\n          _collapsed:\tdoc.title == null\n        };\n    \n    // Try to guess if this field exists\n    // in other doc with roles, same to current\n    if (null == doc.title) {\n      var expand = !!cw.lib.getref(that.Fields, ['title','s']);\n      if (expand) {\n        res._collapsed = false;\n        res.title = doc.title || '';\n      }\n    }\n    \n    return res;\n  },\n  \n  \n  data:{name:''},\n  \n  lang:{\n  \ten:{\n    \tLBL_TITLE:\t'Full name',\n      PLC_TITLE:\t'Enter full name',\n      ERR_TITLE:\t'200 chars max',\n      LBL_ADD:\t\t'＋ Add full name'\n    },\n    ru:{\n    \tLBL_TITLE:\t'Полное имя',\n      PLC_TITLE:\t'Введите полное имя',\n       ERR_TITLE:\t'200 символов максимум',\n      LBL_ADD:\t\t'＋ Добавить полное имя'\n    }\n  },\n  \n  init: function($o){\n  \tvar that = this,\n        d = that.data,\n        doc = that.Doc;\n    $.extend(true, doc, d);\n    d.name = doc.name;\n    if (null == doc.title) delete d.title;\n    $o.html(that.HTML.assign(that.lang));\n  },\n  \n  HTML:[\n  \t'<div id=\"title-container\" class=\"uw-full\">',\n    \t'<div id=\"title-label\" class=\"uw-label dib vat pr10 pt6 fs85 o70\">{LBL_TITLE}</div>',\n    \t'<div class=\"uw-input dib vat\">',\n    \t\t'<input id=\"title-value\" type=\"text\" class=\"w100p\" placeholder=\"{PLC_TITLE}\">',\n    \t\t'<div class=\"my-error-tip\" style=\"display:none\"></div>',\n    \t'</div>',\n    '</div>',\n    '<div id=\"title-add\" class=\"uw-full uw-pl-label fs85\">',\n      '<div id=\"btn-title-add\" class=\"pseudolink tdn dib vat\">',\n        '{LBL_ADD}',\n      '</div>',\n    '</div>'\n  ].join(''),\n  \n  ui:{\n    '#title-container':{\n    \tcss:{\n      \thide: function(d){return d.title == null;}\n      },\n      watch:['#btn-title-add']\n    },\n    '#title-value':{\n  \t\tbind: function(d,v){\n      \tif (v!=null) {\n          var s = v.stripTags();\n        \tif (d.title != null) d.title = s.trim();\n          return s;\n        }\n        return d.title || '';\n      },\n  \t},\n  \t'#btn-title-add':{\n      bind:function(d,v){\n      \tif (v!=null) {\n          d.title = '';\n          d._collapsed = false;\n          this.my.root().trigger('shuffle.my');\n        }\n      },\n    \tevents:'click.my'\n    }\n  },\n  \n  style:{\n    ' #title-add':'display:none;',\n  \t' #title-container.hide~#title-add':'display:block;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1537832935526","id": ".Aux.Email","type": "js","data": "({\n  inherit:['RT'],\n  \n\tcanHandle: function(doc){\n\t\tvar that = this,\n        affects = [],\n        props = ['email','e_mail','e-mail'],\n        prop;\n    \n    props.forEach(function(e){if(!prop && null!=doc[e]) prop = e;})\n    \n    if (prop && typeof doc[prop] != 'string') return null;\n    \n    prop = prop || props[0];\n    \n    var res = {\n      _affects: \t[prop],\n      _priority: \t900,\n      _collapsed:\tdoc[prop] == null\n    };\n    \n    // Try to guess if this field exists\n    // in other doc with roles, same to current\n    if (null == doc[prop]) {\n      var expand = !!cw.lib.getref(that.Fields, [prop,'s']);\n      if (expand) {\n        res._collapsed = false;\n        res[prop] = '';\n      }\n    }\n    \n    return res;\n  },\n  \n  Doc:{ /* Receives clone of original doc */},\n  data:{name:''},\n  \n  lang:{\n  \ten:{\n    \tLBL_EMAIL:\t'E-mail',\n      PLC_EMAIL:\t'Enter e-mail',\n      ERR_EMAIL:\t'Valid e-mail address, please',\n      LBL_ADD:\t\t'＋ Add e-mail',     \n      TIP_SEND:\t\t'Compose e-mail...'\n    },\n    \n    ru:{\n    \tLBL_EMAIL:\t'E-mail',\n      PLC_EMAIL:\t'Укажите e-mail',\n      ERR_EMAIL:\t'Некорректный адрес',\n      LBL_ADD:\t\t'＋ Добавить e-mail',     \n      TIP_SEND:\t\t'Отправить письмо...'\n    }\n  },\n  \n  init: function($o){\n  \tvar that = this,\n        d = that.data,\n        doc = that.Doc;\n    \n    $.extend(true, doc, d);\n\n    if (null == doc[doc._affects[0]]) delete doc[doc._affects[0]];\n    \n    $o.html(that.HTML.assign(that.lang));\n\n  },\n  \n  HTML:[\n  \t'<div id=\"email-container\" class=\"uw-full\">',\n    \t'<div id=\"email-label\" class=\"uw-label dib vat pr10 pt6 fs85 o70\">{LBL_EMAIL}</div>',\n    \t'<div class=\"uw-input-btn pr5 dib vat\">',\n    \t\t'<input id=\"email-value\" type=\"text\" class=\"w100p\" placeholder=\"{PLC_EMAIL}\">',\n    \t\t'<div class=\"my-error-tip\" style=\"display:none\"></div>',\n    \t'</div>',\n    \t'<div class=\"uw-btn dib vat\">',\n    \t\t'<a id=\"btn-email-send\" target=\"_blank\" class=\"button w100p dib vat pl0 tac pr0 br2\" title=\"{TIP_SEND}\">',\n    \t\t\t'<span class=\"fi-mail o70\"></span>',\n    \t\t'</a>',\n    \t'</div>',\n    '</div>',\n    '<div id=\"email-add\" class=\"uw-full uw-pl-label fs85\">',\n      '<div id=\"btn-email-add\" class=\"pseudolink tdn dib vat\">',\n        '{LBL_ADD}',\n      '</div>',\n    '</div>'\n  ].join(''),\n  \n  style:{\n    ' #email-add':'display:none;',\n  \t' #email-container.hide~#email-add':'display:block;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1537842108717","id": ".Aux.Email.ui","type": "js","data": "({\n  '#email-container':{\n    css:{\n      hide: function(d){return d[d._affects[0]] == null;}\n    },\n    watch:['#btn-email-add']\n  },\n  \n  '#email-value':{\n    bind: function(d,v){\n      var p = d._affects[0];\n      if (v!=null) {\n        if (d[p] != null) d[p] = v.trim().replace(/\\s/g,'');\n        return v;\n      }\n      return d[p] || '';\n    },\n    check: function(d,v){\n  \t\tif (!/^(|[^@]+@[^@]{3,})$/i.test(v)) return this.lang.ERR_EMAIL;\n  \t}\n  },\n  \n  '#btn-email-add':{\n    bind:function(d,v){\n      if (v!=null) {\n        d[d._affects[0]] = '';\n        d._collapsed = false;\n        this.my.root().trigger('shuffle.my');\n      }\n    },\n    events:'click.my'\n  },\n  \n  '#btn-email-send':{\n    bind:function(d,v,$o){\n    \tif (d[d._affects[0]] && this.my.valid()) $o.attr('href', 'mailto:'+d[d._affects[0]]);\n      else $o.attr('href','');\n    },\n    css:{\n    \tdisabled:function(d){\n      \treturn !d[d._affects[0]] || !this.my.valid();\n      }\n    },\n    //events:'click.my',\n  \twatch:'#email-value'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9IkdyYWRpZW50XzEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjQuMDc5IiB5MT0iMTE0IiB4Mj0iNjQuMDc5IiB5Mj0iMzciPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNGRkZGRkYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIwLjM4IiBzdG9wLWNvbG9yPSIjRkVBQzZGIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGQjg3NyIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iR3JhZGllbnRfMiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIzOS40MDEiIHkxPSIxOC4yNjUiIHgyPSIxMDYuMjQyIiB5Mj0iNjEuODQyIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjOTBDOEZGIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0E3RTdGRiIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iR3JhZGllbnRfMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMDAuNjAyIiB5MT0iMTA0LjE2MiIgeDI9Ijg0LjYzNyIgeTI9IjQxLjc4MyI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI0I0RDk3RiIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNDREZGODgiIHN0b3Atb3BhY2l0eT0iMCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0ZGQTRCQiIvPgogICAgPHBhdGggZD0iTTY0LjA3OSwxMTQgQzM2LjUwOSwxMTQgMTQuMTU5LDkxLjYxNCAxNC4xNTksNjQgQzE0LjE1OSwzNi4zODYgMzYuNTA5LDE0IDY0LjA3OSwxNCBDOTEuNjUsMTQgMTE0LDM2LjM4NiAxMTQsNjQgQzExNCw5MS42MTQgOTEuNjUsMTE0IDY0LjA3OSwxMTQgeiIgZmlsbD0idXJsKCNHcmFkaWVudF8xKSIvPgogICAgPHBhdGggZD0iTTU1LjI5NCw3Ny4xMjggQzU1LjI5NCw3Ny4xMjggNDguNzc0LDc0Ljk1MSA0OC43NzQsNjQuMDY3IEM0NS4xODMsNjQuMDY3IDQ1LjE4Myw1NS4zNiA0OC43NzQsNTUuMzYgQzQ4Ljc3NCw1My45MDEgNDIuMjU0LDM3Ljk0NSA1My4xMjEsNDAuMTIyIEM1NS4yOTQsMzEuNDE1IDc5LjIwMSwzMS40MTUgODEuMzc0LDQwLjEyMiBDODIuODgzLDQ2LjE2NSA3OS4yMDEsNTQuMjg5IDc5LjIwMSw1NS4zNiBDODIuNzkxLDU1LjM2IDgyLjc5MSw2NC4wNjcgNzkuMjAxLDY0LjA2NyBDNzkuMjAxLDc0Ljk1MSA3Mi42ODEsNzcuMTI4IDcyLjY4MSw3Ny4xMjggTDcyLjY4MSw4OC4wMTIgQzgzLjQ0OCw5Mi4wNTYgOTQuMTEsOTUuNCA5OS41Nyw5OS4yMjMgQzEwOC40NzIsOTAuMTg0IDExMy45NzUsNzcuNzY4IDExMy45NzUsNjQuMDY3IEMxMTMuOTc1LDM2LjQxMyA5MS41OTgsMTQgNjMuOTg3LDE0IEMzNi4zNzcsMTQgMTQsMzYuNDEzIDE0LDY0LjA2NyBDMTQsNzcuNzk0IDE5LjUyLDkwLjIyOCAyOC40NTMsOTkuMjc1IEMzNC4yMzQsOTUuMjY5IDQ1LjYzMSw5MS42NzMgNTUuMjk0LDg4LjAxMiBMNTUuMjk0LDc3LjEyOCB6IiBmaWxsPSJ1cmwoI0dyYWRpZW50XzIpIi8+CiAgICA8Zz4KICAgICAgPHBhdGggZD0iTTU1Ljc5NCw3Ny42MjggQzU1Ljc5NCw3Ny42MjggNDkuMjc0LDc1LjQ1MSA0OS4yNzQsNjQuNTY3IEM0NS42ODMsNjQuNTY3IDQ1LjY4Myw1NS44NiA0OS4yNzQsNTUuODYgQzQ5LjI3NCw1NC40MDEgNDIuNzU0LDM4LjQ0NSA1My42MjEsNDAuNjIyIEM1NS43OTQsMzEuOTE1IDc5LjcwMSwzMS45MTUgODEuODc0LDQwLjYyMiBDODMuMzgzLDQ2LjY2NSA3OS43MDEsNTQuNzg5IDc5LjcwMSw1NS44NiBDODMuMjkxLDU1Ljg2IDgzLjI5MSw2NC41NjcgNzkuNzAxLDY0LjU2NyBDNzkuNzAxLDc1LjQ1MSA3My4xODEsNzcuNjI4IDczLjE4MSw3Ny42MjggTDczLjE4MSw4OC41MTIgQzgzLjk0OCw5Mi41NTYgOTQuNjEsOTUuOSAxMDAuMDcsOTkuNzIzIEMxMDguOTcyLDkwLjY4NCAxMTQuNDc1LDc4LjI2OCAxMTQuNDc1LDY0LjU2NyBDMTE0LjQ3NSwzNi45MTMgOTIuMDk4LDE0LjUgNjQuNDg3LDE0LjUgQzM2Ljg3NywxNC41IDE0LjUsMzYuOTEzIDE0LjUsNjQuNTY3IEMxNC41LDc4LjI5NCAyMC4wMiw5MC43MjggMjguOTUzLDk5Ljc3NSBDMzQuNzM0LDk1Ljc2OSA0Ni4xMzEsOTIuMTczIDU1Ljc5NCw4OC41MTIgTDU1Ljc5NCw3Ny42MjggeiIgZmlsbD0idXJsKCNHcmFkaWVudF8zKSIvPgogICAgICA8cGF0aCBkPSJNNTUuNzk0LDc3LjYyOCBDNTUuNzk0LDc3LjYyOCA0OS4yNzQsNzUuNDUxIDQ5LjI3NCw2NC41NjcgQzQ1LjY4Myw2NC41NjcgNDUuNjgzLDU1Ljg2IDQ5LjI3NCw1NS44NiBDNDkuMjc0LDU0LjQwMSA0Mi43NTQsMzguNDQ1IDUzLjYyMSw0MC42MjIgQzU1Ljc5NCwzMS45MTUgNzkuNzAxLDMxLjkxNSA4MS44NzQsNDAuNjIyIEM4My4zODMsNDYuNjY1IDc5LjcwMSw1NC43ODkgNzkuNzAxLDU1Ljg2IEM4My4yOTEsNTUuODYgODMuMjkxLDY0LjU2NyA3OS43MDEsNjQuNTY3IEM3OS43MDEsNzUuNDUxIDczLjE4MSw3Ny42MjggNzMuMTgxLDc3LjYyOCBMNzMuMTgxLDg4LjUxMiBDODMuOTQ4LDkyLjU1NiA5NC42MSw5NS45IDEwMC4wNyw5OS43MjMgQzEwOC45NzIsOTAuNjg0IDExNC40NzUsNzguMjY4IDExNC40NzUsNjQuNTY3IEMxMTQuNDc1LDM2LjkxMyA5Mi4wOTgsMTQuNSA2NC40ODcsMTQuNSBDMzYuODc3LDE0LjUgMTQuNSwzNi45MTMgMTQuNSw2NC41NjcgQzE0LjUsNzguMjk0IDIwLjAyLDkwLjcyOCAyOC45NTMsOTkuNzc1IEMzNC43MzQsOTUuNzY5IDQ2LjEzMSw5Mi4xNzMgNTUuNzk0LDg4LjUxMiBMNTUuNzk0LDc3LjYyOCB6IiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CiAgICA8L2c+CiAgICA8cGF0aCBkPSJNNjMuOTg3LDE0IEM5MS41OTgsMTQgMTEzLjk3NSwzNi40MTMgMTEzLjk3NSw2NC4wNjcgQzExMy45NzUsNzcuNzY4IDEwOC40NzIsOTAuMTg0IDk5LjU3LDk5LjIyMyBDOTQuMTEsOTUuNCA4My40NDgsOTIuMDU2IDcyLjY4MSw4OC4wMTIgTDcyLjY4MSw3Ny4xMjggQzcyLjY4MSw3Ny4xMjggNzkuMjAxLDc0Ljk1MSA3OS4yMDEsNjQuMDY3IEM4Mi43OTEsNjQuMDY3IDgyLjc5MSw1NS4zNiA3OS4yMDEsNTUuMzYgQzc5LjIwMSw1NC4yODkgODIuODgzLDQ2LjE2NSA4MS4zNzQsNDAuMTIyIEM3OS4yMDEsMzEuNDE1IDU1LjI5NCwzMS40MTUgNTMuMTIxLDQwLjEyMiBDNDIuMjU0LDM3Ljk0NSA0OC43NzQsNTMuOTAxIDQ4Ljc3NCw1NS4zNiBDNDUuMTgzLDU1LjM2IDQ1LjE4Myw2NC4wNjcgNDguNzc0LDY0LjA2NyBDNDguNzc0LDc0Ljk1MSA1NS4yOTQsNzcuMTI4IDU1LjI5NCw3Ny4xMjggTDU1LjI5NCw4OC4wMTIgQzQ1LjYzMSw5MS42NzMgMzQuMjM0LDk1LjI2OSAyOC40NTMsOTkuMjc1IEMxOS41Miw5MC4yMjggMTQsNzcuNzk0IDE0LDY0LjA2NyBDMTQsMzYuNDEzIDM2LjM3NywxNCA2My45ODcsMTQgeiBNNjMuOTg3LDE4IEMzOC41ODgsMTggMTgsMzguNjIgMTgsNjQuMDY3IEMxNy44OTgsNzUuMjk5IDIyLjIzMSw4NS41NjQgMjkuMjIxLDk0LjE2NiBDMzQuODI5LDkxLjEwOSA0MC45MSw4OS4wMjIgNDYuODk2LDg2LjgzOSBDNDcuNjM5LDg2LjU2OSA0OC4wMjQsODYuNDMgNDguMzgsODYuMyBDNDguOTM3LDg2LjA5OCA0OS40MDYsODUuOTI3IDQ5Ljg1Myw4NS43NjQgTDUxLjI5NCw4NS4yMzQgTDUxLjI5NCw3OS4zNzkgQzQ5Ljk1NSw3OC40MDQgNTAuNzY1LDc5LjA1NCA0OC45OTUsNzcuMjggQzQ2LjIxNSw3NC4wMzggNDUuNTI4LDcwLjc2IDQ0LjkyNSw2Ni42OCBDNDEuNzMzLDYzLjg3MSA0MS40NDQsNTguOTggNDMuMDIyLDU1LjIzNSBDNDMuMjk1LDU0LjU4OCA0My43ODIsNTQuMDU1IDQ0LjE2Miw1My40NjYgQzQ0LjA0Niw1My4wNDEgNDQuMTI1LDUzLjMzNCA0My45MjksNTIuNTg2IEM0My41Myw1MS4wMjkgNDMuMjM0LDQ5LjYxMyA0My4wNDYsNDguMjMxIEM0Mi41OTQsNDQuOTA3IDQyLjc5NSw0Mi4xMzEgNDQuMDk3LDM5LjgzNCBDNDUuNjIyLDM3LjI4NiA0Ny44MDYsMzYuMTY1IDUwLjcxMywzNi4wMzggQzU2LjM3NSwyNy4wMzkgODEuMjY0LDI2LjgwNSA4NS4yNTUsMzkuMTUzIEM4NS42ODcsNDAuODgyIDg1LjgxNSw0Mi43MzYgODUuNjk1LDQ0LjcxMSBDODUuNTUsNDcuMDg1IDg1LjA2OCw0OS40OTcgODQuMzE1LDUyLjEzMyBDODQuMDE2LDUzLjE1MyA4NC4xNjEsNTIuNjczIDgzLjg4NCw1My41NzUgQzg0LjI0LDU0LjEyOCA4NC43LDU0LjYyNyA4NC45NTMsNTUuMjM1IEM4Ni41MzcsNTkuMDQyIDg2LjIxMiw2My44IDgzLjA1LDY2LjY4IEM4Mi43OTMsNzAuNjMzIDgxLjM4LDc0LjE2NiA3OC45OCw3Ny4yOCBDNzcuMjEsNzkuMDU0IDc4LjAxOSw3OC40MDQgNzYuNjgxLDc5LjM3OSBMNzYuNjgxLDg1LjIxMiBDODEuODYsODcuMTQgODcuMDc4LDg4Ljk3IDkyLjIwOSw5MS4wMjUgQzk2LjQwMSw5Mi44MjIgOTQuMjAyLDkxLjgwNCA5OC43ODMsOTQuMTMgQzEwNi4xMzYsODUuNzIyIDEwOS43MDQsNzUuMTM1IDEwOS45NzUsNjQuMDY3IEMxMDkuOTc1LDM4LjYyIDg5LjM4NywxOCA2My45ODcsMTggeiIgZmlsbD0iI0ZGRkZGRiIvPgogIDwvZz4KPC9zdmc+Cg==","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "user","actions": ["edit","create","view"]}],"_opts": {"compileTo": ["js"],"runWidth": "500","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "CouchDB user editor","timeout": "3000","author": "ermouth","ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAUsElEQVR4XuWbe3BU133HP2d3Ja20klZPBIinQRiDsUA8bbCxjR1eIvETd9rONDNpkrGbTpu2mXTaJu7rj7RJp0mmbtJ2mjZpEscmzsOAwY4JtrGxwZKQQDwM5iWQkABJaHellbSP0znn3Lt796UH2OkfvTM70t695/H7nt/j+/udcwX/zy/xm5Bf7m3eBHIVMbEM3EtxxaaC8KaOLYeJu7sh1oqURyjwHBIPL331457fxwKA/NXxWcTCzxDlcYbD84lFb04OtxvyfWcQ8qcUeZ4TG5Z23lxHuVt9pADIPa2fIxb5CsPhGcRiyVElIGXqR/2q7qvLnoUQkPJxTFyB4fVegLy/Fo3Lvv9RAfGRACD3HP40ofC3icdLEhNTAsfjEJPgdkFNOVQUQ4UfSrygBMrLM49HImjAgsPQNwB9Iejph1gc3AJcLgOMfQnXACVlT4vN9c/fKhC3BIDc19TAQOhnROOzkVZXSuhoHPyFUDcLpldCadHNzTMwCF19cLoDAmHwuAwYWmsE5BWexV/wKfHg0uM3N0BS+SbdXu48/Dwjw7+VUHW1WtEY3FYDi+ZAeemk+xyzQV8A2i/AxR7wuI1WqcvlhsLCfxeNKz9/MwNOWgPk/iNl9IaaiUVv0wPGJUSjMG86NNRBQf7NzGPibYZHoOUMnLsCHg+4LBFcrlNUzVomHpg7PPHOJqkB8vWWRdwYPK69unJgym79PrhnCZT7JjPurT+rNOJgu2UablsbolSV1IkHll2Y6AAT1gD5ysn1DF17QwutHFwkCovnwLK6ccdSbqErCF1h6AtDbxjCURiNm6Zej/mU5ENJAcwsgjllxv+Nex0+Cac7Ic9t/IIrD6YUN4j1S4+M29YRgMZ8Vu479gn6+1/VwiuVVxJtWAY1FWO2O3ENTvXCxZARRpmtcIFH225Se41TM7iqvwoX9X9tMdzuhwXl44hy6Rq81WZ8gwbBDWVVd4uHF703HgjjYiwPHF/Nld73kJbwyuY2rYTS3Crf0g2HuiCiIqAluBJMD6bmZ41qRzb7fuK7AkPdlKDYRL4bVlTC4soxxOkPwKvNlimoQd3gL18kHl5yciwQxgRA7muZTV/oAnFLeBWGtt0DBVb8Tuv5fB+8fhGGYpZGWtFqQsJb4DhBsNspMKISfB64twZmFOcQaTAMO99NkimlckXT/WJLXSAXCGMDsOPAVeLRaq2PSvUb10BJ9pj+q7PQ3msE17ZrkTotl/VdBy7HfZsI2s+ox3SYd2iLE5C4MH53YRmsrckhktKEVw4nzUG4zojt6xdMGgC589CLDA09qb39aAQ2r4Sqsox+FC4/Pga9I2ZMW0in4E7VV8RQBxAJpXnG6SkVVzRCac6N0ST50z7DBtD6q7RBuaByL2ybaY2XPqvL1+CNNsjX3gZKfN8SW1b9cTYQsmqAfK1lBYHQ+xpuRW6WzIUlJuw7r5GYET4Qhbwcq65NWa2oogsSbiuDReUwqzSV3Tr7vRaG0wE42W80wpOlb+Ubij2wbQbkW5woZXKHT8CHiisolXRDedUcsWHRxXQZsgPw4jtdyNFpWu3Lio3TS7vUT99vg+CoGSOX2mqvHocaH2ycA77s7iOrhiqNeKMLusOQZ5uGw4HaIDw6IweYv3wHwqPG6/qKj4nGlXeNC4Dc3fx5QoHv6gdHIvDI2qx2/8M26LPUXj+bZvO2qqpVn1kCj41PF3KZKW93w5lQppbZIbMsH7ZNz9K89wbsaTKmoEJjVe028cC8Xc4nMzRAvvT2MNFIgTZKRW9XLczo+dfn4ei1pKfPJrwy9NXT4c5KY+POS0ZHoLMFrp+GQRUvh8CdD3lFUDIdpixCTK1PafPiBRiJO3yCw1EqTVjgg9VVWUB4sw2u9BpbKi6+JLaunJUTALmn6RkCwee0l1L8/qkHTQbmuC4PwAsnocCm4Vk8diQOj86HGVnyIXn5MLT/xDCixEcFfjWI8pBxiEehoBSWfRZRVqtHP9UP7/U5TEFrndQRRiKJSsnmGkG1N80hhMLwi7chP89oQWVVo3hw0W5bpBQNkC83dREOTtOrX1cLK27PgPQ/WmA4ZqXoWVRfsbhqLzyZqTgQDiL3fxU83twe0B5RcY88H+LBr+o7/cPw806Jkk8KiUt5VcdfFarVojwyrSBTDd46Cl3XzaR9vsOicdXqDADkm0fquBY8rT2/CntPrs/I7Nquwv7zkOdJsroU4mIlh8unweqp1hDxGLLpe2a1Q5chMggizSZyWf/oIGLzP+uVG4xKdnTEKHDr8hJCr74BwRSRJDEpWe7Po644LSNVidOew2biCgSvzye2rRiy1s+MLve0fptA/x8az++DTatyrr5OxXOQFeX0HpgBiyx7lNc+gMPPmVVXLMFZ2cnp9qwfFACN39ZfQlF46dKIBkALb4FgALCBkLik5NFpmXyFnx0wCZwav6TiS2JL/TdSAdjZdIWh4FQd91cuNCbguBTN/cUZ41CzcXcbEAXAuulQP8UCtvcsHPoXC4DxJHb+bhiT2Pg1fbM7HOX1nhHylQZYQttAOL9HZJy1/hJqC9OKzkfPwvGLJiPzFR0SjavXJACQr5wpYOjKcEL9n1gP3lQ1+uUpk9UlSEkW+9cZXRzunGJA0Jo1dAP2f8V4+MlcKvkqW4BY/Tnd6uTACG0DYZNRqhV3mIGh2korVBYpqc73sK4iLVN1moHbhXhivb2OIHe3bifU/4Lm/MpOHrs3Y6r/dAgKFbPMofqJyi5Q6YUnHOxb7vkyaNsdN/lMjhsbhQWPIOat1/feuhqiOzKK26n6ehEsE9C9G9OIyhiPTZ2RCfeP91msDSjPWyk+sa5Jz0juaf46gcCfaco2uwbuXpzSuOMGvHQaCmzG50xnU9JcqTEcjcEXliWFlc0/gKtt4LK4+UQ0IRKG+/4SUWqynh2dVxFS4HIlHZ+OAjp+GsFtrYgSY52/huqCwtSRXm+C60HDDEv8z4gtDd8xAOxt3stAYKO2/6XzYdHslIYHL0FTt5VgZah+MhwpVYxLyeJKwdrpSU8vO5qg/YeG7EzoUn0WID7x94mnm/pucHE4rOeeiAApgttmoKJBnDqfn0W+tAJC0yk402X8QGnpc2Lz8i9YGtDSSWBgOpEYbFgKU1Mb7joN54O2/SfDjloBpZK4kl5ZOaEn5xVQUZgkJPLoDrj87uQ0IB5H3P8sFJmthv7RUfZdv6p5WSICWKuuOYFtGpoWxZmS52OVRaISKJ6+DE0fmJX0lx4Qm5bfZwDY3RIlNODWYaLxblPodFzfb5OEYhK3sjeXRULUgLbgenAV6iWjsTifvbM4Ye3yyPPQ+S54FEGZhA9Q3nQkgNjyTcgvIo7kZ50XyHOLRBhMOEIdLpJmoAAodOXxYGVaAtLdC/taDYcvLrkotq6YY2uAJDAAo1H4lEp+Um3n31ojGle3EtgeyFbFFG8sGYnH+cwdflxWvJfvfw96Wi31nwwAypkEYdM/Irx+IlLycs+H5Ot+U23ejgCp92FT1Z2pBqeSo71NxtEX+wfF1oZi2wlKAgEDwOP3QWGqrT7XMqRpZoJ6KkrjIB9aJS3nFI3H2TbbT1WhlfcOBZCtP4Ab5ybOANW0o8PQ8PuIWpMU9QwHOXijE48QWU3AxJikQ4zGozTWLE8FIDgELx80AJT6EZsbzDLJ3S2SkKUBj62FolQN+E5rUAOgB0gjIemUVE2hyuti08ykH5GdbdDyvYk7QaX+BZWIh/4iIcAb188RiIUxrlXNI9MX2ACo39VCNNak1TFUzfDn7xg2V+xHbLUB2NUSY3DApX3A1jWmCOK4/vPYDaP+6p7DDAwFdUzEMgs1+MrqUhZa/cjei/DO1yfOBjUJqkOsfUbP4uzgdY4Gu7T66zGlMUWVFAkVdx32r0BQPsAtXDxclUbn1abrnvdsE4iJrQ2a16kw2M9AoEwDsGkFVKZy6edP9Wnnph2gLnFJE491nc7pF8z/ceLM8nlZW2P4sIwMw64vqr3+CQVBYhGYfR+i/nH9fOvARS6F+6yNkiT3T7F5WzMsAHwuL/dWpplAbz/sbTYAlFT0ii31VQaAXS3tDA4s1jxg7RKYbRF5a7p7O/roGYzoCTgTjwwurhExK6KefXz2nITAcv83YLBzYn5AFUjWfQlRNVe3f7WnlSgRU3BNeHzTdcIsLcF1dSAeo6agimVlaU7wQjccPG7CYKn/mNjccJflA5p/QijwlK4DLJ4Fd81PWammngFO9IdMDE7wbkcW5gxDVo4eicfYOG025V6TlMje8/Dm10xOoFLjrJfaCYlA+XzEfX+kn+gbDfJOXzse3camvVYUsOO/tMxBDySJEeV233xu8yUXwKjSWThpJ0SlPxKNy3/XdoJ/RWjg7zQVrq2Ce1Nrh52hMPsu9yRicDIRSXWMzgQlLuOaiq6falZRz63jfTj6AnqXKQMES/jKO+DuzyLcJooc7D1GfzSAWzubpP071d+Uk5KfaCzCmsrVVOSnJURvtEK3KjUL8Pv/XGxq+AcrDLZuJNC/VxN5tcTb789Yn/85fZZ8zUMzbd7Jw53gKC1YVVHL7BJHsS54Dfn631jEyDGMqgDVLEGs+Uzi5oXBLo4Fz5Bnr36aoHZWaEpp1jaLUBEgwpapjZk69sL+ZDZXWLFBfLL+1wlmIne8KbUGKC7wyD1QnJq+vnmlkyuDodR01BEWtT3a3MCeqIgTkzHWVc6npsja4YyEkTu/mJkeqzrgrLWIZU/piV8e6qZl4AR5LpGw/USYszTB0quU1Y8To9JTxcrKu1MBuBGC3VYESE+HtXruaj7NYKBO1wTqMxOinsEgv76iqKjLcjx2cSetOuPIytTKqAnVeitYWWXR0pEh5K4/yQJABGauQyw3ADT3tdEzehW3xfyMyuuZjvlRq7/cv5qaorR0uP08HDtvEqGiouNi22rtIZMa8ErT1wgGv6xVyVcAjfdkqNDLHSeIRKOmmJuWgDi9cSIu6y3vGNMKK1lZaRVYJwjAkb5Wuke7NaV2EpycAGhHqCrKsHGaCZ8p18vWJokC1Of/W9HY8GwqAPtaa+kPXDZVIWUG66A4tax0KdTHu9fOka93MJMe2RbYlFjMCiknKIWq2MdZVDKXBX4rxVYA7P5TdcApdYLKBGYoDdiu758JnObU4EldgTIgmBwgae9pmqC8v4ywsGQZc0vuyFT/Xe8ZBqi2yYorK8WmxX0pAGjl2tn8IUOBeToczq2BNamFEfXMa51HCUVMaSph91ZyolZArbjKx2u8Zcz11TLdl8opUD5gjyqRZQNgFaL+0ZTJdw52cCl8nt7RHlzCZeoBerKGbxjnZ9ifBzcbphkTSrkOHoOOa9bmiO+Y2LoqEeZS9wX2HPk0gYH/ShyB2b7ebCg4rkBkiNc6W8hXCFiUNC5jWvB8Tx5zfDOYX1pLvitH8WMoiHzrm+BJ+11Fgal3IO5KBcAeOipHuRj6kIuhDxiWQVxSgWFPXxKJj7CqahPV3tRiLkMj8NJbyTMNvsrtovGuHXa/Gfmp/Ok7A8RGS7UWzMksj6mG7X3nOBPq0OWoGDGmeaupK5lBVWHuIxxyJASd7dDZbHZ+svKAKFTMgdp6RNW8zJW07vSPXOdS8AQdwx/oVVezqMmfS8OUhzLbHDgKndamiPBcFdvVEYvklQnArqbfYzD43/oRtUGikqPy5AFQu+lrXW9TlldCfcVCCtxZdmO0lsbh2mnoOg6hblMRUpsiY+0N6KM4yne4YMpimHYHojg7sFEZob33LW6MdnP/9N/JFL53APa8n7T9silPiocW/nRMALR5vfh2BzIyU2+SlBbCFl1Cn/AlB3pAbYj0XTB+S+3J5aS/ObrVZ4uVV4+BtwSmLoDq2xMMcUKT2XkQBkcM8ysqPCW2rUnzjjlqVHJvez2hvtbEAQlVJFXF0jEulYDQew66P4Bo2No8tLaQJjTbsTpXYFjH8/zToXoBoqR67F7V8bkPu6xKrguqi+vEA8s/TG+Us0Yldx7+EUODv61XUB1m3rgCqjPPq8noqFnt3kvW4aRJbn9NFhxbK/ILofoORPm0zB7sIzL2Jqav5F9F44o/yDbUmEU6ueNAN/FoTeKQlPIHjoPPMnQdLrca27ZPN01WoJt9XpmIyhzLpiOmOjQ7/ZCUp+CsePyenOo7NgCvtM1gaOBS4oCksqVP3g3epNOT/Z0wcPk3D4AyueIaqJqTpLPpx+SU7/GUlItHl93IhfO4ZVq5t3UVgcChsQ5KyuEg9HdYLHDcLm92za121jGzspmIQn+yL+Xxf9VivquF+igOStq9yzeOPcz1/tfGOiqrk9GBqzASTD0wdIviJprrAeKmrOavQThDafpRWU13S1eLTUsPjzf8hJdrooeldTQYvmE4hM4LJjxErnhoQmlePnj9CHfa/uKhE2a7yz4srXhGTelHe1g6oQl7jy8mdL1ds0Tncfl1d4I/tZKsKboKh8pRqRA2aSAU11dn/PLAU5jJnZTKq+Py6jUbfU4PlepG8Pvmi4dXdIy38vbvk14e+fMjZcQG2ohJc9rKfmGibgYsnZf1hQmtvQo0dfRZn4K2zslnzFKFUM2cdN5uMsC0a3AYWtVm5VXraKouUiqbP07ljBUf6wsTzqnI3Yd/wtDwU5qpqTnrF6RiJotcNDcrfZ7oqmR9TpW02zug46pRd/vdIf3yVdF3xadWPH0z/U9aA1JA2H9sBX39vyQaSx5TtF+aKiuyXpqqyHnAetwJDwzC5V440wFq5VUG6hTcW3gab9mj4qG6E+P2leOBWwIg4Rt2vf85hoe+RSyerKBooqK4vDRnDdVrc+pFqspSU2hRwujX5uLobXm1J6H27vqC5qNem1N9qJCW8dqc5zqVFc+IDYsTae3/KQAJIF5pepqYfJaRcM0tvzhpv1Vhd65UvaDwHCLvWdG49Ic3K3B6u49EA9I7lQeO3kYo8jQxnmB4cE4KGJOZudpe8vpO4crbQb77OfHQkp7JNJ/Isx8LABmA7G5tRLIKj6ueWHQpUAOyIPHujGog5TCCLqIcwSVacfGu2NywbyJC3MozvxEAbmWCH3fb/wWkUqm5Szl9CQAAAABJRU5ErkJggg==","maskstate": "","nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","types": "","width": [[350,3000]],"collapsed": [],"padding": "none"},"log": [[1539884034984,"update","ermouth-524yb546",87,"dev-cloudwall2"]],"id": "cw.Couch.User","stamp": 1539884034984,"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9IkdyYWRpZW50XzEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjQuMDc5IiB5MT0iMTE0IiB4Mj0iNjQuMDc5IiB5Mj0iMzciPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNGRkZGRkYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIwLjM4IiBzdG9wLWNvbG9yPSIjRkVBQzZGIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGQjg3NyIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iR3JhZGllbnRfMiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIzOS40MDEiIHkxPSIxOC4yNjUiIHgyPSIxMDYuMjQyIiB5Mj0iNjEuODQyIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjOTBDOEZGIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0E3RTdGRiIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iR3JhZGllbnRfMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMDAuNjAyIiB5MT0iMTA0LjE2MiIgeDI9Ijg0LjYzNyIgeTI9IjQxLjc4MyI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI0I0RDk3RiIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNDREZGODgiIHN0b3Atb3BhY2l0eT0iMCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0ZGQTRCQiIvPgogICAgPHBhdGggZD0iTTY0LjA3OSwxMTQgQzM2LjUwOSwxMTQgMTQuMTU5LDkxLjYxNCAxNC4xNTksNjQgQzE0LjE1OSwzNi4zODYgMzYuNTA5LDE0IDY0LjA3OSwxNCBDOTEuNjUsMTQgMTE0LDM2LjM4NiAxMTQsNjQgQzExNCw5MS42MTQgOTEuNjUsMTE0IDY0LjA3OSwxMTQgeiIgZmlsbD0idXJsKCNHcmFkaWVudF8xKSIvPgogICAgPHBhdGggZD0iTTU1LjI5NCw3Ny4xMjggQzU1LjI5NCw3Ny4xMjggNDguNzc0LDc0Ljk1MSA0OC43NzQsNjQuMDY3IEM0NS4xODMsNjQuMDY3IDQ1LjE4Myw1NS4zNiA0OC43NzQsNTUuMzYgQzQ4Ljc3NCw1My45MDEgNDIuMjU0LDM3Ljk0NSA1My4xMjEsNDAuMTIyIEM1NS4yOTQsMzEuNDE1IDc5LjIwMSwzMS40MTUgODEuMzc0LDQwLjEyMiBDODIuODgzLDQ2LjE2NSA3OS4yMDEsNTQuMjg5IDc5LjIwMSw1NS4zNiBDODIuNzkxLDU1LjM2IDgyLjc5MSw2NC4wNjcgNzkuMjAxLDY0LjA2NyBDNzkuMjAxLDc0Ljk1MSA3Mi42ODEsNzcuMTI4IDcyLjY4MSw3Ny4xMjggTDcyLjY4MSw4OC4wMTIgQzgzLjQ0OCw5Mi4wNTYgOTQuMTEsOTUuNCA5OS41Nyw5OS4yMjMgQzEwOC40NzIsOTAuMTg0IDExMy45NzUsNzcuNzY4IDExMy45NzUsNjQuMDY3IEMxMTMuOTc1LDM2LjQxMyA5MS41OTgsMTQgNjMuOTg3LDE0IEMzNi4zNzcsMTQgMTQsMzYuNDEzIDE0LDY0LjA2NyBDMTQsNzcuNzk0IDE5LjUyLDkwLjIyOCAyOC40NTMsOTkuMjc1IEMzNC4yMzQsOTUuMjY5IDQ1LjYzMSw5MS42NzMgNTUuMjk0LDg4LjAxMiBMNTUuMjk0LDc3LjEyOCB6IiBmaWxsPSJ1cmwoI0dyYWRpZW50XzIpIi8+CiAgICA8Zz4KICAgICAgPHBhdGggZD0iTTU1Ljc5NCw3Ny42MjggQzU1Ljc5NCw3Ny42MjggNDkuMjc0LDc1LjQ1MSA0OS4yNzQsNjQuNTY3IEM0NS42ODMsNjQuNTY3IDQ1LjY4Myw1NS44NiA0OS4yNzQsNTUuODYgQzQ5LjI3NCw1NC40MDEgNDIuNzU0LDM4LjQ0NSA1My42MjEsNDAuNjIyIEM1NS43OTQsMzEuOTE1IDc5LjcwMSwzMS45MTUgODEuODc0LDQwLjYyMiBDODMuMzgzLDQ2LjY2NSA3OS43MDEsNTQuNzg5IDc5LjcwMSw1NS44NiBDODMuMjkxLDU1Ljg2IDgzLjI5MSw2NC41NjcgNzkuNzAxLDY0LjU2NyBDNzkuNzAxLDc1LjQ1MSA3My4xODEsNzcuNjI4IDczLjE4MSw3Ny42MjggTDczLjE4MSw4OC41MTIgQzgzLjk0OCw5Mi41NTYgOTQuNjEsOTUuOSAxMDAuMDcsOTkuNzIzIEMxMDguOTcyLDkwLjY4NCAxMTQuNDc1LDc4LjI2OCAxMTQuNDc1LDY0LjU2NyBDMTE0LjQ3NSwzNi45MTMgOTIuMDk4LDE0LjUgNjQuNDg3LDE0LjUgQzM2Ljg3NywxNC41IDE0LjUsMzYuOTEzIDE0LjUsNjQuNTY3IEMxNC41LDc4LjI5NCAyMC4wMiw5MC43MjggMjguOTUzLDk5Ljc3NSBDMzQuNzM0LDk1Ljc2OSA0Ni4xMzEsOTIuMTczIDU1Ljc5NCw4OC41MTIgTDU1Ljc5NCw3Ny42MjggeiIgZmlsbD0idXJsKCNHcmFkaWVudF8zKSIvPgogICAgICA8cGF0aCBkPSJNNTUuNzk0LDc3LjYyOCBDNTUuNzk0LDc3LjYyOCA0OS4yNzQsNzUuNDUxIDQ5LjI3NCw2NC41NjcgQzQ1LjY4Myw2NC41NjcgNDUuNjgzLDU1Ljg2IDQ5LjI3NCw1NS44NiBDNDkuMjc0LDU0LjQwMSA0Mi43NTQsMzguNDQ1IDUzLjYyMSw0MC42MjIgQzU1Ljc5NCwzMS45MTUgNzkuNzAxLDMxLjkxNSA4MS44NzQsNDAuNjIyIEM4My4zODMsNDYuNjY1IDc5LjcwMSw1NC43ODkgNzkuNzAxLDU1Ljg2IEM4My4yOTEsNTUuODYgODMuMjkxLDY0LjU2NyA3OS43MDEsNjQuNTY3IEM3OS43MDEsNzUuNDUxIDczLjE4MSw3Ny42MjggNzMuMTgxLDc3LjYyOCBMNzMuMTgxLDg4LjUxMiBDODMuOTQ4LDkyLjU1NiA5NC42MSw5NS45IDEwMC4wNyw5OS43MjMgQzEwOC45NzIsOTAuNjg0IDExNC40NzUsNzguMjY4IDExNC40NzUsNjQuNTY3IEMxMTQuNDc1LDM2LjkxMyA5Mi4wOTgsMTQuNSA2NC40ODcsMTQuNSBDMzYuODc3LDE0LjUgMTQuNSwzNi45MTMgMTQuNSw2NC41NjcgQzE0LjUsNzguMjk0IDIwLjAyLDkwLjcyOCAyOC45NTMsOTkuNzc1IEMzNC43MzQsOTUuNzY5IDQ2LjEzMSw5Mi4xNzMgNTUuNzk0LDg4LjUxMiBMNTUuNzk0LDc3LjYyOCB6IiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CiAgICA8L2c+CiAgICA8cGF0aCBkPSJNNjMuOTg3LDE0IEM5MS41OTgsMTQgMTEzLjk3NSwzNi40MTMgMTEzLjk3NSw2NC4wNjcgQzExMy45NzUsNzcuNzY4IDEwOC40NzIsOTAuMTg0IDk5LjU3LDk5LjIyMyBDOTQuMTEsOTUuNCA4My40NDgsOTIuMDU2IDcyLjY4MSw4OC4wMTIgTDcyLjY4MSw3Ny4xMjggQzcyLjY4MSw3Ny4xMjggNzkuMjAxLDc0Ljk1MSA3OS4yMDEsNjQuMDY3IEM4Mi43OTEsNjQuMDY3IDgyLjc5MSw1NS4zNiA3OS4yMDEsNTUuMzYgQzc5LjIwMSw1NC4yODkgODIuODgzLDQ2LjE2NSA4MS4zNzQsNDAuMTIyIEM3OS4yMDEsMzEuNDE1IDU1LjI5NCwzMS40MTUgNTMuMTIxLDQwLjEyMiBDNDIuMjU0LDM3Ljk0NSA0OC43NzQsNTMuOTAxIDQ4Ljc3NCw1NS4zNiBDNDUuMTgzLDU1LjM2IDQ1LjE4Myw2NC4wNjcgNDguNzc0LDY0LjA2NyBDNDguNzc0LDc0Ljk1MSA1NS4yOTQsNzcuMTI4IDU1LjI5NCw3Ny4xMjggTDU1LjI5NCw4OC4wMTIgQzQ1LjYzMSw5MS42NzMgMzQuMjM0LDk1LjI2OSAyOC40NTMsOTkuMjc1IEMxOS41Miw5MC4yMjggMTQsNzcuNzk0IDE0LDY0LjA2NyBDMTQsMzYuNDEzIDM2LjM3NywxNCA2My45ODcsMTQgeiBNNjMuOTg3LDE4IEMzOC41ODgsMTggMTgsMzguNjIgMTgsNjQuMDY3IEMxNy44OTgsNzUuMjk5IDIyLjIzMSw4NS41NjQgMjkuMjIxLDk0LjE2NiBDMzQuODI5LDkxLjEwOSA0MC45MSw4OS4wMjIgNDYuODk2LDg2LjgzOSBDNDcuNjM5LDg2LjU2OSA0OC4wMjQsODYuNDMgNDguMzgsODYuMyBDNDguOTM3LDg2LjA5OCA0OS40MDYsODUuOTI3IDQ5Ljg1Myw4NS43NjQgTDUxLjI5NCw4NS4yMzQgTDUxLjI5NCw3OS4zNzkgQzQ5Ljk1NSw3OC40MDQgNTAuNzY1LDc5LjA1NCA0OC45OTUsNzcuMjggQzQ2LjIxNSw3NC4wMzggNDUuNTI4LDcwLjc2IDQ0LjkyNSw2Ni42OCBDNDEuNzMzLDYzLjg3MSA0MS40NDQsNTguOTggNDMuMDIyLDU1LjIzNSBDNDMuMjk1LDU0LjU4OCA0My43ODIsNTQuMDU1IDQ0LjE2Miw1My40NjYgQzQ0LjA0Niw1My4wNDEgNDQuMTI1LDUzLjMzNCA0My45MjksNTIuNTg2IEM0My41Myw1MS4wMjkgNDMuMjM0LDQ5LjYxMyA0My4wNDYsNDguMjMxIEM0Mi41OTQsNDQuOTA3IDQyLjc5NSw0Mi4xMzEgNDQuMDk3LDM5LjgzNCBDNDUuNjIyLDM3LjI4NiA0Ny44MDYsMzYuMTY1IDUwLjcxMywzNi4wMzggQzU2LjM3NSwyNy4wMzkgODEuMjY0LDI2LjgwNSA4NS4yNTUsMzkuMTUzIEM4NS42ODcsNDAuODgyIDg1LjgxNSw0Mi43MzYgODUuNjk1LDQ0LjcxMSBDODUuNTUsNDcuMDg1IDg1LjA2OCw0OS40OTcgODQuMzE1LDUyLjEzMyBDODQuMDE2LDUzLjE1MyA4NC4xNjEsNTIuNjczIDgzLjg4NCw1My41NzUgQzg0LjI0LDU0LjEyOCA4NC43LDU0LjYyNyA4NC45NTMsNTUuMjM1IEM4Ni41MzcsNTkuMDQyIDg2LjIxMiw2My44IDgzLjA1LDY2LjY4IEM4Mi43OTMsNzAuNjMzIDgxLjM4LDc0LjE2NiA3OC45OCw3Ny4yOCBDNzcuMjEsNzkuMDU0IDc4LjAxOSw3OC40MDQgNzYuNjgxLDc5LjM3OSBMNzYuNjgxLDg1LjIxMiBDODEuODYsODcuMTQgODcuMDc4LDg4Ljk3IDkyLjIwOSw5MS4wMjUgQzk2LjQwMSw5Mi44MjIgOTQuMjAyLDkxLjgwNCA5OC43ODMsOTQuMTMgQzEwNi4xMzYsODUuNzIyIDEwOS43MDQsNzUuMTM1IDEwOS45NzUsNjQuMDY3IEMxMDkuOTc1LDM4LjYyIDg5LjM4NywxOCA2My45ODcsMTggeiIgZmlsbD0iI0ZGRkZGRiIvPgogIDwvZz4KPC9zdmc+Cg==","creator": "ermouth-524yb546"},{"_id": "cw-Couch-User-Aux-Phone-tt98","_rev": "14-dc0f90029f9da108f810af2ab00b7745","name": "Couch.User.Aux.Phone","title": "Phone add-on","type": "manifest","desc": "Couch User app demo add-on, adds .phone field to type:user doc if this field is used in other user docs.","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Couch.User.Aux.Phone","build": 14,"inherit": ["RT"],"Doc": {},"canHandle": "function (doc) {\n  \t// Analyzes, if the add-on can accept\n    // current user doc.\n    // Returns array of props which would be affected\n    // or null if not applicable.\n    \n    // Below line means we reject docs having .phone\n    // which is not string\n    \n    if (null != doc.phone && typeof doc.phone != 'string') return null;\n    \n    var that = this,\n        res = {\n          _affects: \t['phone'],\n          _priority: \t800,\n          _collapsed:\tdoc.phone == null\n        };\n    \n    // Try to guess if .phone field exists\n    // in other doc with roles, same to current\n    if (null == doc.phone) {\n      var expand = !!cw.lib.getref(that.Fields, ['phone','s']);\n      if (expand) {\n        res._collapsed = false;\n        res.phone = doc.phone || '';\n      }\n    }\n    \n    return res;\n  }","data": {"name": ""},"init": "function ($o) {\n  \tvar that = this,\n        d = that.data,\n        doc = that.Doc;\n    $.extend(true, doc, d);\n    if (null == doc.phone) delete d.phone;\n    $o.html(that.HTML.assign(that.lang));\n  }","HTML": "<div id=\"phone-container\" class=\"uw-full\"><div id=\"phone-label\" class=\"uw-label dib vat pr10 pt6 fs85 o70\">{LBL_PHONE}</div><div class=\"uw-input-btn pr5 dib vat\"><input id=\"phone-value\" type=\"text\" class=\"w100p\" placeholder=\"{PLC_PHONE}\"><div class=\"my-error-tip\" style=\"display:none\"></div></div><div class=\"uw-btn dib vat\"><a id=\"btn-phone-call\" target=\"_blank\" class=\"button w100p dib vat pl0 tac pr0 br2\" title=\"{TIP_CALL}\"><span class=\"fi-telephone o70\"></span></a></div></div><div id=\"phone-add\" class=\"uw-full uw-pl-label fs85\"><div id=\"btn-phone-add\" class=\"pseudolink tdn dib vat\">{LBL_ADD}</div></div>","style": {" #phone-add": "display:none;"," #phone-container.hide~#phone-add": "display:block;"},"lang": {"en": {"LBL_PHONE": "Phone","PLC_PHONE": "Enter phone with code","ERR_PHONE": "Phone number must start with +","ERR_PHONE_D11": "Phone must contain 10…13 digits","TIP_CALL": "Call the number","LBL_ADD": "＋ Add phone"},"ru": {"LBL_PHONE": "Телефон","PLC_PHONE": "Введите полный номер с кодом","ERR_PHONE": "Номер должен начинаться с +","ERR_PHONE_D11": "Телефон должен сожержать 10…13 цифр","TIP_CALL": "Набрать номер","LBL_ADD": "＋ Добавить телефон"}},"ui": {"#phone-container": {"css": {"hide": "function (d) {return d.phone == null;}"},"watch": ["#btn-phone-add"]},"#phone-value": {"bind": "function (d,v) {\n      if (v!=null) {\n        if (d.phone != null) d.phone = v.trim();\n        return v;\n      }\n      return d.phone || '';\n    }","check": "function (d,v) {\n      var l = this.lang;\n      if (v) {\n        var nums = v.replace(/\\D/g,'');\n        if (v[0]!='+') return l.ERR_PHONE;\n        if (nums.length < 10 || nums.length >13) return l.ERR_PHONE_D11;\n      }\n    }"},"#btn-phone-add": {"bind": "function (d,v) {\n      if (v!=null) {\n        d.phone = '';\n        d._collapsed = false;\n        this.my.root().trigger('shuffle.my');\n      }\n    }","events": "click.my"},"#btn-phone-call": {"bind": "function (d,v,$o) {\n      if (d.phone && this.my.valid()) $o.attr('href', 'tel:+'+d.phone.replace(/\\D/g,''));\n      else $o.attr('href','');\n    }","css": {"disabled": "function (d) {\n        return !d.phone || !this.my.valid();\n      }"},"watch": "#phone-value"}}},"raw": {"name": "Couch.User.Aux.Phone","title": "Phone add-on","version": "1.1","build": 14,"com": [{"stamp": "1537991461281","id": "Root","type": "js","data": "({\n  \n  // Add-on for Couch.User app,\n  // manages .phone field\n  \n  inherit:['RT'],\n  \n  Doc:{ /* Receives clone of original doc */},\n\tcanHandle: function(doc){\n  \t// Analyzes, if the add-on can accept\n    // current user doc.\n    // Returns array of props which would be affected\n    // or null if not applicable.\n    \n    // Below line means we reject docs having .phone\n    // which is not string\n    \n    if (null != doc.phone && typeof doc.phone != 'string') return null;\n    \n    var that = this,\n        res = {\n          _affects: \t['phone'],\n          _priority: \t800,\n          _collapsed:\tdoc.phone == null\n        };\n    \n    // Try to guess if .phone field exists\n    // in other doc with roles, same to current\n    if (null == doc.phone) {\n      var expand = !!cw.lib.getref(that.Fields, ['phone','s']);\n      if (expand) {\n        res._collapsed = false;\n        res.phone = doc.phone || '';\n      }\n    }\n    \n    return res;\n  },\n  \n  \n  data:{name:''},\n\n  \n  init: function($o){\n  \tvar that = this,\n        d = that.data,\n        doc = that.Doc;\n    $.extend(true, doc, d);\n    if (null == doc.phone) delete d.phone;\n    $o.html(that.HTML.assign(that.lang));\n  },\n  \n  HTML:[\n  \t'<div id=\"phone-container\" class=\"uw-full\">',\n    \t'<div id=\"phone-label\" class=\"uw-label dib vat pr10 pt6 fs85 o70\">{LBL_PHONE}</div>',\n    \t'<div class=\"uw-input-btn pr5 dib vat\">',\n    \t\t'<input id=\"phone-value\" type=\"text\" class=\"w100p\" placeholder=\"{PLC_PHONE}\">',\n    \t\t'<div class=\"my-error-tip\" style=\"display:none\"></div>',\n    \t'</div>',\n    \t'<div class=\"uw-btn dib vat\">',\n    \t\t'<a id=\"btn-phone-call\" target=\"_blank\" class=\"button w100p dib vat pl0 tac pr0 br2\" title=\"{TIP_CALL}\">',\n    \t\t\t'<span class=\"fi-telephone o70\"></span>',\n    \t\t'</a>',\n    \t'</div>',\n    '</div>',\n    '<div id=\"phone-add\" class=\"uw-full uw-pl-label fs85\">',\n      '<div id=\"btn-phone-add\" class=\"pseudolink tdn dib vat\">',\n        '{LBL_ADD}',\n      '</div>',\n    '</div>'\n  ].join(''),\n  \n  style:{\n    ' #phone-add':'display:none;',\n  \t' #phone-container.hide~#phone-add':'display:block;'\n  }\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1538074905209","id": ".lang","type": "js","data": "({\n  en:{\n    LBL_PHONE:\t\t\t'Phone',\n    PLC_PHONE:\t\t\t'Enter phone with code',\n    ERR_PHONE:\t\t\t'Phone number must start with +',\n    ERR_PHONE_D11:\t'Phone must contain 10…13 digits',\n    TIP_CALL:\t\t\t\t'Call the number',\n    LBL_ADD:\t\t\t\t'＋ Add phone'\n  },\n  ru:{\n    LBL_PHONE:\t\t\t'Телефон',\n    PLC_PHONE:\t\t\t'Введите полный номер с кодом',\n    ERR_PHONE:\t\t\t'Номер должен начинаться с +',\n    ERR_PHONE_D11:\t'Телефон должен сожержать 10…13 цифр',\n    TIP_CALL:\t\t\t\t'Набрать номер',\n    LBL_ADD:\t\t\t\t'＋ Добавить телефон'\n  }\n})","active": true,"err": [],"opts": [],"color": ["green"]},{"stamp": "1538074930755","id": ".ui","type": "js","data": "({\n  '#phone-container':{\n    css:{\n      hide: function(d){return d.phone == null;}\n    },\n    watch:['#btn-phone-add']\n  },\n  \n  '#phone-value':{\n    bind: function(d,v){\n      if (v!=null) {\n        if (d.phone != null) d.phone = v.trim();\n        return v;\n      }\n      return d.phone || '';\n    },\n    check: function(d,v){\n      var l = this.lang;\n      if (v) {\n        var nums = v.replace(/\\D/g,'');\n        if (v[0]!='+') return l.ERR_PHONE;\n        if (nums.length < 10 || nums.length >13) return l.ERR_PHONE_D11;\n      }\n    }\n  },\n  \n  '#btn-phone-add':{\n    bind:function(d,v){\n      if (v!=null) {\n        d.phone = '';\n        d._collapsed = false;\n        this.my.root().trigger('shuffle.my');\n      }\n    },\n    events:'click.my'\n  },\n  \n  '#btn-phone-call':{\n    bind:function(d,v,$o){\n      if (d.phone && this.my.valid()) $o.attr('href', 'tel:+'+d.phone.replace(/\\D/g,''));\n      else $o.attr('href','');\n    },\n    css:{\n      disabled:function(d){\n        return !d.phone || !this.my.valid();\n      }\n    },\n    watch:'#phone-value'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "600","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","collapsed": [],"author": "admin","_desc": "Couch User app demo add-on, adds .phone field to type:user doc if this field is used in other user docs.","timeout": "3000","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"padding": "auto"},"log": [[1538245620690,"update","admin-czpbhuup",13,"dev-cloudwall2"]],"id": "cw.Couch.User.Aux.Phone","stamp": 1538245744317,"creator": "admin-czpbhuup","parent": "cw-Couch-User-wu7v"},{"_id": "cw-Manifest-4vx1","_rev": "160-4a4f71b168f15406ed0ba22a73cc2de5","name": "Manifest","title": "App Editor","type": "manifest","desc": "Manifest editor","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Manifest","build": 89,"app": {"name": "Manifest","title": "App Editor","version": "2.4","build": 89,"timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTk3LjI5MSw1OC4wMyBMODguMzQ4LDU3LjE0OSBDODcuNzczLDU1LjAwMyA4Ni45MTcsNTIuOTQzIDg1Ljc5Myw1MS4wMDUgTDkxLjUwMyw0NC4wNDkgQzkyLjExNSw0My4zMDEgOTIuMDU5LDQyLjIxMiA5MS4zNzcsNDEuNTMxIEw4NS45NDYsMzYuMDk4IEM4NS41ODEsMzUuNzMzIDg1LjEwMiwzNS41NDcgODQuNjE5LDM1LjU0NyBDODQuMTk3LDM1LjU0NyA4My43NzUsMzUuNjg4IDgzLjQyOCwzNS45NzQgTDc2LjQ3MSw0MS42ODUgQzc0LjUzLDQwLjU2IDcyLjQ3MSwzOS43MDQgNzAuMzI3LDM5LjEzIEw2OS40NDcsMzAuMTg1IEM2OS4zNTIsMjkuMjI0IDY4LjU0NCwyOC40OTEgNjcuNTc4LDI4LjQ5MSBMNTkuOSwyOC40OTEgQzU4LjkzNCwyOC40OTEgNTguMTI2LDI5LjIyNCA1OC4wMywzMC4xODUgTDU3LjE1LDM5LjEzMyBDNTUuMDA2LDM5LjcwNyA1Mi45NDgsNDAuNTYzIDUxLjAxMSw0MS42ODggTDQ0LjA1MSwzNS45NzUgQzQzLjcwMywzNS42ODkgNDMuMjgxLDM1LjU0OSA0Mi44NTksMzUuNTQ5IEM0Mi4zNzYsMzUuNTQ5IDQxLjg5OCwzNS43MzMgNDEuNTMyLDM2LjEgTDM2LjEwMSw0MS41MzEgQzM1LjQxOSw0Mi4yMTIgMzUuMzYzLDQzLjMwNCAzNS45NzUsNDQuMDQ5IEw0MS42OSw1MS4wMDggQzQwLjU2Niw1Mi45NDQgMzkuNzA4LDU1LjAwMyAzOS4xMzQsNTcuMTUgTDMwLjE4Nyw1OC4wMzEgQzI5LjIyNSw1OC4xMjMgMjguNDkxLDU4LjkzMiAyOC40OTEsNTkuODk4IEwyOC40OTEsNjcuNTc4IEMyOC40OTEsNjguNTQ1IDI5LjIyNSw2OS4zNTQgMzAuMTg2LDY5LjQ0NiBMMzkuMTMzLDcwLjMyOCBDMzkuNzA3LDcyLjQ3NCA0MC41NjQsNzQuNTMgNDEuNjg5LDc2LjQ2NyBMMzUuOTc4LDgzLjQyNCBDMzUuMzYyLDg0LjE3MSAzNS40MTQsODUuMjYxIDM2LjEsODUuOTQ0IEw0MS41Myw5MS4zNzYgQzQxLjg5Niw5MS43NCA0Mi4zNzQsOTEuOTI1IDQyLjg1Nyw5MS45MjUgQzQzLjI4LDkxLjkyNSA0My43MDIsOTEuNzg0IDQ0LjA0OSw5MS41IEw1MS4wMDUsODUuNzg5IEM1Mi45NDcsODYuOTE0IDU1LDg3Ljc3IDU3LjE1LDg4LjM0NiBMNTguMDI5LDk3LjI5MiBDNTguMTI0LDk4LjI1MiA1OC45MzMsOTguOTg1IDU5Ljg5OSw5OC45ODUgTDY3LjU3OCw5OC45ODUgQzY4LjU0NCw5OC45ODUgNjkuMzUyLDk4LjI1MiA2OS40NDcsOTcuMjkyIEw3MC4zMjcsODguMzQ3IEM3Mi40NzYsODcuNzcyIDc0LjUzLDg2LjkxNyA3Ni40NzEsODUuNzg5IEw4My40MjgsOTEuNSBDODMuNzc2LDkxLjc4NCA4NC4xOTcsOTEuOTI1IDg0LjYxOSw5MS45MjUgQzg1LjEwMiw5MS45MjUgODUuNTgxLDkxLjc0IDg1Ljk0Niw5MS4zNzYgTDkxLjM3Nyw4NS45NDQgQzkyLjA2Myw4NS4yNjIgOTIuMTE1LDg0LjE3MSA5MS40OTksODMuNDI0IEw4NS43OTIsNzYuNDcgQzg2LjkxNyw3NC41MyA4Ny43NzIsNzIuNDc0IDg4LjM0Nyw3MC4zMjggTDk3LjI5MSw2OS40NDYgQzk4LjI1MSw2OS4zNTEgOTguOTg1LDY4LjU0NSA5OC45ODUsNjcuNTc4IEw5OC45ODUsNTkuODk4IEM5OC45ODYsNTguOTMyIDk4LjI1Miw1OC4xMjUgOTcuMjkxLDU4LjAzIHogTTYzLjc0LDc0LjEzOSBDNTcuOTk0LDc0LjEzOSA1My4zMzgsNjkuNDgyIDUzLjMzOCw2My43MzkgQzUzLjMzOCw1Ny45OTMgNTcuOTk1LDUzLjMzOCA2My43NCw1My4zMzggQzY5LjQ4Myw1My4zMzggNzQuMTM5LDU3Ljk5MyA3NC4xMzksNjMuNzM5IEM3NC4xNCw2OS40ODIgNjkuNDgzLDc0LjEzOSA2My43NCw3NC4xMzkgeiIgZmlsbD0iIzgxOThBNyIgZmlsbC1vcGFjaXR5PSIwLjc0NiIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": ["cmd","editor._id"],"nodetitle": "editor.title","nodedoc": "editor","nodecmd": "cmd","width": [[980,1420],1120,1320],"collapsed": [],"padding": "auto","types": {"manifest": ["edit","create"]}},"Version": "3.0","params": {"delay": 50,"restyle": 200},"data": {"cmd": "","editor": {"_id": "","name": "","title": "","type": "manifest","desc": "","beta": false,"tags": [],"manifest": {"app": {}},"raw": {"name": "","title": "","version": "0","build": 1,"com": [],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "800","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": ""},"log": []},"err": []},"ui": {"#tlist": {"init": "function ($o) {\n    \t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n        cursorfixedheight:25,\n\t\t\t});\t\n    }"},"#manifesto": {"bind": "editor.raw","manifest": "this.E","check": true,"delay": 20,"events": "change.my"},"#warn": {"delay": 500,"bind": "function (d,v,$o) {\n\n      var i,j,k,\n          js, app,\n          that \t= this,\n          ed \t\t= d.editor, \n          r \t\t= ed.raw, \n          m \t\t= ed.manifest,\n          $ed \t= that.$Ed,\n          ok\t\t= ['Manifest structure is ok'],\n          err\t\t= [];\n\n      var isEd = r._type.indexOf('editor')>-1,\n          isApp = isEd || r._type.indexOf('app')>-1;\n\n      //check if unique\n      if (!ed._rev) {\n        if (false) {//(cw.form(r.name) || $.my.forms(\"cw.\"+r.name, \"exist\")) {\n          err.push ('Component name must be unique – and it’s not.');\n          d.editor.id = '';\n        } else {\n          r.author = cw.me();\n          d.editor.id = 'cw.' + r.name;\n          d.editor._id = d.editor.id.replace(/\\./g,'-')+'-'+cw.lib.hash4(r.author+'/'+r.version);\n        }\n      }\n\n      if (isApp) {\n        var trim = [/^_/, 'pic','types', 'com'];\n        if (!isEd) trim.push('nodecmd', 'nodedoc');\n\n        app = Object.clone(Object.reject(r,trim), true);\n\n        if (isEd) {\n          //update maskstate\n          app.maskstate='[\"'+app.nodecmd+'\",\"'+app.nodedoc+'._id\"]';\n        }\n\n        if (/^[\\[\\{]|[\\}\\]]$/.test(app.maskstate)) {\n          try {\n         \t\tapp.maskstate = JSON.parse(app.maskstate);\n          } catch(e0){\n          \terr.push (\"Invalid mask state.\");\n          }\n        }\n\n        // mount editor-specific fields\n        var tmp={}, ttype;\n        if (r._type.indexOf('editor')>-1) {\n\n          if (r._cmd && r._cmd.length) for (i=0; i<r._cmd.length; i++) {\n            if (ttype=r._cmd[i].type) {\n              if (!tmp[ttype]) tmp[ttype] = [];\n              tmp[ttype] = tmp[ttype].union(r._cmd[i].actions);\n            }\n          }\n\n          if (!Object.keys(tmp).length) {\n            err.push ('Editor must have types/actions defined.');\n          }\n          else {\n            app.types = tmp;\n          }\n        } \n\n      }\n\n      // get js src\n      if (!d.editor.raw._err.length) js = $ed.my().manifest._src;\n\n      if (Object.isObject(js)) {\n        js = Object.reject(js,['app', 'type', 'id', 'files', /^_/]);\n        if (!Object.isObject(js.ui)) err.push('The ui section must be an object.');\n        if (!Object.isObject(js.data)) err.push('The data section must be an object.');\n      } \n      else err.push(\"Invalid manifest.\");\n\n\n      //mount js on manifest\n      if (!err.length) {\n\n        d.editor.manifest = $.extend(\n          true,\n          app\n          ?{id:\"\", build:r.build||0, app:app}\n          :{id:\"\", build:r.build||0}, \n          js\n        );\n\n        //check if field pointers are valid\n        var n1,n2,n3,n4;\n        if (isEd) {\n          n1=!Object.isString(cw.lib.mask(d.editor.manifest.data, d.editor.manifest.app.nodetitle));\n          n3=!Object.isObject(cw.lib.mask(d.editor.manifest.data, d.editor.manifest.app.nodedoc));\n          n4 = !Object.isString(cw.lib.mask(d.editor.manifest.data, d.editor.manifest.app.nodecmd));\n        }\n        if (n1) err.push(\"Title mount ref poins to null.\");\n        if (n3) err.push(\"Invalid doc mount pointer.\");\n        if (n4) err.push(\"Cmd mount ref poins to null.\");\n      } else d.editor.manifest=null;\n\n\n      if (!err.length) {\n        d.editor.manifest.id = d.editor.id;\n        d.editor.title = r.title;\n\n        if (r.pic.length) d.editor.pic = r.pic; \n\n        ok.push(\"$id: \"+d.editor.id);\n        ok.push(\"_id: \"+d.editor._id);\n      }\n\n      d.editor.desc=r._desc;\n      d.editor.name=r.name;\n      d.editor.beta = !!(r._type.indexOf(\"beta\")>-1);\n\n      \n      if (err.length) d.err=err; else d.err=[];\n      return err.length?'<div class=\"orange\">'+err.join(\"<br>\")+'</div>':'<div class=\"green\">'+ok.join(\"<br>\")+'</div>';\n    }","watch": "#manifesto"},"#atts": {"init": "function ($o) {\n      var that = this; \n      $o.my(\n        $.extend($.my.cache('cw.Sys.Attachments'), {params:{locale:'en'}}), \n        {\n          doc:that.data.editor,\n          namePopup:true,\n          truncate:20\n        }\n      );\n\t\t}","bind": "function () {}"}},"RT": "function (key) {\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t}","Postfix": {},"Subs": {},"Side": {},"die": "function ($o) {\n\t\t$o.find('#tlist').getNiceScroll().remove();\n\t}","init": "function ($o,form) {\n\t\t\n\tvar that=this,\n      pi = $.Deferred();\n\t\t\t\t\n\t$o.formgen('init', that.HTML);\n\t\t\n\t$o.find(\"#pane\").on(\"keyup\",\"textarea\", function (){\n\t\tvar $t=$(this);\n\t\t$t.height(0).height($t[0].scrollHeight-6);\n\t});\n\t\n\tvar ed = that.data.editor;\n\t\n\tthat.$Ed = $o.find(\"#manifesto\");\n\n\tthat.MakePostfix(ed._id);\n\tthat.MakeSubs(\"cw.\"+ed.raw.name);\n  \n  that.E.Prefix = function(){ return {id:form.data.editor.id}; };\n\tthat.E.Postfix = function(){ return that.Postfix; };\n\tthat.E.Subs = function(){ return that.Subs; };\n\t\n\t// listen to commands from inside\n\t$o.on('savemanifest.my', function(){ that.SaveDoc(); });\n\t\n\t// CM-related stuff\n\tthat.InitCM();\n\t\n\t(function(){pi.resolve();}).delay(1);\n\t\t\n\treturn pi.promise();\n}","HTML": "<div class=\"fs90\" id=\"manedframe\">\n  <div id=\"cmcont\" class=\"dib vat maned oh hide\" style=\"border:1px solid #C1D0DA\">\n    <textarea id=\"cm\" class=\"maned fs80\"></textarea>\n  </div>\n  <div id=\"manifesto\" class=\"dib vat maned\">\n    <div class=\"w220 dib vat\">\n      \n      <!-- btns -->\n      <div class=\"buttons dib vat mr10\">\n        <button id=\"btn-add\" class=\"button w30 fs85 lh120 br2 ml0\"><span class=\"fi-plus\"></span></button>\n      </div>\n      <div class=\"buttons dib vat mr10\">\n        <button id=\"btn-run\" class=\"button w30 validate fs85 lh120 btnl pl2\">\n          <span class=\"fi-play\"></span>\n        </button>\n        <button id=\"btn-compile\" class=\"button validate w30 fs85 lh120 btnr\">\n          <span class=\"fi-shopping-bag\"></span>\n        </button>\n      </div>\n      <div class=\"buttons dib vat mr10\">\n        <button id=\"btn-save\" class=\"button w30 fs85 lh120 btnl\"><span class=\"fi-save\"></span></button>\n        <button id=\"btn-docopts\" class=\"button w30 fs85 lh120\"><span class=\"fi-wrench\"></span></button>\n        <button id=\"btn-close\" class=\"button btnr w30 fs85 lh120\">✕</button>\n      </div>\n      \n      <!-- search -->\n\t\t\t<div class=\"w210 fs85 mt5 mb5\">\n\t\t\t\t<div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>\n\t\t\t\t<input type=\"text\" id=\"tab-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" \n\t\t\t\t\tplaceholder=\"Search\" style=\"background-image:none;padding-right:19px!important;\">\n\t\t\t\t<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\" \n\t\t\t\t\t onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span>\n\t\t\t</div>\n      \n      <!-- tabs -->\n      <div class=\"w210 mt4\" id=\"tlist\">\n        <div id=\"coms\" class=\"xgray w100p fs85 lh150\">\n          <div class=\"tab w100p\">\n            <div id=\"xtitle\" class=\"w100p dib vat nw ell oh\">\n              <span id=\"title\" class=\"\"></span>\n              <span class=\"fold\"></span>\n            </div>\n            <span class=\"ctype\"></span>\n          </div>\n        </div>\n        <div id=\"atts\" class=\"w210 fs90 gray mt0 pt6 pb8 btd lh140\"></div>\n      </div>\n    </div>\n    \n    <div class=\"dib vat\" style=\"width:calc(100% - 220px)\">\n      <!-- editors -->\n      <div id=\"eds\" class=\"cb\"></div>\n      <!-- hidden -->\n      <div id=\"warnM\" class=\"hide\"></div>\n    </div>\n  </div>\n  <div id=\"warn\" class=\"hide\"></div>\n</div>","style": {"": "font-size:20px;"," #cmcont .CodeMirror": "height:auto;line-height:1.4em;"," #xmanifesto .CodeMirror": "height:auto;line-height:1.4em;"," .maned": "width:100%;"," .cm-csscolor": "color: rgba(255, 80, 212, 1); "," .cm-csscolor::selection": "cursor:pointer!important;background:red"," .cm-domidcolor": "color: #485E77; background-color: rgba(180, 195, 202, 0.19); border-radius:2px; "," .CodeMirror-selected": "background: #d9dee0;"," .CodeMirror-focused .CodeMirror-selected": "background: #cae7ff;"," .CodeMirror-focused .CodeMirror-selectedtext": "background-color: #cae7ff!important;"," .cm-matchhighlight": "background-color:rgba(97,255,2,0.3); box-shadow: 0 -2px 0 0 rgba(97,255,2,0.3), 0 1px 0 0 rgba(97,255,2,0.3);border-radius:1px;"," .CodeMirror-selection-highlight-scrollbar": "background-color: rgba(165,230,255,0.5);"," #tlist ": "function ($o) {\n    var ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n        pad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n        css = \"overflow:hidden;height:\"+($(window).height()-(pad+ofs+80))+\"px;\";\n    return css;\n  }"," #tab-search": "border-radius:2px!important;"," #manifesto": {"": "width:100%;"," .violet": "color:rgb(109, 37, 179);"," .o0": "opacity:0;"," .w00": "width:0!important;margin-right:0!important;overflow:hidden;white-space: nowrap;position:absolute;"," .fold": "opacity:0.7;padding:0 4px;cursor:pointer; font-size:80%;","  .CodeMirror": "function ($o) {\n      var large = $o.width() > 1400;\n      return large?{\n        '': 'font-size:13.5px;line-height:17px',\n        ' .CodeMirror-lines': 'line-height:17px;',\n      }:{\n        '': 'font-size:13px;line-height:16px',\n        ' .CodeMirror-lines': 'line-height:16px;',\n      };\n    }"," #coms": {"": "margin-bottom: 5px;"," .tab": "margin-right:2px;"," #xtitle": "padding:0px 2px; cursor:move; border-radius:2px; transition: color 0.2s, background-color 0.2s, opacity 0.2s;"," .haserror": "color:#FF2A4D!important;"," #title": "cursor:pointer;"," .active": "background-color:rgba(220,220,220, 0.5);color:#505560;"," .active.haserror": "color:white!important;background-color:#EE637A!important;"," .ctype": "font-size:80%; opacity:0.7; display:block;position:absolute;top:-2px;right:4px;"}," .tab": {"": "transition: color 0.2s, background-color 0.15s;background-color:rgba(255,255,255,0);"}," #eds": {"": "border:1px solid #ddd; border-radius:2px",">xdiv": "height:0;overflow:hidden;",">xdiv:first-child": "height:auto;"," .CodeMirror-linenumbers": "transition: background-color 0.3s"," .ed-error .CodeMirror-linenumbers": "background-color:rgba(255, 200, 200, 0.75)"}," .buttons": {" .button": "margin:0 0 0 2px; border-radius:0; padding: 4px 0px;"," .btnl": "border-radius: 2px 0 0 2px;"," .btnr": "border-radius: 0 2px 2px 0;"}," button:focus": "outline:none;"," .itl": "font-style:italic;"," .itl:after": "content:\"*\";font-style:normal;margin-left:1px;"," a, .pseudolink": "text-decoration:none;"," .cw-att-item": "padding: 0.1em 0 0em 0;"}},"MakePostfix": "function (docid) {\n\tvar that = this;\n\tthat.db.load(docid, true)\n\t.then(function(doc){\n\t\tif ( doc && doc._attachments ) that.Postfix.files = doc._attachments;\n\t})\n}","MakeSubs": "function (formid) {\n\tvar that = this,\n\t\t\ti, \n\t\t\tchilds = that.db.ram(function(e){\n\t\t\t\treturn (e.type == \"manifest\" && e.manifest && e.manifest.id.startsWith(formid+\".\"))\n\t\t\t});\n\n\tif (childs.length) {\n\t\tchilds = childs.map(function(e){return Object.clone(e,true)});\n\t\tchilds.forEach(function(e){\n\t\t\tvar man = cw.lib.unjson(e.manifest),\n\t\t\t\t\tref = man.id.from(formid.length+1);\n\t\t\t$.extend(!0, that.Subs, cw.lib.unmask(man, ref));\n\t\t\tman = cw.lib.getref(that.Subs, ref);\n\n\t\t\t//has attaches?\n\t\t\tif (Object.size(e._attachments)) {\n\t\t\t\tthat.db.load(e._id, true)\n\t\t\t\t.then(function(man2){\n\t\t\t\t\tman.files = man2._attachments;\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t}\n}","CMoverlays": "function () {\n\n\t// Extends CM with DOM id highlighter\n\t// and supplementary highlighting for color picker\n\t\n\tvar re_clr = /^(rgb[a]?\\s*\\([\\s0-9,\\.]+\\)|#[0-9a-fA-F]{8}|#[0-9a-fA-F]{6}|#[0-9a-fA-F]{3})/,\n\t\t\tre_domid = /^('#[a-z0-9\\-_]{1,20}'|'\\.[a-z0-9\\-_\\.]{1,20}'|'input\\[[^\\]]{1,20}\\]'|\"#[a-z0-9\\-_]{1,20}\"|\"\\.[a-z0-9\\-_\\.]{1,20}\"|\"input\\[[^\\]]{1,20}\\]\")/i,\n\t\t\tre_domid_x = /^('#[a-f0-9]{6}'|\"#[a-f0-9]{6}\")/i\n\n\tfunction _parseStream (stream, state) {\n\t\tvar ch, n1, n2;\n\n\t\tif (stream.match(re_clr)){\n\t\t\tstream.eat(re_clr);\n\t\t\treturn \"csscolor\";\n\t\t}\n\t\telse if (stream.match(re_domid) && !stream.match(re_domid_x)){\n\t\t\tstream.eat(re_domid);\n\t\t\treturn \"domidcolor\";\n\t\t}\n\t\twhile (\n\t\t\tstream.next() != null \n\t\t\t&& !stream.match(re_clr, false)\n\t\t\t&& !stream.match(re_domid, false)\n\t\t) {}\n\t\treturn null;\n\t}\n\n\t// - - - - - - - - - - - - -\n\t\n\t[\n\t\t[\"manjs\", \"javascript\"],\n\t\t[\"manhtml\", \"htmlmixed\"],\n\t\t[\"mancss\", \"text/css\"]\n\t].forEach(function(e){\n\t\tif (\n\t\t\t//true || \n\t\t\t!CodeMirror.modes[e[0]]\n\t\t) CodeMirror.defineMode(e[0], function(config, parserConfig) {\n\t\t\treturn CodeMirror.overlayMode(CodeMirror.getMode(config,e[1]), {token: _parseStream});\n\t\t});\n\t})\n\n}","InitCM": "function () {\n\n\t// inits different CM stuff\n\t\n\tvar that = this;\n\t\n\tif (!CodeMirror.overlayMode) _ovl(CodeMirror);\n  \n  if (!CodeMirror.optionHandlers.highlightSelectionMatches) that.Highlighter(CodeMirror);\n\t\n\tthat.CMoverlays();\n\n\treturn ;\n\n\n\t// - - - - - - - - - -\n\n\tfunction _ovl(CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.overlayMode = function(base, overlay, combine) {\n\t\t\treturn {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.startState(base),\n\t\t\t\t\t\toverlay: CodeMirror.startState(overlay),\n\t\t\t\t\t\tbasePos: 0,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: 0,\n\t\t\t\t\t\toverlayCur: null,\n\t\t\t\t\t\tstreamSeen: null\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcopyState: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.copyState(base, state.base),\n\t\t\t\t\t\toverlay: CodeMirror.copyState(overlay, state.overlay),\n\t\t\t\t\t\tbasePos: state.basePos,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: state.overlayPos,\n\t\t\t\t\t\toverlayCur: null\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\ttoken: function(stream, state) {\n\t\t\t\t\tif (stream != state.streamSeen ||\n\t\t\t\t\t\t\tMath.min(state.basePos, state.overlayPos) < stream.start) {\n\t\t\t\t\t\tstate.streamSeen = stream;\n\t\t\t\t\t\tstate.basePos = state.overlayPos = stream.start;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stream.start == state.basePos) {\n\t\t\t\t\t\tstate.baseCur = base.token(stream, state.base);\n\t\t\t\t\t\tstate.basePos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.start == state.overlayPos) {\n\t\t\t\t\t\tstream.pos = stream.start;\n\t\t\t\t\t\tstate.overlayCur = overlay.token(stream, state.overlay);\n\t\t\t\t\t\tstate.overlayPos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tstream.pos = Math.min(state.basePos, state.overlayPos);\n\n\t\t\t\t\t// state.overlay.combineTokens always takes precedence over combine,\n\t\t\t\t\t// unless set to null\n\t\t\t\t\tif (state.overlayCur == null) return state.baseCur;\n\t\t\t\t\telse if (state.baseCur != null &&\n\t\t\t\t\t\t\t\t\t state.overlay.combineTokens ||\n\t\t\t\t\t\t\t\t\t combine && state.overlay.combineTokens == null)\n\t\t\t\t\t\treturn state.baseCur + \" \" + state.overlayCur;\n\t\t\t\t\telse return state.overlayCur;\n\t\t\t\t},\n\n\t\t\t\tindent: base.indent && function(state, textAfter) {\n\t\t\t\t\treturn base.indent(state.base, textAfter);\n\t\t\t\t},\n\t\t\t\telectricChars: base.electricChars,\n\n\t\t\t\tinnerMode: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstate: state.base,\n\t\t\t\t\t\tmode: base\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tblankLine: function(state) {\n\t\t\t\t\tif (base.blankLine) base.blankLine(state.base);\n\t\t\t\t\tif (overlay.blankLine) overlay.blankLine(state.overlay);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t}\n}","SaveDoc": "function () {\n  var that = this,\n      d = that.data,\n      pi = $.Deferred(),\n      dbid = this.db.name; \n\n  d.editor.stamp = Date.now();\n\n  if (d.editor.manifest) {\n    var build = +d.editor.raw.build || (d.editor._rev?+d.editor._rev.split('-')[0]:null) || 1;\n    if (!Object.isNumber(build)) build = 1;\n    d.editor.manifest.build = build + 1;\n    d.editor.raw.build = build + 1;\n    if (d.editor.manifest.app && d.editor.manifest.app.hasOwnProperty('build')) {\n    \td.editor.manifest.app.build = build + 1;\n    }\n  }\n\n  that.db.save(d.editor)\n  .then(function (res){\n    \n    //console.log(Object.clone(res, true));\n\n    // mark manifest as trusted\n    if (window.cw && window.cw.read) {\n      cw.read[dbid].trust[res._id] = res._rev;\n      cw.read[dbid]._dirty = true;\n    }\n    \n    //push to app\n    Object.merge(\n      d.editor,\n      Object.select(res,[/^_/, \"stamp\", \"log\"])\n    );\n\n    //redraw file list\n    that.my.find('#atts').trigger(\"redraw\");\n\n    //rebuild \n    that.MakePostfix(d.editor._id);\n    \n    pi.resolve(d.editor);\n\n  })\n  .fail(function(err, res){\n    console.log(res, err);\n    pi.reject(err,res);\n  });\n\n  return pi.promise();\n}","Highlighter": "function (CodeMirror) {\n\n  // https://codemirror.net/addon/selection/mark-selection.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Because sometimes you need to mark the selected *text*.\n  //\n  // Adds an option 'styleSelectedText' which, when enabled, gives\n  // selected text the CSS class given as option value, or\n  // \"CodeMirror-selectedtext\" when the value is not a string.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineOption(\"styleSelectedText\", false, function(cm, val, old) {\n      var prev = old && old != CodeMirror.Init;\n      if (val && !prev) {\n        cm.state.markedSelection = [];\n        cm.state.markedSelectionStyle = typeof val == \"string\" ? val : \"CodeMirror-selectedtext\";\n        reset(cm);\n        cm.on(\"cursorActivity\", onCursorActivity);\n        cm.on(\"change\", onChange);\n      } else if (!val && prev) {\n        cm.off(\"cursorActivity\", onCursorActivity);\n        cm.off(\"change\", onChange);\n        clear(cm);\n        cm.state.markedSelection = cm.state.markedSelectionStyle = null;\n      }\n    });\n\n    function onCursorActivity(cm) {\n      if (cm.state.markedSelection)\n        cm.operation(function() {\n          update(cm);\n        });\n    }\n\n    function onChange(cm) {\n      if (cm.state.markedSelection && cm.state.markedSelection.length)\n        cm.operation(function() {\n          clear(cm);\n        });\n    }\n\n    var CHUNK_SIZE = 8;\n    var Pos = CodeMirror.Pos;\n    var cmp = CodeMirror.cmpPos;\n\n    function coverRange(cm, from, to, addAt) {\n      if (cmp(from, to) == 0) return;\n      var array = cm.state.markedSelection;\n      var cls = cm.state.markedSelectionStyle;\n      for (var line = from.line;;) {\n        var start = line == from.line ? from : Pos(line, 0);\n        var endLine = line + CHUNK_SIZE,\n            atEnd = endLine >= to.line;\n        var end = atEnd ? to : Pos(endLine, 0);\n        var mark = cm.markText(start, end, {\n          className: cls\n        });\n        if (addAt == null) array.push(mark);\n        else array.splice(addAt++, 0, mark);\n        if (atEnd) break;\n        line = endLine;\n      }\n    }\n\n    function clear(cm) {\n      var array = cm.state.markedSelection;\n      for (var i = 0; i < array.length; ++i) array[i].clear();\n      array.length = 0;\n    }\n\n    function reset(cm) {\n      clear(cm);\n      var ranges = cm.listSelections();\n      for (var i = 0; i < ranges.length; i++)\n        coverRange(cm, ranges[i].from(), ranges[i].to());\n    }\n\n    function update(cm) {\n      if (!cm.somethingSelected()) return clear(cm);\n      if (cm.listSelections().length > 1) return reset(cm);\n\n      var from = cm.getCursor(\"start\"),\n          to = cm.getCursor(\"end\");\n\n      var array = cm.state.markedSelection;\n      if (!array.length) return coverRange(cm, from, to);\n\n      var coverStart = array[0].find(),\n          coverEnd = array[array.length - 1].find();\n      if (!coverStart || !coverEnd || to.line - from.line <= CHUNK_SIZE ||\n          cmp(from, coverEnd.to) >= 0 || cmp(to, coverStart.from) <= 0)\n        return reset(cm);\n\n      while (cmp(from, coverStart.from) > 0) {\n        array.shift().clear();\n        coverStart = array[0].find();\n      }\n      if (cmp(from, coverStart.from) < 0) {\n        if (coverStart.to.line - from.line < CHUNK_SIZE) {\n          array.shift().clear();\n          coverRange(cm, from, coverStart.to, 0);\n        } else {\n          coverRange(cm, from, coverStart.from, 0);\n        }\n      }\n\n      while (cmp(to, coverEnd.to) < 0) {\n        array.pop().clear();\n        coverEnd = array[array.length - 1].find();\n      }\n      if (cmp(to, coverEnd.to) > 0) {\n        if (to.line - coverEnd.from.line < CHUNK_SIZE) {\n          array.pop().clear();\n          coverRange(cm, coverEnd.from, to);\n        } else {\n          coverRange(cm, coverEnd.to, to);\n        }\n      }\n    }\n  });\n\n  //===================================================\n\n  // https://codemirror.net/addon/scroll/annotatescrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"annotateScrollbar\", function(options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      return new Annotation(this, options);\n    });\n\n    CodeMirror.defineOption(\"scrollButtonHeight\", 0);\n\n    function Annotation(cm, options) {\n      this.cm = cm;\n      this.options = options;\n      this.buttonHeight = options.scrollButtonHeight || cm.getOption(\"scrollButtonHeight\");\n      this.annotations = [];\n      this.doRedraw = this.doUpdate = null;\n      this.div = cm.getWrapperElement().appendChild(document.createElement(\"div\"));\n      this.div.style.cssText = \"position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none\";\n      this.computeScale();\n\n      function scheduleRedraw(delay) {\n        clearTimeout(self.doRedraw);\n        self.doRedraw = setTimeout(function() {\n          self.redraw();\n        }, delay);\n      }\n\n      var self = this;\n      cm.on(\"refresh\", this.resizeHandler = function() {\n        clearTimeout(self.doUpdate);\n        self.doUpdate = setTimeout(function() {\n          if (self.computeScale()) scheduleRedraw(20);\n        }, 100);\n      });\n      cm.on(\"markerAdded\", this.resizeHandler);\n      cm.on(\"markerCleared\", this.resizeHandler);\n      if (options.listenForChanges !== false)\n        cm.on(\"change\", this.changeHandler = function() {\n          scheduleRedraw(250);\n        });\n    }\n\n    Annotation.prototype.computeScale = function() {\n      var cm = this.cm;\n      var hScale = (cm.getWrapperElement().clientHeight - cm.display.barHeight - this.buttonHeight * 2) /\n          cm.getScrollerElement().scrollHeight\n      if (hScale != this.hScale) {\n        this.hScale = hScale;\n        return true;\n      }\n    };\n\n    Annotation.prototype.update = function(annotations) {\n      this.annotations = annotations;\n      this.redraw();\n    };\n\n    Annotation.prototype.redraw = function(compute) {\n      if (compute !== false) this.computeScale();\n      var cm = this.cm,\n          hScale = this.hScale;\n\n      var frag = document.createDocumentFragment(),\n          anns = this.annotations;\n\n      var wrapping = cm.getOption(\"lineWrapping\");\n      var singleLineH = wrapping && cm.defaultTextHeight() * 1.5;\n      var curLine = null,\n          curLineObj = null;\n\n      function getY(pos, top) {\n        if (curLine != pos.line) {\n          curLine = pos.line;\n          curLineObj = cm.getLineHandle(curLine);\n        }\n        if ((curLineObj.widgets && curLineObj.widgets.length) ||\n            (wrapping && curLineObj.height > singleLineH))\n          return cm.charCoords(pos, \"local\")[top ? \"top\" : \"bottom\"];\n        var topY = cm.heightAtLine(curLineObj, \"local\");\n        return topY + (top ? 0 : curLineObj.height);\n      }\n\n      var lastLine = cm.lastLine()\n      if (cm.display.barWidth)\n        for (var i = 0, nextTop; i < anns.length; i++) {\n          var ann = anns[i];\n          if (ann.to.line > lastLine) continue;\n          var top = nextTop || getY(ann.from, true) * hScale;\n          var bottom = getY(ann.to, false) * hScale;\n          while (i < anns.length - 1) {\n            if (anns[i + 1].to.line > lastLine) break;\n            nextTop = getY(anns[i + 1].from, true) * hScale;\n            if (nextTop > bottom + .9) break;\n            ann = anns[++i];\n            bottom = getY(ann.to, false) * hScale;\n          }\n          if (bottom == top) continue;\n          var height = Math.max(bottom - top, 3);\n\n          var elt = frag.appendChild(document.createElement(\"div\"));\n          elt.style.cssText = \"position: absolute; right: 0px; width: \" + Math.max(cm.display.barWidth - 1, 2) + \"px; top: \" + (top + this.buttonHeight) + \"px; height: \" + height + \"px\";\n          elt.className = this.options.className;\n          if (ann.id) {\n            elt.setAttribute(\"annotation-id\", ann.id);\n          }\n        }\n      this.div.textContent = \"\";\n      this.div.appendChild(frag);\n    };\n\n    Annotation.prototype.clear = function() {\n      this.cm.off(\"refresh\", this.resizeHandler);\n      this.cm.off(\"markerAdded\", this.resizeHandler);\n      this.cm.off(\"markerCleared\", this.resizeHandler);\n      if (this.changeHandler) this.cm.off(\"change\", this.changeHandler);\n      this.div.parentNode.removeChild(this.div);\n    };\n  });\n\n\n\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/matchesonscrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"showMatchesOnScrollbar\", function(query, caseFold, options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      if (!options) options = {};\n      return new SearchAnnotation(this, query, caseFold, options);\n    });\n\n    function SearchAnnotation(cm, query, caseFold, options) {\n      this.cm = cm;\n      this.options = options;\n      var annotateOptions = {\n        listenForChanges: false\n      };\n      for (var prop in options) annotateOptions[prop] = options[prop];\n      if (!annotateOptions.className) annotateOptions.className = \"CodeMirror-search-match\";\n      this.annotation = cm.annotateScrollbar(annotateOptions);\n      this.query = query;\n      this.caseFold = caseFold;\n      this.gap = {\n        from: cm.firstLine(),\n        to: cm.lastLine() + 1\n      };\n      this.matches = [];\n      this.update = null;\n\n      this.findMatches();\n      this.annotation.update(this.matches);\n\n      var self = this;\n      cm.on(\"change\", this.changeHandler = function(_cm, change) {\n        self.onChange(change);\n      });\n    }\n\n    var MAX_MATCHES = 1000;\n\n    SearchAnnotation.prototype.findMatches = function() {\n      if (!this.gap) return;\n      for (var i = 0; i < this.matches.length; i++) {\n        var match = this.matches[i];\n        if (match.from.line >= this.gap.to) break;\n        if (match.to.line >= this.gap.from) this.matches.splice(i--, 1);\n      }\n      var cursor = this.cm.getSearchCursor(this.query, CodeMirror.Pos(this.gap.from, 0), this.caseFold);\n      var maxMatches = this.options && this.options.maxMatches || MAX_MATCHES;\n      while (cursor.findNext()) {\n        var match = {\n          from: cursor.from(),\n          to: cursor.to()\n        };\n        if (match.from.line >= this.gap.to) break;\n        this.matches.splice(i++, 0, match);\n        if (this.matches.length > maxMatches) break;\n      }\n      this.gap = null;\n    };\n\n    function offsetLine(line, changeStart, sizeChange) {\n      if (line <= changeStart) return line;\n      return Math.max(changeStart, line + sizeChange);\n    }\n\n    SearchAnnotation.prototype.onChange = function(change) {\n      var startLine = change.from.line;\n      var endLine = CodeMirror.changeEnd(change).line;\n      var sizeChange = endLine - change.to.line;\n      if (this.gap) {\n        this.gap.from = Math.min(offsetLine(this.gap.from, startLine, sizeChange), change.from.line);\n        this.gap.to = Math.max(offsetLine(this.gap.to, startLine, sizeChange), change.from.line);\n      } else {\n        this.gap = {\n          from: change.from.line,\n          to: endLine + 1\n        };\n      }\n\n      if (sizeChange)\n        for (var i = 0; i < this.matches.length; i++) {\n          var match = this.matches[i];\n          var newFrom = offsetLine(match.from.line, startLine, sizeChange);\n          if (newFrom != match.from.line) match.from = CodeMirror.Pos(newFrom, match.from.ch);\n          var newTo = offsetLine(match.to.line, startLine, sizeChange);\n          if (newTo != match.to.line) match.to = CodeMirror.Pos(newTo, match.to.ch);\n        }\n      clearTimeout(this.update);\n      var self = this;\n      this.update = setTimeout(function() {\n        self.updateAfterChange();\n      }, 250);\n    };\n\n    SearchAnnotation.prototype.updateAfterChange = function() {\n      this.findMatches();\n      this.annotation.update(this.matches);\n    };\n\n    SearchAnnotation.prototype.clear = function() {\n      this.cm.off(\"change\", this.changeHandler);\n      this.annotation.clear();\n    };\n  });\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/searchcursor.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror)\n  })(function(CodeMirror) {\n    \"use strict\"\n    var Pos = CodeMirror.Pos\n\n    function regexpFlags(regexp) {\n      var flags = regexp.flags\n      return flags != null ? flags : (regexp.ignoreCase ? \"i\" : \"\") + (regexp.global ? \"g\" : \"\") + (regexp.multiline ? \"m\" : \"\")\n    }\n\n    function ensureFlags(regexp, flags) {\n      var current = regexpFlags(regexp),\n          target = current\n      for (var i = 0; i < flags.length; i++)\n        if (target.indexOf(flags.charAt(i)) == -1)\n          target += flags.charAt(i)\n          return current == target ? regexp : new RegExp(regexp.source, target)\n    }\n\n    function maybeMultiline(regexp) {\n      return /\\\\s|\\\\n|\\n|\\\\W|\\\\D|\\[\\^/.test(regexp.source)\n    }\n\n    function searchRegexpForward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {\n        regexp.lastIndex = ch\n        var string = doc.getLine(line),\n            match = regexp.exec(string)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpForwardMultiline(doc, regexp, start) {\n      if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)\n\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, last = doc.lastLine(); line <= last;) {\n        // This grows the search buffer in exponentially-sized chunks\n        // between matches, so that nearby matches are fast and don't\n        // require concatenating the whole document (in case we're\n        // searching for something that has tons of matches), but at the\n        // same time, the amount of retries is limited.\n        for (var i = 0; i < chunk; i++) {\n          if (line > last) break\n          var curLine = doc.getLine(line++)\n          string = string == null ? curLine : string + \"\\n\" + curLine\n        }\n        chunk = chunk * 2\n        regexp.lastIndex = start.ch\n        var match = regexp.exec(string)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = start.line + before.length - 1,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    function lastMatchIn(string, regexp) {\n      var cutOff = 0,\n          match\n      for (;;) {\n        regexp.lastIndex = cutOff\n        var newMatch = regexp.exec(string)\n        if (!newMatch) return match\n        match = newMatch\n        cutOff = match.index + (match[0].length || 1)\n        if (cutOff == string.length) return match\n          }\n    }\n\n    function searchRegexpBackward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {\n        var string = doc.getLine(line)\n        if (ch > -1) string = string.slice(0, ch)\n        var match = lastMatchIn(string, regexp)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpBackwardMultiline(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, first = doc.firstLine(); line >= first;) {\n        for (var i = 0; i < chunk; i++) {\n          var curLine = doc.getLine(line--)\n          string = string == null ? curLine.slice(0, start.ch) : curLine + \"\\n\" + string\n        }\n        chunk *= 2\n\n        var match = lastMatchIn(string, regexp)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = line + before.length,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    var doFold, noFold\n    if (String.prototype.normalize) {\n      doFold = function(str) {\n        return str.normalize(\"NFD\").toLowerCase()\n      }\n      noFold = function(str) {\n        return str.normalize(\"NFD\")\n      }\n    } else {\n      doFold = function(str) {\n        return str.toLowerCase()\n      }\n      noFold = function(str) {\n        return str\n      }\n    }\n\n    // Maps a position in a case-folded line back to a position in the original line\n    // (compensating for codepoints increasing in number during folding)\n\n    function adjustPos(orig, folded, pos, foldFunc) {\n      if (orig.length == folded.length) return pos\n      for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {\n        if (min == max) return min\n        var mid = (min + max) >> 1\n        var len = foldFunc(orig.slice(0, mid)).length\n        if (len == pos) return mid\n        else if (len > pos) max = mid\n        else min = mid + 1\n          }\n    }\n\n    function searchStringForward(doc, query, start, caseFold) {\n      // Empty string would match anything and never progress, so we\n      // define it to match nothing instead.\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {\n        var orig = doc.getLine(line).slice(ch),\n            string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.indexOf(lines[0])\n          if (found == -1) continue search\n          var start = adjustPos(orig, string, found, fold) + ch\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold) + ch),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)\n          }\n        } else {\n          var cutFrom = string.length - lines[0].length\n          if (string.slice(cutFrom) != lines[0]) continue search\n          for (var i = 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(line + i)) != lines[i]) continue search\n            var end = doc.getLine(line + lines.length - 1),\n                endString = fold(end),\n                lastLine = lines[lines.length - 1]\n            if (endString.slice(0, lastLine.length) != lastLine) continue search\n            return {\n              from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),\n              to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function searchStringBackward(doc, query, start, caseFold) {\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {\n        var orig = doc.getLine(line)\n        if (ch > -1) orig = orig.slice(0, ch)\n        var string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.lastIndexOf(lines[0])\n          if (found == -1) continue search\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold)),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))\n          }\n        } else {\n          var lastLine = lines[lines.length - 1]\n          if (string.slice(0, lastLine.length) != lastLine) continue search\n          for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(start + i)) != lines[i]) continue search\n            var top = doc.getLine(line + 1 - lines.length),\n                topString = fold(top)\n            if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search\n            return {\n              from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),\n              to: Pos(line, adjustPos(orig, string, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function SearchCursor(doc, query, pos, options) {\n      this.atOccurrence = false\n      this.doc = doc\n      pos = pos ? doc.clipPos(pos) : Pos(0, 0)\n      this.pos = {\n        from: pos,\n        to: pos\n      }\n\n      var caseFold\n      if (typeof options == \"object\") {\n        caseFold = options.caseFold\n      } else { // Backwards compat for when caseFold was the 4th argument\n        caseFold = options\n        options = null\n      }\n\n      if (typeof query == \"string\") {\n        if (caseFold == null) caseFold = false\n        this.matches = function(reverse, pos) {\n          return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)\n        }\n      } else {\n        query = ensureFlags(query, \"gm\")\n        if (!options || options.multiline !== false)\n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)\n          }; \n        else \n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)\n          };\n      }\n    }\n\n    SearchCursor.prototype = {\n      findNext: function() {\n        return this.find(false)\n      },\n      findPrevious: function() {\n        return this.find(true)\n      },\n\n      find: function(reverse) {\n        var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))\n\n        // Implements weird auto-growing behavior on null-matches for\n        // backwards-compatiblity with the vim code (unfortunately)\n        while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {\n          if (reverse) {\n            if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)\n            else if (result.from.line == this.doc.firstLine()) result = null\n            else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))\n              } else {\n                if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)\n                else if (result.to.line == this.doc.lastLine()) result = null\n                else result = this.matches(reverse, Pos(result.to.line + 1, 0))\n                  }\n        }\n\n        if (result) {\n          this.pos = result\n          this.atOccurrence = true\n          return this.pos.match || true\n        } else {\n          var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)\n          this.pos = {\n            from: end,\n            to: end\n          }\n          return this.atOccurrence = false\n        }\n      },\n\n      from: function() {\n        if (this.atOccurrence) return this.pos.from\n          },\n      to: function() {\n        if (this.atOccurrence) return this.pos.to\n          },\n\n      replace: function(newText, origin) {\n        if (!this.atOccurrence) return\n        var lines = CodeMirror.splitLines(newText)\n        this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)\n        this.pos.to = Pos(this.pos.from.line + lines.length - 1,\n                          lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))\n      }\n    }\n\n    CodeMirror.defineExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this.doc, query, pos, caseFold)\n    })\n    CodeMirror.defineDocExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this, query, pos, caseFold)\n    })\n\n    CodeMirror.defineExtension(\"selectMatches\", function(query, caseFold) {\n      var ranges = []\n      var cur = this.getSearchCursor(query, this.getCursor(\"from\"), caseFold)\n      while (cur.findNext()) {\n        if (CodeMirror.cmpPos(cur.to(), this.getCursor(\"to\")) > 0) break\n        ranges.push({\n          anchor: cur.from(),\n          head: cur.to()\n        })\n          }\n      if (ranges.length)\n        this.setSelections(ranges, 0)\n        })\n  });\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/match-highlighter.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Highlighting text that matches the selection\n  //\n  // Defines an option highlightSelectionMatches, which, when enabled,\n  // will style strings that match the selection throughout the\n  // document.\n  //\n  // The option can be set to true to simply enable it, or to a\n  // {minChars, style, wordsOnly, showToken, delay} object to explicitly\n  // configure it. minChars is the minimum amount of characters that should be\n  // selected for the behavior to occur, and style is the token style to\n  // apply to the matches. This will be prefixed by \"cm-\" to create an\n  // actual CSS class name. If wordsOnly is enabled, the matches will be\n  // highlighted only if the selected text is a word. showToken, when enabled,\n  // will cause the current token to be highlighted when nothing is selected.\n  // delay is used to specify how much time to wait, in milliseconds, before\n  // highlighting the matches. If annotateScrollbar is enabled, the occurences\n  // will be highlighted on the scrollbar via the matchesonscrollbar addon.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    var defaults = {\n      style: \"matchhighlight\",\n      minChars: 2,\n      maxChars: 200,\n      delay: 100,\n      wordsOnly: false,\n      annotateScrollbar: false,\n      showToken: false,\n      trim: true\n    }\n\n    function State(options) {\n      this.options = {}\n      for (var name in defaults)\n        this.options[name] = (options && options.hasOwnProperty(name) ? options : defaults)[name]\n        this.overlay = this.timeout = null;\n      this.matchesonscroll = null;\n      this.active = false;\n    }\n\n    CodeMirror.defineOption(\"highlightSelectionMatches\", false, function(cm, val, old) {\n      if (old && old != CodeMirror.Init) {\n        removeOverlay(cm);\n        clearTimeout(cm.state.matchHighlighter.timeout);\n        cm.state.matchHighlighter = null;\n        cm.off(\"cursorActivity\", cursorActivity);\n        cm.off(\"focus\", onFocus)\n      }\n      if (val) {\n        var state = cm.state.matchHighlighter = new State(val);\n        if (cm.hasFocus()) {\n          state.active = true\n          highlightMatches(cm)\n        } else {\n          cm.on(\"focus\", onFocus)\n        }\n        cm.on(\"cursorActivity\", cursorActivity);\n      }\n    });\n\n    function cursorActivity(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.active || cm.hasFocus()) scheduleHighlight(cm, state)\n        }\n\n    function onFocus(cm) {\n      var state = cm.state.matchHighlighter\n      if (!state.active) {\n        state.active = true\n        scheduleHighlight(cm, state)\n      }\n    }\n\n    function scheduleHighlight(cm, state) {\n      clearTimeout(state.timeout);\n      state.timeout = setTimeout(function() {\n        highlightMatches(cm);\n      }, state.options.delay);\n    }\n\n    function addOverlay(cm, query, hasBoundary, style) {\n      var state = cm.state.matchHighlighter;\n      cm.addOverlay(state.overlay = makeOverlay(query, hasBoundary, style));\n      if (state.options.annotateScrollbar && cm.showMatchesOnScrollbar) {\n        var searchFor = hasBoundary ? new RegExp(\"\\\\b\" + query.replace(/[\\\\\\[.+*?(){|^$]/g, \"\\\\$&\") + \"\\\\b\") : query;\n        state.matchesonscroll = cm.showMatchesOnScrollbar(searchFor, false, {\n          className: \"CodeMirror-selection-highlight-scrollbar\"\n        });\n      }\n    }\n\n    function removeOverlay(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.overlay) {\n        cm.removeOverlay(state.overlay);\n        state.overlay = null;\n        if (state.matchesonscroll) {\n          state.matchesonscroll.clear();\n          state.matchesonscroll = null;\n        }\n      }\n    }\n\n    function highlightMatches(cm) {\n      cm.operation(function() {\n        var state = cm.state.matchHighlighter;\n        removeOverlay(cm);\n        if (!cm.somethingSelected() && state.options.showToken) {\n          var re = state.options.showToken === true ? /[\\w$]/ : state.options.showToken;\n          var cur = cm.getCursor(),\n              line = cm.getLine(cur.line),\n              start = cur.ch,\n              end = start;\n          while (start && re.test(line.charAt(start - 1)))--start;\n          while (end < line.length && re.test(line.charAt(end)))++end;\n          if (start < end)\n            addOverlay(cm, line.slice(start, end), re, state.options.style);\n          return;\n        }\n        var from = cm.getCursor(\"from\"),\n            to = cm.getCursor(\"to\");\n        if (from.line != to.line) return;\n        if (state.options.wordsOnly && !isWord(cm, from, to)) return;\n        var selection = cm.getRange(from, to);\n        if (selection.length > state.options.maxChars) return;\n        if (state.options.trim) selection = selection.replace(/^\\s+|\\s+$/g, \"\")\n        if (selection.length >= state.options.minChars)\n          addOverlay(cm, selection, false, state.options.style);\n      });\n    }\n\n    function isWord(cm, from, to) {\n      var str = cm.getRange(from, to);\n      if (str.match(/^\\w+$/) !== null) {\n        if (from.ch > 0) {\n          var pos = {\n            line: from.line,\n            ch: from.ch - 1\n          };\n          var chr = cm.getRange(pos, from);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        if (to.ch < cm.getLine(from.line).length) {\n          var pos = {\n            line: to.line,\n            ch: to.ch + 1\n          };\n          var chr = cm.getRange(to, pos);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        return true;\n      } else return false;\n    }\n\n    function boundariesAround(stream, re) {\n      return (!stream.start || !re.test(stream.string.charAt(stream.start - 1))) &&\n        (stream.pos == stream.string.length || !re.test(stream.string.charAt(stream.pos)));\n    }\n\n    function makeOverlay(query, hasBoundary, style) {\n      return {\n        token: function(stream) {\n          if (stream.match(query) &&\n              (!hasBoundary || boundariesAround(stream, hasBoundary)))\n            return style;\n          stream.next();\n          stream.skipTo(query.charAt(0)) || stream.skipToEnd();\n        }\n      };\n    }\n  });\n}","E": {"params": {"restyle": 200},"require": [{"UglifyJS": "lib/uglify.js"}],"inherit": ["db","RT"],"data": {"name": "","title": "","version": "0","build": 1,"com": [],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "800","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": ""},"_src": "","_preview": "","Item": {"stamp": 0,"id": "Root","type": "js","data": "({})","active": true,"opts": []},"Mode": {"saveToLs": false,"previewParent": "#cw-body","fullscreenStyle": "padding:30px; min-width:150px;"},"Editors": [],"Collapsed": [],"getCollapsed": "function () {return this.Collapsed;}","searchRe": null,"getSearchRe": "function () {return this.searchRe;}","GetTabHash": "function (item,idx) {\n    var that = this;\n    return cw.lib.sdbm([\n      Object.reject(item, 'data'),\n      that.Collapsed,\n      item.id=='Root'?that.data.title:'',\n      that.searchRe?that.data._search:''\n    ]);\n  }","GetTabId": "function (e) {return e.stamp + e.id}","Postfix": "function () {return {}}","Prefix": "function () {return {}}","RTE": "function (key) {\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t}","TabCollapse": "function (reflist) {\n\n    // Re-builds collapse list for tabs\n\n    var that = this,\n        curr = that.Collapsed,\n        coll = curr.reduce(function(a,b,i){a[b[0]] = i;return a;},{}),\n        res = [],\n        c;\n\n    // Need optimization!\n\n    c= (reflist || that.data.com.map(function(e){return e.id}))\n    .sortBy()\n    .reduce(function(a,b){\n      var ins = -1;\n      if(!a.a[b]) {\n        var k = Object.keys(a.a);\n        k.forEach(function(e,i){\n          if (ins==-1 && b.startsWith(e+\".\")) ins=i;\n        });\n      }\n      if (ins>-1) {\n        a.coll[k[ins]] = (a.coll[k[ins]] || 0)+1;\n      }\n      else a.a[b]=0;\n      return a;\n    },{a:{},coll:{}})[\"coll\"];\n\n    Object.keys(c)\n    .forEach(function(k){\n      if (k in coll) res.push([k, curr[coll[k]][1], c[k]]);\n      else res.push([k, false, c[k]]);\n    });\n\n    that.data.collapsed = res.map(function(e){\n      if (e[1]) return e[0];\n    }).compact();\n\n    return that.Collapsed = res;\n\n  }","Build": "function (buildPreview) {\n    var that=this,\n        d = that.data,\n        opts = that.Types, \n        err=[], r={}, p={}, \n        row, ext, conv, a;\n    if (Object.isFunction(that.Prefix)) $.extend(true, r, that.Prefix());\n\n    if (buildPreview) $.extend(true, p, r);\n\n    for (var i=0;i<d.com.length;i++) {\n      row = d.com[i];\n      ext = {};\n\n      conv = opts[row.type].compile || function(s){return [[], s||\"\"];};\n      a = conv(row.data);\n\n      if (a[0].length) err.push(\"Invalid ‘\"+row.id+\"’. \"+a[0].join(\"; \")+\".\");\n      if (a[1]!==undefined) {\n        if (row.id.to(1)===\".\") {\n          ext = cw.lib.unmask(a[1], row.id.from(1));\n        } else {\n          ext = a[1];\n        }\n      }\n\n      if (buildPreview) $.extend(true, p, ext);\n      if (!row.opts || row.opts.indexOf(\"nocompile\")===-1) $.extend(true, r, ext);\n    }\n\n    if (Object.isFunction(that.Postfix)) {\n      var tmp = that.Postfix()||{};\n      if (buildPreview) $.extend(true, p, tmp);\n      $.extend(true, r, tmp);\n    }\n\n    d._err = err;\n\n    //that._src = \"(\"+this.js2txt(r,'\\t')+\")\";\n\n    that._src = JSON.parse(cw.lib.json(r));\n\n    if (buildPreview) that._preview = \"(\"+this.js2txt(p,'\\t')+\")\";\n\n    r = p = ext = null;\n\n    return err;\n  }","ParseJS": "function (s,clean) {\n\n    var g=s,\n        u = UglifyJS, \n        ast,\n        res ={\n          globals:[],\n          errors:[]\n        },\n        gl;\n    try{\n      ast = u.parse(s+\"\");\n    } catch (e) {\n      res.errors.push (e.message+\" @\"+e.line+\":\"+e.col)\n    }\n    if (ast) {\n      ast.figure_out_scope();\n      if (Object.isObject(gl = ast.globals) && gl._size) {\n        Object.keys(gl._values)\n        .forEach(function(i){\n          res.globals.push(gl._values[i].name);\n        });\n        res.globals.sort();\n        if (clean) {\n          res.globals = [].remove.apply(\n            res.globals,\n            (\"String Function Date Math Number Object Array RegExp isNaN undefined parseInt parseFloat \"\n             +\"isFinite\").split(\" \")\n          );\n        }\n      }\n    }\n    return res;\n  }","init": "function ($form) {\t\n\tvar that = this,\n      d = that.data;\n\t\n  //$form.formgen('init',this.HTML);\t\n\n\tthis.js2txt = cw.lib.js2txt;\n\t\n\t$.extend (this.Ed, {NewTab: Object.clone(this.NewTab, true), Types: this.Types});\n\t\n\t$.extend(this.Tab, {Types: this.Types});\n\n\tif (this.Mode.saveToLs) {\n\t\t// Saved?\n\t\tvar ls = localStorage, old = ls.getItem(\"Manifesto\");\n\t\tif (old) Object.merge(d, JSON.parse(old));\n\t\t// localStorage saver\n\t\t$form.then(function(){\n\t\t\t$form.on(\"change\", function (){\n\t\t\t\tls.setItem(\"Manifesto\", JSON.stringify($form.my(\"data\")));\n\t\t\t}.debounce(500));\n\t\t});\n\t}\n\t\n\tif (d._preview!==void 0) delete d._preview;\n\t\n\tif (!d.com) d.com = [];\n\td.com = d.com.map(function(e){\n\t\tif (!Object.isObject(e) || !e.id || !(\"data\" in e)) return null;\n\t\tif (!that.Types[e.type]) e.type=\"text\";\n\t\treturn e;\n\t}).compact(true);\n\tif (!d.com.length) {\n\t\td.com.push(Object.clone(this.Item, !0));\n\t\td.com[0].stamp = Date.now()+\"\";\n\t\td.com[0].data = that.NewAppSrc;\n\t}\n\t\n\td._src=\"\";\n\t\n\tvar act = d.com.find(function(e){return e.active}) || d.com[0];\n\tact.active = true;\n\tthis.Editors.push(act);\t\n\t\n\t// Remove tab\n\t\n\t$form.on(\"removetab.my\", function(evt, data){\n\t\tvar t = d.com, e = that.Editors;\n\t\tt.removeAt(t.indexOf(data));\n\t\te.removeAt(e.indexOf(data));\n\t\tt[0].active=true;\n\t\t\n\t\tthat.TabCollapse();\n\t\t$form.find(\"#coms,#eds\").trigger(\"recalc\");\n\t});\n\t\n\t// Tab Collapser\n\tif (d.collapsed) that.Collapsed = d.collapsed.map(function(e){return [e, true,1]});\n\tthat.TabCollapse();\n\t\n}","ui": {"#coms": {"bind": "com","check": true,"init": "function ($o,form) {\n      var d = form.data,\n          that = this;\n\n      $o.sortable({handle:\"#xtitle\"});\n\n      // Switch tab\n\n      $o.on(\"switch.my\", function(evt, data){\t\n        var $f = $(this).my().root,  e = that.Editors, i = 0;\t\t\t\n        for (;i<d.com.length;i++) d.com[i].active=!1;\n        data.active = !0;\t\n        if (e.indexOf(data)===-1) e.unshift(data);\n        try { that.TabCollapse(); \t} catch(e) { console.log(e) }\n        return false;\n      });\n\n      // Fold/unfold tabgroups \n\n      $o.on(\"click.my\",\".fold\", function(){\n        var id = $(this).parents('.my-form').eq(0).my(\"data\").id;\n        var e = that.Collapsed.find(function(e){\n          return e[0]==id;\n        });\n        if (e) {\n          e[1]=!e[1];\n          $o.trigger(\"recalc\");\n        }\n      }.debounce(10));\n\n    }","manifest": "Tab","hash": "this.GetTabHash","id": "this.GetTabId","list": ">div","delay": 20,"watch": "#tab-search"},"#eds": {"bind": "this.Editors","watch": "#coms","recalc": "#coms","recalcDepth": 1,"manifest": "Ed","hash": "GetTabHash","id": "GetTabId","list": "<section></section>","delay": 110,"init": "function ($o) {\n      // Color Picker magic\n      if ($.my.cache(\"cw.Sys.Colorpicker\")) {\n        $o.on(\"contextmenu.my\",\".cm-csscolor\", function(evt){\n          var $i = $(evt.currentTarget),//$(this),\n              c = $i[0].innerText+\"\",\n              cm = $i.parents(\"section\").find(\"#cm\").next()[0].CodeMirror,\n              x = evt.pageX,\n              y = evt.pageY,\n              up = $(window).height()/2>y;\n\n          $i.modal({\n            width:272,\n            css:\"p0\",\n            manifest:$.my.cache(\"cw.Sys.Colorpicker\"),\n            data:{css:c},\n            align:up?\"top:100%\":\"bottom:140%\",\n            nose:up?\"top\":\"bottom\",\n            screen:\"rgba(255,255,255,0.5)\",\n            esc:true,\n            enter:true,\n            close:false,\n            focus:\"#cprgb\"\n          })\n          .then(function(picker){\n            //console.log(res);\n            var co = cm.coordsChar({left:x, top:y}),\n                line = co.line,\n                idx = co.ch,\n                cd = cm.getDoc(),\n                s = cd.getLine(line),\n                sl = s.length,\n                res = s;\n            for (var i=idx; i>-1; i--) {\n              var s0 = s.substr(i);\n              if (s0.startsWith(c)) {\n                res = s.to(i) + s0.replace(c, picker.css.toLowerCase());\n                break;\n              }\n            }\n            cd.replaceRange(res, {line:line, ch:0}, {line:line, ch:sl})\n            //$i.text(picker.css).trigger(\"input\");\n          });\n          return false;\n        });\n      }\n    }"},"#warnM": {"bind": "function (d,v,$o) {\n\n      var err = this.Build (false);\n\n      if (err.length) $o.my(\"find\",\".validate\").addClass(\"red\");\n      else $o.my(\"find\",\".validate\").removeClass(\"red\");\n\n      $o.trigger(\"change\");\n    }","watch": "#eds","delay": 150},"#tab-search": {"delay": 150,"bind": "function (d,v) {\n      var that = this;\n      if (v!=null) {\n      \td._search = v;\n      }\n      if (d._search.length < 2) that.searchRe = null;\n      else that.searchRe = new RegExp('('+RegExp.escape(d._search)+')', 'i');\n      return d._search;\n    }","css": {"my-search": "new RegExp(/^.{2,}$/)"}},"#btn-run": {"delay": 150,"bind": "function (d,v,$o) {\n      var $r, $e, $p, dui, ref, doc, parentapp, _prefix, that=this, runnow=true;\n      if (v!=null) {\n        that.Build (true);\n        if (d._err.length) cw.lib.note(d._err.join(\"<br>\"),\"error\");\n        else {\n          $r = $o.my().root;\n          if ($r) dui = $r.my().dui;\n\n          if (dui) {\n            ref = dui.bind.split(\".\").to(-1).join(\".\");\n            doc = $.my.f.getref($r.my().ddata, ref);\n            if (doc && Object.isObject(doc._attachments) && Object.size(doc._attachments)) {\n              // try read attaches\n              parentapp = $r.my().root.data(\"app\");\n              if (parentapp && parentapp.db && parentapp.db.load) {\n                runnow = false;\n                parentapp.db.load(doc._id, true)\n                .then(function(res){\n                  if (res._attachments) _prefix = {files:res._attachments};\n                  _runPreview();\n                })\n              } \n            }\t\n          } \n          if (runnow) _runPreview();\n        }\n      }\n\n      function _runPreview(){ \n        // Preview in modal\n        if (d._opts.runMode==\"modal\") {\n          var $r = $o.parents(\"#manedframe\").eq(0);\n          $r.modal({\n            root:$r.parent(),\n            manifest: that.Preview,\n            data:{\n              _opts:d._opts,\n              _src:that._preview,\n              _prefix:_prefix,\n              _subs:that.Subs,\n              _db:that.db\n            },\n            width:d._opts.runWidth||1000,\n            esc:true,\n            global:false,\n            css:'pl15 pr15 pb15 pt0',\n            //screen:'rgba(255,255,255,0.5)',\n            drag:'#app-editor-preview-drag'\n          }).then(function(r){\n            //Object.merge(d._opts,r,true)\n          })\n          /*.fail(function(res){\n\t\t\t\t\tcw.lib.note(\"Preview failed to init. \"\n\t\t\t\t\t\t+\"See console for details\", \"error\");\n\t\t\t\t});*/\n        }\n\n        // Preview fullscreen\n        else if (d._opts.runMode==\"fullscreen\") {\n          $p = $(that.Mode.previewParent||\"body\");\n\n          $p.find(\">*:visible\").each(function(){\n            var $t = $(this);\n            if (\n              !$t.is(\".my-modal\")\n              && !$t.is(\".my-modal-screen\")\n              && !$t.is(\".my-modal-proxy\")\n            ) $t.addClass(\"hide my-manifesto-preview-hide\");\n          });\t\t\n\n          $e = $(\n            '<div class=\"my-manifesto-preview-run db\" '\n            +'style=\"'+that.Mode.fullscreenStyle\n            +';\"></div>'\n          );\n\n          $e.appendTo($p)\n          .my(that.Preview, {\n            _opts:d._opts,\n            _src:that._preview,\n            _prefix:_prefix,\n            _subs:that.Subs,\n            _db:that.db\n          }).fail(function(){\n            cw.lib.note(\"Preview failed to init. \"\n                        +\"See console for details\", \"error\");\n            _kill();\n          }.debounce(50));\n          $e.on(\"cancel.my\", _kill.debounce(50));\n\n        }\n      }\n\n      function _kill (){\n        try {\n          $e.my(\"remove\");\n        } catch (e) {}\n        $e.unbind(\".my\");\n        $e.remove();\n        $p.find(\".my-manifesto-preview-hide\")\n        .removeClass(\"hide my-manifesto-preview-hide\");\n      }\n    }"},"#btn-add": {"bind": "function (d,v,$o) {\n      var that=this;\n      if (v!=null) {\n        if (!$o.data(\"modal\")) $o.modal({\n          manifest:that.NewTab,\n          data:{},\n          esc: true,\n          enter:true,\n          root:that.my.root(),\n          align:\"top:90%;left:0;\",\n          bound:0,\n          // css:\"mt10\", \n          nose:\"top\",\n          screen:'rgba(255,255,255,0.5)'\n        }, function (e){ \n          return !!(e && Object.size(e)) \n        }).then(function(r){\n          $o.my(\"find\",\"#coms\").trigger(\"insert\", {\n            where:1e6,\n            what:r.result\n          });\n          that.TabCollapse();\n        });\n        else $o.modal(true);\n      }\n    }","events": "click.my"},"#btn-compile": {"delay": 50,"bind": "function (d,v,$o) {\n      var that = this;\n      if (v!=null) {\n        if (d._err.length) cw.lib.note(d._err.join(\"<br>\"),\"error\");\n        else {\n          $o.modal({\n            manifest: $.extend({ParseJS:that.ParseJS}, that.Compiler),\n            data:{\n              _src:that._src,\n              opts:d._opts.compileTo,\n              Subs:that.Subs\n            },\n            width:850,\n            esc:true,\n            enter:true,\n            //global:true,\n            screen:'rgba(255,255,255,0.5)',\n            align:\"top:90%;left:-74px\",\n            nose:'top'\n\n          }).then(function(r){\n            d._opts.compileTo=r.opts.slice(0);\n          })\n          .always(function(){\n            that.my.find(\"#warnM\").trigger(\"check\");\n          });\n        }\n      }\n    }"},"#btn-docopts": {"delay": 50,"bind": "function (d,v,$o) {\n      var that = this;\n      if (v!=null) {\n        //console.log(that.RT('data'))\n        var man = that.Opts;\n        $o.modal({\n          manifest: $.extend(true, {}, man),\n          data:$.extend(\n            true, \n            {}, \n            Object.select(d, Object.keys(man.data)),\n            {_tags:(that.RT('data').editor.tags || []).slice(0)}\n          ),\n          width:350,\n          esc:true,\n          css:'pt15',\n          screen:'rgba(255,255,255,0.5)',\n          align:\"top:90%;left:-148px\",\n          nose:'top'\n        })\n        .then(function(r){\n          Object.merge(d, Object.reject(r, ['_tags']));\n          that.RT('data').editor.tags = r._tags || [];\n          that.my.recalc('#coms');\n        });\n      }\n    }","css": {"self:red": "function (d) {\n      \treturn d.title.length < 3 || !/^[A-Z][A-Za-z0-9]{1,24}(\\.[A-Za-z0-9]{1,25}){0,4}$/.test(d.name);\n      }"},"watch": "#coms"},"#btn-close": {"bind": "function (d,v) {\n      if (v!=null) this.my.cancel();\n    }"},"#btn-save": {"bind": "function (d,v) {\n      var that = this;\n      if (v!=null) {\n        that.RT('SaveDoc')();\n      }\n    }"}},"Ed": {"id": "cw.Manifesto.CM","params": {"restyle": 200},"inherit": ["getSearchRe","RTE"],"init": "function ($o,form) {\n    $o.html([\n      '<div style=\"position:absolute;top:7px;right:7px;z-index:+5\">',\n      \t'<button  id=\"btn-opts\" class=\"button fs90\"><span class=\"fi-widget\"></span></button>',\n      '</div>',\n      \n      //'<div id=\"found\" class=\"w200 hide\" style=\"position:absolute;top:10px;right:50px;z-index:+5;\"></div>',\n      '<div id=\"found\" '\n        +'class=\"w300 hide fs80 bg-yellow2 o80 br2 pl6 pr4 gray0 lh150 hoverlink\" '\n        +'style=\"position:absolute;top:5px;right:45px;z-index:+5;\">',\n      '</div> ',\n      '<div><textarea id=\"cm\"></textarea></div>',\n      '<div class=\"warn hide\"></div>'\n    ].join(\"\"))\n    //console.log(form)\n  }","ui": {"#cm": {"bind": "data","init": "function ($o,form) {\n        var that = this,\n            opts = that.Types[form.data.type];\n        \n        CodeMirror.fromTextArea($o[0], {\n          mode:\t\t\t\t\t\topts.CM.mode,\n          lineNumbers:\t\ttrue,\n          indentWithTabs:\tfalse,\n          indentUnit:\t\t\t2,\n          tabSize:\t\t\t\t2,\n          theme: \t\t\t\t\topts.CM.theme || 'default',\n          extraKeys: {\n            'Ctrl-S':\tfunction(){$o.trigger('savemanifest.my');},\n            'Cmd-S':\tfunction(){$o.trigger('savemanifest.my');},\n            'Ctrl-F':\t_setSearch,\n          \t'Cmd-F':\t_setSearch\n          },\n          styleSelectedText:true,\n        \thighlightSelectionMatches: {minChars:3, /*showToken: /\\w/,*/ annotateScrollbar: true}\n        });\n        \n        // - - - - - - - -\n      \n        function _setSearch(){\n          var s = $o[0].nextSibling.CodeMirror.getSelection();\n          if (s.length>2) {\n            that.RTE('data')._search = that.RTE('data')._search==s?'':s;\n            that.my.parent().my.recalc('#tab-search');\n          }\n        }\n      }","delay": 30,"css": {"hide": "function (d) {return !d.active}"}},"#found": {"delay": 200,"init": "function ($o) {\n        var that = this;\n        // highlight and scroll to found line\n        $o.on('click.my','.pseudolink', function(){\n          var line = +$(this).text(),\n              ed = that.my.find('#cm').next()[0].CodeMirror;\n\n          ed.scrollIntoView({line:line, char:1}, 48);\n\n          var f = function(){\n            ed.addLineClass(line-1,'background','bg-yellow4');\n            (function(){\n              ed.removeLineClass(line-1,'background','bg-yellow4');\n            }.debounce(100))()\n          };\n\n          f.debounce(100)();\n          f.debounce(300)();\n        });\n      }","bind": "function (d) {\n        var that = this,\n            re = that.getSearchRe(),\n            lines = [];\n        if (re && d.active) {\n          d.data.lines().forEach(function(l, i){\n            if (re.test(l)) lines.push(i+1);\n          });\n          if (lines.length) {\n            return '<div class=\"pt4 pb4\"><span class=\"fi-magnifying-glass fs90 o70\"></span> Found @ '+lines.map(function(e){\n              return '<span class=\"pseudolink\">'+e+'</span>';\n            }).join(', ')+'</div>';\n          }\n        }\n        return '';\n      }","css": {"hide": "function () {return !this.getSearchRe();}"},"watch": "#cm"},"#btn-opts": {"bind": "function (d,v,$o) {\n        if (null!=v) {\n          $o.modal({\n            manifest: Object.merge(\n              this.NewTab,\n              {\n                Opts:{apply:\"Save\", title:\"Tab settings\", del:\"Del tab\"},\n                style:{\" #xtype\":\"display:none;\"}\n              }\n            ),\n            data:{result:Object.clone(d,true)},\n            width:400,\n            align:\"top:0px,right:0px\", css:\"fs90\", xnose:\"top\"\n          }).then(function(r){\n            if (r.op === \"Del\") {\n              $o.trigger(\"removetab\", d);\n              //$o.trigger(\"remove\");\t\n            } else if (r.op === \"Save\") {\n              Object.merge(d, Object.reject(r.result, [\"data\",\"stamp\",\"type\"]));\n              $o./*my(\"find\",\".warn\").*/trigger(\"change\");\n            }\n          }.debounce(50));\n        }\n        //if (d.id.to(1)!==\".\") $o.addClass(\"hide\");\n      }"},".warn": {"bind": "function (d,v,$o) {\n        var  row = d, ext = {}, ins={}, err=[];\n\n        var $r, cmp = this.Types[d.type].compile,\n            a = cmp?cmp(d.data):[[], d.data],\n            err=a[0].slice(0);\n\n        if ((d.err||[]).length!=err.length) {\n          d.err = err;\n          $o.trigger(\"change\");\n        }\n        else d.err = err;\n        $r = $o.my().root;\n        $r.toggleClass(\"hide\", !d.active);\n        $r.toggleClass(\"ed-error\", !!err.length);\n\n      }","watch": "#cm","delay": 70}},"style": {" #btn-opts": "border-radius:100px;padding:5px 7px;transition: opacity 0.3s;opacity:0.5;margin:0px!important;line-height:0.95em;"," #btn-opts:hover": "opacity:1;"," .CodeMirror ": "function ($o) {\n      var ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n          pad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n          tab = 0, //$o.parents(\".my-manifest-1a9u4bgu\").find(\"#coms\").outerHeight(true),\n          css = \"height:\"+($(window).height()-(pad+ofs+tab+15))+\"px;\";\n      return css;\n    }"}},"Tab": {"id": "Manifest.Editor.Tab","inherit": ["getCollapsed","ParseJS","RT","getSearchRe"],"Colors": {"blue": ["rgb(14, 85, 163)","rgba(142, 211, 255, 0.25)"],"red": ["#A3293D","rgba(255, 200, 200, 0.75)"],"green": ["rgb(75, 129, 1)","#E3F3CB"],"teal": ["#07AB8F","rgba(198, 252, 234, 0.67)"],"orange": ["#F77400","rgb(255, 227, 185)"],"violet": ["rgba(109, 37, 179, 0.9);","rgba(210, 142, 255, 0.25);"]},"ui": {"#xtitle": {"bind": "function (d,v,$o) {\n        var that = this,\n            Coll=false,\n            clr = d.color?d.color+\"\":\"\",\n            colors = that.Colors;\n        if (clr) {\n          $o.css({ color:colors[clr][0] });\n          if (d.active) { $o.css({ \"background-color\":colors[clr][1] }); } \n          else { \t$o.css({ \"background-color\":\"\" }); }\n        }\n        else $o.css({ color:\"\", \"background-color\":\"\" });\n\n        $o.css({opacity:d.active?\"1\":\"0.7\"});\n      }","css": {"active": "function (d) { return d.active }","bold fs105": "function (d) { return (d.id||\"\").to(1)!==\".\"}","itl": "function (d) { return (d.opts||[]).indexOf(\"nocompile\")>-1}","haserror": "function (d) {return d.err && d.err.length}"},"watch": "#title"},".fold": {"bind": "function (d,v,$o) {\n        var that = this, \n            $p, re, found = true,\n            html=\"\";\n\n        if (v==null) {\n          $p =that.my.root();\n          re = that.getSearchRe();\n\n          if (re) {\n            if (!re.test(d.id) && !re.test(d.data)) {\n              found = false;\n              html = '';\n            }\n            $p.toggleClass(\"w00\", !found);\n          }\n          else {\n\t\t\t\t\t\tfound = false;\n            that.getCollapsed()\n            .forEach(function(e){\n              if (d.id==e[0]) {\n                html = e[1] ? '<span class=\"fs120\">▸</span>'+e[2] : '<span class=\"fs120\">▾</span>'+e[2];\n              }\n              else if (d.id.startsWith(e[0]+\".\")) {\n                var folded = !!$p.is(\".w00\");\n                $p.toggleClass(\"w00\", !!e[1] && !d.active);\n                found = true;\n                if (folded) {\n                  $p.css({\"background-color\":\"rgba(255,240,0,0.5)\"});\n                  (function(){$p.css({\"background-color\":\"rgba(255,255,255,0)\"});}).delay(150);\n                }\n              }\n            });\n            if (!found) $p.removeClass(\"w00\");\n          }\n          return html;\n        }\n        else return v;\n      }"},"#title": {"bind": "function (d,v,$o) {\n        var that = this;\n        if (null != v) {\n          if (!d.active) $o.trigger(\"switch\", d);\n          else if (d.err && d.err.length) {\n            var e = that.ParseJS(\"(\"+d.data+\")\");\n            d.err = e.errors;\n            $o.modal({\n              root:$o.my().root.parents(\".my-form\").eq(0),\n              width:250,\n              nose:\"top\",\n              bound:0,\n              align:\"top:120%;\",\n              esc:true,\n              enter:true,\n              manifest:{\n                init:['<span id=\"t\" class=\"red o80 fs85 lh150\"></span><input type=\"text\" class=\"di fs50 o0 w00 mt0 mb0\"/>'],\n                ui:{\"#t\":\"t\",\"input\":\"x\"}\n              },\n              data:{t:e.errors.join(\"<br>\")},\n              screen:'rgba(255,255,255,0.5)'\n            })\n          }\n        }\n        var s = (d.id == 'Root'?that.RT('data').editor.raw.title:'') || d.id,\n            sl = s.replace(/[^\\.]/g,'').length;\n        if (sl>1) {\n          var hasParent = (that.getCollapsed() || []).find(function(e){\n          \treturn d.id.startsWith(e[0]+\".\");\n          });\n          if (hasParent) s = ('\\u00a0').repeat(sl*2-2)+s;\n        }\n        s+='\\u00a0';\n        \n        if (d.type == 'js' && d.data.to(2)=='//') {\n          var comments = d.data.split(/[\\r\\n]/, 10);\n          s += '<span class=\"gray0 fs90 o60 pl8\" title=\"{1}\">{2}</span>'.assign(\n            comments.filter(e=>/^\\s*\\/\\//.test(e)).map(e=>e.to(100).trimLeft().escapeHTML()).join('\\n'),\n            comments[0].truncate(50,'right','…').escapeHTML()\n          );\n        }\n        \n        return s;\n      }","events": "click.my","init": "function ($o,form) {\n        var d = form.data;\n        $o.parent().parent().find(\".ctype\")\n        .addClass(this.Types[d.type].css||\"hide\");\n      }"}}},"NewTab": {"params": {"width": 350},"Opts": {"apply": "Create","title": "New tab"},"data": {"root": {},"result": {"stamp": 0,"id": "","type": "js","data": "","active": false,"err": [],"opts": [],"color": []},"op": "Save"},"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML);\n\t\tform.data.result.stamp = form.data.result.stamp || (Date.now()+\"\");\n\t}","ui": {"#tabid": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (d.result.type==\"js\") d.result.data = \"({\\n\\n})\";\n\t\t\t\t\tif (d.result.type==\"html\") d.result.data = \"<div>\\n\\n</div>\";\n\t\t\t\t\td.result.id=v;\n\n\t\t\t\t}\n\t\t\t\treturn d.result.id;\n\t\t\t}","check": "new RegExp(/^(\\.[^\\.\\s\\t\\r\\n]+)+\\.?$/i)","error": "Branch name like .Branch or .Branch.Leaf","delay": 100},"#type": {"bind": "result.type","init": "function ($o) {\n        $o.select2({\n        \tminimumResultsForSearch:1e4\n        });\n\t\t\t}","watch": "#tabid"},"#ncolor": {"init": "function ($o) {\n\t\t\t\tvar clr = [\n\t\t\t\t\t{'<span class=\"blue\">✪</span>':'blue'},\n\t\t\t\t\t{'<span class=\"red\">✪</span>':'red'},\n\t\t\t\t\t{'<span class=\"orange\">✪</span>':'orange'},\n\t\t\t\t\t{'<span class=\"green\">✪</span>':'green'},\n\t\t\t\t\t{'<span class=\"teal\">✪</span>':'teal'},\n\t\t\t\t\t{name:'<span>✪</span>', value:'violet', css:\"violet\"}\n\t\t\t\t];\n\t\t\t\t$o.tags({tags:[clr], tagshim:\"\", tagcss:\"tag pt3 pl4 pb2 pr6 lh100 cp\"});\n\t\t\t}","bind": "result.color"},"input[name=\"opts\"]": "result.opts","#btn-cancel": "function (d,v,$o) {\n\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t}","#btn-apply": "function (d,v,$o) {\n\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\treturn this.Opts.apply;\n\t\t}","#btn-del": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.op = \"Del\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn this.Opts.del||\"\";\n\t\t\t}","css": {"hide": "function () {return !this.Opts.del}"}},"#title": "this.Opts.title"},"HTML": ["<h3 class=\"mb0\" id=\"title\"></h3>",{"row": "100%","label": "70px","rowCss": "my-row pt10 pb2","labelCss": "xgray fs85 lh110"},["","inp#tabid.fs120",{"plc": "Property name"},"msg"],["Type","<span id=\"xtype\" class=\"mr20\">","sel#type.w140.mt-3",{"vals": ["js","html","text","css"]},"</span><span>","<label class=\"fs90 xgray dib\">","<input type=\"checkbox\" value=\"nocompile\" name=\"opts\"/>"," Preview only</label>"],["Tab color","<span id=\"ncolor\" class=\"fs110 lh110\"></span>"],{"rowCss": "my-row mt10 pt10 btd fs90"},["","btn#btn-apply.green.mr5",{"val": "Create tab"},"<span class=\"fr\">","btn#btn-del.red.mr0",{"val": "Delete"},"</span>","btn#btn-cancel",{"val": "Cancel"}]],"style": {}},"Compiler": {"init": "function ($o) { \n\t\t$o.formgen(this.HTML); \n\t}","About": {},"Stats": 0,"ui": {"#opts": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tjsmin = cw.lib.jsmin, \n\t\t\t\t\t\ttoj = $.my.tojson;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tvar i = cw.lib.a2o(v),\n\t\t\t\t\t\t\t//_src = d._src;\n\t\t\t\t\t\t\t_src;\n\t\t\t\t\t\n\t\t\t\t\tif (i.childs) {\n\t\t\t\t\t\t//_src = \"(\"+cw.lib.js2txt($.extend(!0, eval(d._src), d.Subs()),'\\t')+\")\";\n\t\t\t\t\t\t_src = \"(\"+cw.lib.js2txt($.extend(!0, cw.lib.unjson(d._src), d.Subs?d.Subs():{}),'\\t')+\")\";\n\t\t\t\t\t} \n\t\t\t\t\telse {\n\t\t\t\t\t\t_src = \"(\"+cw.lib.js2txt(cw.lib.unjson(d._src),'\\t')+\")\";\n\t\t\t\t\t}\n\t\t\t\t\t//else _src = d._src;\n\t\t\t\t\t\n\t\t\t\t\tif (i.json) d.src = toj(eval(_src), '\\t');\n\t\t\t\t\telse if (i.cjson) d.src = toj(eval(jsmin(_src)));\n\t\t\t\t\telse if (i.jsmin) d.src = jsmin(_src);\n\t\t\t\t\telse if (i.uglify) {\n\t\t\t\t\t\t// compress and uglify \n\t\t\t\t\t\tvar u = UglifyJS,\n\t\t\t\t\t\t\t\tast = u.parse(_src);\n\t\t\t\t\t\tast.figure_out_scope();\n\t\t\t\t\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\t\t\t\t\tast.figure_out_scope();\n\t\t\t\t\t\t// No char freq opt to avoid \n\t\t\t\t\t\t// different results from the same code\n\t\t\t\t\t\t//ast.compute_char_frequency();\n\t\t\t\t\t\tast.mangle_names();\n\t\t\t\t\t\td.src = ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>').replace(/;$/,'');\n\t\t\t\t\t}\n\t\t\t\t\telse d.src=_src;\n\t\t\t\t\t\n\t\t\t\t\tthis.Stats = unescape(encodeURIComponent(d.src)).length;\n\t\t\t\t\tthis.About = this.ParseJS(\"(\"+(i.json||i.cjson?_src:d.src) +\")\", true);\n\n\t\t\t\t\td.opts = v;\n\t\t\t\t\tif (!d.opts.length || d.opts+\"\"==\"childs\") d.opts.push(\"js\");\n\t\t\t\t}\n\t\t\t\treturn d.opts;\n\t\t\t}","init": "function ($o,form) {\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{\"JS object\":\"js\"},\n\t\t\t\t\t\t\t{\"JS min\":\"jsmin\"},\n\t\t\t\t\t\t\t{\"JS ugly\":\"uglify\"},\n\t\t\t\t\t\t\t{\"JSON\":\"json\"},\n\t\t\t\t\t\t\t{\"JSON min\":\"cjson\"}\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{\"Include childs\":\"childs\"}\n\t\t\t\t\t\t]\n\t\t\t\t\t], \n\t\t\t\t\tgroupshim:' &nbsp;<span class=\"orange\">|</span>&nbsp; '\n\t\t\t\t})\n\t\t\t}"},"#critic": {"bind": "function (d,v,$o) {\n\t\t\t\tvar a=[];\n\t\t\t\ta.push( '<span class=\"gray fs90 w90 dib\">Globals</span> '+((this.About.globals||[]).join(\", \")||\"—\") );\n\t\t\t\treturn a.join(\"<br>\");\n\t\t\t}","watch": "#opts"},"#src": {"init": "function ($o) {\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode:\"javascript\",\n\t\t\t\t\tlineNumbers:\t\ttrue,\n\t\t\t\t\tindentWithTabs:\tfalse,\n\t\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\t\ttheme:\t\t\t\t\t'default',\n\t\t\t\t\treadOnly:\t\t\t\ttrue,\n\t\t\t\t\tlineWrapping:\t\ttrue\n\t\t\t\t});\n\t\t\t}","bind": "src","watch": "#opts"},"#stats": {"bind": "function () {\n\t\t\t\treturn \"Code is \"+(this.Stats||0).bytes(2)+\" long.\"\n\t\t\t}","watch": "#opts"},"#btn-apply": "function (d,v,$o) {if (null!=v) $o.trigger(\"commit\");}","#btn-cancel": "function (d,v,$o) {if (null!=v) $o.trigger(\"cancel\");}"},"style": {" .CodeMirror": "font:13px Cousine,'PT Mono',Monaco,monospace;overflow:scroll; height:300px;line-height:1.3em;border:1px solid #cde;"},"HTML": ["<div id=\"stats\" class=\"fs80 gray fr mt3\"></div>","<h3 class=\"dib vat mt0 mb15\">Compiler</h3>","<div class=\"fs85 ml20 dib vat mt3\">","<span id=\"opts\"></span>","</div>","<div><textarea id=\"src\"></textarea></div>",{"rowCss": "my-row pt15 fs90 fr"},["","btn#btn-apply.green.mr5",{"val": "Remember mode"},"btn#btn-cancel",{"val": "Cancel"}],"<div id=\"critic\" class=\"w600 fs80 lh130 dib vat mt15 xgray\"></div>"]},"Preview": {"id": "cw.Manifesto.Preview","data": {"_runtime": {}},"init": "function ($o,form) {\n\t\tvar d = form.data, \n\t\t\t\tp = d._opts, \n\t\t\t\tm = d._src,\n\t\t\t\tpi = $.Deferred();\n\t\t\n\t\ttry {\n\t\t\tthis.Manifest = $.extend({db:d._db},(d._prefix||{}),eval(d._src));\n\t\t\t$.extend(!0, this.Manifest, d._subs());\n\t\t} catch (err){\n\t\t\tconsole.log(err, err.stack)\n\t\t\tpi.reject(err);\n\t\t}\n\n    pi.then(function(){\n    \t$o.trigger('layout.my');\n    });\n\t\t\n\t\t$o.html(\n\t\t\t'<div id=\"btn-close\" class=\"'\n\t\t\t+(p.runMode==\"modal\"?\"hide\":\"\")\n\t\t\t+'\">×</div>'\n      +'<div id=\"app-editor-preview-drag\"></div>'\n\t\t\t+'<div id=\"'+p.runId+'\" class=\"app-editor-preview '\n\t\t\t+p.runCss+'\" style=\"margin:0 auto;width:'\n\t\t\t+d._opts.runWidth+'px\"></div>'\n\t\t);\n\t\tpi.resolve();\n\t\t\n\t\treturn pi.promise();\n\t}","ui": {"#btn-close": {"bind": "function (d,v,$o) {\n\t\t\t\tif (null!=v) {\t\t\t\t\t\n\t\t\t\t\tif (/^(full|modal)/.test(d._opts.runMode+\"\")) {\n\t\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t\t} \n\t\t\t\t}\n\t\t\t}","events": "click.my"},">.app-editor-preview:eq(0)": {"bind": "_runtime","manifest": "Manifest"}},"style": {">#app-editor-preview-drag": "width:100%;height:15px;cursor:move;",">#btn-close": "position:absolute;top:0;right:0;cursor:pointer;z-index:+100;font-size:50px;line-height:1em; padding:0 10px;transition:color 0.3s; color:rgba(0,0,0,0.2);",">#btn-close:hover": "color:#c02"}},"Opts": {"data": {"_tags": [],"_type": ["manifest"],"_cmd": [],"_src": "","_desc": "","_opts": {"compileTo": ["js"],"runWidth": "1024","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"name": "","version": "1","build": "","timeout": "3000","title": "","author": "","pic": "","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"padding": "auto"},"inherit": ["RT"],"IsApp": "function (d) { return !(d._type.indexOf(\"app\")<0 && d._type.indexOf(\"editor\")<0);}","IsEd": "function (d) { return !(d._type.indexOf(\"editor\")<0);}","init": "function ($o) {\n    var that = this;\n\t\t$o.formgen(this.HTML);\n    $o.then((function(){\n    \tthat.my.check('#type');\n    }).debounce(50))\n\t}","ParseRange": "function (s0) {\n    var ok = true,\n        s = s0.compact(true).split(/[\\s,]/).compact(true).map(function(v){\n          if (/-/.test(v)) {\n            var a = v.split('-').map(Number).compact(true);\n            if (a.length!=2) ok = false;\n            return a;\n          }\n          else {\n          \tvar n = +v;\n            if (isNaN(n)) ok = false;\n            return n;\n          }\n        });\n    if (!ok) return null;\n    return s;\n  }","HTML": ["<div class=\"w350 dib vat\">",{"row": "100%","label": "75px","rowCss": "my-row pt0 pb5","labelCss": "fs85 gray"},["","inp#title.w100p.fs110",{"plc": "Component title"}],["","<div class=\"dib vat w65p\">","inp#name.w100p",{"plc": "IdName"},"</div>","<div class=\"pl5 dib vat w15p\">","inp#ver.w100p",{"plc": "Ver"},"</div>","<div class=\"pl5 dib vat w20p\">","inp#build.w100p",{"plc": "Build"},"</div>"],["","txt#desc.fs80.w100p",{"plc": "Short description"},"msg"],["","inp#mtags.fs100.w100p","msg"],{"rowCss": "my-row pt0 pb8"},["Type","spn#type.fs90"],["Padding","spn#padding.fs90"],{"rowCss": "my-row pt0 pb5"},["Preview","num#runwidth.fs90.w65",{"min": "300","max": "3000","step": "10"},"<span class=\"gray fs90\"> px &nbsp;</span>","spn#runmode.fs90"],"<div id=\"xpreview\" class=\"w200 oh ha pr20 pt3\" style=\"max-height:125px\">","<img id=\"ico\" src=\"\" class=\"fr hide br2 ml9\" style=\"max-width:32px;max-height:32px;\"/>","<img id=\"pic\" src=\"\" class=\"fr hide br2 mb10\" style=\"max-width:64px;max-height:64px;\"/>","<span id=\"btn-addpic\" class=\"fs85 pseudolink dib vat lh120 tdn\">Add component icon...</span>","</div>","</div>","<div id=\"isapp\" class=\"w360 pl10 ml10 dib vat pb5\" style=\"border-left:1px dotted #bdd3e6;\">",{"rowCss": "my-row pt0 pb5","label": "80px"},["State mask","txt#maskstate.fs80",{"plc": "String reference or JSON obj/array mask"},"msg"],["Title node","inp#nodetitle.fs90",{"plc": "Like item.title"},"msg"],["Widths","inp#width.fs90",{"plc": "Like 800,1200"},"msg"],["Timeout","inp#timeout.fs90.w70",{"plc": "Start in"},"<span class=\"gray fs90\"> ms</span>"],"<div id=\"iseditor\">",["Doc node","inp#nodedoc.fs90.w100p","msg"],["Cmd node","inp#nodecmd.fs90.w100p","msg"],{"rowCss": "my-row pt7"},["","spn#btn-addcmd.pseudolink.fs85.tdn",{"txt": "Add type/command..."}],["","<div id=\"cmd\" class=\"w100p\"></div>"],"</div>","</div>",{"rowCss": "my-row mt0 pt10 btd fs90"},["","btn#btn-apply.w120.tac.mr5.green",{"val": "Apply"},"btn#btn-cancel.w120.tac",{"val": "Cancel"}]],"ui": {"#type": {"bind": "function (d,v) {\n      var that = this,\n          width = 350;\n      if (v!=null) d._type = v;\n\n      if (d._type.indexOf('app')>-1 || d._type.indexOf('editor')>-1) width = 721;\n\n      var modal = that.my.root().parent().data('modal');\n\n      if (modal && modal.width != width) {\n        that.my.root().parent().data('modal').width = width;\n        that.my.root().trigger('layout');\n      }\n\n      return d._type;\n    }","init": "function ($o) {\n      $o.tags({\n        tags:[[ {\"App\":\"app\"},{\"Editor\":\"editor\"}],{\"<i>&beta;eta</i>\":\"beta\"} ], \n        empty:{\"Manifest\":\"manifest\"}\n      });\n    }"},"#mtags": {"init": "function ($o) {\n    \t$o.select2({\n        tags:this.RT('db')&&Object.isFunction(this.RT('db').tags)?this.RT('db').tags():[],\n        minimumResultsForSearch:15,\n        placeholder:'Manifest tags'\n      });\n    }","bind": "_tags"},"#padding": {"init": "function ($o) {\n      $o.tags({\n        tags:[[ {\"No pad\":\"none\"},{\"Fullscreen\":\"fullscreen\"}]], \n        empty:{\"Auto\":\"auto\"}\n      });\n    }","bind": "function (d,v) {\n      if (v==null) return [d.padding];\n      d.padding = v+'';\n      return v;\n    }","watch": "#type","css": {"hide": "function (d,v) { return d._type.indexOf('manifest')>-1;}"}},"#title": {"bind": "title","check": "function (d,v) {\n\t\t\tvar t=v.compact();\n\t\t\tif (t.length<3) return \"Enter title\";\n\t\t\tif (t.length>50) return \"Too long!\";\n\t\t\treturn \"\";\n\t\t}"},"#name": {"bind": "function (d,v) {\n\t\t\tif (v!=null) d.name=v.to(1).toUpperCase()+v.from(1);\n\t\t\treturn d.name;\n\t\t}","check": "function (d,v) {\n\t\t\tif (!/^[A-Z][A-Za-z0-9]{1,24}(\\.[A-Za-z0-9]{1,25}){0,4}$/.test(v)) return \"Like App.Some.Ext\";\n\t\t\tif (v.to(1).toUpperCase() !== v.to(1)) return \"First – cap\";\n\t\t\tif (v.length>129) return \"Too long\";\n\t\t\treturn \"\";\n\t\t}"},"#ver": {"bind": "version","check": "new RegExp(/^(|[0-9][a-z0-9\\.]{0,5})$/)","error": "Like 12 or 5.6.8"},"#build": {"bind": "build","check": "new RegExp(/^(|\\d{1,5})$/)","error": "Number"},"#desc": {"bind": "_desc","check": "new RegExp(/^.{0,140}$/)","error": "<i>Short</i> desc, please"},"#btn-addpic": {"bind": "function (d,v,$o) {\n      var that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t//console.log($o, $o.data(), this)\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:'cw.Sys.Cropper.Square',\n          data:{data:'', filename:'', size:256, png:true, allowSVG:true}\n\t\t\t\t})\n        .then(function (crop) {\n          if (!crop || !crop.data) return;\t\n\n          var I = new Image();\n          I.src = 'data:' + crop.mime + ';base64,' + crop.data;\n          I.onload = function(){\n            var img = cw.lib.image(I);\n            try {\n\n              if (crop.mime == 'image/svg+xml') d.pic = I.src;\n              else d.pic = img.resample(128).sharpen(0.2).png(true);\n              d.ico = img.resample(64).brightness(1.05).contrast(1.05).sharpen(0.5).png();\n              that.my.recalc('#pic');\n              that.my.recalc('#ico');\n            }\n            catch(e){console.log(e)}\t\t\t\t\t\t\t\t\n            crop.data = '';\n            $o.html('Change image...').addClass('w75');\n          }\n        });\n\t\t\t}\n\t\t\tif (d.pic) $o.html('Change image...').addClass('w75');\n\t\t}","events": "click.my"},"#pic": {"bind": "pic","css": {"hide": "function (d) {return !d.pic.length}"}},"#ico": {"bind": "ico","css": {"hide": "function (d) {return !d.ico.length}"}},"#isapp": {"bind": "function () {}","css": {"hide": "function (d) {return !this.IsApp(d)}"},"watch": "#type","delay": 50},"#iseditor": {"bind": "function () {}","css": {"hide": "function (d) {return !this.IsEd(d);}"},"watch": "#type"},"#maskstate": {"delay": 50,"bind": "maskstate","check": "function (d,v) {\n      //v must be ref or json array or obj\n      var t=v.compact(), obj;\n      if (!this.IsApp(d) || this.IsEd(d)) return \"\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      if (/^[\\[\\{]|[\\}\\]]$/.test(t)){\n        try{\n          obj=JSON.parse(t);\n        } catch(e) {}\n        if (!obj) return \"Invalid JSON\";\n        if (Object.isArray(obj)) {\n          if (!obj.length) return \"At least one elt\";\n          for (var i=0;i<obj.length;i++) if (!Object.isString(obj[i])) return \"Only strings in array\";\n          if (obj.length!==obj.unique().length) return \"Array has dupes\";\n        } else if (Object.isObject(obj)) {\n          if (!Object.keys(obj).length) return \"Mask is empty\"\n            } else return \"Invalid JSON type\";\n      } \n      return \"\";\n    }","watch": "#type","css": {"hide": "function (d) {return this.IsEd(d)}"}},"#timeout": {"bind": "timeout","check": "function (d,v) {\n      if (!this.IsApp(d)) return \"\";\n      if (!/^\\d{1,5}$/.test(v)) return \"Num, 0 to 99K\";\n      return \"\";\n    }","watch": "#type"},"#width": {"bind": "function (d,v,$o) {\n      var that = this;\n      if (v!=null) {\n        d.width = that.ParseRange(v) || d.width;\n        return v;\n      }\n      return d.width.map(e=>Object.isArray(e)?e.join('-'):e).join(' ');\n    }","check": "function (d,v) {\n      if (this.IsApp(d) && !this.ParseRange(v)) return \"Num list like 100,300-500,800 required\";\n      return '';\n    }","watch": "#type"},"#nodetitle": {"bind": "nodetitle","check": "function (d,v) {\n      if (!this.IsApp(d)) return \"\";\n      var t=v.compact();\n      if (!t.length && this.IsEd(d)) return \"Data field to map as app title\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      return \"\";\n    }","watch": "#type"},"#nodedoc": {"bind": "nodedoc","check": "function (d,v) {\n      if (!this.IsEd(d)) return \"\";\n      var t=v.compact();\n      if (!t.length) return \"Field to map doc object to edit\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      return \"\";\n    }","watch": "#type"},"#nodecmd": {"bind": "nodecmd","check": "function (d,v) {\n      if (!this.IsEd(d)) return \"\";\n      var t=v.compact();\n      if (!t.length) return \"Field to map editor command\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      return \"\";\n    }","watch": "#type"},"#cmd": {"bind": "_cmd","manifest": "TypeLine","check": true,"watch": "#btn-addcmd"},"#btn-addcmd": {"bind": "function (d,v) {\n      if (v!=null) {\n        d._cmd.push(Object.clone(this.TypeLine.data,true));\n      }\n    }","events": "click.my"},"#btn-cancel": "function (d,v) {if (v!=null) this.my.cancel();}","#runwidth": "_opts.runWidth","#runmode": {"bind": "_opts.runMode","init": "function ($o) {\n      $o.tags({\n        tags:[[\n          //{\"Inline\":\"inline\"},\n          {\"Fullscreen\":\"fullscreen\"}\n        ]], \n        empty:{\"Modal\":\"modal\"}\n      })\n    }"},"#btn-apply": {"bind": "function (d,v) {if (v!=null) this.my.commit();}","css": {":disabled": "function (d,v) {\n      \treturn !this.my.valid();\n      }"},"watch": ["#type","#title","#name","#desc","#maskstate","#nodetitle","#width","#nodedoc"]}},"TypeLine": {"data": {"type": "","actions": []},"init": [{"row": "100%","rowCss": "my-row pb7"},["","<div class=\"w80 dib vat\">","inp#type.w75.fs90.vat.dib.pt3.pb5",{"plc": "Type"},"</div><div class=\"dib vat\" style=\"width:calc(100% - 80px);\">","inp#actions.w100p.fs95",{"plc": "Actions"},"</div>"]],"ui": {"#type": {"bind": "function (d,v) {\n        if (v!=null) d.type=(v+\"\").replace(/[^a-z0-9\\*]/ig,\"\");\n        return d.type;\n      }"},"#actions": {"bind": "actions","init": "function ($o) {\n        $o.select2({tags:[\"create\",\"edit\",\"view\",\"comment\",\"hide\",\"copy\",\"move\",\"delete\"]});\n      }"}}}},"Types": {"html": {"CM": {"mode": "manhtml","theme": "base16-light"},"css": "fi-html5","compile": null},"text": {"CM": {"mode": ""},"compile": null},"js": {"CM": {"mode": "manjs"},"compile": "function (s) {\n\t\t\tvar err=[], res = null;\n\t\t\ttry {\n\t\t\t\t// Eval is unsafe and resource-consuming\n\t\t\t\t//res = eval(s);\n\t\t\t\t\n\t\t\t\t// More safe way\n\t\t\t\tres = (new Function (\"\", \"return (\"+s+\");\"))();\n\n\t\t\t} catch (e) {\n\t\t\t\terr.push(e.message+\".\");\n\t\t\t}\n\t\t\treturn err.length?[err, undefined]:[err,res];\n\t\t}"},"css": {"CM": {"mode": "mancss","theme": "base16-light"},"css": "fi-css3","compile": "function (css) {\n\t\t\tvar err=[], res=\"\";\n\t\t\tres = ((css+\"\")\n\t\t\t.replace(/\\/\\*[\\s\\S]+?\\*\\//gm,\"\")\n\t\t\t.replace(/@charset[^;]+?;/gim,'')\n\t\t\t.replace(/[\\n\\t\\s]+/g,' ')\n\t\t\t.replace(/\\}/g,'}⊻')\n\t\t\t.replace(/^\\n+/g,\"\").replace(/[\\n\\s]+$/g,\"\")\n\t\t\t.split('⊻')\n\t\t\t.compact(true)\n\t\t\t.reduce(function(a,b){\n\t\t\t\tvar t = b.trim(), p, k, v;\n\t\t\t\tif (/^[^{]+\\{[^\\}]+\\}$/.test(t)) {\n\t\t\t\t\tp = t.to(-1).split(\"{\");\n\t\t\t\t\tk = \" \"+p[0].trim();\n\t\t\t\t\tv = p[1].trim();\n\t\t\t\t\tif (v.last()!=\";\") v+=\";\";\n\t\t\t\t\tif (!a[k]) a[k]=\"\";\n\t\t\t\t\ta[k]+=v;\n\t\t\t\t} else {\n\t\t\t\t\terr.push(\"Invalid rule \"+t.truncate(40));\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\t},{}));\n\t\t\treturn [err, res];\n\t\t}"}},"NewAppSrc": "({\n\tparams:{},\n\tdata:{\n\t\t// Data to bind with controls,\n\t\t// freeform like \n\t\t// { type:\"box\", size:{x:\"7\", y:\"5\"}, count:\"6\" }\n\t},\n\tinit: function ($o) {\n\t\t// Init function, executed before controls init.\n\t\t// Renders ui skeleton and prepares data if needed.\n\t\t// Any init function can return promise to become async.\n\t},\n\tui:{\n\t\t/*\n\t\t\"#someControl\":{\n\t\t\tbind:\"size.x\",\n\t\t\tcheck:/someRegexp/\n\t\t}, ...\n\t\t*/\n\t},\n\tstyle:{\n\t\t/*\n\t\t// Creates runtime stylesheet with rules\n\t\t// selective for manifest, like\n\t\t\t\" .red\":\"color:red\",\n\t\t\t\" .item\":{\n\t\t\t\t\" .red\":\"color:#c02\"\n\t\t\t}\n\t\t*/\n\t}\n})"}},"raw": {"name": "Manifest","title": "App Editor","version": "2.4","build": 89,"com": [{"stamp": "1427389971106","id": "Root","type": "js","data": "({\n\t\n\t// jQuery.my Manifest editor \n\t// (c) 2018 ermouth\n\t\n\tVersion:'3.0',\n\tparams:{delay:50, restyle:200},\n  data:{\n    cmd:\"\",\n    editor:{\n      _id:\"\",\n      name:\"\",\n      title:\"\",\n      type:\"manifest\",\n      desc:\"\",\n      beta:false,\n      tags:[],\n      manifest:{\n        app:{}\n      },\n      raw:{\n        name:\t\t\t'', \n        title:\t\t'',\n        version: \t'0',\n        build: \t\t1,\n        com:\t\t\t[],\n        pic:\t\t\t'',\n        _type:\t\t['manifest'],\n        _err:\t\t\t[], \n        _search:\t'',\n        _cmd:\t\t\t[],\n        _opts:{\n          compileTo:[\"js\"], runWidth:\"800\", runMode:[\"modal\"],\n          runCss:\"\", runId:\"manifest-preview\"\n        }, \n        _src:''\n      },\n      log:[]\n    },\n    err:[]\n  },\n\tui:{},\n  RT: function(key){\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t},\n\tPostfix:{},\n\tSubs:{},\n\tSide:{/* See tab */},\n\tdie: function($o){\n\t\t$o.find('#tlist').getNiceScroll().remove();\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1511343969214","id": ".data.editor.raw.com","type": "js","data": "([\n\t{\n    \"stamp\": \"1503524553992\",\n    \"id\": \".Req\",\n    \"type\": \"js\",\n    \"data\": \"// Demo comment which is reflected to components list\\n(function _Req(opts0){\\n\\n\\tvar isS = Object.isString,\\n\\t\\t\\tisO = Object.isObject,\\n\\t\\t\\tisA = Object.isArray;\\n\\n\\tvar that = this,\\n\\t\\t\\td = that.data,\\n\\t\\t\\tcfg = that.Cfg,\\n\\t\\t\\tl = that.lang,\\n\\t\\t\\tpi = $.Deferred();\\n\\n\\tvar opts = $.extend(\\n\\t\\ttrue, \\n\\t\\t{\\n\\t\\t\\tmethod:'GET',\\n\\t\\t\\tdataType:'json',\\n\\t\\t\\theaders:{ Accept:'application/json' },\\n\\t\\t\\tcache:false\\n\\t\\t},\\n\\t\\tisO(opts0)?opts0:isA(opts0)?{url:opts0}:{url:opts0+''}\\n\\t);\\n\\n\\tvar url = a2url(opts.url, that.Base);\\n\\n\\tif (!url) E(400, l.ERR_REQ_INVALIDCALL);\\n\\t\\n\\topts.url = url;\\n\\t\\n\\t$.ajax(opts)\\n\\t.then(function(res){\\n\\t\\tpi.resolve(res);\\n\\t})\\n\\t.fail(function(res, b){\\n\\t\\tvar data;\\n\\t\\ttry {data = JSON.parse(res.responseText);} catch(e){}\\n\\t\\tif (!Object.isObject(data)) data = {};\\n\\t\\tdata.ok = false;\\n\\t\\tvar code = res.status,\\n\\t\\t\\t\\tmsg = data.reason || data.message || '';\\n\\t\\tE(code, msg, data);\\n\\t});\\n\\n\\treturn pi.promise();\\n\\n\\t// - - - - - - -\\n\\n\\tfunction E(code0, msg0, data) {\\n\\t\\tvar code = !isNaN(code0)?(+code0):500,\\n\\t\\t\\t\\tmsg = (isNaN(code0) && !msg0)?code0:msg0;\\n\\t\\tif (!msg) {\\n\\t\\t\\tmsg = l.ERR_REQ[code] || l.ERR_REQ[999];\\n\\t\\t}\\n\\t\\tmsg+='';\\n\\t\\tpi.reject(code, msg, data);\\n\\t}\\n\\n\\t// - - - - - - - \\n\\n\\tfunction a2url(a, base0) {\\n\\t\\tvar p = [],\\n\\t\\t\\t\\tq = {},\\n\\t\\t\\t\\tqa = [],\\n\\t\\t\\t\\turl = '',\\n\\t\\t\\t\\tbase = base0?(base0+'').replace(/\\\\/+$/,'')+'/':'',\\n\\t\\t\\t\\ttostr = {startkey:1,endkey:1,start_key:1,end_key:1,key:1},\\n\\t\\t\\t\\treddoc = /^_design\\\\//;\\n\\n\\t\\tif (typeof a == 'string') {\\n\\t\\t\\turl = !/^http[s]?:/.test(a)?base+a.replace(/^\\\\/+/,''):a;\\n\\t\\t}\\n\\t\\telse if (Object.isArray(a)) {\\n\\t\\t\\ta.forEach(function(e, i){\\n\\t\\t\\t\\tif(''===e || null==e) return;\\n\\t\\t\\t\\tif (Object.isObject(e)) $.extend(true, q, e);\\n\\t\\t\\t\\telse if (reddoc.test(e+'')) p.add((e+'').split('/'));\\n\\t\\t\\t\\telse p.push(encodeURIComponent(e+''));\\n\\t\\t\\t});\\n\\n\\t\\t\\tqa = Object.keys(q).map(function(key){\\n\\t\\t\\t\\tvar v = q[key];\\n\\t\\t\\t\\tif (tostr[key] || typeof v != 'string') v = JSON.stringify(v);\\n\\t\\t\\t\\treturn encodeURIComponent(key)+'='+encodeURIComponent(v);\\n\\t\\t\\t});\\n\\t\\t\\t\\n\\t\\t\\turl = base+p.join('/')+(qa.length?'?'+qa.join('&'):'');\\n\\t\\t}\\n\\n\\t\\treturn url;\\n\\t}\\n})\",\n    \"active\": false,\n    \"err\": [],\n    \"opts\": [],\n    \"color\": [\n      \"violet\"\n    ]\n  },\n  {\n    \"stamp\": \"1504408809562\",\n    \"id\": \".GetList\",\n    \"type\": \"js\",\n    \"data\": \"(function _GetDBList (){\\n\\t\\n\\t// Returns promise resolved with prefilled that.All{}\\n\\t\\n\\tvar that = this,\\n\\t\\t\\td = that.data,\\n\\t\\t\\tpi = $.Deferred(),\\n\\t\\t\\trname = '_replicator';\\n\\t\\n\\tQ.allSettled([\\n\\t\\t\\n\\t\\t// read DB list\\n\\t\\tthat.Req(['_all_dbs'])\\n\\t\\t.then(function(list){\\n\\t\\t\\tvar prev = Object.keys(that.All),\\n\\t\\t\\t\\t\\tcurr = list.slice(0);\\n\\n\\t\\t\\t// Delete non existent\\n\\t\\t\\tprev.subtract(curr).forEach(function(i){ delete that.All[i]; });\\n\\n\\t\\t\\tcurr.forEach(function(dbname){\\n\\t\\t\\t\\t// construct db objs\\n\\t\\t\\t\\tvar db = {\\n\\t\\t\\t\\t\\tname:dbname,\\n\\t\\t\\t\\t\\tnamesafe:dbname.escapeHTML(),\\n\\t\\t\\t\\t\\thref:encodeURIComponent(dbname),\\n\\t\\t\\t\\t\\tsizesafe:'',\\n\\t\\t\\t\\t\\tsyncstate:'',\\n\\n\\t\\t\\t\\t\\tstamp:0,\\n\\t\\t\\t\\t\\tcommitted_update_seq:-1,\\n\\t\\t\\t\\t\\tcompact_running:false,\\n\\t\\t\\t\\t\\tdata_size:'',\\n\\t\\t\\t\\t\\tdb_name:'',\\n\\t\\t\\t\\t\\tdisk_format_version:'',\\n\\t\\t\\t\\t\\tdisk_size:0,\\n\\t\\t\\t\\t\\tdoc_count:'',\\n\\t\\t\\t\\t\\tdoc_del_count:'',\\n\\t\\t\\t\\t\\tinstance_start_time:'',\\n\\t\\t\\t\\t\\tpurge_seq:'',\\n\\t\\t\\t\\t\\tupdate_seq:'',\\n\\n\\t\\t\\t\\t\\tsecurity:{\\n\\t\\t\\t\\t\\t\\tstamp:0,\\n\\t\\t\\t\\t\\t\\tadmins:{names:[],roles:[]},\\n\\t\\t\\t\\t\\t\\tmemebers:{names:[],roles:[]}\\n\\t\\t\\t\\t\\t},\\n\\n\\t\\t\\t\\t\\ttasks:{ stamp:0, pids:[] },\\n\\t\\t\\t\\t\\tsyncs:{ stamp:0, docs:[] }\\n\\t\\t\\t\\t};\\n\\n\\t\\t\\t\\tthat.All[dbname] = $.extend( true, db, that.All[dbname] || {}, {stamp:Date.now()} );\\n\\n\\t\\t\\t});\\n\\n\\t\\t\\t\\n\\t\\t})\\n\\t\\t.fail(function(code, err, msg){\\n\\t\\t\\tpi.reject(code, err, msg);\\n\\t\\t}),\\n\\t\\t\\n\\t\\t// read replicator DB name\\n\\t\\tthat.Req(['_config', 'replicator', 'db'])\\n\\t\\t.then (function(rnewname){\\n\\t\\t\\tif (typeof rnewname == 'string') rname = rnewname;\\n\\t\\t})\\n\\t\\t\\n\\t])\\n\\t.then(function(){\\n\\t\\tif (that.All[rname]) that.ReplicatorDB = rname;\\n\\t\\tpi.resolve(that.All);\\n\\t});\\n\\t\\n\\treturn pi.promise();\\n})\",\n    \"active\": false,\n    \"err\": [],\n    \"opts\": [],\n    \"color\": [\n      \"violet\"\n    ]\n  }\n])","active": false,"err": [],"opts": ["nocompile"],"color": ["green"]},{"stamp": "1428901922554","id": ".init","type": "js","data": "(function ($o, form){\n\t\t\n\tvar that=this,\n      pi = $.Deferred();\n\t\t\t\t\n\t$o.formgen('init', that.HTML);\n\t\t\n\t$o.find(\"#pane\").on(\"keyup\",\"textarea\", function (){\n\t\tvar $t=$(this);\n\t\t$t.height(0).height($t[0].scrollHeight-6);\n\t});\n\t\n\tvar ed = that.data.editor;\n\t\n\tthat.$Ed = $o.find(\"#manifesto\");\n\n\tthat.MakePostfix(ed._id);\n\tthat.MakeSubs(\"cw.\"+ed.raw.name);\n  \n  that.E.Prefix = function(){ return {id:form.data.editor.id}; };\n\tthat.E.Postfix = function(){ return that.Postfix; };\n\tthat.E.Subs = function(){ return that.Subs; };\n\t\n\t// listen to commands from inside\n\t$o.on('savemanifest.my', function(){ that.SaveDoc(); });\n\t\n\t// CM-related stuff\n\tthat.InitCM();\n\t\n\t(function(){pi.resolve();}).delay(1);\n\t\t\n\treturn pi.promise();\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1427392095669","id": ".ui","type": "js","data": "({\n  \n  '#tlist':{\n    init:function ($o){\n    \t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n        cursorfixedheight:25,\n\t\t\t});\t\n    }\n  },\n\n  \"#manifesto\":{\n    bind:\"editor.raw\",\n    // manifest:\"Editor\", check:true,\n    manifest:\"this.E\", \n    check:true,\n    delay:20,\n    events:\"change.my\"\n  },\n\n  \"#warn\": {\n    delay:500,\n    bind:function (d,v,$o){\n\n      var i,j,k,\n          js, app,\n          that \t= this,\n          ed \t\t= d.editor, \n          r \t\t= ed.raw, \n          m \t\t= ed.manifest,\n          $ed \t= that.$Ed,\n          ok\t\t= ['Manifest structure is ok'],\n          err\t\t= [];\n\n      var isEd = r._type.indexOf('editor')>-1,\n          isApp = isEd || r._type.indexOf('app')>-1;\n\n      //check if unique\n      if (!ed._rev) {\n        if (false) {//(cw.form(r.name) || $.my.forms(\"cw.\"+r.name, \"exist\")) {\n          err.push ('Component name must be unique – and it’s not.');\n          d.editor.id = '';\n        } else {\n          r.author = cw.me();\n          d.editor.id = 'cw.' + r.name;\n          d.editor._id = d.editor.id.replace(/\\./g,'-')+'-'+cw.lib.hash4(r.author+'/'+r.version);\n        }\n      }\n\n      if (isApp) {\n        var trim = [/^_/, 'pic','types', 'com'];\n        if (!isEd) trim.push('nodecmd', 'nodedoc');\n\n        app = Object.clone(Object.reject(r,trim), true);\n\n        if (isEd) {\n          //update maskstate\n          app.maskstate='[\"'+app.nodecmd+'\",\"'+app.nodedoc+'._id\"]';\n        }\n\n        if (/^[\\[\\{]|[\\}\\]]$/.test(app.maskstate)) {\n          try {\n         \t\tapp.maskstate = JSON.parse(app.maskstate);\n          } catch(e0){\n          \terr.push (\"Invalid mask state.\");\n          }\n        }\n\n        // mount editor-specific fields\n        var tmp={}, ttype;\n        if (r._type.indexOf('editor')>-1) {\n\n          if (r._cmd && r._cmd.length) for (i=0; i<r._cmd.length; i++) {\n            if (ttype=r._cmd[i].type) {\n              if (!tmp[ttype]) tmp[ttype] = [];\n              tmp[ttype] = tmp[ttype].union(r._cmd[i].actions);\n            }\n          }\n\n          if (!Object.keys(tmp).length) {\n            err.push ('Editor must have types/actions defined.');\n          }\n          else {\n            app.types = tmp;\n          }\n        } \n\n      }\n\n      // get js src\n      if (!d.editor.raw._err.length) js = $ed.my().manifest._src;\n\n      if (Object.isObject(js)) {\n        js = Object.reject(js,['app', 'type', 'id', 'files', /^_/]);\n        if (!Object.isObject(js.ui)) err.push('The ui section must be an object.');\n        if (!Object.isObject(js.data)) err.push('The data section must be an object.');\n      } \n      else err.push(\"Invalid manifest.\");\n\n\n      //mount js on manifest\n      if (!err.length) {\n\n        d.editor.manifest = $.extend(\n          true,\n          app\n          ?{id:\"\", build:r.build||0, app:app}\n          :{id:\"\", build:r.build||0}, \n          js\n        );\n\n        //check if field pointers are valid\n        var n1,n2,n3,n4;\n        if (isEd) {\n          n1=!Object.isString(cw.lib.mask(d.editor.manifest.data, d.editor.manifest.app.nodetitle));\n          n3=!Object.isObject(cw.lib.mask(d.editor.manifest.data, d.editor.manifest.app.nodedoc));\n          n4 = !Object.isString(cw.lib.mask(d.editor.manifest.data, d.editor.manifest.app.nodecmd));\n        }\n        if (n1) err.push(\"Title mount ref poins to null.\");\n        if (n3) err.push(\"Invalid doc mount pointer.\");\n        if (n4) err.push(\"Cmd mount ref poins to null.\");\n      } else d.editor.manifest=null;\n\n\n      if (!err.length) {\n        d.editor.manifest.id = d.editor.id;\n        d.editor.title = r.title;\n\n        if (r.pic.length) d.editor.pic = r.pic; \n\n        ok.push(\"$id: \"+d.editor.id);\n        ok.push(\"_id: \"+d.editor._id);\n      }\n\n      d.editor.desc=r._desc;\n      d.editor.name=r.name;\n      d.editor.beta = !!(r._type.indexOf(\"beta\")>-1);\n\n      \n      if (err.length) d.err=err; else d.err=[];\n      return err.length?'<div class=\"orange\">'+err.join(\"<br>\")+'</div>':'<div class=\"green\">'+ok.join(\"<br>\")+'</div>';\n    },\n    watch:\"#manifesto\"\n  },\n  \n   \"#atts\":{\n\t\tinit: function ($o) {\n      var that = this; \n      $o.my(\n        $.extend($.my.cache('cw.Sys.Attachments'), {params:{locale:'en'}}), \n        {\n          doc:that.data.editor,\n          namePopup:true,\n          truncate:20\n        }\n      );\n\t\t},\n\t\tbind: function (){}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1511251273908","id": ".HTML","type": "html","data": "<div class=\"fs90\" id=\"manedframe\">\n  <div id=\"cmcont\" class=\"dib vat maned oh hide\" style=\"border:1px solid #C1D0DA\">\n    <textarea id=\"cm\" class=\"maned fs80\"></textarea>\n  </div>\n  <div id=\"manifesto\" class=\"dib vat maned\">\n    <div class=\"w220 dib vat\">\n      \n      <!-- btns -->\n      <div class=\"buttons dib vat mr10\">\n        <button id=\"btn-add\" class=\"button w30 fs85 lh120 br2 ml0\"><span class=\"fi-plus\"></span></button>\n      </div>\n      <div class=\"buttons dib vat mr10\">\n        <button id=\"btn-run\" class=\"button w30 validate fs85 lh120 btnl pl2\">\n          <span class=\"fi-play\"></span>\n        </button>\n        <button id=\"btn-compile\" class=\"button validate w30 fs85 lh120 btnr\">\n          <span class=\"fi-shopping-bag\"></span>\n        </button>\n      </div>\n      <div class=\"buttons dib vat mr10\">\n        <button id=\"btn-save\" class=\"button w30 fs85 lh120 btnl\"><span class=\"fi-save\"></span></button>\n        <button id=\"btn-docopts\" class=\"button w30 fs85 lh120\"><span class=\"fi-wrench\"></span></button>\n        <button id=\"btn-close\" class=\"button btnr w30 fs85 lh120\">✕</button>\n      </div>\n      \n      <!-- search -->\n\t\t\t<div class=\"w210 fs85 mt5 mb5\">\n\t\t\t\t<div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>\n\t\t\t\t<input type=\"text\" id=\"tab-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" \n\t\t\t\t\tplaceholder=\"Search\" style=\"background-image:none;padding-right:19px!important;\">\n\t\t\t\t<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\" \n\t\t\t\t\t onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span>\n\t\t\t</div>\n      \n      <!-- tabs -->\n      <div class=\"w210 mt4\" id=\"tlist\">\n        <div id=\"coms\" class=\"xgray w100p fs85 lh150\">\n          <div class=\"tab w100p\">\n            <div id=\"xtitle\" class=\"w100p dib vat nw ell oh\">\n              <span id=\"title\" class=\"\"></span>\n              <span class=\"fold\"></span>\n            </div>\n            <span class=\"ctype\"></span>\n          </div>\n        </div>\n        <div id=\"atts\" class=\"w210 fs90 gray mt0 pt6 pb8 btd lh140\"></div>\n      </div>\n    </div>\n    \n    <div class=\"dib vat\" style=\"width:calc(100% - 220px)\">\n      <!-- editors -->\n      <div id=\"eds\" class=\"cb\"></div>\n      <!-- hidden -->\n      <div id=\"warnM\" class=\"hide\"></div>\n    </div>\n  </div>\n  <div id=\"warn\" class=\"hide\"></div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1511262498151","id": ".style","type": "js","data": "({\n  '':'font-size:20px;',\n  ' #cmcont .CodeMirror':'height:auto;line-height:1.4em;',\n  ' #xmanifesto .CodeMirror':'height:auto;line-height:1.4em;',\n  ' .maned':'width:100%;',\n  \" .cm-csscolor\": \"color: rgba(255, 80, 212, 1); \",\n  \" .cm-csscolor::selection\":\"cursor:pointer!important;background:red\",\n\n  \" .cm-domidcolor\": \"color: #485E77; background-color: rgba(180, 195, 202, 0.19); border-radius:2px; \",\n  \n  ' .CodeMirror-selected':'background: #d9dee0;',\n  ' .CodeMirror-focused .CodeMirror-selected':'background: #cae7ff;',\n  \n  ' .CodeMirror-focused .CodeMirror-selectedtext':'background-color: #cae7ff!important;',\n  ' .cm-matchhighlight':'background-color:rgba(97,255,2,0.3); box-shadow: 0 -2px 0 0 rgba(97,255,2,0.3), 0 1px 0 0 rgba(97,255,2,0.3);'\n  \t\t\t\t\t\t+'border-radius:1px;',\n  ' .CodeMirror-selection-highlight-scrollbar':'background-color: rgba(165,230,255,0.5);',\n  \n  \" #tlist \": function($o){\n    var ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n        pad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n        css = \"overflow:hidden;height:\"+($(window).height()-(pad+ofs+80))+\"px;\";\n    return css;\n  },\n\n  ' #tab-search':'border-radius:2px!important;',\n\n  ' #manifesto':{\n    \"\":\"width:100%;\",\n\n    ' .violet':'color:rgb(109, 37, 179);',\n    ' .o0':'opacity:0;',\n    ' .w00':'width:0!important;margin-right:0!important;overflow:hidden;white-space: nowrap;position:absolute;',\n    ' .fold':'opacity:0.7;padding:0 4px;cursor:pointer; font-size:80%;',\n\n    '  .CodeMirror': function($o) {\n      var large = $o.width() > 1400;\n      return large?{\n        '': 'font-size:13.5px;line-height:17px',\n        ' .CodeMirror-lines': 'line-height:17px;',\n      }:{\n        '': 'font-size:13px;line-height:16px',\n        ' .CodeMirror-lines': 'line-height:16px;',\n      };\n    },\n\n    \" #coms\":{\n      \"\":\"margin-bottom: 5px;\",\n      \" .tab\": \"margin-right:2px;\",\n      ' #xtitle':\"padding:0px 2px; cursor:move; border-radius:2px; \"\n      +\"transition: color 0.2s, background-color 0.2s, opacity 0.2s;\",\n      \" .haserror\":\"color:#FF2A4D!important;\",\n      ' #title':\"cursor:pointer;\",\n      \" .active\":\"background-color:rgba(220,220,220, 0.5);\"\n      + \"color:#505560;\",\n      \" .active.haserror\":\"color:white!important;background-color:#EE637A!important;\",\n      \" .ctype\" :\"font-size:80%; opacity:0.7; display:block;position:absolute;\"\n      +\"top:-2px;right:4px;\"\n    },\n\n    \" .tab\":{\n      \"\":\"transition: color 0.2s, background-color 0.15s;background-color:rgba(255,255,255,0);\"\n    },\n\n    \" #eds\":{\n      \"\":\"border:1px solid #ddd; border-radius:2px\",\n      \">xdiv\":\"height:0;overflow:hidden;\",\n      \">xdiv:first-child\":\"height:auto;\",\n      \" .CodeMirror-linenumbers\":\"transition: background-color 0.3s\",\n      \" .ed-error .CodeMirror-linenumbers\":\"background-color:rgba(255, 200, 200, 0.75)\"\n    },\n    \" .buttons\":{\n      \" .button\": \"margin:0 0 0 2px; border-radius:0; padding: 4px 0px;\",\n      \" .btnl\" :\"border-radius: 2px 0 0 2px;\",\n      \" .btnr\" :\"border-radius: 0 2px 2px 0;\"\n    },\n    \" button:focus\":\"outline:none;\",\n    \" .itl\":\"font-style:italic;\",\n    \" .itl:after\":'content:\"*\";font-style:normal;margin-left:1px;',\n\n    ' a, .pseudolink':'text-decoration:none;',\n    ' .cw-att-item':'padding: 0.1em 0 0em 0;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1428904276922","id": ".MakePostfix","type": "js","data": "(function(docid){\n\tvar that = this;\n\tthat.db.load(docid, true)\n\t.then(function(doc){\n\t\tif ( doc && doc._attachments ) that.Postfix.files = doc._attachments;\n\t})\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1428904289854","id": ".MakeSubs","type": "js","data": "(function (formid){\n\tvar that = this,\n\t\t\ti, \n\t\t\tchilds = that.db.ram(function(e){\n\t\t\t\treturn (e.type == \"manifest\" && e.manifest && e.manifest.id.startsWith(formid+\".\"))\n\t\t\t});\n\n\tif (childs.length) {\n\t\tchilds = childs.map(function(e){return Object.clone(e,true)});\n\t\tchilds.forEach(function(e){\n\t\t\tvar man = cw.lib.unjson(e.manifest),\n\t\t\t\t\tref = man.id.from(formid.length+1);\n\t\t\t$.extend(!0, that.Subs, cw.lib.unmask(man, ref));\n\t\t\tman = cw.lib.getref(that.Subs, ref);\n\n\t\t\t//has attaches?\n\t\t\tif (Object.size(e._attachments)) {\n\t\t\t\tthat.db.load(e._id, true)\n\t\t\t\t.then(function(man2){\n\t\t\t\t\tman.files = man2._attachments;\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t}\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1485209904810","id": ".CMoverlays","type": "js","data": "(function(){\n\n\t// Extends CM with DOM id highlighter\n\t// and supplementary highlighting for color picker\n\t\n\tvar re_clr = /^(rgb[a]?\\s*\\([\\s0-9,\\.]+\\)|#[0-9a-fA-F]{8}|#[0-9a-fA-F]{6}|#[0-9a-fA-F]{3})/,\n\t\t\tre_domid = /^('#[a-z0-9\\-_]{1,20}'|'\\.[a-z0-9\\-_\\.]{1,20}'|'input\\[[^\\]]{1,20}\\]'|\"#[a-z0-9\\-_]{1,20}\"|\"\\.[a-z0-9\\-_\\.]{1,20}\"|\"input\\[[^\\]]{1,20}\\]\")/i,\n\t\t\tre_domid_x = /^('#[a-f0-9]{6}'|\"#[a-f0-9]{6}\")/i\n\n\tfunction _parseStream (stream, state) {\n\t\tvar ch, n1, n2;\n\n\t\tif (stream.match(re_clr)){\n\t\t\tstream.eat(re_clr);\n\t\t\treturn \"csscolor\";\n\t\t}\n\t\telse if (stream.match(re_domid) && !stream.match(re_domid_x)){\n\t\t\tstream.eat(re_domid);\n\t\t\treturn \"domidcolor\";\n\t\t}\n\t\twhile (\n\t\t\tstream.next() != null \n\t\t\t&& !stream.match(re_clr, false)\n\t\t\t&& !stream.match(re_domid, false)\n\t\t) {}\n\t\treturn null;\n\t}\n\n\t// - - - - - - - - - - - - -\n\t\n\t[\n\t\t[\"manjs\", \"javascript\"],\n\t\t[\"manhtml\", \"htmlmixed\"],\n\t\t[\"mancss\", \"text/css\"]\n\t].forEach(function(e){\n\t\tif (\n\t\t\t//true || \n\t\t\t!CodeMirror.modes[e[0]]\n\t\t) CodeMirror.defineMode(e[0], function(config, parserConfig) {\n\t\t\treturn CodeMirror.overlayMode(CodeMirror.getMode(config,e[1]), {token: _parseStream});\n\t\t});\n\t})\n\n})","active": true,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1485209771178","id": ".InitCM","type": "js","data": "(function () {\n\n\t// inits different CM stuff\n\t\n\tvar that = this;\n\t\n\tif (!CodeMirror.overlayMode) _ovl(CodeMirror);\n  \n  if (!CodeMirror.optionHandlers.highlightSelectionMatches) that.Highlighter(CodeMirror);\n\t\n\tthat.CMoverlays();\n\n\treturn ;\n\n\n\t// - - - - - - - - - -\n\n\tfunction _ovl(CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.overlayMode = function(base, overlay, combine) {\n\t\t\treturn {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.startState(base),\n\t\t\t\t\t\toverlay: CodeMirror.startState(overlay),\n\t\t\t\t\t\tbasePos: 0,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: 0,\n\t\t\t\t\t\toverlayCur: null,\n\t\t\t\t\t\tstreamSeen: null\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcopyState: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.copyState(base, state.base),\n\t\t\t\t\t\toverlay: CodeMirror.copyState(overlay, state.overlay),\n\t\t\t\t\t\tbasePos: state.basePos,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: state.overlayPos,\n\t\t\t\t\t\toverlayCur: null\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\ttoken: function(stream, state) {\n\t\t\t\t\tif (stream != state.streamSeen ||\n\t\t\t\t\t\t\tMath.min(state.basePos, state.overlayPos) < stream.start) {\n\t\t\t\t\t\tstate.streamSeen = stream;\n\t\t\t\t\t\tstate.basePos = state.overlayPos = stream.start;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stream.start == state.basePos) {\n\t\t\t\t\t\tstate.baseCur = base.token(stream, state.base);\n\t\t\t\t\t\tstate.basePos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.start == state.overlayPos) {\n\t\t\t\t\t\tstream.pos = stream.start;\n\t\t\t\t\t\tstate.overlayCur = overlay.token(stream, state.overlay);\n\t\t\t\t\t\tstate.overlayPos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tstream.pos = Math.min(state.basePos, state.overlayPos);\n\n\t\t\t\t\t// state.overlay.combineTokens always takes precedence over combine,\n\t\t\t\t\t// unless set to null\n\t\t\t\t\tif (state.overlayCur == null) return state.baseCur;\n\t\t\t\t\telse if (state.baseCur != null &&\n\t\t\t\t\t\t\t\t\t state.overlay.combineTokens ||\n\t\t\t\t\t\t\t\t\t combine && state.overlay.combineTokens == null)\n\t\t\t\t\t\treturn state.baseCur + \" \" + state.overlayCur;\n\t\t\t\t\telse return state.overlayCur;\n\t\t\t\t},\n\n\t\t\t\tindent: base.indent && function(state, textAfter) {\n\t\t\t\t\treturn base.indent(state.base, textAfter);\n\t\t\t\t},\n\t\t\t\telectricChars: base.electricChars,\n\n\t\t\t\tinnerMode: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstate: state.base,\n\t\t\t\t\t\tmode: base\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tblankLine: function(state) {\n\t\t\t\t\tif (base.blankLine) base.blankLine(state.base);\n\t\t\t\t\tif (overlay.blankLine) overlay.blankLine(state.overlay);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1511171837456","id": ".SaveDoc","type": "js","data": "(function(){\n  var that = this,\n      d = that.data,\n      pi = $.Deferred(),\n      dbid = this.db.name; \n\n  d.editor.stamp = Date.now();\n\n  if (d.editor.manifest) {\n    var build = +d.editor.raw.build || (d.editor._rev?+d.editor._rev.split('-')[0]:null) || 1;\n    if (!Object.isNumber(build)) build = 1;\n    d.editor.manifest.build = build + 1;\n    d.editor.raw.build = build + 1;\n    if (d.editor.manifest.app && d.editor.manifest.app.hasOwnProperty('build')) {\n    \td.editor.manifest.app.build = build + 1;\n    }\n  }\n\n  that.db.save(d.editor)\n  .then(function (res){\n    \n    //console.log(Object.clone(res, true));\n\n    // mark manifest as trusted\n    if (window.cw && window.cw.read) {\n      cw.read[dbid].trust[res._id] = res._rev;\n      cw.read[dbid]._dirty = true;\n    }\n    \n    //push to app\n    Object.merge(\n      d.editor,\n      Object.select(res,[/^_/, \"stamp\", \"log\"])\n    );\n\n    //redraw file list\n    that.my.find('#atts').trigger(\"redraw\");\n\n    //rebuild \n    that.MakePostfix(d.editor._id);\n    \n    pi.resolve(d.editor);\n\n  })\n  .fail(function(err, res){\n    console.log(res, err);\n    pi.reject(err,res);\n  });\n\n  return pi.promise();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1533673252700","id": ".Highlighter","type": "js","data": "(function(CodeMirror){\n\n  // https://codemirror.net/addon/selection/mark-selection.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Because sometimes you need to mark the selected *text*.\n  //\n  // Adds an option 'styleSelectedText' which, when enabled, gives\n  // selected text the CSS class given as option value, or\n  // \"CodeMirror-selectedtext\" when the value is not a string.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineOption(\"styleSelectedText\", false, function(cm, val, old) {\n      var prev = old && old != CodeMirror.Init;\n      if (val && !prev) {\n        cm.state.markedSelection = [];\n        cm.state.markedSelectionStyle = typeof val == \"string\" ? val : \"CodeMirror-selectedtext\";\n        reset(cm);\n        cm.on(\"cursorActivity\", onCursorActivity);\n        cm.on(\"change\", onChange);\n      } else if (!val && prev) {\n        cm.off(\"cursorActivity\", onCursorActivity);\n        cm.off(\"change\", onChange);\n        clear(cm);\n        cm.state.markedSelection = cm.state.markedSelectionStyle = null;\n      }\n    });\n\n    function onCursorActivity(cm) {\n      if (cm.state.markedSelection)\n        cm.operation(function() {\n          update(cm);\n        });\n    }\n\n    function onChange(cm) {\n      if (cm.state.markedSelection && cm.state.markedSelection.length)\n        cm.operation(function() {\n          clear(cm);\n        });\n    }\n\n    var CHUNK_SIZE = 8;\n    var Pos = CodeMirror.Pos;\n    var cmp = CodeMirror.cmpPos;\n\n    function coverRange(cm, from, to, addAt) {\n      if (cmp(from, to) == 0) return;\n      var array = cm.state.markedSelection;\n      var cls = cm.state.markedSelectionStyle;\n      for (var line = from.line;;) {\n        var start = line == from.line ? from : Pos(line, 0);\n        var endLine = line + CHUNK_SIZE,\n            atEnd = endLine >= to.line;\n        var end = atEnd ? to : Pos(endLine, 0);\n        var mark = cm.markText(start, end, {\n          className: cls\n        });\n        if (addAt == null) array.push(mark);\n        else array.splice(addAt++, 0, mark);\n        if (atEnd) break;\n        line = endLine;\n      }\n    }\n\n    function clear(cm) {\n      var array = cm.state.markedSelection;\n      for (var i = 0; i < array.length; ++i) array[i].clear();\n      array.length = 0;\n    }\n\n    function reset(cm) {\n      clear(cm);\n      var ranges = cm.listSelections();\n      for (var i = 0; i < ranges.length; i++)\n        coverRange(cm, ranges[i].from(), ranges[i].to());\n    }\n\n    function update(cm) {\n      if (!cm.somethingSelected()) return clear(cm);\n      if (cm.listSelections().length > 1) return reset(cm);\n\n      var from = cm.getCursor(\"start\"),\n          to = cm.getCursor(\"end\");\n\n      var array = cm.state.markedSelection;\n      if (!array.length) return coverRange(cm, from, to);\n\n      var coverStart = array[0].find(),\n          coverEnd = array[array.length - 1].find();\n      if (!coverStart || !coverEnd || to.line - from.line <= CHUNK_SIZE ||\n          cmp(from, coverEnd.to) >= 0 || cmp(to, coverStart.from) <= 0)\n        return reset(cm);\n\n      while (cmp(from, coverStart.from) > 0) {\n        array.shift().clear();\n        coverStart = array[0].find();\n      }\n      if (cmp(from, coverStart.from) < 0) {\n        if (coverStart.to.line - from.line < CHUNK_SIZE) {\n          array.shift().clear();\n          coverRange(cm, from, coverStart.to, 0);\n        } else {\n          coverRange(cm, from, coverStart.from, 0);\n        }\n      }\n\n      while (cmp(to, coverEnd.to) < 0) {\n        array.pop().clear();\n        coverEnd = array[array.length - 1].find();\n      }\n      if (cmp(to, coverEnd.to) > 0) {\n        if (to.line - coverEnd.from.line < CHUNK_SIZE) {\n          array.pop().clear();\n          coverRange(cm, coverEnd.from, to);\n        } else {\n          coverRange(cm, coverEnd.to, to);\n        }\n      }\n    }\n  });\n\n  //===================================================\n\n  // https://codemirror.net/addon/scroll/annotatescrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"annotateScrollbar\", function(options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      return new Annotation(this, options);\n    });\n\n    CodeMirror.defineOption(\"scrollButtonHeight\", 0);\n\n    function Annotation(cm, options) {\n      this.cm = cm;\n      this.options = options;\n      this.buttonHeight = options.scrollButtonHeight || cm.getOption(\"scrollButtonHeight\");\n      this.annotations = [];\n      this.doRedraw = this.doUpdate = null;\n      this.div = cm.getWrapperElement().appendChild(document.createElement(\"div\"));\n      this.div.style.cssText = \"position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none\";\n      this.computeScale();\n\n      function scheduleRedraw(delay) {\n        clearTimeout(self.doRedraw);\n        self.doRedraw = setTimeout(function() {\n          self.redraw();\n        }, delay);\n      }\n\n      var self = this;\n      cm.on(\"refresh\", this.resizeHandler = function() {\n        clearTimeout(self.doUpdate);\n        self.doUpdate = setTimeout(function() {\n          if (self.computeScale()) scheduleRedraw(20);\n        }, 100);\n      });\n      cm.on(\"markerAdded\", this.resizeHandler);\n      cm.on(\"markerCleared\", this.resizeHandler);\n      if (options.listenForChanges !== false)\n        cm.on(\"change\", this.changeHandler = function() {\n          scheduleRedraw(250);\n        });\n    }\n\n    Annotation.prototype.computeScale = function() {\n      var cm = this.cm;\n      var hScale = (cm.getWrapperElement().clientHeight - cm.display.barHeight - this.buttonHeight * 2) /\n          cm.getScrollerElement().scrollHeight\n      if (hScale != this.hScale) {\n        this.hScale = hScale;\n        return true;\n      }\n    };\n\n    Annotation.prototype.update = function(annotations) {\n      this.annotations = annotations;\n      this.redraw();\n    };\n\n    Annotation.prototype.redraw = function(compute) {\n      if (compute !== false) this.computeScale();\n      var cm = this.cm,\n          hScale = this.hScale;\n\n      var frag = document.createDocumentFragment(),\n          anns = this.annotations;\n\n      var wrapping = cm.getOption(\"lineWrapping\");\n      var singleLineH = wrapping && cm.defaultTextHeight() * 1.5;\n      var curLine = null,\n          curLineObj = null;\n\n      function getY(pos, top) {\n        if (curLine != pos.line) {\n          curLine = pos.line;\n          curLineObj = cm.getLineHandle(curLine);\n        }\n        if ((curLineObj.widgets && curLineObj.widgets.length) ||\n            (wrapping && curLineObj.height > singleLineH))\n          return cm.charCoords(pos, \"local\")[top ? \"top\" : \"bottom\"];\n        var topY = cm.heightAtLine(curLineObj, \"local\");\n        return topY + (top ? 0 : curLineObj.height);\n      }\n\n      var lastLine = cm.lastLine()\n      if (cm.display.barWidth)\n        for (var i = 0, nextTop; i < anns.length; i++) {\n          var ann = anns[i];\n          if (ann.to.line > lastLine) continue;\n          var top = nextTop || getY(ann.from, true) * hScale;\n          var bottom = getY(ann.to, false) * hScale;\n          while (i < anns.length - 1) {\n            if (anns[i + 1].to.line > lastLine) break;\n            nextTop = getY(anns[i + 1].from, true) * hScale;\n            if (nextTop > bottom + .9) break;\n            ann = anns[++i];\n            bottom = getY(ann.to, false) * hScale;\n          }\n          if (bottom == top) continue;\n          var height = Math.max(bottom - top, 3);\n\n          var elt = frag.appendChild(document.createElement(\"div\"));\n          elt.style.cssText = \"position: absolute; right: 0px; width: \" + Math.max(cm.display.barWidth - 1, 2) + \"px; top: \" + (top + this.buttonHeight) + \"px; height: \" + height + \"px\";\n          elt.className = this.options.className;\n          if (ann.id) {\n            elt.setAttribute(\"annotation-id\", ann.id);\n          }\n        }\n      this.div.textContent = \"\";\n      this.div.appendChild(frag);\n    };\n\n    Annotation.prototype.clear = function() {\n      this.cm.off(\"refresh\", this.resizeHandler);\n      this.cm.off(\"markerAdded\", this.resizeHandler);\n      this.cm.off(\"markerCleared\", this.resizeHandler);\n      if (this.changeHandler) this.cm.off(\"change\", this.changeHandler);\n      this.div.parentNode.removeChild(this.div);\n    };\n  });\n\n\n\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/matchesonscrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"showMatchesOnScrollbar\", function(query, caseFold, options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      if (!options) options = {};\n      return new SearchAnnotation(this, query, caseFold, options);\n    });\n\n    function SearchAnnotation(cm, query, caseFold, options) {\n      this.cm = cm;\n      this.options = options;\n      var annotateOptions = {\n        listenForChanges: false\n      };\n      for (var prop in options) annotateOptions[prop] = options[prop];\n      if (!annotateOptions.className) annotateOptions.className = \"CodeMirror-search-match\";\n      this.annotation = cm.annotateScrollbar(annotateOptions);\n      this.query = query;\n      this.caseFold = caseFold;\n      this.gap = {\n        from: cm.firstLine(),\n        to: cm.lastLine() + 1\n      };\n      this.matches = [];\n      this.update = null;\n\n      this.findMatches();\n      this.annotation.update(this.matches);\n\n      var self = this;\n      cm.on(\"change\", this.changeHandler = function(_cm, change) {\n        self.onChange(change);\n      });\n    }\n\n    var MAX_MATCHES = 1000;\n\n    SearchAnnotation.prototype.findMatches = function() {\n      if (!this.gap) return;\n      for (var i = 0; i < this.matches.length; i++) {\n        var match = this.matches[i];\n        if (match.from.line >= this.gap.to) break;\n        if (match.to.line >= this.gap.from) this.matches.splice(i--, 1);\n      }\n      var cursor = this.cm.getSearchCursor(this.query, CodeMirror.Pos(this.gap.from, 0), this.caseFold);\n      var maxMatches = this.options && this.options.maxMatches || MAX_MATCHES;\n      while (cursor.findNext()) {\n        var match = {\n          from: cursor.from(),\n          to: cursor.to()\n        };\n        if (match.from.line >= this.gap.to) break;\n        this.matches.splice(i++, 0, match);\n        if (this.matches.length > maxMatches) break;\n      }\n      this.gap = null;\n    };\n\n    function offsetLine(line, changeStart, sizeChange) {\n      if (line <= changeStart) return line;\n      return Math.max(changeStart, line + sizeChange);\n    }\n\n    SearchAnnotation.prototype.onChange = function(change) {\n      var startLine = change.from.line;\n      var endLine = CodeMirror.changeEnd(change).line;\n      var sizeChange = endLine - change.to.line;\n      if (this.gap) {\n        this.gap.from = Math.min(offsetLine(this.gap.from, startLine, sizeChange), change.from.line);\n        this.gap.to = Math.max(offsetLine(this.gap.to, startLine, sizeChange), change.from.line);\n      } else {\n        this.gap = {\n          from: change.from.line,\n          to: endLine + 1\n        };\n      }\n\n      if (sizeChange)\n        for (var i = 0; i < this.matches.length; i++) {\n          var match = this.matches[i];\n          var newFrom = offsetLine(match.from.line, startLine, sizeChange);\n          if (newFrom != match.from.line) match.from = CodeMirror.Pos(newFrom, match.from.ch);\n          var newTo = offsetLine(match.to.line, startLine, sizeChange);\n          if (newTo != match.to.line) match.to = CodeMirror.Pos(newTo, match.to.ch);\n        }\n      clearTimeout(this.update);\n      var self = this;\n      this.update = setTimeout(function() {\n        self.updateAfterChange();\n      }, 250);\n    };\n\n    SearchAnnotation.prototype.updateAfterChange = function() {\n      this.findMatches();\n      this.annotation.update(this.matches);\n    };\n\n    SearchAnnotation.prototype.clear = function() {\n      this.cm.off(\"change\", this.changeHandler);\n      this.annotation.clear();\n    };\n  });\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/searchcursor.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror)\n  })(function(CodeMirror) {\n    \"use strict\"\n    var Pos = CodeMirror.Pos\n\n    function regexpFlags(regexp) {\n      var flags = regexp.flags\n      return flags != null ? flags : (regexp.ignoreCase ? \"i\" : \"\") + (regexp.global ? \"g\" : \"\") + (regexp.multiline ? \"m\" : \"\")\n    }\n\n    function ensureFlags(regexp, flags) {\n      var current = regexpFlags(regexp),\n          target = current\n      for (var i = 0; i < flags.length; i++)\n        if (target.indexOf(flags.charAt(i)) == -1)\n          target += flags.charAt(i)\n          return current == target ? regexp : new RegExp(regexp.source, target)\n    }\n\n    function maybeMultiline(regexp) {\n      return /\\\\s|\\\\n|\\n|\\\\W|\\\\D|\\[\\^/.test(regexp.source)\n    }\n\n    function searchRegexpForward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {\n        regexp.lastIndex = ch\n        var string = doc.getLine(line),\n            match = regexp.exec(string)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpForwardMultiline(doc, regexp, start) {\n      if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)\n\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, last = doc.lastLine(); line <= last;) {\n        // This grows the search buffer in exponentially-sized chunks\n        // between matches, so that nearby matches are fast and don't\n        // require concatenating the whole document (in case we're\n        // searching for something that has tons of matches), but at the\n        // same time, the amount of retries is limited.\n        for (var i = 0; i < chunk; i++) {\n          if (line > last) break\n          var curLine = doc.getLine(line++)\n          string = string == null ? curLine : string + \"\\n\" + curLine\n        }\n        chunk = chunk * 2\n        regexp.lastIndex = start.ch\n        var match = regexp.exec(string)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = start.line + before.length - 1,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    function lastMatchIn(string, regexp) {\n      var cutOff = 0,\n          match\n      for (;;) {\n        regexp.lastIndex = cutOff\n        var newMatch = regexp.exec(string)\n        if (!newMatch) return match\n        match = newMatch\n        cutOff = match.index + (match[0].length || 1)\n        if (cutOff == string.length) return match\n          }\n    }\n\n    function searchRegexpBackward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {\n        var string = doc.getLine(line)\n        if (ch > -1) string = string.slice(0, ch)\n        var match = lastMatchIn(string, regexp)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpBackwardMultiline(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, first = doc.firstLine(); line >= first;) {\n        for (var i = 0; i < chunk; i++) {\n          var curLine = doc.getLine(line--)\n          string = string == null ? curLine.slice(0, start.ch) : curLine + \"\\n\" + string\n        }\n        chunk *= 2\n\n        var match = lastMatchIn(string, regexp)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = line + before.length,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    var doFold, noFold\n    if (String.prototype.normalize) {\n      doFold = function(str) {\n        return str.normalize(\"NFD\").toLowerCase()\n      }\n      noFold = function(str) {\n        return str.normalize(\"NFD\")\n      }\n    } else {\n      doFold = function(str) {\n        return str.toLowerCase()\n      }\n      noFold = function(str) {\n        return str\n      }\n    }\n\n    // Maps a position in a case-folded line back to a position in the original line\n    // (compensating for codepoints increasing in number during folding)\n\n    function adjustPos(orig, folded, pos, foldFunc) {\n      if (orig.length == folded.length) return pos\n      for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {\n        if (min == max) return min\n        var mid = (min + max) >> 1\n        var len = foldFunc(orig.slice(0, mid)).length\n        if (len == pos) return mid\n        else if (len > pos) max = mid\n        else min = mid + 1\n          }\n    }\n\n    function searchStringForward(doc, query, start, caseFold) {\n      // Empty string would match anything and never progress, so we\n      // define it to match nothing instead.\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {\n        var orig = doc.getLine(line).slice(ch),\n            string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.indexOf(lines[0])\n          if (found == -1) continue search\n          var start = adjustPos(orig, string, found, fold) + ch\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold) + ch),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)\n          }\n        } else {\n          var cutFrom = string.length - lines[0].length\n          if (string.slice(cutFrom) != lines[0]) continue search\n          for (var i = 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(line + i)) != lines[i]) continue search\n            var end = doc.getLine(line + lines.length - 1),\n                endString = fold(end),\n                lastLine = lines[lines.length - 1]\n            if (endString.slice(0, lastLine.length) != lastLine) continue search\n            return {\n              from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),\n              to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function searchStringBackward(doc, query, start, caseFold) {\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {\n        var orig = doc.getLine(line)\n        if (ch > -1) orig = orig.slice(0, ch)\n        var string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.lastIndexOf(lines[0])\n          if (found == -1) continue search\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold)),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))\n          }\n        } else {\n          var lastLine = lines[lines.length - 1]\n          if (string.slice(0, lastLine.length) != lastLine) continue search\n          for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(start + i)) != lines[i]) continue search\n            var top = doc.getLine(line + 1 - lines.length),\n                topString = fold(top)\n            if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search\n            return {\n              from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),\n              to: Pos(line, adjustPos(orig, string, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function SearchCursor(doc, query, pos, options) {\n      this.atOccurrence = false\n      this.doc = doc\n      pos = pos ? doc.clipPos(pos) : Pos(0, 0)\n      this.pos = {\n        from: pos,\n        to: pos\n      }\n\n      var caseFold\n      if (typeof options == \"object\") {\n        caseFold = options.caseFold\n      } else { // Backwards compat for when caseFold was the 4th argument\n        caseFold = options\n        options = null\n      }\n\n      if (typeof query == \"string\") {\n        if (caseFold == null) caseFold = false\n        this.matches = function(reverse, pos) {\n          return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)\n        }\n      } else {\n        query = ensureFlags(query, \"gm\")\n        if (!options || options.multiline !== false)\n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)\n          }; \n        else \n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)\n          };\n      }\n    }\n\n    SearchCursor.prototype = {\n      findNext: function() {\n        return this.find(false)\n      },\n      findPrevious: function() {\n        return this.find(true)\n      },\n\n      find: function(reverse) {\n        var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))\n\n        // Implements weird auto-growing behavior on null-matches for\n        // backwards-compatiblity with the vim code (unfortunately)\n        while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {\n          if (reverse) {\n            if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)\n            else if (result.from.line == this.doc.firstLine()) result = null\n            else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))\n              } else {\n                if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)\n                else if (result.to.line == this.doc.lastLine()) result = null\n                else result = this.matches(reverse, Pos(result.to.line + 1, 0))\n                  }\n        }\n\n        if (result) {\n          this.pos = result\n          this.atOccurrence = true\n          return this.pos.match || true\n        } else {\n          var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)\n          this.pos = {\n            from: end,\n            to: end\n          }\n          return this.atOccurrence = false\n        }\n      },\n\n      from: function() {\n        if (this.atOccurrence) return this.pos.from\n          },\n      to: function() {\n        if (this.atOccurrence) return this.pos.to\n          },\n\n      replace: function(newText, origin) {\n        if (!this.atOccurrence) return\n        var lines = CodeMirror.splitLines(newText)\n        this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)\n        this.pos.to = Pos(this.pos.from.line + lines.length - 1,\n                          lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))\n      }\n    }\n\n    CodeMirror.defineExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this.doc, query, pos, caseFold)\n    })\n    CodeMirror.defineDocExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this, query, pos, caseFold)\n    })\n\n    CodeMirror.defineExtension(\"selectMatches\", function(query, caseFold) {\n      var ranges = []\n      var cur = this.getSearchCursor(query, this.getCursor(\"from\"), caseFold)\n      while (cur.findNext()) {\n        if (CodeMirror.cmpPos(cur.to(), this.getCursor(\"to\")) > 0) break\n        ranges.push({\n          anchor: cur.from(),\n          head: cur.to()\n        })\n          }\n      if (ranges.length)\n        this.setSelections(ranges, 0)\n        })\n  });\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/match-highlighter.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Highlighting text that matches the selection\n  //\n  // Defines an option highlightSelectionMatches, which, when enabled,\n  // will style strings that match the selection throughout the\n  // document.\n  //\n  // The option can be set to true to simply enable it, or to a\n  // {minChars, style, wordsOnly, showToken, delay} object to explicitly\n  // configure it. minChars is the minimum amount of characters that should be\n  // selected for the behavior to occur, and style is the token style to\n  // apply to the matches. This will be prefixed by \"cm-\" to create an\n  // actual CSS class name. If wordsOnly is enabled, the matches will be\n  // highlighted only if the selected text is a word. showToken, when enabled,\n  // will cause the current token to be highlighted when nothing is selected.\n  // delay is used to specify how much time to wait, in milliseconds, before\n  // highlighting the matches. If annotateScrollbar is enabled, the occurences\n  // will be highlighted on the scrollbar via the matchesonscrollbar addon.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    var defaults = {\n      style: \"matchhighlight\",\n      minChars: 2,\n      maxChars: 200,\n      delay: 100,\n      wordsOnly: false,\n      annotateScrollbar: false,\n      showToken: false,\n      trim: true\n    }\n\n    function State(options) {\n      this.options = {}\n      for (var name in defaults)\n        this.options[name] = (options && options.hasOwnProperty(name) ? options : defaults)[name]\n        this.overlay = this.timeout = null;\n      this.matchesonscroll = null;\n      this.active = false;\n    }\n\n    CodeMirror.defineOption(\"highlightSelectionMatches\", false, function(cm, val, old) {\n      if (old && old != CodeMirror.Init) {\n        removeOverlay(cm);\n        clearTimeout(cm.state.matchHighlighter.timeout);\n        cm.state.matchHighlighter = null;\n        cm.off(\"cursorActivity\", cursorActivity);\n        cm.off(\"focus\", onFocus)\n      }\n      if (val) {\n        var state = cm.state.matchHighlighter = new State(val);\n        if (cm.hasFocus()) {\n          state.active = true\n          highlightMatches(cm)\n        } else {\n          cm.on(\"focus\", onFocus)\n        }\n        cm.on(\"cursorActivity\", cursorActivity);\n      }\n    });\n\n    function cursorActivity(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.active || cm.hasFocus()) scheduleHighlight(cm, state)\n        }\n\n    function onFocus(cm) {\n      var state = cm.state.matchHighlighter\n      if (!state.active) {\n        state.active = true\n        scheduleHighlight(cm, state)\n      }\n    }\n\n    function scheduleHighlight(cm, state) {\n      clearTimeout(state.timeout);\n      state.timeout = setTimeout(function() {\n        highlightMatches(cm);\n      }, state.options.delay);\n    }\n\n    function addOverlay(cm, query, hasBoundary, style) {\n      var state = cm.state.matchHighlighter;\n      cm.addOverlay(state.overlay = makeOverlay(query, hasBoundary, style));\n      if (state.options.annotateScrollbar && cm.showMatchesOnScrollbar) {\n        var searchFor = hasBoundary ? new RegExp(\"\\\\b\" + query.replace(/[\\\\\\[.+*?(){|^$]/g, \"\\\\$&\") + \"\\\\b\") : query;\n        state.matchesonscroll = cm.showMatchesOnScrollbar(searchFor, false, {\n          className: \"CodeMirror-selection-highlight-scrollbar\"\n        });\n      }\n    }\n\n    function removeOverlay(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.overlay) {\n        cm.removeOverlay(state.overlay);\n        state.overlay = null;\n        if (state.matchesonscroll) {\n          state.matchesonscroll.clear();\n          state.matchesonscroll = null;\n        }\n      }\n    }\n\n    function highlightMatches(cm) {\n      cm.operation(function() {\n        var state = cm.state.matchHighlighter;\n        removeOverlay(cm);\n        if (!cm.somethingSelected() && state.options.showToken) {\n          var re = state.options.showToken === true ? /[\\w$]/ : state.options.showToken;\n          var cur = cm.getCursor(),\n              line = cm.getLine(cur.line),\n              start = cur.ch,\n              end = start;\n          while (start && re.test(line.charAt(start - 1)))--start;\n          while (end < line.length && re.test(line.charAt(end)))++end;\n          if (start < end)\n            addOverlay(cm, line.slice(start, end), re, state.options.style);\n          return;\n        }\n        var from = cm.getCursor(\"from\"),\n            to = cm.getCursor(\"to\");\n        if (from.line != to.line) return;\n        if (state.options.wordsOnly && !isWord(cm, from, to)) return;\n        var selection = cm.getRange(from, to);\n        if (selection.length > state.options.maxChars) return;\n        if (state.options.trim) selection = selection.replace(/^\\s+|\\s+$/g, \"\")\n        if (selection.length >= state.options.minChars)\n          addOverlay(cm, selection, false, state.options.style);\n      });\n    }\n\n    function isWord(cm, from, to) {\n      var str = cm.getRange(from, to);\n      if (str.match(/^\\w+$/) !== null) {\n        if (from.ch > 0) {\n          var pos = {\n            line: from.line,\n            ch: from.ch - 1\n          };\n          var chr = cm.getRange(pos, from);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        if (to.ch < cm.getLine(from.line).length) {\n          var pos = {\n            line: to.line,\n            ch: to.ch + 1\n          };\n          var chr = cm.getRange(to, pos);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        return true;\n      } else return false;\n    }\n\n    function boundariesAround(stream, re) {\n      return (!stream.start || !re.test(stream.string.charAt(stream.start - 1))) &&\n        (stream.pos == stream.string.length || !re.test(stream.string.charAt(stream.pos)));\n    }\n\n    function makeOverlay(query, hasBoundary, style) {\n      return {\n        token: function(stream) {\n          if (stream.match(query) &&\n              (!hasBoundary || boundariesAround(stream, hasBoundary)))\n            return style;\n          stream.next();\n          stream.skipTo(query.charAt(0)) || stream.skipToEnd();\n        }\n      };\n    }\n  });\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1511185962372","id": ".E","type": "js","data": "// Editor\n({\n  //id:\"cw.Manifest.Editor2\",\n  params:{restyle:200},\n  require:[{\n    \"UglifyJS\":\"lib/uglify.js\"\n  }],\n\n  inherit:['db', 'RT'],\n\n  //#####    Default data   ######\n\n  data:{ \n    name:'', \n    title:'',\n    version: '0',\n    build: 1,\n    com:[],\n    pic:'',\n    _type:['manifest'],\n    _err:[], \n    _search:'',\n    _cmd:[],\n    _opts:{\n      compileTo:[\"js\"], runWidth:\"800\", runMode:[\"modal\"],\n      runCss:\"\", runId:\"manifest-preview\"\n    }, \n    _src:'' \n  },\n  _src:\"\", \t\t\t//compiled source\n  _preview:\"\",\t// compiled source for preview\n  Item:{\n    stamp:0, id:\"Root\", type:\"js\", \n    data: \"({})\", active: true, opts:[]\n  },\n  Mode:{\n    saveToLs:false,\n    previewParent:\"#cw-body\",\n    fullscreenStyle:\"padding:30px; min-width:150px;\"\n  },\n  Editors:[],\n  Collapsed:[],\n  getCollapsed:function(){return this.Collapsed;},\n  searchRe:null,\n  getSearchRe:function(){return this.searchRe;},\n\n  // - - - - - - - - - - -\n\n  GetTabHash: function(item, idx) {\n    var that = this;\n    return cw.lib.sdbm([\n      Object.reject(item, 'data'),\n      that.Collapsed,\n      item.id=='Root'?that.data.title:'',\n      that.searchRe?that.data._search:''\n    ]);\n  },\n  GetTabId: function(e){return e.stamp + e.id},\n\n  // - - - - - - - - - - -\n\n  Postfix: function(){return {}},\n  Prefix: function(){return {}},\n\n  // - - - - - - - - - - -\n  \n  RTE: function(key){\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t},\n  \n  // - - - - - - - - - - -\n\n  TabCollapse:function (reflist) {\n\n    // Re-builds collapse list for tabs\n\n    var that = this,\n        curr = that.Collapsed,\n        coll = curr.reduce(function(a,b,i){a[b[0]] = i;return a;},{}),\n        res = [],\n        c;\n\n    // Need optimization!\n\n    c= (reflist || that.data.com.map(function(e){return e.id}))\n    .sortBy()\n    .reduce(function(a,b){\n      var ins = -1;\n      if(!a.a[b]) {\n        var k = Object.keys(a.a);\n        k.forEach(function(e,i){\n          if (ins==-1 && b.startsWith(e+\".\")) ins=i;\n        });\n      }\n      if (ins>-1) {\n        a.coll[k[ins]] = (a.coll[k[ins]] || 0)+1;\n      }\n      else a.a[b]=0;\n      return a;\n    },{a:{},coll:{}})[\"coll\"];\n\n    Object.keys(c)\n    .forEach(function(k){\n      if (k in coll) res.push([k, curr[coll[k]][1], c[k]]);\n      else res.push([k, false, c[k]]);\n    });\n\n    that.data.collapsed = res.map(function(e){\n      if (e[1]) return e[0];\n    }).compact();\n\n    return that.Collapsed = res;\n\n  },\n\n  // - - - - - - - - - - -\n\n  Build: function (buildPreview) {\n    var that=this,\n        d = that.data,\n        opts = that.Types, \n        err=[], r={}, p={}, \n        row, ext, conv, a;\n    if (Object.isFunction(that.Prefix)) $.extend(true, r, that.Prefix());\n\n    if (buildPreview) $.extend(true, p, r);\n\n    for (var i=0;i<d.com.length;i++) {\n      row = d.com[i];\n      ext = {};\n\n      conv = opts[row.type].compile || function(s){return [[], s||\"\"];};\n      a = conv(row.data);\n\n      if (a[0].length) err.push(\"Invalid ‘\"+row.id+\"’. \"+a[0].join(\"; \")+\".\");\n      if (a[1]!==undefined) {\n        if (row.id.to(1)===\".\") {\n          ext = cw.lib.unmask(a[1], row.id.from(1));\n        } else {\n          ext = a[1];\n        }\n      }\n\n      if (buildPreview) $.extend(true, p, ext);\n      if (!row.opts || row.opts.indexOf(\"nocompile\")===-1) $.extend(true, r, ext);\n    }\n\n    if (Object.isFunction(that.Postfix)) {\n      var tmp = that.Postfix()||{};\n      if (buildPreview) $.extend(true, p, tmp);\n      $.extend(true, r, tmp);\n    }\n\n    d._err = err;\n\n    //that._src = \"(\"+this.js2txt(r,'\\t')+\")\";\n\n    that._src = JSON.parse(cw.lib.json(r));\n\n    if (buildPreview) that._preview = \"(\"+this.js2txt(p,'\\t')+\")\";\n\n    r = p = ext = null;\n\n    return err;\n  },\n\n  // - - - - - - - - - - -\n\n  ParseJS:function (s, clean) {\n\n    var g=s,\n        u = UglifyJS, \n        ast,\n        res ={\n          globals:[],\n          errors:[]\n        },\n        gl;\n    try{\n      ast = u.parse(s+\"\");\n    } catch (e) {\n      res.errors.push (e.message+\" @\"+e.line+\":\"+e.col)\n    }\n    if (ast) {\n      ast.figure_out_scope();\n      if (Object.isObject(gl = ast.globals) && gl._size) {\n        Object.keys(gl._values)\n        .forEach(function(i){\n          res.globals.push(gl._values[i].name);\n        });\n        res.globals.sort();\n        if (clean) {\n          res.globals = [].remove.apply(\n            res.globals,\n            (\"String Function Date Math Number Object Array RegExp isNaN undefined parseInt parseFloat \"\n             +\"isFinite\").split(\" \")\n          );\n        }\n      }\n    }\n    return res;\n  }\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1511186006055","id": ".E.init","type": "js","data": "(function ($form) {\t\n\tvar that = this,\n      d = that.data;\n\t\n  //$form.formgen('init',this.HTML);\t\n\n\tthis.js2txt = cw.lib.js2txt;\n\t\n\t$.extend (this.Ed, {NewTab: Object.clone(this.NewTab, true), Types: this.Types});\n\t\n\t$.extend(this.Tab, {Types: this.Types});\n\n\tif (this.Mode.saveToLs) {\n\t\t// Saved?\n\t\tvar ls = localStorage, old = ls.getItem(\"Manifesto\");\n\t\tif (old) Object.merge(d, JSON.parse(old));\n\t\t// localStorage saver\n\t\t$form.then(function(){\n\t\t\t$form.on(\"change\", function (){\n\t\t\t\tls.setItem(\"Manifesto\", JSON.stringify($form.my(\"data\")));\n\t\t\t}.debounce(500));\n\t\t});\n\t}\n\t\n\tif (d._preview!==void 0) delete d._preview;\n\t\n\tif (!d.com) d.com = [];\n\td.com = d.com.map(function(e){\n\t\tif (!Object.isObject(e) || !e.id || !(\"data\" in e)) return null;\n\t\tif (!that.Types[e.type]) e.type=\"text\";\n\t\treturn e;\n\t}).compact(true);\n\tif (!d.com.length) {\n\t\td.com.push(Object.clone(this.Item, !0));\n\t\td.com[0].stamp = Date.now()+\"\";\n\t\td.com[0].data = that.NewAppSrc;\n\t}\n\t\n\td._src=\"\";\n\t\n\tvar act = d.com.find(function(e){return e.active}) || d.com[0];\n\tact.active = true;\n\tthis.Editors.push(act);\t\n\t\n\t// Remove tab\n\t\n\t$form.on(\"removetab.my\", function(evt, data){\n\t\tvar t = d.com, e = that.Editors;\n\t\tt.removeAt(t.indexOf(data));\n\t\te.removeAt(e.indexOf(data));\n\t\tt[0].active=true;\n\t\t\n\t\tthat.TabCollapse();\n\t\t$form.find(\"#coms,#eds\").trigger(\"recalc\");\n\t});\n\t\n\t// Tab Collapser\n\tif (d.collapsed) that.Collapsed = d.collapsed.map(function(e){return [e, true,1]});\n\tthat.TabCollapse();\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1511186031120","id": ".E.ui","type": "js","data": "// List and ed\n({\n  \"#coms\":{\n\n    bind: \"com\",\n    check:true,\n    init: function($o , form) {\n      var d = form.data,\n          that = this;\n\n      $o.sortable({handle:\"#xtitle\"});\n\n      // Switch tab\n\n      $o.on(\"switch.my\", function(evt, data){\t\n        var $f = $(this).my().root,  e = that.Editors, i = 0;\t\t\t\n        for (;i<d.com.length;i++) d.com[i].active=!1;\n        data.active = !0;\t\n        if (e.indexOf(data)===-1) e.unshift(data);\n        try { that.TabCollapse(); \t} catch(e) { console.log(e) }\n        return false;\n      });\n\n      // Fold/unfold tabgroups \n\n      $o.on(\"click.my\",\".fold\", function(){\n        var id = $(this).parents('.my-form').eq(0).my(\"data\").id;\n        var e = that.Collapsed.find(function(e){\n          return e[0]==id;\n        });\n        if (e) {\n          e[1]=!e[1];\n          $o.trigger(\"recalc\");\n        }\n      }.debounce(10));\n\n    },\n    manifest: \"Tab\",\n    hash: \"this.GetTabHash\",\n    id: \"this.GetTabId\",\n    list:'>div',\n    delay:20,\n    watch:'#tab-search'\n    /*css:{\n      \"lh160 mb10\":function(d){\n        return d.com.length>10;\n      },\n      \"fs90\": function(d){\n        return d.com.length>10 && d.com.length < 21;\n      },\n      \"fs85\": function(d){\n        return d.com.length>20;\n      }\n    }*/\n  },\n\n  \"#eds\":{\n    bind:\"this.Editors\",\n    watch:\"#coms\",\n    recalc:\"#coms\",\n    recalcDepth:1,\n    manifest:\"Ed\",\n    hash: \"GetTabHash\",\n    id: \"GetTabId\",\n    list:'<section></section>',\n    delay:110,\n    init: function($o){\n      // Color Picker magic\n      if ($.my.cache(\"cw.Sys.Colorpicker\")) {\n        $o.on(\"contextmenu.my\",\".cm-csscolor\", function(evt){\n          var $i = $(evt.currentTarget),//$(this),\n              c = $i[0].innerText+\"\",\n              cm = $i.parents(\"section\").find(\"#cm\").next()[0].CodeMirror,\n              x = evt.pageX,\n              y = evt.pageY,\n              up = $(window).height()/2>y;\n\n          $i.modal({\n            width:272,\n            css:\"p0\",\n            manifest:$.my.cache(\"cw.Sys.Colorpicker\"),\n            data:{css:c},\n            align:up?\"top:100%\":\"bottom:140%\",\n            nose:up?\"top\":\"bottom\",\n            screen:\"rgba(255,255,255,0.5)\",\n            esc:true,\n            enter:true,\n            close:false,\n            focus:\"#cprgb\"\n          })\n          .then(function(picker){\n            //console.log(res);\n            var co = cm.coordsChar({left:x, top:y}),\n                line = co.line,\n                idx = co.ch,\n                cd = cm.getDoc(),\n                s = cd.getLine(line),\n                sl = s.length,\n                res = s;\n            for (var i=idx; i>-1; i--) {\n              var s0 = s.substr(i);\n              if (s0.startsWith(c)) {\n                res = s.to(i) + s0.replace(c, picker.css.toLowerCase());\n                break;\n              }\n            }\n            cd.replaceRange(res, {line:line, ch:0}, {line:line, ch:sl})\n            //$i.text(picker.css).trigger(\"input\");\n          });\n          return false;\n        });\n      }\n    }\n  },\n\n\n  \"#warnM\": {\n\n    // Builds and validates entire manifest\n\n    bind: function(d,v,$o){\n\n      var err = this.Build (false);\n\n      if (err.length) $o.my(\"find\",\".validate\").addClass(\"red\");\n      else $o.my(\"find\",\".validate\").removeClass(\"red\");\n\n      $o.trigger(\"change\");\n    },\n    watch:\"#eds\",\n    delay:150\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1511186038848","id": ".E.ui","type": "js","data": "// Preview gen\n\n({\n  '#tab-search':{\n    delay:150,\n    bind:function(d,v){\n      var that = this;\n      if (v!=null) {\n      \td._search = v;\n      }\n      if (d._search.length < 2) that.searchRe = null;\n      else that.searchRe = new RegExp('('+RegExp.escape(d._search)+')', 'i');\n      return d._search;\n    },\n    css: { \t\"my-search\": /^.{2,}$/ }\n  },\n  \n  '#btn-run':{\n    delay:150,\n    bind:function (d,v,$o){\n      var $r, $e, $p, dui, ref, doc, parentapp, _prefix, that=this, runnow=true;\n      if (v!=null) {\n        that.Build (true);\n        if (d._err.length) cw.lib.note(d._err.join(\"<br>\"),\"error\");\n        else {\n          $r = $o.my().root;\n          if ($r) dui = $r.my().dui;\n\n          if (dui) {\n            ref = dui.bind.split(\".\").to(-1).join(\".\");\n            doc = $.my.f.getref($r.my().ddata, ref);\n            if (doc && Object.isObject(doc._attachments) && Object.size(doc._attachments)) {\n              // try read attaches\n              parentapp = $r.my().root.data(\"app\");\n              if (parentapp && parentapp.db && parentapp.db.load) {\n                runnow = false;\n                parentapp.db.load(doc._id, true)\n                .then(function(res){\n                  if (res._attachments) _prefix = {files:res._attachments};\n                  _runPreview();\n                })\n              } \n            }\t\n          } \n          if (runnow) _runPreview();\n        }\n      }\n\n      function _runPreview(){ \n        // Preview in modal\n        if (d._opts.runMode==\"modal\") {\n          var $r = $o.parents(\"#manedframe\").eq(0);\n          $r.modal({\n            root:$r.parent(),\n            manifest: that.Preview,\n            data:{\n              _opts:d._opts,\n              _src:that._preview,\n              _prefix:_prefix,\n              _subs:that.Subs,\n              _db:that.db\n            },\n            width:d._opts.runWidth||1000,\n            esc:true,\n            global:false,\n            css:'pl15 pr15 pb15 pt0',\n            //screen:'rgba(255,255,255,0.5)',\n            drag:'#app-editor-preview-drag'\n          }).then(function(r){\n            //Object.merge(d._opts,r,true)\n          })\n          /*.fail(function(res){\n\t\t\t\t\tcw.lib.note(\"Preview failed to init. \"\n\t\t\t\t\t\t+\"See console for details\", \"error\");\n\t\t\t\t});*/\n        }\n\n        // Preview fullscreen\n        else if (d._opts.runMode==\"fullscreen\") {\n          $p = $(that.Mode.previewParent||\"body\");\n\n          $p.find(\">*:visible\").each(function(){\n            var $t = $(this);\n            if (\n              !$t.is(\".my-modal\")\n              && !$t.is(\".my-modal-screen\")\n              && !$t.is(\".my-modal-proxy\")\n            ) $t.addClass(\"hide my-manifesto-preview-hide\");\n          });\t\t\n\n          $e = $(\n            '<div class=\"my-manifesto-preview-run db\" '\n            +'style=\"'+that.Mode.fullscreenStyle\n            +';\"></div>'\n          );\n\n          $e.appendTo($p)\n          .my(that.Preview, {\n            _opts:d._opts,\n            _src:that._preview,\n            _prefix:_prefix,\n            _subs:that.Subs,\n            _db:that.db\n          }).fail(function(){\n            cw.lib.note(\"Preview failed to init. \"\n                        +\"See console for details\", \"error\");\n            _kill();\n          }.debounce(50));\n          $e.on(\"cancel.my\", _kill.debounce(50));\n\n        }\n      }\n\n      function _kill (){\n        try {\n          $e.my(\"remove\");\n        } catch (e) {}\n        $e.unbind(\".my\");\n        $e.remove();\n        $p.find(\".my-manifesto-preview-hide\")\n        .removeClass(\"hide my-manifesto-preview-hide\");\n      }\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1511186048895","id": ".E.ui","type": "js","data": "({\n  \"#btn-add\":{\n    bind: function (d,v,$o){\n      var that=this;\n      if (v!=null) {\n        if (!$o.data(\"modal\")) $o.modal({\n          manifest:that.NewTab,\n          data:{},\n          esc: true,\n          enter:true,\n          root:that.my.root(),\n          align:\"top:90%;left:0;\",\n          bound:0,\n          // css:\"mt10\", \n          nose:\"top\",\n          screen:'rgba(255,255,255,0.5)'\n        }, function (e){ \n          return !!(e && Object.size(e)) \n        }).then(function(r){\n          $o.my(\"find\",\"#coms\").trigger(\"insert\", {\n            where:1e6,\n            what:r.result\n          });\n          that.TabCollapse();\n        });\n        else $o.modal(true);\n      }\n    },\n    events:\"click.my\"\n  },\n\n  \"#btn-compile\": {\n    delay:50,\n    bind: function (d,v,$o){\n      var that = this;\n      if (v!=null) {\n        if (d._err.length) cw.lib.note(d._err.join(\"<br>\"),\"error\");\n        else {\n          $o.modal({\n            manifest: $.extend({ParseJS:that.ParseJS}, that.Compiler),\n            data:{\n              _src:that._src,\n              opts:d._opts.compileTo,\n              Subs:that.Subs\n            },\n            width:850,\n            esc:true,\n            enter:true,\n            //global:true,\n            screen:'rgba(255,255,255,0.5)',\n            align:\"top:90%;left:-74px\",\n            nose:'top'\n\n          }).then(function(r){\n            d._opts.compileTo=r.opts.slice(0);\n          })\n          .always(function(){\n            that.my.find(\"#warnM\").trigger(\"check\");\n          });\n        }\n      }\n    }\n  },\n\n  \"#btn-docopts\": {\n    delay:50,\n    bind: function (d,v,$o){\n      var that = this;\n      if (v!=null) {\n        //console.log(that.RT('data'))\n        var man = that.Opts;\n        $o.modal({\n          manifest: $.extend(true, {}, man),\n          data:$.extend(\n            true, \n            {}, \n            Object.select(d, Object.keys(man.data)),\n            {_tags:(that.RT('data').editor.tags || []).slice(0)}\n          ),\n          width:350,\n          esc:true,\n          css:'pt15',\n          screen:'rgba(255,255,255,0.5)',\n          align:\"top:90%;left:-148px\",\n          nose:'top'\n        })\n        .then(function(r){\n          Object.merge(d, Object.reject(r, ['_tags']));\n          that.RT('data').editor.tags = r._tags || [];\n          that.my.recalc('#coms');\n        });\n      }\n    },\n    css:{\n      'self:red':function(d){\n      \treturn d.title.length < 3 || !/^[A-Z][A-Za-z0-9]{1,24}(\\.[A-Za-z0-9]{1,25}){0,4}$/.test(d.name);\n      }\n    },\n    watch:'#coms'\n  },\n\n  '#btn-close':{\n    bind: function(d,v){\n      if (v!=null) this.my.cancel();\n    }\n  },\n\n  '#btn-save':{\n    bind: function(d,v){\n      var that = this;\n      if (v!=null) {\n        that.RT('SaveDoc')();\n      }\n    }\n  },\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1511186136233","id": ".E.Ed","type": "js","data": "// Editor block\n({\n  id:\"cw.Manifesto.CM\",\n  params:{restyle:200},\n  inherit:['getSearchRe','RTE'],\n  init: function ($o, form){\n    $o.html([\n      '<div style=\"position:absolute;top:7px;right:7px;z-index:+5\">',\n      \t'<button  id=\"btn-opts\" class=\"button fs90\"><span class=\"fi-widget\"></span></button>',\n      '</div>',\n      \n      //'<div id=\"found\" class=\"w200 hide\" style=\"position:absolute;top:10px;right:50px;z-index:+5;\"></div>',\n      '<div id=\"found\" '\n        +'class=\"w300 hide fs80 bg-yellow2 o80 br2 pl6 pr4 gray0 lh150 hoverlink\" '\n        +'style=\"position:absolute;top:5px;right:45px;z-index:+5;\">',\n      '</div> ',\n      '<div><textarea id=\"cm\"></textarea></div>',\n      '<div class=\"warn hide\"></div>'\n    ].join(\"\"))\n    //console.log(form)\n  },\n  \n  ui: {\n    \"#cm\": {\n      bind:\"data\",\n      init: function($o, form){\n        var that = this,\n            opts = that.Types[form.data.type];\n        \n        CodeMirror.fromTextArea($o[0], {\n          mode:\t\t\t\t\t\topts.CM.mode,\n          lineNumbers:\t\ttrue,\n          indentWithTabs:\tfalse,\n          indentUnit:\t\t\t2,\n          tabSize:\t\t\t\t2,\n          theme: \t\t\t\t\topts.CM.theme || 'default',\n          extraKeys: {\n            'Ctrl-S':\tfunction(){$o.trigger('savemanifest.my');},\n            'Cmd-S':\tfunction(){$o.trigger('savemanifest.my');},\n            'Ctrl-F':\t_setSearch,\n          \t'Cmd-F':\t_setSearch\n          },\n          styleSelectedText:true,\n        \thighlightSelectionMatches: {minChars:3, /*showToken: /\\w/,*/ annotateScrollbar: true}\n        });\n        \n        // - - - - - - - -\n      \n        function _setSearch(){\n          var s = $o[0].nextSibling.CodeMirror.getSelection();\n          if (s.length>2) {\n            that.RTE('data')._search = that.RTE('data')._search==s?'':s;\n            that.my.parent().my.recalc('#tab-search');\n          }\n        }\n      },\n      delay:30,\n      css:{\n        \"hide\":function(d){return !d.active}\n      }\n    },\n    \n    '#found':{\n      delay:200,\n      bind:function(d,v){\n      \tvar that = this,\n            re = that.getSearchRe(),\n            html = '',\n            lines = [];\n        if (re) {\n          //br2 bg-yellow2\n          d.data.lines().forEach(function(e, i){\n          \tif (re.test(e)) lines.push(i+1);\n          });\n          if (lines.length) {\n            html = [\n              '<div class=\"w100p oh lh140 pl5 pr5 bg-yellow2 br2 fs90 o80 gray0\">',\n              '<span class=\"fi-magnifying-glass fs90 o70\"></span> ',\n              lines.join(', '),\n              '</div>'\n             ].join('');\n          }\n        }\n        return html;\n      },\n      css:{\n        hide:function(){return !this.getSearchRe();}\n      },\n      watch:'#cm'\n    },\n    \n    '#found':{\n      delay:200,\n      init: function($o){\n        var that = this;\n        // highlight and scroll to found line\n        $o.on('click.my','.pseudolink', function(){\n          var line = +$(this).text(),\n              ed = that.my.find('#cm').next()[0].CodeMirror;\n\n          ed.scrollIntoView({line:line, char:1}, 48);\n\n          var f = function(){\n            ed.addLineClass(line-1,'background','bg-yellow4');\n            (function(){\n              ed.removeLineClass(line-1,'background','bg-yellow4');\n            }.debounce(100))()\n          };\n\n          f.debounce(100)();\n          f.debounce(300)();\n        });\n      },\n      bind: function(d){\n        var that = this,\n            re = that.getSearchRe(),\n            lines = [];\n        if (re && d.active) {\n          d.data.lines().forEach(function(l, i){\n            if (re.test(l)) lines.push(i+1);\n          });\n          if (lines.length) {\n            return '<div class=\"pt4 pb4\"><span class=\"fi-magnifying-glass fs90 o70\"></span> Found @ '+lines.map(function(e){\n              return '<span class=\"pseudolink\">'+e+'</span>';\n            }).join(', ')+'</div>';\n          }\n        }\n        return '';\n      },\n      css:{\n        hide:function(){return !this.getSearchRe();}\n      },\n      watch:'#cm'\n    },\n\n    '#btn-opts':{\n      bind:function(d,v,$o){\n        if (null!=v) {\n          $o.modal({\n            manifest: Object.merge(\n              this.NewTab,\n              {\n                Opts:{apply:\"Save\", title:\"Tab settings\", del:\"Del tab\"},\n                style:{\" #xtype\":\"display:none;\"}\n              }\n            ),\n            data:{result:Object.clone(d,true)},\n            width:400,\n            align:\"top:0px,right:0px\", css:\"fs90\", xnose:\"top\"\n          }).then(function(r){\n            if (r.op === \"Del\") {\n              $o.trigger(\"removetab\", d);\n              //$o.trigger(\"remove\");\t\n            } else if (r.op === \"Save\") {\n              Object.merge(d, Object.reject(r.result, [\"data\",\"stamp\",\"type\"]));\n              $o./*my(\"find\",\".warn\").*/trigger(\"change\");\n            }\n          }.debounce(50));\n        }\n        //if (d.id.to(1)!==\".\") $o.addClass(\"hide\");\n      }\n    },\n\n    \".warn\":{\n      bind: function(d,v,$o){\n        var  row = d, ext = {}, ins={}, err=[];\n\n        var $r, cmp = this.Types[d.type].compile,\n            a = cmp?cmp(d.data):[[], d.data],\n            err=a[0].slice(0);\n\n        if ((d.err||[]).length!=err.length) {\n          d.err = err;\n          $o.trigger(\"change\");\n        }\n        else d.err = err;\n        $r = $o.my().root;\n        $r.toggleClass(\"hide\", !d.active);\n        $r.toggleClass(\"ed-error\", !!err.length);\n\n      },\n      watch:\"#cm\",\n      delay:70\n    }\n  },\n  \n  style:{\n    \" #btn-opts\":\"border-radius:100px;padding:5px 7px;\"\n    +\"transition: opacity 0.3s;opacity:0.5;\"\n    +\"margin:0px!important;line-height:0.95em;\",\n    \" #btn-opts:hover\":\"opacity:1;\",\n    \" .CodeMirror \": function($o){\n      var ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n          pad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n          tab = 0, //$o.parents(\".my-manifest-1a9u4bgu\").find(\"#coms\").outerHeight(true),\n          css = \"height:\"+($(window).height()-(pad+ofs+tab+15))+\"px;\";\n      return css;\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186157966","id": ".E.Tab","type": "js","data": "// List elt\n\n({\n  id:\"Manifest.Editor.Tab\",\n  inherit:[\"getCollapsed\", \"ParseJS\",'RT','getSearchRe'],\n  Colors:{\n    blue:[\"rgb(14, 85, 163)\", \"rgba(142, 211, 255, 0.25)\"],\n    red:[\"#A3293D\", \"rgba(255, 200, 200, 0.75)\"],\n    green:[\"rgb(75, 129, 1)\",\"#E3F3CB\"],\n    teal:[\"#07AB8F\", \"rgba(198, 252, 234, 0.67)\"],\n    orange:[\"#F77400\",\"rgb(255, 227, 185)\"],\n    violet:[\"rgba(109, 37, 179, 0.9);\", \"rgba(210, 142, 255, 0.25);\"]\n  },\n  ui:{\n    \"#xtitle\":{\n      bind: function(d,v,$o){\n        var that = this,\n            Coll=false,\n            clr = d.color?d.color+\"\":\"\",\n            colors = that.Colors;\n        if (clr) {\n          $o.css({ color:colors[clr][0] });\n          if (d.active) { $o.css({ \"background-color\":colors[clr][1] }); } \n          else { \t$o.css({ \"background-color\":\"\" }); }\n        }\n        else $o.css({ color:\"\", \"background-color\":\"\" });\n\n        $o.css({opacity:d.active?\"1\":\"0.7\"});\n      },\n      css:{ \n        \"active\": function(d){ return d.active },\n        \"bold fs105\" : function (d){ return (d.id||\"\").to(1)!==\".\"},\n        \"itl\": function (d){ return (d.opts||[]).indexOf(\"nocompile\")>-1},\n        \"haserror\": function(d) {return d.err && d.err.length}\n      },\n      watch:\"#title\"\n    },\n    \".fold\":{\n      //delay:200,\n      bind:function(d,v,$o){\n        var that = this, \n            $p, re, found = true,\n            html=\"\";\n\n        if (v==null) {\n          $p =that.my.root();\n          re = that.getSearchRe();\n\n          if (re) {\n            if (!re.test(d.id) && !re.test(d.data)) {\n              found = false;\n              html = '';\n            }\n            $p.toggleClass(\"w00\", !found);\n          }\n          else {\n\t\t\t\t\t\tfound = false;\n            that.getCollapsed()\n            .forEach(function(e){\n              if (d.id==e[0]) {\n                html = e[1] ? '<span class=\"fs120\">▸</span>'+e[2] : '<span class=\"fs120\">▾</span>'+e[2];\n              }\n              else if (d.id.startsWith(e[0]+\".\")) {\n                var folded = !!$p.is(\".w00\");\n                $p.toggleClass(\"w00\", !!e[1] && !d.active);\n                found = true;\n                if (folded) {\n                  $p.css({\"background-color\":\"rgba(255,240,0,0.5)\"});\n                  (function(){$p.css({\"background-color\":\"rgba(255,255,255,0)\"});}).delay(150);\n                }\n              }\n            });\n            if (!found) $p.removeClass(\"w00\");\n          }\n          return html;\n        }\n        else return v;\n      }\n    },\n    \"#title\":{\n      bind:function(d,v,$o){\n        var that = this;\n        if (null != v) {\n          if (!d.active) $o.trigger(\"switch\", d);\n          else if (d.err && d.err.length) {\n            var e = that.ParseJS(\"(\"+d.data+\")\");\n            d.err = e.errors;\n            $o.modal({\n              root:$o.my().root.parents(\".my-form\").eq(0),\n              width:250,\n              nose:\"top\",\n              bound:0,\n              align:\"top:120%;\",\n              esc:true,\n              enter:true,\n              manifest:{\n                init:['<span id=\"t\" class=\"red o80 fs85 lh150\"></span><input type=\"text\" class=\"di fs50 o0 w00 mt0 mb0\"/>'],\n                ui:{\"#t\":\"t\",\"input\":\"x\"}\n              },\n              data:{t:e.errors.join(\"<br>\")},\n              screen:'rgba(255,255,255,0.5)'\n            })\n          }\n        }\n        var s = (d.id == 'Root'?that.RT('data').editor.raw.title:'') || d.id,\n            sl = s.replace(/[^\\.]/g,'').length;\n        if (sl>1) {\n          var hasParent = (that.getCollapsed() || []).find(function(e){\n          \treturn d.id.startsWith(e[0]+\".\");\n          });\n          if (hasParent) s = ('\\u00a0').repeat(sl*2-2)+s;\n        }\n        s+='\\u00a0';\n        \n        if (d.type == 'js' && d.data.to(2)=='//') {\n          var comments = d.data.split(/[\\r\\n]/, 10);\n          s += '<span class=\"gray0 fs90 o60 pl8\" title=\"{1}\">{2}</span>'.assign(\n            comments.filter(e=>/^\\s*\\/\\//.test(e)).map(e=>e.to(100).trimLeft().escapeHTML()).join('\\n'),\n            comments[0].truncate(50,'right','…').escapeHTML()\n          );\n        }\n        \n        return s;\n      },\n      events:\"click.my\",\n      init: function($o, form){\n        var d = form.data;\n        $o.parent().parent().find(\".ctype\")\n        .addClass(this.Types[d.type].css||\"hide\");\n      }\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186175348","id": ".E.NewTab","type": "js","data": "// New tab dlg\n({\n\tparams: {width:350},\n\tOpts:{apply:\"Create\", title:\"New tab\"},\n\tdata:{\n\t\troot:{},\n\t\tresult:{\n\t\t\t\"stamp\": 0,\n\t\t\t\"id\": \"\",\n\t\t\t\"type\": \"js\",\n\t\t\t\"data\": \"\",\n\t\t\t\"active\": false,\n\t\t\t\"err\":[],\n\t\t\t\"opts\":[],\n\t\t\t\"color\":[]\n\t\t},\n\t\top:\"Save\"\n\t},\n\tinit: function($o , form){\n\t\t$o.formgen(this.HTML);\n\t\tform.data.result.stamp = form.data.result.stamp || (Date.now()+\"\");\n\t},\n\tui:{\n\t\t\"#tabid\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (d.result.type==\"js\") d.result.data = \"({\\n\\n})\";\n\t\t\t\t\tif (d.result.type==\"html\") d.result.data = \"<div>\\n\\n</div>\";\n\t\t\t\t\td.result.id=v;\n\n\t\t\t\t}\n\t\t\t\treturn d.result.id;\n\t\t\t},\n\t\t\tcheck:/^(\\.[^\\.\\s\\t\\r\\n]+)+\\.?$/i,\n\t\t\terror:\"Branch name like .Branch or .Branch.Leaf\",\n\t\t\tdelay:100\n\t\t},\n\t\t\"#type\":{\n\t\t\tbind:\"result.type\",\n\t\t\tinit:function($o){\n        $o.select2({\n        \tminimumResultsForSearch:1e4\n        });\n\t\t\t},\n\t\t\twatch:\"#tabid\"\n\t\t},\n\t\t\"#ncolor\":{\n\t\t\tinit: function($o){\n\t\t\t\tvar clr = [\n\t\t\t\t\t{'<span class=\"blue\">✪</span>':'blue'},\n\t\t\t\t\t{'<span class=\"red\">✪</span>':'red'},\n\t\t\t\t\t{'<span class=\"orange\">✪</span>':'orange'},\n\t\t\t\t\t{'<span class=\"green\">✪</span>':'green'},\n\t\t\t\t\t{'<span class=\"teal\">✪</span>':'teal'},\n\t\t\t\t\t{name:'<span>✪</span>', value:'violet', css:\"violet\"}\n\t\t\t\t];\n\t\t\t\t$o.tags({tags:[clr], tagshim:\"\", tagcss:\"tag pt3 pl4 pb2 pr6 lh100 cp\"});\n\t\t\t},\n\t\t\tbind:\"result.color\"\n\t\t},\n\t\t'input[name=\"opts\"]': \"result.opts\",\n\t\t\"#btn-cancel\":function(d,v,$o){\n\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t},\n\t\t\"#btn-apply\":function(d,v,$o){\n\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\treturn this.Opts.apply;\n\t\t},\n\t\t\"#btn-del\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.op = \"Del\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn this.Opts.del||\"\";\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"hide\":function(){return !this.Opts.del}\n\t\t\t}\n\t\t},\n\t\t\"#title\": \"this.Opts.title\"\n\t},\n\tHTML:[\n\t\t'<h3 class=\"mb0\" id=\"title\"></h3>',\n\t\t{row:\"100%\",label:\"70px\", rowCss:\"my-row pt10 pb2\", labelCss:\"xgray fs85 lh110\"},\n\t\t[\"\", \"inp#tabid.fs120\",{plc:\"Property name\"}, \"msg\"],\n\t\t[\"Type\", '<span id=\"xtype\" class=\"mr20\">','sel#type.w140.mt-3',\n\t\t {vals:[\"js\", \"html\", \"text\", \"css\"]},\n\t\t '</span><span>',\n\t\t '<label class=\"fs90 xgray dib\">',\n\t\t '<input type=\"checkbox\" value=\"nocompile\" name=\"opts\"/>',\n\t\t ' Preview only</label>'],\n\t\t[\"Tab color\", '<span id=\"ncolor\" class=\"fs110 lh110\"></span>'],\n\t\t{rowCss:\"my-row mt10 pt10 btd fs90\"},\n\t\t[\"\", \n\t\t \"btn#btn-apply.green.mr5\",{val:\"Create tab\"}, \n\t\t '<span class=\"fr\">', \"btn#btn-del.red.mr0\",{val:\"Delete\"}, '</span>',\n\t\t \"btn#btn-cancel\",{val:\"Cancel\"}\n\t\t]\n\t],\n\tstyle:{}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186237112","id": ".E.Compiler","type": "js","data": "// Compiler dlg\n({\n\tinit:function ($o){ \n\t\t$o.formgen(this.HTML); \n\t},\n\tAbout:{},\n\tStats:0,\n\tui:{\n\t\t\"#opts\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tjsmin = cw.lib.jsmin, \n\t\t\t\t\t\ttoj = $.my.tojson;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tvar i = cw.lib.a2o(v),\n\t\t\t\t\t\t\t//_src = d._src;\n\t\t\t\t\t\t\t_src;\n\t\t\t\t\t\n\t\t\t\t\tif (i.childs) {\n\t\t\t\t\t\t//_src = \"(\"+cw.lib.js2txt($.extend(!0, eval(d._src), d.Subs()),'\\t')+\")\";\n\t\t\t\t\t\t_src = \"(\"+cw.lib.js2txt($.extend(!0, cw.lib.unjson(d._src), d.Subs?d.Subs():{}),'\\t')+\")\";\n\t\t\t\t\t} \n\t\t\t\t\telse {\n\t\t\t\t\t\t_src = \"(\"+cw.lib.js2txt(cw.lib.unjson(d._src),'\\t')+\")\";\n\t\t\t\t\t}\n\t\t\t\t\t//else _src = d._src;\n\t\t\t\t\t\n\t\t\t\t\tif (i.json) d.src = toj(eval(_src), '\\t');\n\t\t\t\t\telse if (i.cjson) d.src = toj(eval(jsmin(_src)));\n\t\t\t\t\telse if (i.jsmin) d.src = jsmin(_src);\n\t\t\t\t\telse if (i.uglify) {\n\t\t\t\t\t\t// compress and uglify \n\t\t\t\t\t\tvar u = UglifyJS,\n\t\t\t\t\t\t\t\tast = u.parse(_src);\n\t\t\t\t\t\tast.figure_out_scope();\n\t\t\t\t\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\t\t\t\t\tast.figure_out_scope();\n\t\t\t\t\t\t// No char freq opt to avoid \n\t\t\t\t\t\t// different results from the same code\n\t\t\t\t\t\t//ast.compute_char_frequency();\n\t\t\t\t\t\tast.mangle_names();\n\t\t\t\t\t\td.src = ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>').replace(/;$/,'');\n\t\t\t\t\t}\n\t\t\t\t\telse d.src=_src;\n\t\t\t\t\t\n\t\t\t\t\tthis.Stats = unescape(encodeURIComponent(d.src)).length;\n\t\t\t\t\tthis.About = this.ParseJS(\"(\"+(i.json||i.cjson?_src:d.src) +\")\", true);\n\n\t\t\t\t\td.opts = v;\n\t\t\t\t\tif (!d.opts.length || d.opts+\"\"==\"childs\") d.opts.push(\"js\");\n\t\t\t\t}\n\t\t\t\treturn d.opts;\n\t\t\t},\n\t\t\tinit: function ($o, form) {\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{\"JS object\":\"js\"},\n\t\t\t\t\t\t\t{\"JS min\":\"jsmin\"},\n\t\t\t\t\t\t\t{\"JS ugly\":\"uglify\"},\n\t\t\t\t\t\t\t{\"JSON\":\"json\"},\n\t\t\t\t\t\t\t{\"JSON min\":\"cjson\"}\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{\"Include childs\":\"childs\"}\n\t\t\t\t\t\t]\n\t\t\t\t\t], \n\t\t\t\t\tgroupshim:' &nbsp;<span class=\"orange\">|</span>&nbsp; '\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t\"#critic\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tvar a=[];\n\t\t\t\ta.push( '<span class=\"gray fs90 w90 dib\">Globals</span> '+((this.About.globals||[]).join(\", \")||\"—\") );\n\t\t\t\treturn a.join(\"<br>\");\n\t\t\t},\n\t\t\twatch:\"#opts\"\n\t\t},\n\t\t\"#src\":{\n\t\t\t//delay:100,\n\t\t\tinit: function ($o){\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode:\"javascript\",\n\t\t\t\t\tlineNumbers:\t\ttrue,\n\t\t\t\t\tindentWithTabs:\tfalse,\n\t\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\t\ttheme:\t\t\t\t\t'default',\n\t\t\t\t\treadOnly:\t\t\t\ttrue,\n\t\t\t\t\tlineWrapping:\t\ttrue\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"src\",\n\t\t\twatch:\"#opts\"\n\t\t},\n\t\t\"#stats\":{\n\t\t\tbind: function () {\n\t\t\t\treturn \"Code is \"+(this.Stats||0).bytes(2)+\" long.\"\n\t\t\t},\n\t\t\twatch:\"#opts\"\n\t\t},\n\t\t\"#btn-apply\": function(d,v,$o){if (null!=v) $o.trigger(\"commit\");},\n\t\t\"#btn-cancel\": function(d,v,$o){if (null!=v) $o.trigger(\"cancel\");}\n\t},\n\tstyle:{\n\t\t\" .CodeMirror\":\"font:13px Cousine,'PT Mono',Monaco,monospace;\"\n\t\t\t\t+\"overflow:scroll; height:300px;line-height:1.3em;\"\n\t\t\t\t+\"border:1px solid #cde;\"\n\t},\n\tHTML:[\n\t\t'<div id=\"stats\" class=\"fs80 gray fr mt3\"></div>',\n\t\t'<h3 class=\"dib vat mt0 mb15\">Compiler</h3>',\n\t\t'<div class=\"fs85 ml20 dib vat mt3\">',\n\t\t'<span id=\"opts\"></span>',\n\t\t'</div>',\n\t\t'<div><textarea id=\"src\"></textarea></div>',\n\t\t{rowCss:\"my-row pt15 fs90 fr\"},\n\t\t[\"\", \n\t\t \"btn#btn-apply.green.mr5\",{val:\"Remember mode\"}, \n\t\t \"btn#btn-cancel\",{val:\"Cancel\"}\n\t\t],\n\t\t'<div id=\"critic\" class=\"w600 fs80 lh130 dib vat mt15 xgray\"></div>'\n\t]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186258634","id": ".E.Preview","type": "js","data": "// Preview dlg\n({\n\tid:\"cw.Manifesto.Preview\",\n\tdata:{\n\t\t_runtime:{}\n\t},\n\tinit: function($o, form){\n\t\tvar d = form.data, \n\t\t\t\tp = d._opts, \n\t\t\t\tm = d._src,\n\t\t\t\tpi = $.Deferred();\n\t\t\n\t\ttry {\n\t\t\tthis.Manifest = $.extend({db:d._db},(d._prefix||{}),eval(d._src));\n\t\t\t$.extend(!0, this.Manifest, d._subs());\n\t\t} catch (err){\n\t\t\tconsole.log(err, err.stack)\n\t\t\tpi.reject(err);\n\t\t}\n\n    pi.then(function(){\n    \t$o.trigger('layout.my');\n    });\n\t\t\n\t\t$o.html(\n\t\t\t'<div id=\"btn-close\" class=\"'\n\t\t\t+(p.runMode==\"modal\"?\"hide\":\"\")\n\t\t\t+'\">×</div>'\n      +'<div id=\"app-editor-preview-drag\"></div>'\n\t\t\t+'<div id=\"'+p.runId+'\" class=\"app-editor-preview '\n\t\t\t+p.runCss+'\" style=\"margin:0 auto;width:'\n\t\t\t+d._opts.runWidth+'px\"></div>'\n\t\t);\n\t\tpi.resolve();\n\t\t\n\t\treturn pi.promise();\n\t},\n\tui:{\n\t\t\"#btn-close\": {\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (null!=v) {\t\t\t\t\t\n\t\t\t\t\tif (/^(full|modal)/.test(d._opts.runMode+\"\")) {\n\t\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t\t} \n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t\">.app-editor-preview:eq(0)\":{\n\t\t\tbind:\"_runtime\",\n\t\t\tmanifest:\"Manifest\"\n\t\t}\n\t},\n\tstyle:{\n    '>#app-editor-preview-drag':'width:100%;height:15px;cursor:move;',\n\t\t\">#btn-close\":\"position:absolute;top:0;right:0;cursor:pointer;\"\n\t\t+\"z-index:+100;font-size:50px;line-height:1em; padding:0 10px;\"\n\t\t+\"transition:color 0.3s; color:rgba(0,0,0,0.2);\",\n\t\t\">#btn-close:hover\":\"color:#c02\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186287128","id": ".E.Opts","type": "js","data": "// Man opts dlg\n({\n\t// Opts popup\n\tdata:{\n    _tags:[],\n\t\t_type:['manifest'],\n\t\t_cmd:[],\n\t\t_src:\"\",\n\t\t_desc:\"\",\n    _opts:{\n      compileTo:['js'], runWidth:'1024', runMode:['modal'],\n      runCss:'', runId:'manifest-preview'\n    },\n\t\tname:\t\t\t'',\n\t\tversion:\t'1',\n    build:\t\t'',\n\t\ttimeout:\t'3000',\n\t\ttitle:\t\t'',\n\t\tauthor:\t\t'',\n\t\tpic:\t\t\t'',\n\t\tico:\t\t\t'',\n\t\tmaskstate:'',\n\t\tnodetitle:'',\n\t\tnodedoc:\t'',\n\t\tnodecmd:\t'',\n\t\ttypes:\t\t'',\n\t\twidth:\t\t[],\n    padding:\t'auto'\n\t},\n  inherit:['RT'],\n\tIsApp:function (d) { return !(d._type.indexOf(\"app\")<0 && d._type.indexOf(\"editor\")<0);},\n\tIsEd:function (d) { return !(d._type.indexOf(\"editor\")<0);},\n  \n\tinit:function ($o) {\n    var that = this;\n\t\t$o.formgen(this.HTML);\n    $o.then((function(){\n    \tthat.my.check('#type');\n    }).debounce(50))\n\t},\n  \n  ParseRange: function(s0){\n    var ok = true,\n        s = s0.compact(true).split(/[\\s,]/).compact(true).map(function(v){\n          if (/-/.test(v)) {\n            var a = v.split('-').map(Number).compact(true);\n            if (a.length!=2) ok = false;\n            return a;\n          }\n          else {\n          \tvar n = +v;\n            if (isNaN(n)) ok = false;\n            return n;\n          }\n        });\n    if (!ok) return null;\n    return s;\n  },\n  \n  HTML:[\n    \n    // Left panel\n    \n    '<div class=\"w350 dib vat\">',\n    {row:\"100%\", label:\"75px\", rowCss:\"my-row pt0 pb5\", labelCss:\"fs85 gray\"},\n    [\"\", \"inp#title.w100p.fs110\", {plc:\"Component title\"}],\n    [\"\", '<div class=\"dib vat w65p\">', 'inp#name.w100p', {plc:\"IdName\"},'</div>',\n      '<div class=\"pl5 dib vat w15p\">', 'inp#ver.w100p', {plc:\"Ver\"},'</div>',\n     \t'<div class=\"pl5 dib vat w20p\">', 'inp#build.w100p', {plc:\"Build\"},'</div>'\n    ],\n    [\"\",\"txt#desc.fs80.w100p\",{plc:\"Short description\"},\"msg\"],\n    [\"\",\"inp#mtags.fs100.w100p\",\"msg\"],\n    {rowCss:\"my-row pt0 pb8\"},\n    [\"Type\",'spn#type.fs90'],\n    [\"Padding\",'spn#padding.fs90'],\n    {rowCss:\"my-row pt0 pb5\"},\n    ['Preview', \n\t\t 'num#runwidth.fs90.w65',{min:'300',max:'3000',step:'10'}, '<span class=\"gray fs90\"> px &nbsp;</span>', \n\t\t 'spn#runmode.fs90', \n\t\t],\n    \n    '<div id=\"xpreview\" class=\"w200 oh ha pr20 pt3\" style=\"max-height:125px\">',\n      '<img id=\"ico\" src=\"\" class=\"fr hide br2 ml9\" style=\"max-width:32px;max-height:32px;\"/>',\n      '<img id=\"pic\" src=\"\" class=\"fr hide br2 mb10\" style=\"max-width:64px;max-height:64px;\"/>',\n      '<span id=\"btn-addpic\" class=\"fs85 pseudolink dib vat lh120 tdn\">Add component icon...</span>',\n    '</div>',\n    \n    '</div>',\n    \n    '<div id=\"isapp\" class=\"w360 pl10 ml10 dib vat pb5\" style=\"border-left:1px dotted #bdd3e6;\">',\n      {rowCss:\"my-row pt0 pb5\", label:\"80px\"},\n      [\"State mask\",\n          \"txt#maskstate.fs80\", {plc:\"String reference or JSON obj/array mask\"}, \"msg\"],\n      [\"Title node\",\"inp#nodetitle.fs90\",{plc:\"Like item.title\"},\"msg\"],\n      [\"Widths\",\"inp#width.fs90\",{plc:\"Like 800,1200\"},\"msg\"],\n      [\"Timeout\",\"inp#timeout.fs90.w70\",{plc:\"Start in\"},\n        '<span class=\"gray fs90\"> ms</span>'],\n      '<div id=\"iseditor\">',\n        [\"Doc node\",\"inp#nodedoc.fs90.w100p\",\"msg\"],\n        [\"Cmd node\",\"inp#nodecmd.fs90.w100p\",\"msg\"],\n        {rowCss:\"my-row pt7\"},\n        [\"\",'spn#btn-addcmd.pseudolink.fs85.tdn',{txt:\"Add type/command...\"}],\n        [\"\",'<div id=\"cmd\" class=\"w100p\"></div>'],\n      '</div>',\n\n    '</div>',\n\n    {rowCss:'my-row mt0 pt10 btd fs90'},\n    [\n      '', \n      'btn#btn-apply.w120.tac.mr5.green',{val:\"Apply\"},\n      'btn#btn-cancel.w120.tac',{val:\"Cancel\"}\n    ]\n  ]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186313668","id": ".E.Opts.ui","type": "js","data": "({\n  \"#type\":{\n    bind:function(d,v){\n      var that = this,\n          width = 350;\n      if (v!=null) d._type = v;\n\n      if (d._type.indexOf('app')>-1 || d._type.indexOf('editor')>-1) width = 721;\n\n      var modal = that.my.root().parent().data('modal');\n\n      if (modal && modal.width != width) {\n        that.my.root().parent().data('modal').width = width;\n        that.my.root().trigger('layout');\n      }\n\n      return d._type;\n    },\n    init: function ($o) {\n      $o.tags({\n        tags:[[ {\"App\":\"app\"},{\"Editor\":\"editor\"}],{\"<i>&beta;eta</i>\":\"beta\"} ], \n        empty:{\"Manifest\":\"manifest\"}\n      });\n    }\n  },\n  \n  '#mtags':{\n    init: function($o){\n    \t$o.select2({\n        tags:this.RT('db')&&Object.isFunction(this.RT('db').tags)?this.RT('db').tags():[],\n        minimumResultsForSearch:15,\n        placeholder:'Manifest tags'\n      });\n    },\n    bind:'_tags'\n  },\n\n  '#padding':{\n    init: function ($o) {\n      $o.tags({\n        tags:[[ {\"No pad\":\"none\"},{\"Fullscreen\":\"fullscreen\"}]], \n        empty:{\"Auto\":\"auto\"}\n      });\n    },\n    bind:function(d,v){\n      if (v==null) return [d.padding];\n      d.padding = v+'';\n      return v;\n    },\n    watch:'#type',\n    css:{\n      hide:function(d,v){ return d._type.indexOf('manifest')>-1;}\n    }\n  },\n\n\t\"#title\":{\n\t\tbind:\"title\",\n\t\tcheck:function (d,v) {\n\t\t\tvar t=v.compact();\n\t\t\tif (t.length<3) return \"Enter title\";\n\t\t\tif (t.length>50) return \"Too long!\";\n\t\t\treturn \"\";\n\t\t}\n\t},\n  \n\t\"#name\":{\n\t\tbind:function (d,v){\n\t\t\tif (v!=null) d.name=v.to(1).toUpperCase()+v.from(1);\n\t\t\treturn d.name;\n\t\t},\n\t\tcheck:function (d,v) {\n\t\t\tif (!/^[A-Z][A-Za-z0-9]{1,24}(\\.[A-Za-z0-9]{1,25}){0,4}$/.test(v)) return \"Like App.Some.Ext\";\n\t\t\tif (v.to(1).toUpperCase() !== v.to(1)) return \"First – cap\";\n\t\t\tif (v.length>129) return \"Too long\";\n\t\t\treturn \"\";\n\t\t}\n\t},\n  \n\t\"#ver\":{\n\t\tbind:\"version\",\n\t\tcheck:/^(|[0-9][a-z0-9\\.]{0,5})$/,\n\t\terror:\"Like 12 or 5.6.8\"\n\t},\n  \n  \"#build\":{\n\t\tbind:\"build\",\n\t\tcheck:/^(|\\d{1,5})$/,\n\t\terror:\"Number\"\n\t},\n  \n\t\"#desc\":{\n\t\tbind:\"_desc\",\n\t\tcheck:/^.{0,140}$/,\n\t\terror:'<i>Short</i> desc, please'\n\t},\n  \n  \"#btn-addpic\":{\n\t\tbind: function (d,v,$o){\n      var that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t//console.log($o, $o.data(), this)\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:'cw.Sys.Cropper.Square',\n          data:{data:'', filename:'', size:256, png:true, allowSVG:true}\n\t\t\t\t})\n        .then(function (crop) {\n          if (!crop || !crop.data) return;\t\n\n          var I = new Image();\n          I.src = 'data:' + crop.mime + ';base64,' + crop.data;\n          I.onload = function(){\n            var img = cw.lib.image(I);\n            try {\n\n              if (crop.mime == 'image/svg+xml') d.pic = I.src;\n              else d.pic = img.resample(128).sharpen(0.2).png(true);\n              d.ico = img.resample(64).brightness(1.05).contrast(1.05).sharpen(0.5).png();\n              that.my.recalc('#pic');\n              that.my.recalc('#ico');\n            }\n            catch(e){console.log(e)}\t\t\t\t\t\t\t\t\n            crop.data = '';\n            $o.html('Change image...').addClass('w75');\n          }\n        });\n\t\t\t}\n\t\t\tif (d.pic) $o.html('Change image...').addClass('w75');\n\t\t},\n\t\tevents:'click.my'\n\t},\n\t\"#pic\":{\n\t\tbind:\"pic\",\n\t\tcss:{hide:function (d) {return !d.pic.length}}\n\t},\n\t\"#ico\":{\n\t\tbind:\"ico\",\n\t\tcss:{hide:function (d) {return !d.ico.length}}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1511186332166","id": ".E.Opts.ui","type": "js","data": "// App opts\n({\n  \"#isapp\":{\n    bind:function(){},\n    css:{\n      hide:function(d) {return !this.IsApp(d)}\n    },\n    watch:\"#type\",\n    delay:50\n  },\n\n  \"#iseditor\":{\n    bind:function(){},\n    css:{hide:function(d) {return !this.IsEd(d);}},\n    watch:\"#type\"\n  },\n\n  \"#maskstate\":{\n    delay:50,\n    bind:\"maskstate\",\n    check:function(d,v){\n      //v must be ref or json array or obj\n      var t=v.compact(), obj;\n      if (!this.IsApp(d) || this.IsEd(d)) return \"\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      if (/^[\\[\\{]|[\\}\\]]$/.test(t)){\n        try{\n          obj=JSON.parse(t);\n        } catch(e) {}\n        if (!obj) return \"Invalid JSON\";\n        if (Object.isArray(obj)) {\n          if (!obj.length) return \"At least one elt\";\n          for (var i=0;i<obj.length;i++) if (!Object.isString(obj[i])) return \"Only strings in array\";\n          if (obj.length!==obj.unique().length) return \"Array has dupes\";\n        } else if (Object.isObject(obj)) {\n          if (!Object.keys(obj).length) return \"Mask is empty\"\n            } else return \"Invalid JSON type\";\n      } \n      return \"\";\n    },\n    watch:\"#type\",\n    css:{\n      hide: function (d){return this.IsEd(d)}\n    }\n  },\n\n  \"#timeout\":{\n    bind:\"timeout\",\n    check:function(d,v){\n      if (!this.IsApp(d)) return \"\";\n      if (!/^\\d{1,5}$/.test(v)) return \"Num, 0 to 99K\";\n      return \"\";\n    },\n    watch:\"#type\"\n  },\n\n  \"#width\":{\n    bind:function (d,v,$o) {\n      var that = this;\n      if (v!=null) {\n        d.width = that.ParseRange(v) || d.width;\n        return v;\n      }\n      return d.width.map(e=>Object.isArray(e)?e.join('-'):e).join(' ');\n    },\n    check:function(d,v){\n      if (this.IsApp(d) && !this.ParseRange(v)) return \"Num list like 100,300-500,800 required\";\n      return '';\n    },\n    watch:\"#type\"\n  },\n\n  \"#nodetitle\":{\n    bind:\"nodetitle\",\n    check:function(d,v){\n      if (!this.IsApp(d)) return \"\";\n      var t=v.compact();\n      if (!t.length && this.IsEd(d)) return \"Data field to map as app title\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      return \"\";\n    },\n    watch:\"#type\"\n  },\n\n  \"#nodedoc\":{\n    bind:\"nodedoc\",\n    check:function(d,v){\n      if (!this.IsEd(d)) return \"\";\n      var t=v.compact();\n      if (!t.length) return \"Field to map doc object to edit\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      return \"\";\n    },\n    watch:\"#type\"\n  },\n\n  \"#nodecmd\":{\n    bind:\"nodecmd\",\n    check:function(d,v){\n      if (!this.IsEd(d)) return \"\";\n      var t=v.compact();\n      if (!t.length) return \"Field to map editor command\";\n      if (t.length>150) return \"Too long\";\n      if (/^[\"']|[\"']$/.test(t)) return \"No quots for single string\";\n      return \"\";\n    },\n    watch:\"#type\"\n  },\n  \n  \"#cmd\":{\n    bind:\"_cmd\",\n    manifest:\"TypeLine\",\n    check:true,\n    watch:\"#btn-addcmd\"\n  },\n  \n  \"#btn-addcmd\":{\n    bind: function (d,v) {\n      if (v!=null) {\n        d._cmd.push(Object.clone(this.TypeLine.data,true));\n      }\n    },\n    events:\"click.my\"\n  },\n  \n  '#btn-cancel':function(d,v){if (v!=null) this.my.cancel();}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1511242283450","id": ".E.Opts.ui","type": "js","data": "// Btns\n({\n  \"#runwidth\":\"_opts.runWidth\",\n  \n  \"#runmode\":{\n    bind:\"_opts.runMode\",\n    init: function ($o){\n      $o.tags({\n        tags:[[\n          //{\"Inline\":\"inline\"},\n          {\"Fullscreen\":\"fullscreen\"}\n        ]], \n        empty:{\"Modal\":\"modal\"}\n      })\n    }\n  },\n  \n  '#btn-apply':{\n    bind:function(d,v){if (v!=null) this.my.commit();},\n    css:{\n      ':disabled':function(d,v){\n      \treturn !this.my.valid();\n      }\n    },\n    watch:['#type','#title','#name','#desc','#maskstate','#nodetitle','#width','#nodedoc']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1525638627232","id": ".E.Opts.TypeLine","type": "js","data": "({\n  data:{\n    type:\"\",\n    actions:[]\n  },\n  init: [\n    {row:\"100%\",rowCss:\"my-row pb7\"},\n    [\"\",'<div class=\"w80 dib vat\">','inp#type.w75.fs90.vat.dib.pt3.pb5',{plc:\"Type\"}\n     ,'</div><div class=\"dib vat\" style=\"width:calc(100% - 80px);\">',\n     'inp#actions.w100p.fs95',{plc:\"Actions\"},'</div>']\n  ],\n  ui:{\n    \"#type\":{\n      bind:function(d,v) {\n        if (v!=null) d.type=(v+\"\").replace(/[^a-z0-9\\*]/ig,\"\");\n        return d.type;\n      }\n    },\n\n    \"#actions\":{\n      bind:\"actions\",\n      init: function($o) {\n        $o.select2({tags:[\"create\",\"edit\",\"view\",\"comment\",\"hide\",\"copy\",\"move\",\"delete\"]});\n      }\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1511186355744","id": ".E.Types","type": "js","data": "// Tab types\n\t\n({\n\t\"html\":{\n\t\tCM: {mode:'manhtml', theme:\"base16-light\"},\n\t\tcss:\"fi-html5\",\n\t\tcompile: null\n\t},\n\t//---------------------  TEXT  -------------------\n\t\"text\":{\n\t\tCM:{ mode:\"\"},\n\t\tcompile: null\n\t},\n\t//---------------------  JS  -------------------\n\t\"js\":{\n\t\tCM:{ mode:'manjs'},\n\t\tcompile: function(s){\n\t\t\tvar err=[], res = null;\n\t\t\ttry {\n\t\t\t\t// Eval is unsafe and resource-consuming\n\t\t\t\t//res = eval(s);\n\t\t\t\t\n\t\t\t\t// More safe way\n\t\t\t\tres = (new Function (\"\", \"return (\"+s+\");\"))();\n\n\t\t\t} catch (e) {\n\t\t\t\terr.push(e.message+\".\");\n\t\t\t}\n\t\t\treturn err.length?[err, undefined]:[err,res];\n\t\t}\n\t},\n\t//---------------------  CSS  -------------------\n\t\"css\":{\n\t\tCM:{ mode:\"mancss\", theme:\"base16-light\"},\n\t\tcss:\"fi-css3\",\n\t\tcompile: function(css){\n\t\t\tvar err=[], res=\"\";\n\t\t\tres = ((css+\"\")\n\t\t\t.replace(/\\/\\*[\\s\\S]+?\\*\\//gm,\"\")\n\t\t\t.replace(/@charset[^;]+?;/gim,'')\n\t\t\t.replace(/[\\n\\t\\s]+/g,' ')\n\t\t\t.replace(/\\}/g,'}⊻')\n\t\t\t.replace(/^\\n+/g,\"\").replace(/[\\n\\s]+$/g,\"\")\n\t\t\t.split('⊻')\n\t\t\t.compact(true)\n\t\t\t.reduce(function(a,b){\n\t\t\t\tvar t = b.trim(), p, k, v;\n\t\t\t\tif (/^[^{]+\\{[^\\}]+\\}$/.test(t)) {\n\t\t\t\t\tp = t.to(-1).split(\"{\");\n\t\t\t\t\tk = \" \"+p[0].trim();\n\t\t\t\t\tv = p[1].trim();\n\t\t\t\t\tif (v.last()!=\";\") v+=\";\";\n\t\t\t\t\tif (!a[k]) a[k]=\"\";\n\t\t\t\t\ta[k]+=v;\n\t\t\t\t} else {\n\t\t\t\t\terr.push(\"Invalid rule \"+t.truncate(40));\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\t},{}));\n\t\t\treturn [err, res];\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1511186398023","id": ".E.NewAppSrc","type": "text","data": "({\n\tparams:{},\n\tdata:{\n\t\t// Data to bind with controls,\n\t\t// freeform like \n\t\t// { type:\"box\", size:{x:\"7\", y:\"5\"}, count:\"6\" }\n\t},\n\tinit: function ($o) {\n\t\t// Init function, executed before controls init.\n\t\t// Renders ui skeleton and prepares data if needed.\n\t\t// Any init function can return promise to become async.\n\t},\n\tui:{\n\t\t/*\n\t\t\"#someControl\":{\n\t\t\tbind:\"size.x\",\n\t\t\tcheck:/someRegexp/\n\t\t}, ...\n\t\t*/\n\t},\n\tstyle:{\n\t\t/*\n\t\t// Creates runtime stylesheet with rules\n\t\t// selective for manifest, like\n\t\t\t\" .red\":\"color:red\",\n\t\t\t\" .item\":{\n\t\t\t\t\" .red\":\"color:#c02\"\n\t\t\t}\n\t\t*/\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTk3LjI5MSw1OC4wMyBMODguMzQ4LDU3LjE0OSBDODcuNzczLDU1LjAwMyA4Ni45MTcsNTIuOTQzIDg1Ljc5Myw1MS4wMDUgTDkxLjUwMyw0NC4wNDkgQzkyLjExNSw0My4zMDEgOTIuMDU5LDQyLjIxMiA5MS4zNzcsNDEuNTMxIEw4NS45NDYsMzYuMDk4IEM4NS41ODEsMzUuNzMzIDg1LjEwMiwzNS41NDcgODQuNjE5LDM1LjU0NyBDODQuMTk3LDM1LjU0NyA4My43NzUsMzUuNjg4IDgzLjQyOCwzNS45NzQgTDc2LjQ3MSw0MS42ODUgQzc0LjUzLDQwLjU2IDcyLjQ3MSwzOS43MDQgNzAuMzI3LDM5LjEzIEw2OS40NDcsMzAuMTg1IEM2OS4zNTIsMjkuMjI0IDY4LjU0NCwyOC40OTEgNjcuNTc4LDI4LjQ5MSBMNTkuOSwyOC40OTEgQzU4LjkzNCwyOC40OTEgNTguMTI2LDI5LjIyNCA1OC4wMywzMC4xODUgTDU3LjE1LDM5LjEzMyBDNTUuMDA2LDM5LjcwNyA1Mi45NDgsNDAuNTYzIDUxLjAxMSw0MS42ODggTDQ0LjA1MSwzNS45NzUgQzQzLjcwMywzNS42ODkgNDMuMjgxLDM1LjU0OSA0Mi44NTksMzUuNTQ5IEM0Mi4zNzYsMzUuNTQ5IDQxLjg5OCwzNS43MzMgNDEuNTMyLDM2LjEgTDM2LjEwMSw0MS41MzEgQzM1LjQxOSw0Mi4yMTIgMzUuMzYzLDQzLjMwNCAzNS45NzUsNDQuMDQ5IEw0MS42OSw1MS4wMDggQzQwLjU2Niw1Mi45NDQgMzkuNzA4LDU1LjAwMyAzOS4xMzQsNTcuMTUgTDMwLjE4Nyw1OC4wMzEgQzI5LjIyNSw1OC4xMjMgMjguNDkxLDU4LjkzMiAyOC40OTEsNTkuODk4IEwyOC40OTEsNjcuNTc4IEMyOC40OTEsNjguNTQ1IDI5LjIyNSw2OS4zNTQgMzAuMTg2LDY5LjQ0NiBMMzkuMTMzLDcwLjMyOCBDMzkuNzA3LDcyLjQ3NCA0MC41NjQsNzQuNTMgNDEuNjg5LDc2LjQ2NyBMMzUuOTc4LDgzLjQyNCBDMzUuMzYyLDg0LjE3MSAzNS40MTQsODUuMjYxIDM2LjEsODUuOTQ0IEw0MS41Myw5MS4zNzYgQzQxLjg5Niw5MS43NCA0Mi4zNzQsOTEuOTI1IDQyLjg1Nyw5MS45MjUgQzQzLjI4LDkxLjkyNSA0My43MDIsOTEuNzg0IDQ0LjA0OSw5MS41IEw1MS4wMDUsODUuNzg5IEM1Mi45NDcsODYuOTE0IDU1LDg3Ljc3IDU3LjE1LDg4LjM0NiBMNTguMDI5LDk3LjI5MiBDNTguMTI0LDk4LjI1MiA1OC45MzMsOTguOTg1IDU5Ljg5OSw5OC45ODUgTDY3LjU3OCw5OC45ODUgQzY4LjU0NCw5OC45ODUgNjkuMzUyLDk4LjI1MiA2OS40NDcsOTcuMjkyIEw3MC4zMjcsODguMzQ3IEM3Mi40NzYsODcuNzcyIDc0LjUzLDg2LjkxNyA3Ni40NzEsODUuNzg5IEw4My40MjgsOTEuNSBDODMuNzc2LDkxLjc4NCA4NC4xOTcsOTEuOTI1IDg0LjYxOSw5MS45MjUgQzg1LjEwMiw5MS45MjUgODUuNTgxLDkxLjc0IDg1Ljk0Niw5MS4zNzYgTDkxLjM3Nyw4NS45NDQgQzkyLjA2Myw4NS4yNjIgOTIuMTE1LDg0LjE3MSA5MS40OTksODMuNDI0IEw4NS43OTIsNzYuNDcgQzg2LjkxNyw3NC41MyA4Ny43NzIsNzIuNDc0IDg4LjM0Nyw3MC4zMjggTDk3LjI5MSw2OS40NDYgQzk4LjI1MSw2OS4zNTEgOTguOTg1LDY4LjU0NSA5OC45ODUsNjcuNTc4IEw5OC45ODUsNTkuODk4IEM5OC45ODYsNTguOTMyIDk4LjI1Miw1OC4xMjUgOTcuMjkxLDU4LjAzIHogTTYzLjc0LDc0LjEzOSBDNTcuOTk0LDc0LjEzOSA1My4zMzgsNjkuNDgyIDUzLjMzOCw2My43MzkgQzUzLjMzOCw1Ny45OTMgNTcuOTk1LDUzLjMzOCA2My43NCw1My4zMzggQzY5LjQ4Myw1My4zMzggNzQuMTM5LDU3Ljk5MyA3NC4xMzksNjMuNzM5IEM3NC4xNCw2OS40ODIgNjkuNDgzLDc0LjEzOSA2My43NCw3NC4xMzkgeiIgZmlsbD0iIzgxOThBNyIgZmlsbC1vcGFjaXR5PSIwLjc0NiIvPgogIDwvZz4KPC9zdmc+Cg==","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "manifest","actions": ["edit","create"]}],"_opts": {"compileTo": ["js"],"runWidth": "1200","runMode": ["fullscreen"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Manifest editor","timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTk3LjI5MSw1OC4wMyBMODguMzQ4LDU3LjE0OSBDODcuNzczLDU1LjAwMyA4Ni45MTcsNTIuOTQzIDg1Ljc5Myw1MS4wMDUgTDkxLjUwMyw0NC4wNDkgQzkyLjExNSw0My4zMDEgOTIuMDU5LDQyLjIxMiA5MS4zNzcsNDEuNTMxIEw4NS45NDYsMzYuMDk4IEM4NS41ODEsMzUuNzMzIDg1LjEwMiwzNS41NDcgODQuNjE5LDM1LjU0NyBDODQuMTk3LDM1LjU0NyA4My43NzUsMzUuNjg4IDgzLjQyOCwzNS45NzQgTDc2LjQ3MSw0MS42ODUgQzc0LjUzLDQwLjU2IDcyLjQ3MSwzOS43MDQgNzAuMzI3LDM5LjEzIEw2OS40NDcsMzAuMTg1IEM2OS4zNTIsMjkuMjI0IDY4LjU0NCwyOC40OTEgNjcuNTc4LDI4LjQ5MSBMNTkuOSwyOC40OTEgQzU4LjkzNCwyOC40OTEgNTguMTI2LDI5LjIyNCA1OC4wMywzMC4xODUgTDU3LjE1LDM5LjEzMyBDNTUuMDA2LDM5LjcwNyA1Mi45NDgsNDAuNTYzIDUxLjAxMSw0MS42ODggTDQ0LjA1MSwzNS45NzUgQzQzLjcwMywzNS42ODkgNDMuMjgxLDM1LjU0OSA0Mi44NTksMzUuNTQ5IEM0Mi4zNzYsMzUuNTQ5IDQxLjg5OCwzNS43MzMgNDEuNTMyLDM2LjEgTDM2LjEwMSw0MS41MzEgQzM1LjQxOSw0Mi4yMTIgMzUuMzYzLDQzLjMwNCAzNS45NzUsNDQuMDQ5IEw0MS42OSw1MS4wMDggQzQwLjU2Niw1Mi45NDQgMzkuNzA4LDU1LjAwMyAzOS4xMzQsNTcuMTUgTDMwLjE4Nyw1OC4wMzEgQzI5LjIyNSw1OC4xMjMgMjguNDkxLDU4LjkzMiAyOC40OTEsNTkuODk4IEwyOC40OTEsNjcuNTc4IEMyOC40OTEsNjguNTQ1IDI5LjIyNSw2OS4zNTQgMzAuMTg2LDY5LjQ0NiBMMzkuMTMzLDcwLjMyOCBDMzkuNzA3LDcyLjQ3NCA0MC41NjQsNzQuNTMgNDEuNjg5LDc2LjQ2NyBMMzUuOTc4LDgzLjQyNCBDMzUuMzYyLDg0LjE3MSAzNS40MTQsODUuMjYxIDM2LjEsODUuOTQ0IEw0MS41Myw5MS4zNzYgQzQxLjg5Niw5MS43NCA0Mi4zNzQsOTEuOTI1IDQyLjg1Nyw5MS45MjUgQzQzLjI4LDkxLjkyNSA0My43MDIsOTEuNzg0IDQ0LjA0OSw5MS41IEw1MS4wMDUsODUuNzg5IEM1Mi45NDcsODYuOTE0IDU1LDg3Ljc3IDU3LjE1LDg4LjM0NiBMNTguMDI5LDk3LjI5MiBDNTguMTI0LDk4LjI1MiA1OC45MzMsOTguOTg1IDU5Ljg5OSw5OC45ODUgTDY3LjU3OCw5OC45ODUgQzY4LjU0NCw5OC45ODUgNjkuMzUyLDk4LjI1MiA2OS40NDcsOTcuMjkyIEw3MC4zMjcsODguMzQ3IEM3Mi40NzYsODcuNzcyIDc0LjUzLDg2LjkxNyA3Ni40NzEsODUuNzg5IEw4My40MjgsOTEuNSBDODMuNzc2LDkxLjc4NCA4NC4xOTcsOTEuOTI1IDg0LjYxOSw5MS45MjUgQzg1LjEwMiw5MS45MjUgODUuNTgxLDkxLjc0IDg1Ljk0Niw5MS4zNzYgTDkxLjM3Nyw4NS45NDQgQzkyLjA2Myw4NS4yNjIgOTIuMTE1LDg0LjE3MSA5MS40OTksODMuNDI0IEw4NS43OTIsNzYuNDcgQzg2LjkxNyw3NC41MyA4Ny43NzIsNzIuNDc0IDg4LjM0Nyw3MC4zMjggTDk3LjI5MSw2OS40NDYgQzk4LjI1MSw2OS4zNTEgOTguOTg1LDY4LjU0NSA5OC45ODUsNjcuNTc4IEw5OC45ODUsNTkuODk4IEM5OC45ODYsNTguOTMyIDk4LjI1Miw1OC4xMjUgOTcuMjkxLDU4LjAzIHogTTYzLjc0LDc0LjEzOSBDNTcuOTk0LDc0LjEzOSA1My4zMzgsNjkuNDgyIDUzLjMzOCw2My43MzkgQzUzLjMzOCw1Ny45OTMgNTcuOTk1LDUzLjMzOCA2My43NCw1My4zMzggQzY5LjQ4Myw1My4zMzggNzQuMTM5LDU3Ljk5MyA3NC4xMzksNjMuNzM5IEM3NC4xNCw2OS40ODIgNjkuNDgzLDc0LjEzOSA2My43NCw3NC4xMzkgeiIgZmlsbD0iIzgxOThBNyIgZmlsbC1vcGFjaXR5PSIwLjc0NiIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": "","nodetitle": "editor.title","nodedoc": "editor","nodecmd": "cmd","types": "","width": [[980,1420],1120,1320],"collapsed": [],"padding": "auto"},"log": [[1539141340663,"update","admin-czpbhuup",160,"dev-cloudwall2"]],"id": "cw.Manifest","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTk3LjI5MSw1OC4wMyBMODguMzQ4LDU3LjE0OSBDODcuNzczLDU1LjAwMyA4Ni45MTcsNTIuOTQzIDg1Ljc5Myw1MS4wMDUgTDkxLjUwMyw0NC4wNDkgQzkyLjExNSw0My4zMDEgOTIuMDU5LDQyLjIxMiA5MS4zNzcsNDEuNTMxIEw4NS45NDYsMzYuMDk4IEM4NS41ODEsMzUuNzMzIDg1LjEwMiwzNS41NDcgODQuNjE5LDM1LjU0NyBDODQuMTk3LDM1LjU0NyA4My43NzUsMzUuNjg4IDgzLjQyOCwzNS45NzQgTDc2LjQ3MSw0MS42ODUgQzc0LjUzLDQwLjU2IDcyLjQ3MSwzOS43MDQgNzAuMzI3LDM5LjEzIEw2OS40NDcsMzAuMTg1IEM2OS4zNTIsMjkuMjI0IDY4LjU0NCwyOC40OTEgNjcuNTc4LDI4LjQ5MSBMNTkuOSwyOC40OTEgQzU4LjkzNCwyOC40OTEgNTguMTI2LDI5LjIyNCA1OC4wMywzMC4xODUgTDU3LjE1LDM5LjEzMyBDNTUuMDA2LDM5LjcwNyA1Mi45NDgsNDAuNTYzIDUxLjAxMSw0MS42ODggTDQ0LjA1MSwzNS45NzUgQzQzLjcwMywzNS42ODkgNDMuMjgxLDM1LjU0OSA0Mi44NTksMzUuNTQ5IEM0Mi4zNzYsMzUuNTQ5IDQxLjg5OCwzNS43MzMgNDEuNTMyLDM2LjEgTDM2LjEwMSw0MS41MzEgQzM1LjQxOSw0Mi4yMTIgMzUuMzYzLDQzLjMwNCAzNS45NzUsNDQuMDQ5IEw0MS42OSw1MS4wMDggQzQwLjU2Niw1Mi45NDQgMzkuNzA4LDU1LjAwMyAzOS4xMzQsNTcuMTUgTDMwLjE4Nyw1OC4wMzEgQzI5LjIyNSw1OC4xMjMgMjguNDkxLDU4LjkzMiAyOC40OTEsNTkuODk4IEwyOC40OTEsNjcuNTc4IEMyOC40OTEsNjguNTQ1IDI5LjIyNSw2OS4zNTQgMzAuMTg2LDY5LjQ0NiBMMzkuMTMzLDcwLjMyOCBDMzkuNzA3LDcyLjQ3NCA0MC41NjQsNzQuNTMgNDEuNjg5LDc2LjQ2NyBMMzUuOTc4LDgzLjQyNCBDMzUuMzYyLDg0LjE3MSAzNS40MTQsODUuMjYxIDM2LjEsODUuOTQ0IEw0MS41Myw5MS4zNzYgQzQxLjg5Niw5MS43NCA0Mi4zNzQsOTEuOTI1IDQyLjg1Nyw5MS45MjUgQzQzLjI4LDkxLjkyNSA0My43MDIsOTEuNzg0IDQ0LjA0OSw5MS41IEw1MS4wMDUsODUuNzg5IEM1Mi45NDcsODYuOTE0IDU1LDg3Ljc3IDU3LjE1LDg4LjM0NiBMNTguMDI5LDk3LjI5MiBDNTguMTI0LDk4LjI1MiA1OC45MzMsOTguOTg1IDU5Ljg5OSw5OC45ODUgTDY3LjU3OCw5OC45ODUgQzY4LjU0NCw5OC45ODUgNjkuMzUyLDk4LjI1MiA2OS40NDcsOTcuMjkyIEw3MC4zMjcsODguMzQ3IEM3Mi40NzYsODcuNzcyIDc0LjUzLDg2LjkxNyA3Ni40NzEsODUuNzg5IEw4My40MjgsOTEuNSBDODMuNzc2LDkxLjc4NCA4NC4xOTcsOTEuOTI1IDg0LjYxOSw5MS45MjUgQzg1LjEwMiw5MS45MjUgODUuNTgxLDkxLjc0IDg1Ljk0Niw5MS4zNzYgTDkxLjM3Nyw4NS45NDQgQzkyLjA2Myw4NS4yNjIgOTIuMTE1LDg0LjE3MSA5MS40OTksODMuNDI0IEw4NS43OTIsNzYuNDcgQzg2LjkxNyw3NC41MyA4Ny43NzIsNzIuNDc0IDg4LjM0Nyw3MC4zMjggTDk3LjI5MSw2OS40NDYgQzk4LjI1MSw2OS4zNTEgOTguOTg1LDY4LjU0NSA5OC45ODUsNjcuNTc4IEw5OC45ODUsNTkuODk4IEM5OC45ODYsNTguOTMyIDk4LjI1Miw1OC4xMjUgOTcuMjkxLDU4LjAzIHogTTYzLjc0LDc0LjEzOSBDNTcuOTk0LDc0LjEzOSA1My4zMzgsNjkuNDgyIDUzLjMzOCw2My43MzkgQzUzLjMzOCw1Ny45OTMgNTcuOTk1LDUzLjMzOCA2My43NCw1My4zMzggQzY5LjQ4Myw1My4zMzggNzQuMTM5LDU3Ljk5MyA3NC4xMzksNjMuNzM5IEM3NC4xNCw2OS40ODIgNjkuNDgzLDc0LjEzOSA2My43NCw3NC4xMzkgeiIgZmlsbD0iIzgxOThBNyIgZmlsbC1vcGFjaXR5PSIwLjc0NiIvPgogIDwvZz4KPC9zdmc+Cg==","stamp": 1539141340663,"creator": "ermouth-1ermouth"},{"_id": "cw-Inliner-4vx1","_rev": "333-37e54565b3464bef4dc814069b83113e","name": "Inliner","title": "Inliner","type": "manifest","desc": "Extendable content editor with HTML compiler","beta": false,"tags": ["CW","CW apps","Inliner"],"manifest": {"id": "cw.Inliner","build": 126,"app": {"name": "Inliner","title": "Inliner","version": "4.0","build": 126,"timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzZBQUNGRiIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00My44MzYsOTAuMDc2IEwzNi4wNzEsOTIuNzc4IEwzNi4wNjgsOTIuNzYxIEMzNS4yMTgsOTMuMTYyIDM0LjE4NCw5My4wMjcgMzMuNDgsOTIuMzE4IEMzMi44NDYsOTEuNjggMzIuNjgzLDkwLjc3NiAzMi45NDUsODkuOTgxIEwzMi45MjgsODkuOTc3IEwzNS43MTQsODEuOTU1IEw0My44MzYsOTAuMDc2IHoiIGZpbGw9IiNGRjNEN0UiLz4KICAgICAgPHBhdGggZD0iTTkzLjc4NSw0Ny40NjIgQzk0LjY3OSw0OC4zNTMgOTQuNjc5LDQ5LjgxOCA5My43ODMsNTAuNzEgTDYwLjA3Miw4NC40MTkgTDYwLjAzNiw4NC4zODQgTDYwLjA0OSw4NC40MzQgTDQ1Ljk5Myw4OS4yNzEgTDQxLjYzNSw4NC45MTMgTDU1LjM5Miw3OS43NCBMNDYuMDE1LDcwLjM2MyBMNDAuODM5LDg0LjExNyBMMzYuNTE2LDc5Ljc5NCBMNDEuMzMyLDY1Ljc3NyBMNDEuNDY2LDY1LjgxNCBMNDEuMzgyLDY1LjczIEw3NS4wOTEsMzIuMDI2IEM3NS45ODYsMzEuMTI2IDc3LjQ0OSwzMS4xMjYgNzguMzQzLDMyLjAyNiBMOTMuNzg1LDQ3LjQ2MiB6IE03Ni42NjEsMzcuOTM3IEw0OC4yNTYsNjYuMzQyIEw1MS43MTgsNjkuODAzIEw4MC4xMjIsNDEuMzk5IEw3Ni42NjEsMzcuOTM3IHoiIGZpbGw9IiM1NUEwRkYiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": ["cmd","doc._id"],"nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","width": [1200,1400,[1024,1720]],"collapsed": [".T.embed",".T.html",".T.img"],"padding": "auto","types": {"inliner": ["create","edit","view"],"post": ["edit","view"]}},"Version": "4.0","data": {"cmd": "","doc": {"_id": "","type": "inliner","name": "","creator": "","owners": [],"meta": {},"style": {},"content": [{"_stamp": "1101","type": "html","data": "<p>Write your content<br></p>"}],"previews": {},"stamp": "","tags": [],"log": []},"posts": {},"key": "_"},"params": {"restyle": 100,"navHeight": 0},"Config": {"meta": {}},"Lang": {},"AllTags": [],"Cmd": "function (a) {return a?this.data.cmd == a:this.data.cmd}","init": "function ($o,form) {\n\t\t\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// Locale\n\t\t//if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\t//that.Lang = that.Lang[lang];\n    that.Lang = that.lang;\n\t\t\n\t\t// editor component container\n\t\t$o.formgen(that.HTML);\n\t\t\n\t\t// Parser\n\t\tif (!window.HTMLParser) that.HTMLParser(window);\n\t\t\n\t\t// Collapse content\n\t\tform.data.doc.content = that.CollapseItems(form.data.doc.content);\n\t\t\n\t\t// DB\n\t\tthat.Ed.db = that.db;\n\t\t\n\t\t// Cropper btns\n\t\tthat.Ed.Cropper.style[' .tag-in-fmt'] = Object.clone(that.style[' .tag-in-fmt'], true);\n    that.Ed.Cropper.Ed = Object.merge(that.Ed.Cropper.Ed || {}, {SVG:that.Ed.SVG});\n\t\t\n\t\t// Items\n\t\t//that.Editor.Items = $.extend(true, {}, that.T);\n\t\tthat.Ed.Items = that.T;\n\t\tthat.Ed.Items.img.Opts.style[' .tag-in-fmt'] =\n\t\tthat.Ed.Items.embed.Opts.style[' .tag-in-fmt'] = that.style[' .tag-in-fmt'];\n\t\t\n\t\t//enc key\n\t\tform.data.key= form.data.doc.crypto || \"_\";\n    \n   \n    $o.then(function(){\n       // hide Redactor panels on app hide/show\n      if (cw.lib.getref(that, ['app','watch','on'])) {\n        that.app.watch.on('progress',function(){\n        \t$('body>div.redactor_air').css({display:'none'});\n        });\n      };\n      \n      // Read tags\n      if (that.db && that.db.query) {\n        (function(){\n          that.db.query('Inliner/tags',{reduce:true, group_level:1})\n          .then(function(res){\n            var rows = res.rows || [];\n            rows.forEach(function(e){that.AllTags.push(e.key)});\n            if (that.AllTags.length) {\n              $o.find('#doctags').select2({\n                tags:\t\t\t\t\tthat.AllTags,\n                placeholder:\tthat.Lang.PLC_TAGS,\n                enable:\t\t\t\tthat.Cmd() != 'view'\n              });\n            }\n          })\n          .fail(function(){\n\n          });\n        }).debounce(500)();\n      }\n      \n    });\n\t}","SessionUrls": {},"die": "function ($o) {\n    var that = this;\n\t\t// Free resources \n\t\tvar u = that.SessionUrls||{};\n\t\tObject.keys(u).forEach(function(i){  URL.revokeObjectURL(u[i]); });\n\t\t\n\t\t// Unmount niceScroll if any\n\t\tif (!/Firefox/.test(navigator.userAgent)) $o.find('#meditor').getNiceScroll().remove();\n    \n    // off panel remover\n    if (cw.lib.getref(that, ['app','watch','off'])) {\n        that.app.watch.off('progress');\n    }\n\t}","ui": {"#meditor": {"bind": "doc","manifest": "Ed","init": "function ($o) {\n\t\t\tvar b = navigator.userAgent;\n\t\t\tif (/Mac.+Firefox/.test(b)) $o.css({overflow:'scroll'});\n\t\t\telse if (/iPad.+Safari/.test(b)) $o.css({overflow:\"scroll\",'-webkit-overflow-scrolling': 'touch'});\n\t\t\telse if (/Mac.+Chrome\\//.test(b)) $o.css({overflow:'overlay'});\n\t\t\telse if (/Mac.+Safari/.test(b)) $o.css({overflow:'overlay'});\n\t\t\telse if (!/Firefox/.test(b)) $o.niceScroll({zindex:7});\n\t\t}"},"#docid": {"bind": "function (d) {\n\t\t\treturn (d.doc._id || '<span class=\"salmon\">not yet saved</span>');\n\t\t}"},"#doctags": {"delay": 50,"bind": "function (d,v) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\td.doc.tags = v;\n\t\t\t\tthat.my.restyle();\n\t\t\t}\n\t\t\treturn d.doc.tags;\n\t\t}","init": "function ($o) {\n\t\t\t$o.select2({\n\t\t\t\ttags:this.db&&this.db.tags?this.db.tags():[],\n\t\t\t\tplaceholder:this.Lang.PLC_TAGS,\n        enable:this.Cmd() != 'view'\n\t\t\t});\n\t\t}","css": {":disabled": "function () {return this.Cmd() == 'view'}"}},"#encrypt": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\td.key=v;\n\t\t\t\tif (v!=\"_\") d.doc.crypto=v;\n\t\t\t\telse delete d.doc.crypto;\n\t\t\t}\n\t\t\treturn v||d.key;\n\t\t}","init": "function ($o) {\n\t\t\tvar a = [ {id:\"_\",name:\"No encryption\"} ];\n\t\t\tif (cw.crypto && cw.crypto.keys) a.add(cw.crypto.keys());\n\t\t\t$o.html(\n\t\t\t\ta.reduce(function(a,b){\n\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t},\"\")\n\t\t\t).select2({\n      \t enable:this.Cmd() != 'view'\n      });\n\t\t}","css": {":disabled": "function () {return this.Cmd() == 'view'}","hide": "function () {return !cw.crypto || !cw.crypto.keys || !cw.crypto.keys().length;}"}},"#btn-addphoto": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\tthat.my.modal('#btn-addphoto',{\n\t\t\t\t\twidth:821,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tmanifest:$.extend(true, {Att:that.Att}, that.Ed.Cropper, {data:{gallery:false}}),\n\t\t\t\t\tdata:{}\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\tvar atts = d.doc._attachments,\n\t\t\t\t\t\t\tfname = res.filename;\n\t\t\t\t\n\t\t\t\t\tatts[fname] = {\n\t\t\t\t\t\tcontent_type:'image/jpeg',\n\t\t\t\t\t\tdata:res.data\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// gen preview\n\t\t\t\t\t\n\t\t\t\t\tvar $i = $('<img src=\"\"/>');\n\t\t\t\t\t$i.attr(\"src\", \"data:image/jpeg;base64,\"+res.data);\n\t\t\t\t\t$i.load(function(){\n\t\t\t\t\t\tvar ico = cw.lib.image($i,\"white\").resample(150),\n\t\t\t\t\t\t\t\tl = res.data.length/4*3 | 0,\n\t\t\t\t\t\t\t\tw = $i[0].naturalWidth,\n\t\t\t\t\t\t\t\th = $i[0].naturalHeight;\n\t\t\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height())\n\t\t\t\t\t\t\n\t\t\t\t\t\td.doc.previews[fname] = {\n\t\t\t\t\t\t\tfname:fname,\n\t\t\t\t\t\t\tsize:l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\",\n\t\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\t\t//dim:(res.width * res.expand | 0)+'×'+(res.width * res.expand / 4 * 3 | 0),\n\t\t\t\t\t\t\tdim:(w | 0)+'×'+(h | 0),\n\t\t\t\t\t\t\tdata:ico.sharpen(0.1).contrast(1.05).jpeg(0.7)\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\t$i.remove();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tthat.my.recalc('#atts');\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn that.Lang.BTN_ADDIMAGE;\n\t\t}","events": "click.my"},"#btn-acl": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest: that.ACL,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\towners:(Object.isArray(d.doc.owners)? d.doc.owners: [])\n\t\t\t\t\t\t.map(function(r) { return (r.to(2) == \"r-\")?\"=\"+r.from(2):r;})\n\t\t\t\t\t},\n\t\t\t\t\tnose:\"right\",\n\t\t\t\t\talign:\"right:105%\",\n\t\t\t\t\t//align:\"left:-20px\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs80 pt15\",\n\t\t\t\t\twidth:250,\n\t\t\t\t\tbound:0,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tclose:false\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\td.doc.owners = res.owners.map(function(r) { return (r.to(1) == \"=\")?\"r-\"+r.from(1):r;});\n\t\t\t\t\tthat.my.check('#btn-acl')\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (Object.isArray(d.doc.owners) && d.doc.owners.length) {\n\t\t\t\treturn d.doc.owners.join(', ');\n\t\t\t} else {\n\t\t\t\treturn that.Lang.BTN_ACL;\n\t\t\t}\n\t\t}","events": "click.my"},"#btn-clean": {"delay": 150,"bind": "function (d,v,$o) {\n\t\t\tvar that=this,\n\t\t\t\t\t\ta = d.doc.content;\n\t\t\tif (v!=null) {\n\t\t\t\ta.forEach(function(elt){\n\t\t\t\t\tif (elt.type==\"html\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telt.data = that.CleanHTML(elt.data);\n\t\t\t\t\t\t} catch (e){\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (elt.type==\"img\" || elt.type==\"embed\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telt.desc = that.CleanHTML(elt.desc);\n\t\t\t\t\t\t} catch (e){\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t//console.log(d.doc.content[0].data)\n\t\t\t\td.doc.content = that.CollapseItems(d.doc.content);\n\t\t\t\tcw.lib.note(\"Document cleaned.\",\"ok\");\n\t\t\t\t$o.my(\"find\",\"#meditor\").trigger(\"redraw\");\n\t\t\t}\n\t\t\treturn that.Lang.BTN_CLEANUP;\n\t\t}","events": "click.my"},"#btn-savedoc": {"delay": 50,"bind": "function (d,v) {\n\t\t\tvar that=this;\n\t\t\tif (v!=null) that.my.commit(\"#btn-savedoc\");\n\t\t\treturn that.Lang.BTN_SAVE;\n\t\t}","events": "click.my","css": {":disabled": "function () {return this.Cmd() == 'view';}"}},"#btn-closedoc": {"bind": "function (d,v) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) that.my.cancel(\"#btn-closedoc\");\n\t\t\treturn that.Lang.BTN_CLOSE;\n\t\t}","events": "click.my"},"#docactions": {"css": {"hide": "function () {return this.Cmd() == 'view';}"}},"#btn-undo": {"delay": 2,"bind": "function (d0,v,$o) {\n\t\t\tvar that = this,\n\t\t\t\t\td = d0.doc, \n\t\t\t\t\tcth = {}, \n\t\t\t\t\tctchanged = false,\n\t\t\t\t\tstylechange = false;\n\n\t\t\tif (v!=null) {\n\n\t\t\t\tvar h = that.my.find('#meditor').my().params.history  || {},\n\t\t\t\t\t\thd0 = cw.lib.crc2(d),\n\t\t\t\t\t\tkeys = Object.keys(h).sortBy(),\n\t\t\t\t\t\tct,\n\t\t\t\t\t\tobj;\n\n\t\t\t\tif (keys.length) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (keys.length > 1 ) {\n\t\t\t\t\t\t\twhile (hd0 == cw.lib.crc2(h[keys.last()])) {\n\t\t\t\t\t\t\t\tdelete h[keys.last()];\n\t\t\t\t\t\t\t\tkeys.pop();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobj = h[keys.last()];\n\t\t\t\t\t\tvar ct = $.extend(true,[], obj.content),\n\t\t\t\t\t\t\t\tatts = $.extend(true,{}, obj._attachments||{}),\n\t\t\t\t\t\t\t\tstyle = $.extend(true,{}, obj.style||{}),\n\t\t\t\t\t\t\t\tpreviews = $.extend(true,{}, obj.previews||{});\n\t\t\t\t\t\tif (keys.length > 1 ) {\n\t\t\t\t\t\t\tdelete h[keys.last()];\n\t\t\t\t\t\t\tkeys.pop();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (ct) {\n\n\t\t\t\t\t// Content, only changes\n\n\t\t\t\t\td.content.forEach(function(e, i){\n\t\t\t\t\t\tvar hash = cw.lib.crc2(Object.reject(e, ['random']));\n\t\t\t\t\t\tcth[e._stamp] = {hash:hash, idx:i}\n\t\t\t\t\t});\n\t\t\t\t\td.content = ct.map(function(e){\n\t\t\t\t\t\tvar old, hash;\n\t\t\t\t\t\tif (old = cth[e._stamp]) {\n\t\t\t\t\t\t\thash = cw.lib.crc2(Object.reject(e, ['random']));\n\t\t\t\t\t\t\tif (old.hash == hash) return d.content[old.idx];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctchanged = true;\n\t\t\t\t\t\te.random = Number.random(1e6,1e7)+\"\"; \n\t\t\t\t\t\treturn e;\n\t\t\t\t\t});\n\n\t\t\t\t\t// Styles\n\t\t\t\t\tif (cw.lib.crc2(style) != cw.lib.crc2(d.style)) {\n\t\t\t\t\t\td.style = style;\n\t\t\t\t\t\tstylechange = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Attaches\n\n\t\t\t\t\tif (Object.size(atts)) {\n\t\t\t\t\t\td._attachments = atts;\n\t\t\t\t\t\td.previews = previews;\n\t\t\t\t\t} \n\t\t\t\t\telse {\n\t\t\t\t\t\td.previews = {};\n\t\t\t\t\t\tdelete d._attachments;\n\t\t\t\t\t}\n\n\t\t\t\t\tthat.my.recalc(\"#atts\");\n\t\t\t\t\tif (ctchanged || stylechange) that.my.recalc(\"#medium\");\n\t\t\t\t\tif (stylechange) that.my.restyle();\n\n\t\t\t\t} else {\n\t\t\t\t\tcw.lib.note(that.Lang.MSG_NO_UNDO)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn that.Lang.BTN_UNDO;\n\t\t}","events": "click.my"},"#atts": {"init": "function ($o,form) {\n\t\t\tvar that = this,\n\t\t\t\t\td = form.data.doc;\n\t\t\t$o.my(\"cw.Sys.Attachments\", {\n\t\t\t\tdoc:d,\n\t\t\t\ttruncate:20,\n\t\t\t\tpreviews:'previews',\n\t\t\t\tsort: function (attObj, fname){\n\t\t\t\t\t//sort by preview / name\n\t\t\t\t\tif ((that.data.doc.previews||{})[fname]) {\n\t\t\t\t\t\treturn \"01-\"+fname;\n\t\t\t\t\t}\n\t\t\t\t\tvar ext = fname;\n\t\t\t\t\t// filter hidden\n\t\t\t\t\treturn /^\\./.test(fname)?null:\"02-\"+ext;\n\t\t\t\t},\n\t\t\t\tico:function (fobj, fname){\n\t\t\t\t\tif (d.previews[fname]) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t'<div class=\"img-preview30\" ',\n\t\t\t\t\t\t\t'style=\"background-image:url('+d.previews[fname].data+');\"></div>'\n\t\t\t\t\t\t].join('');\n\t\t\t\t\t}\n\t\t\t\t\tvar css=\"fi-paperclip\",\n\t\t\t\t\t\t\ttypes={\n\t\t\t\t\t\t\t\t\"fi-photo\":/\\.(png|jp[e]?g|gif|tif[f]?|bmp)$/i,\n\t\t\t\t\t\t\t\t\"fi-social-adobe\":/\\.(pdf|ai|psd)$/i,\n\t\t\t\t\t\t\t\t\"fi-page-doc\":/\\.(doc[x]?|txt|rtf)$/i,\n\t\t\t\t\t\t\t\t\"fi-graph-pie\":/\\.(xls[x]?|csv)$/i,\n\t\t\t\t\t\t\t\t\"fi-archive\":/\\.(zip|rar|7z|7zip)$/i,\n\t\t\t\t\t\t\t\t\"fi-html5 pl2\":/\\.(htm[l]|php)$/i,\n\t\t\t\t\t\t\t\t\"fi-css3 pl2\":/\\.css$/i,\n\t\t\t\t\t\t\t\t\"fi-widget\":/\\.(js[on]?|php|asp|jar|c|erl)$/i,\n\t\t\t\t\t\t\t\t\"fi-sound\":/\\.(wav|aiff|mp3|ogg|mpeg3)$/i\n\t\t\t\t\t\t\t};\n\t\t\t\t\tif (!fobj.digest) css=\"orange fi-burst-new\";\n\t\t\t\t\telse Object.each(types, function(key, re){\n\t\t\t\t\t\tif (re.test(fname)) css=key;\n\t\t\t\t\t});\n\t\t\t\t\treturn '<span class=\"'+css+' dib vam o80 lh110\" style=\"width:1.3em;\"></span>';\n\t\t\t\t},\n\t\t\t\tnamePopup:true,\n\t\t\t\tupload:that.Cmd() != 'view'?'<div class=\"hoverlink gray\">'\n\t\t\t\t\t+'<span class=\"fi-paperclip fs105 mr2\"></span> '\n\t\t\t\t\t+'<span class=\"pseudolink\">'+that.Lang.UPLOAD+'</span>'\n\t\t\t\t\t+'</div>':false,\n        uploadCss:that.Cmd() != 'view'?'mt5':'hide',\n\t\t\t\tnoDelete: function(fname, doc){\n\t\t\t\t\t// this fn hides Del button for attaches in use\n\t\t\t\t\tvar no = false,\n\t\t\t\t\t\t\tpreview = doc.meta.preview || '';\n          if (that.Cmd() == 'view') return true;\n\t\t\t\t\tif (fname == preview) return true;\n\t\t\t\t\tdoc.content.forEach(function(e){\n\t\t\t\t\t\tif (e.type=='img' && e.ref == fname) no = true;\n\t\t\t\t\t\telse if (e.type=='widget' && e.bg == fname) no = true;\n\t\t\t\t\t\telse if (e.type=='widget') {\n\t\t\t\t\t\t\tvar it;\n\t\t\t\t\t\t\ttry {it=JSON.parse(e.data.replace(/^\\(|\\)$/g,''))} catch(err){}\n\t\t\t\t\t\t\tif (Object.isObject(it)) {\n\t\t\t\t\t\t\t\tif (e.source == \"Gallery\" || e.source == \"Files\") {\n\t\t\t\t\t\t\t\t\tvar j = it.items;\n\t\t\t\t\t\t\t\t\tif (Object.isArray(j) && j.length) {\n\t\t\t\t\t\t\t\t\t\tj.forEach(function(row){ if (row.url == fname) no = true; });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} // end gallery & files\n\t\t\t\t\t\t\t\telse if (e.source == \"Cards\") {\n\t\t\t\t\t\t\t\t\tvar j = it.items;\n\t\t\t\t\t\t\t\t\tif (Object.isArray(j) && j.length) {\n\t\t\t\t\t\t\t\t\t\tj.forEach(function(row){ if (row.photo == fname) no = true; });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} // end cards\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} // end widget check\n\t\t\t\t\t});\n\t\t\t\t\treturn no;\n\t\t\t\t}\n\t\t\t});\n\t\t}","bind": "function () {}"}},"Items": {},"lang": {"en": {"BTN_CLEANUP": "Clean up","BTN_SAVE": "Save","BTN_CLOSE": "Close","BTN_TOHTML": "Generate HTML","BTN_ADDIMAGE": "Add image...","BTN_ACL": "Access control...","BTN_UNDO": "Undo","MSG_NO_UNDO": "Undo history is empty.","PLC_TAGS": "Add doc tags...","UPLOAD": "Upload file..."},"ru": {"BTN_CLEANUP": "Оптимизировать","BTN_SAVE": "Сохранить","BTN_CLOSE": "Закрыть","BTN_TOHTML": "Экспорт в HTML","BTN_ADDIMAGE": "Добавить фото...","BTN_ACL": "Контроль доступа...","BTN_UNDO": "Отменить","MSG_NO_UNDO": "История правок пуста.","PLC_TAGS": "Добавить теги...","UPLOAD": "Загрузить файл..."}},"style": {" #meditor": "function ($form) {\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tw \t= $form.width(),\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = + (this.params.navHeight || 0),\n        view = this.Cmd() == 'view',\n\t\t\t\tcss = [\n          'width:{1}px;'\t\t\t\t.assign(w- (view?0:221)),\n          'padding-left:{1}px;'\t.assign(view?0:23),\n          'height:{1}px;'\t\t\t\t.assign($(window).height()-(pad+nav+ofs+15))\n        ].join('');\n\t\treturn css;\n\t}"," #control": "function () {\n    return this.Cmd()=='view'?'display:none!important;':'display:inline-block!important;';\n  }"," #atts": "function ($form) {\n\t\tvar ofs = $(\"#l-header\").is(\":visible\")?$(\"#l-header\").outerHeight(true)\n\t\t\t\t:$(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true)\n\t\t\t\t:0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\ttagsheight = $form.find('#s2id_doctags').height() || 35,\n\t\t\t\tactsheight = $form.find('#docactions').height() || 100,\n\t\t\t\th = $(window).height()-185-ofs-pad-tagsheight-actsheight;\n\t\t\n\t\treturn {\n\t\t\t' #att-flist':'overflow-y:scroll;overflow-y:overlay;-webkit-overflow-scrollingtouch; '\n\t\t\t+'transition:max-height 0.2s; max-height:'+h+'px;',\n\t\t\t\n\t\t\t' .img-preview30':'display:inline-block;vertical-align:top;width:36px;height:27px;overflow:hidden;'\n\t\t\t+'background-size:cover; background-position: 50% 50%;margin: 5px 5px 0 0;border-radius:1px;opacity:0.92;',\n\t\t\t\n\t\t\t' #att-fpanel':'border-top: 1px dotted rgba(108, 164, 205, 0.35);margin:10px 0 8px 0;',\n\t\t\t' .cw-att-desc':'font-size:11px;line-height:1.1em;margin-top:0px;opacity:0.8;'\n\t\t}\n\t}"," .nicescroll-rails": "z-index:50!important;"," .btn-l": "border-radius:3px 0 0 3px;"," .btn-r": "border-radius:0 3px 3px 0;"," .btn-c": "border-radius:0;"," .button": "outline:none!important"," .in-br0 .in-ct": "border-radius:0!important;"," .w78": "width:78px!important"," .w205": "width:205px"," .cw-hoverpane": "background-color: #f8fafc!important;","": "font-size:19px"," .cw-item": "padding-bottom:0!important;"," .tag-in-fmt": {" .tag": {"": "display:inline-block;width:42px;height:32px;color:transparent!important;overflow:hidden;border-radius:1px!important;padding:0!important; margin:0 3px 0 0!important;border:1px solid transparent; transition:border 0.3s;",":hover": "border-color:#fab",".active": "border-color: rgb(166, 210, 235);background-color: #EAF9FF!important;",".active:hover": "border-color: rgb(166, 210, 235);"}," .tag>span": {"": "display:inline-block;width:40px;height:30px;background-position-y:0px;background-repeat:no-repeat;"," ": "function () { \n        return 'background-image:url(\\'data:image/svg+xml;base64,'+cw.lib.base64(this.Ed.SVG.Options)+'\\');';\n      }",".t-left200": "background-position-x:0px;",".t-left300": "background-position-x:-40px;",".t-left500": "background-position-x:-80px;",".t-left750": "background-position-x:-120px;",".t-left1000": "background-position-x:-160px;",".t-right300": "background-position-x:-200px;",".t-right200": "background-position-x:-240px;",".t-small": "background-position-x:-280px;",".t-normal": "background-position-x:-320px;",".t-large": "background-position-x:-360px;",".t-background": "background-position-x:-400px;",".t-frame": "background-position-x:-440px;",".t-rules": "background-position-x:-480px;",".t-accented": "background-position-x:-520px;"}}},"HTML": ["<div id=\"meditor\" class=\"dib vat\"></div>","<div id=\"control\" class=\"w200 vat ml20\">",{"row": "200px","label": "50px","rowCss": "my-row"},["","btn#btn-savedoc.tac.green.fs90.mr5.w100.pl0.pr0",{"val": "Save"},"btn#btn-closedoc.tac.fs90.w95.pl0.pr0",{"val": "Close"}],"<div id=\"docaux\"></div>","<div class=\"mt10 nocwmin\"><select id=\"encrypt\" class=\"fs90 w200\"></select></div>","<div class=\"mt10 mb7\"><input type=\"text\" id=\"doctags\" class=\"fs80 w200\"></div>","<div id=\"atts\" class=\"fs80 xgray\"></div>","<div id=\"docactions\" class=\"lh130\">","<div class=\"hoverlink gray fs80\"><span class=\"fi-crop ml-1 mr3\"></span> <span id=\"btn-addphoto\" class=\"pseudolink\">Add image...</span></div>","<div class=\"fs80 gray hoverlink\"><span class=\"fi-check mr3\"></span> <span class=\"pseudolink\" id=\"btn-clean\">Clean up</span></div>","<div class=\"fs80 gray hoverlink\"><span class=\"fi-torsos mr3\"></span> <span class=\"pseudolink\" id=\"btn-acl\">Access control</span></div>","<div class=\"fs80 gray hoverlink\"><span class=\"fi-rewind mr4\"></span> <span class=\"pseudolink\" id=\"btn-undo\">Undo</span></div>","</div>","<div class=\"fs70 mt5 gray\">_id: <span id=\"docid\"></span></div>","</div>"],"Att": "function (fname,rtype) {\n\n\t// Returns attach in appropriate format, defined by rtype,\n\t// \"url\" returns session or data URL,\n\t// \"data\" returns data URL.\n\t// If rtype is object {content_type:\"mime/type\", data:\"b64\"},\n\t// appends this object to doc attachments.\n\n\t// First arg can be obj {name:fname, type:type}\n\n\tvar that = this,\n\t\t\tu = that.SessionUrls || (that.SessionUrls = {}),\n\t\t\td = that.data.doc,\n\t\t\ta = d._attachments || (d._attachments = {}),\n\t\t\tpending = that.PendingUrls || (that.PendingUrls = {});\n\n\t// Store\n\tif (fname && Object.isObject(rtype)) {\n\t\ta[fname] = Object.select(rtype, ['content_type','data']);\n\t\tif (rtype.preview && d.previews) {\n\t\t\td.previews[fname] = rtype.preview;\n\t\t}\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t\treturn a;\n\t}\n\n\t// Recalc atts\n\tif (fname === true) {\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t}\n\n\tif (fname == null) return a;\n\t\n\tif (rtype == \"session\") return u;\n\n\tif (rtype==\"url\" && u[fname]) return u[fname];\n\telse {\n\t\tvar pi = $.Deferred(),\n\t\t\t\tid = that.data.doc._id,\n\t\t\t\tdb = that.db;\n\n\t\tif (!id) pi.reject();\n\t\telse {\n\n\t\t\t//-------------------\n\n\t\t\tif (rtype==\"url\") {\n\n\t\t\t\tif (a && a[fname] && a[fname].data && !a[fname].digest) {\n\t\t\t\t\treturn 'data:'+a[fname].content_type+';base64,'+a[fname].data;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (pending[fname]) {\n\t\t\t\t\tpi.resolve();\n\t\t\t\t\treturn pending[fname];\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tpending[fname] = pi.promise();\n\t\t\t\t\tcw.db(that.db.name)\n\t\t\t\t\t.getAttachment(id, fname+'')\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\tvar url = URL.createObjectURL(blob);\n\t\t\t\t\t\t\tu[fname] = url;\n\t\t\t\t\t\t\tpi.resolve(url);\n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(err){ \n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t\tpi.reject(); \n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//-------------------\n\n\t\t\telse if (rtype==\"data\") {\n\n\t\t\t\tif (a && a[fname] && a[fname].data) {\n\t\t\t\t\tpi.resolve (a[fname].data);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.db(that.db.name).getAttachment(id, fname+'')\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ pi.resolve(data); });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(); }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//-------------------\n\n\t\t\telse if (rtype == \"preview\") {\n\t\t\t\tvar names = [],\n\t\t\t\t\t\tres = [];\n\t\t\t\tif (Object.isString(fname)) names.push(fname);\n\t\t\t\telse if (Object.isArray(fname)) names = fname;\n\t\t\t\telse if (Object.isRegExp(fname)) {\n\t\t\t\t\tnames = Object.keys(a).filter(fname).sortBy();\n\t\t\t\t}\n\t\t\t\tif (!names.length) pi.resolve([]);\n\t\t\t\telse {\n\t\t\t\t\tvar icos = d.previews || (d.previews = {}),\n\t\t\t\t\t\t\tsubnames = Object.keys(icos).intersect(names);\n\t\t\t\t\tif (subnames.length == names.length) {\n\t\t\t\t\t\t// we have all previews\n\t\t\t\t\t\tnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// we have to generate previews\n\t\t\t\t\t\tsubnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar missing = names.subtract(subnames),\n\t\t\t\t\t\t\t\tpis = [];\n\t\t\t\t\t\t\n\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\tvar pi0 = $.Deferred();\n\t\t\t\t\t\t\tpis.push(pi0);\n\t\t\t\t\t\t\tif (a[i] && a[i].data) {\n\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, a[i].data, pi0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// load attach\n\t\t\t\t\t\t\t\tcw.db(that.db.name).getAttachment(id, i)\n\t\t\t\t\t\t\t\t.then (\n\t\t\t\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ \n\t\t\t\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, data, pi0);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfunction(){ pi0.resolve(null); }\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}); // end forEach\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now pis is list of promises\n\t\t\t\t\t\t$.when.apply(null, pis)\n\t\t\t\t\t\t.done(function(){\n\t\t\t\t\t\t\tfor (var t, j=0; j<arguments.length;j++) {\n\t\t\t\t\t\t\t\tvar t = arguments[j];\n\t\t\t\t\t\t\t\tif (t != null) icos[t.fname] = t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\t\tif (icos[i]) res.push(icos[i]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tres.sortBy('fname');\n\t\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn pi.promise();\n\n\t\t// - - - - - - - - - - - - - - - \n\n\t\tfunction _genPreview(name,mime, data, pi0){\n\t\t\tvar $i = $('<img src=\"\"/>'),\n\t\t\t\t\tpv = {\n\t\t\t\t\t\tfname:name,\n\t\t\t\t\t\tsize:'?',\n\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\tdim:'?×?',\n\t\t\t\t\t\tdata:''\n\t\t\t\t\t};\n\t\t\t$i.attr(\"src\",'data:'+mime+';base64,'+data);\n\t\t\t$i.load(function(){\n\t\t\t\tvar ico, \n\t\t\t\t\t\timg = cw.lib.image($i,\"white\");\n\t\t\t\tpv.dim = img.width() + '×'+ img.height();\n\t\t\t\tvar l = (data.length/4*3).round();\n\t\t\t\tpv.size = l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\";\n\t\t\t\tico = img.resample(150);\n\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height());\n\t\t\t\tpv.data = ico.sharpen(0.2).contrast(1.05).jpeg(0.65);\n\t\t\t\t$i.remove();\n\t\t\t\tpi0.resolve(pv);\n\t\t\t});\n\t\t} \n\t}\n\n}","CleanHTML": "function (s) {\n\n\tvar ctr = 0, res = _compress(s), res0;\n\twhile (ctr < 6 && res0 != res) {\n\t\tres0 = res;\n\t\tres = _compress(res);\n\t\tctr +=1\n\t}\n\t\n\tif (!res) res = '<p><br/></p>';\n\t\n\treturn res;\n\t\n\t\n\t//- - - - - - - - - - -\n\n\tfunction _compact(s){\n\t\treturn $('<span>'+s.replace(/[\\s\\n\\r\\t]+/g,' ')+'</span>').html()\n\t\t.replace(/(&nbsp;|\\s)(—|–|-{1,2})(&nbsp;|\\s)([а-яё])/ig,'\\u00A0– $4')\n\t\t.replace(/(&nbsp;|\\s)(—|–|-{1,2})(&nbsp;|\\s)([\\w])/ig,'\\u202F—\\u2006$4')\n\t\t.replace(/([\\w])(&nbsp;|\\s)(—|–|-{1,2})(&[a-z]+sp;|\\s)+/ig,'$1\\u202F—\\u2006')\n\t\t.replace(/([\\wа-яё0-9])'([\\wа-яё0-9])/ig,'$1’$2')\n\t\t.replace(/(&nbsp;|\\s)\"([а-яё])/gi,' «$2').replace(/([а-яё])\"(&nbsp;|\\s)/gi,'$1» ')\n\t\t.replace(/(&nbsp;|\\s)\"(\\w)/gi,' “$2').replace(/(\\w)\"(&nbsp;|\\s)/gi,'$1” ');\n\t}\n\t\n\t// - - - - - - - - - - - - - - - - - \n\n\tfunction _construct (tag, attrs, unary) {\n\n\t\tvar i, c={id:null}, h = '<'+tag;\n\t\t\n\t\tif (/^(p|table|h\\d|span|pre)$/.test(tag) && unary) return \"\";\n\t\t\n\t\tif (attrs && attrs.length) {\n\t\t\tfor (i=0;i<attrs.length;i++) {\n\t\t\t\tvar aname = attrs[i].name.toLowerCase(),\n\t\t\t\t\t\taval = _attr (tag, aname, attrs[i].escaped);\n\t\t\t\tif (aval) {\n\t\t\t\t\tc[aname] = aname+(attrs[i].value!=null?'=\"'+aval+'\"':'');\n\t\t\t\t}\n\t\t\t}\n\t\t\tObject.keys(c).forEach(function(e){ if (null!=c[e]) h+=\" \"+c[e]; });\n\t\t}\n\t\th+=unary?'/>':'>';\n\t\treturn h;\n\t}\n\n\t//- - - - - - - - - - -\n\t\n\tfunction _attr (tag, aname, v) {\n\t\tvar i,j,a, s = v;\n\t\t\n\t\tif (aname == \"style\") {\n\t\t\ta = v.split(\";\").compact(true).map(function(e){return e.compact(true)});\n\t\t\ta = a.reduce(function(a,b) {\n\t\t\t\tif (/(inherit|initial)/i.test(b)) return a;\n\t\t\t\tif (/^(color|background-color):/i.test(b)) a.push(b);\n\t\t\t\tif (/^(td|table|th|img)$/.test(tag) && /^width:/.test(b)) a.push(b);\n\t\t\t\tif (/^(p|td|table|h\\d|blockquote)$/.test(tag) && /^text-align:/.test(b)) a.push(b);\n\t\t\t\treturn a;\n\t\t\t},[]);\n\t\t\ts = a.join(\"; \").compact(true);\n\t\t}\n\t\telse if (aname == \"class\") {\n\t\t\t// not all tags allowed to have class\n\t\t\tif (/^(i|b|em|strong|tr|tbody|li|ul|ol)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == \"src\") {\n\t\t\tif (!/^(img)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == \"href\" || aname == \"target\") {\n\t\t\tif (!/^(a)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == \"rowspan\" || aname == \"colspan\") {\n\t\t\tif (!/^(td|th)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == 'start') {\n\t\t\tif (!/^(ol)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse {\n\t\t\tif (!/^(id|name)$/i.test(aname)) s='';\n\t\t}\n\t\t\n\t\treturn s;\n\t}\n\t\n\t//- - - - - - - - - - -\n\n\tfunction _compress (h){\n\n\t\tvar parse = window.HTMLParser,\n\t\t\t\tkeepSpace = [],\n\t\t\t\tstack=[],\n\t\t\t\tres=[];\n\n\t\tparse(h, {\n\t\t\tstart: function(tag, attrs, unary) {\n\t\t\t\tvar rt = tag.toLowerCase(),\n\t\t\t\t\t\tt = (stack.length || /^(p|h1|h2|h3|h4|table|blockquote|ul|ol|img|pre|hr)$/.test(rt))?rt:'p',\n\t\t\t\t\t\thtml = _construct(t, rt!=t?[]:attrs, unary),\n\t\t\t\t\t\tespan = html == '<span>';\n\t\t\t\tif(/^(p|blockquote|h\\d|pre)$/.test(t) && stack.length && stack.last().tag == t) {\n\t\t\t\t\tstack.last().closed = true;\n\t\t\t\t\tres.push('</'+t+'>');\n\t\t\t\t}\n\t\t\t\tres.push(espan?'':html);\n\t\t\t\tif (!unary) {\n\t\t\t\t\tif (/^(script|pre|textarea|code)$/.test(t)) {\n\t\t\t\t\t\tkeepSpace.push(true);\n\t\t\t\t\t}\n\t\t\t\t\tstack.push({tag:rt, attrs:attrs, closed:!html, retag:t!=rt?t:null, empty:true, espan:espan});\n\t\t\t\t} else {\n\t\t\t\t\tstack.forEach(function(elt){elt.empty = false});\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: function(tag) {\n\t\t\t\tvar a, s, process, type, src,\n\t\t\t\t\t\tt = tag.toLowerCase();\n\n\t\t\t\tif (/^(script|pre|textarea|code)$/.test(t)) keepSpace.pop();\n\t\t\t\t\n\t\t\t\tvar last = stack.pop();\n\t\t\t\tif (!last.closed) {\n\t\t\t\t\tif (last.empty && !last.espan) res.pop();\n\t\t\t\t\telse if (last.espan) res.push('');\n\t\t\t\t\telse res.push('</'+(last.retag || t)+'>');\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tchars: function(chars) {\n\t\t\t\t\n\t\t\t\tif (!stack.length) res.push('<p>');\n\n\t\t\t\tif (keepSpace.length) res.push (chars);\n\t\t\t\telse res.push (_compact(chars));\n\t\t\t\t\n\t\t\t\tif (!stack.length) res.push('</p>');\n\t\t\t\telse {\n\t\t\t\t\tstack.forEach(function(elt){elt.empty = false});\n\t\t\t\t}\n\t\t\t},\n\t\t\tdoctype: function(t) {res.push(t);},\n\t\t});\n\t\t\n\t\t//return res.join(\"\") .replace(/<p><\\/p>/g,'') .replace(/<p><br[\\/]?><\\/p>/g,'');\n\t\t\n\t\treturn $('<div>'+res.join(\"\") .replace(/<p><\\/p>/g,'') .replace(/<p><br[\\/]?><\\/p>/g,'') +'</div>').html();\n\t}\n\n\n\n\t//- - - - - - - - - - -\n\n\tfunction _compressJS (s0) {\n\t\tvar s = s0;\n\t\t// compress and uglify \n\t\tvar u = UglifyJS,\n\t\t\t\tast = u.parse(s+\"\");\n\t\tast.figure_out_scope();\n\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\tast.figure_out_scope();\n\t\tast.mangle_names();\n\t\treturn ast.print_to_string();\n\t}\n\n\n}","HTMLParser": "function (global) {\n\t/*\n\t\n\thttps://github.com/netgusto/htmlparser-jresig/blob/master/htmlparser-lib/htmlparser.js\n\t\n * HTML Parser By John Resig (ejohn.org)\n * Original code by Erik Arvidsson, Mozilla Public License\n * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js\n\n */\n\n\t(function(){\n\n\t\t// Regular Expressions for parsing tags and attributes\n\t\tvar startTag = /^<([\\w\\.\\-]+)((?:\\s+[\\w\\.\\-]+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?)*)\\s*(\\/?)>/,\n\t\t\t\tendTag = /^<\\/([\\w\\.\\-]+)[^>]*>/,\n\t\t\t\tattr = /([\\w\\.\\-]+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/g;\n\n\t\t// Empty Elements - HTML 4.01\n\t\tvar empty = makeMap(\"area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed\");\n\n\t\t// Block Elements - HTML 4.01\n\t\tvar block = makeMap(\"address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul\");\n\n\t\t// Inline Elements - HTML 4.01\n\t\tvar inline = makeMap(\"a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var\");\n\n\t\t// Elements that you can, intentionally, leave open\n\t\t// (and which close themselves)\n\t\tvar closeSelf = makeMap(\"colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr\");\n\n\t\t// Attributes that have their values filled in disabled=\"disabled\"\n\t\tvar fillAttrs = makeMap(\"checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected\");\n\n\t\t// Special Elements (can contain anything)\n\t\tvar special = makeMap(\"\");\n\n\t\tvar HTMLParser = this.HTMLParser = function( html, handler ) {\n\t\t\tvar index, chars, match, stack = [], last = html;\n\t\t\tstack.last = function(){\n\t\t\t\treturn this[ this.length - 1 ];\n\t\t\t};\n\n\t\t\twhile ( html ) {\n\t\t\t\tchars = true;\n\n\t\t\t\t// Make sure we're not in a script or style element\n\t\t\t\tif ( !stack.last() || !special[ stack.last() ] ) {\n\n\t\t\t\t\t// Comment\n\t\t\t\t\tif ( html.indexOf(\"<!--\") == 0 ) {\n\t\t\t\t\t\tindex = html.indexOf(\"-->\");\n\n\t\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\t\tif ( handler.comment )\n\t\t\t\t\t\t\t\thandler.comment( html.substring( 4, index ) );\n\t\t\t\t\t\t\thtml = html.substring( index + 3 );\n\t\t\t\t\t\t\tchars = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// end tag\n\t\t\t\t\t} else if ( html.indexOf(\"</\") == 0 ) {\n\t\t\t\t\t\tmatch = html.match( endTag );\n\n\t\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\t\tmatch[0].replace( endTag, parseEndTag );\n\t\t\t\t\t\t\tchars = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// start tag\n\t\t\t\t\t} else if ( html.indexOf(\"<\") == 0 ) {\n\t\t\t\t\t\tmatch = html.match( startTag );\n\n\t\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\t\tmatch[0].replace( startTag, parseStartTag );\n\t\t\t\t\t\t\tchars = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( chars ) {\n\t\t\t\t\t\tindex = html.indexOf(\"<\");\n\n\t\t\t\t\t\tvar text = index < 0 ? html : html.substring( 0, index );\n\t\t\t\t\t\thtml = index < 0 ? \"\" : html.substring( index );\n\n\t\t\t\t\t\tif ( handler.chars )\n\t\t\t\t\t\t\thandler.chars( text );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\thtml = html.replace(new RegExp(\"(.*)<\\/\" + stack.last() + \"[^>]*>\"), function(all, text){\n\t\t\t\t\t\ttext = text.replace(/<!--(.*?)-->/g, \"$1\")\n\t\t\t\t\t\t.replace(/<!\\[CDATA\\[(.*?)]]>/g, \"$1\");\n\n\t\t\t\t\t\tif ( handler.chars )\n\t\t\t\t\t\t\thandler.chars( text );\n\n\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t});\n\n\t\t\t\t\tparseEndTag( \"\", stack.last() );\n\t\t\t\t}\n\n\t\t\t\tif ( html == last )\n\t\t\t\t\tthrow \"Parse Error: \" + html;\n\t\t\t\tlast = html;\n\t\t\t}\n\n\t\t\t// Clean up any remaining tags\n\t\t\tparseEndTag();\n\n\t\t\tfunction parseStartTag( tag, tagName, rest, unary ) {\n\t\t\t\ttagName = tagName.toLowerCase();\n\n\t\t\t\tif ( block[ tagName ] ) {\n\t\t\t\t\twhile ( stack.last() && inline[ stack.last() ] ) {\n\t\t\t\t\t\tparseEndTag( \"\", stack.last() );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( closeSelf[ tagName ] && stack.last() == tagName ) {\n\t\t\t\t\tparseEndTag( \"\", tagName );\n\t\t\t\t}\n\n\t\t\t\tunary = empty[ tagName ] || !!unary;\n\n\t\t\t\tif ( !unary )\n\t\t\t\t\tstack.push( tagName );\n\n\t\t\t\tif ( handler.start ) {\n\t\t\t\t\tvar attrs = [];\n\n\t\t\t\t\trest.replace(attr, function(match, name) {\n\t\t\t\t\t\tvar value = arguments[2] ? arguments[2] :\n\t\t\t\t\t\targuments[3] ? arguments[3] :\n\t\t\t\t\t\targuments[4] ? arguments[4] :\n\t\t\t\t\t\tfillAttrs[name] ? name : \"\";\n\n\t\t\t\t\t\tattrs.push({\n\t\t\t\t\t\t\tname: name,\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tescaped: value.replace(/(^|[^\\\\])\"/g, '$1\\\\\\\"') //\"\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( handler.start )\n\t\t\t\t\t\thandler.start( tagName, attrs, unary );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction parseEndTag( tag, tagName ) {\n\t\t\t\t// If no tag name is provided, clean shop\n\t\t\t\tif ( !tagName )\n\t\t\t\t\tvar pos = 0;\n\n\t\t\t\t// Find the closest opened tag of the same type\n\t\t\t\telse\n\t\t\t\t\tfor ( var pos = stack.length - 1; pos >= 0; pos-- )\n\t\t\t\t\t\tif ( stack[ pos ] == tagName )\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\tif ( pos >= 0 ) {\n\t\t\t\t\t// Close all the open elements, up the stack\n\t\t\t\t\tfor ( var i = stack.length - 1; i >= pos; i-- )\n\t\t\t\t\t\tif ( handler.end )\n\t\t\t\t\t\t\thandler.end( stack[ i ] );\n\n\t\t\t\t\t// Remove the open elements from the stack\n\t\t\t\t\tstack.length = pos;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.HTMLtoXML = function( html ) {\n\t\t\tvar results = \"\";\n\n\t\t\tHTMLParser(html, {\n\t\t\t\tstart: function( tag, attrs, unary ) {\n\t\t\t\t\tresults += \"<\" + tag;\n\n\t\t\t\t\tfor ( var i = 0; i < attrs.length; i++ )\n\t\t\t\t\t\tresults += \" \" + attrs[i].name + '=\"' + attrs[i].escaped + '\"';\n\n\t\t\t\t\tresults += (unary ? \"/\" : \"\") + \">\";\n\t\t\t\t},\n\t\t\t\tend: function( tag ) {\n\t\t\t\t\tresults += \"</\" + tag + \">\";\n\t\t\t\t},\n\t\t\t\tchars: function( text ) {\n\t\t\t\t\tresults += text;\n\t\t\t\t},\n\t\t\t\tcomment: function( text ) {\n\t\t\t\t\tresults += \"<!--\" + text + \"-->\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn results;\n\t\t};\n\n\t\t/*this.HTMLtoDOM = function( html, doc ) {\n\t\t\t// There can be only one of these elements\n\t\t\tvar one = makeMap(\"html,head,body,title\");\n\n\t\t\t// Enforce a structure for the document\n\t\t\tvar structure = {\n\t\t\t\tlink: \"head\",\n\t\t\t\tbase: \"head\"\n\t\t\t};\n\n\t\t\tif ( !doc ) {\n\t\t\t\tif ( typeof DOMDocument != \"undefined\" )\n\t\t\t\t\tdoc = new DOMDocument();\n\t\t\t\telse if ( typeof document != \"undefined\" && document.implementation && document.implementation.createDocument )\n\t\t\t\t\tdoc = document.implementation.createDocument(\"\", \"\", document.implementation.createDocumentType('html', '', ''));\n\t\t\t\telse if ( typeof ActiveX != \"undefined\" )\n\t\t\t\t\tdoc = new ActiveXObject(\"Msxml.DOMDocument\");\n\n\t\t\t} else\n\t\t\t\tdoc = doc.ownerDocument ||\n\t\t\t\t\tdoc.getOwnerDocument && doc.getOwnerDocument() ||\n\t\t\t\t\tdoc;\n\n\t\t\tvar elems = [],\n\t\t\t\t\tdocumentElement = doc.documentElement ||\n\t\t\t\t\tdoc.getDocumentElement && doc.getDocumentElement();\n\n\t\t\t// If we're dealing with an empty document then we\n\t\t\t// need to pre-populate it with the HTML document structure\n\t\t\tif ( !documentElement && doc.createElement ) (function(){\n\t\t\t\tvar html = doc.createElement(\"html\");\n\t\t\t\tvar head = doc.createElement(\"head\");\n\t\t\t\thead.appendChild( doc.createElement(\"title\") );\n\t\t\t\thtml.appendChild( head );\n\t\t\t\thtml.appendChild( doc.createElement(\"body\") );\n\t\t\t\tdoc.appendChild( html );\n\t\t\t})();\n\n\t\t\t// Find all the unique elements\n\t\t\tif ( doc.getElementsByTagName )\n\t\t\t\tfor ( var i in one )\n\t\t\t\t\tone[ i ] = doc.getElementsByTagName( i )[0];\n\n\t\t\t// If we're working with a document, inject contents into\n\t\t\t// the body element\n\t\t\tvar curParentNode = one.body;\n\n\t\t\tHTMLParser( html, {\n\t\t\t\tstart: function( tagName, attrs, unary ) {\n\t\t\t\t\t// If it's a pre-built element, then we can ignore\n\t\t\t\t\t// its construction\n\t\t\t\t\tif ( one[ tagName ] ) {\n\t\t\t\t\t\tcurParentNode = one[ tagName ];\n\t\t\t\t\t\tif ( !unary ) {\n\t\t\t\t\t\t\telems.push( curParentNode );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar elem = doc.createElement( tagName );\n\n\t\t\t\t\tfor ( var attr in attrs ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telem.setAttribute( attrs[ attr ].name, attrs[ attr ].value );\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( structure[ tagName ] && typeof one[ structure[ tagName ] ] != \"boolean\" )\n\t\t\t\t\t\tone[ structure[ tagName ] ].appendChild( elem );\n\n\t\t\t\t\telse if ( curParentNode && curParentNode.appendChild )\n\t\t\t\t\t\tcurParentNode.appendChild( elem );\n\n\t\t\t\t\tif ( !unary ) {\n\t\t\t\t\t\telems.push( elem );\n\t\t\t\t\t\tcurParentNode = elem;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function( tag ) {\n\t\t\t\t\telems.length -= 1;\n\n\t\t\t\t\t// Init the new parentNode\n\t\t\t\t\tcurParentNode = elems[ elems.length - 1 ];\n\t\t\t\t},\n\t\t\t\tchars: function( text ) {\n\t\t\t\t\tcurParentNode.appendChild( doc.createTextNode( text ) );\n\t\t\t\t},\n\t\t\t\tcomment: function( text ) {\n\t\t\t\t\t// create comment node\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn doc;\n\t\t};*/\n\n\t\tfunction makeMap(str){\n\t\t\tvar obj = {}, items = str.split(\",\");\n\t\t\tfor ( var i = 0; i < items.length; i++ )\n\t\t\t\tobj[ items[i] ] = true;\n\t\t\treturn obj;\n\t\t}\n\t}).call(global);\n}","CollapseItems": "function (items) {\n\t// Collapses subsequent .type:\"html\n\t// items\n\t\n\tvar a =[];\n\titems.forEach(function(elt){\n\t\tif (!a.length) a.push(elt);\n\t\telse {\n\t\t\tif (\n\t\t\t\telt.type == \"html\" \n\t\t\t\t&& a.last().type==\"html\"\n\t\t\t\t&& (elt.css||[]).sortBy()+\"\" == (a.last().css||[]).sortBy()+\"\"\n\t\t\t) {\n\t\t\t\ta.last().data += elt.data;\n\t\t\t} \n\t\t\telse if (elt.type == \"html\") {\n\t\t\t\tif (elt.data && elt.data.compact()) a.push(elt);\n\t\t\t}\n\t\t\telse a.push(elt);\n\t\t}\n\t})\n\treturn a;\n}","Scripts": {"Client": "function _InlinerGlobalInit(window) {\n  \n  // Parallax and scroller initializer\n  // for Inliner-generated pages 4.0\n  \n  // Init: run this function before all Inliner-generated \n  // HTML page code\n\n  // Usage:\n  // Inliner.Parallax(['.selector1','.selector2'], { opts }) – applies parallax\n  // Inliner.Parallax(true) – recalculates parallax, needed if other elements change size\n  // Inliner.Parallax(false) – stops all parallax animators\n\n  // Requires Sugar.js 1.4.x and jQuery 2.x\n\n  if (!Object.isObject(window.Inliner)) window.Inliner = {};\n\n  (function(){\n\n    var I = window.Inliner,\n        hasYT = ('YT' in window),\n        Height = $(window).height(),\n        menuHeight = 0,\n        oCurr= 0,\n        oPrev = 0,\n        oMax = 0,\n        body0 = document.documentElement, \n        body1 = document.body,\n        frames = [],\n        stamp = -1,\n        dirty = false,\n        loopStarted = false,\n        _adjust = _readjust.debounce(200),\n        onTop;\n\n    // Scroller\n    I.ScrollToHash = function(){\n      var hash = (window.location.hash+'').replace(/^#/,''),\n          $p;\n      if (hash){\n        $p = $('#'+hash);\n        if ($p.length) {\n          $('body,html').animate({scrollTop:($p.offset().top-60).clamp(0,1e6)+'px'},250);\n        }\n      }\n    }\n\n    // a# links handler\t\n\n    $(function(){\t\t\n      $('body').on('click.my','a', function(){\t\t\n        var $a = $(this), $t,\t\t\n            href = $a.attr('href'),\n            href1 = href.split('#')[1],\n            l = window.location,\n            pa = (l+'').split('#'),\n            p = pa[0]+'#';\t\t\n        if (/^#.+/.test(href) || href.to(p.length) == p) {\t\t\n          $('body,html').animate({scrollTop:($('#'+href1).offset().top-60).clamp(0,1e6)+'px'},250);\n          window.location.hash = href1;\n          return false;\t\t\n        }\t\t\n      });\t\t\n    });\n\n    // Parallax\n\n    I.Parallax = function(a, options){\n\n      if (a===true) {\n        // readjust\n        _adjust();\n      }\n      else if (a===false) {\n        // Stop animations\n        $(document).off('scroll.in');\n        loopStarted = false;\n      }\n      else if (Object.isArray(a)) {\n        // Build by selector(s)\n        var $items = $(a.join(',')),\n            opts = $.extend(!0, {slow:3, menuHeight:0, onTop:''}, options || {});\n\n        Height = $(window).height();\n        menuHeight = opts.menuHeight;\n\n        if (opts.onTop && $(opts.onTop).size()) {\n          onTop = {\n            btn:$(opts.onTop)[0],\n            isOn:false\n          };\n          $(opts.onTop).on('click.in', function(){\n            $('body,html').animate({scrollTop:'0px'},200);\n            return false;\n          });\n        }\n\n        if ($items.size()) $items.each(function(){ _prepare($(this), opts); });\n\n        if (!loopStarted) _start();\n      }\n\n      return frames;\n\n    }; //-- end I.Parallax\n\n\n\n    // Window resize handler\n\n    $(window).on('resize.in', function(){\n      _readjust();\n      (2).times(_readjust.lazy(500));\n    }.debounce(100));\n\n\n    // image click handler\t\n\n    $(function(){\t\t\n      $('body').on('click.my','.in-zoomable .in--img-frame>img', function(){\t\t\n\n        var $i = $(this),\n            w,w0,\n            width,width0, \n            h,h0, \n            text;\n\n        text = $i.attr('alt') || $i.attr('title') || $i.data('text') || '';\n        w = $i[0].naturalWidth || $i[0].width;\n        h = $i[0].naturalHeight || $i[0].height;\n        if ($i.is('.in-zoomable.in-retina img')) {\n          w = w/2|0; h = h/2|0;\n        }\n        if (h<1) h=1;\n        if (w<1) w=1;\n        w0 = $(window).width()-90;\n        h0 = $(window).height()-90;\n        if (h0<h) w = (w*(h0/h))|0, h=h0;\n        if (w0<w) w=w0, h=(h*(w0/w))|0;\n        if (w<330) w = 330;\n        width=w<330?330:w;\n\n        $.my.modal({\n          manifest:{\n            id:'in.ImagePopup',\n            init: function($o){\n              $o.html(this.HTML);\n              $o.on('click.my','img:eq(0)', function(){\n                $o.trigger('cancel');\n              });\n            },\n            HTML:'<img src=\"\" class=\"db\" style=\"max-width:'+w+'px;max-height:'+h+'px\">'\n            +'<h4 class=\"mt10 tac\"></h4>',\n            ui:{\n              \"img:eq(0)\":\"img\",\n              \"h4\":{\n                bind:\"text\",\n                css:{hide:function(d,v){return !v;}}\n              }\n            }\n          },\n          data:\t\t{img:$i.attr('src'),text:text},\n          css:\t\t'p10',\n          esc:\t\ttrue,\n          screen:\ttrue,\n          width:\twidth0 || width,\n          focus:\tfalse,\n          global:\ttrue,\n          z:\t\t\t'1995'\n        });\n\n        //$.my.modal($(this), null);\n      });\t\t\n    });\n\n\n    return;\n\n\n    // ====================================================================\n\n    // Service functions\n\n    function _prepare($o, opts) {\n\n      // prepares item and grabs its metrics\n\n      var row;\n      if (!$o.data('inplx')){\n        // Image\n        if ($o.hasClass('in--img')) {\n          var $i = $o.find('img'),\n              src = $i.attr('src'),\n              $d = $o.find('.in--img-frame');\n          $o.find('.in-ct').css({overflow:'hidden'});\n          $d.css({\n            background:\"url('\"+src+\"') 50% 30% / cover no-repeat\",\n            'transition':'height 0.2s'\n          });\n          $i.remove();\n          row = {\n            type:\"img\",\n            item:$o,\n            frame:$d[0],\n            top:$o.offset().top,\n            height:Height - menuHeight,\n            stamp:Date.now(),\n            slow: opts.slow,\n            ofs:0\n          }\n          $d.height(row.height);\n        }\n\n        // Embed\n        else if ($o.hasClass('in--embed')) {\n          var $d = $o.find('.in--embed-frame');\n          $o.find('.in-ct').css({overflow:'hidden'});\n          $d.css({'transition':'height 0.2s'});\n          row = {\n            yt:$o.hasClass('in--embed-provider-youtube'),\n            type:\"embed\",\n            item:$o,\n            frame:$d[0],\n            top:$o.offset().top,\n            height:Height - menuHeight,\n            stamp:Date.now(),\n            slow: opts.slow,\n            ofs:0\n          }\n          $d.outerHeight(row.height, true);\n        }\n\n        // Widget\n        else if ($o.hasClass('in--widget')) {\n          var $d = $o.find('#xapp'),\n              bg = $o.css('background-image'),\n              $bg,\n              hm;\n          if (bg) {\n            hm = $d.outerHeight();\n            $d.css({'transition':'height 0.2s'});\n            $bg = $('<div></div>');\n            $bg.css({\n              position:'absolute', \n              width:'100%', \n              //height:'100%',\n              height:((hm + (Height - menuHeight - hm)/opts.slow) | 0)+'px', \n              top:0, left:0,\n              'background-size':'cover',\n              'background-position':'50% 50%',\n              'background-image':bg\n            });\n            $o.find('.in-ct').css({overflow:'hidden'}).prepend($bg);\n            $o.css({'background-image':''});\n\n            row = {\n              type:\t\t'widget',\n              item:\t\t$o,\n              frame:\t$bg[0],\n              top:\t\t$o.offset().top,\n              height:\thm,\n              local:\ttrue,\n              stamp:\tDate.now(),\n              slow: \topts.slow,\n              ofs:\t\t0\n            }\n          }\n        }\n        //-- end rules\n\n        // Stash row\n        if (row) {\n          $o.data('inplx', row.length);\n          frames.push(row);\n          if (oMax < row.top+row.height) oMax = row.top + row.height;\n        }\n      }\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _readjust(){\n      Height = $(window).height();\n      var maxOld = oMax;\n      frames.forEach(function(row){\n        row.top = row.item.offset().top;\n        if (!row.local && (Height - menuHeight != row.height || row.yt)) {\n\n          if (!row.yt) {\n            $(row.frame).outerHeight(Height - menuHeight, true);\n            row.height = Height - menuHeight;\n          }\n          else {\n\n            var w = row.item.width(),\n                $ct = row.item.find('.in-ct'),\n                $frame = $(row.frame),\n                ratio = 16/9;\n\n            $ct.height(Height - menuHeight);\n\n            if (w/(Height - menuHeight) > ratio) {\n              // too wide, increase height\n              $frame.css({'margin-bottom':''});\n              $frame.outerHeight(w/ratio|0, true);\n              $frame.css({width:'', 'margin-bottom':'-'+(w/ratio - Height + menuHeight |0)+'px'});\n            } else {\n              // too narrow, increase width\n              $frame.css({'margin-bottom':''});\n              $frame.outerHeight(Height - menuHeight, true);\n              $frame.width((Height - menuHeight)*ratio|0);\n            }\n          }\n        }\n        else if (row.local) {\n          row.height = row.item.outerHeight();\n          $(row.frame).css({height:((row.height + (Height - menuHeight - row.height)/row.slow) | 0)+'px'})\n        }\n        if (oMax < row.top+row.height) oMax = row.top + row.height;\n      });\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _loop() {\n\n      // Parallax\n\n      if (dirty) {\n        frames.forEach(function(row){\n          var ofs = 0;\n          if (oCurr >= row.top - Height/*Height-menuHeight*/ && oCurr <= row.top + row.height) {\n            \n            var sm = row.top,\n                s0 = oCurr,\n                hm = row.height,\n                hs = Height;\n            \n            if (Math.abs(Height - row.height - menuHeight) < 2) {\n              if (oCurr > row.top - Height) ofs = (oCurr - row.top + menuHeight) / row.slow | 0;\n              else ofs = 0;\n            } \n            else {\n              if (s0 >= sm - hs && s0 < sm + hm) ofs = (s0 - sm + menuHeight)/row.slow | 0;\n              else ofs = 0;\n            }\n\n            if (ofs != row.ofs) {\n              row.frame.style.transform = 'translateY('+ofs+'px)';\n              row.ofs = ofs;\n            }\n          }\n        });\n        oPrev = oCurr;\n        dirty = false;\n        \n        // On top button\n\n        var isOn;\n        if (onTop && (isOn = oCurr> Height/2) != onTop.isOn) {\n          onTop.btn.style.opacity = (onTop.isOn = isOn)?\"1\":\"0\";\n        }\n        \n      }\n\n      \n\n      window.requestAnimationFrame(_loop);\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _start(){\n\n      loopStarted = true;\n\n      if (typeof window.requestAnimationFrame == 'function' /*&& frames.length*/) {\n\n\n        $(document).on('scroll.in', function(){\n          var ofs = window.pageYOffset; //body0.scrollTop || body1.scrollTop;\n          if (ofs <= oMax && ofs != oPrev) dirty = true;\n          oCurr = ofs;\n        });\n\n        // run animation loop\n        _loop();\n\n        // run heights rescanner, to adjust for\n        // embeds started async\n\n        (3).times(_readjust.lazy(1000));\n      } \n    }\n\n  })();\n}"},"T": {"html": {"id": "cw.Inliner.Ed.Items.html","params": {"strict": true},"Name": "<span class=\"fi-text-color fs120\" title=\"Add text\"></span>","Title": "","data": {"type": "html","data": "<p><br></p>","format": "left750","css": []},"Hoverpane": ".in--html.in-item-nocss .redactor_box>.redactor_editor>p,.in--html.in-item-nocss .redactor_box>.redactor_editor>h1,.in--html.in-item-nocss .redactor_box>.redactor_editor>h2,.in--html.in-item-nocss .redactor_box>.redactor_editor>h3,.in--html.in-item-nocss .redactor_box>.redactor_editor>h4,.in--html.in-item-nocss .redactor_box>.redactor_editor>h5,.in--html.in-item-nocss .redactor_box>.redactor_editor>ul,.in--html.in-item-nocss .redactor_box>.redactor_editor>ol,.in--html.in-item-nocss .redactor_box>.redactor_editor>hr,.in--html.in-item-nocss .redactor_box>.redactor_editor>table,.in--html.in-item-nocss .redactor_box>.redactor_editor>blockquote,.in--html.in-item-nocss .redactor_box>.redactor_editor>div,.in--html.in-item-hascss .redactor_box","NoSelfInline": true,"init": "function ($o,form) {\n\t\t\n\t\tvar that = this,\n\t\t\t\td= form.data,\n\t\t\t\tdata = d.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle = that.Formats[fmt];\n\t\t\n\t\t$o.html([\n\t\t\t'<div id=\"formatter\" class=\"hide\"></div>',\n\t\t\t'<div class=\"in-ct xrd\">',\n\t\t\t'<textarea id=\"rd\" class=\"w100p\"></textarea>',\n\t\t\t'</div>'\n\t\t].join(\"\"));\n\n\t\t$o.addClass(\"in--html in-item \"+style.css);\n\t\tthat.Opts.Formats = that.Formats;\n\t}","ui": {"#formatter": {"bind": "function (d,v,$o) {\n\t\t\t\tvar $r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\t\t\t\t\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--html in-item\");\n\t\t\t\t$r.addClass(fm.css);\n\t\t\t}"},"#rd": {"bind": "data","init": "function ($o,d) {\n\t\t\t\t$o.redactor({\n\t\t\t\t\tair:true,\n\t\t\t\t\tminHeight:23,\n\t\t\t\t\tairButtons:['formatting', 'alignment', 'bold', 'italic', 'fixwidth', \n\t\t\t\t\t\t'deleted', 'table', \n\t\t\t\t\t\t'link', 'fontcolor', 'backcolor', \n\t\t\t\t\t\t'unorderedlist','orderedlist','outdent', 'indent', \"horizontalrule\"\n\t\t\t\t\t],\n\t\t\t\t\tfocus:d.data._new,\n\t\t\t\t\tformattingTags:[\"p\",\"blockquote\",\"pre\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\"],\n\t\t\t\t\tformatting:{\n\t\t\t\t\t\t\"code\":{title:\"Fixed\",exec:\"formatblock\",className:\"redactor_format_code\"}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdelete d.data._new;\n\t\t\t}","delay": 20}},"Formats": {"left300": {"css": "in-item-small"},"left750": {"css": "in-item-wide"},"left1000": {"css": "in-item-max"},"right300": {"css": "in-item-small-right"},"right200": {"css": "in-item-tiny-right"}},"style": {".in--html": "function () {\n\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcma = 'margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ';\n\n\t\tr[''] = 'display:block; min-height:1em ;'+cma;\n\t\t\n\t\tr[' .in-ct'] = ctext + 'width:'+(s.text.width||'100%');\n\t\tr['.in-background .in-ct'] =\n\t\tr['.in-frame .in-ct'] = 'display:flex; width: auto;' + cbro;\n\t\t\n\t\tr['.in-rules .in-ct'] = 'display:flex; width: auto;';\n\t\t\n\t\tr[' .redactor_box'] = ctext + 'border:none;background:none!important';\n\t\t\n\t\tr['.in-rules .redactor_box'] = 'padding:'+inset+' 0!important;border-radius:0!important;'\n\t\tr['.in-background .redactor_box'] = \n\t\tr['.in-frame .redactor_box'] = 'padding:'+inset+'!important;' + cbro;\n\t\t\n\t\t\n\t\tr['.in-rules .redactor_editor :last-child'] = \n\t\tr['.in-frame .redactor_editor :last-child'] = \n\t\tr['.in-background .redactor_editor :last-child'] = 'margin-bottom:0!important;'\n\t\t\n\t\tr['.in-rules .redactor_editor :first-child'] = \n\t\tr['.in-frame .redactor_editor :first-child'] = \n\t\tr['.in-background .redactor_editor :first-child'] = 'margin-top:0!important;'\n\n\t\t\n\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-max'] = {\n\t\t\t'': 'width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';',\n\t\t\t' .in-ct':'width:100%; max-width:100%; margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t' .redactor_box':'max-width:100%;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-wide'] = {\n\t\t\t'': cbody,\n\t\t\t'.in-frame':'margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t'.in-background':'margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t'.in-rules':'margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t' .redactor_box':'min-width:'+s.aside.tiny+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto; min-height:0; z-index:+2;',\n\t\t\t' .in-ct': 'min-width:'+s.aside.small+'; width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' -'+pl+';',\n\t\t\t' .redactor_box':'min-width:'+s.aside.small+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;min-height:0; z-index:+2;',\n\t\t\t' .in-ct': 'min-width:'+s.aside.small+'; width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t\t' .redactor_box':'min-width:'+s.aside.small+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-tiny-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;min-height:0; z-index:+2;',\n\t\t\t' .in-ct': 'min-width:'+s.aside.tiny+'; width:' + s.aside.tiny + '; float:right; clear:right; margin: 0 0 '+gap+ ' ' +gap+';',\n\t\t\t' .redactor_box':'min-width:'+s.aside.tiny+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .redactor_editor'] = 'display:inline;';\n\t\t\n\t\t\n\t\treturn r;\n\t\t\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t}"},"Opts": {"data": {"format": [],"css": []},"params": {"width": 320},"lang": {"en": {"BTN_APPLY": "Apply","BTN_CANCEL": "Cancel","TITLE": "Text block settings"},"ru": {"BTN_APPLY": "Применить","BTN_CANCEL": "Отмена","TITLE": "Настройки блока текста"}},"Css": [],"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\n\t\t$o.html($.my.formgen(that.HTML).assign(L));\n\t\t\n\t\tif (d.css.indexOf('Small')==-1 && d.css.indexOf('Large')==-1) d.css.push(\"Normal\");\n\t}","ui": {"#format": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t}","init": "function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}"},"#ecss": {"init": "function ($o,form) {\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}","bind": "css"},"#btn-apply": "function (d,v,$o) {\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.unique().remove(\"Normal\");\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t}","#btn-cancel": "function (d,v,$o) {if(v!=null)$o.trigger(\"cancel\")}"},"HTML": [{"row": "320px","label": "80px","rowCss": "my-row pb6","labelCss": "my-label fs90 gray"},"<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>","<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>","<div id=\"ecss\" class=\"tag-in-fmt mb0\"></div>",{"rowCss": "my-row mt5 ml3"},["","but#btn-apply.w120.green.mr5",{"txt": "{BTN_APPLY}"},"but#btn-cancel.w100",{"txt": "{BTN_CANCEL}"}]],"Ecss": []},"To": {"html": "function (item,options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:''\n\t\t\t}, Object.isObject(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thtml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:''\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type ) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\t\n\tid = d._stamp || id;\n\t\n\tvar css=['in-item', 'in--'+d.type];\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\n\th = [\n\t\t'<div id=\"in-' + id + '\" class=\"'+css.join(' ')+'\">',\n\t\t\t'<div class=\"in-ct\">',\n\t\t\t\t'<div class=\"redactor_box\"><div class=\"redactor_editor\">',\n\t\t\t\t\t(d.data || '').removeTags('script embed iframe input textarea button'.split(' ')),\n\t\t\t\t'</div></div>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\tres.html = h;\n\t\n\treturn res;\n}"}},"img": {"id": "cw.Inliner.Ed.Items.img","Name": "<span class=\"fi-photo fs105 mt1 mb-1 dib vat\" title=\"Add image\"></span>","Hoverpane": ".in--img-container","data": {"type": "img","data": "","desc": "<p><br/></p>","format": "left500","showdesc": "show","css": []},"Formats": {"left200": {"css": "in-item-tiny"},"left300": {"css": "in-item-small"},"left500": {"css": "in-item-medium"},"left750": {"css": "in-item-wide"},"left1000": {"css": "in-item-max"},"right300": {"css": "in-item-small-right"},"right200": {"css": "in-item-tiny-right"}},"inherit": ["Att"],"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td= form.data,\n\t\t\t\tdata = d.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle = that.Formats[fmt];\n\n\t\t$o.html([\n\t\t\t'<div id=\"formatter\" class=\"hide\"></div>',\n\t\t\t//'<div class=\"floater-hotspot\"></div>',\n\t\t\t'<div class=\"in-ct in--img-container\">',\n\t\t\t'<div id=\"imageframe\" class=\"in--img-frame cw-imframe\" style=\"min-height:30px;\"></div>',\n\t\t\t'<div class=\"in--x-fader\"></div>',\n\t\t\t'<div id=\"descframe\" class=\"in--img-desc \"><textarea id=\"desc\" placeholder=\"Image text \"></textarea></div>',\n\t\t\t'</div>'\n\t\t].join(\"\"));\n\n\t\t$o.addClass(\"in-item \"+style.css);\n\n\t\tthat.Opts.Formats = that.Formats;\n\t}","ui": {"#imageframe": {"bind": "function (d,v,$o) {\n\t\tvar that = this;\n\t\tif (v!=null || d._new) {\n\t\t\tvar f = function(d){\n\t\t\t\t//console.log(d)\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend({Att:that.Att},that.Cropper),\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tdata:\"\",\n\t\t\t\t\t\tfilename:\"\", \n\t\t\t\t\t\twidth:(d.format+\"\").replace(/\\D/g,\"\")\n\t\t\t\t\t},\n\t\t\t\t\twidth:1031,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true,\n\t\t\t\t\tesc:true\n\t\t\t\t}).then(function (crop) {\n\t\t\t\t\tif (Object.isObject(crop)) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar a = that.Att(null),\n\t\t\t\t\t\t\t\tnewatt = false,\n\t\t\t\t\t\t\t\tmime,\n\t\t\t\t\t\t\t\tfname;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// New image\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!crop.ref) {\n\t\t\t\t\t\t\tif (crop.data.length) {\n\t\t\t\t\t\t\t\tfname = crop.filename;\n\t\t\t\t\t\t\t\tmime = crop.type;\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t!/^[a-z0-9\\-\\._~]{1,30}\\.(jp[e]?g|gif|png)$/i.test(fname)\n\t\t\t\t\t\t\t\t) fname = cw.lib.hash8(fname+Date.now())+'.'+mime.split(\"/\").last().split(\"+\")[0];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tthat.Att(fname, {\n\t\t\t\t\t\t\t\t\tcontent_type:mime,\n\t\t\t\t\t\t\t\t\tdata:crop.data\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tnewatt = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcrop.ref = fname;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Existing image\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (crop.ref) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tmime = mime || a[crop.ref].content_type;\n\t\t\t\t\t\t\td.ref = crop.ref;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Load image and prepare preview\n\t\t\t\t\t\t\tthat.Att(d.ref, \"data\")\n\t\t\t\t\t\t\t.then(function(data){\n\t\t\t\t\t\t\t\tvar $i = $('<img src=\"\"/>');\n\t\t\t\t\t\t\t\t$i.attr(\"src\", \"data:\"+mime+\";base64,\"+data);\n\t\t\t\t\t\t\t\t$i.load(function(){\n\t\t\t\t\t\t\t\t\tvar ico = cw.lib.image($i,\"white\"),\n\t\t\t\t\t\t\t\t\t\t\tdim = ico.width()+'×'+ico.height();\n\t\t\t\t\t\t\t\t\tico.resample(150);\n\t\t\t\t\t\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height())\n\t\t\t\t\t\t\t\t\tcrop.type = \"image/jpeg\";\n\t\t\t\t\t\t\t\t\t_refresh(ico.sharpen(0.1).contrast(1.05).jpeg(0.65), dim);\n\t\t\t\t\t\t\t\t\t$i.remove();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} \n\t\t\t\t\t\t\n\t\t\t\t\t\t//- - - - - - - -\n\t\t\t\t\t\t\n\t\t\t\t\t\tfunction _refresh(data, dim) {\n\t\t\t\t\t\t\t$o.html(\"\");\n\t\t\t\t\t\t\t$('<img class=\"cw-preview\" src=\"\"/>')\n\t\t\t\t\t\t\t.attr(\"src\",data)\n\t\t\t\t\t\t\t.appendTo($o);\n\t\t\t\t\t\t\td.data=data.split(\"base64,\")[1];\n\n\t\t\t\t\t\t\tif (newatt) {\n\t\t\t\t\t\t\t\td.format=\"left\"+crop.width;\n\t\t\t\t\t\t\t\tvar l = crop.data.length/4*3 |0;\n\t\t\t\t\t\t\t\tthat.Att(fname, {\n\t\t\t\t\t\t\t\t\tcontent_type:mime,\n\t\t\t\t\t\t\t\t\tdata:crop.data,\n\t\t\t\t\t\t\t\t\tpreview:{\n\t\t\t\t\t\t\t\t\t\tfname:fname,\n\t\t\t\t\t\t\t\t\t\tsize: l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\",\n\t\t\t\t\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\t\t\t\t\tdim:dim,\n\t\t\t\t\t\t\t\t\t\tdata:data\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcrop.data=\"\";\n\t\t\t\t\t\t\tthat.my.redraw();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}.fill(d);\n\t\t\tif (d._new) f.delay(250);\n\t\t\telse f();\n\t\t\tif (d._new) delete d._new;\n\t\t}\n\t\tif (d.data) {\n\t\t\t\n\t\t\tif (d.ref) {\n\t\t\t\tvar p = that.Att(d.ref, \"url\");\n\t\t\t\tif (Object.isObject(p) && p.then) {\n\t\t\t\t\tp.then(function(url){\n\t\t\t\t\t\t//console.log(url.to(100))\n\t\t\t\t\t\t$o.html('<img class=\"cw-preview\" src=\"'+url+'\" />');\n\t\t\t\t\t\t//that.my.redraw();\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse if (Object.isString(p)) {\n\t\t\t\t\treturn '<img class=\"cw-preview\" src=\"'+p+'\" />';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn '<img class=\"cw-preview\" src=\"data:image/jpeg;base64,'+d.data+'\" />';\n\t\t}\n\t\telse {\n\t\t\treturn ('<div class=\"w100p bg-lblue tac p30 fs80 blue\">'\n\t\t\t\t\t\t\t+'<span class=\"pseudolink\">Upload image...</span>'\n\t\t\t\t\t\t\t+'</div>');\n\t\t}\n\t}","events": "click.my","delay": 100},"#formatter": {"bind": "function (d,v,$o) {\n\t\t\t\tvar $r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--img in-item\");\n\t\t\t\t$r.addClass(fm.css);\n\t\t\t}"},"#desc": {"delay": 50,"bind": "desc","init": "function ($o) {\n\t\t\t\t$o.redactor({\n\t\t\t\t\tair:true,\n\t\t\t\t\tairButtons:['formatting', 'alignment','bold', 'italic', 'link', 'fontcolor'],\n\t\t\t\t\tfocus:false\n\t\t\t\t});\n\t\t\t}","css": {"in--img-desc-empty": "function (d) {return \"\"===d.desc.stripTags().compact();}","hide": "function (d) {return !(d.showdesc+\"\")}"},"watch": "#imageframe,#showdesc"}},"Compiler": "function ($f,shtml,ocss,orepo,man) {\n\n\t\t// Compiles image\n\n\t\tvar that = this,\n\t\t\t\td = $f.my(\"data\");\n\n\t\tif (d.ref) {\n\t\t\t// we have attachment mount\n\n\t\t\tvar $src = $($f[0].outerHTML.replace(/contenteditable\\s?=\\s?\"true\"/g,\"\"));\n\t\t\t$src.find(\"textarea,input,select,button,.hide,.cw-hoverpane,.floater-hotspot\").remove();\n\t\t\t$src.find('img.cw-preview').attr(\"src\", that.Atts[d.ref]);\n\t\t\tshtml.push($src[0].outerHTML);\n\n\t\t\tthis.CSSCompiler($, ocss);\n\n\t\t}\n\t\telse {\n\t\t\t// Image is inlined, so all is easy\n\t\t\tthat.Compiler.call(that, $f, shtml, ocss, orepo, man);\n\t\t}\n\t}","style": {" .in--img-desc-empty:before": "content:\"Image description\";color:#bbb;font-size:90%;position:absolute;z-index:-1;top:-3px;  pointer-events: none;",".in-item-max .in--img-desc-empty:before": "z-index:0;top:auto;bottom:1em;color:white;text-shadow: 1px 0px 10px rgba(0,0,0,0.5);  pointer-events: none;",".in--img": "function () {\n\t\t\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\t\t\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tgap2 = parseFloat(gap)/2+gap.replace(/[0-9\\.]/g,''),\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\t\t\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcl = 'clear:left; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ',\n\t\t\t\tchmgap = 'margin-top:'+gap2+';';\n\t\t\n\t\tr[''] = 'display:block; z-index:+2;';\n\t\t\n\t\tr[' .in-ct'] = 'margin-top:'+gap+'; margin-bottom:'+gap+'; ';\n\t\t\n\t\tr['.in-rules .in-ct'] = 'padding:'+inset+' 0!important;border-radius:0!important;' \n\t\tr['.in-background .in-ct'] =\n\t\tr['.in-frame .in-ct'] = 'padding:'+inset+'!important;' + cbro;\n\t\t\n\t\tr[' img'] = c100db + cbro;\n    \n    r['.in-zoomable img'] = 'cursor:zoom-in;';\n\t\t\n\t\tr['.in-rules img'] =\n\t\tr['.in-frame img'] = \n\t\tr['.in-background img'] = 'border-radius:'+s.corner.inner+'; ';\n\t\t\n\t\tr[' .in--img-desc p:last-child'] = 'margin-bottom:0!important;';\n\t\t\n\t\tr[' .floater-hotspot'] = 'width:100%';\n\t\tr[' .in--x-fader'] = 'pointer-events:none;';\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tvar wmax = 'width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';';\n\t\tr['.in-item-max'] = {\n\t\t\t'': wmax,\n\t\t\t' .in-ct':'width:100%;'+cpad,\n\t\t\t//' .in--img-desc': ctext+cpad,\n\t\t\t' .in--img-desc':{\n\t\t\t\t'': cbody+cb+'; margin:0 auto;',\n\t\t\t\t' .redactor_box':{\n\t\t\t\t\t'':cbody + 'width:'+(s.text.width||'100%')+';position:absolute;bottom:'+gap+';',\n\t\t\t\t\t'h1,h2':'margin-bottom:0.2em!important;'\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t' img':'border-radius:0;',\n\t\t\t' .in--img-frame':wmax,\n\t\t\t'+.in--img.in-item-max':{\n\t\t\t\t'':'border-top:2px solid white;',\n\t\t\t\t' .in-ct':'margin-top:-'+gap+';'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-wide'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t' .in--img-desc': 'max-width:80%;'+chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':'width:100%'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-medium'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t'>img':'width:70%;'+ cdibvat,\n\t\t\t' .in--img-frame':'width:70%;'+ cdibvat,\n\t\t\t' .in--img-desc': {\n\t\t\t\t'':'width:30%; margin:-1px 0 0 0; padding-left:'+gap+';' + cdibvat ,\n\t\t\t\t' :first-child': 'margin-top:0!important;',\n\t\t\t\t' .redactor_editor :first-child': 'margin-top:0!important;',\n\t\t\t},\n\t\t\t' .floater-hotspot':'width:30%; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' 0;',//' -'+pl+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; right:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-tiny'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.tiny + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' 0;',// -'+pl+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.tiny + '; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-tiny-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;',\n\t\t\t' .in-ct': 'width:' + s.aside.tiny + '; float:right; clear:right; margin: 0 0 '+gap+ ' ' +gap+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.tiny + '; right:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .redactor_box'] = 'width:100%; display:block; border:none; padding:0; '\n\t\t\t+'background:none!important;z-index:+3;min-height:1em;';\n\n\t\tr[' .redactor_editor'] = 'display:block; min-height:1em;';\n\t\t\n\t\treturn r;\n\t\t\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t}"},"To": {"html": "function (item,options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:''\n\t\t\t}, Object.isObject(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thtml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:''\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\t\n\tif (!d.ref && !d.data) {\n\t\tres.err.push('Error: ' + that.data.type + ' has no data to render.');\n\t\treturn res;\n\t}\n\t\n\tid = d._stamp || id;\n\t\n\tvar css=['in-item', 'in--'+d.type];\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\n\tvar url='';\n\t\n\tif (d.ref) {\n\t\t\n\t\tif (/^http[s]?:/.test(d.ref) || d.ref.to(1)=='/') url = d.ref;\n\t\telse {\n\t\t\tif (opts.Urls) {\n\t\t\t\turl = opts.Urls[d.ref];\n\t\t\t} else {\n\t\t\t\turl = opts.path+d.ref;\n\t\t\t}\n\t\t}\n\t\n\t} else {\n\t\turl = \"data:image/jpeg;base64,\"+d.data;\n\t}\n\t\n\th = [\n\t\t'<div id=\"in-' + id + '\" class=\"'+css.join(' ')+'\">',\n\t\t\t'<div class=\"in-ct\">',\n\t\t\t\t'<div id=\"imageframe\" class=\"in--img-frame\">',\n\t\t\t\t\t'<img src=\"' + url +'\" alt=\"'\n\t\t\t\t\t+(d.showdesc+''=='show'?(d.desc+'').stripTags().truncate(100).escapeHTML():'')\n\t\t\t\t\t+'\">',\n\t\t\t\t'</div>',\n\t\t\t\t'<div class=\"in--x-fader\"></div>',\n\t\t\t\t(d.showdesc+''=='show'?[\n\t\t\t\t\t\t'<div id=\"descframe\" class=\"in--img-desc\">',\n\t\t\t\t\t\t'<div class=\"redactor_box\"><div class=\"redactor_editor\">',\n\t\t\t\t\t\t\t(d.desc || '').removeTags('script embed iframe input textarea button'.split(' ')),\n\t\t\t\t\t\t'</div></div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join(''):''),\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\tres.html = h;\n\t\n\treturn res;\n}"},"Opts": {"params": {"width": 320},"lang": {"en": {"BTN_APPLY": "Apply","BTN_CANCEL": "Cancel","TITLE": "Image settings","SHOWDESC": "Show item description","AUX_PLC": "Aux formatting..."},"ru": {"BTN_APPLY": "Применить","BTN_CANCEL": "Отмена","TITLE": "Настройки фото","SHOWDESC": "Показывать текст к фото","AUX_PLC": "Дополнительные эффекты..."}},"init": "function ($o,form) {\n\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\n\t\t$o.html($.my.formgen([\n\t\t\t{row:\"320px\", label:\"70px\", rowCss:\"my-row pb10\", labelCss:\"my-label fs90 gray\"},\n\t\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb3\"></div>',\n\t\t\t['', 'inp#css.w100p.fs100'],\n\t\t\t'<label class=\"fs90 ml4 xgray\"><input type=\"checkbox\" id=\"showdesc\" value=\"show\"> {SHOWDESC}</label>',\n\t\t\t{rowCss:\"my-row mt10 ml3\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w100.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t 'but#btn-cancel.w100',{txt:'{BTN_CANCEL}'}\n\t\t\t]\n\t\t]).assign(L));\n\n\t\tthis.Start = form.data.format + form.data.showdesc;\n\n\t\tvar a = ['small normal large', 'background frame rules','accented'],\n\t\t\t\tb = a.join(\" \")+\" \",\n\t\t\t\tecss = [],\n\t\t\t\tcss = [];\n\t\t\n\t\tvar c = (d.css||[]), isNormal = true;\n\t\tc.forEach(function(i){\n\t\t\tif (b.indexOf(i.toLowerCase()+\" \")>-1) ecss.push(i);\n\t\t\telse css.push(i);\n\t\t\tif (i==\"Small\" || i==\"Large\") isNormal = false;\n\t\t});\n\t\t\n\t\tif (isNormal) ecss.push(\"Normal\");\n\t\t\n\t\tthat.Ecss = ecss;\n\t\td.css = css;\n\t}","ui": {"#format": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t}","init": "function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}"},"#showdesc": "showdesc","#ecss": {"init": "function ($o,form) {\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize(), title:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}","bind": "this.Ecss"},"#css": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[\"Darken\",\"Parallax\",\"Zoomable\"],\n\t\t\t\t\tplaceholder:this.Lang.AUX_PLC\n\t\t\t\t});\n\t\t\t}","bind": "css"},"#btn-apply": "function (d,v,$o) {\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.add(this.Ecss||[]).unique().remove(\"Normal\");\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t}","#btn-cancel": "function (d,v,$o) {if(v!=null)$o.trigger(\"cancel\")}"},"Ecss": [],"style": {}}},"embed": {"id": "cw.Inliner.Ed.Items.embed","Name": "<span class=\"fi-play-video fs120\" title=\"Add embed\"></span>","Hoverpane": ".in--embed-container","data": {"type": "embed","data": "","source": "","desc": "<p><br/></p>","format": "left500","showdesc": "show"},"Formats": {"left300": {"css": "in-item-small"},"left500": {"css": "in-item-medium"},"left750": {"css": "in-item-wide"},"left1000": {"css": "in-item-max"},"right300": {"css": "in-item-small-right"}},"init": "function ($o,form) {\n\t\tvar that = this, \n\t\t\t\td = form.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle=this.Formats[fmt];\n\n\t\t$o.html(that.HTML.join(\"\"));\n\n\t\t$o.addClass(style.css);\n\n\t\t$o.on(\"click.my\",\"#btn-embed-new\", function(){\n\t\t\tform.data._new = true;\n\t\t\t$o.find(\"#btn-embed\").trigger(\"click\");\n\t\t});\n\t\t\n\t\tthat.Opts.Formats = that.Formats;\n\t\t\n\t\tif (d.provider) $o.addClass('in--embed-provider-'+d.provider); \n\t\t\n\t}","Crc": "","HTML": ["<div id=\"formatter\" class=\"hide\"></div><div id=\"btn-embed\" class=\"hide\"></div>","<div class=\"in-ct in--embed-container\">","<div id=\"embed\" class=\"in--embed-frame\"></div>","<div class=\"in--x-fader\"></div>","<div id=\"descframe\" class=\"in--embed-desc\"><textarea id=\"desc\" placeholder:\"Image text \"></textarea></div>","</div>"],"Postinit": [["new RegExp(/data\\-instgrm/)","function () {\n\t\t\tif (window.instgrm) window.instgrm.Embeds.process();\n\t\t}",500],["new RegExp(/class=\"twitter\\-tweet\"/)","function () {\n\t\t\tif (window.twttr) twttr.widgets.load();\n\t\t}",500],["new RegExp(/class=\"in---gist\"/)","function (s) {\n\t\t\tvar that = this;\n\t\t\t$.getJSON( s.split(/[<>]/)[2] + 'on?callback=?', function( data ) {\n\t\t\t\tthat.my.find(\"#embed\").html(data.div);\n\t\t\t\tvar url = data.stylesheet;\n\t\t\t\tvar $head = $('head');\n\t\t\t\tif( $head.find('link[rel=\"stylesheet\"][href=\"'+url+'\"]').length < 1 )\n\t\t\t\t\t\t$head.append('<link rel=\"stylesheet\" href=\"'+ url +'\" type=\"text/css\" />');\n\t\t\t});\n\t\t}",200]],"ui": {"#embed": {"delay": 100,"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (that.Crc == cw.lib.sdbm(d)) return undefined;\n\t\t\t\telse {\n\t\t\t\t\tthat.Crc = cw.lib.sdbm(d);\n\t\t\t\t\tif (!d.data) {\n\t\t\t\t\t\treturn '<div class=\"w100p bg-lblue tac p30 fs80 blue\">'\n\t\t\t\t\t\t\t+'<span class=\"pseudolink\" id=\"btn-embed-new\">Insert embed...</span>'\n\t\t\t\t\t\t\t+'</div>';\n\t\t\t\t\t}\n\t\t\t\t\t// find post-processor\n\t\t\t\t\tvar proc=false;\n\t\t\t\t\tthat.Postinit.forEach(function(a){\n\t\t\t\t\t\tif (!proc && a[0].test(d.data)) {\n\t\t\t\t\t\t\tproc=true;\n\t\t\t\t\t\t\tvar f = a[1].debounce(a[2]);\n\t\t\t\t\t\t\ttry { f.call(that, d.data); } catch (e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\treturn d.data;\n\t\t\t\t}\n\t\t\t}"},"#btn-embed": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (d._new) {\n\t\t\t\t\t\n\t\t\t\t\tvar $p = $o.my().root.parents(\".my-form\").eq(0),\n\t\t\t\t\t\t\t$r = $p.parents(\".my-form\").eq(0);\n\t\t\t\t\t\n\t\t\t\t\tvar f = function(isnew){\n\t\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\t\troot:$r,\n\t\t\t\t\t\t\tmanifest:$.extend({RT:that.RT},that.Opts),\n\t\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\t\tnose:isnew?false:\"top\",\n\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\t\talign:isnew?false:\"top:103%\",\n\t\t\t\t\t\t\tcss:\"blue lh150 \"+(isnew?\"fs90 p15\":\"fs80 p10\"),\n\t\t\t\t\t\t\twidth:450,\n\t\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tclose:!!isnew\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\td.data = res.data;\n\t\t\t\t\t\t\td.format = res.format;\n\t\t\t\t\t\t\td.showdesc = res.showdesc;\n\t\t\t\t\t\t\td.source = res.source;\n\t\t\t\t\t\t\td.css = res.css;\n\t\t\t\t\t\t\td.provider = res.provider;\n\n\t\t\t\t\t\t\tif (Object.isFunction(res.postinit)) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tres.postinit();\n\t\t\t\t\t\t\t\t} catch(e){}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$o.my().root.trigger(\"redraw\");\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (d._new) f.fill(true).delay(250);\n\t\t\t\t\telse f();\n\t\t\t\t\tif (d._new) delete d._new;\n\t\t\t\t}\n\t\t\t}","events": "click.my"},"#desc": {"delay": 50,"bind": "desc","init": "function ($o) {\n\t\t\t\t$o.redactor({\n\t\t\t\t\tair:true,\n\t\t\t\t\tairButtons:['formatting', 'alignment','bold', 'italic', 'link', 'fontcolor'],\n\t\t\t\t\tfocus:false\n\t\t\t\t});\n\t\t\t}","css": {"in--embed-desc-empty": "function (d) {return \"\"===d.desc.stripTags().compact();}","hide": "function (d) {return !(d.showdesc+\"\")}"}},"#formatter": {"bind": "function (d,v,$o) {\n\t\t\t\tvar $r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\t\n\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--embed in-item \"+(d.provider?'in--embed-provider-'+d.provider:''));\n\n\t\t\t\t$r.addClass(fm.css);\n\t\t\t}"}},"Settings": {},"Compiler": "function ($form,html,css,repo,manifest) {\n\t\t// Default item to HTML compiler.\n\t\t// Gets HTML content of form,cleans it and pushes HTML to html array.\n\t\t// Also puts <style> content (if any) into css obj under appropriate keys.\n\t\t\n\t\tvar $src = $($form[0].outerHTML.replace(/contenteditable\\s?=\\s?\"true\"/g,\"\"));\n\t\t$src.find(\"textarea,input,select,button,.hide,.cw-hoverpane,.floater-hotspot\").remove();\n\t\t$src.find(\".cw--embed-frame\").html($form.my(\"data\").data);\n\t\thtml.push($src[0].outerHTML);\n\t\t\n\t\tthis.CSSCompiler($form, css);\n\t}","style": {" .in--embed-desc-empty:before": "content:\"Embed description\";color:#bbb;font-size:90%;position:absolute;z-index:-1;top:-3px;  pointer-events: none;",".in-item-max .in--embed-desc-empty:before": "z-index:0;top:auto;bottom:1em;color:white;text-shadow: 1px 0px 10px rgba(0,0,0,0.5);  pointer-events: none;",".in--embed": "function () {\n\t\t\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\t\t\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tgap2 = parseFloat(inset)/2+inset.replace(/[0-9\\.]/g,''),\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\t\t\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcl = 'clear:left; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ',\n\t\t\t\tchmgap = 'margin-top:'+gap2+';';\n\t\t\n\t\tr[''] = 'display:block; z-index:+1;';\n\t\t\n\t\tr[' .in-ct'] = 'margin-top:'+gap+'; margin-bottom:'+gap+'; '\n\t\t\n\t\tr['.in-rules .in-ct'] = 'padding:'+inset+' 0!important;border-radius:0!important;'\n\t\tr['.in-background .in-ct'] =\n\t\tr['.in-frame .in-ct'] = 'padding:'+inset+'!important;' + cbro;\n\t\t\t\t\n\t\tr[' .in--embed-desc'] = 'display:block;width:100%;min-height:1em;'\n\t\tr[' .in--embed-desc p:last-child'] = 'margin-bottom:0!important;'; \n\t\t\n\t\tr[' .floater-hotspot'] = 'width:100%';\n\t\tr[' .in--x-fader'] = 'pointer-events:none;';\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tvar wmax = 'width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';';\n\t\tr['.in-item-max'] = {\n\t\t\t'': wmax,\n\t\t\t' .in-ct':'width:100%;'+cpad,\n\t\t\t//' .in--img-desc': ctext+cpad,\n\t\t\t' .in--embed-desc':{\n\t\t\t\t'': cbody+cb+'; margin:0 auto;min-height:0;',\n\t\t\t\t' .redactor_box':{\n\t\t\t\t\t'':cbody + 'width:'+(s.text.width||'100%')+';position:absolute;bottom:'+gap+';',\n\t\t\t\t\t'h1,h2':'margin-bottom:0.2em!important;'\n\t\t\t\t}\n\t\t\t},\n\t\t\t'>img':c100db,\n\t\t\t' .in--embed-frame':wmax\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-wide'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':cbody + 'width:100%;',\n\t\t\t//' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t' .in--embed-desc': ctext + chmgap,\n\t\t\t//' .in--embed-desc': 'max-width:80%;'+chmgap,\n\t\t\t' .floater-hotspot':'width:100%; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-medium'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t' .in--embed-frame':'width:70%;'+ cdibvat,\n\t\t\t' .in--embed-desc': {\n\t\t\t\t'': 'display:inline-block; width:30%; margin:-1px 0 0 0; padding-left:'+gap+';' + cdibvat ,\n\t\t\t\t' :first-child': 'margin-top:0!important;',\n\t\t\t\t' .redactor_editor :first-child': 'margin-top:0!important;'\n\t\t\t},\n\t\t\t' .floater-hotspot':'width:30%; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' -'+pl+';',\n\t\t\t' .in--embed-desc': c100db + chmgap,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; left:-'+pl+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t\t' .in--embed-desc': c100db + chmgap,\n\t\t\t' .in--embed-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; right:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\t\n\t\tr['.in--embed-provider-gmap'] =\n\t\tr['.in--embed-provider-youtube'] = {\n\t\t\t' #embed': 'position: relative; padding-bottom: 52%; padding-top: 22px; height: 0; overflow: hidden;',\n\t\t\t' .in--embed-frame iframe': 'position: absolute;top: 0;left: 0;width: 100%;height: 100%;',\n\t\t\t'.in-item-medium #embed': 'padding-bottom: 36.4%; padding-top: 15px;',\n\t\t}\n\t\t\n\t\tr['.in--embed-provider-gist'] = {\n\t\t\t' #embed .blob-wrapper':'overflow-y:auto!important; max-height:'+s.aside.small+';',\n\t\t\t' .blob-code-inner':'font-family:'+_font(s.font.fixed)+';'\n\t\t}\n\t\t\n\t\tr['.in--embed-provider-twitter'] = {\n\t\t\t' iframe':'margin-top:0!important;margin-bottom:0!important;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .in--embed-frame iframe'] = \n\t\tr[' .in--embed-frame object'] = \n\t\tr[' .in--embed-frame embed'] = 'width: 100%;';\t\n\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .redactor_box'] = 'width:100%;display:block; border:none;padding:0; background:none!important;z-index:+3;min-height:1em;';\n\t\t\n\t\tr[' .redactor_editor'] = 'display:block; min-height:1em;';\n\t\t\n\t\treturn r;\n\t\t\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t\tfunction _font(a) {\n\t\t\tvar s=[];\n\t\t\t(a||[]).forEach(function(e){\n\t\t\t\tif (/\\s/.test(e)) s.push(\"'\"+e+\"'\");\n\t\t\t\telse s.push(e);\n\t\t\t});\n\t\t\treturn s.length?s.join(\",\"):\"inherit\";\n\t\t}\n\t\t\n\t\t/*function _ext (obj, list) {\n\t\t\tfor (var i=0; i<list.length; i++) {\n\t\t\t\tobj[list[i].key] = list[i].rule\n\t\t\t\t.split(\";\")\n\t\t\t\t.map(function(e){\n\t\t\t\t\treturn e.trim()+(/important/.test(e)?'':'!important;');\n\t\t\t\t}).join('');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}*/\n\t}"},"To": {"html": "function (item,options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\tembedh = '',\n\t\t\tscripts = [],\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:''\n\t\t\t}, Object.isObject(options)?options:{}), \n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thtml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:'',\n\t\t\t\tscripts:[]\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\t\n\tif (!d.data) {\n\t\tres.err.push('Error: ' + that.data.type + ' has no data to render.');\n\t\treturn res;\n\t}\n\t\n\tid = d._stamp || id;\n\t\n\tvar css=['in-item', 'in--'+d.type];\n\tif (d.provider) css.push('in--embed-provider-'+d.provider);\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\n\t// Youtube\n\tif (d.provider == 'youtube' && /^https:\\/\\/www.youtube.com\\/watch/.test(d.source) && d.css.indexOf(\"Autostart\") > -1) {\n\t\tvar embedid = d.source.split('?')[1].split('&').find(/^v=/).split(\"=\")[1];\n\t\tscripts.push([\n\t\t\t'$(function(){var $item=$(\"#in-'+id+' #embed>div\");',\n\t\t\t'var opts = '+JSON.stringify(d.css)+', html='+JSON.stringify(d.data)+', videoid=\"'+embedid+'\";',\n\t\t\t_youtube.toString(),\n\t\t\t'_youtube($item, html, opts, videoid);',\n\t\t\t'});'\n\t\t].join('\\n'));\n\t\tembedh='<div></div>';\n\t}\n\t// Fallback\n\telse {\n\t\tembedh = d.data;\n\t}\n\t\n\th = [\n\t\t'<div id=\"in-' + id + '\" class=\"'+css.join(' ')+'\">',\n\t\t\t'<div class=\"in-ct\">',\n\t\t\t\t'<div id=\"embed\" class=\"in--embed-frame\">'+embedh+'</div>',\n\t\t\t\t'<div class=\"in--x-fader\"></div>',\n\t\t\t\t(d.showdesc+''=='show'?[\n\t\t\t\t\t'<div class=\"in--embed-desc\">',\n\t\t\t\t\t\t'<div class=\"redactor_box\"><div class=\"redactor_editor\">',\n\t\t\t\t\t\t\t(d.desc || '').removeTags('script embed iframe input textarea button'.split(' ')),\n\t\t\t\t\t\t'</div></div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join(''):''),\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\tres.html = h;\n\tres.scripts = scripts;\n\t\n\treturn res;\n\t\n\t// - - - - - - - - - - - - - \n\n\tfunction _youtube($item, html, opts, videoid){\n\t\tvar hasYT = (\"YT\" in window),\n\t\t\t\tokYT = hasYT && window.YT.Player,\n\t\t\t\tstart = ((opts||[]).indexOf(\"Autostart\") > -1),\n\t\t\t\tmute = ((opts||[]).indexOf(\"Mute\") > -1),\n\t\t\t\tloop = ((opts||[]).indexOf(\"Loop\") > -1),\n\t\t\t\tplayer;\n\n\t\tif (!hasYT || !start) $item.parent().html(html);\n\t\telse {\n\t\t\tif (okYT) {\n\t\t\t\tplayer = new YT.Player($item[0], {\n\t\t\t\t\tplayerVars: {\n\t\t\t\t\t\t'autoplay': start?1:0,\n\t\t\t\t\t\t'controls': 0,\n\t\t\t\t\t\t'autohide': 1,\n\t\t\t\t\t\t'wmode': 'opaque',\n\t\t\t\t\t\t'showinfo': 0,\n\t\t\t\t\t\t'loop': loop?1:0,\n\t\t\t\t\t\t'mute': mute?1:0,\n\t\t\t\t\t\t'playlist': videoid\n\t\t\t\t\t},\n\t\t\t\t\tvideoId: videoid,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t//'onReady': onPlayerReady\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} \n\t\t\telse {\n\t\t\t\t// Ping YT every 100ms\n\t\t\t\tsetTimeout(_youtube, 100);\n\t\t\t}\n\t\t}\n\n\t}\n\t\n}"},"Opts": {"params": {"width": 320},"data": {"data": "","source": "","format": "left500","css": []},"lang": {"en": {"BTN_APPLY": "Apply","BTN_CANCEL": "Cancel","TITLE": "Embed settings","SHOWDESC": "Show embed description","AUX_PLC": "Aux formatting...","EMBED_PLC": "Paste embed code or video URL here"},"ru": {"BTN_APPLY": "Применить","BTN_CANCEL": "Отмена","TITLE": "Настройки внешнего кода","SHOWDESC": "Показывать текст","AUX_PLC": "Дополнительные эффекты...","EMBED_PLC": "Вставьте код внешнего ресурса или ссылку на Youtube-видео"}},"init": "function ($o,form) {\n\t\t\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\n\t\t$o.html($.my.formgen([\n\t\t\t{row:\"320px\", label:\"70px\", rowCss:\"my-row pb10\", labelCss:\"my-label fs90 gray\"},\n\t\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t\t['', '<div class=\"pl3\">','txt#edata.fs90',{plc:'{EMBED_PLC}', spellcheck:\"false\"},'</div>'],\n\t\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb3\"></div>',\n\t\t\t['', 'inp#css.w100p.fs100'],\n\t\t\t'<label class=\"fs90 ml4 xgray\"><input type=\"checkbox\" id=\"showdesc\" value=\"show\"> {SHOWDESC}</label>',\n\t\t\t{rowCss:\"my-row mt10 ml3\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w100.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t 'but#btn-cancel.w100',{txt:'{BTN_CANCEL}'}\n\t\t\t]\n\t\t]).assign(L));\n\n\t\tthis.Start = form.data.format + form.data.showdesc;\n\t\t\n\t\tif (d.data && !d.source ) d.source = d.data;\n\t\t\n\t\t\t\tvar a = ['small normal large', 'background frame rules', 'accented'],\n\t\t\t\tb = a.join(\" \")+\" \",\n\t\t\t\tecss = [],\n\t\t\t\tcss = [];\n\t\t\n\t\tvar c = (d.css||[]), isNormal = true;\n\t\tc.forEach(function(i){\n\t\t\tif (b.indexOf(i.toLowerCase()+\" \")>-1) ecss.push(i);\n\t\t\telse css.push(i);\n\t\t\tif (i==\"Small\" || i==\"Large\") isNormal = false;\n\t\t});\n\t\t\n\t\tif (isNormal) ecss.push(\"Normal\");\n\t\t\n\t\tthat.Ecss = ecss;\n\t\td.css = css;\n\t}","ui": {"#edata": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that=this\n\n\t\t\t\tif (v!=null) d.source = v;\n\t\t\t\t\n\t\t\t\tvar s = d.source, \n\t\t\t\t\t\t\tid=\"\", \n\t\t\t\t\t\t\tres=\"\",\n\t\t\t\t\t\t\tprovider = '',\n\t\t\t\t\t\t\tformats = that.Formats;\n\n\t\t\t\t// We have embed\n\t\t\t\t\n\t\t\t\tif (!/^http[s]?:\\/\\//.test(d.source)) {\n\t\t\t\t\t\n\t\t\t\t\t// Detect embed provider\n\t\t\t\t\t\n\t\t\t\t\tif (/youtu[\\.]?be/.test(s)) {\n\t\t\t\t\t\tres = _redim(s);\n\t\t\t\t\t\tprovider = 'youtube';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/google\\.com\\/maps\\/embed/.test(s)){\n\t\t\t\t\t\tres = _redim(s);\n\t\t\t\t\t\tprovider = 'gmap';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/gist\\.github/.test(s)) {\n\t\t\t\t\t\tres = '<div class=\"in---gist\" style=\"display:none\">'+s.replace(/^([^\"]+\")([^\"]+)(\".+)$/,'$2')+'</div>';\n\t\t\t\t\t\tres+=[\n\t\t\t\t\t\t\t'<sc'+'ript>',\n\t\t\t\t\t\t\t'$(function(){',\n\t\t\t\t\t\t\t\t'if (!window.GIST_LOADING) { ',\n\t\t\t\t\t\t\t\t\t'window.GIST_LOADING = 0;',\n\t\t\t\t\t\t\t\t\t'$(\".in---gist\").each(function(){var that = $(this), $p = that.parent();',\n\t\t\t\t\t\t\t\t\t\t'window.GIST_LOADING +=1;',\n\t\t\t\t\t\t\t\t\t\t'$.getJSON( that.text() + \"on?callback=?\", function( data ) {',\n\t\t\t\t\t\t\t\t\t\t\t'window.GIST_LOADING -=1;',\n\t\t\t\t\t\t\t\t\t\t\t'$p.html(data.div);var url = data.stylesheet,$head = $(\"head\");',\n\t\t\t\t\t\t\t\t\t\t\t'if( $head.find(\\'link[rel=\"stylesheet\"][href=\"\\'+url+\\'\"]\\').length < 1 ) ',\n\t\t\t\t\t\t\t\t\t\t\t'$head.append(\\'<link rel=\"stylesheet\" href=\"\\'+ url +\\'\" type=\"text/css\" />\\');',\n\t\t\t\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t'}',\n\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\tString.fromCharCode(60,47)+'script>'\n\t\t\t\t\t\t].join('\\n');\n\t\t\t\t\t\tprovider = 'gist';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/jsfiddle\\.net/.test(s)) {\n\t\t\t\t\t\tif (s.substr(0,7) == '<script') {\n\t\t\t\t\t\t\tres = '<iframe width=\"100%\" height=\"300\" src=\"'\n\t\t\t\t\t\t\t\t+s.replace(/^([^\"]+\")([^\"]+)(\".+)$/,'$2').replace('embed/','embedded/')\n\t\t\t\t\t\t\t\t+'\" allowfullscreen=\"allowfullscreen\" frameborder=\"0\"></iframe>';\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse res = s;\n\t\t\t\t\t\tprovider = 'jsfiddle';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/class=\"twitter\\-tweet\"/.test(s)) {\n\t\t\t\t\t\tres = _redim(s);\n\t\t\t\t\t\tprovider = 'twitter';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\td.data = res || d.source;\n\t\t\t\t\td.provider = provider || 'unknown'\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// We have URL\n\t\t\t\t\n\t\t\t\telse {\n\t\t\t\t\t\n\t\t\t\t\t// ####  Youtube  ####\n\t\t\t\t\t\n\t\t\t\t\tif (/youtu[\\.]?be/.test(s)) {\n\t\t\t\t\t\tif (/^https:\\/\\/youtu\\.be/.test(s)) {\n\t\t\t\t\t\t\tid = s.split(/[\\/\\?&]/)[3];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (/^http[s]?:\\/\\/(www.)?youtube.[a-z]{2,3}\\/watch/.test(s)) {\n\t\t\t\t\t\t\tid = (s.match(/[\\?&]v=([a-z0-9\\-_]+)/i) || [])[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (id) {\n\n\t\t\t\t\t\t\tres = '<iframe src=\"https://www.youtube.com/embed/'\n\t\t\t\t\t\t\t\t+id+'?rel=0&amp;showinfo=0\" frameborder=\"0\" '\n\t\t\t\t\t\t\t\t+' allowfullscreen></iframe>';\n\t\t\t\t\t\t\tprovider = 'youtube';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// ####  Image  ####\n\t\t\t\t\t\n\t\t\t\t\telse if (/\\.(jpeg|jpg|png|gif)$/i.test(s)) {\n\t\t\t\t\t\tres = [\n\t\t\t\t\t\t\t'<div class=\"w100p tac\">',\n\t\t\t\t\t\t\t\t'<img src=\"'+s+'\" ',\n\t\t\t\t\t\t\t\t' style=\"max-width:100%!important;max-height:1000px;\" ',\n\t\t\t\t\t\t\t\t'/>',\n\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t].join(\"\");\n\t\t\t\t\t\tprovider = 'image';\n\t\t\t\t\t}\n\n\t\t\t\t\t// ... no match\n\t\t\t\t\tif (!res) {\n\t\t\t\t\t\td.data = [\n\t\t\t\t\t\t\t'<div class=\"w100p bg-lblue tac p30 fs80\">',\n\t\t\t\t\t\t\t\t'<a target=\"_blank\" href=\"'+s+'\">',\n\t\t\t\t\t\t\t\t\ts.truncate(50,\"middle\",\" … \"),\n\t\t\t\t\t\t\t\t'</a>',\n\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t].join(\"\");\n\t\t\t\t\t\td.provider = 'unknown';\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.data = res;\n\t\t\t\t\t\td.provider = provider;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\treturn d.source;\n\t\t\t\t\n\t\t\t\t//--------\n\t\t\t\t\n\t\t\t\tfunction _redim(s) {\n\t\t\t\t\treturn s.replace(/width\\s?=\\s?\"\\d+[%]?\"/i,'').replace(/height\\s?=\\s?\"\\d+[%]?\"/i,'');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}","watch": "#format","css": {"self:fs90": "function (d) {return d.source.length<150}","self:fs80": "function (d) {return d.source.length>=150}"}},"#format": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t}","init": "function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}"},"#showdesc": "showdesc","#ecss": {"init": "function ($o,form) {\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize(), title:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}","bind": "this.Ecss"},"#css": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[\"Darken\",\"Parallax\"],\n\t\t\t\t\tplaceholder:this.Lang.AUX_PLC\n\t\t\t\t});\n\t\t\t}","bind": "css"},"#btn-apply": "function (d,v,$o) {\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.add(this.Ecss||[]).unique().remove(\"Normal\");\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t}","#btn-cancel": "function (d,v,$o) {if(v!=null)$o.trigger(\"cancel\")}"},"style": {" #edata": "height:120px;overflow-x:hidden;overflow-y:auto;resize: none"},"Ecss": []}},"widget": {"id": "cw.Inliner.Ed.Items.widget","Name": "<span class=\"fi-layout fs115 dib vat mt1 mb-1\" title=\"Add widget\"></span>","Hoverpane": ".in--widget .in-ct","inherit": ["Att"],"data": {"name": "","type": "widget","tab": ["manifest"],"js": "// Widget manifest\n({\n\tinit: function ($form, form) {\n\t\t// Init code\n\t},\n\tui: {\n\t\t// UI bindings\n\t}\t,\n\tstyle: {\n\t\t// Local CSS rules\n\t}\n})","html": "","data": "({\n\t//Put default data here\n})","state": "","valid": false,"err": [],"options": [],"source": "","format": "left750","css": ["Frame"],"bg": ""},"Url": {},"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td= form.data,\n\t\t\t\tdata = d.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle = that.Formats[fmt];\n\t\t\n\t\t$o.formgen(that.HTML);\n\n\t\t$o.addClass(\"in--widget \"+style.css);\n\t\tif (that.Opts) that.Opts.Formats = that.Formats;\n\t\t\n\t\t$o.then(function(){\n\t\t\tif (form.data.state) $o.find(\"#btn-run\").trigger(\"click\");\n\t\t\telse that.XCode($o, form.data);\n\t\t\t\n\t\t\t$o.find(\"#ovl\").removeClass('hide');\n\t\t\t\n\t\t});\n\t}","die": "function ($o) {\n\t\tif ($o.find(\"#xapp\").data(\"my\")) {\n\t\t\ttry{\n\t\t\t\t$o.find(\"#xapp\").my(\"remove\");\n\t\t\t} catch(e) {}\n\t\t}\n\t}","ui": {"#formatter": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this, \n\t\t\t\t\t\t$r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\t\t\t\t\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\n\t\t\t\tif (d.state == \"running\") {\n\n\t\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t\tcss.push (fm.css);\n\n\t\t\t\t} else {\n\t\t\t\t\tcss.push('in-frame in-br0 '+(d.css.indexOf('NarrowEditor')>-1?'in-item-medium':'in-item-wide'))\n\t\t\t\t}\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--widget in-item\");\n\t\t\t\t\n\t\t\t\t// bg\n\t\t\t\tif (d.bg && d.state == \"running\") {\n          if (!that.Url[d.bg]) {\n            try {\n              that.Url = that.Att('*','session');\n            } catch(e){}\n            if (!that.Url[d.bg]) {\n            \tvar p = that.Att(d.bg, 'url');\n              if (p.then) p.then(function(url){\n                that.Url[d.bg] = url;\n                _bg(url);\n              });\n              else {\n                that.Url[d.bg] = p;\n                _bg(url);\n              }\n            }\n          }\n\t\t\t\t\telse _bg(that.Url[d.bg]);\n\t\t\t\t} \n        else $r.css({'background-image':'none'});\n\t\t\t\t\n        // - - - - - -\n        function _bg(bg){\n        \t$r.css({'background-image':'url(\"'+(bg || d.bg)+'\")'});\n        }\n\t\t\t}","watch": "#btn-run,#btn-code"},"#ovl-tab": {"bind": "function (d,v,$o) {\n\t\t\t\tif (null!=v) {\n\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\tif ($x.is(\".my-form\")) $x.my(\"redraw\");\n\t\t\t\t\td.tab = v.length?v:['manifest'];\n\t\t\t\t}\n\t\t\t\treturn d.tab;\n\t\t\t}","init": "function ($o) {\n\t\t\t\t$o.tags({tags:[{\"HTML\":\"html\"}, {\"Manifest\":\"manifest\"}, {\"Defaults\":\"data\"}]})\n\t\t\t}"},"#btn-run": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t\n\t\t\t\t\tif (d.state == \"running\") $o.my(\"find\",\"#xapp\").my('remove');\n\t\t\t\t\t\n\t\t\t\t\tif (!that.Att || !d.bg || /^http/.test(d.bg)) _run();\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar p = that.Att(d.bg, 'url');\n\t\t\t\t\t\tif (p.then) p.then(function(url){\n\t\t\t\t\t\t\tthat.Url[d.bg] = url;\n\t\t\t\t\t\t\t_run();\n\t\t\t\t\t\t});\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tthat.Url[d.bg] = p;\n\t\t\t\t\t\t\t_run();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Run\n\t\t\t\tfunction _run() {\n\t\t\t\t\tif (d.valid) {\n\t\t\t\t\t\td.state = \"running\";\n\t\t\t\t\t\t$o.my(\"find\",\"#xcode,.ovl-tabs\").addClass(\"hide\");\n\t\t\t\t\t\tvar $a = $o.my(\"find\",\"#xapp\"),\n\t\t\t\t\t\t\t\t$v = $o.my(\"find\",\"#xreflect\"),\n\t\t\t\t\t\t\t\tman = eval(d.js);\n\t\t\t\t\t\tman._compiled = this._compiled;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (that.Att) man.Att = that.Att;\n\t\t\t\t\t\tif (that.db) man.db = that.db;\n\t\t\t\t\t\tif (man.meta && that.RT) {\n\t\t\t\t\t\t\tman.meta = Object.merge(\n\t\t\t\t\t\t\t\tObject.clone(that.RT().Config.meta || {}, true),\n\t\t\t\t\t\t\t\tObject.clone(that.RT().data.meta || {}, true)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tman.meta.id = that.RT().data._id;\n\t\t\t\t\t\t\tman.meta.theme = Object.reject($.extend(true,{},that.RT().Theme, that.RT().data.style),['tags']);\n\t\t\t\t\t\t\tman.meta.tags = Object.clone(that.RT().data.tags, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$a.removeClass(\"hide\")\n\t\t\t\t\t\t.html(d.html)\n\t\t\t\t\t\t.my(man, eval(d.data) || {})\n\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t$a.trigger(\"change\");\n\t\t\t\t\t\t}.debounce(50))\n\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t$a.my('restyle');\n\t\t\t\t\t\t}.debounce(200));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (d.options.indexOf(\"show data\")!=-1) {\n\t\t\t\t\t\t\t$a.on(\"change.my\", function(){\n\t\t\t\t\t\t\t\t$v.html(\n\t\t\t\t\t\t\t\t\tcw.lib.js2txt(\n\t\t\t\t\t\t\t\t\t\t$a.my(\"data\"),\"  \")\n\t\t\t\t\t\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t\t\t\t\t\t.replace(/^\\{/,'{ <span class=\"green\">// Form data</span>')\t\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}.debounce(2));\n\t\t\t\t\t\t\t$a.addClass(\"xdata\");\n\t\t\t\t\t\t\t$v.addClass(\"xdata\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$a.removeClass(\"xdata\");\n\t\t\t\t\t\t\t$v.removeClass(\"xdata\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Persist data 2 doc\n\t\t\t\t\t\t$a.on(\"change.my\", function(){\n\t\t\t\t\t\t\tif (d.options.indexOf(\"reflect\")!=-1) {\n\t\t\t\t\t\t\t\td.data = \"(\"+JSON.stringify($a.my(\"data\"), null, '\\t')+\")\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.debounce(50));\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcw.lib.note(d.err.join(\".<br>\")+\".\", \"error\", 5000);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}","css": {"hide": "function (d) {return !!d.state}","red": "function (d) {return !d.valid}","green": "function (d) {return d.valid}"},"events": "click.my","watch": "#btn-code"},"#btn-code": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = \"\";\n\t\t\t\t\t$o.my(\"find\",\"#xapp\").addClass(\"hide\").my(\"remove\");\n\t\t\t\t\t$o.my(\"find\",\"#xcode,.ovl-tabs\").removeClass(\"hide\");\n\t\t\t\t\t$o.my(\"find\",\"#xreflect\").removeClass(\"xdata\");\n\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\tif (!$x.is(\".my-form\")) {\n\t\t\t\t\t\tthis.XCode($o.my().root, d);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$o.my(\"find\",\"#data\").trigger(\"recalc\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}","css": {"hide": "function (d) {return !d.state || d.options.indexOf(\"noedit\")>-1}"},"events": "click.my","watch": "#btn-run"},"#warn": {"bind": "function (d) {\n\t\t\t\tvar t=d.js, o, err=[], data, isO = Object.isObject;\n\t\t\t\ttry { o = eval(t); } catch (e) {}\n\t\t\t\ttry { data = eval(d.data); } catch (e) {}\n\t\t\t\td.valid=false;\n\t\t\t\tif (!isO(o)) err.push(\"Invalid manifest\");\n\t\t\t\telse {\n\t\t\t\t\t\tif ( !isO(o.ui)) err.push(\"No ui section\");\n\t\t\t\t\t\telse if ( !Object.size(o.ui)) err.push(\"No bindings in ui section\");\n\t\t\t\t\t\n\t\t\t\t\t\tif  ( !Object.isFunction(o.init) && !Object.isArray(o.init) && !(d.html+\"\").length)\n\t\t\t\t\t\t\terr.push(\"No HTML defined in init function or HTML tab\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!isO(data))  err.push(\"Defaults must be an object\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (o.data!==undefined && !isO(o.data)) err.push(\"Section ‘data’ must be an object\");\n\t\t\t\t\t\tif (o.params!==undefined && !isO(o.params)) err.push(\"Section ‘params’ must be an object\");\n\t\t\t\t\t\tif (o.style!==undefined && !isO(o.style)) err.push(\"Section ‘style’ must be an object\");\n\t\t\t\t\t}\n\t\t\t\tif (!err.length) d.valid = true;\n\t\t\t\td.err=err;\n\t\t\t}","delay": 500,"recalc": "#btn-run"}},"XCode": "function ($form,d) {\n\t\tthis.XCode3._compiled = this._compiled;\n\t\t\n\t\t$form.find(\"#xcode\").removeClass('hide')\n\t\t.my (this.XCode3, d)\n\t\t.on(\"change\", function(){\n\t\t\t$form.find(\"#warn\").trigger(\"check.my\");\n\t\t});\n\t}","XCode3": {"require": [{"window.CodeMirror": "/lib/codemirror.js"}],"ui": {"#xjs": {"css": {"hide": "function (d) { return d.tab.indexOf(\"manifest\")==-1;}"}},"#js": {"bind": "js","init": "function ($o,form) { \n\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"manifest\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t}"},"#xdata": {"css": {"hide": "function (d) { return d.tab.indexOf(\"data\")==-1;}","bt1": "function (d) { return d.tab.length>1;}"}},"#data": {"bind": "data","init": "function ($o,form) { \n\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"data\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t}"},"#xhtml": {"css": {"hide": "function (d) { return d.tab.indexOf(\"html\")==-1;}","bb1": "function (d) { return d.tab.length>1;}"}},"#html": {"bind": "html","init": "function ($o,form) { \n\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"html\")>-1) \n\t\t\t\t\t\tthis.Cm($o, \"htmlmixed\", true, \"base16-light\");\n\t\t\t\t}"}},"Cm": "function ($o,mode,lineNums,theme) {\n\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: mode,\n\t\t\t\tlineNumbers:lineNums,\n\t\t\t\tindentWithTabs:!0,\n\t\t\t\tindentUnit:2,\n\t\t\t\ttabSize:2,\n\t\t\t\ttheme: theme||\"default\"\n\t\t\t});\n\t\t}"},"HTML": ["<div id=\"formatter\" class=\"hide\"></div>","<div class=\"cw-widget in-ct\">","<div id=\"ovl\" class=\"hide\">","<div class=\"ovl-tabs\">","<span id=\"ovl-tab\"></span>","</div>","<div class=\"ovl-buttons\">","<span id=\"btn-run\"><span class=\"fi-play\"></span>&nbsp;Run</span>","<span id=\"btn-code\" class=\"hide\">Code&thinsp;<span class=\"fi-pencil\"></span></span>","</div>","</div>","<div id=\"xcode\" class=\"hide\">","<div id=\"xhtml\"><textarea id=\"html\"></textarea></div>","<div id=\"xjs\"><textarea id=\"js\"></textarea></div>","<div id=\"xdata\"><textarea id=\"data\"></textarea></div>","</div>","<div id=\"xreflect\"></div>","<div id=\"xapp\" class=\"hide\"></div>","<div id=\"warn\" class=\"hide\"></div>","</div>"],"Formats": {"left300": {"css": "in-item-small"},"left500": {"css": "in-item-medium"},"left750": {"css": "in-item-wide"},"left1000": {"css": "in-item-max"},"right300": {"css": "in-item-small-right"},"right200": {"css": "in-item-tiny-right"}},"style": {".in--widget": "function () {\n\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcl = 'clear:left; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ';\n\n\t\tr[''] = 'display:block; z-index:+1; margin-top:'+gap+'; margin-bottom:'+gap+'; '\n\t\t+'background-size:cover; background-position:50% 50%;';\n    \n    r['#in-innavbar']={\n      '+.in-item .in-ct':'margin-top:0!important;',\n      '':'margin-bottom:0;'\n    };\n\t\t\n\t\tr['.in-background .in-ct'] = \n\t\tr['.in-frame .in-ct'] = cbro;\n\n\t\tr['.in-rules #xapp'] = 'padding:'+inset+' 0!important;border-radius:0!important;'\n\t\tr['.in-background #xapp'] = \n\t\tr['.in-frame #xapp'] = 'padding:'+inset+'!important;';\n    \n    // - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-max'] = {\n\t\t\t\n\t\t\t':first-child':'margin-top:0!important;',\n      '+.in-item-max':'margin-top:0!important;',\n\t\t\t\n\t\t\t'': 'min-height:1.2em; width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';',\n\t\t\t'.in-rules + .in--widget.in-item-max.in-rules': {\n\t\t\t\t'':'margin-top:-'+gap+';',\n\t\t\t\t' .in-ct':'border-top:none!important;'\n\t\t\t},\n\t\t\t' .in-ct':'width:100%;border-radius:0!important;border-left:none;border-right:none;',\n\t\t\t' .in-rt-pad':'width:100%;'+cpad,\n\t\t\t' .in-rt-body':cbody + 'width:100%;'+cb,\n\t\t\t' .in-rt-text':ctext + 'width:'+(s.text.width||'100%')\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-wide'] = {\n\t\t\t'': 'min-height:1.2em;'+cbody + cb,\n\t\t\t' .in-ct':cbody + 'width:100%;',\n\t\t\t'.in-rules + .in--widget.in-item-wide.in-rules': {\n\t\t\t\t'':'margin-top:-'+gap+';',\n\t\t\t\t' .in-ct':'border-top:none!important;'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-medium'] = {\n\t\t\t'': 'min-height:1.2em;'+cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t'.in-rules + .in--widget.in-item-medium.in-rules': {\n\t\t\t\t'':'margin-top:-'+gap+';',\n\t\t\t\t' .in-ct':'border-top:none!important;'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' -'+pl+';',\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;z-index:+2;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-tiny-right'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;z-index:+2;',\n\t\t\t' .in-ct': 'width:' + s.aside.tiny + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t}\n\t\t\n\t\t\n\t\tr[' #xapp '] = _ext2({\n\t\t\t'': s.text.normal\n\t\t}, s.tags||{}, false);\n\t\t\n\t\tr['.in-small #xapp'] = s.text.small;\n\t\tr['.in-large #xapp'] = s.text.large; \n    \n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\t_ext(r, {\n\t\t\t\n\t\t\t// Editor related\n\n\t\t\t\" .b0\": \"border:none!important;\",\n\t\t\t\" .CodeMirror, .CodeMirror-gutter-elt\":\"font:13px \"+_font(s.font.fixed)+\";line-height:1.3em;\"\n\t\t\t\t+\"height:auto;min-height:30px!important;\",\n\t\t\t\" #xjs .CodeMirror\":\"height:400px;overflow:hidden;\",\n\t\t\t\" #xapp\": {\n\t\t\t\t\"\":\"display:block;vertical-align:top;\",\n\t\t\t\t\".xdata\" :\"width:auto;padding-right:20px;\"\n\t\t\t},\n\t\t\t\" #xcode\":{\n\t\t\t\t\"\":\"width:100%;\",\n\t\t\t\t\">div\":\"display:inline-block;width:100%;vertical-align:top\",\n\t\t\t\t\"textarea\":\"width:100%; font-size:80%;\"\n\t\t\t},\n\t\t\t\" #ovl\" :{\n\t\t\t\t\"\":\"transition: opacity 0.3s; opacity:0.6;position:absolute; top:6px;right:8px;z-index:+4;\"\n\t\t\t\t\t+\"width:280px; font-size:11pt; line-height:1.3em;\",\n\t\t\t\t' .ovl-tabs':'width:200px;display:inline-block;vertical-align:top;padding-top:3px;',\n\t\t\t\t' .ovl-buttons':'width:80px; float:right; font-size:11pt;text-align: right;',\n\t\t\t\t' .my-tags': {\n\t\t\t\t\t'':'position: relative;',\n\t\t\t\t\t' .tag': {\n\t\t\t\t\t\t'':'padding: 0.15em 0.35em 0.22em 0.35em; white-space: nowrap;text-decoration: none;',\n\t\t\t\t\t\t'.active':'background-color: rgba(162, 206, 237, 0.35);color: #20557d;border-radius: 2px;',\n\t\t\t\t\t\t'.active:hover':'color: #12a5dc;'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\":hover\" : \"opacity:1\"\n\t\t\t},\n\t\t\t\" .bb1\":\"border-bottom:1px solid #ddd;\",\n\t\t\t\" .bt1\":\"border-top:1px solid #ddd;\",\n\t\t\t\" label\":\"display:inline-block; color:#777; margin-right:20px;\",\n\t\t\t\" #xreflect\":{\n\t\t\t\t\"\":\"padding:0px 7px 0px 15px; font:12px \"+_font(s.font.fixed)+\";line-height:1.1em;height:auto;\"\n\t\t\t\t+\"margin:18px 0 18px 0; border-left:1px dotted #C1D0DA; opacity:0.7;\"\n\t\t\t\t+\"white-space: pre-wrap;word-wrap: break-word; overflow:hidden; vertical-align:top; display:none;\",\n\t\t\t\t\".xdata\": \"float:right;display:block;width:270px;\"\n\t\t\t},\n\t\t\t' #btn-run, #btn-code':{\n\t\t\t\t'':'border-radius:100px; padding:0.3em 0.8em 0.4em 0.8em; transition: color 0.3s, background 0.3s;'\n\t\t\t\t+'background-color:#e2f4c8; color:#809b2d; display:inline-block;cursor:pointer;',\n\t\t\t\t'.red':'background-color:#fed3d3; color:#d45'\n\t\t\t}\n\t\t});\n\n\t\treturn r;\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list) {\n\t\t\tif (Object.isObject(list)) {\n\t\t\t\tfor (var i in list) {\n\t\t\t\t\tif (list.hasOwnProperty(i) && !obj[i]) obj[i] = list[i]; \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _ext2 (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t\tfunction _font(a) {\n\t\t\tvar s=[];\n\t\t\t(a||[]).forEach(function(e){\n\t\t\t\tif (/\\s/.test(e)) s.push(\"'\"+e+\"'\");\n\t\t\t\telse s.push(e);\n\t\t\t});\n\t\t\treturn s.length?s.join(\",\"):\"inherit\";\n\t\t}\n\t}"},"To": {"html": "function (item,options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n      _clone = Object.clone,\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:'',\n\t\t\t\tinitSync: false,\n\t\t\t\tforceNoEdit:false,\n\t\t\t\tforceUpgradeWidgets:false\n\t\t\t}, Object.isObject(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thatml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:''\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type ) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\n\tid = d._stamp || id;\n\n\tvar css=['in-item', 'in--'+d.type];\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\n\t// Prepare manifest\n\t\n\tvar man,\n\t\t\t\n\t\t\ttid \t= \"in-\"+id,\n\t\t\th\t\t\t=\t\"\", \n\t\t\theight,\n\t\t\thtml = \t[],\n\t\t\tscripts = [],\n      data \t= _clone(item, true),\n      noEdit = data.options.indexOf('noedit')>-1 || (opts.forceNoEdit && data.state=='running'),\n      insync = opts.initSync || data.options.indexOf('init sync')>-1,\n      man = _clone(\n        noEdit\n          ?Object.reject(that, ['Compiler','Hoverpane', 'Opts', 'Select', 'To', 'Ico', /^_/])\n          :that, \n        true\n      );\n\n  man.style[' .ovl-tabs'] = 'display:none!important;';\n\tman._compiled = true;\n\t\n\tif (data.source) css.push('in--widget-manifest-'+data.source);\n\n\tif (noEdit) {\n\t\t// Include only executable manifest\n\t\tif (data.err.length || !data.valid) res.err.push('Error: widget code is invalid or has errors');\n\t\telse {\n\n\t\t\tvar refl = data.options.indexOf(\"show data\")>-1,\n\t\t\t\t\tupgrade = (\n\t\t\t\t\t\tthat.Widget && (\n\t\t\t\t\t\t\topts.forceUpgradeWidgets \n\t\t\t\t\t\t\t|| data.options.indexOf('autoupdate') > -1\n\t\t\t\t\t\t)\n\t\t\t\t\t)? that.Widget:null,\n\t\t\t\t\tfn = (that.Widget && that.Widget.To && that.Widget.To.data) ? that.Widget.To.data:null,\n\t\t\t\t\tformdata = data.data,\n\t\t\t\t\tformman = upgrade?js2txt(Object.reject(upgrade,['Opts','To']),''):data.js,\n          formmanid = (upgrade?upgrade.id:'') || '';\n\t\t\t\n\t\t\tif (\n\t\t\t\tthat.RT\n\t\t\t\t&& (\n\t\t\t\t \t(upgrade && upgrade.meta)\n\t\t\t\t\t||\n\t\t\t\t\t// dirty hack to avoid parsing\n\t\t\t\t\t(!upgrade && /(\"meta\"|meta)[\\s]?:[\\s]?{/.test(data.js))\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// Prepare meta\n\t\t\t\tvar sdoc = that.RT().data,\n\t\t\t\t\t\tfmeta = _clone(sdoc.meta || {}, true);\n\t\t\t\tfmeta.id = sdoc._id;\n\t\t\t\tfmeta.tags = sdoc.tags;\n\t\t\t\tfmeta.theme = Object.reject(Object.merge(\n\t\t\t\t\t_clone(that.RT().Theme || {}, true), \n\t\t\t\t\tsdoc.style, \n\t\t\t\t\ttrue\n\t\t\t\t), ['tags']);\n\t\t\t}\n\t\t\t\n\t\t\tif (Object.isFunction(fn)) formdata = fn.call(that, data, opts);\n\t\t\t\n\t\t\tvar bg='', bgurl, style = '';\n\t\n\t\t\tif (bg = (data.bg || '')) {\n\n\t\t\t\tif (/^http[s]?:/.test(bg) || bg.to(1)=='/') bgurl = bg;\n\t\t\t\telse {\n\t\t\t\t\tif (opts.Urls) bgurl = opts.Urls[bg];\n\t\t\t\t\telse bgurl = opts.path + bg;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (bgurl) style += 'background-image:url(\\''+bgurl+'\\')';\n\n\t\t\th+=[\n\t\t\t\t'<div id=\"'+tid+'\" class=\"'+css.join(' ')+'\" style=\"'+style+'\">',\n\t\t\t\t\t'<div class=\"in-ct cw-widget\">',\n        \t\t(refl?'<div id=\"xreflect\" class=\"xdata\"></div>':\"\"),\n\t\t\t\t\t\t'<div id=\"xapp\" class=\"'+(refl?' xdata':'')+'\">'+data.html+'</div>',\n\t\t\t\t\t'</div>',\n\t\t\t\t'</div>'\n\t\t\t].join(\"\");\n\n\t\t\thtml.push(h);\n\t\t\t\n\t\t\t// First, push manifest\n\t\t\t// if we have widget\n\t\t\t\n      if (upgrade && upgrade.id) {\n        if (!formmanid) scripts.push('$.my.cache('+formman+');');\n        else scripts.push('if (!$.my.cache(\"'+formmanid+'\",\"exist\")) $.my.cache('+formman+');');\n      }\n\t\t\t\n\t\t\t// Push starter script\n\t\t\t\n\t\t\tscripts.push([\n\t\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t\t+'(function(){var $f=$(\"#'+tid+'\");$f.find(\"#xapp\").my($.extend('\n\t\t\t\t+(upgrade && upgrade.id?'$.my.cache(\"' + upgrade.id + '\")':formman)\n\t\t\t\t+',{_compiled:true'+(fmeta?',meta:'+JSON.stringify(fmeta):'')+'}), ',\n\t\t\t\tformdata+')',\n\t\t\t\t(refl?'.on(\"change.my\", function(){'\n\t\t\t\t +'$(this).parent().find(\"#xreflect\").html('\n\t\t\t\t +'cw.lib.js2txt($(this).my(\"data\"),\"  \").replace(/^\\{/,\\'{ <span class=\"green\">// App data</span>\\')'\n\t\t\t\t +');'\n\t\t\t\t +'}.debounce(20))':\"\"),\n\t\t\t\t'.then(function(){$f.css({\"height\":\"\", overflow:\"\"});}.debounce(100))',\n\t\t\t\t'});'\n\t\t\t].join('\\n'));\n\t\t}\n\n\t} else {\n\t\t// Include full code\n\t\t/*var norepo = !repo[man.id];\n\t\trepo[man.id]=true;*/\n\t\tvar norepo = true;\n\t\th+=[\n\t\t\t'<div id=\"'+tid+'\" class=\"' + css.join(' ') + '\" style=\"\"></div>',\n\t\t\t/*'<'+'script>',\n\t\t\t//(norepo?'$.my.cache('+cw.lib.js2txt(man,\"  \")+');' : ''),\n\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t+'(function(){var $f=$(\"#'+tid+'\"); $f.my('+js2txt(man,\"  \")+', ',\n\t\t\t\tjs2txt (data,\"  \").replace(/<\\//g, '<\\\\u002F')+')',\n\t\t\t'.then(function(){$f.css({\"height\":\"\", overflow:\"\"});}.debounce(100))',\n\t\t\t'});',\n\t\t\t'<'+'/script>'*/\n\t\t].join('\\n');\n\t\thtml.push(h);\n\t\t\n\t\tscripts.push([\n\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t+'(function(){var $f=$(\"#'+tid+'\"); $f.my('+js2txt(man,\"  \")+', ',\n\t\t\tjs2txt (data,\"  \").replace(/<\\//g, '<\\\\u002F')+')',\n\t\t\t'.then(function(){$f.css({\"height\":\"\", overflow:\"\"});}.debounce(100))',\n\t\t\t'});'\n\t\t].join('\\n'));\n\t\t\n\t}\n\n\t// - - - - - - - - \n\n\tres.html = html.join('');\n\tres.scripts = scripts;\n\n\treturn res;\n\n\t//- - - - - - - - - - - - - - -\n\n\tfunction js2txt (srcObj, tabChar){\n\t\t// outputs js object as string\n\t\t// js2txt(srcObj, tabChar) >> string\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\tfunction f(n){return n<10?'0'+n:n;}\n\n\t\tvar tabs= '\\t'.repeat(20),  \n\t\t\t\tfj = JSON.stringify;\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\tfunction s2 (w, ctab0, tab){\n\t\t\tvar tl=0,a,i,k,l,v,ctab=ctab0||0,xt = tabs;\n\t\t\tif (tab && Object.isString(tab)) {\n\t\t\t\ttl=(tab+\"\").length;xt = (tab+\"\").repeat(20);\n\t\t\t}\n\t\t\tswitch((typeof w).substr(0,3)){\n\t\t\t\tcase 'str': return fj(w).replace(/<\\/scri/ig,'<\\\\u002fscri');\n\t\t\t\tcase'num':return isFinite(w)?''+String(w):'null';\n\t\t\t\tcase 'boo': case'nul':return String(w); \n\t\t\t\tcase 'fun': return _cleanFn(w.toString())\n\t\t\t\t.replace(/\\n([^\\t\\n])/g,'\\n'+(tab?xt.to(ctab*tl+tl):\"\")+'$1')\n\t\t\t\t.replace(/\\n+/g,'\\n')\n\t\t\t\t.replace(/<\\/scri/ig,'<\\\\u002fscri');\n\t\t\t\tcase 'obj': if(!w) return'null';\n\t\t\t\t\tif (Object.isRegExp(w)) return w.toString();\n\t\t\t\t\tif (typeof w.toJSON===\"function\") return s2(w.toJSON(),ctab+(tab?1:0),tab);\n\t\t\t\t\ta=[];\n\t\t\t\t\tif (Object.isArray(w)){\n\t\t\t\t\t\tfor(i=0; i<w.length; i+=1){\n\t\t\t\t\t\t\ta.push(s2(w[i],ctab+(tab?1:0),tab)||'null');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn'['\n\t\t\t\t\t\t+a.join(','+(tab?\"\\n\"+xt.to(ctab*tl+tl):\"\"))\n\t\t\t\t\t\t+']';\n\t\t\t\t\t}\n\t\t\t\t\tfor (k in w) if (Object.isString(k)) {\n\t\t\t\t\t\tv=s2(w[k],ctab+(tab?1:0),tab);\n\t\t\t\t\t\tif(v) a.push((tab?\"\\n\"+xt.to(ctab*tl+tl):\"\")\n\t\t\t\t\t\t\t\t\t\t\t\t +s2(k,ctab+(tab?1:0),tab)+': '+v);\n\t\t\t\t\t};\n\t\t\t\t\treturn '{'+a.join(',')+(tab?\"\\n\"+xt.to(ctab*tl):\"\")+'}';\n\t\t\t}\n\t\t}\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\tfunction _cleanFn (s) {\n\t\t\tvar splitter = /\\)([\\s\\n\\t]+?|\\/\\/*.*?\\*\\/|\\/\\/[^\\n]*\\n)*?\\{/,\n\t\t\t\t\ta = s.split(splitter,1),\n\t\t\t\t\thead = a[0].from(8).replace(/[\\s\\n\\t]+?|\\/\\/*.*?\\*\\/|\\/\\/[^\\n]*\\n/g,'')+\")\",\n\t\t\t\t\ttail = '{' + s.from(a[0].length).replace(splitter,'').replace(/}[^\\}]+$/,'}');\n\t\t\treturn ('function '+head).replace(/^function\\sanonymous/,'function ') +' '+tail;\n\t\t}\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\treturn s2(srcObj,0,tabChar);\n\t}\n\n}"},"Opts": {"params": {"width": 320},"data": {"options": []},"lang": {"en": {"BTN_APPLY": "Apply","BTN_CANCEL": "Cancel","TITLE": "Widget settings","AUTOUPDATE": "Autoupdate widget code","NOEDIT": "No Code btn when launched","REFLECT": "Reflect data","PERSIST": "Persist data into doc","SYNC": "Init sync","BG_PLC": "Background image...","AUX_PLC": "Aux formatting..."},"ru": {"BTN_APPLY": "Применить","BTN_CANCEL": "Отмена","TITLE": "Настройки виджета","AUTOUPDATE": "Автообновление кода","NOEDIT": "Запрет редактирования кода","REFLECT": "Показывать JSON данных","PERSIST": "Сохранять данные в документ","SYNC": "Синхронная инициализация","BG_PLC": "Фоновое изображение...","AUX_PLC": "Дополнительные эффекты..."}},"init": "function ($o,form) {\n\t\t\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\t$o.html($.my.formgen([\n\t\t\t{row:\"320px\", label:\"70px\", rowCss:\"my-row pb10\", labelCss:\"my-label fs90 gray\"},\n\t\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb3\"></div>',\n\t\t\t['', 'inp#css.w100p.fs100'],\n\t\t\t['', 'inp#ebg.w100p.fs100'],\n\t\t\t'<div id=\"xoptions\" class=\"fs90 bt1 pl5 pt0 pb10 blue\">',\n\t\t\t\t\t'<div id=\"xwname\">',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"autoupdate\" />',\n\t\t\t\t\t\t' &nbsp;{AUTOUPDATE}',\n\t\t\t\t\t'</label>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"noedit\" />',\n\t\t\t\t\t\t' &nbsp;{NOEDIT}',\n\t\t\t\t\t'</label>',\n\t\t\t\t\t'<div id=\"xwreflect\">',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"show data\" />',\n\t\t\t\t\t\t\t' &nbsp;{REFLECT}',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"reflect\" />',\n\t\t\t\t\t\t' &nbsp;{PERSIST}',\n\t\t\t\t\t'</label>',\n\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"init sync\" />',\n\t\t\t\t\t\t' &nbsp;{SYNC}',\n\t\t\t\t\t'</label>',\n\t\t\t\t'</div>',\n\t\t\t{rowCss:\"my-row pl5 pb5\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w120.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t 'but#btn-cancel.w120',{txt:'{BTN_CANCEL}'}\n\t\t\t]\n\t\t]).assign(L));\n\t\t\n\t\tvar a = ['small normal large', 'background frame rules','accented'],\n\t\t\t\tb = a.join(\" \")+\" \",\n\t\t\t\tecss = [],\n\t\t\t\tcss = [];\n\t\t\n\t\tvar c = (d.css||[]), isNormal = true;\n\t\tc.forEach(function(i){\n\t\t\tif (b.indexOf(i.toLowerCase()+\" \")>-1) ecss.push(i);\n\t\t\telse css.push(i);\n\t\t\tif (i==\"Small\" || i==\"Large\") isNormal = false;\n\t\t});\n\t\t\n\t\tif (isNormal) ecss.push(\"Normal\");\n\t\t\n\t\tthat.Ecss = ecss;\n\t\td.css = css;\n\t\t\n\t\tif (that.Att) {\n\t\t\treturn that.Att(/\\.(jpg|jpeg|png|gif|svg)$/i, \"preview\")\n\t\t\t.then(function(res){\n\t\t\t\tres.forEach(function(e){ that.P[e.fname] = e; });\n\t\t\t});\n\t\t}\n\t}","P": {},"ui": {"#format": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t}","init": "function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}"},"#ecss": {"init": "function ($o,form) {\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize(), title:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}","bind": "this.Ecss"},"#ebg": {"init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\tplaceholder:that.Lang.BG_PLC\n\t\t\t\t})\n\t\t\t}","bind": "bg"},"#css": {"init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[\"Darken\",\"Parallax\"],\n\t\t\t\t\tplaceholder:that.Lang.AUX_PLC\n\t\t\t\t});\n\t\t\t}","bind": "css"},"#btn-apply": "function (d,v,$o) {\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.add(this.Ecss||[]).unique().remove(\"Normal\");\n\t\t\t\td.bg = d.bg+'';\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t}","input[name=options]": "options","#xwname": {"css": {"hide": "function (d) {return !d.source}"}},"#xwreflect": {"css": {"hide": "function (d) {return !!d.source}"}},"#btn-cancel": "function (d,v,$o) {if(v!=null)$o.trigger(\"cancel\")}"},"Ecss": []},"Select": {"init": "function ($o,form) {\n\t\t$o.on(\"click.my\",\"#wname\",function(){\n\t\t\t var e = $(this).my().root.my(\"data\");\n\t\t\t\n\t\t\tif (e.ui) {\n        var code = cw.lib.unjson(JSON.parse(cw.lib.json(e)));\n\t\t\t\tform.data.extender = {\n\t\t\t\t\tjs:\t\t\t\t'(' + cw.lib.js2txt(code,'\\t') + ')',\n\t\t\t\t\tstate:\t\t'running',\n\t\t\t\t\ttab:\t\t\t['data'],\n\t\t\t\t\toptions:\t['noedit','reflect','autoupdate'],\n\t\t\t\t\tsource:\t\te.id.split('.').last()\n\t\t\t\t};\n        if (code.defaultFormat) {\n          Object.merge(form.data.extender, Object.select(code.defaultFormat, ['format','css']));\n        }\n\t\t\t}\n\n\t\t\t\n\t\t\t$o.trigger(\"commit\");\n\t\t});\n\t\t\n\t\tthis.Widgets = [{name:\"Custom widget\"}]\n\t\t\t.add(form.data.widgets.sortBy(\"name\"));\n\t\t\n\t\t$o.html('<div id=\"wlist\" class=\"pl0\"></div>');\n\t}","ui": {"#wlist": {"bind": "this.Widgets","list": "<div><img id=\"wico\" class=\"w16 h16 mr5 dib vat mt3\"><span class=\"pseudolink tdn\" id=\"wname\"></span></div>","manifest": {"inherit": ["GetIco"],"ui": {"#wico": "function (d) {\n\t\t\t\t\t\treturn d.Ico || this.GetIco();\n\t\t\t\t\t}","#wname": "function (d,v) {\n\t\t\t\t\t\tvar lang = $.my.locale() || 'en';\n\t\t\t\t\t\tif (d.Lang && d.Lang[lang] && d.Lang[lang].APPTITLE) return d.Lang[lang].APPTITLE;\n\t\t\t\t\t\treturn d.name || d.id\n\t\t\t\t\t}"}}}},"GetIco": "function () {return this.Ico}","Ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAACUpJREFUeNrkW+tvVEUUn0KhvKSdQmlBELi8ITzSRR4iiNpEFGNMtDEkhm+CXzR8o3/CfjTBaIr6RRNI5IvEqMFU8ElVWBQQRCgjVB5VwOH9KFD8/e7MXXbL3d27e+/tIw6czt27987O+Z0zZ845M1N279498X8u5fxTVlYW64+sSzbXoRoPYl0LGgEaAqoAdYFuWtKgDksnNzetvxpnvyj8MvdPxAA0Jj8eLIWux+Vc0EzQSO87ScalHIrLQbgeRADA9W3Ut7XWZPiu1z/QadDvoBTAON7nAYCkJ6N6EkTmKyRJyrEkfK6RUlQCgop8fYISXNNaXAQoHQDkDOicBYP1btDXUWlGZACA8emoVoNmg+lyMDwJNBX0MEeYK3lJkoL/7P+sot0/mv9xbWr7zS1cK6X1MYDxD27cAn0L2gEgLvUqAOuSySqw8gouF1LajuPMAY9zPCk7jhQOmZaypPYVAVHarQ1I+jw+/4rPJ6zN2O4IvbOpqamrxwGA1J9A9TJoGBifC0YXuOMazCac0pnOB4ZKKWGh0FCJ3bh3Fh9Ogd6DNpzpEQDAOK33WtCjYLoWUl4OiVe5jCccIUW8JRMIDIk2pVQrrq/g41aA8H2sAEDlq8HsBlyOhdQXAIB6MDzAZVzGzXp2SSlFw0AYrqaU3mntwy6AsNUazWgBgOTHodoANmvA/NNgeIJjpd5bhaYhlUpRG7qUVq0AhFPmXujHBy1NTXciA8A6MhvB/CgwvwrM1yQcxzVyfaG0cEi4M4jeB83Yh1v7YRzfKWQcyfuAAJKXVvKjIO3nyXxDou8wz+L2x8w29RDMItyar4RcG+TdvACsW9dMT+1N0BhI/hnO5A29MN6DlIQVCvo2j7MSbi2D8FaHAkA4Yg19eKC6Eg2PSfRR5tMgOEYTQItAE3HrBeukFQ8AXlyIajlQhXMjJ3uN9/VihCTK0O8V6DdjkNcak8nhRQGwMZlksLIGDVQ70llEqfelMV/YJiTofFdAYE/hogoD46WiANBCvsgIDg0sQz2woRenunCaIGG75Cx8fBwa7QQCAA+OQbUSzE9HA7WJfsi8a77cWcGtGadQoxuDasBzlDqQq7cNxOTAqAcoei2wQ8Fx5uFiqp9BLPeZ8xdT+nhxBA1fTD5cOsLL6nDEvyKtJgDaWbjer03IfjSfBnDMl0P6c734vb8XxwzhQdJxaAtmQcij8wGwlJ4eozvHiXPs9xyw0iZjMIlNs8mZJb4A2HTWGKjMNM+IxNapHlYsI0xZaYQrFufSgNm2cxPDMs8wtaUl5QYokeQA0N62lpQotTWPH9STUNVtTDZX+wEwCwgxaTk87NhnrK5tlBbUuvv9pGkj5bbnthtiprDtj7PtzswCIJlMDrBAuQ/IEF6f19nMDA6lp4rUBrZjtChz+tQla5U00eIom4qfngUAQsca11IKWR3WRJksjQ9DkB6lWdhHMMMnXzshhsEAO7WN6z4E6mxdGUb7c3U60wHalo85Sj2d+MzlQYjStMAyhr9VwqxOZTlCNfaZShlC/m487iTcpGU+le8+TDxwCjHG9kt1zuT9oTASPzQMsx6X5656AAyzX1eEnaKll5yw6hrFTBCGcZ8yxNZDMwEYYp2E8qimaGlTVa7fr7KNWS8x7vZJGyOYBsIDgOt45XF4aRx6jM+pCe70qIMZrFiiUIOAx/PgTCPYqdOrslrEUcwYDxoq6aKnzYANs3jp8juZGsAFR6aQ7+KZgVH+Ji2+n9ELEi4rafJ8UQVlFtLb9uPNTABu2Ec6oSdDI2GcKh8yxicQnBZltEB0ZvLsDYHz9gcvh7XayjoyUSY4PCDoSIXtH4bXZYKwuWn95UwAOmx9KUz7ShnfXxcyig0JX1e1UO7RA6IUENLvaME9BX9ne4JKcGGxS4e0gIVyCFRjzggyh2wIQiPAyZeBLjVRk+bfINGRBcDmzetpGNq1WW8PZYH95u0gjD0IlOMbIZo8X2lD0+oBjV+bXzh8BF+fN1tSdAgtkFkd53weKK2u/YZENmhu2yXbEXfbzVmP1+6xAAuXllfhoVOYuqaE8UMoQSJejBen87TFZmhbSvUKPYGibqedy9xNktYAOK1EhbNAmyg14sqQXr7OFtuy51aXnqNw1f86hMJtd3t8U2J2Lf1nPHSKD6dUPB5hjM5mIfXnPkPuHGnNlRNk+YEPgffD9qV+j4D1Qrsg2EOo/4L6t+cEAF9yx9VBrRQf7izWhe2Lha44hHnc7kL9ovv35T7vfAb5zMULB2mDqAlRL5DIHtpbZL1RSv8Xzv0Q8N7uzzywNmj35O6H9A9AVS/HpQV2I0MWRT3ulUmiHgDR7f1E+Owey7VBglvNbnAzoklo9L+hYKSvr6DvlP5vEKxvRtYXADx8AdWnnBGA3iE7jvoN8zax2oWZbBc+XgdtyfVszi0yAGEHnSMg+BP36JogpB9IXilP/ffYzZNbwMu5ogGw4+V90EWVUl9yR2aQvH5vW3yrrUcRmdKIt4L53fneybtLzMbMmxglQp0wheibYdbo4mbeSr8d9Xe4dQxR7keF3iu4URIgnED1Lhq+ABA+p5cY5cJnVGpvmT+B+ivcOiWF3mSj3LylmL3C81GtxxwuE458lsvNfWG7bMY22SNgnp7sSdBbENyVQu+WsFu8eSqqN8BypeM43Ic3OUgmJxaVv59zvKO0+hFDgMHcH6C3wfzNIG2Uel6A62qvg8ZzCxr3EeJ6EA9JxLur5H4U4a044d8FMP4Nrv/F7Z24uy3ILvFQALAkk8lyJSS30a6Q5sTIEmiCY+L3eIDwHDJrezqhAfuUiVmugT7M5ejEAkCGNnCd/VUQT4bV8NgM6kdoW7zdpVHsNoGKez5IJwA4zClOm7UMhrbbgoz3WABgaWxsHCgTDSuZTRLcliplFZieAb6nwFAOy0xkmlNj/knNrFNjOntliA4NvjmmlW6zZww51reD8WNhwI303GADhoUj5GO45P5c97gcgKgDs+OshozOEX36KfwN8N8Bps+gPm2DGY5tOjc7ojpEGdvJUQyNCaiWCnNytC4jDB7BGURwaVpylVa6J0fB8B2oQKd7+EnrS/r+6g2lTVPP8b0n6qO0sQHQDQwyPEOYs8O1lh4S5tyw39lhLlowb/8nWD8exJkJA4Do5dPjZb3542kN+D+X/wQYANGV3Y5/SC+IAAAAAElFTkSuQmCC"}}},"ACL": {"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t$o.formgen(that.HTML);\n\t\t// Locale\n\t\tthat.Lang = that.lang;\n\t}","lang": {"en": {"APPLY": "Apply","CANCEL": "Cancel","TIP": "For groups use =roleName syntax.","PLC": "Who can edit this doc"},"ru": {"APPLY": "Применить","CANCEL": "Отмена","TIP": "Для указания групп наберите =Группа","PLC": "Кто может редактировать документ"}},"ui": {"#owners": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[],\n\t\t\t\t\tplaceholder:this.Lang.PLC\n\t\t\t\t});\n\t\t\t}","bind": "owners"},"#warn": "function () {\n\t\t\treturn this.Lang.TIP;\n\t\t}","#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t\treturn this.Lang.CANCEL;\n\t\t\t}","events": "click.my"},"#btn-apply": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t\treturn this.Lang.APPLY;\n\t\t\t}","events": "click.my"}},"HTML": ["<input id=\"owners\" type=\"text\" class=\"w250\" />","<div id=\"warn\" class=\"fs80 lh150 xgray mt7 o90\"></div>",{"rowCss": "my-row mt5"},["","but#btn-apply.w100.mr5.green",{"txt": "Apply"},"but#btn-cancel.w100.mr0",{"txt": "Cancel"}]]},"Ed": {"id": "cw.Inliner.Ed","params": {"strict": true,"restyle": 120,"historyDelay": 1000,"remember": 10},"inherit": ["CollapseItems","Att","Config","Cmd"],"RT": "function () {return this;}","EdContent": "#edcontainer","data": {"_id": "","type": "inliner","name": "","creator": "","owners": [],"meta": {},"content": [{"_stamp": "1101","type": "html","data": "<p>Write your content<br></p>"}],"stamp": "","tags": [],"style": {}},"Widgets": {},"ui": {"#title": {"bind": "function (d,v,$o) {\n      var re = /[\\n\\r\\t]+/g;\n      if (v!=null) {\n        d.name = v.replace(re,\" \").compact(); \n        return v.replace(re,\" \");\n      }\n      return d.name.replace(re,\" \");\n    }"},"#medium": {"delay": 80,"bind": "content","init": "function ($o) {\n      //\t$o.sortable();\n    }","manifest": "function (v,idx,list,$o) {\n      var that = this;\n      if (that.Cmd() == 'view') return that.Empty;\n      var spin = {\n        $Root:$o.my().root, \n        Idx:idx,\n        //Items:that.Items,\n        Insert:that.Insert,\n        Hoverpane:that.Hoverpane(),\n        Cropper:that.Cropper,\n        RT: function(){return that;}\n      };\n      return $.extend(spin, that.Items[v.type]);\n    }","list": "<div class=\"in-item\"></div>","hash": "function (item) {\n      if (item.type===\"img\") {\n        return item.data.length+cw.lib.sdbm(Object.reject(item,\"data\"))\n      }\n      else return cw.lib.sdbm(item);\n    }","id": "function (item) {\n      return item._stamp + \"|\"+(item.random||\"\");\n    }"},"#renderer": {"delay": 100,"bind": "function (d,v,$o) {\n      var that = this;\n      //console.log(v?v.to(50):'---');\n      if (v==null || $o.find('div').length) return;\n      if (that.Cmd() != 'view') {\n        $o.html('');\n        return;\n      }\n\n      var h = '',  css = '',\n          _json2css = $.my.f._s2css,\n          atts = Object.keys(d._attachments || {});\n      \n      if (!atts.length) _render(that.Att('*','session'));\n      else {\n      \tQ.allSettled(atts.map(function(fname){\n        \treturn that.Att(fname,'url');\n        }))\n        .then(function(){\n        \t_render(that.Att('*','session'));\n        })\n      }\n\n      return v;\n      \n      // - - - - -\n      \n      function _render(uu){\n        try {\n          var res = that.To.html.call(that, Object.clone(d, true), {\n            style:\t\t\ttrue, \n            Urls:\t\t\t\tuu,\n            initSync: \ttrue,\n            forceNoEdit:true,\n            forceUpgradeWidgets:true\n          });\n        }\n        catch(e){\n          console.log(e)\n        }\n\n        h = '<!-- stylesheet -->\\n<style>\\n'+res.style+'</style>\\n\\n<!-- content -->\\n'+res.html;\n\n        h+='<sc'+'ript>'+res.scripts.map(function(e){\n        \treturn e.replace(/script>/g,'s'+'\\\\u0063'+'ript>')\n        }).join('\\n\\n')+'<'+'/'+'sc'+'ript>';\n\n        var w = (window.innerWidth - 90).clamp(1024, 1920);\n\n        $o.html(h);\n      }\n    }"},"#btn-style": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\troot:that.my.parent().my.root(),\n\t\t\t\t\tmanifest:that.Themer,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tsrc:$.extend(true,{},d.style||{}),\n\t\t\t\t\t\ttheme:$.extend(true,{},that.Theme)\n\t\t\t\t\t},\n\t\t\t\t\twidth:918,\n\t\t\t\t\tbound:23,\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs80 pt15\",\n\t\t\t\t\tesc:true\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\td.style = res.dest;\n\t\t\t\t\tthat.my.root().my(\"restyle\");\n\t\t\t\t\tthat.my.root().trigger('change');\n\t\t\t\t})\n\t\t\t}\n\t\t}","css": {"self:hide": "function () {\n\t\t\t\tvar me;\n\t\t\t\tif (cw.me && (me = cw.me(null))) {\n\t\t\t\t\treturn !(me.roles||['app-admin']).find(/(^_admin|^app-admin)$/);\n\t\t\t\t}\n\t\t\t}"}},"#btn-preview": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\tvar h = '',\n\t\t\t\t\t\tcss = '',\n\t\t\t\t\t\t_json2css = $.my.f._s2css;\n        \n        var uu = that.Att('*','session');\n\n\t\t\t\ttry {\n\t\t\t\t\tvar res = that.To.html.call(that, Object.clone(d, true), {\n\t\t\t\t\t\tstyle:\t\t\t\t\t\t\ttrue, \n\t\t\t\t\t\tUrls:\t\t\t\t\t\t\t\tthat.Att('*','session'),\n\t\t\t\t\t\tinitSync: \t\t\t\t\ttrue,\n            forceNoEdit:\t\t\t\ttrue,\n\t\t\t\t\t\tforceUpgradeWidgets:true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch(e){\n\t\t\t\t\tconsole.log(e)\n\t\t\t\t}\n\n\t\t\t\th = '<!-- stylesheet -->\\n<style>\\n'+res.style+'</style>\\n\\n<!-- content -->\\n'+res.html;\n\t\t\t\t\n\t\t\t\th+='<sc'+'ript>'+res.scripts.map(function(e){\n        \treturn e.replace(/script>/g,'s'+'\\\\u0063'+'ript>')\n        }).join('\\n\\n')+'<'+'/'+'sc'+'ript>';\n        \n        var w = (window.innerWidth - 90).clamp(1024, 1920);\n\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:{\n\t\t\t\t\t\tinit: function($o){\n              $o.css({width:w+'px'}).html('<div id=\"pdoc\">'+h+'</div>');\n\t\t\t\t\t\t\t$o.css({\n                'overflow-x':'hidden', \n                'max-height':(window.innerHeight - 100)+'px',\n                'min-height':(window.innerHeight - 100)+'px'\n              });\n              that.TrackLocalLinks($o.find('#pdoc'), true);\n\t\t\t\t\t\t\t//$o.niceScroll();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tui:{\"#x\":'x'},\n\t\t\t\t\t\tdata:{x:1}\n\t\t\t\t\t},\n\t\t\t\t\twidth:w\n\t\t\t\t})\n\t\t\t\t.fail(function(res){\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t})\n\t\t\t}\n\t\t}"},"#btn-meta": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif(v!=null) {\n\n\t\t\t\tvar a = [], \n            id = Number.random(1,1e6);\n\t\t\t\tObject.keys(d.meta)\n\t\t\t\t.forEach(function(i){ \n\t\t\t\t\ta.push({id:id+\"\", key:i, value:d.meta[i]});\n\t\t\t\t\tid+=1;\n\t\t\t\t})\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.Meta,\n\t\t\t\t\tdata:{meta:a},\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs80\",\n\t\t\t\t\twidth:718,\n\t\t\t\t\tbound:23,\n\t\t\t\t\tesc:true\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\tvar a = res.meta,\n\t\t\t\t\t\t\tm = {};\n\n\t\t\t\t\ta.forEach(function(elt){\n\t\t\t\t\t\tif (elt.key != \"id\" && elt.key !=\"tags\" && elt.key != \"name\") {\n\t\t\t\t\t\t\tif (!m[elt.key]) m[elt.key] = \"\";\n\t\t\t\t\t\t\telse m[elt.key]+='\\n';\n\t\t\t\t\t\t\tm[elt.key] += elt.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\td.meta = m;\n\t\t\t\t\tthat.my.root().my(\"restyle\");\n\t\t\t\t});\n\t\t\t}\n\t\t}","events": "click.my"}},"Items": {},"style": {" #topnav, #edcontainer": "display:block;"," #renderer": "display:none;",".in-view-mode": {" #topnav, #edcontainer": "display:none;"," #renderer": "display:block;"}," #medium": "function () {\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.Theme, true), that.data.style || {}, true),\n\t\t\t\ta = [], sbody;\n\t\ta.push(\n\t\t\t'padding-left:'+s.pad.left, \n\t\t\t'padding-right:'+s.pad.right\n\t\t);\n\t\tif (s.body.bg) {\n\t\t\tif (sbody = s.body) {\n\t\t\t\tif (/^http/.test(sbody.bg)) {\n\t\t\t\t\ta.push(\n\t\t\t\t\t\t'background-image:url('+sbody.bg+')',\n\t\t\t\t\t\t'background-position:50% 50%',\n\t\t\t\t\t\t'background-size:cover'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse a.push('background-color:'+sbody.bg);\n\t\t\t}\n\t\t}\n\n\t\treturn a.join(';').replace(/[<>\"]+/g,'');\n\t}"," #medium ": "padding-top:1px;"," .redactor_box": "background:none!important;"," .cw-btn-small": "font-size: 80%;line-height: 1.1em;padding: 2px 6px 0 6px;display: none;vertical-align: top;"," .lred": "color:rgba(205,20,40,0.7)"," #append .cw-hoverpane": "opacity:0.45"," #edcontainer": "margin:0 auto 0 auto; padding:1px 0 0 0;letter-spacing:0;"," .cw-hoverpane": {"": "position:absolute; z-index:+29;display:inline-block;opacity:0;transition: opacity 0.3s, border-radius 0.1s;left:-24px;top:-20px;text-align: left;border:1px solid #A8B4C3;border-radius:20px;background:white;font-size:95%;line-height:1.2em;padding:3px 1px 3px 4px;cursor:pointer;",".cw-half": "opacity:1",".cw-half>*": "opacity:0.6",":hover": "opacity:1!important;border-radius:5px;",":hover>*": "opacity:1!important;",".hover": "opacity:1!important;border-radius:5px;",":before": "content:\" \"; width:110%;height:150%;z-index:-2; position:absolute;top:-40%;left:-10%;"," .hbtn": "function () {\n    \treturn [\n      \t'display:none;width:26px;height:26px;overflow:hidden;border-radius:1px;vertical-align:top;',\n        'cursor:pointer; margin:0 2px 0 0;',\n\t\t\t\t'background-color:transparent; transition: background-color 0.3s; background-repeat:no-repeat;',\n        'background-size:242px 26px;',\n        'background-image:url(data:image/svg+xml;base64,'+cw.lib.base64(this.SVG.Hoverpane)+');'\n      ].join('')\n    }"," .hbtn:hover": "background-color:#DBE8F3;",":hover .hbtn": "display:inline-block;",".hover .hbtn": "display:inline-block;"," .hbtn-cog": "background-position:-27px 0;"," .hbtn-html": "background-position:-54px 0;margin-right:0;"," .hbtn-img": "background-position:-81px 0;"," .hbtn-embed": "background-position:-108px 0;"," .hbtn-widget": "background-position:-135px 0;"," .hbtn-copy": "background-position:-162px 0;"," .hbtn-paste": "background-position:-189px 0;"," .hbtn-del": "background-position:-216px 0;"," .hbtn-plus": "display:inline-block!important;background-position:0 0;cursor:default;margin:0 1px 0 0;"," .hbtn-plus:hover": "background-color:transparent;",":hover .hbtn-plus": "margin-right:-1px;",".hover .hbtn-plus": "margin-right:-1px;"}," .floater-hotspot": " position:absolute; top:-3px;height:1.3em;z-index:+10"," .in-item": "function () {\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.Theme, true), that.data.style || {}, true),\n\t\t\t\ttypes = {},\n\t\t\t\ti, j, r;\n\t\t\n\t\t(that.data.content||[]).forEach(function(e){\n\t\t\ttypes[e.type]=true;\n\t\t});\n\t\t\n\t\tr = {\n\t\t\t'div,p,ul,ol,li,table,dl,blockquote,td':'font-family:'+_font(s.font.main)+';', \n\t\t\t'h1,h2,h3,h4,h5,h6': 'font-family:'+_font(s.font.header)+';',\n\t\t\t'pre,code':'font-family:'+_font(s.font.fixed)+';',\n\t\t\t\n\t\t\t'.in-accented':{\n\t\t\t\t'h1,h2,h3,h4,h5,h6,div,p,ul,ol,li,table,dl,blockquote,td':'font-family:'+_font(s.font.accent)+';',\n\t\t\t},\n\t\t\t' .redactor_box':'background:none!important;border:none!important;',\n\t\t\t' .hide':'display:none!important;'\n\t\t};\n\t\t\n\t\tObject.keys(s.themes)\n\t\t.forEach(function(i){\n\t\t\tif (!r['.in-'+i+' .in-ct']) r['.in-'+i+' .in-ct'] = s.themes[i];\n\t\t});\n\t\t\n\t\tr[' .redactor_editor'] = _ext({\n\t\t\t'': 'word-wrap: break-word; border:none;padding:0; background:none!important;'+s.text.normal,\n\t\t\t' td>:first-child':'margin-top:0!important;',\n\t\t\t' td>:last-child':'margin-bottom:0!important;',\n\t\t}, s.tags||{}, true);\n\t\t\n\t\t/*r[' '] = _ext({\n\t\t\t'': s.text.normal\n\t\t}, s.tags||{}, true);*/\n\t\t\n\t\tr['.in-small .redactor_editor'] = s.text.small;\n\t\tr['.in-large .redactor_editor'] = s.text.large;\n\t\t\n\t\tr['.in-item-max:first-child .in-ct'] ='margin-top:0!important;';\n\t\t\n\t\tr[' .in--x-fader'] = 'display:none;';\n\t\t\n\t\tr['.in-darken'] = {\n\t\t\t' .redactor_editor':{\n\t\t\t\t' h1,h2,h3,h4,h5,h6,div,p,ul,ol,li,table,dl,blockquote,td':'color:white!important;',\n\t\t\t\t' a':'color:rgba(255,255,255,0.8)!important;text-decoration:none!important;'\n\t\t\t\t\t+'border-bottom:1px solid rgba(255,255,255,0.5)!important;'\n\t\t\t\t\t+'transition:color 0.3s, border 0.3s;',\n\t\t\t\t' a:hover':'color:rgba(255,255,255,1)!important;border-bottom:1px solid rgba(255,255,255,0.8)!important;'\n\t\t\t},\n\t\t\t' .in--x-fader':'display:block; height:100%; width:100%; position:absolute; top:0; left:0; z-index:2;'\n\t\t\t\t+'background-image: -moz-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: -webkit-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: -o-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: -ms-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));',\n\t\t}\n\t\t\n\t\tr[':last-child'] = 'margin-bottom:0px!important;'\n    \n    // - - - - - - - - - - - - - - - - -\n    \n    r['.in-z1'] = {'':'z-index:+1!important;'}\n    r['.in-z2'] = {'':'z-index:+2!important;'}\n    r['.in-z3'] = {'':'z-index:+3!important;'}\n    r['.in-z5'] = {'':'z-index:+5!important;'}\n    r['.in-z10'] = {'':'z-index:+10!important;'}\n    r['.in-z20'] = {'':'z-index:+20!important;'}\n    \n    // - - - - - - - - - - - - - - - - -\n    \n    var mobileshrink = 'min-width: 100%!important; width: 100%!important; float: none!important;',\n        mobilemargin = 'margin-left: 0!important;';\n    \n    r['@media screen and (max-width: 480px)'] = {\n      '.in-item-tiny-right .in-ct':\t\tmobileshrink,\n      '.in-item-small-right .in-ct':\tmobileshrink,\n      '.in-item-small .in-ct':\t\t\t\tmobileshrink,\n      '.in-item-tiny .in-ct':\t\t\t\t\tmobileshrink,\n      \n      '.in-item-tiny-right .in-ct ':\tmobilemargin,\n      '.in-item-small-right .in-ct ':\tmobilemargin\n    }\n\t\t\n    // - - - - - - - - - - - - - - - - -\n    \n\t\tfor (i in that.Items) {\n\t\t\tif (\n\t\t\t\tthat.Items.hasOwnProperty(i) \n\t\t\t\t&& types[i]\n\t\t\t\t&& (\n\t\t\t\t\tj = that.IStyle[\".in--\"+i] \n\t\t\t\t\t|| (that.Items[i].style || {})[\".in--\"+i]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif (typeof j == \"function\") {\n\t\t\t\t\tr[\".in--\"+i] = j;\n\t\t\t\t\tthat.Items[i].style[\".in--\"+i] = \"\";\n\t\t\t\t\tif (!that.IStyle[\".in--\"+i]) that.IStyle[\".in--\"+i] = j;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn r;\n\t\t\n\t\t//--------\n\t\t\n\t\tfunction _font(a) {\n\t\t\tvar s=[];\n\t\t\t(a||[]).forEach(function(e){\n\t\t\t\tif (/\\s/.test(e)) s.push(\"'\"+e+\"'\");\n\t\t\t\telse s.push(e);\n\t\t\t});\n\t\t\treturn s.length?s.join(\",\"):\"inherit\";\n\t\t}\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t}"},"IStyle": {},"lang": {"en": {"CLIP_STASHED": "Doc clip succesfully copied to internal clipboard","CLIP_NOCLIP": "No clip to paste","META_PLC": "Doc meta","PREVIEW_PLC": "Preview","CSS_PLC": "Stylesheet","UNDO_PLC": "Undo","NAME_PLC": "Doc title…","HOVERPANE": {"html": {"css": "hbtn-html","title": "Insert text block"},"img": {"css": "hbtn-img","title": "Add image"},"embed": {"css": "hbtn-embed","title": "Add video or other embed"},"widget": {"css": "hbtn-widget","title": "Add widget"},"_opts": {"css": "hbtn-cog","title": "Below block settings"},"_copy": {"css": "hbtn-copy","title": "Copy block"},"_paste": {"css": "hbtn-paste","title": "Paste block"},"_del": {"css": "hbtn-del","title": "Delete block"}}},"ru": {"CLIP_STASHED": "Блок скопирован в буфер","CLIP_NOCLIP": "Нет фрагмента для вставки","META_PLC": "Метаданные документа","PREVIEW_PLC": "Просмотр","CSS_PLC": "Стили документа","UNDO_PLC": "Отменить","NAME_PLC": "Имя документа…","HOVERPANE": {"html": {"css": "hbtn-html","title": "Вставить блок текста"},"img": {"css": "hbtn-img","title": "Вставить изображение"},"embed": {"css": "hbtn-embed","title": "Вставить видео или фрейм"},"widget": {"css": "hbtn-widget","title": "Вставить виджет"},"_opts": {"css": "hbtn-cog","title": "Настройки блока"},"_copy": {"css": "hbtn-copy","title": "Скопировать блок в буфер"},"_paste": {"css": "hbtn-paste","title": "Вставить блок из буфера"},"_del": {"css": "hbtn-del","title": "Удалить блок"}}}},"Theme": {"body": {"min": "750px","max": "950px"},"font": {"header": ["-apple-system","BlinkMacSystemFont","Helvetica Neue","Segoe UI","Roboto","Helvetica","Tahoma","Arial","Verdana","Sans-serif"],"main": ["-apple-system","BlinkMacSystemFont","Helvetica Neue","Segoe UI","Roboto","Helvetica","Tahoma","Arial","Verdana","Sans-serif"],"accent": ["Georgia","Times","serif"],"fixed": ["Cousine","PT Mono","Monaco","Lucide Console","monospace"]},"text": {"min": "400px","max": "750px","normal": "font-size:13pt; color:#333; font-weight:400;","small": "font-size:11pt; color:#444; font-weight:400;","large": "font-size:18pt; color:#555; font-weight:200;"},"themes": {"background": "background-color:rgb(239, 243, 247);","frame": "border:1px solid #ddd;","rules": "border-top:1px solid #ddd; border-bottom:1px solid #ddd;"},"tags": {"p": "font-size:1em; line-height:1.6em; margin:0.2em 0 0.8em 0; color:inherit; font-weight:inherit;","a": "color: #2a70a6;","h1": "font-size:2.7em; line-height:0.95em; margin:0.5em 0 0.4em 0; color:inherit; font-weight:600;","h2": "font-size:1.9em; line-height:1em; margin:0.5em 0 0.4em 0; color:inherit; font-weight:600;","h3": "font-size:1.5em; line-height:1.2em; margin:0.5em 0 0.4em 0; color:inherit; font-weight:600;","h4": "font-size:1.2em; line-height:1.2em; margin:0.5em 0 0.4em 0;color:inherit; font-weight:600;","blockquote": "font-size:1.2em; line-height:1.3em; margin: 1em 1em 1em 2em;color:inherit; font-weight:inherit; font-style:italic;","ul,ol": "padding-left:2em;margin:0.2em 0 0.8em 0;","ul>ul,ol>ul,ol>ol": "margin:0.2em 0;","li": "margin-left:1em;","code": "background-color:rgb(229, 233, 235); border-radius:2px; font-size:85%; padding:0.15em 0.3em;","table": "max-width:100%; display:table; border-collapse:collapse; margin:1em 0;","td": "max-width:50%;min-width:2em;line-height:1.3em;border:1px solid #ddd; vertical-align:top; padding:0.2em 0.4em;"},"pad": {"inset": "0.6em","gap": "1.2em","left": "25px","right": "25px"},"aside": {"small": "450px","tiny": "250px"},"corner": {"outer": "4px","inner": "1px"}},"init": "function ($o,form) {\n\t\n\tvar that = this, \n\t\t\ti, old,\n\t\t\td = form.data,\n\t\t\tnow = Date.now(),\n\t\t\tlang = 'en';\n\t\n\t// Locale\n\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t// that.Lang = that.Lang[lang];\n\tthat.Lang = that.lang;\n  \n\t// Prepare doc\n\tif (form.data.title) delete form.data.title;\n\t\n\tfor (i=0;i<d.content.length;i++) {\n\t\tif (!d.content[i]._stamp || d.content[i]._stamp=='1101') {\n\t\t\td.content[i]._stamp = cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6));\n\t\t}\n\t\tif (d.content[i]._new) delete d.content[i]._new;\n\t\t\n\t\t// translate type:code to widget:in.Code\n\t\tif (d.content[i].type=='code') {\t\n\t\t\told = d.content[i];\n\t\t\td.content[i] = {\n\t\t\t\t_stamp:old._stamp, type:'widget', js:'('+cw.lib.js2txt(that.Widgets.Code)+')', html:\"\",\n\t\t\t\tdata:'('+JSON.stringify({ type:\"inliner-codesample\", tab:old.tab, js:old.js, html:old.html, css:old.css})+')',\n\t\t\t\tstate:\"running\", tab:[\"data\"], options:[\"noedit\",\"reflect\",\"autoupdate\"],\n\t\t\t\tvalid:true, err:[], source:\"Code\", format:\"left500\", css:[], bg:''\n\t\t\t};\n\t\t}\n\t}\n\t\n\t// Remove previews for non-existing attaches\n\t\n\tif (d.previews) Object.keys(d.previews).forEach(function(i){\n\t\tif (!(d._attachments||{})[i]) delete d.previews[i];\n\t});\n\t\n\t// Build DOM\n\t$o.formgen('init', that.HTML.assign(that.Lang));\n  \n  // View mode\n  if (!that.Cmd) that.Cmd = function(){return 'view'};\n  if (that.Cmd() == 'view') {\n  \t$o.addClass('in-view-mode');\n  }\n\n  // Hoverpane container\n\tif (!$o.find(\"#hoverpane:eq(0)\").size()) {\n\t\t$($(that.Hoverpane()).attr(\"id\",\"hoverpane\")[0].outerHTML)\n\t\t.prependTo($o);\n\t}\n\t\n\t// Build Hoverpane sceleton\n\tvar $ho=$o.find(\"#hoverpane:eq(0)\"),\n\t\t\t$me = $o.find(\"#medium\"),\n\t\t\thh = $ho.height(),\n\t\t\tdx = $o.offset().left,\n\t\t\tdy = $o.offset().top;\n\t\n\t// ---------------------------\n\t\n\tthat.Insert = that.Insert($o);\n\t\n\t// ---------------------------\n\t\n\t// Update widgets code\n\tthat.UpdateWidgets(d);\n\t\n\t// ---------------------------\n\n\t// Hoverpane actions\n\tthat.Actions($o, form);\n\t\n\t// ---------------------------\n  \n  // Click-open links to local docs\n  that.TrackLocalLinks($o.find(that.EdContent), true);\n  that.TrackLocalLinks($o.find('#renderer'), true);\n  \n  // ---------------------------\n\n\t// Hoverpane tracker\n\t$me.on(\n\t\t\"mousemove.my\", \n\t\tObject.values(that.Items)\n\t\t.map(function(e){return e.Hoverpane})\n\t\t.compact()\n\t\t.join(\", \"), \n\t\tfunction (evt) {\n\t\t\tvar dx = $o.offset().left,\n\t\t\t\t\tdy = $o.offset().top,\n\t\t\t\t\tscy = $o.scrollTop(),\n\t\t\t\t\t$x = $(this), \n\t\t\t\t\tofs = $x.offset(), \n\t\t\t\t\th=$x.height(),\n\t\t\t\t\tex = evt.clientX, \n\t\t\t\t\tey = evt.clientY,\n\t\t\t\t\tx = ofs.left,\n\t\t\t\t\ty = ofs.top, \n\t\t\t\t\tafter=false, \n\t\t\t\t\tfulltop=0, \n\t\t\t\t\t$form, type, ohtml=\"\", fhtml=\"\", showDel = true;\n\t\t\t\n\t\t\thh = $ho.height();\n\t\t\t//correct pos if we inside Redactor, that has floating content\n\t\t\tif ($x.is(\".redactor_box *\")) {\n\t\t\t\t//insert and del small shim\n\t\t\t\tvar $i=$('<b>\\u200b</b>').prependTo($x);\n\t\t\t\tx=$i.offset().left;\n\t\t\t\t$i.remove();\n\t\t\t}\n\n\t\t\tfulltop = y-dy-hh+scy-2; \n\t\t\tif ($ho.data(\"hoverpane\") && $ho.data(\"hoverpane\").top && Math.abs($ho.data(\"hoverpane\").top-fulltop)<3) \n\t\t\t\tfulltop = $ho.data(\"hoverpane\").top;\n\n\t\t\t$ho.css({top:(fulltop | 0)+\"px\", left:(x-dx-23)+\"px\"});\n\n\t\t\t$ho.toggleClass(\"cw-half\", (ex-x<100 /*&& Math.abs(y+h/2-ey+scy)-h/2<40*/));\n\n\t\t\t$form = $x.parents(\".my-form:eq(0)\");\n\t\t\ttype = $form.my(\"data\").type;\n\t\t\t\n\t\t\t\t\t\t\n\t\t\tvar prev = d.content[$form.data(\"formlist\").index-1],\n\t\t\t\t\tcurr = $form.my(\"data\"),\n\t\t\t\t\thide = {};\n\n\t\t\tif (type==\"html\") {\n\t\t\t\tohtml=$x[0].outerHTML;\n\t\t\t\tfhtml=curr.data;\n\t\t\t\t// Allow del for empty and non-last html items\n\t\t\t\tshowDel = !!(\n\t\t\t\t\t\n\t\t\t\t\tthat.data.content.last() !== curr\n\t\t\t\t\t&& (\n\t\t\t\t\t\t(fhtml===ohtml && ohtml.stripTags()===\"\")\n\t\t\t\t\t\t|| (curr.css||[]).length\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\tif (curr.type == \"html\" && !(curr.css||[]).length) hide.html = true;\n\t\t\tif (curr.type != \"html\") {\n\t\t\t\tif (prev && prev.type==\"html\" && !(prev.css||[]).length) hide.html = true;\n\t\t\t}\n\n\t\t\t$ho.html($(that.Hoverpane(type, showDel, hide)).html());\n\n\t\t\tif (type===\"html\") {\n\t\t\t\t$ho.data(\"hoverpane\",{\n\t\t\t\t\tform:$form, \n\t\t\t\t\tp:\" \", \n\t\t\t\t\tafter:after, \n\t\t\t\t\ttop:fulltop, \n\t\t\t\t\tval:$x,\n\t\t\t\t\tprev:prev\n\t\t\t\t});\n\t\t\t}\n\t\t\telse $ho.data(\"hoverpane\",{\n\t\t\t\tform:$form, \n\t\t\t\tafter:after, \n\t\t\t\ttop:fulltop\n\t\t\t});\t\t\n\n\t\t}.debounce(50)\n\t);\n}","TrackLocalLinks": "function ($container,suppress) {\n  \n  // Set up tracking of <a> link clicks for $container,\n  // cancels link open if doc exists locally\n  // and can be opened; then opens doc\n  \n  // Links hooked should have href=\"./local_id\", where local_id\n  // is valid uuid (cw.uuid.test(local_id)=>true)\n  \n\tvar that = this;\n  $container.on('click.my','a', function(evt){\n    // console.log(evt)\n    var url = $(evt.currentTarget || evt.target).attr('href')+'',\n        $t;\n    if (suppress && url[0]=='#') {\n      $t = $container.find(url);\n    \tif ($t.length) {\n        evt.preventDefault();\n        $container.parent().animate({\n          scrollTop: $t.offset().top + $container.parent()[0].scrollTop - 50\n        }, 200);\n    \t}\n      return;\n    }\n    if (!/^\\.\\/.+$/.test(url)) return;\n    var au = url.from(2).split('#'),\n        id = au[0];\n    if (!cw.uuid || !cw.uuid.test(id)) return;\n    \n    evt.preventDefault();\n    \n    // Seems local doc, try to retrieve its type\n    that.db.query('DB-Shell/info',{keys:[id]})\n    .then(function(res){\n    \tif (!res.rows || ! res.rows.length) return;\n      var doc = res.rows[0].value,\n          t = doc.type;\n      var opt = that.db.actions(t),\n          app = '',\n          act = '';\n      \n      if (!Object.size(opt)) return;\n      \n      ['view','edit'].forEach(function(i){\n        if (app || !Object.isArray(opt[i]) || !opt[i].length) return;\n        app = opt[i][0].replace(/^cw\\./, '');\n        act = i;\n      });\n      \n      if (!app) return;\n      \n      var path = [that.db.name, app, cw.lib.tourl64([act, id])].join('/');\n      cw.state.set(path);  \n    })\n    .fail(function(){\n    \t// Do nothing\n    });\n  });\n}","CouchQS": "function _inliner2obj(doc0,opts) {\n  \n  /* \tRenders Inliner doc (type:'inliner') with opts.\n  \t\tOpts {\n      \t_id\t\t\t\t\t\t\t\t\t// Doc _id replacement, optional\n        _db\t\t\t\t\t\t\t\t\t// Doc _db replacement, optional\n        project\t\t\t\t\t\t\t// Project name\n        base\t\t\t\t\t\t\t\t// Site base \n        mobile\t\t\t\t\t\t\t// Obj with doc.style extensions/replacements for mobiles\n        tx\t\t\t\t\t\t\t\t\t// {'Step1':2, 'Step3':5}, duration of steps, initial value\n        t0\t\t\t\t\t\t\t\t\t// Previous timestamp, int\n        \t\t\t\t\n        header\t\t\t\t\t\t\t// Header, should be Inliner content item\n        footer\t\t\t\t\t\t\t// Footer, should be Inliner content item\n        \t\t\t\t\n        renderStyle\t\t\t\t\t// Render stylesheets, true\n\t\t\t\timportant\t\t\t\t\t\t// Add !important to widgets styleshhets, true\n\t\t\t\tinitSync \t\t\t\t\t\t// Start widgets in sync, false\t\n\t\t\t\tforceNoEdit\t\t\t\t\t// Always disable widget editors, true\n\t\t\t\tupgradeWidgets \t\t\t// Force using pre-built versions of known widgets, false\n        upgradeStyle\t\t\t\t// Force style uprade if .meta.template key is in Themes\n\t\t\t\tpath\t\t\t\t\t\t\t\t// path template for attaches, like '/file/{_db}/{_id}/'\n        \n        Inliner\t\t\t\t\t\t\t// Inliner app object\n        Themes\t\t\t\t\t\t\t// Themes object\n      }\n  \n  \t \tReturns {\n        project\t\t\t// HTML-escaped project name from opts.project\n        title\t\t\t\t// HTML-escaped page title, from .meta.pagetitle or .name\n        description\t// Escaped desc, from .meta.description or .name\n        _id\t\t\t\t\t// doc _id\n        hid\t\t\t\t\t// Last 8 chars of doc _id\n        bodyStyle:\t// ''\n        style\t\t\t\t// String of CSS rules to display page\n        scripts\t\t\t// String with scripts, required to run before HTML\n        html\t\t\t\t// HTML\n        docmeta\t\t\t// JSON string with doc.meta\n        tx\t\t\t\t\t// {op_name:1, op_name1:12,...} duration of steps in ms\n      }\n\t*/\n\t\n\tvar _clone = Object.clone,\n\t\t\tdoc = _clone(doc0, true),\n      id  = doc._id,\n      hid = id.substr(-8),\n\t\t\ttx  = _clone(opts.tx || {}, true),\n\t\t\tt0  = opts.t0 || Date.now(),\n\t\t\tmobile = !!opts.mobile,\n      html, \n      menu,\n      res;\n  \n  _tx('Render start'); \n  \n  \n  // ###### Prepare Inliner instance ######\n\n  var Inliner = opts.Inliner || require('lib/Inliner').Inliner,\n      Themes \t= opts.Themes  || require('lib/Themes').Themes,\n      ed \t\t\t= _clone(Inliner.Ed, true),\n      style = Object.merge(\n        _clone(ed.Theme, true), \n        (doc.meta.template && Themes[doc.meta.template] ? Themes[doc.meta.template] : doc.style), \n        true\n      );\n  \n  // Add RT() to Inliner.Ed items, fake $.my environment\n  Object.keys(ed.Items).forEach(function(i){\n\t\ted.Items[i].RT = function(){return ed};\n\t});\n\n\t// Override style, meta.base and _id/_db\n  Object.merge(doc, {\n    _id:\t\t\topts._id || hid,\n    _db:\t\t\topts._db || doc._db,\n  \tstyle:\t\topts.upgradeStyle === undefined || opts.upgradeStyle ? style : doc.style,\n    meta:{\n      _mobile:mobile,\n    \tbase:\t\topts.base\n    }\n  }, true);\n\n\t// Override style for mobile\n\tif (mobile && Object.isObject(opts.mobile)) {\n\t\tObject.merge(doc.style, mobile, true);\n\t}\n\n\t// Remove empty html block at the end, if any\n\tvar last = doc.content.slice(0).last();\n\tif (\n    last \n    && last.type == 'html' \n    && last.data.length <50 \n    && !last.data.stripTags().compact()\n  ) doc.content.pop();\n\n\t// Add header / footer widgets\n  if (opts.header && opts.header.type=='widget') doc.content.unshift(_clone(opts.header, true));\n\tif (opts.footer && opts.footer.type=='widget') doc.content.push(_clone(opts.footer, true));\n  \n  // Bind doc to Inliner instance\n  ed.data = doc;\n  \n  _tx('Render prepared');\n  \n\n\t// ###### Render article #######\n\n\t// Remove content blocks unsuitable for mobiles,\n  // also re-order asides for mobiles\n\tif (mobile) { \n\t\tdoc.content = doc.content.filter(function(e){\n      var css = e.css||[];\n      return css.indexOf('Nomobile') == -1 && css.indexOf('NoMobile') == -1;\n    })\n    .map(function(e,i){\n      var css = e.css||[],\n          isDrop = css.find('InlineAfter');\n      e._idx = ('0000'+(isDrop?(i*2+3):(i*2)).toString(36)).substr(-4);\n      return e;\n    })\n    .sort(function(a,b){\n    \treturn a._idx>b._idx?1:a._idx<b._idx?-1:0;\n    });\n\t}\n\n  // Call renderer\n\tres = ed.To.html.call(ed, doc, {\n\t\tstyle:\t\t\t\t\t\t\t\topts.renderStyle!= undefined ? !!opts.renderStyle : true,\n\t\timportant:\t\t\t\t\t\topts.important !== undefined ? !!opts.important : true,\n\t\tinitSync: \t\t\t\t\t\t!!opts.initSync,\n\t\tforceNoEdit:\t\t\t\t\topts.forceNoEdit !== undefined ? !!opts.forceNoEdit : true,\n\t\tforceUpgradeWidgets:\t!!opts.upgradeWidgets,\n\t\tpath:\t\t\t\t\t\t\t\t\t((opts.path || '/file/{_id}/')+'').assign(doc)\n\t});\n\n\t// Add script to run chain if chainable run\n\tif (!opts.initSync) {\n\t\tres.scripts.push([\n\t\t\t'$(function(){var c = $.my.chain;',\n\t\t\t'c(Inliner.ScrollToHash\t\t\t,10\t\t,10);',\n\t\t\t'c(Inliner.Parallax.fill(!0),1000\t,500);',\n\t\t\t'c(Inliner.Parallax.fill(!0),10  \t,500);',\n\t\t\t'c(Inliner.ScrollToHash\t\t\t,10\t\t,10);',\n\t\t\t'c.start();});'\n\t\t].join('\\n'));\n\t}\n  \n  _tx('Render done');\n  \n  // Store stamps to opts for chaining metrics\n  if (opts.tx) opts.tx = tx;\n  if (opts.t0) opts.t0 = Date.now();\n\t\n\treturn {\n\t\tproject:\t\t\t((opts.project || 'Inliner')+'').escapeHTML(),\n\t\ttitle: \t\t\t\t(((doc.meta ? doc.meta.pagetitle:'') || doc.name) + '').escapeHTML(),\n\t\tdescription: \t(((doc.meta ? doc.meta.description || doc.meta.pagetitle || '':'') || doc.name) + '').escapeHTML(),\n    _id:\t\t\t\t\tid,\n\t\thid:\t\t\t\t\thid,\n\t\tbodyStyle:\t\t'',\n\t\tstyle:\t\t\t\tres.style,\n\t\thtml:\t\t\t\t\tres.html,\n\t\tscripts:\t\t\t(res.scripts || []).join('\\n\\n'),\n\t\tdocmeta:\t\t\tJSON.stringify(doc.meta),\n    tx:\t\t\t\t\t\ttx\n\t}\n\n  // - - - - - \n  \n  function _tx(step) {\n  \ttx[step] = Date.now() - t0;\n    t0 = Date.now();\n  }\n}","HTML": "<section id=\"renderer\" class=\"w100p\"></section>\n<div id=\"topnav\" class=\"cb bbs pb10 w100p\" >\n\t<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n\t\t<tr>\n\t\t\t<td width=\"1%\" ><nobr>\n\t\t\t\t<button id=\"btn-meta\" class=\"btn w40 mt0 vat fs90 mr2 btn-l\" title=\"{META_PLC}\">\n\t\t\t\t\t<span class=\"fi-pricetag-multiple\"></span>\n\t\t\t\t</button>\n        \n        <button id=\"btn-style\" class=\"btn w40 mt0 vat fs90 btn-c mr2\" title=\"{CSS_PLC}\">\n\t\t\t\t\t<span class=\"fi-css3\"></span>\n\t\t\t\t</button>\n\n\t\t\t\t<button id=\"btn-preview\" class=\"nocwmin btn w40 mt0 vat fs90 mr10 btn-r\" title=\"{PREVIEW_PLC}\">\n\t\t\t\t\t<span class=\"fi-eye\"></span>\n\t\t\t\t</button>\n\n\t\t\t\t<!--<button id=\"btn-undo\" class=\"btn w40 mt0 mr10 vat fs90 btn-r\" title=\"{UNDO_PLC}\">\n\t\t\t\t\t<span class=\"fi-rewind\"></span>\n\t\t\t\t</button>-->\n\t\t\t\t\n\t\t\t\t</nobr></td>\n\t\t\t\n\t\t\t<td>\n\t\t\t\t<input type=\"text\" id=\"title\" rows=1 class=\"gray lh120 w100p\" \n\t\t\t\t\t\tstyle=\"font-size:1.4em;border:none;padding:0;margin:2px 0 0 0;box-shadow:none;color:#333;min-height:0;resize:none;\" \n\t\t\t\t\t\tplaceholder=\"{NAME_PLC}\">\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n</div>\n<div id=\"edcontainer\" style=\"\">\n\t<div id=\"medium\" class=\"cb\" ></div>\n</div>","Empty": {"init": "function ($o) {$o.html('<div class=\"hide\"></div>')}","ui": {"div.hide": {"bind": "function () {return '';}"}},"data": {}},"Themer": {"data": {"src": {},"dest": {},"theme": {}},"Code": "","init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\tlang = 'en';\n\t\n\t\t// Locale\n\t\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\tthat.Code = '('+JSON.stringify(d.src,null,'  ')+')';\n\t\t$o.html( $.my.formgen(that.HTML).assign(L) );\n\t}","lang": {"en": {"TITLE": "Doc style settings","ERR_PARAMS": "Invalid params","APPLY": "Apply","CLOSE": "Close","DEFAULTS": "Extend with defaults"},"ru": {"TITLE": "Стиль документа","ERR_PARAMS": "Неверные параметры","APPLY": "Применить","CLOSE": "Закрыть","DEFAULTS": "Добавить настройки по умолчанию"}},"ui": {"#tjson": {"bind": "this.Code","init": "function ($o) {\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: 'javascript',\n\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t//lineWrapping:true,\n\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\tindentUnit:2,\n\t\t\t\t\ttabSize:2,\n\t\t\t\t\ttheme: \"default\"\n\t\t\t\t});\n\t\t\t}","check": "function (d,v) {\n\t\t\t\tvar j;\n\t\t\t\ttry {\n\t\t\t\t\tj = eval('('+v+')');\n\t\t\t\t} catch(e){}\n\t\t\t\tif (Object.isObject(j)) {\n\t\t\t\t\td.dest = j;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.Lang.ERR_PARAMS;\n\t\t\t}"},"#btn-apply": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null && this.my.valid()) {\n\t\t\t\t\tvar fl = {\n\t\t\t\t\t\tbody:{},\n\t\t\t\t\t\tfont:{},\n\t\t\t\t\t\ttext:{},\n\t\t\t\t\t\ttags:{},\n\t\t\t\t\t\taside:{},\n\t\t\t\t\t\tthemes:{},\n\t\t\t\t\t\tpad:{},\n\t\t\t\t\t\tcorner:{}\n\t\t\t\t\t}\n\t\t\t\t\td.dest = Object.select(d.dest,Object.keys(fl));\n\t\t\t\t\tthis.my.commit();\n\t\t\t\t}\n\t\t\t}","css": {":disabled": "function () {return !this.my.valid();}"},"watch": "#tjson"},"#btn-close": "function (d,v) {\n\t\t\tif (v!=null) this.my.cancel();\n\t\t}","#btn-defaults": {"bind": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null)  that.Code = '('+JSON.stringify($.extend(true, {}, d.dest, d.theme), null,'  ')+')';\n\t\t\t}","recalc": "#tjson"}},"HTML": ["<div class=\"fs150 mb10 mt-1 blue-1\">{TITLE}</div>","<div class=\"jcont w100p dib vat\"><textarea id=\"tjson\"></textarea></div>","<div class=\"pt15\">","<button id=\"btn-defaults\" class=\"fr orange mr0\">{DEFAULTS}</button>","<button id=\"btn-apply\" class=\"green w150 mr4\">{APPLY}</button>","<button id=\"btn-close\" class=\"w150\">{CLOSE}</button>","</div>"],"style": {" .CodeMirror": "height:400px!important; width:918px; font-size:12px;border:1px solid #ddd; border-radius:2px;"," .my-error .CodeMirror": "border-color:rgb(255,120,120);"}},"Meta": {"id": "cw.Inliner.Ed.Meta","data": {"meta": []},"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\tlang = 'en';\n\t\n\t\t// Locale\n\t\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\t$o.formgen([\n\t\t\t'<div class=\"fs150 mb10 mt-1 blue-1\">'+L.TITLE+'</div>',\n\t\t\t'<div id=\"metas\"></div>',\n\t\t\t'<div class=\"bbs mt5 pb10 mb15 hoverlink blue\">',\n\t\t\t\t'<span class=\"fi-plus fs80 o80\"></span> ',\n\t\t\t\t'<span class=\"pseudolink\" id=\"btn-addmeta\">'+L.ADD+'</span>',\n\t\t\t'</div>',\n\t\t\t{rowCss:\"my-row\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w100.mr5.green',{txt:L.SAVE},\n\t\t\t 'but#btn-cancel.w100',{txt:L.CANCEL}\n\t\t\t]\n\t\t]);\n\t}","ui": {"#metas": {"bind": "meta","manifest": "this.Prop","list": "<div class=\"mb6\"></div>","check": true,"id": ["id"]},"#btn-addmeta": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null){\n\t\t\t\t\t$o.my(\"find\",\"#metas\").trigger(\"insert\",{\n\t\t\t\t\t\twhat:$.extend(!0,{},that.Prop.data, {id:Number.random(0,1e6)+\"\"}),\n\t\t\t\t\t\twhere:1e6\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}","events": "click.my"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}","events": "click.my"},"#btn-apply": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null && this.my.valid()) {\n\t\t\t\t\tvar a = d.meta.reduce(function(a,b){\n\t\t\t\t\t\tif (b.key) a.push(b);\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t},[]);\n\t\t\t\t\td.meta = a;\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {":disabled": "function () {return !this.my.valid()}"},"watch": "#metas"}},"Prop": {"data": {"id": "","key": "","value": ""},"inherit": ["Lang"],"init": "function ($o) {\n\t\t\tvar that = this;\n\t\t\t$o.html([\n\t\t\t\t'<span>',\n\t\t\t\t\t'<input type=\"text\" id=\"mkey\" class=\"w200 bold mr8 dib vat\" placeholder=\"{KEY_PLC}\"/>',\n\t\t\t\t'</span>',\n\t\t\t\t'<span>',\n\t\t\t\t\t'<textarea id=\"mval\" class=\"w510 dib fs100 vat\" rows=1 placeholder=\"{VAL_PLC}\" spellcheck=\"false\"></textarea>',\n\t\t\t\t'</span>'\n\t\t\t].join('').assign(that.Lang));\n\t\t}","ui": {"#mkey": {"bind": "key","check": "function (d,v) {\n\t\t\t\t\tif (!/^(|[a-z0-9]+)$/i.test(v)) return this.Lang.ERR_LATINS;\n\t\t\t\t\telse if (v==\"id\" || v==\"tags\" || v==\"name\" || v==\"title\") return this.Lang.ERR_RESERVED;\n\t\t\t\t}"},"#mval": {"bind": "function (d,v,$o) {\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\td.value = v;\n\t\t\t\t\t\t$o.height(0).height($o[0].scrollHeight - 11);\n\t\t\t\t\t}\n\t\t\t\t\treturn d.value;\n\t\t\t\t}","css": {"self:tdl": "function (d) {return d.value && !d.key}","self:lgray": "function (d) {return d.value && !d.key}"},"watch": "#mkey"}}},"style": {"textarea": "min-height:32px;"," .w510": "width:510px"},"lang": {"en": {"TITLE": "Doc meta","ADD": "Add property","SAVE": "Save","CANCEL": "Cancel","ERR_LATINS": "Latins and nums","ERR_RESERVED": "Reserved property name","KEY_PLC": "key","VAL_PLC": "value"},"ru": {"TITLE": "Метаданные документа","ADD": "Добавить ключ","SAVE": "Сохранить","CANCEL": "Закрыть","ERR_LATINS": "Только латиница и цифры","ERR_RESERVED": "Зарезервированный ключ","KEY_PLC": "ключ","VAL_PLC": "значение"}}},"To": {"html": "function (doc,options) {\n  \n  var isO = Object.isObject,\n\t\t\tisF = Object.isFunction,\n\t\t\tisA = Object.isArray,\n\t\t\tisS = Object.isString,\n\t\t\tKeys = Object.keys;\n  \n\tvar that = this,\n\t\t\td = doc,\n\t\t\th = '',\n\t\t\tid = 'x'+Number.random(1e6, 1e7-1)+'',\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:\t\t\t\t\t\t\t\ttrue,\n\t\t\t\tpath:'',\n\t\t\t\timportant:\t\t\t\t\t\ttrue,\n\t\t\t\tforceNoEdit:\t\t\t\t\tfalse,\n\t\t\t\tforceUpgradeWidgets:\tfalse,\n\t\t\t\tinitSync:\t\t\t\t\t\t\tfalse\n\t\t\t}, isO(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:\t\t\t[],\n\t\t\t\thtml:\t\t\t'',\n\t\t\t\tstyle:\t\t'',\n\t\t\t\tscripts:\t[],\n\t\t\t\tcomment:\t''\n\t\t\t},\n\t\t\tastyle;\n\n\tif (!isO(d) || d.type != 'inliner' || !isA(d.content) || !d.content.length) {\n\t\tres.err.push('Error: invalid or empty inliner doc.');\n\t\treturn res;\n\t}\n\n\tid = d._id || id;\n  \n  // ===============================================\n\n\t// Generate stylesheet\n\t\n\tif (opts.style) {\n\n\t\tif (!Object.isObject(opts.style)) {\n\t\t\tastyle = _json2css.call(\n\t\t\t\tthat, \n\t\t\t\tnull , \n\t\t\t\tObject.merge(\n\t\t\t\t\tObject.reject(that,['style','data']), \n\t\t\t\t\t{\n\t\t\t\t\t\tstyle:{\n\t\t\t\t\t\t\t' ': that.style[' #medium'],\n\t\t\t\t\t\t\t' .in-item':that.style[' .in-item']\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: doc\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\tastyle = _json2css.call(\n\t\t\t\tthat, \n\t\t\t\tnull , \n\t\t\t\tObject.merge(\n\t\t\t\t\tObject.reject(that,['style','data']), \n\t\t\t\t\t{\n\t\t\t\t\t\tstyle:{\n\t\t\t\t\t\t\t' ': that.style[' #medium'],\n\t\t\t\t\t\t\t' .in-item':that.style[' .in-item']\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: Object.merge({style:opts.style},Object.reject(doc,'style'), true)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\t\n\t\tif (astyle) {\n\t\t\tres.style = astyle[1]\n\t\t\t.map(function(e){\n\t\t\t\treturn (\n\t\t\t\t\t(e[0]=='@' || e[0]=='}'?'':'#in-doc-'+id+' ')\n\t\t\t\t\t+e.replace(/redactor_box/g,'in-cb')\n\t\t\t\t\t\t.replace(/redactor_editor/g,'in-cc')\n\t\t\t\t).replace(/\\s+/g,' ');\n\t\t\t}).join('\\n');\n\t\t}\n\t} //-- end stylesheet gen\n  \n  \n  \n  // ===============================================\n\n\td.content.forEach(function(item){\n\t\tvar type = item.type,\n\t\t\t\tT = that.Items[type], \n\t\t\t\terrs,\n\t\t\t\tiopts = {\n\t\t\t\t\tpath:opts.path,\n\t\t\t\t\tstyle:null,\n\t\t\t\t\tinitSync:opts.initSync,\n\t\t\t\t\tforceNoEdit:opts.forceNoEdit\n\t\t\t\t},\n\t\t\t\trow;\n\n\t\tif (T && T.To && T.To.html) {\n\n\t\t\tif (opts.Urls) iopts.Urls = opts.Urls;\n\n\t\t\ttry {\n\t\t\t\trow = T.To.html.call(\n\t\t\t\t\ttype=='widget'&&item.source\n\t\t\t\t\t\t?Object.merge({\n\t\t\t\t\t\t\tWidget:that.Widgets[item.source]||null, \n\t\t\t\t\t\t\tRT:function(){return that;}\n\t\t\t\t\t\t},T)\n\t\t\t\t\t\t:T, \n\t\t\t\t\titem, \n\t\t\t\t\tiopts\n\t\t\t\t);\n\t\t\t} catch (e) { errs = e }\n\n\t\t\tif (row) {\n\t\t\t\t\n\t\t\t\tif (!row.err.length) {\n\t\t\t\t\tres.html += row.html;\n\t\t\t\t\tres.style += row.style;\n\t\t\t\t\tres.scripts = res.scripts.add(row.scripts||[]);\n\t\t\t\t} else {\n\t\t\t\t\tres.err = res.err.add(row.err || []);\n\t\t\t\t\tif (!row.html) {\n\t\t\t\t\t\tres.html +='<div class=\"in-render-error red hide\">'+(row.err||['Error rendering item']).join('<br>')+'</div>';\n\t\t\t\t\t}\n\t\t\t\t\telse res.html += row.html;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tres.html +='<div class=\"red\">'+[errs.message, errs.stack].join('<br>')+'</div>'\n\t\t\t}\n\t\t}\n\t});\n\t//--end render content\n\t\n\t\n\t// Gen HTML string\n\t\n\tres.html = [\n\t\t'<div id=\"in-doc-'+d._id+'\" ',\n      'class=\"in-doc-body\" ',\n      'data-title=\"'+(d.name+'').escapeHTML()+'\" ',\n      'data-tags=\"'+d.tags.map(function(e){return (e+'').replace(/\\s+/g,'_').escapeHTML()}).join(\" \")+'\" ',\n      'data-lastupdated=\"'+(d.log && d.log.length?d.log[0][0]:d.stamp)+'\" ',\n      Object.keys(d.meta).map(function(i){\n        if (Object.isString(d.meta[i])) return 'data-'+i.escapeHTML()+'=\"'+(d.meta[i]).escapeHTML()+'\"'\n      }).compact().join(' '),\n\t\t'>',\n\t\tres.html,\n\t\t'</div>'\n\t].join('')\n  .replace(/redactor_box/g,'in-cb')\n  .replace(/redactor_editor/g,'in-cc');\n\t\n\t\n\t// Dedup scripts\n\t\n\tvar nscripts = [],\n\t\t\thscripts = {};\n\tres.scripts.forEach(function(e){\n\t\tvar h = _sdbmS(e);\n\t\tif (!hscripts[h]) {\n\t\t\thscripts[h] = true;\n\t\t\tnscripts.push(e);\n\t\t}\n\t});\n\tres.scripts = nscripts;\n\n\t\n\treturn res;\n\t\n\n\t// - - - - - - - - - - - - - - -\n\n\tfunction _json2css ($o, manifest, localOnly) {\n\t\t// converts .style section of manifest\n\t\t// into two css rule lists for the form\n\t\tvar  aglob=[], aloc=[], man=manifest;\n\t\tif (!isO(man) || !isO(man.style)) return \"\";\n\n\t\tcrawl(manifest.style, \"\", aglob, aloc);\t\t\n\t\t\n\t\treturn [_dedup(aglob), _dedup(aloc)];\n\t\t\n\t\t//- - - - - - - - - - - - - - \n\t\t\n\t\tfunction _dedup(a) {\n\t\t\t// replaces rules with identical tails \n\t\t\t// to #id1,#id2,id#{rule}\n\t\t\t// Todo: make more effective\n\t\t\treturn a.map(function(e, i){\n\t\t\t\tvar e1 = a[i+1];\n\t\t\t\tif (e1) {\n\t\t\t\t\tvar es0 = e.split('{'),\n\t\t\t\t\t\t\tes1 = e1.split('{');\n\t\t\t\t\tif (es0[1] && es0.from(1)+'' == es1.from(1)+'') return es0[0]+',';\n\t\t\t\t}\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\t\t\n\t\t//- - - - - - - - - - - - - - \n\n\t\tfunction crawl (branch0, key0, aglob, aloc){\n\t\t\tvar i, j, k, b, a, \n\t\t\t\t\tbranch = branch0,\n\t\t\t\t\tisMedia = /@/.test(key0),\n\t\t\t\t\tkey = key0.split(\"@\")[0],\n\t\t\t\t\tisFn = isF(branch);\n\n\t\t\tif (isMedia) (isFn?aloc:aglob).push (\"@\"+key0.split(\"@\")[1].trim()+\" {\");\n\n\t\t\tif (isS(branch)) {\n\t\t\t\taglob.push(key+(/\\{/.test(branch)?branch:'{'+branch.replace(/[\\r\\n]/g,'')+'}'));\n\t\t\t}\n\t\t\tif (isA(branch) && branch.length) {\n\t\t\t\tfor (i=0; i<branch.length; i++) crawl(branch[i], key, aglob, aloc);\n\t\t\t}\n\t\t\telse if (isO(branch)) {\n\t\t\t\tk = Keys(branch);\n\t\t\t\tfor (i=0; i<k.length; i++) {\n\t\t\t\t\ta = unfold(key, k[i]);\n\t\t\t\t\tfor (j=0; j<a.length; j++) crawl(branch[k[i]], a[j], aglob, aloc);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (isF(branch)) {\n\t\t\t\ttry {\n\t\t\t\t\tb = branch.call(manifest, $o, manifest);\n\t\t\t\t\tcrawl (b, key, aloc, aloc);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t//console.log(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isMedia) (isFn?aloc:aglob).push (\"}\");\n\t\t}\n\n\t\tfunction unfold (key, selector) {\n\t\t\tvar pre = \"\", ext = selector+\"\", a;\n\t\t\tif (\" \" === ext.to(1) || /^[a-z]/i.test(ext)) pre = \" \";\n\t\t\ta = ext.split(/\\s*,\\s{0,}/).compact(true);\n\t\t\tif (!a.length) a.push(\"\");\n\t\t\treturn a.map(function (e) {return key+pre+e;});\n\t\t}\n\t}\n\t\n\t\t//- - - - - - - - - - - - \n\t\n\tfunction _sdbmS (s){\n\t\t// Very fast hash used in Berkeley DB\n\t\tfor (var hash=0,i=0;i<s.length;i++)\n\t\t\thash=s.charCodeAt(i)+(hash<<6)+(hash<<16)-hash;\n\t\treturn (1e11+hash).toString(36);\n\t}\n\n}"},"Hoverpane": "function (type,del,hide0) {\n\t\n\t// Hoverpane generator, enumerates all plugins\n\t\n\tvar i, v, hide = hide0 || {},\n\t\t\thtml= '<div class=\"cw-hoverpane cw-hoverpane-insert blue\">'\n\t+'<span class=\"hbtn hbtn-plus\"></span>', \n\t\t\tthat = this, \n\t\t\tmans = that.Items,\n\t\t\tt2c = Object.clone(that.Lang.HOVERPANE, true),\n\t\t\ttc;\n\n\n\tfor (i in mans) {\n\t\tv = mans[i];\n\t\tif (!hide[v.data.type] && (tc = t2c[v.data.type])) {\n\t\t\thtml+='<span data-type=\"'+v.data.type+'\" class=\"hbtn '+tc.css+'\" title=\"'+tc.title+'\"></span>';\n\t\t}\n\t}\n\n\thtml+='<nobr>';\n\n\t// Opts button\n\n\tif (mans[type] && mans[type].Opts) {\n\n\t\ttc = t2c._opts;\n\n\t\thtml += '<span class=\"hbtn hbtn-cog\" '\n\t\t+'data-type=\"-opts\" id=\"btn-htmlopts\" title=\"'+tc.title+'\"></span>';\n\t}\n\n\t// Copy / paste buttons\n\n\ttc = t2c._copy;\n\n\thtml += '<span class=\"hbtn hbtn-copy\" '\n\t+'data-type=\"-copy\" id=\"btn-copy\" title=\"'+tc.title+'\"></span>';\n\n\ttc = t2c._paste;\n\n\thtml += '<span class=\"hbtn hbtn-paste\" '\n\t+'data-type=\"-paste\" id=\"btn-paste\" title=\"'+tc.title+'\"></span>';\n\n\t// Del button\n\n\ttc = t2c._del;\n\n\tif (del) html += '<span class=\"hbtn hbtn-del\" '\n\t+'data-type=\"-\" id=\"btn-del\" title=\"'+tc.title+'\"></span>';\n\n\t// End hoverpane html\n\thtml+='</nobr>';\n\n\thtml+='</div>';\n\treturn html;\n}","Actions": "function ($o,form) {\n\t\n\tvar that = this, i,\n\t\t\td = form.data,\n\t\t\tnow = Date.now(),\n\t\t\t$ho=$o.find(\"#hoverpane:eq(0)\"),\n\t\t\t$me = $o.find(\"#medium\"),\n\t\t\tisO = Object.isObject,\n\t\t\tisA = Object.isArray,\n\t\t\tisF = Object.isFunction;\n\t\n\t$o.on(\"click.my\", \".cw-hoverpane-insert .hbtn\", function (){\n\t\tvar xd = $ho.data(\"hoverpane\"),\n\t\t\t\t$r = xd.form,\n\t\t\t\tidx = ($r.data(\"formlist\")?$r.data(\"formlist\").index:$o.my(\"data\").content.length+1),\n\t\t\t\ttype = $(this).data(\"type\"),\n\t\t\t\tidata = $r.my(\"data\"),\n\t\t\t\t$frame;\n\n\t\tif (type==\"-\") {\n\t\t\t//$r.trigger(\"remove\");\n\t\t\td.content = that.CollapseItems(d.content.removeAt(idx));\n\t\t\t$o.my(\"redraw\");\n\t\t\t_off();\n\t\t}\n\t\telse if (type==\"-opts\") {\n\t\t\t$ho.addClass(\"hover\");\n\t\t\t$('body>div.redactor_air').css({display:'none'});\n\t\t\t// Add red frame\n\t\t\tif (xd.val && !xd.val.hasClass('redactor_box')) $frame = xd.val;\n\t\t\telse $frame = $r.find('.in-ct');\n\t\t\t$frame.css({outline: '1px dashed red'});\n\t\t\t\n\t\t\tif (that.Items[idata.type].Opts) {\n\t\t\t\tvar modal = $(this).modal({\n\t\t\t\t\troot:$o.parents(\".my-form\").eq(0),\n\t\t\t\t\tmanifest:$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tRT: function(){return that;},\n\t\t\t\t\t\t\tAtt: that.Att\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$r.my(\"manifest\").Opts\n\t\t\t\t\t),\n\t\t\t\t\tdata:Object.clone($r.my(\"data\"), true),\n\t\t\t\t\t//nose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\talign:\"top:-4px;left:-\"+($(this).parent().position().left+1)+\"px;\",\n\t\t\t\t\tcss:\"blue lh150 fs80 p10\",\n\t\t\t\t\tbound:8,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tclose:false\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (idata.type == \"html\") {\n\t\t\t\t\t// HTML data, special case\n\t\t\t\t\tmodal.then(function(res){\n\t\t\t\t\t\t_noframe();\n\t\t\t\t\t\tvar prevcss = ($r.my(\"data\").css||[]).sortBy()+$r.my(\"data\").format;\n\t\t\t\t\t\tif (res.css + res.format != prevcss) {\n\n\t\t\t\t\t\t\tif (prevcss!=$r.my(\"data\").format+\"\" || $r.find(\".redactor_editor>*\").size()==1) {\n\t\t\t\t\t\t\t\t// Reformat already formatted block\n\t\t\t\t\t\t\t\t$r.my(\"data\").css = res.css;\n\t\t\t\t\t\t\t\t$r.my(\"data\").format = res.format+\"\";\n\t\t\t\t\t\t\t\t$r.my(\"redraw\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Insert new only into unformatted block\n\t\t\t\t\t\t\t\tthat.Insert(\"html\", idx, xd.p, xd.after, xd.val, {css:res.css});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_off();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else if (idata.type == \"widget\"){\n\t\t\t\t\t\n\t\t\t\t\t// do we need to restart widget ?\n\t\t\t\t\tmodal.then(function(res){\n\t\t\t\t\t\t$.extend($r.my(\"data\"), res);\n\t\t\t\t\t\t$r.my(\"redraw\");\n\t\t\t\t\t\t//$r.my('find', '#btn-run').trigger('click');\n\t\t\t\t\t\t$r.my(\"restyle\");\n\t\t\t\t\t\t_off();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t// Other data, extend data with result\n\t\t\t\t\tmodal.then(function(res){\n\t\t\t\t\t\t$.extend($r.my(\"data\"), res);\n\t\t\t\t\t\t$r.my(\"redraw\");\n\t\t\t\t\t\t$r.my(\"restyle\");\n\t\t\t\t\t\t_off();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tmodal.fail(_off);\n\t\t\t}\n\t\t}\n\t\telse if (type==\"-copy\") {\n\t\t\t\n\t\t\tvar clip = $.extend(true, {_id:\"_local/cw.Inliner\", type:\"clip\"}, {clip:idata, previews:{}, files:{}});\n\t\t\t\n\t\t\tif (idata.type==\"html\" && !(idata.css||[]).length) {clip.clip.data = xd.val[0].outerHTML}\n\t\t\t\n\t\t\tthat.db.get(\"_local/cw.Inliner\")\n\t\t\t.then(\n\t\t\t\tfunction(old){ clip._rev = old._rev; return _saveClip(clip)},\n\t\t\t\tfunction(err){ return _saveClip(clip) }\n\t\t\t)\n\t\t\t.then(function(){\n\t\t\t\tcw.lib.note(that.Lang.CLIP_STASHED,\"ok\");\n\t\t\t\t_off();\n\t\t\t})\n\t\t\t\n\t\t}\n\t\telse if (type==\"-paste\") {\n\t\t\tthat.db.get(\"_local/cw.Inliner\")\n\t\t\t.then(\n\t\t\t\tfunction(clip){ \n\t\t\t\t\tif (clip.clip && clip.clip.type) {\n\t\t\t\t\t\tclip.clip._stamp = cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6));\n\t\t\t\t\t\tvar item = clip.clip;\n\t\t\t\t\t\titem._new = false;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (clip.previews) d.previews = $.extend(d.previews||{}, clip.previews);\n\t\t\t\t\t\tif (Object.size(clip.files)) {\n\t\t\t\t\t\t\tif (!d._attachments) d._attachments = {};\n\t\t\t\t\t\t\t$.extend(d._attachments, clip.files);\n\t\t\t\t\t\t\tthat.Att(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tthat.Insert(item.type, idx, null, false, xd.val, item);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t_off();\n\t\t\t\t},\n\t\t\t\tfunction(err){ cw.lib.note(that.Lang.CLIP_NOCLIP,\"error\"); _off(); }\n\t\t\t)\n\t\t}\n\t\telse if (type.to(1)!=\"-\") {\n\t\t\tif (type==\"html\") {\n\t\t\t\tthat.Insert(type, idx, void 0, false, null, {data:'<p><br></p>'});\n\t\t\t\t_off();\n\t\t\t} \n\t\t\telse if (type == 'widget') {\n\t\t\t\tif (Object.size(that.Widgets)) {\n\t\t\t\t\t// We have extenders\n\t\t\t\t\t$ho.addClass('hover');\n\t\t\t\t\t$(this).modal({\n\t\t\t\t\t\troot:$o.parents(\".my-form\").eq(0),\n\t\t\t\t\t\tmanifest:that.Items.widget.Select,\n            width: $ho.outerWidth()-24,\n\t\t\t\t\t\tdata:{widgets:Object.values(that.Widgets)},\n\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\talign:'top:22px;left:'+(-$(this).position().left),\n\t\t\t\t\t\tcss:\"blue lh150 fs80 p10\",\n\t\t\t\t\t\tbound:8,\n\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\tclose:false\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\tthat.Insert(type, idx, xd.p, xd.after, xd.val, res.extender);\n\t\t\t\t\t})\n\t\t\t\t\t.always(_off);\n\t\t\t\t} else {\n\t\t\t\t\tthat.Insert(type, idx, xd.p, xd.after, xd.val);\n\t\t\t\t\t_off();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.Insert(type, idx, xd.p, xd.after, xd.val);\n\t\t\t\t_off();\n\t\t\t}\n\t\t}\n\t\t\n\t\t//- - - - - - - - - - - - - - -\n\t\t\n\t\tfunction _noframe(){\n\t\t\tif ($frame) $frame.css({outline: ''});\n\t\t}\n\t\t\n\t\tfunction _off(){ \n\t\t\t_noframe();\n\t\t\t$ho.removeClass(\"cw-half hover\").css({top:\"-250px\",left:0});\n\t\t}\n\t\t\n\t\tfunction _saveClip(doc){ \n\t\t\t\n\t\t\t// here we should detect attaches used, \n\t\t\t// load em and append to doc as files{},\n\t\t\t// and their previews as previews{}\n\t\t\tvar a = d._attachments,\n\t\t\t\t\tp = d.previews,\n\t\t\t\t\tc = doc.clip,\n\t\t\t\t\tlist = {},\n\t\t\t\t\twlist,\n\t\t\t\t\tman,\n\t\t\t\t\tdata,\n\t\t\t\t\tre = /^http[s]?:\\/\\//;\n\t\t\t\n\t\t\tif (!a || !Object.size(a)) return that.db.put(doc); \n\t\t\t\n\t\t\tif (c.type=='img' && c.ref && !re.test(c.ref)) list[c.ref] = true;\n\t\t\telse if (c.type == 'widget') {\n\t\t\t\tif (c.bg && !re.test(c.bg)) list[c.bg] = true;\n\t\t\t\t// try to parse man\n\t\t\t\ttry {\n\t\t\t\t\tman = eval(c.js);\n\t\t\t\t\tdata = eval(c.data);\n\t\t\t\t} catch(e){}\n\t\t\t\t\n\t\t\t\tif (isO(man) && isO(data) && man.To && isF(man.To.files)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t\twlist = man.To.files.call(man, data);\n\t\t\t\t\t} catch(e){}\n\t\t\t\t\t\n\t\t\t\t\tif (isO(wlist) && Object.size(wlist)) {\n\t\t\t\t\t\tObject.keys(wlist).forEach(function(k){ list[k] = true; });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// stash\n\t\t\tvar pis = [],\n\t\t\t\t\tpi = $.Deferred();\n\t\t\t\n\t\t\tObject.keys(list).forEach(function(fname){\n\t\t\t\tvar fname = fname;\n\t\t\t\tif (a[fname]) {\n\t\t\t\t\tif (p[fname]) doc.previews[fname] = Object.clone(p[fname], true);\n\t\t\t\t\tif (a[fname].data) doc.files[fname] = {\n\t\t\t\t\t\tcontent_type:a[fname].content_type,\n\t\t\t\t\t\tdata:a[fname].data\n\t\t\t\t\t} \n\t\t\t\t\telse {\n\t\t\t\t\t\t// fetch attach\n\t\t\t\t\t\tpis.push(that.Att(fname, 'data').then(function(s){\n\t\t\t\t\t\t\tdoc.files[fname] = {\n\t\t\t\t\t\t\t\tcontent_type:a[fname].content_type,\n\t\t\t\t\t\t\t\tdata:s\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t}));\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (!pis.length) _save.debounce(1)();\n\t\t\telse {\n\t\t\t\t$.when.apply(null, pis).done(_save.debounce(1));\n\t\t\t}\n\t\t\t\n\t\t\treturn pi.promise();\n\t\t\t\n\t\t\t// - - - - - - - - - \n\t\t\t\n\t\t\tfunction _save(){\n\t\t\t\tthat.db.put(doc)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(){pi.resolve();},\n\t\t\t\t\tfunction(){pi.reject();}\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t} // end save clip\n\n\t}.debounce(40));\n\n}","UpdateWidgets": "function (d) {\n\tvar that = this,\n\t\t\tw = that.Widgets,\n\t\t\ta = d.content,\n\t\t\tm;\n\tif (Object.size(w)) {\n\t\td.content = d.content.map(function(e){\n\t\t\tif (\n\t\t\t\te.type==\"widget\" \n\t\t\t\t&& e.source \n\t\t\t\t&& e.options.indexOf(\"autoupdate\")>-1\n\t\t\t\t&& (m = w[e.source])\n\t\t\t) {\n\t\t\t\te.js = \"(\"+cw.lib.js2txt(cw.lib.unjson(JSON.parse(cw.lib.json(m))),'\\t')+\")\";\n\t\t\t}\n\t\t\treturn e; \n\t\t});\n\t}\n}","Insert": "function ($o) {\n\tvar that = this;\n\t\n\treturn function  (type, idx, p0, after, $item, extender) {\n\t\t\n\t\t// Inserts new item, splits src if needed\n\t\t\n\t\tvar ins,txt, content, news, \n\t\t\t\ta=[], \n\t\t\t\tod = $o.my(\"data\"), \n\t\t\t\tonew={},\n\t\t\t\tp=p0;\n\t\t\n\t\tif ($item) {\n\t\t\tvar $e = $item.parents('.redactor_editor').eq(0),\n\t\t\t\t\tid = Number.random(65536, 0x100000 - 1).toString(16).last(4),\n\t\t\t\t\tins = '<b id=\"split-'+id+'\"></b>',\n\t\t\t\t\t$i = $(ins).insertBefore($item.eq(0));\n\t\t\tcontent = $e.html();\n\t\t\tp = ins;\n\t\t\t$i.remove();\n\t\t}\n\n\t\tif (p) {\n\t\t\ttxt = content || od.content[idx].data;\n\t\t\ta=txt.split(p+((extender||{})._new!==false && type==\"html\" && $item?$item.eq(0)[0].outerHTML:\"\"));\n\t\t}\n\n\t\tif (type) {\n\t\t\tins = $.extend(true, {_stamp:cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6))}, that.Items[type].data);\n\t\t\tif (type==\"html\" && $item) {\n\t\t\t\tins.data = $item.eq(0)[0].outerHTML;\n\t\t\t}\n\t\t\tif (extender) $.extend(ins, extender);\n\t\t\t\n\t\t\tif (!(extender && extender._new===false)) ins._new = true;\n\t\t}\n\n\t\tif (\n\t\t\t!(type==\"html\" && $item) &&\n\t\t\t(!p || a.length<2 || (a[0]==\"\" && !after) || (a[1]==\"\" && after))\n\t\t) {\n\t\t\tif (type) od.content.add(ins, idx+(after?1:0));\n\t\t\telse od.content.removeAt(idx);\n\t\t} else if (p) {\n\t\t\tif (type) {\n\t\t\t\tod.content[idx].data=a[0];\n\t\t\t\t//od.content[idx]._stamp = (Date.now()+100)+\"\";\n\t\t\t\tonew=Object.clone(od.content[idx],true);\n\t\t\t\tonew.data=a[1];\n\t\t\t\tonew._stamp = cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6));\n\t\t\t\t\n\t\t\t\tod.content.add([ins,onew], idx+1);\n\t\t\t\t\n\t\t\t\tif (!od.content[idx].data) od.content.removeAt(idx);\n\t\t\t\t\n\t\t\t\tod.content = that.CollapseItems(od.content);\n\n\t\t\t} else {\n\t\t\t\t//delete\n\t\t\t\tif (!a[0].length && !a[1].length) {\n\t\t\t\t\tod.content.removeAt(idx+(after?1:0));\n\t\t\t\t} else {\n\t\t\t\t\tod.content[idx].data=a[0]+a[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tod.content = that.CollapseItems(od.content);\n\t\t$o.find(\"#medium\").trigger(\"redraw\");\n\t};\n}","SVG": {"Hoverpane": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"242\" height=\"26\" viewBox=\"0, 0, 242, 26\">\n  <g id=\"Layer_1\">\n    <path d=\"M47.6,11.7 L45.5,11.5 C45.4,11.0 45.2,10.5 45.0,10.1 L46.3,8.5 C46.4,8.3 46.4,8.1 46.2,7.9 L45.0,6.7 C44.9,6.6 44.8,6.6 44.7,6.6 C44.6,6.6 44.5,6.6 44.4,6.6 L42.8,7.9 C42.4,7.7 41.9,7.5 41.4,7.4 L41.2,5.3 C41.2,5.1 41.0,5 40.8,5 L39.1,5 C38.9,5 38.7,5.1 38.7,5.3 L38.5,7.4 C38.0,7.5 37.5,7.7 37.1,7.9 L35.5,6.6 C35.4,6.6 35.3,6.6 35.2,6.6 C35.1,6.6 35.0,6.6 34.9,6.7 L33.7,7.9 C33.5,8.1 33.5,8.3 33.6,8.5 L34.9,10.1 C34.7,10.5 34.5,11.0 34.4,11.5 L32.3,11.7 C32.1,11.7 32,11.9 32,12.1 L32,13.8 C32,14.0 32.1,14.2 32.3,14.2 L34.4,14.4 C34.5,14.9 34.7,15.4 34.9,15.8 L33.6,17.4 C33.5,17.6 33.5,17.8 33.7,18.0 L34.9,19.2 C35.0,19.3 35.1,19.3 35.2,19.3 C35.3,19.3 35.4,19.3 35.5,19.3 L37.1,18.0 C37.5,18.2 38.0,18.4 38.5,18.5 L38.7,20.6 C38.7,20.8 38.9,21 39.1,21 L40.8,21 C41.0,21 41.2,20.8 41.2,20.6 L41.4,18.5 C41.9,18.4 42.4,18.2 42.8,18.0 L44.4,19.3 C44.5,19.3 44.6,19.3 44.7,19.3 C44.8,19.3 44.9,19.3 45.0,19.2 L46.2,18.0 C46.4,17.8 46.4,17.6 46.3,17.4 L45.0,15.8 C45.2,15.4 45.4,14.9 45.5,14.4 L47.6,14.2 C47.8,14.2 48,14.0 48,13.8 L48,12.1 C48,11.9 47.8,11.7 47.6,11.7 z M40,15.6 C38.6,15.6 37.3,14.3 37.3,13 C37.3,11.6 38.6,10.3 40,10.3 C41.3,10.3 42.6,11.6 42.6,13 C42.6,14.3 41.3,15.6 40,15.6 z M18.2,11.3 C18.3,11.3 18.5,11.5 18.5,11.6 L18.5,14.1 C18.5,14.1 18.4,14.2 18.4,14.3 C18.3,14.3 18.3,14.3 18.2,14.3 L14.5,14.3 L14.4,18.1 C14.4,18.1 14.4,18.2 14.4,18.3 C14.3,18.3 14.2,18.3 14.2,18.3 L11.7,18.3 C11.7,18.3 11.6,18.3 11.5,18.3 C11.5,18.2 11.5,18.1 11.5,18.1 L11.5,14.3 L7.7,14.3 C7.7,14.3 7.6,14.3 7.5,14.3 C7.5,14.2 7.5,14.1 7.5,14.1 L7.5,11.6 C7.5,11.5 7.6,11.3 7.7,11.3 L11.5,11.3 L11.5,7.6 C11.5,7.5 11.6,7.3 11.7,7.3 L14.2,7.3 C14.3,7.3 14.4,7.5 14.4,7.6 L14.5,11.3 L18.2,11.3 z\" fill=\"#A6B2C2\"/>\n    <path d=\"M102.9,6.8 C102.9,6.3 102.5,6.0 102.0,6.0 C102.0,6.0 101.9,6.0 101.9,6.0 L101.9,6 L85.9,6 L85.9,6.0 C85.4,6.0 85,6.3 85,6.8 L85,6.8 L85,19.1 L85,19.1 L85,19.1 L85,19.2 L85.0,19.2 C85.0,19.6 85.4,19.9 85.9,19.9 L85.9,20 L101.9,20 L101.9,19.9 C101.9,19.9 102.0,19.9 102.0,19.9 C102.5,19.9 102.9,19.6 102.9,19.2 L103,19.2 L103,6.8 L102.9,6.8 z M101.1,18.1 L98,18.1 C97.9,18.0 98.0,18.1 98,18.1 L98,18.1 L93.9,10.4 L93.9,10.4 C93.7,10.2 93.5,10.1 93.3,10.1 C93.0,10.1 92.8,10.2 92.7,10.4 L89.8,15.3 L88.8,14.2 L88.8,14.2 C88.7,14.1 88.6,14.0 88.5,14.0 C88.3,14.0 88.2,14.1 88.2,14.2 L86.9,16.0 L86.8,7.8 L101.1,7.8 L101.1,18.1 z M100,10.5 C100,9.6 99.3,9 98.5,9 C97.6,9 97,9.6 97,10.5 C97,11.3 97.6,12 98.5,12 C99.3,12 100,11.3 100,10.5 z M121,6 C123,6 129.0,7 129.0,7 C129.0,7 130,10.8 129.9,13 C129.9,14.8 129.0,19 129.0,19 C129.0,19 123,20 121,20 C119,20 112.9,19 112.9,19 C112.9,19 112.0,15.0 112.0,13 C111.9,10.8 112.9,7 112.9,7 C112.9,7 119,6 121,6 z M121,8 C120.3,8 119.1,8.1 117.5,8.3 C117.2,8.3 116.8,8.4 116.5,8.4 C115.1,8.6 115.7,8.5 114.6,8.7 C114.5,9.0 114.6,8.7 114.4,9.5 C114.3,10.0 114.2,10.5 114.1,11.0 C114.0,11.8 113.9,12.4 114.0,12.9 C114.0,13.4 114.1,14.1 114.2,15.0 C114.3,15.4 114.3,15.8 114.4,16.2 C114.6,17.1 114.5,16.8 114.6,17.2 C115.7,17.4 115.1,17.3 116.5,17.5 C116.8,17.5 117.2,17.6 117.5,17.6 C119.1,17.8 120.3,18 121,18 C121.6,18 122.8,17.8 124.4,17.6 C124.7,17.6 125.1,17.5 125.4,17.5 C126.8,17.3 126.2,17.4 127.3,17.2 C127.4,16.8 127.3,17.1 127.5,16.3 C127.6,15.9 127.6,15.5 127.7,15.2 C127.9,14.2 127.9,13.4 127.9,12.9 C127.9,12.5 127.9,11.8 127.7,10.9 C127.7,10.5 127.6,10.0 127.5,9.5 C127.3,8.8 127.4,9.0 127.3,8.7 C126.2,8.5 126.8,8.6 125.4,8.4 C125.1,8.4 124.7,8.3 124.4,8.3 C122.8,8.1 121.6,8 121,8 z M121.6,11.3 L119,9.7 L119,12.8 L119,16 L121.6,14.4 L124.3,12.8 z M155.8,10.8 C157.0,10.8 158,11.7 158,12.8 C158,13.9 157.0,14.8 155.8,14.8 C154.7,14.8 153.7,13.9 153.7,12.8 C153.7,11.7 154.7,10.8 155.8,10.8 z M148,10.8 C149.1,10.8 150.1,11.7 150.1,12.8 C150.1,13.9 149.1,14.8 148,14.8 C146.8,14.8 145.8,13.9 145.8,12.8 C145.8,11.7 146.8,10.8 148,10.8 z M140.1,10.8 C138.9,10.8 138,11.7 138,12.8 C138,13.9 138.9,14.8 140.1,14.8 C141.2,14.8 142.2,13.9 142.2,12.8 C142.2,11.7 141.2,10.8 140.1,10.8 z M65,20 L65,8.2 L59,8.2 L59,6 L74,6 L74,8.2 L68,8.2 L68,20 z\" fill=\"#616C7D\"/>\n    <path d=\"M209,9 C209.5,9 210,9.4 210,10 L210,21.0 C210,21.6 209.5,22.0 209,22.0 L200,22.0 C199.4,22.0 199,21.6 199,21.0 L199,10 C199,9.4 199.4,9 200,9 L209,9 z M209,10 L200,10 L200,21 L209,21 L209,10 z M205,15 L205,16 L201,16 L201,15 L205,15 z M207,13 L207,14 L201,14 L201,13 L207,13 z M206,11 L206,12 L201,12 L201,11 L206,11 z M203,4 L200,4 L200,5 L196,5 C196,5 195,6 195,6 L195,19 C195,19 196,20 196,20 L198,20 L198,18.1 L196.8,18.1 L196.8,6.8 L206.1,6.8 L206,8 L208,8 L208,6 C208,6 207,5 207,5 L203,5 L203,4 z M183.0,5.9 L183,6 L182,6 L182,21 L170,21 L170,22 C169.7,22 170,22.2 170,22 L182,22 C182.2,22 183,21.2 183,21 L183,6 C183.1,5.9 183.1,5.9 183.0,5.9 z M177,10 L171,10 L171,11 L177,11 L177,10 z M175,12 L171,12 L171,13 L175,13 L175,12 z M179.1,5.8 L179.1,18.1 L169.8,18.1 L169.8,8.8 L171,8.8 L171,9 L176,9 L176,8 L172.8,8 L172.8,5.8 L179.1,5.8 z M180,4 L173,4 L168,9 L168,19 C168,19.2 168.7,20 169,20 L180,20 C180.2,20 181,19.2 181,19 L181,5 L180.9,4.9 C180.9,4.7 180.2,4 180,4 z\" fill=\"#A6B2C2\"/>\n    <path d=\"M233.5,9 C233.7,9 234,9.2 234,9.4 L234,13 C234,13.2 233.2,21 233,21 L224,21 C223.7,21 223,13.2 223,13 L223,9.4 C223,9.2 223.2,9 223.4,9 L233.5,9 z M233.3,6.2 C233.6,6.2 234.3,6.6 234.3,7 L234.3,7.4 C234.3,7.7 234.1,8 233.8,8 L223.1,8 C222.8,8 222.6,7.7 222.6,7.4 L222.6,7 C222.6,6.6 223.3,6.2 223.6,6.2 L226.5,6.2 L226.5,5.5 C226.5,5.2 226.7,5 227.0,5 L229.9,5 C230.2,5 230.4,5.2 230.4,5.5 L230.4,6.2 L233.3,6.2 z\" fill=\"#FF7979\"/>\n    <path d=\"M230.2,11 L230.2,19 L229.2,19 L229.2,11 L230.2,11 z M228.2,11 L227.2,11 L227.2,19 L228.2,19 L228.2,11 z M232.2,11 L231.2,11 L231.2,18 L232.2,18 L232.2,11 z M226.2,11 L225.2,11 L225.2,18 L226.2,18 L226.2,11 z\" fill=\"#FFFFFF\" fill-opacity=\"0.7\"/>\n    <path d=\"M0,0 L1,0 L1,1 L0,1 L0,0 z\" fill=\"#FFFFFF\" fill-opacity=\"0.0\"/>\n    <path d=\"M241,25 L242,25 L242,26 L241,26 L241,25 z\" fill=\"#FFFFFF\" fill-opacity=\"0.0\"/>\n  </g>\n</svg>\n","Options": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"560\" height=\"30\" viewBox=\"0, 0, 560, 30\">\n  <g id=\"Layer_1\">\n    <path d=\"M404,4 L436,4 L436,26 L404,26 L404,4 z\" fill=\"#93A0A9\" fill-opacity=\"0.4\"/>\n    <path d=\"M284,4 L316,4 L316,26 L284,26 L284,4 z M324,4 L324,26 L356,26 L356,4 L324,4 z M364,4 L364,26 L396,26 L396,4 L364,4 z M524,4 L524,26 L556,26 L556,4 L524,4 z\" fill=\"#93A0A9\" fill-opacity=\"0.2\"/>\n    <path d=\"M2,4 L12,4 L12,14 L2,14 L2,4 z M266,4 L266,14 L276,14 L276,4 L266,4 z M44,4 L44,14 L60,14 L60,4 L44,4 z M220,4 L220,14 L236,14 L236,4 L220,4 z M84,4 L84,14 L106,14 L106,4 L84,4 z M108,4 L108,6 L116,6 L116,4 L108,4 z M108,8 L108,10 L114,10 L114,8 L108,8 z M124,4 L124,14 L156,14 L156,4 L124,4 z M193,7 L196,9 L193,11 z M167,11 L164,9 L167,7 z M162,4 L162,14 L198,14 L198,4 L162,4 z\" fill=\"#93A0A9\" fill-opacity=\"0.7\"/>\n    <path d=\"M476,4 L476,26 L444,26 L444,4 L476,4 z M475,5 L445,5 L445,25 L475,25 L475,5 z\" fill=\"#5E666B\" fill-opacity=\"0.6\"/>\n    <path d=\"M14,4 L36,4 L36,6 L14,6 L14,4 z M14,8 L14,10 L34,10 L34,8 L14,8 z M14,12 L14,14 L36,14 L36,12 L14,12 z M4,16 L4,18 L34,18 L34,16 L4,16 z M4,20 L4,22 L36,22 L36,20 L4,20 z M448,8 L448,10 L472,10 L472,8 L448,8 z M448,12 L448,14 L470,14 L470,12 L448,12 z M448,16 L448,18 L472,18 L472,16 L448,16 z M448,20 L448,22 L464,22 L464,20 L448,20 z M484,8 L484,10 L514,10 L514,8 L484,8 z M484,12 L484,14 L512,14 L512,12 L484,12 z M484,16 L484,18 L514,18 L514,16 L484,16 z M484,20 L484,22 L500,22 L500,20 L484,20 z M4,24 L4,26 L24,26 L24,24 L4,24 z M244,4 L244,6 L264,6 L264,4 L244,4 z M244,8 L244,10 L262,10 L262,8 L244,8 z M244,12 L244,14 L264,14 L264,12 L244,12 z M244,16 L244,18 L274,18 L274,16 L244,16 z M244,20 L244,22 L276,22 L276,20 L244,20 z M244,24 L244,26 L264,26 L264,24 L244,24 z M62,4 L62,6 L76,6 L76,4 L62,4 z M62,8 L62,10 L74,10 L74,8 L62,8 z M62,12 L62,14 L76,14 L76,12 L62,12 z M44,16 L44,18 L74,18 L74,16 L44,16 z M44,20 L44,22 L76,22 L76,20 L44,20 z M44,24 L44,26 L64,26 L64,24 L44,24 z M204,4 L204,6 L218,6 L218,4 L204,4 z M204,8 L204,10 L216,10 L216,8 L204,8 z M204,12 L204,14 L218,14 L218,12 L204,12 z M204,16 L204,18 L234,18 L234,16 L204,16 z M204,20 L204,22 L236,22 L236,20 L204,20 z M204,24 L204,26 L224,26 L224,24 L204,24 z M84,16 L84,18 L116,18 L116,16 L84,16 z M84,20 L84,22 L114,22 L114,20 L84,20 z M84,24 L84,26 L104,26 L104,24 L84,24 z M124,16 L124,18 L156,18 L156,16 L124,16 z M124,20 L124,22 L154,22 L154,20 L124,20 z M124,24 L124,26 L144,26 L144,24 L124,24 z M164,16 L164,18 L194,18 L194,16 L164,16 z M164,20 L164,22 L194,22 L194,20 L164,20 z M164,24 L164,26 L184,26 L184,24 L164,24 z\" fill=\"#93A0A9\" fill-opacity=\"0.6\"/>\n    <path d=\"M408,8 L432,8 L432,10 L408,10 L408,8 z M408,12 L408,14 L430,14 L430,12 L408,12 z M408,16 L408,18 L432,18 L432,16 L408,16 z M408,20 L408,22 L424,22 L424,20 L408,20 z\" fill=\"#5D656A\" fill-opacity=\"0.4\"/>\n    <path d=\"M484,4 L516,4 L516,5 L484,5 L484,4 z\" fill=\"#5D666B\" fill-opacity=\"0.7\"/>\n    <path d=\"M484,25 L516,25 L516,26 L484,26 L484,25 z\" fill=\"#5D666B\" fill-opacity=\"0.7\"/>\n    <path d=\"M295,19 L299.1,11 L300.7,11 L305,19 L303.0,19 L302.2,17.2 L297.5,17.2 L296.7,19 z M298.2,15.8 L301.4,15.8 L299.9,12.5 z M339.8,11.9 L341.9,16.0 L337.7,16.0 z M335.7,20 L336.8,17.8 L342.8,17.8 L344.0,20 L346.5,20 L341.0,10 L338.8,10 L333.5,20 z M379.8,11.0 L382.5,16.3 L377.0,16.3 z M374.3,21.5 L375.8,18.6 L383.7,18.6 L385.2,21.5 L388.5,21.5 L381.3,8.5 L378.5,8.5 L371.5,21.5 z M539.1,12.5 Q539.3,12.9 539.5,13.3 L540.7,16.0 L537.6,16.0 L538.8,13.3 Q539.0,12.9 539.1,12.5 z M541.0,16.8 L541.6,18.3 Q541.8,18.7 541.9,18.9 Q542.0,19.1 542.0,19.3 Q542.0,19.4 541.9,19.5 Q541.9,19.6 541.7,19.6 L540.3,19.8 L540.4,20.5 Q542.0,20.4 544.0,20.4 Q545.3,20.4 547,20.5 L546.9,19.8 L545.6,19.6 Q545.2,19.5 545.0,19.3 Q544.9,19.2 544.6,18.6 L540.5,9.5 L539.5,9.6 L535.2,18.7 Q535.0,19.1 534.9,19.3 Q534.7,19.5 534.4,19.6 L533,19.8 L533.0,20.5 Q534.1,20.4 535.4,20.4 Q536.2,20.4 538.1,20.5 L538.1,19.8 L536.6,19.6 Q536.5,19.6 536.4,19.5 Q536.3,19.4 536.3,19.3 Q536.3,19.2 536.4,18.9 Q536.5,18.7 536.7,18.2 L537.3,16.8 z\" fill=\"#5E666B\" fill-opacity=\"0.6\"/>\n  </g>\n</svg>\n"},"Cropper": {"params": {"strict": true,"width": 1031},"data": {"title": "","filename": "","filesize": 0,"mime": "","data": "","mode": ["inline"],"cropped": false,"width": ["300"],"scale": "1","src": {"w": 0,"h": 0,"size": 0},"aspect": null,"expand": 1.7,"quality": 1,"enforceQuality": false,"crop": {},"gallery": true,"dim": ""},"Quality": "function (w) {\n\t\tvar that = this, q = 0.95;\n\t\t[\n\t\t\t[500, 0.91],\n\t\t\t[800, 0.86],\n\t\t\t[1200, 0.81],\n\t\t\t[1600, 0.77],\n\t\t\t[1e6, 0.72]\n\t\t].forEach(function(e){\n\t\t\tif (+w <= e[0]) q = e[1];\n\t\t});\n\t\treturn (q*that.data.quality).clamp(0.4, 0.98);\n\t}","init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\t// HTML\n\t\t$o.formgen([\n\t\t'<div class=\"fl mr20 tac vat\" style=\"background-color:#e3e8eb;'\n\t\t+'width:800px;height:600px;overflow:hidden;position:relative;line-height:600px;\" id=\"crop-frame\">',\n    \t'<img id=\"source\" class=\"vam\" style=\"max-width:800px; max-height:600px; \" src=\"\" />',\n    \t'<div class=\"w800  dib\" style=\"height:600px;position:absolute;top:0;left:0\">',\n\t\t\t'<div id=\"previewscont\" class=\"dib vab\" style=\"line-height:2em;\">',\n\t\t\t\t\t'<span class=\"dib fs120 button w320 mr0 mb70\">',\n\t\t\t\t\t\t'<span class=\"fi-photo o80\"><span class=\"fs110\"> &nbsp;'+L.BTN_UPLOAD+'</span></span>',\n\t\t\t\t\t'</span>',\n\t\t\t\t\t'<br>',\n\t\t\t\t\t'<div id=\"previews\" class=\"w800 dib vat\" style=\"overflow-y:auto; height:392px;\">',\n\t\t\t\t\t'</div>',\n\t\t\t\t'</div>',\n   \t\t\t'<input type=\"file\" id=\"file\" class=\"w800 dib\" accept=\"image/jpeg,image/png,image/svg+xml,image/gif\" '\n   \t\t\t\t+'style=\"height:205px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n   \t\t'</div>',\n    '</div>',\n    '<div class=\"w210 dib vat\" id=\"xpreview\">',\n\t\t\t'<div id=\"ftitle\" class=\"hide fs110 lh120 tac blue-1 mb20\"></div>',\n\t\t\t'<textarea id=\"fname\" type=\"text\" class=\"w100p mt0 mb15 db tac\" rows=\"2\" style=\"resize:none\" '\n\t\t\t\t+'placeholder=\"'+L.FNAME_PLC+'\"></textarea>',\n\t\t\t{row:\"210px\",rowCss:\"tac mt7\"},\n\t\t\t[\"\",\"spn#format.fs90.lh150.tag-in-fmt\"],\n\t\t\t[\"\", \"div#quality.fs80.tac.o80\"],\n\t\t\t{row:\"210px\",rowCss:\"tac mt20\"},\n\t\t\t[\"\",\n\t\t\t \"but#btn-apply.w200.green.fs120.tac\",{txt:'<span class=\"fi-crop fs90 o90\"></span> '+L.BTN_CROP},\n\t\t\t \"btn#btn-orig.w200.tac.mt4.pl0.pr0.fs95\",{val:L.BTN_ORIGINAL},\n\t\t\t \"btn#btn-close.w200.tac.mt4.fs95\",{val:L.BTN_CANCEL}\n\t\t\t],\n\t\t\t'<div id=\"info\" class=\"fs75 gray mt20 tac nw\">',\n\t\t\t\t'<div id=\"dims\" class=\"dib vat pr6 tar w85\"></div>',\n\t\t\t\t'•',\n\t\t\t\t'<div id=\"xscale\" class=\"dib vat tac w40\">0.3x</div>',\n\t\t\t\t'•',\n\t\t\t\t'<div id=\"fsize\" class=\"dib vat pl6 tal w65 nw\">—— kb</div>',\n\t\t\t'</div>',\n    '</div>',\n    '<div class=\"w200 dib vat\" id=\"xwarn\"></div>',\n    '<div class=\"hide\">',\n    \t\t\t'<canvas id=\"x2\" width=400 height=400></canvas>',\n    \t\t\t'<canvas id=\"x1\" width=200 height=200></canvas>',\n\t\t'</div>'\n\t]);\n\t\t\n\t\t// Mount exisiting atts if needed\n\t\tif (that.data.gallery) $o.then(function(){\n\t\t\tthat.Att(that.Filter,'preview')\n\t\t\t.done(function(res){\n\t\t\t\tthat.Files = res;\n\t\t\t\t$o.find(\"#previews\").trigger(\"recalc\");\n\t\t\t}.debounce(100));\n\t\t});\n\t}","Filter": "new RegExp(/(jpeg|jpg|png|gif|svg)$/i)","Files": [],"ui": {"#quality": {"bind": "function (d,v) {\n\t\t\tif(v!=null) {\n\t\t\t\td.quality = v;\n\t\t\t\tif (v+\"\"==\"1\") {\n\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.png');\n\t\t\t\t} else {\n\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.jpg');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn d.quality;\n\t\t}","init": "function ($o) {\n\t\t\t$o.tags({\n\t\t\t\ttags:[[\n\t\t\t\t\t{\"JPG 97%\":\"0.97\"},\n\t\t\t\t\t{\"90%\":\"0.90\"},\n\t\t\t\t\t{\"80%\":\"0.80\"}\n\t\t\t\t]],\n\t\t\t\tempty:{\"PNG\":\"1\"},\n\t\t\t\ttagshim:'',\n\t\t\t\tgroupshim:''\n\t\t\t})\n\t\t}","watch": "#fname","recalc": "#fname","css": {"hide": "function (d) { return !d.cropped}"}},"#previews": {"bind": "this.Files","init": "function ($o,form) {\n\t\t\tvar that = this;\n\t\t\t$o.on(\"click.my\",'.previewcard', function(){\n\t\t\t\tform.data.ref = $(this).my(\"data\").fname+\"\";\n\t\t\t\tthat.my.commit();\n\t\t\t});\n\t\t}","manifest": {"ui": {"#iii": "data","#iidesc": "function (d) {\n\t\t\t\t\treturn [d.size, d.dim].compact().join(\" • \");\n\t\t\t\t}","#iiname": "function (d) {\n\t\t\t\t\treturn (d.fname||'?').split('/').last().truncate(50, 'middle', '…');\n\t\t\t\t}"}},"list": "<div class=\"previewcard\"><div class=\"previewcont\"><img src=\"\" id=\"iii\"></div><div id=\"iiname\" class=\"w100p oh tac fs80 lh110 mb2\"></div><div id=\"iidesc\" class=\"w100p oh tac fs70 lh110\"></div></div>"},"#fname": {"bind": "filename","css": {"self:hide": "function (d) {return !d.cropped}","self:fs90": "function (d) {return d.filename.length<20}","self:fs80": "function (d) {return d.filename.length>=20}"}},"#format": {"bind": "width","init": "function ($o) {\n\t\t\tvar that = this;\n\t\t\t$o.tags($.extend(true, {tagshim:'',groupshim:''},that.Lang.FORMAT_TAGS));\n\t\t}"},"#info": {"watch": "#fname,#format","css": {"self:hide": "function (d) {return !d.cropped}"}},"#dims": {"bind": "function (d,v) {\n\t\t\tvar that = this,\n\t\t\t\t\twidth = d.width*(+d.expand || 1.7) | 0,\n\t\t\t\t\theight = width * (d.crop.h / d.crop.w) |0;\n\t\t\treturn width+'×'+height;\n\t\t}","watch": "#fname,#format","css": {"self:hide": "function (d) {return !d.cropped}"}},"#xscale": {"bind": "function (d) {\n\t\t\tvar scale = d.width*(+d.expand || 1.7) / (d.crop.w * d.scale);\n\t\t\treturn '<span class=\"{2}\">{1}×</span>'.assign(scale.round(1), scale<1.2?'':scale<1.5?'orange':scale<2?'red':'red fs120');\n\t\t}","watch": "#dims"},"#fsize": {"delay": 500,"bind": "function (d) {\n\t\t\tvar that = this,\n\t\t\t\t\ts, l, width,height, bpp;\n\t\t\tif (d.cropped) {\n\t\t\t\tl = that.Gen(true);\n\t\t\t\twidth = d.width*(+d.expand || 1.7) | 0,\n\t\t\t\theight = width * (d.crop.h / d.crop.w) |0;\n\t\t\t\tbpp = l*8 / width / height;\n\t\t\t\ts = l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\";\n\t\t\t\treturn '<span class=\"{2}\">{1}</span>'\n\t\t\t\t\t.assign(s, bpp < 2.5?'':bpp<4?'orange':bpp<6?'red':'red fs110');\n\t\t\t}\n\t\t}","watch": "#dims,#quality,#format"},"#ftitle": {"bind": "title","css": {"hide": "function (d) {return !d.title;}"}},"#file": {"bind": "function (d,v,$o) {\n\n\t\t\tvar that = this,\n\t\t\t\t\tf,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\timg=\"\",\n\t\t\t\t\t_prepareFname = that.Fname;\n\n\t\t\tif (v!=null && v) {\n\t\t\t\tf = $o[0].files[0];\n\t\t\t\tif (f) (function(){\n\t\t\t\t\td.filename = _prepareFname(f.name);\n\t\t\t\t\td.type = f.type;\n\t\t\t\t\t\n\t\t\t\t\tvar params = { \n\t\t\t\t\t\tnoRevoke:true, \n\t\t\t\t\t\tcanvas: true,\n\t\t\t\t\t\tpixelRatio: 1,\n\t\t\t\t\t\tdownsamplingRatio: 0.5,\n\t\t\t\t\t\tmaxWidth:3600,\n\t\t\t\t\t\tmaxHeight:2400\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// apply img\n\t\t\t\t\tvar _apply = function (ni) {\n\t\t\t\t\t\tvar st = $img.attr('style');\n\t\t\t\t\t\t$img = $(ni);\n\t\t\t\t\t\t$img.attr('style',st).removeClass(\"hide\");\n\t\t\t\t\t\t$r.find(\"#source\").replaceWith($img);\n\t\t\t\t\t\t$img.attr('id','source');\n\n\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\t\t\t\t\t\t\n\t\t\t\t\t\td.src.w = $img[0].width;\n\t\t\t\t\t\td.src.h = $img[0].height;\n\t\t\t\t\t\td.scale = d.src.w/$img.width();\n\n\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\taspectRatio: d.aspect,\n\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\tbgColor:'#e3e8eb',\n\t\t\t\t\t\t\tbgOpacity:0.2,\n\t\t\t\t\t\t\tminSize:[50,40],\n\t\t\t\t\t\t\tallowMove:true\n\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\tthis.animateTo([100,100,300,230]);\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.cropped = true;\n\t\t\t\t\t\tif (!d.enforceQuality) d.quality = d.type=='image/jpeg'?'0.90':'1';\n\t\t\t\t\t\t\n\t\t\t\t\t\tthat.my.recalc('#fname');\n\t\t\t\t\t\tthat.my.check('#fname');\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tloadImage.parseMetaData(f, function(data) {\n\t\t\t\t\t\tif (data.exif) params.orientation = data.exif.get('Orientation');\n\t\t\t\t\t\tloadImage(f, _apply, params);\n\t\t\t\t\t});\n\n\t\t\t\t})();\n\t\t\t} // end if\n\n\t\t\tfunction preview(c){\n\t\t\t\t$.extend(d.crop, Object.select(c,[\"x\",\"y\",\"w\",\"h\"]));\n\t\t\t\td.cropped=true;\n\t\t\t\tthat.my.check('#dims');\n\t\t\t\tthat.my.check('#quality');\n\t\t\t}\n\t\t}","events": "change.my"},"#btn-orig": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v !=null && d.filename) {\n\t\t\t\tvar f = $o.my(\"find\",\"#file\")[0].files[0];\n\t\t\t\tif (f) {\n\t\t\t\t\td.type=f.type;\n\t\t\t\t\td.filename = that.Fname(d.filename);\n\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\td.data = window.btoa(sb64.join(''));\n\t\t\t\t\t\t//console.log(d.type)\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t};\n\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}","events": "click.my","watch": "#fname","css": {":disabled": "function (d) {return !d.filename || d.filesize>3e6}"}},"#btn-apply": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null && d.cropped && d.filename) {\n\t\t\t\tthat.Gen(false);\n\t\t\t\t$o.my().root.trigger(\"commit\");\n\t\t\t}\n\t\t}","events": "click.my","watch": "#fname","css": {":disabled": "function (d) {return !d.filename}"}},"#btn-close": {"bind": "function (d,v,$o) {if (v!=null) $o.trigger(\"cancel\");}","events": "click.my"}},"style": {" ": "function () {\n\t\t\treturn (!this.data.gallery?{\n\t\t\t\t'#previewscont':{\n\t\t\t\t\t'':'height:440px',\n\t\t\t\t\t' #previews':'display:none!important;'\n\t\t\t\t},\n\t\t\t\t' #file':'height:500px!important;'\n\t\t\t}:{});\n\t\t}"," #format.tag-in-fmt .tag": "margin-right:0!important;"," .jcrop-holder": "display:inline-block;vertical-align:middle"," .previewcard": {"": "cursor:pointer;width:160px;display:inline-block;vertical-align:top;background-color:rgba(255,255,255,0);padding:5px;color:#bbb;transition: background 0.3s, color 0.3s;",":hover": "background-color:rgba(200,220,255,1);color:#69c;"," .previewcont": "line-height:150px; xborder:1px solid rgba(0,0,0,0.1);border-radius:2px;overflow:hidden;height:150px;width:150px;background:white;margin-bottom:6px;"," .previewcont img": "display:inline-block;vertical-align:middle;"," #iiname": "word-break: break-all;"}},"lang": {"en": {"BTN_UPLOAD": "Upload image...","FNAME_PLC": "Attachment file name","BTN_CROP": "Crop","BTN_ORIGINAL": "Insert original","BTN_CANCEL": "Cancel","FORMAT_TAGS": {"tags": [[{"value": "300","name": "<span class=\"t-left300\"></span>","title": "Aside floater"},{"value": "500","name": "<span class=\"t-left500\"></span>","title": "1/2 column"},{"value": "750","name": "<span class=\"t-left750\"></span>","title": "Column"},{"value": "1000","name": "<span class=\"t-left1000\"></span>","title": "Fullscreen"}]],"empty": {"value": "200","name": "<span class=\"t-left200\"></span>","title": "Small aside"}},"LBL_FSIZE": "File size ~"},"ru": {"BTN_UPLOAD": "Загрузить фото...","FNAME_PLC": "Имя файла","BTN_CROP": "Обрезать","BTN_ORIGINAL": "Вставить оригинал","BTN_CANCEL": "Закрыть","FORMAT_TAGS": {"tags": [[{"value": "300","name": "<span class=\"t-left300\"></span>","title": "Врезка"},{"value": "500","name": "<span class=\"t-left500\"></span>","title": "Полколонки"},{"value": "750","name": "<span class=\"t-left750\"></span>","title": "Колонка"},{"value": "1000","name": "<span class=\"t-left1000\"></span>","title": "На весь экран"}]],"empty": {"value": "200","name": "<span class=\"t-left200\"></span>","title": "Маленькая врезка"}},"LBL_FSIZE": "Размер файла ~"}},"Fname": "function (fname0,size) {\n\tvar fname = fname0+'',\n\t\t\tsfname = fname.split('.'),\n\t\t\tln = !isNaN(size)?+size:60;\n\tif (sfname.length>1)  {\n\t\tfname = sfname.to(-1).join('.').truncate(ln,'middle','_') + '.' +sfname.last().toLowerCase();\n\t} \n\telse fname = fname.toLowerCase().truncate(ln,'middle','_');\n\n\t// translit cyr and replace invalid chars\n\tvar cr = 'аa бb вv гg дd еe ёyo жzh зz иi йiy кk лl мm нn оo пp рr сs тt уu фf хh цts чch шsh щsch ъ- ыy ь- эe юyu яya'\n\t.split(\" \").reduce(function(a,b){\n\t\tvar key = b.to(1), val = b.from(1);\n\t\ta[key] = val;\n\t\ta[key.toUpperCase()] = val.toUpperCase();\n\t\treturn a; \n\t},{});\n\n\tfname = fname.split('').map(function(e){\n\t\tif (cr[e]) return cr[e];\n\t\telse if (!/[a-z0-9\\.\\-_~]/i.test(e)) return '-';\n\t\treturn e;\n\t}).join('').replace(/-+/g,'-').replace(/^_/,'');\n\n\treturn fname;\n}","Gen": "function (countOnly) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tf,\n\t\t\t//$r = $o.my().root,\n\t\t\t$c = that.my.find(\"#x1\"),\n\t\t\t$img = that.my.find(\"#source\"), \n\t\t\t$c2 = that.my.find(\"#x2\"),\n\t\t\tn={k:d.scale}, img=\"\",\n\t\t\twidth=d.width*(+d.expand || 1.7) | 0,\n\t\t\tquality = +d.quality || that.Quality(width) || 0.85,\n\t\t\ts;\n\t\n\tpreview(d.crop);\n\t\n\tif (+quality != 1) { \n\t\ts = that.my.find(\"#x1\")[0]\n\t\t.toDataURL('image/jpeg', quality)\n\t\t.substr(23);\n\t}\n\telse {\n\t\ts = that.my.find(\"#x1\")[0]\n\t\t.toDataURL('image/png', quality)\n\t\t.substr(22);\n\t}\n\t\n\tif (countOnly) return s.length/4*3|0;\n\t\t\n\td.filename = that.Fname(d.filename);\n\n\td.data = s;\n\n\td.type = +quality != 1?\"image/jpeg\":\"image/png\";\n\n\t//- - - - - - - - - - - -\n\n\tfunction preview (c){\n\t\tif(parseInt(c.w) > 0) {\n\t\t\t// Show image preview\n\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\tk = n.k,\n\t\t\t\t\tw = c.w*k|0 , // scale width/height\n\t\t\t\t\th = c.h*k|0; \n\t\t\tif (w>width*2) {\n\t\t\t\tcs2 = $c2[0];\n\t\t\t\tcs2.width=width*2;\n\t\t\t\tcs2.height=2*width*(h/w)|0;\n\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\tctx2.rect(0, 0, cs2.width, cs2.height);\n\t\t\t\tctx2.fillStyle='white';\n\t\t\t\tctx2.fill();\n\t\t\t\tctx2.drawImage(img, c.x*k |0, c.y*k|0, w, h, 0, 0, cs2.width, cs2.height);\n\n\t\t\t\tcs = $c[0];\n\t\t\t\tcs.width=width;\n\t\t\t\tcs.height=width*(h/w)|0;\n\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\tctx.drawImage(cs2, 0, 0, cs2.width, cs2.height, 0, 0, cs.width, cs.height);\n\t\t\t} else {\n\t\t\t\tcs = $c[0];\n\t\t\t\tcs.width=width;\n\t\t\t\tcs.height=width*(h/w)|0;\n\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\tctx.rect(0, 0, cs.width, cs.height);\n\t\t\t\tctx.fillStyle='white';\n\t\t\t\tctx.fill();\n\t\t\t\tctx.drawImage(img, c.x*k|0, c.y*k|0, w, h, 0, 0, cs.width, cs.height);\n\t\t\t}\n\t\t}\n\t}\n}"}},"queries": {"cards": {"map": "  function(doc){\n    \n    if (doc.type != 'inliner' || !isArray(doc.tags) || !doc.stamp || isNaN(doc.stamp)) return;\n    if (doc.crypto && doc.CRYPTO) return;\n    if (isArray(doc.owners) && doc.owners.length) return; \n    \n    var _hide   = ['Draft','Черновик'],\n        _tags   = {},\n        _hidden = false,\n        _keys   = [],\n        _key    = function(a){if(a)_keys.push(a)},\n        meta     = (doc.meta || {}),\n        alias   = (meta.alias || '').replace(/(^\\/+|\\/+$)/g,'').replace(/\\/+/g,'/'),\n        ms       = -doc.stamp;\n    \n    doc.tags.forEach(function(t){_tags[t.toLowerCase()] = true});\n    \n    // Case-insensitive search for tags to skip\n    for (var i = 0; i<_hide.length && !_hidden; i++) _hidden = _tags[_hide[i].toLowerCase()] || _hidden;\n    if (_hidden) return;\n    \n    var obj = {\n      title:  '',\n      desc:    '',\n      photo:  '',\n      logo:    '',\n      tags:    doc.tags,\n      link:{\n        mode:  ['link','header','image'],\n        text:  _eschtml(_untag(doc.name+'')),\n        url:  './'+doc._id\n      }\n    };\n    \n    // Title and description\n    obj = _merge(obj, _brief(doc));\n    \n    // Photo\n    var photo = _detectPreview(doc);\n    if (photo) obj.photo = doc._id+'/'+_uri(photo+'');\n    \n    // Logo\n    var logo = doc.meta?doc.meta.logo:null;\n    if (logo) obj.logo = /^http[s]?:/.test(logo)?logo:(doc._id+'/'+_uri(logo+''));\n\n    // String-type emit keys\n    [doc._id, 'doc/'+doc._id.substr(-8), alias].forEach(_key);\n\n    // Keys like ['tag' tag, -ts]]\n    Object.keys(_tags).forEach(function(tag){_key(['tag', tag, ms])});\n    \n    // Keys pointing on doc root ['path', root, -ts]\n    if (alias) {\n      var alpath = alias.split('/');\n      alpath.pop();\n      _key(['path','/'+alpath.join('/'), ms]);\n    }\n    else _key(['path','/doc', -ms]);\n    \n    // Author ['user', author, -ts]\n    if (isS(doc.creator)) _key(['user', doc.creator, ms]);\n    \n    // Emit all collected keys\n    _keys.forEach(function(key){emit(key, obj)});\n    \n    return;\n    \n    \n    //- - - - - - - - -\n    \n    function _brief(d) {\n      \n      // Builds brief from Inliner doc\n      \n      var h = '', head = 'h1',\n          res = {title:'', desc:''};\n      \n      d.content.forEach(function(e){\n        if (!/^(right|left200|left300)/.test(e.format+'')) {\n          if (e.type == 'img' || e.type == 'embed' && e.showDesc+'') h+=' '+e.desc;\n          else if (e.type == 'html') h+=' '+e.data;\n          else if (e.type == 'widget' && e.html) h+=' '+e.html;\n        }\n      });\n      \n      if (h.indexOf('</h1>')==-1) {\n        head = 'h2';\n        if (h.indexOf('</h2>')==-1) return {title:d.name, desc:d.desc||''};\n      }\n      \n      //return res;\n      \n      var a = h.split('</'+head+'>');\n      var t = _last(a[0].split('<'+head)).split('>').slice(1).join('>');\n      var p = _last(a.slice(1).join('</'+head+'>')\n      .replace(/<p>(|\\s+|&nbsp;|\\u00a0+|<br>)<\\/p>/g,'')\n      .split('</p>')[0].split('<p'))\n      .split('>').slice(1).join('>');\n      \n      res.title = _dehtml(t);\n      res.desc = _shy(_dehtml(p));\n      \n      return res;\n    }\n    \n    //- - - - - - - - -\n    \n    function _dehtml(s) {\n      return _compact(_untag(s.replace(/<br[\\/]?>/g,' ')).replace(/&nbsp;/g,' '));\n    }\n    \n    //- - - - - - - - -\n    \n    function _detectPreview(d){\n      \n      // Detects preview in Inliner doc\n      \n      var a = d._attachments;\n      if (a) {\n        if (a['preview.jpg']) return 'preview.jpg';\n        else if (a['preview.jpeg']) return 'preview.jpeg';\n        else if (a['preview.gif']) return 'preview.gif';\n        else if (a['preview.png']) return 'preview.png';\n        \n        var fname = null,\n            fdiff = 1e12;\n        \n        // Search for most relevant image for preview\n        if (d.previews) {\n          Object.keys(d.previews).forEach(function(i){\n            var dim = (d.previews[i].dim||'').match(/\\d+/g),\n                diff = Math.abs(800*600 - dim[0]*dim[1]);\n            if (dim[0]*dim[1]>300*200 && a[i] && diff<fdiff) {\n              fdiff = diff; fname = i;\n            } \n          });\n          if (fname) return fname;\n        }\n        \n        Object.keys(a).forEach(function(i){\n          if (!fname && /\\.(jp[e]?g|png)$/i.test(i)) fname = i;\n        });\n        \n        return fname;\n        \n      } else return null;\n    }\n    \n    //- - - - - - - - - - - - - -\n  \n    function _j(a) {return JSON.stringify(a);}\n    function _uri(s) {return encodeURIComponent(s);}\n    function _untag(s) {return s.replace(/<\\/?[^<>]*>/gi,'');}\n    function _compact(s) {return s.replace(/\\s+/gi,' ').replace(/^\\s+|\\s+$/g,'');}\n    function _eschtml(s) {\n      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')\n              .replace(/\"/g,'&quot;').replace(/'/g,'&apos;').replace(/\\//g,'&#x2f;');}\n    function _last(a) {return a[a.length-1];}\n    function isS(s) {return typeof s == 'string';}\n    \n    //- - - - - - - - - - - - - - \n    \n    function _merge(a,b){\n      for (var j=0,r={},args=[]; j<arguments.length; j++) args.push(arguments[j]);\n      for (j=0;j<args.length;j++) Object.keys(args[j]).forEach(function(i){r[i] = args[j][i];});\n      return r;\n    }\n    \n    //- - - - - - - - - - - - - - \n    \n    function _shy (s) {\n\n      // Hyphenates cyrillic text\n\n      var r1=\"$1ᴥ$2\",r2=r1+\"ᴥ\";\n      return (s+'').replace(/([а-яё])([\\.,;\\?\\!:])([а-яё])/gi,\"$1$2 $3\").split(/[\\s\\t\\r\\n]+/).map(function(w,ctr,a) { \n        if (w.length<6 ||  (ctr==a.length-1 && w.length<10)) return w;\n        var prefix=\"\", postfix=\"\",w1;\n        if (/^[^a-z0-9а-яё]/i.test(w)) prefix=w.substr(0,1);\n        if (/[^a-z0-9а-яё]$/gi.test(w)) postfix=_last(w);\n        return prefix+w\n          .replace(/^[^a-z0-9а-яё]|[^a-z0-9а-яё]$/gi,\"\")\n\n        //prefixes\n          .replace(/^(верх|ниж|зад)(не)/i,r2).replace(/^(су|ги)(пер)/i,r2)\n          .replace(/^(вяче|архан|про|вы|над|по(д)?|пара|бе[зс]о?|раз|лесо|круго|суб|за|журна|долго|ре([ск])?|транс|энерго|прези|пере|(ста|ме)ро)/i,\"$1ᴥ\")\n\n        //hyphener\n          .replace(/([а-яё]{2,}?[б-джзй-нп-тф-щ][аеёиоуыэюя])([аеёиоуыэюя][а-яё]+)/gi,r1)\n          .replace(/^([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ][аеёиоуыэюя])/gi,\"$1ᴥ$2ᴥ$3\")\n          .replace(/([аеёоуыэюя][б-джзй-нп-тф-щ][ъь])([б-джзй-нп-тф-щ][а-яё])/gi,r1)\n          .replace(/([аеёиоуыэюяйᴥ][б-джзй-нп-тф-щ])([б-джзк-нп-тф-щ][а-яё]?[аеёиоуыэюяй][а-яёᴥ]?)/gi,r1)\n          .replace(/^([оау][зщжшцйс])(ᴥ)/gi,\"$1\")\n          .replace(/([а-яё]{2}[аеёиоуыэюя])([б-джзк-нп-тф-щ][а-щыэ-яё])/gi,r1)\n          .replace(/([а-яё]{2}[б-джзк-нп-тф-щ])([аеёиоуыэюя][а-яё])/gi,r1)\n\n\n        //correctors\n          .replace(/(ᴥ)([б-джзй-нп-тф-щъь]+)$/i,\"$2\")\n          .replace(/(ᴥ)([йъьы])/gi,\"$2\")\n          .replace(/(ᴥ)([а-яё][лнтс]+ь)/gi,\"$2\")\n          .replace(/(ᴥ)(кала|убить)$/gi,\"$2\")\n          .replace(/([б-джзк-нп-тф-щ])(ᴥ)([аеёиоуыэюяй]{2})$/gi,\"ᴥ$1$3\")\n          .replace(/(ᴥ)([б-джзк-нп-тф-щ])(ᴥ)([б-джзк-нп-тф-щ])/gi,\"$1$2$4\")\n          .replace(/^([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ])(ᴥ)([аеёиоуыэюя][б-джзк-нп-тф-щ])/gi,\"$1ᴥ$2$4\")\n          .replace(/([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ])(ᴥ)([аеёиоуыэюя][б-джзк-нп-тф-щ])$/gi,\"$1ᴥ$2$4\")\n          .replace(/([б-джзк-нп-тф-щ][аеёиоуыэюя][б-джзк-нп-тф-щ])(ᴥ)([б-джзк-нп-тф-щ])([б-джзк-нп-тф-щ][аеёиоуыэюя]ᴥ[б-джзк-нп-тф-щ])/gi,\"$1$3ᴥ$4\")\n          .replace(/([б-джзк-нп-тф-щ]{2})([б-джзк-нп-тф-щ][ие])(ᴥ)([тн])([тн])([аеёиоуыэюя][аеёиоуыэюяй]?)$/gi,\"$1ᴥ$2$4ᴥ$5$6\")\n          .replace(/([б-джзк-нп-тф-щ])([б-джзк-нп-тф-щ])(ᴥ)([аиоуыэ][б-джзк-нп-тф-щ])(ᴥ)/gi,\"$1ᴥ$2$4$5\") //тр-иб- 2 т-риб-\n          .replace(/ᴥ([б-джзк-нп-тф-щ]{2})ᴥ/gi,\"$1ᴥ\") // - согл согл -\n          .replace(/^([б-джзк-нп-тф-щ]{2,})ᴥ/gi,\"$1\") //2+согл в начале слова\n          .replace(/(ᴥ)([б-джзк-нп-тф-щ])([б-джзк-нп-тф-щ]{3})/gi,\"$2$1$3\") //средства, сопутству...\n          .replace(/([а-яё])\\1ᴥ/gi,\"$1ᴥ$1\") //две одинаковых буквы\n          .replace(/ᴥ([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ])ᴥ([аеёиоуыэюя])([б-джзк-нп-тф-щ][аеёиоуыэюя])/gi,\"ᴥ$1ᴥ$2$3ᴥ$4\")    // нан-ана 2 на-на-на\n          .replace(/^(ра)ᴥ(з)/i,\"$1$2ᴥ\")\n          .replace(/([б-джзк-нп-тф-щ])ᴥ([еу])([ежзц])ᴥ/,\"ᴥ$1$2$3\")\n          .replace(/([б-джзк-нп-тф-щ]{2})([б-джзк-нп-тф-щ])(ᴥ)([эуюяыое][б-джзк-нп-тф-щ])/gi,\"$1ᴥ$2$4\")\n          .replace(/ᴥᴥ/gi,\"ᴥ\")\n          .replace(/ᴥ/g,\"\\u00ad\")+postfix;//\\u00ad\");\n      }).join(' ').replace(/\\s—\\s/g,\"\\u00a0– \");\n    }\n    \n  }"},"tags": {"map": "  function(doc){\n    \n    if (doc.type != 'inliner' || !isArray(doc.tags) || !doc.stamp || isNaN(doc.stamp)) return;\n    \n    var _tags   = {};\n    doc.tags.forEach(function(t){_tags[t] = true});\n    Object.keys(_tags).forEach(function(t){emit(t, 1);});\n    \n  }","reduce": "_count"}}},"raw": {"name": "Inliner","title": "Inliner","version": "4.0","build": 126,"com": [{"stamp": "1405141591656","id": "Root","type": "js","data": "({\n\t\n\t// Inliner 4.0\n\t// (c) ermouth\n\t\n\tVersion:\"4.0\",\n\t\n\tdata:{\n\t\tcmd:\"\",\n\t\tdoc:{\n\t\t\t_id:\"\", \n\t\t\ttype:\"inliner\", \n\t\t\tname:\"\", \n\t\t\tcreator:\"\", \n\t\t\towners:[],\n\t\t\tmeta:{},\n\t\t\tstyle:{},\n\t\t\tcontent:[{_stamp:\"1101\",type:\"html\",data:\"<p>Write your content<br></p>\"}],\n\t\t\tpreviews:{},\n\t\t\tstamp:\"\", \n\t\t\ttags:[], \n\t\t\tlog:[]\n\t\t},\n\t\tposts:{},\n\t\tkey:\"_\"\n\t},\n\t\n\tparams:{\n\t\trestyle:100,\n\t\tnavHeight:0\n\t},\n\t\n\tConfig:{ meta:{} },\n  \n  Lang:{},\n  AllTags:[],\n  \n  Cmd: function(a){return a?this.data.cmd == a:this.data.cmd},\n\t\n\tinit: function ($o, form){\n\t\t\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// Locale\n\t\t//if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\t//that.Lang = that.Lang[lang];\n    that.Lang = that.lang;\n\t\t\n\t\t// editor component container\n\t\t$o.formgen(that.HTML);\n\t\t\n\t\t// Parser\n\t\tif (!window.HTMLParser) that.HTMLParser(window);\n\t\t\n\t\t// Collapse content\n\t\tform.data.doc.content = that.CollapseItems(form.data.doc.content);\n\t\t\n\t\t// DB\n\t\tthat.Ed.db = that.db;\n\t\t\n\t\t// Cropper btns\n\t\tthat.Ed.Cropper.style[' .tag-in-fmt'] = Object.clone(that.style[' .tag-in-fmt'], true);\n    that.Ed.Cropper.Ed = Object.merge(that.Ed.Cropper.Ed || {}, {SVG:that.Ed.SVG});\n\t\t\n\t\t// Items\n\t\t//that.Editor.Items = $.extend(true, {}, that.T);\n\t\tthat.Ed.Items = that.T;\n\t\tthat.Ed.Items.img.Opts.style[' .tag-in-fmt'] =\n\t\tthat.Ed.Items.embed.Opts.style[' .tag-in-fmt'] = that.style[' .tag-in-fmt'];\n\t\t\n\t\t//enc key\n\t\tform.data.key= form.data.doc.crypto || \"_\";\n    \n   \n    $o.then(function(){\n       // hide Redactor panels on app hide/show\n      if (cw.lib.getref(that, ['app','watch','on'])) {\n        that.app.watch.on('progress',function(){\n        \t$('body>div.redactor_air').css({display:'none'});\n        });\n      };\n      \n      // Read tags\n      if (that.db && that.db.query) {\n        (function(){\n          that.db.query('Inliner/tags',{reduce:true, group_level:1})\n          .then(function(res){\n            var rows = res.rows || [];\n            rows.forEach(function(e){that.AllTags.push(e.key)});\n            if (that.AllTags.length) {\n              $o.find('#doctags').select2({\n                tags:\t\t\t\t\tthat.AllTags,\n                placeholder:\tthat.Lang.PLC_TAGS,\n                enable:\t\t\t\tthat.Cmd() != 'view'\n              });\n            }\n          })\n          .fail(function(){\n\n          });\n        }).debounce(500)();\n      }\n      \n    });\n\t},\t\n\t\n\tSessionUrls:{},\n\tdie: function($o){\n    var that = this;\n\t\t// Free resources \n\t\tvar u = that.SessionUrls||{};\n\t\tObject.keys(u).forEach(function(i){  URL.revokeObjectURL(u[i]); });\n\t\t\n\t\t// Unmount niceScroll if any\n\t\tif (!/Firefox/.test(navigator.userAgent)) $o.find('#meditor').getNiceScroll().remove();\n    \n    // off panel remover\n    if (cw.lib.getref(that, ['app','watch','off'])) {\n        that.app.watch.off('progress');\n    }\n\t},\n\tui:{ /* See tab */ },\n\tItems :{ /* See tabs */ }\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1462860724722","id": ".lang","type": "js","data": "// L10N\n({\n\ten:{\n\t\tBTN_CLEANUP:'Clean up',\n\t\tBTN_SAVE:'Save',\n\t\tBTN_CLOSE:'Close',\n\t\tBTN_TOHTML:'Generate HTML',\n\t\tBTN_ADDIMAGE:'Add image...',\n\t\tBTN_ACL:'Access control...',\n\t\t\n\t\tBTN_UNDO:'Undo',\n\t\tMSG_NO_UNDO:'Undo history is empty.',\n\t\t\n\t\tPLC_TAGS:'Add doc tags...',\n\t\tUPLOAD:'Upload file...'\n\t},\n  \n\tru:{\n\t\tBTN_CLEANUP:'Оптимизировать',\n\t\tBTN_SAVE:'Сохранить',\n\t\tBTN_CLOSE:'Закрыть',\n\t\tBTN_TOHTML:'Экспорт в HTML',\n\t\tBTN_ADDIMAGE:'Добавить фото...',\n\t\tBTN_ACL:'Контроль доступа...',\n\t\t\n\t\tBTN_UNDO:'Отменить',\n\t\tMSG_NO_UNDO:'История правок пуста.',\n\t\t\n\t\tPLC_TAGS:'Добавить теги...',\n\t\tUPLOAD:'Загрузить файл...'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1428809490306","id": ".ui","type": "js","data": "// editor, tags, crypto, photo cropper\n({\n\t\"#meditor\":{\n\t\tbind:\"doc\",\n\t\tmanifest:\"Ed\",\n\t\tinit: function($o){\n\t\t\tvar b = navigator.userAgent;\n\t\t\tif (/Mac.+Firefox/.test(b)) $o.css({overflow:'scroll'});\n\t\t\telse if (/iPad.+Safari/.test(b)) $o.css({overflow:\"scroll\",'-webkit-overflow-scrolling': 'touch'});\n\t\t\telse if (/Mac.+Chrome\\//.test(b)) $o.css({overflow:'overlay'});\n\t\t\telse if (/Mac.+Safari/.test(b)) $o.css({overflow:'overlay'});\n\t\t\telse if (!/Firefox/.test(b)) $o.niceScroll({zindex:7});\n\t\t}\n\t},\n\t\"#docid\":{\n\t\tbind:function(d) {\n\t\t\treturn (d.doc._id || '<span class=\"salmon\">not yet saved</span>');\n\t\t}\n\t},\n\t\"#doctags\":{\n\t\tdelay:50,\n\t\tbind: function(d,v){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\td.doc.tags = v;\n\t\t\t\tthat.my.restyle();\n\t\t\t}\n\t\t\treturn d.doc.tags;\n\t\t},\n\t\t//bind:\"doc.tags\",\n\t\tinit: function($o){\n\t\t\t$o.select2({\n\t\t\t\ttags:this.db&&this.db.tags?this.db.tags():[],\n\t\t\t\tplaceholder:this.Lang.PLC_TAGS,\n        enable:this.Cmd() != 'view'\n\t\t\t});\n\t\t},\n    css:{\n    \t':disabled':function(){return this.Cmd() == 'view'}\n    }\n\t},\n\t\"#encrypt\":{\n\t\tbind:function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\td.key=v;\n\t\t\t\tif (v!=\"_\") d.doc.crypto=v;\n\t\t\t\telse delete d.doc.crypto;\n\t\t\t}\n\t\t\treturn v||d.key;\n\t\t},\n\t\tinit: function($o) {\n\t\t\tvar a = [ {id:\"_\",name:\"No encryption\"} ];\n\t\t\tif (cw.crypto && cw.crypto.keys) a.add(cw.crypto.keys());\n\t\t\t$o.html(\n\t\t\t\ta.reduce(function(a,b){\n\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t},\"\")\n\t\t\t).select2({\n      \t enable:this.Cmd() != 'view'\n      });\n\t\t},\n    css:{\n    \t':disabled':function(){return this.Cmd() == 'view'},\n      hide: function() {return !cw.crypto || !cw.crypto.keys || !cw.crypto.keys().length;}\n    }\n\t},\n\t\"#btn-addphoto\":{\n\t\tbind: function(d,v, $o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\tthat.my.modal('#btn-addphoto',{\n\t\t\t\t\twidth:821,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tmanifest:$.extend(true, {Att:that.Att}, that.Ed.Cropper, {data:{gallery:false}}),\n\t\t\t\t\tdata:{}\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\tvar atts = d.doc._attachments,\n\t\t\t\t\t\t\tfname = res.filename;\n\t\t\t\t\n\t\t\t\t\tatts[fname] = {\n\t\t\t\t\t\tcontent_type:'image/jpeg',\n\t\t\t\t\t\tdata:res.data\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// gen preview\n\t\t\t\t\t\n\t\t\t\t\tvar $i = $('<img src=\"\"/>');\n\t\t\t\t\t$i.attr(\"src\", \"data:image/jpeg;base64,\"+res.data);\n\t\t\t\t\t$i.load(function(){\n\t\t\t\t\t\tvar ico = cw.lib.image($i,\"white\").resample(150),\n\t\t\t\t\t\t\t\tl = res.data.length/4*3 | 0,\n\t\t\t\t\t\t\t\tw = $i[0].naturalWidth,\n\t\t\t\t\t\t\t\th = $i[0].naturalHeight;\n\t\t\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height())\n\t\t\t\t\t\t\n\t\t\t\t\t\td.doc.previews[fname] = {\n\t\t\t\t\t\t\tfname:fname,\n\t\t\t\t\t\t\tsize:l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\",\n\t\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\t\t//dim:(res.width * res.expand | 0)+'×'+(res.width * res.expand / 4 * 3 | 0),\n\t\t\t\t\t\t\tdim:(w | 0)+'×'+(h | 0),\n\t\t\t\t\t\t\tdata:ico.sharpen(0.1).contrast(1.05).jpeg(0.7)\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\t$i.remove();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tthat.my.recalc('#atts');\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn that.Lang.BTN_ADDIMAGE;\n\t\t},\n\t\tevents:'click.my'\n\t\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1439842458268","id": ".ui","type": "js","data": "// btn-acl, btn-clean\n({\n\t\"#btn-acl\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest: that.ACL,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\towners:(Object.isArray(d.doc.owners)? d.doc.owners: [])\n\t\t\t\t\t\t.map(function(r) { return (r.to(2) == \"r-\")?\"=\"+r.from(2):r;})\n\t\t\t\t\t},\n\t\t\t\t\tnose:\"right\",\n\t\t\t\t\talign:\"right:105%\",\n\t\t\t\t\t//align:\"left:-20px\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs80 pt15\",\n\t\t\t\t\twidth:250,\n\t\t\t\t\tbound:0,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tclose:false\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\td.doc.owners = res.owners.map(function(r) { return (r.to(1) == \"=\")?\"r-\"+r.from(1):r;});\n\t\t\t\t\tthat.my.check('#btn-acl')\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (Object.isArray(d.doc.owners) && d.doc.owners.length) {\n\t\t\t\treturn d.doc.owners.join(', ');\n\t\t\t} else {\n\t\t\t\treturn that.Lang.BTN_ACL;\n\t\t\t}\n\t\t},\n\t\tevents:\"click.my\"\n\t},\n\t\"#btn-clean\":{\n\t\tdelay:150,\n\t\tbind: function(d,v,$o){\n\t\t\tvar that=this,\n\t\t\t\t\t\ta = d.doc.content;\n\t\t\tif (v!=null) {\n\t\t\t\ta.forEach(function(elt){\n\t\t\t\t\tif (elt.type==\"html\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telt.data = that.CleanHTML(elt.data);\n\t\t\t\t\t\t} catch (e){\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (elt.type==\"img\" || elt.type==\"embed\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telt.desc = that.CleanHTML(elt.desc);\n\t\t\t\t\t\t} catch (e){\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t//console.log(d.doc.content[0].data)\n\t\t\t\td.doc.content = that.CollapseItems(d.doc.content);\n\t\t\t\tcw.lib.note(\"Document cleaned.\",\"ok\");\n\t\t\t\t$o.my(\"find\",\"#meditor\").trigger(\"redraw\");\n\t\t\t}\n\t\t\treturn that.Lang.BTN_CLEANUP;\n\t\t},\n\t\tevents:\"click.my\"\n\t},\n\t/*\"#btn-export\":{\n\t\tbind:function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\troot:$o.parents(\".my-form\").eq(0),\n\t\t\t\t\tmanifest:$.extend({\n\t\t\t\t\t\tGetDoc: function(){return d.doc}\n\t\t\t\t\t},this.Export),\n\t\t\t\t\tbound:10,\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\talign:\"top:102%\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tcss:\"p25\",\n\t\t\t\t\tscreen:'rgba(255,255,255,0.5)'\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn that.Lang.BTN_TOHTML;\n\t\t},\n\t\tevents:\"click.my\"\n\t}*/\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1473316760258","id": ".ui","type": "js","data": "// btn-save, btn-close, btn-undo\n({\n\t\"#btn-savedoc\":{\n\t\tdelay:50,\n\t\tbind:function(d,v){\n\t\t\tvar that=this;\n\t\t\tif (v!=null) that.my.commit(\"#btn-savedoc\");\n\t\t\treturn that.Lang.BTN_SAVE;\n\t\t},\n\t\tevents:\"click.my\",\n    css:{\n    \t':disabled':function(){return this.Cmd() == 'view';}\n    }\n\t},\n\n\t\"#btn-closedoc\":{\n\t\tbind:function(d,v){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) that.my.cancel(\"#btn-closedoc\");\n\t\t\treturn that.Lang.BTN_CLOSE;\n\t\t},\n\t\tevents:\"click.my\"\n\t},\n  \n  '#docactions':{\n  \tcss:{\n    \thide:function(){return this.Cmd() == 'view';}\n    }\n  },\n\n\t\"#btn-undo\":{\n\t\tdelay:2,\n\t\tbind: function(d0,v,$o){\n\t\t\tvar that = this,\n\t\t\t\t\td = d0.doc, \n\t\t\t\t\tcth = {}, \n\t\t\t\t\tctchanged = false,\n\t\t\t\t\tstylechange = false;\n\n\t\t\tif (v!=null) {\n\n\t\t\t\tvar h = that.my.find('#meditor').my().params.history  || {},\n\t\t\t\t\t\thd0 = cw.lib.crc2(d),\n\t\t\t\t\t\tkeys = Object.keys(h).sortBy(),\n\t\t\t\t\t\tct,\n\t\t\t\t\t\tobj;\n\n\t\t\t\tif (keys.length) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (keys.length > 1 ) {\n\t\t\t\t\t\t\twhile (hd0 == cw.lib.crc2(h[keys.last()])) {\n\t\t\t\t\t\t\t\tdelete h[keys.last()];\n\t\t\t\t\t\t\t\tkeys.pop();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobj = h[keys.last()];\n\t\t\t\t\t\tvar ct = $.extend(true,[], obj.content),\n\t\t\t\t\t\t\t\tatts = $.extend(true,{}, obj._attachments||{}),\n\t\t\t\t\t\t\t\tstyle = $.extend(true,{}, obj.style||{}),\n\t\t\t\t\t\t\t\tpreviews = $.extend(true,{}, obj.previews||{});\n\t\t\t\t\t\tif (keys.length > 1 ) {\n\t\t\t\t\t\t\tdelete h[keys.last()];\n\t\t\t\t\t\t\tkeys.pop();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (ct) {\n\n\t\t\t\t\t// Content, only changes\n\n\t\t\t\t\td.content.forEach(function(e, i){\n\t\t\t\t\t\tvar hash = cw.lib.crc2(Object.reject(e, ['random']));\n\t\t\t\t\t\tcth[e._stamp] = {hash:hash, idx:i}\n\t\t\t\t\t});\n\t\t\t\t\td.content = ct.map(function(e){\n\t\t\t\t\t\tvar old, hash;\n\t\t\t\t\t\tif (old = cth[e._stamp]) {\n\t\t\t\t\t\t\thash = cw.lib.crc2(Object.reject(e, ['random']));\n\t\t\t\t\t\t\tif (old.hash == hash) return d.content[old.idx];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctchanged = true;\n\t\t\t\t\t\te.random = Number.random(1e6,1e7)+\"\"; \n\t\t\t\t\t\treturn e;\n\t\t\t\t\t});\n\n\t\t\t\t\t// Styles\n\t\t\t\t\tif (cw.lib.crc2(style) != cw.lib.crc2(d.style)) {\n\t\t\t\t\t\td.style = style;\n\t\t\t\t\t\tstylechange = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Attaches\n\n\t\t\t\t\tif (Object.size(atts)) {\n\t\t\t\t\t\td._attachments = atts;\n\t\t\t\t\t\td.previews = previews;\n\t\t\t\t\t} \n\t\t\t\t\telse {\n\t\t\t\t\t\td.previews = {};\n\t\t\t\t\t\tdelete d._attachments;\n\t\t\t\t\t}\n\n\t\t\t\t\tthat.my.recalc(\"#atts\");\n\t\t\t\t\tif (ctchanged || stylechange) that.my.recalc(\"#medium\");\n\t\t\t\t\tif (stylechange) that.my.restyle();\n\n\t\t\t\t} else {\n\t\t\t\t\tcw.lib.note(that.Lang.MSG_NO_UNDO)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn that.Lang.BTN_UNDO;\n\t\t},\n\t\tevents:\"click.my\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1472954920626","id": ".ui","type": "js","data": "// Attachments block\n({\n\t\"#atts\":{\n\t\tinit: function ($o, form) {\n\t\t\tvar that = this,\n\t\t\t\t\td = form.data.doc;\n\t\t\t$o.my(\"cw.Sys.Attachments\", {\n\t\t\t\tdoc:d,\n\t\t\t\ttruncate:20,\n\t\t\t\tpreviews:'previews',\n\t\t\t\tsort: function (attObj, fname){\n\t\t\t\t\t//sort by preview / name\n\t\t\t\t\tif ((that.data.doc.previews||{})[fname]) {\n\t\t\t\t\t\treturn \"01-\"+fname;\n\t\t\t\t\t}\n\t\t\t\t\tvar ext = fname;\n\t\t\t\t\t// filter hidden\n\t\t\t\t\treturn /^\\./.test(fname)?null:\"02-\"+ext;\n\t\t\t\t},\n\t\t\t\tico:function (fobj, fname){\n\t\t\t\t\tif (d.previews[fname]) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t'<div class=\"img-preview30\" ',\n\t\t\t\t\t\t\t'style=\"background-image:url('+d.previews[fname].data+');\"></div>'\n\t\t\t\t\t\t].join('');\n\t\t\t\t\t}\n\t\t\t\t\tvar css=\"fi-paperclip\",\n\t\t\t\t\t\t\ttypes={\n\t\t\t\t\t\t\t\t\"fi-photo\":/\\.(png|jp[e]?g|gif|tif[f]?|bmp)$/i,\n\t\t\t\t\t\t\t\t\"fi-social-adobe\":/\\.(pdf|ai|psd)$/i,\n\t\t\t\t\t\t\t\t\"fi-page-doc\":/\\.(doc[x]?|txt|rtf)$/i,\n\t\t\t\t\t\t\t\t\"fi-graph-pie\":/\\.(xls[x]?|csv)$/i,\n\t\t\t\t\t\t\t\t\"fi-archive\":/\\.(zip|rar|7z|7zip)$/i,\n\t\t\t\t\t\t\t\t\"fi-html5 pl2\":/\\.(htm[l]|php)$/i,\n\t\t\t\t\t\t\t\t\"fi-css3 pl2\":/\\.css$/i,\n\t\t\t\t\t\t\t\t\"fi-widget\":/\\.(js[on]?|php|asp|jar|c|erl)$/i,\n\t\t\t\t\t\t\t\t\"fi-sound\":/\\.(wav|aiff|mp3|ogg|mpeg3)$/i\n\t\t\t\t\t\t\t};\n\t\t\t\t\tif (!fobj.digest) css=\"orange fi-burst-new\";\n\t\t\t\t\telse Object.each(types, function(key, re){\n\t\t\t\t\t\tif (re.test(fname)) css=key;\n\t\t\t\t\t});\n\t\t\t\t\treturn '<span class=\"'+css+' dib vam o80 lh110\" style=\"width:1.3em;\"></span>';\n\t\t\t\t},\n\t\t\t\tnamePopup:true,\n\t\t\t\tupload:that.Cmd() != 'view'?'<div class=\"hoverlink gray\">'\n\t\t\t\t\t+'<span class=\"fi-paperclip fs105 mr2\"></span> '\n\t\t\t\t\t+'<span class=\"pseudolink\">'+that.Lang.UPLOAD+'</span>'\n\t\t\t\t\t+'</div>':false,\n        uploadCss:that.Cmd() != 'view'?'mt5':'hide',\n\t\t\t\tnoDelete: function(fname, doc){\n\t\t\t\t\t// this fn hides Del button for attaches in use\n\t\t\t\t\tvar no = false,\n\t\t\t\t\t\t\tpreview = doc.meta.preview || '';\n          if (that.Cmd() == 'view') return true;\n\t\t\t\t\tif (fname == preview) return true;\n\t\t\t\t\tdoc.content.forEach(function(e){\n\t\t\t\t\t\tif (e.type=='img' && e.ref == fname) no = true;\n\t\t\t\t\t\telse if (e.type=='widget' && e.bg == fname) no = true;\n\t\t\t\t\t\telse if (e.type=='widget') {\n\t\t\t\t\t\t\tvar it;\n\t\t\t\t\t\t\ttry {it=JSON.parse(e.data.replace(/^\\(|\\)$/g,''))} catch(err){}\n\t\t\t\t\t\t\tif (Object.isObject(it)) {\n\t\t\t\t\t\t\t\tif (e.source == \"Gallery\" || e.source == \"Files\") {\n\t\t\t\t\t\t\t\t\tvar j = it.items;\n\t\t\t\t\t\t\t\t\tif (Object.isArray(j) && j.length) {\n\t\t\t\t\t\t\t\t\t\tj.forEach(function(row){ if (row.url == fname) no = true; });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} // end gallery & files\n\t\t\t\t\t\t\t\telse if (e.source == \"Cards\") {\n\t\t\t\t\t\t\t\t\tvar j = it.items;\n\t\t\t\t\t\t\t\t\tif (Object.isArray(j) && j.length) {\n\t\t\t\t\t\t\t\t\t\tj.forEach(function(row){ if (row.photo == fname) no = true; });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} // end cards\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} // end widget check\n\t\t\t\t\t});\n\t\t\t\t\treturn no;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tbind: function (){}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1427576311979","id": ".style","type": "js","data": "({\n  /*\" #renderer\": function($form){\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tw = $form.width(),\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = + (this.params.navHeight || 0),\n\t\t\t\tcss = [\n          \"width:\"+(w)+\"px;\",\n          \"padding-left:0px;\",\n          \"height:\"+($(window).height()-(pad+nav+ofs))+\"px;\",\n          \"overflow:hidden\"\n        ].join('');\n\t\treturn css;\n\t},*/\n\t\" #meditor\": function($form){\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tw \t= $form.width(),\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = + (this.params.navHeight || 0),\n        view = this.Cmd() == 'view',\n\t\t\t\tcss = [\n          'width:{1}px;'\t\t\t\t.assign(w- (view?0:221)),\n          'padding-left:{1}px;'\t.assign(view?0:23),\n          'height:{1}px;'\t\t\t\t.assign($(window).height()-(pad+nav+ofs+15))\n        ].join('');\n\t\treturn css;\n\t},\n  ' #control':function(){\n    return this.Cmd()=='view'?'display:none!important;':'display:inline-block!important;';\n  },\n\t\" #atts\": function($form){\n\t\tvar ofs = $(\"#l-header\").is(\":visible\")?$(\"#l-header\").outerHeight(true)\n\t\t\t\t:$(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true)\n\t\t\t\t:0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\ttagsheight = $form.find('#s2id_doctags').height() || 35,\n\t\t\t\tactsheight = $form.find('#docactions').height() || 100,\n\t\t\t\th = $(window).height()-185-ofs-pad-tagsheight-actsheight;\n\t\t\n\t\treturn {\n\t\t\t' #att-flist':'overflow-y:scroll;overflow-y:overlay;-webkit-overflow-scrollingtouch; '\n\t\t\t+'transition:max-height 0.2s; max-height:'+h+'px;',\n\t\t\t\n\t\t\t' .img-preview30':'display:inline-block;vertical-align:top;width:36px;height:27px;overflow:hidden;'\n\t\t\t+'background-size:cover; background-position: 50% 50%;margin: 5px 5px 0 0;border-radius:1px;opacity:0.92;',\n\t\t\t\n\t\t\t' #att-fpanel':'border-top: 1px dotted rgba(108, 164, 205, 0.35);margin:10px 0 8px 0;',\n\t\t\t' .cw-att-desc':'font-size:11px;line-height:1.1em;margin-top:0px;opacity:0.8;'\n\t\t}\n\t},\n\t\" .nicescroll-rails\":\"z-index:50!important;\",\n\t\" .btn-l\": \"border-radius:3px 0 0 3px;\",\n\t\" .btn-r\": \"border-radius:0 3px 3px 0;\",\n\t\" .btn-c\": \"border-radius:0;\",\n\t\" .button\":\"outline:none!important\",\n\t\" .in-br0 .in-ct\":\"border-radius:0!important;\",\n\t\" .w78\":\"width:78px!important\",\n\t\" .w205\":\"width:205px\",\n\t\" .cw-hoverpane\":\"background-color: #f8fafc!important;\",\n\t\n\t\"\":\"font-size:19px\",\n\t\n\t//\" .my-modal.nose-top:before\": \"border: 1px solid rgba(168, 180, 195,0.6)!important; border-top: none;border-right: none;\",\n\t//\t\" .my-modal-overlay\": \"box-shadow: 0px 0px 0px 5px rgba(30, 66, 98, 0.16)!important;\",\n\t//\" .my-modal-overlay\": \"box-shadow: 0px 0px 0px 5px rgba(30, 66, 98, 0.16)!important;border-radius:1px!important;\",\n\t\n\t' .cw-item':'padding-bottom:0!important;',\n\t\n\t' .tag-in-fmt': {\n\t\t' .tag':{\n\t\t\t'':'display:inline-block;width:42px;height:32px;color:transparent!important;overflow:hidden;border-radius:1px!important;'\n\t\t\t+'padding:0!important; margin:0 3px 0 0!important;border:1px solid transparent; transition:border 0.3s;',\n\t\t\t':hover':'border-color:#fab',\n\t\t\t'.active':'border-color: rgb(166, 210, 235);background-color: #EAF9FF!important;',\n\t\t\t'.active:hover':'border-color: rgb(166, 210, 235);'\n\t\t},\n\t\t' .tag>span':{\n\t\t\t'':\"display:inline-block;width:40px;height:30px;background-position-y:0px;background-repeat:no-repeat;\",\n      ' ':function(){ \n        return 'background-image:url(\\'data:image/svg+xml;base64,'+cw.lib.base64(this.Ed.SVG.Options)+'\\');';\n      },\n\t\t\t\n\t\t\t'.t-left200':'background-position-x:0px;',\n\t\t\t'.t-left300':'background-position-x:-40px;',\n\t\t\t'.t-left500':'background-position-x:-80px;',\n\t\t\t'.t-left750':'background-position-x:-120px;',\n\t\t\t'.t-left1000':'background-position-x:-160px;',\n\t\t\t'.t-right300':'background-position-x:-200px;',\n\t\t\t'.t-right200':'background-position-x:-240px;',\n\t\t\t\n\t\t\t'.t-small':'background-position-x:-280px;',\n\t\t\t'.t-normal':'background-position-x:-320px;',\n\t\t\t'.t-large':'background-position-x:-360px;',\n\t\t\t\n\t\t\t'.t-background':'background-position-x:-400px;',\n\t\t\t'.t-frame':'background-position-x:-440px;',\n\t\t\t'.t-rules':'background-position-x:-480px;',\n\t\t\t'.t-accented':'background-position-x:-520px;'\n\t\t}\n\t}\n\n})","active": false,"opts": [],"err": [],"color": ["orange"]},{"stamp": "1441385073397","id": ".HTML","type": "js","data": "// App carcass\n([\n  //'<div id=\"renderer\" class=\"hide w100\"></div>',\n\t'<div id=\"meditor\" class=\"dib vat\"></div>',\n\t'<div id=\"control\" class=\"w200 vat ml20\">',\n\t\t{row:\"200px\",label:\"50px\",rowCss:\"my-row\"},\n\t\t['', \n\t\t //'but#btn-acl.tac.green.fs90.mr2.w40.btn-l.mt0',{txt:'<span class=\"fi-torsos\"></span>'},\n\t\t 'btn#btn-savedoc.tac.green.fs90.mr5.w100.pl0.pr0',{val:\"Save\"},\n\t\t 'btn#btn-closedoc.tac.fs90.w95.pl0.pr0',{val:\"Close\"}\n\t\t],\n\t\n\t\t//aux fields container\n\t\t'<div id=\"docaux\"></div>',\n\t\n\t\t//encrypt\n\t\t'<div class=\"mt10 nocwmin\"><select id=\"encrypt\" class=\"fs90 w200\"></select></div>',\n\t\n\t\t//tags\n\t\t'<div class=\"mt10 mb7\"><input type=\"text\" id=\"doctags\" class=\"fs80 w200\"></div>',\n\t\n\t\t//attachments\n\t\t'<div id=\"atts\" class=\"fs80 xgray\"></div>',\n\n\t\t'<div id=\"docactions\" class=\"lh130\">',\n\t\n\t\t\t// add image\n\t\n\t\t\t'<div class=\"hoverlink gray fs80\">'+\n\t\t\t\t'<span class=\"fi-crop ml-1 mr3\"></span> '+\n\t\t\t\t'<span id=\"btn-addphoto\" class=\"pseudolink\">Add image...</span>'+\n\t\t\t'</div>',\n\n\t\t\t// html generator\n\t\t\t/*'<div class=\"fs80 nocwmin gray hoverlink\">'+\n\t\t\t\t'<span class=\"fi-html5 mr3 ml1\"></span> '+\n\t\t\t\t'<span class=\"pseudolink\" id=\"btn-export\">Generate HTML</span>'+\n\t\t\t'</div>',*/\n\n\t\t\t// Cleaner\n\t\t\t'<div class=\"fs80 gray hoverlink\">'+\n\t\t\t\t'<span class=\"fi-check mr3\"></span> '+\n\t\t\t\t'<span class=\"pseudolink\" id=\"btn-clean\">Clean up</span>'+\n\t\t\t'</div>',\n\t\n\t\t\t// ACL\n\t\t\t'<div class=\"fs80 gray hoverlink\">'+\n\t\t\t\t'<span class=\"fi-torsos mr3\"></span> '+\n\t\t\t\t'<span class=\"pseudolink\" id=\"btn-acl\">Access control</span>'+\n\t\t\t'</div>',\n\n\t\t\t// Undo\n\t\t\t'<div class=\"fs80 gray hoverlink\">'+\n\t\t\t\t'<span class=\"fi-rewind mr4\"></span> '+\n\t\t\t\t'<span class=\"pseudolink\" id=\"btn-undo\">Undo</span>'+\n\t\t\t'</div>',\n\n\t\t'</div>',\n\n\t\t// _id\n\t\t'<div class=\"fs70 mt5 gray\">'+\n\t\t'_id: <span id=\"docid\"></span>'+\n\t\t'</div>',\n\t'</div>'\n])","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1458776945638","id": ".Att","type": "js","data": "// Attach URL generator\n(function (fname, rtype) {\n\n\t// Returns attach in appropriate format, defined by rtype,\n\t// \"url\" returns session or data URL,\n\t// \"data\" returns data URL.\n\t// If rtype is object {content_type:\"mime/type\", data:\"b64\"},\n\t// appends this object to doc attachments.\n\n\t// First arg can be obj {name:fname, type:type}\n\n\tvar that = this,\n\t\t\tu = that.SessionUrls || (that.SessionUrls = {}),\n\t\t\td = that.data.doc,\n\t\t\ta = d._attachments || (d._attachments = {}),\n\t\t\tpending = that.PendingUrls || (that.PendingUrls = {});\n\n\t// Store\n\tif (fname && Object.isObject(rtype)) {\n\t\ta[fname] = Object.select(rtype, ['content_type','data']);\n\t\tif (rtype.preview && d.previews) {\n\t\t\td.previews[fname] = rtype.preview;\n\t\t}\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t\treturn a;\n\t}\n\n\t// Recalc atts\n\tif (fname === true) {\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t}\n\n\tif (fname == null) return a;\n\t\n\tif (rtype == \"session\") return u;\n\n\tif (rtype==\"url\" && u[fname]) return u[fname];\n\telse {\n\t\tvar pi = $.Deferred(),\n\t\t\t\tid = that.data.doc._id,\n\t\t\t\tdb = that.db;\n\n\t\tif (!id) pi.reject();\n\t\telse {\n\n\t\t\t//-------------------\n\n\t\t\tif (rtype==\"url\") {\n\n\t\t\t\tif (a && a[fname] && a[fname].data && !a[fname].digest) {\n\t\t\t\t\treturn 'data:'+a[fname].content_type+';base64,'+a[fname].data;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (pending[fname]) {\n\t\t\t\t\tpi.resolve();\n\t\t\t\t\treturn pending[fname];\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tpending[fname] = pi.promise();\n\t\t\t\t\tcw.db(that.db.name)\n\t\t\t\t\t.getAttachment(id, fname+'')\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\tvar url = URL.createObjectURL(blob);\n\t\t\t\t\t\t\tu[fname] = url;\n\t\t\t\t\t\t\tpi.resolve(url);\n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(err){ \n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t\tpi.reject(); \n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//-------------------\n\n\t\t\telse if (rtype==\"data\") {\n\n\t\t\t\tif (a && a[fname] && a[fname].data) {\n\t\t\t\t\tpi.resolve (a[fname].data);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.db(that.db.name).getAttachment(id, fname+'')\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ pi.resolve(data); });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(); }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//-------------------\n\n\t\t\telse if (rtype == \"preview\") {\n\t\t\t\tvar names = [],\n\t\t\t\t\t\tres = [];\n\t\t\t\tif (Object.isString(fname)) names.push(fname);\n\t\t\t\telse if (Object.isArray(fname)) names = fname;\n\t\t\t\telse if (Object.isRegExp(fname)) {\n\t\t\t\t\tnames = Object.keys(a).filter(fname).sortBy();\n\t\t\t\t}\n\t\t\t\tif (!names.length) pi.resolve([]);\n\t\t\t\telse {\n\t\t\t\t\tvar icos = d.previews || (d.previews = {}),\n\t\t\t\t\t\t\tsubnames = Object.keys(icos).intersect(names);\n\t\t\t\t\tif (subnames.length == names.length) {\n\t\t\t\t\t\t// we have all previews\n\t\t\t\t\t\tnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// we have to generate previews\n\t\t\t\t\t\tsubnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar missing = names.subtract(subnames),\n\t\t\t\t\t\t\t\tpis = [];\n\t\t\t\t\t\t\n\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\tvar pi0 = $.Deferred();\n\t\t\t\t\t\t\tpis.push(pi0);\n\t\t\t\t\t\t\tif (a[i] && a[i].data) {\n\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, a[i].data, pi0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// load attach\n\t\t\t\t\t\t\t\tcw.db(that.db.name).getAttachment(id, i)\n\t\t\t\t\t\t\t\t.then (\n\t\t\t\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ \n\t\t\t\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, data, pi0);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfunction(){ pi0.resolve(null); }\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}); // end forEach\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now pis is list of promises\n\t\t\t\t\t\t$.when.apply(null, pis)\n\t\t\t\t\t\t.done(function(){\n\t\t\t\t\t\t\tfor (var t, j=0; j<arguments.length;j++) {\n\t\t\t\t\t\t\t\tvar t = arguments[j];\n\t\t\t\t\t\t\t\tif (t != null) icos[t.fname] = t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\t\tif (icos[i]) res.push(icos[i]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tres.sortBy('fname');\n\t\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn pi.promise();\n\n\t\t// - - - - - - - - - - - - - - - \n\n\t\tfunction _genPreview(name,mime, data, pi0){\n\t\t\tvar $i = $('<img src=\"\"/>'),\n\t\t\t\t\tpv = {\n\t\t\t\t\t\tfname:name,\n\t\t\t\t\t\tsize:'?',\n\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\tdim:'?×?',\n\t\t\t\t\t\tdata:''\n\t\t\t\t\t};\n\t\t\t$i.attr(\"src\",'data:'+mime+';base64,'+data);\n\t\t\t$i.load(function(){\n\t\t\t\tvar ico, \n\t\t\t\t\t\timg = cw.lib.image($i,\"white\");\n\t\t\t\tpv.dim = img.width() + '×'+ img.height();\n\t\t\t\tvar l = (data.length/4*3).round();\n\t\t\t\tpv.size = l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\";\n\t\t\t\tico = img.resample(150);\n\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height());\n\t\t\t\tpv.data = ico.sharpen(0.2).contrast(1.05).jpeg(0.65);\n\t\t\t\t$i.remove();\n\t\t\t\tpi0.resolve(pv);\n\t\t\t});\n\t\t} \n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1439588192516","id": ".CleanHTML","type": "js","data": "(function (s) {\n\n\tvar ctr = 0, res = _compress(s), res0;\n\twhile (ctr < 6 && res0 != res) {\n\t\tres0 = res;\n\t\tres = _compress(res);\n\t\tctr +=1\n\t}\n\t\n\tif (!res) res = '<p><br/></p>';\n\t\n\treturn res;\n\t\n\t\n\t//- - - - - - - - - - -\n\n\tfunction _compact(s){\n\t\treturn $('<span>'+s.replace(/[\\s\\n\\r\\t]+/g,' ')+'</span>').html()\n\t\t.replace(/(&nbsp;|\\s)(—|–|-{1,2})(&nbsp;|\\s)([а-яё])/ig,'\\u00A0– $4')\n\t\t.replace(/(&nbsp;|\\s)(—|–|-{1,2})(&nbsp;|\\s)([\\w])/ig,'\\u202F—\\u2006$4')\n\t\t.replace(/([\\w])(&nbsp;|\\s)(—|–|-{1,2})(&[a-z]+sp;|\\s)+/ig,'$1\\u202F—\\u2006')\n\t\t.replace(/([\\wа-яё0-9])'([\\wа-яё0-9])/ig,'$1’$2')\n\t\t.replace(/(&nbsp;|\\s)\"([а-яё])/gi,' «$2').replace(/([а-яё])\"(&nbsp;|\\s)/gi,'$1» ')\n\t\t.replace(/(&nbsp;|\\s)\"(\\w)/gi,' “$2').replace(/(\\w)\"(&nbsp;|\\s)/gi,'$1” ');\n\t}\n\t\n\t// - - - - - - - - - - - - - - - - - \n\n\tfunction _construct (tag, attrs, unary) {\n\n\t\tvar i, c={id:null}, h = '<'+tag;\n\t\t\n\t\tif (/^(p|table|h\\d|span|pre)$/.test(tag) && unary) return \"\";\n\t\t\n\t\tif (attrs && attrs.length) {\n\t\t\tfor (i=0;i<attrs.length;i++) {\n\t\t\t\tvar aname = attrs[i].name.toLowerCase(),\n\t\t\t\t\t\taval = _attr (tag, aname, attrs[i].escaped);\n\t\t\t\tif (aval) {\n\t\t\t\t\tc[aname] = aname+(attrs[i].value!=null?'=\"'+aval+'\"':'');\n\t\t\t\t}\n\t\t\t}\n\t\t\tObject.keys(c).forEach(function(e){ if (null!=c[e]) h+=\" \"+c[e]; });\n\t\t}\n\t\th+=unary?'/>':'>';\n\t\treturn h;\n\t}\n\n\t//- - - - - - - - - - -\n\t\n\tfunction _attr (tag, aname, v) {\n\t\tvar i,j,a, s = v;\n\t\t\n\t\tif (aname == \"style\") {\n\t\t\ta = v.split(\";\").compact(true).map(function(e){return e.compact(true)});\n\t\t\ta = a.reduce(function(a,b) {\n\t\t\t\tif (/(inherit|initial)/i.test(b)) return a;\n\t\t\t\tif (/^(color|background-color):/i.test(b)) a.push(b);\n\t\t\t\tif (/^(td|table|th|img)$/.test(tag) && /^width:/.test(b)) a.push(b);\n\t\t\t\tif (/^(p|td|table|h\\d|blockquote)$/.test(tag) && /^text-align:/.test(b)) a.push(b);\n\t\t\t\treturn a;\n\t\t\t},[]);\n\t\t\ts = a.join(\"; \").compact(true);\n\t\t}\n\t\telse if (aname == \"class\") {\n\t\t\t// not all tags allowed to have class\n\t\t\tif (/^(i|b|em|strong|tr|tbody|li|ul|ol)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == \"src\") {\n\t\t\tif (!/^(img)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == \"href\" || aname == \"target\") {\n\t\t\tif (!/^(a)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == \"rowspan\" || aname == \"colspan\") {\n\t\t\tif (!/^(td|th)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse if (aname == 'start') {\n\t\t\tif (!/^(ol)$/.test(tag)) s=\"\";\n\t\t}\n\t\telse {\n\t\t\tif (!/^(id|name)$/i.test(aname)) s='';\n\t\t}\n\t\t\n\t\treturn s;\n\t}\n\t\n\t//- - - - - - - - - - -\n\n\tfunction _compress (h){\n\n\t\tvar parse = window.HTMLParser,\n\t\t\t\tkeepSpace = [],\n\t\t\t\tstack=[],\n\t\t\t\tres=[];\n\n\t\tparse(h, {\n\t\t\tstart: function(tag, attrs, unary) {\n\t\t\t\tvar rt = tag.toLowerCase(),\n\t\t\t\t\t\tt = (stack.length || /^(p|h1|h2|h3|h4|table|blockquote|ul|ol|img|pre|hr)$/.test(rt))?rt:'p',\n\t\t\t\t\t\thtml = _construct(t, rt!=t?[]:attrs, unary),\n\t\t\t\t\t\tespan = html == '<span>';\n\t\t\t\tif(/^(p|blockquote|h\\d|pre)$/.test(t) && stack.length && stack.last().tag == t) {\n\t\t\t\t\tstack.last().closed = true;\n\t\t\t\t\tres.push('</'+t+'>');\n\t\t\t\t}\n\t\t\t\tres.push(espan?'':html);\n\t\t\t\tif (!unary) {\n\t\t\t\t\tif (/^(script|pre|textarea|code)$/.test(t)) {\n\t\t\t\t\t\tkeepSpace.push(true);\n\t\t\t\t\t}\n\t\t\t\t\tstack.push({tag:rt, attrs:attrs, closed:!html, retag:t!=rt?t:null, empty:true, espan:espan});\n\t\t\t\t} else {\n\t\t\t\t\tstack.forEach(function(elt){elt.empty = false});\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: function(tag) {\n\t\t\t\tvar a, s, process, type, src,\n\t\t\t\t\t\tt = tag.toLowerCase();\n\n\t\t\t\tif (/^(script|pre|textarea|code)$/.test(t)) keepSpace.pop();\n\t\t\t\t\n\t\t\t\tvar last = stack.pop();\n\t\t\t\tif (!last.closed) {\n\t\t\t\t\tif (last.empty && !last.espan) res.pop();\n\t\t\t\t\telse if (last.espan) res.push('');\n\t\t\t\t\telse res.push('</'+(last.retag || t)+'>');\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tchars: function(chars) {\n\t\t\t\t\n\t\t\t\tif (!stack.length) res.push('<p>');\n\n\t\t\t\tif (keepSpace.length) res.push (chars);\n\t\t\t\telse res.push (_compact(chars));\n\t\t\t\t\n\t\t\t\tif (!stack.length) res.push('</p>');\n\t\t\t\telse {\n\t\t\t\t\tstack.forEach(function(elt){elt.empty = false});\n\t\t\t\t}\n\t\t\t},\n\t\t\tdoctype: function(t) {res.push(t);},\n\t\t});\n\t\t\n\t\t//return res.join(\"\") .replace(/<p><\\/p>/g,'') .replace(/<p><br[\\/]?><\\/p>/g,'');\n\t\t\n\t\treturn $('<div>'+res.join(\"\") .replace(/<p><\\/p>/g,'') .replace(/<p><br[\\/]?><\\/p>/g,'') +'</div>').html();\n\t}\n\n\n\n\t//- - - - - - - - - - -\n\n\tfunction _compressJS (s0) {\n\t\tvar s = s0;\n\t\t// compress and uglify \n\t\tvar u = UglifyJS,\n\t\t\t\tast = u.parse(s+\"\");\n\t\tast.figure_out_scope();\n\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\tast.figure_out_scope();\n\t\tast.mangle_names();\n\t\treturn ast.print_to_string();\n\t}\n\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1473304125121","id": ".HTMLParser","type": "js","data": "(function(global) {\n\t/*\n\t\n\thttps://github.com/netgusto/htmlparser-jresig/blob/master/htmlparser-lib/htmlparser.js\n\t\n * HTML Parser By John Resig (ejohn.org)\n * Original code by Erik Arvidsson, Mozilla Public License\n * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js\n\n */\n\n\t(function(){\n\n\t\t// Regular Expressions for parsing tags and attributes\n\t\tvar startTag = /^<([\\w\\.\\-]+)((?:\\s+[\\w\\.\\-]+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?)*)\\s*(\\/?)>/,\n\t\t\t\tendTag = /^<\\/([\\w\\.\\-]+)[^>]*>/,\n\t\t\t\tattr = /([\\w\\.\\-]+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/g;\n\n\t\t// Empty Elements - HTML 4.01\n\t\tvar empty = makeMap(\"area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed\");\n\n\t\t// Block Elements - HTML 4.01\n\t\tvar block = makeMap(\"address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul\");\n\n\t\t// Inline Elements - HTML 4.01\n\t\tvar inline = makeMap(\"a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var\");\n\n\t\t// Elements that you can, intentionally, leave open\n\t\t// (and which close themselves)\n\t\tvar closeSelf = makeMap(\"colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr\");\n\n\t\t// Attributes that have their values filled in disabled=\"disabled\"\n\t\tvar fillAttrs = makeMap(\"checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected\");\n\n\t\t// Special Elements (can contain anything)\n\t\tvar special = makeMap(\"\");\n\n\t\tvar HTMLParser = this.HTMLParser = function( html, handler ) {\n\t\t\tvar index, chars, match, stack = [], last = html;\n\t\t\tstack.last = function(){\n\t\t\t\treturn this[ this.length - 1 ];\n\t\t\t};\n\n\t\t\twhile ( html ) {\n\t\t\t\tchars = true;\n\n\t\t\t\t// Make sure we're not in a script or style element\n\t\t\t\tif ( !stack.last() || !special[ stack.last() ] ) {\n\n\t\t\t\t\t// Comment\n\t\t\t\t\tif ( html.indexOf(\"<!--\") == 0 ) {\n\t\t\t\t\t\tindex = html.indexOf(\"-->\");\n\n\t\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\t\tif ( handler.comment )\n\t\t\t\t\t\t\t\thandler.comment( html.substring( 4, index ) );\n\t\t\t\t\t\t\thtml = html.substring( index + 3 );\n\t\t\t\t\t\t\tchars = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// end tag\n\t\t\t\t\t} else if ( html.indexOf(\"</\") == 0 ) {\n\t\t\t\t\t\tmatch = html.match( endTag );\n\n\t\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\t\tmatch[0].replace( endTag, parseEndTag );\n\t\t\t\t\t\t\tchars = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// start tag\n\t\t\t\t\t} else if ( html.indexOf(\"<\") == 0 ) {\n\t\t\t\t\t\tmatch = html.match( startTag );\n\n\t\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\t\tmatch[0].replace( startTag, parseStartTag );\n\t\t\t\t\t\t\tchars = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( chars ) {\n\t\t\t\t\t\tindex = html.indexOf(\"<\");\n\n\t\t\t\t\t\tvar text = index < 0 ? html : html.substring( 0, index );\n\t\t\t\t\t\thtml = index < 0 ? \"\" : html.substring( index );\n\n\t\t\t\t\t\tif ( handler.chars )\n\t\t\t\t\t\t\thandler.chars( text );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\thtml = html.replace(new RegExp(\"(.*)<\\/\" + stack.last() + \"[^>]*>\"), function(all, text){\n\t\t\t\t\t\ttext = text.replace(/<!--(.*?)-->/g, \"$1\")\n\t\t\t\t\t\t.replace(/<!\\[CDATA\\[(.*?)]]>/g, \"$1\");\n\n\t\t\t\t\t\tif ( handler.chars )\n\t\t\t\t\t\t\thandler.chars( text );\n\n\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t});\n\n\t\t\t\t\tparseEndTag( \"\", stack.last() );\n\t\t\t\t}\n\n\t\t\t\tif ( html == last )\n\t\t\t\t\tthrow \"Parse Error: \" + html;\n\t\t\t\tlast = html;\n\t\t\t}\n\n\t\t\t// Clean up any remaining tags\n\t\t\tparseEndTag();\n\n\t\t\tfunction parseStartTag( tag, tagName, rest, unary ) {\n\t\t\t\ttagName = tagName.toLowerCase();\n\n\t\t\t\tif ( block[ tagName ] ) {\n\t\t\t\t\twhile ( stack.last() && inline[ stack.last() ] ) {\n\t\t\t\t\t\tparseEndTag( \"\", stack.last() );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( closeSelf[ tagName ] && stack.last() == tagName ) {\n\t\t\t\t\tparseEndTag( \"\", tagName );\n\t\t\t\t}\n\n\t\t\t\tunary = empty[ tagName ] || !!unary;\n\n\t\t\t\tif ( !unary )\n\t\t\t\t\tstack.push( tagName );\n\n\t\t\t\tif ( handler.start ) {\n\t\t\t\t\tvar attrs = [];\n\n\t\t\t\t\trest.replace(attr, function(match, name) {\n\t\t\t\t\t\tvar value = arguments[2] ? arguments[2] :\n\t\t\t\t\t\targuments[3] ? arguments[3] :\n\t\t\t\t\t\targuments[4] ? arguments[4] :\n\t\t\t\t\t\tfillAttrs[name] ? name : \"\";\n\n\t\t\t\t\t\tattrs.push({\n\t\t\t\t\t\t\tname: name,\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tescaped: value.replace(/(^|[^\\\\])\"/g, '$1\\\\\\\"') //\"\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( handler.start )\n\t\t\t\t\t\thandler.start( tagName, attrs, unary );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction parseEndTag( tag, tagName ) {\n\t\t\t\t// If no tag name is provided, clean shop\n\t\t\t\tif ( !tagName )\n\t\t\t\t\tvar pos = 0;\n\n\t\t\t\t// Find the closest opened tag of the same type\n\t\t\t\telse\n\t\t\t\t\tfor ( var pos = stack.length - 1; pos >= 0; pos-- )\n\t\t\t\t\t\tif ( stack[ pos ] == tagName )\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\tif ( pos >= 0 ) {\n\t\t\t\t\t// Close all the open elements, up the stack\n\t\t\t\t\tfor ( var i = stack.length - 1; i >= pos; i-- )\n\t\t\t\t\t\tif ( handler.end )\n\t\t\t\t\t\t\thandler.end( stack[ i ] );\n\n\t\t\t\t\t// Remove the open elements from the stack\n\t\t\t\t\tstack.length = pos;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.HTMLtoXML = function( html ) {\n\t\t\tvar results = \"\";\n\n\t\t\tHTMLParser(html, {\n\t\t\t\tstart: function( tag, attrs, unary ) {\n\t\t\t\t\tresults += \"<\" + tag;\n\n\t\t\t\t\tfor ( var i = 0; i < attrs.length; i++ )\n\t\t\t\t\t\tresults += \" \" + attrs[i].name + '=\"' + attrs[i].escaped + '\"';\n\n\t\t\t\t\tresults += (unary ? \"/\" : \"\") + \">\";\n\t\t\t\t},\n\t\t\t\tend: function( tag ) {\n\t\t\t\t\tresults += \"</\" + tag + \">\";\n\t\t\t\t},\n\t\t\t\tchars: function( text ) {\n\t\t\t\t\tresults += text;\n\t\t\t\t},\n\t\t\t\tcomment: function( text ) {\n\t\t\t\t\tresults += \"<!--\" + text + \"-->\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn results;\n\t\t};\n\n\t\t/*this.HTMLtoDOM = function( html, doc ) {\n\t\t\t// There can be only one of these elements\n\t\t\tvar one = makeMap(\"html,head,body,title\");\n\n\t\t\t// Enforce a structure for the document\n\t\t\tvar structure = {\n\t\t\t\tlink: \"head\",\n\t\t\t\tbase: \"head\"\n\t\t\t};\n\n\t\t\tif ( !doc ) {\n\t\t\t\tif ( typeof DOMDocument != \"undefined\" )\n\t\t\t\t\tdoc = new DOMDocument();\n\t\t\t\telse if ( typeof document != \"undefined\" && document.implementation && document.implementation.createDocument )\n\t\t\t\t\tdoc = document.implementation.createDocument(\"\", \"\", document.implementation.createDocumentType('html', '', ''));\n\t\t\t\telse if ( typeof ActiveX != \"undefined\" )\n\t\t\t\t\tdoc = new ActiveXObject(\"Msxml.DOMDocument\");\n\n\t\t\t} else\n\t\t\t\tdoc = doc.ownerDocument ||\n\t\t\t\t\tdoc.getOwnerDocument && doc.getOwnerDocument() ||\n\t\t\t\t\tdoc;\n\n\t\t\tvar elems = [],\n\t\t\t\t\tdocumentElement = doc.documentElement ||\n\t\t\t\t\tdoc.getDocumentElement && doc.getDocumentElement();\n\n\t\t\t// If we're dealing with an empty document then we\n\t\t\t// need to pre-populate it with the HTML document structure\n\t\t\tif ( !documentElement && doc.createElement ) (function(){\n\t\t\t\tvar html = doc.createElement(\"html\");\n\t\t\t\tvar head = doc.createElement(\"head\");\n\t\t\t\thead.appendChild( doc.createElement(\"title\") );\n\t\t\t\thtml.appendChild( head );\n\t\t\t\thtml.appendChild( doc.createElement(\"body\") );\n\t\t\t\tdoc.appendChild( html );\n\t\t\t})();\n\n\t\t\t// Find all the unique elements\n\t\t\tif ( doc.getElementsByTagName )\n\t\t\t\tfor ( var i in one )\n\t\t\t\t\tone[ i ] = doc.getElementsByTagName( i )[0];\n\n\t\t\t// If we're working with a document, inject contents into\n\t\t\t// the body element\n\t\t\tvar curParentNode = one.body;\n\n\t\t\tHTMLParser( html, {\n\t\t\t\tstart: function( tagName, attrs, unary ) {\n\t\t\t\t\t// If it's a pre-built element, then we can ignore\n\t\t\t\t\t// its construction\n\t\t\t\t\tif ( one[ tagName ] ) {\n\t\t\t\t\t\tcurParentNode = one[ tagName ];\n\t\t\t\t\t\tif ( !unary ) {\n\t\t\t\t\t\t\telems.push( curParentNode );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar elem = doc.createElement( tagName );\n\n\t\t\t\t\tfor ( var attr in attrs ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telem.setAttribute( attrs[ attr ].name, attrs[ attr ].value );\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( structure[ tagName ] && typeof one[ structure[ tagName ] ] != \"boolean\" )\n\t\t\t\t\t\tone[ structure[ tagName ] ].appendChild( elem );\n\n\t\t\t\t\telse if ( curParentNode && curParentNode.appendChild )\n\t\t\t\t\t\tcurParentNode.appendChild( elem );\n\n\t\t\t\t\tif ( !unary ) {\n\t\t\t\t\t\telems.push( elem );\n\t\t\t\t\t\tcurParentNode = elem;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function( tag ) {\n\t\t\t\t\telems.length -= 1;\n\n\t\t\t\t\t// Init the new parentNode\n\t\t\t\t\tcurParentNode = elems[ elems.length - 1 ];\n\t\t\t\t},\n\t\t\t\tchars: function( text ) {\n\t\t\t\t\tcurParentNode.appendChild( doc.createTextNode( text ) );\n\t\t\t\t},\n\t\t\t\tcomment: function( text ) {\n\t\t\t\t\t// create comment node\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn doc;\n\t\t};*/\n\n\t\tfunction makeMap(str){\n\t\t\tvar obj = {}, items = str.split(\",\");\n\t\t\tfor ( var i = 0; i < items.length; i++ )\n\t\t\t\tobj[ items[i] ] = true;\n\t\t\treturn obj;\n\t\t}\n\t}).call(global);\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1439677529852","id": ".CollapseItems","type": "js","data": "(function (items) {\n\t// Collapses subsequent .type:\"html\n\t// items\n\t\n\tvar a =[];\n\titems.forEach(function(elt){\n\t\tif (!a.length) a.push(elt);\n\t\telse {\n\t\t\tif (\n\t\t\t\telt.type == \"html\" \n\t\t\t\t&& a.last().type==\"html\"\n\t\t\t\t&& (elt.css||[]).sortBy()+\"\" == (a.last().css||[]).sortBy()+\"\"\n\t\t\t) {\n\t\t\t\ta.last().data += elt.data;\n\t\t\t} \n\t\t\telse if (elt.type == \"html\") {\n\t\t\t\tif (elt.data && elt.data.compact()) a.push(elt);\n\t\t\t}\n\t\t\telse a.push(elt);\n\t\t}\n\t})\n\treturn a;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1536874103257","id": ".Scripts.Client","type": "js","data": "(function _InlinerGlobalInit (window){\n  \n  // Parallax and scroller initializer\n  // for Inliner-generated pages 4.0\n  \n  // Init: run this function before all Inliner-generated \n  // HTML page code\n\n  // Usage:\n  // Inliner.Parallax(['.selector1','.selector2'], { opts }) – applies parallax\n  // Inliner.Parallax(true) – recalculates parallax, needed if other elements change size\n  // Inliner.Parallax(false) – stops all parallax animators\n\n  // Requires Sugar.js 1.4.x and jQuery 2.x\n\n  if (!Object.isObject(window.Inliner)) window.Inliner = {};\n\n  (function(){\n\n    var I = window.Inliner,\n        hasYT = ('YT' in window),\n        Height = $(window).height(),\n        menuHeight = 0,\n        oCurr= 0,\n        oPrev = 0,\n        oMax = 0,\n        body0 = document.documentElement, \n        body1 = document.body,\n        frames = [],\n        stamp = -1,\n        dirty = false,\n        loopStarted = false,\n        _adjust = _readjust.debounce(200),\n        onTop;\n\n    // Scroller\n    I.ScrollToHash = function(){\n      var hash = (window.location.hash+'').replace(/^#/,''),\n          $p;\n      if (hash){\n        $p = $('#'+hash);\n        if ($p.length) {\n          $('body,html').animate({scrollTop:($p.offset().top-60).clamp(0,1e6)+'px'},250);\n        }\n      }\n    }\n\n    // a# links handler\t\n\n    $(function(){\t\t\n      $('body').on('click.my','a', function(){\t\t\n        var $a = $(this), $t,\t\t\n            href = $a.attr('href'),\n            href1 = href.split('#')[1],\n            l = window.location,\n            pa = (l+'').split('#'),\n            p = pa[0]+'#';\t\t\n        if (/^#.+/.test(href) || href.to(p.length) == p) {\t\t\n          $('body,html').animate({scrollTop:($('#'+href1).offset().top-60).clamp(0,1e6)+'px'},250);\n          window.location.hash = href1;\n          return false;\t\t\n        }\t\t\n      });\t\t\n    });\n\n    // Parallax\n\n    I.Parallax = function(a, options){\n\n      if (a===true) {\n        // readjust\n        _adjust();\n      }\n      else if (a===false) {\n        // Stop animations\n        $(document).off('scroll.in');\n        loopStarted = false;\n      }\n      else if (Object.isArray(a)) {\n        // Build by selector(s)\n        var $items = $(a.join(',')),\n            opts = $.extend(!0, {slow:3, menuHeight:0, onTop:''}, options || {});\n\n        Height = $(window).height();\n        menuHeight = opts.menuHeight;\n\n        if (opts.onTop && $(opts.onTop).size()) {\n          onTop = {\n            btn:$(opts.onTop)[0],\n            isOn:false\n          };\n          $(opts.onTop).on('click.in', function(){\n            $('body,html').animate({scrollTop:'0px'},200);\n            return false;\n          });\n        }\n\n        if ($items.size()) $items.each(function(){ _prepare($(this), opts); });\n\n        if (!loopStarted) _start();\n      }\n\n      return frames;\n\n    }; //-- end I.Parallax\n\n\n\n    // Window resize handler\n\n    $(window).on('resize.in', function(){\n      _readjust();\n      (2).times(_readjust.lazy(500));\n    }.debounce(100));\n\n\n    // image click handler\t\n\n    $(function(){\t\t\n      $('body').on('click.my','.in-zoomable .in--img-frame>img', function(){\t\t\n\n        var $i = $(this),\n            w,w0,\n            width,width0, \n            h,h0, \n            text;\n\n        text = $i.attr('alt') || $i.attr('title') || $i.data('text') || '';\n        w = $i[0].naturalWidth || $i[0].width;\n        h = $i[0].naturalHeight || $i[0].height;\n        if ($i.is('.in-zoomable.in-retina img')) {\n          w = w/2|0; h = h/2|0;\n        }\n        if (h<1) h=1;\n        if (w<1) w=1;\n        w0 = $(window).width()-90;\n        h0 = $(window).height()-90;\n        if (h0<h) w = (w*(h0/h))|0, h=h0;\n        if (w0<w) w=w0, h=(h*(w0/w))|0;\n        if (w<330) w = 330;\n        width=w<330?330:w;\n\n        $.my.modal({\n          manifest:{\n            id:'in.ImagePopup',\n            init: function($o){\n              $o.html(this.HTML);\n              $o.on('click.my','img:eq(0)', function(){\n                $o.trigger('cancel');\n              });\n            },\n            HTML:'<img src=\"\" class=\"db\" style=\"max-width:'+w+'px;max-height:'+h+'px\">'\n            +'<h4 class=\"mt10 tac\"></h4>',\n            ui:{\n              \"img:eq(0)\":\"img\",\n              \"h4\":{\n                bind:\"text\",\n                css:{hide:function(d,v){return !v;}}\n              }\n            }\n          },\n          data:\t\t{img:$i.attr('src'),text:text},\n          css:\t\t'p10',\n          esc:\t\ttrue,\n          screen:\ttrue,\n          width:\twidth0 || width,\n          focus:\tfalse,\n          global:\ttrue,\n          z:\t\t\t'1995'\n        });\n\n        //$.my.modal($(this), null);\n      });\t\t\n    });\n\n\n    return;\n\n\n    // ====================================================================\n\n    // Service functions\n\n    function _prepare($o, opts) {\n\n      // prepares item and grabs its metrics\n\n      var row;\n      if (!$o.data('inplx')){\n        // Image\n        if ($o.hasClass('in--img')) {\n          var $i = $o.find('img'),\n              src = $i.attr('src'),\n              $d = $o.find('.in--img-frame');\n          $o.find('.in-ct').css({overflow:'hidden'});\n          $d.css({\n            background:\"url('\"+src+\"') 50% 30% / cover no-repeat\",\n            'transition':'height 0.2s'\n          });\n          $i.remove();\n          row = {\n            type:\"img\",\n            item:$o,\n            frame:$d[0],\n            top:$o.offset().top,\n            height:Height - menuHeight,\n            stamp:Date.now(),\n            slow: opts.slow,\n            ofs:0\n          }\n          $d.height(row.height);\n        }\n\n        // Embed\n        else if ($o.hasClass('in--embed')) {\n          var $d = $o.find('.in--embed-frame');\n          $o.find('.in-ct').css({overflow:'hidden'});\n          $d.css({'transition':'height 0.2s'});\n          row = {\n            yt:$o.hasClass('in--embed-provider-youtube'),\n            type:\"embed\",\n            item:$o,\n            frame:$d[0],\n            top:$o.offset().top,\n            height:Height - menuHeight,\n            stamp:Date.now(),\n            slow: opts.slow,\n            ofs:0\n          }\n          $d.outerHeight(row.height, true);\n        }\n\n        // Widget\n        else if ($o.hasClass('in--widget')) {\n          var $d = $o.find('#xapp'),\n              bg = $o.css('background-image'),\n              $bg,\n              hm;\n          if (bg) {\n            hm = $d.outerHeight();\n            $d.css({'transition':'height 0.2s'});\n            $bg = $('<div></div>');\n            $bg.css({\n              position:'absolute', \n              width:'100%', \n              //height:'100%',\n              height:((hm + (Height - menuHeight - hm)/opts.slow) | 0)+'px', \n              top:0, left:0,\n              'background-size':'cover',\n              'background-position':'50% 50%',\n              'background-image':bg\n            });\n            $o.find('.in-ct').css({overflow:'hidden'}).prepend($bg);\n            $o.css({'background-image':''});\n\n            row = {\n              type:\t\t'widget',\n              item:\t\t$o,\n              frame:\t$bg[0],\n              top:\t\t$o.offset().top,\n              height:\thm,\n              local:\ttrue,\n              stamp:\tDate.now(),\n              slow: \topts.slow,\n              ofs:\t\t0\n            }\n          }\n        }\n        //-- end rules\n\n        // Stash row\n        if (row) {\n          $o.data('inplx', row.length);\n          frames.push(row);\n          if (oMax < row.top+row.height) oMax = row.top + row.height;\n        }\n      }\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _readjust(){\n      Height = $(window).height();\n      var maxOld = oMax;\n      frames.forEach(function(row){\n        row.top = row.item.offset().top;\n        if (!row.local && (Height - menuHeight != row.height || row.yt)) {\n\n          if (!row.yt) {\n            $(row.frame).outerHeight(Height - menuHeight, true);\n            row.height = Height - menuHeight;\n          }\n          else {\n\n            var w = row.item.width(),\n                $ct = row.item.find('.in-ct'),\n                $frame = $(row.frame),\n                ratio = 16/9;\n\n            $ct.height(Height - menuHeight);\n\n            if (w/(Height - menuHeight) > ratio) {\n              // too wide, increase height\n              $frame.css({'margin-bottom':''});\n              $frame.outerHeight(w/ratio|0, true);\n              $frame.css({width:'', 'margin-bottom':'-'+(w/ratio - Height + menuHeight |0)+'px'});\n            } else {\n              // too narrow, increase width\n              $frame.css({'margin-bottom':''});\n              $frame.outerHeight(Height - menuHeight, true);\n              $frame.width((Height - menuHeight)*ratio|0);\n            }\n          }\n        }\n        else if (row.local) {\n          row.height = row.item.outerHeight();\n          $(row.frame).css({height:((row.height + (Height - menuHeight - row.height)/row.slow) | 0)+'px'})\n        }\n        if (oMax < row.top+row.height) oMax = row.top + row.height;\n      });\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _loop() {\n\n      // Parallax\n\n      if (dirty) {\n        frames.forEach(function(row){\n          var ofs = 0;\n          if (oCurr >= row.top - Height/*Height-menuHeight*/ && oCurr <= row.top + row.height) {\n            \n            var sm = row.top,\n                s0 = oCurr,\n                hm = row.height,\n                hs = Height;\n            \n            if (Math.abs(Height - row.height - menuHeight) < 2) {\n              if (oCurr > row.top - Height) ofs = (oCurr - row.top + menuHeight) / row.slow | 0;\n              else ofs = 0;\n            } \n            else {\n              if (s0 >= sm - hs && s0 < sm + hm) ofs = (s0 - sm + menuHeight)/row.slow | 0;\n              else ofs = 0;\n            }\n\n            if (ofs != row.ofs) {\n              row.frame.style.transform = 'translateY('+ofs+'px)';\n              row.ofs = ofs;\n            }\n          }\n        });\n        oPrev = oCurr;\n        dirty = false;\n        \n        // On top button\n\n        var isOn;\n        if (onTop && (isOn = oCurr> Height/2) != onTop.isOn) {\n          onTop.btn.style.opacity = (onTop.isOn = isOn)?\"1\":\"0\";\n        }\n        \n      }\n\n      \n\n      window.requestAnimationFrame(_loop);\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _start(){\n\n      loopStarted = true;\n\n      if (typeof window.requestAnimationFrame == 'function' /*&& frames.length*/) {\n\n\n        $(document).on('scroll.in', function(){\n          var ofs = window.pageYOffset; //body0.scrollTop || body1.scrollTop;\n          if (ofs <= oMax && ofs != oPrev) dirty = true;\n          oCurr = ofs;\n        });\n\n        // run animation loop\n        _loop();\n\n        // run heights rescanner, to adjust for\n        // embeds started async\n\n        (3).times(_readjust.lazy(1000));\n      } \n    }\n\n  })();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1539135115310","id": ".Scripts.Client-old","type": "js","data": "(function _InlinerGlobalInit (window){\n  \n  // Parallax and scroller initializer\n  // for Inliner-generated pages 4.0\n  \n  // Init: run this function before all Inliner-generated \n  // HTML page code\n\n  // Usage:\n  // Inliner.Parallax(['.selector1','.selector2'], { opts }) – applies parallax\n  // Inliner.Parallax(true) – recalculates parallax, needed if other elements change size\n  // Inliner.Parallax(false) – stops all parallax animators\n\n  // Requires Sugar.js 1.4.x and jQuery 2.x\n\n  if (!Object.isObject(window.Inliner)) window.Inliner = {};\n\n  (function(){\n\n    var I = window.Inliner,\n        hasYT = (\"YT\" in window),\n        Height = $(window).height(),\n        menuHeight = 0,\n        oCurr= 0,\n        oPrev = 0,\n        oMax = 0,\n        body0 = document.documentElement, \n        body1 = document.body,\n        frames = [],\n        stamp = -1,\n        dirty = false,\n        loopStarted = false,\n        _adjust = _readjust.debounce(200),\n        onTop;\n\n    // Scroller\n    I.ScrollToHash = function(){\n      var hash = (window.location.hash+'').replace(/^#/,''),\n          $p;\n      if (hash){\n        $p = $('#'+hash);\n        if ($p.length) {\n          $('body,html').animate({scrollTop:($p.offset().top-60).clamp(0,1e6)+'px'},250);\n        }\n      }\n    }\n\n    // a# links handler\t\n\n    $(function(){\t\t\n      $('body').on('click.my','a', function(){\t\t\n        var $a = $(this), $t,\t\t\n            href = $a.attr('href'),\n            href1 = href.split('#')[1],\n            l = window.location,\n            pa = (l+'').split('#'),\n            p = pa[0]+'#';\t\t\n        if (/^#.+/.test(href) || href.to(p.length) == p) {\t\t\n          $('body,html').animate({scrollTop:($('#'+href1).offset().top-60).clamp(0,1e6)+'px'},250);\n          window.location.hash = href1;\n          return false;\t\t\n        }\t\t\n      });\t\t\n    });\n\n    // Parallax\n\n    I.Parallax = function(a, options){\n\n      if (a===true) {\n        // readjust\n        _adjust();\n      }\n      else if (a===false) {\n        // Stop animations\n        $(document).off('scroll.in');\n        loopStarted = false;\n      }\n      else if (Object.isArray(a)) {\n        // Build by selector(s)\n        var $items = $(a.join(',')),\n            opts = $.extend(!0, {slow:3, menuHeight:0, onTop:''}, options || {});\n\n        Height = $(window).height();\n        menuHeight = opts.menuHeight;\n\n        if (opts.onTop && $(opts.onTop).size()) {\n          onTop = {\n            btn:$(opts.onTop)[0],\n            isOn:false\n          };\n          $(opts.onTop).on('click.in', function(){\n            $('body,html').animate({scrollTop:'0px'},200);\n            return false;\n          });\n        }\n\n        if ($items.size()) $items.each(function(){ _prepare($(this), opts); });\n\n        if (!loopStarted /*&& frames.length*/) _start();\n      }\n\n      return frames;\n\n    }; //-- end I.Parallax\n\n\n\n    // Window resize handler\n\n    $(window).on('resize.in', function(){\n      _readjust();\n      (2).times(_readjust.lazy(500));\n    }.debounce(100));\n\n\n    // image click handler\t\n\n    $(function(){\t\t\n      $('body').on('click.my','.in-zoomable .in--img-frame>img', function(){\t\t\n\n        var $i = $(this),\n            w,w0,\n            width,width0, \n            h,h0, \n            text;\n\n        text = $i.attr('alt') || $i.attr('title') || $i.data('text') || '';\n        w = $i[0].naturalWidth || $i[0].width;\n        h = $i[0].naturalHeight || $i[0].height;\n        if ($i.is('.in-zoomable.in-retina img')) {\n          w = w/2|0; h = h/2|0;\n        }\n        if (h<1) h=1;\n        if (w<1) w=1;\n        w0 = $(window).width()-90;\n        h0 = $(window).height()-90;\n        if (h0<h) w = (w*(h0/h))|0, h=h0;\n        if (w0<w) w=w0, h=(h*(w0/w))|0;\n        if (w<330) w = 330;\n        width=w<330?330:w;\n\n        $.my.modal({\n          manifest:{\n            id:'in.ImagePopup',\n            init: function($o){\n              $o.html(this.HTML);\n              $o.on('click.my','img:eq(0)', function(){\n                $o.trigger('cancel');\n              });\n            },\n            HTML:'<img src=\"\" class=\"db\" style=\"max-width:'+w+'px;max-height:'+h+'px\">'\n            +'<h4 class=\"mt10\"></h4>',\n            ui:{\n              \"img:eq(0)\":\"img\",\n              \"h4\":{\n                bind:\"text\",\n                css:{hide:function(d,v){return !v;}}\n              }\n            }\n          },\n          data:{img:$i.attr(\"src\"),text:text},\n          css:'p10',\n          esc:true,\n          screen:true,\n          width:width0||width,\n          focus:false,\n          global:true,\n          z:\"1995\"\n        });\n\n        //$.my.modal($(this), null);\n      });\t\t\n    });\n\n\n    return;\n\n\n    // ====================================================================\n\n    // Service functions\n\n    function _prepare($o, opts) {\n\n      // prepares item and grabs its metrics\n\n      var row;\n      if (!$o.data('inplx')){\n        // Image\n        if ($o.hasClass('in--img')) {\n          var $i = $o.find('img'),\n              src = $i.attr('src'),\n              $d = $o.find('.in--img-frame');\n          $o.find('.in-ct').css({overflow:'hidden'});\n          $d.css({\n            background:\"url('\"+src+\"') 50% 30% / cover no-repeat\",\n            'transition':'height 0.2s'\n          });\n          $i.remove();\n          row = {\n            type:\"img\",\n            item:$o,\n            frame:$d[0],\n            top:$o.offset().top,\n            height:Height - menuHeight,\n            stamp:Date.now(),\n            slow: opts.slow,\n            ofs:0\n          }\n          $d.height(row.height);\n        }\n\n        // Embed\n        else if ($o.hasClass('in--embed')) {\n          var $d = $o.find('.in--embed-frame');\n          $o.find('.in-ct').css({overflow:'hidden'});\n          $d.css({'transition':'height 0.2s'});\n          row = {\n            yt:$o.hasClass('in--embed-provider-youtube'),\n            type:\"embed\",\n            item:$o,\n            frame:$d[0],\n            top:$o.offset().top,\n            height:Height - menuHeight,\n            stamp:Date.now(),\n            slow: opts.slow,\n            ofs:0\n          }\n          $d.outerHeight(row.height, true);\n        }\n\n        // Widget\n        else if ($o.hasClass('in--widget')) {\n          var $d = $o.find('#xapp'),\n              bg = $o.css('background-image'),\n              $bg,\n              hm;\n          if (bg) {\n            hm = $d.outerHeight();\n            $d.css({'transition':'height 0.2s'});\n            $bg = $('<div></div>');\n            $bg.css({\n              position:'absolute', \n              width:'100%', \n              //height:'100%',\n              height:((hm + (Height - menuHeight - hm)/opts.slow) | 0)+'px', \n              top:0, left:0,\n              'background-size':'cover',\n              'background-position':'50% 50%',\n              'background-image':bg\n            });\n            $o.find('.in-ct').css({overflow:'hidden'}).prepend($bg);\n            $o.css({'background-image':''});\n\n            row = {\n              type:\t\t'widget',\n              item:\t\t$o,\n              frame:\t$bg[0],\n              top:\t\t$o.offset().top,\n              height:\thm,//Height - menuHeight,\n              local:\ttrue,\n              stamp:\tDate.now(),\n              slow: \topts.slow,\n              ofs:\t\t0\n            }\n            //$d.outerHeight(row.height, true);\n          }\n        }\n        //-- end rules\n\n        // Stash row\n        if (row) {\n          $o.data('inplx', row.length);\n          frames.push(row);\n          if (oMax < row.top+row.height) oMax = row.top + row.height;\n        }\n      }\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _readjust(){\n      Height = $(window).height();\n      var maxOld = oMax;\n      frames.forEach(function(row){\n        row.top = row.item.offset().top;\n        if (!row.local && (Height - menuHeight != row.height || row.yt)) {\n\n          if (!row.yt) {\n            $(row.frame).outerHeight(Height - menuHeight, true);\n            row.height = Height - menuHeight;\n          }\n          else {\n\n            var w = row.item.width(),\n                $ct = row.item.find('.in-ct'),\n                $frame = $(row.frame),\n                ratio = 16/9;\n\n            $ct.height(Height - menuHeight);\n\n            if (w/(Height - menuHeight) > ratio) {\n              // too wide, increase height\n              $frame.css({'margin-bottom':''});\n              $frame.outerHeight(w/ratio|0, true);\n              $frame.css({width:'', 'margin-bottom':'-'+(w/ratio - Height + menuHeight |0)+'px'});\n            } else {\n              // too narrow, increase width\n              $frame.css({'margin-bottom':''});\n              $frame.outerHeight(Height - menuHeight, true);\n              $frame.width((Height - menuHeight)*ratio|0);\n            }\n          }\n        }\n        else if (row.local) {\n          row.height = $(row.frame).outerHeight();\n        }\n        if (oMax < row.top+row.height) oMax = row.top + row.height;\n      });\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _loop() {\n\n      // Parallax\n\n      if (dirty) {\n        frames.forEach(function(row){\n          var ofs = 0;\n          if (oCurr >= row.top - Height/*Height-menuHeight*/ && oCurr <= row.top + row.height) {\n\n            if (Math.abs(Height - row.height - menuHeight) < 2) {\n              if (oCurr > row.top - Height) ofs = (oCurr - row.top + menuHeight) / row.slow | 0;\n              else ofs = 0;\n            } \n            else {\n\n              // Scrolling in from the bottom\n              if ( oCurr < row.top - Height + row.height && oCurr < row.top ) {\n                ofs = (oCurr - row.top + Height - row.height) / row.slow | 0;\n              }\n\n              // Scrolling in from the top\n              else if ( oCurr >= row.top - menuHeight ){\n                ofs = (oCurr - row.top + menuHeight) / row.slow | 0;\n              }\n              else ofs = 0;\n            }\n\n            if (ofs != row.ofs) {\n              //row.frame.style.transform = 'translate3d(0,'+(ofs)+'px,0)';\n              row.frame.style.transform = 'translateY('+ofs+'px)';\n              row.ofs = ofs;\n            }\n          }\n        });\n        oPrev = oCurr;\n        dirty = false;\n        \n        // On top button\n\n        var isOn;\n        if (onTop && (isOn = oCurr> Height/2) != onTop.isOn) {\n          onTop.btn.style.opacity = (onTop.isOn = isOn)?\"1\":\"0\";\n        }\n        \n      }\n\n      \n\n      window.requestAnimationFrame(_loop);\n    }\n\n    //- - - - - - - - - - - - - - - - - - - -\n\n    function _start(){\n\n      loopStarted = true;\n\n      if (typeof window.requestAnimationFrame == 'function' /*&& frames.length*/) {\n\n\n        $(document).on('scroll.in', function(){\n          var ofs = window.pageYOffset; //body0.scrollTop || body1.scrollTop;\n          if (ofs <= oMax && ofs != oPrev) dirty = true;\n          oCurr = ofs;\n        });\n\n        // run animation loop\n        _loop();\n\n        // run heights rescanner, to adjust for\n        // embeds started async\n\n        (3).times(_readjust.lazy(1000));\n      } \n    }\n\n  })();\n})","active": false,"err": [],"opts": ["nocompile"],"color": []},{"stamp": "1405141909880","id": ".T.html","type": "js","data": "({\n\tid:\"cw.Inliner.Ed.Items.html\",\n\tparams:{strict:true},\n\t//Name:\"Text\",\n\tName:'<span class=\"fi-text-color fs120\" title=\"Add text\"></span>',\n\tTitle:\"\",\n\tdata:{ \t\n\t\ttype:\"html\",  \n\t\tdata:\"<p><br></p>\", \n\t\tformat:\"left750\",\n\t\tcss:[] \n\t},\n\tHoverpane:\"p h1 h2 h3 h4 h5 ul ol hr table blockquote div\"\n\t\t.split(\" \")\n\t\t.map(function(e){return \".in--html.in-item-nocss .redactor_box>.redactor_editor>\"+e})\n\t\t.add(\".in--html.in-item-hascss .redactor_box\")\n\t\t.join(\",\"),\n\tNoSelfInline:true,\n\tinit:function($o, form) {\n\t\t\n\t\tvar that = this,\n\t\t\t\td= form.data,\n\t\t\t\tdata = d.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle = that.Formats[fmt];\n\t\t\n\t\t$o.html([\n\t\t\t'<div id=\"formatter\" class=\"hide\"></div>',\n\t\t\t'<div class=\"in-ct xrd\">',\n\t\t\t'<textarea id=\"rd\" class=\"w100p\"></textarea>',\n\t\t\t'</div>'\n\t\t].join(\"\"));\n\n\t\t$o.addClass(\"in--html in-item \"+style.css);\n\t\tthat.Opts.Formats = that.Formats;\n\t},\n\tui:{\n\t\t\"#formatter\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tvar $r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\t\t\t\t\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--html in-item\");\n\t\t\t\t$r.addClass(fm.css);\n\t\t\t}\n\t\t},\n\t\t\"#rd\":{\n\t\t\tbind:\"data\",\n\t\t\tinit:function($o,d) {\n\t\t\t\t$o.redactor({\n\t\t\t\t\tair:true,\n\t\t\t\t\tminHeight:23,\n\t\t\t\t\tairButtons:['formatting', 'alignment', 'bold', 'italic', 'fixwidth', \n\t\t\t\t\t\t'deleted', 'table', \n\t\t\t\t\t\t'link', 'fontcolor', 'backcolor', \n\t\t\t\t\t\t'unorderedlist','orderedlist','outdent', 'indent', \"horizontalrule\"\n\t\t\t\t\t],\n\t\t\t\t\tfocus:d.data._new,\n\t\t\t\t\tformattingTags:[\"p\",\"blockquote\",\"pre\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\"],\n\t\t\t\t\tformatting:{\n\t\t\t\t\t\t\"code\":{title:\"Fixed\",exec:\"formatblock\",className:\"redactor_format_code\"}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdelete d.data._new;\n\t\t\t},\n\t\t\tdelay:20\n\t\t\t//watch:\"#watch\"\n\t\t}\n\t},\n\tFormats:{\n\t\tleft300:{css:\"in-item-small\"},\n\t\tleft750:{css:\"in-item-wide\"},\n\t\tleft1000:{css:\"in-item-max\"},\n\t\tright300:{css:\"in-item-small-right\"},\n\t\tright200:{css:\"in-item-tiny-right\"}\n\t},\n\tstyle:{\n\t\t/*\" .xrd\":\"min-width:50px;\",\n\t\t\" .redactor_box\":\"display:block; border:none;padding:0; background:none!important;margin:0 auto;\",\n\t\t\"  .redactor_box\":function(){\n\t\t\tvar that = this,\n\t\t\t\t\ts = that.RT().data.style;\n\t\t\treturn 'min-width:'+s.text.min+\";max-width:\"+s.text.max+\";\";\n\t\t},*/\n\t\t/*\" .redactor_editor\":{\n\t\t\t\"\":\"display:inline; border:none;padding:0; background:none!important;\",\n\t\t\t\"h1,h2,h3,h4,h5,h6\": \"padding: 0 !important;color: #333;\"\n\t\t\t\t+\"font-weight: bold;margin:0em 0 0.5em 0!important;line-height:1.2em!important;\",\n\t\t\t\"h4,h5,h6\":\"margin: 0.7em 0 0.2em 0!important;\",\n\t\t\t\"h4\":\"font-size:14pt!important;\",\n\t\t\t\"h2\":\"margin-top: 1.3em\",\n\t\t\t\"h4 span\":\"line-height:inherit!important;\",\n\t\t\t\"div,p,ul,ol,dl,blockquote\":\"font-size: 14pt;\",\n\t\t\t\"div,p,ol\":\"line-height: 1.6em;\",\n\t\t\t\"li\":\"line-height: 1.4em;margin-bottom:0.4em;\",\n\t\t\t\"pre\":\"margin:0em 0 0.9em 0!important;line-height:1.25em;font-size: 12pt;word-break: break-word;\",\n\t\t\t\n\t\t\t\"table\":\"margin:0.9em 0 0.9em 0!important;font-size:13pt; width:100%;\",\n\t\t\t\"td\":\"font-size:13pt; max-width:50%;min-width:2em;\",\n\t\t\t\" p\":{\n\t\t\t\t\" b\":\"font-size:1.05em\"\n\t\t\t}\n\t\t},*/\n\t\t/*\".in-accented\" :{\n\t\t\t\" .redactor_editor\":{\n\t\t\t\t\"h4\":\"font-size:17pt!important;\",\n\t\t\t\t\"div,p,ul,ol,dl,blockquote\":\"font-size: 17pt; line-height:1.4em;\",\n\t\t\t\t\"pre\":\"font-size: 13pt\",\n\t\t\t\t\"table\":\"font-size:14pt;\",\n\t\t\t\t\"td\":\"font-size:14pt; \"\n\t\t\t}\n\t\t},\n\t\t\".in-small\" :{\n\t\t\t\" .redactor_editor\":{\n\t\t\t\t\"h4\":\"font-size:12pt!important;\",\n\t\t\t\t\"div,p,ul,ol,dl,blockquote\":\"font-size: 12pt; line-height:1.4em;\",\n\t\t\t\t\"pre\":\"font-size: 10pt\",\n\t\t\t\t\"table\":\"font-size:10.5pt;\",\n\t\t\t\t\"td\":\"font-size:10.5pt; \"\n\t\t\t}\n\t\t}*/\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1459120903011","id": ".T.html.style","type": "js","data": "({\n\t'.in--html': function (){\n\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcma = 'margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ';\n\n\t\tr[''] = 'display:block; min-height:1em ;'+cma;\n\t\t\n\t\tr[' .in-ct'] = ctext + 'width:'+(s.text.width||'100%');\n\t\tr['.in-background .in-ct'] =\n\t\tr['.in-frame .in-ct'] = 'display:flex; width: auto;' + cbro;\n\t\t\n\t\tr['.in-rules .in-ct'] = 'display:flex; width: auto;';\n\t\t\n\t\tr[' .redactor_box'] = ctext + 'border:none;background:none!important';\n\t\t\n\t\tr['.in-rules .redactor_box'] = 'padding:'+inset+' 0!important;border-radius:0!important;'\n\t\tr['.in-background .redactor_box'] = \n\t\tr['.in-frame .redactor_box'] = 'padding:'+inset+'!important;' + cbro;\n\t\t\n\t\t\n\t\tr['.in-rules .redactor_editor :last-child'] = \n\t\tr['.in-frame .redactor_editor :last-child'] = \n\t\tr['.in-background .redactor_editor :last-child'] = 'margin-bottom:0!important;'\n\t\t\n\t\tr['.in-rules .redactor_editor :first-child'] = \n\t\tr['.in-frame .redactor_editor :first-child'] = \n\t\tr['.in-background .redactor_editor :first-child'] = 'margin-top:0!important;'\n\n\t\t\n\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-max'] = {\n\t\t\t'': 'width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';',\n\t\t\t' .in-ct':'width:100%; max-width:100%; margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t' .redactor_box':'max-width:100%;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-wide'] = {\n\t\t\t'': cbody,\n\t\t\t'.in-frame':'margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t'.in-background':'margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t'.in-rules':'margin-top:'+gap+'; margin-bottom:'+gap+'; ',\n\t\t\t' .redactor_box':'min-width:'+s.aside.tiny+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto; min-height:0; z-index:+2;',\n\t\t\t' .in-ct': 'min-width:'+s.aside.small+'; width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' -'+pl+';',\n\t\t\t' .redactor_box':'min-width:'+s.aside.small+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;min-height:0; z-index:+2;',\n\t\t\t' .in-ct': 'min-width:'+s.aside.small+'; width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t\t' .redactor_box':'min-width:'+s.aside.small+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-tiny-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;min-height:0; z-index:+2;',\n\t\t\t' .in-ct': 'min-width:'+s.aside.tiny+'; width:' + s.aside.tiny + '; float:right; clear:right; margin: 0 0 '+gap+ ' ' +gap+';',\n\t\t\t' .redactor_box':'min-width:'+s.aside.tiny+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .redactor_editor'] = 'display:inline;';\n\t\t\n\t\t\n\t\treturn r;\n\t\t\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1440113446473","id": ".T.html.Opts","type": "js","data": "({\n\tdata:{\n\t\tformat:[],\n\t\tcss:[]\n\t},\n\tparams:{width:320},\n\tlang:{\n\t\ten:{\n\t\t\tBTN_APPLY:'Apply',\n\t\t\tBTN_CANCEL:'Cancel',\n\t\t\tTITLE:'Text block settings'\n\t\t},\n\t\tru:{\n\t\t\tBTN_APPLY:'Применить',\n\t\t\tBTN_CANCEL:'Отмена',\n\t\t\tTITLE:'Настройки блока текста'\n\t\t}\n\t},\n\tCss:[],\n\tinit: function($o, form){\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\n\t\t$o.html($.my.formgen(that.HTML).assign(L));\n\t\t\n\t\tif (d.css.indexOf('Small')==-1 && d.css.indexOf('Large')==-1) d.css.push(\"Normal\");\n\t},\n\tui:{\n\t\t\"#format\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"#ecss\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"css\"\n\t\t},\n\t\t\"#btn-apply\":function(d,v,$o){\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.unique().remove(\"Normal\");\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":function(d,v,$o){if(v!=null)$o.trigger(\"cancel\")}\n\t},\n\tHTML:[\n\t\t{row:\"320px\", label:\"80px\", rowCss:\"my-row pb6\", labelCss:\"my-label fs90 gray\"},\n\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb0\"></div>',\n\t\t{rowCss:\"my-row mt5 ml3\"},\n\t\t['',\n\t\t\t'but#btn-apply.w120.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t'but#btn-cancel.w100',{txt:'{BTN_CANCEL}'}\n\t\t]\n\t],\n\tEcss:[]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1459897864942","id": ".T.html.To.html","type": "js","data": "(function (item, options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:''\n\t\t\t}, Object.isObject(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thtml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:''\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type ) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\t\n\tid = d._stamp || id;\n\t\n\tvar css=['in-item', 'in--'+d.type];\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\n\th = [\n\t\t'<div id=\"in-' + id + '\" class=\"'+css.join(' ')+'\">',\n\t\t\t'<div class=\"in-ct\">',\n\t\t\t\t'<div class=\"redactor_box\"><div class=\"redactor_editor\">',\n\t\t\t\t\t(d.data || '').removeTags('script embed iframe input textarea button'.split(' ')),\n\t\t\t\t'</div></div>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\tres.html = h;\n\t\n\treturn res;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1405142063068","id": ".T.img","type": "js","data": "({\n\tid:\"cw.Inliner.Ed.Items.img\",\n\t//Name:\"Pic\",\n\tName:'<span class=\"fi-photo fs105 mt1 mb-1 dib vat\" title=\"Add image\"></span>',\n\t//Hoverpane:\".floater-hotspot\",\n\tHoverpane:\".in--img-container\",\n\tdata:{type:\"img\", data:\"\", desc:\"<p><br/></p>\", format:\"left500\", showdesc:\"show\", css:[]}, \n\tFormats:{/* See tab */},\n\tinherit:[\"Att\"],\n\tinit: function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td= form.data,\n\t\t\t\tdata = d.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle = that.Formats[fmt];\n\n\t\t$o.html([\n\t\t\t'<div id=\"formatter\" class=\"hide\"></div>',\n\t\t\t//'<div class=\"floater-hotspot\"></div>',\n\t\t\t'<div class=\"in-ct in--img-container\">',\n\t\t\t'<div id=\"imageframe\" class=\"in--img-frame cw-imframe\" style=\"min-height:30px;\"></div>',\n\t\t\t'<div class=\"in--x-fader\"></div>',\n\t\t\t'<div id=\"descframe\" class=\"in--img-desc \"><textarea id=\"desc\" placeholder=\"Image text \"></textarea></div>',\n\t\t\t'</div>'\n\t\t].join(\"\"));\n\n\t\t$o.addClass(\"in-item \"+style.css);\n\n\t\tthat.Opts.Formats = that.Formats;\n\t},\n\tui:{\n\t\t\"#imageframe\":{ /* see tab */ },\n\t\t\"#formatter\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tvar $r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--img in-item\");\n\t\t\t\t$r.addClass(fm.css);\n\t\t\t}\n\t\t},\n\t\t\"#desc\":{\n\t\t\tdelay:50,\n\t\t\tbind:\"desc\",\n\t\t\tinit:function ($o) {\n\t\t\t\t$o.redactor({\n\t\t\t\t\tair:true,\n\t\t\t\t\tairButtons:['formatting', 'alignment','bold', 'italic', 'link', 'fontcolor'],\n\t\t\t\t\tfocus:false\n\t\t\t\t});\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"in--img-desc-empty\":function (d) {return \"\"===d.desc.stripTags().compact();},\n\t\t\t\t\"hide\":function (d) {return !(d.showdesc+\"\")}\n\t\t\t},\n\t\t\twatch:\"#imageframe,#showdesc\"\n\t\t}\n\t},\n\tCompiler: function ($f, shtml, ocss, orepo, man){\n\n\t\t// Compiles image\n\n\t\tvar that = this,\n\t\t\t\td = $f.my(\"data\");\n\n\t\tif (d.ref) {\n\t\t\t// we have attachment mount\n\n\t\t\tvar $src = $($f[0].outerHTML.replace(/contenteditable\\s?=\\s?\"true\"/g,\"\"));\n\t\t\t$src.find(\"textarea,input,select,button,.hide,.cw-hoverpane,.floater-hotspot\").remove();\n\t\t\t$src.find('img.cw-preview').attr(\"src\", that.Atts[d.ref]);\n\t\t\tshtml.push($src[0].outerHTML);\n\n\t\t\tthis.CSSCompiler($, ocss);\n\n\t\t}\n\t\telse {\n\t\t\t// Image is inlined, so all is easy\n\t\t\tthat.Compiler.call(that, $f, shtml, ocss, orepo, man);\n\t\t}\n\t},\n\tstyle:{\n\t\t\" .in--img-desc-empty:before\":\"content:\\\"Image description\\\";color:#bbb;font-size:90%;\"\n\t\t\t+\"position:absolute;z-index:-1;top:-3px;  pointer-events: none;\",\n\t\t'.in-item-max .in--img-desc-empty:before':'z-index:0;top:auto;bottom:1em;'\n\t\t\t+'color:white;text-shadow: 1px 0px 10px rgba(0,0,0,0.5);  pointer-events: none;'\n\t},\n\tFormats:{\n\t\tleft200:{css:\"in-item-tiny\"},\n\t\tleft300:{css:\"in-item-small\"},\n\t\tleft500:{css:\"in-item-medium\"},\n\t\tleft750:{css:\"in-item-wide\"},\n\t\tleft1000:{css:\"in-item-max\"},\n\t\tright300:{css:\"in-item-small-right\"},\n\t\tright200:{css:\"in-item-tiny-right\"}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1458773412744","id": ".T.img.ui.#imageframe","type": "js","data": "({\n\tbind:function(d,v,$o) {\n\t\tvar that = this;\n\t\tif (v!=null || d._new) {\n\t\t\tvar f = function(d){\n\t\t\t\t//console.log(d)\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend({Att:that.Att},that.Cropper),\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tdata:\"\",\n\t\t\t\t\t\tfilename:\"\", \n\t\t\t\t\t\twidth:(d.format+\"\").replace(/\\D/g,\"\")\n\t\t\t\t\t},\n\t\t\t\t\twidth:1031,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true,\n\t\t\t\t\tesc:true\n\t\t\t\t}).then(function (crop) {\n\t\t\t\t\tif (Object.isObject(crop)) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar a = that.Att(null),\n\t\t\t\t\t\t\t\tnewatt = false,\n\t\t\t\t\t\t\t\tmime,\n\t\t\t\t\t\t\t\tfname;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// New image\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!crop.ref) {\n\t\t\t\t\t\t\tif (crop.data.length) {\n\t\t\t\t\t\t\t\tfname = crop.filename;\n\t\t\t\t\t\t\t\tmime = crop.type;\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t!/^[a-z0-9\\-\\._~]{1,30}\\.(jp[e]?g|gif|png)$/i.test(fname)\n\t\t\t\t\t\t\t\t) fname = cw.lib.hash8(fname+Date.now())+'.'+mime.split(\"/\").last().split(\"+\")[0];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tthat.Att(fname, {\n\t\t\t\t\t\t\t\t\tcontent_type:mime,\n\t\t\t\t\t\t\t\t\tdata:crop.data\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tnewatt = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcrop.ref = fname;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Existing image\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (crop.ref) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tmime = mime || a[crop.ref].content_type;\n\t\t\t\t\t\t\td.ref = crop.ref;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Load image and prepare preview\n\t\t\t\t\t\t\tthat.Att(d.ref, \"data\")\n\t\t\t\t\t\t\t.then(function(data){\n\t\t\t\t\t\t\t\tvar $i = $('<img src=\"\"/>');\n\t\t\t\t\t\t\t\t$i.attr(\"src\", \"data:\"+mime+\";base64,\"+data);\n\t\t\t\t\t\t\t\t$i.load(function(){\n\t\t\t\t\t\t\t\t\tvar ico = cw.lib.image($i,\"white\"),\n\t\t\t\t\t\t\t\t\t\t\tdim = ico.width()+'×'+ico.height();\n\t\t\t\t\t\t\t\t\tico.resample(150);\n\t\t\t\t\t\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height())\n\t\t\t\t\t\t\t\t\tcrop.type = \"image/jpeg\";\n\t\t\t\t\t\t\t\t\t_refresh(ico.sharpen(0.1).contrast(1.05).jpeg(0.65), dim);\n\t\t\t\t\t\t\t\t\t$i.remove();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} \n\t\t\t\t\t\t\n\t\t\t\t\t\t//- - - - - - - -\n\t\t\t\t\t\t\n\t\t\t\t\t\tfunction _refresh(data, dim) {\n\t\t\t\t\t\t\t$o.html(\"\");\n\t\t\t\t\t\t\t$('<img class=\"cw-preview\" src=\"\"/>')\n\t\t\t\t\t\t\t.attr(\"src\",data)\n\t\t\t\t\t\t\t.appendTo($o);\n\t\t\t\t\t\t\td.data=data.split(\"base64,\")[1];\n\n\t\t\t\t\t\t\tif (newatt) {\n\t\t\t\t\t\t\t\td.format=\"left\"+crop.width;\n\t\t\t\t\t\t\t\tvar l = crop.data.length/4*3 |0;\n\t\t\t\t\t\t\t\tthat.Att(fname, {\n\t\t\t\t\t\t\t\t\tcontent_type:mime,\n\t\t\t\t\t\t\t\t\tdata:crop.data,\n\t\t\t\t\t\t\t\t\tpreview:{\n\t\t\t\t\t\t\t\t\t\tfname:fname,\n\t\t\t\t\t\t\t\t\t\tsize: l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\",\n\t\t\t\t\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\t\t\t\t\tdim:dim,\n\t\t\t\t\t\t\t\t\t\tdata:data\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcrop.data=\"\";\n\t\t\t\t\t\t\tthat.my.redraw();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}.fill(d);\n\t\t\tif (d._new) f.delay(250);\n\t\t\telse f();\n\t\t\tif (d._new) delete d._new;\n\t\t}\n\t\tif (d.data) {\n\t\t\t\n\t\t\tif (d.ref) {\n\t\t\t\tvar p = that.Att(d.ref, \"url\");\n\t\t\t\tif (Object.isObject(p) && p.then) {\n\t\t\t\t\tp.then(function(url){\n\t\t\t\t\t\t//console.log(url.to(100))\n\t\t\t\t\t\t$o.html('<img class=\"cw-preview\" src=\"'+url+'\" />');\n\t\t\t\t\t\t//that.my.redraw();\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse if (Object.isString(p)) {\n\t\t\t\t\treturn '<img class=\"cw-preview\" src=\"'+p+'\" />';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn '<img class=\"cw-preview\" src=\"data:image/jpeg;base64,'+d.data+'\" />';\n\t\t}\n\t\telse {\n\t\t\treturn ('<div class=\"w100p bg-lblue tac p30 fs80 blue\">'\n\t\t\t\t\t\t\t+'<span class=\"pseudolink\">Upload image...</span>'\n\t\t\t\t\t\t\t+'</div>');\n\t\t}\n\t},\n\tevents:\"click.my\",\n\tdelay:100\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1459075147457","id": ".T.img.style","type": "js","data": "({\n\t\".in--img\": function(){\n\t\t\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\t\t\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tgap2 = parseFloat(gap)/2+gap.replace(/[0-9\\.]/g,''),\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\t\t\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcl = 'clear:left; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ',\n\t\t\t\tchmgap = 'margin-top:'+gap2+';';\n\t\t\n\t\tr[''] = 'display:block; z-index:+2;';\n\t\t\n\t\tr[' .in-ct'] = 'margin-top:'+gap+'; margin-bottom:'+gap+'; ';\n\t\t\n\t\tr['.in-rules .in-ct'] = 'padding:'+inset+' 0!important;border-radius:0!important;' \n\t\tr['.in-background .in-ct'] =\n\t\tr['.in-frame .in-ct'] = 'padding:'+inset+'!important;' + cbro;\n\t\t\n\t\tr[' img'] = c100db + cbro;\n    \n    r['.in-zoomable img'] = 'cursor:zoom-in;';\n\t\t\n\t\tr['.in-rules img'] =\n\t\tr['.in-frame img'] = \n\t\tr['.in-background img'] = 'border-radius:'+s.corner.inner+'; ';\n\t\t\n\t\tr[' .in--img-desc p:last-child'] = 'margin-bottom:0!important;';\n\t\t\n\t\tr[' .floater-hotspot'] = 'width:100%';\n\t\tr[' .in--x-fader'] = 'pointer-events:none;';\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tvar wmax = 'width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';';\n\t\tr['.in-item-max'] = {\n\t\t\t'': wmax,\n\t\t\t' .in-ct':'width:100%;'+cpad,\n\t\t\t//' .in--img-desc': ctext+cpad,\n\t\t\t' .in--img-desc':{\n\t\t\t\t'': cbody+cb+'; margin:0 auto;',\n\t\t\t\t' .redactor_box':{\n\t\t\t\t\t'':cbody + 'width:'+(s.text.width||'100%')+';position:absolute;bottom:'+gap+';',\n\t\t\t\t\t'h1,h2':'margin-bottom:0.2em!important;'\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t' img':'border-radius:0;',\n\t\t\t' .in--img-frame':wmax,\n\t\t\t'+.in--img.in-item-max':{\n\t\t\t\t'':'border-top:2px solid white;',\n\t\t\t\t' .in-ct':'margin-top:-'+gap+';'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-wide'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t' .in--img-desc': 'max-width:80%;'+chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':'width:100%'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-medium'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t'>img':'width:70%;'+ cdibvat,\n\t\t\t' .in--img-frame':'width:70%;'+ cdibvat,\n\t\t\t' .in--img-desc': {\n\t\t\t\t'':'width:30%; margin:-1px 0 0 0; padding-left:'+gap+';' + cdibvat ,\n\t\t\t\t' :first-child': 'margin-top:0!important;',\n\t\t\t\t' .redactor_editor :first-child': 'margin-top:0!important;',\n\t\t\t},\n\t\t\t' .floater-hotspot':'width:30%; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' 0;',//' -'+pl+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; right:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-tiny'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.tiny + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' 0;',// -'+pl+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.tiny + '; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-tiny-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;',\n\t\t\t' .in-ct': 'width:' + s.aside.tiny + '; float:right; clear:right; margin: 0 0 '+gap+ ' ' +gap+';',\n\t\t\t' .in--img-desc': c100db + chmgap,\n\t\t\t'>img':c100db,\n\t\t\t' .in--img-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.tiny + '; right:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .redactor_box'] = 'width:100%; display:block; border:none; padding:0; '\n\t\t\t+'background:none!important;z-index:+3;min-height:1em;';\n\n\t\tr[' .redactor_editor'] = 'display:block; min-height:1em;';\n\t\t\n\t\treturn r;\n\t\t\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1459901151930","id": ".T.img.To.html","type": "js","data": "(function (item, options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:''\n\t\t\t}, Object.isObject(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thtml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:''\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\t\n\tif (!d.ref && !d.data) {\n\t\tres.err.push('Error: ' + that.data.type + ' has no data to render.');\n\t\treturn res;\n\t}\n\t\n\tid = d._stamp || id;\n\t\n\tvar css=['in-item', 'in--'+d.type];\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\n\tvar url='';\n\t\n\tif (d.ref) {\n\t\t\n\t\tif (/^http[s]?:/.test(d.ref) || d.ref.to(1)=='/') url = d.ref;\n\t\telse {\n\t\t\tif (opts.Urls) {\n\t\t\t\turl = opts.Urls[d.ref];\n\t\t\t} else {\n\t\t\t\turl = opts.path+d.ref;\n\t\t\t}\n\t\t}\n\t\n\t} else {\n\t\turl = \"data:image/jpeg;base64,\"+d.data;\n\t}\n\t\n\th = [\n\t\t'<div id=\"in-' + id + '\" class=\"'+css.join(' ')+'\">',\n\t\t\t'<div class=\"in-ct\">',\n\t\t\t\t'<div id=\"imageframe\" class=\"in--img-frame\">',\n\t\t\t\t\t'<img src=\"' + url +'\" alt=\"'\n\t\t\t\t\t+(d.showdesc+''=='show'?(d.desc+'').stripTags().truncate(100).escapeHTML():'')\n\t\t\t\t\t+'\">',\n\t\t\t\t'</div>',\n\t\t\t\t'<div class=\"in--x-fader\"></div>',\n\t\t\t\t(d.showdesc+''=='show'?[\n\t\t\t\t\t\t'<div id=\"descframe\" class=\"in--img-desc\">',\n\t\t\t\t\t\t'<div class=\"redactor_box\"><div class=\"redactor_editor\">',\n\t\t\t\t\t\t\t(d.desc || '').removeTags('script embed iframe input textarea button'.split(' ')),\n\t\t\t\t\t\t'</div></div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join(''):''),\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\tres.html = h;\n\t\n\treturn res;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1440177092002","id": ".T.img.Opts","type": "js","data": "({\n\tparams:{width:320},\n\tlang:{\n\t\ten:{\n\t\t\tBTN_APPLY:'Apply',\n\t\t\tBTN_CANCEL:'Cancel',\n\t\t\tTITLE:'Image settings',\n\t\t\tSHOWDESC:'Show item description',\n\t\t\tAUX_PLC:'Aux formatting...'\n\t\t},\n\t\tru:{\n\t\t\tBTN_APPLY:'Применить',\n\t\t\tBTN_CANCEL:'Отмена',\n\t\t\tTITLE:'Настройки фото',\n\t\t\tSHOWDESC:'Показывать текст к фото',\n\t\t\tAUX_PLC:'Дополнительные эффекты...'\n\t\t}\n\t},\n\tinit:function($o, form){\n\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\n\t\t$o.html($.my.formgen([\n\t\t\t{row:\"320px\", label:\"70px\", rowCss:\"my-row pb10\", labelCss:\"my-label fs90 gray\"},\n\t\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb3\"></div>',\n\t\t\t['', 'inp#css.w100p.fs100'],\n\t\t\t'<label class=\"fs90 ml4 xgray\"><input type=\"checkbox\" id=\"showdesc\" value=\"show\"> {SHOWDESC}</label>',\n\t\t\t{rowCss:\"my-row mt10 ml3\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w100.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t 'but#btn-cancel.w100',{txt:'{BTN_CANCEL}'}\n\t\t\t]\n\t\t]).assign(L));\n\n\t\tthis.Start = form.data.format + form.data.showdesc;\n\n\t\tvar a = ['small normal large', 'background frame rules','accented'],\n\t\t\t\tb = a.join(\" \")+\" \",\n\t\t\t\tecss = [],\n\t\t\t\tcss = [];\n\t\t\n\t\tvar c = (d.css||[]), isNormal = true;\n\t\tc.forEach(function(i){\n\t\t\tif (b.indexOf(i.toLowerCase()+\" \")>-1) ecss.push(i);\n\t\t\telse css.push(i);\n\t\t\tif (i==\"Small\" || i==\"Large\") isNormal = false;\n\t\t});\n\t\t\n\t\tif (isNormal) ecss.push(\"Normal\");\n\t\t\n\t\tthat.Ecss = ecss;\n\t\td.css = css;\n\t},\n\tui:{\n\t\t\"#format\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"#showdesc\":\"showdesc\",\n\t\t\"#ecss\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize(), title:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"this.Ecss\"\n\t\t},\n\t\t\"#css\":{\n\t\t\tinit: function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[\"Darken\",\"Parallax\",\"Zoomable\"],\n\t\t\t\t\tplaceholder:this.Lang.AUX_PLC\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"css\"\n\t\t},\n\t\t\"#btn-apply\":function(d,v,$o){\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.add(this.Ecss||[]).unique().remove(\"Normal\");\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":function(d,v,$o){if(v!=null)$o.trigger(\"cancel\")}\n\t},\n\tEcss:[],\n\tstyle:{}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1439641693277","id": ".T.embed","type": "js","data": "({\n\tid:\"cw.Inliner.Ed.Items.embed\",\n\t//Name:\"Embed\",\n\tName:'<span class=\"fi-play-video fs120\" title=\"Add embed\"></span>',\t\n\tHoverpane:\".in--embed-container\",\n\tdata:{type:\"embed\", data:\"\", source:\"\", desc:\"<p><br/></p>\", format:\"left500\", showdesc:\"show\"},\n\tFormats:{ /* See tab */ },\n\tinit: function($o, form){\n\t\tvar that = this, \n\t\t\t\td = form.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle=this.Formats[fmt];\n\n\t\t$o.html(that.HTML.join(\"\"));\n\n\t\t$o.addClass(style.css);\n\n\t\t$o.on(\"click.my\",\"#btn-embed-new\", function(){\n\t\t\tform.data._new = true;\n\t\t\t$o.find(\"#btn-embed\").trigger(\"click\");\n\t\t});\n\t\t\n\t\tthat.Opts.Formats = that.Formats;\n\t\t\n\t\tif (d.provider) $o.addClass('in--embed-provider-'+d.provider); \n\t\t\n\t},\n\tCrc:\"\",\n\tHTML:[\n\t\t//'<div class=\"floater-hotspot\"></div>',\n\t\t'<div id=\"formatter\" class=\"hide\"></div><div id=\"btn-embed\" class=\"hide\"></div>',\n\t\t'<div class=\"in-ct in--embed-container\">',\n\t\t'<div id=\"embed\" class=\"in--embed-frame\"></div>',\n\t\t'<div class=\"in--x-fader\"></div>',\n\t\t'<div id=\"descframe\" class=\"in--embed-desc\"><textarea id=\"desc\" placeholder:\"Image text \"></textarea></div>',\n\t\t'</div>'\n\t],\n\tPostinit:[\n\t\t[/data\\-instgrm/, \tfunction() {\n\t\t\tif (window.instgrm) window.instgrm.Embeds.process();\n\t\t}, 500],\n\t\t[/class=\"twitter\\-tweet\"/, function(){\n\t\t\tif (window.twttr) twttr.widgets.load();\n\t\t}, 500],\n\t\t[/class=\"in---gist\"/, function(s){\n\t\t\tvar that = this;\n\t\t\t$.getJSON( s.split(/[<>]/)[2] + 'on?callback=?', function( data ) {\n\t\t\t\tthat.my.find(\"#embed\").html(data.div);\n\t\t\t\tvar url = data.stylesheet;\n\t\t\t\tvar $head = $('head');\n\t\t\t\tif( $head.find('link[rel=\"stylesheet\"][href=\"'+url+'\"]').length < 1 )\n\t\t\t\t\t\t$head.append('<link rel=\"stylesheet\" href=\"'+ url +'\" type=\"text/css\" />');\n\t\t\t});\n\t\t}, 200]\n\t],\n\tui:{\n\t\t\"#embed\":{\n\t\t\tdelay:100,\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tvar that = this;\n\t\t\t\tif (that.Crc == cw.lib.sdbm(d)) return undefined;\n\t\t\t\telse {\n\t\t\t\t\tthat.Crc = cw.lib.sdbm(d);\n\t\t\t\t\tif (!d.data) {\n\t\t\t\t\t\treturn '<div class=\"w100p bg-lblue tac p30 fs80 blue\">'\n\t\t\t\t\t\t\t+'<span class=\"pseudolink\" id=\"btn-embed-new\">Insert embed...</span>'\n\t\t\t\t\t\t\t+'</div>';\n\t\t\t\t\t}\n\t\t\t\t\t// find post-processor\n\t\t\t\t\tvar proc=false;\n\t\t\t\t\tthat.Postinit.forEach(function(a){\n\t\t\t\t\t\tif (!proc && a[0].test(d.data)) {\n\t\t\t\t\t\t\tproc=true;\n\t\t\t\t\t\t\tvar f = a[1].debounce(a[2]);\n\t\t\t\t\t\t\ttry { f.call(that, d.data); } catch (e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\treturn d.data;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#btn-embed\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (d._new) {\n\t\t\t\t\t\n\t\t\t\t\tvar $p = $o.my().root.parents(\".my-form\").eq(0),\n\t\t\t\t\t\t\t$r = $p.parents(\".my-form\").eq(0);\n\t\t\t\t\t\n\t\t\t\t\tvar f = function(isnew){\n\t\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\t\troot:$r,\n\t\t\t\t\t\t\tmanifest:$.extend({RT:that.RT},that.Opts),\n\t\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\t\tnose:isnew?false:\"top\",\n\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\t\talign:isnew?false:\"top:103%\",\n\t\t\t\t\t\t\tcss:\"blue lh150 \"+(isnew?\"fs90 p15\":\"fs80 p10\"),\n\t\t\t\t\t\t\twidth:450,\n\t\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tclose:!!isnew\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\td.data = res.data;\n\t\t\t\t\t\t\td.format = res.format;\n\t\t\t\t\t\t\td.showdesc = res.showdesc;\n\t\t\t\t\t\t\td.source = res.source;\n\t\t\t\t\t\t\td.css = res.css;\n\t\t\t\t\t\t\td.provider = res.provider;\n\n\t\t\t\t\t\t\tif (Object.isFunction(res.postinit)) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tres.postinit();\n\t\t\t\t\t\t\t\t} catch(e){}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$o.my().root.trigger(\"redraw\");\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (d._new) f.fill(true).delay(250);\n\t\t\t\t\telse f();\n\t\t\t\t\tif (d._new) delete d._new;\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t\"#desc\":{\n\t\t\tdelay:50,\n\t\t\tbind:\"desc\",\n\t\t\tinit:function ($o) {\n\t\t\t\t$o.redactor({\n\t\t\t\t\tair:true,\n\t\t\t\t\tairButtons:['formatting', 'alignment','bold', 'italic', 'link', 'fontcolor'],\n\t\t\t\t\tfocus:false\n\t\t\t\t});\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"in--embed-desc-empty\":function (d) {return \"\"===d.desc.stripTags().compact();},\n\t\t\t\t\"hide\":function (d) {return !(d.showdesc+\"\")}\n\t\t\t},\n\t\t\t//watch:\"#imageframe,#showdesc\"\n\t\t},\n\t\t\"#formatter\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tvar $r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\t\n\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--embed in-item \"+(d.provider?'in--embed-provider-'+d.provider:''));\n\n\t\t\t\t$r.addClass(fm.css);\n\t\t\t}\n\t\t}\n\t},\n\tSettings:{ /* See tab */ },\n\tCompiler: function ($form, html, css, repo, manifest) {\n\t\t// Default item to HTML compiler.\n\t\t// Gets HTML content of form,cleans it and pushes HTML to html array.\n\t\t// Also puts <style> content (if any) into css obj under appropriate keys.\n\t\t\n\t\tvar $src = $($form[0].outerHTML.replace(/contenteditable\\s?=\\s?\"true\"/g,\"\"));\n\t\t$src.find(\"textarea,input,select,button,.hide,.cw-hoverpane,.floater-hotspot\").remove();\n\t\t$src.find(\".cw--embed-frame\").html($form.my(\"data\").data);\n\t\thtml.push($src[0].outerHTML);\n\t\t\n\t\tthis.CSSCompiler($form, css);\n\t},\n\tstyle:{ \n\t\t\" .in--embed-desc-empty:before\":\"content:\\\"Embed description\\\";color:#bbb;font-size:90%;\"\n\t\t\t\t\t+\"position:absolute;z-index:-1;top:-3px;  pointer-events: none;\",\n\t\t'.in-item-max .in--embed-desc-empty:before':'z-index:0;top:auto;bottom:1em;'\n\t\t\t+'color:white;text-shadow: 1px 0px 10px rgba(0,0,0,0.5);  pointer-events: none;'\n\t},\n\tFormats:{\n\t\tleft300:{css:\"in-item-small\"},\n\t\tleft500:{css:\"in-item-medium\"},\n\t\tleft750:{css:\"in-item-wide\"},\n\t\tleft1000:{css:\"in-item-max\"},\n\t\tright300:{css:\"in-item-small-right\"}\n\t}\n})\n\n","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1459298639431","id": ".T.embed.style","type": "js","data": "({\n\t\".in--embed\": function(){\n\t\t\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\t\t\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tgap2 = parseFloat(inset)/2+inset.replace(/[0-9\\.]/g,''),\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\t\t\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcl = 'clear:left; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ',\n\t\t\t\tchmgap = 'margin-top:'+gap2+';';\n\t\t\n\t\tr[''] = 'display:block; z-index:+1;';\n\t\t\n\t\tr[' .in-ct'] = 'margin-top:'+gap+'; margin-bottom:'+gap+'; '\n\t\t\n\t\tr['.in-rules .in-ct'] = 'padding:'+inset+' 0!important;border-radius:0!important;'\n\t\tr['.in-background .in-ct'] =\n\t\tr['.in-frame .in-ct'] = 'padding:'+inset+'!important;' + cbro;\n\t\t\t\t\n\t\tr[' .in--embed-desc'] = 'display:block;width:100%;min-height:1em;'\n\t\tr[' .in--embed-desc p:last-child'] = 'margin-bottom:0!important;'; \n\t\t\n\t\tr[' .floater-hotspot'] = 'width:100%';\n\t\tr[' .in--x-fader'] = 'pointer-events:none;';\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tvar wmax = 'width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';';\n\t\tr['.in-item-max'] = {\n\t\t\t'': wmax,\n\t\t\t' .in-ct':'width:100%;'+cpad,\n\t\t\t//' .in--img-desc': ctext+cpad,\n\t\t\t' .in--embed-desc':{\n\t\t\t\t'': cbody+cb+'; margin:0 auto;min-height:0;',\n\t\t\t\t' .redactor_box':{\n\t\t\t\t\t'':cbody + 'width:'+(s.text.width||'100%')+';position:absolute;bottom:'+gap+';',\n\t\t\t\t\t'h1,h2':'margin-bottom:0.2em!important;'\n\t\t\t\t}\n\t\t\t},\n\t\t\t'>img':c100db,\n\t\t\t' .in--embed-frame':wmax\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-wide'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':cbody + 'width:100%;',\n\t\t\t//' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t' .in--embed-desc': ctext + chmgap,\n\t\t\t//' .in--embed-desc': 'max-width:80%;'+chmgap,\n\t\t\t' .floater-hotspot':'width:100%; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-medium'] = {\n\t\t\t'': cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t' .in--embed-frame':'width:70%;'+ cdibvat,\n\t\t\t' .in--embed-desc': {\n\t\t\t\t'': 'display:inline-block; width:30%; margin:-1px 0 0 0; padding-left:'+gap+';' + cdibvat ,\n\t\t\t\t' :first-child': 'margin-top:0!important;',\n\t\t\t\t' .redactor_editor :first-child': 'margin-top:0!important;'\n\t\t\t},\n\t\t\t' .floater-hotspot':'width:30%; left:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' -'+pl+';',\n\t\t\t' .in--embed-desc': c100db + chmgap,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; left:-'+pl+';'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin-left:auto;margin-right:auto;margin-top:0;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t\t' .in--embed-desc': c100db + chmgap,\n\t\t\t' .in--embed-frame':c100db,\n\t\t\t' .floater-hotspot':'width:' + s.aside.small + '; right:0;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\t\n\t\tr['.in--embed-provider-gmap'] =\n\t\tr['.in--embed-provider-youtube'] = {\n\t\t\t' #embed': 'position: relative; padding-bottom: 52%; padding-top: 22px; height: 0; overflow: hidden;',\n\t\t\t' .in--embed-frame iframe': 'position: absolute;top: 0;left: 0;width: 100%;height: 100%;',\n\t\t\t'.in-item-medium #embed': 'padding-bottom: 36.4%; padding-top: 15px;',\n\t\t}\n\t\t\n\t\tr['.in--embed-provider-gist'] = {\n\t\t\t' #embed .blob-wrapper':'overflow-y:auto!important; max-height:'+s.aside.small+';',\n\t\t\t' .blob-code-inner':'font-family:'+_font(s.font.fixed)+';'\n\t\t}\n\t\t\n\t\tr['.in--embed-provider-twitter'] = {\n\t\t\t' iframe':'margin-top:0!important;margin-bottom:0!important;'\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .in--embed-frame iframe'] = \n\t\tr[' .in--embed-frame object'] = \n\t\tr[' .in--embed-frame embed'] = 'width: 100%;';\t\n\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t\n\t\tr[' .redactor_box'] = 'width:100%;display:block; border:none;padding:0; background:none!important;z-index:+3;min-height:1em;';\n\t\t\n\t\tr[' .redactor_editor'] = 'display:block; min-height:1em;';\n\t\t\n\t\treturn r;\n\t\t\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t\tfunction _font(a) {\n\t\t\tvar s=[];\n\t\t\t(a||[]).forEach(function(e){\n\t\t\t\tif (/\\s/.test(e)) s.push(\"'\"+e+\"'\");\n\t\t\t\telse s.push(e);\n\t\t\t});\n\t\t\treturn s.length?s.join(\",\"):\"inherit\";\n\t\t}\n\t\t\n\t\t/*function _ext (obj, list) {\n\t\t\tfor (var i=0; i<list.length; i++) {\n\t\t\t\tobj[list[i].key] = list[i].rule\n\t\t\t\t.split(\";\")\n\t\t\t\t.map(function(e){\n\t\t\t\t\treturn e.trim()+(/important/.test(e)?'':'!important;');\n\t\t\t\t}).join('');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}*/\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1460101592400","id": ".T.embed.To.html","type": "js","data": "(function (item, options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\tembedh = '',\n\t\t\tscripts = [],\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:''\n\t\t\t}, Object.isObject(options)?options:{}), \n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thtml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:'',\n\t\t\t\tscripts:[]\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\t\n\tif (!d.data) {\n\t\tres.err.push('Error: ' + that.data.type + ' has no data to render.');\n\t\treturn res;\n\t}\n\t\n\tid = d._stamp || id;\n\t\n\tvar css=['in-item', 'in--'+d.type];\n\tif (d.provider) css.push('in--embed-provider-'+d.provider);\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\n\t// Youtube\n\tif (d.provider == 'youtube' && /^https:\\/\\/www.youtube.com\\/watch/.test(d.source) && d.css.indexOf(\"Autostart\") > -1) {\n\t\tvar embedid = d.source.split('?')[1].split('&').find(/^v=/).split(\"=\")[1];\n\t\tscripts.push([\n\t\t\t'$(function(){var $item=$(\"#in-'+id+' #embed>div\");',\n\t\t\t'var opts = '+JSON.stringify(d.css)+', html='+JSON.stringify(d.data)+', videoid=\"'+embedid+'\";',\n\t\t\t_youtube.toString(),\n\t\t\t'_youtube($item, html, opts, videoid);',\n\t\t\t'});'\n\t\t].join('\\n'));\n\t\tembedh='<div></div>';\n\t}\n\t// Fallback\n\telse {\n\t\tembedh = d.data;\n\t}\n\t\n\th = [\n\t\t'<div id=\"in-' + id + '\" class=\"'+css.join(' ')+'\">',\n\t\t\t'<div class=\"in-ct\">',\n\t\t\t\t'<div id=\"embed\" class=\"in--embed-frame\">'+embedh+'</div>',\n\t\t\t\t'<div class=\"in--x-fader\"></div>',\n\t\t\t\t(d.showdesc+''=='show'?[\n\t\t\t\t\t'<div class=\"in--embed-desc\">',\n\t\t\t\t\t\t'<div class=\"redactor_box\"><div class=\"redactor_editor\">',\n\t\t\t\t\t\t\t(d.desc || '').removeTags('script embed iframe input textarea button'.split(' ')),\n\t\t\t\t\t\t'</div></div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join(''):''),\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\tres.html = h;\n\tres.scripts = scripts;\n\t\n\treturn res;\n\t\n\t// - - - - - - - - - - - - - \n\n\tfunction _youtube($item, html, opts, videoid){\n\t\tvar hasYT = (\"YT\" in window),\n\t\t\t\tokYT = hasYT && window.YT.Player,\n\t\t\t\tstart = ((opts||[]).indexOf(\"Autostart\") > -1),\n\t\t\t\tmute = ((opts||[]).indexOf(\"Mute\") > -1),\n\t\t\t\tloop = ((opts||[]).indexOf(\"Loop\") > -1),\n\t\t\t\tplayer;\n\n\t\tif (!hasYT || !start) $item.parent().html(html);\n\t\telse {\n\t\t\tif (okYT) {\n\t\t\t\tplayer = new YT.Player($item[0], {\n\t\t\t\t\tplayerVars: {\n\t\t\t\t\t\t'autoplay': start?1:0,\n\t\t\t\t\t\t'controls': 0,\n\t\t\t\t\t\t'autohide': 1,\n\t\t\t\t\t\t'wmode': 'opaque',\n\t\t\t\t\t\t'showinfo': 0,\n\t\t\t\t\t\t'loop': loop?1:0,\n\t\t\t\t\t\t'mute': mute?1:0,\n\t\t\t\t\t\t'playlist': videoid\n\t\t\t\t\t},\n\t\t\t\t\tvideoId: videoid,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t//'onReady': onPlayerReady\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} \n\t\t\telse {\n\t\t\t\t// Ping YT every 100ms\n\t\t\t\tsetTimeout(_youtube, 100);\n\t\t\t}\n\t\t}\n\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1440180276665","id": ".T.embed.Opts","type": "js","data": "({\n\tparams:{width:320},\n\tdata:{data:\"\", source:\"\",format:\"left500\", css:[]},\n\tlang:{\n\t\ten:{\n\t\t\tBTN_APPLY:'Apply',\n\t\t\tBTN_CANCEL:'Cancel',\n\t\t\tTITLE:'Embed settings',\n\t\t\tSHOWDESC:'Show embed description',\n\t\t\tAUX_PLC:'Aux formatting...',\n\t\t\tEMBED_PLC:'Paste embed code or video URL here'\n\t\t},\n\t\tru:{\n\t\t\tBTN_APPLY:'Применить',\n\t\t\tBTN_CANCEL:'Отмена',\n\t\t\tTITLE:'Настройки внешнего кода',\n\t\t\tSHOWDESC:'Показывать текст',\n\t\t\tAUX_PLC:'Дополнительные эффекты...',\n\t\t\tEMBED_PLC:'Вставьте код внешнего ресурса или ссылку на Youtube-видео'\n\t\t}\n\t},\n\tinit:function($o, form){\n\t\t\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\n\t\t$o.html($.my.formgen([\n\t\t\t{row:\"320px\", label:\"70px\", rowCss:\"my-row pb10\", labelCss:\"my-label fs90 gray\"},\n\t\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t\t['', '<div class=\"pl3\">','txt#edata.fs90',{plc:'{EMBED_PLC}', spellcheck:\"false\"},'</div>'],\n\t\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb3\"></div>',\n\t\t\t['', 'inp#css.w100p.fs100'],\n\t\t\t'<label class=\"fs90 ml4 xgray\"><input type=\"checkbox\" id=\"showdesc\" value=\"show\"> {SHOWDESC}</label>',\n\t\t\t{rowCss:\"my-row mt10 ml3\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w100.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t 'but#btn-cancel.w100',{txt:'{BTN_CANCEL}'}\n\t\t\t]\n\t\t]).assign(L));\n\n\t\tthis.Start = form.data.format + form.data.showdesc;\n\t\t\n\t\tif (d.data && !d.source ) d.source = d.data;\n\t\t\n\t\t\t\tvar a = ['small normal large', 'background frame rules', 'accented'],\n\t\t\t\tb = a.join(\" \")+\" \",\n\t\t\t\tecss = [],\n\t\t\t\tcss = [];\n\t\t\n\t\tvar c = (d.css||[]), isNormal = true;\n\t\tc.forEach(function(i){\n\t\t\tif (b.indexOf(i.toLowerCase()+\" \")>-1) ecss.push(i);\n\t\t\telse css.push(i);\n\t\t\tif (i==\"Small\" || i==\"Large\") isNormal = false;\n\t\t});\n\t\t\n\t\tif (isNormal) ecss.push(\"Normal\");\n\t\t\n\t\tthat.Ecss = ecss;\n\t\td.css = css;\n\t},\n\tui:{\n\t\t\"#edata\":{\n\t\t\tbind:\tfunction(d,v,$o){\n\t\t\t\tvar that=this\n\n\t\t\t\tif (v!=null) d.source = v;\n\t\t\t\t\n\t\t\t\tvar s = d.source, \n\t\t\t\t\t\t\tid=\"\", \n\t\t\t\t\t\t\tres=\"\",\n\t\t\t\t\t\t\tprovider = '',\n\t\t\t\t\t\t\tformats = that.Formats;\n\n\t\t\t\t// We have embed\n\t\t\t\t\n\t\t\t\tif (!/^http[s]?:\\/\\//.test(d.source)) {\n\t\t\t\t\t\n\t\t\t\t\t// Detect embed provider\n\t\t\t\t\t\n\t\t\t\t\tif (/youtu[\\.]?be/.test(s)) {\n\t\t\t\t\t\tres = _redim(s);\n\t\t\t\t\t\tprovider = 'youtube';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/google\\.com\\/maps\\/embed/.test(s)){\n\t\t\t\t\t\tres = _redim(s);\n\t\t\t\t\t\tprovider = 'gmap';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/gist\\.github/.test(s)) {\n\t\t\t\t\t\tres = '<div class=\"in---gist\" style=\"display:none\">'+s.replace(/^([^\"]+\")([^\"]+)(\".+)$/,'$2')+'</div>';\n\t\t\t\t\t\tres+=[\n\t\t\t\t\t\t\t'<sc'+'ript>',\n\t\t\t\t\t\t\t'$(function(){',\n\t\t\t\t\t\t\t\t'if (!window.GIST_LOADING) { ',\n\t\t\t\t\t\t\t\t\t'window.GIST_LOADING = 0;',\n\t\t\t\t\t\t\t\t\t'$(\".in---gist\").each(function(){var that = $(this), $p = that.parent();',\n\t\t\t\t\t\t\t\t\t\t'window.GIST_LOADING +=1;',\n\t\t\t\t\t\t\t\t\t\t'$.getJSON( that.text() + \"on?callback=?\", function( data ) {',\n\t\t\t\t\t\t\t\t\t\t\t'window.GIST_LOADING -=1;',\n\t\t\t\t\t\t\t\t\t\t\t'$p.html(data.div);var url = data.stylesheet,$head = $(\"head\");',\n\t\t\t\t\t\t\t\t\t\t\t'if( $head.find(\\'link[rel=\"stylesheet\"][href=\"\\'+url+\\'\"]\\').length < 1 ) ',\n\t\t\t\t\t\t\t\t\t\t\t'$head.append(\\'<link rel=\"stylesheet\" href=\"\\'+ url +\\'\" type=\"text/css\" />\\');',\n\t\t\t\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t'}',\n\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\tString.fromCharCode(60,47)+'script>'\n\t\t\t\t\t\t].join('\\n');\n\t\t\t\t\t\tprovider = 'gist';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/jsfiddle\\.net/.test(s)) {\n\t\t\t\t\t\tif (s.substr(0,7) == '<script') {\n\t\t\t\t\t\t\tres = '<iframe width=\"100%\" height=\"300\" src=\"'\n\t\t\t\t\t\t\t\t+s.replace(/^([^\"]+\")([^\"]+)(\".+)$/,'$2').replace('embed/','embedded/')\n\t\t\t\t\t\t\t\t+'\" allowfullscreen=\"allowfullscreen\" frameborder=\"0\"></iframe>';\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse res = s;\n\t\t\t\t\t\tprovider = 'jsfiddle';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telse if (/class=\"twitter\\-tweet\"/.test(s)) {\n\t\t\t\t\t\tres = _redim(s);\n\t\t\t\t\t\tprovider = 'twitter';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\td.data = res || d.source;\n\t\t\t\t\td.provider = provider || 'unknown'\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// We have URL\n\t\t\t\t\n\t\t\t\telse {\n\t\t\t\t\t\n\t\t\t\t\t// ####  Youtube  ####\n\t\t\t\t\t\n\t\t\t\t\tif (/youtu[\\.]?be/.test(s)) {\n\t\t\t\t\t\tif (/^https:\\/\\/youtu\\.be/.test(s)) {\n\t\t\t\t\t\t\tid = s.split(/[\\/\\?&]/)[3];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (/^http[s]?:\\/\\/(www.)?youtube.[a-z]{2,3}\\/watch/.test(s)) {\n\t\t\t\t\t\t\tid = (s.match(/[\\?&]v=([a-z0-9\\-_]+)/i) || [])[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (id) {\n\n\t\t\t\t\t\t\tres = '<iframe src=\"https://www.youtube.com/embed/'\n\t\t\t\t\t\t\t\t+id+'?rel=0&amp;showinfo=0\" frameborder=\"0\" '\n\t\t\t\t\t\t\t\t+' allowfullscreen></iframe>';\n\t\t\t\t\t\t\tprovider = 'youtube';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// ####  Image  ####\n\t\t\t\t\t\n\t\t\t\t\telse if (/\\.(jpeg|jpg|png|gif)$/i.test(s)) {\n\t\t\t\t\t\tres = [\n\t\t\t\t\t\t\t'<div class=\"w100p tac\">',\n\t\t\t\t\t\t\t\t'<img src=\"'+s+'\" ',\n\t\t\t\t\t\t\t\t' style=\"max-width:100%!important;max-height:1000px;\" ',\n\t\t\t\t\t\t\t\t'/>',\n\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t].join(\"\");\n\t\t\t\t\t\tprovider = 'image';\n\t\t\t\t\t}\n\n\t\t\t\t\t// ... no match\n\t\t\t\t\tif (!res) {\n\t\t\t\t\t\td.data = [\n\t\t\t\t\t\t\t'<div class=\"w100p bg-lblue tac p30 fs80\">',\n\t\t\t\t\t\t\t\t'<a target=\"_blank\" href=\"'+s+'\">',\n\t\t\t\t\t\t\t\t\ts.truncate(50,\"middle\",\" … \"),\n\t\t\t\t\t\t\t\t'</a>',\n\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t].join(\"\");\n\t\t\t\t\t\td.provider = 'unknown';\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.data = res;\n\t\t\t\t\t\td.provider = provider;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\treturn d.source;\n\t\t\t\t\n\t\t\t\t//--------\n\t\t\t\t\n\t\t\t\tfunction _redim(s) {\n\t\t\t\t\treturn s.replace(/width\\s?=\\s?\"\\d+[%]?\"/i,'').replace(/height\\s?=\\s?\"\\d+[%]?\"/i,'');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\twatch:\"#format\",\n\t\t\tcss:{\n\t\t\t\t\"self:fs90\":function(d){return d.source.length<150},\n\t\t\t\t\"self:fs80\":function(d){return d.source.length>=150}\n\t\t\t}\n\t\t},\n\t\t\"#format\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"#showdesc\":\"showdesc\",\n\t\t\"#ecss\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize(), title:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"this.Ecss\"\n\t\t},\n\t\t\"#css\":{\n\t\t\tinit: function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[\"Darken\",\"Parallax\"],\n\t\t\t\t\tplaceholder:this.Lang.AUX_PLC\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"css\"\n\t\t},\n\t\t\"#btn-apply\":function(d,v,$o){\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.add(this.Ecss||[]).unique().remove(\"Normal\");\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":function(d,v,$o){if(v!=null)$o.trigger(\"cancel\")}\n\t},\n\tstyle:{\n\t\t\" #edata\":'height:120px;overflow-x:hidden;overflow-y:auto;resize: none'\n\t},\n\tEcss:[]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1405141789999","id": ".T.widget","type": "js","data": "// Widget plugin\n({\n\tid:\"cw.Inliner.Ed.Items.widget\",\n\t//Name:\"App\",\n\tName:'<span class=\"fi-layout fs115 dib vat mt1 mb-1\" title=\"Add widget\"></span>',\n\tHoverpane:\".in--widget .in-ct\",\n\tinherit:[\"Att\"],\n\tdata:{\n\t\tname: \"\",\n\t\ttype: \"widget\",\n\t\ttab:[\"manifest\"],\n\t\tjs:\"// Widget manifest\\n({\\n\\tinit: function ($form, form) {\\n\\t\\t// Init code\\n\\t},\\n\\tui: \"\n\t\t+\"{\\n\\t\\t// UI bindings\\n\\t}\\t,\\n\\tstyle: {\\n\\t\\t// Local CSS rules\\n\\t}\\n})\",\n\t\thtml:\"\",\n\t\tdata:\"({\\n\\t//Put default data here\\n})\",\n\t\tstate:\"\",\n\t\tvalid:false,\n\t\terr:[],\n\t\toptions:[],\n\t\tsource:\"\",\n\t\tformat:\"left750\", \n\t\tcss:[\"Frame\"],\n\t\tbg:''\n\t},\n\tUrl:{},\n\tinit: function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td= form.data,\n\t\t\t\tdata = d.data,\n\t\t\t\tfmt = d.format,\n\t\t\t\tstyle = that.Formats[fmt];\n\t\t\n\t\t$o.formgen(that.HTML);\n\n\t\t$o.addClass(\"in--widget \"+style.css);\n\t\tif (that.Opts) that.Opts.Formats = that.Formats;\n\t\t\n\t\t$o.then(function(){\n\t\t\tif (form.data.state) $o.find(\"#btn-run\").trigger(\"click\");\n\t\t\telse that.XCode($o, form.data);\n\t\t\t\n\t\t\t$o.find(\"#ovl\").removeClass('hide');\n\t\t\t\n\t\t});\n\t},\n\tdie:function($o){\n\t\tif ($o.find(\"#xapp\").data(\"my\")) {\n\t\t\ttry{\n\t\t\t\t$o.find(\"#xapp\").my(\"remove\");\n\t\t\t} catch(e) {}\n\t\t}\n\t},\n\tui:{\n\t\t\"#formatter\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tvar that = this, \n\t\t\t\t\t\t$r, fm;\n\t\t\t\t$r = $o.my().root;\n\t\t\t\tfm = this.Formats[d.format];\n\t\t\t\t\n\t\t\t\tvar css= $r.attr(\"class\").split(\" \").map(function(e){\n\t\t\t\t\tif (!/^in-/.test(e)) return e;\n\t\t\t\t}).compact(true);\n\n\t\t\t\tif (d.state == \"running\") {\n\n\t\t\t\t\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\t\t\t\t\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\t\t\t\t\tcss.push (fm.css);\n\n\t\t\t\t} else {\n\t\t\t\t\tcss.push('in-frame in-br0 '+(d.css.indexOf('NarrowEditor')>-1?'in-item-medium':'in-item-wide'))\n\t\t\t\t}\n\t\t\t\t$r.attr(\"class\", css.join(\" \")+\" in--widget in-item\");\n\t\t\t\t\n\t\t\t\t// bg\n\t\t\t\tif (d.bg && d.state == \"running\") {\n          if (!that.Url[d.bg]) {\n            try {\n              that.Url = that.Att('*','session');\n            } catch(e){}\n            if (!that.Url[d.bg]) {\n            \tvar p = that.Att(d.bg, 'url');\n              if (p.then) p.then(function(url){\n                that.Url[d.bg] = url;\n                _bg(url);\n              });\n              else {\n                that.Url[d.bg] = p;\n                _bg(url);\n              }\n            }\n          }\n\t\t\t\t\telse _bg(that.Url[d.bg]);\n\t\t\t\t} \n        else $r.css({'background-image':'none'});\n\t\t\t\t\n        // - - - - - -\n        function _bg(bg){\n        \t$r.css({'background-image':'url(\"'+(bg || d.bg)+'\")'});\n        }\n\t\t\t},\n\t\t\twatch:\"#btn-run,#btn-code\"\n\t\t},\n\t\t\"#ovl-tab\":{\n\t\t\tbind:function (d,v,$o){\n\t\t\t\tif (null!=v) {\n\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\tif ($x.is(\".my-form\")) $x.my(\"redraw\");\n\t\t\t\t\td.tab = v.length?v:['manifest'];\n\t\t\t\t}\n\t\t\t\treturn d.tab;\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\t$o.tags({tags:[{\"HTML\":\"html\"}, {\"Manifest\":\"manifest\"}, {\"Defaults\":\"data\"}]})\n\t\t\t}\n\t\t},\n\t\t\"#btn-run\":{\n\t\t\tbind: function (d,v,$o){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t\n\t\t\t\t\tif (d.state == \"running\") $o.my(\"find\",\"#xapp\").my('remove');\n\t\t\t\t\t\n\t\t\t\t\tif (!that.Att || !d.bg || /^http/.test(d.bg)) _run();\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar p = that.Att(d.bg, 'url');\n\t\t\t\t\t\tif (p.then) p.then(function(url){\n\t\t\t\t\t\t\tthat.Url[d.bg] = url;\n\t\t\t\t\t\t\t_run();\n\t\t\t\t\t\t});\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tthat.Url[d.bg] = p;\n\t\t\t\t\t\t\t_run();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Run\n\t\t\t\tfunction _run() {\n\t\t\t\t\tif (d.valid) {\n\t\t\t\t\t\td.state = \"running\";\n\t\t\t\t\t\t$o.my(\"find\",\"#xcode,.ovl-tabs\").addClass(\"hide\");\n\t\t\t\t\t\tvar $a = $o.my(\"find\",\"#xapp\"),\n\t\t\t\t\t\t\t\t$v = $o.my(\"find\",\"#xreflect\"),\n\t\t\t\t\t\t\t\tman = eval(d.js);\n\t\t\t\t\t\tman._compiled = this._compiled;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (that.Att) man.Att = that.Att;\n\t\t\t\t\t\tif (that.db) man.db = that.db;\n\t\t\t\t\t\tif (man.meta && that.RT) {\n\t\t\t\t\t\t\tman.meta = Object.merge(\n\t\t\t\t\t\t\t\tObject.clone(that.RT().Config.meta || {}, true),\n\t\t\t\t\t\t\t\tObject.clone(that.RT().data.meta || {}, true)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tman.meta.id = that.RT().data._id;\n\t\t\t\t\t\t\tman.meta.theme = Object.reject($.extend(true,{},that.RT().Theme, that.RT().data.style),['tags']);\n\t\t\t\t\t\t\tman.meta.tags = Object.clone(that.RT().data.tags, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$a.removeClass(\"hide\")\n\t\t\t\t\t\t.html(d.html)\n\t\t\t\t\t\t.my(man, eval(d.data) || {})\n\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t$a.trigger(\"change\");\n\t\t\t\t\t\t}.debounce(50))\n\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t$a.my('restyle');\n\t\t\t\t\t\t}.debounce(200));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (d.options.indexOf(\"show data\")!=-1) {\n\t\t\t\t\t\t\t$a.on(\"change.my\", function(){\n\t\t\t\t\t\t\t\t$v.html(\n\t\t\t\t\t\t\t\t\tcw.lib.js2txt(\n\t\t\t\t\t\t\t\t\t\t$a.my(\"data\"),\"  \")\n\t\t\t\t\t\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t\t\t\t\t\t.replace(/^\\{/,'{ <span class=\"green\">// Form data</span>')\t\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}.debounce(2));\n\t\t\t\t\t\t\t$a.addClass(\"xdata\");\n\t\t\t\t\t\t\t$v.addClass(\"xdata\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$a.removeClass(\"xdata\");\n\t\t\t\t\t\t\t$v.removeClass(\"xdata\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Persist data 2 doc\n\t\t\t\t\t\t$a.on(\"change.my\", function(){\n\t\t\t\t\t\t\tif (d.options.indexOf(\"reflect\")!=-1) {\n\t\t\t\t\t\t\t\td.data = \"(\"+JSON.stringify($a.my(\"data\"), null, '\\t')+\")\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}.debounce(50));\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcw.lib.note(d.err.join(\".<br>\")+\".\", \"error\", 5000);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\thide: function(d){return !!d.state},\n\t\t\t\t\"red\": function (d) {return !d.valid},\n\t\t\t\t\"green\": function (d) {return d.valid}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\twatch:\"#btn-code\"\n\t\t},\n\t\t\"#btn-code\":{\n\t\t\tbind: function(d,v, $o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = \"\";\n\t\t\t\t\t$o.my(\"find\",\"#xapp\").addClass(\"hide\").my(\"remove\");\n\t\t\t\t\t$o.my(\"find\",\"#xcode,.ovl-tabs\").removeClass(\"hide\");\n\t\t\t\t\t$o.my(\"find\",\"#xreflect\").removeClass(\"xdata\");\n\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\tif (!$x.is(\".my-form\")) {\n\t\t\t\t\t\tthis.XCode($o.my().root, d);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$o.my(\"find\",\"#data\").trigger(\"recalc\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\thide: function(d){return !d.state || d.options.indexOf(\"noedit\")>-1}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\twatch:\"#btn-run\"\n\t\t},\n\t\t\"#warn\":{\n\t\t\tbind:function (d) {\n\t\t\t\tvar t=d.js, o, err=[], data, isO = Object.isObject;\n\t\t\t\ttry { o = eval(t); } catch (e) {}\n\t\t\t\ttry { data = eval(d.data); } catch (e) {}\n\t\t\t\td.valid=false;\n\t\t\t\tif (!isO(o)) err.push(\"Invalid manifest\");\n\t\t\t\telse {\n\t\t\t\t\t\tif ( !isO(o.ui)) err.push(\"No ui section\");\n\t\t\t\t\t\telse if ( !Object.size(o.ui)) err.push(\"No bindings in ui section\");\n\t\t\t\t\t\n\t\t\t\t\t\tif  ( !Object.isFunction(o.init) && !Object.isArray(o.init) && !(d.html+\"\").length)\n\t\t\t\t\t\t\terr.push(\"No HTML defined in init function or HTML tab\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!isO(data))  err.push(\"Defaults must be an object\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (o.data!==undefined && !isO(o.data)) err.push(\"Section ‘data’ must be an object\");\n\t\t\t\t\t\tif (o.params!==undefined && !isO(o.params)) err.push(\"Section ‘params’ must be an object\");\n\t\t\t\t\t\tif (o.style!==undefined && !isO(o.style)) err.push(\"Section ‘style’ must be an object\");\n\t\t\t\t\t}\n\t\t\t\tif (!err.length) d.valid = true;\n\t\t\t\td.err=err;\n\t\t\t},\n\t\t\tdelay:500,\n\t\t\trecalc:\"#btn-run\"\n\t\t}\n\t},\n\tXCode: function ($form, d){\n\t\tthis.XCode3._compiled = this._compiled;\n\t\t\n\t\t$form.find(\"#xcode\").removeClass('hide')\n\t\t.my (this.XCode3, d)\n\t\t.on(\"change\", function(){\n\t\t\t$form.find(\"#warn\").trigger(\"check.my\");\n\t\t});\n\t},\n\tXCode3:{\n    require:[{'window.CodeMirror':'/lib/codemirror.js'}],\n\t\tui:{\n\t\t\t\"#xjs\":{css:{hide: function (d) { return d.tab.indexOf(\"manifest\")==-1;}}},\n\t\t\t\"#js\":{\n\t\t\t\tbind:\"js\",\n\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"manifest\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#xdata\":{\n\t\t\t\tcss:{\n\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"data\")==-1;},\n\t\t\t\t\tbt1: function (d)  { return d.tab.length>1;}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#data\":{\n\t\t\t\tbind:\"data\",\n\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"data\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#xhtml\":{\n\t\t\t\tcss:{\n\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"html\")==-1;},\n\t\t\t\t\tbb1: function (d)  { return d.tab.length>1;}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#html\":{\n\t\t\t\tbind:\"html\",\n\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"html\")>-1) \n\t\t\t\t\t\tthis.Cm($o, \"htmlmixed\", true, \"base16-light\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: mode,\n\t\t\t\tlineNumbers:lineNums,\n\t\t\t\tindentWithTabs:!0,\n\t\t\t\tindentUnit:2,\n\t\t\t\ttabSize:2,\n\t\t\t\ttheme: theme||\"default\"\n\t\t\t});\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div id=\"formatter\" class=\"hide\"></div>',\n\t\t'<div class=\"cw-widget in-ct\">',\n\t\t\t'<div id=\"ovl\" class=\"hide\">',\n\t\t\t\t'<div class=\"ovl-tabs\">',\n\t\t\t\t\t'<span id=\"ovl-tab\"></span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div class=\"ovl-buttons\">',\n\t\t\t\t\t'<span id=\"btn-run\"><span class=\"fi-play\"></span>&nbsp;Run</span>',\n\t\t\t\t\t'<span id=\"btn-code\" class=\"hide\">Code&thinsp;<span class=\"fi-pencil\"></span></span>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div id=\"xcode\" class=\"hide\">',\n\t\t\t\t'<div id=\"xhtml\"><textarea id=\"html\"></textarea></div>',\n\t\t\t\t'<div id=\"xjs\"><textarea id=\"js\"></textarea></div>',\t\n\t\t\t\t'<div id=\"xdata\"><textarea id=\"data\"></textarea></div>',\n\t\t\t'</div>',\n    \t'<div id=\"xreflect\"></div>',\n\t\t\t'<div id=\"xapp\" class=\"hide\"></div>',\n\t\t\t'<div id=\"warn\" class=\"hide\"></div>',\n\t\t'</div>'\n\t],\n\tFormats:{\n\t\tleft300:{css:\"in-item-small\"},\n\t\tleft500:{css:\"in-item-medium\"},\n\t\tleft750:{css:\"in-item-wide\"},\n\t\tleft1000:{css:\"in-item-max\"},\n\t\tright300:{css:\"in-item-small-right\"},\n\t\tright200:{css:\"in-item-tiny-right\"}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1459105853144","id": ".T.widget.style","type": "js","data": "({\n\t'.in--widget': function (){\n\n\t\t// Style generator, both for editor and compiled html,\n\t\t// is cut from manifest and mount to root Editor on start\n\t\t// to avoid slylesheet cluttering\n\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.RT().Theme || {}, true), that.RT().data.style, true),\n\t\t\t\tgap = s.pad.gap,\n\t\t\t\tinset = s.pad.inset,\n\t\t\t\tpl = s.pad.left,\n\t\t\t\tpr = s.pad.right,\n\t\t\t\tr = {};\n\n\t\tvar cbody = 'min-width:'+s.body.min+'; max-width:'+s.body.max+'; ',\n\t\t\t\tctext = 'min-width:'+s.text.min+'; max-width:'+s.text.max+'; ',\n\t\t\t\tc100plus = 'calc(100% + '+pl+' + '+pr+');',\n\t\t\t\tcb = 'clear:both; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcl = 'clear:left; margin-left:auto; margin-right:auto; ',\n\t\t\t\tcpad = 'padding-left:'+pl+'; padding-right:'+pr+'; ',\n\t\t\t\tc100db = 'width:100%; display:block; ',\n\t\t\t\tcdibvat = 'display:inline-block; vertical-align:top;',\n\t\t\t\tcbro = 'border-radius:'+s.corner.outer+'; ';\n\n\t\tr[''] = 'display:block; z-index:+1; margin-top:'+gap+'; margin-bottom:'+gap+'; '\n\t\t+'background-size:cover; background-position:50% 50%;';\n    \n    r['#in-innavbar']={\n      '+.in-item .in-ct':'margin-top:0!important;',\n      '':'margin-bottom:0;'\n    };\n\t\t\n\t\tr['.in-background .in-ct'] = \n\t\tr['.in-frame .in-ct'] = cbro;\n\n\t\tr['.in-rules #xapp'] = 'padding:'+inset+' 0!important;border-radius:0!important;'\n\t\tr['.in-background #xapp'] = \n\t\tr['.in-frame #xapp'] = 'padding:'+inset+'!important;';\n    \n    // - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-max'] = {\n\t\t\t\n\t\t\t':first-child':'margin-top:0!important;',\n      '+.in-item-max':'margin-top:0!important;',\n\t\t\t\n\t\t\t'': 'min-height:1.2em; width: -webkit-'+c100plus+'width:'+c100plus + cb + 'margin-left:-'+pl+'; margin-right:-'+pr+';',\n\t\t\t'.in-rules + .in--widget.in-item-max.in-rules': {\n\t\t\t\t'':'margin-top:-'+gap+';',\n\t\t\t\t' .in-ct':'border-top:none!important;'\n\t\t\t},\n\t\t\t' .in-ct':'width:100%;border-radius:0!important;border-left:none;border-right:none;',\n\t\t\t' .in-rt-pad':'width:100%;'+cpad,\n\t\t\t' .in-rt-body':cbody + 'width:100%;'+cb,\n\t\t\t' .in-rt-text':ctext + 'width:'+(s.text.width||'100%')\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-wide'] = {\n\t\t\t'': 'min-height:1.2em;'+cbody + cb,\n\t\t\t' .in-ct':cbody + 'width:100%;',\n\t\t\t'.in-rules + .in--widget.in-item-wide.in-rules': {\n\t\t\t\t'':'margin-top:-'+gap+';',\n\t\t\t\t' .in-ct':'border-top:none!important;'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-medium'] = {\n\t\t\t'': 'min-height:1.2em;'+cbody + cl,\n\t\t\t' .in-ct':ctext + 'width:'+(s.text.width||'100%'),\n\t\t\t'.in-rules + .in--widget.in-item-medium.in-rules': {\n\t\t\t\t'':'margin-top:-'+gap+';',\n\t\t\t\t' .in-ct':'border-top:none!important;'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:left; clear:left; margin: 0 '+gap+' '+gap+' -'+pl+';',\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-small-right'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;z-index:+2;',\n\t\t\t' .in-ct': 'width:' + s.aside.small + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t}\n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tr['.in-item-tiny-right'] = {\n\t\t\t'': cbody +'margin: 0 auto 0 auto;z-index:+2;',\n\t\t\t' .in-ct': 'width:' + s.aside.tiny + '; float:right; clear:right; margin: 0 0 '+gap+' '+gap+';',\n\t\t}\n\t\t\n\t\t\n\t\tr[' #xapp '] = _ext2({\n\t\t\t'': s.text.normal\n\t\t}, s.tags||{}, false);\n\t\t\n\t\tr['.in-small #xapp'] = s.text.small;\n\t\tr['.in-large #xapp'] = s.text.large; \n    \n\t\t\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\t_ext(r, {\n\t\t\t\n\t\t\t// Editor related\n\n\t\t\t\" .b0\": \"border:none!important;\",\n\t\t\t\" .CodeMirror, .CodeMirror-gutter-elt\":\"font:13px \"+_font(s.font.fixed)+\";line-height:1.3em;\"\n\t\t\t\t+\"height:auto;min-height:30px!important;\",\n\t\t\t\" #xjs .CodeMirror\":\"height:400px;overflow:hidden;\",\n\t\t\t\" #xapp\": {\n\t\t\t\t\"\":\"display:block;vertical-align:top;\",\n\t\t\t\t\".xdata\" :\"width:auto;padding-right:20px;\"\n\t\t\t},\n\t\t\t\" #xcode\":{\n\t\t\t\t\"\":\"width:100%;\",\n\t\t\t\t\">div\":\"display:inline-block;width:100%;vertical-align:top\",\n\t\t\t\t\"textarea\":\"width:100%; font-size:80%;\"\n\t\t\t},\n\t\t\t\" #ovl\" :{\n\t\t\t\t\"\":\"transition: opacity 0.3s; opacity:0.6;position:absolute; top:6px;right:8px;z-index:+4;\"\n\t\t\t\t\t+\"width:280px; font-size:11pt; line-height:1.3em;\",\n\t\t\t\t' .ovl-tabs':'width:200px;display:inline-block;vertical-align:top;padding-top:3px;',\n\t\t\t\t' .ovl-buttons':'width:80px; float:right; font-size:11pt;text-align: right;',\n\t\t\t\t' .my-tags': {\n\t\t\t\t\t'':'position: relative;',\n\t\t\t\t\t' .tag': {\n\t\t\t\t\t\t'':'padding: 0.15em 0.35em 0.22em 0.35em; white-space: nowrap;text-decoration: none;',\n\t\t\t\t\t\t'.active':'background-color: rgba(162, 206, 237, 0.35);color: #20557d;border-radius: 2px;',\n\t\t\t\t\t\t'.active:hover':'color: #12a5dc;'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\":hover\" : \"opacity:1\"\n\t\t\t},\n\t\t\t\" .bb1\":\"border-bottom:1px solid #ddd;\",\n\t\t\t\" .bt1\":\"border-top:1px solid #ddd;\",\n\t\t\t\" label\":\"display:inline-block; color:#777; margin-right:20px;\",\n\t\t\t\" #xreflect\":{\n\t\t\t\t\"\":\"padding:0px 7px 0px 15px; font:12px \"+_font(s.font.fixed)+\";line-height:1.1em;height:auto;\"\n\t\t\t\t+\"margin:18px 0 18px 0; border-left:1px dotted #C1D0DA; opacity:0.7;\"\n\t\t\t\t+\"white-space: pre-wrap;word-wrap: break-word; overflow:hidden; vertical-align:top; display:none;\",\n\t\t\t\t\".xdata\": \"float:right;display:block;width:270px;\"\n\t\t\t},\n\t\t\t' #btn-run, #btn-code':{\n\t\t\t\t'':'border-radius:100px; padding:0.3em 0.8em 0.4em 0.8em; transition: color 0.3s, background 0.3s;'\n\t\t\t\t+'background-color:#e2f4c8; color:#809b2d; display:inline-block;cursor:pointer;',\n\t\t\t\t'.red':'background-color:#fed3d3; color:#d45'\n\t\t\t}\n\t\t});\n\n\t\treturn r;\n\t\t\n\t\t//=======================\n\t\t\n\t\tfunction _ext (obj, list) {\n\t\t\tif (Object.isObject(list)) {\n\t\t\t\tfor (var i in list) {\n\t\t\t\t\tif (list.hasOwnProperty(i) && !obj[i]) obj[i] = list[i]; \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _ext2 (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t\tfunction _font(a) {\n\t\t\tvar s=[];\n\t\t\t(a||[]).forEach(function(e){\n\t\t\t\tif (/\\s/.test(e)) s.push(\"'\"+e+\"'\");\n\t\t\t\telse s.push(e);\n\t\t\t});\n\t\t\treturn s.length?s.join(\",\"):\"inherit\";\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1460015776628","id": ".T.widget.To.html","type": "js","data": "(function (item, options) {\n\tvar that = this,\n\t\t\td = item,\n\t\t\th = '',\n\t\t\tid = Number.random(1e6, 1e7-1),\n      _clone = Object.clone,\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:null,\n\t\t\t\tpath:'',\n\t\t\t\tinitSync: false,\n\t\t\t\tforceNoEdit:false,\n\t\t\t\tforceUpgradeWidgets:false\n\t\t\t}, Object.isObject(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:[],\n\t\t\t\thatml:'',\n\t\t\t\tstyle:'',\n\t\t\t\tcomment:''\n\t\t\t};\n\tif (!Object.isObject(d) || d.type != that.data.type ) {\n\t\tres.err.push('Error: item of ' + that.data.type + ' type expected.');\n\t\treturn res;\n\t}\n\n\tid = d._stamp || id;\n\n\tvar css=['in-item', 'in--'+d.type];\n\tcss.push ((that.Formats[d.format || 'left750'] || {css:''}).css);\n\t(d.css||[]).forEach(function(e){css.push(\"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-'))});\n\tcss.push(!(d.css||[]).length?\"in-item-nocss\":\"in-item-hascss\");\n\n\t// Prepare manifest\n\t\n\tvar man,\n\t\t\t\n\t\t\ttid \t= \"in-\"+id,\n\t\t\th\t\t\t=\t\"\", \n\t\t\theight,\n\t\t\thtml = \t[],\n\t\t\tscripts = [],\n      data \t= _clone(item, true),\n      noEdit = data.options.indexOf('noedit')>-1 || (opts.forceNoEdit && data.state=='running'),\n      insync = opts.initSync || data.options.indexOf('init sync')>-1,\n      man = _clone(\n        noEdit\n          ?Object.reject(that, ['Compiler','Hoverpane', 'Opts', 'Select', 'To', 'Ico', /^_/])\n          :that, \n        true\n      );\n\n  man.style[' .ovl-tabs'] = 'display:none!important;';\n\tman._compiled = true;\n\t\n\tif (data.source) css.push('in--widget-manifest-'+data.source);\n\n\tif (noEdit) {\n\t\t// Include only executable manifest\n\t\tif (data.err.length || !data.valid) res.err.push('Error: widget code is invalid or has errors');\n\t\telse {\n\n\t\t\tvar refl = data.options.indexOf(\"show data\")>-1,\n\t\t\t\t\tupgrade = (\n\t\t\t\t\t\tthat.Widget && (\n\t\t\t\t\t\t\topts.forceUpgradeWidgets \n\t\t\t\t\t\t\t|| data.options.indexOf('autoupdate') > -1\n\t\t\t\t\t\t)\n\t\t\t\t\t)? that.Widget:null,\n\t\t\t\t\tfn = (that.Widget && that.Widget.To && that.Widget.To.data) ? that.Widget.To.data:null,\n\t\t\t\t\tformdata = data.data,\n\t\t\t\t\tformman = upgrade?js2txt(Object.reject(upgrade,['Opts','To']),''):data.js,\n          formmanid = (upgrade?upgrade.id:'') || '';\n\t\t\t\n\t\t\tif (\n\t\t\t\tthat.RT\n\t\t\t\t&& (\n\t\t\t\t \t(upgrade && upgrade.meta)\n\t\t\t\t\t||\n\t\t\t\t\t// dirty hack to avoid parsing\n\t\t\t\t\t(!upgrade && /(\"meta\"|meta)[\\s]?:[\\s]?{/.test(data.js))\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// Prepare meta\n\t\t\t\tvar sdoc = that.RT().data,\n\t\t\t\t\t\tfmeta = _clone(sdoc.meta || {}, true);\n\t\t\t\tfmeta.id = sdoc._id;\n\t\t\t\tfmeta.tags = sdoc.tags;\n\t\t\t\tfmeta.theme = Object.reject(Object.merge(\n\t\t\t\t\t_clone(that.RT().Theme || {}, true), \n\t\t\t\t\tsdoc.style, \n\t\t\t\t\ttrue\n\t\t\t\t), ['tags']);\n\t\t\t}\n\t\t\t\n\t\t\tif (Object.isFunction(fn)) formdata = fn.call(that, data, opts);\n\t\t\t\n\t\t\tvar bg='', bgurl, style = '';\n\t\n\t\t\tif (bg = (data.bg || '')) {\n\n\t\t\t\tif (/^http[s]?:/.test(bg) || bg.to(1)=='/') bgurl = bg;\n\t\t\t\telse {\n\t\t\t\t\tif (opts.Urls) bgurl = opts.Urls[bg];\n\t\t\t\t\telse bgurl = opts.path + bg;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (bgurl) style += 'background-image:url(\\''+bgurl+'\\')';\n\n\t\t\th+=[\n\t\t\t\t'<div id=\"'+tid+'\" class=\"'+css.join(' ')+'\" style=\"'+style+'\">',\n\t\t\t\t\t'<div class=\"in-ct cw-widget\">',\n        \t\t(refl?'<div id=\"xreflect\" class=\"xdata\"></div>':\"\"),\n\t\t\t\t\t\t'<div id=\"xapp\" class=\"'+(refl?' xdata':'')+'\">'+data.html+'</div>',\n\t\t\t\t\t'</div>',\n\t\t\t\t'</div>'\n\t\t\t].join(\"\");\n\n\t\t\thtml.push(h);\n\t\t\t\n\t\t\t// First, push manifest\n\t\t\t// if we have widget\n\t\t\t\n      if (upgrade && upgrade.id) {\n        if (!formmanid) scripts.push('$.my.cache('+formman+');');\n        else scripts.push('if (!$.my.cache(\"'+formmanid+'\",\"exist\")) $.my.cache('+formman+');');\n      }\n\t\t\t\n\t\t\t// Push starter script\n\t\t\t\n\t\t\tscripts.push([\n\t\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t\t+'(function(){var $f=$(\"#'+tid+'\");$f.find(\"#xapp\").my($.extend('\n\t\t\t\t+(upgrade && upgrade.id?'$.my.cache(\"' + upgrade.id + '\")':formman)\n\t\t\t\t+',{_compiled:true'+(fmeta?',meta:'+JSON.stringify(fmeta):'')+'}), ',\n\t\t\t\tformdata+')',\n\t\t\t\t(refl?'.on(\"change.my\", function(){'\n\t\t\t\t +'$(this).parent().find(\"#xreflect\").html('\n\t\t\t\t +'cw.lib.js2txt($(this).my(\"data\"),\"  \").replace(/^\\{/,\\'{ <span class=\"green\">// App data</span>\\')'\n\t\t\t\t +');'\n\t\t\t\t +'}.debounce(20))':\"\"),\n\t\t\t\t'.then(function(){$f.css({\"height\":\"\", overflow:\"\"});}.debounce(100))',\n\t\t\t\t'});'\n\t\t\t].join('\\n'));\n\t\t}\n\n\t} else {\n\t\t// Include full code\n\t\t/*var norepo = !repo[man.id];\n\t\trepo[man.id]=true;*/\n\t\tvar norepo = true;\n\t\th+=[\n\t\t\t'<div id=\"'+tid+'\" class=\"' + css.join(' ') + '\" style=\"\"></div>',\n\t\t\t/*'<'+'script>',\n\t\t\t//(norepo?'$.my.cache('+cw.lib.js2txt(man,\"  \")+');' : ''),\n\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t+'(function(){var $f=$(\"#'+tid+'\"); $f.my('+js2txt(man,\"  \")+', ',\n\t\t\t\tjs2txt (data,\"  \").replace(/<\\//g, '<\\\\u002F')+')',\n\t\t\t'.then(function(){$f.css({\"height\":\"\", overflow:\"\"});}.debounce(100))',\n\t\t\t'});',\n\t\t\t'<'+'/script>'*/\n\t\t].join('\\n');\n\t\thtml.push(h);\n\t\t\n\t\tscripts.push([\n\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t+'(function(){var $f=$(\"#'+tid+'\"); $f.my('+js2txt(man,\"  \")+', ',\n\t\t\tjs2txt (data,\"  \").replace(/<\\//g, '<\\\\u002F')+')',\n\t\t\t'.then(function(){$f.css({\"height\":\"\", overflow:\"\"});}.debounce(100))',\n\t\t\t'});'\n\t\t].join('\\n'));\n\t\t\n\t}\n\n\t// - - - - - - - - \n\n\tres.html = html.join('');\n\tres.scripts = scripts;\n\n\treturn res;\n\n\t//- - - - - - - - - - - - - - -\n\n\tfunction js2txt (srcObj, tabChar){\n\t\t// outputs js object as string\n\t\t// js2txt(srcObj, tabChar) >> string\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\tfunction f(n){return n<10?'0'+n:n;}\n\n\t\tvar tabs= '\\t'.repeat(20),  \n\t\t\t\tfj = JSON.stringify;\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\tfunction s2 (w, ctab0, tab){\n\t\t\tvar tl=0,a,i,k,l,v,ctab=ctab0||0,xt = tabs;\n\t\t\tif (tab && Object.isString(tab)) {\n\t\t\t\ttl=(tab+\"\").length;xt = (tab+\"\").repeat(20);\n\t\t\t}\n\t\t\tswitch((typeof w).substr(0,3)){\n\t\t\t\tcase 'str': return fj(w).replace(/<\\/scri/ig,'<\\\\u002fscri');\n\t\t\t\tcase'num':return isFinite(w)?''+String(w):'null';\n\t\t\t\tcase 'boo': case'nul':return String(w); \n\t\t\t\tcase 'fun': return _cleanFn(w.toString())\n\t\t\t\t.replace(/\\n([^\\t\\n])/g,'\\n'+(tab?xt.to(ctab*tl+tl):\"\")+'$1')\n\t\t\t\t.replace(/\\n+/g,'\\n')\n\t\t\t\t.replace(/<\\/scri/ig,'<\\\\u002fscri');\n\t\t\t\tcase 'obj': if(!w) return'null';\n\t\t\t\t\tif (Object.isRegExp(w)) return w.toString();\n\t\t\t\t\tif (typeof w.toJSON===\"function\") return s2(w.toJSON(),ctab+(tab?1:0),tab);\n\t\t\t\t\ta=[];\n\t\t\t\t\tif (Object.isArray(w)){\n\t\t\t\t\t\tfor(i=0; i<w.length; i+=1){\n\t\t\t\t\t\t\ta.push(s2(w[i],ctab+(tab?1:0),tab)||'null');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn'['\n\t\t\t\t\t\t+a.join(','+(tab?\"\\n\"+xt.to(ctab*tl+tl):\"\"))\n\t\t\t\t\t\t+']';\n\t\t\t\t\t}\n\t\t\t\t\tfor (k in w) if (Object.isString(k)) {\n\t\t\t\t\t\tv=s2(w[k],ctab+(tab?1:0),tab);\n\t\t\t\t\t\tif(v) a.push((tab?\"\\n\"+xt.to(ctab*tl+tl):\"\")\n\t\t\t\t\t\t\t\t\t\t\t\t +s2(k,ctab+(tab?1:0),tab)+': '+v);\n\t\t\t\t\t};\n\t\t\t\t\treturn '{'+a.join(',')+(tab?\"\\n\"+xt.to(ctab*tl):\"\")+'}';\n\t\t\t}\n\t\t}\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\tfunction _cleanFn (s) {\n\t\t\tvar splitter = /\\)([\\s\\n\\t]+?|\\/\\/*.*?\\*\\/|\\/\\/[^\\n]*\\n)*?\\{/,\n\t\t\t\t\ta = s.split(splitter,1),\n\t\t\t\t\thead = a[0].from(8).replace(/[\\s\\n\\t]+?|\\/\\/*.*?\\*\\/|\\/\\/[^\\n]*\\n/g,'')+\")\",\n\t\t\t\t\ttail = '{' + s.from(a[0].length).replace(splitter,'').replace(/}[^\\}]+$/,'}');\n\t\t\treturn ('function '+head).replace(/^function\\sanonymous/,'function ') +' '+tail;\n\t\t}\n\n\t\t// - - - - - - - - - - - - - - - - - - - - - - -\n\n\t\treturn s2(srcObj,0,tabChar);\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1441381917076","id": ".T.widget.Opts","type": "js","data": "({\n\tparams:{width:320},\n\tdata:{options:[]},\n\tlang:{\n\t\ten:{\n\t\t\tBTN_APPLY:'Apply',\n\t\t\tBTN_CANCEL:'Cancel',\n\t\t\tTITLE:'Widget settings',\n\t\t\tAUTOUPDATE:'Autoupdate widget code',\n\t\t\tNOEDIT:'No Code btn when launched',\n\t\t\tREFLECT:'Reflect data',\n\t\t\tPERSIST:'Persist data into doc',\n\t\t\tSYNC:'Init sync',\n\t\t\tBG_PLC:'Background image...',\n\t\t\tAUX_PLC:'Aux formatting...'\n\t\t},\n\t\tru:{\n\t\t\tBTN_APPLY:'Применить',\n\t\t\tBTN_CANCEL:'Отмена',\n\t\t\tTITLE:'Настройки виджета',\n\t\t\tAUTOUPDATE:'Автообновление кода',\n\t\t\tNOEDIT:'Запрет редактирования кода',\n\t\t\tREFLECT:'Показывать JSON данных',\n\t\t\tPERSIST:'Сохранять данные в документ',\n\t\t\tSYNC:'Синхронная инициализация',\n\t\t\tBG_PLC:'Фоновое изображение...',\n\t\t\tAUX_PLC:'Дополнительные эффекты...'\n\t\t}\n\t},\n\tinit:function($o, form){\n\t\t\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\t$o.html($.my.formgen([\n\t\t\t{row:\"320px\", label:\"70px\", rowCss:\"my-row pb10\", labelCss:\"my-label fs90 gray\"},\n\t\t\t'<div class=\"blue-1 fs130 ml3 mb7\">{TITLE}</div>',\n\t\t\t'<div id=\"format\" class=\"tag-in-fmt mb-2\"></div>',\n\t\t\t'<div id=\"ecss\" class=\"tag-in-fmt mb3\"></div>',\n\t\t\t['', 'inp#css.w100p.fs100'],\n\t\t\t['', 'inp#ebg.w100p.fs100'],\n\t\t\t'<div id=\"xoptions\" class=\"fs90 bt1 pl5 pt0 pb10 blue\">',\n\t\t\t\t\t'<div id=\"xwname\">',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"autoupdate\" />',\n\t\t\t\t\t\t' &nbsp;{AUTOUPDATE}',\n\t\t\t\t\t'</label>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"noedit\" />',\n\t\t\t\t\t\t' &nbsp;{NOEDIT}',\n\t\t\t\t\t'</label>',\n\t\t\t\t\t'<div id=\"xwreflect\">',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"show data\" />',\n\t\t\t\t\t\t\t' &nbsp;{REFLECT}',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"reflect\" />',\n\t\t\t\t\t\t' &nbsp;{PERSIST}',\n\t\t\t\t\t'</label>',\n\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"init sync\" />',\n\t\t\t\t\t\t' &nbsp;{SYNC}',\n\t\t\t\t\t'</label>',\n\t\t\t\t'</div>',\n\t\t\t{rowCss:\"my-row pl5 pb5\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w120.green.mr5',{txt:'{BTN_APPLY}'},\n\t\t\t 'but#btn-cancel.w120',{txt:'{BTN_CANCEL}'}\n\t\t\t]\n\t\t]).assign(L));\n\t\t\n\t\tvar a = ['small normal large', 'background frame rules','accented'],\n\t\t\t\tb = a.join(\" \")+\" \",\n\t\t\t\tecss = [],\n\t\t\t\tcss = [];\n\t\t\n\t\tvar c = (d.css||[]), isNormal = true;\n\t\tc.forEach(function(i){\n\t\t\tif (b.indexOf(i.toLowerCase()+\" \")>-1) ecss.push(i);\n\t\t\telse css.push(i);\n\t\t\tif (i==\"Small\" || i==\"Large\") isNormal = false;\n\t\t});\n\t\t\n\t\tif (isNormal) ecss.push(\"Normal\");\n\t\t\n\t\tthat.Ecss = ecss;\n\t\td.css = css;\n\t\t\n\t\tif (that.Att) {\n\t\t\treturn that.Att(/\\.(jpg|jpeg|png|gif|svg)$/i, \"preview\")\n\t\t\t.then(function(res){\n\t\t\t\tres.forEach(function(e){ that.P[e.fname] = e; });\n\t\t\t});\n\t\t}\n\t},\n\tP:{},\n\tui:{\n\t\t\"#format\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.format=v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.format;\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\tvar that=this, formats = that.Formats,\n\t\t\t\t\t\te0=Object.keys(formats)[0];\n\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\n\t\t\t\t\t\tObject.keys(formats).slice(1)\n\t\t\t\t\t\t.map(function(e){\n\t\t\t\t\t\t\tvar tag={\n\t\t\t\t\t\t\t\tname:'<span class=\"t-'+e+'\"></span>',\n\t\t\t\t\t\t\t\tvalue:e\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn tag;\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tempty:{\n\t\t\t\t\t\tname:'<span class=\"t-'+e0+'\"></span>',\n\t\t\t\t\t\tvalue:e0\n\t\t\t\t\t},\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"#ecss\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar a = ['small normal large', 'background frame rules','accented'];\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags: a.map(function(e){\n\t\t\t\t\t\treturn e.split(\" \").map(function(i){\n\t\t\t\t\t\t\treturn {name:'<span class=\"t-'+i+'\"></span>', value:i.capitalize(), title:i.capitalize()};\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t\ttagcss:\"tag cp\",\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"this.Ecss\"\n\t\t},\n\t\t'#ebg':{\n\t\t\tinit: function($o){\n\t\t\t\tvar that = this;\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\tplaceholder:that.Lang.BG_PLC\n\t\t\t\t})\n\t\t\t},\n\t\t\tbind:'bg'\n\t\t},\n\t\t\n\t\t\"#css\":{\n\t\t\tinit: function($o){\n\t\t\t\tvar that = this;\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[\"Darken\",\"Parallax\"],\n\t\t\t\t\tplaceholder:that.Lang.AUX_PLC\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"css\"\n\t\t},\n\t\t\"#btn-apply\":function(d,v,$o){\n\t\t\tif(v!=null){\n\t\t\t\td.css = d.css.add(this.Ecss||[]).unique().remove(\"Normal\");\n\t\t\t\td.bg = d.bg+'';\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"input[name=options]\":\"options\",\n\t\t\"#xwname\":{\n\t\t\tcss:{hide:function(d){return !d.source}}\n\t\t},\n\t\t\"#xwreflect\":{\n\t\t\tcss:{hide:function(d){return !!d.source}}\n\t\t},\n\t\t\"#btn-cancel\":function(d,v,$o){if(v!=null)$o.trigger(\"cancel\")}\n\t},\n\tEcss:[]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1441386577875","id": ".T.widget.Select","type": "js","data": "({\n\t//params:{width:220},\n\tinit:function($o, form) {\n\t\t$o.on(\"click.my\",\"#wname\",function(){\n\t\t\t var e = $(this).my().root.my(\"data\");\n\t\t\t\n\t\t\tif (e.ui) {\n        var code = cw.lib.unjson(JSON.parse(cw.lib.json(e)));\n\t\t\t\tform.data.extender = {\n\t\t\t\t\tjs:\t\t\t\t'(' + cw.lib.js2txt(code,'\\t') + ')',\n\t\t\t\t\tstate:\t\t'running',\n\t\t\t\t\ttab:\t\t\t['data'],\n\t\t\t\t\toptions:\t['noedit','reflect','autoupdate'],\n\t\t\t\t\tsource:\t\te.id.split('.').last()\n\t\t\t\t};\n        if (code.defaultFormat) {\n          Object.merge(form.data.extender, Object.select(code.defaultFormat, ['format','css']));\n        }\n\t\t\t}\n\n\t\t\t\n\t\t\t$o.trigger(\"commit\");\n\t\t});\n\t\t\n\t\tthis.Widgets = [{name:\"Custom widget\"}]\n\t\t\t.add(form.data.widgets.sortBy(\"name\"));\n\t\t\n\t\t$o.html('<div id=\"wlist\" class=\"pl0\"></div>');\n\t},\n\tui:{\n\t\t\"#wlist\":{\n\t\t\tbind:\"this.Widgets\",\n\t\t\tlist:'<div><img id=\"wico\" class=\"w16 h16 mr5 dib vat mt3\"><span class=\"pseudolink tdn\" id=\"wname\"></span></div>',\n\t\t\tmanifest:{\n\t\t\t\tinherit:['GetIco'],\n\t\t\t\tui:{\n\t\t\t\t\t'#wico': function(d){\n\t\t\t\t\t\treturn d.Ico || this.GetIco();\n\t\t\t\t\t},\n\t\t\t\t\t\"#wname\":function(d,v){\n\t\t\t\t\t\tvar lang = $.my.locale() || 'en';\n\t\t\t\t\t\tif (d.Lang && d.Lang[lang] && d.Lang[lang].APPTITLE) return d.Lang[lang].APPTITLE;\n\t\t\t\t\t\treturn d.name || d.id\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tGetIco: function(){return this.Ico},\n\tIco:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAACUpJREFUeNrkW+tvVEUUn0KhvKSdQmlBELi8ITzSRR4iiNpEFGNMtDEkhm+CXzR8o3/CfjTBaIr6RRNI5IvEqMFU8ElVWBQQRCgjVB5VwOH9KFD8/e7MXXbL3d27e+/tIw6czt27987O+Z0zZ845M1N279498X8u5fxTVlYW64+sSzbXoRoPYl0LGgEaAqoAdYFuWtKgDksnNzetvxpnvyj8MvdPxAA0Jj8eLIWux+Vc0EzQSO87ScalHIrLQbgeRADA9W3Ut7XWZPiu1z/QadDvoBTAON7nAYCkJ6N6EkTmKyRJyrEkfK6RUlQCgop8fYISXNNaXAQoHQDkDOicBYP1btDXUWlGZACA8emoVoNmg+lyMDwJNBX0MEeYK3lJkoL/7P+sot0/mv9xbWr7zS1cK6X1MYDxD27cAn0L2gEgLvUqAOuSySqw8gouF1LajuPMAY9zPCk7jhQOmZaypPYVAVHarQ1I+jw+/4rPJ6zN2O4IvbOpqamrxwGA1J9A9TJoGBifC0YXuOMazCac0pnOB4ZKKWGh0FCJ3bh3Fh9Ogd6DNpzpEQDAOK33WtCjYLoWUl4OiVe5jCccIUW8JRMIDIk2pVQrrq/g41aA8H2sAEDlq8HsBlyOhdQXAIB6MDzAZVzGzXp2SSlFw0AYrqaU3mntwy6AsNUazWgBgOTHodoANmvA/NNgeIJjpd5bhaYhlUpRG7qUVq0AhFPmXujHBy1NTXciA8A6MhvB/CgwvwrM1yQcxzVyfaG0cEi4M4jeB83Yh1v7YRzfKWQcyfuAAJKXVvKjIO3nyXxDou8wz+L2x8w29RDMItyar4RcG+TdvACsW9dMT+1N0BhI/hnO5A29MN6DlIQVCvo2j7MSbi2D8FaHAkA4Yg19eKC6Eg2PSfRR5tMgOEYTQItAE3HrBeukFQ8AXlyIajlQhXMjJ3uN9/VihCTK0O8V6DdjkNcak8nhRQGwMZlksLIGDVQ70llEqfelMV/YJiTofFdAYE/hogoD46WiANBCvsgIDg0sQz2woRenunCaIGG75Cx8fBwa7QQCAA+OQbUSzE9HA7WJfsi8a77cWcGtGadQoxuDasBzlDqQq7cNxOTAqAcoei2wQ8Fx5uFiqp9BLPeZ8xdT+nhxBA1fTD5cOsLL6nDEvyKtJgDaWbjer03IfjSfBnDMl0P6c734vb8XxwzhQdJxaAtmQcij8wGwlJ4eozvHiXPs9xyw0iZjMIlNs8mZJb4A2HTWGKjMNM+IxNapHlYsI0xZaYQrFufSgNm2cxPDMs8wtaUl5QYokeQA0N62lpQotTWPH9STUNVtTDZX+wEwCwgxaTk87NhnrK5tlBbUuvv9pGkj5bbnthtiprDtj7PtzswCIJlMDrBAuQ/IEF6f19nMDA6lp4rUBrZjtChz+tQla5U00eIom4qfngUAQsca11IKWR3WRJksjQ9DkB6lWdhHMMMnXzshhsEAO7WN6z4E6mxdGUb7c3U60wHalo85Sj2d+MzlQYjStMAyhr9VwqxOZTlCNfaZShlC/m487iTcpGU+le8+TDxwCjHG9kt1zuT9oTASPzQMsx6X5656AAyzX1eEnaKll5yw6hrFTBCGcZ8yxNZDMwEYYp2E8qimaGlTVa7fr7KNWS8x7vZJGyOYBsIDgOt45XF4aRx6jM+pCe70qIMZrFiiUIOAx/PgTCPYqdOrslrEUcwYDxoq6aKnzYANs3jp8juZGsAFR6aQ7+KZgVH+Ji2+n9ELEi4rafJ8UQVlFtLb9uPNTABu2Ec6oSdDI2GcKh8yxicQnBZltEB0ZvLsDYHz9gcvh7XayjoyUSY4PCDoSIXtH4bXZYKwuWn95UwAOmx9KUz7ShnfXxcyig0JX1e1UO7RA6IUENLvaME9BX9ne4JKcGGxS4e0gIVyCFRjzggyh2wIQiPAyZeBLjVRk+bfINGRBcDmzetpGNq1WW8PZYH95u0gjD0IlOMbIZo8X2lD0+oBjV+bXzh8BF+fN1tSdAgtkFkd53weKK2u/YZENmhu2yXbEXfbzVmP1+6xAAuXllfhoVOYuqaE8UMoQSJejBen87TFZmhbSvUKPYGibqedy9xNktYAOK1EhbNAmyg14sqQXr7OFtuy51aXnqNw1f86hMJtd3t8U2J2Lf1nPHSKD6dUPB5hjM5mIfXnPkPuHGnNlRNk+YEPgffD9qV+j4D1Qrsg2EOo/4L6t+cEAF9yx9VBrRQf7izWhe2Lha44hHnc7kL9ovv35T7vfAb5zMULB2mDqAlRL5DIHtpbZL1RSv8Xzv0Q8N7uzzywNmj35O6H9A9AVS/HpQV2I0MWRT3ulUmiHgDR7f1E+Owey7VBglvNbnAzoklo9L+hYKSvr6DvlP5vEKxvRtYXADx8AdWnnBGA3iE7jvoN8zax2oWZbBc+XgdtyfVszi0yAGEHnSMg+BP36JogpB9IXilP/ffYzZNbwMu5ogGw4+V90EWVUl9yR2aQvH5vW3yrrUcRmdKIt4L53fneybtLzMbMmxglQp0wheibYdbo4mbeSr8d9Xe4dQxR7keF3iu4URIgnED1Lhq+ABA+p5cY5cJnVGpvmT+B+ivcOiWF3mSj3LylmL3C81GtxxwuE458lsvNfWG7bMY22SNgnp7sSdBbENyVQu+WsFu8eSqqN8BypeM43Ic3OUgmJxaVv59zvKO0+hFDgMHcH6C3wfzNIG2Uel6A62qvg8ZzCxr3EeJ6EA9JxLur5H4U4a044d8FMP4Nrv/F7Z24uy3ILvFQALAkk8lyJSS30a6Q5sTIEmiCY+L3eIDwHDJrezqhAfuUiVmugT7M5ejEAkCGNnCd/VUQT4bV8NgM6kdoW7zdpVHsNoGKez5IJwA4zClOm7UMhrbbgoz3WABgaWxsHCgTDSuZTRLcliplFZieAb6nwFAOy0xkmlNj/knNrFNjOntliA4NvjmmlW6zZww51reD8WNhwI303GADhoUj5GO45P5c97gcgKgDs+OshozOEX36KfwN8N8Bps+gPm2DGY5tOjc7ojpEGdvJUQyNCaiWCnNytC4jDB7BGURwaVpylVa6J0fB8B2oQKd7+EnrS/r+6g2lTVPP8b0n6qO0sQHQDQwyPEOYs8O1lh4S5tyw39lhLlowb/8nWD8exJkJA4Do5dPjZb3542kN+D+X/wQYANGV3Y5/SC+IAAAAAElFTkSuQmCC'\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1439851655376","id": ".ACL","type": "js","data": "({\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t$o.formgen(that.HTML);\n\t\t// Locale\n\t\tthat.Lang = that.lang;\n\t},\n\tlang:{\n\t\ten:{\n\t\t\tAPPLY:'Apply',\n\t\t\tCANCEL:'Cancel',\n\t\t\tTIP: 'For groups use =roleName syntax.',\n\t\t\tPLC: 'Who can edit this doc'\n\t\t},\n\t\tru:{\n\t\t\tAPPLY:'Применить',\n\t\t\tCANCEL:'Отмена',\n\t\t\tTIP:'Для указания групп наберите =Группа',\n\t\t\tPLC: 'Кто может редактировать документ'\n\t\t}\n\t},\n\tui:{\n\t\t\"#owners\":{\n\t\t\tinit: function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[],\n\t\t\t\t\tplaceholder:this.Lang.PLC\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:\"owners\"\n\t\t},\n\t\t\"#warn\":function () {\n\t\t\treturn this.Lang.TIP;\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t\treturn this.Lang.CANCEL;\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t\"#btn-apply\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t\treturn this.Lang.APPLY;\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t}\n\t},\n\tHTML:[\n\t\t'<input id=\"owners\" type=\"text\" class=\"w250\" />',\n\t\t'<div id=\"warn\" class=\"fs80 lh150 xgray mt7 o90\"></div>',\n\t\t{rowCss:\"my-row mt5\"},\n\t\t['',\n\t\t 'but#btn-apply.w100.mr5.green',{txt:'Apply'},\n\t\t 'but#btn-cancel.w100.mr0',{txt:'Cancel'}\n\t\t]\n\t\n\t]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1405141855406","id": ".Ed","type": "js","data": "// Main Editor,\n// used in Inliner as component\n({\n\tid:\"cw.Inliner.Ed\",\n\tparams:{\n\t\tstrict:true, \n\t\trestyle: 120,\n\t\thistoryDelay:1000, \n\t\tremember:10\n\t},\n\t\n\tinherit:['CollapseItems','Att','Config', 'Cmd'],\n\t\n\tRT: function(){return this;},\n  \n  EdContent: '#edcontainer',\n\n\tdata:{\n\t\t_id:\"\", \n\t\ttype:\"inliner\", \n\t\tname:\"\", \n\t\tcreator:\"\", \n\t\towners:[],\n\t\tmeta:{},\n\t\tcontent:[{_stamp:\"1101\",type:\"html\",data:\"<p>Write your content<br></p>\"}], \n\t\tstamp:\"\", \n\t\ttags:[],\n\t\tstyle:{\n\t\t\t/* See .Ed.Theme tab */\n\t\t}\n\t},\n\n\tWidgets:{},\n\n\tui: { /* See tab */ },\n\t\n\n\t//#################################\n\n\tItems:{ /* Container for content plugins */ },\n\n\t//#################################\n\n\tstyle: { /* See tab */ },\n\t\n\tIStyle:{}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1464139884159","id": ".Ed.lang","type": "js","data": "({\n\ten:{\n\t\tCLIP_STASHED:'Doc clip succesfully copied to internal clipboard',\n\t\tCLIP_NOCLIP:'No clip to paste',\n\t\t\n\t\tMETA_PLC:'Doc meta',\n\t\tPREVIEW_PLC:'Preview',\n\t\tCSS_PLC:'Stylesheet',\n\t\tUNDO_PLC:'Undo',\n\t\tNAME_PLC:'Doc title…',\n\t\tHOVERPANE:{\n\t\t\thtml:{css:'hbtn-html', \t\t\ttitle:'Insert text block'},\n\t\t\timg:{css:'hbtn-img', \t\t\t\ttitle:'Add image'},\n\t\t\tembed:{css:'hbtn-embed', \t\ttitle:'Add video or other embed'},\n\t\t\twidget:{css:'hbtn-widget', \ttitle:'Add widget'},\n\t\t\t_opts:{css:'hbtn-cog', \t\t\ttitle:'Below block settings'},\n\t\t\t_copy:{css:'hbtn-copy', \t\ttitle:'Copy block'},\n\t\t\t_paste:{css:'hbtn-paste', \ttitle:'Paste block'},\n\t\t\t_del:{css:'hbtn-del', \t\t\ttitle:'Delete block'},\n\t\t}\n\t},\n\tru:{\n\t\tCLIP_STASHED:'Блок скопирован в буфер',\n\t\tCLIP_NOCLIP:'Нет фрагмента для вставки',\n\t\t\n\t\tMETA_PLC:'Метаданные документа',\n\t\tPREVIEW_PLC:'Просмотр',\n\t\tCSS_PLC:'Стили документа',\n\t\tUNDO_PLC:'Отменить',\n\t\tNAME_PLC:'Имя документа…',\n\t\tHOVERPANE:{\n\t\t\thtml:{css:'hbtn-html', \t\t\ttitle:'Вставить блок текста'},\n\t\t\timg:{css:'hbtn-img', \t\t\t\ttitle:'Вставить изображение'},\n\t\t\tembed:{css:'hbtn-embed', \t\ttitle:'Вставить видео или фрейм'},\n\t\t\twidget:{css:'hbtn-widget', \ttitle:'Вставить виджет'},\n\t\t\t_opts:{css:'hbtn-cog', \t\t\ttitle:'Настройки блока'},\n\t\t\t_copy:{css:'hbtn-copy', \t\ttitle:'Скопировать блок в буфер'},\n\t\t\t_paste:{css:'hbtn-paste', \ttitle:'Вставить блок из буфера'},\n\t\t\t_del:{css:'hbtn-del', \t\t\ttitle:'Удалить блок'},\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1459553796684","id": ".Ed.Theme","type": "js","data": "({\n\tbody:{\n\t\tmin:\"750px\",\n\t\tmax:\"950px\"\n\t},\n\tfont:{\n    header:\t[\"-apple-system\", \"BlinkMacSystemFont\", \"Helvetica Neue\", \"Segoe UI\", \"Roboto\",\n             \"Helvetica\", \"Tahoma\", \"Arial\", \"Verdana\", \"Sans-serif\"],\n    \n    main:\t\t[\"-apple-system\", \"BlinkMacSystemFont\", \"Helvetica Neue\", \"Segoe UI\", \"Roboto\",\n          \t \"Helvetica\", \"Tahoma\", \"Arial\", \"Verdana\", \"Sans-serif\"],\n    \n    accent:\t['Georgia','Times', 'serif'],\n    \n    fixed: \t['Cousine','PT Mono','Monaco','Lucide Console','monospace']\n\t},\n\ttext:{\n\t\tmin:\"400px\",\n\t\tmax:\"750px\",\n\t\tnormal:'font-size:13pt; color:#333; font-weight:400;',\n\t\tsmall:'font-size:11pt; color:#444; font-weight:400;',\n\t\tlarge:'font-size:18pt; color:#555; font-weight:200;',\n\t},\n\tthemes:{\n\t\t'background': 'background-color:rgb(239, 243, 247);', \n\t\t'frame': 'border:1px solid #ddd;',\n\t\t'rules': 'border-top:1px solid #ddd; border-bottom:1px solid #ddd;',\n\t},\n\ttags:{\n\t\t'p': \t\t'font-size:1em; line-height:1.6em; margin:0.2em 0 0.8em 0; color:inherit; font-weight:inherit;',\n\t\t'a':\t\t'color: #2a70a6;',\n\t\t'h1':\t\t'font-size:2.7em; line-height:0.95em; margin:0.5em 0 0.4em 0; color:inherit; font-weight:600;',\n\t\t'h2':\t\t'font-size:1.9em; line-height:1em; margin:0.5em 0 0.4em 0; color:inherit; font-weight:600;',\n\t\t'h3':\t\t'font-size:1.5em; line-height:1.2em; margin:0.5em 0 0.4em 0; color:inherit; font-weight:600;',\n\t\t'h4':\t\t'font-size:1.2em; line-height:1.2em; margin:0.5em 0 0.4em 0;color:inherit; font-weight:600;',\n\t\t'blockquote':\n\t\t\t\t\t\t'font-size:1.2em; line-height:1.3em; margin: 1em 1em 1em 2em;color:inherit; '\n\t\t\t\t\t\t+'font-weight:inherit; font-style:italic;',\n\t\t'ul,ol':'padding-left:2em;margin:0.2em 0 0.8em 0;',\n\t\t'ul>ul,ol>ul,ol>ol':\n\t\t\t\t\t\t'margin:0.2em 0;',\n\t\t'li':\t\t'margin-left:1em;',\n\t\t'code':\t'background-color:rgb(229, 233, 235); border-radius:2px; font-size:85%; padding:0.15em 0.3em;',\n\t\t'table':'max-width:100%; display:table; border-collapse:collapse; margin:1em 0;',\n\t\t'td':\t\t'max-width:50%;min-width:2em;line-height:1.3em;border:1px solid #ddd; '\n\t\t\t\t\t\t+'vertical-align:top; padding:0.2em 0.4em;'\n\t},\n\tpad:{\n\t\tinset:\"0.6em\",\n\t\tgap:\"1.2em\",\n\t\tleft:\"25px\",\n\t\tright:\"25px\"\n\t},\n\taside:{\n\t\tsmall:\"450px\",\n\t\ttiny:\"250px\"\n\t},\n\tcorner:{\n\t\touter:\"4px\",\n\t\tinner:\"1px\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1406145389668","id": ".Ed.init","type": "js","data": "(function ($o, form) {\n\t\n\tvar that = this, \n\t\t\ti, old,\n\t\t\td = form.data,\n\t\t\tnow = Date.now(),\n\t\t\tlang = 'en';\n\t\n\t// Locale\n\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t// that.Lang = that.Lang[lang];\n\tthat.Lang = that.lang;\n  \n\t// Prepare doc\n\tif (form.data.title) delete form.data.title;\n\t\n\tfor (i=0;i<d.content.length;i++) {\n\t\tif (!d.content[i]._stamp || d.content[i]._stamp=='1101') {\n\t\t\td.content[i]._stamp = cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6));\n\t\t}\n\t\tif (d.content[i]._new) delete d.content[i]._new;\n\t\t\n\t\t// translate type:code to widget:in.Code\n\t\tif (d.content[i].type=='code') {\t\n\t\t\told = d.content[i];\n\t\t\td.content[i] = {\n\t\t\t\t_stamp:old._stamp, type:'widget', js:'('+cw.lib.js2txt(that.Widgets.Code)+')', html:\"\",\n\t\t\t\tdata:'('+JSON.stringify({ type:\"inliner-codesample\", tab:old.tab, js:old.js, html:old.html, css:old.css})+')',\n\t\t\t\tstate:\"running\", tab:[\"data\"], options:[\"noedit\",\"reflect\",\"autoupdate\"],\n\t\t\t\tvalid:true, err:[], source:\"Code\", format:\"left500\", css:[], bg:''\n\t\t\t};\n\t\t}\n\t}\n\t\n\t// Remove previews for non-existing attaches\n\t\n\tif (d.previews) Object.keys(d.previews).forEach(function(i){\n\t\tif (!(d._attachments||{})[i]) delete d.previews[i];\n\t});\n\t\n\t// Build DOM\n\t$o.formgen('init', that.HTML.assign(that.Lang));\n  \n  // View mode\n  if (!that.Cmd) that.Cmd = function(){return 'view'};\n  if (that.Cmd() == 'view') {\n  \t$o.addClass('in-view-mode');\n  }\n\n  // Hoverpane container\n\tif (!$o.find(\"#hoverpane:eq(0)\").size()) {\n\t\t$($(that.Hoverpane()).attr(\"id\",\"hoverpane\")[0].outerHTML)\n\t\t.prependTo($o);\n\t}\n\t\n\t// Build Hoverpane sceleton\n\tvar $ho=$o.find(\"#hoverpane:eq(0)\"),\n\t\t\t$me = $o.find(\"#medium\"),\n\t\t\thh = $ho.height(),\n\t\t\tdx = $o.offset().left,\n\t\t\tdy = $o.offset().top;\n\t\n\t// ---------------------------\n\t\n\tthat.Insert = that.Insert($o);\n\t\n\t// ---------------------------\n\t\n\t// Update widgets code\n\tthat.UpdateWidgets(d);\n\t\n\t// ---------------------------\n\n\t// Hoverpane actions\n\tthat.Actions($o, form);\n\t\n\t// ---------------------------\n  \n  // Click-open links to local docs\n  that.TrackLocalLinks($o.find(that.EdContent), true);\n  that.TrackLocalLinks($o.find('#renderer'), true);\n  \n  // ---------------------------\n\n\t// Hoverpane tracker\n\t$me.on(\n\t\t\"mousemove.my\", \n\t\tObject.values(that.Items)\n\t\t.map(function(e){return e.Hoverpane})\n\t\t.compact()\n\t\t.join(\", \"), \n\t\tfunction (evt) {\n\t\t\tvar dx = $o.offset().left,\n\t\t\t\t\tdy = $o.offset().top,\n\t\t\t\t\tscy = $o.scrollTop(),\n\t\t\t\t\t$x = $(this), \n\t\t\t\t\tofs = $x.offset(), \n\t\t\t\t\th=$x.height(),\n\t\t\t\t\tex = evt.clientX, \n\t\t\t\t\tey = evt.clientY,\n\t\t\t\t\tx = ofs.left,\n\t\t\t\t\ty = ofs.top, \n\t\t\t\t\tafter=false, \n\t\t\t\t\tfulltop=0, \n\t\t\t\t\t$form, type, ohtml=\"\", fhtml=\"\", showDel = true;\n\t\t\t\n\t\t\thh = $ho.height();\n\t\t\t//correct pos if we inside Redactor, that has floating content\n\t\t\tif ($x.is(\".redactor_box *\")) {\n\t\t\t\t//insert and del small shim\n\t\t\t\tvar $i=$('<b>\\u200b</b>').prependTo($x);\n\t\t\t\tx=$i.offset().left;\n\t\t\t\t$i.remove();\n\t\t\t}\n\n\t\t\tfulltop = y-dy-hh+scy-2; \n\t\t\tif ($ho.data(\"hoverpane\") && $ho.data(\"hoverpane\").top && Math.abs($ho.data(\"hoverpane\").top-fulltop)<3) \n\t\t\t\tfulltop = $ho.data(\"hoverpane\").top;\n\n\t\t\t$ho.css({top:(fulltop | 0)+\"px\", left:(x-dx-23)+\"px\"});\n\n\t\t\t$ho.toggleClass(\"cw-half\", (ex-x<100 /*&& Math.abs(y+h/2-ey+scy)-h/2<40*/));\n\n\t\t\t$form = $x.parents(\".my-form:eq(0)\");\n\t\t\ttype = $form.my(\"data\").type;\n\t\t\t\n\t\t\t\t\t\t\n\t\t\tvar prev = d.content[$form.data(\"formlist\").index-1],\n\t\t\t\t\tcurr = $form.my(\"data\"),\n\t\t\t\t\thide = {};\n\n\t\t\tif (type==\"html\") {\n\t\t\t\tohtml=$x[0].outerHTML;\n\t\t\t\tfhtml=curr.data;\n\t\t\t\t// Allow del for empty and non-last html items\n\t\t\t\tshowDel = !!(\n\t\t\t\t\t\n\t\t\t\t\tthat.data.content.last() !== curr\n\t\t\t\t\t&& (\n\t\t\t\t\t\t(fhtml===ohtml && ohtml.stripTags()===\"\")\n\t\t\t\t\t\t|| (curr.css||[]).length\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\tif (curr.type == \"html\" && !(curr.css||[]).length) hide.html = true;\n\t\t\tif (curr.type != \"html\") {\n\t\t\t\tif (prev && prev.type==\"html\" && !(prev.css||[]).length) hide.html = true;\n\t\t\t}\n\n\t\t\t$ho.html($(that.Hoverpane(type, showDel, hide)).html());\n\n\t\t\tif (type===\"html\") {\n\t\t\t\t$ho.data(\"hoverpane\",{\n\t\t\t\t\tform:$form, \n\t\t\t\t\tp:\" \", \n\t\t\t\t\tafter:after, \n\t\t\t\t\ttop:fulltop, \n\t\t\t\t\tval:$x,\n\t\t\t\t\tprev:prev\n\t\t\t\t});\n\t\t\t}\n\t\t\telse $ho.data(\"hoverpane\",{\n\t\t\t\tform:$form, \n\t\t\t\tafter:after, \n\t\t\t\ttop:fulltop\n\t\t\t});\t\t\n\n\t\t}.debounce(50)\n\t);\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1536351687494","id": ".Ed.TrackLocalLinks","type": "js","data": "//<a> click\n(function ($container, suppress){\n  \n  // Set up tracking of <a> link clicks for $container,\n  // cancels link open if doc exists locally\n  // and can be opened; then opens doc\n  \n  // Links hooked should have href=\"./local_id\", where local_id\n  // is valid uuid (cw.uuid.test(local_id)=>true)\n  \n\tvar that = this;\n  $container.on('click.my','a', function(evt){\n    // console.log(evt)\n    var url = $(evt.currentTarget || evt.target).attr('href')+'',\n        $t;\n    if (suppress && url[0]=='#') {\n      $t = $container.find(url);\n    \tif ($t.length) {\n        evt.preventDefault();\n        $container.parent().animate({\n          scrollTop: $t.offset().top + $container.parent()[0].scrollTop - 50\n        }, 200);\n    \t}\n      return;\n    }\n    if (!/^\\.\\/.+$/.test(url)) return;\n    var au = url.from(2).split('#'),\n        id = au[0];\n    if (!cw.uuid || !cw.uuid.test(id)) return;\n    \n    evt.preventDefault();\n    \n    // Seems local doc, try to retrieve its type\n    that.db.query('DB-Shell/info',{keys:[id]})\n    .then(function(res){\n    \tif (!res.rows || ! res.rows.length) return;\n      var doc = res.rows[0].value,\n          t = doc.type;\n      var opt = that.db.actions(t),\n          app = '',\n          act = '';\n      \n      if (!Object.size(opt)) return;\n      \n      ['view','edit'].forEach(function(i){\n        if (app || !Object.isArray(opt[i]) || !opt[i].length) return;\n        app = opt[i][0].replace(/^cw\\./, '');\n        act = i;\n      });\n      \n      if (!app) return;\n      \n      var path = [that.db.name, app, cw.lib.tourl64([act, id])].join('/');\n      cw.state.set(path);  \n    })\n    .fail(function(){\n    \t// Do nothing\n    });\n  });\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1537147008952","id": ".Ed.CouchQS","type": "js","data": "(function _inliner2obj (doc0, opts){\n  \n  /* \tRenders Inliner doc (type:'inliner') with opts.\n  \t\tOpts {\n      \t_id\t\t\t\t\t\t\t\t\t// Doc _id replacement, optional\n        _db\t\t\t\t\t\t\t\t\t// Doc _db replacement, optional\n        project\t\t\t\t\t\t\t// Project name\n        base\t\t\t\t\t\t\t\t// Site base \n        mobile\t\t\t\t\t\t\t// Obj with doc.style extensions/replacements for mobiles\n        tx\t\t\t\t\t\t\t\t\t// {'Step1':2, 'Step3':5}, duration of steps, initial value\n        t0\t\t\t\t\t\t\t\t\t// Previous timestamp, int\n        \t\t\t\t\n        header\t\t\t\t\t\t\t// Header, should be Inliner content item\n        footer\t\t\t\t\t\t\t// Footer, should be Inliner content item\n        \t\t\t\t\n        renderStyle\t\t\t\t\t// Render stylesheets, true\n\t\t\t\timportant\t\t\t\t\t\t// Add !important to widgets styleshhets, true\n\t\t\t\tinitSync \t\t\t\t\t\t// Start widgets in sync, false\t\n\t\t\t\tforceNoEdit\t\t\t\t\t// Always disable widget editors, true\n\t\t\t\tupgradeWidgets \t\t\t// Force using pre-built versions of known widgets, false\n        upgradeStyle\t\t\t\t// Force style uprade if .meta.template key is in Themes\n\t\t\t\tpath\t\t\t\t\t\t\t\t// path template for attaches, like '/file/{_db}/{_id}/'\n        \n        Inliner\t\t\t\t\t\t\t// Inliner app object\n        Themes\t\t\t\t\t\t\t// Themes object\n      }\n  \n  \t \tReturns {\n        project\t\t\t// HTML-escaped project name from opts.project\n        title\t\t\t\t// HTML-escaped page title, from .meta.pagetitle or .name\n        description\t// Escaped desc, from .meta.description or .name\n        _id\t\t\t\t\t// doc _id\n        hid\t\t\t\t\t// Last 8 chars of doc _id\n        bodyStyle:\t// ''\n        style\t\t\t\t// String of CSS rules to display page\n        scripts\t\t\t// String with scripts, required to run before HTML\n        html\t\t\t\t// HTML\n        docmeta\t\t\t// JSON string with doc.meta\n        tx\t\t\t\t\t// {op_name:1, op_name1:12,...} duration of steps in ms\n      }\n\t*/\n\t\n\tvar _clone = Object.clone,\n\t\t\tdoc = _clone(doc0, true),\n      id  = doc._id,\n      hid = id.substr(-8),\n\t\t\ttx  = _clone(opts.tx || {}, true),\n\t\t\tt0  = opts.t0 || Date.now(),\n\t\t\tmobile = !!opts.mobile,\n      html, \n      menu,\n      res;\n  \n  _tx('Render start'); \n  \n  \n  // ###### Prepare Inliner instance ######\n\n  var Inliner = opts.Inliner || require('lib/Inliner').Inliner,\n      Themes \t= opts.Themes  || require('lib/Themes').Themes,\n      ed \t\t\t= _clone(Inliner.Ed, true),\n      style = Object.merge(\n        _clone(ed.Theme, true), \n        (doc.meta.template && Themes[doc.meta.template] ? Themes[doc.meta.template] : doc.style), \n        true\n      );\n  \n  // Add RT() to Inliner.Ed items, fake $.my environment\n  Object.keys(ed.Items).forEach(function(i){\n\t\ted.Items[i].RT = function(){return ed};\n\t});\n\n\t// Override style, meta.base and _id/_db\n  Object.merge(doc, {\n    _id:\t\t\topts._id || hid,\n    _db:\t\t\topts._db || doc._db,\n  \tstyle:\t\topts.upgradeStyle === undefined || opts.upgradeStyle ? style : doc.style,\n    meta:{\n      _mobile:mobile,\n    \tbase:\t\topts.base\n    }\n  }, true);\n\n\t// Override style for mobile\n\tif (mobile && Object.isObject(opts.mobile)) {\n\t\tObject.merge(doc.style, mobile, true);\n\t}\n\n\t// Remove empty html block at the end, if any\n\tvar last = doc.content.slice(0).last();\n\tif (\n    last \n    && last.type == 'html' \n    && last.data.length <50 \n    && !last.data.stripTags().compact()\n  ) doc.content.pop();\n\n\t// Add header / footer widgets\n  if (opts.header && opts.header.type=='widget') doc.content.unshift(_clone(opts.header, true));\n\tif (opts.footer && opts.footer.type=='widget') doc.content.push(_clone(opts.footer, true));\n  \n  // Bind doc to Inliner instance\n  ed.data = doc;\n  \n  _tx('Render prepared');\n  \n\n\t// ###### Render article #######\n\n\t// Remove content blocks unsuitable for mobiles,\n  // also re-order asides for mobiles\n\tif (mobile) { \n\t\tdoc.content = doc.content.filter(function(e){\n      var css = e.css||[];\n      return css.indexOf('Nomobile') == -1 && css.indexOf('NoMobile') == -1;\n    })\n    .map(function(e,i){\n      var css = e.css||[],\n          isDrop = css.find('InlineAfter');\n      e._idx = ('0000'+(isDrop?(i*2+3):(i*2)).toString(36)).substr(-4);\n      return e;\n    })\n    .sort(function(a,b){\n    \treturn a._idx>b._idx?1:a._idx<b._idx?-1:0;\n    });\n\t}\n\n  // Call renderer\n\tres = ed.To.html.call(ed, doc, {\n\t\tstyle:\t\t\t\t\t\t\t\topts.renderStyle!= undefined ? !!opts.renderStyle : true,\n\t\timportant:\t\t\t\t\t\topts.important !== undefined ? !!opts.important : true,\n\t\tinitSync: \t\t\t\t\t\t!!opts.initSync,\n\t\tforceNoEdit:\t\t\t\t\topts.forceNoEdit !== undefined ? !!opts.forceNoEdit : true,\n\t\tforceUpgradeWidgets:\t!!opts.upgradeWidgets,\n\t\tpath:\t\t\t\t\t\t\t\t\t((opts.path || '/file/{_id}/')+'').assign(doc)\n\t});\n\n\t// Add script to run chain if chainable run\n\tif (!opts.initSync) {\n\t\tres.scripts.push([\n\t\t\t'$(function(){var c = $.my.chain;',\n\t\t\t'c(Inliner.ScrollToHash\t\t\t,10\t\t,10);',\n\t\t\t'c(Inliner.Parallax.fill(!0),1000\t,500);',\n\t\t\t'c(Inliner.Parallax.fill(!0),10  \t,500);',\n\t\t\t'c(Inliner.ScrollToHash\t\t\t,10\t\t,10);',\n\t\t\t'c.start();});'\n\t\t].join('\\n'));\n\t}\n  \n  _tx('Render done');\n  \n  // Store stamps to opts for chaining metrics\n  if (opts.tx) opts.tx = tx;\n  if (opts.t0) opts.t0 = Date.now();\n\t\n\treturn {\n\t\tproject:\t\t\t((opts.project || 'Inliner')+'').escapeHTML(),\n\t\ttitle: \t\t\t\t(((doc.meta ? doc.meta.pagetitle:'') || doc.name) + '').escapeHTML(),\n\t\tdescription: \t(((doc.meta ? doc.meta.description || doc.meta.pagetitle || '':'') || doc.name) + '').escapeHTML(),\n    _id:\t\t\t\t\tid,\n\t\thid:\t\t\t\t\thid,\n\t\tbodyStyle:\t\t'',\n\t\tstyle:\t\t\t\tres.style,\n\t\thtml:\t\t\t\t\tres.html,\n\t\tscripts:\t\t\t(res.scripts || []).join('\\n\\n'),\n\t\tdocmeta:\t\t\tJSON.stringify(doc.meta),\n    tx:\t\t\t\t\t\ttx\n\t}\n\n  // - - - - - \n  \n  function _tx(step) {\n  \ttx[step] = Date.now() - t0;\n    t0 = Date.now();\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1460808975928","id": ".Ed.ui","type": "js","data": "// title, editor, preview\n({\n  '#title':{\n    bind: function (d,v,$o){\n      var re = /[\\n\\r\\t]+/g;\n      if (v!=null) {\n        d.name = v.replace(re,\" \").compact(); \n        return v.replace(re,\" \");\n      }\n      return d.name.replace(re,\" \");\n    }\n  },\n\n  '#medium':{\n    delay:80,\n    bind:\"content\",\n    init: function($o){\n      //\t$o.sortable();\n    },\n    manifest: function (v, idx, list, $o) {\n      var that = this;\n      if (that.Cmd() == 'view') return that.Empty;\n      var spin = {\n        $Root:$o.my().root, \n        Idx:idx,\n        //Items:that.Items,\n        Insert:that.Insert,\n        Hoverpane:that.Hoverpane(),\n        Cropper:that.Cropper,\n        RT: function(){return that;}\n      };\n      return $.extend(spin, that.Items[v.type]);\n    },\n    list:'<div class=\"in-item\"></div>',\n    hash: function(item){\n      if (item.type===\"img\") {\n        return item.data.length+cw.lib.sdbm(Object.reject(item,\"data\"))\n      }\n      else return cw.lib.sdbm(item);\n    },\n    id: function(item){\n      return item._stamp + \"|\"+(item.random||\"\");\n    }\n  },\n\n  '#renderer': {\n    delay:100,\n    bind: function(d,v,$o){\n      var that = this;\n      //console.log(v?v.to(50):'---');\n      if (v==null || $o.find('div').length) return;\n      if (that.Cmd() != 'view') {\n        $o.html('');\n        return;\n      }\n\n      var h = '',  css = '',\n          _json2css = $.my.f._s2css,\n          atts = Object.keys(d._attachments || {});\n      \n      if (!atts.length) _render(that.Att('*','session'));\n      else {\n      \tQ.allSettled(atts.map(function(fname){\n        \treturn that.Att(fname,'url');\n        }))\n        .then(function(){\n        \t_render(that.Att('*','session'));\n        })\n      }\n\n      return v;\n      \n      // - - - - -\n      \n      function _render(uu){\n        try {\n          var res = that.To.html.call(that, Object.clone(d, true), {\n            style:\t\t\ttrue, \n            Urls:\t\t\t\tuu,\n            initSync: \ttrue,\n            forceNoEdit:true,\n            forceUpgradeWidgets:true\n          });\n        }\n        catch(e){\n          console.log(e)\n        }\n\n        h = '<!-- stylesheet -->\\n<style>\\n'+res.style+'</style>\\n\\n<!-- content -->\\n'+res.html;\n\n        h+='<sc'+'ript>'+res.scripts.map(function(e){\n        \treturn e.replace(/script>/g,'s'+'\\\\u0063'+'ript>')\n        }).join('\\n\\n')+'<'+'/'+'sc'+'ript>';\n\n        var w = (window.innerWidth - 90).clamp(1024, 1920);\n\n        $o.html(h);\n      }\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1462051988465","id": ".Ed.ui","type": "js","data": "// buttons\n({\n\t\"#btn-style\":{\n\t\tbind: function(d,v, $o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\troot:that.my.parent().my.root(),\n\t\t\t\t\tmanifest:that.Themer,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tsrc:$.extend(true,{},d.style||{}),\n\t\t\t\t\t\ttheme:$.extend(true,{},that.Theme)\n\t\t\t\t\t},\n\t\t\t\t\twidth:918,\n\t\t\t\t\tbound:23,\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs80 pt15\",\n\t\t\t\t\tesc:true\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\td.style = res.dest;\n\t\t\t\t\tthat.my.root().my(\"restyle\");\n\t\t\t\t\tthat.my.root().trigger('change');\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t'self:hide':function(){\n\t\t\t\tvar me;\n\t\t\t\tif (cw.me && (me = cw.me(null))) {\n\t\t\t\t\treturn !(me.roles||['app-admin']).find(/(^_admin|^app-admin)$/);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-preview\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\tvar h = '',\n\t\t\t\t\t\tcss = '',\n\t\t\t\t\t\t_json2css = $.my.f._s2css;\n        \n        var uu = that.Att('*','session');\n\n\t\t\t\ttry {\n\t\t\t\t\tvar res = that.To.html.call(that, Object.clone(d, true), {\n\t\t\t\t\t\tstyle:\t\t\t\t\t\t\ttrue, \n\t\t\t\t\t\tUrls:\t\t\t\t\t\t\t\tthat.Att('*','session'),\n\t\t\t\t\t\tinitSync: \t\t\t\t\ttrue,\n            forceNoEdit:\t\t\t\ttrue,\n\t\t\t\t\t\tforceUpgradeWidgets:true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch(e){\n\t\t\t\t\tconsole.log(e)\n\t\t\t\t}\n\n\t\t\t\th = '<!-- stylesheet -->\\n<style>\\n'+res.style+'</style>\\n\\n<!-- content -->\\n'+res.html;\n\t\t\t\t\n\t\t\t\th+='<sc'+'ript>'+res.scripts.map(function(e){\n        \treturn e.replace(/script>/g,'s'+'\\\\u0063'+'ript>')\n        }).join('\\n\\n')+'<'+'/'+'sc'+'ript>';\n        \n        var w = (window.innerWidth - 90).clamp(1024, 1920);\n\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:{\n\t\t\t\t\t\tinit: function($o){\n              $o.css({width:w+'px'}).html('<div id=\"pdoc\">'+h+'</div>');\n\t\t\t\t\t\t\t$o.css({\n                'overflow-x':'hidden', \n                'max-height':(window.innerHeight - 100)+'px',\n                'min-height':(window.innerHeight - 100)+'px'\n              });\n              that.TrackLocalLinks($o.find('#pdoc'), true);\n\t\t\t\t\t\t\t//$o.niceScroll();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tui:{\"#x\":'x'},\n\t\t\t\t\t\tdata:{x:1}\n\t\t\t\t\t},\n\t\t\t\t\twidth:w\n\t\t\t\t})\n\t\t\t\t.fail(function(res){\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-meta\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif(v!=null) {\n\n\t\t\t\tvar a = [], \n            id = Number.random(1,1e6);\n\t\t\t\tObject.keys(d.meta)\n\t\t\t\t.forEach(function(i){ \n\t\t\t\t\ta.push({id:id+\"\", key:i, value:d.meta[i]});\n\t\t\t\t\tid+=1;\n\t\t\t\t})\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.Meta,\n\t\t\t\t\tdata:{meta:a},\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs80\",\n\t\t\t\t\twidth:718,\n\t\t\t\t\tbound:23,\n\t\t\t\t\tesc:true\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\tvar a = res.meta,\n\t\t\t\t\t\t\tm = {};\n\n\t\t\t\t\ta.forEach(function(elt){\n\t\t\t\t\t\tif (elt.key != \"id\" && elt.key !=\"tags\" && elt.key != \"name\") {\n\t\t\t\t\t\t\tif (!m[elt.key]) m[elt.key] = \"\";\n\t\t\t\t\t\t\telse m[elt.key]+='\\n';\n\t\t\t\t\t\t\tm[elt.key] += elt.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\td.meta = m;\n\t\t\t\t\tthat.my.root().my(\"restyle\");\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tevents:\"click.my\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1462053341865","id": ".Ed.HTML","type": "html","data": "<section id=\"renderer\" class=\"w100p\"></section>\n<div id=\"topnav\" class=\"cb bbs pb10 w100p\" >\n\t<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n\t\t<tr>\n\t\t\t<td width=\"1%\" ><nobr>\n\t\t\t\t<button id=\"btn-meta\" class=\"btn w40 mt0 vat fs90 mr2 btn-l\" title=\"{META_PLC}\">\n\t\t\t\t\t<span class=\"fi-pricetag-multiple\"></span>\n\t\t\t\t</button>\n        \n        <button id=\"btn-style\" class=\"btn w40 mt0 vat fs90 btn-c mr2\" title=\"{CSS_PLC}\">\n\t\t\t\t\t<span class=\"fi-css3\"></span>\n\t\t\t\t</button>\n\n\t\t\t\t<button id=\"btn-preview\" class=\"nocwmin btn w40 mt0 vat fs90 mr10 btn-r\" title=\"{PREVIEW_PLC}\">\n\t\t\t\t\t<span class=\"fi-eye\"></span>\n\t\t\t\t</button>\n\n\t\t\t\t<!--<button id=\"btn-undo\" class=\"btn w40 mt0 mr10 vat fs90 btn-r\" title=\"{UNDO_PLC}\">\n\t\t\t\t\t<span class=\"fi-rewind\"></span>\n\t\t\t\t</button>-->\n\t\t\t\t\n\t\t\t\t</nobr></td>\n\t\t\t\n\t\t\t<td>\n\t\t\t\t<input type=\"text\" id=\"title\" rows=1 class=\"gray lh120 w100p\" \n\t\t\t\t\t\tstyle=\"font-size:1.4em;border:none;padding:0;margin:2px 0 0 0;box-shadow:none;color:#333;min-height:0;resize:none;\" \n\t\t\t\t\t\tplaceholder=\"{NAME_PLC}\">\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n</div>\n<div id=\"edcontainer\" style=\"\">\n\t<div id=\"medium\" class=\"cb\" ></div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1459553023586","id": ".Ed.style","type": "js","data": "({\n  ' #topnav, #edcontainer':'display:block;',\n  ' #renderer':'display:none;',\n  '.in-view-mode':{\n  \t' #topnav, #edcontainer':'display:none;',\n    ' #renderer':'display:block;'\n  },\n\t\" #medium\":function(){\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.Theme, true), that.data.style || {}, true),\n\t\t\t\ta = [], sbody;\n\t\ta.push(\n\t\t\t'padding-left:'+s.pad.left, \n\t\t\t'padding-right:'+s.pad.right\n\t\t);\n\t\tif (s.body.bg) {\n\t\t\tif (sbody = s.body) {\n\t\t\t\tif (/^http/.test(sbody.bg)) {\n\t\t\t\t\ta.push(\n\t\t\t\t\t\t'background-image:url('+sbody.bg+')',\n\t\t\t\t\t\t'background-position:50% 50%',\n\t\t\t\t\t\t'background-size:cover'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse a.push('background-color:'+sbody.bg);\n\t\t\t}\n\t\t}\n\n\t\treturn a.join(';').replace(/[<>\"]+/g,'');\n\t},\n  \" #medium \":\"padding-top:1px;\",\n\t\" .redactor_box\":\"background:none!important;\",\n\t\" .cw-btn-small\":\"font-size: 80%;line-height: 1.1em;padding: 2px 6px 0 6px;display: none;vertical-align: top;\",\n\t\" .lred\":\"color:rgba(205,20,40,0.7)\",\n\t\" #append .cw-hoverpane\":\"opacity:0.45\",\n\t' #edcontainer':'margin:0 auto 0 auto; padding:1px 0 0 0;letter-spacing:0;',\n\n\t//hoverpanes\n\t\" .cw-hoverpane\":{\n\t\t\"\":\"position:absolute; z-index:+29;display:inline-block;opacity:0;\"\n\t\t\t+\"transition: opacity 0.3s, border-radius 0.1s;left:-24px;top:-20px;text-align: left;\"\n\t\t\t+\"border:1px solid #A8B4C3;border-radius:20px;background:white;\"\n\t\t\t+\"font-size:95%;line-height:1.2em;padding:3px 1px 3px 4px;cursor:pointer;\",\n\t\t\".cw-half\":\"opacity:1\",\n\t\t\".cw-half>*\":\"opacity:0.6\",\n\n\t\t\":hover\":\"opacity:1!important;border-radius:5px;\",\n\t\t\":hover>*\":\"opacity:1!important;\",\n\t\t\".hover\":\"opacity:1!important;border-radius:5px;\",\n\n\t\t':before':'content:\" \"; width:110%;height:150%;z-index:-2; position:absolute;top:-40%;left:-10%;',\n\n    ' .hbtn': function(){\n    \treturn [\n      \t'display:none;width:26px;height:26px;overflow:hidden;border-radius:1px;vertical-align:top;',\n        'cursor:pointer; margin:0 2px 0 0;',\n\t\t\t\t'background-color:transparent; transition: background-color 0.3s; background-repeat:no-repeat;',\n        'background-size:242px 26px;',\n        'background-image:url(data:image/svg+xml;base64,'+cw.lib.base64(this.SVG.Hoverpane)+');'\n      ].join('')\n    },\n    \n\t\t' .hbtn:hover':'background-color:#DBE8F3;',\n\t\t\n\t\t':hover .hbtn':'display:inline-block;',\n\t\t'.hover .hbtn':'display:inline-block;',\n\t\t\n\t\t' .hbtn-cog':'background-position:-27px 0;',\n\t\t' .hbtn-html':'background-position:-54px 0;margin-right:0;',\n\t\t' .hbtn-img':'background-position:-81px 0;',\n\t\t' .hbtn-embed':'background-position:-108px 0;',\n\t\t' .hbtn-widget':'background-position:-135px 0;',\n\t\t' .hbtn-copy':'background-position:-162px 0;',\n\t\t' .hbtn-paste':'background-position:-189px 0;',\n\t\t' .hbtn-del':'background-position:-216px 0;',\n\t\t\n\t\t' .hbtn-plus':'display:inline-block!important;background-position:0 0;cursor:default;margin:0 1px 0 0;',\n\t\t' .hbtn-plus:hover':'background-color:transparent;',\n\t\t':hover .hbtn-plus':'margin-right:-1px;',\n\t\t'.hover .hbtn-plus':'margin-right:-1px;',\n\t},\n\n\t' .floater-hotspot':' position:absolute; top:-3px;height:1.3em;z-index:+10',\n\n\t\n\t// Applies font faces from the doc, also mb used during compilation to html\n\t\n\t\" .in-item\": function (){\n\t\tvar that = this,\n\t\t\t\t_clone = Object.clone,\n\t\t\t\ts = Object.merge(_clone(that.Theme, true), that.data.style || {}, true),\n\t\t\t\ttypes = {},\n\t\t\t\ti, j, r;\n\t\t\n\t\t(that.data.content||[]).forEach(function(e){\n\t\t\ttypes[e.type]=true;\n\t\t});\n\t\t\n\t\tr = {\n\t\t\t'div,p,ul,ol,li,table,dl,blockquote,td':'font-family:'+_font(s.font.main)+';', \n\t\t\t'h1,h2,h3,h4,h5,h6': 'font-family:'+_font(s.font.header)+';',\n\t\t\t'pre,code':'font-family:'+_font(s.font.fixed)+';',\n\t\t\t\n\t\t\t'.in-accented':{\n\t\t\t\t'h1,h2,h3,h4,h5,h6,div,p,ul,ol,li,table,dl,blockquote,td':'font-family:'+_font(s.font.accent)+';',\n\t\t\t},\n\t\t\t' .redactor_box':'background:none!important;border:none!important;',\n\t\t\t' .hide':'display:none!important;'\n\t\t};\n\t\t\n\t\tObject.keys(s.themes)\n\t\t.forEach(function(i){\n\t\t\tif (!r['.in-'+i+' .in-ct']) r['.in-'+i+' .in-ct'] = s.themes[i];\n\t\t});\n\t\t\n\t\tr[' .redactor_editor'] = _ext({\n\t\t\t'': 'word-wrap: break-word; border:none;padding:0; background:none!important;'+s.text.normal,\n\t\t\t' td>:first-child':'margin-top:0!important;',\n\t\t\t' td>:last-child':'margin-bottom:0!important;',\n\t\t}, s.tags||{}, true);\n\t\t\n\t\t/*r[' '] = _ext({\n\t\t\t'': s.text.normal\n\t\t}, s.tags||{}, true);*/\n\t\t\n\t\tr['.in-small .redactor_editor'] = s.text.small;\n\t\tr['.in-large .redactor_editor'] = s.text.large;\n\t\t\n\t\tr['.in-item-max:first-child .in-ct'] ='margin-top:0!important;';\n\t\t\n\t\tr[' .in--x-fader'] = 'display:none;';\n\t\t\n\t\tr['.in-darken'] = {\n\t\t\t' .redactor_editor':{\n\t\t\t\t' h1,h2,h3,h4,h5,h6,div,p,ul,ol,li,table,dl,blockquote,td':'color:white!important;',\n\t\t\t\t' a':'color:rgba(255,255,255,0.8)!important;text-decoration:none!important;'\n\t\t\t\t\t+'border-bottom:1px solid rgba(255,255,255,0.5)!important;'\n\t\t\t\t\t+'transition:color 0.3s, border 0.3s;',\n\t\t\t\t' a:hover':'color:rgba(255,255,255,1)!important;border-bottom:1px solid rgba(255,255,255,0.8)!important;'\n\t\t\t},\n\t\t\t' .in--x-fader':'display:block; height:100%; width:100%; position:absolute; top:0; left:0; z-index:2;'\n\t\t\t\t+'background-image: -moz-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: -webkit-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: -o-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: -ms-linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));'\n\t\t\t\t+'background-image: linear-gradient(top, rgba(0,0,0,0.05), rgba(0,0,0,0.50));',\n\t\t}\n\t\t\n\t\tr[':last-child'] = 'margin-bottom:0px!important;'\n    \n    // - - - - - - - - - - - - - - - - -\n    \n    r['.in-z1'] = {'':'z-index:+1!important;'}\n    r['.in-z2'] = {'':'z-index:+2!important;'}\n    r['.in-z3'] = {'':'z-index:+3!important;'}\n    r['.in-z5'] = {'':'z-index:+5!important;'}\n    r['.in-z10'] = {'':'z-index:+10!important;'}\n    r['.in-z20'] = {'':'z-index:+20!important;'}\n    \n    // - - - - - - - - - - - - - - - - -\n    \n    var mobileshrink = 'min-width: 100%!important; width: 100%!important; float: none!important;',\n        mobilemargin = 'margin-left: 0!important;';\n    \n    r['@media screen and (max-width: 480px)'] = {\n      '.in-item-tiny-right .in-ct':\t\tmobileshrink,\n      '.in-item-small-right .in-ct':\tmobileshrink,\n      '.in-item-small .in-ct':\t\t\t\tmobileshrink,\n      '.in-item-tiny .in-ct':\t\t\t\t\tmobileshrink,\n      \n      '.in-item-tiny-right .in-ct ':\tmobilemargin,\n      '.in-item-small-right .in-ct ':\tmobilemargin\n    }\n\t\t\n    // - - - - - - - - - - - - - - - - -\n    \n\t\tfor (i in that.Items) {\n\t\t\tif (\n\t\t\t\tthat.Items.hasOwnProperty(i) \n\t\t\t\t&& types[i]\n\t\t\t\t&& (\n\t\t\t\t\tj = that.IStyle[\".in--\"+i] \n\t\t\t\t\t|| (that.Items[i].style || {})[\".in--\"+i]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif (typeof j == \"function\") {\n\t\t\t\t\tr[\".in--\"+i] = j;\n\t\t\t\t\tthat.Items[i].style[\".in--\"+i] = \"\";\n\t\t\t\t\tif (!that.IStyle[\".in--\"+i]) that.IStyle[\".in--\"+i] = j;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn r;\n\t\t\n\t\t//--------\n\t\t\n\t\tfunction _font(a) {\n\t\t\tvar s=[];\n\t\t\t(a||[]).forEach(function(e){\n\t\t\t\tif (/\\s/.test(e)) s.push(\"'\"+e+\"'\");\n\t\t\t\telse s.push(e);\n\t\t\t});\n\t\t\treturn s.length?s.join(\",\"):\"inherit\";\n\t\t}\n\t\t\n\t\tfunction _ext (obj, list, important) {\n\t\t\tfor (var i in list) {\n\t\t\t\tif (list.hasOwnProperty(i)) obj[i] = (list[i]+\"\").replace(/\\s*;/g,important?'!important;':';');\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1536353558263","id": ".Ed.Empty","type": "js","data": "({\n\tinit: function($o){$o.html('<div class=\"hide\"></div>')},\n  ui:{\n  \t'div.hide':{bind:function(){return '';}}\n  },\n  data:{}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1460332201920","id": ".Ed.Themer","type": "js","data": "({\n\tdata:{\n\t\tsrc:{},\n\t\tdest:{},\n\t\ttheme:{}\n\t},\n\tCode:\"\",\n\tinit:function($o, form){\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\tlang = 'en';\n\t\n\t\t// Locale\n\t\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\tthat.Code = '('+JSON.stringify(d.src,null,'  ')+')';\n\t\t$o.html( $.my.formgen(that.HTML).assign(L) );\n\t},\n\tlang:{\n\t\ten:{\n\t\t\tTITLE:'Doc style settings',\n\t\t\tERR_PARAMS:'Invalid params',\n\t\t\tAPPLY:'Apply',\n\t\t\tCLOSE:'Close',\n\t\t\tDEFAULTS:'Extend with defaults'\n\t\t},\n\t\tru:{\n\t\t\tTITLE:'Стиль документа',\n\t\t\tERR_PARAMS:'Неверные параметры',\n\t\t\tAPPLY:'Применить',\n\t\t\tCLOSE:'Закрыть',\n\t\t\tDEFAULTS:'Добавить настройки по умолчанию'\n\t\t}\n\t},\n\tui:{\n\t\t\"#tjson\":{\n\t\t\tbind:\"this.Code\",\n\t\t\tinit: function($o){\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: 'javascript',\n\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t//lineWrapping:true,\n\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\tindentUnit:2,\n\t\t\t\t\ttabSize:2,\n\t\t\t\t\ttheme: \"default\"\n\t\t\t\t});\n\t\t\t},\n\t\t\tcheck:function(d,v){\n\t\t\t\tvar j;\n\t\t\t\ttry {\n\t\t\t\t\tj = eval('('+v+')');\n\t\t\t\t} catch(e){}\n\t\t\t\tif (Object.isObject(j)) {\n\t\t\t\t\td.dest = j;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.Lang.ERR_PARAMS;\n\t\t\t}\n\t\t},\n\t\t\"#btn-apply\":{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null && this.my.valid()) {\n\t\t\t\t\tvar fl = {\n\t\t\t\t\t\tbody:{},\n\t\t\t\t\t\tfont:{},\n\t\t\t\t\t\ttext:{},\n\t\t\t\t\t\ttags:{},\n\t\t\t\t\t\taside:{},\n\t\t\t\t\t\tthemes:{},\n\t\t\t\t\t\tpad:{},\n\t\t\t\t\t\tcorner:{}\n\t\t\t\t\t}\n\t\t\t\t\td.dest = Object.select(d.dest,Object.keys(fl));\n\t\t\t\t\tthis.my.commit();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\":function(){return !this.my.valid();}\n\t\t\t},\n\t\t\twatch:\"#tjson\"\n\t\t},\n\t\t\"#btn-close\":function(d,v){\n\t\t\tif (v!=null) this.my.cancel();\n\t\t},\n\t\t\"#btn-defaults\":{\n\t\t\tbind:function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null)  that.Code = '('+JSON.stringify($.extend(true, {}, d.dest, d.theme), null,'  ')+')';\n\t\t\t},\n\t\t\trecalc:\"#tjson\"\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div class=\"fs150 mb10 mt-1 blue-1\">{TITLE}</div>',\n\t\t'<div class=\"jcont w100p dib vat\"><textarea id=\"tjson\"></textarea></div>',\n\t\t'<div class=\"pt15\">',\n\t\t\t'<button id=\"btn-defaults\" class=\"fr orange mr0\">{DEFAULTS}</button>',\n\t\t\t'<button id=\"btn-apply\" class=\"green w150 mr4\">{APPLY}</button>',\n\t\t\t'<button id=\"btn-close\" class=\"w150\">{CLOSE}</button>',\n\t\t'</div>'\n\t],\n\tstyle:{\n\t\t\" .CodeMirror\":\"height:400px!important; width:918px; font-size:12px;border:1px solid #ddd; border-radius:2px;\",\n\t\t' .my-error .CodeMirror':\"border-color:rgb(255,120,120);\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1439841704347","id": ".Ed.Meta","type": "js","data": "({\n\tid:\"cw.Inliner.Ed.Meta\",\n\tdata:{\n\t\tmeta:[]\n\t},\n\tinit: function($o, form){\n\t\tvar that = this,\n\t\t\tlang = 'en';\n\t\n\t\t// Locale\n\t\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\t$o.formgen([\n\t\t\t'<div class=\"fs150 mb10 mt-1 blue-1\">'+L.TITLE+'</div>',\n\t\t\t'<div id=\"metas\"></div>',\n\t\t\t'<div class=\"bbs mt5 pb10 mb15 hoverlink blue\">',\n\t\t\t\t'<span class=\"fi-plus fs80 o80\"></span> ',\n\t\t\t\t'<span class=\"pseudolink\" id=\"btn-addmeta\">'+L.ADD+'</span>',\n\t\t\t'</div>',\n\t\t\t{rowCss:\"my-row\"},\n\t\t\t['',\n\t\t\t 'but#btn-apply.w100.mr5.green',{txt:L.SAVE},\n\t\t\t 'but#btn-cancel.w100',{txt:L.CANCEL}\n\t\t\t]\n\t\t]);\n\t},\n\t\n\tui:{\n\t\t\"#metas\":{\n\t\t\tbind:\"meta\",\n\t\t\tmanifest:\"this.Prop\",\n\t\t\tlist:'<div class=\"mb6\"></div>',\n\t\t\tcheck:true,\n\t\t\tid:[\"id\"]\n\t\t},\n\t\t\"#btn-addmeta\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null){\n\t\t\t\t\t$o.my(\"find\",\"#metas\").trigger(\"insert\",{\n\t\t\t\t\t\twhat:$.extend(!0,{},that.Prop.data, {id:Number.random(0,1e6)+\"\"}),\n\t\t\t\t\t\twhere:1e6\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t\"#btn-apply\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null && this.my.valid()) {\n\t\t\t\t\tvar a = d.meta.reduce(function(a,b){\n\t\t\t\t\t\tif (b.key) a.push(b);\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t},[]);\n\t\t\t\t\td.meta = a;\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t':disabled':function(){return !this.my.valid()}\n\t\t\t},\n\t\t\twatch:'#metas'\n\t\t}\n\t},\n\tProp:{\n\t\tdata:{ id:\"\", key:\"\", value:\"\" },\n \t\tinherit:['Lang'],\n\t\tinit:function($o){\n\t\t\tvar that = this;\n\t\t\t$o.html([\n\t\t\t\t'<span>',\n\t\t\t\t\t'<input type=\"text\" id=\"mkey\" class=\"w200 bold mr8 dib vat\" placeholder=\"{KEY_PLC}\"/>',\n\t\t\t\t'</span>',\n\t\t\t\t'<span>',\n\t\t\t\t\t'<textarea id=\"mval\" class=\"w510 dib fs100 vat\" rows=1 placeholder=\"{VAL_PLC}\" spellcheck=\"false\"></textarea>',\n\t\t\t\t'</span>'\n\t\t\t].join('').assign(that.Lang));\n\t\t},\n\t\tui:{\n\t\t\t\"#mkey\":{\n\t\t\t\tbind:\"key\",\n\t\t\t\tcheck:function(d,v){\n\t\t\t\t\tif (!/^(|[a-z0-9]+)$/i.test(v)) return this.Lang.ERR_LATINS;\n\t\t\t\t\telse if (v==\"id\" || v==\"tags\" || v==\"name\" || v==\"title\") return this.Lang.ERR_RESERVED;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#mval\":{\n\t\t\t\tbind:function(d,v,$o){\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\td.value = v;\n\t\t\t\t\t\t$o.height(0).height($o[0].scrollHeight - 11);\n\t\t\t\t\t}\n\t\t\t\t\treturn d.value;\n\t\t\t\t},\n\t\t\t\tcss:{\n\t\t\t\t\t\"self:tdl\":function(d){return d.value && !d.key},\n\t\t\t\t\t\"self:lgray\":function(d){return d.value && !d.key}\n\t\t\t\t},\n\t\t\t\twatch:\"#mkey\"\n\t\t\t}\n\t\t}\n\t},\n\tstyle:{\n\t\t'textarea':'min-height:32px;',\n\t\t\" .w510\":\"width:510px\"\n\t},\n\t\t\n\tlang:{\n\t\ten:{\n\t\t\tTITLE:'Doc meta',\n\t\t\tADD:'Add property',\n\t\t\tSAVE:'Save',\n\t\t\tCANCEL:'Cancel',\n\t\t\tERR_LATINS:'Latins and nums',\n\t\t\tERR_RESERVED:'Reserved property name',\n\t\t\tKEY_PLC:'key',\n\t\t\tVAL_PLC:'value'\n\t\t},\n\t\tru:{\n\t\t\tTITLE:'Метаданные документа',\n\t\t\tADD:'Добавить ключ',\n\t\t\tSAVE:'Сохранить',\n\t\t\tCANCEL:'Закрыть',\n\t\t\tERR_LATINS:'Только латиница и цифры',\n\t\t\tERR_RESERVED:'Зарезервированный ключ',\n\t\t\tKEY_PLC:'ключ',\n\t\t\tVAL_PLC:'значение'\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1459912991523","id": ".Ed.To.html","type": "js","data": "// compiler\n(function (doc, options) {\n  \n  var isO = Object.isObject,\n\t\t\tisF = Object.isFunction,\n\t\t\tisA = Object.isArray,\n\t\t\tisS = Object.isString,\n\t\t\tKeys = Object.keys;\n  \n\tvar that = this,\n\t\t\td = doc,\n\t\t\th = '',\n\t\t\tid = 'x'+Number.random(1e6, 1e7-1)+'',\n\t\t\topts = Object.merge({\n\t\t\t\tstyle:\t\t\t\t\t\t\t\ttrue,\n\t\t\t\tpath:'',\n\t\t\t\timportant:\t\t\t\t\t\ttrue,\n\t\t\t\tforceNoEdit:\t\t\t\t\tfalse,\n\t\t\t\tforceUpgradeWidgets:\tfalse,\n\t\t\t\tinitSync:\t\t\t\t\t\t\tfalse\n\t\t\t}, isO(options)?options:{}),\n\t\t\tres = {\n\t\t\t\terr:\t\t\t[],\n\t\t\t\thtml:\t\t\t'',\n\t\t\t\tstyle:\t\t'',\n\t\t\t\tscripts:\t[],\n\t\t\t\tcomment:\t''\n\t\t\t},\n\t\t\tastyle;\n\n\tif (!isO(d) || d.type != 'inliner' || !isA(d.content) || !d.content.length) {\n\t\tres.err.push('Error: invalid or empty inliner doc.');\n\t\treturn res;\n\t}\n\n\tid = d._id || id;\n  \n  // ===============================================\n\n\t// Generate stylesheet\n\t\n\tif (opts.style) {\n\n\t\tif (!Object.isObject(opts.style)) {\n\t\t\tastyle = _json2css.call(\n\t\t\t\tthat, \n\t\t\t\tnull , \n\t\t\t\tObject.merge(\n\t\t\t\t\tObject.reject(that,['style','data']), \n\t\t\t\t\t{\n\t\t\t\t\t\tstyle:{\n\t\t\t\t\t\t\t' ': that.style[' #medium'],\n\t\t\t\t\t\t\t' .in-item':that.style[' .in-item']\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: doc\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\tastyle = _json2css.call(\n\t\t\t\tthat, \n\t\t\t\tnull , \n\t\t\t\tObject.merge(\n\t\t\t\t\tObject.reject(that,['style','data']), \n\t\t\t\t\t{\n\t\t\t\t\t\tstyle:{\n\t\t\t\t\t\t\t' ': that.style[' #medium'],\n\t\t\t\t\t\t\t' .in-item':that.style[' .in-item']\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: Object.merge({style:opts.style},Object.reject(doc,'style'), true)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\t\n\t\tif (astyle) {\n\t\t\tres.style = astyle[1]\n\t\t\t.map(function(e){\n\t\t\t\treturn (\n\t\t\t\t\t(e[0]=='@' || e[0]=='}'?'':'#in-doc-'+id+' ')\n\t\t\t\t\t+e.replace(/redactor_box/g,'in-cb')\n\t\t\t\t\t\t.replace(/redactor_editor/g,'in-cc')\n\t\t\t\t).replace(/\\s+/g,' ');\n\t\t\t}).join('\\n');\n\t\t}\n\t} //-- end stylesheet gen\n  \n  \n  \n  // ===============================================\n\n\td.content.forEach(function(item){\n\t\tvar type = item.type,\n\t\t\t\tT = that.Items[type], \n\t\t\t\terrs,\n\t\t\t\tiopts = {\n\t\t\t\t\tpath:opts.path,\n\t\t\t\t\tstyle:null,\n\t\t\t\t\tinitSync:opts.initSync,\n\t\t\t\t\tforceNoEdit:opts.forceNoEdit\n\t\t\t\t},\n\t\t\t\trow;\n\n\t\tif (T && T.To && T.To.html) {\n\n\t\t\tif (opts.Urls) iopts.Urls = opts.Urls;\n\n\t\t\ttry {\n\t\t\t\trow = T.To.html.call(\n\t\t\t\t\ttype=='widget'&&item.source\n\t\t\t\t\t\t?Object.merge({\n\t\t\t\t\t\t\tWidget:that.Widgets[item.source]||null, \n\t\t\t\t\t\t\tRT:function(){return that;}\n\t\t\t\t\t\t},T)\n\t\t\t\t\t\t:T, \n\t\t\t\t\titem, \n\t\t\t\t\tiopts\n\t\t\t\t);\n\t\t\t} catch (e) { errs = e }\n\n\t\t\tif (row) {\n\t\t\t\t\n\t\t\t\tif (!row.err.length) {\n\t\t\t\t\tres.html += row.html;\n\t\t\t\t\tres.style += row.style;\n\t\t\t\t\tres.scripts = res.scripts.add(row.scripts||[]);\n\t\t\t\t} else {\n\t\t\t\t\tres.err = res.err.add(row.err || []);\n\t\t\t\t\tif (!row.html) {\n\t\t\t\t\t\tres.html +='<div class=\"in-render-error red hide\">'+(row.err||['Error rendering item']).join('<br>')+'</div>';\n\t\t\t\t\t}\n\t\t\t\t\telse res.html += row.html;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tres.html +='<div class=\"red\">'+[errs.message, errs.stack].join('<br>')+'</div>'\n\t\t\t}\n\t\t}\n\t});\n\t//--end render content\n\t\n\t\n\t// Gen HTML string\n\t\n\tres.html = [\n\t\t'<div id=\"in-doc-'+d._id+'\" ',\n      'class=\"in-doc-body\" ',\n      'data-title=\"'+(d.name+'').escapeHTML()+'\" ',\n      'data-tags=\"'+d.tags.map(function(e){return (e+'').replace(/\\s+/g,'_').escapeHTML()}).join(\" \")+'\" ',\n      'data-lastupdated=\"'+(d.log && d.log.length?d.log[0][0]:d.stamp)+'\" ',\n      Object.keys(d.meta).map(function(i){\n        if (Object.isString(d.meta[i])) return 'data-'+i.escapeHTML()+'=\"'+(d.meta[i]).escapeHTML()+'\"'\n      }).compact().join(' '),\n\t\t'>',\n\t\tres.html,\n\t\t'</div>'\n\t].join('')\n  .replace(/redactor_box/g,'in-cb')\n  .replace(/redactor_editor/g,'in-cc');\n\t\n\t\n\t// Dedup scripts\n\t\n\tvar nscripts = [],\n\t\t\thscripts = {};\n\tres.scripts.forEach(function(e){\n\t\tvar h = _sdbmS(e);\n\t\tif (!hscripts[h]) {\n\t\t\thscripts[h] = true;\n\t\t\tnscripts.push(e);\n\t\t}\n\t});\n\tres.scripts = nscripts;\n\n\t\n\treturn res;\n\t\n\n\t// - - - - - - - - - - - - - - -\n\n\tfunction _json2css ($o, manifest, localOnly) {\n\t\t// converts .style section of manifest\n\t\t// into two css rule lists for the form\n\t\tvar  aglob=[], aloc=[], man=manifest;\n\t\tif (!isO(man) || !isO(man.style)) return \"\";\n\n\t\tcrawl(manifest.style, \"\", aglob, aloc);\t\t\n\t\t\n\t\treturn [_dedup(aglob), _dedup(aloc)];\n\t\t\n\t\t//- - - - - - - - - - - - - - \n\t\t\n\t\tfunction _dedup(a) {\n\t\t\t// replaces rules with identical tails \n\t\t\t// to #id1,#id2,id#{rule}\n\t\t\t// Todo: make more effective\n\t\t\treturn a.map(function(e, i){\n\t\t\t\tvar e1 = a[i+1];\n\t\t\t\tif (e1) {\n\t\t\t\t\tvar es0 = e.split('{'),\n\t\t\t\t\t\t\tes1 = e1.split('{');\n\t\t\t\t\tif (es0[1] && es0.from(1)+'' == es1.from(1)+'') return es0[0]+',';\n\t\t\t\t}\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\t\t\n\t\t//- - - - - - - - - - - - - - \n\n\t\tfunction crawl (branch0, key0, aglob, aloc){\n\t\t\tvar i, j, k, b, a, \n\t\t\t\t\tbranch = branch0,\n\t\t\t\t\tisMedia = /@/.test(key0),\n\t\t\t\t\tkey = key0.split(\"@\")[0],\n\t\t\t\t\tisFn = isF(branch);\n\n\t\t\tif (isMedia) (isFn?aloc:aglob).push (\"@\"+key0.split(\"@\")[1].trim()+\" {\");\n\n\t\t\tif (isS(branch)) {\n\t\t\t\taglob.push(key+(/\\{/.test(branch)?branch:'{'+branch.replace(/[\\r\\n]/g,'')+'}'));\n\t\t\t}\n\t\t\tif (isA(branch) && branch.length) {\n\t\t\t\tfor (i=0; i<branch.length; i++) crawl(branch[i], key, aglob, aloc);\n\t\t\t}\n\t\t\telse if (isO(branch)) {\n\t\t\t\tk = Keys(branch);\n\t\t\t\tfor (i=0; i<k.length; i++) {\n\t\t\t\t\ta = unfold(key, k[i]);\n\t\t\t\t\tfor (j=0; j<a.length; j++) crawl(branch[k[i]], a[j], aglob, aloc);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (isF(branch)) {\n\t\t\t\ttry {\n\t\t\t\t\tb = branch.call(manifest, $o, manifest);\n\t\t\t\t\tcrawl (b, key, aloc, aloc);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t//console.log(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isMedia) (isFn?aloc:aglob).push (\"}\");\n\t\t}\n\n\t\tfunction unfold (key, selector) {\n\t\t\tvar pre = \"\", ext = selector+\"\", a;\n\t\t\tif (\" \" === ext.to(1) || /^[a-z]/i.test(ext)) pre = \" \";\n\t\t\ta = ext.split(/\\s*,\\s{0,}/).compact(true);\n\t\t\tif (!a.length) a.push(\"\");\n\t\t\treturn a.map(function (e) {return key+pre+e;});\n\t\t}\n\t}\n\t\n\t\t//- - - - - - - - - - - - \n\t\n\tfunction _sdbmS (s){\n\t\t// Very fast hash used in Berkeley DB\n\t\tfor (var hash=0,i=0;i<s.length;i++)\n\t\t\thash=s.charCodeAt(i)+(hash<<6)+(hash<<16)-hash;\n\t\treturn (1e11+hash).toString(36);\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1467237453005","id": ".Ed.Hoverpane","type": "js","data": "(function (type, del, hide0){\n\t\n\t// Hoverpane generator, enumerates all plugins\n\t\n\tvar i, v, hide = hide0 || {},\n\t\t\thtml= '<div class=\"cw-hoverpane cw-hoverpane-insert blue\">'\n\t+'<span class=\"hbtn hbtn-plus\"></span>', \n\t\t\tthat = this, \n\t\t\tmans = that.Items,\n\t\t\tt2c = Object.clone(that.Lang.HOVERPANE, true),\n\t\t\ttc;\n\n\n\tfor (i in mans) {\n\t\tv = mans[i];\n\t\tif (!hide[v.data.type] && (tc = t2c[v.data.type])) {\n\t\t\thtml+='<span data-type=\"'+v.data.type+'\" class=\"hbtn '+tc.css+'\" title=\"'+tc.title+'\"></span>';\n\t\t}\n\t}\n\n\thtml+='<nobr>';\n\n\t// Opts button\n\n\tif (mans[type] && mans[type].Opts) {\n\n\t\ttc = t2c._opts;\n\n\t\thtml += '<span class=\"hbtn hbtn-cog\" '\n\t\t+'data-type=\"-opts\" id=\"btn-htmlopts\" title=\"'+tc.title+'\"></span>';\n\t}\n\n\t// Copy / paste buttons\n\n\ttc = t2c._copy;\n\n\thtml += '<span class=\"hbtn hbtn-copy\" '\n\t+'data-type=\"-copy\" id=\"btn-copy\" title=\"'+tc.title+'\"></span>';\n\n\ttc = t2c._paste;\n\n\thtml += '<span class=\"hbtn hbtn-paste\" '\n\t+'data-type=\"-paste\" id=\"btn-paste\" title=\"'+tc.title+'\"></span>';\n\n\t// Del button\n\n\ttc = t2c._del;\n\n\tif (del) html += '<span class=\"hbtn hbtn-del\" '\n\t+'data-type=\"-\" id=\"btn-del\" title=\"'+tc.title+'\"></span>';\n\n\t// End hoverpane html\n\thtml+='</nobr>';\n\n\thtml+='</div>';\n\treturn html;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1441492334802","id": ".Ed.Actions","type": "js","data": "// Hoverpane actions\n(function ($o, form){\n\t\n\tvar that = this, i,\n\t\t\td = form.data,\n\t\t\tnow = Date.now(),\n\t\t\t$ho=$o.find(\"#hoverpane:eq(0)\"),\n\t\t\t$me = $o.find(\"#medium\"),\n\t\t\tisO = Object.isObject,\n\t\t\tisA = Object.isArray,\n\t\t\tisF = Object.isFunction;\n\t\n\t$o.on(\"click.my\", \".cw-hoverpane-insert .hbtn\", function (){\n\t\tvar xd = $ho.data(\"hoverpane\"),\n\t\t\t\t$r = xd.form,\n\t\t\t\tidx = ($r.data(\"formlist\")?$r.data(\"formlist\").index:$o.my(\"data\").content.length+1),\n\t\t\t\ttype = $(this).data(\"type\"),\n\t\t\t\tidata = $r.my(\"data\"),\n\t\t\t\t$frame;\n\n\t\tif (type==\"-\") {\n\t\t\t//$r.trigger(\"remove\");\n\t\t\td.content = that.CollapseItems(d.content.removeAt(idx));\n\t\t\t$o.my(\"redraw\");\n\t\t\t_off();\n\t\t}\n\t\telse if (type==\"-opts\") {\n\t\t\t$ho.addClass(\"hover\");\n\t\t\t$('body>div.redactor_air').css({display:'none'});\n\t\t\t// Add red frame\n\t\t\tif (xd.val && !xd.val.hasClass('redactor_box')) $frame = xd.val;\n\t\t\telse $frame = $r.find('.in-ct');\n\t\t\t$frame.css({outline: '1px dashed red'});\n\t\t\t\n\t\t\tif (that.Items[idata.type].Opts) {\n\t\t\t\tvar modal = $(this).modal({\n\t\t\t\t\troot:$o.parents(\".my-form\").eq(0),\n\t\t\t\t\tmanifest:$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tRT: function(){return that;},\n\t\t\t\t\t\t\tAtt: that.Att\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$r.my(\"manifest\").Opts\n\t\t\t\t\t),\n\t\t\t\t\tdata:Object.clone($r.my(\"data\"), true),\n\t\t\t\t\t//nose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\talign:\"top:-4px;left:-\"+($(this).parent().position().left+1)+\"px;\",\n\t\t\t\t\tcss:\"blue lh150 fs80 p10\",\n\t\t\t\t\tbound:8,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tclose:false\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (idata.type == \"html\") {\n\t\t\t\t\t// HTML data, special case\n\t\t\t\t\tmodal.then(function(res){\n\t\t\t\t\t\t_noframe();\n\t\t\t\t\t\tvar prevcss = ($r.my(\"data\").css||[]).sortBy()+$r.my(\"data\").format;\n\t\t\t\t\t\tif (res.css + res.format != prevcss) {\n\n\t\t\t\t\t\t\tif (prevcss!=$r.my(\"data\").format+\"\" || $r.find(\".redactor_editor>*\").size()==1) {\n\t\t\t\t\t\t\t\t// Reformat already formatted block\n\t\t\t\t\t\t\t\t$r.my(\"data\").css = res.css;\n\t\t\t\t\t\t\t\t$r.my(\"data\").format = res.format+\"\";\n\t\t\t\t\t\t\t\t$r.my(\"redraw\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Insert new only into unformatted block\n\t\t\t\t\t\t\t\tthat.Insert(\"html\", idx, xd.p, xd.after, xd.val, {css:res.css});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_off();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else if (idata.type == \"widget\"){\n\t\t\t\t\t\n\t\t\t\t\t// do we need to restart widget ?\n\t\t\t\t\tmodal.then(function(res){\n\t\t\t\t\t\t$.extend($r.my(\"data\"), res);\n\t\t\t\t\t\t$r.my(\"redraw\");\n\t\t\t\t\t\t//$r.my('find', '#btn-run').trigger('click');\n\t\t\t\t\t\t$r.my(\"restyle\");\n\t\t\t\t\t\t_off();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t// Other data, extend data with result\n\t\t\t\t\tmodal.then(function(res){\n\t\t\t\t\t\t$.extend($r.my(\"data\"), res);\n\t\t\t\t\t\t$r.my(\"redraw\");\n\t\t\t\t\t\t$r.my(\"restyle\");\n\t\t\t\t\t\t_off();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tmodal.fail(_off);\n\t\t\t}\n\t\t}\n\t\telse if (type==\"-copy\") {\n\t\t\t\n\t\t\tvar clip = $.extend(true, {_id:\"_local/cw.Inliner\", type:\"clip\"}, {clip:idata, previews:{}, files:{}});\n\t\t\t\n\t\t\tif (idata.type==\"html\" && !(idata.css||[]).length) {clip.clip.data = xd.val[0].outerHTML}\n\t\t\t\n\t\t\tthat.db.get(\"_local/cw.Inliner\")\n\t\t\t.then(\n\t\t\t\tfunction(old){ clip._rev = old._rev; return _saveClip(clip)},\n\t\t\t\tfunction(err){ return _saveClip(clip) }\n\t\t\t)\n\t\t\t.then(function(){\n\t\t\t\tcw.lib.note(that.Lang.CLIP_STASHED,\"ok\");\n\t\t\t\t_off();\n\t\t\t})\n\t\t\t\n\t\t}\n\t\telse if (type==\"-paste\") {\n\t\t\tthat.db.get(\"_local/cw.Inliner\")\n\t\t\t.then(\n\t\t\t\tfunction(clip){ \n\t\t\t\t\tif (clip.clip && clip.clip.type) {\n\t\t\t\t\t\tclip.clip._stamp = cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6));\n\t\t\t\t\t\tvar item = clip.clip;\n\t\t\t\t\t\titem._new = false;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (clip.previews) d.previews = $.extend(d.previews||{}, clip.previews);\n\t\t\t\t\t\tif (Object.size(clip.files)) {\n\t\t\t\t\t\t\tif (!d._attachments) d._attachments = {};\n\t\t\t\t\t\t\t$.extend(d._attachments, clip.files);\n\t\t\t\t\t\t\tthat.Att(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tthat.Insert(item.type, idx, null, false, xd.val, item);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t_off();\n\t\t\t\t},\n\t\t\t\tfunction(err){ cw.lib.note(that.Lang.CLIP_NOCLIP,\"error\"); _off(); }\n\t\t\t)\n\t\t}\n\t\telse if (type.to(1)!=\"-\") {\n\t\t\tif (type==\"html\") {\n\t\t\t\tthat.Insert(type, idx, void 0, false, null, {data:'<p><br></p>'});\n\t\t\t\t_off();\n\t\t\t} \n\t\t\telse if (type == 'widget') {\n\t\t\t\tif (Object.size(that.Widgets)) {\n\t\t\t\t\t// We have extenders\n\t\t\t\t\t$ho.addClass('hover');\n\t\t\t\t\t$(this).modal({\n\t\t\t\t\t\troot:$o.parents(\".my-form\").eq(0),\n\t\t\t\t\t\tmanifest:that.Items.widget.Select,\n            width: $ho.outerWidth()-24,\n\t\t\t\t\t\tdata:{widgets:Object.values(that.Widgets)},\n\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\talign:'top:22px;left:'+(-$(this).position().left),\n\t\t\t\t\t\tcss:\"blue lh150 fs80 p10\",\n\t\t\t\t\t\tbound:8,\n\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\tclose:false\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\tthat.Insert(type, idx, xd.p, xd.after, xd.val, res.extender);\n\t\t\t\t\t})\n\t\t\t\t\t.always(_off);\n\t\t\t\t} else {\n\t\t\t\t\tthat.Insert(type, idx, xd.p, xd.after, xd.val);\n\t\t\t\t\t_off();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.Insert(type, idx, xd.p, xd.after, xd.val);\n\t\t\t\t_off();\n\t\t\t}\n\t\t}\n\t\t\n\t\t//- - - - - - - - - - - - - - -\n\t\t\n\t\tfunction _noframe(){\n\t\t\tif ($frame) $frame.css({outline: ''});\n\t\t}\n\t\t\n\t\tfunction _off(){ \n\t\t\t_noframe();\n\t\t\t$ho.removeClass(\"cw-half hover\").css({top:\"-250px\",left:0});\n\t\t}\n\t\t\n\t\tfunction _saveClip(doc){ \n\t\t\t\n\t\t\t// here we should detect attaches used, \n\t\t\t// load em and append to doc as files{},\n\t\t\t// and their previews as previews{}\n\t\t\tvar a = d._attachments,\n\t\t\t\t\tp = d.previews,\n\t\t\t\t\tc = doc.clip,\n\t\t\t\t\tlist = {},\n\t\t\t\t\twlist,\n\t\t\t\t\tman,\n\t\t\t\t\tdata,\n\t\t\t\t\tre = /^http[s]?:\\/\\//;\n\t\t\t\n\t\t\tif (!a || !Object.size(a)) return that.db.put(doc); \n\t\t\t\n\t\t\tif (c.type=='img' && c.ref && !re.test(c.ref)) list[c.ref] = true;\n\t\t\telse if (c.type == 'widget') {\n\t\t\t\tif (c.bg && !re.test(c.bg)) list[c.bg] = true;\n\t\t\t\t// try to parse man\n\t\t\t\ttry {\n\t\t\t\t\tman = eval(c.js);\n\t\t\t\t\tdata = eval(c.data);\n\t\t\t\t} catch(e){}\n\t\t\t\t\n\t\t\t\tif (isO(man) && isO(data) && man.To && isF(man.To.files)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t\twlist = man.To.files.call(man, data);\n\t\t\t\t\t} catch(e){}\n\t\t\t\t\t\n\t\t\t\t\tif (isO(wlist) && Object.size(wlist)) {\n\t\t\t\t\t\tObject.keys(wlist).forEach(function(k){ list[k] = true; });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// stash\n\t\t\tvar pis = [],\n\t\t\t\t\tpi = $.Deferred();\n\t\t\t\n\t\t\tObject.keys(list).forEach(function(fname){\n\t\t\t\tvar fname = fname;\n\t\t\t\tif (a[fname]) {\n\t\t\t\t\tif (p[fname]) doc.previews[fname] = Object.clone(p[fname], true);\n\t\t\t\t\tif (a[fname].data) doc.files[fname] = {\n\t\t\t\t\t\tcontent_type:a[fname].content_type,\n\t\t\t\t\t\tdata:a[fname].data\n\t\t\t\t\t} \n\t\t\t\t\telse {\n\t\t\t\t\t\t// fetch attach\n\t\t\t\t\t\tpis.push(that.Att(fname, 'data').then(function(s){\n\t\t\t\t\t\t\tdoc.files[fname] = {\n\t\t\t\t\t\t\t\tcontent_type:a[fname].content_type,\n\t\t\t\t\t\t\t\tdata:s\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t}));\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (!pis.length) _save.debounce(1)();\n\t\t\telse {\n\t\t\t\t$.when.apply(null, pis).done(_save.debounce(1));\n\t\t\t}\n\t\t\t\n\t\t\treturn pi.promise();\n\t\t\t\n\t\t\t// - - - - - - - - - \n\t\t\t\n\t\t\tfunction _save(){\n\t\t\t\tthat.db.put(doc)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(){pi.resolve();},\n\t\t\t\t\tfunction(){pi.reject();}\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t} // end save clip\n\n\t}.debounce(40));\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1441551383779","id": ".Ed.UpdateWidgets","type": "js","data": "(function (d) {\n\tvar that = this,\n\t\t\tw = that.Widgets,\n\t\t\ta = d.content,\n\t\t\tm;\n\tif (Object.size(w)) {\n\t\td.content = d.content.map(function(e){\n\t\t\tif (\n\t\t\t\te.type==\"widget\" \n\t\t\t\t&& e.source \n\t\t\t\t&& e.options.indexOf(\"autoupdate\")>-1\n\t\t\t\t&& (m = w[e.source])\n\t\t\t) {\n\t\t\t\te.js = \"(\"+cw.lib.js2txt(cw.lib.unjson(JSON.parse(cw.lib.json(m))),'\\t')+\")\";\n\t\t\t}\n\t\t\treturn e; \n\t\t});\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1440176075217","id": ".Ed.Insert","type": "js","data": "(function ($o) {\n\tvar that = this;\n\t\n\treturn function  (type, idx, p0, after, $item, extender) {\n\t\t\n\t\t// Inserts new item, splits src if needed\n\t\t\n\t\tvar ins,txt, content, news, \n\t\t\t\ta=[], \n\t\t\t\tod = $o.my(\"data\"), \n\t\t\t\tonew={},\n\t\t\t\tp=p0;\n\t\t\n\t\tif ($item) {\n\t\t\tvar $e = $item.parents('.redactor_editor').eq(0),\n\t\t\t\t\tid = Number.random(65536, 0x100000 - 1).toString(16).last(4),\n\t\t\t\t\tins = '<b id=\"split-'+id+'\"></b>',\n\t\t\t\t\t$i = $(ins).insertBefore($item.eq(0));\n\t\t\tcontent = $e.html();\n\t\t\tp = ins;\n\t\t\t$i.remove();\n\t\t}\n\n\t\tif (p) {\n\t\t\ttxt = content || od.content[idx].data;\n\t\t\ta=txt.split(p+((extender||{})._new!==false && type==\"html\" && $item?$item.eq(0)[0].outerHTML:\"\"));\n\t\t}\n\n\t\tif (type) {\n\t\t\tins = $.extend(true, {_stamp:cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6))}, that.Items[type].data);\n\t\t\tif (type==\"html\" && $item) {\n\t\t\t\tins.data = $item.eq(0)[0].outerHTML;\n\t\t\t}\n\t\t\tif (extender) $.extend(ins, extender);\n\t\t\t\n\t\t\tif (!(extender && extender._new===false)) ins._new = true;\n\t\t}\n\n\t\tif (\n\t\t\t!(type==\"html\" && $item) &&\n\t\t\t(!p || a.length<2 || (a[0]==\"\" && !after) || (a[1]==\"\" && after))\n\t\t) {\n\t\t\tif (type) od.content.add(ins, idx+(after?1:0));\n\t\t\telse od.content.removeAt(idx);\n\t\t} else if (p) {\n\t\t\tif (type) {\n\t\t\t\tod.content[idx].data=a[0];\n\t\t\t\t//od.content[idx]._stamp = (Date.now()+100)+\"\";\n\t\t\t\tonew=Object.clone(od.content[idx],true);\n\t\t\t\tonew.data=a[1];\n\t\t\t\tonew._stamp = cw.lib.hash8(Date.now()+\"x\"+Number.random(1,1e6));\n\t\t\t\t\n\t\t\t\tod.content.add([ins,onew], idx+1);\n\t\t\t\t\n\t\t\t\tif (!od.content[idx].data) od.content.removeAt(idx);\n\t\t\t\t\n\t\t\t\tod.content = that.CollapseItems(od.content);\n\n\t\t\t} else {\n\t\t\t\t//delete\n\t\t\t\tif (!a[0].length && !a[1].length) {\n\t\t\t\t\tod.content.removeAt(idx+(after?1:0));\n\t\t\t\t} else {\n\t\t\t\t\tod.content[idx].data=a[0]+a[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tod.content = that.CollapseItems(od.content);\n\t\t$o.find(\"#medium\").trigger(\"redraw\");\n\t};\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1537573053788","id": ".Ed.SVG.Hoverpane","type": "html","data": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"242\" height=\"26\" viewBox=\"0, 0, 242, 26\">\n  <g id=\"Layer_1\">\n    <path d=\"M47.6,11.7 L45.5,11.5 C45.4,11.0 45.2,10.5 45.0,10.1 L46.3,8.5 C46.4,8.3 46.4,8.1 46.2,7.9 L45.0,6.7 C44.9,6.6 44.8,6.6 44.7,6.6 C44.6,6.6 44.5,6.6 44.4,6.6 L42.8,7.9 C42.4,7.7 41.9,7.5 41.4,7.4 L41.2,5.3 C41.2,5.1 41.0,5 40.8,5 L39.1,5 C38.9,5 38.7,5.1 38.7,5.3 L38.5,7.4 C38.0,7.5 37.5,7.7 37.1,7.9 L35.5,6.6 C35.4,6.6 35.3,6.6 35.2,6.6 C35.1,6.6 35.0,6.6 34.9,6.7 L33.7,7.9 C33.5,8.1 33.5,8.3 33.6,8.5 L34.9,10.1 C34.7,10.5 34.5,11.0 34.4,11.5 L32.3,11.7 C32.1,11.7 32,11.9 32,12.1 L32,13.8 C32,14.0 32.1,14.2 32.3,14.2 L34.4,14.4 C34.5,14.9 34.7,15.4 34.9,15.8 L33.6,17.4 C33.5,17.6 33.5,17.8 33.7,18.0 L34.9,19.2 C35.0,19.3 35.1,19.3 35.2,19.3 C35.3,19.3 35.4,19.3 35.5,19.3 L37.1,18.0 C37.5,18.2 38.0,18.4 38.5,18.5 L38.7,20.6 C38.7,20.8 38.9,21 39.1,21 L40.8,21 C41.0,21 41.2,20.8 41.2,20.6 L41.4,18.5 C41.9,18.4 42.4,18.2 42.8,18.0 L44.4,19.3 C44.5,19.3 44.6,19.3 44.7,19.3 C44.8,19.3 44.9,19.3 45.0,19.2 L46.2,18.0 C46.4,17.8 46.4,17.6 46.3,17.4 L45.0,15.8 C45.2,15.4 45.4,14.9 45.5,14.4 L47.6,14.2 C47.8,14.2 48,14.0 48,13.8 L48,12.1 C48,11.9 47.8,11.7 47.6,11.7 z M40,15.6 C38.6,15.6 37.3,14.3 37.3,13 C37.3,11.6 38.6,10.3 40,10.3 C41.3,10.3 42.6,11.6 42.6,13 C42.6,14.3 41.3,15.6 40,15.6 z M18.2,11.3 C18.3,11.3 18.5,11.5 18.5,11.6 L18.5,14.1 C18.5,14.1 18.4,14.2 18.4,14.3 C18.3,14.3 18.3,14.3 18.2,14.3 L14.5,14.3 L14.4,18.1 C14.4,18.1 14.4,18.2 14.4,18.3 C14.3,18.3 14.2,18.3 14.2,18.3 L11.7,18.3 C11.7,18.3 11.6,18.3 11.5,18.3 C11.5,18.2 11.5,18.1 11.5,18.1 L11.5,14.3 L7.7,14.3 C7.7,14.3 7.6,14.3 7.5,14.3 C7.5,14.2 7.5,14.1 7.5,14.1 L7.5,11.6 C7.5,11.5 7.6,11.3 7.7,11.3 L11.5,11.3 L11.5,7.6 C11.5,7.5 11.6,7.3 11.7,7.3 L14.2,7.3 C14.3,7.3 14.4,7.5 14.4,7.6 L14.5,11.3 L18.2,11.3 z\" fill=\"#A6B2C2\"/>\n    <path d=\"M102.9,6.8 C102.9,6.3 102.5,6.0 102.0,6.0 C102.0,6.0 101.9,6.0 101.9,6.0 L101.9,6 L85.9,6 L85.9,6.0 C85.4,6.0 85,6.3 85,6.8 L85,6.8 L85,19.1 L85,19.1 L85,19.1 L85,19.2 L85.0,19.2 C85.0,19.6 85.4,19.9 85.9,19.9 L85.9,20 L101.9,20 L101.9,19.9 C101.9,19.9 102.0,19.9 102.0,19.9 C102.5,19.9 102.9,19.6 102.9,19.2 L103,19.2 L103,6.8 L102.9,6.8 z M101.1,18.1 L98,18.1 C97.9,18.0 98.0,18.1 98,18.1 L98,18.1 L93.9,10.4 L93.9,10.4 C93.7,10.2 93.5,10.1 93.3,10.1 C93.0,10.1 92.8,10.2 92.7,10.4 L89.8,15.3 L88.8,14.2 L88.8,14.2 C88.7,14.1 88.6,14.0 88.5,14.0 C88.3,14.0 88.2,14.1 88.2,14.2 L86.9,16.0 L86.8,7.8 L101.1,7.8 L101.1,18.1 z M100,10.5 C100,9.6 99.3,9 98.5,9 C97.6,9 97,9.6 97,10.5 C97,11.3 97.6,12 98.5,12 C99.3,12 100,11.3 100,10.5 z M121,6 C123,6 129.0,7 129.0,7 C129.0,7 130,10.8 129.9,13 C129.9,14.8 129.0,19 129.0,19 C129.0,19 123,20 121,20 C119,20 112.9,19 112.9,19 C112.9,19 112.0,15.0 112.0,13 C111.9,10.8 112.9,7 112.9,7 C112.9,7 119,6 121,6 z M121,8 C120.3,8 119.1,8.1 117.5,8.3 C117.2,8.3 116.8,8.4 116.5,8.4 C115.1,8.6 115.7,8.5 114.6,8.7 C114.5,9.0 114.6,8.7 114.4,9.5 C114.3,10.0 114.2,10.5 114.1,11.0 C114.0,11.8 113.9,12.4 114.0,12.9 C114.0,13.4 114.1,14.1 114.2,15.0 C114.3,15.4 114.3,15.8 114.4,16.2 C114.6,17.1 114.5,16.8 114.6,17.2 C115.7,17.4 115.1,17.3 116.5,17.5 C116.8,17.5 117.2,17.6 117.5,17.6 C119.1,17.8 120.3,18 121,18 C121.6,18 122.8,17.8 124.4,17.6 C124.7,17.6 125.1,17.5 125.4,17.5 C126.8,17.3 126.2,17.4 127.3,17.2 C127.4,16.8 127.3,17.1 127.5,16.3 C127.6,15.9 127.6,15.5 127.7,15.2 C127.9,14.2 127.9,13.4 127.9,12.9 C127.9,12.5 127.9,11.8 127.7,10.9 C127.7,10.5 127.6,10.0 127.5,9.5 C127.3,8.8 127.4,9.0 127.3,8.7 C126.2,8.5 126.8,8.6 125.4,8.4 C125.1,8.4 124.7,8.3 124.4,8.3 C122.8,8.1 121.6,8 121,8 z M121.6,11.3 L119,9.7 L119,12.8 L119,16 L121.6,14.4 L124.3,12.8 z M155.8,10.8 C157.0,10.8 158,11.7 158,12.8 C158,13.9 157.0,14.8 155.8,14.8 C154.7,14.8 153.7,13.9 153.7,12.8 C153.7,11.7 154.7,10.8 155.8,10.8 z M148,10.8 C149.1,10.8 150.1,11.7 150.1,12.8 C150.1,13.9 149.1,14.8 148,14.8 C146.8,14.8 145.8,13.9 145.8,12.8 C145.8,11.7 146.8,10.8 148,10.8 z M140.1,10.8 C138.9,10.8 138,11.7 138,12.8 C138,13.9 138.9,14.8 140.1,14.8 C141.2,14.8 142.2,13.9 142.2,12.8 C142.2,11.7 141.2,10.8 140.1,10.8 z M65,20 L65,8.2 L59,8.2 L59,6 L74,6 L74,8.2 L68,8.2 L68,20 z\" fill=\"#616C7D\"/>\n    <path d=\"M209,9 C209.5,9 210,9.4 210,10 L210,21.0 C210,21.6 209.5,22.0 209,22.0 L200,22.0 C199.4,22.0 199,21.6 199,21.0 L199,10 C199,9.4 199.4,9 200,9 L209,9 z M209,10 L200,10 L200,21 L209,21 L209,10 z M205,15 L205,16 L201,16 L201,15 L205,15 z M207,13 L207,14 L201,14 L201,13 L207,13 z M206,11 L206,12 L201,12 L201,11 L206,11 z M203,4 L200,4 L200,5 L196,5 C196,5 195,6 195,6 L195,19 C195,19 196,20 196,20 L198,20 L198,18.1 L196.8,18.1 L196.8,6.8 L206.1,6.8 L206,8 L208,8 L208,6 C208,6 207,5 207,5 L203,5 L203,4 z M183.0,5.9 L183,6 L182,6 L182,21 L170,21 L170,22 C169.7,22 170,22.2 170,22 L182,22 C182.2,22 183,21.2 183,21 L183,6 C183.1,5.9 183.1,5.9 183.0,5.9 z M177,10 L171,10 L171,11 L177,11 L177,10 z M175,12 L171,12 L171,13 L175,13 L175,12 z M179.1,5.8 L179.1,18.1 L169.8,18.1 L169.8,8.8 L171,8.8 L171,9 L176,9 L176,8 L172.8,8 L172.8,5.8 L179.1,5.8 z M180,4 L173,4 L168,9 L168,19 C168,19.2 168.7,20 169,20 L180,20 C180.2,20 181,19.2 181,19 L181,5 L180.9,4.9 C180.9,4.7 180.2,4 180,4 z\" fill=\"#A6B2C2\"/>\n    <path d=\"M233.5,9 C233.7,9 234,9.2 234,9.4 L234,13 C234,13.2 233.2,21 233,21 L224,21 C223.7,21 223,13.2 223,13 L223,9.4 C223,9.2 223.2,9 223.4,9 L233.5,9 z M233.3,6.2 C233.6,6.2 234.3,6.6 234.3,7 L234.3,7.4 C234.3,7.7 234.1,8 233.8,8 L223.1,8 C222.8,8 222.6,7.7 222.6,7.4 L222.6,7 C222.6,6.6 223.3,6.2 223.6,6.2 L226.5,6.2 L226.5,5.5 C226.5,5.2 226.7,5 227.0,5 L229.9,5 C230.2,5 230.4,5.2 230.4,5.5 L230.4,6.2 L233.3,6.2 z\" fill=\"#FF7979\"/>\n    <path d=\"M230.2,11 L230.2,19 L229.2,19 L229.2,11 L230.2,11 z M228.2,11 L227.2,11 L227.2,19 L228.2,19 L228.2,11 z M232.2,11 L231.2,11 L231.2,18 L232.2,18 L232.2,11 z M226.2,11 L225.2,11 L225.2,18 L226.2,18 L226.2,11 z\" fill=\"#FFFFFF\" fill-opacity=\"0.7\"/>\n    <path d=\"M0,0 L1,0 L1,1 L0,1 L0,0 z\" fill=\"#FFFFFF\" fill-opacity=\"0.0\"/>\n    <path d=\"M241,25 L242,25 L242,26 L241,26 L241,25 z\" fill=\"#FFFFFF\" fill-opacity=\"0.0\"/>\n  </g>\n</svg>\n","active": false,"err": [],"opts": [],"color": []},{"stamp": "1537575593083","id": ".Ed.SVG.Options","type": "html","data": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"560\" height=\"30\" viewBox=\"0, 0, 560, 30\">\n  <g id=\"Layer_1\">\n    <path d=\"M404,4 L436,4 L436,26 L404,26 L404,4 z\" fill=\"#93A0A9\" fill-opacity=\"0.4\"/>\n    <path d=\"M284,4 L316,4 L316,26 L284,26 L284,4 z M324,4 L324,26 L356,26 L356,4 L324,4 z M364,4 L364,26 L396,26 L396,4 L364,4 z M524,4 L524,26 L556,26 L556,4 L524,4 z\" fill=\"#93A0A9\" fill-opacity=\"0.2\"/>\n    <path d=\"M2,4 L12,4 L12,14 L2,14 L2,4 z M266,4 L266,14 L276,14 L276,4 L266,4 z M44,4 L44,14 L60,14 L60,4 L44,4 z M220,4 L220,14 L236,14 L236,4 L220,4 z M84,4 L84,14 L106,14 L106,4 L84,4 z M108,4 L108,6 L116,6 L116,4 L108,4 z M108,8 L108,10 L114,10 L114,8 L108,8 z M124,4 L124,14 L156,14 L156,4 L124,4 z M193,7 L196,9 L193,11 z M167,11 L164,9 L167,7 z M162,4 L162,14 L198,14 L198,4 L162,4 z\" fill=\"#93A0A9\" fill-opacity=\"0.7\"/>\n    <path d=\"M476,4 L476,26 L444,26 L444,4 L476,4 z M475,5 L445,5 L445,25 L475,25 L475,5 z\" fill=\"#5E666B\" fill-opacity=\"0.6\"/>\n    <path d=\"M14,4 L36,4 L36,6 L14,6 L14,4 z M14,8 L14,10 L34,10 L34,8 L14,8 z M14,12 L14,14 L36,14 L36,12 L14,12 z M4,16 L4,18 L34,18 L34,16 L4,16 z M4,20 L4,22 L36,22 L36,20 L4,20 z M448,8 L448,10 L472,10 L472,8 L448,8 z M448,12 L448,14 L470,14 L470,12 L448,12 z M448,16 L448,18 L472,18 L472,16 L448,16 z M448,20 L448,22 L464,22 L464,20 L448,20 z M484,8 L484,10 L514,10 L514,8 L484,8 z M484,12 L484,14 L512,14 L512,12 L484,12 z M484,16 L484,18 L514,18 L514,16 L484,16 z M484,20 L484,22 L500,22 L500,20 L484,20 z M4,24 L4,26 L24,26 L24,24 L4,24 z M244,4 L244,6 L264,6 L264,4 L244,4 z M244,8 L244,10 L262,10 L262,8 L244,8 z M244,12 L244,14 L264,14 L264,12 L244,12 z M244,16 L244,18 L274,18 L274,16 L244,16 z M244,20 L244,22 L276,22 L276,20 L244,20 z M244,24 L244,26 L264,26 L264,24 L244,24 z M62,4 L62,6 L76,6 L76,4 L62,4 z M62,8 L62,10 L74,10 L74,8 L62,8 z M62,12 L62,14 L76,14 L76,12 L62,12 z M44,16 L44,18 L74,18 L74,16 L44,16 z M44,20 L44,22 L76,22 L76,20 L44,20 z M44,24 L44,26 L64,26 L64,24 L44,24 z M204,4 L204,6 L218,6 L218,4 L204,4 z M204,8 L204,10 L216,10 L216,8 L204,8 z M204,12 L204,14 L218,14 L218,12 L204,12 z M204,16 L204,18 L234,18 L234,16 L204,16 z M204,20 L204,22 L236,22 L236,20 L204,20 z M204,24 L204,26 L224,26 L224,24 L204,24 z M84,16 L84,18 L116,18 L116,16 L84,16 z M84,20 L84,22 L114,22 L114,20 L84,20 z M84,24 L84,26 L104,26 L104,24 L84,24 z M124,16 L124,18 L156,18 L156,16 L124,16 z M124,20 L124,22 L154,22 L154,20 L124,20 z M124,24 L124,26 L144,26 L144,24 L124,24 z M164,16 L164,18 L194,18 L194,16 L164,16 z M164,20 L164,22 L194,22 L194,20 L164,20 z M164,24 L164,26 L184,26 L184,24 L164,24 z\" fill=\"#93A0A9\" fill-opacity=\"0.6\"/>\n    <path d=\"M408,8 L432,8 L432,10 L408,10 L408,8 z M408,12 L408,14 L430,14 L430,12 L408,12 z M408,16 L408,18 L432,18 L432,16 L408,16 z M408,20 L408,22 L424,22 L424,20 L408,20 z\" fill=\"#5D656A\" fill-opacity=\"0.4\"/>\n    <path d=\"M484,4 L516,4 L516,5 L484,5 L484,4 z\" fill=\"#5D666B\" fill-opacity=\"0.7\"/>\n    <path d=\"M484,25 L516,25 L516,26 L484,26 L484,25 z\" fill=\"#5D666B\" fill-opacity=\"0.7\"/>\n    <path d=\"M295,19 L299.1,11 L300.7,11 L305,19 L303.0,19 L302.2,17.2 L297.5,17.2 L296.7,19 z M298.2,15.8 L301.4,15.8 L299.9,12.5 z M339.8,11.9 L341.9,16.0 L337.7,16.0 z M335.7,20 L336.8,17.8 L342.8,17.8 L344.0,20 L346.5,20 L341.0,10 L338.8,10 L333.5,20 z M379.8,11.0 L382.5,16.3 L377.0,16.3 z M374.3,21.5 L375.8,18.6 L383.7,18.6 L385.2,21.5 L388.5,21.5 L381.3,8.5 L378.5,8.5 L371.5,21.5 z M539.1,12.5 Q539.3,12.9 539.5,13.3 L540.7,16.0 L537.6,16.0 L538.8,13.3 Q539.0,12.9 539.1,12.5 z M541.0,16.8 L541.6,18.3 Q541.8,18.7 541.9,18.9 Q542.0,19.1 542.0,19.3 Q542.0,19.4 541.9,19.5 Q541.9,19.6 541.7,19.6 L540.3,19.8 L540.4,20.5 Q542.0,20.4 544.0,20.4 Q545.3,20.4 547,20.5 L546.9,19.8 L545.6,19.6 Q545.2,19.5 545.0,19.3 Q544.9,19.2 544.6,18.6 L540.5,9.5 L539.5,9.6 L535.2,18.7 Q535.0,19.1 534.9,19.3 Q534.7,19.5 534.4,19.6 L533,19.8 L533.0,20.5 Q534.1,20.4 535.4,20.4 Q536.2,20.4 538.1,20.5 L538.1,19.8 L536.6,19.6 Q536.5,19.6 536.4,19.5 Q536.3,19.4 536.3,19.3 Q536.3,19.2 536.4,18.9 Q536.5,18.7 536.7,18.2 L537.3,16.8 z\" fill=\"#5E666B\" fill-opacity=\"0.6\"/>\n  </g>\n</svg>\n","active": false,"err": [],"opts": [],"color": []},{"stamp": "1405142102473","id": ".Ed.Cropper","type": "js","data": "({\n\tparams:{strict:true, width:1031},\n\tdata: {\n\t\ttitle:'',\n\t\tfilename: \"\",\n\t\tfilesize:0,\n\t\tmime:\"\",\n\t\tdata: \"\",\n\t\tmode:[\"inline\"],\n\t\tcropped: false,\n\t\twidth: [\"300\"],\n\t\tscale: \"1\",\n\t\tsrc:{\n\t\t\tw:0, h:0, size:0\n\t\t},\n\t\taspect:null,\n\t\texpand:1.7,\n\t\tquality:1,\n\t\tenforceQuality:false,\n\t\tcrop: {}, \n\t\tgallery:true,\n\t\tdim:''\n\t},\n\tQuality:function(w){\n\t\tvar that = this, q = 0.95;\n\t\t[\n\t\t\t[500, 0.91],\n\t\t\t[800, 0.86],\n\t\t\t[1200, 0.81],\n\t\t\t[1600, 0.77],\n\t\t\t[1e6, 0.72]\n\t\t].forEach(function(e){\n\t\t\tif (+w <= e[0]) q = e[1];\n\t\t});\n\t\treturn (q*that.data.quality).clamp(0.4, 0.98);\n\t},\n\t//inherit:[\"GetAttRef\"],\n\tinit: function ($o) {\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\t// if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.lang;\n\t\t\n\t\t// HTML\n\t\t$o.formgen([\n\t\t'<div class=\"fl mr20 tac vat\" style=\"background-color:#e3e8eb;'\n\t\t+'width:800px;height:600px;overflow:hidden;position:relative;line-height:600px;\" id=\"crop-frame\">',\n    \t'<img id=\"source\" class=\"vam\" style=\"max-width:800px; max-height:600px; \" src=\"\" />',\n    \t'<div class=\"w800  dib\" style=\"height:600px;position:absolute;top:0;left:0\">',\n\t\t\t'<div id=\"previewscont\" class=\"dib vab\" style=\"line-height:2em;\">',\n\t\t\t\t\t'<span class=\"dib fs120 button w320 mr0 mb70\">',\n\t\t\t\t\t\t'<span class=\"fi-photo o80\"><span class=\"fs110\"> &nbsp;'+L.BTN_UPLOAD+'</span></span>',\n\t\t\t\t\t'</span>',\n\t\t\t\t\t'<br>',\n\t\t\t\t\t'<div id=\"previews\" class=\"w800 dib vat\" style=\"overflow-y:auto; height:392px;\">',\n\t\t\t\t\t'</div>',\n\t\t\t\t'</div>',\n   \t\t\t'<input type=\"file\" id=\"file\" class=\"w800 dib\" accept=\"image/jpeg,image/png,image/svg+xml,image/gif\" '\n   \t\t\t\t+'style=\"height:205px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n   \t\t'</div>',\n    '</div>',\n    '<div class=\"w210 dib vat\" id=\"xpreview\">',\n\t\t\t'<div id=\"ftitle\" class=\"hide fs110 lh120 tac blue-1 mb20\"></div>',\n\t\t\t'<textarea id=\"fname\" type=\"text\" class=\"w100p mt0 mb15 db tac\" rows=\"2\" style=\"resize:none\" '\n\t\t\t\t+'placeholder=\"'+L.FNAME_PLC+'\"></textarea>',\n\t\t\t{row:\"210px\",rowCss:\"tac mt7\"},\n\t\t\t[\"\",\"spn#format.fs90.lh150.tag-in-fmt\"],\n\t\t\t[\"\", \"div#quality.fs80.tac.o80\"],\n\t\t\t{row:\"210px\",rowCss:\"tac mt20\"},\n\t\t\t[\"\",\n\t\t\t \"but#btn-apply.w200.green.fs120.tac\",{txt:'<span class=\"fi-crop fs90 o90\"></span> '+L.BTN_CROP},\n\t\t\t \"btn#btn-orig.w200.tac.mt4.pl0.pr0.fs95\",{val:L.BTN_ORIGINAL},\n\t\t\t \"btn#btn-close.w200.tac.mt4.fs95\",{val:L.BTN_CANCEL}\n\t\t\t],\n\t\t\t'<div id=\"info\" class=\"fs75 gray mt20 tac nw\">',\n\t\t\t\t'<div id=\"dims\" class=\"dib vat pr6 tar w85\"></div>',\n\t\t\t\t'•',\n\t\t\t\t'<div id=\"xscale\" class=\"dib vat tac w40\">0.3x</div>',\n\t\t\t\t'•',\n\t\t\t\t'<div id=\"fsize\" class=\"dib vat pl6 tal w65 nw\">—— kb</div>',\n\t\t\t'</div>',\n    '</div>',\n    '<div class=\"w200 dib vat\" id=\"xwarn\"></div>',\n    '<div class=\"hide\">',\n    \t\t\t'<canvas id=\"x2\" width=400 height=400></canvas>',\n    \t\t\t'<canvas id=\"x1\" width=200 height=200></canvas>',\n\t\t'</div>'\n\t]);\n\t\t\n\t\t// Mount exisiting atts if needed\n\t\tif (that.data.gallery) $o.then(function(){\n\t\t\tthat.Att(that.Filter,'preview')\n\t\t\t.done(function(res){\n\t\t\t\tthat.Files = res;\n\t\t\t\t$o.find(\"#previews\").trigger(\"recalc\");\n\t\t\t}.debounce(100));\n\t\t});\n\t},\n\tFilter:/(jpeg|jpg|png|gif|svg)$/i,\n\tFiles:[],\n\tui: { /* See tab */ },\n\tstyle:{\n\t\t\" \": function(){\n\t\t\treturn (!this.data.gallery?{\n\t\t\t\t'#previewscont':{\n\t\t\t\t\t'':'height:440px',\n\t\t\t\t\t' #previews':'display:none!important;'\n\t\t\t\t},\n\t\t\t\t' #file':'height:500px!important;'\n\t\t\t}:{});\n\t\t},\n\t\t' #format.tag-in-fmt .tag':'margin-right:0!important;',\n\t\t\" .jcrop-holder\":\"display:inline-block;vertical-align:middle\",\n\t\t' .previewcard':{\n\t\t\t'':'cursor:pointer;width:160px;display:inline-block;vertical-align:top;background-color:rgba(255,255,255,0);'\n\t\t\t+'padding:5px;color:#bbb;transition: background 0.3s, color 0.3s;',\n\t\t\t':hover':'background-color:rgba(200,220,255,1);color:#69c;',\n\t\t\t' .previewcont':'line-height:150px; xborder:1px solid rgba(0,0,0,0.1);border-radius:2px;overflow:hidden;'\n\t\t\t+'height:150px;width:150px;background:white;margin-bottom:6px;',\n\t\t\t' .previewcont img':'display:inline-block;vertical-align:middle;',\n\t\t\t' #iiname':'word-break: break-all;'\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1473405182153","id": ".Ed.Cropper.ui","type": "js","data": "({\n\t\"#quality\":{\n\t\tbind:function(d,v){\n\t\t\tif(v!=null) {\n\t\t\t\td.quality = v;\n\t\t\t\tif (v+\"\"==\"1\") {\n\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.png');\n\t\t\t\t} else {\n\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.jpg');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn d.quality;\n\t\t},\n\t\tinit: function($o) {\n\t\t\t$o.tags({\n\t\t\t\ttags:[[\n\t\t\t\t\t{\"JPG 97%\":\"0.97\"},\n\t\t\t\t\t{\"90%\":\"0.90\"},\n\t\t\t\t\t{\"80%\":\"0.80\"}\n\t\t\t\t]],\n\t\t\t\tempty:{\"PNG\":\"1\"},\n\t\t\t\ttagshim:'',\n\t\t\t\tgroupshim:''\n\t\t\t})\n\t\t},\n\t\twatch:\"#fname\",\n\t\trecalc:'#fname',\n\t\tcss:{\n\t\t\thide: function(d){ return !d.cropped}\n\t\t}\n\t},\n\t\"#previews\":{\n\t\tbind:\"this.Files\",\n\t\tinit: function($o, form){\n\t\t\tvar that = this;\n\t\t\t$o.on(\"click.my\",'.previewcard', function(){\n\t\t\t\tform.data.ref = $(this).my(\"data\").fname+\"\";\n\t\t\t\tthat.my.commit();\n\t\t\t});\n\t\t},\n\t\tmanifest:{\n\t\t\tui:{\n\t\t\t\t'#iii':\"data\",\n\t\t\t\t'#iidesc':function(d) {\n\t\t\t\t\treturn [d.size, d.dim].compact().join(\" • \");\n\t\t\t\t},\n\t\t\t\t'#iiname':function(d){\n\t\t\t\t\treturn (d.fname||'?').split('/').last().truncate(50, 'middle', '…');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlist:[\n\t\t\t'<div class=\"previewcard\">',\n\t\t\t\t'<div class=\"previewcont\">',\n\t\t\t\t\t'<img src=\"\" id=\"iii\">',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"iiname\" class=\"w100p oh tac fs80 lh110 mb2\"></div>',\n\t\t\t\t'<div id=\"iidesc\" class=\"w100p oh tac fs70 lh110\"></div>',\n\t\t\t'</div>'\n\t\t].join('')\n\t},\n\t\"#fname\":{\n\t\tbind:\"filename\",\n\t\tcss:{\n\t\t\t'self:hide':function(d){return !d.cropped},\n\t\t\t'self:fs90':function(d){return d.filename.length<20},\n\t\t\t'self:fs80':function(d){return d.filename.length>=20},\n\t\t}\n\t},\n\t\"#format\": {\n\t\t\"bind\": \"width\",\n\t\t\"init\": function ($o) {\n\t\t\tvar that = this;\n\t\t\t$o.tags($.extend(true, {tagshim:'',groupshim:''},that.Lang.FORMAT_TAGS));\n\t\t}\n\t},\n\t'#info':{\n\t\twatch:'#fname,#format',\n\t\tcss:{\n\t\t\t'self:hide':function(d){return !d.cropped}\n\t\t}\n\t},\n\t'#dims':{\n\t\tbind:function(d,v){\n\t\t\tvar that = this,\n\t\t\t\t\twidth = d.width*(+d.expand || 1.7) | 0,\n\t\t\t\t\theight = width * (d.crop.h / d.crop.w) |0;\n\t\t\treturn width+'×'+height;\n\t\t},\n\t\twatch:'#fname,#format',\n\t\tcss:{\n\t\t\t'self:hide':function(d){return !d.cropped}\n\t\t}\n\t},\n\t'#xscale':{\n\t\tbind: function(d){\n\t\t\tvar scale = d.width*(+d.expand || 1.7) / (d.crop.w * d.scale);\n\t\t\treturn '<span class=\"{2}\">{1}×</span>'.assign(scale.round(1), scale<1.2?'':scale<1.5?'orange':scale<2?'red':'red fs120');\n\t\t},\n\t\twatch:'#dims'\n\t},\n\t'#fsize':{\n\t\tdelay:500,\n\t\tbind: function(d){\n\t\t\tvar that = this,\n\t\t\t\t\ts, l, width,height, bpp;\n\t\t\tif (d.cropped) {\n\t\t\t\tl = that.Gen(true);\n\t\t\t\twidth = d.width*(+d.expand || 1.7) | 0,\n\t\t\t\theight = width * (d.crop.h / d.crop.w) |0;\n\t\t\t\tbpp = l*8 / width / height;\n\t\t\t\ts = l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\";\n\t\t\t\treturn '<span class=\"{2}\">{1}</span>'\n\t\t\t\t\t.assign(s, bpp < 2.5?'':bpp<4?'orange':bpp<6?'red':'red fs110');\n\t\t\t}\n\t\t},\n\t\twatch:'#dims,#quality,#format'\n\t},\n\t'#ftitle':{\n\t\tbind:'title',\n\t\tcss:{\n\t\t\thide: function(d){return !d.title;}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1464978346435","id": ".Ed.Cropper.ui","type": "js","data": "({\n\t\"#file\": {\n\t\t\"bind\": function (d, v, $o){\n\n\t\t\tvar that = this,\n\t\t\t\t\tf,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\timg=\"\",\n\t\t\t\t\t_prepareFname = that.Fname;\n\n\t\t\tif (v!=null && v) {\n\t\t\t\tf = $o[0].files[0];\n\t\t\t\tif (f) (function(){\n\t\t\t\t\td.filename = _prepareFname(f.name);\n\t\t\t\t\td.type = f.type;\n\t\t\t\t\t\n\t\t\t\t\tvar params = { \n\t\t\t\t\t\tnoRevoke:true, \n\t\t\t\t\t\tcanvas: true,\n\t\t\t\t\t\tpixelRatio: 1,\n\t\t\t\t\t\tdownsamplingRatio: 0.5,\n\t\t\t\t\t\tmaxWidth:3600,\n\t\t\t\t\t\tmaxHeight:2400\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// apply img\n\t\t\t\t\tvar _apply = function (ni) {\n\t\t\t\t\t\tvar st = $img.attr('style');\n\t\t\t\t\t\t$img = $(ni);\n\t\t\t\t\t\t$img.attr('style',st).removeClass(\"hide\");\n\t\t\t\t\t\t$r.find(\"#source\").replaceWith($img);\n\t\t\t\t\t\t$img.attr('id','source');\n\n\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\t\t\t\t\t\t\n\t\t\t\t\t\td.src.w = $img[0].width;\n\t\t\t\t\t\td.src.h = $img[0].height;\n\t\t\t\t\t\td.scale = d.src.w/$img.width();\n\n\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\taspectRatio: d.aspect,\n\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\tbgColor:'#e3e8eb',\n\t\t\t\t\t\t\tbgOpacity:0.2,\n\t\t\t\t\t\t\tminSize:[50,40],\n\t\t\t\t\t\t\tallowMove:true\n\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\tthis.animateTo([100,100,300,230]);\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.cropped = true;\n\t\t\t\t\t\tif (!d.enforceQuality) d.quality = d.type=='image/jpeg'?'0.90':'1';\n\t\t\t\t\t\t\n\t\t\t\t\t\tthat.my.recalc('#fname');\n\t\t\t\t\t\tthat.my.check('#fname');\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tloadImage.parseMetaData(f, function(data) {\n\t\t\t\t\t\tif (data.exif) params.orientation = data.exif.get('Orientation');\n\t\t\t\t\t\tloadImage(f, _apply, params);\n\t\t\t\t\t});\n\n\t\t\t\t})();\n\t\t\t} // end if\n\n\t\t\tfunction preview(c){\n\t\t\t\t$.extend(d.crop, Object.select(c,[\"x\",\"y\",\"w\",\"h\"]));\n\t\t\t\td.cropped=true;\n\t\t\t\tthat.my.check('#dims');\n\t\t\t\tthat.my.check('#quality');\n\t\t\t}\n\t\t},\n\t\tevents:'change.my'\n\t},\n\t\"#btn-orig\":{\n\t\tbind: function(d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v !=null && d.filename) {\n\t\t\t\tvar f = $o.my(\"find\",\"#file\")[0].files[0];\n\t\t\t\tif (f) {\n\t\t\t\t\td.type=f.type;\n\t\t\t\t\td.filename = that.Fname(d.filename);\n\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\td.data = window.btoa(sb64.join(''));\n\t\t\t\t\t\t//console.log(d.type)\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t};\n\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t}\n\n\t\t\t}\n\t\t},\n\t\tevents:\"click.my\",\n\t\twatch:'#fname',\n\t\tcss:{\n\t\t\t':disabled':function(d){return !d.filename || d.filesize>3e6}\n\t\t}\n\t},\n\t\"#btn-apply\": {\n\t\t\"bind\": function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null && d.cropped && d.filename) {\n\t\t\t\tthat.Gen(false);\n\t\t\t\t$o.my().root.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"events\": \"click.my\",\n\t\twatch:'#fname',\n\t\tcss:{\n\t\t\t':disabled':function(d){return !d.filename}\n\t\t}\n\t},\n\t\"#btn-close\": {\n\t\t\"bind\": function (d,v,$o) {if (v!=null) $o.trigger(\"cancel\");},\n\t\t\"events\": \"click.my\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1464978417258","id": ".Ed.Cropper.lang","type": "js","data": "({\n\ten:{\n\t\tBTN_UPLOAD:'Upload image...',\n\t\tFNAME_PLC:'Attachment file name',\n\t\tBTN_CROP:'Crop',\n\t\tBTN_ORIGINAL:'Insert original',\n\t\tBTN_CANCEL:'Cancel',\n\n\t\tFORMAT_TAGS:{\n\t\t\ttags:[[\n\t\t\t\t{ value:'300', name:'<span class=\"t-left300\"></span>', title:'Aside floater' },\n\t\t\t\t{ value:'500', name:'<span class=\"t-left500\"></span>', title:'1/2 column' },\n\t\t\t\t{ value:'750', name:'<span class=\"t-left750\"></span>', title:'Column' },\n\t\t\t\t{ value:'1000', name:'<span class=\"t-left1000\"></span>', title:'Fullscreen' }\n\t\t\t]],\n\t\t\tempty: { value:'200', name:'<span class=\"t-left200\"></span>', title:'Small aside' }\n\t\t},\n\t\t\n\t\tLBL_FSIZE:'File size ~'\n\t},\n\n\tru:{\n\t\tBTN_UPLOAD:'Загрузить фото...',\n\t\tFNAME_PLC:'Имя файла',\n\t\tBTN_CROP:'Обрезать',\n\t\tBTN_ORIGINAL:'Вставить оригинал',\n\t\tBTN_CANCEL:'Закрыть',\n\n\t\tFORMAT_TAGS:{\n\t\t\ttags:[[\n\t\t\t\t{ value:'300', name:'<span class=\"t-left300\"></span>', title:'Врезка' },\n\t\t\t\t{ value:'500', name:'<span class=\"t-left500\"></span>', title:'Полколонки' },\n\t\t\t\t{ value:'750', name:'<span class=\"t-left750\"></span>', title:'Колонка' },\n\t\t\t\t{ value:'1000', name:'<span class=\"t-left1000\"></span>', title:'На весь экран' }\n\t\t\t]],\n\t\t\tempty: { value:'200', name:'<span class=\"t-left200\"></span>', title:'Маленькая врезка' }\n\t\t},\n\t\t\n\t\tLBL_FSIZE:'Размер файла ~'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1465731873517","id": ".Ed.Cropper.Fname","type": "js","data": "(function (fname0, size) {\n\tvar fname = fname0+'',\n\t\t\tsfname = fname.split('.'),\n\t\t\tln = !isNaN(size)?+size:60;\n\tif (sfname.length>1)  {\n\t\tfname = sfname.to(-1).join('.').truncate(ln,'middle','_') + '.' +sfname.last().toLowerCase();\n\t} \n\telse fname = fname.toLowerCase().truncate(ln,'middle','_');\n\n\t// translit cyr and replace invalid chars\n\tvar cr = 'аa бb вv гg дd еe ёyo жzh зz иi йiy кk лl мm нn оo пp рr сs тt уu фf хh цts чch шsh щsch ъ- ыy ь- эe юyu яya'\n\t.split(\" \").reduce(function(a,b){\n\t\tvar key = b.to(1), val = b.from(1);\n\t\ta[key] = val;\n\t\ta[key.toUpperCase()] = val.toUpperCase();\n\t\treturn a; \n\t},{});\n\n\tfname = fname.split('').map(function(e){\n\t\tif (cr[e]) return cr[e];\n\t\telse if (!/[a-z0-9\\.\\-_~]/i.test(e)) return '-';\n\t\treturn e;\n\t}).join('').replace(/-+/g,'-').replace(/^_/,'');\n\n\treturn fname;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1473405780546","id": ".Ed.Cropper.Gen","type": "js","data": "(function (countOnly) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tf,\n\t\t\t//$r = $o.my().root,\n\t\t\t$c = that.my.find(\"#x1\"),\n\t\t\t$img = that.my.find(\"#source\"), \n\t\t\t$c2 = that.my.find(\"#x2\"),\n\t\t\tn={k:d.scale}, img=\"\",\n\t\t\twidth=d.width*(+d.expand || 1.7) | 0,\n\t\t\tquality = +d.quality || that.Quality(width) || 0.85,\n\t\t\ts;\n\t\n\tpreview(d.crop);\n\t\n\tif (+quality != 1) { \n\t\ts = that.my.find(\"#x1\")[0]\n\t\t.toDataURL('image/jpeg', quality)\n\t\t.substr(23);\n\t}\n\telse {\n\t\ts = that.my.find(\"#x1\")[0]\n\t\t.toDataURL('image/png', quality)\n\t\t.substr(22);\n\t}\n\t\n\tif (countOnly) return s.length/4*3|0;\n\t\t\n\td.filename = that.Fname(d.filename);\n\n\td.data = s;\n\n\td.type = +quality != 1?\"image/jpeg\":\"image/png\";\n\n\t//- - - - - - - - - - - -\n\n\tfunction preview (c){\n\t\tif(parseInt(c.w) > 0) {\n\t\t\t// Show image preview\n\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\tk = n.k,\n\t\t\t\t\tw = c.w*k|0 , // scale width/height\n\t\t\t\t\th = c.h*k|0; \n\t\t\tif (w>width*2) {\n\t\t\t\tcs2 = $c2[0];\n\t\t\t\tcs2.width=width*2;\n\t\t\t\tcs2.height=2*width*(h/w)|0;\n\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\tctx2.rect(0, 0, cs2.width, cs2.height);\n\t\t\t\tctx2.fillStyle='white';\n\t\t\t\tctx2.fill();\n\t\t\t\tctx2.drawImage(img, c.x*k |0, c.y*k|0, w, h, 0, 0, cs2.width, cs2.height);\n\n\t\t\t\tcs = $c[0];\n\t\t\t\tcs.width=width;\n\t\t\t\tcs.height=width*(h/w)|0;\n\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\tctx.drawImage(cs2, 0, 0, cs2.width, cs2.height, 0, 0, cs.width, cs.height);\n\t\t\t} else {\n\t\t\t\tcs = $c[0];\n\t\t\t\tcs.width=width;\n\t\t\t\tcs.height=width*(h/w)|0;\n\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\tctx.rect(0, 0, cs.width, cs.height);\n\t\t\t\tctx.fillStyle='white';\n\t\t\t\tctx.fill();\n\t\t\t\tctx.drawImage(img, c.x*k|0, c.y*k|0, w, h, 0, 0, cs.width, cs.height);\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1461350207246","id": ".Ed.Widgets.Chart","type": "js","data": "({\n\t\"id\": \"in.Chart\",\n\t\"name\": \"Donut chart\",\n\t\"params\": {\n\t},\n\t\"data\": {\n\t\t\"title\": \"\",\n\t\t\"rows\": [],\n\t\t\"width\": 330,\n\t\t\"height\": 330\n\t},\n\t\"init\": function ($o,form) {\n\n\t\tif (!form.data.rows.length) {\n\t\t\tform.data.rows.push({\n\t\t\t\tid:cw.lib.hash4(Date.now()+\"x\"),\n\t\t\t\tname:\"\",\n\t\t\t\tvalue:\"1\",\n\t\t\t\tcolor:this.Colors[0]\n\t\t\t})\n\t\t}\n\t\t$o.formgen([\n\t\t\t'<div class=\"w700\">',\n\t\t\t'<div id=\"graph\" class=\"dib vat mr20\"></div>',\n\t\t\t'<div id=\"legend\" class=\"w350 dib vat\">',\n\t\t\t\t'<textarea id=\"stitle\" class=\"w100p fs150 lh110 pr0 mb6\" placeholder=\"Enter title...\"></textarea>',\n\t\t\t\t'<div id=\"slist\" class=\"w350 dib vat fs90\"></div>',\n\t\t\t\t'<div class=\"hoverlink lgray fs70 pl35 lh120\" id=\"xadd\">',\n\t\t\t\t\t'<span class=\"pseudolink\" id=\"btn-add\">Add row...</span>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'</div>'\n\t\t]);\n\t\n\t\t},\n\t\"Colors\": [\"#ffa3b2\",\n\t\t\"#ffb88c\",\n\t\t\"#ffe28a\",\n\t\t\"#c5db90\",\n\t\t\"#98e2d5\",\n\t\t\"#a3c8f5\",\n\t\t\"#c9a2de\",\n\t\t\"#cecece\"],\n\t\"ui\": {\n\t\t\"#stitle\": function (d,v,$o) {\n\n\t\t\tif (v!=null) d.title = v;\n\t\t\t$o.height(0).height($o[0].scrollHeight);\n\t\t\treturn d.title;\n\t\t\n\t\t\t},\n\t\t\"#btn-add\": {\n\t\t\t\"bind\": function (d,v,$o) {\n\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t$o.my(\"find\", \"#slist\").trigger(\"insert\", {\n\t\t\t\t\t\twhat:{\n\t\t\t\t\t\t\tid:cw.lib.hash4(Date.now()+\"x\"),\n\t\t\t\t\t\t\tname:\"\",\n\t\t\t\t\t\t\tvalue:\"1\",\n\t\t\t\t\t\t\tcolor:this.Colors[d.rows.length%8]\n\t\t\t\t\t\t},\n\t\t\t\t\t\twhere:1e12\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\n\t\t\t\t},\n\t\t\t\"events\": \"click.my\"\n\t\t},\n\t\t\"#slist\": {\n\t\t\t\"bind\": \"rows\",\n\t\t\t\"id\": \"id\",\n\t\t\t\"init\": function ($o,form) {\n\n\t\t\t\t$o.sortable({handle:\".dragger\"});\n\t\t\t\t$o.on(\"dblclick.my\",\"#scolor\", function(){\n\t\t\t\t\tif (form.data.rows.length>1) $(this).trigger(\"remove\")\n\t\t\t\t}.debounce(10));\n\t\t\t\n\t\t\t\t},\n\t\t\t\"css\": {\n\t\t\t\t\"fs80\": function (d) {\n\t\t\t\t\treturn d.rows.length >7\n\t\t\t\t\t},\n\t\t\t\t\"fs90\": function (d) {\n\t\t\t\t\treturn d.rows.length >4 && d.rows.length<8\n\t\t\t\t\t},\n\t\t\t\t\"fs100 lh170\": function (d) {\n\t\t\t\t\treturn d.rows.length <5\n\t\t\t\t\t}\n\t\t\t},\n\t\t\t\"manifest\": {\n\t\t\t\t\"ui\": {\n\t\t\t\t\t\"#scolor\": function (d,v,$o) {\n\t\t\t\t\t\t$o.css({'background-color':d.color})\n\t\t\t\t\t\t},\n\t\t\t\t\t\"#sname\": function (d,v,$o) {\n\n\t\t\t\t\t\tif (v!=null) d.name = v;\n\t\t\t\t\t\t$o.height(0).height($o[0].scrollHeight);\n\t\t\t\t\t\treturn d.name;\n\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\"#svalue\": {\n\t\t\t\t\t\t\"bind\": \"value\",\n\t\t\t\t\t\t\"check\": /^[\\-]?\\d+([\\.,]?\\d+)?.*$/\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"list\": \"<div class=\\\"pierow pl5\\\"><div class=\\\"dib vat w32 dragger\\\"><div class=\\\"br100\\\" style=\\\"width:1em;height:1em;margin-top:0.18em;\\\" id=\\\"scolor\\\"></div></div><div class=\\\"dib vat w230\\\"><textarea id=\\\"sname\\\" class=\\\"w100p db\\\" placeholder=\\\"Enter label...\\\"></textarea></div><div class=\\\"dib vat w80\\\"><input type=\\\"text\\\" id=\\\"svalue\\\" class=\\\"w100p db pr5 tar\\\" placeholder=\\\"Value\\\"/></div></div>\"\n\t\t},\n\t\t\"#graph\": {\n\t\t\t\"init\": function ($o) {\n\n\t\t$o.on(\"mouseenter.my\", \"path.sector\", function(){\n\t\t\tvar id=$(this).attr(\"id\"),\n\t\t\t\t\t$row = $o.my(\"find\",\"#slist>div\").eq(id.from(1));\n\t\t\t$row.css({'border':'1px solid '+$row.my(\"data\").color})\n\t\t});\n\t\t$o.on(\"mouseleave.my\", \"path.sector\", function(){\n\t\t\tvar id=$(this).attr(\"id\"),\n\t\t\t\t\t$row = $o.my(\"find\",\"#slist>div\").eq(id.from(1));\n\t\t\t$row.css({'border':'1px solid transparent'})\n\t\t});\n\t\n\t\t\t\t},\n\t\t\t\"bind\": function (d,v,$o) {\n\n\t\tvar a, sum;\n\t\ta = d.rows.reduce(function(a, elt){\n\t\t\tif (!isNaN(parseFloat(elt.value.replace(/,/g,'.')))) {\n\t\t\t\tvar t = Object.clone(elt);\n\t\t\t\tt.value = parseFloat(elt.value.replace(/,/g,'.'));\n\t\t\t\ta.push(t)\n\t\t\t};\n\t\t\treturn a;\n\t\t},[]);\n\t\tsum = a.reduce(function(a, elt){ return a+elt.value; \t},0);\n\n\t\tvar rot = -90,\n\t\t\t\tw = Math.min(d.width, d.height, $o.my(\"find\",\"#legend\").height()).clamp(230,d.width),\n\t\t\t\th = '<svg width=\"'+w+'\" height=\"'+w+'\">', \n\t\t\t\tcx = w/2,\n\t\t\t\tcy = w/2,\n\t\t\t\taw = w/8*3,\n\t\t\t\tow = 0.625 * w /2,\n\t\t\t\tsin = Math.sin, cos = Math.cos, PI = Math.PI;\n\t\ta.forEach(function(e, i){ \t\n\t\t\tvar x1,y1,x2,y2,end;\n\t\t\te.angle = a.length==1 ? 359.9999 : e.value/sum*360; \n\t\t\tend = rot + e.angle;\n\t\t\t\n\t\t\tx1 = cx - ow*cos(PI*rot/180);\n\t\t\ty1 = cy - ow*sin(PI*rot/180);\n\n\t\t\tx2 = cx - ow*Math.cos(PI*end/180);\n\t\t\ty2 = cy - ow*Math.sin(PI*end/180);\n\n\t\t\trot = end;\n\n\t\t\th+='<path '\n\t\t\t+'id=\"x'+i+'\" class=\"sector\" '\n\t\t\t+'d=\"M'+x1+','+y1+' A'+ow+','+ow+' 0 '\n\t\t\t+(e.angle>180?1:0)+',1 '+x2+','+y2+' \" '\n\t\t\t+'stroke-width=\"'+aw+'\" fill=\"none\" stroke=\"'+e.color+'\" '\n\t\t\t+'/>';\n\t\t});\n\t\th+='</svg>'\n\t\treturn h;\n\t\n\t\t\t\t},\n\t\t\t\"watch\": \"#slist\"\n\t\t}\n\t},\n\t\"style\": {\n\t\t\" #legend\": \"font-size:15pt;\",\n\t\t\" .dragger\": \"cursor:move;\",\n\t\t\" .pierow\": \"line-height:1.4em;margin-bottom:0.1em; border:1px solid transparent; border-radius:2px;\",\n\t\t\" #xadd\": \"opacity:0; transition: opacity 0.3s;\",\n\t\t\" #legend:hover #xadd\": \"opacity:1;\",\n\t\t\" input[type=text],textarea\": \"font-size:inherit; border:0!important; min-height:1em;resize:none;margin:0; padding:0 1em 0 0;\"\n\t}\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["teal"]},{"stamp": "1538770273428","id": ".queries","type": "js","data": "({\n\t// built-in views\n  \n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1538770306934","id": ".queries.cards","type": "js","data": "({\n  \n  // Emits doc cards categorized by _id, path, tag, alias\n  \n\tmap: '  '+(function(doc){\n    \n  \tif (doc.type != 'inliner' || !isArray(doc.tags) || !doc.stamp || isNaN(doc.stamp)) return;\n    if (doc.crypto && doc.CRYPTO) return;\n\t\tif (isArray(doc.owners) && doc.owners.length) return; \n    \n\t\tvar _hide \t= ['Draft','Черновик'],\n        _tags \t= {},\n        _hidden = false,\n        _keys \t= [],\n        _key\t\t= function(a){if(a)_keys.push(a)},\n        meta \t\t= (doc.meta || {}),\n        alias \t= (meta.alias || '').replace(/(^\\/+|\\/+$)/g,'').replace(/\\/+/g,'/'),\n        ms \t\t\t= -doc.stamp;\n\t\t\n    doc.tags.forEach(function(t){_tags[t.toLowerCase()] = true});\n    \n    // Case-insensitive search for tags to skip\n    for (var i = 0; i<_hide.length && !_hidden; i++) _hidden = _tags[_hide[i].toLowerCase()] || _hidden;\n    if (_hidden) return;\n    \n    var obj = {\n    \ttitle:\t'',\n      desc:\t\t'',\n      photo:\t'',\n      logo:\t\t'',\n      tags:\t\tdoc.tags,\n      link:{\n        mode:\t['link','header','image'],\n        text:\t_eschtml(_untag(doc.name+'')),\n        url:\t'./'+doc._id\n      }\n    };\n    \n    // Title and description\n    obj = _merge(obj, _brief(doc));\n    \n\t\t// Photo\n    var photo = _detectPreview(doc);\n    if (photo) obj.photo = doc._id+'/'+_uri(photo+'');\n    \n    // Logo\n    var logo = doc.meta?doc.meta.logo:null;\n    if (logo) obj.logo = /^http[s]?:/.test(logo)?logo:(doc._id+'/'+_uri(logo+''));\n\n    // String-type emit keys\n    [doc._id, 'doc/'+doc._id.substr(-8), alias].forEach(_key);\n\n    // Keys like ['tag' tag, -ts]]\n    Object.keys(_tags).forEach(function(tag){_key(['tag', tag, ms])});\n    \n    // Keys pointing on doc root ['path', root, -ts]\n    if (alias) {\n    \tvar alpath = alias.split('/');\n      alpath.pop();\n      _key(['path','/'+alpath.join('/'), ms]);\n    }\n    else _key(['path','/doc', -ms]);\n    \n    // Author ['user', author, -ts]\n    if (isS(doc.creator)) _key(['user', doc.creator, ms]);\n    \n    // Emit all collected keys\n    _keys.forEach(function(key){emit(key, obj)});\n    \n    return;\n    \n    \n    //- - - - - - - - -\n\t\t\n\t\tfunction _brief(d) {\n\t\t\t\n\t\t\t// Builds brief from Inliner doc\n\t\t\t\n\t\t\tvar h = '', head = 'h1',\n\t\t\t\t\tres = {title:'', desc:''};\n\t\t\t\n\t\t\td.content.forEach(function(e){\n\t\t\t\tif (!/^(right|left200|left300)/.test(e.format+'')) {\n\t\t\t\t\tif (e.type == 'img' || e.type == 'embed' && e.showDesc+'') h+=' '+e.desc;\n\t\t\t\t\telse if (e.type == 'html') h+=' '+e.data;\n          else if (e.type == 'widget' && e.html) h+=' '+e.html;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (h.indexOf('</h1>')==-1) {\n\t\t\t\thead = 'h2';\n\t\t\t\tif (h.indexOf('</h2>')==-1) return {title:d.name, desc:d.desc||''};\n\t\t\t}\n\t\t\t\n\t\t\t//return res;\n\t\t\t\n\t\t\tvar a = h.split('</'+head+'>');\n\t\t\tvar t = _last(a[0].split('<'+head)).split('>').slice(1).join('>');\n\t\t\tvar p = _last(a.slice(1).join('</'+head+'>')\n\t\t\t.replace(/<p>(|\\s+|&nbsp;|\\u00a0+|<br>)<\\/p>/g,'')\n\t\t\t.split('</p>')[0].split('<p'))\n\t\t\t.split('>').slice(1).join('>');\n\t\t\t\n\t\t\tres.title = _dehtml(t);\n\t\t\tres.desc = _shy(_dehtml(p));\n\t\t\t\n\t\t\treturn res;\n\t\t}\n\t\t\n\t\t//- - - - - - - - -\n\t\t\n\t\tfunction _dehtml(s) {\n\t\t\treturn _compact(_untag(s.replace(/<br[\\/]?>/g,' ')).replace(/&nbsp;/g,' '));\n\t\t}\n\t\t\n\t\t//- - - - - - - - -\n\t\t\n\t\tfunction _detectPreview(d){\n\t\t\t\n\t\t\t// Detects preview in Inliner doc\n\t\t\t\n\t\t\tvar a = d._attachments;\n\t\t\tif (a) {\n\t\t\t\tif (a['preview.jpg']) return 'preview.jpg';\n\t\t\t\telse if (a['preview.jpeg']) return 'preview.jpeg';\n\t\t\t\telse if (a['preview.gif']) return 'preview.gif';\n\t\t\t\telse if (a['preview.png']) return 'preview.png';\n\t\t\t\t\n\t\t\t\tvar fname = null,\n\t\t\t\t\t\tfdiff = 1e12;\n\t\t\t\t\n\t\t\t\t// Search for most relevant image for preview\n\t\t\t\tif (d.previews) {\n\t\t\t\t\tObject.keys(d.previews).forEach(function(i){\n\t\t\t\t\t\tvar dim = (d.previews[i].dim||'').match(/\\d+/g),\n\t\t\t\t\t\t\t\tdiff = Math.abs(800*600 - dim[0]*dim[1]);\n\t\t\t\t\t\tif (dim[0]*dim[1]>300*200 && a[i] && diff<fdiff) {\n\t\t\t\t\t\t\tfdiff = diff; fname = i;\n\t\t\t\t\t\t} \n\t\t\t\t\t});\n\t\t\t\t\tif (fname) return fname;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tObject.keys(a).forEach(function(i){\n\t\t\t\t\tif (!fname && /\\.(jp[e]?g|png)$/i.test(i)) fname = i;\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\treturn fname;\n\t\t\t\t\n\t\t\t} else return null;\n\t\t}\n    \n    //- - - - - - - - - - - - - -\n  \n    function _j(a) {return JSON.stringify(a);}\n    function _uri(s) {return encodeURIComponent(s);}\n    function _untag(s) {return s.replace(/<\\/?[^<>]*>/gi,'');}\n    function _compact(s) {return s.replace(/\\s+/gi,' ').replace(/^\\s+|\\s+$/g,'');}\n    function _eschtml(s) {\n      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')\n        \t\t\t.replace(/\"/g,'&quot;').replace(/'/g,'&apos;').replace(/\\//g,'&#x2f;');}\n    function _last(a) {return a[a.length-1];}\n    function isS(s) {return typeof s == 'string';}\n    \n    //- - - - - - - - - - - - - - \n\t\t\n    function _merge(a,b){\n      for (var j=0,r={},args=[]; j<arguments.length; j++) args.push(arguments[j]);\n      for (j=0;j<args.length;j++) Object.keys(args[j]).forEach(function(i){r[i] = args[j][i];});\n      return r;\n    }\n    \n    //- - - - - - - - - - - - - - \n    \n    function _shy (s) {\n\n      // Hyphenates cyrillic text\n\n      var r1=\"$1ᴥ$2\",r2=r1+\"ᴥ\";\n      return (s+'').replace(/([а-яё])([\\.,;\\?\\!:])([а-яё])/gi,\"$1$2 $3\").split(/[\\s\\t\\r\\n]+/).map(function(w,ctr,a) { \n        if (w.length<6 ||  (ctr==a.length-1 && w.length<10)) return w;\n        var prefix=\"\", postfix=\"\",w1;\n        if (/^[^a-z0-9а-яё]/i.test(w)) prefix=w.substr(0,1);\n        if (/[^a-z0-9а-яё]$/gi.test(w)) postfix=_last(w);\n        return prefix+w\n          .replace(/^[^a-z0-9а-яё]|[^a-z0-9а-яё]$/gi,\"\")\n\n        //prefixes\n          .replace(/^(верх|ниж|зад)(не)/i,r2).replace(/^(су|ги)(пер)/i,r2)\n          .replace(/^(вяче|архан|про|вы|над|по(д)?|пара|бе[зс]о?|раз|лесо|круго|суб|за|журна|долго|ре([ск])?|транс|энерго|прези|пере|(ста|ме)ро)/i,\"$1ᴥ\")\n\n        //hyphener\n          .replace(/([а-яё]{2,}?[б-джзй-нп-тф-щ][аеёиоуыэюя])([аеёиоуыэюя][а-яё]+)/gi,r1)\n          .replace(/^([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ][аеёиоуыэюя])/gi,\"$1ᴥ$2ᴥ$3\")\n          .replace(/([аеёоуыэюя][б-джзй-нп-тф-щ][ъь])([б-джзй-нп-тф-щ][а-яё])/gi,r1)\n          .replace(/([аеёиоуыэюяйᴥ][б-джзй-нп-тф-щ])([б-джзк-нп-тф-щ][а-яё]?[аеёиоуыэюяй][а-яёᴥ]?)/gi,r1)\n          .replace(/^([оау][зщжшцйс])(ᴥ)/gi,\"$1\")\n          .replace(/([а-яё]{2}[аеёиоуыэюя])([б-джзк-нп-тф-щ][а-щыэ-яё])/gi,r1)\n          .replace(/([а-яё]{2}[б-джзк-нп-тф-щ])([аеёиоуыэюя][а-яё])/gi,r1)\n\n\n        //correctors\n          .replace(/(ᴥ)([б-джзй-нп-тф-щъь]+)$/i,\"$2\")\n          .replace(/(ᴥ)([йъьы])/gi,\"$2\")\n          .replace(/(ᴥ)([а-яё][лнтс]+ь)/gi,\"$2\")\n          .replace(/(ᴥ)(кала|убить)$/gi,\"$2\")\n          .replace(/([б-джзк-нп-тф-щ])(ᴥ)([аеёиоуыэюяй]{2})$/gi,\"ᴥ$1$3\")\n          .replace(/(ᴥ)([б-джзк-нп-тф-щ])(ᴥ)([б-джзк-нп-тф-щ])/gi,\"$1$2$4\")\n          .replace(/^([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ])(ᴥ)([аеёиоуыэюя][б-джзк-нп-тф-щ])/gi,\"$1ᴥ$2$4\")\n          .replace(/([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ])(ᴥ)([аеёиоуыэюя][б-джзк-нп-тф-щ])$/gi,\"$1ᴥ$2$4\")\n          .replace(/([б-джзк-нп-тф-щ][аеёиоуыэюя][б-джзк-нп-тф-щ])(ᴥ)([б-джзк-нп-тф-щ])([б-джзк-нп-тф-щ][аеёиоуыэюя]ᴥ[б-джзк-нп-тф-щ])/gi,\"$1$3ᴥ$4\")\n          .replace(/([б-джзк-нп-тф-щ]{2})([б-джзк-нп-тф-щ][ие])(ᴥ)([тн])([тн])([аеёиоуыэюя][аеёиоуыэюяй]?)$/gi,\"$1ᴥ$2$4ᴥ$5$6\")\n          .replace(/([б-джзк-нп-тф-щ])([б-джзк-нп-тф-щ])(ᴥ)([аиоуыэ][б-джзк-нп-тф-щ])(ᴥ)/gi,\"$1ᴥ$2$4$5\") //тр-иб- 2 т-риб-\n          .replace(/ᴥ([б-джзк-нп-тф-щ]{2})ᴥ/gi,\"$1ᴥ\") // - согл согл -\n          .replace(/^([б-джзк-нп-тф-щ]{2,})ᴥ/gi,\"$1\") //2+согл в начале слова\n          .replace(/(ᴥ)([б-джзк-нп-тф-щ])([б-джзк-нп-тф-щ]{3})/gi,\"$2$1$3\") //средства, сопутству...\n          .replace(/([а-яё])\\1ᴥ/gi,\"$1ᴥ$1\") //две одинаковых буквы\n          .replace(/ᴥ([б-джзк-нп-тф-щ][аеёиоуыэюя])([б-джзк-нп-тф-щ])ᴥ([аеёиоуыэюя])([б-джзк-нп-тф-щ][аеёиоуыэюя])/gi,\"ᴥ$1ᴥ$2$3ᴥ$4\")    // нан-ана 2 на-на-на\n          .replace(/^(ра)ᴥ(з)/i,\"$1$2ᴥ\")\n          .replace(/([б-джзк-нп-тф-щ])ᴥ([еу])([ежзц])ᴥ/,\"ᴥ$1$2$3\")\n          .replace(/([б-джзк-нп-тф-щ]{2})([б-джзк-нп-тф-щ])(ᴥ)([эуюяыое][б-джзк-нп-тф-щ])/gi,\"$1ᴥ$2$4\")\n          .replace(/ᴥᴥ/gi,\"ᴥ\")\n          .replace(/ᴥ/g,\"\\u00ad\")+postfix;//\\u00ad\");\n      }).join(' ').replace(/\\s—\\s/g,\"\\u00a0– \");\n    }\n    \n\t}).toString().replace(/\\t/g,'  ')\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1538860371756","id": ".queries.tags","type": "js","data": "({\n  \n  // Emits doc tags\n  \n\tmap: '  '+(function(doc){\n    \n  \tif (doc.type != 'inliner' || !isArray(doc.tags) || !doc.stamp || isNaN(doc.stamp)) return;\n    \n\t\tvar _tags \t= {};\n    doc.tags.forEach(function(t){_tags[t] = true});\n    Object.keys(_tags).forEach(function(t){emit(t, 1);});\n    \n\t}).toString().replace(/\\t/g,'  '),\n  \n  reduce:'_count'\n})","active": false,"err": [],"opts": [],"color": ["red"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzZBQUNGRiIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00My44MzYsOTAuMDc2IEwzNi4wNzEsOTIuNzc4IEwzNi4wNjgsOTIuNzYxIEMzNS4yMTgsOTMuMTYyIDM0LjE4NCw5My4wMjcgMzMuNDgsOTIuMzE4IEMzMi44NDYsOTEuNjggMzIuNjgzLDkwLjc3NiAzMi45NDUsODkuOTgxIEwzMi45MjgsODkuOTc3IEwzNS43MTQsODEuOTU1IEw0My44MzYsOTAuMDc2IHoiIGZpbGw9IiNGRjNEN0UiLz4KICAgICAgPHBhdGggZD0iTTkzLjc4NSw0Ny40NjIgQzk0LjY3OSw0OC4zNTMgOTQuNjc5LDQ5LjgxOCA5My43ODMsNTAuNzEgTDYwLjA3Miw4NC40MTkgTDYwLjAzNiw4NC4zODQgTDYwLjA0OSw4NC40MzQgTDQ1Ljk5Myw4OS4yNzEgTDQxLjYzNSw4NC45MTMgTDU1LjM5Miw3OS43NCBMNDYuMDE1LDcwLjM2MyBMNDAuODM5LDg0LjExNyBMMzYuNTE2LDc5Ljc5NCBMNDEuMzMyLDY1Ljc3NyBMNDEuNDY2LDY1LjgxNCBMNDEuMzgyLDY1LjczIEw3NS4wOTEsMzIuMDI2IEM3NS45ODYsMzEuMTI2IDc3LjQ0OSwzMS4xMjYgNzguMzQzLDMyLjAyNiBMOTMuNzg1LDQ3LjQ2MiB6IE03Ni42NjEsMzcuOTM3IEw0OC4yNTYsNjYuMzQyIEw1MS43MTgsNjkuODAzIEw4MC4xMjIsNDEuMzk5IEw3Ni42NjEsMzcuOTM3IHoiIGZpbGw9IiM1NUEwRkYiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "inliner","actions": ["create","edit","view"]},{"type": "post","actions": ["edit","view"]}],"_opts": {"compileTo": ["js"],"runWidth": "1000","runMode": ["fullscreen"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Extendable content editor with HTML compiler","timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzZBQUNGRiIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00My44MzYsOTAuMDc2IEwzNi4wNzEsOTIuNzc4IEwzNi4wNjgsOTIuNzYxIEMzNS4yMTgsOTMuMTYyIDM0LjE4NCw5My4wMjcgMzMuNDgsOTIuMzE4IEMzMi44NDYsOTEuNjggMzIuNjgzLDkwLjc3NiAzMi45NDUsODkuOTgxIEwzMi45MjgsODkuOTc3IEwzNS43MTQsODEuOTU1IEw0My44MzYsOTAuMDc2IHoiIGZpbGw9IiNGRjNEN0UiLz4KICAgICAgPHBhdGggZD0iTTkzLjc4NSw0Ny40NjIgQzk0LjY3OSw0OC4zNTMgOTQuNjc5LDQ5LjgxOCA5My43ODMsNTAuNzEgTDYwLjA3Miw4NC40MTkgTDYwLjAzNiw4NC4zODQgTDYwLjA0OSw4NC40MzQgTDQ1Ljk5Myw4OS4yNzEgTDQxLjYzNSw4NC45MTMgTDU1LjM5Miw3OS43NCBMNDYuMDE1LDcwLjM2MyBMNDAuODM5LDg0LjExNyBMMzYuNTE2LDc5Ljc5NCBMNDEuMzMyLDY1Ljc3NyBMNDEuNDY2LDY1LjgxNCBMNDEuMzgyLDY1LjczIEw3NS4wOTEsMzIuMDI2IEM3NS45ODYsMzEuMTI2IDc3LjQ0OSwzMS4xMjYgNzguMzQzLDMyLjAyNiBMOTMuNzg1LDQ3LjQ2MiB6IE03Ni42NjEsMzcuOTM3IEw0OC4yNTYsNjYuMzQyIEw1MS43MTgsNjkuODAzIEw4MC4xMjIsNDEuMzk5IEw3Ni42NjEsMzcuOTM3IHoiIGZpbGw9IiM1NUEwRkYiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": "","nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","types": "","width": [1200,1400,[1024,1720]],"collapsed": [".T.embed",".T.html",".T.img"],"padding": "auto"},"log": [[1539995405454,"update","ermouth-524yb546",333,"dev-cloudwall2"]],"id": "cw.Inliner","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzZBQUNGRiIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00My44MzYsOTAuMDc2IEwzNi4wNzEsOTIuNzc4IEwzNi4wNjgsOTIuNzYxIEMzNS4yMTgsOTMuMTYyIDM0LjE4NCw5My4wMjcgMzMuNDgsOTIuMzE4IEMzMi44NDYsOTEuNjggMzIuNjgzLDkwLjc3NiAzMi45NDUsODkuOTgxIEwzMi45MjgsODkuOTc3IEwzNS43MTQsODEuOTU1IEw0My44MzYsOTAuMDc2IHoiIGZpbGw9IiNGRjNEN0UiLz4KICAgICAgPHBhdGggZD0iTTkzLjc4NSw0Ny40NjIgQzk0LjY3OSw0OC4zNTMgOTQuNjc5LDQ5LjgxOCA5My43ODMsNTAuNzEgTDYwLjA3Miw4NC40MTkgTDYwLjAzNiw4NC4zODQgTDYwLjA0OSw4NC40MzQgTDQ1Ljk5Myw4OS4yNzEgTDQxLjYzNSw4NC45MTMgTDU1LjM5Miw3OS43NCBMNDYuMDE1LDcwLjM2MyBMNDAuODM5LDg0LjExNyBMMzYuNTE2LDc5Ljc5NCBMNDEuMzMyLDY1Ljc3NyBMNDEuNDY2LDY1LjgxNCBMNDEuMzgyLDY1LjczIEw3NS4wOTEsMzIuMDI2IEM3NS45ODYsMzEuMTI2IDc3LjQ0OSwzMS4xMjYgNzguMzQzLDMyLjAyNiBMOTMuNzg1LDQ3LjQ2MiB6IE03Ni42NjEsMzcuOTM3IEw0OC4yNTYsNjYuMzQyIEw1MS43MTgsNjkuODAzIEw4MC4xMjIsNDEuMzk5IEw3Ni42NjEsMzcuOTM3IHoiIGZpbGw9IiM1NUEwRkYiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","stamp": 1539995405453,"creator": "ermouth-1ermouth"},{"_id": "cw-Inliner-Ed-Widgets-Cards-1ccd","_rev": "123-81184b562f70d433837b2c9b88da4c51","name": "Inliner.Ed.Widgets.Cards","title": "⊛ Inliner Cards","type": "manifest","desc": "General cards widget for Inliner","beta": false,"tags": ["Inliner"],"manifest": {"id": "cw.Inliner.Ed.Widgets.Cards","build": 111,"name": "Cards","params": {"restyle": 100},"meta": {},"M": {"normal": {"id": "in.Cards.Normal","inherit": ["RT","Tgt"],"data": {"title": "","photo": "","desc": "","list": [],"link": {"url": "","text": "","mode": [],"color": ""},"banner": {"text": "","color": ""},"bg": "","logo": "","scale": "100"},"init": ["<div id=\"vc-banner\" style=\"position:absolute\"></div>","<div id=\"vc-photo\" class=\"vc-photo-big\"></div>","<div id=\"vc-text\">","<h3 id=\"vc-title\"></h3>","<div id=\"vc-desc\"></div>","<ul id=\"vc-list\"></ul>","<div id=\"vc-link\"></div>","</div>"],"ui": {"#vc-banner": {"bind": "banner.text","css": {"hide": "function (d) { return !(d.banner.text)}"}},"#vc-photo": {"bind": "function (d,v,$o) {\n      var that = this;\n      if (!d.photo) return '';\n      $o.css({\n        'background-image':'url('+(that.RT().Url[d.photo]||d.photo)+')'\n      });\n\n      if (d.link.mode.indexOf('image') == -1) return '';\n\n      return '<a href=\"'+d.link.url+'\" ' + that.Tgt(d) + '> </a>';\n    }","css": {"hide": "function (d) { return !(d.photo+'')}"}},"#vc-desc": {"bind": "function (d,v) {\n      var that = this;\n      if (!d.list.length && that.RT().data.align == \"center\") return '<center>'+d.desc+'</center>';\n      return d.desc;\n    }","css": {"hide": "function (d) { return !(d.desc)}"}},"#vc-list": {"bind": "function (d) {\n      return (d.list || []).map(function(e){\n        return '<li>'+e+'</li>';\n      }).join('');\n    }","css": {"hide": "function (d) {return !(d.list || []).length}"}},"#vc-title": {"bind": "function (d) {\n      if (!d.link || !d.link.url || (d.link||[]).mode.indexOf('header') == -1) return d.title;\n      var that = this,\n          u = d.link.url,\n          t = d.title;\n      if (u.to(4)=='http') {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }\n      else {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }      \n\n    }","css": {"hide": "function (d) { return !(d.title)}"}},"#vc-link": {"bind": "function (d) {\n      var that = this,\n          u, t;\n      if (d.link && d.link.url && d.link.text) {\n        u = d.link.url;\n        t = d.link.text;\n        if (u.to(4)=='http') {\n          return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n        }\n        else {\n          return '<a href=\"'+u+'\">'+t+'</a>';\n        }\n      }\n    }","init": "function ($o) {\n      var d = this.data,\n          link = d.link,\n          m  = d.link.mode;\n      if (link) {\n        if (m.indexOf('link') != -1) $o.addClass('vc-link');\n        if (m.indexOf('button') != -1) $o.addClass('vc-button');\n      }\n    }","css": {"hide": "function (d) { return !(d.link && d.link.url && d.link.text)}"}}},"style": {"": "function () {\n\t\t\tvar scale = +this.data.scale || 100,\n          m = this.RT().meta,\n          bradius = this.RT().data.br || m.theme.corner.outer,\n          pradius = this.RT().data.pad=='0'?'0':m.theme.corner.inner,\n\t\t\t\t\tcss = {\n            '':'transform:scale('+scale/100+');border-radius:'+bradius+';',\n            ' #vc-photo':'border-radius:' + pradius + ';'\n          };\n\t\t\tif (scale >100 ) css[''] += 'z-index:'+(scale-100 | 0)+';'\n\t\t\treturn css;\n\t\t}"," #vc-text": {" ": "function () {\n\t\t\t\tvar d = this.RT().data,\n\t\t\t\t\t\titem = this.data,\n\t\t\t\t\t\talign = 'text-align:'+(item.align || d.align)+';',\n\t\t\t\t\t\tbcolor = (item.link?item.link.color:'')||d.border,\n            m = this.RT().meta,\n\t\t\t\t\t\tbradius = (item.link?item.link.corner:'') || m.theme.corner.outer;\n\t\t\t\treturn {\n\t\t\t\t\t'':'line-height: 1.4em;font-size: 1em;padding:'+d.text.pad+';display:block;',\n\t\t\t\t\t' #vc-title':'display:inline-block;vertical-align:top;width:100%;'+align,\n\t\t\t\t\t' #vc-link':{\n\t\t\t\t\t\t'':'margin:0.9em 0 0 0;font-size:1.1em;'+align,\n\t\t\t\t\t\t'.vc-button a':{\n\t\t\t\t\t\t\t'':'text-decoration:none!important; border:1px solid transparent!important;padding:0.2em 0.6em 0.4em 0.6em;'\n\t\t\t\t\t\t\t+' background-color:'+bcolor+';color:white!important;transition: color 0.3s, border 0.3s, background-color 0.3s;'\n\t\t\t\t\t\t\t+'border-radius:'+bradius+';line-height:1.2em;display:inline-block;min-width:130px;text-align:center;',\n\t\t\t\t\t\t\t':hover':'background:white;border:1px solid '+bcolor+'!important;color:'+bcolor+'!important;'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}"}," #vc-desc": "margin-top:1em; hyphens:auto;"," #vc-photo": {"": "background-size:cover;background-position:50% 30%;"," a": "position:absolute; width:100%; height:100%; top:0;left:0;border-bottom:none!important;"}}},"small": {"id": "in.Cards.Small","inherit": ["RT","Tgt"],"data": {"title": "","photo": "","desc": "","list": [],"link": {"url": "","text": "","mode": [],"color": ""},"banner": {"text": "","color": ""},"bg": "","logo": "","scale": "100"},"init": ["<div id=\"vc-banner\" style=\"position:absolute\"></div>","<div id=\"vc-photo\" class=\"dib vat\"></div>","<div id=\"vc-text\" class=\"dib vat\">","<div id=\"vc-title\"></div>","<div id=\"vc-desc\"></div>","<ul id=\"vc-list\"></ul>","<div id=\"vc-link\"></div>","</div>"],"ui": {"#vc-banner": {"bind": "banner.text","css": {"hide": "function (d) { return !(d.banner.text)}"}},"#vc-photo": {"bind": "function (d,v,$o) {\n      var that = this;\n      if (!d.photo) return '';\n      $o.css({\n        'background-image':'url('+(that.RT().Url[d.photo]||d.photo)+')'\n      });\n\n      if (d.link.mode.indexOf('image') == -1) return '';\n\n      return '<a href=\"'+d.link.url+'\" ' + that.Tgt(d) + '> </a>';\n    }","css": {"hide": "function (d) { return !(d.photo+'')}"}},"#vc-desc": {"bind": "function (d,v) {\n      var that = this;\n      if (!d.list.length && that.RT().data.align == \"center\") return '<center>'+d.desc+'</center>';\n      return d.desc;\n    }","css": {"hide": "function (d) { return !(d.desc)}"}},"#vc-list": {"bind": "function (d) {\n      return (d.list || []).map(function(e){\n        return '<li>'+e+'</li>';\n      }).join('');\n    }","css": {"hide": "function (d) {return !(d.list || []).length}"}},"#vc-title": {"bind": "function (d) {\n      if (!d.link || !d.link.url || (d.link||[]).mode.indexOf('header') == -1) return d.title;\n      var that = this,\n          u = d.link.url,\n          t = d.title;\n      if (u.to(4)=='http') {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }\n      else {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }      \n\n    }","css": {"hide": "function (d) { return !(d.title)}"}},"#vc-link": {"bind": "function (d) {\n      var that = this,\n          u, t;\n      if (d.link && d.link.url && d.link.text) {\n        u = d.link.url;\n        t = d.link.text;\n        if (u.to(4)=='http') {\n          return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n        }\n        else {\n          return '<a href=\"'+u+'\">'+t+'</a>';\n        }\n      }\n    }","init": "function ($o) {\n      var d = this.data,\n          link = d.link,\n          m  = d.link.mode;\n      if (link) {\n        if (m.indexOf('link') != -1) $o.addClass('vc-link');\n        if (m.indexOf('button') != -1) $o.addClass('vc-button');\n      }\n    }","css": {"hide": "function (d) { return !(d.link && d.link.url && d.link.text)}"}}},"style": {"": "function () {\n\t\t\tvar scale = +this.data.scale || 100,\n          bradius = this.RT().data.br || this.RT().meta.theme.corner.outer,\n\t\t\t\t\tcss = {\n            '':'transform:scale('+scale/100+');border-radius:'+bradius+';'\n          };\n\t\t\tif (scale >100 ) css[''] += 'z-index:'+(scale-100 | 0)+';'\n\t\t\treturn css;\n\t\t}"," ": "function () {\n      var d = this.RT().data,\n          item = this.data,\n          align = 'text-align:'+(item.align || d.align)+';',\n          bcolor = (item.link?item.link.color:'')||d.border,\n          bradius = (item.link?item.link.corner:'')||this.RT().meta.theme.corner.outer,\n          ratio\t=\td.ratio || '40:30',\n          aratio = ratio.split(/\\D+/);\n      return {\n        '#vc-text':{\n          '':'line-height: 1.4em;font-size: 1em;width:calc(100% - {1}px);padding:{2};'.assign(aratio[0],d.text.pad),\n          ' #vc-title':'display:inline-block;vertical-align:top;hyphens:auto;width:100%;'+align,\n          ' #vc-link':{\n            '':'margin:1em 0 0 0;font-size:1.1em;'+align,\n            '.vc-button a':{\n              '':'text-decoration:none!important; border:1px solid transparent!important;padding:0.2em 0.6em 0.4em 0.6em;'\n              +' background-color:'+bcolor+';color:white!important;transition: color 0.3s, border 0.3s, background-color 0.3s;'\n              +'border-radius:'+bradius+';line-height:1.2em;display:inline-block;min-width:130px;text-align:center;',\n              ':hover':'background:white;border:1px solid '+bcolor+'!important;color:'+bcolor+'!important;'\n            }\n          }\n        },\n        '#vc-photo':'width:{1}px;height:{2}px;'.assign(aratio[0],aratio[1])\n      };\n    }"," #vc-desc": "margin-top:0.6em; hyphens:auto;"," #vc-photo": {"": "background-size:cover;background-position:50% 30%;"," a": "position:absolute; width:100%; height:100%; top:0;left:0;border-bottom:none!important;"}}},"icon": {"id": "in.Cards.Icon","inherit": ["RT","Tgt"],"data": {"title": "","photo": "","desc": "","list": [],"link": {"url": "","text": "","mode": [],"color": ""},"banner": {"text": "","color": ""},"bg": "","logo": "","scale": "100"},"init": ["<div id=\"vc-banner\" style=\"position:absolute\"></div>","<div>","<div id=\"vc-photo\" class=\"dib vat\"></div>","</div>","<div id=\"vc-text\" class=\"dib vat\">","<div id=\"vc-title\"></div>","<div id=\"vc-desc\"></div>","<ul id=\"vc-list\"></ul>","<div id=\"vc-link\"></div>","</div>"],"ui": {"#vc-banner": {"bind": "banner.text","css": {"hide": "function (d) { return !(d.banner.text)}"}},"#vc-photo": {"bind": "function (d,v,$o) {\n      var that = this;\n      if (!d.photo) return '';\n      $o.css({\n        'background-image':'url('+(that.RT().Url[d.photo]||d.photo)+')'\n      });\n\n      if (d.link.mode.indexOf('image') == -1) return '';\n\n      return '<a href=\"'+d.link.url+'\" ' + that.Tgt(d) + '> </a>';\n    }","css": {"hide": "function (d) { return !(d.photo+'')}"}},"#vc-desc": {"bind": "function (d,v) {\n      var that = this;\n      if (!d.list.length && that.RT().data.align == \"center\") return '<center>'+d.desc+'</center>';\n      return d.desc;\n    }","css": {"hide": "function (d) { return !(d.desc)}"}},"#vc-list": {"bind": "function (d) {\n      return (d.list || []).map(function(e){\n        return '<li>'+e+'</li>';\n      }).join('');\n    }","css": {"hide": "function (d) {return !(d.list || []).length}"}},"#vc-title": {"bind": "function (d) {\n      if (!d.link || !d.link.url || (d.link||[]).mode.indexOf('header') == -1) return d.title;\n      var that = this,\n          u = d.link.url,\n          t = d.title;\n      if (u.to(4)=='http') {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }\n      else {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }      \n\n    }","css": {"hide": "function (d) { return !(d.title)}"}},"#vc-link": {"bind": "function (d) {\n      var that = this,\n          u, t;\n      if (d.link && d.link.url && d.link.text) {\n        u = d.link.url;\n        t = d.link.text;\n        if (u.to(4)=='http') {\n          return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n        }\n        else {\n          return '<a href=\"'+u+'\">'+t+'</a>';\n        }\n      }\n    }","init": "function ($o) {\n      var d = this.data,\n          link = d.link,\n          m  = d.link.mode;\n      if (link) {\n        if (m.indexOf('link') != -1) $o.addClass('vc-link');\n        if (m.indexOf('button') != -1) $o.addClass('vc-button');\n      }\n    }","css": {"hide": "function (d) { return !(d.link && d.link.url && d.link.text)}"}}},"style": {"": "function () {\n\t\t\tvar scale = +this.data.scale || 100,\n          bradius = this.RT().data.br || this.RT().meta.theme.corner.outer,\n\t\t\t\t\tcss = {\n            '':'transform:scale('+scale/100+');border-radius:'+bradius+';'\n          };\n\t\t\tif (scale >100 ) css[''] += 'z-index:'+(scale-100 | 0)+';'\n\t\t\treturn css;\n\t\t}"," ": "function () {\n      var d = this.RT().data,\n          item = this.data,\n          align = 'text-align:'+(item.align || d.align)+';',\n          bcolor = (item.link?item.link.color:'')||d.border,\n          bradius = (item.link?item.link.corner:'')||this.RT().meta.theme.corner.outer,\n          ratio\t=\td.ratio || '40:30',\n          aratio = ratio.split(/\\D+/);\n      return {\n        '#vc-text':{\n          '':'line-height: 1.4em;font-size: 1em;width:100%;padding:{1};'.assign(d.text.pad),\n          ' #vc-title':'display:inline-block;vertical-align:top;hyphens:auto;width:100%;'+align,\n          ' #vc-link':{\n            '':'margin:1em 0 0 0;font-size:1.1em;'+align,\n            '.vc-button a':{\n              '':'text-decoration:none!important; border:1px solid transparent!important;padding:0.2em 0.6em 0.4em 0.6em;'\n              +' background-color:'+bcolor+';color:white!important;transition: color 0.3s, border 0.3s, background-color 0.3s;'\n              +'border-radius:'+bradius+';line-height:1.2em;display:inline-block;min-width:130px;text-align:center;',\n              ':hover':'background:white;border:1px solid '+bcolor+'!important;color:'+bcolor+'!important;'\n            }\n          }\n        },\n        '#vc-photo':'width:{1}px;height:{2}px;'.assign(aratio[0],aratio[1])\n      };\n    }"," #vc-desc": "margin-top:0.6em; hyphens:auto;"," #vc-photo": {"": "background-size:cover;background-position:50% 30%;"," a": "position:absolute; width:100%; height:100%; top:0;left:0;border-bottom:none!important;"}}}},"RT": "function () {return this;}","Url": {},"Loaded": [],"data": {"type": "inliner-cards","mode": ["normal"],"title": "","layout": ["uniform"],"align": ["center"],"animate": "zoom","width": "250","gap": "10","bg": "#ffffff","br": "","border": "#efefef","pad": "0","ratio": "4:3","bullet": {"char": "—","color": "#bbb"},"text": {"pad": "20px"},"remote": {"query": "","limit": "30","trim": "1000","root": "","sort": "","transform": "title  =\nbg     =\nlogo   =\nphoto  =\ndesc   =\nlist   =\nlink.url    =\nlink.text   =\nlink.mode   =[\"link\",\"header\",\"image\"]\nlink.color  =\nscale=\"100\""},"items": []},"ObjURL": [],"HTML": ["<div class=\"in-w-btn-box\">","<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>","</div>","<div id=\"oltitle\"></div>","<div class=\"in-w-cards-frame\">","<div class=\"in-w-cards-box\">","<div id=\"vc-cards\" class=\"in-w-cards\"></div>","</div>","</div>","<div id=\"vc-empty\" class=\"w100p tac\">","Empty","</div>"],"die": "function () {\n  \tthis.ObjURL.forEach(function(e){URL.revokeObjectURL(e);})\n  }","Lang": {"en": {"APPTITLE": "Cards","EMPTY": "Set up list of cards using Settings button at right","LOADING": "Loading"},"ru": {"APPTITLE": "Карточки","EMPTY": "Настройте список карточек кнопкой справа","LOADING": "Загрузка"}},"init": "function ($o) {\n  var that = this,\n      d = that.data,\n      lang = 'en',\n      $p = $o.parent().parent();\n\n  // L10N\n\n  if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n  that.Lang = that.Lang[lang];\n\n  // HTML\n  $o.html(that.HTML.join(''));\n\n  // Make list\n  if (!d.remote.query) that.MakeList();\n  else that.Loading = true;\n\n  $o.then(function(){\n    if (d.remote.query) that.ReadCards();\n  }.debounce(1));\n\n  // Load attachments\n  if (that.Att) return that.GetAtts();\n\n}","ui": {"#oltitle": {"bind": "function (d) {\n\t\t\tvar tag = /^(large|normal)$/.test(d.mode+'')?'h2':'h3';\n\t\t\treturn d.title?'<'+tag+'>'+d.title+'</'+tag+'>':'';\n\t\t}","watch": "#vc-cards","css": {"hide": "function (d) {return !d.title;}"}},"#vc-cards": {"delay": 1,"bind": "this.List","merge": false,"check": true,"manifest": "function (elt) {\n\t\t\tvar m = this.data.mode+'';\n\t\t\treturn this.M[m] || this.M.normal;\n\t\t}","list": "<div class=\"wcard in-w-cards-item vc-cover\"></div>","css": {"in-w-spacearound": "function (d) {return (d.align+'').startsWith('center');}"}},"#vc-empty": {"delay": 50,"bind": "function () {\n\t\t\tvar that = this,\n\t\t\t\t\tctr = 0,\n\t\t\t\t\tl,\n\t\t\t\t\t$c;\n\t\t\tif (that.List.length) {\n\t\t\t\t$c = that.my.find('#vc-cards>.wcard');\n\t\t\t\tl = $c.size();\n\t\t\t\t(l+1).times(function(){\n\t\t\t\t\t$c.eq(ctr).removeClass('vc-cover');\n\t\t\t\t\t//if (ctr == l) that.Reheight.debounce(150)();\n\t\t\t\t\tctr+=1;\n\t\t\t\t}.lazy(l>20?15:30));\n\t\t\t}\n\t\t\treturn that.Loading\n        ?that.Lang.LOADING + '<br><div class=\"cw-busy dib vam w100 h4 br100\"></div>'\n      \t:that.Lang.EMPTY;\n\t\t}","css": {"hide": "function () {return !!this.List.length;}"},"watch": "#vc-cards"},"#btn-gopts": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif(v!=null) {\n\t\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\telse {\n\t\t\t\t\tvar root = $o.parents('#medium');\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\troot:root.size()?root:undefined,\n\t\t\t\t\t\tbound:0,\n\t\t\t\t\t\twidth:675,\n\t\t\t\t\t\tmanifest:$.extend(true, {}, that.Opts, {Att:that.Att}),\n\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\talign:'right:38px;top:-5px',\n\t\t\t\t\t\tscreen:'rgba(255,255,255,0.65)',\n\t\t\t\t\t\tcss:'p15',\n\t\t\t\t\t\tnose:'right',\n\t\t\t\t\t\tclose:false,\n\t\t\t\t\t\tfocus:false,\n\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\tesc:true\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t$.extend(d, Object.reject(res,'items'));\n            if (res.items.length > 1 || (res.items[0] && res.items[0].title && res.items[0].desc)) {\n\t\t\t\t\t\t\td.items = res.items;\n            } \n            else d.items = [];\n            if (d.remote.query) that.ReadCards().then(_fin);\n            else _fin();\n\t\t\t\t\t}.debounce(50));\n\t\t\t\t}\n        \n        // - - - - - \n        function _fin(){\n          that.MakeList();\n          that.GetAtts().then(function(){\n            that.my.recalc('#vc-cards');\n            that.my.root().my('restyle');\n            //that.Reheight.debounce(150)();\n          });\n        }\n\t\t\t}\n\t\t}","css": {"self:hide": "function () {return !!this._compiled}"}}},"style": {" #vc-empty": "opacity:0.7;padding: 10px 0;text-align:center;"," .in-w-cards": {"": "display:flex; flex-wrap: wrap; justify-content: flex-start;",".in-w-spacearound": "justify-content: center;"}," .in-w-cards-frame": "width:100%;overflow:hidden;"," .in-w-cards-item": "transition:height 0.1s;text-align:left;","": {" .wcard": "display:inline-block; vertical-align:top;overflow:hidden;"," ": "function ($o) {\n\t\t\tvar d = this.data,\n\t\t\t\t\tmeta = this.meta,\n\t\t\t\t\tw0 = $o.width() | 0,\n\t\t\t\t\twcard = (+d.width<w0?+d.width:w0),\n\t\t\t\t\tw = ((+d.gap+w0)/Math.round(w0/wcard-0.45)|0)-(d.gap|0),\n\t\t\t\t\tg1 = (d.gap/2|0)+'px ',\n\t\t\t\t\tg0 = 2*(d.gap/2|0)+'px ',\n\t\t\t\t\tg25 = (d.gap/2.5|0)+'px ',\n\t\t\t\t\talign = d.align+'',\n          al0 = align.split('-'),\n\t\t\t\t\tratio = d.ratio.split(/\\D/),\n\t\t\t\t\tfheight = w/ratio[0]*ratio[1]|0,\n\t\t\t\t\tanimate = {\n\t\t\t\t\t\tzoom:'transform:scale3d(0.3,0.3,1);',\n\t\t\t\t\t\tflip:'transform:scale3d(0.3,0.2,0.1) rotate3d(1, 0,0.1, 30deg) translateY(-150%)',\n\t\t\t\t\t\tdrop:'transform:scale3d(0.3,0.2,0.1) translateY(-150%)',\n\t\t\t\t\t\tfade:' '\n\t\t\t\t\t},\n\t\t\t\t\ttransStart;\n\n\t\t\tif (!meta._mobile) {\n\t\t\t\ttransStart = animate[d.animate] || '';\n\t\t\t\tif (transStart) transStart = 'opacity:0.05;'+transStart;\n\t\t\t}\n\t\t\t\n\t\t\treturn {\n\t\t\t\t' .in-w-cards-item':'border:1px solid '+d.border+';' +(d.bg?'background:'+d.bg+';':'white;'),\n\t\t\t\t\n\t\t\t\t' .in-w-cards-box':'width:'+(+d.gap+w0)+'px;margin:0 -'+g1+'-'+g1+'-'+g1+';',\n\t\t\t\t' .in-w-cards, #vc-empty ':'text-align:'+al0[0]+';',\n\t\t\t\t' .wcard':{\n\t\t\t\t\t'':'width:'+w+'px;margin:0 '+g1 + g0 + g1 +';padding:'+d.pad+';',\n\t\t\t\t\t' ':'opacity:1; transition:opacity 0.1s, transform 0.3s, transform-origin 0.1s;'\n\t\t\t\t\t\t+'transform-origin:50% '+fheight+'px 0;text-align:'+al0[al0.length-1]+';',\n\t\t\t\t\t'.vc-cover':transStart,\n\t\t\t\t\t' .vc-photo-big':'width:100%;height:'+fheight+'px;',\n\t\t\t\t\t' h4, h3':'margin:0!important;',\n\t\t\t\t\t' p':'margin:0em 0 0em 0!important;line-height:1.45em!important;',\n\t\t\t\t\t' li':'list-style-type:none;margin:0.4em 0!important;line-height:1.3em!important;',\n\t\t\t\t\t' ul':'padding-left:1.2em!important;',\n\t\t\t\t\t' li:before':'content:\"'+d.bullet.char+'\";margin-left:-1.2em;display:inline-block;width:1.2em; color:'+d.bullet.color+';'\n\t\t\t\t},\n\t\t\t\t' #oltitle':{\n\t\t\t\t\t'':'margin-bottom:'+meta.theme.pad.gap+';padding:0 0;',\n\t\t\t\t\t' h3':'text-align:'+al0[0]+';margin:0!important;',\n\t\t\t\t\t' h2':'text-align:'+al0[0]+';margin:0!important;'\n\t\t\t\t}\n\t\t\t};\n\t\t}"}," .in-w-btn-box": "width:100%;z-index:+10;"," #btn-gopts": "position: absolute; top: 5px; right:5px; font-size:17px;z-index:+3;border-radius:100px!important;padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;"," #btn-gopts:hover": "opacity:1;"},"To": {"data": "function (item,options) {\n\t\tvar that = this,\n\t\t\t\td = item,\n\t\t\t\th = '',\n\t\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\t\topts = Object.merge(\n\t\t\t\t\t{path:''}, \n\t\t\t\t\tObject.isObject(options)?options:{}\t\t\t\t\t\t\n\t\t\t\t);\n\t\tvar obj, s = item.data.replace(/^\\(|\\)$/g,'');\n\n\t\ttry {\n\t\t\tobj = JSON.parse(s);\n\t\t} catch(e){}\n\n\t\tif (!Object.isObject(obj)) return item.data;\n\n\t\tif (opts.path || opts.Urls) {\n\t\t\t\n\t\t\t// Fix global params\n\t\t\t\n\t\t\t// Fix items\n\t\t\tobj.items = obj.items.map(function(e){\n\n\t\t\t\t['logo','photo','bg'].forEach(function(key){\n\t\t\t\t\tvar s = e[key]+'';\n\t\t\t\t\tif (!s || s.to(1) == '#' || s.to(1)=='/' || /^http[s]?:/.test(s)) return;\n\t\t\t\t\te[key] = opts.Urls?opts.Urls[s]:(opts.path+s);\n\t\t\t\t});\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\n\t\treturn '('+JSON.stringify(obj)+')';\n\t}","files": "function (data) {\n\t\tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\t['logo','photo','bg'].forEach(function(key){\n\t\t\t\tvar s = e[key]+'';\n\t\t\t\tif (s.to(1) == '#' || s.to(1)=='/' || /^http[s]?:/.test(s+'')) return;\n\t\t\t\tlist[s] = true;\n\t\t\t});\n\t\t});\n\t\treturn list;\n\t}"},"MakeList": "function (items0) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\titems = items0 || (d.items.include(that.Loaded||[])),\n\t\t\titem = {\n\t\t\t\tbg:d.bg,\n\t\t\t\tpadding:d.gap,\n\t\t\t\tborder:d.border,\n\t\t\t\talign:d.align+'',\n\t\t\t\tscale:100,\n\t\t\t\tratio:'16:9',\n\t\t\t\tpadPreview:false\n\t\t\t};\n\tif (!items.length) {\n\t\tthat.List = []; \n\t\treturn;\n\t}\n\t\n\tthat.List = items.map(function(e){ return $.extend(true, {}, item, e); });\n\t\n}","GetAtts": "function () {\n\tvar that = this,\n\t\t\tpi = $.Deferred(),\n\t\t\td = that.data,\n\t\t\tpis = [],\n\t\t\tatts = that.Att(null);\n\n\t//Prepare session urls\n\tif (!Object.size(atts)) pi.resolve();\n\telse {\n\t\t\n\t\tObject.keys(that.To.files(d))\n\t\t.forEach(function(s){\n\t\t\tif (atts[s]) {\n\t\t\t\tvar u = that.Att(s, 'url');\n\t\t\t\tif (typeof u == 'string') that.Url[s] = u;\n\t\t\t\telse {\n\t\t\t\t\tu.then(function(res){ that.Url[s] = res; });\n\t\t\t\t\tpis.push(u);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!pis.length) pi.resolve();\n\t\telse {\n\t\t\t$.when.apply(null, pis).done(function(){ pi.resolve(); }.debounce(1));\n\t\t}\n\t}\n\n\treturn pi.promise();\n}","Translate": "function _transform(map,defaults0,src,dest) {\n\t\n  var maplines = map.lines().map(function(e){return e.trim()}).compact(true),\n      defaults = Object.isObject(defaults0)?defaults0:{},\n      _get = function(a,b){\n        var v = cw.lib.getref(a,b);\n        return v===undefined?cw.lib.getref(defaults||{},b):v\n      };\n  \n  var fm = maplines.map(function(l){\n  \tvar al = l.split('='),\n        dest = [al[0].trim().split('.')],\n        parts = al[1].trim().split('+').map(function(elt){\n          var e = elt.trim(),\n              l = e.length,\n              l0 = e[0],\n              l1 = e.last();\n        \tif (l == 1) return _get.fill(void 0, e+'');\n          if ((l0==l1&&l0=='\"') || (l0=='{'&&l1=='}') || (l0=='['&&l1==']')) {\n            var p;\n            try{p=JSON.parse(e)}catch(err){}\n            if (p!=null) return p;\n            return _get.fill(void 0, e+'')\n          }\n          return _get.fill(void 0, e+'');\n        });\n    \n    return function _patch(receiver, src){\n    \t//make value\n      var aval = parts.map(function(e){\n      \tif (typeof e == 'function') return e(src);\n        return e;\n      });\n      \n      var val = (function(){\n        if (!aval.length) return null;\n        if (aval.length == 1) return aval[0];\n        if (typeof aval[0] == 'string') return aval.join('');\n        if (Object.isObject(aval[0])) {\n          return aval.reduce(function(a,b){\n            if (Object.isObject(b)) Object.merge(a,b,true);\n            return a;\n          },{});\n        }\n        if (Object.isArray(aval[0])) {\n          return aval.reduce(function(a,b){\n            if (!Object.isObject(b)) a.concat(b);\n            return a;\n          },[]);\n        }\n      })();\n      \n      cw.lib.unmask(receiver, [val], dest);\n      return receiver;\n    }\n  });\n  \n  var trans = function(src, res0){\n    var res = res0 || {};\n  \tfm.forEach(function(e){e(res, src)});\n    return res;\n  };\n  \n  if (!src) return dest?trans.fill(void 0, dest):trans;\n  else return trans(src, dest || {});\n  \n}","ReadCards": "function (db0,silent) {\n\tvar that = this,\n      pi = $.Deferred(),\n      d = that.data,\n      r = d.remote,\n      qry = r.query,\n      tran = r.transform;\n  \n  var $p, db;\n    \n  // Prepare DB obj\n  if (that.DB) db = that.DB;\n  if (qry && !db) {\n\n\n    $p = that.my.root().parent().parent();\n\n    if ($p.hasClass('my-form')) db = $p.my('manifest').RT().db;\n    else if (typeof cw.root == 'string') {\n      db = {_adapter:'httpquery', query: that.HttpDB};\n      //prefix = cw.root;\n    }\n    that.DB = db;\n  }\n\n  var  isLocal = db._adapter != 'httpquery';\n\n  if (qry.startsWith('query://')) {\n  \tvar parts = qry.from(8).split(' ').compact(true);\n    var req = db.query(\n      parts[0], \n      Object.merge({limit:+r.limit}, parts[1]?JSON.parse(parts[1]):{})\n    );\n    \n    var _transform = that.Translate(tran, {});\n    \n    var store = req.then(function(res){\n      var rows = (r.root?res[r.root]:res) || [];\n      that.Loaded = rows.map(function(row){\n        var rt = _transform(row);\n\t\t\t\tif (!isLocal) {\n          if (\n            rt.photo && !/^http[s]?:\\//.test(rt.photo) \n            && rt.photo[0]!='/' && rt.photo.split('/').length>=2\n          ) {\n            rt.photo = cw.root + 'file/' + rt.photo;\n          }\n      \t}\n        rt.desc = _trunc(rt.desc || '', +r.trim || 1000);\n        return rt;\n      });\n     \n    })\n    .catch(function(e){\n    \tpi.reject(e)\n    });\n    \n    // Load pics if local DB\n    if (isLocal) {\n      \n      store = store.then(function(){\n        var pis = [];\n        that.Loaded.forEach(function(rt){\n          var a = rt.photo.split('/');\n          if (!rt.photo || /^http[s]?:\\//.test(rt.photo) \n            || rt.photo[0]=='/' ||  a.length < 2\n          ) return;\n          var att = db.getAttachment(a[0], a.slice(1).join('/'))\n          .then(function(blob){\n            that.Url[rt.photo] = URL.createObjectURL(blob);\n            that.ObjURL.push(that.Url[rt.photo]);\n          });\n          pis.push(att);\n        });\n\n        return Q.allSettled(pis);\n      });\n    }\n    \n    // Redraw\n    if (!silent) store = store.then(function(){\n      that.MakeList();\n      that.my.recalc('#vc-cards');\n      that.my.restyle();\n    });\n    \n    store.then(function(){pi.resolve()}, function(err){pi.reject(err)})\n    \n    //return store;\n  }\n  \n  else pi.resolve();\n  \n  pi.always(function(){that.Loading = false;})\n  \n  return pi.promise();\n  \n  // - - - - - - - - - - - \n  \n  function _trunc(s, len, tail) {\n    var t = tail||'...', \n        l = (+len || 1000)+t.length,\n        ctr = 0;\n    \n  \tif (s.length <= l) return s;\n    \n    return s.words()\n    .map(function(w, i){\n      ctr += w.length+1;\n      if (!i || ctr <= l) return w;\n      return null;\n    })\n    .compact(true).join(' ')\n    .replace(/[;:\\.,\\-–—\\?!#\\*\\+=]+$/,'')+t;\n  }\n  \n  \n}","HttpDB": "function (query,opts0) {\n  var that = this,\n      d = that.data,\n      q = query.split('/'),\n      opts = opts0 || {},\n      path = ['_query', _uri(q[0]), _uri(q[1])].join('/'),\n      qpath = [],\n      body;\n  \n  if (!opts.limit) opts.limit = +d.remote.limit;\n  if (!opts.reduce) opts.reduce = false;\n  \n  Object.each(opts, function(k, v0){\n    if (k=='keys') {\n    \tbody = _j(opts[k]);\n      return;\n    }\n  \tvar v = /^(start|end|key)/.test(k)?_j(v0):(v0+'');\n    qpath.push(_uri(k)+'='+_uri(v));\n  });\n  \n  if (qpath.length) path+='?'+qpath.join('&');\n  \n  var req = {\n  \turl:\t\t\t'/'+path,\n    method:\t\tbody?'POST':'GET',\n    datatype:\t'json',\n    headers:\t{\n      'Accept':\t\t\t\t'application/json',\n      'Content-Type':\t'application/json'\n    }\n  };\n  if(body) req.body = body;\n  \n  return that.my.ajax(req);\n  \n  \n  //- - - - - - - - - - - - - -\n  \n  function _j(a) {return JSON.stringify(a);}\n  function _uri(s) {return encodeURIComponent(s);}\n}","Tgt": "function (d) {\n  var link = d.link.url,\n      tgt = ' target=\"_blank\"';\n  \n  if (!link) return '';\n\n  if (\n    /^http[s]?:\\/\\//.test(link) \n    && link.split('/')[2] != window.location.host\n  ) return tgt;\n\n  return '';\n}","Ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABtxJREFUeNrkW2mIHEUUrtkcHpuVlFfUNYodNd4gLV54kDBt2BB/GNwWRAMRdPBC0I07aPCHiIygJMEY2IhoDv0xq2CERXTW44caDY6GVcF4tFHQKAqlu2pC1F2/N0dPVU/P9DHdc20N1dXdU11d73tHvap+lZiZmWGzOc2lQyKRiPUlI7ncIs6YzhhfyphAZv3IfbhGFnNwPoVzZPEbzveV8oRpGF/F2S9ifqJwiB6ARDaXuxblauTlIO78kO38BFDeRjlmCbErbZoH2xoAcPokcPoeEHwrLk+LGNRJ5JcByGZIxqdtBQAIX8wZT6Nzt4H4I93qcCDD6ceLF9zxvygdBP0E5XpvFGM4PAYgPmwpAJlsdr7G+RAoWo/Lo5z/a0SoxgtlmERAWJStWmiIHfhnXcowfmk6ANBxGDX2YtGwqZzWNC000fXAyFuWi2SI33G4D9KwvWkAZHMf34viSeT5NuHEcT16wquBYAAi7wbEC7h1N6Th79gAyGRyczWdP4fTNfJ9ncQcXG9mItXI5y0nCHsBwgBA+DlyAGDojoZGj+J0pSzuuq4zzlqXxvNWQT1kbADECqjEN5EBAOKPAPGv43SZbOB0XWPtkCzYhrxqKA8AlCtTprHfC4Aeb7HP9IDDOxXitfYhvtgfzdmfkznnb45kcyd4PesJgKbrGQj7jQrxWvsQL0tkUgXhLNx6bWRkZF5oADDUrQLxQ4rYtyHxFZvklEx+OdeIgSEAgN6fgga2kV9fMXjtS7zMJJJSKd0PRq4MDACM3gYUx5avk7reMVNcklKHO7KFRjHfAAAxA4VZIV5jnZZUhvHTgcd6vwBA5PlTsl5xzlknJtVe8QfA2H5PAFDpehQXdjL35RFL4h257et8SAB/WG6g05PqovPbweDjq5bEJO5fhOJSdxGqkbaOMo/JO8QoSY3ZlzSrq/bjw6XBwWRdV5xGBau83sAYGcJbkDe6AiBPcnzrvR9CHADR/F54gRZgmuzVV5ICAr1E2RoZgB6H8bu5m8S/Bi0XQ9LPrQIANy8gH1oWnfg8tgjbCvfO69xUYHlg8W9gjG62Y6VxqIGw1YBo3eQAgF/TDO7buttE7rsw9WoXCRDnlZuMm/7x8bxklBpLd9Ao4KPDjio8m82Ruh/oKS914d6SZqmAaFFbXL1YahtBTWeLUcxj3Z5Uxi6RVWBhAxbN2xFyOFR6YViKxsUOYq+oqtTVhTIAfaGHKOhgGPe0DdZV+mQ/oJfNvtQrA3BoFgJwSFaBqbAmWrCtnjaA80FF50Xd730B5/zhp+tTMgCTYYcoy0p56zyjCUtlbZI+ZlgR+QGBPr6qxE3aKgAP8QcU090u80JF4DsbgFTKIH34XhbRrgRAKOf7nJOhL5HPKFeM0xlMwncQVgTjIPfvBzhYelBYeUh9UpkLvI8WByoSEON0uKS7TeW+anR3p9Pp6eHhYUUC3rENGwCIc7Ia2ZIYJz8s6YtVqloXAq/U2aCVZ3swJyDLeEz5gbgmRZEtiQn//bTU971VtSKUThv/orlX5E52S1KJF/tNw/ioCoBS2l4DscaWJbhWb24e+6KIw+fYgWyHxzoDJCjA8evy2kC7fgoPNvSJguNVStO4cbZpGt/ShVuABJDhT3STGqgrTyJbJr6WCkD0rW2o+KN7A52n+5Imk9g/7qxTBUDaNA+jeES12B3KfWWoFS/B+H3mCQAlVHwexQcVKch3OvF/gIdDbvVqBUhAXMSdKA+XXeOovuU1S/Qdo9hDtWIHa0aIQAomQPqDSqMdYBRFVQCl2AVattSqXzdICg9uQgOvygbRamODIEprDdIdmuGurfdMj49G6WvqJ7JutSMI1CX64CLdoSDqVWBi3c76ihTNZnMnwuWi2eKZ9lJUC+KDfTo7dIfWNwwQ/1695wLFCsNDpB0gbwCEcyouLW95CE1BLRXbJP7E4QYQP+71bOBocUjCcZCEMZB+mbLAoWtND6QSBXWsCpv/Ff8MgHhf43ao/QLFqHG2GSCsVSc4xShN3hKuF9IeqMJNXgHSDQMgqQQZx2dA+gL5fjFSU4tlSa0G4eSzbBSWNZxKpf4J0l7De4agEqeC5RvkYGp5yktBCY2G2pT9D/cFFLEXh7sg8rvDtB3ZrjFIQxIkP4rTK2rV0UoBl/V3jRXnHd47xwrje2ZUiGdHTfO/sP2OfN8ggFhWjC4XK1DOiUH9ab/g08LK7wwq7k0BQDKUi3gh4kysLo0YDcQeiC/QxhhtkYOofx5lP+PcOivbiV7I+1U4vQR5aWn/cH9x3zBbUPRGxV+s+K2utHeYI4sJaMC7YfcE+gWAtXr3OG3JadW7bQmYzel/AQYAm20RvfUSk38AAAAASUVORK5CYII=","Opts": {"P": {},"Detail": [],"ui": {"#btn-gapply": "function (d,v) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\td.bg = d.bg +'';\n\t\t\t\td.items = d.items.map(function(e){if (e.photo) {e.photo=e.photo+'';} return e;}).compact();\n\t\t\t\tthis.my.commit();\n\t\t\t}\n\t\t}","#btn-gcancel": "function (d,v) {\n\t\t\tif (v!=null) this.my.cancel();\n\t\t}","#btn-gsettings": {"delay": 50,"bind": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tthat.my.find('#gleft .vc-active').removeClass('vc-active');\n\t\t\t\t\tthat.my.find('#x-gsettings').addClass('vc-active');\n\t\t\t\t\tthat.Detail[0] = d;\n\t\t\t\t}\n\t\t\t}","events": "click.my","recalc": "#gi"},"#btn-gremote": {"delay": 50,"bind": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tthat.my.find('#gleft .vc-active').removeClass('vc-active');\n          that.my.find('#x-gremote').addClass('vc-active');\n\t\t\t\t\tthat.Detail[0] = d.remote;\n\t\t\t\t}\n\t\t\t}","events": "click.my","recalc": "#gi"},"#btn-gadd": {"bind": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null)  {\n\t\t\t\t\td.items.push($.extend(true, {}, that.Item.data));\n\t\t\t\t}\n\t\t\t}","events": "click.my","recalc": "#master"},"#x-gadd": {"css": {"hide": "function (d) {\n\t\t\t\t\treturn d.items.length>30;\n\t\t\t\t}"},"watch": "#master"},"#btn-gdel": {"bind": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null)  {\n\t\t\t\t\td.items.remove(that.Detail[0]);\n\t\t\t\t\t(function(){\n\t\t\t\t\t\tthat.my.find('#master>div:eq(0)>#name').trigger('click');\n\t\t\t\t\t}.debounce(100))();\n\t\t\t\t}\n\t\t\t}","events": "click.my","recalc": "#master"},"#x-gdel": {"delay": 50,"css": {"hide": "function (d) {\n\t\t\t\t\treturn !!(d.items.length <2 || (this.Detail[0] && this.Detail[0].items));\n\t\t\t\t}"},"watch": "#master,#gi"},"#master": {"recalcDepth": 1,"bind": "items","list": "<div class=\"mitem\"><span id=\"name\" class=\"pseudolink tdn ml3\"></span></div>","init": "function ($o,form) {\n\t\t\tvar that = this;\n      $o.niceScroll();\n\t\t\t// Explicitly process click on left col‘s elt\n\t\t\t$o.on('switch.my', function (event, item){\n\t\t\t\tthat.my.find(\".vc-active\").removeClass(\"vc-active\");\n\t\t\t\tthat.Detail[0] = item;\n\t\t\t\tthat.my.recalc('#gi');\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.sortable();\n\t\t}","hash": ["title","desc","type"],"id": ["title","type","desc","photo","link"],"manifest": {"inherit": ["Lang"],"ui": {"#name": {"bind": "function (d,v) { \n\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\tif (null!=v) {\n\t\t\t\t\t\t\tthat.my.trigger(null, \"switch\", d);\n\t\t\t\t\t\t\tthat.my.root().addClass(\"vc-active\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar title = (d.title || d.desc).stripTags().compact()//.truncate(23,'middle','…') \n\t\t\t\t\t\t|| ('<span class=\"fi-alert red1\"></span> '+that.Lang.UNTITLED);\n\n\t\t\t\t\t\treturn '<nobr class=\"w100p oh\">'+title+'</nobr>';\n\t\t\t\t\t}","events": "click.my"}}},"watch": "#gi","events": "sortchange.my sortupdate.my"},"#gi": {"recalcDepth": 1,"delay": 50,"manifest": "function (e) {\n\t\t\tif (e.type == \"inliner-cards\") return $.extend(true,{}, this.Settings);\n      if (typeof e.query == 'string' && typeof e.transform == 'string')\treturn $.extend(true,{}, this.Remote);\n\t\t\treturn $.extend(true,{}, this.Item);\n\t\t}","bind": "this.Detail","list": "<div></div>"}},"style": {"": "font-size:15px;"," .vc-active": "background-color:#def;"," .mitem": "cursor:move;overflow:hidden;text-overflow:ellipsis;"},"die": "function ($o) {\n  \t// Unmount niceScroll\n\t\tvar f = $o.find('#master').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n  }","init": "function ($o) {\n\t\t\t\n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tlang = 'en';\n\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\t\t\t\n\t\t$o.formgen([\n\t\t\t\n\t\t\t'<div id=\"gleft\" class=\"dib vat w210 pr10 oh\" style=\"min-height:360px;border-right:1px solid #eee;\">',\n\t\t\t\t'<div class=\"blue mt2 fs95 w100p pl3 lh150 vc-active\" id=\"x-gsettings\">',\n\t\t\t\t\t'<span class=\"fi-widget o80 fs90\"></span> <span id=\"btn-gsettings\" class=\"pseudolink tdn\">'+L.SETTINGS+'</span>',\n\t\t\t\t'</div>',\n      \t'<div class=\"blue mt2 fs95 w100p pl3 lh150\" id=\"x-gremote\">',\n\t\t\t\t\t'<span class=\"fi-link o80 fs90\"></span> <span id=\"btn-gremote\" class=\"pseudolink tdn\">'+L.REMOTE+'</span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"master\" class=\"lh150 fs95\" style=\"max-height:250px\"></div>',\n\t\t\t\t'<div class=\"hoverlink gray mt2 fs90 dib vat\" id=\"x-gadd\">',\n\t\t\t\t\t'<span class=\"fi-plus o80 fs90\"></span> <span id=\"btn-gadd\" class=\"pseudolink\">'+L.ADD+'</span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div class=\"hoverlink gray mt2 fs90 dib vat pl10\" id=\"x-gdel\">',\n\t\t\t\t\t'<span class=\"fi-x o80 fs85\"></span> <span id=\"btn-gdel\" class=\"pseudolink\">'+L.DEL+'</span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"gbtns\" class=\"pt10\" style=\"position:absolute;left:0;bottom:0;\">',\n\t\t\t\t\t'<button id=\"btn-gapply\" class=\"green fs95 w100 mr5 pl0 pr0 mb0\">'+L.APPLY+'</button>',\n\t\t\t\t\t'<button id=\"btn-gcancel\" class=\"fs95 w95 pl0 pr0 mr0 mb0\">'+L.CLOSE+'</button>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div id=\"gi\" class=\"w450 dib vat ml15\" style=\"min-height:360px;\"></div>'\n\t\t\t\n\t\t]);\n\t\t\n\tif (!d.items.length) d.items[0] = {\n\t\t\"photo\": '',\t\"title\": \"\",\"desc\": \"\",\"list\": [],\n\t\t\"link\": {\"url\": \"\",\"text\": \"\",\"mode\": \"link\",\"color\": \"\"}\n\t};\n\n\tif (that.Att) that.P = that.Att(null);\n  \n  that.Detail[0] = d;\n\n\t/*$o.then(function(){\n\t\t$o.find('#master>div:eq(0)>#name').trigger('click');\n\t}.debounce(100))*/\n}","Lang": {"en": {"APPLY": "Apply","CLOSE": "Close","ADD": "Add","DEL": "Del","UNTITLED": "Untitled","SETTINGS": "Block settings","REMOTE": "Remote data"},"ru": {"APPLY": "Применить","CLOSE": "Закрыть","ADD": "Добавить","DEL": "Удалить","UNTITLED": "Без имени","SETTINGS": "Настройки блока","REMOTE": "Внешние данные"}},"Item": {"id": "in.Cards.Opts.Item","data": {"title": "","desc": "","photo": "","list": [],"scale": "100","link": {"mode": "link"}},"inherit": ["P","Att"],"init": "function ($o) {\n\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\n\t\t//[ ,'inp#gdesc.fs110',{plc: }],\n\n\t\tvar t = [\n\t\t\t{row:\"450px\", rowCss:\"my-row mb10 gray\", label:'100px', labelCss:'fs95 gray'},\n\t\t\t[L.TITLE,'inp#gtitle.fs110',{plc:L.TITLE_PLC}],\n\t\t\t[L.DESC ,'txt#gdesc.fs90.w100p',{plc: L.DESC_PLC}],\n\t\t\t[L.LIST ,'txt#glist.fs90.w100p',{plc: L.LIST_PLC}],\n\t\t\t[L.PHOTO ,'inp#gphoto.fs105',{plc: L.PHOTO_PLC}],\n\t\t\t[L.LINK, \n\t\t\t '<div class=\"dib vat w100p fs95 mb3\">','spn#glmode','</div>',\n\t\t\t '<div class=\"dib vat w100p fs95 mb4\">',\n\t\t\t \t'inp#gltext.w250.mr5',{plc:L.LINK_TEXT},\n\t\t\t \t'inp#glcolor.w95',{plc:L.LINK_COLOR},\n\t\t\t '</div>',\n\t\t\t '<div class=\"dib vat w100p fs95 mb4\">','inp#glurl',{plc:L.LINK_URL},'</div>',\n\t\t\t //'<div class=\"dib vat w100p fs95\">','inp#glcolor.w150',{plc:L.LINK_COLOR},'</div>'\n\t\t\t],\n\t\t\t[L.SCALE ,'num#gscale.fs90.w60',{plc: L.SCALE_PLC}, '&nbsp;%']\n\t\t];\n\n\t\t$o.formgen(t);\n\n\t}","ui": {"#gtitle": "title","#gdesc": {"delay": 0,"bind": "function (d,v,$o) {\n      \t$o.height(0).height(($o[0].scrollHeight-10).clamp(39,90));\n        if (v!=null) {\n          d.desc = v.trim();\n          return v;\n        }\n        return d.desc;\n      }"},"#glist": {"bind": "function (d,v,$o) {\n        $o.height(0).height(($o[0].scrollHeight-10).clamp(39,90));\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.list = v.split('\\n').compact(true);\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.list.join('\\n');\n\t\t\t}"},"#gphoto": {"bind": "photo","init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\tplaceholder:that.Lang.LINK_URL\n\t\t\t\t})\n\t\t\t}"},"#glmode": {"init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\t$o.tags(that.Lang.LINK_MODE)\n\t\t\t}","bind": "link.mode"},"#glurl": "link.url","#gltext": "link.text","#glcolor": "link.color","#gscale": "scale"},"style": {"\ttextarea": "resize:none;"},"Lang": {"en": {"APPLY": "Apply","CLOSE": "Close","PHOTO": "Image","PHOTO_PLC": "Select attach or paste URL","TITLE": "Title","TITLE_PLC": "Text, markup allowed","DESC": "Lead","DESC_PLC": "Text, markup allowed","LIST": "List","LIST_PLC": "Newline-seprated list","BANNER": "Banner","BANNER_TEXT": "Text, markup allowed","BANNER_COLOR": "#RRGGBB","LINK": "Show link as ","LINK_MODE": {"tags": [[{"Link": "link"},{"Button": "button"}],{"+ Header": "header"},{"+ Image": "image"}]},"LINK_URL": "Link URL","LINK_COLOR": "#RRGGBB","LINK_TEXT": "Text label","SCALE": "Card scale"},"ru": {"APPLY": "Применить","CLOSE": "Закрыть","PHOTO": "Картинка","PHOTO_PLC": "URL или выберите из списка...","TITLE": "Заголовок","TITLE_PLC": "Текст с разметкой","DESC": "Описание","DESC_PLC": "Текст с разметкой","LIST": "Опции","LIST_PLC": "Список через Enter","BANNER": "Баннер","BANNER_TEXT": "Текст с разметкой","BANNER_COLOR": "#RRGGBB","LINK": "Ссылка","LINK_MODE": {"tags": [[{"Ссылкой": "link"},{"Кнопкой": "button"}],{"+ Заголовок": "header"},{"+ Картинка": "image"}],"tagshim": "","groupshim": ""},"LINK_URL": "URL-адрес","LINK_COLOR": "#RRGGBB","LINK_TEXT": "Текст","SCALE": "Масштаб"}}},"Settings": {"data": {"align": ["left"]},"params": {"delay": 20},"init": "function ($o) {\n\t\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\t\t\n\t\t$o.formgen([\n\t\t\t'<div class=\"fs140 blue-1 mb7\">'+L.H1+'</div>',\n\t\t\t{row:\"450px\", rowCss:\"my-row mb7 gray\", label:'90px', labelCss:'fs95 gray'},\n\t\t\t[L.TITLE,'inp#gtitle.fs110',{plc:L.TITLE_PLC}],\n\t\t\t[L.MODE,'spn#gmode'],\n\t\t\t[L.ALIGN,'spn#sgalign'],\n\t\t\t[L.ANIMATE,'spn#ganimate'],\n\t\t\t[L.WIDTH, \n\t\t\t \t'num#gwidth.w70',{min:100, max:1000}, '<span class=\"fs95 dib w30\">&nbsp;px</span>',\n       \t'<span class=\"dib w90 ml40 fs95 pl10\">' + L.GAP + '</span>',\n\t\t\t\t'num#ggap.w70',{min:0, max:100},'<span class=\"fs95\"> px</span>'\n\t\t\t],\n\t\t\t[L.BORDER, \n      \t'inp#gborder.w130', {plc:L.BORDER_PLC},\n      \t'<span class=\"dib w90 ml10 fs95 pl10\">' + L.BG + '</span>',\n      \t'inp#gbg.w130', {plc:L.BG_PLC}\n      ],\n\t\t\t// [L.BG, 'inp#gbg.w120', {plc:L.BG_PLC}],\n\t\t\t[L.PAD, \n      \t'inp#gpad.w130', {plc:L.PAD_PLC},\n       \t'<span class=\"dib w90 ml10 fs95 pl10\">' + L.PAD0 + '</span>',\n      \t'inp#gtpad.w130', {plc:L.PAD0_PLC}\n      ],\n\t\t\t[L.RATIO, 'inp#gratio.w70', {plc:L.RATIO_PLC}, \n\t\t\t '<span class=\"pl10\">', 'val',{vals:['3:1','2:1','16:9','4:3','1:1']}, '</span>'\n\t\t\t]\n\t\t]);\n\t\t\n\t}","ui": {"#gtitle": "title","#gmode": {"bind": "mode","init": "function ($o) {\n\t\t\t\t$o.tags(this.Lang.MODE_TAGS)\n\t\t\t}"},"#sgalign": {"bind": "align","init": "function ($o) {\n\t\t\t\t$o.tags(this.Lang.ALIGN_TAGS)\n\t\t\t}"},"#ganimate": {"bind": "animate","init": "function ($o) {\n\t\t\t\t$o.tags(this.Lang.ANIMATE_TAGS)\n\t\t\t}"},"#gwidth": "width","#ggap": "gap","#gbg": "bg","#gborder": "border","#gratio": "ratio","#gpad": "pad","#gtpad": "text.pad"},"Lang": {"en": {"H1": "Cards block settings","TITLE": "Title","TITLE_PLC": "Text, markup allowed","MODE": "Render","MODE_TAGS": {"tags": [[{"Photo top": "normal"},{"Icon top": "icon"},{"Icon left": "small"}]]},"ALIGN": "Align","ALIGN_TAGS": {"tags": [[{"Center": "center"},{"Center-left": "center-left"}]],"empty": {"Left": "left"},"tagshim": ""},"ANIMATE": "Animate","ANIMATE_TAGS": {"tags": [[{"Zoom": "zoom"},{"Flip": "flip"},{"Drop": "drop"},{"Fade-in": "fade"}]],"empty": {"No": ""}},"WIDTH": "Width","WIDTH_AFT": " px, gap ","GAP": "Cards gap","BORDER": "Border","BORDER_PLC": "#RRGGBB","BG": "B-ground","BG_PLC": "#RRGGBB","RATIO": "Pic ratio","RATIO_PLC": "X:Y","BULLET": "Bullets","BULLET_MARKER": "Char","BULLET_COLOR": "#RRGGBB","PAD": "Card inset","PAD_PLC": "i.e. 20px","PAD0": "Text pad","PAD0_PLC": "i.e. 20px"},"ru": {"H1": "Настройки блока карточек","TITLE": "Заголовок","TITLE_PLC": "Текст с разметкой","MODE": "Показать","MODE_TAGS": {"tags": [[{"фото вверху": "normal"},{"Иконка вверху": "icon"},{"Иконка слева": "small"}]]},"ALIGN": "Ровнять","ALIGN_TAGS": {"tags": [[{"По центру": "center"},{"Центр-налево": "center-left"}]],"empty": {"Слева": "left"},"tagshim": ""},"ANIMATE": "Эффект","ANIMATE_TAGS": {"tags": [[{"Zoom": "zoom"},{"Flip": "flip"},{"Drop": "drop"},{"Fade-in": "fade"}]],"empty": {"Нет": ""}},"WIDTH": "Ширина","WIDTH_AFT": " px, просвет","GAP": "Просвет","BORDER": "Рамка","BORDER_PLC": "#RRGGBB","BG": "Фон","BG_PLC": "#RRGGBB","RATIO": "Аспект фото","RATIO_PLC": "X:Y","BULLET": "Список","BULLET_MARKER": "Буллет","BULLET_COLOR": "#RRGGBB","PAD": "Отступы","PAD_PLC": "напр. 20px","PAD0": "Text pad","PAD0_PLC": "напр. 20px"}}},"Remote": {"data": {"query": "","root": "","limit": "30","trim": "1000","transform": ""},"params": {"delay": 20},"init": "function ($o) {\n\t\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\t\t\n\t\t$o.formgen([\n\t\t\t'<div class=\"fs140 blue-1 mb7\">'+L.H1+'</div>',\n\t\t\t{row:\"450px\", rowCss:\"my-row mb7 gray\", label:'100px', labelCss:'fs95 gray'},\n\t\t\t[L.LBL_Q,\t\t'txt#gquery.fs100',{plc:L.PLC_Q},'msg'],\n      [L.LBL_ROOT,'inp#groot.fs100',{plc:L.PLC_ROOT},'msg'],\n      [L.LBL_BIND,'txt#gbind.fs80.code.pt6',{plc:L.PLC_BIND},'msg'],\n      [L.LBL_LIMIT, \n\t\t\t \t'num#glimit.w70',{min:1, max:100}, '<span class=\"fs95\">'+L.LBL_TRIM+'</span>',\n\t\t\t\t'num#gtrim.w70.ml5',{min:10, max:10000}, '<span class=\"fs95\">'+L.TXT_TRIM+'</span>'\n\t\t\t]\n\t\t]);\n\t\t\n\t}","ui": {"#gquery": {"delay": 0,"bind": "function (d,v,$o) {\n      \t$o.height(0).height(($o[0].scrollHeight-10).clamp(59,250));\n        if (v!=null) {\n          d.query = v.trim();\n          return v;\n        }\n        return d.query;\n      }"},"#gbind": {"delay": 0,"bind": "function (d,v,$o) {\n      \t$o.height(0).height(($o[0].scrollHeight-10).clamp(56,250));\n        if (v!=null) {\n          d.transform = v.trim();\n          return v;\n        }\n        return d.transform;\n      }"},"#groot": {"bind": "function (d,v) {\n      \tif (v!=null) {\n          d.root = v.compact();\n          return v;\n        }\n        return d.root;\n      }"},"#glimit": "function (d,v) {\n    \tif (v!=null) {\n      \tif (!v || isNaN(v)) d.limit = '30';\n        else d.limit = ''+(+v | 0).clamp(1,100);\n        return v;\n      }\n      return d.limit;\n    }","#gtrim": "function (d,v) {\n    \tif (v!=null) {\n      \tif (!v || isNaN(v)) d.trim = '1000';\n        else d.trim = ''+(+v | 0).clamp(10,10000);\n        return v;\n      }\n      return d.trim;\n    }"},"style": {"\ttextarea": "word-break:break-all!important;resize:none;"," textarea.code": "font-family:Cousine;"},"Lang": {"en": {"H1": "Remote query settings","LBL_Q": "Query","PLC_Q": "URL of JSON data source \nor query://ddoc/view {jsonParams}","ERR_Q_PREFIX": "Query must start with http://, https:// or query://","ERR_Q_HTTP": "Invalid query URL","ERR_Q_LOCAL": "Local query must be 'query://ddoc/view {params}'","ERR_Q_PARAMS": "Local query params should be valid json","LBL_LIMIT": "Max cards","LBL_TRIM": ", trim each to ","TXT_TRIM": " chars ","LBL_ROOT": "Data node","PLC_ROOT": "Cards array path in JSON, like 'all.rows'","LBL_BIND": "Transform","PLC_BIND": "Source data transform, multiline like \ntitle=value.title\nphoto=value.photo\ndesc=value.desc+&quot;!&quot;"},"ru": {"H1": "Внешний источник данных","LBL_Q": "Запрос","PLC_Q": "URL или источник JSON-данных \nили query://ddoc/view {jsonParams}","ERR_Q_PREFIX": "Запрос должен начинаться с http://, https:// or query://","ERR_Q_HTTP": "Неверный URL","ERR_Q_LOCAL": "Локальный запрос должен иметь вид 'query://ddoc/view {params}'","ERR_Q_PARAMS": "Невалидный JSON в параметрах локального запроса","LBL_LIMIT": "Карточек","LBL_TRIM": ", обрезать до ","TXT_TRIM": " знаков ","LBL_ROOT": "Узел данных","PLC_ROOT": "Пусть к массиву с данными, например 'all.rows'","LBL_BIND": "Трансформ","PLC_BIND": "Трансформ данных, например \ntitle=value.title\nphoto=value.photo\ndesc=value.desc+&quot;!&quot;"}}}}},"raw": {"name": "Inliner.Ed.Widgets.Cards","title": "⊛ Inliner Cards","version": "4.0","build": 111,"com": [{"stamp": "1464393202255","id": "Root","type": "js","data": "({\n\tid:\"in.Cards\",\n\tname:\"Cards\",\n\tparams:{restyle:100},\n\tmeta:{},\n\t\n\tM:{ /* Modes, see tab */ },\n\tRT:function(){return this;},\n\tUrl:{},\n  Loaded :[],\n  \n\t// Default data\n\tdata:{\n\t\ttype:\t\t\t'inliner-cards',\n\t\tmode:\t\t\t['normal'],\n\t\t\t\n\t\ttitle:''\t,\n\t\tlayout:\t\t['uniform'],\n\t\talign:\t\t['center'],\n\t\tanimate:\t'zoom',\n\t\t\t\n\t\twidth:\t\t'250',\n\t\tgap:\t\t\t'10',\n\t\tbg:\t\t\t\t'#ffffff',\n    br:\t\t\t\t'',\n\t\tborder:\t\t'#efefef',\n    pad:\t\t\t'0',\n\t\tratio:\t\t'4:3',\n\t\tbullet:\t\t{char:'—', color:'#bbb'},\n\t\ttext:\t\t\t{pad:'20px'},\n    \n    remote:{\n    \tquery:\t'',\n      limit:\t'30',\n      trim:\t\t'1000',\n      root:\t\t'',\n      sort:\t\t'',\n      transform:[\n        'title  =',\n        'bg     =',\n        'logo   =',\n        'photo  =',\n        'desc   =',\n        'list   =',\n        'link.url    =',\n        'link.text   =',\n        'link.mode   =[\"link\",\"header\",\"image\"]',\n        'link.color  =',\n        'scale=\"100\"'\n      ].join('\\n')\n    },\n    \n\t\titems:[]\n\t},\n  \n  ObjURL:[],\n\t\n\tHTML:[\n\t\t'<div class=\"in-w-btn-box\">',\n\t\t\t'<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>',\n\t\t'</div>',\n\t\t'<div id=\"oltitle\"></div>',\n\t\t'<div class=\"in-w-cards-frame\">',\n\t\t\t'<div class=\"in-w-cards-box\">',\n\t\t\t\t'<div id=\"vc-cards\" class=\"in-w-cards\"></div>',\n\t\t\t'</div>',\n\t\t'</div>',\n\t\t'<div id=\"vc-empty\" class=\"w100p tac\">',\n\t\t\t'Empty',\n\t\t'</div>'\n\t],\n  \n  die: function(){\n  \tthis.ObjURL.forEach(function(e){URL.revokeObjectURL(e);})\n  }\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1538534812559","id": ".data","type": "js","data": "({\n  align:\t\t['left'],\n  remote:{\n    query:\t'query://www/cards {\"startkey\":[\"path\",\"/api\"],\"endkey\":[\"path\",\"/api\",0]}',\n    limit:\t'30',\n    trim:\t\t'100',\n    root:\t\t'rows',\n    transform:[\n      'title  =value.title',\n      'photo  =value.photo',\n      'desc   =value.desc',\n      'link.url    =value.link.url',\n      'link.text   =value.link.text',\n      'link.mode   =[\"link\"]'\n    ].join('\\n')\n  },\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["green"]},{"stamp": "1464905694020","id": ".Lang","type": "js","data": "({\n\t'en':{\n\t\tAPPTITLE:'Cards',\n\t\tEMPTY:'Set up list of cards using Settings button at right',\n    LOADING:'Loading'\n\t},\n\t'ru':{\n\t\tAPPTITLE:'Карточки',\n\t\tEMPTY:'Настройте список карточек кнопкой справа',\n    LOADING:'Загрузка'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1538535070591","id": ".init","type": "js","data": "(function ($o) {\n  var that = this,\n      d = that.data,\n      lang = 'en',\n      $p = $o.parent().parent();\n\n  // L10N\n\n  if (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n  that.Lang = that.Lang[lang];\n\n  // HTML\n  $o.html(that.HTML.join(''));\n\n  // Make list\n  if (!d.remote.query) that.MakeList();\n  else that.Loading = true;\n\n  $o.then(function(){\n    if (d.remote.query) that.ReadCards();\n  }.debounce(1));\n\n  // Load attachments\n  if (that.Att) return that.GetAtts();\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1464397005970","id": ".ui","type": "js","data": "({\n\n\t'#oltitle':{\n\t\tbind:\tfunction(d){\n\t\t\tvar tag = /^(large|normal)$/.test(d.mode+'')?'h2':'h3';\n\t\t\treturn d.title?'<'+tag+'>'+d.title+'</'+tag+'>':'';\n\t\t},\n\t\twatch:'#vc-cards',\n\t\tcss:{\n\t\t\thide:function(d){return !d.title;}\n\t\t}\n\t},\n\t'#vc-cards':{\n\t\tdelay:1,\n\t\tbind:'this.List',\n\t\tmerge:false,\n\t\tcheck:true,\n\t\tmanifest:function(elt){\n\t\t\tvar m = this.data.mode+'';\n\t\t\treturn this.M[m] || this.M.normal;\n\t\t},\n\t\t//id:['id'],\n\t\t//hash:function(e){return cw.lib.sdbm(e)},\n\t\tlist:'<div class=\"wcard in-w-cards-item vc-cover\"></div>',\n    css:{\n    \t'in-w-spacearound':function(d){return (d.align+'').startsWith('center');}\n    }\n\t},\n\t'#vc-empty':{\n\t\tdelay:50,\n\t\tbind: function(){\n\t\t\tvar that = this,\n\t\t\t\t\tctr = 0,\n\t\t\t\t\tl,\n\t\t\t\t\t$c;\n\t\t\tif (that.List.length) {\n\t\t\t\t$c = that.my.find('#vc-cards>.wcard');\n\t\t\t\tl = $c.size();\n\t\t\t\t(l+1).times(function(){\n\t\t\t\t\t$c.eq(ctr).removeClass('vc-cover');\n\t\t\t\t\t//if (ctr == l) that.Reheight.debounce(150)();\n\t\t\t\t\tctr+=1;\n\t\t\t\t}.lazy(l>20?15:30));\n\t\t\t}\n\t\t\treturn that.Loading\n        ?that.Lang.LOADING + '<br><div class=\"cw-busy dib vam w100 h4 br100\"></div>'\n      \t:that.Lang.EMPTY;\n\t\t},\n\t\tcss:{\n\t\t\thide:function(){return !!this.List.length;}\n\t\t},\n\t\twatch:'#vc-cards'\n\t},\n\t\"#btn-gopts\":{\n\t\tbind: function(d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif(v!=null) {\n\t\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\telse {\n\t\t\t\t\tvar root = $o.parents('#medium');\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\troot:root.size()?root:undefined,\n\t\t\t\t\t\tbound:0,\n\t\t\t\t\t\twidth:675,\n\t\t\t\t\t\tmanifest:$.extend(true, {}, that.Opts, {Att:that.Att}),\n\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\talign:'right:38px;top:-5px',\n\t\t\t\t\t\tscreen:'rgba(255,255,255,0.65)',\n\t\t\t\t\t\tcss:'p15',\n\t\t\t\t\t\tnose:'right',\n\t\t\t\t\t\tclose:false,\n\t\t\t\t\t\tfocus:false,\n\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\tesc:true\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t$.extend(d, Object.reject(res,'items'));\n            if (res.items.length > 1 || (res.items[0] && res.items[0].title && res.items[0].desc)) {\n\t\t\t\t\t\t\td.items = res.items;\n            } \n            else d.items = [];\n            if (d.remote.query) that.ReadCards().then(_fin);\n            else _fin();\n\t\t\t\t\t}.debounce(50));\n\t\t\t\t}\n        \n        // - - - - - \n        function _fin(){\n          that.MakeList();\n          that.GetAtts().then(function(){\n            that.my.recalc('#vc-cards');\n            that.my.root().my('restyle');\n            //that.Reheight.debounce(150)();\n          });\n        }\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t'self:hide':function(){return !!this._compiled}\n\t\t}\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1464397672062","id": ".style","type": "js","data": "({\n\t\n\t' #vc-empty':'opacity:0.7;padding: 10px 0;text-align:center;',\n\t\n  ' .in-w-cards':{\n    '':\t'display:flex; flex-wrap: wrap; justify-content: flex-start;',\n    '.in-w-spacearound':'justify-content: center;'\n  },\n  \n\t' .in-w-cards-frame':'width:100%;overflow:hidden;', \n\n\t' .in-w-cards-item':'transition:height 0.1s;text-align:left;',\n\n\t'':{\n\t\t' .wcard':'display:inline-block; vertical-align:top;overflow:hidden;',\n\t\t' ': function($o){\n\t\t\tvar d = this.data,\n\t\t\t\t\tmeta = this.meta,\n\t\t\t\t\tw0 = $o.width() | 0,\n\t\t\t\t\twcard = (+d.width<w0?+d.width:w0),\n\t\t\t\t\tw = ((+d.gap+w0)/Math.round(w0/wcard-0.45)|0)-(d.gap|0),\n\t\t\t\t\tg1 = (d.gap/2|0)+'px ',\n\t\t\t\t\tg0 = 2*(d.gap/2|0)+'px ',\n\t\t\t\t\tg25 = (d.gap/2.5|0)+'px ',\n\t\t\t\t\talign = d.align+'',\n          al0 = align.split('-'),\n\t\t\t\t\tratio = d.ratio.split(/\\D/),\n\t\t\t\t\tfheight = w/ratio[0]*ratio[1]|0,\n\t\t\t\t\tanimate = {\n\t\t\t\t\t\tzoom:'transform:scale3d(0.3,0.3,1);',\n\t\t\t\t\t\tflip:'transform:scale3d(0.3,0.2,0.1) rotate3d(1, 0,0.1, 30deg) translateY(-150%)',\n\t\t\t\t\t\tdrop:'transform:scale3d(0.3,0.2,0.1) translateY(-150%)',\n\t\t\t\t\t\tfade:' '\n\t\t\t\t\t},\n\t\t\t\t\ttransStart;\n\n\t\t\tif (!meta._mobile) {\n\t\t\t\ttransStart = animate[d.animate] || '';\n\t\t\t\tif (transStart) transStart = 'opacity:0.05;'+transStart;\n\t\t\t}\n\t\t\t\n\t\t\treturn {\n\t\t\t\t' .in-w-cards-item':'border:1px solid '+d.border+';' +(d.bg?'background:'+d.bg+';':'white;'),\n\t\t\t\t\n\t\t\t\t' .in-w-cards-box':'width:'+(+d.gap+w0)+'px;margin:0 -'+g1+'-'+g1+'-'+g1+';',\n\t\t\t\t' .in-w-cards, #vc-empty ':'text-align:'+al0[0]+';',\n\t\t\t\t' .wcard':{\n\t\t\t\t\t'':'width:'+w+'px;margin:0 '+g1 + g0 + g1 +';padding:'+d.pad+';',\n\t\t\t\t\t' ':'opacity:1; transition:opacity 0.1s, transform 0.3s, transform-origin 0.1s;'\n\t\t\t\t\t\t+'transform-origin:50% '+fheight+'px 0;text-align:'+al0[al0.length-1]+';',\n\t\t\t\t\t'.vc-cover':transStart,\n\t\t\t\t\t' .vc-photo-big':'width:100%;height:'+fheight+'px;',\n\t\t\t\t\t' h4, h3':'margin:0!important;',\n\t\t\t\t\t' p':'margin:0em 0 0em 0!important;line-height:1.45em!important;',\n\t\t\t\t\t' li':'list-style-type:none;margin:0.4em 0!important;line-height:1.3em!important;',\n\t\t\t\t\t' ul':'padding-left:1.2em!important;',\n\t\t\t\t\t' li:before':'content:\"'+d.bullet.char+'\";margin-left:-1.2em;display:inline-block;width:1.2em; color:'+d.bullet.color+';'\n\t\t\t\t},\n\t\t\t\t' #oltitle':{\n\t\t\t\t\t'':'margin-bottom:'+meta.theme.pad.gap+';padding:0 0;',\n\t\t\t\t\t' h3':'text-align:'+al0[0]+';margin:0!important;',\n\t\t\t\t\t' h2':'text-align:'+al0[0]+';margin:0!important;'\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\t\n\t// Opts button\n\t' .in-w-btn-box':'width:100%;z-index:+10;',\n\n\t' #btn-gopts':'position: absolute; top: 5px; right:5px; font-size:17px;z-index:+3;border-radius:100px!important;'\n\t\t\t+'padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;',\n\n\t' #btn-gopts:hover':'opacity:1;',\n})","active": true,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1464395923419","id": ".To","type": "js","data": "({\n\tdata:function(item, options){\n\t\tvar that = this,\n\t\t\t\td = item,\n\t\t\t\th = '',\n\t\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\t\topts = Object.merge(\n\t\t\t\t\t{path:''}, \n\t\t\t\t\tObject.isObject(options)?options:{}\t\t\t\t\t\t\n\t\t\t\t);\n\t\tvar obj, s = item.data.replace(/^\\(|\\)$/g,'');\n\n\t\ttry {\n\t\t\tobj = JSON.parse(s);\n\t\t} catch(e){}\n\n\t\tif (!Object.isObject(obj)) return item.data;\n\n\t\tif (opts.path || opts.Urls) {\n\t\t\t\n\t\t\t// Fix global params\n\t\t\t\n\t\t\t// Fix items\n\t\t\tobj.items = obj.items.map(function(e){\n\n\t\t\t\t['logo','photo','bg'].forEach(function(key){\n\t\t\t\t\tvar s = e[key]+'';\n\t\t\t\t\tif (!s || s.to(1) == '#' || s.to(1)=='/' || /^http[s]?:/.test(s)) return;\n\t\t\t\t\te[key] = opts.Urls?opts.Urls[s]:(opts.path+s);\n\t\t\t\t});\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\n\t\treturn '('+JSON.stringify(obj)+')';\n\t},\n\tfiles: function(data){\n\t\tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\t['logo','photo','bg'].forEach(function(key){\n\t\t\t\tvar s = e[key]+'';\n\t\t\t\tif (s.to(1) == '#' || s.to(1)=='/' || /^http[s]?:/.test(s+'')) return;\n\t\t\t\tlist[s] = true;\n\t\t\t});\n\t\t});\n\t\treturn list;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1464397811279","id": ".MakeList","type": "js","data": "(function (items0) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\titems = items0 || (d.items.include(that.Loaded||[])),\n\t\t\titem = {\n\t\t\t\tbg:d.bg,\n\t\t\t\tpadding:d.gap,\n\t\t\t\tborder:d.border,\n\t\t\t\talign:d.align+'',\n\t\t\t\tscale:100,\n\t\t\t\tratio:'16:9',\n\t\t\t\tpadPreview:false\n\t\t\t};\n\tif (!items.length) {\n\t\tthat.List = []; \n\t\treturn;\n\t}\n\t\n\tthat.List = items.map(function(e){ return $.extend(true, {}, item, e); });\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1464398223066","id": ".GetAtts","type": "js","data": "(function(){\n\tvar that = this,\n\t\t\tpi = $.Deferred(),\n\t\t\td = that.data,\n\t\t\tpis = [],\n\t\t\tatts = that.Att(null);\n\n\t//Prepare session urls\n\tif (!Object.size(atts)) pi.resolve();\n\telse {\n\t\t\n\t\tObject.keys(that.To.files(d))\n\t\t.forEach(function(s){\n\t\t\tif (atts[s]) {\n\t\t\t\tvar u = that.Att(s, 'url');\n\t\t\t\tif (typeof u == 'string') that.Url[s] = u;\n\t\t\t\telse {\n\t\t\t\t\tu.then(function(res){ that.Url[s] = res; });\n\t\t\t\t\tpis.push(u);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!pis.length) pi.resolve();\n\t\telse {\n\t\t\t$.when.apply(null, pis).done(function(){ pi.resolve(); }.debounce(1));\n\t\t}\n\t}\n\n\treturn pi.promise();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1538530111278","id": ".Translate","type": "js","data": "(function _transform(map, defaults0, src, dest){\n\t\n  var maplines = map.lines().map(function(e){return e.trim()}).compact(true),\n      defaults = Object.isObject(defaults0)?defaults0:{},\n      _get = function(a,b){\n        var v = cw.lib.getref(a,b);\n        return v===undefined?cw.lib.getref(defaults||{},b):v\n      };\n  \n  var fm = maplines.map(function(l){\n  \tvar al = l.split('='),\n        dest = [al[0].trim().split('.')],\n        parts = al[1].trim().split('+').map(function(elt){\n          var e = elt.trim(),\n              l = e.length,\n              l0 = e[0],\n              l1 = e.last();\n        \tif (l == 1) return _get.fill(void 0, e+'');\n          if ((l0==l1&&l0=='\"') || (l0=='{'&&l1=='}') || (l0=='['&&l1==']')) {\n            var p;\n            try{p=JSON.parse(e)}catch(err){}\n            if (p!=null) return p;\n            return _get.fill(void 0, e+'')\n          }\n          return _get.fill(void 0, e+'');\n        });\n    \n    return function _patch(receiver, src){\n    \t//make value\n      var aval = parts.map(function(e){\n      \tif (typeof e == 'function') return e(src);\n        return e;\n      });\n      \n      var val = (function(){\n        if (!aval.length) return null;\n        if (aval.length == 1) return aval[0];\n        if (typeof aval[0] == 'string') return aval.join('');\n        if (Object.isObject(aval[0])) {\n          return aval.reduce(function(a,b){\n            if (Object.isObject(b)) Object.merge(a,b,true);\n            return a;\n          },{});\n        }\n        if (Object.isArray(aval[0])) {\n          return aval.reduce(function(a,b){\n            if (!Object.isObject(b)) a.concat(b);\n            return a;\n          },[]);\n        }\n      })();\n      \n      cw.lib.unmask(receiver, [val], dest);\n      return receiver;\n    }\n  });\n  \n  var trans = function(src, res0){\n    var res = res0 || {};\n  \tfm.forEach(function(e){e(res, src)});\n    return res;\n  };\n  \n  if (!src) return dest?trans.fill(void 0, dest):trans;\n  else return trans(src, dest || {});\n  \n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1538533866370","id": ".ReadCards","type": "js","data": "(function(db0, silent){\n\tvar that = this,\n      pi = $.Deferred(),\n      d = that.data,\n      r = d.remote,\n      qry = r.query,\n      tran = r.transform;\n  \n  var $p, db;\n    \n  // Prepare DB obj\n  if (that.DB) db = that.DB;\n  if (qry && !db) {\n\n\n    $p = that.my.root().parent().parent();\n\n    if ($p.hasClass('my-form')) db = $p.my('manifest').RT().db;\n    else if (typeof cw.root == 'string') {\n      db = {_adapter:'httpquery', query: that.HttpDB};\n      //prefix = cw.root;\n    }\n    that.DB = db;\n  }\n\n  var  isLocal = db._adapter != 'httpquery';\n\n  if (qry.startsWith('query://')) {\n  \tvar parts = qry.from(8).split(' ').compact(true);\n    var req = db.query(\n      parts[0], \n      Object.merge({limit:+r.limit}, parts[1]?JSON.parse(parts[1]):{})\n    );\n    \n    var _transform = that.Translate(tran, {});\n    \n    var store = req.then(function(res){\n      var rows = (r.root?res[r.root]:res) || [];\n      that.Loaded = rows.map(function(row){\n        var rt = _transform(row);\n\t\t\t\tif (!isLocal) {\n          if (\n            rt.photo && !/^http[s]?:\\//.test(rt.photo) \n            && rt.photo[0]!='/' && rt.photo.split('/').length>=2\n          ) {\n            rt.photo = cw.root + 'file/' + rt.photo;\n          }\n      \t}\n        rt.desc = _trunc(rt.desc || '', +r.trim || 1000);\n        return rt;\n      });\n     \n    })\n    .catch(function(e){\n    \tpi.reject(e)\n    });\n    \n    // Load pics if local DB\n    if (isLocal) {\n      \n      store = store.then(function(){\n        var pis = [];\n        that.Loaded.forEach(function(rt){\n          var a = rt.photo.split('/');\n          if (!rt.photo || /^http[s]?:\\//.test(rt.photo) \n            || rt.photo[0]=='/' ||  a.length < 2\n          ) return;\n          var att = db.getAttachment(a[0], a.slice(1).join('/'))\n          .then(function(blob){\n            that.Url[rt.photo] = URL.createObjectURL(blob);\n            that.ObjURL.push(that.Url[rt.photo]);\n          });\n          pis.push(att);\n        });\n\n        return Q.allSettled(pis);\n      });\n    }\n    \n    // Redraw\n    if (!silent) store = store.then(function(){\n      that.MakeList();\n      that.my.recalc('#vc-cards');\n      that.my.restyle();\n    });\n    \n    store.then(function(){pi.resolve()}, function(err){pi.reject(err)})\n    \n    //return store;\n  }\n  \n  else pi.resolve();\n  \n  pi.always(function(){that.Loading = false;})\n  \n  return pi.promise();\n  \n  // - - - - - - - - - - - \n  \n  function _trunc(s, len, tail) {\n    var t = tail||'...', \n        l = (+len || 1000)+t.length,\n        ctr = 0;\n    \n  \tif (s.length <= l) return s;\n    \n    return s.words()\n    .map(function(w, i){\n      ctr += w.length+1;\n      if (!i || ctr <= l) return w;\n      return null;\n    })\n    .compact(true).join(' ')\n    .replace(/[;:\\.,\\-–—\\?!#\\*\\+=]+$/,'')+t;\n  }\n  \n  \n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1538594983417","id": ".HttpDB","type": "js","data": "(function(query, opts0){\n  var that = this,\n      d = that.data,\n      q = query.split('/'),\n      opts = opts0 || {},\n      path = ['_query', _uri(q[0]), _uri(q[1])].join('/'),\n      qpath = [],\n      body;\n  \n  if (!opts.limit) opts.limit = +d.remote.limit;\n  if (!opts.reduce) opts.reduce = false;\n  \n  Object.each(opts, function(k, v0){\n    if (k=='keys') {\n    \tbody = _j(opts[k]);\n      return;\n    }\n  \tvar v = /^(start|end|key)/.test(k)?_j(v0):(v0+'');\n    qpath.push(_uri(k)+'='+_uri(v));\n  });\n  \n  if (qpath.length) path+='?'+qpath.join('&');\n  \n  var req = {\n  \turl:\t\t\t'/'+path,\n    method:\t\tbody?'POST':'GET',\n    datatype:\t'json',\n    headers:\t{\n      'Accept':\t\t\t\t'application/json',\n      'Content-Type':\t'application/json'\n    }\n  };\n  if(body) req.body = body;\n  \n  return that.my.ajax(req);\n  \n  \n  //- - - - - - - - - - - - - -\n  \n  function _j(a) {return JSON.stringify(a);}\n  function _uri(s) {return encodeURIComponent(s);}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1464395850360","id": ".Reheight","type": "js","data": "// No more needed\n(function(){\n  \n  return;\n  \n\t/*var that = this;\n\t// Realign heights\n\t\n\tif (that.List.length) {\n\t\tvar $c = that.my.find('#vc-cards>div'),\n\t\t\t\th = 0,\n\t\t\t\ths = {},\n\t\t\t\trows = [];\n\t\t$c.each(function(i,e){\n\t\t\tvar hc = $(e).outerHeight(),\n\t\t\t\t\ttc = $(e).offset().top;\n\t\t\tif (!hs[tc|0] || hs[tc|0]<hc) hs[tc|0] = hc;\n\t\t\trows[i] = tc | 0;\n\t\t});\n\t\t$c.each(function(i,e){\n\t\t\t$(e).css({height:hs[rows[i]]+'px'});\n\t\t});\n\t}*/\n\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["violet"]},{"stamp": "1539577434696","id": ".Tgt","type": "js","data": "(function(d){\n  var link = d.link.url,\n      tgt = ' target=\"_blank\"';\n  \n  if (!link) return '';\n\n  if (\n    /^http[s]?:\\/\\//.test(link) \n    && link.split('/')[2] != window.location.host\n  ) return tgt;\n\n  return '';\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1465148666844","id": ".Ico","type": "text","data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABtxJREFUeNrkW2mIHEUUrtkcHpuVlFfUNYodNd4gLV54kDBt2BB/GNwWRAMRdPBC0I07aPCHiIygJMEY2IhoDv0xq2CERXTW44caDY6GVcF4tFHQKAqlu2pC1F2/N0dPVU/P9DHdc20N1dXdU11d73tHvap+lZiZmWGzOc2lQyKRiPUlI7ncIs6YzhhfyphAZv3IfbhGFnNwPoVzZPEbzveV8oRpGF/F2S9ifqJwiB6ARDaXuxblauTlIO78kO38BFDeRjlmCbErbZoH2xoAcPokcPoeEHwrLk+LGNRJ5JcByGZIxqdtBQAIX8wZT6Nzt4H4I93qcCDD6ceLF9zxvygdBP0E5XpvFGM4PAYgPmwpAJlsdr7G+RAoWo/Lo5z/a0SoxgtlmERAWJStWmiIHfhnXcowfmk6ANBxGDX2YtGwqZzWNC000fXAyFuWi2SI33G4D9KwvWkAZHMf34viSeT5NuHEcT16wquBYAAi7wbEC7h1N6Th79gAyGRyczWdP4fTNfJ9ncQcXG9mItXI5y0nCHsBwgBA+DlyAGDojoZGj+J0pSzuuq4zzlqXxvNWQT1kbADECqjEN5EBAOKPAPGv43SZbOB0XWPtkCzYhrxqKA8AlCtTprHfC4Aeb7HP9IDDOxXitfYhvtgfzdmfkznnb45kcyd4PesJgKbrGQj7jQrxWvsQL0tkUgXhLNx6bWRkZF5oADDUrQLxQ4rYtyHxFZvklEx+OdeIgSEAgN6fgga2kV9fMXjtS7zMJJJSKd0PRq4MDACM3gYUx5avk7reMVNcklKHO7KFRjHfAAAxA4VZIV5jnZZUhvHTgcd6vwBA5PlTsl5xzlknJtVe8QfA2H5PAFDpehQXdjL35RFL4h257et8SAB/WG6g05PqovPbweDjq5bEJO5fhOJSdxGqkbaOMo/JO8QoSY3ZlzSrq/bjw6XBwWRdV5xGBau83sAYGcJbkDe6AiBPcnzrvR9CHADR/F54gRZgmuzVV5ICAr1E2RoZgB6H8bu5m8S/Bi0XQ9LPrQIANy8gH1oWnfg8tgjbCvfO69xUYHlg8W9gjG62Y6VxqIGw1YBo3eQAgF/TDO7buttE7rsw9WoXCRDnlZuMm/7x8bxklBpLd9Ao4KPDjio8m82Ruh/oKS914d6SZqmAaFFbXL1YahtBTWeLUcxj3Z5Uxi6RVWBhAxbN2xFyOFR6YViKxsUOYq+oqtTVhTIAfaGHKOhgGPe0DdZV+mQ/oJfNvtQrA3BoFgJwSFaBqbAmWrCtnjaA80FF50Xd730B5/zhp+tTMgCTYYcoy0p56zyjCUtlbZI+ZlgR+QGBPr6qxE3aKgAP8QcU090u80JF4DsbgFTKIH34XhbRrgRAKOf7nJOhL5HPKFeM0xlMwncQVgTjIPfvBzhYelBYeUh9UpkLvI8WByoSEON0uKS7TeW+anR3p9Pp6eHhYUUC3rENGwCIc7Ia2ZIYJz8s6YtVqloXAq/U2aCVZ3swJyDLeEz5gbgmRZEtiQn//bTU971VtSKUThv/orlX5E52S1KJF/tNw/ioCoBS2l4DscaWJbhWb24e+6KIw+fYgWyHxzoDJCjA8evy2kC7fgoPNvSJguNVStO4cbZpGt/ShVuABJDhT3STGqgrTyJbJr6WCkD0rW2o+KN7A52n+5Imk9g/7qxTBUDaNA+jeES12B3KfWWoFS/B+H3mCQAlVHwexQcVKch3OvF/gIdDbvVqBUhAXMSdKA+XXeOovuU1S/Qdo9hDtWIHa0aIQAomQPqDSqMdYBRFVQCl2AVattSqXzdICg9uQgOvygbRamODIEprDdIdmuGurfdMj49G6WvqJ7JutSMI1CX64CLdoSDqVWBi3c76ihTNZnMnwuWi2eKZ9lJUC+KDfTo7dIfWNwwQ/1695wLFCsNDpB0gbwCEcyouLW95CE1BLRXbJP7E4QYQP+71bOBocUjCcZCEMZB+mbLAoWtND6QSBXWsCpv/Ff8MgHhf43ao/QLFqHG2GSCsVSc4xShN3hKuF9IeqMJNXgHSDQMgqQQZx2dA+gL5fjFSU4tlSa0G4eSzbBSWNZxKpf4J0l7De4agEqeC5RvkYGp5yktBCY2G2pT9D/cFFLEXh7sg8rvDtB3ZrjFIQxIkP4rTK2rV0UoBl/V3jRXnHd47xwrje2ZUiGdHTfO/sP2OfN8ggFhWjC4XK1DOiUH9ab/g08LK7wwq7k0BQDKUi3gh4kysLo0YDcQeiC/QxhhtkYOofx5lP+PcOivbiV7I+1U4vQR5aWn/cH9x3zBbUPRGxV+s+K2utHeYI4sJaMC7YfcE+gWAtXr3OG3JadW7bQmYzel/AQYAm20RvfUSk38AAAAASUVORK5CYII=","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1464395447159","id": ".M.normal","type": "js","data": "({\n\tid:'in.Cards.Normal',\n\tinherit:['RT','Tgt'],\n\tdata:{\n\t\ttitle:'',\n\t\tphoto:'',\n\t\tdesc:'',\n\t\tlist:[],\n\t\tlink:{\n\t\t\turl:'',\n\t\t\ttext:'',\n\t\t\tmode:[],\n\t\t\tcolor:''\n\t\t},\n\t\tbanner:{\n\t\t\ttext:'',\n\t\t\tcolor:''\n\t\t},\n\t\tbg:'',\n\t\tlogo:'',\n\t\tscale:'100'\n\t},\n\tinit:[\n\t\t'<div id=\"vc-banner\" style=\"position:absolute\"></div>',\n\t\t'<div id=\"vc-photo\" class=\"vc-photo-big\"></div>',\n\t\t'<div id=\"vc-text\">',\n\t\t\t'<h3 id=\"vc-title\"></h3>',\n\t\t\t'<div id=\"vc-desc\"></div>',\n\t\t\t'<ul id=\"vc-list\"></ul>',\n\t\t\t'<div id=\"vc-link\"></div>',\n\t\t'</div>'\n\t],\n\tui: { /* See tab */ },\n  \n\tstyle:{\n\t\t'': function(){\n\t\t\tvar scale = +this.data.scale || 100,\n          m = this.RT().meta,\n          bradius = this.RT().data.br || m.theme.corner.outer,\n          pradius = this.RT().data.pad=='0'?'0':m.theme.corner.inner,\n\t\t\t\t\tcss = {\n            '':'transform:scale('+scale/100+');border-radius:'+bradius+';',\n            ' #vc-photo':'border-radius:' + pradius + ';'\n          };\n\t\t\tif (scale >100 ) css[''] += 'z-index:'+(scale-100 | 0)+';'\n\t\t\treturn css;\n\t\t},\n\t\t' #vc-text':{\n\t\t\t' ': function(){\n\t\t\t\tvar d = this.RT().data,\n\t\t\t\t\t\titem = this.data,\n\t\t\t\t\t\talign = 'text-align:'+(item.align || d.align)+';',\n\t\t\t\t\t\tbcolor = (item.link?item.link.color:'')||d.border,\n            m = this.RT().meta,\n\t\t\t\t\t\tbradius = (item.link?item.link.corner:'') || m.theme.corner.outer;\n\t\t\t\treturn {\n\t\t\t\t\t'':'line-height: 1.4em;font-size: 1em;padding:'+d.text.pad+';display:block;',\n\t\t\t\t\t' #vc-title':'display:inline-block;vertical-align:top;width:100%;'+align,\n\t\t\t\t\t' #vc-link':{\n\t\t\t\t\t\t'':'margin:0.9em 0 0 0;font-size:1.1em;'+align,\n\t\t\t\t\t\t'.vc-button a':{\n\t\t\t\t\t\t\t'':'text-decoration:none!important; border:1px solid transparent!important;padding:0.2em 0.6em 0.4em 0.6em;'\n\t\t\t\t\t\t\t+' background-color:'+bcolor+';color:white!important;transition: color 0.3s, border 0.3s, background-color 0.3s;'\n\t\t\t\t\t\t\t+'border-radius:'+bradius+';line-height:1.2em;display:inline-block;min-width:130px;text-align:center;',\n\t\t\t\t\t\t\t':hover':'background:white;border:1px solid '+bcolor+'!important;color:'+bcolor+'!important;'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n    ' #vc-desc':'margin-top:1em; hyphens:auto;',\n    ' #vc-photo':{\n      '':'background-size:cover;background-position:50% 30%;',\n\t\t\t' a':'position:absolute; width:100%; height:100%; top:0;left:0;border-bottom:none!important;'\n    }\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1538785356041","id": ".M.normal.ui","type": "js","data": "({\n  '#vc-banner':{\n    bind:'banner.text',\n    css:{\n      hide: function(d){ return !(d.banner.text)}\n    }\n  },\n  '#vc-photo':{\n    bind:function(d,v,$o){\n      var that = this;\n      if (!d.photo) return '';\n      $o.css({\n        'background-image':'url('+(that.RT().Url[d.photo]||d.photo)+')'\n      });\n\n      if (d.link.mode.indexOf('image') == -1) return '';\n\n      return '<a href=\"'+d.link.url+'\" ' + that.Tgt(d) + '> </a>';\n    },\n    css:{\n      hide: function(d){ return !(d.photo+'')}\n    }\n  },\n  '#vc-desc':{\n    bind: function(d,v){\n      var that = this;\n      if (!d.list.length && that.RT().data.align == \"center\") return '<center>'+d.desc+'</center>';\n      return d.desc;\n    },\n    css:{\n      hide: function(d){ return !(d.desc)}\n    }\n  },\n  '#vc-list':{\n    bind: function(d){\n      return (d.list || []).map(function(e){\n        return '<li>'+e+'</li>';\n      }).join('');\n    },\n    css:{\n      hide: function(d){return !(d.list || []).length}\n    }\n  },\n  '#vc-title':{\n    bind:function(d){\n      if (!d.link || !d.link.url || (d.link||[]).mode.indexOf('header') == -1) return d.title;\n      var that = this,\n          u = d.link.url,\n          t = d.title;\n      if (u.to(4)=='http') {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }\n      else {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }      \n\n    },\n    css:{\n      hide: function(d){ return !(d.title)}\n    }\n  },\n  '#vc-link': {\n    bind:function(d){\n      var that = this,\n          u, t;\n      if (d.link && d.link.url && d.link.text) {\n        u = d.link.url;\n        t = d.link.text;\n        if (u.to(4)=='http') {\n          return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n        }\n        else {\n          return '<a href=\"'+u+'\">'+t+'</a>';\n        }\n      }\n    },\n    init: function($o){\n      var d = this.data,\n          link = d.link,\n          m  = d.link.mode;\n      if (link) {\n        if (m.indexOf('link') != -1) $o.addClass('vc-link');\n        if (m.indexOf('button') != -1) $o.addClass('vc-button');\n      }\n    },\n    css:{\n      hide: function(d){ return !(d.link && d.link.url && d.link.text)}\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1538856050883","id": ".M.small","type": "js","data": "({\n\tid:'in.Cards.Small',\n\tinherit:['RT','Tgt'],\n\tdata:{\n\t\ttitle:'',\n\t\tphoto:'',\n\t\tdesc:'',\n\t\tlist:[],\n\t\tlink:{\n\t\t\turl:'',\n\t\t\ttext:'',\n\t\t\tmode:[],\n\t\t\tcolor:''\n\t\t},\n\t\tbanner:{\n\t\t\ttext:'',\n\t\t\tcolor:''\n\t\t},\n\t\tbg:'',\n\t\tlogo:'',\n\t\tscale:'100'\n\t},\n\tinit:[\n\t\t'<div id=\"vc-banner\" style=\"position:absolute\"></div>',\n\t\t'<div id=\"vc-photo\" class=\"dib vat\"></div>',\n\t\t'<div id=\"vc-text\" class=\"dib vat\">',\n      '<div id=\"vc-title\"></div>',\n      '<div id=\"vc-desc\"></div>',\n      '<ul id=\"vc-list\"></ul>',\n      '<div id=\"vc-link\"></div>',\n\t\t'</div>'\n\t],\n\tui: { /* See tab */ },\n  \n\tstyle:{\n\t\t'': function(){\n\t\t\tvar scale = +this.data.scale || 100,\n          bradius = this.RT().data.br || this.RT().meta.theme.corner.outer,\n\t\t\t\t\tcss = {\n            '':'transform:scale('+scale/100+');border-radius:'+bradius+';'\n          };\n\t\t\tif (scale >100 ) css[''] += 'z-index:'+(scale-100 | 0)+';'\n\t\t\treturn css;\n\t\t},\n\n    ' ': function(){\n      var d = this.RT().data,\n          item = this.data,\n          align = 'text-align:'+(item.align || d.align)+';',\n          bcolor = (item.link?item.link.color:'')||d.border,\n          bradius = (item.link?item.link.corner:'')||this.RT().meta.theme.corner.outer,\n          ratio\t=\td.ratio || '40:30',\n          aratio = ratio.split(/\\D+/);\n      return {\n        '#vc-text':{\n          '':'line-height: 1.4em;font-size: 1em;width:calc(100% - {1}px);padding:{2};'.assign(aratio[0],d.text.pad),\n          ' #vc-title':'display:inline-block;vertical-align:top;hyphens:auto;width:100%;'+align,\n          ' #vc-link':{\n            '':'margin:1em 0 0 0;font-size:1.1em;'+align,\n            '.vc-button a':{\n              '':'text-decoration:none!important; border:1px solid transparent!important;padding:0.2em 0.6em 0.4em 0.6em;'\n              +' background-color:'+bcolor+';color:white!important;transition: color 0.3s, border 0.3s, background-color 0.3s;'\n              +'border-radius:'+bradius+';line-height:1.2em;display:inline-block;min-width:130px;text-align:center;',\n              ':hover':'background:white;border:1px solid '+bcolor+'!important;color:'+bcolor+'!important;'\n            }\n          }\n        },\n        '#vc-photo':'width:{1}px;height:{2}px;'.assign(aratio[0],aratio[1])\n      };\n    },\n    \n    ' #vc-desc':'margin-top:0.6em; hyphens:auto;',\n\n\t\t' #vc-photo':{\n      '':'background-size:cover;background-position:50% 30%;',\n\t\t\t' a':'position:absolute; width:100%; height:100%; top:0;left:0;border-bottom:none!important;'\n    }\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1538856073043","id": ".M.small.ui","type": "js","data": "({\n  '#vc-banner':{\n    bind:'banner.text',\n    css:{\n      hide: function(d){ return !(d.banner.text)}\n    }\n  },\n  '#vc-photo':{\n    bind:function(d,v,$o){\n      var that = this;\n      if (!d.photo) return '';\n      $o.css({\n        'background-image':'url('+(that.RT().Url[d.photo]||d.photo)+')'\n      });\n\n      if (d.link.mode.indexOf('image') == -1) return '';\n\n      return '<a href=\"'+d.link.url+'\" ' + that.Tgt(d) + '> </a>';\n    },\n    css:{\n      hide: function(d){ return !(d.photo+'')}\n    }\n  },\n  '#vc-desc':{\n    bind: function(d,v){\n      var that = this;\n      if (!d.list.length && that.RT().data.align == \"center\") return '<center>'+d.desc+'</center>';\n      return d.desc;\n    },\n    css:{\n      hide: function(d){ return !(d.desc)}\n    }\n  },\n  '#vc-list':{\n    bind: function(d){\n      return (d.list || []).map(function(e){\n        return '<li>'+e+'</li>';\n      }).join('');\n    },\n    css:{\n      hide: function(d){return !(d.list || []).length}\n    }\n  },\n  '#vc-title':{\n    bind:function(d){\n      if (!d.link || !d.link.url || (d.link||[]).mode.indexOf('header') == -1) return d.title;\n      var that = this,\n          u = d.link.url,\n          t = d.title;\n      if (u.to(4)=='http') {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }\n      else {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }      \n\n    },\n    css:{\n      hide: function(d){ return !(d.title)}\n    }\n  },\n  '#vc-link': {\n    bind:function(d){\n      var that = this,\n          u, t;\n      if (d.link && d.link.url && d.link.text) {\n        u = d.link.url;\n        t = d.link.text;\n        if (u.to(4)=='http') {\n          return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n        }\n        else {\n          return '<a href=\"'+u+'\">'+t+'</a>';\n        }\n      }\n    },\n    init: function($o){\n      var d = this.data,\n          link = d.link,\n          m  = d.link.mode;\n      if (link) {\n        if (m.indexOf('link') != -1) $o.addClass('vc-link');\n        if (m.indexOf('button') != -1) $o.addClass('vc-button');\n      }\n    },\n    css:{\n      hide: function(d){ return !(d.link && d.link.url && d.link.text)}\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1539465709185","id": ".M.icon","type": "js","data": "({\n\tid:'in.Cards.Icon',\n\tinherit:['RT','Tgt'],\n\tdata:{\n\t\ttitle:'',\n\t\tphoto:'',\n\t\tdesc:'',\n\t\tlist:[],\n\t\tlink:{\n\t\t\turl:'',\n\t\t\ttext:'',\n\t\t\tmode:[],\n\t\t\tcolor:''\n\t\t},\n\t\tbanner:{\n\t\t\ttext:'',\n\t\t\tcolor:''\n\t\t},\n\t\tbg:'',\n\t\tlogo:'',\n\t\tscale:'100'\n\t},\n\tinit:[\n\t\t'<div id=\"vc-banner\" style=\"position:absolute\"></div>',\n    '<div>',\n\t\t\t'<div id=\"vc-photo\" class=\"dib vat\"></div>',\n    '</div>',\n\t\t'<div id=\"vc-text\" class=\"dib vat\">',\n      '<div id=\"vc-title\"></div>',\n      '<div id=\"vc-desc\"></div>',\n      '<ul id=\"vc-list\"></ul>',\n      '<div id=\"vc-link\"></div>',\n\t\t'</div>'\n\t],\n\tui: { /* See tab */ },\n  \n\tstyle:{\n\t\t'': function(){\n\t\t\tvar scale = +this.data.scale || 100,\n          bradius = this.RT().data.br || this.RT().meta.theme.corner.outer,\n\t\t\t\t\tcss = {\n            '':'transform:scale('+scale/100+');border-radius:'+bradius+';'\n          };\n\t\t\tif (scale >100 ) css[''] += 'z-index:'+(scale-100 | 0)+';'\n\t\t\treturn css;\n\t\t},\n\n    ' ': function(){\n      var d = this.RT().data,\n          item = this.data,\n          align = 'text-align:'+(item.align || d.align)+';',\n          bcolor = (item.link?item.link.color:'')||d.border,\n          bradius = (item.link?item.link.corner:'')||this.RT().meta.theme.corner.outer,\n          ratio\t=\td.ratio || '40:30',\n          aratio = ratio.split(/\\D+/);\n      return {\n        '#vc-text':{\n          '':'line-height: 1.4em;font-size: 1em;width:100%;padding:{1};'.assign(d.text.pad),\n          ' #vc-title':'display:inline-block;vertical-align:top;hyphens:auto;width:100%;'+align,\n          ' #vc-link':{\n            '':'margin:1em 0 0 0;font-size:1.1em;'+align,\n            '.vc-button a':{\n              '':'text-decoration:none!important; border:1px solid transparent!important;padding:0.2em 0.6em 0.4em 0.6em;'\n              +' background-color:'+bcolor+';color:white!important;transition: color 0.3s, border 0.3s, background-color 0.3s;'\n              +'border-radius:'+bradius+';line-height:1.2em;display:inline-block;min-width:130px;text-align:center;',\n              ':hover':'background:white;border:1px solid '+bcolor+'!important;color:'+bcolor+'!important;'\n            }\n          }\n        },\n        '#vc-photo':'width:{1}px;height:{2}px;'.assign(aratio[0],aratio[1])\n      };\n    },\n    \n    ' #vc-desc':'margin-top:0.6em; hyphens:auto;',\n\n\t\t' #vc-photo':{\n      '':'background-size:cover;background-position:50% 30%;',\n\t\t\t' a':'position:absolute; width:100%; height:100%; top:0;left:0;border-bottom:none!important;'\n    }\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1539465751026","id": ".M.icon.ui","type": "js","data": "({\n  '#vc-banner':{\n    bind:'banner.text',\n    css:{\n      hide: function(d){ return !(d.banner.text)}\n    }\n  },\n  '#vc-photo':{\n    bind:function(d,v,$o){\n      var that = this;\n      if (!d.photo) return '';\n      $o.css({\n        'background-image':'url('+(that.RT().Url[d.photo]||d.photo)+')'\n      });\n\n      if (d.link.mode.indexOf('image') == -1) return '';\n\n      return '<a href=\"'+d.link.url+'\" ' + that.Tgt(d) + '> </a>';\n    },\n    css:{\n      hide: function(d){ return !(d.photo+'')}\n    }\n  },\n  '#vc-desc':{\n    bind: function(d,v){\n      var that = this;\n      if (!d.list.length && that.RT().data.align == \"center\") return '<center>'+d.desc+'</center>';\n      return d.desc;\n    },\n    css:{\n      hide: function(d){ return !(d.desc)}\n    }\n  },\n  '#vc-list':{\n    bind: function(d){\n      return (d.list || []).map(function(e){\n        return '<li>'+e+'</li>';\n      }).join('');\n    },\n    css:{\n      hide: function(d){return !(d.list || []).length}\n    }\n  },\n  '#vc-title':{\n    bind:function(d){\n      if (!d.link || !d.link.url || (d.link||[]).mode.indexOf('header') == -1) return d.title;\n      var that = this,\n          u = d.link.url,\n          t = d.title;\n      if (u.to(4)=='http') {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }\n      else {\n        return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n      }      \n\n    },\n    css:{\n      hide: function(d){ return !(d.title)}\n    }\n  },\n  '#vc-link': {\n    bind:function(d){\n      var that = this,\n          u, t;\n      if (d.link && d.link.url && d.link.text) {\n        u = d.link.url;\n        t = d.link.text;\n        if (u.to(4)=='http') {\n          return '<a href=\"'+u+'\" '+that.Tgt(d)+'>'+t+'</a>';\n        }\n        else {\n          return '<a href=\"'+u+'\">'+t+'</a>';\n        }\n      }\n    },\n    init: function($o){\n      var d = this.data,\n          link = d.link,\n          m  = d.link.mode;\n      if (link) {\n        if (m.indexOf('link') != -1) $o.addClass('vc-link');\n        if (m.indexOf('button') != -1) $o.addClass('vc-button');\n      }\n    },\n    css:{\n      hide: function(d){ return !(d.link && d.link.url && d.link.text)}\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1464823519006","id": ".Opts","type": "js","data": "({\n\n\tP:{},\n\tDetail:[],\n\tui:{\n\t\t'#btn-gapply':function(d,v){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\td.bg = d.bg +'';\n\t\t\t\td.items = d.items.map(function(e){if (e.photo) {e.photo=e.photo+'';} return e;}).compact();\n\t\t\t\tthis.my.commit();\n\t\t\t}\n\t\t},\n\t\t'#btn-gcancel':function(d,v){\n\t\t\tif (v!=null) this.my.cancel();\n\t\t},\n\t\t\n\t\t'#btn-gsettings':{\n\t\t\tdelay:50,\n\t\t\tbind: function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tthat.my.find('#gleft .vc-active').removeClass('vc-active');\n\t\t\t\t\tthat.my.find('#x-gsettings').addClass('vc-active');\n\t\t\t\t\tthat.Detail[0] = d;\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:'click.my',\n\t\t\trecalc:'#gi'\n\t\t},\n    \n    '#btn-gremote':{\n\t\t\tdelay:50,\n\t\t\tbind: function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tthat.my.find('#gleft .vc-active').removeClass('vc-active');\n          that.my.find('#x-gremote').addClass('vc-active');\n\t\t\t\t\tthat.Detail[0] = d.remote;\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:'click.my',\n\t\t\trecalc:'#gi'\n\t\t},\n\t\t\n\t\t'#btn-gadd':{\n\t\t\tbind: function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null)  {\n\t\t\t\t\td.items.push($.extend(true, {}, that.Item.data));\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:'click.my',\n\t\t\trecalc:'#master'\n\t\t},\n\t\t'#x-gadd':{\n\t\t\tcss:{\n\t\t\t\thide: function(d){\n\t\t\t\t\treturn d.items.length>30;\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:'#master',\n\t\t},\n\t\t'#btn-gdel':{\n\t\t\tbind: function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v!=null)  {\n\t\t\t\t\td.items.remove(that.Detail[0]);\n\t\t\t\t\t(function(){\n\t\t\t\t\t\tthat.my.find('#master>div:eq(0)>#name').trigger('click');\n\t\t\t\t\t}.debounce(100))();\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:'click.my',\n\t\t\trecalc:'#master'\n\t\t},\n\t\t'#x-gdel':{\n\t\t\tdelay:50,\n\t\t\tcss:{\n\t\t\t\thide: function(d){\n\t\t\t\t\treturn !!(d.items.length <2 || (this.Detail[0] && this.Detail[0].items));\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:'#master,#gi',\n\t\t}\n\t},\n\tstyle:{\n\t\t'':'font-size:15px;',\n\t\t' .vc-active':'background-color:#def;',\n\t\t' .mitem':'cursor:move;overflow:hidden;text-overflow:ellipsis;'\n\t},\n  die:function($o){\n  \t// Unmount niceScroll\n\t\tvar f = $o.find('#master').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1464887341679","id": ".Opts.ui","type": "js","data": "({\n\t\"#master\": {\n\t\trecalcDepth:1,\n\t\tbind: \"items\",\n\t\tlist: '<div class=\"mitem\"><span id=\"name\" class=\"pseudolink tdn ml3\"></span></div>',\n\t\tinit: function ($o, form){\n\t\t\tvar that = this;\n      $o.niceScroll();\n\t\t\t// Explicitly process click on left col‘s elt\n\t\t\t$o.on('switch.my', function (event, item){\n\t\t\t\tthat.my.find(\".vc-active\").removeClass(\"vc-active\");\n\t\t\t\tthat.Detail[0] = item;\n\t\t\t\tthat.my.recalc('#gi');\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.sortable();\n\t\t},\n\t\thash: ['title','desc','type'],\n\t\tid:['title','type','desc','photo','link'],\n\t\tmanifest: {\n\t\t\tinherit:['Lang'],\n\t\t\tui: {\n\t\t\t\t\"#name\": {\n\t\t\t\t\tbind: function (d, v){ \n\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\tif (null!=v) {\n\t\t\t\t\t\t\tthat.my.trigger(null, \"switch\", d);\n\t\t\t\t\t\t\tthat.my.root().addClass(\"vc-active\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar title = (d.title || d.desc).stripTags().compact()//.truncate(23,'middle','…') \n\t\t\t\t\t\t|| ('<span class=\"fi-alert red1\"></span> '+that.Lang.UNTITLED);\n\n\t\t\t\t\t\treturn '<nobr class=\"w100p oh\">'+title+'</nobr>';\n\t\t\t\t\t},\n\t\t\t\t\tevents: \"click.my\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\twatch: \"#gi\",\n\t\tevents: \"sortchange.my sortupdate.my\"\n\t},\n\t'#gi':{\n\t\trecalcDepth:1,\n\t\tdelay:50,\n\t\tmanifest:function(e){\n\t\t\tif (e.type == \"inliner-cards\") return $.extend(true,{}, this.Settings);\n      if (typeof e.query == 'string' && typeof e.transform == 'string')\treturn $.extend(true,{}, this.Remote);\n\t\t\treturn $.extend(true,{}, this.Item);\n\t\t},\n\t\tbind:'this.Detail',\n\t\tlist:'<div></div>',\n\t\t//watch:'#master'\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1464902845860","id": ".Opts.init","type": "js","data": "(function($o){\n\t\t\t\n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tlang = 'en';\n\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\t\t\t\n\t\t$o.formgen([\n\t\t\t\n\t\t\t'<div id=\"gleft\" class=\"dib vat w210 pr10 oh\" style=\"min-height:360px;border-right:1px solid #eee;\">',\n\t\t\t\t'<div class=\"blue mt2 fs95 w100p pl3 lh150 vc-active\" id=\"x-gsettings\">',\n\t\t\t\t\t'<span class=\"fi-widget o80 fs90\"></span> <span id=\"btn-gsettings\" class=\"pseudolink tdn\">'+L.SETTINGS+'</span>',\n\t\t\t\t'</div>',\n      \t'<div class=\"blue mt2 fs95 w100p pl3 lh150\" id=\"x-gremote\">',\n\t\t\t\t\t'<span class=\"fi-link o80 fs90\"></span> <span id=\"btn-gremote\" class=\"pseudolink tdn\">'+L.REMOTE+'</span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"master\" class=\"lh150 fs95\" style=\"max-height:250px\"></div>',\n\t\t\t\t'<div class=\"hoverlink gray mt2 fs90 dib vat\" id=\"x-gadd\">',\n\t\t\t\t\t'<span class=\"fi-plus o80 fs90\"></span> <span id=\"btn-gadd\" class=\"pseudolink\">'+L.ADD+'</span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div class=\"hoverlink gray mt2 fs90 dib vat pl10\" id=\"x-gdel\">',\n\t\t\t\t\t'<span class=\"fi-x o80 fs85\"></span> <span id=\"btn-gdel\" class=\"pseudolink\">'+L.DEL+'</span>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"gbtns\" class=\"pt10\" style=\"position:absolute;left:0;bottom:0;\">',\n\t\t\t\t\t'<button id=\"btn-gapply\" class=\"green fs95 w100 mr5 pl0 pr0 mb0\">'+L.APPLY+'</button>',\n\t\t\t\t\t'<button id=\"btn-gcancel\" class=\"fs95 w95 pl0 pr0 mr0 mb0\">'+L.CLOSE+'</button>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div id=\"gi\" class=\"w450 dib vat ml15\" style=\"min-height:360px;\"></div>'\n\t\t\t\n\t\t]);\n\t\t\n\tif (!d.items.length) d.items[0] = {\n\t\t\"photo\": '',\t\"title\": \"\",\"desc\": \"\",\"list\": [],\n\t\t\"link\": {\"url\": \"\",\"text\": \"\",\"mode\": \"link\",\"color\": \"\"}\n\t};\n\n\tif (that.Att) that.P = that.Att(null);\n  \n  that.Detail[0] = d;\n\n\t/*$o.then(function(){\n\t\t$o.find('#master>div:eq(0)>#name').trigger('click');\n\t}.debounce(100))*/\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1464832734274","id": ".Opts.Lang","type": "js","data": "({\n\ten:{\n\t\tAPPLY:\t\t'Apply',\n\t\tCLOSE:\t\t'Close',\n\t\tADD:\t\t\t'Add',\n\t\tDEL:\t\t\t'Del',\n\t\tUNTITLED:\t'Untitled',\n\t\tSETTINGS:\t'Block settings',\n    REMOTE:\t\t'Remote data'\n\t},\n\t\n\tru:{\n\t\t\n\t\tAPPLY:\t\t'Применить',\n\t\tCLOSE:\t\t'Закрыть',\n\t\tADD:\t\t\t'Добавить',\n\t\tDEL:\t\t\t'Удалить',\n\t\tUNTITLED:\t'Без имени',\n\t\tSETTINGS:\t'Настройки блока',\n    REMOTE:\t\t'Внешние данные'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1464823639594","id": ".Opts.Item","type": "js","data": "({\n  id:'in.Cards.Opts.Item',\n\tdata:{\n\t\ttitle:'',\n\t\tdesc:'',\n\t\tphoto:'',\n\t\tlist:[],\n\t\tscale:'100',\n\t\tlink:{\n\t\t\tmode:'link'\n\t\t}\n\t},\n\tinherit:['P','Att'],\n\tinit: function($o){\n\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\n\t\t//[ ,'inp#gdesc.fs110',{plc: }],\n\n\t\tvar t = [\n\t\t\t{row:\"450px\", rowCss:\"my-row mb10 gray\", label:'100px', labelCss:'fs95 gray'},\n\t\t\t[L.TITLE,'inp#gtitle.fs110',{plc:L.TITLE_PLC}],\n\t\t\t[L.DESC ,'txt#gdesc.fs90.w100p',{plc: L.DESC_PLC}],\n\t\t\t[L.LIST ,'txt#glist.fs90.w100p',{plc: L.LIST_PLC}],\n\t\t\t[L.PHOTO ,'inp#gphoto.fs105',{plc: L.PHOTO_PLC}],\n\t\t\t[L.LINK, \n\t\t\t '<div class=\"dib vat w100p fs95 mb3\">','spn#glmode','</div>',\n\t\t\t '<div class=\"dib vat w100p fs95 mb4\">',\n\t\t\t \t'inp#gltext.w250.mr5',{plc:L.LINK_TEXT},\n\t\t\t \t'inp#glcolor.w95',{plc:L.LINK_COLOR},\n\t\t\t '</div>',\n\t\t\t '<div class=\"dib vat w100p fs95 mb4\">','inp#glurl',{plc:L.LINK_URL},'</div>',\n\t\t\t //'<div class=\"dib vat w100p fs95\">','inp#glcolor.w150',{plc:L.LINK_COLOR},'</div>'\n\t\t\t],\n\t\t\t[L.SCALE ,'num#gscale.fs90.w60',{plc: L.SCALE_PLC}, '&nbsp;%']\n\t\t];\n\n\t\t$o.formgen(t);\n\n\t},\n\tui:{\n\t\t'#gtitle':'title',\n\t\t'#gdesc':{\n      delay:0,\n    \tbind: function(d,v,$o){\n      \t$o.height(0).height(($o[0].scrollHeight-10).clamp(39,90));\n        if (v!=null) {\n          d.desc = v.trim();\n          return v;\n        }\n        return d.desc;\n      }\n    },\n\t\t'#glist':{\n\t\t\tbind: function(d,v,$o){\n        $o.height(0).height(($o[0].scrollHeight-10).clamp(39,90));\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.list = v.split('\\n').compact(true);\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\treturn d.list.join('\\n');\n\t\t\t}\n\t\t},\n\t\t'#gphoto':{\n\t\t\tbind:'photo',\n\t\t\tinit:function($o){\n\t\t\t\tvar that = this;\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\tplaceholder:that.Lang.LINK_URL\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t'#glmode':{\n\t\t\tinit: function($o){\n\t\t\t\tvar that = this;\n\t\t\t\t$o.tags(that.Lang.LINK_MODE)\n\t\t\t},\n\t\t\tbind:'link.mode'\n\t\t},\n\t\t'#glurl':'link.url',\n\t\t'#gltext':'link.text',\n\t\t'#glcolor':'link.color',\n\n\t\t'#gscale':'scale',\n\n\t},\n  style:{\n  \t'\ttextarea':'resize:none;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1464823735807","id": ".Opts.Item.Lang","type": "js","data": "({\n\ten:{\n\t\tAPPLY:'Apply',\n\t\tCLOSE:'Close',\n\t\t\n\t\tPHOTO:'Image',\n\t\tPHOTO_PLC:'Select attach or paste URL',\n\t\t\n\t\tTITLE:'Title',\n\t\tTITLE_PLC:'Text, markup allowed',\n\t\t\n\t\tDESC:'Lead',\n\t\tDESC_PLC:'Text, markup allowed',\n\t\t\n\t\tLIST:'List',\n\t\tLIST_PLC:'Newline-seprated list',\n\t\t\n\t\tBANNER:'Banner',\n\t\tBANNER_TEXT:'Text, markup allowed',\n\t\tBANNER_COLOR:'#RRGGBB',\n\t\t\n\t\tLINK:'Show link as ',\n\t\tLINK_MODE:{\n\t\t\ttags:[\n\t\t\t\t[\n\t\t\t\t\t{'Link':'link'},\n\t\t\t\t\t{'Button':'button'}\n\t\t\t\t],\n\t\t\t\t{'+ Header':'header'},\n\t\t\t\t{'+ Image':'image'}\n\t\t\t]\n\t\t},\n\t\tLINK_URL:'Link URL',\n\t\tLINK_COLOR:'#RRGGBB',\n\t\tLINK_TEXT:'Text label',\n\t\t\n\t\tSCALE:'Card scale'\n\t},\n\t\n\tru:{\n\t\t\n\t\tAPPLY:'Применить',\n\t\tCLOSE:'Закрыть',\n\t\t\n\t\tPHOTO:'Картинка',\n\t\tPHOTO_PLC:'URL или выберите из списка...',\n\t\t\n\t\tTITLE:'Заголовок',\n\t\tTITLE_PLC:'Текст с разметкой',\n\t\t\n\t\tDESC:'Описание',\n\t\tDESC_PLC:'Текст с разметкой',\n\t\t\n\t\tLIST:'Опции',\n\t\tLIST_PLC:'Список через Enter',\n\t\t\n\t\tBANNER:'Баннер',\n\t\tBANNER_TEXT:'Текст с разметкой',\n\t\tBANNER_COLOR:'#RRGGBB',\n\t\t\n\t\tLINK:'Ссылка',\n\t\tLINK_MODE:{\n\t\t\ttags:[\n\t\t\t\t[\n\t\t\t\t\t{'Ссылкой':'link'},\n\t\t\t\t\t{'Кнопкой':'button'}\n\t\t\t\t],\n\t\t\t\t{'+ Заголовок':'header'},\n\t\t\t\t{'+ Картинка':'image'}\n\t\t\t],\n      tagshim:'',\n      groupshim:''\n\t\t},\n\t\tLINK_URL:'URL-адрес',\n\t\tLINK_COLOR:'#RRGGBB',\n\t\tLINK_TEXT:'Текст',\n\t\t\n\t\tSCALE:'Масштаб'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1464900331227","id": ".Opts.Settings","type": "js","data": "({\n\tdata:{\n\t\talign:['left']\n\t},\n\tparams:{delay:20},\n\tinit: function($o){\n\t\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\t\t\n\t\t$o.formgen([\n\t\t\t'<div class=\"fs140 blue-1 mb7\">'+L.H1+'</div>',\n\t\t\t{row:\"450px\", rowCss:\"my-row mb7 gray\", label:'90px', labelCss:'fs95 gray'},\n\t\t\t[L.TITLE,'inp#gtitle.fs110',{plc:L.TITLE_PLC}],\n\t\t\t[L.MODE,'spn#gmode'],\n\t\t\t[L.ALIGN,'spn#sgalign'],\n\t\t\t[L.ANIMATE,'spn#ganimate'],\n\t\t\t[L.WIDTH, \n\t\t\t \t'num#gwidth.w70',{min:100, max:1000}, '<span class=\"fs95 dib w30\">&nbsp;px</span>',\n       \t'<span class=\"dib w90 ml40 fs95 pl10\">' + L.GAP + '</span>',\n\t\t\t\t'num#ggap.w70',{min:0, max:100},'<span class=\"fs95\"> px</span>'\n\t\t\t],\n\t\t\t[L.BORDER, \n      \t'inp#gborder.w130', {plc:L.BORDER_PLC},\n      \t'<span class=\"dib w90 ml10 fs95 pl10\">' + L.BG + '</span>',\n      \t'inp#gbg.w130', {plc:L.BG_PLC}\n      ],\n\t\t\t// [L.BG, 'inp#gbg.w120', {plc:L.BG_PLC}],\n\t\t\t[L.PAD, \n      \t'inp#gpad.w130', {plc:L.PAD_PLC},\n       \t'<span class=\"dib w90 ml10 fs95 pl10\">' + L.PAD0 + '</span>',\n      \t'inp#gtpad.w130', {plc:L.PAD0_PLC}\n      ],\n\t\t\t[L.RATIO, 'inp#gratio.w70', {plc:L.RATIO_PLC}, \n\t\t\t '<span class=\"pl10\">', 'val',{vals:['3:1','2:1','16:9','4:3','1:1']}, '</span>'\n\t\t\t]\n\t\t]);\n\t\t\n\t},\n\tui:{\n\t\t'#gtitle':'title',\n\t\t'#gmode':{\n\t\t\tbind:'mode',\n\t\t\tinit: function($o){\n\t\t\t\t$o.tags(this.Lang.MODE_TAGS)\n\t\t\t}\n\t\t},\n\t\t'#sgalign':{\n\t\t\tbind:'align',\n\t\t\tinit: function($o){\n\t\t\t\t$o.tags(this.Lang.ALIGN_TAGS)\n\t\t\t}\n\t\t},\n\t\t'#ganimate':{\n\t\t\tbind:'animate',\n\t\t\tinit: function($o){\n\t\t\t\t$o.tags(this.Lang.ANIMATE_TAGS)\n\t\t\t}\n\t\t},\n\t\t'#gwidth':\t'width',\n\t\t'#ggap':\t\t'gap',\n\t\t'#gbg':\t\t\t'bg',\n\t\t'#gborder':\t'border',\n\t\t'#gratio':\t'ratio',\n    '#gpad':\t\t'pad',\n\t\t'#gtpad':\t\t'text.pad'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1464900368510","id": ".Opts.Settings.Lang","type": "js","data": "({\n\ten:{\n\t\tH1:'Cards block settings',\n\t\t\n\t\tTITLE:'Title',\n\t\tTITLE_PLC:'Text, markup allowed',\n\n\t\tMODE:'Render',\n\t\tMODE_TAGS:{tags:[[\n      {'Photo top':'normal'},\n      {'Icon top':'icon'},\n      {'Icon left':'small'},\n    ]]},\n\t\t\n\t\tALIGN:'Align',\n\t\tALIGN_TAGS:{\n\t\t\ttags:[[{'Center':'center'}, {'Center-left':'center-left'}]],\n\t\t\tempty:{'Left':'left'},\n\t\t\ttagshim:''\n\t\t},\n\t\t\n\t\tANIMATE:'Animate',\n\t\tANIMATE_TAGS:{\n\t\t\ttags:[[{\"Zoom\":'zoom'},{\"Flip\":'flip'},{\"Drop\":'drop'},{\"Fade-in\":'fade'}]],\n\t\t\tempty:{\"No\":''}\n\t\t},\n\t\t\n\t\tWIDTH:'Width',\n\t\tWIDTH_AFT:' px, gap ',\n\t\tGAP:'Cards gap',\n\t\t\n\t\tBORDER:'Border',\n\t\tBORDER_PLC:'#RRGGBB',\n\t\t\n\t\tBG:'B-ground',\n\t\tBG_PLC:'#RRGGBB',\n\t\t\n\t\tRATIO:'Pic ratio',\n\t\tRATIO_PLC:'X:Y',\n\t\t\n\t\tBULLET:'Bullets',\n\t\tBULLET_MARKER:'Char',\n\t\tBULLET_COLOR:'#RRGGBB',\n\t\t\n\t\tPAD:'Card inset',\n\t\tPAD_PLC:'i.e. 20px',\n    \n    PAD0:'Text pad',\n\t\tPAD0_PLC:'i.e. 20px'\n\t},\n\n\tru:{\n\t\tH1:'Настройки блока карточек',\n\t\t\n\t\tTITLE:'Заголовок',\n\t\tTITLE_PLC:'Текст с разметкой',\n\t\t\n\t\tMODE:'Показать',\n\t\tMODE_TAGS:{tags:[[\n      {'фото вверху':'normal'},\n      {'Иконка вверху':'icon'},\n      {'Иконка слева':'small'},\n    ]]},\n\t\t\n\t\tALIGN:'Ровнять',\n\t\tALIGN_TAGS:{\n\t\t\ttags:[[{'По центру':'center'}, {'Центр-налево':'center-left'}]],\n\t\t\tempty:{'Слева':'left'},\n\t\t\ttagshim:''\n\t\t},\n\t\t\n\t\tANIMATE:'Эффект',\n\t\tANIMATE_TAGS:{\n\t\t\ttags:[[{\"Zoom\":'zoom'},{\"Flip\":'flip'},{\"Drop\":'drop'},{\"Fade-in\":'fade'}]],\n\t\t\tempty:{\"Нет\":''}\n\t\t},\n\t\t\n\t\tWIDTH:'Ширина',\n\t\tWIDTH_AFT:' px, просвет',\n\t\tGAP:'Просвет',\n\t\t\n\t\tBORDER:'Рамка',\n\t\tBORDER_PLC:'#RRGGBB',\n\t\t\n\t\tBG:'Фон',\n\t\tBG_PLC:'#RRGGBB',\n\t\t\n\t\tRATIO:'Аспект фото',\n\t\tRATIO_PLC:'X:Y',\n\t\t\n\t\tBULLET:'Список',\n\t\tBULLET_MARKER:'Буллет',\n\t\tBULLET_COLOR:'#RRGGBB',\n\t\t\n\t\tPAD:'Отступы',\n\t\tPAD_PLC:'напр. 20px',\n    \n    PAD0:'Text pad',\n\t\tPAD0_PLC:'напр. 20px'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1538693393548","id": ".Opts.Remote","type": "js","data": "({\n  data:{\n    query:\t'',\n\t\troot:\t\t'',\n    limit:\t'30',\n    trim:\t\t'1000',\n    transform:''\n  },\n\tparams:{delay:20},\n\tinit: function($o){\n\t\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tvar L = that.Lang = that.Lang[lang];\n\t\t\n\t\t$o.formgen([\n\t\t\t'<div class=\"fs140 blue-1 mb7\">'+L.H1+'</div>',\n\t\t\t{row:\"450px\", rowCss:\"my-row mb7 gray\", label:'100px', labelCss:'fs95 gray'},\n\t\t\t[L.LBL_Q,\t\t'txt#gquery.fs100',{plc:L.PLC_Q},'msg'],\n      [L.LBL_ROOT,'inp#groot.fs100',{plc:L.PLC_ROOT},'msg'],\n      [L.LBL_BIND,'txt#gbind.fs80.code.pt6',{plc:L.PLC_BIND},'msg'],\n      [L.LBL_LIMIT, \n\t\t\t \t'num#glimit.w70',{min:1, max:100}, '<span class=\"fs95\">'+L.LBL_TRIM+'</span>',\n\t\t\t\t'num#gtrim.w70.ml5',{min:10, max:10000}, '<span class=\"fs95\">'+L.TXT_TRIM+'</span>'\n\t\t\t]\n\t\t]);\n\t\t\n\t},\n  // query root limit trim transform\n\tui:{\n    '#gquery':{\n      delay:0,\n    \tbind: function(d,v,$o){\n      \t$o.height(0).height(($o[0].scrollHeight-10).clamp(59,250));\n        if (v!=null) {\n          d.query = v.trim();\n          return v;\n        }\n        return d.query;\n      }\n    },\n    \n    '#gbind':{\n      delay:0,\n    \tbind: function(d,v,$o){\n      \t$o.height(0).height(($o[0].scrollHeight-10).clamp(56,250));\n        if (v!=null) {\n          d.transform = v.trim();\n          return v;\n        }\n        return d.transform;\n      }\n    },\n    \n    '#groot':{\n    \tbind: function(d,v){\n      \tif (v!=null) {\n          d.root = v.compact();\n          return v;\n        }\n        return d.root;\n      }\n    },\n    \n    '#glimit':function(d,v){\n    \tif (v!=null) {\n      \tif (!v || isNaN(v)) d.limit = '30';\n        else d.limit = ''+(+v | 0).clamp(1,100);\n        return v;\n      }\n      return d.limit;\n    },\n    \n    '#gtrim':function(d,v){\n    \tif (v!=null) {\n      \tif (!v || isNaN(v)) d.trim = '1000';\n        else d.trim = ''+(+v | 0).clamp(10,10000);\n        return v;\n      }\n      return d.trim;\n    }\n  },\n  \n  style:{\n  \n  '\ttextarea':'word-break:break-all!important;resize:none;',\n    ' textarea.code':'font-family:Cousine;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1538693503002","id": ".Opts.Remote.Lang","type": "js","data": "({\n\ten:{\n\t\tH1:'Remote query settings',\n\t\t\n\t\tLBL_Q:\t\t\t\t'Query',\n    PLC_Q:\t\t\t\t'URL of JSON data source \\nor query://ddoc/view\\u00a0{jsonParams}',\n    ERR_Q_PREFIX:\t'Query must start with http://, https:// or query://',\n    ERR_Q_HTTP:\t\t'Invalid query URL',\n    ERR_Q_LOCAL:\t'Local query must be \\'query://ddoc/view\\u00a0{params}\\'',\n    ERR_Q_PARAMS:\t'Local query params should be valid json',\n    \n    LBL_LIMIT:\t\t'Max cards',\n    LBL_TRIM:\t\t\t', trim each to ',\n    TXT_TRIM:\t\t\t' chars ',\n    \n    LBL_ROOT:\t\t\t'Data node',\n    PLC_ROOT:\t\t\t'Cards array path in JSON, like \\'all.rows\\'',\n    \n    LBL_BIND:\t\t\t'Transform',\n    PLC_BIND: [\t\t\n      'Source data transform, multiline like ',\n      'title=value.title',\n      'photo=value.photo',\n      'desc=value.desc+&quot;!&quot;',\n    ].join('\\n')\n\t},\n\n\tru:{\n\t\tH1:'Внешний источник данных',\n\t\t\n    LBL_Q:\t\t\t\t'Запрос',\n    PLC_Q:\t\t\t\t'URL или источник JSON-данных \\nили query://ddoc/view\\u00a0{jsonParams}',\n    ERR_Q_PREFIX:\t'Запрос должен начинаться с http://, https:// or query://',\n    ERR_Q_HTTP:\t\t'Неверный URL',\n    ERR_Q_LOCAL:\t'Локальный запрос должен иметь вид \\'query://ddoc/view\\u00a0{params}\\'',\n    ERR_Q_PARAMS:\t'Невалидный JSON в параметрах локального запроса',\n    \n    LBL_LIMIT:\t\t'Карточек',\n    LBL_TRIM:\t\t\t', обрезать до ',\n    TXT_TRIM:\t\t\t' знаков ',\n    \n    LBL_ROOT:\t\t\t'Узел данных',\n    PLC_ROOT:\t\t\t'Пусть к массиву с данными, например \\'all.rows\\'',\n    \n    LBL_BIND:\t\t\t'Трансформ',\n    PLC_BIND: [\t\t\n      'Трансформ данных, например ',\n      'title=value.title',\n      'photo=value.photo',\n      'desc=value.desc+&quot;!&quot;',\n    ].join('\\n')\n\t\t\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "800","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "General cards widget for Inliner","timeout": "3000","author": "ermouth","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"collapsed": [],"padding": "auto"},"log": [[1540003740884,"update","ermouth-524yb546",122,"dev-cloudwall2"]],"id": "cw.Inliner.Ed.Widgets.Cards","stamp": 1540003895887,"creator": "ermouth-e3o7ecs0","parent": "cw-Inliner-4vx1"},{"_id": "cw-Inliner-Ed-Widgets-Code-1ccd","_rev": "29-fa6ca2e763f2682cc9fdd23c27260c45","name": "Inliner.Ed.Widgets.Code","title": "⊛ Inliner Code","type": "manifest","desc": "Code sample widget, formerly was a built-in type","beta": false,"tags": ["Inliner"],"manifest": {"id": "cw.Inliner.Ed.Widgets.Code","build": 2,"name": "Code sample","require": [{"window.CodeMirror": "/lib/codemirror.js"}],"meta": {},"params": {"restyle": 200},"data": {"title": "","start": "folded","folded": true,"type": "inliner-codesample","src": [{"id": "","type": "javascript","text": ""}]},"Rows": [],"Build": "function () {\n    var that = this,\n        d = that.data;\n    if (!d.folded || !d.title) that.Rows = d.src.slice(0);\n    else that.Rows.length = 0;\n  }","RT": "function (key) {\n    return null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n  }","Cm": "function ($o,mode,lineNums,theme) {\n    var that = this;\n    CodeMirror.fromTextArea($o[0], {\n      mode: \t\t\t\t\tmode,\n      lineNumbers:\t\tlineNums === undefined?true:!!lineNums,\n      lineWrapping:\t\ttrue,\n      indentWithTabs: false,\n      indentUnit:\t\t\t2,\n      tabSize:\t\t\t\t2,\n      theme: \t\t\t\t\ttheme||'default',\n      readOnly: \t\t\t!!that._compiled\n    });\n  }","ui": {"#tfold": {"delay": 50,"bind": "function (d,v) {\n\t\t\tvar that = this;\n      if (v!=null) {\n        d.folded = !d.folded;\n        that.Build();\n      }\n      var t = d.title;\n      \n      return '<span class=\"fs70 o40 lh100 w15 dib\">{1}</span>\\u00a0{2}'.assign(\n      \td.folded?'►':'▼',\n        t.length > 1?t.replace(/^\\s*\\/\\//,''):d.folded?that.lang.BTN_UNFOLD:that.lang.BTN_FOLD\n      );\n    }","events": "click.my","css": {"hide": "function (d) {return !d.title}"}},"#tpanel": {"bind": "this.Rows","manifest": "this.CodeBlock","list": "<div></div>","watch": "#tfold"},"#btn-gopts": {"bind": "function (d,v,$o) {\n      var that = this;\n      if(v!=null) {\n        if ($o.data('modal')) $o.modal(true);\n        else {\n          var root = $o.parents('#medium');\n          $o.modal({\n            root:root.size()?root:undefined,\n            bound:0,\n            width:350,\n            manifest:that.Opts,\n            data:Object.clone(d, true),\n            align:'right:38px;',\n            screen:'rgba(255,255,255,0.65)',\n            nose:'right',\n            focus:false,\n            enter:true,\n            esc:true\n          })\n          .then(function(res){\n\t\t\t\t\t\t$.extend(d, res);\n            d.src = d.src.filter(function(e){return !!e.type});\n            that.Build();\n            that.my.check('#tfold');\n            that.my.recalc('#tpanel');\n            that.my.restyle();\n          });\n        }\n      }\n    }","css": {"self:hide": "function () {return !!this._compiled}"}}},"style": {"   ": "function () {\n    var that = this, \n        th = that.meta.theme,\n        b1 = 'border:1px solid #e0e0e8;';\n    if (th) b1 = th.themes.frame+';';\n    return {\n    \t' .b1':b1,\n      ' #btn-gopts':!that.data.title?'top:5px;right:5px;':'top:0;right:0;',\n    }\n  }"," .in-w-btn-box": {"": "width:50px;z-index:+10;position: absolute; top: 0px; right:0px;"," #btn-gopts": "position: absolute; font-size:17px;z-index:+3;border-radius:100px!important;padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;transition:top 0.1s, right 0.1s;"," #btn-gopts:hover": "opacity:1;"}," #tpanel>div": "margin-top:-1px;"," #tpanel>div:first-child": "margin-top:0px;"},"lang": {"en": {"BTN_FOLD": "Hide code","BTN_UNFOLD": "Show code"},"ru": {"BTN_FOLD": "Показать код","BTN_UNFOLD": "Скрыть код"}},"Lang": {"en": {"APPTITLE": "Code sample"},"ru": {"APPTITLE": "Пример кода"}},"init": "function ($o) {\n  var that = this,\n      d = that.data;\n\n  that.CodeBlock.RT = that.RT;\n\n  // old format convert\n  if (d.tab && d.tab.length) {\n    d.src = d.tab.map(function(t){\n      return {\n        id: \t_r4(),\n        type:\tt=='js'?'javascript':t=='html'?'htmlmixed':t,\n        text:\td[t]\n      }\n    });\n    delete d.tab;\n    delete d.js;\n    delete d.css;\n    delete d.html;\n  }\n  else {\n    d.src.forEach(function(r){if(!r.id) r.id = _r4();})\n  }\n\n  // Build list\n  that.Build();\n\n  // HTML\n  $o.html(that.HTML.assign(that.lang));\n\n  function _r4() {\n    return Number.random(46656,1679615).toString(36);\n  }\n}","HTML": "<div class=\"in-w-btn-box\"><button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button></div><div id=\"tfold\" class=\"blue cp mt-5 mb2\"></div><section id=\"tpanel\" class=\"\"></section>","Ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB8ZJREFUeNrkW0uMFEUYrl0JL0EpPagxvhp0I+qp0YMSH3FGicaggR0PoIlGd/BijMbshCwcIJLFE0ZRIQSIia9ZgjESxcwoEgzGSAdfB7h00IMcMFYEFXyxfn93z3R1dVdNz0zP7IxUtqd6Zrpq6v/+739UbdXA5OQkO5fLNHoZGBjo2A+Mj48PWrZ9E25vxDWE61pcHH9zUc9hTPyF+1OoT+L9j7iO0iUE+6pYyP/aSeFJ+QPeS8YAlCsVCMiGIdgS1Hf6AjdbxL9o5qD+lLos5POHex4ACJ5DtQoDfwD19GyHK77Hy07B2NZiPn+qpwCA4BCYj+H2Ft0znEiPF+6xP04JQRd4TzdUCwMSuF5GtQmsEFMKAAS/DtVmiJOLCYzLsrgvNOct9e8CCNcVPjDxcgLXaCG/aCfJ0lUAAse2GmKuUaluQdia4FkWAsJx3aSvDoANj4ANP3QFgC2VyiUQ7U0If7cquG1bHQ9bGiDIcB4DCO93FABQnkLZXgh/uWzbtmVlrvFGhUAgMJSyFiaxviMAQPjFqD6AyPPqWgfVSfipKuQbqo7KBrHZdZynS6XS2cwAgPC3QvAqbmfVPiO6W13Wuq5UHYdF/aTYBnN4MhMAIPwNEP6AnMzk7O5TvjEIrhItxAsAYawtAMrlysWQlDKwK0LhbdZjshtAYI/DJ+wwATBo6G8Akr4RFd7qWeE143vFZ7C+DBqo/yyq+2Sb570svcRQqcyG5U4gdM9oCgAIfxUarpO9vdUHwmtAuB4jLzXLgJd89HzPN5WhrpXi5yYRhZXgz+anAgDavx1dLJWp34/FsmR/wGfizYaUDOBjIZK8L+xeVxTmLodyh4wA4IFFqPKaDvqu+AqMyFpqxIARTeP/CQv4w/AFF8jfT6vP8rZUZqIqhA27KL1blcZo+VeWLAhWUbxUnrPlqLfHAMBv3o/XC+WGXSkTYKWzUfJeOfCwkq0pQJmiPnPkK2QAJBPg98hxv3van1Dct92RiCCVxUiMZif5gLvkxY22p6qkXOGyrcIxPESLvsp01hoOyeG1x7y/XQZE307H+9siJgBELmX+en3b9Md0hFUxaEeelOi6c6rxoUoMcLzFUYHaZYjqLAc7tVscGynVDceEXIdV6gCgy4VyFtXSTEz4ghvXc2MAKPS3h43AemwSBIQPBm/SGYaLBnyh4gT5UKgD3oS2WaDtFkhKbVTzMAAgG1cNbCsAwk4x5qhixZAaBRY0pKusuGAAbgNte7TVJVOq9j36R1fXR9A2Zk6yAoTPCs5CVhgZEJYFKgDz0jCABjPhDcYsuG+rFrPSxn6N9gnAEW4T6+tAJJkYfUbjIqdJvzvSMI/gM4K850wNgLlpGFA1CM8DJ5VL5UREAgA5oxcfRt/DuHECJ+tqWEHmKNL4B+7JfKYWBs9vN9CkF15H/+FUTW1Wc4DthWoMdbZkAuJ0GuPnWv0T/RxcKemvhj8rlyqvMJmBIe7r+jsj+4BTkV/S9DCKGO1R0NU7QBpktVHcdtOHPyfIA3SOsDUTDGWuhcGTskMxYUgUtAGEkIQ1xW0ODzYup7cx+uvtfyPauw0EtwPv31xWIP4p5vN/jExO1hlwLMKAlOml75gsYxIU+yyW++e0gOtkJ23bTSZDynL5MSUMiqO1QTSVydXDHg3GDtJgYU6MnGpq+uvyCrsFB6hIdVTNA440Qj3tAEcAhuBWssPyQp/QTn50Tte3bastv68w4EgEgEI+75Yrh47j9rLaw+1MiOS4LUzhD6wxTT5GM5waKwAcTJoO75NTzMwWI1qc/GRdJJHO4v6zBADEJ+E8RXRgBG6c/l0CILqPQBwuFvK/xJbEUN7Dl69SniwyMIOEdSkY83jH1v6MAESd8juJi6K046pcqezB7bKaGdhZrwvmRlm3i7fxTKY/Y2/J36vL4tuTadO/xY3sJxIfIQH6SQsAWPAhHvqm7rNct6+FF3GHPq4+k/TP0Q0yC/qZB44jrziJ/VDw5w0BcB1nFx4+lNxJH1GfkrBQe7SRcnXSczEAgt1VT5HDqDkRtw9NwYnuHtsB7R9MBUDgC8AA8VroC7TbVXuyVKOsPQFZtOFn0ECh51F9F3bq9o3mo9T3ttH+3DQApULhNBojVRO/10Go9rY/8HaPRrfKjUP4j01tTLvEyBRo2ligBYT6slSPOsWErbO74dDHGrVLu1P0UeStO+n5elKXsxnvIdormt+Pd/ci6fnT1K7ZvcJPoHodQJxXn8v0wHbZ+DZZtg8ue2maUyWt7BZ/ENXb3qaj2npGl7bJJ83w4pmq2AUsVjbSfMsABCDcDADexe01kZmtZXVlXwGFYxJc0TpyFrEONr8+zS7xtgCgsqVcmQfFbwMQy9TvOgWERnAqx/HtCjjsfc32mcWZoYcAwibcXql+l8XRGRHM5pJnpt6xus1AZE2hkD/ZSv+ZnBqj7SYQ8zncPoProsS1EB7uOeTBBzxp3u4fGfPTb33mSXn9Hjy4Flr/uh1WZXpuEGYxB3KtYv65wfkdMH9KzHajfhGCf5tFh508OUp7cFbiWgIwrm7D8ikLpSlsGeTY1SrVuw6AAgZFiztY5Oyw5xjo39OzgizzN//fcyI4O8xxiS+E635ZLBb/7tTYvIPjU3l6nM4fTmUSVWfAuVz+E2AAzxzLiWnJS7QAAAAASUVORK5CYII=","CodeBlock": {"data": {"id": "","type": "text","text": ""},"init": "function ($o) {\n    var that = this,\n        d = that.data;\n    $o.html(that.HTML);\n  }","ui": {"textarea.tcode": {"init": "function ($o) {\n        var that = this,\n            d = that.data;\n        this.RT('Cm')($o, d.type, true, 'default');\n      }","bind": "text"}},"HTML": "<section class=\"b1\"><textarea class=\"tcode w100p\"></textarea></section>"},"Opts": {"lang": {"en": {"PLC_TITLE": "Code sample title","ERR_TITLE": "200 chars max","BTN_APPLY": "Apply","BTN_CANCEL": "Cancel","SEL_TYPES": [{"id": "javascript","text": "JS"},{"id": "css","text": "CSS"},{"id": "htmlmixed","text": "HTML"},{"id": "erlang","text": "Erlang"},{"id": "text","text": "Text"},{"id": "","text": "Remove"}]},"ru": {"PLC_TITLE": "Заголовок блока","ERR_TITLE": "200 символов максимум","BTN_APPLY": "Применить","BTN_CANCEL": "Отмена","SEL_TYPES": [{"id": "javascript","text": "JS"},{"id": "css","text": "CSS"},{"id": "htmlmixed","text": "HTML"},{"id": "erlang","text": "Erlang"},{"id": "text","text": "Text"},{"id": "","text": "Удалить"}]}},"init": "function ($o) {\n  \tvar that = this,\n        d = that.data;\n    \n    that.Row.lang = that.lang;\n    \n    $o.html($.my.formgen(that.HTML).assign(that.lang));\n  }","ui": {"#otitle": "title","#orows": {"bind": "src","list": "<div class=\"pt4\"></div>","manifest": "this.Row","id": ["id","type"],"watch": "#btn-add"},"#btn-add": "function (d,v) {\n    \tif (v!=null) {\n      \tthis.my.insert('#orows',{id:Number.random(46656,1679615).toString(36), type:'text', text:''}, 1e6);\n      }\n    }","#btn-apply": "function (d,v) {\n    \tif (v!=null) this.my.commit();\n    }","#btn-cancel": "function (d,v) {\n    \tif (v!=null) this.my.cancel();\n    }"},"Row": {"init": ["<input type=\"text\" id=\"rtype\" class=\"w100p fs90\" value=\"\">"],"ui": {"#rtype": {"init": "function ($o) {\n        \t$o.select2({\n          \tmultiple:false,\n            data:this.lang.SEL_TYPES,\n            minimumResultsForSearch:100\n          });\n        }","bind": "type"}}},"HTML": [{"row": "100%"},["","inp#otitle",{"plc": "{PLC_TITLE}"},"msg"],"<div id=\"orows\"></div>","<div class=\"btd pt15 mt15 fs90\">","<div class=\"fr zi2\"><button id=\"btn-cancel\">{BTN_CANCEL}</button></div>",["","but#btn-add.green.mr2.bold.w40.pl0.pr0",{"txt": "＋"},"but#btn-apply",{"txt": "{BTN_APPLY}"}],"</div>"],"style": {"": "font-size:16px;"}}},"raw": {"name": "Inliner.Ed.Widgets.Code","title": "⊛ Inliner Code","version": "4.0","build": 2,"com": [{"stamp": "1464231880640","id": "Root","type": "js","data": "({\n  id:\t\t\t'in.Code',\n  name:\t\t'Code sample',\n  require:[{'window.CodeMirror':'/lib/codemirror.js'}],  \n  meta:{},\n  params:{restyle:200},\n\n  data:{\n    title:\t'',\n    start: \t'folded',\n    folded:\ttrue,\n    type:\t\t'inliner-codesample',\n    src:[\n      {id:'', type:'javascript', text:''}\n    ]\n  },\n\n  Rows:[],\n\n  Build:function (){\n    var that = this,\n        d = that.data;\n    if (!d.folded || !d.title) that.Rows = d.src.slice(0);\n    else that.Rows.length = 0;\n  },\n\n  RT: function(key){\n    return null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n  },\n\n  Cm: function ($o, mode, lineNums, theme) {\n    var that = this;\n    CodeMirror.fromTextArea($o[0], {\n      mode: \t\t\t\t\tmode,\n      lineNumbers:\t\tlineNums === undefined?true:!!lineNums,\n      lineWrapping:\t\ttrue,\n      indentWithTabs: false,\n      indentUnit:\t\t\t2,\n      tabSize:\t\t\t\t2,\n      theme: \t\t\t\t\ttheme||'default',\n      readOnly: \t\t\t!!that._compiled\n    });\n  },\n\n  ui: {},\n\n  style: {}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1530518990120","id": ".lang","type": "js","data": "({\n\ten:{\n  \tBTN_FOLD:'Hide code',\n    BTN_UNFOLD:'Show code'\n  },\n  ru:{\n  \tBTN_FOLD:'Показать код',\n    BTN_UNFOLD:'Скрыть код'\n  }\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1465150020040","id": ".Lang","type": "js","data": "({\n\ten:{\n\t\tAPPTITLE:'Code sample',\n\t},\n\tru:{\n\t\tAPPTITLE:'Пример кода',\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1530523050852","id": ".init","type": "js","data": "( function($o){\n  var that = this,\n      d = that.data;\n\n  that.CodeBlock.RT = that.RT;\n\n  // old format convert\n  if (d.tab && d.tab.length) {\n    d.src = d.tab.map(function(t){\n      return {\n        id: \t_r4(),\n        type:\tt=='js'?'javascript':t=='html'?'htmlmixed':t,\n        text:\td[t]\n      }\n    });\n    delete d.tab;\n    delete d.js;\n    delete d.css;\n    delete d.html;\n  }\n  else {\n    d.src.forEach(function(r){if(!r.id) r.id = _r4();})\n  }\n\n  // Build list\n  that.Build();\n\n  // HTML\n  $o.html(that.HTML.assign(that.lang));\n\n  function _r4() {\n    return Number.random(46656,1679615).toString(36);\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1464232906439","id": ".ui","type": "js","data": "({\n  '#tfold':{\n    delay:50,\n    bind:function(d,v){\n\t\t\tvar that = this;\n      if (v!=null) {\n        d.folded = !d.folded;\n        that.Build();\n      }\n      var t = d.title;\n      \n      return '<span class=\"fs70 o40 lh100 w15 dib\">{1}</span>\\u00a0{2}'.assign(\n      \td.folded?'►':'▼',\n        t.length > 1?t.replace(/^\\s*\\/\\//,''):d.folded?that.lang.BTN_UNFOLD:that.lang.BTN_FOLD\n      );\n    },\n    events:'click.my',\n    css:{\n      hide: function(d){return !d.title}\n    }\n  },\n  '#tpanel':{\n    bind:\t\t\t'this.Rows',\n    manifest:\t'this.CodeBlock',\n    list:\t\t\t'<div></div>',\n    watch:\t\t'#tfold'\n  },\n\n  \"#btn-gopts\":{\n    bind: function(d,v,$o) {\n      var that = this;\n      if(v!=null) {\n        if ($o.data('modal')) $o.modal(true);\n        else {\n          var root = $o.parents('#medium');\n          $o.modal({\n            root:root.size()?root:undefined,\n            bound:0,\n            width:350,\n            manifest:that.Opts,\n            data:Object.clone(d, true),\n            align:'right:38px;',\n            screen:'rgba(255,255,255,0.65)',\n            nose:'right',\n            focus:false,\n            enter:true,\n            esc:true\n          })\n          .then(function(res){\n\t\t\t\t\t\t$.extend(d, res);\n            d.src = d.src.filter(function(e){return !!e.type});\n            that.Build();\n            that.my.check('#tfold');\n            that.my.recalc('#tpanel');\n            that.my.restyle();\n          });\n        }\n      }\n    },\n    css:{\n      'self:hide':function(){return !!this._compiled}\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1530521757281","id": ".HTML","type": "js","data": "([\n  '<div class=\"in-w-btn-box\">',\n  \t'<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>',\n  '</div>',\n  '<div id=\"tfold\" class=\"blue cp mt-5 mb2\"></div>',\n  '<section id=\"tpanel\" class=\"\">',\n  //'<textarea class=\"w100p\" id=\"tcode\"></textarea>',\n  '</section>'\n]).join('')","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1530578479195","id": ".style","type": "js","data": "({\n  '   ':function(){\n    var that = this, \n        th = that.meta.theme,\n        b1 = 'border:1px solid #e0e0e8;';\n    if (th) b1 = th.themes.frame+';';\n    return {\n    \t' .b1':b1,\n      ' #btn-gopts':!that.data.title?'top:5px;right:5px;':'top:0;right:0;',\n    }\n  },\n  ' .in-w-btn-box':{\n    '':'width:50px;z-index:+10;position: absolute; top: 0px; right:0px;',\n\n    ' #btn-gopts':'position: absolute; font-size:17px;z-index:+3;border-radius:100px!important;'\n    +'padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;transition:top 0.1s, right 0.1s;',\n    ' #btn-gopts:hover':'opacity:1;'\n  },\n\n  ' #tpanel>div':'margin-top:-1px;',\n  ' #tpanel>div:first-child':'margin-top:0px;',\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1465148710752","id": ".Ico","type": "text","data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB8ZJREFUeNrkW0uMFEUYrl0JL0EpPagxvhp0I+qp0YMSH3FGicaggR0PoIlGd/BijMbshCwcIJLFE0ZRIQSIia9ZgjESxcwoEgzGSAdfB7h00IMcMFYEFXyxfn93z3R1dVdNz0zP7IxUtqd6Zrpq6v/+739UbdXA5OQkO5fLNHoZGBjo2A+Mj48PWrZ9E25vxDWE61pcHH9zUc9hTPyF+1OoT+L9j7iO0iUE+6pYyP/aSeFJ+QPeS8YAlCsVCMiGIdgS1Hf6AjdbxL9o5qD+lLos5POHex4ACJ5DtQoDfwD19GyHK77Hy07B2NZiPn+qpwCA4BCYj+H2Ft0znEiPF+6xP04JQRd4TzdUCwMSuF5GtQmsEFMKAAS/DtVmiJOLCYzLsrgvNOct9e8CCNcVPjDxcgLXaCG/aCfJ0lUAAse2GmKuUaluQdia4FkWAsJx3aSvDoANj4ANP3QFgC2VyiUQ7U0If7cquG1bHQ9bGiDIcB4DCO93FABQnkLZXgh/uWzbtmVlrvFGhUAgMJSyFiaxviMAQPjFqD6AyPPqWgfVSfipKuQbqo7KBrHZdZynS6XS2cwAgPC3QvAqbmfVPiO6W13Wuq5UHYdF/aTYBnN4MhMAIPwNEP6AnMzk7O5TvjEIrhItxAsAYawtAMrlysWQlDKwK0LhbdZjshtAYI/DJ+wwATBo6G8Akr4RFd7qWeE143vFZ7C+DBqo/yyq+2Sb570svcRQqcyG5U4gdM9oCgAIfxUarpO9vdUHwmtAuB4jLzXLgJd89HzPN5WhrpXi5yYRhZXgz+anAgDavx1dLJWp34/FsmR/wGfizYaUDOBjIZK8L+xeVxTmLodyh4wA4IFFqPKaDvqu+AqMyFpqxIARTeP/CQv4w/AFF8jfT6vP8rZUZqIqhA27KL1blcZo+VeWLAhWUbxUnrPlqLfHAMBv3o/XC+WGXSkTYKWzUfJeOfCwkq0pQJmiPnPkK2QAJBPg98hxv3van1Dct92RiCCVxUiMZif5gLvkxY22p6qkXOGyrcIxPESLvsp01hoOyeG1x7y/XQZE307H+9siJgBELmX+en3b9Md0hFUxaEeelOi6c6rxoUoMcLzFUYHaZYjqLAc7tVscGynVDceEXIdV6gCgy4VyFtXSTEz4ghvXc2MAKPS3h43AemwSBIQPBm/SGYaLBnyh4gT5UKgD3oS2WaDtFkhKbVTzMAAgG1cNbCsAwk4x5qhixZAaBRY0pKusuGAAbgNte7TVJVOq9j36R1fXR9A2Zk6yAoTPCs5CVhgZEJYFKgDz0jCABjPhDcYsuG+rFrPSxn6N9gnAEW4T6+tAJJkYfUbjIqdJvzvSMI/gM4K850wNgLlpGFA1CM8DJ5VL5UREAgA5oxcfRt/DuHECJ+tqWEHmKNL4B+7JfKYWBs9vN9CkF15H/+FUTW1Wc4DthWoMdbZkAuJ0GuPnWv0T/RxcKemvhj8rlyqvMJmBIe7r+jsj+4BTkV/S9DCKGO1R0NU7QBpktVHcdtOHPyfIA3SOsDUTDGWuhcGTskMxYUgUtAGEkIQ1xW0ODzYup7cx+uvtfyPauw0EtwPv31xWIP4p5vN/jExO1hlwLMKAlOml75gsYxIU+yyW++e0gOtkJ23bTSZDynL5MSUMiqO1QTSVydXDHg3GDtJgYU6MnGpq+uvyCrsFB6hIdVTNA440Qj3tAEcAhuBWssPyQp/QTn50Tte3bastv68w4EgEgEI+75Yrh47j9rLaw+1MiOS4LUzhD6wxTT5GM5waKwAcTJoO75NTzMwWI1qc/GRdJJHO4v6zBADEJ+E8RXRgBG6c/l0CILqPQBwuFvK/xJbEUN7Dl69SniwyMIOEdSkY83jH1v6MAESd8juJi6K046pcqezB7bKaGdhZrwvmRlm3i7fxTKY/Y2/J36vL4tuTadO/xY3sJxIfIQH6SQsAWPAhHvqm7rNct6+FF3GHPq4+k/TP0Q0yC/qZB44jrziJ/VDw5w0BcB1nFx4+lNxJH1GfkrBQe7SRcnXSczEAgt1VT5HDqDkRtw9NwYnuHtsB7R9MBUDgC8AA8VroC7TbVXuyVKOsPQFZtOFn0ECh51F9F3bq9o3mo9T3ttH+3DQApULhNBojVRO/10Go9rY/8HaPRrfKjUP4j01tTLvEyBRo2ligBYT6slSPOsWErbO74dDHGrVLu1P0UeStO+n5elKXsxnvIdormt+Pd/ci6fnT1K7ZvcJPoHodQJxXn8v0wHbZ+DZZtg8ue2maUyWt7BZ/ENXb3qaj2npGl7bJJ83w4pmq2AUsVjbSfMsABCDcDADexe01kZmtZXVlXwGFYxJc0TpyFrEONr8+zS7xtgCgsqVcmQfFbwMQy9TvOgWERnAqx/HtCjjsfc32mcWZoYcAwibcXql+l8XRGRHM5pJnpt6xus1AZE2hkD/ZSv+ZnBqj7SYQ8zncPoProsS1EB7uOeTBBzxp3u4fGfPTb33mSXn9Hjy4Flr/uh1WZXpuEGYxB3KtYv65wfkdMH9KzHajfhGCf5tFh508OUp7cFbiWgIwrm7D8ikLpSlsGeTY1SrVuw6AAgZFiztY5Oyw5xjo39OzgizzN//fcyI4O8xxiS+E635ZLBb/7tTYvIPjU3l6nM4fTmUSVWfAuVz+E2AAzxzLiWnJS7QAAAAASUVORK5CYII=","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1530520157646","id": ".CodeBlock","type": "js","data": "({\n  data:{id:'',type:'text',text:''},\n  init: function($o){\n    var that = this,\n        d = that.data;\n    $o.html(that.HTML);\n  },\n  ui:{\n    'textarea.tcode':{\n      init: function($o){\n        var that = this,\n            d = that.data;\n        this.RT('Cm')($o, d.type, true, 'default');\n      },\n      bind:'text'\n    }\n  },\n  HTML:[\n  \t'<section class=\"b1\">',\n\t\t\t'<textarea class=\"tcode w100p\"></textarea>',\n\t\t'</section>'\n  ].join('')\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1530575401279","id": ".Opts","type": "js","data": "({\n\tlang:{\n  \ten:{\n    \tPLC_TITLE:\t'Code sample title',\n      ERR_TITLE:\t'200 chars max',\n      BTN_APPLY:\t'Apply',\n      BTN_CANCEL:\t'Cancel',\n      SEL_TYPES:[\n        {id:'javascript', text:'JS'},\n        {id:'css', \t\t\t\ttext:'CSS'},\n        {id:'htmlmixed',\ttext:'HTML'},\n        {id:'erlang',\t\t\ttext:'Erlang'},\n        {id:'text',\t\t\t\ttext:'Text'},\n        {id:'',\t\t\t\t\t\ttext:'Remove'}\n      ]\n    },\n    \n    ru:{\n    \tPLC_TITLE:\t'Заголовок блока',\n      ERR_TITLE:\t'200 символов максимум',\n      BTN_APPLY:\t'Применить',\n      BTN_CANCEL:\t'Отмена',\n      SEL_TYPES:[\n        {id:'javascript', text:'JS'},\n        {id:'css', \t\t\t\ttext:'CSS'},\n        {id:'htmlmixed',\ttext:'HTML'},\n        {id:'erlang',\t\t\ttext:'Erlang'},\n        {id:'text',\t\t\t\ttext:'Text'},\n        {id:'',\t\t\t\t\t\ttext:'Удалить'}\n      ]\n    }\n  },\n  \n  init: function($o){\n  \tvar that = this,\n        d = that.data;\n    \n    that.Row.lang = that.lang;\n    \n    $o.html($.my.formgen(that.HTML).assign(that.lang));\n  },\n  \n  ui:{\n    '#otitle':'title',\n    \n    '#orows':{\n    \tbind:'src',\n      list:'<div class=\"pt4\"></div>',\n      manifest:'this.Row',\n      id:['id','type'],\n      watch:'#btn-add'\n    },\n    \n    '#btn-add':function(d,v){\n    \tif (v!=null) {\n      \tthis.my.insert('#orows',{id:Number.random(46656,1679615).toString(36), type:'text', text:''}, 1e6);\n      }\n    },\n    \n\t\t'#btn-apply':function(d,v){\n    \tif (v!=null) this.my.commit();\n    },\n    '#btn-cancel':function(d,v){\n    \tif (v!=null) this.my.cancel();\n    }\n\t},\n  \n  Row:{\n  \tinit:[\n    \t'<input type=\"text\" id=\"rtype\" class=\"w100p fs90\" value=\"\">'\n    ],\n    ui:{\n    \t'#rtype':{\n      \tinit: function($o){\n        \t$o.select2({\n          \tmultiple:false,\n            data:this.lang.SEL_TYPES,\n            minimumResultsForSearch:100\n          });\n        },\n        bind:'type'\n      }\n    }\n  },\n  \n  HTML:[\n    {row:'100%'},\n    ['', 'inp#otitle',{plc:'{PLC_TITLE}'},'msg'],\n    '<div id=\"orows\"></div>',\n    '<div class=\"btd pt15 mt15 fs90\">',\n      '<div class=\"fr zi2\"><button id=\"btn-cancel\">{BTN_CANCEL}</button></div>',\n      [\n        '',\n        'but#btn-add.green.mr2.bold.w40.pl0.pr0', {txt:'＋'},\n        'but#btn-apply', {txt:'{BTN_APPLY}'}\n      ],\n    '</div>'\n  ],\n  \n  style:{\n  \t'':'font-size:16px;'\n  }\n})","active": true,"err": [],"opts": [],"color": ["teal"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "800","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Code sample widget, formerly was a built-in type","timeout": "3000","author": "ermouth","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"collapsed": [],"padding": "auto"},"log": [[1536876416726,"update","admin-czpbhuup",29,"dev-cloudwall2"]],"id": "cw.Inliner.Ed.Widgets.Code","stamp": 1536858187826,"creator": "ermouth-e3o7ecs0","parent": "cw-Inliner-4vx1"},{"_id": "cw-Inliner-Ed-Widgets-Files-1ccd","_rev": "5-dc96b462d71e26adb314824e09f79933","name": "Inliner.Ed.Widgets.Files","title": "⊛ Inliner Files","type": "manifest","desc": "Inliner ‘files to download’ widget","beta": false,"tags": ["Inliner"],"manifest": {"id": "cw.Inliner.Ed.Widgets.Files","build": 3,"name": "Files to download","defaultFormat": {"format": ["right200"],"css": ["Frame"]},"params": {"restyle": 200},"data": {"type": "inliner-files","items": [],"title": "","width": "300","gap": "2","align": "left"},"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t// HTML\n\t\t$o.html(that.HTML.join(''));\n\t\t\n\t\t// Attaches\n\t\tif (that.Att) return that.GetAtts();\n\t}","Url": {},"ui": {"#oltitle": {"bind": "function (d) {\n\t\t\t\t//var tag = /^(large|normal)$/.test(d.mode+'')?'h2':'h3';\n\t\t\t\tvar tag = 'h3';\n\t\t\t\treturn d.title?'<'+tag+'>'+d.title+'</'+tag+'>':'';\n\t\t\t}","watch": "#cards"},"#cards": {"bind": "function (d) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn d.items.map(function(e){\n\t\t\t\t\treturn that.TRow.assign({\n\t\t\t\t\t\turl:(that.Url[e.url]||e.url),\n\t\t\t\t\t\tdesc:e.desc,\n\t\t\t\t\t\text:e.url.split('.').last().toUpperCase()\n\t\t\t\t\t});\n\t\t\t\t}).join('');\n\t\t\t}"},"#nocards": {"bind": "this.Lang.EMPTY","watch": "#cards","css": {"hide": "function (d) { return !!d.items.length }"}},"#btn-gopts": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif(v!=null) {\n\t\t\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar root = $o.parents('#medium');\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\troot:root.size()?root:undefined,\n\t\t\t\t\t\t\tbound:0,\n\t\t\t\t\t\t\twidth:675,\n\t\t\t\t\t\t\tmanifest:$.extend(true, {}, that.Opts, {Att:that.Att}),\n\t\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\t\talign:'right:38px;',\n\t\t\t\t\t\t\tscreen:'rgba(255,255,255,0.65)',\n\t\t\t\t\t\t\tnose:'right',\n\t\t\t\t\t\t\tfocus:false,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\tesc:true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t\tthat.GetAtts().then(function(){\n\t\t\t\t\t\t\t\tthat.my.check(\"#cards\");\n\t\t\t\t\t\t\t\tthat.my.root().my('restyle');\n\t\t\t\t\t\t\t\tthat.my.root().trigger(\"change\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}","css": {"self:hide": "function () {return !!this._compiled}"}}},"HTML": ["<div class=\"in-w-btn-box\">","<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>","</div>","<div id=\"oltitle\"></div>","<div class=\"in-w-files-box\">","<div id=\"cards\" class=\"in-w-files\"></div>","<div id=\"nocards\" class=\"hide in-w-empty\"></div>","</div>"],"style": {" .in-w-files-box": "width:100%;overflow:hidden;"," .in-w-empty": "opacity:0.7;text-align:center;"," .in-w-btn-box": {"": "width:100%;z-index:+10;position: absolute; top: 0px; right:0px;"," #btn-gopts": "position: absolute; top: 5px; right:5px; font-size:17px;z-index:+3;border-radius:100px!important;padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;"," #btn-gopts:hover": "opacity:1;"}," table": {"": "margin:0!important;width:100%!important;"," td": "border:none!important;padding:0!important;"},"": {" .filecard": "display:inline-block; vertical-align:top;overflow:hidden;"," ": "function ($o) {\n\t\t\tvar w0 = $o.width(),\n\t\t\t\t\tw = (w0/Math.round(w0/this.data.width-0.45)|0)-(this.data.gap|0),\n\t\t\t\t\tg0 = (this.data.gap|0)+'px ',\n\t\t\t\t\tg1 = (this.data.gap/2|0)+'px ',\n\t\t\t\t\talign = this.data.align+'';\n\n\t\t\treturn {\n\t\t\t\t' .filecard':{\n\t\t\t\t\t'':'width:'+w+'px;margin:0 '+g1 + g0 + g1 +';',\n\t\t\t\t\t//' img#pic':'width:100%;height:'+(w/4*3|0)+'px;',\n\t\t\t\t\t//' h4':'margin:0 0 0.5em 0!important;'\n\t\t\t\t\t' .olabel':'display:inline-block;border-radius:1px;border:1px solid gray; background:white;'\n\t\t\t\t\t+'padding:1px 5px 2px 5px; font-size:75%;color:gray;line-height:1.1em; margin: 0.08em 0 0 0;vertical-align:top;',\n\t\t\t\t\t' .clabel':'width:3em!important;padding-right:0.2em!important;'\n\t\t\t\t},\n\t\t\t\t' #oltitle':{\n\t\t\t\t\t'':'margin-bottom:'+g1+';padding:0 '+g1+g1+g1+';',\n\t\t\t\t\t' h3':'text-align:'+align+';margin:0!important;',\n\t\t\t\t\t' h2':'text-align:'+align+';margin:0!important;'\n\t\t\t\t}\n\t\t\t};\n\t\t}"}},"GetAtts": "function () {\n\tvar that = this,\n\t\t\tpi = $.Deferred(),\n\t\t\td = that.data,\n\t\t\tpis = [],\n\t\t\tatts = that.Att(null);\n\n\t//Prepare session urls\n\tif (!d.items.length || !Object.size(atts)) pi.resolve();\n\telse {\n\t\td.items.forEach(function(e){\n\t\t\tvar s = e.url;\n\t\t\tif (atts[s]) {\n\t\t\t\tvar u = that.Att(s, 'url');\n\t\t\t\tif (typeof u == 'string') that.Url[s] = u;\n\t\t\t\telse {\n\t\t\t\t\tu.then(function(res){ that.Url[s] = res; });\n\t\t\t\t\tpis.push(u);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (!pis.length) pi.resolve();\n\t\telse {\n\t\t\t$.when.apply(null, pis).done(function(){ pi.resolve(); }.debounce(1));\n\t\t}\n\t}\n\n\treturn pi.promise();\n}","To": {"data": "function (item,options) {\n\t\tvar that = this,\n\t\t\t\td = item,\n\t\t\t\th = '',\n\t\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\t\topts = Object.merge(\n\t\t\t\t\t{path:''}, \n\t\t\t\t\tObject.isObject(options)?options:{}\t\t\t\t\t\t\n\t\t\t\t);\n\t\tvar obj, s = item.data.replace(/^\\(|\\)$/g,'');\n\t\t\n\t\ttry {\n\t\t\tobj = JSON.parse(s);\n\t\t} catch(e){}\n\t\t\n\t\tif (!Object.isObject(obj)) return item.data;\n\t\t\t\t\n\t\tif (opts.path || opts.Urls) {\n\t\t\tobj.items = obj.items.map(function(e){\n\t\t\t\tvar s = e.url;\n\t\t\t\tif ((s+'').to(1)=='/' || /^http[s]:/.test(s+'')) return e;\n\t\t\t\te.url = opts.Urls?opts.Urls[s]:(opts.path+s);\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\t\t\n\t\treturn '('+JSON.stringify(obj)+')';\n\t}","files": "function (data) {\n\t\tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\tif (!/^http[s]:\\/\\//.test(e.url)) list[e.url] = true;\n\t\t});\n\t\treturn list;\n\t}"},"TRow": "<div class=\"filecard\">\n\t<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n\t\t<tbody><tr>\n\t\t\t<td class=\"clabel\"><div class=\"olabel\">{ext}</div></td>\n\t\t\t<td><div class=\"olink\"><a href=\"{url}\" target=\"_blank\">{desc}</a></div></td>\n\t\t</tr></tbody>\n\t</table>\n</div>","Lang": {"en": {"APPTITLE": "Files to download","EMPTY": "Set up list of files to download using button at right"},"ru": {"APPTITLE": "Файлы для скачивания","EMPTY": "Настройте список файлов для скачивания кнопкой справа"}},"Opts": {"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t$o.html(that.HTML.join('').assign(that.Lang));\n\t\t\n\t\tif (that.Att) that.P = that.Att(null);\n\t}","P": {},"ui": {"#gitems": {"bind": "items","init": "function ($o) {\n\t\t\t\t$o.sortable({handle:\"#gpreview\"});\n\t\t\t}","list": "<div class=\"fs80\"></div>","manifest": {"inherit": ["P","Att","Lang"],"init": "function ($o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\t$o.html([\n\t\t\t\t\t\t'<div id=\"gpreview\" class=\"dib vat br2 mt4 h32 w20 cm\"><span class=\"fi-list o50\"></span></div>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gurl\" class=\"w350 mr4 h32\"></span>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gdesc\" class=\"w300 mr0 h32\" placeholder=\"{DESC}\"></span>'\n\t\t\t\t\t].join('').assign(that.Lang));\n\t\t\t\t}","ui": {"#gurl": {"bind": "url","init": "function ($o) {\n\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t$o.select2({\n\t\t\t\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\t\t\t\tplaceholder:that.Lang.URL\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}"},"#gdesc": "desc"}},"id": ["id"],"hash": ["id","url","desc"]},"#nogitems": {"bind": "this.Lang.EMPTY","watch": "#gitems","css": {"hide": "function (d) {return !!d.items.length;}"}},"#btn-gapply": "function (d,v) {\n\t\t\tif (v!=null) {\n\t\t\t\td.items = d.items.map(function(e){if (e.url+'') {e.url=e.url+'';return e;}}).compact();\n\t\t\t\tthis.my.commit();\n\t\t\t}\n\t\t}","#btn-gadd": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tthis.my.insert('#gitems',{\n\t\t\t\t\tid:Number.random(1e12).toString(36), \n\t\t\t\t\turl:'', \n\t\t\t\t\tdesc:''\n\t\t\t\t})\t;\n\t\t\t\tvar $r = $o.my().root;\n\t\t\t\t(function(){\n\t\t\t\t\t$r.parent().trigger('layout');\n\t\t\t\t}).debounce(80)();\n\t\t\t}\n\t\t}","#ggap": "gap","#gwidth": "width"},"HTML": ["<div id=\"nogitems\" class=\"hide fs90 pt10 pb10 o80\"></div>","<div id=\"gitems\"></div>","<div id=\"gbtns\" class=\"mt10 btd pt10\">","<div class=\"fr fs80 xgray w350 tar\">","{GAP1}<input type=\"number\" class=\"w60 mr4\" id=\"ggap\">{GAP2}","<input type=\"number\" class=\"w80 mr4\" id=\"gwidth\">{GAP3}","</div>","<button id=\"btn-gadd\" class=\"fs80 mr10 w40\"><span class=\"fi-plus\"></span></button>","<button id=\"btn-gapply\" class=\"green fs80 w150\">{APPLY}</button>","</div>"],"Lang": {"en": {"EMPTY": "Add attached files or external resource URLs","APPLY": "Apply","GAP1": "Gap ","GAP2": "px, width ","GAP3": "px","URL": "Attach or web URL","DESC": "Description"},"ru": {"EMPTY": "Добавьте вложения или ссылки на внешние ресурсы","APPLY": "Применить","GAP1": "Просвет ","GAP2": "px, ширина ","GAP3": "px","URL": "Вложенный файл или URL","DESC": "Текст описания"}}},"Ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAA+CAYAAABzwahEAAAAAXNSR0IArs4c6QAAAAlwSFlzAAAHsQAAB7EBBsVhhgAADLFJREFUaAXdWwlwlNUd/79vN5tkc5CQS+4ggUC4RIxStRyBiiWJolV0SESlrdSx0+mhrVNrh+r0GGeqnTo6Re1ogVSJQ0cHooJIGPBAYBCkYGJAkhAggYSE3Mfuvv7+3+Z9u5ss2W83u4D9zyTvfe/4v/d7x/94762gCNP69dviRLItV2g0VROULSVlChKJUlCCIIqWRB3oQpuQ1IK846S5KslFR9/pbDz09ooVzkh1D22Hnza+syOHbNb7hJSLSYgb0UhUsK1gQFpJyt1Siu2u3p5Nq+5eei5YHkOVDxvw50tLY6+xpz4shVgthJg7VKPB50kHSdpGLte6lYWLt6I+xmV4NGzgL5WWxyfZ6THSxC/BLN1fd2KjbZSUGE+JcXZKsMeSLcpKVquFLJpGDqeTHA4ndff2UWtHJ7Xh78LFdj3dHy+kfeki+afiZYtKEQ95AIYFfOOW8nvQ979hOY8Z2Mn0kSNo/DVplJGSTInx9oHZQ367XBLg26i+8QJVnz2HwegaVB6IP3M5XY8+UJh3eFCmiYSQgL/67o6MOKvlDQC+3buNKMzilAljaNK4URQXG+OdNax4U0srfV1zmmowCBCAHpISwk/8ta2u8ndr1qzp82QEjgUNfP17H+VZpVYC0Nco9laLRjmTxuugo6xWlRz2sL2zi/57vIZOnm7w4S1J7iXpur8of3GNT8YQH0EB31hW/hhU0d+FIE3xHIflfP20SWSPiVZJEQ8bm1tp/9GvqaWNNaGbAL4JIrCg+I5Fe1XaUKFp4CVbdz4jNO1pxYxnOXfGFMocnaGSLmvocrnocOVJqqiuM9rFNuiE5L+3qDDvPSPxEhFTwDHTf9aEeFLxSIiLpflzZ+hSWqVdqbCuoZE+PfwVOZ0uvQsQAX2SnHcWL1v8/lB9Cgh849byn2uaeEExGTkigRbeMJOibUHbJIpF2EMWfrsOHKHePofOm2deOuXioZb9kMA3bN15B3TtO+Cml0tJSqS83Fm6Dg5774fJ8GJ7B+3Ye8gDHnu+p7d3zurlS0/5Y20IqYGZJWUfTdCE9gbSddCsixdgebPhcTXSiPg4fSVaIHuYIIRTom3Rm9auLferZvwCX7t2rUZCewvSO5mZsKV1tS1v7tdA4hV58+xpRjJm7DtZufSskeAV8Qs8K3fBoxixearcvFlTw2qQKL6RCMdmpFJ2pseQhEf4+MayD2cObGsQcLbKUPiPqmDW+NE0Jj1FfX4rwuuyryVe+m4SViGsLyPuI88GAY+zWn+PMiO4Ugwk9+wpE931v0X/NTgQudMnGz3G6r0VdshdRgIiPht/w+YPRkkhV6OgXmY2Ro73d7iprkVSJbzrs61wurvhYkH52m1EafFEmSOJsuHjRVl8JijoLqTBScocnU7VZ/rdeE17Ckz+oxj5zLgWGw3XUujeRbw9hjLHhNcqq2+VVHJA0qYviA6dJmpoI+qCa9EN9Xuhk/TB2FZB9OpnRF/UwQj18UhUl82HM7ImGOsbw3j9hrJyw6kygK9bty4K3u1Dim3OtePhYg9v1BUvDg+ekvTvg0T1ABuIeDB2VhFthsPZ6/B2xwLV9M1PgP8/flSakWgR4hH1YQCPHzt5GU5OUjmD3ctw2uD7aiSVH3cvadWwmbCmmejtQ8MDPxluskGS8l8r/QCbyWuPw+FaqQrwAYIyBFSa2fBil6TaFpweYu/yeuFF88lJs7UHl+MVsr2SqGD64DwzKWnJI3RV3NGld8gWa7fdg3qv6JLLbbDQEsVoAoRCsHS+HbOK5XkKoMNNLAiz0yVNTgtt6zGeYydq3d0S4jZEXtGX+sQ5t8zGh74E+BwsFaMUDB2rl7TxQGRAq37sOcFbJbT9PgrHXwYJWog4TrtBVqt1PodMvDQYvFmqOi/p/a+IcEwWUWruCn1g2ZRVmKC1UtZvLZ/uRihEjup1SlKCigYMO3okfQDQl4s+qyb6HIKy8pykniCkPcurpERlybHckTn91onMdosiIlYBZmlfLSRuxO46BveiDvKD/5ii0fP5kyTNGm1u3/PRdlOLW5fC68zWZxzXN1ludoRTlVgVHTJ0Yb8drR+ySEQze2D0fAhpf6DW3B7zmVDg1YHjHitJ9TLaBtvRBNXD3OTGrzTthtBr7AgMnv0ORVCxSRqrMmx4Y32z8WKGWiBsQqVkLKosmEqTYVSlwz4fDjHk/dhygcj7AAWLNcGalrOAQRsbxazhwmZlsDQBWmX+JIDle1Ivau2W9OlJCnnrVDd5MbtE1GrxTKggadd20XmfueNjWzNk6xeLZspymbnjiH4Aa2EgaM5LjBF0+zRBt0HEhkKdmARnAH2qTmGZP7Z2t6bfQUsywPfhAs8MpRibI3DpiSlECzDT8AXchbt7cSuOJvmP4/00ExI6d7z6Ci5UrC9Viy8nDZLU1j9vEqJK6OKcj2jNCPYMqHtWKWYE3MIsL9Dc+q9f5Cly94PH4oVfsGekf8+bQHTkjNtVdRcI/D8VKjqQJ9nT5703Rasu1cG6WrH3dzOp8rxDC0TitAzvFP9xHqCRdt89jdsOT2GWTl7fNqugSbqP6CkSKGamHz64JFW71RkJaEQ38R21WboJsxMXQPvxbARLwdQZiS03Z2zgFvje3SA8N9HXFwa9Qs1Jc2u7kR8oEh8t6JGbJfV5bZ+BdUI5QWIgM0cP5OT/2wZhbcgO/0V056a51XPBSE5ZoQMX5PyEyC3uz11o0QsGYqba4L3Fez2cxNuo/14gLGx5MvscbmsLOryzqqvpkN7lqo6mvZPj0juBwc7CjQvyHVlYiaX3s/8kvPGAPhnA+elXMO7Ydb99kJ2FAZnD/2xo8jokEPTx2hUrevU9zhESco9qovbseRUNXxgDYfDdOUTthub08Ga1dtP0iIDmRvglhSL4JTs4rqQ6z8JbKrP6TEPITr/i4Te87SbYqn4k0Tic+BTe6rfKcBP5MtFLbmGlO0uZpwG829G6mdc/J3b19NKZcybsQC4cDGHv0kP5RLHRnlqsvx8uxFJ3yxhPRnhix2vPGoxwYL1bPRcxgP/wzjvb4KC/rUod/aZWRcMbJicSrVzq4XlPHlGGfurlSQtTrBsTeOKUBzhsVQgZNxnA+dPV63wOgS562Gk/i+dWEaHrs4nmzSCalUV0Kx/3RYb4mYiz3zjCeV1N1X75pmpJqW/1TSVluzZDut/NCXwn/v1b5hLfRYWd2GTlTkXgior7ypbaex/vRxP9KsTlemxlQd7LCscgRLLP8TSK6oZta3sneT+uUZXCErL6ihBo7t+BY1UGaMiuqkat21jmnD8IePHyJccg8l/gTKYjVdXeUtGdeJX/r8JjwPrGZqOX0uX86c+WLesxEhAZBJwzHU09z2CrV3Ocl8onXxyD5QPD41tA/BT0YMUJo6fY25uKCxdvNxL6I36Br1q1tMMh5f1qybfhRSGDN/bLQC5XyXdnVw/tOXjUq5+yureXfuKve36Bc8FV+XmfC+l6UlViCf/5kYrIGDaqkWGEPXj9XH7gS+rs7l/RknpdDueKh+9a5GWvehq4JHAusjI/73ksFUMo8CX73i8rMKJe/rSH1xWLdQHszn2HiYVxP0npkquL71iyXyUMDAOaS5bl+WVTo+yz4a1N5cr8fpT30ZiMFONaZiDTy/nNYBm090EDpPivigoWwfO5NA3S4/6Kvv56eYwtnd4E+OUqn19M3HJdTvi9ONWAibAar5j5Ma9DHWOhjotcvylelseG2JBkCjhzuLe01LI8Lu0fAP8jxRFPPWlGViZNnTj2ss4+m6IsuWvU+xa9QxLymH5clL/oDdW/oULTwBUTftsqNPEcKhpXE/yol59uj07DcWoEiY+Ij8P2PlJ10le9SlmPN/sriwqWlJttPmjgzLhky0c3kmbB0qdrvRsaid+d8IP9MempMHNDYu3Nzoj34XDkRF09VZw8pXuORgYiULnbnd09DwT7K6WQe7duyxZ7vEh4CuAfxz2Mz5Ej31PxKwR+UjJyRGJIg8AG07mmZv03KacbmgxnwwAtZYMk8URR/sINRloQkZCBqzY2vLszW7OKP+DI714MwiD1yFc3/OYs2cSvkPgklE95G+EZXrjIPztTrXhCpLXBr36po8PxlzUrvnfRkxNcbNjAVXP/KtsxxUqWJwD+fgzCMK8CFVef8BQMiNdwVvJiUUGBxxD3KWL+I2zAVZP6FqD4u8gi7kPaAjSAk4cQScrTODve5iBnyTf79uzCzW7YLKewA/eGyCqwMC71BgtpN0MOwADCywtJmVgRifiOR+NRWLbduKZuwxJm0/I4ToEqUeZoHzl3P5i/5Gtvfv83cf2Z2RVC8z88oFWT3gvxWAAAAABJRU5ErkJggg=="},"raw": {"name": "Inliner.Ed.Widgets.Files","title": "⊛ Inliner Files","version": "4.0","build": 3,"com": [{"stamp": "1462716340287","id": "Root","type": "js","data": "({\n\tid:\"in.Files\",\n\tname:\"Files to download\",\n  defaultFormat:{format:['right200'],css:['Frame']},\n\tparams:{restyle:200},\n\tdata:{\n\t\ttype:\"inliner-files\",\n\t\titems:[],\n\t\ttitle:'',\n\t\twidth:'300',\n\t\tgap:'2',\n\t\talign:'left'\n\t},\n\tinit: function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t// HTML\n\t\t$o.html(that.HTML.join(''));\n\t\t\n\t\t// Attaches\n\t\tif (that.Att) return that.GetAtts();\n\t},\n\tUrl:{},\n\tui:{\n\t\t'#oltitle':{\n\t\t\tbind:\tfunction(d){\n\t\t\t\t//var tag = /^(large|normal)$/.test(d.mode+'')?'h2':'h3';\n\t\t\t\tvar tag = 'h3';\n\t\t\t\treturn d.title?'<'+tag+'>'+d.title+'</'+tag+'>':'';\n\t\t\t},\n\t\t\twatch:'#cards'\n\t\t},\n\t\t'#cards':{\n\t\t\tbind:function(d){\n\t\t\t\tvar that = this;\n\t\t\t\treturn d.items.map(function(e){\n\t\t\t\t\treturn that.TRow.assign({\n\t\t\t\t\t\turl:(that.Url[e.url]||e.url),\n\t\t\t\t\t\tdesc:e.desc,\n\t\t\t\t\t\text:e.url.split('.').last().toUpperCase()\n\t\t\t\t\t});\n\t\t\t\t}).join('');\n\t\t\t},\n\t\t\t//recalc:'#nocards'\n\t\t},\n\t\t'#nocards':{\n\t\t\tbind:'this.Lang.EMPTY',\n\t\t\twatch:'#cards',\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !!d.items.length }\n\t\t\t}\n\t\t},\n\t\t\"#btn-gopts\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif(v!=null) {\n\t\t\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar root = $o.parents('#medium');\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\troot:root.size()?root:undefined,\n\t\t\t\t\t\t\tbound:0,\n\t\t\t\t\t\t\twidth:675,\n\t\t\t\t\t\t\tmanifest:$.extend(true, {}, that.Opts, {Att:that.Att}),\n\t\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\t\talign:'right:38px;',\n\t\t\t\t\t\t\tscreen:'rgba(255,255,255,0.65)',\n\t\t\t\t\t\t\tnose:'right',\n\t\t\t\t\t\t\tfocus:false,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\tesc:true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t\tthat.GetAtts().then(function(){\n\t\t\t\t\t\t\t\tthat.my.check(\"#cards\");\n\t\t\t\t\t\t\t\tthat.my.root().my('restyle');\n\t\t\t\t\t\t\t\tthat.my.root().trigger(\"change\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t'self:hide':function(){return !!this._compiled}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div class=\"in-w-btn-box\">',\n\t\t\t'<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>',\n\t\t'</div>',\n\t\t'<div id=\"oltitle\"></div>',\n\t\t'<div class=\"in-w-files-box\">',\n\t\t\t'<div id=\"cards\" class=\"in-w-files\"></div>',\n\t\t\t'<div id=\"nocards\" class=\"hide in-w-empty\"></div>',\n\t\t'</div>'\n\t]\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1462716769331","id": ".style","type": "js","data": "({\n\t' .in-w-files-box':'width:100%;overflow:hidden;', \n\t\n\t' .in-w-empty':'opacity:0.7;text-align:center;',\n\n\t' .in-w-btn-box':{\n\t\t'':'width:100%;z-index:+10;position: absolute; top: 0px; right:0px;',\n\n\t\t' #btn-gopts':'position: absolute; top: 5px; right:5px; font-size:17px;z-index:+3;border-radius:100px!important;'\n\t\t\t+'padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;',\n\t\t\t' #btn-gopts:hover':'opacity:1;'\n\t},\n\t' table':{\n\t\t'':'margin:0!important;width:100%!important;',\n\t\t' td':'border:none!important;padding:0!important;'\n\t},\n\t'':{\n\t\t' .filecard':'display:inline-block; vertical-align:top;overflow:hidden;',\n\t\t' ': function($o){\n\t\t\tvar w0 = $o.width(),\n\t\t\t\t\tw = (w0/Math.round(w0/this.data.width-0.45)|0)-(this.data.gap|0),\n\t\t\t\t\tg0 = (this.data.gap|0)+'px ',\n\t\t\t\t\tg1 = (this.data.gap/2|0)+'px ',\n\t\t\t\t\talign = this.data.align+'';\n\n\t\t\treturn {\n\t\t\t\t' .filecard':{\n\t\t\t\t\t'':'width:'+w+'px;margin:0 '+g1 + g0 + g1 +';',\n\t\t\t\t\t//' img#pic':'width:100%;height:'+(w/4*3|0)+'px;',\n\t\t\t\t\t//' h4':'margin:0 0 0.5em 0!important;'\n\t\t\t\t\t' .olabel':'display:inline-block;border-radius:1px;border:1px solid gray; background:white;'\n\t\t\t\t\t+'padding:1px 5px 2px 5px; font-size:75%;color:gray;line-height:1.1em; margin: 0.08em 0 0 0;vertical-align:top;',\n\t\t\t\t\t' .clabel':'width:3em!important;padding-right:0.2em!important;'\n\t\t\t\t},\n\t\t\t\t' #oltitle':{\n\t\t\t\t\t'':'margin-bottom:'+g1+';padding:0 '+g1+g1+g1+';',\n\t\t\t\t\t' h3':'text-align:'+align+';margin:0!important;',\n\t\t\t\t\t' h2':'text-align:'+align+';margin:0!important;'\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1462716639866","id": ".GetAtts","type": "js","data": "(function(){\n\tvar that = this,\n\t\t\tpi = $.Deferred(),\n\t\t\td = that.data,\n\t\t\tpis = [],\n\t\t\tatts = that.Att(null);\n\n\t//Prepare session urls\n\tif (!d.items.length || !Object.size(atts)) pi.resolve();\n\telse {\n\t\td.items.forEach(function(e){\n\t\t\tvar s = e.url;\n\t\t\tif (atts[s]) {\n\t\t\t\tvar u = that.Att(s, 'url');\n\t\t\t\tif (typeof u == 'string') that.Url[s] = u;\n\t\t\t\telse {\n\t\t\t\t\tu.then(function(res){ that.Url[s] = res; });\n\t\t\t\t\tpis.push(u);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (!pis.length) pi.resolve();\n\t\telse {\n\t\t\t$.when.apply(null, pis).done(function(){ pi.resolve(); }.debounce(1));\n\t\t}\n\t}\n\n\treturn pi.promise();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1462716581569","id": ".To","type": "js","data": "({\n\tdata:function(item, options){\n\t\tvar that = this,\n\t\t\t\td = item,\n\t\t\t\th = '',\n\t\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\t\topts = Object.merge(\n\t\t\t\t\t{path:''}, \n\t\t\t\t\tObject.isObject(options)?options:{}\t\t\t\t\t\t\n\t\t\t\t);\n\t\tvar obj, s = item.data.replace(/^\\(|\\)$/g,'');\n\t\t\n\t\ttry {\n\t\t\tobj = JSON.parse(s);\n\t\t} catch(e){}\n\t\t\n\t\tif (!Object.isObject(obj)) return item.data;\n\t\t\t\t\n\t\tif (opts.path || opts.Urls) {\n\t\t\tobj.items = obj.items.map(function(e){\n\t\t\t\tvar s = e.url;\n\t\t\t\tif ((s+'').to(1)=='/' || /^http[s]:/.test(s+'')) return e;\n\t\t\t\te.url = opts.Urls?opts.Urls[s]:(opts.path+s);\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\t\t\n\t\treturn '('+JSON.stringify(obj)+')';\n\t},\n\tfiles: function(data){\n\t\tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\tif (!/^http[s]:\\/\\//.test(e.url)) list[e.url] = true;\n\t\t});\n\t\treturn list;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1462720413346","id": ".TRow","type": "html","data": "<div class=\"filecard\">\n\t<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n\t\t<tbody><tr>\n\t\t\t<td class=\"clabel\"><div class=\"olabel\">{ext}</div></td>\n\t\t\t<td><div class=\"olink\"><a href=\"{url}\" target=\"_blank\">{desc}</a></div></td>\n\t\t</tr></tbody>\n\t</table>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1462856228646","id": ".Lang","type": "js","data": "({\n\t'en':{\n\t\tAPPTITLE:'Files to download',\n\t\tEMPTY:'Set up list of files to download using button at right'\n\t},\n\t'ru':{\n\t\tAPPTITLE:'Файлы для скачивания',\n\t\tEMPTY:'Настройте список файлов для скачивания кнопкой справа'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1462716658891","id": ".Opts","type": "js","data": "({\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t$o.html(that.HTML.join('').assign(that.Lang));\n\t\t\n\t\tif (that.Att) that.P = that.Att(null);\n\t},\n\tP:{},\n\tui:{\n\t\t\"#gitems\":{\n\t\t\tbind:\"items\",\n\t\t\tinit: function($o){\n\t\t\t\t$o.sortable({handle:\"#gpreview\"});\n\t\t\t},\n\t\t\tlist:'<div class=\"fs80\"></div>',\n\t\t\tmanifest:{\n\t\t\t\tinherit:['P','Att','Lang'],\n\t\t\t\tinit:function($o){\n\t\t\t\t\tvar that = this;\n\t\t\t\t\t$o.html([\n\t\t\t\t\t\t'<div id=\"gpreview\" class=\"dib vat br2 mt4 h32 w20 cm\"><span class=\"fi-list o50\"></span></div>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gurl\" class=\"w350 mr4 h32\"></span>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gdesc\" class=\"w300 mr0 h32\" placeholder=\"{DESC}\"></span>'\n\t\t\t\t\t].join('').assign(that.Lang));\n\t\t\t\t},\n\t\t\t\tui:{\n\t\t\t\t\t'#gurl':{\n\t\t\t\t\t\tbind:'url',\n\t\t\t\t\t\tinit:function($o){\n\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t$o.select2({\n\t\t\t\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\t\t\t\tplaceholder:that.Lang.URL\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'#gdesc':'desc'\n\t\t\t\t}\n\t\t\t},\n\t\t\tid:['id'],\n\t\t\thash:['id','url','desc']\n\t\t},\n\t\t'#nogitems':{\n\t\t\tbind:'this.Lang.EMPTY',\n\t\t\twatch:'#gitems',\n\t\t\tcss:{\n\t\t\t\thide:function(d){return !!d.items.length;}\n\t\t\t}\n\t\t},\n\t\t'#btn-gapply':function(d,v){\n\t\t\tif (v!=null) {\n\t\t\t\td.items = d.items.map(function(e){if (e.url+'') {e.url=e.url+'';return e;}}).compact();\n\t\t\t\tthis.my.commit();\n\t\t\t}\n\t\t},\n\t\t'#btn-gadd':function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tthis.my.insert('#gitems',{\n\t\t\t\t\tid:Number.random(1e12).toString(36), \n\t\t\t\t\turl:'', \n\t\t\t\t\tdesc:''\n\t\t\t\t})\t;\n\t\t\t\tvar $r = $o.my().root;\n\t\t\t\t(function(){\n\t\t\t\t\t$r.parent().trigger('layout');\n\t\t\t\t}).debounce(80)();\n\t\t\t}\n\t\t},\n\t\t'#ggap':'gap',\n\t\t'#gwidth':'width'\n\t},\n\tHTML:[\n\t\t'<div id=\"nogitems\" class=\"hide fs90 pt10 pb10 o80\"></div>',\n\t\t'<div id=\"gitems\"></div>',\n\t\t'<div id=\"gbtns\" class=\"mt10 btd pt10\">',\n\t\t\t'<div class=\"fr fs80 xgray w350 tar\">',\n\t\t\t\t'{GAP1}<input type=\"number\" class=\"w60 mr4\" id=\"ggap\">{GAP2}',\n\t\t\t\t'<input type=\"number\" class=\"w80 mr4\" id=\"gwidth\">{GAP3}',\n\t\t\t'</div>',\n\t\t\t'<button id=\"btn-gadd\" class=\"fs80 mr10 w40\"><span class=\"fi-plus\"></span></button>',\n\t\t\t'<button id=\"btn-gapply\" class=\"green fs80 w150\">{APPLY}</button>',\n\t\t'</div>'\n\t\t\n\t]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1462857412470","id": ".Opts.Lang","type": "js","data": "({\n\ten:{\n\t\tEMPTY:'Add attached files or external resource URLs',\n\t\tAPPLY:'Apply',\n\t\tGAP1:'Gap ',\n\t\tGAP2:'px, width ',\n\t\tGAP3:'px',\n\t\tURL:'Attach or web URL',\n\t\tDESC:'Description'\n\t},\n\tru:{\n\t\tEMPTY:'Добавьте вложения или ссылки на внешние ресурсы',\n\t\tAPPLY:'Применить',\n\t\tGAP1:'Просвет ',\n\t\tGAP2:'px, ширина ',\n\t\tGAP3:'px',\n\t\tURL:'Вложенный файл или URL',\n\t\tDESC:'Текст описания'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1465148763322","id": ".Ico","type": "text","data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAA+CAYAAABzwahEAAAAAXNSR0IArs4c6QAAAAlwSFlzAAAHsQAAB7EBBsVhhgAADLFJREFUaAXdWwlwlNUd/79vN5tkc5CQS+4ggUC4RIxStRyBiiWJolV0SESlrdSx0+mhrVNrh+r0GGeqnTo6Re1ogVSJQ0cHooJIGPBAYBCkYGJAkhAggYSE3Mfuvv7+3+Z9u5ss2W83u4D9zyTvfe/4v/d7x/94762gCNP69dviRLItV2g0VROULSVlChKJUlCCIIqWRB3oQpuQ1IK846S5KslFR9/pbDz09ooVzkh1D22Hnza+syOHbNb7hJSLSYgb0UhUsK1gQFpJyt1Siu2u3p5Nq+5eei5YHkOVDxvw50tLY6+xpz4shVgthJg7VKPB50kHSdpGLte6lYWLt6I+xmV4NGzgL5WWxyfZ6THSxC/BLN1fd2KjbZSUGE+JcXZKsMeSLcpKVquFLJpGDqeTHA4ndff2UWtHJ7Xh78LFdj3dHy+kfeki+afiZYtKEQ95AIYFfOOW8nvQ979hOY8Z2Mn0kSNo/DVplJGSTInx9oHZQ367XBLg26i+8QJVnz2HwegaVB6IP3M5XY8+UJh3eFCmiYSQgL/67o6MOKvlDQC+3buNKMzilAljaNK4URQXG+OdNax4U0srfV1zmmowCBCAHpISwk/8ta2u8ndr1qzp82QEjgUNfP17H+VZpVYC0Nco9laLRjmTxuugo6xWlRz2sL2zi/57vIZOnm7w4S1J7iXpur8of3GNT8YQH0EB31hW/hhU0d+FIE3xHIflfP20SWSPiVZJEQ8bm1tp/9GvqaWNNaGbAL4JIrCg+I5Fe1XaUKFp4CVbdz4jNO1pxYxnOXfGFMocnaGSLmvocrnocOVJqqiuM9rFNuiE5L+3qDDvPSPxEhFTwDHTf9aEeFLxSIiLpflzZ+hSWqVdqbCuoZE+PfwVOZ0uvQsQAX2SnHcWL1v8/lB9Cgh849byn2uaeEExGTkigRbeMJOibUHbJIpF2EMWfrsOHKHePofOm2deOuXioZb9kMA3bN15B3TtO+Cml0tJSqS83Fm6Dg5774fJ8GJ7B+3Ye8gDHnu+p7d3zurlS0/5Y20IqYGZJWUfTdCE9gbSddCsixdgebPhcTXSiPg4fSVaIHuYIIRTom3Rm9auLferZvwCX7t2rUZCewvSO5mZsKV1tS1v7tdA4hV58+xpRjJm7DtZufSskeAV8Qs8K3fBoxixearcvFlTw2qQKL6RCMdmpFJ2pseQhEf4+MayD2cObGsQcLbKUPiPqmDW+NE0Jj1FfX4rwuuyryVe+m4SViGsLyPuI88GAY+zWn+PMiO4Ugwk9+wpE931v0X/NTgQudMnGz3G6r0VdshdRgIiPht/w+YPRkkhV6OgXmY2Ro73d7iprkVSJbzrs61wurvhYkH52m1EafFEmSOJsuHjRVl8JijoLqTBScocnU7VZ/rdeE17Ckz+oxj5zLgWGw3XUujeRbw9hjLHhNcqq2+VVHJA0qYviA6dJmpoI+qCa9EN9Xuhk/TB2FZB9OpnRF/UwQj18UhUl82HM7ImGOsbw3j9hrJyw6kygK9bty4K3u1Dim3OtePhYg9v1BUvDg+ekvTvg0T1ABuIeDB2VhFthsPZ6/B2xwLV9M1PgP8/flSakWgR4hH1YQCPHzt5GU5OUjmD3ctw2uD7aiSVH3cvadWwmbCmmejtQ8MDPxluskGS8l8r/QCbyWuPw+FaqQrwAYIyBFSa2fBil6TaFpweYu/yeuFF88lJs7UHl+MVsr2SqGD64DwzKWnJI3RV3NGld8gWa7fdg3qv6JLLbbDQEsVoAoRCsHS+HbOK5XkKoMNNLAiz0yVNTgtt6zGeYydq3d0S4jZEXtGX+sQ5t8zGh74E+BwsFaMUDB2rl7TxQGRAq37sOcFbJbT9PgrHXwYJWog4TrtBVqt1PodMvDQYvFmqOi/p/a+IcEwWUWruCn1g2ZRVmKC1UtZvLZ/uRihEjup1SlKCigYMO3okfQDQl4s+qyb6HIKy8pykniCkPcurpERlybHckTn91onMdosiIlYBZmlfLSRuxO46BveiDvKD/5ii0fP5kyTNGm1u3/PRdlOLW5fC68zWZxzXN1ludoRTlVgVHTJ0Yb8drR+ySEQze2D0fAhpf6DW3B7zmVDg1YHjHitJ9TLaBtvRBNXD3OTGrzTthtBr7AgMnv0ORVCxSRqrMmx4Y32z8WKGWiBsQqVkLKosmEqTYVSlwz4fDjHk/dhygcj7AAWLNcGalrOAQRsbxazhwmZlsDQBWmX+JIDle1Ivau2W9OlJCnnrVDd5MbtE1GrxTKggadd20XmfueNjWzNk6xeLZspymbnjiH4Aa2EgaM5LjBF0+zRBt0HEhkKdmARnAH2qTmGZP7Z2t6bfQUsywPfhAs8MpRibI3DpiSlECzDT8AXchbt7cSuOJvmP4/00ExI6d7z6Ci5UrC9Viy8nDZLU1j9vEqJK6OKcj2jNCPYMqHtWKWYE3MIsL9Dc+q9f5Cly94PH4oVfsGekf8+bQHTkjNtVdRcI/D8VKjqQJ9nT5703Rasu1cG6WrH3dzOp8rxDC0TitAzvFP9xHqCRdt89jdsOT2GWTl7fNqugSbqP6CkSKGamHz64JFW71RkJaEQ38R21WboJsxMXQPvxbARLwdQZiS03Z2zgFvje3SA8N9HXFwa9Qs1Jc2u7kR8oEh8t6JGbJfV5bZ+BdUI5QWIgM0cP5OT/2wZhbcgO/0V056a51XPBSE5ZoQMX5PyEyC3uz11o0QsGYqba4L3Fez2cxNuo/14gLGx5MvscbmsLOryzqqvpkN7lqo6mvZPj0juBwc7CjQvyHVlYiaX3s/8kvPGAPhnA+elXMO7Ydb99kJ2FAZnD/2xo8jokEPTx2hUrevU9zhESco9qovbseRUNXxgDYfDdOUTthub08Ga1dtP0iIDmRvglhSL4JTs4rqQ6z8JbKrP6TEPITr/i4Te87SbYqn4k0Tic+BTe6rfKcBP5MtFLbmGlO0uZpwG829G6mdc/J3b19NKZcybsQC4cDGHv0kP5RLHRnlqsvx8uxFJ3yxhPRnhix2vPGoxwYL1bPRcxgP/wzjvb4KC/rUod/aZWRcMbJicSrVzq4XlPHlGGfurlSQtTrBsTeOKUBzhsVQgZNxnA+dPV63wOgS562Gk/i+dWEaHrs4nmzSCalUV0Kx/3RYb4mYiz3zjCeV1N1X75pmpJqW/1TSVluzZDut/NCXwn/v1b5hLfRYWd2GTlTkXgior7ypbaex/vRxP9KsTlemxlQd7LCscgRLLP8TSK6oZta3sneT+uUZXCErL6ihBo7t+BY1UGaMiuqkat21jmnD8IePHyJccg8l/gTKYjVdXeUtGdeJX/r8JjwPrGZqOX0uX86c+WLesxEhAZBJwzHU09z2CrV3Ocl8onXxyD5QPD41tA/BT0YMUJo6fY25uKCxdvNxL6I36Br1q1tMMh5f1qybfhRSGDN/bLQC5XyXdnVw/tOXjUq5+yureXfuKve36Bc8FV+XmfC+l6UlViCf/5kYrIGDaqkWGEPXj9XH7gS+rs7l/RknpdDueKh+9a5GWvehq4JHAusjI/73ksFUMo8CX73i8rMKJe/rSH1xWLdQHszn2HiYVxP0npkquL71iyXyUMDAOaS5bl+WVTo+yz4a1N5cr8fpT30ZiMFONaZiDTy/nNYBm090EDpPivigoWwfO5NA3S4/6Kvv56eYwtnd4E+OUqn19M3HJdTvi9ONWAibAar5j5Ma9DHWOhjotcvylelseG2JBkCjhzuLe01LI8Lu0fAP8jxRFPPWlGViZNnTj2ss4+m6IsuWvU+xa9QxLymH5clL/oDdW/oULTwBUTftsqNPEcKhpXE/yol59uj07DcWoEiY+Ij8P2PlJ10le9SlmPN/sriwqWlJttPmjgzLhky0c3kmbB0qdrvRsaid+d8IP9MempMHNDYu3Nzoj34XDkRF09VZw8pXuORgYiULnbnd09DwT7K6WQe7duyxZ7vEh4CuAfxz2Mz5Ej31PxKwR+UjJyRGJIg8AG07mmZv03KacbmgxnwwAtZYMk8URR/sINRloQkZCBqzY2vLszW7OKP+DI714MwiD1yFc3/OYs2cSvkPgklE95G+EZXrjIPztTrXhCpLXBr36po8PxlzUrvnfRkxNcbNjAVXP/KtsxxUqWJwD+fgzCMK8CFVef8BQMiNdwVvJiUUGBxxD3KWL+I2zAVZP6FqD4u8gi7kPaAjSAk4cQScrTODve5iBnyTf79uzCzW7YLKewA/eGyCqwMC71BgtpN0MOwADCywtJmVgRifiOR+NRWLbduKZuwxJm0/I4ToEqUeZoHzl3P5i/5Gtvfv83cf2Z2RVC8z88oFWT3gvxWAAAAABJRU5ErkJggg==","active": false,"err": [],"opts": [],"color": ["green"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "800","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Inliner ‘files to download’ widget","timeout": "3000","author": "ermouth","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"collapsed": [],"padding": "auto"},"log": [[1539560451145,"update","ermouth-524yb546",5,"dev-cloudwall2"]],"id": "cw.Inliner.Ed.Widgets.Files","stamp": 1539560451145,"creator": "ermouth-524yb546","parent": "cw-Inliner-4vx1"},{"_id": "cw-Inliner-Ed-Widgets-Gallery-1ccd","_rev": "28-1a6ae3af2cad1c7d32bdff5cdefe30dc","name": "Inliner.Ed.Widgets.Gallery","title": "⊛ Inliner Gallery","type": "manifest","desc": "Gallery widget for Inliner 3","beta": false,"tags": ["Inliner"],"manifest": {"id": "cw.Inliner.Ed.Widgets.Gallery","build": 3,"name": "Image gallery","params": {"restyle": 200},"data": {"title": "","type": "inliner-gallery","items": [],"gap": "10","round": "0","ratio": "4:3","action": "","bg": "#efefef"},"Layout": "normal","init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t// HTML\n\t\t\n\t\t$o.html(that.HTML.join(''));\n\t\t\n\t\t// Load attachments\n\t\tif (that.Att) return that.GetAtts();\n\t}","Url": {},"ui": {"#cards": {"init": "function ($o,form) {\n\t\t\t\tvar that = this;\n\t\t\t\t// Zoom\n\t\t\t\tif (that.data.action+'' == 'zoom') {\n\t\t\t\t\t$o.on('click.my', '.in-w-gallery-item', function(evt){\n\t\t\t\t\t\t// if (that.data.items.length<2) return false;\n\t\t\t\t\t\tvar idx = $(this).data('idx'),\n\t\t\t\t\t\t\t\td = that.data;\n\n\t\t\t\t\t\t// Prepare modal, calculate width\n\t\t\t\t\t\tvar ww = $(window).width() - 40,\n\t\t\t\t\t\t\t\twh = $(window).height() -100,\n\t\t\t\t\t\t\t\tar = d.ratio.split(/\\D/),\n\t\t\t\t\t\t\t\tratio = ar[0]/ar[1],\n\t\t\t\t\t\t\t\twidth = (Math.min(ww/ratio, wh).clamp(100,900) * ratio | 0).clamp(200,1600),\n\t\t\t\t\t\t\t\theight = width/ratio | 0;\n\n\t\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\t\tmanifest:$.extend({Url:that.Url},that.Fullscreen),\n\t\t\t\t\t\t\twidth:width,\n\t\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t\tw:width,\n\t\t\t\t\t\t\t\th:height,\n\t\t\t\t\t\t\t\titems:d.items,\n\t\t\t\t\t\t\t\tidx:idx,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tclose:false,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\tcss:'p10'\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (that.data.action+'' == 'link') {\n\t\t\t\t\t\n\t\t\t\t\t$o.on('click.my', '.in-w-gallery-item', function(evt){\n\t\t\t\t\t\tif (that.data.items.length<2) return false;\n\t\t\t\t\t\tvar idx = $(this).data('idx'),\n\t\t\t\t\t\t\t\trow = that.data.items[idx],\n\t\t\t\t\t\t\t\tlink = row.link || '';\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (link) window.location.href=link;\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}","bind": "function (d) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tt = that.L[that.Layout][d.items.length],\n\t\t\t\t\t\timgs = Object.clone(d.items, true),\n\t\t\t\t\t\th = '',\n\t\t\t\t\t\tctr = 0;\n\t\t\t\t\n\t\t\t\tif (imgs.length) {\n\t\t\t\t\t\n\t\t\t\t\tt.c.forEach(function(col, idx){\n\t\t\t\t\t\tvar a = col.slice(1);\n\t\t\t\t\t\th+='<div class=\"in-w-gallery-col in-w-gallery-c'+col[0]+'\">';\n\n\t\t\t\t\t\ta.forEach(function(cell){\n\t\t\t\t\t\t\tvar img = imgs.shift();\n\t\t\t\t\t\t\tif (img) {\n\t\t\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t\t\t'<div class=\"in-w-gallery-cell in-w-gallery-i-'+idx+'-'+cell+'\">',\n\t\t\t\t\t\t\t\t\t\t'<div class=\"in-w-gallery-item in-w-gallery-z-'+idx+'-'+cell+'\" ',\n\t\t\t\t\t\t\t\t\t\t'data-idx=\"'+ctr+'\" ',\n\t\t\t\t\t\t\t\t\t\t'style=\"background-image:url(\\''+(that.Url[img.url]||img.url)+'\\');\">',\n\t\t\t\t\t\t\t\t\t\t\t(img.desc?'<div class=\"in-w-gallery-item-desc\">'+img.desc+'</div>':''),\n\t\t\t\t\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t].join('');\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tctr+=1;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\th+='</div>';\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t}"},"#nocards": {"bind": "this.Lang.EMPTY","watch": "#cards","css": {"hide": "function (d) { return !!d.items.length }"}},"#btn-gopts": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif(v!=null) {\n\t\t\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar root = $o.parents('#medium');\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\troot:root.size()?root:undefined,\n\t\t\t\t\t\t\tbound:0,\n\t\t\t\t\t\t\twidth:705,\n\t\t\t\t\t\t\tmanifest:$.extend(true, {}, that.Opts, {Att:that.Att}),\n\t\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\t\talign:'right:38px;',\n\t\t\t\t\t\t\tscreen:'rgba(255,255,255,0.65)',\n\t\t\t\t\t\t\tnose:'right',\n\t\t\t\t\t\t\tfocus:false,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\tesc:true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t['items','gap','bg','ratio','action','round']\n\t\t\t\t\t\t\t.forEach(function(k){d[k]=res[k]});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthat.GetAtts().then(function(){\n\t\t\t\t\t\t\t\tthat.my.check(\"#cards\");\n\t\t\t\t\t\t\t\tthat.my.root().my('restyle');\n\t\t\t\t\t\t\t\tthat.my.root().trigger(\"change\");\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}","css": {"self:hide": "function () {return !!this._compiled}"}}},"HTML": ["<div class=\"in-w-btn-box\">","<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>","</div>","<div class=\"in-w-gallery-box\">","<div id=\"nocards\" class=\"hide in-w-empty\"></div>","<div id=\"cards\" class=\"in-w-gallery\"></div>","</div>"],"L": {"wide": [{},{"w": 1,"h": 1,"c": [[1,1]]},{"w": 2,"h": 1,"c": [[1,1],[1,1]]},{"w": 3,"h": 2,"c": [[2,2],[1,1,1]]},{"w": 5,"h": 3,"c": [[3,3],[2,2,1,1]]},{"w": 4,"h": 2,"c": [[2,2],[1,1,1],[1,1,1]]},{"w": 11,"h": 6,"c": [[6,6],[3,3,3],[2,2,2,2]]},{"w": 6,"h": 3,"c": [[3,3],[2,2,1,1],[1,1,1,1]]},{"w": 19,"h": 12,"c": [[12,12],[4,4,4,4],[3,3,3,3,3]]},{"w": 13,"h": 6,"c": [[6,6],[3,3,3],[2,2,2,2],[2,2,2,2]]},{"w": 25,"h": 12,"c": [[12,12],[6,6,6],[4,4,4,4],[3,3,3,3,3]]}],"normal": [{},{"w": 1,"h": 1,"c": [[1,1]]},{"w": 2,"h": 1,"c": [[1,1],[1,1]]},{"w": 3,"h": 2,"c": [[2,2],[1,1,1]]},{"w": 4,"h": 3,"c": [[3,3],[1,1,1,1]]},{"w": 6,"h": 5,"c": [[6,3,3],[6,2,2,2]]},{"w": 3,"h": 3,"c": [[2,2,1,1],[1,1,1,1]]},{"w": 12,"h": 7,"c": [[12,4,4,4],[12,3,3,3,3]]},{"w": 6,"h": 7,"c": [[6,3,3],[6,2,2,2],[6,2,2,2]]},{"w": 3,"h": 3,"c": [[3,1,1,1],[3,1,1,1],[3,1,1,1]]},{"w": 12,"h": 11,"c": [[12,4,4,4],[12,4,4,4],[12,3,3,3,3]]}],"narrow": [{},{"w": 1,"h": 1,"c": [[1,1]]},{"w": 1,"h": 2,"c": [[1,1,1]]},{"w": 2,"h": 3,"c": [[2,2,1,1]]},{"w": 2,"h": 5,"c": [[2,2,2,1,1]]},{"w": 2,"h": 4,"c": [[2,2,1,1,1,1]]},{"w": 2,"h": 3,"c": [[2,1,1,1,1,1,1]]},{"w": 2,"h": 5,"c": [[2,2,1,1,1,1,1,1]]},{"w": 2,"h": 7,"c": [[2,2,2,1,1,1,1,1,1]]},{"w": 2,"h": 6,"c": [[2,2,1,1,1,1,1,1,1,1]]},{"w": 2,"h": 5,"c": [[2,1,1,1,1,1,1,1,1,1,1]]}]},"Lang": {"en": {"APPTITLE": "Image gallery","EMPTY": "Set up list of images using button at right"},"ru": {"APPTITLE": "Галерея изображений","EMPTY": "Настройте список изображений кнопкой справа"}},"style": {" .in-w-empty": "opacity:0.7;text-align:center;"," .in-w-gallery-box": "width:100%;overflow:hidden;"," .in-w-btn-box": {"": "width:100%;z-index:+10;position: absolute; top: 0px; right:0px;"," #btn-gopts": "position: absolute; top: 5px; right:5px; font-size:17px;z-index:+3;border-radius:100px!important;padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;"," #btn-gopts:hover": "opacity:1;"}," .in-w-gallery-item": "transition:height 0.1s;"," .in-w-gallery-item-desc": "color:white; line-height:1.1em; text-overflow:ellipsis;overflow:hidden;position:absolute; bottom:0;left:0;width:100%;padding:0.7em 1em;word-break:break-word; opacity:0.5; transition: opacity 0.3s;background-image: -moz-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));background-image: -webkit-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));background-image: -o-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));background-image: -ms-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));background-image: linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50))"," .in-w-gallery-item:hover .in-w-gallery-item-desc": "opacity:1;"," .in-w-gallery-box ": "function ($o) {\n\t\tvar r = this.data.round || '0';\n\t\tif (r == '0') return '';\n\t\tr = r+'px;'\n\t\treturn {\n\t\t\t'':'border-radius:'+r,\n\t\t\t'#cards>div:last-child>div:last-child>div':'border-bottom-right-radius:'+r\n\t\t};\n\t}"," .in-w-gallery": "function ($o) {\n\n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tn = d.items.length,\n\t\t\t\tgap = d.gap/2,\n\t\t\t\tw0 = 99.999,\n\t\t\t\tww = $o.width(),\n\t\t\t\tscheme = ww<500?'narrow':ww<1000?'normal':'wide';\n\t\t\n\t\tthat.Layout = scheme;\n\t\t\t\t\t\t\t\t\n\t\tvar t = that.L[scheme][n],\n\t\t\t\tk = d.ratio.split(\":\")[1]/d.ratio.split(\":\")[0],\n\t\t\t\tx = (w0/t.w).round(4),\n\t\t\t\ty = (k*(ww+gap*2)/t.w).round(4),\n\t\t\t\tvc = 'calc(100% + '+d.gap+'px);';\n\t\t\n\t\tvar res = {\n\t\t\t' ':'width:'+vc+'margin:-'+gap+'px;'+(scheme=='wide'?'white-space: nowrap;':''),\n\t\t\t' .in-w-gallery-col':'display:inline-block;vertical-align:top;white-space: normal;',\n\t\t\t' .in-w-gallery-cell':'display:inline-block;vertical-align:top;padding:'+gap+'px;overflow:hidden;',\n\t\t\t' .in-w-gallery-item':'width:100%; display:block;background-size:cover;background-repeat:no-repeat;'\n\t\t\t+'background-position:center center; background-color:'+d.bg+';'\n\t\t\t+(d.action=='zoom'?'cursor:zoom-in;':'')\n\t\t};\n\t\t\n\t\tvar cells = {}, its = {};\n\t\tif (t.c) {\n\t\t\tt.c.forEach(function(a, idx){\n\t\t\t\tvar col = a[0];\n\t\t\t\tcells[col]=1;\n\t\t\t\t\n\t\t\t\ta.from(1).forEach(function(i){ its[idx+'-'+i] = {i:i, w:100*i/col}; })\n\t\t\t});\n\t\t\t\n\t\t\tObject.keys(cells).forEach(function(i){\n\t\t\t\tvar wr = (x*i).round(4);\n\t\t\t\tres[' .in-w-gallery-c'+i] = 'width:'+wr+'%;';\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\tObject.keys(its).forEach(function(i){\n\t\t\t\tvar wc = its[i].w.round(4);\n\t\t\t\tres[' .in-w-gallery-i-'+i] = 'width:'+wc+'%!important;'\n\t\t\t\tres[' .in-w-gallery-z-'+i] = 'height:'+(y*its[i].i-gap*2).round(4)+'px!important;';\n\t\t\t});\n\t\t}\n\t\t\n\t\t(function($f){$f.find('#cards').trigger('recalc');}).fill($o).delay(5);\n\t\t\n\t\treturn res;\n\t}"},"GetAtts": "function () {\n\tvar that = this,\n\t\t\tpi = $.Deferred(),\n\t\t\td = that.data,\n\t\t\tpis = [],\n\t\t\tatts = that.Att(null);\n\n\t//Prepare session urls\n\tif (!d.items.length || !Object.size(atts)) pi.resolve();\n\telse {\n\t\td.items.forEach(function(e){\n\t\t\tvar s = e.url+'';\n\t\t\tif (atts[s]) {\n\t\t\t\tvar u = that.Att(s, 'url');\n\t\t\t\tif (typeof u == 'string') that.Url[s] = u;\n\t\t\t\telse {\n\t\t\t\t\tu.then(function(res){ that.Url[s] = res; });\n\t\t\t\t\tpis.push(u);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (!pis.length) pi.resolve();\n\t\telse {\n\t\t\t$.when.apply(null, pis).done(function(){ pi.resolve(); }.debounce(1));\n\t\t}\n\t}\n\n\treturn pi.promise();\n}","To": {"data": "function (item,options) {\n\t\tvar that = this,\n\t\t\t\td = item,\n\t\t\t\th = '',\n\t\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\t\topts = Object.merge(\n\t\t\t\t\t{path:''}, \n\t\t\t\t\tObject.isObject(options)?options:{}\t\t\t\t\t\t\n\t\t\t\t);\n\t\tvar obj, s = item.data.replace(/^\\(|\\)$/g,'');\n\t\t\n\t\ttry {\n\t\t\tobj = JSON.parse(s);\n\t\t} catch(e){}\n\t\t\n\t\tif (!Object.isObject(obj)) return item.data;\n\t\t\t\t\n\t\tif (opts.path || opts.Urls) {\n\t\t\tobj.items = obj.items.map(function(e){\n\t\t\t\tvar s = e.url;\n\t\t\t\tif ((s+'').to(1)=='/' || /^http[s]:/.test(s+'')) return e;\n\t\t\t\te.url = opts.Urls?opts.Urls[s]:(opts.path+s);\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\t\t\n\t\treturn '('+JSON.stringify(obj)+')';\n\t}","files": "function (data) {\n\t\tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\tif (!/^http[s]:\\/\\//.test(e.url)) list[e.url] = true;\n\t\t});\n\t\treturn list;\n\t}","updateFiles": "function (data,replacer) {\n  \tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\tif (!/^http[s]:\\/\\//.test(e.url)) list[e.url] = true;\n\t\t});\n\t\tif (!Object.isObject(replacer)) return data;\n    \n    data.items.forEach(function(e){\n\t\t\tif (!list[e.url]) return;\n      if (replacer[e.url]) e.url = replacer[e.url];\n\t\t});\n    return data;\n  }"},"Opts": {"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t$o.html(that.HTML.join('').assign(that.Lang));\n\t\t\n\t\tif (that.Att) {\n\t\t\treturn that.Att(/\\.(jpg|jpeg|png|gif|svg)$/i, \"preview\")\n\t\t\t.then(function(res){\n\t\t\t\tres.forEach(function(e){ that.P[e.fname] = e; });\n\t\t\t});\n\t\t}\n\t}","P": {},"ui": {"#gitems": {"bind": "items","init": "function ($o) {\n\t\t\t\t$o.sortable({handle:\"#gpreview\"});\n\t\t\t}","list": "<div class=\"fs80\"></div>","manifest": {"init": "function ($o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\t$o.html([\n\t\t\t\t\t\t'<div id=\"gpreview\" class=\"dib vat mr10 br2 mt4 h32 w40\" style=\"background-size:cover;background-repeat:no-repeat;'\n\t\t\t\t\t\t\t+'background-position:center center;width:40px;cursor:move;\"></div>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gurl\" class=\"w350 mr4 h32\"></span>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gdesc\" class=\"w300 mr0 h32\" placeholder=\"{DESC}\"></span>'\n\t\t\t\t\t].join('').assign(that.Lang));\n\t\t\t\t}","inherit": ["P","Att","Lang"],"ui": {"#gpreview": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t$o.css({\n\t\t\t\t\t\t\t\t'background-image':'url(\\''+(that.P[d.url]?that.P[d.url].data:d.url+'')+'\\')'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}","watch": "#gurl"},"#gurl": {"bind": "url","init": "function ($o) {\n\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t$o.select2({\n\t\t\t\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\t\t\t\tplaceholder:that.Lang.URL\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}"},"#gdesc": "desc"}},"id": ["id"],"hash": ["id","url","desc"]},"#nogitems": {"bind": "this.Lang.EMPTY","watch": "#gitems","css": {"hide": "function (d) {return !!d.items.length;}"}},"#btn-gapply": "function (d,v) {\n\t\t\tif (v!=null) {\n\t\t\t\td.items = d.items.map(function(e){if (e.url+'') {e.url=e.url+'';return e;}}).compact();\n\t\t\t\tthis.my.commit();\n\t\t\t}\n\t\t}","#btn-gadd": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tthis.my.insert('#gitems',{\n\t\t\t\t\tid:Number.random(1e12).toString(36), \n\t\t\t\t\turl:'', \n\t\t\t\t\tdesc:''\n\t\t\t\t});\n\t\t\t\tvar $r = $o.my().root;\n\t\t\t\t(function(){\n\t\t\t\t\t$r.parent().trigger('layout');\n\t\t\t\t}).debounce(80)();\n\t\t\t}\n\t\t}","#ggap": "gap","#gratio": "ratio","#ground": "round","#gaction": {"init": "function ($o) {$o.tags(this.Lang.CLICK)}","bind": "action"}},"HTML": ["<div class=\"fr tar w450 fs80\" style=\"z-index:+2\">{ONCLICK} <span id=\"gaction\"></span></div>","<div class=\"fs120 mb4 xgray\">{TITLE}</div>","<div id=\"nogitems\" class=\"hide fs90 pt10 pb10 o80\"></div>","<div id=\"gitems\"></div>","<div id=\"gbtns\" class=\"mt10 btd pt10\">","<div class=\"fr fs80 xgray w420 tar\">","{GAP1}<input type=\"number\" class=\"w50 mr4\" id=\"ggap\">","{GAP2}<input type=\"number\" class=\"w50 mr4\" id=\"ground\">","{GAP3}<input type=\"text\" class=\"w70\" id=\"gratio\">","</div>","<button id=\"btn-gadd\" class=\"fs80 mr10 w40\"><span class=\"fi-plus\"></span></button>","<button id=\"btn-gapply\" class=\"green fs80 w150\">{APPLY}</button>","</div>"],"style": {" .select2-choices": "max-height:2.1em;"},"Lang": {"en": {"TITLE": "Gallery","EMPTY": "Add attached files or external image URLs","APPLY": "Apply","GAP1": "Gap ","GAP2": "px, round ","GAP3": "px, ratio ","URL": "Attached image or web URL","DESC": "Description","ONCLICK": "On click ","CLICK": {"tags": [[{"Zoom": "zoom"},{"Goto link": "link"}]],"empty": {"Ignore": ""}}},"ru": {"TITLE": "Галерея","EMPTY": "Добавьте вложения или ссылки на внешние картинки","APPLY": "Применить","GAP1": "Просвет ","GAP2": "px, радиус ","GAP3": "px, аспект ","URL": "Вложенное изображение или URL","DESC": "Текст описания","ONCLICK": "Клик картинке – ","CLICK": {"tags": [[{"Зум": "zoom"},{"Перейти по URL": "link"}]],"empty": {"Пропустить": ""}}}}},"Fullscreen": {"init": ["<div id=\"pframe\">","<div id=\"pcont\"></div>","<div id=\"pleft\"></div>","<div id=\"pright\"></div>","</div>"],"ui": {"#pcont": {"init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\t\n\t\t\t\t$o.addClass('ptrans')\n\t\t\t\t.on('click.my','.pimg', function(){\n\t\t\t\t\tthat.my.commit();\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif ($.fn.swipe && that.data.items.length > 1) {\n\t\t\t\t\tthat.my.find('#pframe').swipe({\n\t\t\t\t\t\tswipeLeft: function(){that.Align(1);},\n\t\t\t\t\t\tswipeRight: function(){that.Align(-1);},\n\t\t\t\t\t\tthreshold:50\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}","bind": "function (d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\ta = d.items.slice(0);\n\t\t\t\ta.unshift(d.items.last());\n\t\t\t\ta.push(d.items[0]);\n\t\t\t\treturn a.map(function(e){\n\t\t\t\t\treturn [\n\t\t\t\t\t\t'<div class=\"pimg\" style=\"background-image:url(\\''+(that.Url[e.url]||e.url)+'\\');\">',\n\t\t\t\t\t\t\t(e.desc?'<div class=\"in-w-gallery-item-desc\">'+e.desc+'</div>':''),\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t].join('');\n\t\t\t\t}).join('');\n\t\t\t}"},"#pright": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) this.Align(1);\n\t\t\t\treturn '<div class=\"pbtn\">›</div>';\n\t\t\t}","events": "click.my"},"#pleft": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) this.Align(-1);\n\t\t\t\treturn '<div class=\"pbtn\">‹</div>';\n\t\t\t}","events": "click.my"}},"Align": "function (x) {\n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tidx = d.idx,\n\t\t\t\tshifted = false;\n\t\t\n\t\tif (idx == 0 && x<0) {\n\t\t\tthat.my.find('#pcont')\n\t\t\t.removeClass('ptrans')\n\t\t\t.css({\n\t\t\t\ttransform:'translateX('+(-d.w * (d.items.length+1))+'px)'\n\t\t\t});\n\t\t\tshifted = true;\n\t\t}\n\t\telse if (idx == d.items.length-1 && x>0) {\n\t\t\tthat.my.find('#pcont')\n\t\t\t.removeClass('ptrans')\n\t\t\t.css({\n\t\t\t\ttransform:'translateX(0px)'\n\t\t\t});\n\t\t\tshifted = true;\n\t\t}\n\t\t\n\t\t(function() {\n\t\t\tif (shifted) that.my.find('#pcont').addClass('ptrans');\n\t\t\td.idx = (d.idx + d.items.length + (+x)) % d.items.length;\n\t\t\tthat.my.find('#pcont').css({\n\t\t\t\ttransform:'translateX('+(-d.w * (d.idx+1))+'px)'\n\t\t\t});\n\t\t}).delay(20);\n\t}","style": {"": "function () {\n\t\t\tvar that = this,\n\t\t\t\t\td = that.data;\n\t\t\td.w0 = d.w * (d.items.length+2) + 1;\n\t\t\td.shift = -d.w * (d.idx+1);\n\t\t\treturn {\n\t\t\t\t' #pframe':'overflow:hidden;width:{w}px;height:{h}px;'.assign(d),\n\t\t\t\t' #pcont':'width:{w0}px;height:{h}px;transform:translateX({shift}px);'.assign(d),\n\t\t\t\t\n\t\t\t\t' #pcont>div':'cursor:zoom-out;background-size: cover;background-repeat: no-repeat;'\n\t\t\t\t+'display:inline-block;margin:0;padding:0;vertical-align:top;'\n\t\t\t\t+'background-position: center center;overflow:hidden;width:{w}px;height:{h}px;'.assign(d),\n\t\t\t\t\n\t\t\t\t' #pleft, #pright':d.items.length==1?'display:none;':\n\t\t\t\t('opacity:0.2;transition:opacity 0.2s;line-height:'+(d.h-120)+'px;'\n\t\t\t\t+'padding:30px;color:white;font-size:80px;text-shadow:0 0 15px rgba(0,0,0,0.7);'\n\t\t\t\t+'z-index:+1;position:absolute; top:0; width:'+d.w/3+'px;height:'+d.h+'px;'),\n\t\t\t\t\n\t\t\t\t' #pleft:hover, #pright:hover':'opacity:1;',\n\t\t\t\t' #pright':'right:0px;text-align:right;cursor:pointer;',\n\t\t\t\t' #pleft':'left:0px;text-align:left;cursor:pointer;',\n\t\t\t\t//' .pbtn':'width:100px;height:100px;border-raius:100px; background:rgba(0,255,0,0.5);',\n\t\t\t\t' .ptrans':'transition:transform 0.3s;',\n\t\t\t\t' .in-w-gallery-item-desc':'color:white; font-size:1.2em;line-height:1.2em; text-overflow:ellipsis;'\n\t\t\t\t\t\t+'overflow:hidden;position:absolute; bottom:0;left:0;width:100%;padding:1em 1.3em;'\n\t\t\t\t\t\t+'word-break:break-word; opacity:0.7;text-align:center;'\n\t\t\t\t\t\t+'background-image: -moz-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: -webkit-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: -o-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: -ms-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50))',\n\t\t\t};\n\t\t}"}},"Ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABo1JREFUeNrkW2toHFUUvhurFtPWXEu1ICqO6UMRfExBW0VJzKggAdF27Q9bEcFFsMQ/YopVqmhYCz5+1McWRFBb6AaxVTTibCMp6q9u/aX4HF9oCxVubXxUg43fmZ2dvXf2bmYzmd2d3dxk9s7Mztyd7zvn3HvOnXNT09PTbD6XBfSRSqUa+iN52zZQXcEYX82YWIn6XBwvxj42ThKYxD42dgTbV952OG1ZvzTyuUj4KfcjZgKy+fwZBue3YXcQWz9AXhSxqa9BzDjqfaNCFEbT6f8STQAkfSmqLQB8F+pzYhYYtEPsRr0TmvFjoggAcKg32wbgd6Du0l3DOW2c0Z/3rxThfgj6x36prlGmcMWbqEdAxLctJQDACcfTgJPRATcMzgwCzXmk9gVYcGhztGz8iyuexTdPZSzrr6YTAPC3A/gu7C4LSto0jMiga5USEY5GMwSZwz3QhommEOB1cDsAdagZwHVaUawiQlDnuN0pFkeGh4dPNYwAT+XfAdzr5fOmabiq3sxCZkFEBOjZLxy2MZOxTsZOAMCfj+oDgL9clvqAabbUkSkUi0Ft+BjHg5m0dTw2AnK2fR6wfgLIl8gdHKl8EgppgtpRikMgoQ8k/BFGQFeo5PP2EvTjYzJ4Ap4U8OXnIYFIPdIaaOfb1F+F3RtGQAoD9l7UVyn2bnCWtFISikLCAPqlV+ZEAOx+Kxq6VWGaJw98xSyrNOFeYNgciQDcuA7Vk4pTYyQXvCykwFD8ErCsnBUB2axNUWIODJ4mj/HtUgZM+Vl5N5EwKwIMkw3Jw53Z4qEuBhJughZsrIuAXN7uwQ2Py6rPWfsVMgO1v+LP5HK500MJwI0IZ9kS2abatZiKFrALuWHePSMBcHjOghMx1AngZQ2WylZ3aA9OifnSZ/xOVEtr3FzLK4/7kYPRT5iuh44KjlMsH65AX9CHyHFcSwB+bXN5qqIe8I5Yg+crxgufZ4HpEc/HRdu7CmHjHmP3bwhpk7vhtFc2YRuvMgGo/3KA75edijqC0/jDXVmjRDyPEBDmemA9s4oACuzKx1wzZdXORXWM+CIcrdV0grxPf0NnlIAL368hQNxY4+LO0ALVDG5QCMjl7IW45OJO1oCAGVymEMAN1ltHaNzeBKiHy7zpPR90b53DaieVXpmAHskZSqzYIl+jF26P5AjxxQl15hGbm7ERECiLJAJEt98ST7bxzr0x33Pqlk3g7wY6dwkqCriTciwwmcTHpZnughPm4MCFjRa0TsoEnKhwlBwVcN8UixijEfXiE7IJ/FBv9NkpBoD9730CRCklhc0b64f0M5Z11CcAB2QPv1a0oPPUIIDpS00wRO/+5gsB4lNdNDhe6X07kAA1y2RcpwEHOrUjLOUd+WUKBxNVBKQt6xtUh30tcFrDghKLxOQFOkJxJsbSacsf9oOToq/jV68uEeAwwzBDnBCbCV6MmYDKBKdJU3NmuCMUSoCaO/CG/N2CgKrs4Vxk8bMLhdcXzDw7ZOCBG/vuYK7vYwOafAxH78onlEmQTNo6hurVys1O29t/II/oeQz5/9QkwCs73I7C6zxa1RfED14cB6AXg9dUEYDO8CdUL9dgsK2KKjw+Ind+M2kAif4xfBwtHxaK7UcCZY9J5QvhFF/QXaclwGPqIdmLaidTCCRSngKCBzKZzFTdBHimsBc3vqY2mnwSqnOLBSVVH6x1fVdIBPUgPj+XTSHJJLhptIq5iolRIbbPdE9oomTetumFCYIHvrx8jtJPkvbyxKkC7y62uA7S/63WPXVninrrAeA/87N9L81MTsqcJm8Yob1YF7awYra5wtegeg8kKAkUrc4iIakHolcM4+JmgA+d5ImSLb4aBHyI3Qv80dVNoTOb/kapbO9qj+T2V7fUu9gq0noBSqRAxLYHu32Kz95EbdBIncC/hVP3wZ3/vd52Iq8YyWazXYZpUirdtnIyZaOJcIMzPXCa338YUt852zbjWDNEawHJbV5bFdZyL3d3jrZBHRzF8zVG3zF8sQWO23dR2o5r1VgKRGwC5Eexr83JlVeMuXxwHr5qzJnxDcVnuOoJSH3/XB481nWDnllsKLnQ/NoGmD65tB+hfg7A34+jwYatHIVGrGCldLRBkEE+RMQfcBdDHcK2D9qwG7H8z3E+Z8MIUMjI20uh75R/dCXIWAVQq0prh911w/SGltYO/8lK64eP4BzGb+GuHYYNHNSFsHESwFq8ejwVXTti1ID5XP4XYACCAtv47eiZUwAAAABJRU5ErkJggg=="},"raw": {"name": "Inliner.Ed.Widgets.Gallery","title": "⊛ Inliner Gallery","version": "4.0","build": 3,"com": [{"stamp": "1460979599048","id": "Root","type": "js","data": "({\n\tid:\"in.Gallery\",\n\tname:\"Image gallery\",\n\tparams:{restyle:200},\n\tdata:{\n\t\ttitle:'',\n\t\ttype:\"inliner-gallery\",\n\t\titems:[],\n\t\tgap:\"10\",\n\t\tround:'0',\n\t\tratio:\"4:3\",\n\t\taction:'',//['zoom'],\n\t\tbg:'#efefef'\n\t},\n\tLayout:'normal',\n\tinit: function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\tlang = 'en';\n\t\t\n\t\t// L10N\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t// HTML\n\t\t\n\t\t$o.html(that.HTML.join(''));\n\t\t\n\t\t// Load attachments\n\t\tif (that.Att) return that.GetAtts();\n\t},\n\tUrl:{},\n\tui:{\n\t\t'#cards':{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar that = this;\n\t\t\t\t// Zoom\n\t\t\t\tif (that.data.action+'' == 'zoom') {\n\t\t\t\t\t$o.on('click.my', '.in-w-gallery-item', function(evt){\n\t\t\t\t\t\t// if (that.data.items.length<2) return false;\n\t\t\t\t\t\tvar idx = $(this).data('idx'),\n\t\t\t\t\t\t\t\td = that.data;\n\n\t\t\t\t\t\t// Prepare modal, calculate width\n\t\t\t\t\t\tvar ww = $(window).width() - 40,\n\t\t\t\t\t\t\t\twh = $(window).height() -100,\n\t\t\t\t\t\t\t\tar = d.ratio.split(/\\D/),\n\t\t\t\t\t\t\t\tratio = ar[0]/ar[1],\n\t\t\t\t\t\t\t\twidth = (Math.min(ww/ratio, wh).clamp(100,900) * ratio | 0).clamp(200,1600),\n\t\t\t\t\t\t\t\theight = width/ratio | 0;\n\n\t\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\t\tmanifest:$.extend({Url:that.Url},that.Fullscreen),\n\t\t\t\t\t\t\twidth:width,\n\t\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t\tw:width,\n\t\t\t\t\t\t\t\th:height,\n\t\t\t\t\t\t\t\titems:d.items,\n\t\t\t\t\t\t\t\tidx:idx,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tclose:false,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\tcss:'p10'\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (that.data.action+'' == 'link') {\n\t\t\t\t\t\n\t\t\t\t\t$o.on('click.my', '.in-w-gallery-item', function(evt){\n\t\t\t\t\t\tif (that.data.items.length<2) return false;\n\t\t\t\t\t\tvar idx = $(this).data('idx'),\n\t\t\t\t\t\t\t\trow = that.data.items[idx],\n\t\t\t\t\t\t\t\tlink = row.link || '';\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (link) window.location.href=link;\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t},\n\t\t\tbind: function(d){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tt = that.L[that.Layout][d.items.length],\n\t\t\t\t\t\timgs = Object.clone(d.items, true),\n\t\t\t\t\t\th = '',\n\t\t\t\t\t\tctr = 0;\n\t\t\t\t\n\t\t\t\tif (imgs.length) {\n\t\t\t\t\t\n\t\t\t\t\tt.c.forEach(function(col, idx){\n\t\t\t\t\t\tvar a = col.slice(1);\n\t\t\t\t\t\th+='<div class=\"in-w-gallery-col in-w-gallery-c'+col[0]+'\">';\n\n\t\t\t\t\t\ta.forEach(function(cell){\n\t\t\t\t\t\t\tvar img = imgs.shift();\n\t\t\t\t\t\t\tif (img) {\n\t\t\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t\t\t'<div class=\"in-w-gallery-cell in-w-gallery-i-'+idx+'-'+cell+'\">',\n\t\t\t\t\t\t\t\t\t\t'<div class=\"in-w-gallery-item in-w-gallery-z-'+idx+'-'+cell+'\" ',\n\t\t\t\t\t\t\t\t\t\t'data-idx=\"'+ctr+'\" ',\n\t\t\t\t\t\t\t\t\t\t'style=\"background-image:url(\\''+(that.Url[img.url]||img.url)+'\\');\">',\n\t\t\t\t\t\t\t\t\t\t\t(img.desc?'<div class=\"in-w-gallery-item-desc\">'+img.desc+'</div>':''),\n\t\t\t\t\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t].join('');\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tctr+=1;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\th+='</div>';\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t}\n\t\t},\n\t\t'#nocards':{\n\t\t\tbind:'this.Lang.EMPTY',\n\t\t\twatch:'#cards',\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !!d.items.length }\n\t\t\t}\n\t\t},\n\t\t\"#btn-gopts\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif(v!=null) {\n\t\t\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar root = $o.parents('#medium');\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\troot:root.size()?root:undefined,\n\t\t\t\t\t\t\tbound:0,\n\t\t\t\t\t\t\twidth:705,\n\t\t\t\t\t\t\tmanifest:$.extend(true, {}, that.Opts, {Att:that.Att}),\n\t\t\t\t\t\t\tdata:Object.clone(d, true),\n\t\t\t\t\t\t\talign:'right:38px;',\n\t\t\t\t\t\t\tscreen:'rgba(255,255,255,0.65)',\n\t\t\t\t\t\t\tnose:'right',\n\t\t\t\t\t\t\tfocus:false,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\tesc:true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t['items','gap','bg','ratio','action','round']\n\t\t\t\t\t\t\t.forEach(function(k){d[k]=res[k]});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthat.GetAtts().then(function(){\n\t\t\t\t\t\t\t\tthat.my.check(\"#cards\");\n\t\t\t\t\t\t\t\tthat.my.root().my('restyle');\n\t\t\t\t\t\t\t\tthat.my.root().trigger(\"change\");\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t'self:hide':function(){return !!this._compiled}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div class=\"in-w-btn-box\">',\n\t\t\t'<button id=\"btn-gopts\" class=\"hide\"><span class=\"fi-wrench\"></span></button>',\n\t\t'</div>',\n\t\t'<div class=\"in-w-gallery-box\">',\n\t\t\t'<div id=\"nocards\" class=\"hide in-w-empty\"></div>',\n\t\t\t'<div id=\"cards\" class=\"in-w-gallery\"></div>',\n\t\t'</div>'\n\t]\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1460979666332","id": ".L","type": "js","data": "({\n\t// Layouts\n\twide: [\n\t\t{},\n\t\t{w:1, h:1, c:[[1,1]]},\t\t\t\t\t\t\t\t\t\t//1\n\t\t{w:2, h:1, c:[[1,1],[1,1]]},\t\t\t\t\t\t\t//2\n\t\t{w:3, h:2, c:[[2,2],[1,1,1]]},\t\t\t\t\t\t//3\n\t\t{w:5, h:3, c:[[3,3],[2,2,1,1]]},\t\t\t\t\t//4\n\t\t{w:4, h:2, c:[[2,2],[1,1,1],[1,1,1]]},\t\t//5\n\t\t{w:11, h:6, c:[[6,6],[3,3,3],[2,2,2,2]]},\t//6\n\t\t{w:6, h:3, c:[[3,3],[2,2,1,1],[1,1,1,1]]},//7\n\n\t\t//{w:6, h:4, c:[[3,3,1,1,1],[3,3,1,1,1]]},\t//8\n\t\t{w:19, h:12, c:[[12,12],[4,4,4,4],[3,3,3,3,3]]},\n\n\t\t//{w:4, h:3, c:[[2,2,1,1],[1,1,1,1],[1,1,1,1]]},\t//9\n\t\t{w:13, h:6, c:[[6,6],[3,3,3],[2,2,2,2],[2,2,2,2]]},\t//9\n\n\t\t{w:25, h:12, c:[[12,12],[6,6,6],[4,4,4,4],[3,3,3,3,3]]}\t//10\n\t],\n\n\tnormal:[\n\t\t{},\n\t\t{w:1, h:1, c:[[1,1]]},\n\t\t{w:2, h:1, c:[[1,1],[1,1]]},\n\t\t{w:3, h:2, c:[[2,2],[1,1,1]]},\n\t\t{w:4, h:3, c:[[3,3],[1,1,1,1]]},\n\t\t{w:6, h:5, c:[[6,3,3],[6,2,2,2]]}, // 5\n\t\t{w:3, h:3, c:[[2,2,1,1],[1,1,1,1]]},\n\t\t{w:12, h:7, c:[[12,4,4,4],[12,3,3,3,3]]},\n\t\t{w:6, h:7, c:[[6,3,3],[6,2,2,2],[6,2,2,2]]},\n\t\t{w:3, h:3, c:[[3,1,1,1],[3,1,1,1],[3,1,1,1]]},\n\t\t{w:12, h:11, c:[[12,4,4,4],[12,4,4,4],[12,3,3,3,3]]}\n\t],\n\n\tnarrow:[\n\t\t{},\n\t\t{w:1, h:1, c:[[1,1]]},\n\t\t{w:1, h:2, c:[[1,1,1]]},\n\t\t{w:2, h:3, c:[[2,2,1,1]]},\n\t\t{w:2, h:5, c:[[2,2,2,1,1]]},\n\t\t{w:2, h:4, c:[[2,2,1,1,1,1]]}, //5\n\t\t{w:2, h:3, c:[[2,1,1,1,1,1,1]]},\n\t\t{w:2, h:5, c:[[2,2,1,1,1,1,1,1]]},\n\t\t{w:2, h:7, c:[[2,2,2,1,1,1,1,1,1]]},\n\t\t{w:2, h:6, c:[[2,2,1,1,1,1,1,1,1,1]]},\n\t\t{w:2, h:5, c:[[2,1,1,1,1,1,1,1,1,1,1]]}\n\t]\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1462868932320","id": ".Lang","type": "js","data": "({\n\t'en':{\n\t\tAPPTITLE:'Image gallery',\n\t\tEMPTY:'Set up list of images using button at right'\n\t},\n\t'ru':{\n\t\tAPPTITLE:'Галерея изображений',\n\t\tEMPTY:'Настройте список изображений кнопкой справа'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1460981240941","id": ".style","type": "js","data": "({\n\t' .in-w-empty':'opacity:0.7;text-align:center;',\n\t\n\t' .in-w-gallery-box':'width:100%;overflow:hidden;', \n\t\n\t' .in-w-btn-box':{\n\t\t'':'width:100%;z-index:+10;position: absolute; top: 0px; right:0px;',\n\n\t\t' #btn-gopts':'position: absolute; top: 5px; right:5px; font-size:17px;z-index:+3;border-radius:100px!important;'\n\t\t\t+'padding:0; line-height:30px;width:30px;height:30px;margin:0;opacity:0.5;',\n\t\t\t' #btn-gopts:hover':'opacity:1;'\n\t},\n\t\n\t//' .in-w-gallery ':'min-height:100px;',\n\t\n\t' .in-w-gallery-item':'transition:height 0.1s;',\n\t\n\t' .in-w-gallery-item-desc':'color:white; line-height:1.1em; text-overflow:ellipsis;'\n\t\t+'overflow:hidden;position:absolute; bottom:0;left:0;width:100%;padding:0.7em 1em;'\n\t\t+'word-break:break-word; opacity:0.5; transition: opacity 0.3s;'\n\t\t+'background-image: -moz-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t+'background-image: -webkit-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t+'background-image: -o-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t+'background-image: -ms-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t+'background-image: linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50))',\n\t\n\t' .in-w-gallery-item:hover .in-w-gallery-item-desc':'opacity:1;',\n\t\n\t' .in-w-gallery-box ':function($o){\n\t\tvar r = this.data.round || '0';\n\t\tif (r == '0') return '';\n\t\tr = r+'px;'\n\t\treturn {\n\t\t\t'':'border-radius:'+r,\n\t\t\t'#cards>div:last-child>div:last-child>div':'border-bottom-right-radius:'+r\n\t\t};\n\t},\n\t\n\t' .in-w-gallery':function($o){\n\n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tn = d.items.length,\n\t\t\t\tgap = d.gap/2,\n\t\t\t\tw0 = 99.999,\n\t\t\t\tww = $o.width(),\n\t\t\t\tscheme = ww<500?'narrow':ww<1000?'normal':'wide';\n\t\t\n\t\tthat.Layout = scheme;\n\t\t\t\t\t\t\t\t\n\t\tvar t = that.L[scheme][n],\n\t\t\t\tk = d.ratio.split(\":\")[1]/d.ratio.split(\":\")[0],\n\t\t\t\tx = (w0/t.w).round(4),\n\t\t\t\ty = (k*(ww+gap*2)/t.w).round(4),\n\t\t\t\tvc = 'calc(100% + '+d.gap+'px);';\n\t\t\n\t\tvar res = {\n\t\t\t' ':'width:'+vc+'margin:-'+gap+'px;'+(scheme=='wide'?'white-space: nowrap;':''),\n\t\t\t' .in-w-gallery-col':'display:inline-block;vertical-align:top;white-space: normal;',\n\t\t\t' .in-w-gallery-cell':'display:inline-block;vertical-align:top;padding:'+gap+'px;overflow:hidden;',\n\t\t\t' .in-w-gallery-item':'width:100%; display:block;background-size:cover;background-repeat:no-repeat;'\n\t\t\t+'background-position:center center; background-color:'+d.bg+';'\n\t\t\t+(d.action=='zoom'?'cursor:zoom-in;':'')\n\t\t};\n\t\t\n\t\tvar cells = {}, its = {};\n\t\tif (t.c) {\n\t\t\tt.c.forEach(function(a, idx){\n\t\t\t\tvar col = a[0];\n\t\t\t\tcells[col]=1;\n\t\t\t\t\n\t\t\t\ta.from(1).forEach(function(i){ its[idx+'-'+i] = {i:i, w:100*i/col}; })\n\t\t\t});\n\t\t\t\n\t\t\tObject.keys(cells).forEach(function(i){\n\t\t\t\tvar wr = (x*i).round(4);\n\t\t\t\tres[' .in-w-gallery-c'+i] = 'width:'+wr+'%;';\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\tObject.keys(its).forEach(function(i){\n\t\t\t\tvar wc = its[i].w.round(4);\n\t\t\t\tres[' .in-w-gallery-i-'+i] = 'width:'+wc+'%!important;'\n\t\t\t\tres[' .in-w-gallery-z-'+i] = 'height:'+(y*its[i].i-gap*2).round(4)+'px!important;';\n\t\t\t});\n\t\t}\n\t\t\n\t\t(function($f){$f.find('#cards').trigger('recalc');}).fill($o).delay(5);\n\t\t\n\t\treturn res;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1460982532965","id": ".data.items","type": "js","data": "([\n\t//{id:'2', url:'http://jquerymy.com/lj/solovki.pro_139DA/2016031719.03.jpg', desc:''},\n\t{id:'1', url:'http://jquerymy.com/lj/Micdrop_7A6/2016040223.16.59.png', \n\t desc:'Какой-то текст с длиннннннннннннннннннннннннннннннными словами В 2016 году введена новая вне командная номинация – «Лучший машинист фронтального погрузчика». '},\n\t{id:'2', url:'http://jquerymy.com/lj/solovki.pro_139DA/2016031719.03.jpg', desc:''},\n\t{id:'3', url:'http://jquerymy.com/lj/II_DDDB/2016030915.18.24.png', desc:''},\n\t{id:'4', url:'http://jquerymy.com/lj/61c7997bc005_9EC5/IMG_1488.jpg', desc:''},\n])","active": false,"err": [],"opts": ["nocompile"],"color": ["green"]},{"stamp": "1460996771315","id": ".GetAtts","type": "js","data": "(function(){\n\tvar that = this,\n\t\t\tpi = $.Deferred(),\n\t\t\td = that.data,\n\t\t\tpis = [],\n\t\t\tatts = that.Att(null);\n\n\t//Prepare session urls\n\tif (!d.items.length || !Object.size(atts)) pi.resolve();\n\telse {\n\t\td.items.forEach(function(e){\n\t\t\tvar s = e.url+'';\n\t\t\tif (atts[s]) {\n\t\t\t\tvar u = that.Att(s, 'url');\n\t\t\t\tif (typeof u == 'string') that.Url[s] = u;\n\t\t\t\telse {\n\t\t\t\t\tu.then(function(res){ that.Url[s] = res; });\n\t\t\t\t\tpis.push(u);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (!pis.length) pi.resolve();\n\t\telse {\n\t\t\t$.when.apply(null, pis).done(function(){ pi.resolve(); }.debounce(1));\n\t\t}\n\t}\n\n\treturn pi.promise();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1461004357458","id": ".To","type": "js","data": "({\n\tdata:function(item, options){\n\t\tvar that = this,\n\t\t\t\td = item,\n\t\t\t\th = '',\n\t\t\t\tid = Number.random(1e6, 1e7-1),\n\t\t\t\topts = Object.merge(\n\t\t\t\t\t{path:''}, \n\t\t\t\t\tObject.isObject(options)?options:{}\t\t\t\t\t\t\n\t\t\t\t);\n\t\tvar obj, s = item.data.replace(/^\\(|\\)$/g,'');\n\t\t\n\t\ttry {\n\t\t\tobj = JSON.parse(s);\n\t\t} catch(e){}\n\t\t\n\t\tif (!Object.isObject(obj)) return item.data;\n\t\t\t\t\n\t\tif (opts.path || opts.Urls) {\n\t\t\tobj.items = obj.items.map(function(e){\n\t\t\t\tvar s = e.url;\n\t\t\t\tif ((s+'').to(1)=='/' || /^http[s]:/.test(s+'')) return e;\n\t\t\t\te.url = opts.Urls?opts.Urls[s]:(opts.path+s);\n\t\t\t\treturn e;\n\t\t\t});\n\t\t}\n\t\t\n\t\treturn '('+JSON.stringify(obj)+')';\n\t},\n\tfiles: function(data){\n\t\tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\tif (!/^http[s]:\\/\\//.test(e.url)) list[e.url] = true;\n\t\t});\n\t\treturn list;\n\t},\n  updateFiles: function(data, replacer){\n  \tvar list = {};\n\t\tdata.items.forEach(function(e){\n\t\t\tif (!/^http[s]:\\/\\//.test(e.url)) list[e.url] = true;\n\t\t});\n\t\tif (!Object.isObject(replacer)) return data;\n    \n    data.items.forEach(function(e){\n\t\t\tif (!list[e.url]) return;\n      if (replacer[e.url]) e.url = replacer[e.url];\n\t\t});\n    return data;\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1460981173332","id": ".Opts","type": "js","data": "({\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\tlang = 'en';\n\t\t\n\t\tif (cw.me && that.Lang[cw.me('locale')]) lang = cw.me('locale');\n\t\tthat.Lang = that.Lang[lang];\n\t\t\n\t\t$o.html(that.HTML.join('').assign(that.Lang));\n\t\t\n\t\tif (that.Att) {\n\t\t\treturn that.Att(/\\.(jpg|jpeg|png|gif|svg)$/i, \"preview\")\n\t\t\t.then(function(res){\n\t\t\t\tres.forEach(function(e){ that.P[e.fname] = e; });\n\t\t\t});\n\t\t}\n\t},\n\tP:{},\n\tui:{\n\t\t\"#gitems\":{\n\t\t\tbind:\"items\",\n\t\t\tinit: function($o){\n\t\t\t\t$o.sortable({handle:\"#gpreview\"});\n\t\t\t},\n\t\t\tlist:'<div class=\"fs80\"></div>',\n\t\t\tmanifest:{\n\t\t\t\tinit:function($o){\n\t\t\t\t\tvar that = this;\n\t\t\t\t\t$o.html([\n\t\t\t\t\t\t'<div id=\"gpreview\" class=\"dib vat mr10 br2 mt4 h32 w40\" style=\"background-size:cover;background-repeat:no-repeat;'\n\t\t\t\t\t\t\t+'background-position:center center;width:40px;cursor:move;\"></div>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gurl\" class=\"w350 mr4 h32\"></span>',\n\t\t\t\t\t\t'<span class=\"dib vat mt4\"><input type=\"text\" id=\"gdesc\" class=\"w300 mr0 h32\" placeholder=\"{DESC}\"></span>'\n\t\t\t\t\t].join('').assign(that.Lang));\n\t\t\t\t},\n\t\t\t\tinherit:['P','Att','Lang'],\n\t\t\t\tui:{\n\t\t\t\t\t'#gpreview': {\n\t\t\t\t\t\tbind: function(d,v,$o){\n\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t$o.css({\n\t\t\t\t\t\t\t\t'background-image':'url(\\''+(that.P[d.url]?that.P[d.url].data:d.url+'')+'\\')'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\twatch:'#gurl'\n\t\t\t\t\t},\n\t\t\t\t\t'#gurl':{\n\t\t\t\t\t\tbind:'url',\n\t\t\t\t\t\tinit:function($o){\n\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t$o.select2({\n\t\t\t\t\t\t\t\ttags:Object.keys(that.P),\n\t\t\t\t\t\t\t\tmaximumSelectionSize:1,\n\t\t\t\t\t\t\t\tplaceholder:that.Lang.URL\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'#gdesc':'desc'\n\t\t\t\t}\n\t\t\t},\n\t\t\tid:['id'],\n\t\t\thash:['id','url','desc']\n\t\t},\n\t\t'#nogitems':{\n\t\t\tbind:'this.Lang.EMPTY',\n\t\t\twatch:'#gitems',\n\t\t\tcss:{\n\t\t\t\thide:function(d){return !!d.items.length;}\n\t\t\t}\n\t\t},\n\t\t'#btn-gapply':function(d,v){\n\t\t\tif (v!=null) {\n\t\t\t\td.items = d.items.map(function(e){if (e.url+'') {e.url=e.url+'';return e;}}).compact();\n\t\t\t\tthis.my.commit();\n\t\t\t}\n\t\t},\n\t\t'#btn-gadd':function(d,v, $o){\n\t\t\tif (v!=null) {\n\t\t\t\tthis.my.insert('#gitems',{\n\t\t\t\t\tid:Number.random(1e12).toString(36), \n\t\t\t\t\turl:'', \n\t\t\t\t\tdesc:''\n\t\t\t\t});\n\t\t\t\tvar $r = $o.my().root;\n\t\t\t\t(function(){\n\t\t\t\t\t$r.parent().trigger('layout');\n\t\t\t\t}).debounce(80)();\n\t\t\t}\n\t\t},\n\t\t'#ggap':'gap',\n\t\t'#gratio':'ratio',\n\t\t'#ground':'round',\n\t\t'#gaction':{\n\t\t\tinit: function($o){$o.tags(this.Lang.CLICK)},\n\t\t\tbind:'action'\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div class=\"fr tar w450 fs80\" style=\"z-index:+2\">{ONCLICK} <span id=\"gaction\"></span></div>',\n\t\t'<div class=\"fs120 mb4 xgray\">{TITLE}</div>',\n\t\t'<div id=\"nogitems\" class=\"hide fs90 pt10 pb10 o80\"></div>',\n\t\t'<div id=\"gitems\"></div>',\n\t\t'<div id=\"gbtns\" class=\"mt10 btd pt10\">',\n\t\t\t'<div class=\"fr fs80 xgray w420 tar\">',\n\t\t\t\t'{GAP1}<input type=\"number\" class=\"w50 mr4\" id=\"ggap\">',\n\t\t\t\t'{GAP2}<input type=\"number\" class=\"w50 mr4\" id=\"ground\">',\n\t\t\t\t'{GAP3}<input type=\"text\" class=\"w70\" id=\"gratio\">',\n\t\t\t'</div>',\n\t\t\t'<button id=\"btn-gadd\" class=\"fs80 mr10 w40\"><span class=\"fi-plus\"></span></button>',\n\t\t\t'<button id=\"btn-gapply\" class=\"green fs80 w150\">{APPLY}</button>',\n\t\t'</div>'\n\t\t\n\t],\n\tstyle:{\n\t\t' .select2-choices':'max-height:2.1em;'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1462868286220","id": ".Opts.Lang","type": "js","data": "({\n\ten:{\n\t\tTITLE:'Gallery',\n\t\tEMPTY:'Add attached files or external image URLs',\n\t\tAPPLY:'Apply',\n\t\tGAP1:'Gap ',\n\t\tGAP2:'px, round ',\n\t\tGAP3:'px, ratio ',\n\t\tURL:'Attached image or web URL',\n\t\tDESC:'Description',\n\t\t\n\t\tONCLICK:'On click ',\n\t\tCLICK:{\n\t\t\ttags:[[{'Zoom':'zoom'},{'Goto link':'link'}]],\n\t\t\tempty:{'Ignore':''}\n\t\t}\n\t},\n\tru:{\n\t\tTITLE:'Галерея',\n\t\tEMPTY:'Добавьте вложения или ссылки на внешние картинки',\n\t\tAPPLY:'Применить',\n\t\tGAP1:'Просвет ',\n\t\tGAP2:'px, радиус ',\n\t\tGAP3:'px, аспект ',\n\t\tURL:'Вложенное изображение или URL',\n\t\tDESC:'Текст описания',\n\t\t\n\t\tONCLICK:'Клик картинке – ',\n\t\tCLICK:{\n\t\t\ttags:[[{'Зум':'zoom'},{'Перейти по URL':'link'}]],\n\t\t\tempty:{'Пропустить':''}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1463217530920","id": ".Fullscreen","type": "js","data": "({\n\tinit:[\n\t\t'<div id=\"pframe\">',\n\t\t\t'<div id=\"pcont\"></div>',\n\t\t\t'<div id=\"pleft\"></div>',\n\t\t\t'<div id=\"pright\"></div>',\n\t\t'</div>'\n\t],\n\tui:{\n\t\t'#pcont':{\n\t\t\tinit: function($o){\n\t\t\t\tvar that = this;\n\t\t\t\t\n\t\t\t\t$o.addClass('ptrans')\n\t\t\t\t.on('click.my','.pimg', function(){\n\t\t\t\t\tthat.my.commit();\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif ($.fn.swipe && that.data.items.length > 1) {\n\t\t\t\t\tthat.my.find('#pframe').swipe({\n\t\t\t\t\t\tswipeLeft: function(){that.Align(1);},\n\t\t\t\t\t\tswipeRight: function(){that.Align(-1);},\n\t\t\t\t\t\tthreshold:50\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\ta = d.items.slice(0);\n\t\t\t\ta.unshift(d.items.last());\n\t\t\t\ta.push(d.items[0]);\n\t\t\t\treturn a.map(function(e){\n\t\t\t\t\treturn [\n\t\t\t\t\t\t'<div class=\"pimg\" style=\"background-image:url(\\''+(that.Url[e.url]||e.url)+'\\');\">',\n\t\t\t\t\t\t\t(e.desc?'<div class=\"in-w-gallery-item-desc\">'+e.desc+'</div>':''),\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t].join('');\n\t\t\t\t}).join('');\n\t\t\t}\n\t\t},\n\t\t'#pright':{\n\t\t\tbind: function(d, v){\n\t\t\t\tif (v!=null) this.Align(1);\n\t\t\t\treturn '<div class=\"pbtn\">›</div>';\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t},\n\t\t'#pleft':{\n\t\t\tbind: function(d, v){\n\t\t\t\tif (v!=null) this.Align(-1);\n\t\t\t\treturn '<div class=\"pbtn\">‹</div>';\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t}\n\t},\n\tAlign:function(x){\n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tidx = d.idx,\n\t\t\t\tshifted = false;\n\t\t\n\t\tif (idx == 0 && x<0) {\n\t\t\tthat.my.find('#pcont')\n\t\t\t.removeClass('ptrans')\n\t\t\t.css({\n\t\t\t\ttransform:'translateX('+(-d.w * (d.items.length+1))+'px)'\n\t\t\t});\n\t\t\tshifted = true;\n\t\t}\n\t\telse if (idx == d.items.length-1 && x>0) {\n\t\t\tthat.my.find('#pcont')\n\t\t\t.removeClass('ptrans')\n\t\t\t.css({\n\t\t\t\ttransform:'translateX(0px)'\n\t\t\t});\n\t\t\tshifted = true;\n\t\t}\n\t\t\n\t\t(function() {\n\t\t\tif (shifted) that.my.find('#pcont').addClass('ptrans');\n\t\t\td.idx = (d.idx + d.items.length + (+x)) % d.items.length;\n\t\t\tthat.my.find('#pcont').css({\n\t\t\t\ttransform:'translateX('+(-d.w * (d.idx+1))+'px)'\n\t\t\t});\n\t\t}).delay(20);\n\t},\n\tstyle:{\n\t\t'': function(){\n\t\t\tvar that = this,\n\t\t\t\t\td = that.data;\n\t\t\td.w0 = d.w * (d.items.length+2) + 1;\n\t\t\td.shift = -d.w * (d.idx+1);\n\t\t\treturn {\n\t\t\t\t' #pframe':'overflow:hidden;width:{w}px;height:{h}px;'.assign(d),\n\t\t\t\t' #pcont':'width:{w0}px;height:{h}px;transform:translateX({shift}px);'.assign(d),\n\t\t\t\t\n\t\t\t\t' #pcont>div':'cursor:zoom-out;background-size: cover;background-repeat: no-repeat;'\n\t\t\t\t+'display:inline-block;margin:0;padding:0;vertical-align:top;'\n\t\t\t\t+'background-position: center center;overflow:hidden;width:{w}px;height:{h}px;'.assign(d),\n\t\t\t\t\n\t\t\t\t' #pleft, #pright':d.items.length==1?'display:none;':\n\t\t\t\t('opacity:0.2;transition:opacity 0.2s;line-height:'+(d.h-120)+'px;'\n\t\t\t\t+'padding:30px;color:white;font-size:80px;text-shadow:0 0 15px rgba(0,0,0,0.7);'\n\t\t\t\t+'z-index:+1;position:absolute; top:0; width:'+d.w/3+'px;height:'+d.h+'px;'),\n\t\t\t\t\n\t\t\t\t' #pleft:hover, #pright:hover':'opacity:1;',\n\t\t\t\t' #pright':'right:0px;text-align:right;cursor:pointer;',\n\t\t\t\t' #pleft':'left:0px;text-align:left;cursor:pointer;',\n\t\t\t\t//' .pbtn':'width:100px;height:100px;border-raius:100px; background:rgba(0,255,0,0.5);',\n\t\t\t\t' .ptrans':'transition:transform 0.3s;',\n\t\t\t\t' .in-w-gallery-item-desc':'color:white; font-size:1.2em;line-height:1.2em; text-overflow:ellipsis;'\n\t\t\t\t\t\t+'overflow:hidden;position:absolute; bottom:0;left:0;width:100%;padding:1em 1.3em;'\n\t\t\t\t\t\t+'word-break:break-word; opacity:0.7;text-align:center;'\n\t\t\t\t\t\t+'background-image: -moz-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: -webkit-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: -o-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: -ms-linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50));'\n\t\t\t\t\t\t+'background-image: linear-gradient(top, rgba(0,0,0,0), rgba(0,0,0,0.4), rgba(0,0,0,0.5), rgba(0,0,0,0.50))',\n\t\t\t};\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1465148164438","id": ".Ico","type": "text","data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABo1JREFUeNrkW2toHFUUvhurFtPWXEu1ICqO6UMRfExBW0VJzKggAdF27Q9bEcFFsMQ/YopVqmhYCz5+1McWRFBb6AaxVTTibCMp6q9u/aX4HF9oCxVubXxUg43fmZ2dvXf2bmYzmd2d3dxk9s7Mztyd7zvn3HvOnXNT09PTbD6XBfSRSqUa+iN52zZQXcEYX82YWIn6XBwvxj42ThKYxD42dgTbV952OG1ZvzTyuUj4KfcjZgKy+fwZBue3YXcQWz9AXhSxqa9BzDjqfaNCFEbT6f8STQAkfSmqLQB8F+pzYhYYtEPsRr0TmvFjoggAcKg32wbgd6Du0l3DOW2c0Z/3rxThfgj6x36prlGmcMWbqEdAxLctJQDACcfTgJPRATcMzgwCzXmk9gVYcGhztGz8iyuexTdPZSzrr6YTAPC3A/gu7C4LSto0jMiga5USEY5GMwSZwz3QhommEOB1cDsAdagZwHVaUawiQlDnuN0pFkeGh4dPNYwAT+XfAdzr5fOmabiq3sxCZkFEBOjZLxy2MZOxTsZOAMCfj+oDgL9clvqAabbUkSkUi0Ft+BjHg5m0dTw2AnK2fR6wfgLIl8gdHKl8EgppgtpRikMgoQ8k/BFGQFeo5PP2EvTjYzJ4Ap4U8OXnIYFIPdIaaOfb1F+F3RtGQAoD9l7UVyn2bnCWtFISikLCAPqlV+ZEAOx+Kxq6VWGaJw98xSyrNOFeYNgciQDcuA7Vk4pTYyQXvCykwFD8ErCsnBUB2axNUWIODJ4mj/HtUgZM+Vl5N5EwKwIMkw3Jw53Z4qEuBhJughZsrIuAXN7uwQ2Py6rPWfsVMgO1v+LP5HK500MJwI0IZ9kS2abatZiKFrALuWHePSMBcHjOghMx1AngZQ2WylZ3aA9OifnSZ/xOVEtr3FzLK4/7kYPRT5iuh44KjlMsH65AX9CHyHFcSwB+bXN5qqIe8I5Yg+crxgufZ4HpEc/HRdu7CmHjHmP3bwhpk7vhtFc2YRuvMgGo/3KA75edijqC0/jDXVmjRDyPEBDmemA9s4oACuzKx1wzZdXORXWM+CIcrdV0grxPf0NnlIAL368hQNxY4+LO0ALVDG5QCMjl7IW45OJO1oCAGVymEMAN1ltHaNzeBKiHy7zpPR90b53DaieVXpmAHskZSqzYIl+jF26P5AjxxQl15hGbm7ERECiLJAJEt98ST7bxzr0x33Pqlk3g7wY6dwkqCriTciwwmcTHpZnughPm4MCFjRa0TsoEnKhwlBwVcN8UixijEfXiE7IJ/FBv9NkpBoD9730CRCklhc0b64f0M5Z11CcAB2QPv1a0oPPUIIDpS00wRO/+5gsB4lNdNDhe6X07kAA1y2RcpwEHOrUjLOUd+WUKBxNVBKQt6xtUh30tcFrDghKLxOQFOkJxJsbSacsf9oOToq/jV68uEeAwwzBDnBCbCV6MmYDKBKdJU3NmuCMUSoCaO/CG/N2CgKrs4Vxk8bMLhdcXzDw7ZOCBG/vuYK7vYwOafAxH78onlEmQTNo6hurVys1O29t/II/oeQz5/9QkwCs73I7C6zxa1RfED14cB6AXg9dUEYDO8CdUL9dgsK2KKjw+Ind+M2kAif4xfBwtHxaK7UcCZY9J5QvhFF/QXaclwGPqIdmLaidTCCRSngKCBzKZzFTdBHimsBc3vqY2mnwSqnOLBSVVH6x1fVdIBPUgPj+XTSHJJLhptIq5iolRIbbPdE9oomTetumFCYIHvrx8jtJPkvbyxKkC7y62uA7S/63WPXVninrrAeA/87N9L81MTsqcJm8Yob1YF7awYra5wtegeg8kKAkUrc4iIakHolcM4+JmgA+d5ImSLb4aBHyI3Qv80dVNoTOb/kapbO9qj+T2V7fUu9gq0noBSqRAxLYHu32Kz95EbdBIncC/hVP3wZ3/vd52Iq8YyWazXYZpUirdtnIyZaOJcIMzPXCa338YUt852zbjWDNEawHJbV5bFdZyL3d3jrZBHRzF8zVG3zF8sQWO23dR2o5r1VgKRGwC5Eexr83JlVeMuXxwHr5qzJnxDcVnuOoJSH3/XB481nWDnllsKLnQ/NoGmD65tB+hfg7A34+jwYatHIVGrGCldLRBkEE+RMQfcBdDHcK2D9qwG7H8z3E+Z8MIUMjI20uh75R/dCXIWAVQq0prh911w/SGltYO/8lK64eP4BzGb+GuHYYNHNSFsHESwFq8ejwVXTti1ID5XP4XYACCAtv47eiZUwAAAABJRU5ErkJggg==","active": false,"err": [],"opts": [],"color": ["green"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "950","runMode": ["fullscreen"],"runCss": "p0","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Gallery widget for Inliner 3","timeout": "3000","author": "ermouth","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"collapsed": [],"ico": "","padding": "auto"},"log": [[1539744010192,"update","ermouth-524yb546",28,"dev-cloudwall2"]],"id": "cw.Inliner.Ed.Widgets.Gallery","stamp": 1539744010191,"creator": "ermouth-e3o7ecs0","parent": "cw-Inliner-4vx1"},{"_id": "cw-Inliner-Ed-Widgets-Contents-0k00","_rev": "71-8cfe45cbe0ee174722e57f0775220c92","name": "Inliner.Ed.Widgets.Contents","title": "⊛ Inliner Contents","type": "manifest","desc": "Contents aside floater for Inliner","beta": false,"tags": ["Inliner"],"manifest": {"id": "cw.Inliner.Ed.Widgets.Contents","build": 20,"defaultFormat": {"format": ["right200"],"css": ["Z5"]},"data": {"title": "","type": "inliner-contents","rules": [{"id": "h1","skip": false,"selector": ".in--html h1","css": "fs120 bolder"},{"id": "h2","skip": true,"selector": ".in--html h2","css": "fs105 bolder"},{"id": "h3","skip": true,"selector": ".in--html h3","css": "pl5 w100p nw oh ell"}],"padding": "10px 10px 15px 15px","drop": "","bg": "#f5f7f9","floater": true},"params": {"restyle": 1},"meta": {},"Lang": {"en": {"APPTITLE": "Contents"},"ru": {"APPTITLE": "Содержание"}},"Titles": [],"init": "function ($o) {\n\t\tvar that = this;\n    that.Titles = that.findItems();\n    $o.html(that.HTML.assign(that.lang));\n\t}","ui": {"#aside-links": "function (d,v) {\n    var t = this.Titles, \n        tmpl = '<div class=\"aside-row {3}\"><a href=\"#{1}\">{2}</a></div>';\n    if (!t.length) return;\n    var rows = t.map(function(a){\n      return tmpl.assign(a[0], a[1], a[2].css);\n    }).join('');\n\n    return rows;\n  }","#btn-gopts": {"bind": "function (d,v,$o) {\n      var that = this;\n      if(v!=null) {\n        if ($o.data('modal')) $o.modal(true);\n        else {\n          var root = $o.parents('#medium');\n          $o.modal({\n            root:\t\t\troot.size()?root:undefined,\n            bound:\t\t0,\n            width:\t\t400,\n            manifest:\t$.extend(true, {}, that.Opts, {Att:that.Att}),\n            data:\t\t\tObject.clone(d, true),\n            align:\t\t'right:38px;top:0;',\n            //css:'z20',\n            screen:\t\t'rgba(255,255,255,0.65)',\n            nose:\t\t\t'right',\n            focus:\t\tfalse,\n            enter:\t\ttrue,\n            esc:\t\t\ttrue\n          })\n          .then(function(res){\n            $.extend(d, res);\n            d.rules = d.rules.filter(function(e){return !!e.selector.trim()});\n            that.Titles = that.findItems();\n            that.my.check('#aside-links');\n            that.my.restyle();\n          });\n        }\n      }\n    }","css": {"self:hide": "function () {return !!this._compiled}"}},"#btn-rebuild": {"bind": "function (d,v,$o) {\n      var that = this;\n      if(v!=null) {\n        that.Titles = that.findItems();\n        that.my.check('#aside-links');\n        that.my.restyle();\n      }\n    }","css": {"self:hide": "function () {return !!this._compiled}"}}},"style": {" .aside-row": "line-height:1.2em; padding:0.25em 0;","": "function ($o) {\n      var that = this,\n          d = that.data,\n          m = that.meta,\n          t = m.theme || {},\n          css = 'background-color:'+d.bg+';padding:'+d.padding+';margin-top:'+t.pad.gap+';';\n      \n      css += (d.floater && !m._mobile && $o.parent().parent().width()>600)\n        ?'position:fixed;width:inherit;'\n      \t:'width:100%;';\n      \n      css += 'border-radius:'+t.corner.outer+';'\n      \n      return css;\n    }"," .in-w-btn-box": {"": "width:65px;z-index:+10;position: absolute; top: 5px; right:6px;"," .btn-gopts": "font-size:17px; z-index:+3; border-radius:100px!important;padding:0; line-height:28px; width:30px; height:30px; margin:0; opacity:0.5;transition:top 0.1s, right 0.1s;"," .btn-gopts:hover": "opacity:1;"}},"HTML": "<div class=\"in-w-btn-box\"><button id=\"btn-rebuild\" class=\"hide btn-gopts mr5\"><span class=\"fi-loop\"></span></button><button id=\"btn-gopts\" class=\"hide btn-gopts\"><span class=\"fi-wrench\"></span></button></div><div id=\"aside-links\"><div>{TITLE}</div></div>","lang": {"en": {"TITLE": "Contents"},"ru": {"TITLE": "Содержание"}},"findItems": "function () {\n  var that = this,\n      d = that.data,\n      items = d.rules.reduce(function(a,b){\n        if (b.skip) return a;\n        a[b.selector] = b;\n        return a;\n      },{}),\n      selectors = Object.keys(items),\n      titles = [],\n      $o = that.my.root();\n  \n  var $h = $o.parents(\n    that._compiled\n    ?'.in-doc-body'\n    :'#medium'\n  ).eq(0)\n  .find(selectors.join(','));\n\n  var re = null;\n\tif (d.drop) {\n  \ttry {\n    \tre = new RegExp(d.drop, 'g');\n    }catch(e){}\n  }\n\n  $h.each(function(){\n    var $n = $(this),\n        t = $n.text(),\n        id = $n.attr('id'),\n        result = null;\n\n    if (!(t||'').trim()) return;\n    \n    if (d.drop && re) t = t.replace(re, '');\n\n    if (!id) {\n      id = 'h-'+cw.lib.sdbm(t + Date.now());\n      $n.attr('id', id);\n    }\n\n    selectors.forEach(function(s){\n      if (result != null) return;\n      if ($n.is(s)) result = [id, t.escapeHTML(), items[s]];\n    });\n\n    if (result) titles.push(result);\n\n  });\n  return titles;\n}","Ico": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAACc5JREFUeAHlW2tsFNcVPjO7xvauzYIfGww0dYSDcR4OmFCoKxElpCJxqiZECaS0pOmPKq0SteqPqsqv9l/V5kfVKhWq+gc1Km2cpIS2dooCTUQUJxEBwiPBpjYhxmDq9xNj7J3p+e7Mnb2zrHdn1/buNnske+49cx/nO3Mf5557lijPSVts/H9ofitUWqxvJU2vNzWzlkiv1TQzbBKVaqZWiv6ZP86CjJum1kdkdDC/g0zj9PiUcfTZnV8fXUwZF0UB+w4cWVOwRN9DmtakmWYDP31pgTDNiKlpJ8g0W2duGC8/s2NbV1rtJKi0YAp4srnZ92iwYpdO+nOkUWOCPtN/ZVKbQcbvD04OvPLqzp2R9BuK1py3AgD8sUDlM5pOLxBpa6JNR1NLCvxUsTxEoWCASoPFFCwuIr/fRwU+a2DMRCI0OxuhyanrND45RaOT12hgeJRuzMxGG3GlzC7ToF++ca1/33wVMS8F/Knl35v9mr6XZdvgko8zSxls9aowVVWU0fKlJTwLUuvKNE0aHpug3oEhuni5j8ZYKXHo5Kxp/PDpRx74MM47T6zUpLKb/F1ra2EFFb3IC9rzzHLaQOLWqjDV3raaykNiffMkhJdCg6Pj1PFZD3X39hEvoCpx1nhpgK7/9EdNTdPqCy9pR3gvhVFGLHCFvmau2KDW+fLKMN1dUy2GuMpf6DSmyJnOi/T5Fd4wFGItnDBmzF17Hr2/U2EnTaakgD+3HNmqafrf+aOHZMtLSwK06Y7bKVy+TLIy8uwbHKFjn/6HxibUqWGOmqbxzW8/su2oVyE8K2B/69uPsZb/opFWJBuv+VIVNdTVkM+nS1ZGn5GIQSfOdVLnpV6nX5PM6wzqW7ub7n/DYSZIeFIAwPPEe03u57qu0Za71xGGfS4QpsMHZ9rJMOzVge0HXpme8KKEpArAsGcr7pD88gW8fW3deBeFyzI75JMpum9ohI4eP0szvJ2CMBLYmtyebDokVMDLB9+u8RXQR3LOA/y2zevFtpZMoGy8x7Z55MOPHSWwGkZvTBsbE1mQc05ebHV6gfaKBI9hjy+PPT1XCbJBRshqkRYq4B0LWOaSeU4FYJ/nZpytDnM+14Z9PFCQEbJKAgbLZpEc9zOuAmDh2UaOKF1za1XOLHhu8ePnsDhjh4qS/ryFKcqRqZsUANveNm/FOMI+37CuRpb/v3lie4bsNmnABGySIZ83KQAHG37p2PYwcrK1z0sh03lCZsiu0AYbm8JS7HhwoaEdJZUdzBanOgylxnvqXBViM109V+n9U+284Np7cGyBxc7zIWtLfW3MkI922nbqnGI2m10HJvpr1ROkP1qUCOd5CR7jH7Z9Mmr/7BJdYCVkk0I81N1zPioNMHSzoWR9Hm0NML5KtF+WcE0B4cyw3+BUh7N7MsrWh08ml3wPDMAiScUInqMAGD2qJwdH2i8KubCwtwonWonNUYDup+9IJpwZXs/zuWAYlSUxzoAFmCQJf6Wdia4B7MCUBeDJ8UpfW19Hm+9aC9vba5UFLcdnFOFeS9YoMJ0+f9EqZmH9BTJirxeu66B/UJ72tjc2UNkCe3SsnrP3f4g9SofaTlgC8GlxfHK2HC53MQUsv73luoYDM61h/c5xoisD2UOYpGdgAjZB7KYXmDkjOKau3yOGAjPgvU3VgUkt7xG1thGV8K7x46eIVlZYHdn/Xz/cRoMjYy7efDN+v592PLDF88cCJmC70jdodc0XNZz4h1AAg+cbG4vguk6JJHhUmpgi+u1fWQlsTqysFM0YhkGfdHWn1KTXwr0Dw54VgDaB7QpJBZA4MYkpYJK2VnbqZe+XZensBevLOwxOQAl7/6ZyFi+dohGiYpOYhQJwVyelxKWFZ7qjmujeGFOZnSa0e7vnJjJZUMUmMVtrAC4qbUlwY+OZdNbfd+3d86NzvKJw3R88TlRX7TShc5lb2GMMv/5Ckp9vlcqWpXb3oGLjTVtUttYA3NLaGpDXVZ6FlUoI8Mipr3GBl208+8RDMpnVp4pN3kwLBcxbKihh14PzbiYbDViLIN/Py85xUZkOHR7qpp7rE+lUzVgdFRtiEtCxNQU4OIHT5WDgljZVOtjfRW8OfU5BdiH/ZPUGWl3kdpy+9tZ71D88fzsA96sNdWvoK2x6p0MqNm4qqgBEZnDj1WgUV9SpkAQv6kZm6Dc9J11KgB3w6YVLqTSZsGxnd2/aClCxWdEo9nFYI/O87BWXj17pzMSA+PJq+UlWwt7Lp1VWzqTd2Az2fNkK4C1BZMBAcIJXujNYTluWrnAVL+BIiT0r1rl4uZJRsYk4JBbMWgMM4xR7PoWciMxAcIKX84DO8+bpFZYh9MHYVQL451bV07pgmYMZdkBV5XI+C4gp5/DTTVRVRttOpQ1gAjaHOAgLaaEARGOVBnW+UNR8CEvBFZPX47BUQoA9KvUlFS7wsrPvP559yxCYnJAbHIcZM+QT2yDOxSIay5YYYSmpEJSw85a1ccGn0s5illUxAasMvxMKEB1zKJoUADE5qdLVkRfp2vTHqVbLWHkXJgWrmAKQAnF4Swp9P0caAUmw3b36BXsGX6Cro78mn/4rqq06TIHC9WjGoeZD71L/PPwB8Oftfvi+tC9ogEUNsgJWKZyjAFwh7295p016hhGQ1Mj+vmQkwaNcxBimjt4HXUqAHdB+8XKyZhK+xwI6NT1NJQF2uKRBwOIQxxqq1+XRKcAlEIQoCyIay71vyjfR58i1FvHloxxLCZ3/3aGyspoGBmCRpGIEz6UARGDyHVcXXsDHi2isRBQqbqLy0u+5iuhagG6r3OfiZTMDDMBikdllYZT5GAXgzgwRmPI1Ym8QjTUXwVaorvijowSAv33FP6m0+D6nCuyAVeFyKipckvZfuCwk6jqNekxAdjWcDtjUe0E0w2cCN1kXpOFjzBU3xLhifqhxY8IFiEPTqGfoZ7Qs8A0XeHfLmc0hguxfbcfVMLqTByb6NiVVAMS0Q2Df56RQEAIkNt2Z3gkss7CjvR07e14NnzM5pPar8UJqXWuArG4VNF6SeZzA1KEk+bn6hKxq7CBCaeOBh/xxFYAXiL3lxcO+SiERh4dQtFwnyIiYQUnAACwyH/u8aQ1QC3wRwuT4dH5vovjhOUcAFIGKiL0VQYecRxAi4vBycSRAJjVGEDJD9kTggTHhCEABUF6HyloqsJTA88kdLM27AyLIshVEJYKl2zlYmhdpSfjy/FUXNlhaNp7X4fJSCVgYEULLWm6QPDzz4gcTEnBe/2RGKgHPvP3RlKoEnB3y9mdzsYrIyx9OqkqQ6bz86awEH/uUP56245BqEZmR6MfTuKVie6ND47uKTPx4OlbevMv/D5RxK36/9FxXAAAAAElFTkSuQmCC","Opts": {"init": "function ($o) {\n  \tvar that = this,\n        d = that.data;\n    \n    that.Row.lang = that.lang;\n    \n    $o.html($.my.formgen(that.HTML).assign(that.lang));\n  }","ui": {"#otitle": "title","#opad": "padding","#obg": "function (d,v) {\n    \tif (v!=null) {\n      \td.bg = v.split(';')[0].trim().to(22);\n      }\n      return d.bg;\n    }","#orows": {"bind": "rules","list": "<div class=\"pt6 fs95\"></div>","manifest": "this.Row","id": ["id"],"watch": "#btn-add"},"#ofloat": {"bind": "function (d,v) {\n      \tif (v!=null) {\n        \td.floater = !!(v+'');\n        }\n        return d.floater?'float':'';\n      }"},"#odrop": {"bind": "function (d,v) {\n      \tif (v!=null) {\n        \ttry {\n          \tvar re = new RegExp(v, 'g');\n            d.drop = v;\n          }catch(e){\n          \td.drop = '';\n          }\n          return v;\n        }\n        return d.drop;\n      }","check": "function (d,v) {\n        var re;\n      \ttry {\n          re = new RegExp(v, 'g');\n        }catch(e){}\n        if (!re) return this.lang.ERR_DROP;\n      }"},"#btn-add": "function (d,v) {\n    \tif (v!=null) {\n      \tthis.my.insert('#orows',{\n          id:\t\t\t\tNumber.random(46656,1679615).toString(36), \n          skip:\t\t\tfalse,\n          selector:\t'', \n          css:\t\t\t''\n        }, 1e6);\n      }\n    }","#btn-apply": "function (d,v) {\n    \tif (v!=null) this.my.commit();\n    }","#btn-cancel": "function (d,v) {\n    \tif (v!=null) this.my.cancel();\n    }"},"HTML": [{"row": "100%","label": "77px","rowCss": "my-row pb6","labelCss": "my-label o80 fs90"},["{LBL_TITLE}","inp#otitle.fs105.bolder",{"plc": "{PLC_TITLE}"},"msg"],["{LBL_PAD}","inp#opad",{"plc": "{PLC_PAD}"},"msg"],["{LBL_DROP}","inp#odrop",{"plc": "{PLC_DROP}"},"msg"],["{LBL_BG}","<span class=\"dib w140 pr9\">","inp#obg.w100p",{"plc": "{PLC_BG}"},"</span>","<label class=\"dib gray\"><input type=\"checkbox\" id=\"ofloat\" value=\"float\" class=\"dib vat mt1\"> {LBL_FLOAT}</label>"],"<div id=\"orows\" class=\"pl60\"></div>","<div class=\"btd pt15 mt15 fs95\">","<div class=\"fr zi2\"><button id=\"btn-cancel\">{BTN_CANCEL}</button></div>",["","but#btn-add.green.mr2.bold.w40.pl0.pr0",{"txt": "＋"},"but#btn-apply",{"txt": "{BTN_APPLY}"}],"</div>"],"style": {"": "font-size:16px;"},"isSelector": "function validateQuery(str) {\n    try {\n      document.querySelector(str);\n      return true;\n    }\n    catch(e) {}\n    return false;\n  }","lang": {"en": {"LBL_TITLE": "Title","PLC_TITLE": "Panel title","ERR_TITLE": "100 chars max","LBL_PAD": "Padding","PLC_PAD": "15px 15px 20px 20px","LBL_DROP": "Drop","PLC_DROP": "RegExp removed from texts","ERR_DROP": "Invalid RegExp","LBL_BG": "B-ground","PLC_BG": "#E8E9EA","LBL_FLOAT": "Floating","BTN_APPLY": "Apply","BTN_CANCEL": "Cancel","PLC_SEL": "CSS selector","ERR_SEL": "Invalid selector","PLC_RULES": "CSS rules","TIP_SKIP": "Apply or skip this rule"},"ru": {"LBL_TITLE": "Шапка","PLC_TITLE": "Заголовок блока","ERR_TITLE": "100 символов максимум","LBL_PAD": "Отступ","PLC_PAD": "15px 15px 20px 20px","LBL_DROP": "Чистка","PLC_DROP": "RegExp для замены на ''","ERR_DROP": "Неверный RegExp","LBL_BG": "Фон","PLC_BG": "#E8E9EA","LBL_FLOAT": "Плавающий","BTN_APPLY": "Применить","BTN_CANCEL": "Отмена","PLC_SEL": "CSS селектор","ERR_SEL": "Невалидный селектор","PLC_RULES": "Правила CSS","TIP_SKIP": "Применить/пропустить правило"}},"Row": {"inherit": ["lang"],"init": "function ($o) {\n  \t$o.html(this.HTML.assign(this.lang));\n  }","HTML": "<input type=\"checkbox\" id=\"rskip\" value=\"skip\" class=\"w5p\" title=\"{TIP_SKIP}\"><span class=\"w40p dib vat pr5\"><input type=\"text\" id=\"rsel\" class=\"w100p bolder\" value=\"\" placeholder=\"{PLC_SEL}\"></span><span class=\"w55p dib vat\"><input type=\"text\" id=\"rcss\" class=\"w100p\" value=\"\" placeholder=\"{PLC_RULES}\"></span>","ui": {"#rsel": {"bind": "selector","css": {":disabled": "function (d) {return !!d.skip}","self:tdl": "function (d) {return !!d.skip}"},"watch": "#rskip"},"#rcss": {"bind": "css","css": {":disabled": "function (d) {return !!d.skip}","self:tdl": "function (d) {return !!d.skip}"},"watch": "#rskip"},"#rskip": {"bind": "function (d,v) {\n        if (v!=null) {\n      \t\tif (v+'') d.skip = false;\n          else d.skip = true;\n        }\n        return d.skip?'':'skip';\n      }"}}}}},"raw": {"name": "Inliner.Ed.Widgets.Contents","title": "⊛ Inliner Contents","version": "4.0","build": 20,"com": [{"stamp": "1536705193738","id": "Root","type": "js","data": "({\n  \n  // Inliner list of contents widget\n  // (c) 2018 ermouth\n  \n  id:\"in.Contents\",\n  defaultFormat:{format:['right200'],css:['Z5']},\n\tdata:{\n\t\ttitle:'',\n\t\ttype:\t\t\t'inliner-contents',\n    rules:[\n      {id:'h1', skip: false, selector:'.in--html h1', css:'fs120 bolder'},\n      {id:'h2', skip: true, selector:'.in--html h2', css:'fs105 bolder'},\n      {id:'h3', skip: true, selector:'.in--html h3', css:'pl5 w100p nw oh ell'}\n    ],\n\t\tpadding:\t'10px 10px 15px 15px',\n    drop:\t\t\t'',\n\t\tbg:\t\t\t\t'#f5f7f9',\n    floater:\ttrue\n\t},\n  \n  params:{restyle:1},\n  meta:{},\n  Lang:{\n    en:{APPTITLE:'Contents'},\n    ru:{APPTITLE:'Содержание'}\n  },\n  \n  Titles:[],\n  \n\tinit: function ($o) {\n\t\tvar that = this;\n    that.Titles = that.findItems();\n    $o.html(that.HTML.assign(that.lang));\n\t},\n  \n\tui: { /* See tab */ },\n  \n\tstyle: {\n\t\t' .aside-row':'line-height:1.2em; padding:0.25em 0;',\n\t\t'': function($o){\n      var that = this,\n          d = that.data,\n          m = that.meta,\n          t = m.theme || {},\n          css = 'background-color:'+d.bg+';padding:'+d.padding+';margin-top:'+t.pad.gap+';';\n      \n      css += (d.floater && !m._mobile && $o.parent().parent().width()>600)\n        ?'position:fixed;width:inherit;'\n      \t:'width:100%;';\n      \n      css += 'border-radius:'+t.corner.outer+';'\n      \n      return css;\n    },\n    ' .in-w-btn-box':{\n      '':'width:65px;z-index:+10;position: absolute; top: 5px; right:6px;',\n\n      ' .btn-gopts':[\n        'font-size:17px; z-index:+3; border-radius:100px!important;',\n        'padding:0; line-height:28px; width:30px; height:30px; margin:0; ',\n        'opacity:0.5;transition:top 0.1s, right 0.1s;'\n      ].join(''),\n      ' .btn-gopts:hover':'opacity:1;'\n    }\n\t},\n  \n  HTML:[\n    '<div class=\"in-w-btn-box\">',\n    \t'<button id=\"btn-rebuild\" class=\"hide btn-gopts mr5\"><span class=\"fi-loop\"></span></button>',\n\t\t\t'<button id=\"btn-gopts\" class=\"hide btn-gopts\"><span class=\"fi-wrench\"></span></button>',\n\t\t'</div>',\n    '<div id=\"aside-links\"><div>{TITLE}</div></div>'\n  ].join('')\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1536773459639","id": ".lang","type": "js","data": "({\n\ten:\t{\n  \tTITLE:'Contents'\n  },\n  ru:\t{\n  \tTITLE:'Содержание'\n  }\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1536771310945","id": ".ui","type": "js","data": "({\n  '#aside-links':function(d,v){\n    var t = this.Titles, \n        tmpl = '<div class=\"aside-row {3}\"><a href=\"#{1}\">{2}</a></div>';\n    if (!t.length) return;\n    var rows = t.map(function(a){\n      return tmpl.assign(a[0], a[1], a[2].css);\n    }).join('');\n\n    return rows;\n  },\n\n  '#btn-gopts':{\n    bind: function(d,v,$o) {\n      var that = this;\n      if(v!=null) {\n        if ($o.data('modal')) $o.modal(true);\n        else {\n          var root = $o.parents('#medium');\n          $o.modal({\n            root:\t\t\troot.size()?root:undefined,\n            bound:\t\t0,\n            width:\t\t400,\n            manifest:\t$.extend(true, {}, that.Opts, {Att:that.Att}),\n            data:\t\t\tObject.clone(d, true),\n            align:\t\t'right:38px;top:0;',\n            //css:'z20',\n            screen:\t\t'rgba(255,255,255,0.65)',\n            nose:\t\t\t'right',\n            focus:\t\tfalse,\n            enter:\t\ttrue,\n            esc:\t\t\ttrue\n          })\n          .then(function(res){\n            $.extend(d, res);\n            d.rules = d.rules.filter(function(e){return !!e.selector.trim()});\n            that.Titles = that.findItems();\n            that.my.check('#aside-links');\n            that.my.restyle();\n          });\n        }\n      }\n    },\n    css:{\n      'self:hide':function(){return !!this._compiled}\n    }\n  },\n\n  '#btn-rebuild':{\n    bind: function(d,v,$o) {\n      var that = this;\n      if(v!=null) {\n        that.Titles = that.findItems();\n        that.my.check('#aside-links');\n        that.my.restyle();\n      }\n    },\n    css:{\n      'self:hide':function(){return !!this._compiled}\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1536772343569","id": ".findItems","type": "js","data": "(function (){\n  var that = this,\n      d = that.data,\n      items = d.rules.reduce(function(a,b){\n        if (b.skip) return a;\n        a[b.selector] = b;\n        return a;\n      },{}),\n      selectors = Object.keys(items),\n      titles = [],\n      $o = that.my.root();\n  \n  var $h = $o.parents(\n    that._compiled\n    ?'.in-doc-body'\n    :'#medium'\n  ).eq(0)\n  .find(selectors.join(','));\n\n  var re = null;\n\tif (d.drop) {\n  \ttry {\n    \tre = new RegExp(d.drop, 'g');\n    }catch(e){}\n  }\n\n  $h.each(function(){\n    var $n = $(this),\n        t = $n.text(),\n        id = $n.attr('id'),\n        result = null;\n\n    if (!(t||'').trim()) return;\n    \n    if (d.drop && re) t = t.replace(re, '');\n\n    if (!id) {\n      id = 'h-'+cw.lib.sdbm(t + Date.now());\n      $n.attr('id', id);\n    }\n\n    selectors.forEach(function(s){\n      if (result != null) return;\n      if ($n.is(s)) result = [id, t.escapeHTML(), items[s]];\n    });\n\n    if (result) titles.push(result);\n\n  });\n  return titles;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1536706146356","id": ".Ico","type": "text","data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAACc5JREFUeAHlW2tsFNcVPjO7xvauzYIfGww0dYSDcR4OmFCoKxElpCJxqiZECaS0pOmPKq0SteqPqsqv9l/V5kfVKhWq+gc1Km2cpIS2dooCTUQUJxEBwiPBpjYhxmDq9xNj7J3p+e7Mnb2zrHdn1/buNnske+49cx/nO3Mf5557lijPSVts/H9ofitUWqxvJU2vNzWzlkiv1TQzbBKVaqZWiv6ZP86CjJum1kdkdDC/g0zj9PiUcfTZnV8fXUwZF0UB+w4cWVOwRN9DmtakmWYDP31pgTDNiKlpJ8g0W2duGC8/s2NbV1rtJKi0YAp4srnZ92iwYpdO+nOkUWOCPtN/ZVKbQcbvD04OvPLqzp2R9BuK1py3AgD8sUDlM5pOLxBpa6JNR1NLCvxUsTxEoWCASoPFFCwuIr/fRwU+a2DMRCI0OxuhyanrND45RaOT12hgeJRuzMxGG3GlzC7ToF++ca1/33wVMS8F/Knl35v9mr6XZdvgko8zSxls9aowVVWU0fKlJTwLUuvKNE0aHpug3oEhuni5j8ZYKXHo5Kxp/PDpRx74MM47T6zUpLKb/F1ra2EFFb3IC9rzzHLaQOLWqjDV3raaykNiffMkhJdCg6Pj1PFZD3X39hEvoCpx1nhpgK7/9EdNTdPqCy9pR3gvhVFGLHCFvmau2KDW+fLKMN1dUy2GuMpf6DSmyJnOi/T5Fd4wFGItnDBmzF17Hr2/U2EnTaakgD+3HNmqafrf+aOHZMtLSwK06Y7bKVy+TLIy8uwbHKFjn/6HxibUqWGOmqbxzW8/su2oVyE8K2B/69uPsZb/opFWJBuv+VIVNdTVkM+nS1ZGn5GIQSfOdVLnpV6nX5PM6wzqW7ub7n/DYSZIeFIAwPPEe03u57qu0Za71xGGfS4QpsMHZ9rJMOzVge0HXpme8KKEpArAsGcr7pD88gW8fW3deBeFyzI75JMpum9ohI4eP0szvJ2CMBLYmtyebDokVMDLB9+u8RXQR3LOA/y2zevFtpZMoGy8x7Z55MOPHSWwGkZvTBsbE1mQc05ebHV6gfaKBI9hjy+PPT1XCbJBRshqkRYq4B0LWOaSeU4FYJ/nZpytDnM+14Z9PFCQEbJKAgbLZpEc9zOuAmDh2UaOKF1za1XOLHhu8ePnsDhjh4qS/ryFKcqRqZsUANveNm/FOMI+37CuRpb/v3lie4bsNmnABGySIZ83KQAHG37p2PYwcrK1z0sh03lCZsiu0AYbm8JS7HhwoaEdJZUdzBanOgylxnvqXBViM109V+n9U+284Np7cGyBxc7zIWtLfW3MkI922nbqnGI2m10HJvpr1ROkP1qUCOd5CR7jH7Z9Mmr/7BJdYCVkk0I81N1zPioNMHSzoWR9Hm0NML5KtF+WcE0B4cyw3+BUh7N7MsrWh08ml3wPDMAiScUInqMAGD2qJwdH2i8KubCwtwonWonNUYDup+9IJpwZXs/zuWAYlSUxzoAFmCQJf6Wdia4B7MCUBeDJ8UpfW19Hm+9aC9vba5UFLcdnFOFeS9YoMJ0+f9EqZmH9BTJirxeu66B/UJ72tjc2UNkCe3SsnrP3f4g9SofaTlgC8GlxfHK2HC53MQUsv73luoYDM61h/c5xoisD2UOYpGdgAjZB7KYXmDkjOKau3yOGAjPgvU3VgUkt7xG1thGV8K7x46eIVlZYHdn/Xz/cRoMjYy7efDN+v592PLDF88cCJmC70jdodc0XNZz4h1AAg+cbG4vguk6JJHhUmpgi+u1fWQlsTqysFM0YhkGfdHWn1KTXwr0Dw54VgDaB7QpJBZA4MYkpYJK2VnbqZe+XZensBevLOwxOQAl7/6ZyFi+dohGiYpOYhQJwVyelxKWFZ7qjmujeGFOZnSa0e7vnJjJZUMUmMVtrAC4qbUlwY+OZdNbfd+3d86NzvKJw3R88TlRX7TShc5lb2GMMv/5Ckp9vlcqWpXb3oGLjTVtUttYA3NLaGpDXVZ6FlUoI8Mipr3GBl208+8RDMpnVp4pN3kwLBcxbKihh14PzbiYbDViLIN/Py85xUZkOHR7qpp7rE+lUzVgdFRtiEtCxNQU4OIHT5WDgljZVOtjfRW8OfU5BdiH/ZPUGWl3kdpy+9tZ71D88fzsA96sNdWvoK2x6p0MqNm4qqgBEZnDj1WgUV9SpkAQv6kZm6Dc9J11KgB3w6YVLqTSZsGxnd2/aClCxWdEo9nFYI/O87BWXj17pzMSA+PJq+UlWwt7Lp1VWzqTd2Az2fNkK4C1BZMBAcIJXujNYTluWrnAVL+BIiT0r1rl4uZJRsYk4JBbMWgMM4xR7PoWciMxAcIKX84DO8+bpFZYh9MHYVQL451bV07pgmYMZdkBV5XI+C4gp5/DTTVRVRttOpQ1gAjaHOAgLaaEARGOVBnW+UNR8CEvBFZPX47BUQoA9KvUlFS7wsrPvP559yxCYnJAbHIcZM+QT2yDOxSIay5YYYSmpEJSw85a1ccGn0s5illUxAasMvxMKEB1zKJoUADE5qdLVkRfp2vTHqVbLWHkXJgWrmAKQAnF4Swp9P0caAUmw3b36BXsGX6Cro78mn/4rqq06TIHC9WjGoeZD71L/PPwB8Oftfvi+tC9ogEUNsgJWKZyjAFwh7295p016hhGQ1Mj+vmQkwaNcxBimjt4HXUqAHdB+8XKyZhK+xwI6NT1NJQF2uKRBwOIQxxqq1+XRKcAlEIQoCyIay71vyjfR58i1FvHloxxLCZ3/3aGyspoGBmCRpGIEz6UARGDyHVcXXsDHi2isRBQqbqLy0u+5iuhagG6r3OfiZTMDDMBikdllYZT5GAXgzgwRmPI1Ym8QjTUXwVaorvijowSAv33FP6m0+D6nCuyAVeFyKipckvZfuCwk6jqNekxAdjWcDtjUe0E0w2cCN1kXpOFjzBU3xLhifqhxY8IFiEPTqGfoZ7Qs8A0XeHfLmc0hguxfbcfVMLqTByb6NiVVAMS0Q2Df56RQEAIkNt2Z3gkss7CjvR07e14NnzM5pPar8UJqXWuArG4VNF6SeZzA1KEk+bn6hKxq7CBCaeOBh/xxFYAXiL3lxcO+SiERh4dQtFwnyIiYQUnAACwyH/u8aQ1QC3wRwuT4dH5vovjhOUcAFIGKiL0VQYecRxAi4vBycSRAJjVGEDJD9kTggTHhCEABUF6HyloqsJTA88kdLM27AyLIshVEJYKl2zlYmhdpSfjy/FUXNlhaNp7X4fJSCVgYEULLWm6QPDzz4gcTEnBe/2RGKgHPvP3RlKoEnB3y9mdzsYrIyx9OqkqQ6bz86awEH/uUP56245BqEZmR6MfTuKVie6ND47uKTPx4OlbevMv/D5RxK36/9FxXAAAAAElFTkSuQmCC","active": false,"err": [],"opts": [],"color": []},{"stamp": "1536784326486","id": ".Opts","type": "js","data": "({\n  \n  init: function($o){\n  \tvar that = this,\n        d = that.data;\n    \n    that.Row.lang = that.lang;\n    \n    $o.html($.my.formgen(that.HTML).assign(that.lang));\n  },\n  \n  ui:{\n    '#otitle':'title',\n    \n    '#opad':'padding',\n    \n    '#obg':function(d,v){\n    \tif (v!=null) {\n      \td.bg = v.split(';')[0].trim().to(22);\n      }\n      return d.bg;\n    },\n    \n    '#orows':{\n    \tbind:'rules',\n      list:'<div class=\"pt6 fs95\"></div>',\n      manifest:'this.Row',\n      id:['id'],\n      watch:'#btn-add'\n    },\n    \n    '#ofloat':{\n    \tbind: function(d,v){\n      \tif (v!=null) {\n        \td.floater = !!(v+'');\n        }\n        return d.floater?'float':'';\n      }\n    },\n    \n    '#odrop':{\n    \tbind:function(d,v){\n      \tif (v!=null) {\n        \ttry {\n          \tvar re = new RegExp(v, 'g');\n            d.drop = v;\n          }catch(e){\n          \td.drop = '';\n          }\n          return v;\n        }\n        return d.drop;\n      },\n      check:function(d,v){\n        var re;\n      \ttry {\n          re = new RegExp(v, 'g');\n        }catch(e){}\n        if (!re) return this.lang.ERR_DROP;\n      }\n    },\n    \n    '#btn-add':function(d,v){\n    \tif (v!=null) {\n      \tthis.my.insert('#orows',{\n          id:\t\t\t\tNumber.random(46656,1679615).toString(36), \n          skip:\t\t\tfalse,\n          selector:\t'', \n          css:\t\t\t''\n        }, 1e6);\n      }\n    },\n    \n\t\t'#btn-apply':function(d,v){\n    \tif (v!=null) this.my.commit();\n    },\n    '#btn-cancel':function(d,v){\n    \tif (v!=null) this.my.cancel();\n    }\n\t},\n  \n  HTML:[\n    {row:'100%', label:'77px', rowCss:'my-row pb6', labelCss:'my-label o80 fs90'},\n    ['{LBL_TITLE}', 'inp#otitle.fs105.bolder',\t{plc:'{PLC_TITLE}'},'msg'],\n    ['{LBL_PAD}', \t'inp#opad',\t\t{plc:'{PLC_PAD}'},\t'msg'],\n    ['{LBL_DROP}', \t'inp#odrop',\t\t{plc:'{PLC_DROP}'},\t'msg'],\n    [\n      '{LBL_BG}', \t\n      '<span class=\"dib w140 pr9\">',\n      \t'inp#obg.w100p',\t\t\n      \t{plc:'{PLC_BG}'},\t\n      '</span>',\n    \t'<label class=\"dib gray\"><input type=\"checkbox\" id=\"ofloat\" value=\"float\" class=\"dib vat mt1\"> {LBL_FLOAT}</label>'\n    ],\n    '<div id=\"orows\" class=\"pl60\"></div>',\n    '<div class=\"btd pt15 mt15 fs95\">',\n      '<div class=\"fr zi2\"><button id=\"btn-cancel\">{BTN_CANCEL}</button></div>',\n      [\n        '',\n        //'<span class=\"w60 dib\"></span>',\n        'but#btn-add.green.mr2.bold.w40.pl0.pr0', {txt:'＋'},\n        'but#btn-apply', {txt:'{BTN_APPLY}'}\n      ],\n    '</div>'\n  ],\n\n  style:{\n  \t'':'font-size:16px;'\n  },\n  \n  isSelector: function validateQuery(str) {\n    try {\n      document.querySelector(str);\n      return true;\n    }\n    catch(e) {}\n    return false;\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1536788823051","id": ".Opts.lang","type": "js","data": "({\n\n  en:{\n    LBL_TITLE:\t'Title',\n    PLC_TITLE:\t'Panel title',\n    ERR_TITLE:\t'100 chars max',\n\n    LBL_PAD:\t\t'Padding',\n    PLC_PAD:\t\t'15px 15px 20px 20px',\n    \n    LBL_DROP:\t\t'Drop',\n    PLC_DROP:\t\t'RegExp removed from texts',\n    ERR_DROP:\t\t'Invalid RegExp',\n\n    LBL_BG:\t\t\t'B-ground',\n    PLC_BG:\t\t\t'#E8E9EA',\n\n    LBL_FLOAT:\t'Floating',\n\n    BTN_APPLY:\t'Apply',\n    BTN_CANCEL:\t'Cancel',\n\n    PLC_SEL:\t\t'CSS selector',\n    ERR_SEL:\t\t'Invalid selector',\n\n    PLC_RULES:\t'CSS rules',\n    \n    TIP_SKIP:\t\t'Apply or skip this rule'\n  },\n\n  // RU ------------------\n  \n  ru:{\n    LBL_TITLE:\t'Шапка',\n    PLC_TITLE:\t'Заголовок блока',\n    ERR_TITLE:\t'100 символов максимум',\n\n    LBL_PAD:\t\t'Отступ',\n    PLC_PAD:\t\t'15px 15px 20px 20px',\n    \n    LBL_DROP:\t\t'Чистка',\n    PLC_DROP:\t\t\"RegExp для замены на ''\",\n    ERR_DROP:\t\t'Неверный RegExp',\n\n    LBL_BG:\t\t\t'Фон',\n    PLC_BG:\t\t\t'#E8E9EA',\n\n    LBL_FLOAT:\t'Плавающий',\n\n    BTN_APPLY:\t'Применить',\n    BTN_CANCEL:\t'Отмена',\n\n    PLC_SEL:\t\t'CSS селектор',\n    ERR_SEL:\t\t'Невалидный селектор',\n\n    PLC_RULES:\t'Правила CSS',\n    \n    TIP_SKIP:\t\t'Применить/пропустить правило'\n  }\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1536784894633","id": ".Opts.Row","type": "js","data": "({\n  inherit:['lang'],\n  init: function($o){\n  \t$o.html(this.HTML.assign(this.lang));\n  },\n  HTML:[\n    '<input type=\"checkbox\" id=\"rskip\" value=\"skip\" class=\"w5p\" title=\"{TIP_SKIP}\">',\n    '<span class=\"w40p dib vat pr5\">',\n    \t'<input type=\"text\" id=\"rsel\" class=\"w100p bolder\" value=\"\" placeholder=\"{PLC_SEL}\">',\n    '</span>',\n    '<span class=\"w55p dib vat\"><input type=\"text\" id=\"rcss\" class=\"w100p\" value=\"\" placeholder=\"{PLC_RULES}\"></span>'\n  ].join(''),\n  ui:{\n    '#rsel':{\n    \tbind:'selector',\n      css:{\n      \t':disabled':function(d){return !!d.skip},\n        'self:tdl':function(d){return !!d.skip}\n      },\n      watch:'#rskip'\n    },\n    \n    '#rcss':{\n    \tbind:'css',\n      css:{\n      \t':disabled':function(d){return !!d.skip},\n        'self:tdl':function(d){return !!d.skip}\n      },\n      watch:'#rskip'\n    },\n    \n    '#rskip':{\n    \tbind: function(d,v){\n        if (v!=null) {\n      \t\tif (v+'') d.skip = false;\n          else d.skip = true;\n        }\n        return d.skip?'':'skip';\n      },\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "950","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","collapsed": [],"author": "admin","_desc": "Contents aside floater for Inliner","timeout": "3000","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"padding": "auto"},"log": [[1539296566315,"update","admin-czpbhuup",71,"dev-cloudwall2"]],"id": "cw.Inliner.Ed.Widgets.Contents","stamp": 1539296566315,"parent": "cw-Inliner-4vx1"},{"_id": "cw-Site-Editor-4vx1","_rev": "118-b3324478bae2509affd6c9cbc61f9acb","name": "Site.Editor","title": "S3 Site Builder","type": "manifest","desc": "Static AWS S3 site generator","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Site.Editor","build": 160,"app": {"name": "Site.Editor","title": "S3 Site Builder","version": "2.0","build": 160,"timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0ZGN0Y0QiIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTM0LjkzNCwzNS4yNDQgTDQwLjE3Nyw5NC4wNDYgTDYzLjcwMywxMDAuNTc4IEw4Ny4yOTUsOTQuMDM4IEw5Mi41NDIsMzUuMjQ1IEwzNC45MzQsMzUuMjQ1IHogTTgxLjYwNiw0OS4xOTkgTDgxLjI3OCw1Mi44NTUgTDgxLjEzMyw1NC40NzUgTDgxLjExMSw1NC40NzUgTDYzLjczOCw1NC40NzUgTDYzLjcxNCw1NC40NzUgTDUzLjUzNiw1NC40NzUgTDU0LjE5NSw2MS44NjEgTDYzLjcxMyw2MS44NjEgTDYzLjczOCw2MS44NjEgTDc4LjUzNCw2MS44NjEgTDgwLjQ3OCw2MS44NjEgTDgwLjMwMiw2My43OTggTDc4LjYwNiw4Mi43ODYgTDc4LjQ5OCw4NC4wMDMgTDYzLjczOCw4OC4wOTMgTDYzLjczOCw4OC4wOTMgTDYzLjcwNSw4OC4xMDQgTDQ4LjkzMiw4NC4wMDMgTDQ3LjkyMiw3Mi42NzkgTDUxLjI1OSw3Mi42NzkgTDU1LjE2MSw3Mi42NzkgTDU1LjY3NCw3OC40MzIgTDYzLjcwNiw4MC42IEw2My43MTMsODAuNTk4IEw2My43MTMsODAuNTk3IEw3MS43NTcsNzguNDI2IEw3Mi41OTQsNjkuMDczIEw2My43MzgsNjkuMDczIEw2My43MTQsNjkuMDczIEw0Ny41OTksNjkuMDczIEw0NS44MjcsNDkuMTk5IEw0NS42NTUsNDcuMjYzIEw2My43MTQsNDcuMjYzIEw2My43MzgsNDcuMjYzIEw4MS43NzksNDcuMjYzIEw4MS42MDYsNDkuMTk5IHoiIGZpbGw9IiNGRjY5MjkiLz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": ["cmd","doc._id"],"nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","width": [1150,1320,1420],"collapsed": [],"padding": "auto","types": {"site": ["create","edit","view"],"s3site": ["edit"]}},"Version": "2.3.0","require": [{"AWS": "lib/aws.js","UglifyJS": "lib/uglify.js","Zlib": "lib/gzip.js","less": "lib/less.js"}],"expose": ["GetDoc","GetActiveId","RT","Path","GenId","getDup","Confirm","Items2Atts"],"params": {"restyle": 200},"creds": {},"List": [],"Tablist": [],"Active": "","Expanded": {},"RT": "function () { return this; }","GetDoc": "function () { return this.data.doc; }","GenId": "function () {return $.my.f.sdbmCode(Date.now()+Number.random(1e11, 1e18))}","GetActiveId": "function () { return this.Active; }","MemoTabs": "function () {\n\t\tvar that=this, d = that.data.doc, di = d.items, a=[];\n\t\ta.push(that.Path(that.List[0]));\n\t\tthat.Tablist.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (p!=a[0] && elt.data.length<50000) a.push(p);\n\t\t});\n\t\td.tabs = a.reverse();\n\t}","getDup": "function (item,name0) {\n\t\tvar that = this, \n\t\t\t\ti,e, ename, \n\t\t\t\tfname = that.Path(item, name0), \n\t\t\t\tu = false;\n\t\tfor (var i = 0; i < that.data.doc.items.length && !u; i++) {\n\t\t\te = that.data.doc.items[i];\n\t\t\tename = that.Path(e);\n\t\t\tif (e.id!==item.id && ename===fname) u = e.type;\n\t\t}\n\t\treturn u;\n\t}","Path": "function (item,name) {\n\t\treturn (item.folder?item.folder+\"/\":\"\")+(name!=null?name:item.name)+(item.ext?\".\"+item.ext:\"\");\n\t}","init": "function ($o,form) {\n\tvar i, j, that = this, \n\t\t\td = form.data.doc,\n\t\t\titems = d.items;\n\n\t$o.html(this.HTML);\n\n\t// Prepare doc if it’s empty\n\tif (!d.items.length) {\n\t\td.items.push( \t$.extend(true, {},that.Item.data, {id:that.GenId()}) );\n\t}\n\n\t// Restore tabs ...\n\t\n\tif (Object.isArray(d.tabs) && d.tabs.length) {\n\t\tvar tabs = cw.lib.a2o(d.tabs);\n\t\td.items.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (tabs[p]) tabs[p] = elt;\n\t\t});\n\t\t\n\t\td.tabs.forEach(function(i) {\n\t\t\tvar t = tabs[i];\n\t\t\tif (Object.isObject(t)) {\n\t\t\t\tthat.Tablist.push(t);\n\t\t\t}\n\t\t});\n\t\tif (that.Tablist[0]) that.List.push(that.Tablist[0]);\n\t\tthat.Active = that.List[0].id;\n\t} \n\t\n\t// ... or open item[0] if failed to restore\n\t\n\tif (!that.List.length) {\n\t\tthat.Active = d.items[0].id;\n\t\tthat.List.push(d.items[0]);\n\t\tthat.Tablist.push(d.items[0]);\n\t}\n\t\n\t// Clean attaches if no preview\n\tif (!d.site.previewBase) {\n\t\tthat.CleanAtts(d);\n\t}\n\t\n\t/*that.getDup = function (item, name0) {\n\t\tvar i,e, \n\t\t\t\tename, \n\t\t\t\tfname = that.Path(item, name0), \n\t\t\t\tu=false;\n\t\tfor (var i=0;i<d.items.length && !u; i++) {\n\t\t\te = d.items[i];\n\t\t\tename = that.Path(e);\n\t\t\tif (e.id!==item.id && ename===fname) u = e.type;\n\t\t}\n\t\treturn u;\n\t};*/\n\t\n\t// Init gzip\n\tthat.gzip = that.Gzip();\n\n\t// Remember mimes && set missing cache max-ages\n\t\n\tfor (i=0;i<d.items.length;i++) {\n\t\tj = d.items[i];\n\t\tif (j.type===\"attachment\" && !j.mime) {\n\t\t\tj.mime = d._attachments[that.Path(j)].content_type;\n\t\t}\n\t\tif (!j.cache) j.cache = \"86400\";\n\t\tif (!j.state) j.state = {savedSdbm:\"\",sdbm:\"\",depends:{},impacts:{}};\n\t\tdelete j.savedSdbm; delete j.depends;\n\t}\n\n\t// ‘Delete item’ event handler\n\n\t$o.on(\"delitem.my\", function(evt, item){\n\t\tvar ipos = d.items.findIndex(_find),\n\t\t\t\tlpos = that.List.findIndex(_find),\n\t\t\t\tfname = that.Path(item);\n\t\tif (d.items.length>1) {\n\t\t\td.items.removeAt(ipos);\n\t\t\tthat.List.removeAt(lpos);\n\t\t\tthat.Tablist.removeAt(that.Tablist.findIndex(_find));\n\t\t\tif (d._attachments && d._attachments[fname]) \n\t\t\t\tdelete d._attachments[fname];\n\t\t\tthat.Expanded[item.id] = false;\n\t\t\tthat.Active = that.List[0].id;\n\t\t\t$o.find(\"#items\").trigger(\"recalc\");\n\t\t}\n\t\telse {\n\t\t\t(window.l||cw.lib).note(\"Can’t remove last resource.\",\"error\");\n\t\t}\n\n\t\tfunction _find (e) {\n\t\t\treturn e.id == item.id;\n\t\t}\n\t});\n\n}","data": {"doc": {"_id": "","name": "Default site","type": "s3site","owners": [],"acl": [],"s3": {"accessKeyId": "","secretAccessKey": "","region": "eu-west-1"},"site": {"s3bucket": "","s3folder": "","siteBase": "","previewBase": ""},"creds": {"crypto": ""},"items": []},"cmd": ""},"ui": {"#btn-view": {"bind": "function (d,v,$o) {\n\t\t\tvar base = d.doc.site.previewBase;\n\t\t\t$o.attr(\"href\", (base?base.replace(/\\/$/,'')+\"/index.html\":\"\"));\n\t\t}","watch": "#sname","css": {"hide": "function (d,v,$o) {$o.parent().toggleClass(\"hide\",!d.doc.site.previewBase)}"}},"#sname": {"bind": "function (d) {\n\t\t\tvar html = (d.doc.name||\"Untitled\"), \n\t\t\t\t\tbase = d.doc.site.siteBase;\n\t\t\tif (base) html = '<a target=\"_blank\" href=\"'+base+'\">'+html+'</a>'; \n\t\t\treturn html;\n\t\t}"},"#btn-params": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\telse $o.modal({\n\t\t\t\t\tmanifest:that.DocParams,\n\t\t\t\t\tdata:$.extend(true,{},\n\t\t\t\t\t\tObject.select(d.doc,\"name s3 site owners creds\".split(\" \"))\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\twidth: 525,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tcss:\"fs90\"\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t$.extend(true, d.doc, res);\n\t\t\t\t\tfor (var i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\td.doc.items[i].state.savedSdbm = \"\";\n\t\t\t\t\t}\n\t\t\t\t\t$o.my(\"find\",\"#sname\").trigger(\"check\");\n\t\t\t\t\t\n\t\t\t\t\tif (!d.doc.site.previewBase) {\n\t\t\t\t\t\tthat.CleanAtts(d.doc);\n\t\t\t\t\t} \n\t\t\t\t\t\n\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}","css": {"self:red": "function (d) {\n\t\t\t\tvar s3 = $.extend(!0, {}, d.doc.s3, cw.crypto.dec(d.doc.creds)[\"s3\"]||{}), \n\t\t\t\t\ts = d.doc.site;\n\t\t\t\treturn (!s3.accessKeyId || !s3.secretAccessKey || !s3.region || !s.s3bucket || !s.siteBase);\n\t\t\t\t/*var s3 = d.doc.s3, s = d.doc.site;\n\t\t\t\treturn (!s3.accessKeyId || !s3.secretAccessKey || !s3.region\n\t\t\t\t\t\t\t\t|| !s.s3bucket || !s.siteBase);*/\n\t\t\t}"},"watch": "#sname"},"#btn-addpic": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.AddImage,\n\t\t\t\t\twidth:820,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tdata:{},\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\tvar item = $.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{}, \n\t\t\t\t\t\tthat.Types.attachment.manifest.data,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid:that.GenId(), \n\t\t\t\t\t\t\tfolder:res.folder,\n\t\t\t\t\t\t\tname:res.filename.replace(/\\.jpg$/,''),\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"jpg\",\n\t\t\t\t\t\t\tmime:res.mime,\n\t\t\t\t\t\t\tsize:res.data.length/4*3\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\td.doc._attachments[that.Path(item)] = {content_type:res.mime, data: res.data};\n\t\t\t\t\td.doc.items.push(item);\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-addfile": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(!0,  that.AddFile, {getDup:that.getDup,Types:that.Types}),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{doc:d.doc}, \n\t\t\t\t\t\t{item:that.Types.attachment.manifest.data}, \n\t\t\t\t\t\t{item:{\n\t\t\t\t\t\t\tid:that.GenId(), name:\"\",\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"—\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\twidth: 535,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\tvar path, dup, i;\n\t\t\t\t\tres.item.data = \"Файл\";\t\n\t\t\t\t\tres.item.mime = res.file.content_type;\n\t\t\t\t\tres.item.size = res.file.size;\n\t\t\t\t\tif (res.file && res.file.data) {\n\t\t\t\t\t\tpath = that.Path(res.item);\n\t\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\t\td.doc._attachments[path] = res.file;\n\t\t\t\t\t\tfor (i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\t\tif (that.Path(d.doc.items[i]) == path) dup = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (null!=dup) d.doc.items[dup] = $.extend(true, {}, res.item);\n\t\t\t\t\t\telse d.doc.items.push($.extend(true, {}, res.item));\n\t\t\t\t\t}\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-additem": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(\n\t\t\t\t\t\ttrue,  that.AddItem, \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgetDup:that.getDup,\n\t\t\t\t\t\t\tTypes:that.Types,\n\t\t\t\t\t\t\tRT: function(){ return that; }\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, {}, that.Item.data, \n\t\t\t\t\t\t{id:that.GenId(),name:\"\"}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t$.extend(res, that.Types[res.type].defaults||{});\n\t\t\t\t\tres.mime = that.Types[res.type].mime;\n\t\t\t\t\t//console.log(res);\n\t\t\t\t\td.doc.items.push($.extend(true, {}, res));\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-save": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar that=this, errors={};\n\t\tif (v!=null) {\n\t\t\tthat.MemoTabs();\n\t\t\t\n\t\t\tif (!d.doc.site.previewBase) {\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\n\t\t\t\tthat.Build(d.doc, {silent:true}, $o)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(res){\n\t\t\t\t\t\td.doc.stamp = Date.now();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Merge attaches if we have to\n\t\t\t\t\t\tif (d.doc.site.previewBase) {\n\t\t\t\t\t\t\tthat.MergeAtts(d.doc, res.result)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t},\n\t\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}"},"#btn-close": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t}"},"#ilist": {"delay": 50,"init": "function ($o,form) {\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t\n\t\t$o.on(\"click.my\", \".siteitem\", function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.attr(\"id\").from(3),\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (!item) {\n\t\t\t\tif (that.Expanded[id]) that.Expanded[id] = false;\n\t\t\t\telse that.Expanded[id] = true;\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t\telse /*if (item.type!=\"attachment\")*/ {\n\t\t\t\tthat.Active = id;\n\t\t\t\tif (item.folder) that.Expanded[item.folder] = true;\n\t\t\t\tif ( (idx = that.List.indexOf(item)) !== -1) {\n\t\t\t\t\tthat.List.removeAt(idx);\n\t\t\t\t} \n\t\t\t\tthat.List.unshift(item);\n\t\t\t\tif (that.Tablist.indexOf(item)==-1) that.Tablist.unshift(item);\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t})\n\t}","bind": "function (d,v,$o) {\n\t\tvar that = this, \n\t\t\t\ti, e, html=\"\",\n\t\t\t\tlist = d.doc.items, \n\t\t\t\tres = [], fl = \"\";\n\n\t\t// sort list\n\t\tlist = list.sortBy(function(e){\n\t\t\treturn [\n\t\t\t\t(!e.folder) *1,\n\t\t\t\te.folder,\n\t\t\t\te.snippet*1,\n\t\t\t\te.name,e.type\n\t\t\t].join(\"/\").toLowerCase();\n\t\t});\n\t\t\n\t\t// gen items/folders final list\n\t\tfor (i=0; i<list.length; i++) {\n\t\t\te = list[i];\n\t\t\tif (e.folder && e.folder != fl) {\n\t\t\t\tfl = e.folder;\n\t\t\t\tres.push({\n\t\t\t\t\tid:fl,\n\t\t\t\t\thtml: '<span class=\"dib w15\">'+(that.Expanded[fl]?\"▾\":\"▸\")+'</span>'+fl,\n\t\t\t\t\tcss:\"xgray\",\n\t\t\t\t\ttype:\"folder\"\n\t\t\t\t});\n\t\t\t} \n\t\t\tif (!e.folder || that.Expanded[e.folder]) {\n\t\t\t\tvar isdirty = (!e.state.savedSdbm || e.state.sdbm == \"Z\"  || (e.state.sdbm!==e.state.savedSdbm));\n\t\t\t\tres.push({\n\t\t\t\t\tid:e.id,\n\t\t\t\t\thtml: (e.folder?\"\":\"&nbsp;\")\n\t\t\t\t\t+ (e.parserActive?'<i>':\"\")\n\t\t\t\t\t+ e.name+\".\"+e.ext\n\t\t\t\t\t+ (e.parserActive?'</i>':\"\")\n\t\t\t\t\t+ (isdirty?'<span class=\"lgray\">&nbsp;•</span>':\"\"),\n\t\t\t\t\tcss: (e.external?\"orange o80\":e.snippet?\"sky\":e.type===\"attachment\"?\"gray\":\"blue\") + (e.id == that.Active?\" bg-lblue\":\"\"),\n\t\t\t\t\ttype:e.snippet?\"snippet\":\"item\",\n\t\t\t\t\ttitle: e.folder+\"/\"+e.name+\".\"+e.ext,\n\t\t\t\t\tfolder: e.folder\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t// render list\n\t\tfor (i=0;i<res.length;i++) {\n\t\t\te = res[i];\n\t\t\thtml+='<div class=\"siteitem w190 oh '+e.css+(e.folder?\" pl15\":\"\")\n\t\t\t\t+'\" id=\"sx-'+e.id+'\" title=\"'\n\t\t\t\t+(e.title?e.title:\"\")+'\">'\n\t\t\t\t+e.html\n\t\t\t\t+'</div>';\n\t\t}\n\t\treturn html;\n\t}"},"#tabs": {"bind": "this.Tablist","init": "function ($o,form) {\n\t\t\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t$o.on(\"click.my\", \"#tabname\", function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.List.indexOf(item)==-1) that.List.unshift(item);\n\t\t\tthat.Active = id;\n\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t}.debounce(150));\n\t\t\n\t\t$o.on(\"click.my\", \".btn-tabclose\", function(){\n\t\t\tvar $l = $(this).parent(),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.Tablist.length>1) {\n\t\t\t\tthat.Tablist.remove(function(e){return e===item});\n\t\t\t\tthat.List.remove(function(e){return e===item});\n\t\t\t\tif (!that.List.length) that.List.push(that.Tablist[0]);\n\t\t\t\tthat.Active = that.List[0].id;\n\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t}\n\t\t}.debounce(150))\n\t\t\n\t}","manifest": {"inherit": ["Path","GetActiveId"],"ui": {"#tabname": {"bind": "function (d) {\n\t\t\t\t\treturn this.Path(d);\n\t\t\t\t}","css": {"active": "function (d) {return d.id == this.GetActiveId()}"}}}},"id": "function (e) {return e.id}","hash": "function (e,i) {\n\t\tvar h =  (e.id===this.Active?\"1\":\"0\")+$.my.f.sdbmCode(e);\n\t\treturn h;\n\t}","list": "<div class=\"vat dib cp tab-tab\"><span id=\"tabname\"></span><span class=\"btn-tabclose\">×</span></div>","watch": "#ilist,#items"},"#items": {"bind": "this.List","manifest": "function (e) {\n\t\tvar that = this,\n\t\t\t\tman = {\n\t\t\t\t\tGetActiveId: function(){ return that.Active; },\n\t\t\t\t\tGetSite: function(){ return that.data.doc; },\n\t\t\t\t\tRT: function(){ return that; }\n\t\t\t\t},\n\t\t\t\tT = that.Types[e.type];\n\t\t\n\t\tif (!T.manifest) {\n\t\t\t$.extend( true, \n\t\t\t\tman, \n\t\t\t\tthat.Item,\n\t\t\t\t/*Object.select(T,[\"HTML\",\"ui\",\"init\", \"HTMLtail\", \"style\",\"validator\"]),\n\t\t\t\t{data:{data:T.data}}*/\n\t\t\t\tT.extend\n\t\t\t);\n\t\t\t$.extend (man, T.replace)\n\t\t} \n\t\telse {\n\t\t\t$.extend( true, \n\t\t\t\tman, \n\t\t\t\tT.manifest\n\t\t\t);\n\t\t}\n\t\t\n\t\treturn man;\n\t}","init": "function ($o,form) {\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t\n\t\t// Render tab preview\n\t\t\n\t\t$o.on(\"click.my\", \"#btn-rendertab\", function(evt){\n\t\t\tvar $c = $(evt.currentTarget), fd, path;\n\n\t\t\t\t\tfd = $c.my().root.my(\"data\");\n\t\t\t\t\tpath = that.Path(fd);\n\t\t\t\n\t\t\tif (true || !fd.snippet) {\n\t\t\t\tthat.Build($.extend(true, {}, d.doc), {\n\t\t\t\t\tpick:path, \n\t\t\t\t\tresolve:false,\n\t\t\t\t\tbuttons:true,\n\t\t\t\t\tsilent:true\n\t\t\t\t}, $c)\n\t\t\t\t.then(function(a){\n\t\t\t\t\tvar mod;\n\n\t\t\t\t\tvar att = (a.result._attachments||{})[path],\n\t\t\t\t\t\t\tmime;\n\n\t\t\t\t\tif (att) {\n\t\t\t\t\t\tmime = att.content_type;\n\t\t\t\t\t\tif (/^text\\/|(javascript|xml|xhtml|json)$/.test(mime)) {\n\t\t\t\t\t\t\t// we have text format\n\t\t\t\t\t\t\tmod = {\n\t\t\t\t\t\t\t\tjson:cw.lib.base64(att.data,true)\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (/javascript$/.test(mime)) {\n\t\t\t\t\t\t\t\tvar parsed = that.ParseJS(mod.json, true);\n\t\t\t\t\t\t\t\tif (parsed.errors.length) {\n\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\tmod.comment+='<span class=\"red\">'+parsed.errors.join(\"; \")+'</span><br/>';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (parsed.globals.length) {\n\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\tmod.comment+='Globals: '+parsed.globals.join(\", \");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (mod.comment) mod.comment = '<div class=\"mt10\">'+mod.comment+'</div>';\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t_modal(mod);\n\n\t\t\t\t\t\t} else if (/^image\\//.test(mime)) {\n\t\t\t\t\t\t\t// we have image\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// we have something else\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcw.lib.note(\"Can’t build attachment.\",\"error\");\n\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t\t\n\t\t\t//- - - - - -\n\t\t\t\n\t\t\tfunction _modal(data){\n\t\t\t\treturn $c.modal({\n\t\t\t\t\tmanifest:that.Takeout,\n\t\t\t\t\tdata:data,\n\t\t\t\t\twidth:600,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tbound:10\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t});\n\t}","list": "<div class=\"s3item\"></div>","check": true,"id": "function (e) {return e.id}","hash": "function (e,i) {\n\t\tvar h =  (e.id===this.Active?\"1\":\"0\")+$.my.f.sdbmCode(e);\n\t\treturn h;\n\t}","delay": 100,"recalc": "#ilist","watch": "#ilist","recalcDepth": 1},"#btn-publish": {"delay": 150,"css": {":disabled": "function (d) {\n\t\t\tvar s3 = $.extend(!0, {}, d.doc.s3, cw.crypto.dec(d.doc.creds)[\"s3\"]||{}), \n\t\t\t\t\ts = d.doc.site;\n\t\t\treturn (!s3.accessKeyId || !s3.secretAccessKey || !s3.region || !s.s3bucket);\n\t\t}"},"watch": "#sname","bind": "function (d,v,$o) {\n\t\tvar i, async = false,\n\t\t\t\tnote = cw.lib.note,\n\t\t\t\tthat = this,\n\t\t\t\trows, key,\n\t\t\t\terr = {}, atts2go,\n\t\t\t\terrors={},\n\t\t\t\t$root = $o.my().root,\n\t\t\t\toldhtml = $o.html(),\n\t\t\t\tproc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tproc = $.Deferred();\n\t\t\t$o.html('<span class=\"dib vat cw-busy w50 h8 br100 mt5\"></span>');\n\t\t\t$o.attr(\"disabled\", true);\n\t\t\tproc.then(\n\t\t\t\tfunction(msg, skipSave){\n\t\t\t\t\tcw.lib.note(msg || \"Published to S3\",\"ok\");\n\t\t\t\t\tif (!skipSave)  {\n\t\t\t\t\t\td.doc.stamp = Date.now();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Merge attaches if we have to\n\t\t\t\t\t\tif (d.doc.site.previewBase) {\n\t\t\t\t\t\t\tthat.MergeAtts(d.doc, atts2go.result)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t publish. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t).always(function(){\n\t\t\t\t$o.attr(\"disabled\", false);\n\t\t\t\t$o.html(oldhtml);\n\t\t\t});\n\t\t\t\n\t\t\t//-------\n\t\t\t\n\t\t\ttry {\n\t\t\t\n\t\t\t\tthat.Build(d.doc, {\n\t\t\t\t\tbuttons:true, \n\t\t\t\t\tfooter:\"Above items won’t be included.\",\n\t\t\t\t\tcheckcreds:true,\n\t\t\t\t\tpick:false\n\t\t\t\t}, $o)\n\t\t\t\t.then(function(a){\n\t\t\t\t\tatts2go = a;\n\t\t\t\t\t_getEnv ();\n\t\t\t\t})\n\t\t\t\t.fail(function(txt, msg, stack){\n\t\t\t\t\tproc.reject(txt, msg, stack);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t} catch (e ) {\n\t\t\t\tconsole.log(e.message, e.stack)\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t/*if (key = d.doc.creds.crypto) {\n\t\t\t\tif (!cw.crypto.has(key)) {\n\t\t\t\t\tcw.lib.note(\"No cryptokey to decode S3 credentials.\", \"error\");\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tvar s3 = cw.crypto.dec(d.doc.creds)[\"s3\"];\n\t\t\t\t\tif (s3) {\n\t\t\t\t\t\tthat.creds.s3 = s3;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcw.lib.note(\"Error decoding S3 credentials.\", \"error\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthat.creds.s3 = Object.clone(d.doc.s3, !0);\n\t\t\t}\n\t\t\tthat.ResolveExternals(d.doc, errors)\n\t\t\t.then(_createAtts)\n\t\t\t.fail(function(e){\n\t\t\t\tconsole.log(e);\n\t\t\t\tnote(\"Failed generating attaches, see console for details\",\"error\");\n\t\t\t});*/\n\t\t}\n\t\t\n\t\t// - - - - - - -\n\t\t\n\t\tfunction _getEnv () {\n\t\t\t\n\t\t\tif (!Object.size(atts2go.upload)) {\n\t\t\t\tif (!Object.size(atts2go.err)) proc.resolve (\"All files are up to date, nothing to upload.\", true);\n\t\t\t\telse proc.reject (\"All files, scheduled to upload, have errors. Upload cancelled.\", \"error\");\n\t\t\t} else {\n\t\t\t\t// Upload\n\t\t\t\t\n\t\t\t\tthat.db.load(d.doc._id, true)\n\t\t\t\t.then(function(odoc){\n\t\t\t\t\t\n\t\t\t\t\tif (!odoc) {\n\t\t\t\t\t\tproc.reject(\"Doc must be saved at least once before publishing.\", \"error\")\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar ra, na, \n\t\t\t\t\t\t\tr = atts2go.result,\n\t\t\t\t\t\t\tu = atts2go.upload;\n\t\t\t\t\t\n\t\t\t\t\tif (Object.size(odoc._attachments)) {\n\t\t\t\t\t\tif (!r._attachments) atts2go.result._attachments = {};\n\t\t\t\t\t\tra = atts2go.result._attachments;\n\t\t\t\t\t\tna = odoc._attachments;\n\t\t\t\t\t\tObject.keys(na).forEach(function(i){\n\t\t\t\t\t\t\tif (!ra[i] || null==ra[i].data) {\n\t\t\t\t\t\t\t\tra[i] = {\n\t\t\t\t\t\t\t\t\tcontent_type:na[i].content_type,\n\t\t\t\t\t\t\t\t\tdata:na[i].data\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tu[i] = cw.lib.sdbm(na[i].digest);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t_go()\n\t\t\t\t\t.then(function(msg,req){\n\t\t\t\t\t\tfor (var i=0;i<d.doc.items.length; i++) {\n\t\t\t\t\t\t\tvar item = d.doc.items[i];\n\t\t\t\t\t\t\tif (u[that.Path(item)] || item.snippet) {\n\t\t\t\t\t\t\t\tvar ssdbm = item.state.sdbm!=\"Z\" ? item.state.sdbm : u[that.Path(item)];\n\t\t\t\t\t\t\t\titem.state.savedSdbm = item.state.sdbm = ssdbm;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tproc.resolve();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(e,req){\n\t\t\t\t\t\tproc.reject(\"Failed to publish, see console\",e,req);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t/*if (that.db) {\n\t\t\t\t\tvar Att = \"_attachments\";\n\t\t\t\t\tcw.db(that.db.name).save(d.doc, true)\n\t\t\t\t\t.then(function(newdoc){\n\t\t\t\t\t\td.doc._rev = newdoc._rev;\n\t\t\t\t\t\td.doc._attachments = newdoc._attachments\n\t\t\t\t\t\tthat.db.load(d.doc._id, true).then(function(res){\n\t\t\t\t\t\t\tvar obj = $.extend({}, Object.reject(d.doc,Att), Object.select(res,Att));\n\n\t\t\t\t\t\t\t_go(obj).then(function(msg){\n\n\t\t\t\t\t\t\t\tfor (var i=0; i<obj.items.length; i++) {\n\t\t\t\t\t\t\t\t\td.doc.items[i].state.savedSdbm = obj.items[i].state.savedSdbm;\n\t\t\t\t\t\t\t\t}\t\n\n\t\t\t\t\t\t\t\tthat.db.save(d.doc).then(function(newdoc1){\n\t\t\t\t\t\t\t\t\td.doc._rev = newdoc1._rev;\n\t\t\t\t\t\t\t\t\td.doc.stamp = newdoc1.stamp;\n\t\t\t\t\t\t\t\t\t_success(msg);\n\t\t\t\t\t\t\t\t\t$root.find(\"#items\").trigger(\"recalc\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, _fail);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t_go().then(_success, _fail);\n\t\t\t\t}*/\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// - - - - - - - \n\n\t\tfunction _go(doc){\n\t\t\tvar pi = $.Deferred();\n\t\t\ttry {\n\t\t\t\tthat.Upload(d.doc, $o.my().root, atts2go)\n\t\t\t\t.then(function(msg) {\n\t\t\t\t\tpi.resolve(msg);\n\t\t\t\t})\n\t\t\t\t.fail(function(e,req){\n\t\t\t\t\tpi.reject(e,req);\n\t\t\t\t});\n\t\t\t} catch (e){\n\t\t\t\tpi.reject(e.message);\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\treturn pi.promise();\n\t\t}\n\n\t\t// - - - - - - - \n\n\t\t/*function _go(doc){\n\t\t\tvar pi = $.Deferred();\n\t\t\tif (!Object.size(atts2go.upload)) {\n\t\t\t\tpi.resolve(\"All files are up to date, nothing to upload.\");\n\t\t\t} else {\n\t\t\t\tvar res = that.Upload(doc || d.doc, $o.my().root, atts2go);\n\t\t\t\t\n\t\t\t\tres.then(function(d){\n\t\t\t\t\tpi.resolve('Files uploaded succesfully.');\n\t\t\t\t}, function () {\n\t\t\t\t\tpi.reject('Failed to publish files. Please, try again.');\n\t\t\t\t}, function (notify) {\n\t\t\t\t\tconsole.log(notify);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn pi.promise();\n\t\t}\n\t\t\n\t\t// - - - - - - - \n\t\t\n\t\tfunction _success (msg){\n\t\t\tnote(msg, \"ok\");\n\t\t}\n\t\t\n\t\tfunction _fail (msg){\n\t\t\tnote(msg,'error');\n\t\t}*/\n\t\n\t\t// - - - - - - -\n\t\t\n\t\t/*function _createAtts (){\n\t\t\tthat.MemoTabs();\n\t\t\ttry {\n\t\t\t\tatts2go = that.Items2Atts(d.doc, that.Types, errors);\n\t\t\t\terr = atts2go.err;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e.message, e.stack, e)\n\t\t\t}\n\t\t\tif (Object.size(err)) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\t\tdata:$.extend({buttons:true, footer:\"Above items won’t be published.\"},atts2go),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\t//width:600,\n\t\t\t\t\t//global:true,\n\t\t\t\t\tscreen:'rgba(255,255,255,0.5)',\n\t\t\t\t\talign:\"top:105%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tbound:0\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\t_getEnv();\n\t\t\t\t})\n\t\t\t\t.fail(function(){\n\t\t\t\t\tatts2go=null;\n\t\t\t\t\terr = null;\n\t\t\t\t\tnote(\"Publish operation cancelled\",\"error\");\n\t\t\t\t})\n\t\t\t} \n\t\t\telse {\n\t\t\t\t_getEnv();\n\t\t\t}\n\t\t}*/\n\t\t\n\t}"},"#btn-tar": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar a,err, that = this,errors = {}, tdoc, key;\n\t\t\n\t\tif (v!=null) {\n\t\t\t\n\t\t\ttdoc = $.extend(true, {}, d.doc);\n\t\t\t\n\t\t\tthat.Build(tdoc, {\n\t\t\t\tsilent:true\n\t\t\t}, $o)\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tvar i, \n\t\t\t\t\t\tT = that.Tar.Tar(),\n\t\t\t\t\t\ttar = new T(), \n\t\t\t\t\t\ta = res.result._attachments,\n\t\t\t\t\t\turl,r;\n\t\t\t\t\t\n\t\t\t\t\tif (Object.size(a)) {\n\n\t\t\t\t\t\tfor (i in a) {\n\t\t\t\t\t\t\tr = tar.append(i, that.Tar.Bytes(a[i].data));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\turl = URL.createObjectURL(new Blob([r], {type : 'application/x-tar'}));\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\t\tinit:[\n\t\t\t\t\t\t\t\t\t\t'<p class=\"mt10\">Tar archive of all files:</p>',\n\t\t\t\t\t\t\t\t\t\t'<div id=\"atar\" class=\"fs110 bold pb10\"></div>'\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\t\t\t\"#atar\": function(d){\n\t\t\t\t\t\t\t\t\t\t\tvar name = tdoc.name.replace(/[^a-z0-9\\.\\-]/ig,'-').replace(/\\-{2,}/g,'-').toLowerCase()+\".tar\",\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml = '<a download=\"' + name + '\" href=\"' + d.url +'\">' +name+'</a>';\n\t\t\t\t\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata:{url:url},\n\t\t\t\t\t\t\t\talign:\"top:102%\",\n\t\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\t\twidth:230,\n\t\t\t\t\t\t\t\tcss:\"fs85 tac xgray\",\n\t\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\t\tenter:true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t}\n\t}"},"#btn-validate": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar that=this, errors = {}, tdoc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\telse {\n\t\t\t\t\n\t\t\t\t//var tdoc = $.extend(true, {}, d.doc);\n\t\t\t\t\n\t\t\t\tthat.Build(d.doc, {blocking:false}, $o)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(res){\n\t\t\t\t\t\t// here better go some kind of stats\n\t\t\t\t\t},\n\t\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t/*if ($o.data(\"modal\")) $o.modal(true);\n\t\t\telse {\n\t\t\t\t\n\t\t\t\tvar tdoc = $.extend(true, {}, d.doc);\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tthat.ResolveExternals(tdoc, errors)\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\tvar err = that.Items2Atts(tdoc, that.Types, errors);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//window.MM = err;\n\n\t\t\t\t\t\tif (Object.size(err.err)) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\t\t\t\t\tdata:$.extend({buttons:false},err),\n\t\t\t\t\t\t\t\t//data:err,\n\t\t\t\t\t\t\t\tesc:false,\n\t\t\t\t\t\t\t\tenter:false,\n\t\t\t\t\t\t\t\tdrag:true,\n\t\t\t\t\t\t\t\talign:\"top:103%\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcw.lib.note(\"Doc integrity seems to be Ok.\",\"ok\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\tcw.lib.note(\"Error during validation\",\"error\");\n\t\t\t\t}\n\t\t\t}*/\n\t\t}\n\t}"}},"AddItem": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML);\n\t}","params": {"width": 445},"ui": {"#nname": {"bind": "name","check": "function (d,v) {\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\tif (this.getDup(d, v)) return \"Already taken\";\n\t\t\t}","watch": "#nfolder,#ntype"},"#ntype": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.type = v+\"\";\n\t\t\t\t\td.ext = this.Types[d.type].ext;\n\t\t\t\t}\n\t\t\t\treturn [d.type]\n\t\t\t}","init": "function ($o) {\n\t\t\t\tvar i, r, x, \n\t\t\t\t\t\tt = this.RT().Types,\n\t\t\t\t\t\ta=[], em;\n\t\t\t\tfor (i in t) {\n\t\t\t\t\tr = t[i];\n\t\t\t\t\tif (!r.noInsert) {\n\t\t\t\t\t\n\t\t\t\t\t\tif (!em && r.primary) {\n\t\t\t\t\t\t\tem = {};\n\t\t\t\t\t\t\tem[r.name] = i;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tx = {};\n\t\t\t\t\t\t\tx[r.name] = i;\n\t\t\t\t\t\t\ta.push(x);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$o.tags({tags:[a], empty:em});\n\t\t\t\t}\n\t\t\t}"},"input[name=\"snippet\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t}","recalc": "#cache"},"#nfolder": {"bind": "folder","check": "new RegExp(/^[a-z0-9\\-\\.]{0,20}$/i)"},"#ext": {"bind": "ext","check": "new RegExp(/^[a-z0-9\\-]{0,20}$/)","watch": "#ntype"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.name || \n\t\t\t\t\t\tthis.getDup(d)\n\t\t\t\t\t);\n\t\t\t\t}"},"watch": "#ntype,#nfolder,#nname"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#cache": {"init": "function ($o) {\n\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t}","bind": "cache","css": {"hide": "function (d) {return d.snippet}"}}},"HTML": [{"row": "445px","label": "116px","labelCss": "fs80 gray","rowCss": "my-row pt5 pb7"},"<h4 class=\"mt0\">Create resource</h4>",["","spn#ntype.fs90"],["","<span>","inp#nfolder.w100",{"plc": "Folder"},"</span> / <span class=\"dib vat w250\">","inp#nname.w250",{"plc": "Name"},"msg.fs70","</span> . ","<span>","inp#ext.w60",{"plc": "Ext"},"</span>"],{"rowCss": "my-row pt7 pb5"},["Cache-control","spn#cache.fs85"],{"rowCss": "my-row pt5 pb10"},["","<label class=\"gray fs80\">","<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>"," Fragment (no file created)","</label>"],{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Create"}," ","btn#btn-cancel",{"val": "Cancel"}]],"Typelist": ["html"]},"AddFile": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML);\n\t}","ui": {"#fext": {"bind": "item.ext"},"#ffolder": {"bind": "item.folder","check": "new RegExp(/^[a-z0-9\\-\\.]{0,20}$/i)"},"#fname": {"bind": "item.name","check": "function (d,v) {\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\tvar dup = this.getDup(d.item, v);\n\t\t\t\tif (dup && dup!==\"attachment\") return \"Already taken\";\n\t\t\t}","watch": "#fext,#ffolder"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\tvar dup = this.getDup(d.item);\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.item.name || \n\t\t\t\t\t\t(dup && dup!=\"attachment\")\n\t\t\t\t\t);\n\t\t\t\t}"},"watch": "#fext,#ffolder,#fname,#upload"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#upload": {"bind": "function (d,v,$o) {\n\t\t\t\tvar f, a={}, data;\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f.size>1024*1024*15){\n\t\t\t\t\t\t(window.l||cw).note(\"15Mb max\",\"error\");\n\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t}\n\t\t\t\t\telse if (f) (function(){\n\t\t\t\t\t\ta.content_type = f.type||\"application/octet-stream\";\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [], fn = f.name.split(\".\");\n\t\t\t\t\t\td.item.ext = fn.last().toLowerCase();\n\t\t\t\t\t\tfn.pop();\n\t\t\t\t\t\td.item.name = fn.join(\".\");\n\t\t\t\t\t\t$o.my(\"find\",\"#fext\").trigger(\"recalc\");\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\t\ta.size = sb64.length;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\td.file = a;\n\t\t\t\t\t\t\t$o.my(\"find\",\".cw-att-upload .pseudolink\").html(\"Other file...\");\n\t\t\t\t\t\t\t$o.my(\"find\",\".unhide\").removeClass(\"hide\");\n\t\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t}","watch": "#fname"},"#cache": {"init": "function ($o) {\n\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t}","bind": "item.cache"}},"HTML": [{"row": "535px","rowCss": "my-row pt5 pb7 hide unhide","label": "166px","labelCss": "gray fs80"},"<div class=\"mt5 mb10\"><h3 class=\"cw-att-upload fs100\"><span class=\"pseudolink\">Select a file...</span></h3><input id=\"upload\" type=\"file\" /></div>",["","<span>","inp#ffolder.w150.fs100",{"plc": "Folder"},"</span> / <span class=\"dib vat w300\">","inp#fname.w300.fs100",{"plc": "Name"},"msg.fs70","</span> . ","spn#fext.w100.fs80"],["Cache-control","spn#cache.fs85"],{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Attach"}," ","btn#btn-cancel",{"val": "Cancel"}]],"style": {" input[type=file]": "width:100%;cursor:pointer;opacity:0; position:absolute;top:0;left:0;height:1.5em"}},"AddImage": {"data": {"filename": "","folder": "","data": "","mime": "image/jpeg","mode": ["inline"],"cropped": false,"width": "300","height": "200","scale": "1","crop": {},"srcsize": true},"params": {"width": 1020},"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\thtml = $.my.formgen([\n\t\t\t'<div class=\"fl mr20 tac vat bg-lgray\" style=\"'\n\t\t\t+'width:800px;height:600px;overflow:hidden;position:relative;line-height:600px;\" id=\"crop-frame\">',\n\t\t\t\t'<img id=\"source\" class=\"vam\" style=\"max-width:800px; max-height:600px; \" src=\"\" />',\n\t\t\t\t'<div class=\"w800  dib\" style=\"height:600px;position:absolute;top:0;left:0\">',\n\t\t\t\t\t'<span class=\"dib vam fs110 button\">',\n\t\t\t\t\t'<span class=\"fi-photo\"><span class=\"fs110\"> &nbsp;Select image</span></span>',\n\t\t\t\t\t'</span>',\n\t\t\t\t\t'<input type=\"file\" id=\"file\" class=\"w800 dib\" accept=\"image/jpeg,image/png\" '\n\t\t\t\t\t+'style=\"height:600px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xpreview\">',\n\t\t\t\t{row:\"200px\",rowCss:\"pb10 my-row\"},\n\t\t\t\t[\"\",\"inp#folder\",{plc:\"Folder\"},\"msg.fs70\"],\n\t\t\t\t[\"\",\"inp#fname\",{plc:\"Flename\"},\"msg.fs70\"],\n\t\t\t\t[\"\",\"num#fw.w90.fs110.sizer\",{min:20, max:3000, step:5},' × ', \n\t\t\t\t \t\"num#fh.w90.fs110.sizer\", {min:20, max:3000, step:5}],\n\t\t\t\t/*[\"\",\"spn#mode.fs100.lh150\"],*/\n\t\t\t\t[\"\", '<label class=\"fs80\">',\n\t\t\t\t \t'<input type=\"checkbox\" name=\"srcsize\" value=\"srcsize\">',\n\t\t\t\t \t' &nbsp;Original dimensions',\n\t\t\t\t\t'</label>'],\n\t\t\t\t{rowCss:\"\"},\n\t\t\t\t[\"\",\n\t\t\t\t \"btn#btn-apply.w200.green.fs120.tac\",{val:\"Crop\"},\n\t\t\t\t //\"btn#btn-orig.w200.tac\",{val:\"Вставить оригинал\"},\n\t\t\t\t \"btn#btn-close.w200.tac\",{val:\"Cancel\"}\n\t\t\t\t],\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xwarn\"></div>',\n\t\t\t'<div class=\"hide\">',\n\t\t\t\t'<canvas id=\"x2\" width=400 height=400></canvas>',\n\t\t\t\t'<canvas id=\"x1\" width=200 height=200></canvas>',\n\t\t\t'</div>'\n\t\t]);\n\t\t$o.html(html);\n\t\tthat.Active = \"\";\n\t\t$o.on(\"focus.my\",\".sizer\", function(){\n\t\t\tif (!d.srcsize) {\n\t\t\t\tthat.Active = $(this).attr(\"id\");\n\t\t\t\t$(this).removeClass(\"gray\");\n\t\t\t} else {\n\t\t\t\tthat.Active = \"\";\n\t\t\t}\n\t\t});\n\t\t\n\t}","style": {" .jcrop-holder": "display:inline-block;vertical-align:middle"},"Recalc": "function (d,$o,update) {\n\t\tvar that = this;\n\t\tif (that.Active ==\"fh\") {\n\t\t\td.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fh\").trigger(\"check\");\n\t\t}\n\t\telse if (that.Active == \"fw\") {\n\t\t\td.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t\telse {\n\t\t\td.width = (d.crop.w*d.scale).floor();\n\t\t\td.height = (d.crop.h*d.scale).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t}","ui": {"#folder": {"bind": "folder","check": "new RegExp(/^[a-z0-9\\-\\.]{0,20}$/i)","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"#fname": {"bind": "filename","check": "function (d,v) {\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\t//if (this.getDup(d, v)) return \"Имя занято\";\n\t\t\t}","watch": "#folder","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"input[name=\"srcsize\"]": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.srcsize = !!(v+\"\");\n\t\t\t\t}\n\t\t\t\tif (d.srcsize) {\n\t\t\t\t\tthis.Active = \"\";\n\t\t\t\t\tthis.Recalc (d, $o, false);\n\t\t\t\t}\n\t\t\t\treturn d.srcsize?[\"srcsize\"]:[];\n\t\t\t}","watch": "#folder","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"#fw": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.width=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)\t) d.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.width+\"\";\n\t\t\t}","recalcDepth": 1,"delay": 20,"watch": "#fh,#folder,input[name=\"srcsize\"]","css": {"hide": "function (d) { return !Object.size(d.crop)}","self:gray": "function (d,v,$o) {\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}"}},"#fh": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.height=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)) d.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.height+\"\";\n\t\t\t}","watch": "#fw","recalcDepth": 1,"delay": 20,"css": {"self:gray": "function (d,v,$o) {\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}"}},"#file": {"bind": "function (d,v,$o) {\n\t\t\n\t    \t\tvar f,that = this,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\timg=\"\";\n\t    \t\t\n\t    \t\t\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\td.filename = f.name\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.replace(/[^a-z0-9\\-\\.]/gi,'')\n\t\t\t\t\t\t\t.replace(/\\.[^\\.]+$/,\"\")+\".jpg\";\n\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\timg = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tfr.onloadend = function (){\n\t\t\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\t\t\td.scale = $img[0].naturalWidth/$img.width();\n\t\t\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\t\t\tallowMove:true\n\t\t\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\t\t\tthis.animateTo([0,0,100,100]);\n\t\t\t\t\t\t\t\t\td.crop.z=1;\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#folder\").trigger(\"check\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\timg=\"\";\n\t\t\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$img.removeClass(\"hide\")\n\t\t\t\t\t\t\t\t.attr(\"src\",\"data:image/jpeg;base64,\"+img);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//d.scale=$img[0].naturalWidth/$img.width();\t\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction preview(c){\n\t\t\t\t\t$.extend(d.crop, Object.select(c,[\"x\",\"y\",\"w\",\"h\"]));\n\t\t\t\t\td.cropped=true;\n\t\t\t\t\t\n\t\t\t\t\tthat.Recalc(d, $o, true);\n\t\t\t\t}\n\t\t\t}"},"#btn-apply": {"bind": "function (d,v,$o) {\n\t\t\t\tvar f, that = this,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$c = $r.find(\"#x1\"),\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\t$c2 = $r.find(\"#x2\"),\n\t\t\t\t\tn={k:d.scale}, img=\"\",\n\t\t\t\t\twidth=d.width*1.5;\n\t\t\t\n\t\t\t\tif (v!=null && d.cropped) {\n\t\t\t\t\t_create (d.crop);\n\n\t\t\t\t\td.data = $o.my(\"find\",\"#x1\")[0]\n\t\t\t\t\t\t.toDataURL('image/jpeg',0.97)\n\t\t\t\t\t\t.substr(23);\n\t\t\t\t\t$o.my().root.trigger(\"commit\");\n\t\t\t\t}\n\n\t\t\t\tfunction _create (c){\n\t\t\t\t\tif(parseInt(c.w) > 0) {\n\t\t\t\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\t\t\tk = n.k,\n\t\t\t\t\t\t\tw = c.w*k, // scale width/height\n\t\t\t\t\t\t\th = c.h*k; \n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!that.Active) {\n\t\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\t\tctx.drawImage(img, (c.x*k).floor(), (c.y*k).floor(), d.width*1, d.height*1, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t\t\n\t\t\t\t\t\t} else { \n\t\t\t\t\t\t\tif (w>d.width*2) {\n\t\t\t\t\t\t\t\tcs2 = $c2[0];\n\t\t\t\t\t\t\t\tcs2.width=d.width*2;\n\t\t\t\t\t\t\t\tcs2.height=2*d.height;\n\t\t\t\t\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\t\t\t\t\tctx2.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*2,d.height*2);\n\n\t\t\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\t\t\tctx.drawImage(cs2, 0, 0, d.width*2,d.height*2, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\t\t\tctx.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}","events": "click.my","watch": "#folder","css": {":disabled": "function (d) { return !Object.size(d.crop)}"}},"#btn-close": {"bind": "function (d,v,$o) {if (v!=null) $o.trigger(\"cancel\");}","events": "click.my"}}},"DocParams": {"init": "function ($o,form) { \n\t\t$o.formgen(this.HTML);\n\t\tvar that = this, d = form.data;\n\t\tif (!(d.creds.crypto+\"\")) {\n\t\t\t$.extend(!0, that.s3, d.s3);\n\t\t} else if (cw.crypto.has(d.creds.crypto)) {\n\t\t\tif (!d.creds.CRYPTO) {\n\t\t\t\td.creds.crypto = \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar s3 = cw.crypto.dec(d.creds);\n\t\t\t\tif (!s3.CRYPTO) {\n\t\t\t\t\t$.extend(!0, that.s3, s3.s3);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthat.nokey = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t} else {\n\t\t\tthat.nokey = true;\n\t\t}\n\t}","nokey": false,"s3": {"accessKeyId": "","secretAccessKey": "","region": ""},"ui": {"#s3title": {"bind": "name","check": "new RegExp(/^.+$/)"},"#s3id": {"bind": "this.s3.accessKeyId","check": "new RegExp(/^.+$/)"},"#s3key": {"bind": "this.s3.secretAccessKey","check": "new RegExp(/^.+$/)"},"#s3region": {"bind": "this.s3.region","check": "new RegExp(/^[a-z0-9]{2}\\-[a-z0-9]{2,20}\\-[0-9]$/i)"},"#s3bucket": {"bind": "site.s3bucket","check": "new RegExp(/^[a-z0-9\\-\\.]{2,50}$/i)"},"#s3folder": {"bind": "site.s3folder","check": "new RegExp(/^(|([a-z0-9\\-\\.]{1,30}\\/){0,2}[a-z0-9\\-\\.]{1,30}\\/?)$/i)"},"#url": {"bind": "site.siteBase","check": "new RegExp(/^http[s]?:\\/\\/.{3,200}$/)"},"#preview": {"bind": "site.previewBase","check": "new RegExp(/^http[s]?:\\/\\/.{3,200}$/)"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tvar that = this, i;\n\t\t\t\t\tif (d.creds.crypto+\"\" && !that.nokey) {\n\t\t\t\t\t\tfor (i in d.s3) d.s3[i]=\"\";\n\t\t\t\t\t\td.creds.s3 = Object.clone(Object.reject(that.s3,\"CRYPTO\"), true);\n\t\t\t\t\t\td.creds = cw.crypto.enc(Object.reject(d.creds,\"CRYPTO\"));\n\t\t\t\t\t} else if (!(d.creds.crypto+\"\")) {\n\t\t\t\t\t\t$.extend(d.s3,Object.reject(that.s3,\"CRYPTO\"));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#cryptokey": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.creds.crypto=v;\n\t\t\t\t\tif (v!=\"_\") d.creds.crypto=v;\n\t\t\t\t\telse d.creds.crypto=\"\";\n\t\t\t\t}\n\t\t\t\treturn v||d.creds.crypto||\"_\";\n\t\t\t}","init": "function ($o) {\n\t\t\t\t$o.html(\n\t\t\t\t\t[ {id:\"_\",name:\"No encryption\"} ]\n\t\t\t\t\t.add( cw.crypto.keys() )\n\t\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t\t},\"\")\n\t\t\t\t).select2();\n\t\t\t}"},"#haskey": {"css": {"hide": "function () { return !!this.nokey}"}},"#nokey": {"css": {"hide": "function () {return !this.nokey}"}}},"HTML": ["<h4 class=\"mb10\">AWS S3 and preview settings</h4>",{"row": "525px","label": "125px","rowCss": "my-row pb10","labelCss": "fs80 gray"},["Title","inp#s3title.bold"],["Site URL","inp#url"],["Preview URL","inp#preview"],["S3 path","<span>","inp#s3region.w100",{"plc": "Region"},"</span><span class=\"w15 dib gray tac\">/</span><span>","inp#s3bucket.w170",{"plc": "Bucket"},"</span><span class=\"w15 dib gray tac\">/</span><span>","inp#s3folder.w100",{"plc": "Folder"},"</span>"],"<section id=\"haskey\">",["S3 access key Id","inp#s3id"],["S3 secret key","inp#s3key"],["Encrypt creds","sel#cryptokey.w200"," <span class=\"fs80 gray pl10\">Key to encrypt secrets</span>"],"</section>","<section id=\"nokey\" class=\"hide red fs90 pt10 pb10\">","Credentials are encrypted with the key you don‘t have, sorry.","</section>",{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Save"}," ","btn#btn-cancel",{"val": "Cancel"}]]},"ParseErrors": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML);\n\t}","params": {"width": 450},"ui": {"#errs": {"bind": "function (d,v,$o) {\n\t\t\t\tvar i, h = '<table width=\"450\">';\n\t\t\t\tfor (i in d.err) {\n\t\t\t\t\th+='<tr><td class=\"w150 xgray pr15 brw btd\">'\n\t\t\t\t\t\t+i+'</td><td class=\"red vam btd\">'\n\t\t\t\t\t\t+d.err[i].join(\"<br>\")\n\t\t\t\t\t\t+'</td></tr>';\n\t\t\t\t}\n\t\t\t\treturn h+'</table>'\n\t\t\t}"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#errtitle": "function (d) {\n\t\t\tvar i = Object.size(d.err), e = Object.values(d.err).flatten().length;\n\t\t\treturn \"Found \"+e+\" error\"+(e>1?\"s\":\"\")+\" in \"+i+\" item\"+(i>1?\"s\":\"\");\n\t\t}","#efooter": {"bind": "function (d) { return \"&nbsp;\"+d.footer}","css": {"hide": "function (d) {return !d.footer}"}},".ebtns": {"css": {"hide": "function (d) {return !d.buttons}"}}},"HTML": ["<h4 class=\"mb10 fs100\" id=\"errtitle\"></h4>",{"row": "450px","label": "100px","rowCss": "my-row pb10","labelCss": "fs80 gray"},"<div id=\"errs\" class=\"fs80 w450\"></div>","<div id=\"efooter\" class=\"fs80 fi-alert xgray mt5\"></div>",{"rowCss": "my-row pt12 mt7 btd fs80 ebtns"},["","btn#btn-ok.green",{"val": "Proceed"}," ","btn#btn-cancel",{"val": "Cancel"}]],"style": {" td": "padding:4px 0; font-size:85%; line-height:1.2em;"," .brw": "word-break:break-word"," #errs": "max-height:400px;overflow-y:auto;"}},"Takeout": {"data": {"json": "error"},"init": ["<textarea id=\"json\" class=\"w100p h400 fs60 lh120 xgray o90\" disabled style=\"font-family:'Cousine'\"></textarea>",["","btn#btn-ok.green.w100.mr30.fs90",{"val": "Ok"},"<div class=\"gray fr mt7 fs80\" id=\"stats\"></div>","<a href=\"\" download=\"\" id=\"btn-dl\" target=\"_blank\" class=\"fs90\">Download as a file</a>"],"<div id=\"comment\" class=\"fs70 gray\"></div>"],"ui": {"#btn-ok": "function (d,v,$o) {\n\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t}","#json": "function (d) {return d.json}","#btn-dl": {"init": "function ($o,form) {\n\t\t\t\tif (form.data.objurl) {\n\t\t\t\t\t$o.attr(\"download\", form.data.fname);\n\t\t\t\t\t$o.attr(\"href\", form.data.objurl);\n\t\t\t\t}\n\t\t\t}","css": {"hide": "function (d) {return !d.objurl}"}},"#stats": {"bind": "function (d) {return d.json.length.metric(2,false)+\"b\"}"},"#comment": {"bind": "comment"}}},"Confirm": {"id": "cw.Sys.YesNoCancel","params": {"delay": 5,"width": 450},"data": {"text": "","css": "xgray","yes": "Yes","no": "No","cancel": "Cancel","cmd": ""},"init": "function ($o,form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t    '<div class=\"'+d.css+'\">'+d.text+'</div>',\n\t\t\t{label:\"70px\", row:form.params.width+\"px\", rowCss:\"my-row mt15 pt15 fs90 mb-5 xgray btd\"},\n\t\t\t['', 'spn#btn-yes.button.green.mr5',{txt:d.yes}, \n\t\t\t \t'spn#btn-no.button.mr5',{txt:d.no}, \n\t\t\t\t'spn#btn-cancel.button.fr',{txt:d.cancel}]\n\t\t]);\n\t}","ui": {"#btn-yes": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"yes\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.yes}"}},"#btn-no": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"no\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.no}"}},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"cancel\";\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.cancel}"}}}},"Item": {"inherit": ["GetDoc","GetActiveId","RT","Confirm","Items2Atts","Path"],"params": {"restyle": 200},"data": {"id": "","type": "html","snippet": false,"folder": "","name": "index","ext": "html","mime": "text/html","desc": "","external": "","dropImport": false,"data": "<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title> Insert title here </title>\n\t</head>\n\t<body>\n\t\tHello, world!\n\t</body>\n</html>","parser": "// Parser receives (item, _attachments)\n// and must return string representation of item\n(function (item, atts){\n\n\treturn item.data+\"\";\n})","parserActive": false,"cache": "86400","state": {"savedSdbm": "","sdbm": "","depends": {},"impacts": {}}},"Track": "function (item) {\n\t\tvar it=item, att,\n\t\t\t\tparser;\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t}\n\t}","init": "function ($o,form) {\n\t\tvar that = this;\n\t\t$o.html($.my.formgen(this.HTML)+$.my.formgen(this.HTMLtail));\n\t\t\n\t\t\n\t\t$o.then(function(){\n\t\t\t$o.find(\"#xparser\").addClass(\"hide\").css({opacity:1});\n\t\t\t$o.on(\"change.my\", function(){\n\t\t\t\tthat.Track(form.data);\n\t\t\t\tif (form.data.state.sdbm !== form.data.state.savedSdbm) {\n\t\t\t\t\t$o.parent().my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t}\n\t\t\t}.debounce(300));\n\t\t});\n\t\t\n\t\t$o.on(\"click.my\",\"#warn\", function(){\n\t\t\tvar $c = $(this);\n\t\t\tif ($c.data(\"modal\")) return $c.modal(true);\n\t\t\tif (that.Err) {\n\t\t\t\tvar e = that.Err(that.data.data);\n\t\t\t\t$c.modal({\n\t\t\t\t\twidth:250,\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tbound:0,\n\t\t\t\t\talign:\"top:120%;left:0;\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tmanifest:{\n\t\t\t\t\t\tinit:['<span id=\"t\" class=\"red lh150\"></span>'],\n\t\t\t\t\t\tui:{\"#t\":\"t\"}\n\t\t\t\t\t},\n\t\t\t\t\tdata:{t:e},\n\t\t\t\t\tcss:\"fs80\"\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t}","ui": {"#warn": {"bind": "function (d,v,$o) {\n\t\t\tvar r, that = this;\n\t\t\tif (Object.isFunction(that.validator)){\n\t\t\t\ttry {\n\t\t\t\t\tr = that.validator(d);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t}\n\t\t\t$o.html(\n\t\t\t\tr\n\t\t\t\t?'&nbsp;<span class=\"'+(that.Err?'pseudolink red':'')+'\">'+r+'</span>'\n\t\t\t\t:\"\"\n\t\t\t);\n\t\t\t$o.toggleClass(\"hide\", !r);\n\t\t\t$o.my(\"find\",\"#xeditor\").toggleClass(\"b1r\", !!r);\n\t\t}","watch": "#editor","delay": 500},"#fname": {"bind": "function (d) {\n\t\t\tvar html=\"\", \n\t\t\t\t\tbase = this.GetSite().site.previewBase, \n\t\t\t\t\tp = !d.snippet && !!base;\n\t\t\tif (p) html+='<span class=\"gray fs85 fi-eye\"></span>&nbsp;';\n\t\t\t\t\n\t\t\thtml+= (d.folder?'<span class=\"gray\">'+d.folder+\"/</span>\":\"\");\n\t\t\t\n\t\t\tif (p) {\n\t\t\t\t\n\t\t\t\thtml+='<a target=\"_blank\" href=\"'\n\t\t\t\t\t\t+(base?base.replace(/\\/$/,'')+\"/\":\"\")\n\t\t\t\t\t\t+(d.folder?d.folder+\"/\":\"\")\n\t\t\t\t\t\t+d.name+\".\"+d.ext\n\t\t\t\t\t\t+'\">';\n\t\t\t}\n\t\t\thtml+= d.name+\".\"+d.ext;\n\t\t\t\n\t\t\tif (p) html+='</a>';\n\t\t\t\n\t\t\treturn html;\n\t\t}"},"#xparse": {"css": {"hide": "function (d) {return !d.parserActive}"},"watch": "#fname"},"#btn-settings": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this, $f;\n\t\t\tif (v!=null) {\n\t\t\t\t$f = $o;//.my().root;\n\t\t\t\tif ($f.data(\"modal\")) $f.modal(true);\n\t\t\t\telse $f.modal({\n\t\t\t\t\tmanifest:$.extend({}, this.Settings, { RT:this.RT }),\n\t\t\t\t\tdata:Object.select(d, \n\t\t\t\t\t\t\"id type desc folder mime size name ext cache parserActive dropImport noIncludes snippet external\".split(\" \").add([/^[A-Z]/])\n\t\t\t\t\t),\n\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t(window.l||cw.lib).note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\talign:\"top:0;right:0\", \n\t\t\t\t\t// nose:\"top\",\n\t\t\t\t\troot:$o.my().root,\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t\n\t\t\t\t\t// moveAtt\n\t\t\t\t\tvar nold = that.RT().Path(d),\n\t\t\t\t\t\t\tnnew = that.RT().Path(res),\n\t\t\t\t\t\t\tdoc = that.RT().data.doc\n\t\t\t\t\tif (nold != nnew && doc._attachments) {\n\t\t\t\t\t\t//doc._attachments[nnew] = doc._attachments[nold];\n\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t}\n\t\t\t\t\t_fin();\n\t\t\t\t\t\n\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}","watch": "#fname"},"#showhideproxy": {"bind": "function (d,v,$o) {\n\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t}"},"#btn-deps": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tvar that = this, h=\"\";\n\n\t\t\t\tthat.RT().Items2Atts(null, null, {}, true, true);\n\t\t\t\t\n\t\t\t\tvar deps=Object.keys(d.state.depends||{}),\n\t\t\t\t\t\timps = Object.keys(d.state.impacts||{});\n\t\t\t\t\n\t\t\t\t//console.log(d);\n\t\t\t\t\n\t\t\t\tif (deps.length) {\n\t\t\t\t\th+='<div>Depends:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+deps.map(function(i){\n\t\t\t\t\t\t\treturn d.state.depends[i] ? i:'<span class=\"red\">'+i+'</span>';\n\t\t\t\t\t\t}).join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (imps.length) {\n\t\t\t\t\th+='<div>Impacts:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+imps.join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (h) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:$.extend(true, {},that.Confirm,{params:{width:250}}),\n\t\t\t\t\t\twidth:250,\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttext:h, yes:\"Ok\", \tno:\"\", cancel:\"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\tcss:\"fs100 lh170 pb20\",\n\t\t\t\t\t\tesc:true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.lib.note(\"Item has no dependencies.\",\"ok\");\n\t\t\t\t}\n\t\t\t}\n\t\t}","watch": "#fname"},"#btn-rendertab": {"bind": "function () {}","watch": "#fname"},"#btn-play": {"delay": 100,"bind": "function (d,v,$o) {\n\t\t\tvar parser, res, err, atts={}, html=\"\", that=this;\n\t\t\tif (v!=null) {\n\t\t\t\t\n\t\t\t\tif(d.parserActive) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tparser = eval(d.parser);\n\t\t\t\t\t} catch (e){ \n\t\t\t\t\t\tconsole.log(err=\"Parser code has errors, \"+e.message, e.stack);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Object.isFunction(parser)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tres = parser(d, atts)+\"\";\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\tconsole.log(err=\"Parser/generator error, \"+e.message, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} \n\t\t\t\t\n\t\t\t\tif (res) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:that.PlayParser,\n\t\t\t\t\t\tdata:{txt:res},\n\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\twidth:800,\n\t\t\t\t\t\tglobal:true,\n\t\t\t\t\t\tscreen:true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (err) {\n\t\t\t\t\t(window.l||cw.lib)[\"note\"](err,\"error\");\n\t\t\t\t}\n\t\t\t}\n\t\t}","check": "function (d,v,$o) {\n\t\t\tvar parser, err;\n\t\t\ttry {parser = eval(d.parser);} catch (e){}\n\t\t\terr = (!Object.isFunction(parser)?\"Error\":\"\");\n\t\t\t$o.toggleClass(\"red\",!!err);\n\t\t\treturn err;\n\t\t}","watch": "#parser"},"#parser": {"bind": "parser","init": "function ($o,form) {\n\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: \"javascript\",\n\t\t\t\tlineNumbers:true,\n\t\t\t\tindentWithTabs:!0,\n\t\t\t\tindentUnit:2,\n\t\t\t\ttabSize:2,\n\t\t\t\ttheme: \"default\"\n\t\t\t});\n\t\t}"},"#btn-source": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#editor\");\n\n\t\t\t\t$e.parent().toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t}"},"#btn-parser": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#editor\");\n\n\t\t\t\t$e.parent().toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t}","css": {"hide": "function (d) {return !d.parserActive}"},"watch": "#fname"}},"validator": "function () {}","HTML": ["<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:200px\">","<div class=\"db epane\">","<div class=\"control\">","<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-rendertab\" title=\"Render\">","<span class=\"fi-shopping-bag\" ></span>","</button></span>","<span><button class=\"btn mr2 button btn-c pl1 pr2 bold\" id=\"btn-parser\" title=\"Parser\">","<span class=\"lh100 fs110\" style=\"letter-spacing:-1px;\">&gt;_</span>","</button></span>","<span><button class=\"btn mr2 button btn-c pr1 pl1\" id=\"btn-deps\" title=\"Dependencies\">","<span class=\"fi-share\" ></span>","</button></span>","<span><button class=\"btn button mr0 btn-r pr3\" id=\"btn-settings\"  title=\"Settings\">","<span class=\"fi-widget\" ></span>","</button><span>","</div>","<div id=\"fname\" class=\"fs90 xgray lh120\"></div> ","<div id=\"warn\" class=\"fs80 red fi-alert lh120\"></div> ","<div id=\"showhideproxy\"></div>","</div>","<textarea id=\"editor\" style=\"width:100%\" class=\"edheight\"></textarea>","</div>","<div id=\"xparser\" class=\"edwidth\" style=\"opacity:0.005\">","<div style=\"position:absolute;top:3px;right:5px;z-index:+5\">","<button class=\"fs80 green tac btn-l mr2 button pr7 pl12 lh100\" id=\"btn-source\">","<span class=\"fi-page-edit\" title=\"Source\"></span>","</button>","<button  id=\"btn-play\" title=\"Run parser\" ","class=\"button green fs80 mt0 mb0 mr0 btn-r pl10 pr12 lh100\"><span class=\"fi-play\"></span></button>","</div>","<div class=\"dib vat b1g\" style=\"width:100%;min-height:200px\">","<textarea id=\"parser\" class=\"\" style=\"width:100%\"  class=\"edheight\"></textarea>","</div></div>"],"HTMLtail": [],"style": {" .epane": "width: 330px;position: absolute;top: 2px;right: 0px;z-index: +5;background: rgba(255,255,255,0.0);border-radius: 10px;padding: 0px 5px;"," .control": {"": " font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;"," .button": "padding-bottom: 0.35em;",":hover": "opacity:1"}," .btn": "width:2em; height:2em; border-radius:2em; line-height:2em; vertical-align:middle; text-align:center;padding:0;display:inline-block;"," #fname": "word-wrap: break-word; white-space: pre; padding: 5px 0;font-weight: bold;width: 190px;margin-top: 5px;"," #xeditor .CodeMirror": "function ($o,form) {\n\t\t\t\t\t\n\t\t\tif (form.data.external && !/^[\\sx]/.test(form.data.external)) return \"background-color:rgba(0,0,0,0.03);opacity: 0.6;\";\n\t\t\telse return \"\";\n\t\t}"},"PlayParser": {"init": "function ($o,form) {\n\t\t\t$o.html('<div><textarea id=\"txt\" disabled=\"disabled\"></textarea></div>')\n\t\t}","ui": {"#txt": "txt"},"style": {" textarea": "line-height:1.4em;font:12px Cousine,'PT Mono', Monaco,monospace;height:400px;overflow:scroll;width:800px; white-space:pre-wrap; word-break: break-all;color: #666!important;opacity: 1!important;"}},"Settings": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML.add(this.Aux).add(this.Buttons));\n\t}","params": {"width": 550},"ui": {"#name": {"bind": "name","check": "function (d,v) {\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\tif (this.RT().getDup(d, v)) return \"Already taken\";\n\t\t\t}","watch": "#folder,#ext"},"#folder": {"bind": "folder","check": "new RegExp(/^[a-z0-9\\-\\.]{0,20}$/i)"},"#ext": {"bind": "ext","check": "new RegExp(/^[a-z0-9\\-]{0,20}$/)"},"#mime": {"bind": "mime","check": "new RegExp(/^[a-z0-9\\-\\.]{1,20}\\/[a-z0-9\\-\\.]{1,20}$/)"},"#external": {"bind": "external","check": "function (d,v) {\n\t\t\t\tif (!/^[x\\s]?(|(http|https|pouch|doc|local|query):\\/\\/[^\\s\\n\\t]+(\\s[\\S]+)?)$/.test(v)) {\n\t\t\t\t\treturn 'External URL or <i>local://doc_id propertyName</i>';\n\t\t\t\t}\n\t\t\t}","css": {"self:tdl": "function (d,v) {return v.to(1)==\"x\" || v.to(1)==\" \"}","self:fs85": "function (d,v) {return v.length>50 && v.length<66}","self:fs70": "function (d,v) {return v.length>65}"}},"input[name=\"snippet\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t}","recalc": "#cache"},"input[name=\"parser\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.parserActive = !!(v+\"\");\n\t\t\t\treturn d.parserActive?[\"parser\"]:[];\n\t\t\t}"},"input[name=\"dropimport\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.dropImport = !!(v+\"\");\n\t\t\t\treturn d.dropImport?[\"dropimport\"]:[];\n\t\t\t}","css": {"hide": "function (d,v) {return !d.external || d.external[0]==' ';}"},"watch": "#external"},"input[name=\"noincludes\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.noIncludes = !!(v+\"\");\n\t\t\t\treturn d.noIncludes?[\"noincludes\"]:[];\n\t\t\t}"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#btn-delitem": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t\n\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t})\n\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t.delay(50);\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}","css": {"self:hide": "function (d) {\n\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t}"},"watch": "#folder,#name"},"#cache": {"init": "function ($o) {\n\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t}","bind": "cache","css": {"hide": "function (d) {return d.snippet}"}}},"HTML": ["<h4 class=\"mb10\">Resource settings</h4>",{"row": "550px","label": "116px","rowCss": "my-row pb10","labelCss": "fs80 gray"},["","<span>","inp#folder.w100",{"plc": "Folder"},"</span> / <span class=\"dib vat w200\">","inp#name.w200",{"plc": "Filename"},"msg.fs80","</span> . ","<span>","inp#ext.w50",{"plc": "Ext"},"</span> :: ","<span class=\"fr\">","inp#mime.w140",{"plc": "MIME"},"</span>"],["Linked to","txt#external.fs90",{"plc": "External resource URL"},"msg.fs80"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"dropimport\" value=\"dropimport\"/>","<span> Do not store imported data in document</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Cache-control","spn#cache.fs85"],{"rowCss": "my-row pb3"},["Mode","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>"," Fragment (no file created)","</label>"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"noincludes\" value=\"noincludes\"/>","<span> Skip includes</span>","</label>"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"parser\" value=\"parser\"/>","<span> Additional parser</span>","</label>"]],"Aux": [],"Buttons": [{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Apply"}," ","btn#btn-cancel",{"val": "Cancel"}," ","btn#btn-delitem.red.fr",{"val": "Delete"}]]}},"Types": {"html": {"name": "HTML","ext": "html","mime": "text/html","primary": true,"stringify": "function (e) { return e.data+\"\" }","defaults": {"data": "<!-- HTML -->\n\n\n"},"extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"htmlmixed\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t}","bind": "data"}}},"replace": {},"manifest": null},"js": {"name": "JS","ext": "js","mime": "text/javascript","stringify": "function (item) { return item.data+\"\"; }","postprocess": "function (item,att) {\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t// compress and uglify \n\t\t\tvar u   = UglifyJS,\n\t\t\t\t\tast = u.parse(att+\"\");\n\t\t\tast.figure_out_scope();\n\t\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\t\tast.figure_out_scope();\n\t\t\t// No char freq opt to avoid \n\t\t\t// different results from the same code\n\t\t\t//ast.compute_char_frequency();\n\t\t\tast.mangle_names();\n\t\t\treturn (item.desc?\"/*\"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\"*/\\n\":\"\") \n\t\t\t\t+ ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>');\n\t\t}\n\t}","defaults": {"data": "/* JS */\n\n\n","Uglify": false},"extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\tmode: \"javascript\",\n\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t});\n\t\t\t\t}","bind": "data"},"#warn": {"delay": 300}},"Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Uglify code</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before uglified code"}]]},"validator": "function (d) {\n\t\t\tvar r, f, s = d.data;\n\t\t\ttry {\n\t\t\t\tf = new Function([], (s.to(1)==\"{\" && s.from(-1)==\"}\"?\"return(\"+s+\");\":s));\n\t\t\t} catch (e) {\n\t\t\t\tr = e.message;\n\t\t\t}\n\t\t\tf = null;\n\t\t\treturn r;\n\t\t}"},"replace": {},"manifest": null},"json": {"name": "JSON","ext": "json","mime": "application/json","stringify": "function (e) { \n\t\t\tvar t;\n\t\t\ttry { \n\t\t\t\tt = eval (\"(\"+e.data+\")\"); \n\t\t\t} catch (err) {}\n\t\t\tif (Object.isObject(t) || Object.isArray(t)) return $.my.tojson(t);\n\t\t\tt=null;\n\t\t\treturn e.data;\n\t\t}","defaults": {"data": "({\n\t/* Put JSON here */\n})"},"extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"javascript\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t}","bind": "data"}},"validator": "function (d) {\n\t\t\t\tvar r, f;\n\t\t\t\ttry {\n\t\t\t\t\t//f = new Function([], \"return \"+d.data+\";\");\n\t\t\t\t\t\n\t\t\t\t\tf = new Function([], \"return \"+d.data+\";\");\n\t\t\t\t\t$.my.tojson(f());\n\t\t\t\t\t\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t\tf=null;\n\t\t\t\treturn r;\n\t\t\t}"},"replace": {},"manifest": null},"css": {"name": "CSS","ext": "css","mime": "text/css","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "/* CSS */"},"extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"css\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t}","bind": "data"}}},"replace": {},"manifest": null},"txt": {"name": "Text","ext": "txt","mime": "text/plain","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "\n\n\n"},"extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"text\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t}","bind": "data"}}},"replace": {},"manifest": null},"attachment": {"name": "File attachment","ext": "","mime": "","stringify": "function (e) { return \"\"}","noInsert": true,"defaults": {},"manifest": {"inherit": ["GetDoc","GetActiveId","RT","Confirm","Items2Atts","Path"],"data": {"id": "","folder": "","name": "","mime": "","parser": "","parserActive": false,"ext": "","cache": "864000","data": "","snippet": false,"size": "?","desc": "","state": {"savedSdbm": "","sdbm": "Z","depends": {},"impacts": {}}},"init": "function ($o,form) {\n\t\t\tvar db, d = form.data,\n\t\t\t\t\tthat = this;\n\t\t\t$o.formgen(this.HTML);\n\t\t\t$o.then(function(){\n\t\t\t\tif (!d.preview && /^image\\//.test(d.mime)) {\n\t\t\t\t\t// generate preview\n\t\t\t\t\tvar path = that.Path(d),\n\t\t\t\t\t\t\tatts = that.GetDoc()._attachments || {},\n\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\trev = that.GetDoc()._rev,\n\t\t\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t\n\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\tvar ico = cw.lib.image($img).resample(120);\n\t\t\t\t\t\tif (ico.height()>120) ico.resample(120 * 120/ico.height())\n\t\t\t\t\t\td.preview = ico.sharpen(0.1).contrast(1.05).jpeg(0.75);\n\t\t\t\t\t\t$o.find(\"#fpic\").trigger(\"recalc\");\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tif (rev) {\n\t\t\t\t\t\tvar att = atts[path];\n\t\t\t\t\t\tif (!att || !att.data) {\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdbatt.image(path).then(function(obj, data){\n\t\t\t\t\t\t\t\t//console.log(id, obj, data)\n\t\t\t\t\t\t\t\t$img.attr(\"src\", obj[path].image);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (att.data.length<1e7) {\n\t\t\t\t\t\t\t$img.attr(\"src\",\"data:\"+att.content_type+\";base64,\"+att.data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t}","ui": {"#fpic": "function (d) {\n\t\t\t\tif (d.preview) return '<img src=\"'+d.preview+'\"/>';\n\t\t\t\telse return \"\";\n\t\t\t}","#fname": {"bind": "function (d) {\n\t\t\t\t\tvar html=\"\", \n\t\t\t\t\t\t\tbase = this.GetSite().site.previewBase, \n\t\t\t\t\t\t\tp = !d.snippet && !!base;\n\t\t\t\t\tif (p) html+='<span class=\"gray fs85 fi-eye\"></span>&nbsp;';\n\n\t\t\t\t\thtml+= (d.folder?'<span class=\"gray\">'+d.folder+\"/</span>\":\"\");\n\n\t\t\t\t\tif (p) {\n\n\t\t\t\t\t\thtml+='<a target=\"_blank\" href=\"'\n\t\t\t\t\t\t\t\t+(base?base.replace(/\\/$/,'')+\"/\":\"\")\n\t\t\t\t\t\t\t\t+(d.folder?d.folder+\"/\":\"\")\n\t\t\t\t\t\t\t\t+d.name+\".\"+d.ext\n\t\t\t\t\t\t\t\t+'\">';\n\t\t\t\t\t}\n\t\t\t\t\thtml+= d.name+\".\"+d.ext;\n\n\t\t\t\t\tif (p) html+='</a>';\n\n\t\t\t\t\treturn html;\n\t\t\t\t}"},"#fmime": {"bind": "mime","watch": "#fname"},"#fsize": {"bind": "function (d) {\n\t\t\t\t\treturn isNaN(d.size)?\"\":(d.size*1)+\" байт\"; \n\t\t\t\t}","watch": "#fname"},"#btn-settings": {"bind": "function (d,v,$o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\t\t\telse $o.modal({\n\t\t\t\t\t\t\tmanifest:$.extend({}, this.Settings, { RT:this.RT }),\n\t\t\t\t\t\t\tdata:Object.select(d, [\"id\",\"folder\",\"mime\",\"size\",\"name\",\"ext\",\"cache\"]),\n\t\t\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t(window.l||cw).note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\twidth:550,\n\t\t\t\t\t\t\talign:\"top:0;right:0\", // nose:\"top\"\n\t\t\t\t\t\t}).then(function(res){\n\t\t\t\t\t\t\t// moveAtt\n\t\t\t\t\t\t\tvar db, \n\t\t\t\t\t\t\t\t\tnold = that.RT().Path(d),\n\t\t\t\t\t\t\t\t\tnnew = that.RT().Path(res),\n\t\t\t\t\t\t\t\t\tdoc = that.RT().data.doc;\n\t\t\t\t\t\t\tif (nold != nnew && doc._attachments) {\t\n\t\t\t\t\t\t\t\tif (doc._attachments[nold].data) {\n\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(doc._attachments[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t// we need to load it\n\t\t\t\t\t\t\t\t\tif (db = that.RT().db) {\n\t\t\t\t\t\t\t\t\t\t// cloudwall.me runtime\n\t\t\t\t\t\t\t\t\t\tdb.att(doc._id).data(nold).then(function(att){\n\t\t\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(att[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse _fin();\n\n\t\t\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}","watch": "#fname"},"#showhideproxy": {"bind": "function (d,v,$o) {\n\t\t\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t\t\t}"},"#btn-download": {"bind": "function (d,v,$o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tvar path = that.RT().Path(d),\n\t\t\t\t\t\t\t\tdoc = that.RT().data.doc,\n\t\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\t\tatt, url=\"\";\n\t\t\t\t\t\tif (doc._attachments && doc._attachments[path] && null!=doc._attachments[path].data) {\n\t\t\t\t\t\t\tatt = doc._attachments[path];\n\t\t\t\t\t\t\t_showModal(att);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// read att\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\tdbatt.data(path).then(function(obj){\n\t\t\t\t\t\t\t\t_showModal(obj[path]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//- - - - - -\n\t\t\t\t\t\n\t\t\t\t\tfunction _showModal(att) {\n\t\t\t\t\t\tvar blob = $.my.f.base642blob(att.data, null, att.content_type),\n\t\t\t\t\t\t\t\turl = URL.createObjectURL(blob);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\tinit:[ \n\t\t\t\t\t\t\t\t\t'<a href=\"'\t+url+'\" '\n\t\t\t\t\t\t\t\t\t+(!/^image\\//.test(att.content_type)\n\t\t\t\t\t\t\t\t\t\t?'download=\"'+that.RT().Path(d).split(\"/\").last()+'\"'\n\t\t\t\t\t\t\t\t\t\t:'')\n\t\t\t\t\t\t\t\t\t+'target=\"_blank\">Click to download</a>' \n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tui:{ 'a':'a' }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:\"p20 tac fs90\",\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.7)\",\n\t\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\t\twidth:150\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}"}},"validator": "function () {}","HTML": ["<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:200px; padding:35px 100px 35px 50px;\">","<div class=\"db epane\">","<div class=\"control\">","<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-download\" title=\"Render\">","<span class=\"fi-shopping-bag\" ></span>","</button></span>","<button class=\"btn button mr0 btn-r\" id=\"btn-settings\"><span class=\"fi-widget\"  title=\"Settings\"></span></button>","</div>","</div>","<div id=\"fpic\" class=\"tac\"></div>","<div id=\"fname\" class=\"fs110 xgray lh120 tac\"></div> ","<div id=\"fmime\" class=\"fs80 gray tac\"></div> ","<div id=\"fsize\" class=\"fs80 gray tac\"></div> ","<div id=\"showhideproxy\"></div>","</div>"],"style": {" .epane": "width: 100px;position: absolute;top: 2px;right: 5px;z-index: +5;"," .control": {"": " font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;"," .button": "padding-bottom: 0.35em;",":hover": "opacity:1"}," .btn": "width:2em; height:2em; border-radius:2em; line-height:2em; vertical-align:middle; text-align:center;padding:0;display:inline-block;"," #fname": "word-wrap: break-word; white-space: pre;margin-top: 0px;"},"Settings": {"init": "function ($o,form) { $o.formgen(this.HTML); }","ui": {"#name": {"bind": "name","check": "function (d,v) {\n\t\t\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\t\t\tif (this.RT().getDup(d, v)) return \"Already taken\";\n\t\t\t\t\t}","watch": "#folder,#ext"},"#folder": {"bind": "folder","check": "new RegExp(/^[a-z0-9\\-]{0,20}$/i)"},"#ext": {"bind": "ext","check": "new RegExp(/^[a-z0-9\\-]{0,20}$/)"},"#mime": {"bind": "mime","check": "new RegExp(/^[a-z0-9\\-]{1,20}\\/[a-z0-9\\-]{1,20}$/)"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t\t\t}"},"#btn-delitem": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\tif (v!=null) {\n\n\t\t\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t\t\t.delay(60);\n\n\t\t\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}","css": {"self:hide": "function (d) {\n\t\t\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t\t\t}"},"watch": "#folder,#name"},"#cache": {"init": "function ($o) {\n\t\t\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t\t\t}","bind": "cache"}},"HTML": ["<h4 class=\"mb10\">Attachment properties</h4>",{"row": "550px","label": "116px","rowCss": "my-row pb10","labelCss": "fs80 gray"},["","<span>","inp#folder.w100",{"plc": "Folder"},"</span> / <span class=\"dib vat w200\">","inp#name.w200",{"plc": "Filename"},"msg.fs80","</span> . ","<span>","inp#ext.w50",{"plc": "Ext"},"</span> :: ","<span>","inp#mime.w140",{"plc": "MIME"},"</span>"],{"rowCss": "my-row pt3 pb10"},["Cache-control","spn#cache.fs85"],{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Save"}," ","btn#btn-cancel",{"val": "Cancel"}," ","btn#btn-delitem.red.fr",{"val": "Delete"}]]}}},"rtf": {"name": "Rich text","ext": "html","mime": "text/html","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "<p><br></p>"},"extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\t$o.redactor({\n\t\t\t\t\t\tminHeight:300,\n\t\t\t\t\t\tbuttons:[\n\t\t\t\t\t\t\t'html','|', 'formatting', 'bold', 'italic', 'fixwidth',\n\t\t\t\t\t\t 'deleted', 'table', 'image',\n\t\t\t\t\t\t 'link', 'fontcolor', 'backcolor', \n\t\t\t\t\t\t 'unorderedlist','outdent', 'indent'\n\t\t\t\t\t\t],\n\t\t\t\t\t\tformattingTags:[\"p\",\"blockquote\",\"pre\",\"h1\",\"h2\",\"h3\",\"h4\"],\n\t\t\t\t\t\tformatting:{\n\t\t\t\t\t\t\t\"code\":{title:\"Fixed\",exec:\"formatblock\",className:\"redactor_format_code\"}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfocus: false\n\t\t\t\t\t});\n\t\t\t\t}","bind": "data"}},"style": {" .epane": "width: 520px;position: absolute;top: -3px;right: 1px;z-index: +5;"," #fname": "word-wrap: break-word; white-space: nowrap; padding: 5px 0;font-weight: bold;width: 465px;margin-top: 5px;text-align:center"}},"replace": {},"manifest": null},"less": {"name": "less","ext": "less","mime": "text/x-less","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "/* LESS */"},"postprocess": "function (item,att) {\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t\n\t\t\tvar ret=\"\";\n\t\t\tless.render(att+\"\", function(err, res){\n\t\t\t\tif (err) {\n\t\t\t\t\tthrow {message:err.message+\", line \"+err.line};\n\t\t\t\t}\n\t\t\t\telse ret = res.css;\n\t\t\t})\n\t\t\treturn (item.desc?\"/* \"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\" */\\n\":\"\")+ret;\n\t\t}\n\t}","extend": {"ui": {"#editor": {"init": "function ($o,form) {\n\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\tmode: \"text/x-less\",\n\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\treadOnly:!!form.data.external && !/^[x\\s]/.test(form.data.external)\n\t\t\t\t\t});\n\t\t\t\t}","bind": "data"}},"Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Compile to CSS</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before compressed code"}]]}},"replace": {},"manifest": null}},"Build": "function (doc0,opts0,$o) {\n\t\n\tvar i,j,that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\ttdoc = doc0 || that.data.doc,\n\t\t\t\n\t\t\topts = $.extend(!0,{ \n\t\t\t\tbuttons:true, \n\t\t\t\tfooter:\"\", \n\t\t\t\tcheckcreds:false,\n\t\t\t\tpick:\"\",\n\t\t\t\tresolve:true,\n\t\t\t\tsilent:false,\n\t\t\t\tblocking:true\n\t\t\t},Object.reject(opts0||{},\"errors\")),\n\t\t\t\n\t\t\terrors = (opts0||{}).errors || {},\n\t\t\tkey,\n\t\t\titems={};\n\t\n\tfor (i=0;i<tdoc.items.length;i++) {\n\t\tif ( !tdoc.items[i].snippet && (j=that.Path(tdoc.items[i])).to(1) != \".\") {\n\t\t\titems[j.from(1)] = tdoc.items[i];\n\t\t}\n\t}\n\t\n\t\n\tif (key = d.doc.creds.crypto) {\n\t\tif (!cw.crypto.has(key)) {\n\t\t\t// cw.lib.note(\"No cryptokey to decode CouchDB credentials.\", \"error\");\n\t\t\tif (opts.checkcreds) pi.reject(\"Can’t get S3 credentials.\");\n\t\t\tthat.creds.s3 = {region:\"\"}\n\t\t} else {\n\t\t\tvar s3 = cw.crypto.dec(d.doc.creds)[\"s3\"];\n\t\t\tif (s3) {\n\t\t\t\tthat.creds.s3 = s3;\n\t\t\t} else {\n\t\t\t\tcw.lib.note(\"Error decoding S3 credentials.\", \"error\");\n\t\t\t\tif (opts.checkcreds) pi.reject(\"Can’t get S3 credentials.\");\n\t\t\t\tthat.creds.s3 = {region:\"\"}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthat.creds.s3 = Object.clone(d.doc.s3, !0);\n\t}\n\t\n\ttry {\n\t\tif (opts.resolve) that.ResolveExternals(tdoc, errors).always(_process);\n\t\telse _process();\n\n\t} catch(e) {\n\t\tpi.reject(\"Error during validation\", e.message, e.stack);\n\t}\n\t\n\treturn pi.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _process (){\n\t\t\tvar a = that.Items2Atts( tdoc,  that.Types,  errors,  opts.pick?opts.pick:true);\n\n\t\t\t//a.result._id = that.creds.s3.region;\n\n\t\t\tif (Object.size(a.err)) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\t\tdata:$.extend(!0, {}, opts,a ),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tscreen:opts.blocking?'rgba(255,255,255,0.5)':false,\n\t\t\t\t\talign:\"top:105%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tbound:10,\n\t\t\t\t\tdrag:!opts.blocking\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\t_result(a);\n\t\t\t\t})\n\t\t\t\t.fail(function(){\n\t\t\t\t\tpi.reject(\"Cancelled\");\n\t\t\t\t});\n\t\t\t} \n\t\t\telse {\n\t\t\t\tif (!opts.silent) cw.lib.note(\"Doc integrity seems to be Ok.\");\n\t\t\t\t_result(a);\n\t\t\t}\n\t\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _result(a){\n\t\tif (a.result) {\n\t\t\tvar att  = a.result._attachments;\n\t\t\t\n\t\t\t// Make it last node of the doc\n\t\t\tdelete a.result._attachments;\n\t\t\ta.result._attachments = att;\n\n\t\t\t//console.log(a);\n\n\t\t\t// load binary atts\n\t\t\tthat.db.get(d.doc._id, {\n\t\t\t\tattachments:true\n\t\t\t})\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tif (res._attachments) for (var i in res._attachments) {\n\t\t\t\t\t\tif (!a.result._attachments[i] || null == a.result._attachments[i].data) {\n\t\t\t\t\t\t\ta.result._attachments[i] = {\n\t\t\t\t\t\t\t\tcontent_type:res._attachments[i].content_type,\n\t\t\t\t\t\t\t\tdata:res._attachments[i].data\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(items[i]) items[i].state.crc = $.my.f.sdbmCode(res._attachments[i].data);\n\t\t\t\t\t};\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t},\n\t\t\t\tfunction(){\n\t\t\t\t\tif (!opts.silent) cw.lib.note(\"Doc is not yet saved, you may need to save doc.\", \"warning\");\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t} // --end _result\n\t\n}","ResolveExternals": "function (doc0,errs) {\n\tvar that = this, \n\t\t\tpis,\n\t\t\tasync,\n\t\t\tpending = {},\n\t\t\trows = (doc0 || that.data.doc).items,\n\t\t\tz = $.Deferred(),\n\t\t\thasErrors = false,\n\t\t\terr = errs || {};\n\t\n\tpis = rows.map(function(e,i){\n\t\tvar s=\"\", id='', \n\t\t\t\tp = e.external, \n\t\t\t\tpi;\n\t\tif (p && !/^[x\\s]/.test(p)) {\n\t\t\tasync = true;\n\t\t\tpi = $.Deferred();\n\t\t\t\n\t\t\t// Local doc\n\t\t\tif (p.startsWith(\"pouch://\") || p.startsWith(\"local://\")) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"pouch \"+id]) pending[\"pouch \"+id] = that.db.get(id, {attachments:true});\n\t\t\t\t\n\t\t\t\tpending[\"pouch \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process local doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load local doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){ pi.reject(\"Failed to load local doc '\"+id+\"'\"); }\n\t\t\t\t);\n\t\t\t}\n      \n      // Local query\n\t\t\telse if (p.startsWith('query://')) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\t\n\t\t\t\t// check if query has db\n\t\t\t\tvar db,\n\t\t\t\t\t\tq = p[0].split(\"/\").to(3);\n\t\t\t\tif (q.length < 2 && q[0]!=='_all_docs') pi.reject('Too short path for query');\n\t\t\t\telse {\n\t\t\t\t\tdb = q[0]=='_all_docs'?cw.db(that.db.name):q.length<3?that.db:cw.db(q[0]);\n\t\t\t\t\tif (db) {\n\t\t\t\t\t\tvar query = q.last(2).join('/'),\n\t\t\t\t\t\t\t\tparams,\n\t\t\t\t\t\t\t\terr;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparams = eval (s?'('+s+')':'');\n\t\t\t\t\t\t\tif (params !== undefined && !Object.isObject(params)) err = 'Params must be an object';\n\t\t\t\t\t\t\telse params = params || {};\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\terr = 'Invalid params for query';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!pending['query '+p.join(' ')]) {\n\t\t\t\t\t\t\t\tpending['query '+p.join(' ')] = query=='_all_docs'?db.allDocs(params):db.query(query, params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpending['query '+p.join(' ')].then(\n\t\t\t\t\t\t\t\tfunction(res) {\n\t\t\t\t\t\t\t\t\tpi.resolve(res.rows);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfunction(){ pi.reject(\"Query '\"+p.join(\" \")+\"' failed\"); }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi.reject(\"PouchDB DB '\"+q[0]+' does not exist' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Local doc, other DB\n\t\t\telse if (p.startsWith(\"doc://\")) {\n\t\t\t\tp = p.from(6).split(/\\s+/).compact(true);\n\t\t\t\t\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tvar dbid = id.split(\"/\",1)[0];\n\t\t\t\tid = id.from(dbid.length+1);\n\t\t\t\t\n\t\t\t\tif (cw.db(dbid)) {\n\t\t\t\t\n\t\t\t\t\tif (!pending[\"doc \"+p[0]]) {\n\t\t\t\t\t\tpending[\"doc \"+p[0]] = cw.db(dbid).get(id, {attachments:true});\n\t\t\t\t\t}\n\n\t\t\t\t\tpending[\"doc \"+p[0]].then(\n\t\t\t\t\t\tfunction(doc) {\n\n\t\t\t\t\t\t\tif (!doc) {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse if (s) {\n\t\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\t\tif (r) pi.resolve(r);\n\t\t\t\t\t\t\t\telse pi.reject(\"Failed to process PouchDB doc '\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t +p[0]+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.resolve(doc);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\"); }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tpi.reject(\"PouchDB DB '\"+dbid+' does not exist' );\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// External request\n\t\t\telse if (/^http[s]?:\\/\\//.test(p)) {\n\t\t\t\tp = p.split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"url \"+id]) {\n\t\t\t\t\t\n\t\t\t\t\tif ('https:'==window.location.protocol && !id.startsWith(window.location.protocol)) {\n\t\t\t\t\t\tpending[\"url \"+id] = $.Deferred().reject('forbidden protocol').promise();\n\t\t\t\t\t}\n\t\t\t\t\telse pending[\"url \"+id] = $.ajax({\n\t\t\t\t\t\turl:id,\n\t\t\t\t\t\tcache:false,\n\t\t\t\t\t\ttype:\"GET\",\n\t\t\t\t\t\tdataType:s?\"json\":\"text\",\n\t\t\t\t\t\txhrFields:{withCredentials:/^https/.test(id)}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpending[\"url \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tvar json, r;\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tif (!Object.isObject(doc) && !Object.isArray(doc)) {\n\t\t\t\t\t\t\t\ttry { doc = JSON.parse(doc) } catch (e) { }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tr = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process external doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load external doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){ pi.reject(\"Failed to load external doc '\"+id+\"'\"); }\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t// Unknown, reject\n\t\t\telse {\n\t\t\t\tpi.reject(\"Failed to load resource \"+id+', protocol is unknown.');\n\t\t\t}\n\t\t\t\n\t\t\treturn pi.promise();\n\t\t\t\n\t\t} else {\n\t\t\treturn e.data;\n\t\t}\n\t});\n\t\n\t\n\n\tif (!async) z.resolve();\n\telse {\n\t\tQ.allSettled(pis)\n\t\t.then(\n\t\t\tfunction(reps){\n\t\t\t\treps.forEach(function(e,i){\n\t\t\t\t\t\n\t\t\t\t\tvar d = rows[i], aname = that.Path(d);\n\t\t\t\t\t\n\t\t\t\t\tif (e.state ===\"fulfilled\") {\n\t\t\t\t\t\tif (Object.isString(e.value)) {\n\t\t\t\t\t\t\trows[i].data = e.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (Object.isObject(e.value) && rows[i].ext=='js') {\n\n\t\t\t\t\t\t\t\trows[i].data = cw.lib.js2txt(cw.lib.unjson(e.value),'\\t');\n\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trows[i].data = JSON.stringify(e.value,null,'\\t');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// error\n\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t_e(aname, e.reason);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\tif (!hasErrors) z.resolve();\n\t\t\t\telse z.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t},\n\t\t\tfunction(e){\n\t\t\t\tz.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t}\n\t\t)\n\t}\n\t\n\treturn z.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n}","Items2Atts": "function (doc0,Types,prevErrors,pick0,depsOnly) {\n\tvar that=this, \n\t\t\ti, j, e, item, \n\t\t\tdoc = doc0 || that.data.doc,\n\t\t\tbuildAll = !!pick0,\n\t\t\tpick = Object.isString(pick0)?pick0:\"\",\n\t\t\tt = Types || that.Types, \n\t\t\tnames = {}, \n\t\t\tdirty = {},\n\t\t\taname=\"\", \n\t\t\ta={}, sn={}, pp={}, src = {}, fin = {}, \n\t\t\terr = prevErrors || {},\n\t\t\tincls = {}, \n\t\t\tfvalidator = null, isinvalid = null,\n\t\t\tz={\n\t\t\t\tname:doc.name,\n\t\t\t\t_attachments:{}\n\t\t\t};\n\t\n\tif (doc.site && doc.site.previewBase) z = doc;\n\t\n\tif (!z._attachments) z._attachments = {};\n\t\n\t// gen work structs\n\tfor (i=0;i<doc.items.length;i++) {\n\t\te = doc.items[i];\n\t\tif (e) {\n\t\t\taname = that.Path(e);\n\t\t\tnames[aname]=true;\n\t\t\tsn[aname]=e.snippet;\n\t\t\tsrc[aname]=doc.items[i];\n\t\t\tif (Object.isFunction(t[e.type].postprocess)) pp[aname] = t[e.type].postprocess;\n\t\t}\n\t}\n\t\n\t\n\t// stringify\n\tfor (i in names) {\n\t\tif (names.hasOwnProperty(i)) {\n\t\t\t_convert (i);\n\t\t}\n\t}\n\n\t\n\t// Resolves include directives.\n\t// Possible syntaxes are:\n\t// {{res.name}} \t\t\t– inserts as is\n\t// {/*{{res.name}}*/} – inserts as is\n\t// [/*{{res.name}}*/] – inserts as is\n\t// \"{{res.name}}\" \t\t– inserts stringified version\n\t\n\t// parse includes\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) {\n\t\t\t_parseIncludes (i);\n\t\t}\n\t}\n\t\n\t// merge snippets deps into files \n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\tvar tmp = {};\n\t\t\tfor (j in e.state.depends) \n\t\t\t\tif (sn[j] && src[j].state.depends) \n\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t$.extend(e.state.depends, tmp);\n\t\t}\n\t}\n\t\n\t// merge files deps into files \n\tvar tmp = {};\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\tif (e) {\n\t\t\t\ttmp = {};\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j) && a[j] && !sn[j] && src[j].state.depends) {\n\t\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$.extend(e.state.depends, tmp);\n\t\t\t}\n\t\t}\n\t}\n\t\t\n\t// build impacts (reverse deps)\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) {\n\t\t\te = src[i];\n\t\t\tif (e) {\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j)) {\n\t\t\t\t\t\tif (src[j]) src[j].state.impacts[i] = true;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t//console.log(\"Missing include \"+j+\" in \"+i);\n\t\t\t\t\t\t\t_e(i, \"Missing include '\"+j+\"'\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif (depsOnly) return {\n\t\terr: err,\n\t\tdoc:doc\n\t};\n\t\t\n\t// build list of items to be updated\n\tvar imps = {};\n\tfor (i in a){\n\t\tif (a.hasOwnProperty(i) && (!pick || i === pick)) {\n\t\t\te = src[i];\n\t\t\tif (!!buildAll || e.state.sdbm !== e.state.savedSdbm) {\n\t\t\t\t$.extend (true, imps, e.state.impacts);\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t// add dependees to dirty list, \n\t// they also need to be updated\n\tfor (i in imps) {\n\t\tif (imps.hasOwnProperty(i)) {\n\t\t\te = src[i];\n\t\t\tif (e) {\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tconsole.log(\"Dirties wired to rebuild: \", dirty);\n\t\n\t// build snippets\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && sn[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving snippet include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\n\t// build files\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !sn[i] && src[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving file include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// validate finalized versions\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !sn[i] && !err[i] && src[i]) {\n\t\t\tfvalidator = null;\n\t\t\tisinvalid = null;\n\t\t\ttry {\n\t\t\t\tfvalidator = (t[src[i].type].manifest || t[src[i].type].extend || {}).validator;\n\t\t\t\tif (Object.isFunction(fvalidator)) {\n\t\t\t\t\tisinvalid = fvalidator ({data:fin[i]});\n\t\t\t\t}\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Final result is not of type '\"+src[i].type+\"': \"+er.message);\n\t\t\t}\n\t\t\tif (isinvalid != null) _e(i, \"Final result is not of type '\"+src[i].type+\"': \"+isinvalid);\n\t\t}\n\t}\n\t\n\n\t// build attachments\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && (!sn[i] || i === pick) && !err[i] && src[i]) {\n\t\t\ttry {\n\t\t\t\ta[i].data = $.my.f.base64(fin[i], false, false);\n\t\t\t\tz._attachments[i] = a[i];\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Attach was not updated, error: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar process={};\n\tfor (i in src) {\n\t\tif (src.hasOwnProperty(i)) {\n      if (src[i].dropImport && src[i].external && src[i].external[0]!=' ') {\n      \tsrc[i].data = '// This branch has no visible data\\n// since ‘Do not store imported data in document’\\n// option is set for the branch';\n      }\n\t\t\tif (\n\t\t\t\tsrc[i].type === \"attachment\"\n\t\t\t\t&& src[i].state.sdbm !== src[i].state.savedSdbm\n\t\t\t\t&& (!pick || i===pick)\n\t\t\t) {\n\t\t\t\tprocess[i] = true;\n\t\t\t\t// May be we have not yet saved attaches\n\t\t\t\tif (doc._attachments && doc._attachments[i] && doc._attachments[i].data) {\n\t\t\t\t\tz._attachments[i] = {\n\t\t\t\t\t\tcontent_type:doc._attachments[i].content_type,\n\t\t\t\t\t\tdata:doc._attachments[i].data\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!sn[i] && dirty[i] && !err[i]) process[i] = true;\n\t\t}\n\t}\n\t\n\treturn {\n\t\terr:err,\n\t\tdirty: dirty,\n\t\tdoc:doc,\n\t\tupload:process,\n\t\tresult:z\n\t};\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _parseIncludes (iname) {\n\t\tvar reSnippet = \n\t\t/([\\{\\[]\\/\\*\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\\*\\/[\\}\\]])|(\"\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\")|(\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\})/gi,\n\t\t\t\ti = iname, deps,\n\t\t\t\tj, re, idx, str, \n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tdeps = src[i].state.depends={};\n\t\tif (incl && !src[i].noIncludes) {\t\t\n\t\t\tincls[i] = incl.slice(0);\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9\\-\\.\\/]/gi,\"\");\n\t\t\t\tdeps[idx] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _resolveIncludes (iname) {\n\t\tvar i = iname, \n\t\t\t\tj, re, idx, str, \n\t\t\t\treSnippet = \n\t\t/([\\{\\[]\\/\\*\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\\*\\/[\\}\\]])|(\"\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\")|(\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\})/gi,\n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tfin[i] = a[i].data;\n\t\tif (incl) {\t\t\t\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9\\-\\.\\/]/gi,\"\");\n\t\t\t\tre = new RegExp(RegExp.escape(incl[j]), 'g');\n\t\t\t\tif (idx === i) fin[i] = fin[i].replace(re,\"\");\n\t\t\t\telse if (a[idx]) {\n\t\t\t\t\tstr = fin[idx]||a[idx].data;\n\t\t\t\t\tif (incl[j].to(1) === '\"' && incl[j].from(-1) ==='\"') str = JSON.stringify(str);\n\t\t\t\t\tfin[i] = fin[i].split(re).join(str);\n\t\t\t\t} \n\t\t\t\t//else fin[i] = fin[i].replace(re,\"\");\n\t\t\t}\n\t\t}\n\t\t// post-process\n\t\tif (pp[i]) {\n\t\t\ttry { fin[i] = pp[i](src[i], fin[i]);  }\n\t\t\tcatch (e) {\n\t\t\t\t_e(i, \"Post-processor error: \"+e.message);\n\t\t\t\t//console.log(e.message, e.stack, e);\n\t\t\t\t//window.M = fin[i];\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _convert (iname) {\n\t\tvar it=src[iname], att,\n\t\t\t\tparser, eparser;\n\t\t\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\t// Item\t\t\t\n\t\t\tif(it.parserActive) {\n\t\t\t\ttry { \n\t\t\t\t\tparser = eval(it.parser); \n\t\t\t\t} catch (e){ \n\t\t\t\t\tparser = null; \n\t\t\t\t\teparser = e.message;\n\t\t\t\t}\n\t\t\t\tif (!Object.isFunction(parser)) {\n\t\t\t\t\t_e (iname, \"Invalid custom parser: \"+eparser);\n\t\t\t\t\tparser = t[it.type].stringify;\n\t\t\t\t}\n\t\t\t} \n\t\t\telse parser = t[it.type].stringify;\n\t\t\n\t\t\ttry {\n\t\t\t\tatt = {\n\t\t\t\t\tcontent_type:it.mime||t[it.type].mime,\n\t\t\t\t\tdata:parser(it, doc._attachments, doc)+\"\"\n\t\t\t\t};\n\t\t\t} catch(e) {\n\t\t\t\tif (it.parserActive) _e(iname, \"Custom parser failed: \"+e.message);\n\t\t\t\telse _e(iname,\"Error parsing data: \"+e.message);\n\t\t\t}\n\t\t\tif (att ) {\n\t\t\t\ta[iname] = att;\n\t\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t// We have attachment\n\t\t\tif (doc._attachments && (att = doc._attachments[iname])) {\n\t\t\t\tif (att.digest) it.state.sdbm = $.my.f.sdbmCode(att.digest);\n\t\t\t} else {\n\t\t\t\tit.state.sdbm = \"Z\";\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n}","Upload": "function (doc,$root,opts) {\n\tAWS.config.update(this.creds.s3);\n\tvar i, j, that = this,\n\t\t\tuploadList = opts.upload,\n\t\t\tz = opts.result,\n\t\t\ts3 = new AWS.S3({params: {Bucket: doc.site.s3bucket}}),\n\t\t\t_gzip = that.gzip,\n\t\t\ttotalSize = 0,\n\t\t\tsendAtt = {},\n\t\t\t$cs = $root.find(\"#counter-size\"),\n\t\t\titems = {},\n\t\t\tres; \n\n\t// cache items\n\tfor (i=0;i<doc.items.length;i++) {\n\t\tj = doc.items[i];\n\t\titems[that.Path(j)] = doc.items[i];\n\t}\n\t\n\tres = PushToBucket(doc, function(total, send){\n\t\ttotalSize = total;\n\t\tsendAtt = send;\n\t\t$cs.trigger('upload');\n\t});\n\t\n\t// section to animate downloading\n\t// spinning circle\n\tsetTimeout(function () {\n\t\tif (res.state() === \"pending\") $root.addClass('my-app-busy');\n\t}, 100);\n\n\t// size counter\n\tsetTimeout(function () {\n\t\tif (res.state() === \"pending\") {$root.addClass('my-app-busy-high');$cs.html(\"\");}\n\t}, 200);\n\n\t// remove block from app after upload\n\tres.always(function () {\n\t\t$root.removeClass('my-app-busy my-app-busy-high');\n\t\t$root.find('#counter-size').off('.upload');\n\t});\n\n\t// handler for uploading status\n\t$cs.on('upload', function () {\n\t\tvar loadedSize = 0;\n\t\tObject.keys(sendAtt).forEach(function (e) {\n\t\t\tloadedSize += sendAtt[e];\n\t\t});\n\t\tif (loadedSize > 5120 && totalSize > loadedSize) $(this).html(loadedSize.bytes(2) + ' / ' + totalSize.bytes(2));\n\t}.debounce(50));\n\n\treturn res.promise();\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction PushToBucket (doc, onProgress) {\n\t\tvar dfd = $.Deferred(),\n\t\t\t\tlen = Object.size(uploadList || doc._attachments || {}),\n\t\t\t\tprefix = doc.site.s3folder?doc.site.s3folder.replace(/\\/$/,'')+\"/\":\"\",\n\t\t\t\tctr = 0, // counter for resolving $.Deferred\n\t\t\t\ttotal = 0, // total size uploaded files\n\t\t\t\tsend = {}, // object for updating file upload size\n\t\t\t\tlog = {},\n\t\t\t\tfunc = {\n\t\t\t\t\tonProgress: function (load, name) {\n\t\t\t\t\t\tsend[name] = load;\n\t\t\t\t\t\tif (onProgress) onProgress(total, send);\n\t\t\t\t\t},\n\t\t\t\t\tonDone: function (len, name) {\n\t\t\t\t\t\tif (len) send[name] = len;\n\t\t\t\t\t\tif (onProgress) onProgress(total, send);\n\t\t\t\t\t},\n\t\t\t\t\tonError: function (name) {\n\t\t\t\t\t\tvar idx = name.from(prefix.length);\n\t\t\t\t\t\tlog[idx] = \"Upload failed\";\n\t\t\t\t\t\tif (items[idx]) items[idx].state.savedSdbm = \"\";\n\t\t\t\t\t\tdfd.notify('Unable to upload file ' + name + '');\n\t\t\t\t\t\tdfd.reject(log);\n\t\t\t\t\t},\n\t\t\t\t\tonSuccess: function (name) {\n\t\t\t\t\t\tvar i, idx = name.from(prefix.length);\n\t\t\t\t\t\tlog[idx] = true;\n\t\t\t\t\t\tif (items[idx]) items[idx].state.savedSdbm = items[idx].state.sdbm;\n\t\t\t\t\t\tdfd.notify('File ' + name + ' uploaded succesfully.');\n\t\t\t\t\t\tif (++ctr == len) {\n\t\t\t\t\t\t\tconsole.log(log);\n\t\t\t\t\t\t\t// mark snippets as succeded\n\t\t\t\t\t\t\tfor (i in items) {\n\t\t\t\t\t\t\t\tif (items[i].snippet) items[i].state.savedSdbm = items[i].state.sdbm;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdfd.resolve(log);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\n\t\t// we need to determine in what environment we are\n\t\tif (!window.l && window.cw) {\n\t\t\t\n\t\t\tObject.keys(uploadList || z._attachments).forEach(function (e) {\n\t\t\t\tconsole.log(prefix + e);\n\t\t\t\tvar params = {\n\t\t\t\t\tname: prefix + e,\n\t\t\t\t\tcontent_type: z._attachments[e].content_type,\n\t\t\t\t\tbody: z._attachments[e].data,\n\t\t\t\t\tlength: z._attachments[e].data.length/4*3,\n\t\t\t\t\ttype: \"base64\",\n\t\t\t\t\tgzip: !/(jp[e]?g|png|zip|gif|rar|pdf)$/.test(e),\n\t\t\t\t\tcache:items[e].cache||\"\"\n\t\t\t\t};\n\t\t\t\tif (z._attachments[e].length || z._attachments[e].size) {\n\t\t\t\t\tparams.length = z._attachments[e].length || z._attachments[e].size;\n\t\t\t\t}\n\t\t\t\ttotal += params.length;\n\t\t\t\tUploadToS3(PrepareToUpload(params), s3, func)\n\t\t\t});\n\t\t} else {\n\t\t\tObject.keys(uploadList || z._attachments).forEach(function (e) {\n\t\t\t\tvar wl = window.location,\n\t\t\t\t\t\tdb = that.Db,\n\t\t\t\t\t\tloc = wl.protocol + '//' + wl.hostname + '/x/' + db + '/' + doc._id + '/' + e;\n\n\t\t\t\ttotal += z._attachments[e].length * 2;\n\t\t\t\tGetBlob(loc,\n\t\t\t\t{\n\t\t\t\t\tonProgress: function (load) {\n\t\t\t\t\t\tsend[e + \"send\"] = load;\n\t\t\t\t\t\tif (onProgress) onProgress(total, send);\n\t\t\t\t\t}\n\t\t\t\t}, \n\t\t\t\tfunction (body, gzipped) {\n\t\t\t\t\tUploadToS3(PrepareToUpload({\n\t\t\t\t\t\tname: prefix + e,\n\t\t\t\t\t\tcontent_type: z._attachments[e].content_type,\n\t\t\t\t\t\tlength: z._attachments[e].length,\n\t\t\t\t\t\tbody: body,\n\t\t\t\t\t\ttype: \"u8array\",\n\t\t\t\t\t\tgzip: gzipped,\n\t\t\t\t\t\tcache:items[e].cache||\"\"\n\t\t\t\t\t}), s3, func)\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn dfd;\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction PrepareToUpload (params) {\n\t\tvar obj = {\n\t\t\tKey: params.name,\n\t\t\tACL: 'public-read',\n\t\t\tContentType: params.content_type\n\t\t};\n\t\t\n\t\tif (params.cache+\"\" != \"\") obj.CacheControl = \"max-age=\"+params.cache;\n\t\t\n\t\tif (params.length) obj.ContentLength = params.length;\n\t\tif (params.type === \"base64\") {\n\t\t\tif (params.gzip) params.body = _gzip.base64(params.body);\n\t\t\telse $.my.f.base642blob(params.body,function(b){params.body=b});\n\t\t} \n\t\telse if (params.type === \"u8array\" ) {\n\t\t\tif (params.gzip) params.body = _gzip.u8array(new Uint8Array(params.body));\n\t\t}\n\t\tobj.Body = params.body;\n\t\tif (params.gzip) obj.ContentEncoding = \"gzip\";\n\t\treturn obj;\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - \n\t\n\tfunction UploadToS3 (params, s3, func) {\n\t\tvar req = s3.putObject(params,function(err){\n\t\t\tif (err) {\n\t\t\t\tif (func.onError) func.onError(params.Key);\n\t\t\t} else {\n\t\t\t\tif (func.onSuccess) func.onSuccess(params.Key);\n\t\t\t}\n\t\t});\n\t\tif (func.onProgress) req.on('httpUploadProgress',function(pr,res){\n\t\t\tfunc.onProgress(pr.loaded, params.Key);\n\t\t});\n\t\tif (func.onDone) req.on('httpDone',function(){\n\t\t\tfunc.onDone(params.ContentLength, params.Key);\n\t\t});\n\t}\n\t\n\t// - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction GetBlob (url, params, callback) {\n\t\tif (!params.notGzip) var gzipped = !/(jp[e]?g|png|gif|zip|rar|pdf)$/.test(url);\n\n\t\tvar oReq = new XMLHttpRequest();\n\t\toReq.open(\"GET\", url, true);\n\t\tif (params.onProgress) oReq.onprogress = function(e) {\n\t\t\tparams.onProgress(e.loaded);\n\t\t};\n\t\tif (!gzipped) oReq.responseType = \"blob\";\n\t\telse oReq.responseType = \"arraybuffer\";\n\t\toReq.onload = function() {\n\t\t\tcallback(oReq.response, gzipped);\n\t\t};\n\t\toReq.send();\n\t}\n\t\n}","Tar": {"Tar": "function () {\n\t\n\t\t// Tar implementation\n\t\t// https://github.com/beatgammit/tar-js\n\n\t\tvar header = _header(),\n\t\t\tutils = _utils(),\n\t\t\trecordSize = 512,\n\t\t\tblockSize;\n\n\t\tfunction Tar(recordsPerBlock) {\n\t\t\tthis.written = 0;\n\t\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t}\n\n\t\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\t\tvar data,\n\t\t\t\tchecksum,\n\t\t\t\tmode,\n\t\t\t\tmtime,\n\t\t\t\tuid,\n\t\t\t\tgid,\n\t\t\t\theaderArr;\n\n\t\t\tif (typeof input === 'string') {\n\t\t\t\tinput = utils.stringToUint8(input);\n\t\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t\t}\n\n\t\t\tif (typeof opts === 'function') {\n\t\t\t\tcallback = opts;\n\t\t\t\topts = {};\n\t\t\t}\n\n\t\t\topts = opts || {};\n\n\t\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\t\tuid = opts.uid || 0;\n\t\t\tgid = opts.gid || 0;\n\n\t\t\tdata = {\n\t\t\t\tfileName: filepath,\n\t\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\t\tuid: utils.pad(uid, 7),\n\t\t\t\tgid: utils.pad(gid, 7),\n\t\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\t\tchecksum: '        ',\n\t\t\t\ttype: '0', // just a file\n\t\t\t\tustar: 'ustar  ',\n\t\t\t\towner: opts.owner || '',\n\t\t\t\tgroup: opts.group || ''\n\t\t\t};\n\n\t\t\t// calculate the checksum\n\t\t\tchecksum = 0;\n\t\t\tObject.keys(data).forEach(function (key) {\n\t\t\t\tvar i, value = data[key], length;\n\n\t\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\t\theaderArr = header.format(data);\n\n\t\t\tvar i, offset, length;\n\n\t\t\tthis.out.set(headerArr, this.written);\n\n\t\t\tthis.written += headerArr.length;\n\n\t\t\t// If there is not enough space in this.out, we need to expand it to\n\t\t\t// fit the new input.\n\t\t\tif (this.written + input.length > this.out.length) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, input.length, blockSize);\n\t\t\t}\n\n\t\t\tthis.out.set(input, this.written);\n\n\t\t\t// to the nearest multiple of recordSize\n\t\t\tthis.written += input.length + (recordSize - (input.length % recordSize || recordSize));\n\n\t\t\t// make sure there's at least 2 empty records worth of extra space\n\t\t\tif (this.out.length - this.written < recordSize * 2) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, recordSize * 2, blockSize);\n\t\t\t}\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(this.out);\n\t\t\t}\n\n\t\t\treturn this.out;\n\t\t};\n\n\t\tTar.prototype.clear = function () {\n\t\t\tthis.written = 0;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t};\n\n\t\treturn Tar;\n\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\t\t// HEADER\n\n\t\tfunction _header () {\n\n\t\t/*\n\t\tstruct posix_header {             // byte offset\n\t\t\tchar name[100];               //   0\n\t\t\tchar mode[8];                 // 100\n\t\t\tchar uid[8];                  // 108\n\t\t\tchar gid[8];                  // 116\n\t\t\tchar size[12];                // 124\n\t\t\tchar mtime[12];               // 136\n\t\t\tchar chksum[8];               // 148\n\t\t\tchar typeflag;                // 156\n\t\t\tchar linkname[100];           // 157\n\t\t\tchar magic[6];                // 257\n\t\t\tchar version[2];              // 263\n\t\t\tchar uname[32];               // 265\n\t\t\tchar gname[32];               // 297\n\t\t\tchar devmajor[8];             // 329\n\t\t\tchar devminor[8];             // 337\n\t\t\tchar prefix[155];             // 345\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 500\n\t\t};\n\t\t*/\n\n\t\t\tvar utils = _utils(),\n\t\t\t\theaderFormat;\n\n\t\t\theaderFormat = [\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileMode',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'uid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'gid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileSize',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'mtime',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'checksum',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'type',\n\t\t\t\t\t'length': 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'linkName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'ustar',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'owner',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'group',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'majorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'minorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'filenamePrefix',\n\t\t\t\t\t'length': 155\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'padding',\n\t\t\t\t\t'length': 12\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tfunction formatHeader(data, cb) {\n\t\t\t\tvar buffer = utils.clean(512),\n\t\t\t\t\toffset = 0;\n\n\t\t\t\theaderFormat.forEach(function (value) {\n\t\t\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\t\t\ti, length;\n\n\t\t\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\t\t\toffset += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset += value.length - i; // space it out with nulls\n\t\t\t\t});\n\n\t\t\t\tif (typeof cb === 'function') {\n\t\t\t\t\treturn cb(buffer, offset);\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstructure:headerFormat,\n\t\t\t\tformat:formatHeader\n\t\t\t};\n\t\t}\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\n\t\t// UTILS\n\n\t\tfunction _utils () {\n\n\t\t\tvar lookup = [\n\t\t\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t\t\t];\n\t\t\tfunction clean(length) {\n\t\t\t\tvar i, buffer = new Uint8Array(length);\n\t\t\t\tfor (i = 0; i < length; i += 1) {\n\t\t\t\t\tbuffer[i] = 0;\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction extend(orig, length, addLength, multipleOf) {\n\t\t\t\tvar newSize = length + addLength,\n\t\t\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\t\t\tbuffer.set(orig);\n\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction pad(num, bytes, base) {\n\t\t\t\tnum = num.toString(base || 8);\n\t\t\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t\t\t}\t\n\n\t\t\tfunction stringToUint8 (input, out, offset) {\n\t\t\t\tvar i, length;\n\n\t\t\t\tout = out || clean(input.length);\n\n\t\t\t\toffset = offset || 0;\n\t\t\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\t\t\toffset += 1;\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction uint8ToBase64(uint8) {\n\t\t\t\tvar i,\n\t\t\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\t\t\toutput = \"\",\n\t\t\t\t\ttemp, length;\n\n\t\t\t\tfunction tripletToBase64 (num) {\n\t\t\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t\t\t};\n\n\t\t\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\t\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\t\t\toutput += tripletToBase64(temp);\n\t\t\t\t}\n\n\t\t\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\t\t\tswitch (output.length % 4) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\toutput += '=';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\toutput += '==';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tclean:clean,\n\t\t\t\tpad:pad,\n\t\t\t\textend:extend,\n\t\t\t\tstringToUint8:stringToUint8,\n\t\t\t\tuint8ToBase64:uint8ToBase64\n\t\t\t};\n\t\t}\n\t}","Bytes": "function (input) {\n\t\tvar binary = window.atob(input),\n\t\t\t\ti=0, len = binary.length,\n\t\t\t\tbuffer = new ArrayBuffer(len),\n\t\t\t\tview = new Uint8Array(buffer);\n\t\tfor (i; i<len;i++) view[i] = binary.charCodeAt(i);\n\t\treturn view;\n\t}"},"Gzip": "function () {\n\n\tvar U8A = window.Uint8Array ? Uint8Array : Array,\n\t\t\tBASE64_MARKER = ';base64,',\n\t\t\tBASE64_MARKER_L = BASE64_MARKER.length;\n\n\tfunction stringToByteArray(str) {\n\t\tvar i = 0, max = str.length, array = new Array(max);\n\t\twhile(i < max) array[i] = str.charCodeAt(i++) & 0xFF;\n\t\treturn new U8A(array);\n\t}\n\n\tfunction base64ToByteArray(dataURI) {\n\t\tvar base64Pos = dataURI.indexOf(BASE64_MARKER),\n\t\t\t\tbase64Index = base64Pos != -1 ? base64Pos + BASE64_MARKER_L : 0,\n\t\t\t\tbase64 = dataURI.substring(base64Index),\n\t\t\t\traw = window.atob(base64),\n\t\t\t\trawLength = raw.length,\n\t\t\t\tarray = new Array(rawLength),\n\t\t\t\ti = 0;\n\t\twhile(i < rawLength) array[i] = raw.charCodeAt(i++);\n\t\treturn new U8A(array);\n\t}\n\n\tfunction toGzip(data) {\n\t\tif(!data) {\n\t\t\tconsole.log('No data to gzip!');\n\t\t\treturn null;\n\t\t}\n\t\treturn new Blob([\n\t\t\tnew Zlib.Gzip(data).compress()\n\t\t]);\n\t}\n\n\treturn {\n\t\t'string': function(text) {\n\t\t\tif(!text || !text.length) {\n\t\t\t\tconsole.log('No text to gzip!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn toGzip(stringToByteArray(text));\n\t\t},\n\t\t'u8array': function(array) {\n\t\t\tif(!array || !array.length) {\n\t\t\t\tconsole.log('No u8array to gzip!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn toGzip(array);\n\t\t},\n\t\t'base64': function(base64) {\n\t\t\tif(!base64 || !base64.length) {\n\t\t\t\tconsole.log('No base64 to gzip!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t//console.log(base64);\n\t\t\treturn toGzip(base64ToByteArray(base64));\n\t\t}\n\t}\n\n}","CleanAtts": "function (doc) {\n\tvar that = this,\n\t\t\ta = Object.keys(doc._attachments||{}),\n\t\t\tb = doc.items,\n\t\t\tids = {};\n\tif (!a || !a.length) return doc;\n\t\n\tb.forEach(function(e){ \n\t\tif (e.type===\"attachment\") ids[that.Path(e)] = true; \n\t});\n\t\n\ta.forEach(function(i){\n\t\tif (!ids[i])  delete doc._attachments[i];\n\t});\n\treturn true;\n\t\n}","MergeAtts": "function (doc,ext) {\n\t// Compares atts of ext with doc,\n\t// adds missing\n\t\n\tif (ext._attachments)\n\t\n\tvar a = doc._attachments,\n\t\t\tb = ext._attachments;\n\t\n\tif (!b || !Object.size(b)) return doc;\n\t\n\tif (!a) a = doc._attachments = {};\n\t\n\tObject.keys(b).forEach(function(i){\n\t\t\n\t\tif (b[i].data) {\n\t\t\ta[i] = {\n\t\t\t\tcontent_type:b[i].content_type,\n\t\t\t\tdata:b[i].data\n\t\t\t};\n\t\t}\n\t\n\t});\n\t\n}","GetSettings": "function (section) {\n\tvar that = this,\n\t\t\tkey,\n\t\t\td = that.data;\n\t// Decode / prepare creds\n\tif ( cw.crypto && (key = d.doc.creds.crypto)) {\n\t\tif (!cw.crypto.has(key)) {\n\t\t\treturn {  };\n\t\t} else {\n\t\t\tvar obj = cw.crypto.dec(d.doc.creds)[section || \"s3\"];\n\t\t\tif (obj) {\n\t\t\t\treturn obj;\n\t\t\t} else {\n\t\t\t\treturn {  };\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn Object.clone(d.doc[section || \"s3\"], !0);\n\t}\n}","ParseJS": "function (s,clean) {\n\t\n\tvar g=s,\n\t\t\tu = UglifyJS, \n\t\t\tast,\n\t\t\tres ={\n\t\t\t\tglobals:[],\n\t\t\t\terrors:[]\n\t\t\t},\n\t\t\tgl;\n\ttry{\n\t\tast = u.parse(s+\"\");\n\t} catch (e) {\n\t\tres.errors.push (e.message+\" @\"+e.line+\":\"+e.col)\n\t}\n\tif (ast) {\n\t\tast.figure_out_scope();\n\t\tif (Object.isObject(gl = ast.globals) && gl._size) {\n\t\t\tObject.keys(gl._values)\n\t\t\t.forEach(function(i){\n\t\t\t\tres.globals.push(gl._values[i].name);\n\t\t\t});\n\t\t\tres.globals.sort();\n\t\t\tif (clean) {\n\t\t\t\tres.globals = [].remove.apply(\n\t\t\t\t\tres.globals,\n\t\t\t\t\t(\"String Function Date Math Number Object Array RegExp isNaN undefined parseInt parseFloat \"\n\t\t\t\t\t\t+\"isFinite\").split(\" \")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n}","HTML": "<div id=\"sysload\"><img src=\"http://cdn.cloudwall.me/0.9/i/loader66.gif\"><div id=\"counter-size\"></div></div>\n<div id=\"nav\" class=\"-pt5 -pb5 -bts -bbd mb10 fs100 my-row \">\n\t<div class=\"fr fs85\">\n\t\t<input type=\"button\" style=\"\" class=\" tac mr5 green w100\" txt=\"\" value=\"Save\" id=\"btn-save\"><input \n\t\ttype=\"button\" style=\"\" class=\" tac w100\" txt=\"\" value=\"Close\" id=\"btn-close\"></div>\n\t\n\t<h3 id=\"sname\" class=\"dib vat mt1 mb5 w200 mr10 fs130\"\n\t\t\tstyle=\"white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\"></h3><span class=\"fs80\"\n\t><button style=\"\" class=\" tac btn-l mr2 button\" id=\"btn-params\"><span class=\"fi-wrench\"></span></button></\n\tspan><span class=\"mr10\"\n\t><button style=\"\" class=\" tac btn-r button w140\" id=\"btn-publish\"><span class=\"fi-arrow-up\"> Publish to S3</span></button \n\t></span>\n\t<span class=\"mr10\"\n\t><button style=\"\" class=\" tac button\" id=\"btn-tar\"><span class=\"fi-archive\"> Get .tar</span></button \n\t></span>\n\t<span class=\"mr10\"\n\t><button style=\"\" class=\" tac button\" id=\"btn-validate\"><span class=\"fi-checkbox\"> Validate</span></button \n\t></span>\n\t<span class=\"dib vat fs80 mt5 blue\"><span class=\"fi-eye\"></span> \n\t\t<a href=\"\" target=\"_blank\" id=\"btn-view\">Preview</a>\n\t</span>\n</div>\n<table width=\"100%\" cellpadding=0 cellspacing=0 border=0 class=\"fs90\">\n\t<tr>\n\t\t<td style=\"width:195px;padding-right:0px;\" >\n\t\t\t<div id=\"ilist\" class=\"w190 fs90\"></div>\n\t\t\t<div id=\"btns-main\" class=\"mt10 w190 oh fs80 hoverlink gray pl3 mt15 pt10 btd lh190\">\n\t\t\t\t<span class=\"fi-page-add\"></span> <span class=\"pseudolink\" id=\"btn-additem\">Add resource</span><br>\n\t\t\t\t<span class=\" fi-paperclip\"></span> <span class=\"pseudolink\" id=\"btn-addfile\">Attach file</span><br>\n\t\t\t\t<span class=\"fi-photo ml-2\"></span> <span class=\"pseudolink\" id=\"btn-addpic\">Add image</span>\n\t\t\t</div>\n\t\t</td>\n\t\t<td class=\"pl15 edpane\">\n\t\t\t<div id=\"tabs\" class=\"mb10\"></div>\n\t\t\t<div id=\"items\" class=\"edpane\"></div>\n\t\t</td>\n\t</tr>\n</table>","style": {"": {"": "font-size:15pt!important"}," .s3item .my-modal-overlay": "font-size:110%;"," .s3item": {" .edwidth": "function ($form) {\n\t\t\treturn \"width:\"+($form.width()-210)+\"px;\"\n\t\t}"," .CodeMirror": "function ($form) {\n\t\t\t\n\t\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\ttabs = ($form.find(\"#tabs\").outerHeight(true)||0).clamp(38,100),\n\t\t\t\tcss = \"height:\"+($(window).height()-(pad+ofs+nav+tabs+15))+\"px;\";\n\t\t\t\n\t\t\treturn \"min-height:300px;\"+css;\n\t\t}"," .btn-l": "border-radius:30px 0 0 30px!important;"," .btn-r": "border-radius:0 30px 30px 0!important;"," .btn-c": "border-radius:0 0 0 0!important;"," .b1r .CodeMirror-linenumbers": "background-color: rgba(255, 200, 200, 0.75);"},".my-app-busy": {">#nav": "opacity:0.2",">table": "opacity:0.2",">#sysload": {"": "display:block;"}}," .busy:before": "content:\" \"; width:100%;height:100%;position:absolute;top:0;left:0;background:rgba(255,255,255,0.5);z-index:+3;",".my-app-busy-high > #sysload #counter-size": "display:block;"," #sysload": {"": "display:none;position:absolute;width: 100%;text-align: center;height: 300px;padding-top:100px;left:0;top:0;"," div#counter-size": "margin-top:20px;display:none;"},".my-app-busy>#sysload": "display:block;"," #ilist": "function ($form) {\n\t\t\t\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\tcss = \"max-height:\"+($(window).height()-(pad+ofs+nav+126))+\"px;\";\n\n\t\treturn \"overflow-x:hidden;overflow-y:\"+(navigator.webkitGetUserMedia?\"overlay\":\"scroll\")+\";\"+css;\n\t}"," .edpane": "function ($o) {\n\t\treturn \"width:\"+($o.width()-210)+\"px;\"\n\t}"," #ilist>div": "cursor:pointer"," .CodeMirror": "line-height:1.4em;height:auto;padding:0px;font:13px Cousine,'PT Mono',Monaco,monospace;"," .siteitem": "font-size:11pt;word-wrap: break-word;line-height:1.1em;padding-top: 5px;padding-bottom: 5px;"," .b1": "border:1px solid #C1D0DA; border-radius:2px;"," .b1b": "border:1px solid #00BCF4; border-radius:2px;","\t.b1g": "border: 1px solid #A4D572;border-radius:2px;","\t.b1r": "border: 1px solid rgb(255, 134, 153);border-radius:2px;"," .red": "color:rgb(255, 134, 153)!important;"," .btn-l": "border-radius:3px 0 0 3px;"," .btn-r": "border-radius:0 3px 3px 0;"," .btn-с": "border-radius:00;"," .button": "outline:none!important"," .redactor_editor": "font-size:13pt; padding:0.7em; color:#444"," .redactor_box": "border:none"," .redactor_toolbar": "background: none;padding-top: 2px!important;border-bottom-color:#C1D0DA"," .redactor_toolbar li a:active, .redactor_toolbar li a.redactor_act ": " outline: none;border-color: #C5DCEA;background-color: #C5DCEA;"," .redactor_toolbar li.redactor_separator": "margin: 0 2px 0 3px !important;padding: 0;height: 27px;border-right: none;border-left: 1px solid #C1D0DA;"," .redactor_box textarea": "background-color:#333;padding:15px;"," div.tab-tab": {" #tabname": "padding:1px 18px 1px 7px;color:#8292A3;font-size:80%; border:1px solid #DEE7EC;display:inline-block;background-color:white;border-radius:2px 10px 0 0;margin: 0 0 2px 0;"," .btn-tabclose": "opacity:0;transition:opacity 0.3s;display:inline-block;text-align:center;width:18px; margin:0px 2px 0 -18px;color:#c02;line-height:0.9em;"," #tabname.active": "background-color: rgba(142, 211, 255, 0.25);color:#274361;border-color:rgba(255,255,255,0);"," #tabname:hover": "color:#274361;",":hover .btn-tabclose": "opacity:0.6"}}},"raw": {"name": "Site.Editor","title": "S3 Site Builder","version": "2.0","build": 160,"com": [{"stamp": "1408670524235","id": "Root","type": "js","data": "({\n\t// CloudWall AWS S3 site builder\n  // (c) 2018 ermouth\n\t\n\t// (c) ermouth\n\t\n\tVersion:\"2.3.0\",\n\t\n\trequire:[{\n\t\tAWS: \t\t\t\t'lib/aws.js',\n\t\tUglifyJS:\t\t'lib/uglify.js', \n\t\tZlib:\t\t\t\t'lib/gzip.js',\n\t\tless:\t\t\t\t'lib/less.js'\n\t}],\n\texpose:[\"GetDoc\",\"GetActiveId\",\"RT\",\"Path\",\"GenId\",\"getDup\",\"Confirm\",\"Items2Atts\"],\n\tparams:{restyle:200},\n\tcreds:{},\n\tList:[],\n\tTablist:[],\n\tActive:\"\", // active item\n\tExpanded:{},\t// list of expanded branches\n\t\n\tRT: function(){ return this; },\n\tGetDoc: function(){ return this.data.doc; },\n\tGenId: function(){return $.my.f.sdbmCode(Date.now()+Number.random(1e11, 1e18))},\n\tGetActiveId: function(){ return this.Active; },\n\tMemoTabs: function(){\n\t\tvar that=this, d = that.data.doc, di = d.items, a=[];\n\t\ta.push(that.Path(that.List[0]));\n\t\tthat.Tablist.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (p!=a[0] && elt.data.length<50000) a.push(p);\n\t\t});\n\t\td.tabs = a.reverse();\n\t},\n\t\n\tgetDup: function (item, name0) {\n\t\tvar that = this, \n\t\t\t\ti,e, ename, \n\t\t\t\tfname = that.Path(item, name0), \n\t\t\t\tu = false;\n\t\tfor (var i = 0; i < that.data.doc.items.length && !u; i++) {\n\t\t\te = that.data.doc.items[i];\n\t\t\tename = that.Path(e);\n\t\t\tif (e.id!==item.id && ename===fname) u = e.type;\n\t\t}\n\t\treturn u;\n\t},\n\t\n\tPath: function(item, name) {\n\t\treturn (item.folder?item.folder+\"/\":\"\")+(name!=null?name:item.name)+(item.ext?\".\"+item.ext:\"\");\n\t}\n\t\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1436021399043","id": ".init","type": "js","data": "(function ($o, form) {\n\tvar i, j, that = this, \n\t\t\td = form.data.doc,\n\t\t\titems = d.items;\n\n\t$o.html(this.HTML);\n\n\t// Prepare doc if it’s empty\n\tif (!d.items.length) {\n\t\td.items.push( \t$.extend(true, {},that.Item.data, {id:that.GenId()}) );\n\t}\n\n\t// Restore tabs ...\n\t\n\tif (Object.isArray(d.tabs) && d.tabs.length) {\n\t\tvar tabs = cw.lib.a2o(d.tabs);\n\t\td.items.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (tabs[p]) tabs[p] = elt;\n\t\t});\n\t\t\n\t\td.tabs.forEach(function(i) {\n\t\t\tvar t = tabs[i];\n\t\t\tif (Object.isObject(t)) {\n\t\t\t\tthat.Tablist.push(t);\n\t\t\t}\n\t\t});\n\t\tif (that.Tablist[0]) that.List.push(that.Tablist[0]);\n\t\tthat.Active = that.List[0].id;\n\t} \n\t\n\t// ... or open item[0] if failed to restore\n\t\n\tif (!that.List.length) {\n\t\tthat.Active = d.items[0].id;\n\t\tthat.List.push(d.items[0]);\n\t\tthat.Tablist.push(d.items[0]);\n\t}\n\t\n\t// Clean attaches if no preview\n\tif (!d.site.previewBase) {\n\t\tthat.CleanAtts(d);\n\t}\n\t\n\t/*that.getDup = function (item, name0) {\n\t\tvar i,e, \n\t\t\t\tename, \n\t\t\t\tfname = that.Path(item, name0), \n\t\t\t\tu=false;\n\t\tfor (var i=0;i<d.items.length && !u; i++) {\n\t\t\te = d.items[i];\n\t\t\tename = that.Path(e);\n\t\t\tif (e.id!==item.id && ename===fname) u = e.type;\n\t\t}\n\t\treturn u;\n\t};*/\n\t\n\t// Init gzip\n\tthat.gzip = that.Gzip();\n\n\t// Remember mimes && set missing cache max-ages\n\t\n\tfor (i=0;i<d.items.length;i++) {\n\t\tj = d.items[i];\n\t\tif (j.type===\"attachment\" && !j.mime) {\n\t\t\tj.mime = d._attachments[that.Path(j)].content_type;\n\t\t}\n\t\tif (!j.cache) j.cache = \"86400\";\n\t\tif (!j.state) j.state = {savedSdbm:\"\",sdbm:\"\",depends:{},impacts:{}};\n\t\tdelete j.savedSdbm; delete j.depends;\n\t}\n\n\t// ‘Delete item’ event handler\n\n\t$o.on(\"delitem.my\", function(evt, item){\n\t\tvar ipos = d.items.findIndex(_find),\n\t\t\t\tlpos = that.List.findIndex(_find),\n\t\t\t\tfname = that.Path(item);\n\t\tif (d.items.length>1) {\n\t\t\td.items.removeAt(ipos);\n\t\t\tthat.List.removeAt(lpos);\n\t\t\tthat.Tablist.removeAt(that.Tablist.findIndex(_find));\n\t\t\tif (d._attachments && d._attachments[fname]) \n\t\t\t\tdelete d._attachments[fname];\n\t\t\tthat.Expanded[item.id] = false;\n\t\t\tthat.Active = that.List[0].id;\n\t\t\t$o.find(\"#items\").trigger(\"recalc\");\n\t\t}\n\t\telse {\n\t\t\t(window.l||cw.lib).note(\"Can’t remove last resource.\",\"error\");\n\t\t}\n\n\t\tfunction _find (e) {\n\t\t\treturn e.id == item.id;\n\t\t}\n\t});\n\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1408678731282","id": ".data","type": "js","data": "({\n\tdoc:{\n\t\t_id:\"\",\n\t\tname:\"Default site\",\n\t\ttype:\"s3site\",\n\t\towners:[],\n\t\tacl:[],\n\t\ts3:{\n\t\t\taccessKeyId :\"\",\n\t\t\tsecretAccessKey :\"\",\n\t\t\tregion :\"eu-west-1\"\n\t\t},\n\t\tsite:{\n\t\t\ts3bucket:\"\",\n\t\t\ts3folder:\"\",\n\t\t\tsiteBase:\"\",\n\t\t\tpreviewBase:\"\"\n\t\t},\n\t\tcreds:{\n\t\t\tcrypto:\"\"\n\t\t},\n\t\titems:[]\n\t},\n\tcmd:\"\"\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1435105056763","id": ".data.doc","type": "js","data": "({\n  \"_id\": \"\",\n  \"name\": \"Default site\",\n  \"type\": \"s3site\",\n  \"owners\": [],\n  \"acl\": [],\n  \"s3\": {\n    \"accessKeyId\": \"\",\n    \"secretAccessKey\": \"\",\n    \"region\": \"eu-west-1\"\n  },\n  \"site\": {\n    \"s3bucket\": \"\",\n    \"s3folder\": \"\",\n    \"siteBase\": \"\",\n    \"previewBase\": \"\"\n  },\n  \"creds\": {\n    \"crypto\": \"\"\n  },\n  \"items\": [\n    {\n      \"id\": \"1ct0j7yp\",\n      \"type\": \"html\",\n      \"snippet\": false,\n      \"folder\": \"\",\n      \"name\": \"index\",\n      \"ext\": \"html\",\n      \"mime\": \"text/html\",\n      \"desc\": \"\",\n      \"external\": \"\",\n      \"data\": \"<!DOCTYPE html>\\n<html>\\n\\t<head>\\n\\t\\t<title> Insert title here </title>\\n\\t</head>\\n\\t<body>\\n\\t\\tHello, world!\\\\n\\\\ {{x.x}}\\n\\t\\t{{xx.html}}\\n\\t</body>\\n</html>\",\n      \"parser\": \"// Parser receives (item, _attachments)\\n// and must return string representation of item\\n(function (item, atts){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n      \"parserActive\": false,\n      \"cache\": \"86400\",\n      \"state\": {\n        \"savedSdbm\": \"\",\n        \"sdbm\": \"Z\",\n        \"depends\": {},\n        \"impacts\": {}\n      }\n    },\n    {\n      \"id\": \"1c6vodvl\",\n      \"type\": \"html\",\n      \"snippet\": true,\n      \"folder\": \"folder\",\n      \"name\": \"longlongnamesuperlong123\",\n      \"ext\": \"html\",\n      \"mime\": \"text/html\",\n      \"desc\": \"\",\n      \"external\": \"\",\n      \"data\": \"<!-- HTML -->\\nzzz\\n{{cc.cc}}\\n\",\n      \"parser\": \"// Parser receives (item, _attachments)\\n// and must return string representation of item\\n(function (item, atts){\\n\\n\\tvar t = item.dddd.zzzz;\\n\\treturn item.data+\\\"\\\";\\n})\",\n      \"parserActive\": true,\n      \"cache\": [\n        \"86400\"\n      ],\n      \"state\": {\n        \"savedSdbm\": \"\",\n        \"sdbm\": \"Z\",\n        \"depends\": {},\n        \"impacts\": {}\n      },\n      \"noIncludes\": false\n    },\n    {\n      \"id\": \"19qvfb4f\",\n      \"type\": \"html\",\n      \"snippet\": false,\n      \"folder\": \"\",\n      \"name\": \"dgrhr\",\n      \"ext\": \"html\",\n      \"mime\": \"text/html\",\n      \"desc\": \"\",\n      \"external\": \"pouch://sgdhdfghdf\",\n      \"data\": \"<!-- HTML -->\\n\\n\\n\",\n      \"parser\": \"// Parser receives (item, _attachments)\\n// and must return string representation of item\\n(function (item, atts){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n      \"parserActive\": false,\n      \"cache\": [\n        \"86400\"\n      ],\n      \"state\": {\n        \"savedSdbm\": \"\",\n        \"sdbm\": \"Z\",\n        \"depends\": {},\n        \"impacts\": {}\n      },\n      \"noIncludes\": false\n    },\n    {\n      \"id\": \"18ts14mm\",\n      \"type\": \"json\",\n      \"snippet\": false,\n      \"folder\": \"\",\n      \"name\": \"abc\",\n      \"ext\": \"json\",\n      \"mime\": \"application/json\",\n      \"desc\": \"\",\n      \"external\": \"\",\n      \"data\": \"(\\n\\t/* Put JSON here */\\n})\",\n      \"parser\": \"// Parser receives (item, _attachments)\\n// and must return string representation of item\\n(function (item, atts){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n      \"parserActive\": false,\n      \"cache\": [\n        \"86400\"\n      ],\n      \"state\": {\n        \"savedSdbm\": \"\",\n        \"sdbm\": \"Z\",\n        \"depends\": {},\n        \"impacts\": {}\n      }\n    },\n    {\n      \"id\": \"1cjbfh22\",\n      \"type\": \"js\",\n      \"snippet\": false,\n      \"folder\": \"\",\n      \"name\": \"test\",\n      \"ext\": \"js\",\n      \"mime\": \"text/javascript\",\n      \"desc\": \"\",\n      \"external\": \"\",\n      \"data\": \"/* JS */\\n\\n/*{{2.1.3.js}}*/\\n\\nfunction m(){\\n\\n}\",\n      \"parser\": \"// Parser receives (item, _attachments)\\n// and must return string representation of item\\n(function (item, atts){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n      \"parserActive\": false,\n      \"cache\": [\n        \"86400\"\n      ],\n      \"state\": {\n        \"savedSdbm\": \"\",\n        \"sdbm\": \"Z\",\n        \"depends\": {},\n        \"impacts\": {}\n      },\n      \"Uglify\": false\n    },\n    {\n      \"id\": \"19udh66i\",\n      \"type\": \"js\",\n      \"snippet\": true,\n      \"folder\": \"\",\n      \"name\": \"2.1.3\",\n      \"ext\": \"js\",\n      \"mime\": \"text/javascript\",\n      \"desc\": \"\",\n      \"external\": \"\",\n      \"data\": \"/* JS */\\n\\n\\nfunction z(){\\n return x\\n}\",\n      \"parser\": \"// Parser receives (item, _attachments)\\n// and must return string representation of item\\n(function (item, atts){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n      \"parserActive\": false,\n      \"cache\": [\n        \"86400\"\n      ],\n      \"state\": {\n        \"savedSdbm\": \"\",\n        \"sdbm\": \"Z\",\n        \"depends\": {},\n        \"impacts\": {}\n      },\n      \"Uglify\": false\n    }\n  ]\n})","active": false,"opts": ["nocompile"],"err": []},{"stamp": "1409438648501","id": ".ui","type": "js","data": "({\n\t\"#btn-view\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar base = d.doc.site.previewBase;\n\t\t\t$o.attr(\"href\", (base?base.replace(/\\/$/,'')+\"/index.html\":\"\"));\n\t\t},\n\t\twatch:\"#sname\",\n\t\tcss:{\n\t\t\thide:function(d,v,$o){$o.parent().toggleClass(\"hide\",!d.doc.site.previewBase)}\n\t\t}\n\t},\n\t\"#sname\":{\n\t\tbind: function(d){\n\t\t\tvar html = (d.doc.name||\"Untitled\"), \n\t\t\t\t\tbase = d.doc.site.siteBase;\n\t\t\tif (base) html = '<a target=\"_blank\" href=\"'+base+'\">'+html+'</a>'; \n\t\t\treturn html;\n\t\t}\n\t},\n\t\n\t\"#btn-params\":{\n\t\tbind: function(d,v, $o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\telse $o.modal({\n\t\t\t\t\tmanifest:that.DocParams,\n\t\t\t\t\tdata:$.extend(true,{},\n\t\t\t\t\t\tObject.select(d.doc,\"name s3 site owners creds\".split(\" \"))\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\twidth: 525,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tcss:\"fs90\"\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t$.extend(true, d.doc, res);\n\t\t\t\t\tfor (var i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\td.doc.items[i].state.savedSdbm = \"\";\n\t\t\t\t\t}\n\t\t\t\t\t$o.my(\"find\",\"#sname\").trigger(\"check\");\n\t\t\t\t\t\n\t\t\t\t\tif (!d.doc.site.previewBase) {\n\t\t\t\t\t\tthat.CleanAtts(d.doc);\n\t\t\t\t\t} \n\t\t\t\t\t\n\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t\"self:red\":function(d){\n\t\t\t\tvar s3 = $.extend(!0, {}, d.doc.s3, cw.crypto.dec(d.doc.creds)[\"s3\"]||{}), \n\t\t\t\t\ts = d.doc.site;\n\t\t\t\treturn (!s3.accessKeyId || !s3.secretAccessKey || !s3.region || !s.s3bucket || !s.siteBase);\n\t\t\t\t/*var s3 = d.doc.s3, s = d.doc.site;\n\t\t\t\treturn (!s3.accessKeyId || !s3.secretAccessKey || !s3.region\n\t\t\t\t\t\t\t\t|| !s.s3bucket || !s.siteBase);*/\n\t\t\t}\n\t\t},\n\t\twatch:\"#sname\"\n\t},\n\t\"#btn-addpic\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.AddImage,\n\t\t\t\t\twidth:820,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tdata:{},\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\tvar item = $.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{}, \n\t\t\t\t\t\tthat.Types.attachment.manifest.data,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid:that.GenId(), \n\t\t\t\t\t\t\tfolder:res.folder,\n\t\t\t\t\t\t\tname:res.filename.replace(/\\.jpg$/,''),\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"jpg\",\n\t\t\t\t\t\t\tmime:res.mime,\n\t\t\t\t\t\t\tsize:res.data.length/4*3\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\td.doc._attachments[that.Path(item)] = {content_type:res.mime, data: res.data};\n\t\t\t\t\td.doc.items.push(item);\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-addfile\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(!0,  that.AddFile, {getDup:that.getDup,Types:that.Types}),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{doc:d.doc}, \n\t\t\t\t\t\t{item:that.Types.attachment.manifest.data}, \n\t\t\t\t\t\t{item:{\n\t\t\t\t\t\t\tid:that.GenId(), name:\"\",\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"—\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\twidth: 535,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\tvar path, dup, i;\n\t\t\t\t\tres.item.data = \"Файл\";\t\n\t\t\t\t\tres.item.mime = res.file.content_type;\n\t\t\t\t\tres.item.size = res.file.size;\n\t\t\t\t\tif (res.file && res.file.data) {\n\t\t\t\t\t\tpath = that.Path(res.item);\n\t\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\t\td.doc._attachments[path] = res.file;\n\t\t\t\t\t\tfor (i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\t\tif (that.Path(d.doc.items[i]) == path) dup = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (null!=dup) d.doc.items[dup] = $.extend(true, {}, res.item);\n\t\t\t\t\t\telse d.doc.items.push($.extend(true, {}, res.item));\n\t\t\t\t\t}\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-additem\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(\n\t\t\t\t\t\ttrue,  that.AddItem, \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgetDup:that.getDup,\n\t\t\t\t\t\t\tTypes:that.Types,\n\t\t\t\t\t\t\tRT: function(){ return that; }\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, {}, that.Item.data, \n\t\t\t\t\t\t{id:that.GenId(),name:\"\"}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t$.extend(res, that.Types[res.type].defaults||{});\n\t\t\t\t\tres.mime = that.Types[res.type].mime;\n\t\t\t\t\t//console.log(res);\n\t\t\t\t\td.doc.items.push($.extend(true, {}, res));\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-save\":{ /*See tab*/ },\n\t\"#btn-close\":{\n\t\tbind:function(d,v,$o){\n\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1408681622106","id": ".ui.#ilist","type": "js","data": "({\n\tdelay:50,\n\t\n\t//- - - - - - - - - - - - - - - - - - - - -\n\t\n\tinit: function($o, form){\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t\n\t\t$o.on(\"click.my\", \".siteitem\", function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.attr(\"id\").from(3),\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (!item) {\n\t\t\t\tif (that.Expanded[id]) that.Expanded[id] = false;\n\t\t\t\telse that.Expanded[id] = true;\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t\telse /*if (item.type!=\"attachment\")*/ {\n\t\t\t\tthat.Active = id;\n\t\t\t\tif (item.folder) that.Expanded[item.folder] = true;\n\t\t\t\tif ( (idx = that.List.indexOf(item)) !== -1) {\n\t\t\t\t\tthat.List.removeAt(idx);\n\t\t\t\t} \n\t\t\t\tthat.List.unshift(item);\n\t\t\t\tif (that.Tablist.indexOf(item)==-1) that.Tablist.unshift(item);\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t})\n\t},\n\t\n\t///- - - - - - - - - - - - - - - - - - - - -\n\t\n\tbind:function(d,v,$o) {\n\t\tvar that = this, \n\t\t\t\ti, e, html=\"\",\n\t\t\t\tlist = d.doc.items, \n\t\t\t\tres = [], fl = \"\";\n\n\t\t// sort list\n\t\tlist = list.sortBy(function(e){\n\t\t\treturn [\n\t\t\t\t(!e.folder) *1,\n\t\t\t\te.folder,\n\t\t\t\te.snippet*1,\n\t\t\t\te.name,e.type\n\t\t\t].join(\"/\").toLowerCase();\n\t\t});\n\t\t\n\t\t// gen items/folders final list\n\t\tfor (i=0; i<list.length; i++) {\n\t\t\te = list[i];\n\t\t\tif (e.folder && e.folder != fl) {\n\t\t\t\tfl = e.folder;\n\t\t\t\tres.push({\n\t\t\t\t\tid:fl,\n\t\t\t\t\thtml: '<span class=\"dib w15\">'+(that.Expanded[fl]?\"▾\":\"▸\")+'</span>'+fl,\n\t\t\t\t\tcss:\"xgray\",\n\t\t\t\t\ttype:\"folder\"\n\t\t\t\t});\n\t\t\t} \n\t\t\tif (!e.folder || that.Expanded[e.folder]) {\n\t\t\t\tvar isdirty = (!e.state.savedSdbm || e.state.sdbm == \"Z\"  || (e.state.sdbm!==e.state.savedSdbm));\n\t\t\t\tres.push({\n\t\t\t\t\tid:e.id,\n\t\t\t\t\thtml: (e.folder?\"\":\"&nbsp;\")\n\t\t\t\t\t+ (e.parserActive?'<i>':\"\")\n\t\t\t\t\t+ e.name+\".\"+e.ext\n\t\t\t\t\t+ (e.parserActive?'</i>':\"\")\n\t\t\t\t\t+ (isdirty?'<span class=\"lgray\">&nbsp;•</span>':\"\"),\n\t\t\t\t\tcss: (e.external?\"orange o80\":e.snippet?\"sky\":e.type===\"attachment\"?\"gray\":\"blue\") + (e.id == that.Active?\" bg-lblue\":\"\"),\n\t\t\t\t\ttype:e.snippet?\"snippet\":\"item\",\n\t\t\t\t\ttitle: e.folder+\"/\"+e.name+\".\"+e.ext,\n\t\t\t\t\tfolder: e.folder\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t// render list\n\t\tfor (i=0;i<res.length;i++) {\n\t\t\te = res[i];\n\t\t\thtml+='<div class=\"siteitem w190 oh '+e.css+(e.folder?\" pl15\":\"\")\n\t\t\t\t+'\" id=\"sx-'+e.id+'\" title=\"'\n\t\t\t\t+(e.title?e.title:\"\")+'\">'\n\t\t\t\t+e.html\n\t\t\t\t+'</div>';\n\t\t}\n\t\treturn html;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1436021434299","id": ".ui.#tabs","type": "js","data": "({\n\tbind: \"this.Tablist\",\n\tinit: function($o, form){\n\t\t\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t$o.on(\"click.my\", \"#tabname\", function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.List.indexOf(item)==-1) that.List.unshift(item);\n\t\t\tthat.Active = id;\n\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t}.debounce(150));\n\t\t\n\t\t$o.on(\"click.my\", \".btn-tabclose\", function(){\n\t\t\tvar $l = $(this).parent(),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.Tablist.length>1) {\n\t\t\t\tthat.Tablist.remove(function(e){return e===item});\n\t\t\t\tthat.List.remove(function(e){return e===item});\n\t\t\t\tif (!that.List.length) that.List.push(that.Tablist[0]);\n\t\t\t\tthat.Active = that.List[0].id;\n\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t}\n\t\t}.debounce(150))\n\t\t\n\t},\n\tmanifest:{\n\t\tinherit:[\"Path\",\"GetActiveId\"],\n\t\tui:{\n\t\t\t\"#tabname\":{\n\t\t\t\tbind:function(d){\n\t\t\t\t\treturn this.Path(d);\n\t\t\t\t},\n\t\t\t\tcss:{\n\t\t\t\t\t\"active\":function(d){return d.id == this.GetActiveId()}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tid:function(e){return e.id},\n\thash: function(e, i){\n\t\tvar h =  (e.id===this.Active?\"1\":\"0\")+$.my.f.sdbmCode(e);\n\t\treturn h;\n\t},\n\tlist:[\n\t\t'<div class=\"vat dib cp tab-tab\">',\n\t\t\t'<span id=\"tabname\"></span>',\n\t\t\t'<span class=\"btn-tabclose\">×</span>',\n\t\t'</div>'\n\t].join(\"\"),\n\twatch:\"#ilist,#items\"\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1408800142685","id": ".ui.#items","type": "js","data": "({\n\tbind:\"this.List\",\n\tmanifest: function (e){\n\t\tvar that = this,\n\t\t\t\tman = {\n\t\t\t\t\tGetActiveId: function(){ return that.Active; },\n\t\t\t\t\tGetSite: function(){ return that.data.doc; },\n\t\t\t\t\tRT: function(){ return that; }\n\t\t\t\t},\n\t\t\t\tT = that.Types[e.type];\n\t\t\n\t\tif (!T.manifest) {\n\t\t\t$.extend( true, \n\t\t\t\tman, \n\t\t\t\tthat.Item,\n\t\t\t\t/*Object.select(T,[\"HTML\",\"ui\",\"init\", \"HTMLtail\", \"style\",\"validator\"]),\n\t\t\t\t{data:{data:T.data}}*/\n\t\t\t\tT.extend\n\t\t\t);\n\t\t\t$.extend (man, T.replace)\n\t\t} \n\t\telse {\n\t\t\t$.extend( true, \n\t\t\t\tman, \n\t\t\t\tT.manifest\n\t\t\t);\n\t\t}\n\t\t\n\t\treturn man;\n\t},\n\tinit: function($o, form){\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t\n\t\t// Render tab preview\n\t\t\n\t\t$o.on(\"click.my\", \"#btn-rendertab\", function(evt){\n\t\t\tvar $c = $(evt.currentTarget), fd, path;\n\n\t\t\t\t\tfd = $c.my().root.my(\"data\");\n\t\t\t\t\tpath = that.Path(fd);\n\t\t\t\n\t\t\tif (true || !fd.snippet) {\n\t\t\t\tthat.Build($.extend(true, {}, d.doc), {\n\t\t\t\t\tpick:path, \n\t\t\t\t\tresolve:false,\n\t\t\t\t\tbuttons:true,\n\t\t\t\t\tsilent:true\n\t\t\t\t}, $c)\n\t\t\t\t.then(function(a){\n\t\t\t\t\tvar mod;\n\n\t\t\t\t\tvar att = (a.result._attachments||{})[path],\n\t\t\t\t\t\t\tmime;\n\n\t\t\t\t\tif (att) {\n\t\t\t\t\t\tmime = att.content_type;\n\t\t\t\t\t\tif (/^text\\/|(javascript|xml|xhtml|json)$/.test(mime)) {\n\t\t\t\t\t\t\t// we have text format\n\t\t\t\t\t\t\tmod = {\n\t\t\t\t\t\t\t\tjson:cw.lib.base64(att.data,true)\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (/javascript$/.test(mime)) {\n\t\t\t\t\t\t\t\tvar parsed = that.ParseJS(mod.json, true);\n\t\t\t\t\t\t\t\tif (parsed.errors.length) {\n\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\tmod.comment+='<span class=\"red\">'+parsed.errors.join(\"; \")+'</span><br/>';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (parsed.globals.length) {\n\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\tmod.comment+='Globals: '+parsed.globals.join(\", \");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (mod.comment) mod.comment = '<div class=\"mt10\">'+mod.comment+'</div>';\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t_modal(mod);\n\n\t\t\t\t\t\t} else if (/^image\\//.test(mime)) {\n\t\t\t\t\t\t\t// we have image\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// we have something else\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcw.lib.note(\"Can’t build attachment.\",\"error\");\n\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t\t\n\t\t\t//- - - - - -\n\t\t\t\n\t\t\tfunction _modal(data){\n\t\t\t\treturn $c.modal({\n\t\t\t\t\tmanifest:that.Takeout,\n\t\t\t\t\tdata:data,\n\t\t\t\t\twidth:600,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tbound:10\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t});\n\t},\n\tlist:'<div class=\"s3item\"></div>',\n\tcheck:true,\n\tid:function(e){return e.id},\n\thash: function(e, i){\n\t\tvar h =  (e.id===this.Active?\"1\":\"0\")+$.my.f.sdbmCode(e);\n\t\treturn h;\n\t},\n\tdelay:100,\n\trecalc:\"#ilist\",\n\twatch:\"#ilist\",\n\trecalcDepth:1\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1427645731624","id": ".ui.#btn-save","type": "js","data": "({\n\tdelay:150,\n\tbind:function(d,v,$o){\n\t\tvar that=this, errors={};\n\t\tif (v!=null) {\n\t\t\tthat.MemoTabs();\n\t\t\t\n\t\t\tif (!d.doc.site.previewBase) {\n\t\t\t\t$o.trigger(\"commit\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\n\t\t\t\tthat.Build(d.doc, {silent:true}, $o)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(res){\n\t\t\t\t\t\td.doc.stamp = Date.now();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Merge attaches if we have to\n\t\t\t\t\t\tif (d.doc.site.previewBase) {\n\t\t\t\t\t\t\tthat.MergeAtts(d.doc, res.result)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t},\n\t\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1410663596232","id": ".ui.#btn-publish","type": "js","data": "({\n\t// Publish\t\n\t\n\tdelay:150,\n\t\n\tcss:{\n\t\t\":disabled\":function(d){\n\t\t\tvar s3 = $.extend(!0, {}, d.doc.s3, cw.crypto.dec(d.doc.creds)[\"s3\"]||{}), \n\t\t\t\t\ts = d.doc.site;\n\t\t\treturn (!s3.accessKeyId || !s3.secretAccessKey || !s3.region || !s.s3bucket);\n\t\t}\n\t},\n\t\n\twatch:\"#sname\",\n\t\n\tbind: function (d, v, $o){\n\t\tvar i, async = false,\n\t\t\t\tnote = cw.lib.note,\n\t\t\t\tthat = this,\n\t\t\t\trows, key,\n\t\t\t\terr = {}, atts2go,\n\t\t\t\terrors={},\n\t\t\t\t$root = $o.my().root,\n\t\t\t\toldhtml = $o.html(),\n\t\t\t\tproc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tproc = $.Deferred();\n\t\t\t$o.html('<span class=\"dib vat cw-busy w50 h8 br100 mt5\"></span>');\n\t\t\t$o.attr(\"disabled\", true);\n\t\t\tproc.then(\n\t\t\t\tfunction(msg, skipSave){\n\t\t\t\t\tcw.lib.note(msg || \"Published to S3\",\"ok\");\n\t\t\t\t\tif (!skipSave)  {\n\t\t\t\t\t\td.doc.stamp = Date.now();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Merge attaches if we have to\n\t\t\t\t\t\tif (d.doc.site.previewBase) {\n\t\t\t\t\t\t\tthat.MergeAtts(d.doc, atts2go.result)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t publish. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t).always(function(){\n\t\t\t\t$o.attr(\"disabled\", false);\n\t\t\t\t$o.html(oldhtml);\n\t\t\t});\n\t\t\t\n\t\t\t//-------\n\t\t\t\n\t\t\ttry {\n\t\t\t\n\t\t\t\tthat.Build(d.doc, {\n\t\t\t\t\tbuttons:true, \n\t\t\t\t\tfooter:\"Above items won’t be included.\",\n\t\t\t\t\tcheckcreds:true,\n\t\t\t\t\tpick:false\n\t\t\t\t}, $o)\n\t\t\t\t.then(function(a){\n\t\t\t\t\tatts2go = a;\n\t\t\t\t\t_getEnv ();\n\t\t\t\t})\n\t\t\t\t.fail(function(txt, msg, stack){\n\t\t\t\t\tproc.reject(txt, msg, stack);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t} catch (e ) {\n\t\t\t\tconsole.log(e.message, e.stack)\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t/*if (key = d.doc.creds.crypto) {\n\t\t\t\tif (!cw.crypto.has(key)) {\n\t\t\t\t\tcw.lib.note(\"No cryptokey to decode S3 credentials.\", \"error\");\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tvar s3 = cw.crypto.dec(d.doc.creds)[\"s3\"];\n\t\t\t\t\tif (s3) {\n\t\t\t\t\t\tthat.creds.s3 = s3;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcw.lib.note(\"Error decoding S3 credentials.\", \"error\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthat.creds.s3 = Object.clone(d.doc.s3, !0);\n\t\t\t}\n\t\t\tthat.ResolveExternals(d.doc, errors)\n\t\t\t.then(_createAtts)\n\t\t\t.fail(function(e){\n\t\t\t\tconsole.log(e);\n\t\t\t\tnote(\"Failed generating attaches, see console for details\",\"error\");\n\t\t\t});*/\n\t\t}\n\t\t\n\t\t// - - - - - - -\n\t\t\n\t\tfunction _getEnv () {\n\t\t\t\n\t\t\tif (!Object.size(atts2go.upload)) {\n\t\t\t\tif (!Object.size(atts2go.err)) proc.resolve (\"All files are up to date, nothing to upload.\", true);\n\t\t\t\telse proc.reject (\"All files, scheduled to upload, have errors. Upload cancelled.\", \"error\");\n\t\t\t} else {\n\t\t\t\t// Upload\n\t\t\t\t\n\t\t\t\tthat.db.load(d.doc._id, true)\n\t\t\t\t.then(function(odoc){\n\t\t\t\t\t\n\t\t\t\t\tif (!odoc) {\n\t\t\t\t\t\tproc.reject(\"Doc must be saved at least once before publishing.\", \"error\")\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar ra, na, \n\t\t\t\t\t\t\tr = atts2go.result,\n\t\t\t\t\t\t\tu = atts2go.upload;\n\t\t\t\t\t\n\t\t\t\t\tif (Object.size(odoc._attachments)) {\n\t\t\t\t\t\tif (!r._attachments) atts2go.result._attachments = {};\n\t\t\t\t\t\tra = atts2go.result._attachments;\n\t\t\t\t\t\tna = odoc._attachments;\n\t\t\t\t\t\tObject.keys(na).forEach(function(i){\n\t\t\t\t\t\t\tif (!ra[i] || null==ra[i].data) {\n\t\t\t\t\t\t\t\tra[i] = {\n\t\t\t\t\t\t\t\t\tcontent_type:na[i].content_type,\n\t\t\t\t\t\t\t\t\tdata:na[i].data\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tu[i] = cw.lib.sdbm(na[i].digest);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t_go()\n\t\t\t\t\t.then(function(msg,req){\n\t\t\t\t\t\tfor (var i=0;i<d.doc.items.length; i++) {\n\t\t\t\t\t\t\tvar item = d.doc.items[i];\n\t\t\t\t\t\t\tif (u[that.Path(item)] || item.snippet) {\n\t\t\t\t\t\t\t\tvar ssdbm = item.state.sdbm!=\"Z\" ? item.state.sdbm : u[that.Path(item)];\n\t\t\t\t\t\t\t\titem.state.savedSdbm = item.state.sdbm = ssdbm;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tproc.resolve();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(e,req){\n\t\t\t\t\t\tproc.reject(\"Failed to publish, see console\",e,req);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t/*if (that.db) {\n\t\t\t\t\tvar Att = \"_attachments\";\n\t\t\t\t\tcw.db(that.db.name).save(d.doc, true)\n\t\t\t\t\t.then(function(newdoc){\n\t\t\t\t\t\td.doc._rev = newdoc._rev;\n\t\t\t\t\t\td.doc._attachments = newdoc._attachments\n\t\t\t\t\t\tthat.db.load(d.doc._id, true).then(function(res){\n\t\t\t\t\t\t\tvar obj = $.extend({}, Object.reject(d.doc,Att), Object.select(res,Att));\n\n\t\t\t\t\t\t\t_go(obj).then(function(msg){\n\n\t\t\t\t\t\t\t\tfor (var i=0; i<obj.items.length; i++) {\n\t\t\t\t\t\t\t\t\td.doc.items[i].state.savedSdbm = obj.items[i].state.savedSdbm;\n\t\t\t\t\t\t\t\t}\t\n\n\t\t\t\t\t\t\t\tthat.db.save(d.doc).then(function(newdoc1){\n\t\t\t\t\t\t\t\t\td.doc._rev = newdoc1._rev;\n\t\t\t\t\t\t\t\t\td.doc.stamp = newdoc1.stamp;\n\t\t\t\t\t\t\t\t\t_success(msg);\n\t\t\t\t\t\t\t\t\t$root.find(\"#items\").trigger(\"recalc\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, _fail);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t_go().then(_success, _fail);\n\t\t\t\t}*/\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// - - - - - - - \n\n\t\tfunction _go(doc){\n\t\t\tvar pi = $.Deferred();\n\t\t\ttry {\n\t\t\t\tthat.Upload(d.doc, $o.my().root, atts2go)\n\t\t\t\t.then(function(msg) {\n\t\t\t\t\tpi.resolve(msg);\n\t\t\t\t})\n\t\t\t\t.fail(function(e,req){\n\t\t\t\t\tpi.reject(e,req);\n\t\t\t\t});\n\t\t\t} catch (e){\n\t\t\t\tpi.reject(e.message);\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\treturn pi.promise();\n\t\t}\n\n\t\t// - - - - - - - \n\n\t\t/*function _go(doc){\n\t\t\tvar pi = $.Deferred();\n\t\t\tif (!Object.size(atts2go.upload)) {\n\t\t\t\tpi.resolve(\"All files are up to date, nothing to upload.\");\n\t\t\t} else {\n\t\t\t\tvar res = that.Upload(doc || d.doc, $o.my().root, atts2go);\n\t\t\t\t\n\t\t\t\tres.then(function(d){\n\t\t\t\t\tpi.resolve('Files uploaded succesfully.');\n\t\t\t\t}, function () {\n\t\t\t\t\tpi.reject('Failed to publish files. Please, try again.');\n\t\t\t\t}, function (notify) {\n\t\t\t\t\tconsole.log(notify);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn pi.promise();\n\t\t}\n\t\t\n\t\t// - - - - - - - \n\t\t\n\t\tfunction _success (msg){\n\t\t\tnote(msg, \"ok\");\n\t\t}\n\t\t\n\t\tfunction _fail (msg){\n\t\t\tnote(msg,'error');\n\t\t}*/\n\t\n\t\t// - - - - - - -\n\t\t\n\t\t/*function _createAtts (){\n\t\t\tthat.MemoTabs();\n\t\t\ttry {\n\t\t\t\tatts2go = that.Items2Atts(d.doc, that.Types, errors);\n\t\t\t\terr = atts2go.err;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e.message, e.stack, e)\n\t\t\t}\n\t\t\tif (Object.size(err)) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\t\tdata:$.extend({buttons:true, footer:\"Above items won’t be published.\"},atts2go),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\t//width:600,\n\t\t\t\t\t//global:true,\n\t\t\t\t\tscreen:'rgba(255,255,255,0.5)',\n\t\t\t\t\talign:\"top:105%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tbound:0\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\t_getEnv();\n\t\t\t\t})\n\t\t\t\t.fail(function(){\n\t\t\t\t\tatts2go=null;\n\t\t\t\t\terr = null;\n\t\t\t\t\tnote(\"Publish operation cancelled\",\"error\");\n\t\t\t\t})\n\t\t\t} \n\t\t\telse {\n\t\t\t\t_getEnv();\n\t\t\t}\n\t\t}*/\n\t\t\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1427647144826","id": ".ui.#btn-tar","type": "js","data": "({\n\t\n\tdelay:150,\n\t\n\tbind: function(d,v,$o) {\n\t\tvar a,err, that = this,errors = {}, tdoc, key;\n\t\t\n\t\tif (v!=null) {\n\t\t\t\n\t\t\ttdoc = $.extend(true, {}, d.doc);\n\t\t\t\n\t\t\tthat.Build(tdoc, {\n\t\t\t\tsilent:true\n\t\t\t}, $o)\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tvar i, \n\t\t\t\t\t\tT = that.Tar.Tar(),\n\t\t\t\t\t\ttar = new T(), \n\t\t\t\t\t\ta = res.result._attachments,\n\t\t\t\t\t\turl,r;\n\t\t\t\t\t\n\t\t\t\t\tif (Object.size(a)) {\n\n\t\t\t\t\t\tfor (i in a) {\n\t\t\t\t\t\t\tr = tar.append(i, that.Tar.Bytes(a[i].data));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\turl = URL.createObjectURL(new Blob([r], {type : 'application/x-tar'}));\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\t\tinit:[\n\t\t\t\t\t\t\t\t\t\t'<p class=\"mt10\">Tar archive of all files:</p>',\n\t\t\t\t\t\t\t\t\t\t'<div id=\"atar\" class=\"fs110 bold pb10\"></div>'\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\t\t\t\"#atar\": function(d){\n\t\t\t\t\t\t\t\t\t\t\tvar name = tdoc.name.replace(/[^a-z0-9\\.\\-]/ig,'-').replace(/\\-{2,}/g,'-').toLowerCase()+\".tar\",\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml = '<a download=\"' + name + '\" href=\"' + d.url +'\">' +name+'</a>';\n\t\t\t\t\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata:{url:url},\n\t\t\t\t\t\t\t\talign:\"top:102%\",\n\t\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\t\twidth:230,\n\t\t\t\t\t\t\t\tcss:\"fs85 tac xgray\",\n\t\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\t\tenter:true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t}\n\t}\n\t\n\t/*bind: function(d,v,$o) {\n\t\tvar that = this;\n\t\tif (v!=null) {\n\t\t\tthat.db.load(d.doc._id, true)\n\t\t\t.then(\n\t\t\t\tfunction(doc){\n\t\t\t\t\tif (!doc) return cw.lib.note(\"No saved version of the doc, can’t build .tar archive.\",\"error\");\n\t\t\t\t\tvar i, T = that.Tar.Tar(),\n\t\t\t\t\t\t\ttar = new T(), \n\t\t\t\t\t\t\ta = doc._attachments,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\tr;\n\n\t\t\t\t\tif (Object.size(a)) {\n\n\t\t\t\t\t\tfor (i in a) {\n\t\t\t\t\t\t\tr = tar.append(i, that.Tar.Bytes(a[i].data));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\turl = URL.createObjectURL(new Blob([r], {type : 'application/x-tar'}));\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\t\tinit:[\n\t\t\t\t\t\t\t\t\t\t'<p>Tar archive of <b>last saved</b> version:</p>',\n\t\t\t\t\t\t\t\t\t\t'<div id=\"atar\" class=\"fs110 bold pb5\"></div>'\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\t\t\t\"#atar\": function(d){\n\t\t\t\t\t\t\t\t\t\t\tvar name = doc.name.replace(/[^a-z0-9\\.\\-]/ig,'-').toLowerCase()+\".tar\",\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml = '<a download=\"' + name + '\" href=\"' + d.url +'\">' +name+'</a>';\n\t\t\t\t\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata:{url:url},\n\t\t\t\t\t\t\t\talign:\"top:102%\",\n\t\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\t\twidth:230,\n\t\t\t\t\t\t\t\tcss:\"fs90 tac\"\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t.fail(function(){\n\t\t\t\tcw.lib.note(\"Failed loading doc, can’t build .tar archive.\",\"error\");\n\t\t\t});\n\t\t}\n\t}*/\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1435098212759","id": ".ui.#btn-validate","type": "js","data": "({\n\t\n\tdelay:150,\n\t\n\tbind:function(d,v,$o){\n\t\tvar that=this, errors = {}, tdoc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\telse {\n\t\t\t\t\n\t\t\t\t//var tdoc = $.extend(true, {}, d.doc);\n\t\t\t\t\n\t\t\t\tthat.Build(d.doc, {blocking:false}, $o)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(res){\n\t\t\t\t\t\t// here better go some kind of stats\n\t\t\t\t\t},\n\t\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t/*if ($o.data(\"modal\")) $o.modal(true);\n\t\t\telse {\n\t\t\t\t\n\t\t\t\tvar tdoc = $.extend(true, {}, d.doc);\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tthat.ResolveExternals(tdoc, errors)\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\tvar err = that.Items2Atts(tdoc, that.Types, errors);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//window.MM = err;\n\n\t\t\t\t\t\tif (Object.size(err.err)) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\t\t\t\t\tdata:$.extend({buttons:false},err),\n\t\t\t\t\t\t\t\t//data:err,\n\t\t\t\t\t\t\t\tesc:false,\n\t\t\t\t\t\t\t\tenter:false,\n\t\t\t\t\t\t\t\tdrag:true,\n\t\t\t\t\t\t\t\talign:\"top:103%\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcw.lib.note(\"Doc integrity seems to be Ok.\",\"ok\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\tcw.lib.note(\"Error during validation\",\"error\");\n\t\t\t\t}\n\t\t\t}*/\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1408807909839","id": ".AddItem","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML);\n\t},\n\tparams:{width:445},\n\tui:{\n\t\t\"#nname\":{\n\t\t\tbind:\"name\",\n\t\t\tcheck:function(d,v){\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\tif (this.getDup(d, v)) return \"Already taken\";\n\t\t\t},\n\t\t\twatch:\"#nfolder,#ntype\"\n\t\t},\n\t\t\"#ntype\":{\n\t\t\tbind: function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.type = v+\"\";\n\t\t\t\t\td.ext = this.Types[d.type].ext;\n\t\t\t\t}\n\t\t\t\treturn [d.type]\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\tvar i, r, x, \n\t\t\t\t\t\tt = this.RT().Types,\n\t\t\t\t\t\ta=[], em;\n\t\t\t\tfor (i in t) {\n\t\t\t\t\tr = t[i];\n\t\t\t\t\tif (!r.noInsert) {\n\t\t\t\t\t\n\t\t\t\t\t\tif (!em && r.primary) {\n\t\t\t\t\t\t\tem = {};\n\t\t\t\t\t\t\tem[r.name] = i;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tx = {};\n\t\t\t\t\t\t\tx[r.name] = i;\n\t\t\t\t\t\t\ta.push(x);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$o.tags({tags:[a], empty:em});\n\t\t\t\t}\n\t\t\t},\n\t\t\t/*init: function($o){\n\t\t\t\t$o.html(this.Typelist.reduce(function(a,b){\n\t\t\t\t\treturn a+'<option value=\"'+b+'\">'+b+'</option>';\n\t\t\t\t},''));\n\t\t\t\t$o.select2();\n\t\t\t}*/\n\t\t},\n\t\t'input[name=\"snippet\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t},\n\t\t\trecalc:\"#cache\"\n\t\t},\n\t\t\"#nfolder\":{\n\t\t\tbind:\"folder\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{0,20}$/i\n\t\t},\n\t\t\"#ext\":{\n\t\t\tbind:\"ext\",\n\t\t\tcheck:/^[a-z0-9\\-]{0,20}$/,\n\t\t\twatch:\"#ntype\"\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d,v){\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.name || \n\t\t\t\t\t\tthis.getDup(d)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#ntype,#nfolder,#nname\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#cache\":{\n\t\t\tinit:function($o) {\n\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t},\n\t\t\tbind: \"cache\",\n\t\t\tcss:{\n\t\t\t\thide: function(d){return d.snippet}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t{'row':'445px', label:\"116px\", labelCss:\"fs80 gray\", rowCss:\"my-row pt5 pb7\"},\n\t\t'<h4 class=\"mt0\">Create resource</h4>',\n\t\t[\"\", \"spn#ntype.fs90\"],\n\t\t[\"\",\n\t\t '<span>', \n\t\t \t'inp#nfolder.w100', {plc:\"Folder\"} ,\n\t\t '</span> / <span class=\"dib vat w250\">', \n\t\t \t'inp#nname.w250', {plc:\"Name\"} , \"msg.fs70\",\n\t\t '</span> . ',\n\t\t '<span>','inp#ext.w60', {plc:\"Ext\"}, '</span>'\n\t\t //'sel#ntype.w100.fs90.mt1'\n\t\t],\n\t\t{rowCss:\"my-row pt7 pb5\"},\n\t\t['Cache-control','spn#cache.fs85'],\n\t\t{rowCss:\"my-row pt5 pb10\"},\n\t\t[\"\", \n\t\t '<label class=\"gray fs80\">',\n\t\t '<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>',\n\t\t ' Fragment (no file created)',\n\t\t '</label>'\n\t\t],\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Create\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t],\n\tTypelist:[\"html\"]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1408864311686","id": ".AddFile","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML);\n\t},\n\tui:{\n\t\t\"#fext\":{\n\t\t\tbind: \"item.ext\"\n\t\t},\n\t\t\"#ffolder\":{\n\t\t\tbind:\"item.folder\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{0,20}$/i\n\t\t},\n\t\t\"#fname\":{\n\t\t\tbind:\"item.name\",\n\t\t\tcheck:function(d,v){\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\tvar dup = this.getDup(d.item, v);\n\t\t\t\tif (dup && dup!==\"attachment\") return \"Already taken\";\n\t\t\t},\n\t\t\twatch:\"#fext,#ffolder\"\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d,v){\n\t\t\t\t\tvar dup = this.getDup(d.item);\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.item.name || \n\t\t\t\t\t\t(dup && dup!=\"attachment\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#fext,#ffolder,#fname,#upload\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#upload\":{\n\t\t\tbind:function(d,v,$o) {\n\t\t\t\tvar f, a={}, data;\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f.size>1024*1024*15){\n\t\t\t\t\t\t(window.l||cw).note(\"15Mb max\",\"error\");\n\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t}\n\t\t\t\t\telse if (f) (function(){\n\t\t\t\t\t\ta.content_type = f.type||\"application/octet-stream\";\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [], fn = f.name.split(\".\");\n\t\t\t\t\t\td.item.ext = fn.last().toLowerCase();\n\t\t\t\t\t\tfn.pop();\n\t\t\t\t\t\td.item.name = fn.join(\".\");\n\t\t\t\t\t\t$o.my(\"find\",\"#fext\").trigger(\"recalc\");\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\t\ta.size = sb64.length;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\td.file = a;\n\t\t\t\t\t\t\t$o.my(\"find\",\".cw-att-upload .pseudolink\").html(\"Other file...\");\n\t\t\t\t\t\t\t$o.my(\"find\",\".unhide\").removeClass(\"hide\");\n\t\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#fname\"\n\t\t},\n\t\t\"#cache\":{\n\t\t\tinit:function($o) {\n\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t},\n\t\t\tbind: \"item.cache\"\n\t\t}\n\t},\n\tHTML:[\n\t\t{'row':'535px', rowCss:\"my-row pt5 pb7 hide unhide\", label:\"166px\", labelCss:\"gray fs80\"},\n\t\t//'<h3>Добавить файл</h3>',\n\t\t'<div class=\"mt5 mb10\">'\n\t\t+'<h3 class=\"cw-att-upload fs100\"><span class=\"pseudolink\">Select a file...</span></h3>'\n\t\t+'<input id=\"upload\" type=\"file\" />'\n\t\t+'</div>',\n\t\t[\"\",\n\t\t '<span>', \n\t\t \t'inp#ffolder.w150.fs100', {plc:\"Folder\"} ,\n\t\t '</span> / <span class=\"dib vat w300\">', \n\t\t \t'inp#fname.w300.fs100', {plc:\"Name\"} , \"msg.fs70\",\n\t\t '</span> . ',\n\t\t 'spn#fext.w100.fs80'\n\t\t],\n\t\t\n\t\t//{rowCss:\"my-row pt7 pb5\"},\n\t\t['Cache-control','spn#cache.fs85'],\n\t\t\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Attach\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t\t\n\t],\n\tstyle:{\n\t\t\" input[type=file]\":\"width:100%;cursor:pointer;opacity:0; position:absolute;top:0;left:0;height:1.5em\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1409526912611","id": ".AddImage","type": "js","data": "({\n\t\"data\": {\n\t\t\"filename\": \"\",\n\t\tfolder:\"\",\n\t\t\"data\": \"\",\n\t\tmime:\"image/jpeg\",\n\t\t\"mode\":[\"inline\"],\n\t\t\"cropped\": false,\n\t\t\"width\": \"300\",\n\t\t\"height\":\"200\",\n\t\t\"scale\": \"1\",\n\t\t\"crop\": {},\n\t\tsrcsize:true\n\t},\n\tparams:{width:1020},\n\tinit: function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\thtml = $.my.formgen([\n\t\t\t'<div class=\"fl mr20 tac vat bg-lgray\" style=\"'\n\t\t\t+'width:800px;height:600px;overflow:hidden;position:relative;line-height:600px;\" id=\"crop-frame\">',\n\t\t\t\t'<img id=\"source\" class=\"vam\" style=\"max-width:800px; max-height:600px; \" src=\"\" />',\n\t\t\t\t'<div class=\"w800  dib\" style=\"height:600px;position:absolute;top:0;left:0\">',\n\t\t\t\t\t'<span class=\"dib vam fs110 button\">',\n\t\t\t\t\t'<span class=\"fi-photo\"><span class=\"fs110\"> &nbsp;Select image</span></span>',\n\t\t\t\t\t'</span>',\n\t\t\t\t\t'<input type=\"file\" id=\"file\" class=\"w800 dib\" accept=\"image/jpeg,image/png\" '\n\t\t\t\t\t+'style=\"height:600px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xpreview\">',\n\t\t\t\t{row:\"200px\",rowCss:\"pb10 my-row\"},\n\t\t\t\t[\"\",\"inp#folder\",{plc:\"Folder\"},\"msg.fs70\"],\n\t\t\t\t[\"\",\"inp#fname\",{plc:\"Flename\"},\"msg.fs70\"],\n\t\t\t\t[\"\",\"num#fw.w90.fs110.sizer\",{min:20, max:3000, step:5},' × ', \n\t\t\t\t \t\"num#fh.w90.fs110.sizer\", {min:20, max:3000, step:5}],\n\t\t\t\t/*[\"\",\"spn#mode.fs100.lh150\"],*/\n\t\t\t\t[\"\", '<label class=\"fs80\">',\n\t\t\t\t \t'<input type=\"checkbox\" name=\"srcsize\" value=\"srcsize\">',\n\t\t\t\t \t' &nbsp;Original dimensions',\n\t\t\t\t\t'</label>'],\n\t\t\t\t{rowCss:\"\"},\n\t\t\t\t[\"\",\n\t\t\t\t \"btn#btn-apply.w200.green.fs120.tac\",{val:\"Crop\"},\n\t\t\t\t //\"btn#btn-orig.w200.tac\",{val:\"Вставить оригинал\"},\n\t\t\t\t \"btn#btn-close.w200.tac\",{val:\"Cancel\"}\n\t\t\t\t],\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xwarn\"></div>',\n\t\t\t'<div class=\"hide\">',\n\t\t\t\t'<canvas id=\"x2\" width=400 height=400></canvas>',\n\t\t\t\t'<canvas id=\"x1\" width=200 height=200></canvas>',\n\t\t\t'</div>'\n\t\t]);\n\t\t$o.html(html);\n\t\tthat.Active = \"\";\n\t\t$o.on(\"focus.my\",\".sizer\", function(){\n\t\t\tif (!d.srcsize) {\n\t\t\t\tthat.Active = $(this).attr(\"id\");\n\t\t\t\t$(this).removeClass(\"gray\");\n\t\t\t} else {\n\t\t\t\tthat.Active = \"\";\n\t\t\t}\n\t\t});\n\t\t\n\t},\n\tstyle:{\n\t\t\" .jcrop-holder\":\"display:inline-block;vertical-align:middle\"\n\t},\n\tRecalc: function (d , $o, update){\n\t\tvar that = this;\n\t\tif (that.Active ==\"fh\") {\n\t\t\td.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fh\").trigger(\"check\");\n\t\t}\n\t\telse if (that.Active == \"fw\") {\n\t\t\td.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t\telse {\n\t\t\td.width = (d.crop.w*d.scale).floor();\n\t\t\td.height = (d.crop.h*d.scale).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t},\n\tui: {\n\t\t\"#folder\":{\n\t\t\tbind:\"folder\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{0,20}$/i,\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !Object.size(d.crop)}\n\t\t\t}\n\t\t},\n\t\t\"#fname\":{\n\t\t\tbind:\"filename\",\n\t\t\tcheck:function(d,v){\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\t//if (this.getDup(d, v)) return \"Имя занято\";\n\t\t\t},\n\t\t\twatch:\"#folder\",\n\t\t\tcss:{ hide: function(d){ return !Object.size(d.crop)} }\n\t\t},\n\t\t'input[name=\"srcsize\"]':{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.srcsize = !!(v+\"\");\n\t\t\t\t}\n\t\t\t\tif (d.srcsize) {\n\t\t\t\t\tthis.Active = \"\";\n\t\t\t\t\tthis.Recalc (d, $o, false);\n\t\t\t\t}\n\t\t\t\treturn d.srcsize?[\"srcsize\"]:[];\n\t\t\t},\n\t\t\twatch:\"#folder\",\n\t\t\tcss:{ hide: function(d){ return !Object.size(d.crop)} }\n\t\t},\n\t\t\"#fw\": {\n\t\t\t\"bind\": function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.width=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)\t) d.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.width+\"\";\n\t\t\t},\n\t\t\trecalcDepth:1,\n\t\t\tdelay:20,\n\t\t\twatch:'#fh,#folder,input[name=\"srcsize\"]',\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !Object.size(d.crop)},\n\t\t\t\t\"self:gray\":function(d,v,$o){\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#fh\": {\n\t\t\t\"bind\": function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.height=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)) d.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.height+\"\";\n\t\t\t},\n\t\t\twatch:\"#fw\",\n\t\t\trecalcDepth:1,\n\t\t\tdelay:20,\n\t\t\tcss:{\n\t\t\t\t\"self:gray\":function(d,v,$o){\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/*\"#mode\": {\n\t\t\t\"bind\": \"width\",\n\t\t\t\"init\": function ($o) {\n\t\t\t\t$o.tags({tags:[[{\"Attach\":\"attach\"}]], empty:{\"Inline\":\"inline\"}})\n\t\t\t}\n\t\t},*/\n\t\t\"#file\": {\n\t\t\t\"bind\": function (d, v, $o){\n\t\t\n\t    \t\tvar f,that = this,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\timg=\"\";\n\t    \t\t\n\t    \t\t\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\td.filename = f.name\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.replace(/[^a-z0-9\\-\\.]/gi,'')\n\t\t\t\t\t\t\t.replace(/\\.[^\\.]+$/,\"\")+\".jpg\";\n\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\timg = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tfr.onloadend = function (){\n\t\t\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\t\t\td.scale = $img[0].naturalWidth/$img.width();\n\t\t\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\t\t\tallowMove:true\n\t\t\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\t\t\tthis.animateTo([0,0,100,100]);\n\t\t\t\t\t\t\t\t\td.crop.z=1;\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#folder\").trigger(\"check\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\timg=\"\";\n\t\t\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$img.removeClass(\"hide\")\n\t\t\t\t\t\t\t\t.attr(\"src\",\"data:image/jpeg;base64,\"+img);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//d.scale=$img[0].naturalWidth/$img.width();\t\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction preview(c){\n\t\t\t\t\t$.extend(d.crop, Object.select(c,[\"x\",\"y\",\"w\",\"h\"]));\n\t\t\t\t\td.cropped=true;\n\t\t\t\t\t\n\t\t\t\t\tthat.Recalc(d, $o, true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/*\"#btn-orig\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v !=null) {\n\t\t\t\t\tvar f = $o.my(\"find\",\"#file\")[0].files[0];\n\t\t\t\t\tif (f) {\n\t\t\t\t\t\td.type=f.type;\n\t\t\t\t\t\td.filename = f.name;\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\td.data = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t\t//console.log(d.type)\n\t\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\twatch:\"#folder\",\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d){ return !Object.size(d.crop)}\n\t\t\t}\n\t\t},*/\n\t\t\"#btn-apply\": {\n\t\t\t\"bind\": function (d,v,$o) {\n\t\t\t\tvar f, that = this,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$c = $r.find(\"#x1\"),\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\t$c2 = $r.find(\"#x2\"),\n\t\t\t\t\tn={k:d.scale}, img=\"\",\n\t\t\t\t\twidth=d.width*1.5;\n\t\t\t\n\t\t\t\tif (v!=null && d.cropped) {\n\t\t\t\t\t_create (d.crop);\n\n\t\t\t\t\td.data = $o.my(\"find\",\"#x1\")[0]\n\t\t\t\t\t\t.toDataURL('image/jpeg',0.97)\n\t\t\t\t\t\t.substr(23);\n\t\t\t\t\t$o.my().root.trigger(\"commit\");\n\t\t\t\t}\n\n\t\t\t\tfunction _create (c){\n\t\t\t\t\tif(parseInt(c.w) > 0) {\n\t\t\t\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\t\t\tk = n.k,\n\t\t\t\t\t\t\tw = c.w*k, // scale width/height\n\t\t\t\t\t\t\th = c.h*k; \n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!that.Active) {\n\t\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\t\tctx.drawImage(img, (c.x*k).floor(), (c.y*k).floor(), d.width*1, d.height*1, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t\t\n\t\t\t\t\t\t} else { \n\t\t\t\t\t\t\tif (w>d.width*2) {\n\t\t\t\t\t\t\t\tcs2 = $c2[0];\n\t\t\t\t\t\t\t\tcs2.width=d.width*2;\n\t\t\t\t\t\t\t\tcs2.height=2*d.height;\n\t\t\t\t\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\t\t\t\t\tctx2.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*2,d.height*2);\n\n\t\t\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\t\t\tctx.drawImage(cs2, 0, 0, d.width*2,d.height*2, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\t\t\tctx.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"events\": \"click.my\",\n\t\t\twatch:\"#folder\",\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d){ return !Object.size(d.crop)}\n\t\t\t}\n\t\t},\n\t\t\"#btn-close\": {\n\t\t\t\"bind\": function (d,v,$o) {if (v!=null) $o.trigger(\"cancel\");},\n\t\t\t\"events\": \"click.my\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1409001251370","id": ".DocParams","type": "js","data": "({\n\tinit: function($o, form){ \n\t\t$o.formgen(this.HTML);\n\t\tvar that = this, d = form.data;\n\t\tif (!(d.creds.crypto+\"\")) {\n\t\t\t$.extend(!0, that.s3, d.s3);\n\t\t} else if (cw.crypto.has(d.creds.crypto)) {\n\t\t\tif (!d.creds.CRYPTO) {\n\t\t\t\td.creds.crypto = \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar s3 = cw.crypto.dec(d.creds);\n\t\t\t\tif (!s3.CRYPTO) {\n\t\t\t\t\t$.extend(!0, that.s3, s3.s3);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthat.nokey = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t} else {\n\t\t\tthat.nokey = true;\n\t\t}\n\t},\n\tnokey:false,\n\ts3:{\n\t\taccessKeyId:'',\n\t\tsecretAccessKey:'',\n\t\tregion:''\n\t},\n\tui:{\n\t\t\"#s3title\":{\n\t\t\tbind:\"name\",\n\t\t\tcheck:/^.+$/\n\t\t},\n\t\t\"#s3id\":{\n\t\t\tbind:\"this.s3.accessKeyId\",\n\t\t\tcheck:/^.+$/\n\t\t},\n\t\t\"#s3key\":{\n\t\t\tbind:\"this.s3.secretAccessKey\",\n\t\t\tcheck:/^.+$/\n\t\t},\n\t\t\"#s3region\":{\n\t\t\tbind:\"this.s3.region\",\n\t\t\tcheck:/^[a-z0-9]{2}\\-[a-z0-9]{2,20}\\-[0-9]$/i\n\t\t},\n\t\t\"#s3bucket\":{\n\t\t\tbind:\"site.s3bucket\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{2,50}$/i\n\t\t},\n\t\t\"#s3folder\":{\n\t\t\tbind:\"site.s3folder\",\n\t\t\tcheck:/^(|([a-z0-9\\-\\.]{1,30}\\/){0,2}[a-z0-9\\-\\.]{1,30}\\/?)$/i\n\t\t},\n\t\t\"#url\":{\n\t\t\tbind:\"site.siteBase\",\n\t\t\tcheck:/^http[s]?:\\/\\/.{3,200}$/\n\t\t},\n\t\t\"#preview\":{\n\t\t\tbind:\"site.previewBase\",\n\t\t\tcheck:/^http[s]?:\\/\\/.{3,200}$/\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tvar that = this, i;\n\t\t\t\t\tif (d.creds.crypto+\"\" && !that.nokey) {\n\t\t\t\t\t\tfor (i in d.s3) d.s3[i]=\"\";\n\t\t\t\t\t\td.creds.s3 = Object.clone(Object.reject(that.s3,\"CRYPTO\"), true);\n\t\t\t\t\t\td.creds = cw.crypto.enc(Object.reject(d.creds,\"CRYPTO\"));\n\t\t\t\t\t} else if (!(d.creds.crypto+\"\")) {\n\t\t\t\t\t\t$.extend(d.s3,Object.reject(that.s3,\"CRYPTO\"));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#cryptokey\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.creds.crypto=v;\n\t\t\t\t\tif (v!=\"_\") d.creds.crypto=v;\n\t\t\t\t\telse d.creds.crypto=\"\";\n\t\t\t\t}\n\t\t\t\treturn v||d.creds.crypto||\"_\";\n\t\t\t},\n\t\t\tinit: function($o) {\n\t\t\t\t$o.html(\n\t\t\t\t\t[ {id:\"_\",name:\"No encryption\"} ]\n\t\t\t\t\t.add( cw.crypto.keys() )\n\t\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t\t},\"\")\n\t\t\t\t).select2();\n\t\t\t}\n\t\t},\n\t\t\"#haskey\":{\n\t\t\tcss:{\n\t\t\t\thide: function(){ return !!this.nokey}\n\t\t\t}\n\t\t},\n\t\t\"#nokey\":{\n\t\t\tcss:{\n\t\t\t\thide: function(){return !this.nokey}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<h4 class=\"mb10\">AWS S3 and preview settings</h4>',\n\t\t{row:\"525px\", label:\"125px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray\"},\n\t\t\n\t\t['Title','inp#s3title.bold'],\n\t\t\n\t\t['Site URL','inp#url'],\n\t\t['Preview URL','inp#preview'],\n\t\t\n\t\t['S3 path','<span>', 'inp#s3region.w100', {plc:\"Region\"},\n\t\t\t'</span><span class=\"w15 dib gray tac\">/</span><span>',\n\t\t\t'inp#s3bucket.w170', {plc:\"Bucket\"},\n\t\t\t'</span><span class=\"w15 dib gray tac\">/</span><span>',\n\t\t\t'inp#s3folder.w100',{plc:\"Folder\"},'</span>'],\n\t\t'<section id=\"haskey\">',\n\t\t\t['S3 access key Id','inp#s3id'],\n\t\t\t['S3 secret key','inp#s3key'],\n\n\t\t\t['Encrypt creds','sel#cryptokey.w200',' <span class=\"fs80 gray pl10\">Key to encrypt secrets</span>'],\n\t\t\n\t\t'</section>',\n\t\t'<section id=\"nokey\" class=\"hide red fs90 pt10 pb10\">',\n\t\t\t'Credentials are encrypted with the key you don‘t have, sorry.',\n\t\t'</section>',\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Save\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1409263717515","id": ".ParseErrors","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML);\n\t},\n\tparams:{ width:450 },\n\tui:{\n\t\t\"#errs\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tvar i, h = '<table width=\"450\">';\n\t\t\t\tfor (i in d.err) {\n\t\t\t\t\th+='<tr><td class=\"w150 xgray pr15 brw btd\">'\n\t\t\t\t\t\t+i+'</td><td class=\"red vam btd\">'\n\t\t\t\t\t\t+d.err[i].join(\"<br>\")\n\t\t\t\t\t\t+'</td></tr>';\n\t\t\t\t}\n\t\t\t\treturn h+'</table>'\n\t\t\t}\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#errtitle\":function(d){\n\t\t\tvar i = Object.size(d.err), e = Object.values(d.err).flatten().length;\n\t\t\treturn \"Found \"+e+\" error\"+(e>1?\"s\":\"\")+\" in \"+i+\" item\"+(i>1?\"s\":\"\");\n\t\t},\n\t\t\"#efooter\":{\n\t\t\tbind: function(d){ return \"&nbsp;\"+d.footer},\n\t\t\tcss:{\n\t\t\t\thide: function(d) {return !d.footer}\n\t\t\t}\n\t\t},\n\t\t\".ebtns\":{\n\t\t\tcss:{\n\t\t\t\thide: function(d) {return !d.buttons}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<h4 class=\"mb10 fs100\" id=\"errtitle\"></h4>',\n\t\t{row:\"450px\", label:\"100px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray\"},\n\t\t\n\t\t'<div id=\"errs\" class=\"fs80 w450\"></div>',\n\t\t\n\t\t'<div id=\"efooter\" class=\"fs80 fi-alert xgray mt5\"></div>',\n\t\t\n\t\t{rowCss:\"my-row pt12 mt7 btd fs80 ebtns\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Proceed\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t],\n\tstyle:{\n\t\t\" td\":\"padding:4px 0; font-size:85%; line-height:1.2em;\",\n\t\t\" .brw\":\"word-break:break-word\",\n\t\t\" #errs\":\"max-height:400px;overflow-y:auto;\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1438502921854","id": ".Takeout","type": "js","data": "({\n\t//params:{width:800},\n\tdata:{json:\"error\"},\n\tinit:[\n\t\t'<textarea id=\"json\" class=\"w100p h400 fs60 lh120 xgray o90\" disabled style=\"font-family:\\'Cousine\\'\"></textarea>',\n\t\t[\"\",\"btn#btn-ok.green.w100.mr30.fs90\",{val:\"Ok\"}, \n\t\t '<div class=\"gray fr mt7 fs80\" id=\"stats\"></div>',\n\t\t '<a href=\"\" download=\"\" id=\"btn-dl\" target=\"_blank\" class=\"fs90\">Download as a file</a>',\n\t\t],\n\t\t'<div id=\"comment\" class=\"fs70 gray\"></div>'\n\t],\n\tui:{\n\t\t\"#btn-ok\":function(d,v,$o){\n\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t},\n\t\t\"#json\":function(d){return d.json},\n\t\t\"#btn-dl\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tif (form.data.objurl) {\n\t\t\t\t\t$o.attr(\"download\", form.data.fname);\n\t\t\t\t\t$o.attr(\"href\", form.data.objurl);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\thide: function(d){return !d.objurl}\n\t\t\t}\n\t\t},\n\t\t\"#stats\":{\n\t\t\tbind:function(d) {return d.json.length.metric(2,false)+\"b\"}\n\t\t},\n\t\t'#comment':{\n\t\t\tbind:\"comment\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1438503686467","id": ".Confirm","type": "js","data": "({\n\tid:\"cw.Sys.YesNoCancel\",\n\tparams:{\n\t\tdelay:5, \n\t\twidth:450\n\t},\n\tdata:{\n\t\ttext:\"\",\n\t\tcss:\"xgray\",\n\t\tyes:\"Yes\",\n\t\tno:\"No\",\n\t\tcancel:\"Cancel\",\n\t\tcmd:\"\"\n\t},\n\tinit: function ($o, form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t    '<div class=\"'+d.css+'\">'+d.text+'</div>',\n\t\t\t{label:\"70px\", row:form.params.width+\"px\", rowCss:\"my-row mt15 pt15 fs90 mb-5 xgray btd\"},\n\t\t\t['', 'spn#btn-yes.button.green.mr5',{txt:d.yes}, \n\t\t\t \t'spn#btn-no.button.mr5',{txt:d.no}, \n\t\t\t\t'spn#btn-cancel.button.fr',{txt:d.cancel}]\n\t\t]);\n\t},\n\tui:{\n\t\t\"#btn-yes\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"yes\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.yes}\n\t\t\t}\n\t\t},\n\t\t\"#btn-no\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"no\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.no}\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"cancel\";\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.cancel}\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1408761116765","id": ".Item","type": "js","data": "({\n\t// item editor skeleton, \n\t// all controls except editor itself,\n\t// ui section is expanded when Item initialized\n\tinherit:[\"GetDoc\",\"GetActiveId\",\"RT\",\"Confirm\",\"Items2Atts\",\"Path\"],\n\tparams:{restyle:200},\n\tdata:{\n\t\tid:\"\", type:\"html\", snippet:false,\n\t\tfolder:\"\", name:\"index\", ext:\"html\",\n\t\tmime:\"text/html\", desc:\"\",\n\t\texternal:\"\",\n    dropImport: false,\n\t\tdata:\"\", // See tab\n\t\t\n\t\tparser:\"// Parser receives (item, _attachments)\\n\"\n\t\t\t+\"// and must return string representation of item\\n\"\n\t\t\t+'(function (item, atts){\\n\\n\\treturn item.data+\"\";\\n})',\n\t\tparserActive:false,\n\t\t\n\t\tcache:\"86400\",\n\t\t\n\t\tstate:{\n\t\t\tsavedSdbm:\"\",\n\t\t\tsdbm:\"\",\n\t\t\tdepends:{},\n\t\t\timpacts:{}\n\t\t}\n\t\t\n\t},\n\tTrack: function(item) {\n\t\tvar it=item, att,\n\t\t\t\tparser;\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t}\n\t},\n\tinit: function($o, form){\n\t\tvar that = this;\n\t\t$o.html($.my.formgen(this.HTML)+$.my.formgen(this.HTMLtail));\n\t\t\n\t\t\n\t\t$o.then(function(){\n\t\t\t$o.find(\"#xparser\").addClass(\"hide\").css({opacity:1});\n\t\t\t$o.on(\"change.my\", function(){\n\t\t\t\tthat.Track(form.data);\n\t\t\t\tif (form.data.state.sdbm !== form.data.state.savedSdbm) {\n\t\t\t\t\t$o.parent().my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t}\n\t\t\t}.debounce(300));\n\t\t});\n\t\t\n\t\t$o.on(\"click.my\",\"#warn\", function(){\n\t\t\tvar $c = $(this);\n\t\t\tif ($c.data(\"modal\")) return $c.modal(true);\n\t\t\tif (that.Err) {\n\t\t\t\tvar e = that.Err(that.data.data);\n\t\t\t\t$c.modal({\n\t\t\t\t\twidth:250,\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tbound:0,\n\t\t\t\t\talign:\"top:120%;left:0;\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tmanifest:{\n\t\t\t\t\t\tinit:['<span id=\"t\" class=\"red lh150\"></span>'],\n\t\t\t\t\t\tui:{\"#t\":\"t\"}\n\t\t\t\t\t},\n\t\t\t\t\tdata:{t:e},\n\t\t\t\t\tcss:\"fs80\"\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t},\n\tui:{ /* See tab */ },\n\tvalidator: function(){},\n\tHTML:['<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:200px\">',\n\t\t\t\t'<div class=\"db epane\">',\n\n\t\t\t/*'<div class=\"control\">', \n\t\t\t\t'<span id=\"xparse\">',\n\t\t\t\t\t'<button class=\"btn mr2 button btn-l pl6\" id=\"btn-parser\"><span class=\"fi-page-export\" title=\"Parser\"></span></button>', \n\t\t\t\t'</span>',\n\t\t\t\t'<button class=\"btn button mr0\" id=\"btn-settings\"><span class=\"fi-widget\"  title=\"Settings\"></span></button>',\n\t\t\t'</div>',*/\n\t\t\t'<div class=\"control\">', \n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-rendertab\" title=\"Render\">',\n\t\t\t\t\t\t\t'<span class=\"fi-shopping-bag\" ></span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-c pl1 pr2 bold\" id=\"btn-parser\" title=\"Parser\">',\n\t\t\t\t\t\t'<span class=\"lh100 fs110\" style=\"letter-spacing:-1px;\">&gt;_</span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-c pr1 pl1\" id=\"btn-deps\" title=\"Dependencies\">',\n\t\t\t\t\t\t'<span class=\"fi-share\" ></span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn button mr0 btn-r pr3\" id=\"btn-settings\"  title=\"Settings\">',\n\t\t\t\t\t\t'<span class=\"fi-widget\" ></span>',\n\t\t\t\t\t'</button><span>',\n\t\t\t\t'</div>',\n\n\t\t\t'<div id=\"fname\" class=\"fs90 xgray lh120\"></div> ',\n\t\t\t'<div id=\"warn\" class=\"fs80 red fi-alert lh120\"></div> ',\n\t\t\t'<div id=\"showhideproxy\"></div>',\n\t\t\t'</div>',\n\t\t\t'<textarea id=\"editor\" style=\"width:100%\" class=\"edheight\"></textarea>',\n\t\t'</div>',\n\t\t'<div id=\"xparser\" class=\"edwidth\" style=\"opacity:0.005\">',\n\t\t'<div style=\"position:absolute;top:3px;right:5px;z-index:+5\">',\n\t\t\t'<button class=\"fs80 green tac btn-l mr2 button pr7 pl12 lh100\" id=\"btn-source\">',\n\t\t\t'<span class=\"fi-page-edit\" title=\"Source\"></span>',\n\t\t\t'</button>' ,\n\t\t\t'<button  id=\"btn-play\" title=\"Run parser\" ',\n\t\t\t\t'class=\"button green fs80 mt0 mb0 mr0 btn-r pl10 pr12 lh100\"><span '\n\t\t\t\t+ 'class=\"fi-play\"></span></button>',\n\t\t'</div>',\n\t\t'<div class=\"dib vat b1g\" style=\"width:100%;min-height:200px\">',\n\t\t\t'<textarea id=\"parser\" class=\"\" style=\"width:100%\"  class=\"edheight\"></textarea>',\n\t\t'</div></div>'\n\t],\n\t\n\tHTMLtail:[],\n\t\n\tstyle:{\n\n\t\t\n\t\t\" .epane\":\"width: 330px;position: absolute;top: 2px;right: 0px;z-index: +5;background: rgba(255,255,255,0.0);\"\n\t\t\t\t+\"border-radius: 10px;padding: 0px 5px;\",\n\t\t\n\t\t\" .control\":{\n\t\t\t\"\":\" font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;\",\n\t\t\t\" .button\": \"padding-bottom: 0.35em;\",\n\t\t\t\":hover\":\"opacity:1\"\n\t\t},\n\t\t\n\t\t\" .btn\":\"width:2em; height:2em; border-radius:2em; line-height:2em; \"\n\t\t\t+\"vertical-align:middle; text-align:center;padding:0;display:inline-block;\",\n\t\t\n\t\t\n\t\t\" #fname\":\"word-wrap: break-word; white-space: pre; padding: 5px 0;\"\n\t\t\t\t+\"font-weight: bold;width: 190px;margin-top: 5px;\",\n\t\t\" #xeditor .CodeMirror\": function($o, form){\n\t\t\t\t\t\n\t\t\tif (form.data.external && !/^[\\sx]/.test(form.data.external)) return \"background-color:rgba(0,0,0,0.03);opacity: 0.6;\";\n\t\t\telse return \"\";\n\t\t}\n\t},\n\t\n\tPlayParser:{\n\t\tinit: function($o, form){\n\t\t\t$o.html('<div><textarea id=\"txt\" disabled=\"disabled\"></textarea></div>')\n\t\t}, \n\t\tui:{\n\t\t\t\"#txt\":\"txt\"\n\t\t},\n\t\tstyle:{\n\t\t\t\" textarea\":\"line-height:1.4em;font:12px Cousine,'PT Mono', Monaco,monospace;height:400px;overflow:scroll;\"\n\t\t\t+\"width:800px; white-space:pre-wrap; word-break: break-all;color: #666!important;opacity: 1!important;\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1409363994487","id": ".Item.ui","type": "js","data": "({\n\t\n\t// Editor\n\t\n\t\"#warn\":{\n\t\tbind: function(d, v, $o){\n\t\t\tvar r, that = this;\n\t\t\tif (Object.isFunction(that.validator)){\n\t\t\t\ttry {\n\t\t\t\t\tr = that.validator(d);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t}\n\t\t\t$o.html(\n\t\t\t\tr\n\t\t\t\t?'&nbsp;<span class=\"'+(that.Err?'pseudolink red':'')+'\">'+r+'</span>'\n\t\t\t\t:\"\"\n\t\t\t);\n\t\t\t$o.toggleClass(\"hide\", !r);\n\t\t\t$o.my(\"find\",\"#xeditor\").toggleClass(\"b1r\", !!r);\n\t\t},\n\t\twatch:\"#editor\",\n\t\tdelay:500\n\t},\n\t\n\t\"#fname\":{\n\t\tbind: function(d){\n\t\t\tvar html=\"\", \n\t\t\t\t\tbase = this.GetSite().site.previewBase, \n\t\t\t\t\tp = !d.snippet && !!base;\n\t\t\tif (p) html+='<span class=\"gray fs85 fi-eye\"></span>&nbsp;';\n\t\t\t\t\n\t\t\thtml+= (d.folder?'<span class=\"gray\">'+d.folder+\"/</span>\":\"\");\n\t\t\t\n\t\t\tif (p) {\n\t\t\t\t\n\t\t\t\thtml+='<a target=\"_blank\" href=\"'\n\t\t\t\t\t\t+(base?base.replace(/\\/$/,'')+\"/\":\"\")\n\t\t\t\t\t\t+(d.folder?d.folder+\"/\":\"\")\n\t\t\t\t\t\t+d.name+\".\"+d.ext\n\t\t\t\t\t\t+'\">';\n\t\t\t}\n\t\t\thtml+= d.name+\".\"+d.ext;\n\t\t\t\n\t\t\tif (p) html+='</a>';\n\t\t\t\n\t\t\treturn html;\n\t\t}\n\t},\n\t\"#xparse\":{\n\t\tcss:{hide: function(d){return !d.parserActive}},\n\t\twatch:\"#fname\"\n\t},\n\t\"#btn-settings\":{\n\t\tbind: function(d,v,$o) {\n\t\t\tvar that = this, $f;\n\t\t\tif (v!=null) {\n\t\t\t\t$f = $o;//.my().root;\n\t\t\t\tif ($f.data(\"modal\")) $f.modal(true);\n\t\t\t\telse $f.modal({\n\t\t\t\t\tmanifest:$.extend({}, this.Settings, { RT:this.RT }),\n\t\t\t\t\tdata:Object.select(d, \n\t\t\t\t\t\t\"id type desc folder mime size name ext cache parserActive dropImport noIncludes snippet external\".split(\" \").add([/^[A-Z]/])\n\t\t\t\t\t),\n\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t(window.l||cw.lib).note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\talign:\"top:0;right:0\", \n\t\t\t\t\t// nose:\"top\",\n\t\t\t\t\troot:$o.my().root,\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t\n\t\t\t\t\t// moveAtt\n\t\t\t\t\tvar nold = that.RT().Path(d),\n\t\t\t\t\t\t\tnnew = that.RT().Path(res),\n\t\t\t\t\t\t\tdoc = that.RT().data.doc\n\t\t\t\t\tif (nold != nnew && doc._attachments) {\n\t\t\t\t\t\t//doc._attachments[nnew] = doc._attachments[nold];\n\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t}\n\t\t\t\t\t_fin();\n\t\t\t\t\t\n\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\twatch:\"#fname\"\n\t},\n\t\"#showhideproxy\":{\n\t\tbind: function(d,v,$o) {\n\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1410914579915","id": ".Item.ui","type": "js","data": "({\n\t// Parser\n\t\n\t\"#btn-deps\":{\n\t\tbind:function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tvar that = this, h=\"\";\n\n\t\t\t\tthat.RT().Items2Atts(null, null, {}, true, true);\n\t\t\t\t\n\t\t\t\tvar deps=Object.keys(d.state.depends||{}),\n\t\t\t\t\t\timps = Object.keys(d.state.impacts||{});\n\t\t\t\t\n\t\t\t\t//console.log(d);\n\t\t\t\t\n\t\t\t\tif (deps.length) {\n\t\t\t\t\th+='<div>Depends:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+deps.map(function(i){\n\t\t\t\t\t\t\treturn d.state.depends[i] ? i:'<span class=\"red\">'+i+'</span>';\n\t\t\t\t\t\t}).join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (imps.length) {\n\t\t\t\t\th+='<div>Impacts:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+imps.join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (h) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:$.extend(true, {},that.Confirm,{params:{width:250}}),\n\t\t\t\t\t\twidth:250,\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttext:h, yes:\"Ok\", \tno:\"\", cancel:\"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\tcss:\"fs100 lh170 pb20\",\n\t\t\t\t\t\tesc:true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.lib.note(\"Item has no dependencies.\",\"ok\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\twatch:\"#fname\"\n\t},\n\t\n\t\"#btn-rendertab\":{\n\t\tbind:function(){},\n\t\t/*css:{\n\t\t\t\":disabled\": function(d){return !!d.snippet}\n\t\t},*/\n\t\twatch:\"#fname\"\n\t},\n\t\n\t\"#btn-play\":{\n\t\tdelay:100,\n\t\tbind: function (d,v,$o) {\n\t\t\tvar parser, res, err, atts={}, html=\"\", that=this;\n\t\t\tif (v!=null) {\n\t\t\t\t\n\t\t\t\tif(d.parserActive) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tparser = eval(d.parser);\n\t\t\t\t\t} catch (e){ \n\t\t\t\t\t\tconsole.log(err=\"Parser code has errors, \"+e.message, e.stack);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Object.isFunction(parser)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tres = parser(d, atts)+\"\";\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\tconsole.log(err=\"Parser/generator error, \"+e.message, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} \n\t\t\t\t\n\t\t\t\tif (res) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:that.PlayParser,\n\t\t\t\t\t\tdata:{txt:res},\n\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\twidth:800,\n\t\t\t\t\t\tglobal:true,\n\t\t\t\t\t\tscreen:true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (err) {\n\t\t\t\t\t(window.l||cw.lib)[\"note\"](err,\"error\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcheck:function(d,v,$o){\n\t\t\tvar parser, err;\n\t\t\ttry {parser = eval(d.parser);} catch (e){}\n\t\t\terr = (!Object.isFunction(parser)?\"Error\":\"\");\n\t\t\t$o.toggleClass(\"red\",!!err);\n\t\t\treturn err;\n\t\t},\n\t\twatch:\"#parser\"\n\t},\n\t\"#parser\":{\n\t\tbind:\"parser\",\n\t\tinit: function($o, form){\n\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: \"javascript\",\n\t\t\t\tlineNumbers:true,\n\t\t\t\tindentWithTabs:!0,\n\t\t\t\tindentUnit:2,\n\t\t\t\ttabSize:2,\n\t\t\t\ttheme: \"default\"\n\t\t\t});\n\t\t}\n\t},\n\t\"#btn-source\":{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#editor\");\n\n\t\t\t\t$e.parent().toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-parser\":{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#editor\");\n\n\t\t\t\t$e.parent().toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t\"hide\": function(d){return !d.parserActive}\n\t\t},\n\t\twatch:\"#fname\"\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1409100475509","id": ".Item.Settings","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML.add(this.Aux).add(this.Buttons));\n\t},\n\tparams:{width:550},\n\tui:{\n\t\t\"#name\":{\n\t\t\tbind:\"name\",\n\t\t\tcheck:function(d,v){\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\tif (this.RT().getDup(d, v)) return \"Already taken\";\n\t\t\t},\n\t\t\twatch:\"#folder,#ext\"\n\t\t},\n\t\t\"#folder\":{\n\t\t\tbind:\"folder\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{0,20}$/i\n\t\t},\n\t\t\"#ext\":{\n\t\t\tbind:\"ext\",\n\t\t\tcheck:/^[a-z0-9\\-]{0,20}$/\n\t\t},\n\t\t\"#mime\":{\n\t\t\tbind:\"mime\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{1,20}\\/[a-z0-9\\-\\.]{1,20}$/\n\t\t},\n\t\t'#external':{\n\t\t\tbind:\"external\",\n\t\t\tcheck: function(d,v) {\n\t\t\t\tif (!/^[x\\s]?(|(http|https|pouch|doc|local|query):\\/\\/[^\\s\\n\\t]+(\\s[\\S]+)?)$/.test(v)) {\n\t\t\t\t\treturn 'External URL or <i>local://doc_id propertyName</i>';\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"self:tdl\":function(d,v) {return v.to(1)==\"x\" || v.to(1)==\" \"},\n\t\t\t\t\"self:fs85\":function(d,v) {return v.length>50 && v.length<66},\n\t\t\t\t\"self:fs70\":function(d,v) {return v.length>65}\n\t\t\t}\n\t\t},\n\t\t'input[name=\"snippet\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t},\n\t\t\trecalc:\"#cache\"\n\t\t},\n\t\t'input[name=\"parser\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.parserActive = !!(v+\"\");\n\t\t\t\treturn d.parserActive?[\"parser\"]:[];\n\t\t\t}\n\t\t},\n    'input[name=\"dropimport\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.dropImport = !!(v+\"\");\n\t\t\t\treturn d.dropImport?[\"dropimport\"]:[];\n\t\t\t},\n      css:{\n      \thide: function(d,v){return !d.external || d.external[0]==' ';}\n      },\n      watch:'#external'\n\t\t},\n\t\t'input[name=\"noincludes\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.noIncludes = !!(v+\"\");\n\t\t\t\treturn d.noIncludes?[\"noincludes\"]:[];\n\t\t\t}\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-delitem\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t\n\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t})\n\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t.delay(50);\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){\n\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#folder,#name\"\n\t\t},\n\t\t\"#cache\":{\n\t\t\tinit:function($o) {\n\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t},\n\t\t\tbind: \"cache\",\n\t\t\tcss:{\n\t\t\t\thide: function(d){return d.snippet}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<h4 class=\"mb10\">Resource settings</h4>',\n\t\t{row:\"550px\", label:\"116px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray\"},\n\t\t\n\t\t[\"\",\n\t\t \t'<span>', \n\t\t\t'inp#folder.w100', {plc:\"Folder\"} ,\n\t\t\t'</span> / <span class=\"dib vat w200\">', \n\t\t\t'inp#name.w200', {plc:\"Filename\"} , \"msg.fs80\",\n\t\t\t'</span> . ',\n\t\t\t'<span>','inp#ext.w50', {plc:\"Ext\"}, '</span> :: ',\n\t\t\t'<span class=\"fr\">','inp#mime.w140', {plc:\"MIME\"}, '</span>'\n\t\t],\n\t\t\n\t\t//[\"\",'inp#external.w550',{plc:\"External resource URL\"},\"msg.fs80\"],\n    \n    [\"Linked to\",'txt#external.fs90',{plc:\"External resource URL\"},\"msg.fs80\"],\n    [\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"dropimport\" value=\"dropimport\"/>',\n\t\t '<span> Do not store imported data in document</span>',\n\t\t '</label>'\n\t\t],\n\t\t\t\t\t\t\t\t \n\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t['Cache-control','spn#cache.fs85'],\n\t\t\n\t\t{rowCss:\"my-row pb3\"},\n\t\t[\"Mode\", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>',\n\t\t ' Fragment (no file created)',\n\t\t '</label>'\n\t\t],\n\t\t[\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"noincludes\" value=\"noincludes\"/>',\n\t\t '<span> Skip includes</span>',\n\t\t '</label>'\n\t\t],\n\t\t[\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"parser\" value=\"parser\"/>',\n\t\t '<span> Additional parser</span>',\n\t\t '</label>'\n\t\t]\n\t],\n\tAux:[],\n\tButtons:[\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Apply\"},' ', \n\t\t \t\t\t'btn#btn-cancel', {val:\"Cancel\"}, ' ', \n\t\t \t\t\t'btn#btn-delitem.red.fr', {val:\"Delete\"}]\n\t]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1411208469331","id": ".Item.data.data","type": "html","data": "<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title> Insert title here </title>\n\t</head>\n\t<body>\n\t\tHello, world!\n\t</body>\n</html>","active": false,"opts": [],"err": [],"color": ["orange"]},{"stamp": "1408679397963","id": ".Types","type": "js","data": "({\n\t\"html\": {\n\t\tname:\"HTML\",\n\t\text:\"html\",\n\t\tmime:\"text/html\",\n\t\tprimary:true,\n\t\tstringify: function(e) { return e.data+\"\" },\n\t\tdefaults:{ data:'<!-- HTML -->\\n\\n\\n' },\n\t\textend:{\n\t\t\tui:{\n\t\t\t\t\"#editor\":{\n\t\t\t\t\tinit: function($o, form){\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"htmlmixed\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbind:\"data\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treplace:{\n\t\t\t//HTML:[]\n\t\t},\n\t\tmanifest:null\n\t},\n\t\n\t// ##############################\n\t\n\t\"js\": { /* See tab */ },\n\t\n\t// ##############################\n\t\n\t\"json\": {\n\t\tname:\"JSON\",\n\t\text:\"json\",\n\t\tmime:\"application/json\",\n\t\tstringify: function(e) { \n\t\t\tvar t;\n\t\t\ttry { \n\t\t\t\tt = eval (\"(\"+e.data+\")\"); \n\t\t\t} catch (err) {}\n\t\t\tif (Object.isObject(t) || Object.isArray(t)) return $.my.tojson(t);\n\t\t\tt=null;\n\t\t\treturn e.data;\n\t\t},\n\t\tdefaults:{ data:'({\\n\\t/* Put JSON here */\\n})' },\n\t\textend:{\n\t\t\tui:{\n\t\t\t\t\"#editor\":{\n\t\t\t\t\tinit: function($o, form){\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"javascript\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbind:\"data\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tvalidator: function(d){\n\t\t\t\tvar r, f;\n\t\t\t\ttry {\n\t\t\t\t\t//f = new Function([], \"return \"+d.data+\";\");\n\t\t\t\t\t\n\t\t\t\t\tf = new Function([], \"return \"+d.data+\";\");\n\t\t\t\t\t$.my.tojson(f());\n\t\t\t\t\t\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t\tf=null;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t},\n\t\treplace:{},\n\t\tmanifest:null\n\t},\n\t\n\t// ##############################\n\t\n\t\"css\": {\n\t\tname:\"CSS\",\n\t\text:\"css\",\n\t\tmime:\"text/css\",\n\t\tstringify: function(e) { return e.data+\"\"},\n\t\tdefaults:{ data:'/* CSS */' },\n\t\textend:{\n\t\t\tui:{\n\t\t\t\t\"#editor\":{\n\t\t\t\t\tinit: function($o, form){\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"css\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbind:\"data\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treplace:{},\n\t\tmanifest:null\n\t},\n\t\n\t// ##############################\n\t\n\t\"txt\": {\n\t\tname:\"Text\",\n\t\text:\"txt\",\n\t\tmime:\"text/plain\",\n\t\tstringify: function(e) { return e.data+\"\"},\n\t\tdefaults:{data:'\\n\\n\\n'},\n\t\textend:{\n\t\t\tui:{\n\t\t\t\t\"#editor\":{\n\t\t\t\t\tinit: function($o, form){\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: \"text\",\n\t\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbind:\"data\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treplace:{},\n\t\tmanifest:null\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1410999823546","id": ".Types.attachment","type": "js","data": "({\n\tname:\"File attachment\",\n\text:\"\",\n\tmime:\"\",\n\tstringify: function(e) { return \"\"},\n\tnoInsert:true,\n\tdefaults:{},\n\tmanifest:{\n\t\tinherit:[\"GetDoc\",\"GetActiveId\",\"RT\",\"Confirm\",\"Items2Atts\",\"Path\"],\n\t\tdata:{\n\t\t\tid:\"\", folder:\"\", name:\"\", mime:\"\", parser:\"\", parserActive:false,\n\t\t\text:\"\", cache:\"864000\", data:\"\", snippet:false, size:\"?\",\n\t\t\tdesc:\"\", \n\t\t\tstate:{\n\t\t\t\tsavedSdbm:\"\", sdbm:\"Z\",\n\t\t\t\tdepends:{}, impacts:{}\n\t\t\t}\n\t\t},\n\t\tinit: function($o, form){\n\t\t\tvar db, d = form.data,\n\t\t\t\t\tthat = this;\n\t\t\t$o.formgen(this.HTML);\n\t\t\t$o.then(function(){\n\t\t\t\tif (!d.preview && /^image\\//.test(d.mime)) {\n\t\t\t\t\t// generate preview\n\t\t\t\t\tvar path = that.Path(d),\n\t\t\t\t\t\t\tatts = that.GetDoc()._attachments || {},\n\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\trev = that.GetDoc()._rev,\n\t\t\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t\n\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\tvar ico = cw.lib.image($img).resample(120);\n\t\t\t\t\t\tif (ico.height()>120) ico.resample(120 * 120/ico.height())\n\t\t\t\t\t\td.preview = ico.sharpen(0.1).contrast(1.05).jpeg(0.75);\n\t\t\t\t\t\t$o.find(\"#fpic\").trigger(\"recalc\");\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tif (rev) {\n\t\t\t\t\t\tvar att = atts[path];\n\t\t\t\t\t\tif (!att || !att.data) {\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdbatt.image(path).then(function(obj, data){\n\t\t\t\t\t\t\t\t//console.log(id, obj, data)\n\t\t\t\t\t\t\t\t$img.attr(\"src\", obj[path].image);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (att.data.length<1e7) {\n\t\t\t\t\t\t\t$img.attr(\"src\",\"data:\"+att.content_type+\";base64,\"+att.data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t},\n\t\tui:{\n\t\t\t\"#fpic\":function(d){\n\t\t\t\tif (d.preview) return '<img src=\"'+d.preview+'\"/>';\n\t\t\t\telse return \"\";\n\t\t\t},\n\t\t\t\"#fname\":{\n\t\t\t\tbind: function(d){\n\t\t\t\t\tvar html=\"\", \n\t\t\t\t\t\t\tbase = this.GetSite().site.previewBase, \n\t\t\t\t\t\t\tp = !d.snippet && !!base;\n\t\t\t\t\tif (p) html+='<span class=\"gray fs85 fi-eye\"></span>&nbsp;';\n\n\t\t\t\t\thtml+= (d.folder?'<span class=\"gray\">'+d.folder+\"/</span>\":\"\");\n\n\t\t\t\t\tif (p) {\n\n\t\t\t\t\t\thtml+='<a target=\"_blank\" href=\"'\n\t\t\t\t\t\t\t\t+(base?base.replace(/\\/$/,'')+\"/\":\"\")\n\t\t\t\t\t\t\t\t+(d.folder?d.folder+\"/\":\"\")\n\t\t\t\t\t\t\t\t+d.name+\".\"+d.ext\n\t\t\t\t\t\t\t\t+'\">';\n\t\t\t\t\t}\n\t\t\t\t\thtml+= d.name+\".\"+d.ext;\n\n\t\t\t\t\tif (p) html+='</a>';\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#fmime\":{\n\t\t\t\tbind:\"mime\",\n\t\t\t\twatch:\"#fname\"\n\t\t\t},\n\t\t\t\"#fsize\":{\n\t\t\t\tbind:function(d) {\n\t\t\t\t\treturn isNaN(d.size)?\"\":(d.size*1)+\" байт\"; \n\t\t\t\t},\n\t\t\t\twatch:\"#fname\"\n\t\t\t},\n\t\t\t\"#btn-settings\":{\n\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\t\t\telse $o.modal({\n\t\t\t\t\t\t\tmanifest:$.extend({}, this.Settings, { RT:this.RT }),\n\t\t\t\t\t\t\tdata:Object.select(d, [\"id\",\"folder\",\"mime\",\"size\",\"name\",\"ext\",\"cache\"]),\n\t\t\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t(window.l||cw).note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\twidth:550,\n\t\t\t\t\t\t\talign:\"top:0;right:0\", // nose:\"top\"\n\t\t\t\t\t\t}).then(function(res){\n\t\t\t\t\t\t\t// moveAtt\n\t\t\t\t\t\t\tvar db, \n\t\t\t\t\t\t\t\t\tnold = that.RT().Path(d),\n\t\t\t\t\t\t\t\t\tnnew = that.RT().Path(res),\n\t\t\t\t\t\t\t\t\tdoc = that.RT().data.doc;\n\t\t\t\t\t\t\tif (nold != nnew && doc._attachments) {\t\n\t\t\t\t\t\t\t\tif (doc._attachments[nold].data) {\n\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(doc._attachments[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t// we need to load it\n\t\t\t\t\t\t\t\t\tif (db = that.RT().db) {\n\t\t\t\t\t\t\t\t\t\t// cloudwall.me runtime\n\t\t\t\t\t\t\t\t\t\tdb.att(doc._id).data(nold).then(function(att){\n\t\t\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(att[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse _fin();\n\n\t\t\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\twatch:\"#fname\"\n\t\t\t},\n\t\t\t\"#showhideproxy\":{\n\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#btn-download\":{\n\t\t\t\tbind: function(d,v,$o){\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tvar path = that.RT().Path(d),\n\t\t\t\t\t\t\t\tdoc = that.RT().data.doc,\n\t\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\t\tatt, url=\"\";\n\t\t\t\t\t\tif (doc._attachments && doc._attachments[path] && null!=doc._attachments[path].data) {\n\t\t\t\t\t\t\tatt = doc._attachments[path];\n\t\t\t\t\t\t\t_showModal(att);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// read att\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\tdbatt.data(path).then(function(obj){\n\t\t\t\t\t\t\t\t_showModal(obj[path]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//- - - - - -\n\t\t\t\t\t\n\t\t\t\t\tfunction _showModal(att) {\n\t\t\t\t\t\tvar blob = $.my.f.base642blob(att.data, null, att.content_type),\n\t\t\t\t\t\t\t\turl = URL.createObjectURL(blob);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\tinit:[ \n\t\t\t\t\t\t\t\t\t'<a href=\"'\t+url+'\" '\n\t\t\t\t\t\t\t\t\t+(!/^image\\//.test(att.content_type)\n\t\t\t\t\t\t\t\t\t\t?'download=\"'+that.RT().Path(d).split(\"/\").last()+'\"'\n\t\t\t\t\t\t\t\t\t\t:'')\n\t\t\t\t\t\t\t\t\t+'target=\"_blank\">Click to download</a>' \n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tui:{ 'a':'a' }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:\"p20 tac fs90\",\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.7)\",\n\t\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\t\twidth:150\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tvalidator: function(){},\n\t\t\n\t\tHTML:[\n\t\t\t'<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:200px; padding:35px 100px 35px 50px;\">',\n\t\t\t\t'<div class=\"db epane\">',\n\t\t\t\t\t'<div class=\"control\">', \n\t\t\t\t\t\t'<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-download\" title=\"Render\">',\n\t\t\t\t\t\t\t\t'<span class=\"fi-shopping-bag\" ></span>',\n\t\t\t\t\t\t'</button></span>', \n\t\t\t\t\t\t'<button class=\"btn button mr0 btn-r\" id=\"btn-settings\"><span class=\"fi-widget\"  title=\"Settings\"></span></button>',\n\t\t\t\t\t'</div>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"fpic\" class=\"tac\"></div>',\n\t\t\t\t'<div id=\"fname\" class=\"fs110 xgray lh120 tac\"></div> ',\n\t\t\t\t'<div id=\"fmime\" class=\"fs80 gray tac\"></div> ',\n\t\t\t\t'<div id=\"fsize\" class=\"fs80 gray tac\"></div> ',\n\t\t\t\t'<div id=\"showhideproxy\"></div>',\n\t\t\t'</div>'\n\t\t],\n\n\n\t\tstyle:{\n\n\t\t\t\" .epane\":\"width: 100px;position: absolute;top: 2px;right: 5px;z-index: +5;\",\n\n\t\t\t\" .control\":{\n\t\t\t\t\"\":\" font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;\",\n\t\t\t\t\" .button\": \"padding-bottom: 0.35em;\",\n\t\t\t\t\":hover\":\"opacity:1\"\n\t\t\t},\n\n\t\t\t\" .btn\":\"width:2em; height:2em; border-radius:2em; line-height:2em; \"\n\t\t\t\t+\"vertical-align:middle; text-align:center;padding:0;display:inline-block;\",\n\n\t\t\t\" #fname\":\"word-wrap: break-word; white-space: pre;\"\n\t\t\t\t\t+\"margin-top: 0px;\"\n\t\t},\n\t\tSettings:{\n\t\t\tinit: function($o, form){ $o.formgen(this.HTML); },\n\t\t\tui:{\n\t\t\t\t\"#name\":{\n\t\t\t\t\tbind:\"name\",\n\t\t\t\t\tcheck:function(d,v){\n\t\t\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\t\t\tif (this.RT().getDup(d, v)) return \"Already taken\";\n\t\t\t\t\t},\n\t\t\t\t\twatch:\"#folder,#ext\"\n\t\t\t\t},\n\t\t\t\t\"#folder\":{\n\t\t\t\t\tbind:\"folder\",\n\t\t\t\t\tcheck:/^[a-z0-9\\-]{0,20}$/i\n\t\t\t\t},\n\t\t\t\t\"#ext\":{\n\t\t\t\t\tbind:\"ext\",\n\t\t\t\t\tcheck:/^[a-z0-9\\-]{0,20}$/\n\t\t\t\t},\n\t\t\t\t\"#mime\":{\n\t\t\t\t\tbind:\"mime\",\n\t\t\t\t\tcheck:/^[a-z0-9\\-]{1,20}\\/[a-z0-9\\-]{1,20}$/\n\t\t\t\t},\n\t\t\t\t\"#btn-ok\":{\n\t\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#btn-cancel\":{\n\t\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#btn-delitem\":{\n\t\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t\tif (v!=null) {\n\n\t\t\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t\t\t.delay(60);\n\n\t\t\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcss:{\n\t\t\t\t\t\t\"self:hide\": function(d){\n\t\t\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twatch:\"#folder,#name\"\n\t\t\t\t},\n\t\t\t\t\"#cache\":{\n\t\t\t\t\tinit:function($o) {\n\t\t\t\t\t\t$o.tags({tags:[[\n\t\t\t\t\t\t\t{\"2\":172800}, \n\t\t\t\t\t\t\t{\"3\":3*86400},\n\t\t\t\t\t\t\t{\"7\":7*86400},\n\t\t\t\t\t\t\t{\"10\":10*86400},\n\t\t\t\t\t\t\t{\"15\":14*86400},\n\t\t\t\t\t\t\t{\"Month\":31*86400},\n\t\t\t\t\t\t\t{\"No\":\"\"}\n\t\t\t\t\t\t]], empty:{\"1 day\":\"86400\"}})\n\t\t\t\t\t},\n\t\t\t\t\tbind: \"cache\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tHTML:[\n\t\t\t\t'<h4 class=\"mb10\">Attachment properties</h4>',\n\t\t\t\t{row:\"550px\", label:\"116px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray\"},\n\t\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\t\t \n\t\t\t\t[\"\",\n\t\t\t\t '<span>', \n\t\t\t\t\t'inp#folder.w100', {plc:\"Folder\"} ,\n\t\t\t\t \t'</span> / <span class=\"dib vat w200\">', \n\t\t\t\t\t'inp#name.w200', {plc:\"Filename\"} , \"msg.fs80\",\n\t\t\t\t\t'</span> . ',\n\t\t\t\t\t'<span>','inp#ext.w50', {plc:\"Ext\"}, '</span> :: ',\n\t\t\t\t\t'<span>','inp#mime.w140', {plc:\"MIME\"}, '</span>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t['Cache-control','spn#cache.fs85'],\n\n\t\t\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t\t\t[\"\", 'btn#btn-ok.green', {val:\"Save\"},' ', \n\t\t\t\t\t\t\t'btn#btn-cancel', {val:\"Cancel\"}, ' ', \n\t\t\t\t\t\t\t'btn#btn-delitem.red.fr', {val:\"Delete\"}]\n\t\t\t]\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1411000199457","id": ".Types.rtf","type": "js","data": "({\n\tname:\"Rich text\",\n\text:\"html\",\n\tmime:\"text/html\",\n\tstringify: function(e) { return e.data+\"\"},\n\tdefaults:{data:'<p><br></p>'},\n\textend:{\n\t\tui:{\n\t\t\t\"#editor\":{\n\t\t\t\tinit: function($o, form){\n\t\t\t\t\t$o.redactor({\n\t\t\t\t\t\tminHeight:300,\n\t\t\t\t\t\tbuttons:[\n\t\t\t\t\t\t\t'html','|', 'formatting', 'bold', 'italic', 'fixwidth',\n\t\t\t\t\t\t 'deleted', 'table', 'image',\n\t\t\t\t\t\t 'link', 'fontcolor', 'backcolor', \n\t\t\t\t\t\t 'unorderedlist','outdent', 'indent'\n\t\t\t\t\t\t],\n\t\t\t\t\t\tformattingTags:[\"p\",\"blockquote\",\"pre\",\"h1\",\"h2\",\"h3\",\"h4\"],\n\t\t\t\t\t\tformatting:{\n\t\t\t\t\t\t\t\"code\":{title:\"Fixed\",exec:\"formatblock\",className:\"redactor_format_code\"}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfocus: false\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbind:\"data\"\n\t\t\t}\n\t\t},\n\t\tstyle:{\n\t\t\t\" .epane\":\"width: 520px;position: absolute;top: -3px;right: 1px;z-index: +5;\",\n\t\t\t\" #fname\":\"word-wrap: break-word; white-space: nowrap; padding: 5px 0;\"\n\t\t\t+\"font-weight: bold;width: 465px;margin-top: 5px;text-align:center\"\n\t\t}\n\t},\n\treplace:{},\n\tmanifest:null\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1411092418927","id": ".Types.js","type": "js","data": "({\n\tname:\"JS\",\n\text:\"js\",\n\tmime:\"text/javascript\",\n\tstringify: function (item) { return item.data+\"\"; },\n\tpostprocess: function (item, att){\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t// compress and uglify \n\t\t\tvar u   = UglifyJS,\n\t\t\t\t\tast = u.parse(att+\"\");\n\t\t\tast.figure_out_scope();\n\t\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\t\tast.figure_out_scope();\n\t\t\t// No char freq opt to avoid \n\t\t\t// different results from the same code\n\t\t\t//ast.compute_char_frequency();\n\t\t\tast.mangle_names();\n\t\t\treturn (item.desc?\"/*\"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\"*/\\n\":\"\") \n\t\t\t\t+ ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>');\n\t\t}\n\t},\n\tdefaults:{\n\t\tdata:'/* JS */\\n\\n\\n',\n\t\tUglify: false\n\t},\n\textend:{\t\n\t\tui:{\n\t\t\t\"#editor\":{\n\t\t\t\tinit: function($o, form){\n\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\tmode: \"javascript\",\n\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\treadOnly:!!form.data.external\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbind:\"data\"\n\t\t\t},\n\t\t\t\"#warn\":{\n\t\t\t\tdelay:300\n\t\t\t}\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Uglify code</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before uglified code\"} ]\n\t\t\t]\n\t\t},\n\t\tvalidator: function(d){\n\t\t\tvar r, f, s = d.data;\n\t\t\ttry {\n\t\t\t\tf = new Function([], (s.to(1)==\"{\" && s.from(-1)==\"}\"?\"return(\"+s+\");\":s));\n\t\t\t} catch (e) {\n\t\t\t\tr = e.message;\n\t\t\t}\n\t\t\tf = null;\n\t\t\treturn r;\n\t\t}\n\t},\n\treplace:{},\n\tmanifest:null\n\t\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1437961399548","id": ".Types.less","type": "js","data": "({\n\tname:\"less\",\n\text:\"less\",\n\tmime:\"text/x-less\",\n\tstringify: function(e) { return e.data+\"\"},\n\tdefaults:{ data:'/* LESS */' },\n\tpostprocess: function(item, att){\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t\n\t\t\tvar ret=\"\";\n\t\t\tless.render(att+\"\", function(err, res){\n\t\t\t\tif (err) {\n\t\t\t\t\tthrow {message:err.message+\", line \"+err.line};\n\t\t\t\t}\n\t\t\t\telse ret = res.css;\n\t\t\t})\n\t\t\treturn (item.desc?\"/* \"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\" */\\n\":\"\")+ret;\n\t\t}\n\t},\n\textend:{\n\t\tui:{\n\t\t\t\"#editor\":{\n\t\t\t\tinit: function($o, form){\n\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\tmode: \"text/x-less\",\n\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\treadOnly:!!form.data.external && !/^[x\\s]/.test(form.data.external)\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbind:\"data\"\n\t\t\t}\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Compile to CSS</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before compressed code\"} ]\n\t\t\t]\n\t\t}\n\t},\n\treplace:{},\n\tmanifest:null\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1436727310070","id": ".Build","type": "js","data": "(function (doc0, opts0, $o) {\n\t\n\tvar i,j,that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\ttdoc = doc0 || that.data.doc,\n\t\t\t\n\t\t\topts = $.extend(!0,{ \n\t\t\t\tbuttons:true, \n\t\t\t\tfooter:\"\", \n\t\t\t\tcheckcreds:false,\n\t\t\t\tpick:\"\",\n\t\t\t\tresolve:true,\n\t\t\t\tsilent:false,\n\t\t\t\tblocking:true\n\t\t\t},Object.reject(opts0||{},\"errors\")),\n\t\t\t\n\t\t\terrors = (opts0||{}).errors || {},\n\t\t\tkey,\n\t\t\titems={};\n\t\n\tfor (i=0;i<tdoc.items.length;i++) {\n\t\tif ( !tdoc.items[i].snippet && (j=that.Path(tdoc.items[i])).to(1) != \".\") {\n\t\t\titems[j.from(1)] = tdoc.items[i];\n\t\t}\n\t}\n\t\n\t\n\tif (key = d.doc.creds.crypto) {\n\t\tif (!cw.crypto.has(key)) {\n\t\t\t// cw.lib.note(\"No cryptokey to decode CouchDB credentials.\", \"error\");\n\t\t\tif (opts.checkcreds) pi.reject(\"Can’t get S3 credentials.\");\n\t\t\tthat.creds.s3 = {region:\"\"}\n\t\t} else {\n\t\t\tvar s3 = cw.crypto.dec(d.doc.creds)[\"s3\"];\n\t\t\tif (s3) {\n\t\t\t\tthat.creds.s3 = s3;\n\t\t\t} else {\n\t\t\t\tcw.lib.note(\"Error decoding S3 credentials.\", \"error\");\n\t\t\t\tif (opts.checkcreds) pi.reject(\"Can’t get S3 credentials.\");\n\t\t\t\tthat.creds.s3 = {region:\"\"}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthat.creds.s3 = Object.clone(d.doc.s3, !0);\n\t}\n\t\n\ttry {\n\t\tif (opts.resolve) that.ResolveExternals(tdoc, errors).always(_process);\n\t\telse _process();\n\n\t} catch(e) {\n\t\tpi.reject(\"Error during validation\", e.message, e.stack);\n\t}\n\t\n\treturn pi.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _process (){\n\t\t\tvar a = that.Items2Atts( tdoc,  that.Types,  errors,  opts.pick?opts.pick:true);\n\n\t\t\t//a.result._id = that.creds.s3.region;\n\n\t\t\tif (Object.size(a.err)) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\t\tdata:$.extend(!0, {}, opts,a ),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tscreen:opts.blocking?'rgba(255,255,255,0.5)':false,\n\t\t\t\t\talign:\"top:105%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tbound:10,\n\t\t\t\t\tdrag:!opts.blocking\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\t_result(a);\n\t\t\t\t})\n\t\t\t\t.fail(function(){\n\t\t\t\t\tpi.reject(\"Cancelled\");\n\t\t\t\t});\n\t\t\t} \n\t\t\telse {\n\t\t\t\tif (!opts.silent) cw.lib.note(\"Doc integrity seems to be Ok.\");\n\t\t\t\t_result(a);\n\t\t\t}\n\t\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _result(a){\n\t\tif (a.result) {\n\t\t\tvar att  = a.result._attachments;\n\t\t\t\n\t\t\t// Make it last node of the doc\n\t\t\tdelete a.result._attachments;\n\t\t\ta.result._attachments = att;\n\n\t\t\t//console.log(a);\n\n\t\t\t// load binary atts\n\t\t\tthat.db.get(d.doc._id, {\n\t\t\t\tattachments:true\n\t\t\t})\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tif (res._attachments) for (var i in res._attachments) {\n\t\t\t\t\t\tif (!a.result._attachments[i] || null == a.result._attachments[i].data) {\n\t\t\t\t\t\t\ta.result._attachments[i] = {\n\t\t\t\t\t\t\t\tcontent_type:res._attachments[i].content_type,\n\t\t\t\t\t\t\t\tdata:res._attachments[i].data\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(items[i]) items[i].state.crc = $.my.f.sdbmCode(res._attachments[i].data);\n\t\t\t\t\t};\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t},\n\t\t\t\tfunction(){\n\t\t\t\t\tif (!opts.silent) cw.lib.note(\"Doc is not yet saved, you may need to save doc.\", \"warning\");\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t} // --end _result\n\t\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1427645817856","id": ".ResolveExternals","type": "js","data": "(function (doc0, errs) {\n\tvar that = this, \n\t\t\tpis,\n\t\t\tasync,\n\t\t\tpending = {},\n\t\t\trows = (doc0 || that.data.doc).items,\n\t\t\tz = $.Deferred(),\n\t\t\thasErrors = false,\n\t\t\terr = errs || {};\n\t\n\tpis = rows.map(function(e,i){\n\t\tvar s=\"\", id='', \n\t\t\t\tp = e.external, \n\t\t\t\tpi;\n\t\tif (p && !/^[x\\s]/.test(p)) {\n\t\t\tasync = true;\n\t\t\tpi = $.Deferred();\n\t\t\t\n\t\t\t// Local doc\n\t\t\tif (p.startsWith(\"pouch://\") || p.startsWith(\"local://\")) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"pouch \"+id]) pending[\"pouch \"+id] = that.db.get(id, {attachments:true});\n\t\t\t\t\n\t\t\t\tpending[\"pouch \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process local doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load local doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){ pi.reject(\"Failed to load local doc '\"+id+\"'\"); }\n\t\t\t\t);\n\t\t\t}\n      \n      // Local query\n\t\t\telse if (p.startsWith('query://')) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\t\n\t\t\t\t// check if query has db\n\t\t\t\tvar db,\n\t\t\t\t\t\tq = p[0].split(\"/\").to(3);\n\t\t\t\tif (q.length < 2 && q[0]!=='_all_docs') pi.reject('Too short path for query');\n\t\t\t\telse {\n\t\t\t\t\tdb = q[0]=='_all_docs'?cw.db(that.db.name):q.length<3?that.db:cw.db(q[0]);\n\t\t\t\t\tif (db) {\n\t\t\t\t\t\tvar query = q.last(2).join('/'),\n\t\t\t\t\t\t\t\tparams,\n\t\t\t\t\t\t\t\terr;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparams = eval (s?'('+s+')':'');\n\t\t\t\t\t\t\tif (params !== undefined && !Object.isObject(params)) err = 'Params must be an object';\n\t\t\t\t\t\t\telse params = params || {};\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\terr = 'Invalid params for query';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!pending['query '+p.join(' ')]) {\n\t\t\t\t\t\t\t\tpending['query '+p.join(' ')] = query=='_all_docs'?db.allDocs(params):db.query(query, params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpending['query '+p.join(' ')].then(\n\t\t\t\t\t\t\t\tfunction(res) {\n\t\t\t\t\t\t\t\t\tpi.resolve(res.rows);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfunction(){ pi.reject(\"Query '\"+p.join(\" \")+\"' failed\"); }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi.reject(\"PouchDB DB '\"+q[0]+' does not exist' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Local doc, other DB\n\t\t\telse if (p.startsWith(\"doc://\")) {\n\t\t\t\tp = p.from(6).split(/\\s+/).compact(true);\n\t\t\t\t\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tvar dbid = id.split(\"/\",1)[0];\n\t\t\t\tid = id.from(dbid.length+1);\n\t\t\t\t\n\t\t\t\tif (cw.db(dbid)) {\n\t\t\t\t\n\t\t\t\t\tif (!pending[\"doc \"+p[0]]) {\n\t\t\t\t\t\tpending[\"doc \"+p[0]] = cw.db(dbid).get(id, {attachments:true});\n\t\t\t\t\t}\n\n\t\t\t\t\tpending[\"doc \"+p[0]].then(\n\t\t\t\t\t\tfunction(doc) {\n\n\t\t\t\t\t\t\tif (!doc) {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse if (s) {\n\t\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\t\tif (r) pi.resolve(r);\n\t\t\t\t\t\t\t\telse pi.reject(\"Failed to process PouchDB doc '\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t +p[0]+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.resolve(doc);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\"); }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tpi.reject(\"PouchDB DB '\"+dbid+' does not exist' );\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// External request\n\t\t\telse if (/^http[s]?:\\/\\//.test(p)) {\n\t\t\t\tp = p.split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"url \"+id]) {\n\t\t\t\t\t\n\t\t\t\t\tif ('https:'==window.location.protocol && !id.startsWith(window.location.protocol)) {\n\t\t\t\t\t\tpending[\"url \"+id] = $.Deferred().reject('forbidden protocol').promise();\n\t\t\t\t\t}\n\t\t\t\t\telse pending[\"url \"+id] = $.ajax({\n\t\t\t\t\t\turl:id,\n\t\t\t\t\t\tcache:false,\n\t\t\t\t\t\ttype:\"GET\",\n\t\t\t\t\t\tdataType:s?\"json\":\"text\",\n\t\t\t\t\t\txhrFields:{withCredentials:/^https/.test(id)}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpending[\"url \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tvar json, r;\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tif (!Object.isObject(doc) && !Object.isArray(doc)) {\n\t\t\t\t\t\t\t\ttry { doc = JSON.parse(doc) } catch (e) { }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tr = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process external doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load external doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){ pi.reject(\"Failed to load external doc '\"+id+\"'\"); }\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t// Unknown, reject\n\t\t\telse {\n\t\t\t\tpi.reject(\"Failed to load resource \"+id+', protocol is unknown.');\n\t\t\t}\n\t\t\t\n\t\t\treturn pi.promise();\n\t\t\t\n\t\t} else {\n\t\t\treturn e.data;\n\t\t}\n\t});\n\t\n\t\n\n\tif (!async) z.resolve();\n\telse {\n\t\tQ.allSettled(pis)\n\t\t.then(\n\t\t\tfunction(reps){\n\t\t\t\treps.forEach(function(e,i){\n\t\t\t\t\t\n\t\t\t\t\tvar d = rows[i], aname = that.Path(d);\n\t\t\t\t\t\n\t\t\t\t\tif (e.state ===\"fulfilled\") {\n\t\t\t\t\t\tif (Object.isString(e.value)) {\n\t\t\t\t\t\t\trows[i].data = e.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (Object.isObject(e.value) && rows[i].ext=='js') {\n\n\t\t\t\t\t\t\t\trows[i].data = cw.lib.js2txt(cw.lib.unjson(e.value),'\\t');\n\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trows[i].data = JSON.stringify(e.value,null,'\\t');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// error\n\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t_e(aname, e.reason);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\tif (!hasErrors) z.resolve();\n\t\t\t\telse z.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t},\n\t\t\tfunction(e){\n\t\t\t\tz.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t}\n\t\t)\n\t}\n\t\n\treturn z.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1408892631849","id": ".Items2Atts","type": "js","data": "(function (doc0, Types, prevErrors, pick0, depsOnly) {\n\tvar that=this, \n\t\t\ti, j, e, item, \n\t\t\tdoc = doc0 || that.data.doc,\n\t\t\tbuildAll = !!pick0,\n\t\t\tpick = Object.isString(pick0)?pick0:\"\",\n\t\t\tt = Types || that.Types, \n\t\t\tnames = {}, \n\t\t\tdirty = {},\n\t\t\taname=\"\", \n\t\t\ta={}, sn={}, pp={}, src = {}, fin = {}, \n\t\t\terr = prevErrors || {},\n\t\t\tincls = {}, \n\t\t\tfvalidator = null, isinvalid = null,\n\t\t\tz={\n\t\t\t\tname:doc.name,\n\t\t\t\t_attachments:{}\n\t\t\t};\n\t\n\tif (doc.site && doc.site.previewBase) z = doc;\n\t\n\tif (!z._attachments) z._attachments = {};\n\t\n\t// gen work structs\n\tfor (i=0;i<doc.items.length;i++) {\n\t\te = doc.items[i];\n\t\tif (e) {\n\t\t\taname = that.Path(e);\n\t\t\tnames[aname]=true;\n\t\t\tsn[aname]=e.snippet;\n\t\t\tsrc[aname]=doc.items[i];\n\t\t\tif (Object.isFunction(t[e.type].postprocess)) pp[aname] = t[e.type].postprocess;\n\t\t}\n\t}\n\t\n\t\n\t// stringify\n\tfor (i in names) {\n\t\tif (names.hasOwnProperty(i)) {\n\t\t\t_convert (i);\n\t\t}\n\t}\n\n\t\n\t// Resolves include directives.\n\t// Possible syntaxes are:\n\t// {{res.name}} \t\t\t– inserts as is\n\t// {/*{{res.name}}*/} – inserts as is\n\t// [/*{{res.name}}*/] – inserts as is\n\t// \"{{res.name}}\" \t\t– inserts stringified version\n\t\n\t// parse includes\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) {\n\t\t\t_parseIncludes (i);\n\t\t}\n\t}\n\t\n\t// merge snippets deps into files \n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\tvar tmp = {};\n\t\t\tfor (j in e.state.depends) \n\t\t\t\tif (sn[j] && src[j].state.depends) \n\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t$.extend(e.state.depends, tmp);\n\t\t}\n\t}\n\t\n\t// merge files deps into files \n\tvar tmp = {};\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\tif (e) {\n\t\t\t\ttmp = {};\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j) && a[j] && !sn[j] && src[j].state.depends) {\n\t\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$.extend(e.state.depends, tmp);\n\t\t\t}\n\t\t}\n\t}\n\t\t\n\t// build impacts (reverse deps)\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) {\n\t\t\te = src[i];\n\t\t\tif (e) {\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j)) {\n\t\t\t\t\t\tif (src[j]) src[j].state.impacts[i] = true;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t//console.log(\"Missing include \"+j+\" in \"+i);\n\t\t\t\t\t\t\t_e(i, \"Missing include '\"+j+\"'\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif (depsOnly) return {\n\t\terr: err,\n\t\tdoc:doc\n\t};\n\t\t\n\t// build list of items to be updated\n\tvar imps = {};\n\tfor (i in a){\n\t\tif (a.hasOwnProperty(i) && (!pick || i === pick)) {\n\t\t\te = src[i];\n\t\t\tif (!!buildAll || e.state.sdbm !== e.state.savedSdbm) {\n\t\t\t\t$.extend (true, imps, e.state.impacts);\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t// add dependees to dirty list, \n\t// they also need to be updated\n\tfor (i in imps) {\n\t\tif (imps.hasOwnProperty(i)) {\n\t\t\te = src[i];\n\t\t\tif (e) {\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tconsole.log(\"Dirties wired to rebuild: \", dirty);\n\t\n\t// build snippets\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && sn[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving snippet include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\n\t// build files\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !sn[i] && src[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving file include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// validate finalized versions\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !sn[i] && !err[i] && src[i]) {\n\t\t\tfvalidator = null;\n\t\t\tisinvalid = null;\n\t\t\ttry {\n\t\t\t\tfvalidator = (t[src[i].type].manifest || t[src[i].type].extend || {}).validator;\n\t\t\t\tif (Object.isFunction(fvalidator)) {\n\t\t\t\t\tisinvalid = fvalidator ({data:fin[i]});\n\t\t\t\t}\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Final result is not of type '\"+src[i].type+\"': \"+er.message);\n\t\t\t}\n\t\t\tif (isinvalid != null) _e(i, \"Final result is not of type '\"+src[i].type+\"': \"+isinvalid);\n\t\t}\n\t}\n\t\n\n\t// build attachments\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && (!sn[i] || i === pick) && !err[i] && src[i]) {\n\t\t\ttry {\n\t\t\t\ta[i].data = $.my.f.base64(fin[i], false, false);\n\t\t\t\tz._attachments[i] = a[i];\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Attach was not updated, error: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar process={};\n\tfor (i in src) {\n\t\tif (src.hasOwnProperty(i)) {\n      if (src[i].dropImport && src[i].external && src[i].external[0]!=' ') {\n      \tsrc[i].data = '// This branch has no visible data\\n// since ‘Do not store imported data in document’\\n// option is set for the branch';\n      }\n\t\t\tif (\n\t\t\t\tsrc[i].type === \"attachment\"\n\t\t\t\t&& src[i].state.sdbm !== src[i].state.savedSdbm\n\t\t\t\t&& (!pick || i===pick)\n\t\t\t) {\n\t\t\t\tprocess[i] = true;\n\t\t\t\t// May be we have not yet saved attaches\n\t\t\t\tif (doc._attachments && doc._attachments[i] && doc._attachments[i].data) {\n\t\t\t\t\tz._attachments[i] = {\n\t\t\t\t\t\tcontent_type:doc._attachments[i].content_type,\n\t\t\t\t\t\tdata:doc._attachments[i].data\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!sn[i] && dirty[i] && !err[i]) process[i] = true;\n\t\t}\n\t}\n\t\n\treturn {\n\t\terr:err,\n\t\tdirty: dirty,\n\t\tdoc:doc,\n\t\tupload:process,\n\t\tresult:z\n\t};\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _parseIncludes (iname) {\n\t\tvar reSnippet = \n\t\t/([\\{\\[]\\/\\*\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\\*\\/[\\}\\]])|(\"\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\")|(\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\})/gi,\n\t\t\t\ti = iname, deps,\n\t\t\t\tj, re, idx, str, \n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tdeps = src[i].state.depends={};\n\t\tif (incl && !src[i].noIncludes) {\t\t\n\t\t\tincls[i] = incl.slice(0);\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9\\-\\.\\/]/gi,\"\");\n\t\t\t\tdeps[idx] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _resolveIncludes (iname) {\n\t\tvar i = iname, \n\t\t\t\tj, re, idx, str, \n\t\t\t\treSnippet = \n\t\t/([\\{\\[]\\/\\*\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\\*\\/[\\}\\]])|(\"\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\}\")|(\\{\\{[a-z0-9\\-\\.\\/]+\\.[a-z0-9\\-]+\\}\\})/gi,\n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tfin[i] = a[i].data;\n\t\tif (incl) {\t\t\t\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9\\-\\.\\/]/gi,\"\");\n\t\t\t\tre = new RegExp(RegExp.escape(incl[j]), 'g');\n\t\t\t\tif (idx === i) fin[i] = fin[i].replace(re,\"\");\n\t\t\t\telse if (a[idx]) {\n\t\t\t\t\tstr = fin[idx]||a[idx].data;\n\t\t\t\t\tif (incl[j].to(1) === '\"' && incl[j].from(-1) ==='\"') str = JSON.stringify(str);\n\t\t\t\t\tfin[i] = fin[i].split(re).join(str);\n\t\t\t\t} \n\t\t\t\t//else fin[i] = fin[i].replace(re,\"\");\n\t\t\t}\n\t\t}\n\t\t// post-process\n\t\tif (pp[i]) {\n\t\t\ttry { fin[i] = pp[i](src[i], fin[i]);  }\n\t\t\tcatch (e) {\n\t\t\t\t_e(i, \"Post-processor error: \"+e.message);\n\t\t\t\t//console.log(e.message, e.stack, e);\n\t\t\t\t//window.M = fin[i];\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _convert (iname) {\n\t\tvar it=src[iname], att,\n\t\t\t\tparser, eparser;\n\t\t\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\t// Item\t\t\t\n\t\t\tif(it.parserActive) {\n\t\t\t\ttry { \n\t\t\t\t\tparser = eval(it.parser); \n\t\t\t\t} catch (e){ \n\t\t\t\t\tparser = null; \n\t\t\t\t\teparser = e.message;\n\t\t\t\t}\n\t\t\t\tif (!Object.isFunction(parser)) {\n\t\t\t\t\t_e (iname, \"Invalid custom parser: \"+eparser);\n\t\t\t\t\tparser = t[it.type].stringify;\n\t\t\t\t}\n\t\t\t} \n\t\t\telse parser = t[it.type].stringify;\n\t\t\n\t\t\ttry {\n\t\t\t\tatt = {\n\t\t\t\t\tcontent_type:it.mime||t[it.type].mime,\n\t\t\t\t\tdata:parser(it, doc._attachments, doc)+\"\"\n\t\t\t\t};\n\t\t\t} catch(e) {\n\t\t\t\tif (it.parserActive) _e(iname, \"Custom parser failed: \"+e.message);\n\t\t\t\telse _e(iname,\"Error parsing data: \"+e.message);\n\t\t\t}\n\t\t\tif (att ) {\n\t\t\t\ta[iname] = att;\n\t\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t// We have attachment\n\t\t\tif (doc._attachments && (att = doc._attachments[iname])) {\n\t\t\t\tif (att.digest) it.state.sdbm = $.my.f.sdbmCode(att.digest);\n\t\t\t} else {\n\t\t\t\tit.state.sdbm = \"Z\";\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n})\n\n","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1409438872558","id": ".Upload","type": "js","data": "(function (doc, $root, opts) {\n\tAWS.config.update(this.creds.s3);\n\tvar i, j, that = this,\n\t\t\tuploadList = opts.upload,\n\t\t\tz = opts.result,\n\t\t\ts3 = new AWS.S3({params: {Bucket: doc.site.s3bucket}}),\n\t\t\t_gzip = that.gzip,\n\t\t\ttotalSize = 0,\n\t\t\tsendAtt = {},\n\t\t\t$cs = $root.find(\"#counter-size\"),\n\t\t\titems = {},\n\t\t\tres; \n\n\t// cache items\n\tfor (i=0;i<doc.items.length;i++) {\n\t\tj = doc.items[i];\n\t\titems[that.Path(j)] = doc.items[i];\n\t}\n\t\n\tres = PushToBucket(doc, function(total, send){\n\t\ttotalSize = total;\n\t\tsendAtt = send;\n\t\t$cs.trigger('upload');\n\t});\n\t\n\t// section to animate downloading\n\t// spinning circle\n\tsetTimeout(function () {\n\t\tif (res.state() === \"pending\") $root.addClass('my-app-busy');\n\t}, 100);\n\n\t// size counter\n\tsetTimeout(function () {\n\t\tif (res.state() === \"pending\") {$root.addClass('my-app-busy-high');$cs.html(\"\");}\n\t}, 200);\n\n\t// remove block from app after upload\n\tres.always(function () {\n\t\t$root.removeClass('my-app-busy my-app-busy-high');\n\t\t$root.find('#counter-size').off('.upload');\n\t});\n\n\t// handler for uploading status\n\t$cs.on('upload', function () {\n\t\tvar loadedSize = 0;\n\t\tObject.keys(sendAtt).forEach(function (e) {\n\t\t\tloadedSize += sendAtt[e];\n\t\t});\n\t\tif (loadedSize > 5120 && totalSize > loadedSize) $(this).html(loadedSize.bytes(2) + ' / ' + totalSize.bytes(2));\n\t}.debounce(50));\n\n\treturn res.promise();\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction PushToBucket (doc, onProgress) {\n\t\tvar dfd = $.Deferred(),\n\t\t\t\tlen = Object.size(uploadList || doc._attachments || {}),\n\t\t\t\tprefix = doc.site.s3folder?doc.site.s3folder.replace(/\\/$/,'')+\"/\":\"\",\n\t\t\t\tctr = 0, // counter for resolving $.Deferred\n\t\t\t\ttotal = 0, // total size uploaded files\n\t\t\t\tsend = {}, // object for updating file upload size\n\t\t\t\tlog = {},\n\t\t\t\tfunc = {\n\t\t\t\t\tonProgress: function (load, name) {\n\t\t\t\t\t\tsend[name] = load;\n\t\t\t\t\t\tif (onProgress) onProgress(total, send);\n\t\t\t\t\t},\n\t\t\t\t\tonDone: function (len, name) {\n\t\t\t\t\t\tif (len) send[name] = len;\n\t\t\t\t\t\tif (onProgress) onProgress(total, send);\n\t\t\t\t\t},\n\t\t\t\t\tonError: function (name) {\n\t\t\t\t\t\tvar idx = name.from(prefix.length);\n\t\t\t\t\t\tlog[idx] = \"Upload failed\";\n\t\t\t\t\t\tif (items[idx]) items[idx].state.savedSdbm = \"\";\n\t\t\t\t\t\tdfd.notify('Unable to upload file ' + name + '');\n\t\t\t\t\t\tdfd.reject(log);\n\t\t\t\t\t},\n\t\t\t\t\tonSuccess: function (name) {\n\t\t\t\t\t\tvar i, idx = name.from(prefix.length);\n\t\t\t\t\t\tlog[idx] = true;\n\t\t\t\t\t\tif (items[idx]) items[idx].state.savedSdbm = items[idx].state.sdbm;\n\t\t\t\t\t\tdfd.notify('File ' + name + ' uploaded succesfully.');\n\t\t\t\t\t\tif (++ctr == len) {\n\t\t\t\t\t\t\tconsole.log(log);\n\t\t\t\t\t\t\t// mark snippets as succeded\n\t\t\t\t\t\t\tfor (i in items) {\n\t\t\t\t\t\t\t\tif (items[i].snippet) items[i].state.savedSdbm = items[i].state.sdbm;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdfd.resolve(log);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\n\t\t// we need to determine in what environment we are\n\t\tif (!window.l && window.cw) {\n\t\t\t\n\t\t\tObject.keys(uploadList || z._attachments).forEach(function (e) {\n\t\t\t\tconsole.log(prefix + e);\n\t\t\t\tvar params = {\n\t\t\t\t\tname: prefix + e,\n\t\t\t\t\tcontent_type: z._attachments[e].content_type,\n\t\t\t\t\tbody: z._attachments[e].data,\n\t\t\t\t\tlength: z._attachments[e].data.length/4*3,\n\t\t\t\t\ttype: \"base64\",\n\t\t\t\t\tgzip: !/(jp[e]?g|png|zip|gif|rar|pdf)$/.test(e),\n\t\t\t\t\tcache:items[e].cache||\"\"\n\t\t\t\t};\n\t\t\t\tif (z._attachments[e].length || z._attachments[e].size) {\n\t\t\t\t\tparams.length = z._attachments[e].length || z._attachments[e].size;\n\t\t\t\t}\n\t\t\t\ttotal += params.length;\n\t\t\t\tUploadToS3(PrepareToUpload(params), s3, func)\n\t\t\t});\n\t\t} else {\n\t\t\tObject.keys(uploadList || z._attachments).forEach(function (e) {\n\t\t\t\tvar wl = window.location,\n\t\t\t\t\t\tdb = that.Db,\n\t\t\t\t\t\tloc = wl.protocol + '//' + wl.hostname + '/x/' + db + '/' + doc._id + '/' + e;\n\n\t\t\t\ttotal += z._attachments[e].length * 2;\n\t\t\t\tGetBlob(loc,\n\t\t\t\t{\n\t\t\t\t\tonProgress: function (load) {\n\t\t\t\t\t\tsend[e + \"send\"] = load;\n\t\t\t\t\t\tif (onProgress) onProgress(total, send);\n\t\t\t\t\t}\n\t\t\t\t}, \n\t\t\t\tfunction (body, gzipped) {\n\t\t\t\t\tUploadToS3(PrepareToUpload({\n\t\t\t\t\t\tname: prefix + e,\n\t\t\t\t\t\tcontent_type: z._attachments[e].content_type,\n\t\t\t\t\t\tlength: z._attachments[e].length,\n\t\t\t\t\t\tbody: body,\n\t\t\t\t\t\ttype: \"u8array\",\n\t\t\t\t\t\tgzip: gzipped,\n\t\t\t\t\t\tcache:items[e].cache||\"\"\n\t\t\t\t\t}), s3, func)\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn dfd;\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction PrepareToUpload (params) {\n\t\tvar obj = {\n\t\t\tKey: params.name,\n\t\t\tACL: 'public-read',\n\t\t\tContentType: params.content_type\n\t\t};\n\t\t\n\t\tif (params.cache+\"\" != \"\") obj.CacheControl = \"max-age=\"+params.cache;\n\t\t\n\t\tif (params.length) obj.ContentLength = params.length;\n\t\tif (params.type === \"base64\") {\n\t\t\tif (params.gzip) params.body = _gzip.base64(params.body);\n\t\t\telse $.my.f.base642blob(params.body,function(b){params.body=b});\n\t\t} \n\t\telse if (params.type === \"u8array\" ) {\n\t\t\tif (params.gzip) params.body = _gzip.u8array(new Uint8Array(params.body));\n\t\t}\n\t\tobj.Body = params.body;\n\t\tif (params.gzip) obj.ContentEncoding = \"gzip\";\n\t\treturn obj;\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - \n\t\n\tfunction UploadToS3 (params, s3, func) {\n\t\tvar req = s3.putObject(params,function(err){\n\t\t\tif (err) {\n\t\t\t\tif (func.onError) func.onError(params.Key);\n\t\t\t} else {\n\t\t\t\tif (func.onSuccess) func.onSuccess(params.Key);\n\t\t\t}\n\t\t});\n\t\tif (func.onProgress) req.on('httpUploadProgress',function(pr,res){\n\t\t\tfunc.onProgress(pr.loaded, params.Key);\n\t\t});\n\t\tif (func.onDone) req.on('httpDone',function(){\n\t\t\tfunc.onDone(params.ContentLength, params.Key);\n\t\t});\n\t}\n\t\n\t// - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction GetBlob (url, params, callback) {\n\t\tif (!params.notGzip) var gzipped = !/(jp[e]?g|png|gif|zip|rar|pdf)$/.test(url);\n\n\t\tvar oReq = new XMLHttpRequest();\n\t\toReq.open(\"GET\", url, true);\n\t\tif (params.onProgress) oReq.onprogress = function(e) {\n\t\t\tparams.onProgress(e.loaded);\n\t\t};\n\t\tif (!gzipped) oReq.responseType = \"blob\";\n\t\telse oReq.responseType = \"arraybuffer\";\n\t\toReq.onload = function() {\n\t\t\tcallback(oReq.response, gzipped);\n\t\t};\n\t\toReq.send();\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1427646971204","id": ".Tar","type": "js","data": "({\n\tTar: function () {\n\t\n\t\t// Tar implementation\n\t\t// https://github.com/beatgammit/tar-js\n\n\t\tvar header = _header(),\n\t\t\tutils = _utils(),\n\t\t\trecordSize = 512,\n\t\t\tblockSize;\n\n\t\tfunction Tar(recordsPerBlock) {\n\t\t\tthis.written = 0;\n\t\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t}\n\n\t\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\t\tvar data,\n\t\t\t\tchecksum,\n\t\t\t\tmode,\n\t\t\t\tmtime,\n\t\t\t\tuid,\n\t\t\t\tgid,\n\t\t\t\theaderArr;\n\n\t\t\tif (typeof input === 'string') {\n\t\t\t\tinput = utils.stringToUint8(input);\n\t\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t\t}\n\n\t\t\tif (typeof opts === 'function') {\n\t\t\t\tcallback = opts;\n\t\t\t\topts = {};\n\t\t\t}\n\n\t\t\topts = opts || {};\n\n\t\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\t\tuid = opts.uid || 0;\n\t\t\tgid = opts.gid || 0;\n\n\t\t\tdata = {\n\t\t\t\tfileName: filepath,\n\t\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\t\tuid: utils.pad(uid, 7),\n\t\t\t\tgid: utils.pad(gid, 7),\n\t\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\t\tchecksum: '        ',\n\t\t\t\ttype: '0', // just a file\n\t\t\t\tustar: 'ustar  ',\n\t\t\t\towner: opts.owner || '',\n\t\t\t\tgroup: opts.group || ''\n\t\t\t};\n\n\t\t\t// calculate the checksum\n\t\t\tchecksum = 0;\n\t\t\tObject.keys(data).forEach(function (key) {\n\t\t\t\tvar i, value = data[key], length;\n\n\t\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\t\theaderArr = header.format(data);\n\n\t\t\tvar i, offset, length;\n\n\t\t\tthis.out.set(headerArr, this.written);\n\n\t\t\tthis.written += headerArr.length;\n\n\t\t\t// If there is not enough space in this.out, we need to expand it to\n\t\t\t// fit the new input.\n\t\t\tif (this.written + input.length > this.out.length) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, input.length, blockSize);\n\t\t\t}\n\n\t\t\tthis.out.set(input, this.written);\n\n\t\t\t// to the nearest multiple of recordSize\n\t\t\tthis.written += input.length + (recordSize - (input.length % recordSize || recordSize));\n\n\t\t\t// make sure there's at least 2 empty records worth of extra space\n\t\t\tif (this.out.length - this.written < recordSize * 2) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, recordSize * 2, blockSize);\n\t\t\t}\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(this.out);\n\t\t\t}\n\n\t\t\treturn this.out;\n\t\t};\n\n\t\tTar.prototype.clear = function () {\n\t\t\tthis.written = 0;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t};\n\n\t\treturn Tar;\n\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\t\t// HEADER\n\n\t\tfunction _header () {\n\n\t\t/*\n\t\tstruct posix_header {             // byte offset\n\t\t\tchar name[100];               //   0\n\t\t\tchar mode[8];                 // 100\n\t\t\tchar uid[8];                  // 108\n\t\t\tchar gid[8];                  // 116\n\t\t\tchar size[12];                // 124\n\t\t\tchar mtime[12];               // 136\n\t\t\tchar chksum[8];               // 148\n\t\t\tchar typeflag;                // 156\n\t\t\tchar linkname[100];           // 157\n\t\t\tchar magic[6];                // 257\n\t\t\tchar version[2];              // 263\n\t\t\tchar uname[32];               // 265\n\t\t\tchar gname[32];               // 297\n\t\t\tchar devmajor[8];             // 329\n\t\t\tchar devminor[8];             // 337\n\t\t\tchar prefix[155];             // 345\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 500\n\t\t};\n\t\t*/\n\n\t\t\tvar utils = _utils(),\n\t\t\t\theaderFormat;\n\n\t\t\theaderFormat = [\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileMode',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'uid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'gid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileSize',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'mtime',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'checksum',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'type',\n\t\t\t\t\t'length': 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'linkName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'ustar',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'owner',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'group',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'majorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'minorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'filenamePrefix',\n\t\t\t\t\t'length': 155\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'padding',\n\t\t\t\t\t'length': 12\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tfunction formatHeader(data, cb) {\n\t\t\t\tvar buffer = utils.clean(512),\n\t\t\t\t\toffset = 0;\n\n\t\t\t\theaderFormat.forEach(function (value) {\n\t\t\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\t\t\ti, length;\n\n\t\t\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\t\t\toffset += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset += value.length - i; // space it out with nulls\n\t\t\t\t});\n\n\t\t\t\tif (typeof cb === 'function') {\n\t\t\t\t\treturn cb(buffer, offset);\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstructure:headerFormat,\n\t\t\t\tformat:formatHeader\n\t\t\t};\n\t\t}\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\n\t\t// UTILS\n\n\t\tfunction _utils () {\n\n\t\t\tvar lookup = [\n\t\t\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t\t\t];\n\t\t\tfunction clean(length) {\n\t\t\t\tvar i, buffer = new Uint8Array(length);\n\t\t\t\tfor (i = 0; i < length; i += 1) {\n\t\t\t\t\tbuffer[i] = 0;\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction extend(orig, length, addLength, multipleOf) {\n\t\t\t\tvar newSize = length + addLength,\n\t\t\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\t\t\tbuffer.set(orig);\n\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction pad(num, bytes, base) {\n\t\t\t\tnum = num.toString(base || 8);\n\t\t\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t\t\t}\t\n\n\t\t\tfunction stringToUint8 (input, out, offset) {\n\t\t\t\tvar i, length;\n\n\t\t\t\tout = out || clean(input.length);\n\n\t\t\t\toffset = offset || 0;\n\t\t\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\t\t\toffset += 1;\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction uint8ToBase64(uint8) {\n\t\t\t\tvar i,\n\t\t\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\t\t\toutput = \"\",\n\t\t\t\t\ttemp, length;\n\n\t\t\t\tfunction tripletToBase64 (num) {\n\t\t\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t\t\t};\n\n\t\t\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\t\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\t\t\toutput += tripletToBase64(temp);\n\t\t\t\t}\n\n\t\t\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\t\t\tswitch (output.length % 4) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\toutput += '=';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\toutput += '==';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tclean:clean,\n\t\t\t\tpad:pad,\n\t\t\t\textend:extend,\n\t\t\t\tstringToUint8:stringToUint8,\n\t\t\t\tuint8ToBase64:uint8ToBase64\n\t\t\t};\n\t\t}\n\t},\n\tBytes: function (input){\n\t\tvar binary = window.atob(input),\n\t\t\t\ti=0, len = binary.length,\n\t\t\t\tbuffer = new ArrayBuffer(len),\n\t\t\t\tview = new Uint8Array(buffer);\n\t\tfor (i; i<len;i++) view[i] = binary.charCodeAt(i);\n\t\treturn view;\n\t}\n\t\n})","active": false,"opts": [],"err": [],"color": ["green"]},{"stamp": "1409440216540","id": ".Gzip","type": "js","data": "(function(){\n\n\tvar U8A = window.Uint8Array ? Uint8Array : Array,\n\t\t\tBASE64_MARKER = ';base64,',\n\t\t\tBASE64_MARKER_L = BASE64_MARKER.length;\n\n\tfunction stringToByteArray(str) {\n\t\tvar i = 0, max = str.length, array = new Array(max);\n\t\twhile(i < max) array[i] = str.charCodeAt(i++) & 0xFF;\n\t\treturn new U8A(array);\n\t}\n\n\tfunction base64ToByteArray(dataURI) {\n\t\tvar base64Pos = dataURI.indexOf(BASE64_MARKER),\n\t\t\t\tbase64Index = base64Pos != -1 ? base64Pos + BASE64_MARKER_L : 0,\n\t\t\t\tbase64 = dataURI.substring(base64Index),\n\t\t\t\traw = window.atob(base64),\n\t\t\t\trawLength = raw.length,\n\t\t\t\tarray = new Array(rawLength),\n\t\t\t\ti = 0;\n\t\twhile(i < rawLength) array[i] = raw.charCodeAt(i++);\n\t\treturn new U8A(array);\n\t}\n\n\tfunction toGzip(data) {\n\t\tif(!data) {\n\t\t\tconsole.log('No data to gzip!');\n\t\t\treturn null;\n\t\t}\n\t\treturn new Blob([\n\t\t\tnew Zlib.Gzip(data).compress()\n\t\t]);\n\t}\n\n\treturn {\n\t\t'string': function(text) {\n\t\t\tif(!text || !text.length) {\n\t\t\t\tconsole.log('No text to gzip!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn toGzip(stringToByteArray(text));\n\t\t},\n\t\t'u8array': function(array) {\n\t\t\tif(!array || !array.length) {\n\t\t\t\tconsole.log('No u8array to gzip!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn toGzip(array);\n\t\t},\n\t\t'base64': function(base64) {\n\t\t\tif(!base64 || !base64.length) {\n\t\t\t\tconsole.log('No base64 to gzip!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t//console.log(base64);\n\t\t\treturn toGzip(base64ToByteArray(base64));\n\t\t}\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1436732229729","id": ".CleanAtts","type": "js","data": "(function (doc) {\n\tvar that = this,\n\t\t\ta = Object.keys(doc._attachments||{}),\n\t\t\tb = doc.items,\n\t\t\tids = {};\n\tif (!a || !a.length) return doc;\n\t\n\tb.forEach(function(e){ \n\t\tif (e.type===\"attachment\") ids[that.Path(e)] = true; \n\t});\n\t\n\ta.forEach(function(i){\n\t\tif (!ids[i])  delete doc._attachments[i];\n\t});\n\treturn true;\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1436736197729","id": ".MergeAtts","type": "js","data": "(function (doc, ext){\n\t// Compares atts of ext with doc,\n\t// adds missing\n\t\n\tif (ext._attachments)\n\t\n\tvar a = doc._attachments,\n\t\t\tb = ext._attachments;\n\t\n\tif (!b || !Object.size(b)) return doc;\n\t\n\tif (!a) a = doc._attachments = {};\n\t\n\tObject.keys(b).forEach(function(i){\n\t\t\n\t\tif (b[i].data) {\n\t\t\ta[i] = {\n\t\t\t\tcontent_type:b[i].content_type,\n\t\t\t\tdata:b[i].data\n\t\t\t};\n\t\t}\n\t\n\t});\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1438501038443","id": ".GetSettings","type": "js","data": "(function (section) {\n\tvar that = this,\n\t\t\tkey,\n\t\t\td = that.data;\n\t// Decode / prepare creds\n\tif ( cw.crypto && (key = d.doc.creds.crypto)) {\n\t\tif (!cw.crypto.has(key)) {\n\t\t\treturn {  };\n\t\t} else {\n\t\t\tvar obj = cw.crypto.dec(d.doc.creds)[section || \"s3\"];\n\t\t\tif (obj) {\n\t\t\t\treturn obj;\n\t\t\t} else {\n\t\t\t\treturn {  };\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn Object.clone(d.doc[section || \"s3\"], !0);\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1438503062265","id": ".ParseJS","type": "js","data": "(function (s, clean) {\n\t\n\tvar g=s,\n\t\t\tu = UglifyJS, \n\t\t\tast,\n\t\t\tres ={\n\t\t\t\tglobals:[],\n\t\t\t\terrors:[]\n\t\t\t},\n\t\t\tgl;\n\ttry{\n\t\tast = u.parse(s+\"\");\n\t} catch (e) {\n\t\tres.errors.push (e.message+\" @\"+e.line+\":\"+e.col)\n\t}\n\tif (ast) {\n\t\tast.figure_out_scope();\n\t\tif (Object.isObject(gl = ast.globals) && gl._size) {\n\t\t\tObject.keys(gl._values)\n\t\t\t.forEach(function(i){\n\t\t\t\tres.globals.push(gl._values[i].name);\n\t\t\t});\n\t\t\tres.globals.sort();\n\t\t\tif (clean) {\n\t\t\t\tres.globals = [].remove.apply(\n\t\t\t\t\tres.globals,\n\t\t\t\t\t(\"String Function Date Math Number Object Array RegExp isNaN undefined parseInt parseFloat \"\n\t\t\t\t\t\t+\"isFinite\").split(\" \")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1408681635064","id": ".HTML","type": "html","data": "<div id=\"sysload\"><img src=\"http://cdn.cloudwall.me/0.9/i/loader66.gif\"><div id=\"counter-size\"></div></div>\n<div id=\"nav\" class=\"-pt5 -pb5 -bts -bbd mb10 fs100 my-row \">\n\t<div class=\"fr fs85\">\n\t\t<input type=\"button\" style=\"\" class=\" tac mr5 green w100\" txt=\"\" value=\"Save\" id=\"btn-save\"><input \n\t\ttype=\"button\" style=\"\" class=\" tac w100\" txt=\"\" value=\"Close\" id=\"btn-close\"></div>\n\t\n\t<h3 id=\"sname\" class=\"dib vat mt1 mb5 w200 mr10 fs130\"\n\t\t\tstyle=\"white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\"></h3><span class=\"fs80\"\n\t><button style=\"\" class=\" tac btn-l mr2 button\" id=\"btn-params\"><span class=\"fi-wrench\"></span></button></\n\tspan><span class=\"mr10\"\n\t><button style=\"\" class=\" tac btn-r button w140\" id=\"btn-publish\"><span class=\"fi-arrow-up\"> Publish to S3</span></button \n\t></span>\n\t<span class=\"mr10\"\n\t><button style=\"\" class=\" tac button\" id=\"btn-tar\"><span class=\"fi-archive\"> Get .tar</span></button \n\t></span>\n\t<span class=\"mr10\"\n\t><button style=\"\" class=\" tac button\" id=\"btn-validate\"><span class=\"fi-checkbox\"> Validate</span></button \n\t></span>\n\t<span class=\"dib vat fs80 mt5 blue\"><span class=\"fi-eye\"></span> \n\t\t<a href=\"\" target=\"_blank\" id=\"btn-view\">Preview</a>\n\t</span>\n</div>\n<table width=\"100%\" cellpadding=0 cellspacing=0 border=0 class=\"fs90\">\n\t<tr>\n\t\t<td style=\"width:195px;padding-right:0px;\" >\n\t\t\t<div id=\"ilist\" class=\"w190 fs90\"></div>\n\t\t\t<div id=\"btns-main\" class=\"mt10 w190 oh fs80 hoverlink gray pl3 mt15 pt10 btd lh190\">\n\t\t\t\t<span class=\"fi-page-add\"></span> <span class=\"pseudolink\" id=\"btn-additem\">Add resource</span><br>\n\t\t\t\t<span class=\" fi-paperclip\"></span> <span class=\"pseudolink\" id=\"btn-addfile\">Attach file</span><br>\n\t\t\t\t<span class=\"fi-photo ml-2\"></span> <span class=\"pseudolink\" id=\"btn-addpic\">Add image</span>\n\t\t\t</div>\n\t\t</td>\n\t\t<td class=\"pl15 edpane\">\n\t\t\t<div id=\"tabs\" class=\"mb10\"></div>\n\t\t\t<div id=\"items\" class=\"edpane\"></div>\n\t\t</td>\n\t</tr>\n</table>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1409438621693","id": ".style","type": "js","data": "({\n\t\"\": {\n\t\t\"\": \"font-size:15pt!important\"\n\t},\n\t\n\t\" .s3item .my-modal-overlay\":\"font-size:110%;\",\n\t\n\t\" .s3item\":{\n\t\t\" .edwidth\": function ($form){\n\t\t\treturn \"width:\"+($form.width()-210)+\"px;\"\n\t\t},\n\t\t\" .CodeMirror\": function($form) {\n\t\t\t\n\t\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\ttabs = ($form.find(\"#tabs\").outerHeight(true)||0).clamp(38,100),\n\t\t\t\tcss = \"height:\"+($(window).height()-(pad+ofs+nav+tabs+15))+\"px;\";\n\t\t\t\n\t\t\treturn \"min-height:300px;\"+css;\n\t\t},\n\t\t\" .btn-l\": \"border-radius:30px 0 0 30px!important;\",\n\t\t\" .btn-r\": \"border-radius:0 30px 30px 0!important;\",\n\t\t\" .btn-c\": \"border-radius:0 0 0 0!important;\",\n\t\t\" .b1r .CodeMirror-linenumbers\": \"background-color: rgba(255, 200, 200, 0.75);\"\n\t},\n\t\n\t\n\t\".my-app-busy\": {\n\t\t\">#nav\": \"opacity:0.2\",\n\t\t\">table\": \"opacity:0.2\",\n\t\t\">#sysload\": {\n\t\t\t\"\": \"display:block;\"\n\t\t}\n\t},\n\t\" .busy:before\":'content:\" \"; width:100%;height:100%;position:absolute;top:0;left:0;background:rgba(255,255,255,0.5);z-index:+3;',\n\t\".my-app-busy-high > #sysload #counter-size\": \"display:block;\",\n\t\" #sysload\": {\n\t\t\"\": \"display:none;position:absolute;width: 100%;text-align: center;height: 300px;padding-top:100px;left:0;top:0;\",\n\t\t\" div#counter-size\": \"margin-top:20px;display:none;\"\n\t},\n\t\".my-app-busy>#sysload\": \"display:block;\",\n\t\" #ilist\": function($form) {\n\t\t\t\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\tcss = \"max-height:\"+($(window).height()-(pad+ofs+nav+126))+\"px;\";\n\n\t\treturn \"overflow-x:hidden;overflow-y:\"+(navigator.webkitGetUserMedia?\"overlay\":\"scroll\")+\";\"+css;\n\t},\n\t\" .edpane\": function($o){\n\t\treturn \"width:\"+($o.width()-210)+\"px;\"\n\t},\n\t\" #ilist>div\": \"cursor:pointer\",\n\t\" .CodeMirror\": \"line-height:1.4em;height:auto;padding:0px;font:13px Cousine,'PT Mono',Monaco,monospace;\",\n\t\" .siteitem\": \"font-size:11pt;word-wrap: break-word;line-height:1.1em;padding-top: 5px;padding-bottom: 5px;\",\n\t\" .b1\": \"border:1px solid #C1D0DA; border-radius:2px;\",\n\t\" .b1b\": \"border:1px solid #00BCF4; border-radius:2px;\",\n\t\"\t.b1g\": \"border: 1px solid #A4D572;border-radius:2px;\",\n\t\n\t\"\t.b1r\": \"border: 1px solid rgb(255, 134, 153);border-radius:2px;\",\n\t\n\t\" .red\": \"color:rgb(255, 134, 153)!important;\",\n\t\" .btn-l\": \"border-radius:3px 0 0 3px;\",\n\t\" .btn-r\": \"border-radius:0 3px 3px 0;\",\n\t\" .btn-с\": \"border-radius:00;\",\n\t\" .button\":\"outline:none!important\",\n\t\n\t\" .redactor_editor\":\"font-size:13pt; padding:0.7em; color:#444\",\n\t\" .redactor_box\":\"border:none\",\n\t\" .redactor_toolbar\":\"background: none;padding-top: 2px!important;border-bottom-color:#C1D0DA\",\n\t\" .redactor_toolbar li a:active, .redactor_toolbar li a.redactor_act \":\n\t\t\" outline: none;border-color: #C5DCEA;background-color: #C5DCEA;\",\n\t\" .redactor_toolbar li.redactor_separator\":\n\t\t\t\"margin: 0 2px 0 3px !important;padding: 0;height: 27px;border-right: none;border-left: 1px solid #C1D0DA;\",\n\t\" .redactor_box textarea\":\"background-color:#333;padding:15px;\",\n\t\n\t' div.tab-tab':{\n\t\t\" #tabname\":'padding:1px 18px 1px 7px;color:#8292A3;font-size:80%; border:1px solid #DEE7EC;'\n\t\t\t+'display:inline-block;background-color:white;border-radius:2px 10px 0 0;margin: 0 0 2px 0;',\n\t\t\n\t\t' .btn-tabclose' :'opacity:0;transition:opacity 0.3s;display:inline-block;'\n\t\t\t+'text-align:center;width:18px; margin:0px 2px 0 -18px;color:#c02;line-height:0.9em;',\n\t\t\n\t\t\" #tabname.active\":\"background-color: rgba(142, 211, 255, 0.25);color:#274361;border-color:rgba(255,255,255,0);\",\n\t\t\" #tabname:hover\":'color:#274361;',\n\t\t\":hover .btn-tabclose\":'opacity:0.6'\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["orange"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0ZGN0Y0QiIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTM0LjkzNCwzNS4yNDQgTDQwLjE3Nyw5NC4wNDYgTDYzLjcwMywxMDAuNTc4IEw4Ny4yOTUsOTQuMDM4IEw5Mi41NDIsMzUuMjQ1IEwzNC45MzQsMzUuMjQ1IHogTTgxLjYwNiw0OS4xOTkgTDgxLjI3OCw1Mi44NTUgTDgxLjEzMyw1NC40NzUgTDgxLjExMSw1NC40NzUgTDYzLjczOCw1NC40NzUgTDYzLjcxNCw1NC40NzUgTDUzLjUzNiw1NC40NzUgTDU0LjE5NSw2MS44NjEgTDYzLjcxMyw2MS44NjEgTDYzLjczOCw2MS44NjEgTDc4LjUzNCw2MS44NjEgTDgwLjQ3OCw2MS44NjEgTDgwLjMwMiw2My43OTggTDc4LjYwNiw4Mi43ODYgTDc4LjQ5OCw4NC4wMDMgTDYzLjczOCw4OC4wOTMgTDYzLjczOCw4OC4wOTMgTDYzLjcwNSw4OC4xMDQgTDQ4LjkzMiw4NC4wMDMgTDQ3LjkyMiw3Mi42NzkgTDUxLjI1OSw3Mi42NzkgTDU1LjE2MSw3Mi42NzkgTDU1LjY3NCw3OC40MzIgTDYzLjcwNiw4MC42IEw2My43MTMsODAuNTk4IEw2My43MTMsODAuNTk3IEw3MS43NTcsNzguNDI2IEw3Mi41OTQsNjkuMDczIEw2My43MzgsNjkuMDczIEw2My43MTQsNjkuMDczIEw0Ny41OTksNjkuMDczIEw0NS44MjcsNDkuMTk5IEw0NS42NTUsNDcuMjYzIEw2My43MTQsNDcuMjYzIEw2My43MzgsNDcuMjYzIEw4MS43NzksNDcuMjYzIEw4MS42MDYsNDkuMTk5IHoiIGZpbGw9IiNGRjY5MjkiLz4KICA8L2c+Cjwvc3ZnPgo=","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "site","actions": ["create","edit","view"]},{"type": "s3site","actions": ["edit"]}],"_opts": {"compileTo": ["js"],"runWidth": "1050","runMode": ["fullscreen"],"runCss": "","runId": "s3"},"_src": "","_new": false,"_desc": "Static AWS S3 site generator","timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0ZGN0Y0QiIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTM0LjkzNCwzNS4yNDQgTDQwLjE3Nyw5NC4wNDYgTDYzLjcwMywxMDAuNTc4IEw4Ny4yOTUsOTQuMDM4IEw5Mi41NDIsMzUuMjQ1IEwzNC45MzQsMzUuMjQ1IHogTTgxLjYwNiw0OS4xOTkgTDgxLjI3OCw1Mi44NTUgTDgxLjEzMyw1NC40NzUgTDgxLjExMSw1NC40NzUgTDYzLjczOCw1NC40NzUgTDYzLjcxNCw1NC40NzUgTDUzLjUzNiw1NC40NzUgTDU0LjE5NSw2MS44NjEgTDYzLjcxMyw2MS44NjEgTDYzLjczOCw2MS44NjEgTDc4LjUzNCw2MS44NjEgTDgwLjQ3OCw2MS44NjEgTDgwLjMwMiw2My43OTggTDc4LjYwNiw4Mi43ODYgTDc4LjQ5OCw4NC4wMDMgTDYzLjczOCw4OC4wOTMgTDYzLjczOCw4OC4wOTMgTDYzLjcwNSw4OC4xMDQgTDQ4LjkzMiw4NC4wMDMgTDQ3LjkyMiw3Mi42NzkgTDUxLjI1OSw3Mi42NzkgTDU1LjE2MSw3Mi42NzkgTDU1LjY3NCw3OC40MzIgTDYzLjcwNiw4MC42IEw2My43MTMsODAuNTk4IEw2My43MTMsODAuNTk3IEw3MS43NTcsNzguNDI2IEw3Mi41OTQsNjkuMDczIEw2My43MzgsNjkuMDczIEw2My43MTQsNjkuMDczIEw0Ny41OTksNjkuMDczIEw0NS44MjcsNDkuMTk5IEw0NS42NTUsNDcuMjYzIEw2My43MTQsNDcuMjYzIEw2My43MzgsNDcuMjYzIEw4MS43NzksNDcuMjYzIEw4MS42MDYsNDkuMTk5IHoiIGZpbGw9IiNGRjY5MjkiLz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": "","nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","types": "","width": [1150,1320,1420],"collapsed": [],"padding": "auto"},"log": [[1539883973596,"update","ermouth-524yb546",118,"dev-cloudwall2"]],"id": "cw.Site.Editor","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0ZGN0Y0QiIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTM0LjkzNCwzNS4yNDQgTDQwLjE3Nyw5NC4wNDYgTDYzLjcwMywxMDAuNTc4IEw4Ny4yOTUsOTQuMDM4IEw5Mi41NDIsMzUuMjQ1IEwzNC45MzQsMzUuMjQ1IHogTTgxLjYwNiw0OS4xOTkgTDgxLjI3OCw1Mi44NTUgTDgxLjEzMyw1NC40NzUgTDgxLjExMSw1NC40NzUgTDYzLjczOCw1NC40NzUgTDYzLjcxNCw1NC40NzUgTDUzLjUzNiw1NC40NzUgTDU0LjE5NSw2MS44NjEgTDYzLjcxMyw2MS44NjEgTDYzLjczOCw2MS44NjEgTDc4LjUzNCw2MS44NjEgTDgwLjQ3OCw2MS44NjEgTDgwLjMwMiw2My43OTggTDc4LjYwNiw4Mi43ODYgTDc4LjQ5OCw4NC4wMDMgTDYzLjczOCw4OC4wOTMgTDYzLjczOCw4OC4wOTMgTDYzLjcwNSw4OC4xMDQgTDQ4LjkzMiw4NC4wMDMgTDQ3LjkyMiw3Mi42NzkgTDUxLjI1OSw3Mi42NzkgTDU1LjE2MSw3Mi42NzkgTDU1LjY3NCw3OC40MzIgTDYzLjcwNiw4MC42IEw2My43MTMsODAuNTk4IEw2My43MTMsODAuNTk3IEw3MS43NTcsNzguNDI2IEw3Mi41OTQsNjkuMDczIEw2My43MzgsNjkuMDczIEw2My43MTQsNjkuMDczIEw0Ny41OTksNjkuMDczIEw0NS44MjcsNDkuMTk5IEw0NS42NTUsNDcuMjYzIEw2My43MTQsNDcuMjYzIEw2My43MzgsNDcuMjYzIEw4MS43NzksNDcuMjYzIEw4MS42MDYsNDkuMTk5IHoiIGZpbGw9IiNGRjY5MjkiLz4KICA8L2c+Cjwvc3ZnPgo=","stamp": 1539883973595,"creator": "ermouth-1ermouth"},{"_id": "cw-ToDo-4vx1","_rev": "24-06c8419e8cd9c99a8796708b2318e185","name": "ToDo","title": "ToDo List","type": "manifest","desc": "Demo ToDo app, a little like TodoMVC. ","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.ToDo","build": 23,"app": {"name": "ToDo","title": "ToDo List","version": "2","build": 23,"timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzcwQjMxRCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik05Mi43MTcsNDQuODg1IEw4Ni42MzUsMzguODAxIEM4Ni40MjIsMzguNTg4IDg2LjEzMywzOC40NjggODUuODMsMzguNDY4IEM4NS41MjgsMzguNDY4IDg1LjIzOSwzOC41ODggODUuMDI1LDM4LjgwMSBMNjMuMDQ4LDYwLjc3OSBMNTguNzY1LDU2LjQ5NyBDNTguMzIxLDU2LjA1MyA1Ny42LDU2LjA1MyA1Ny4xNTUsNTYuNDk3IEw1MS4wNzIsNjIuNTgxIEM1MC44NTgsNjIuNzk0IDUwLjczOCw2My4wODQgNTAuNzM4LDYzLjM4NiBDNTAuNzM4LDYzLjY4NyA1MC44NTgsNjMuOTc3IDUxLjA3Miw2NC4xOTEgTDYyLjIwNyw3NS4zMjMgQzYyLjQyLDc1LjUzNiA2Mi43MDksNzUuNjU3IDYzLjAxMiw3NS42NTcgQzYzLjAyNSw3NS42NTcgNjMuMDM4LDc1LjY1IDYzLjA1Miw3NS42NSBDNjMuMDYzLDc1LjY1IDYzLjA3NSw3NS42NTYgNjMuMDg3LDc1LjY1NiBDNjMuMzc5LDc1LjY1NiA2My42NjksNzUuNTQ1IDYzLjg5Miw3NS4zMjIgTDkyLjcxNyw0Ni40OTUgQzkzLjE2Miw0Ni4wNSA5My4xNjIsNDUuMzI5IDkyLjcxNyw0NC44ODUgeiIgZmlsbD0iIzY2QTMxQSIvPgogICAgICA8cGF0aCBkPSJNNzguNTk1LDY1LjU1MiBMNzguNTk1LDgwLjQ4MSBMNDcuNTIsODAuNDgxIEw0Ny41Miw0OS40MDUgTDY5LjQzNCw0OS40MDUgTDc2LjQ3NSw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNyBDNDQuMTI3LDQyLjM3IDQ0LjExMiw0Mi4zNjUgNDQuMDk1LDQyLjM2NSBDNDIuMTI4LDQyLjM2NSA0MC41MzYsNDMuOTM4IDQwLjQ4OCw0NS44OTMgTDQwLjQ3OSw0NS44OTMgTDQwLjQ3OSw4My45OTMgTDQwLjQ4OSw4My45OTMgQzQwLjUzNiw4NS45MTggNDIuMDgyLDg3LjQ2NCA0NC4wMDcsODcuNTEyIEw0NC4wMDcsODcuNTIxIEw0NC4wOTUsODcuNTIxIEw0NC4wOTYsODcuNTIxIEM0NC4wOTYsODcuNTIxIDQ0LjA5Niw4Ny41MjEgNDQuMDk2LDg3LjUyMSBMODIuMDE4LDg3LjUyMSBMODIuMDE5LDg3LjUyMSBDODIuMDE5LDg3LjUyMSA4Mi4wMTksODcuNTIxIDgyLjAxOSw4Ny41MjEgTDgyLjEwNyw4Ny41MjEgTDgyLjEwNyw4Ny41MTIgQzg0LjAzMyw4Ny40NjQgODUuNTc5LDg1LjkxOCA4NS42MjYsODMuOTkzIEw4NS42MzUsODMuOTkzIEw4NS42MzUsNTguNTEyIEw3OC41OTUsNjUuNTUyIHoiIGZpbGw9IiM2NkEzMUEiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": ["cmd","editor._id"],"nodetitle": "editor.name","nodedoc": "editor","nodecmd": "cmd","width": [1000],"collapsed": [],"padding": "auto","types": {"todo": ["edit","create"]}},"data": {"cmd": "","filter": ["All"],"editor": {"_id": "","name": "","type": "todo","stamp": "","creator": "","top": {"done": "","text": "","stamp": ""},"list": [{"done": "","text": "","stamp": "","isnew": true}],"log": []},"key": "_"},"init": "function ($o,form) {\n\t\tvar that=this, d = form.data;\n\t\t$o.html(that.FormHTML);\n\t\t//enc key\n\t\tform.data.key= form.data.editor.crypto||\"_\";\n\t}","ui": {"#name": "editor.name","#encrypt": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.key=v;\n\t\t\t\t\tif (v!=\"_\") d.editor.crypto=v;\n\t\t\t\t\telse delete d.editor.crypto;\n\t\t\t\t}\n\t\t\t\treturn v||d.key;\n\t\t\t}","init": "function ($o) {\n\t\t\t\t$o.html(\n\t\t\t\t\t[ {id:\"_\",name:\"No encryption\"} ]\n\t\t\t\t\t.add( cw.crypto.keys() )\n\t\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t\t},\"\")\n\t\t\t\t).select2();\n\t\t\t}"},"#doctags": {"bind": "editor.tags","init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:this.db&&this.db.tags?this.db.tags():[],\n\t\t\t\t\tplaceholder:\"Doc tags\"\n\t\t\t\t});\n\t\t\t}"},"#list": {"bind": "editor.list","manifest": "ToDoLine","list": "<div class=\"todo\"></div>","init": "function ($o,form) {\n\t\t\t\t$o.sortable();\t\t\t// make items draggable\n\t\t\t}"},"#filter": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) d.filter=v;\n\t\t\t\t$o.my(\"find\",\"#list\")\n\t\t\t\t\t.removeClass(\"todoAll todoDone todoActive\")\n\t\t\t\t\t.addClass(\"todo\"+d.filter);\n\t\t\t\treturn d.filter;\n\t\t\t}","init": "function ($o) {\n\t\t\t\t$o.tags({tags:[[\"Active\",\"Done\"]], empty:{\"All\":\"All\"}});\n\t\t\t}"},"#btn-save": {"bind": "function (d,v,$o) { if (v!=null) $o.trigger(\"commit\");}","events": "click","css": {":disabled": "function (d) { return !d.editor.name }"},"watch": "#name"},"#btn-cancel": {"bind": "function (d,v,$o) { if (v!=null) $o.trigger(\"cancel\");}","events": "click.my"},"#atts": {"delay": 50,"init": "function ($o,form) {\n\t\t\t\t$o.my(\"cw.Sys.Attachments\", {\n\t\t\t\t\tdoc:form.data.editor,\n\t\t\t\t\ttruncate:20\n\t\t\t\t});\n\t\t\t}","bind": "function () {}"}},"ToDoLine": {"id": "TodoLine","data": {"done": "","text": "","stamp": "","isnew": true},"init": "function ($o,form) {\n\t\t$o.html('<div id=\"isdone\"></div>'\n\t\t\t\t\t\t+'<textarea id=\"text\" placeholder='\n\t\t\t\t\t\t+'\"What need to be done?\"></textarea>');\n\t\tif (!form.data.stamp) form.data.stamp=Date.now();\n\t}","ui": {"#isdone": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) d.done = d.done?\"\":\"done\";\n\t\t\t\t$o.toggleClass(\"fi-checkbox green o80\", !!d.done)\n\t\t\t\t.toggleClass(\"fi-check lgray\", !d.done)\n\t\t\t\t.parent().toggleClass(\"done\", !!d.done);\n\t\t\t}","events": "click"},"#text": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.text = v.replace(/^-\\s/,\"— \");\n\t\t\t\t\tvar idx = $o.my(\"index\")+1, \n\t\t\t\t\t\t\t$list=$o.parents(\".my-form-list:eq(0)\");\n\t\t\t\t\tif (!d.text && !d.isnew \n\t\t\t\t\t\t\t&& $list.find(\">div\").size()>1\n\t\t\t\t\t\t ) {\n\t\t\t\t\t\t// focus back after delay\n\t\t\t\t\t\t(function(){\n\t\t\t\t\t\t\t$list.find(\">div:eq(\"+(idx-2).clamp(0,1e5)+\") #text\").focus();\n\t\t\t\t\t\t\t$o.trigger(\"remove\");\n\t\t\t\t\t\t}).delay(100);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\tif (v.length) d.isnew=false;\n\t\t\t\t\t// we have split\n\t\t\t\t\tif (/[\\r\\n]/.test(v)) {\n\t\t\t\t\t\tvar a = v.split(/[\\r\\n]/);\n\t\t\t\t\t\t\n\t\t\t\t\t\td.text=a[0];\n\n\t\t\t\t\t\tif (!a[0].compact()) {\n\t\t\t\t\t\t\td.text=a[1];  idx-=1;\n\t\t\t\t\t\t\t$o.trigger(\"insert\",\"before\");\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse if (!a[1].compact()) $o.trigger(\"insert\",\"after\");\n\t\t\t\t\t\telse $o.trigger(\"insert\",{where:\"after\", what:{text:a[1]}});\n\n\t\t\t\t\t\t// focus back after delay\n\t\t\t\t\t\t(function(){\n\t\t\t\t\t\t\t$list.find(\">div:eq(\"+idx+\") #text\").focus();\n\t\t\t\t\t\t}).delay(100);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ($o.is(\":visible\")) (function(){$o.height(0).height($o[0].scrollHeight);}).delay(40);\n\t\t\t\treturn d.text;\n\t\t\t}","css": {"sub": "function (d) {return /^(—.|–.|\\*.|--)$/.test(d.text.to(2))}","imp1": "function (d) {return /[^!]!$/.test(d.text)}","imp2": "function (d) {return /!!$/.test(d.text)}","imp3": "function (d) {return /^\\d*\\./.test(d.text)}"}}}},"FormHTML": "<div id=\"cont\" class=\"w700 oh dib vat\" style=\"margin:0 30px 0 30px\">\n\t<div id=\"head\" class=\"pb10\">\n\t\t<div class=\"w500 dib vat\">\n\t\t\t<input id=\"name\" type=\"text\" class=\"w500 fs130 p8\" placeholder=\"ToDo title\" />\n\t\t</div><div \n\t\tclass=\"w200 vat dib fs90 tar pt10 mt4\">\n\t\t\t<span id=\"filter\"></span>\n\t\t</div>\n\t</div>\n\t<div id=\"list\"></div>\n</div><div \nid=\"panel\" class=\"w200 dib vat mr\">\n\t<div class=\"my-row\">\n\t\t<input type=\"button\" id=\"btn-save\" class=\"fs110 green w100 ml-5 mr5 tac br100\" value=\"Save\"><input \n\t\ttype=\"button\" id=\"btn-cancel\" class=\"fs110 w100 mr0 tac br100\" value=\"Close\">\n\t</div>\n\t<div class=\"mt15\"><select id=\"encrypt\" class=\"fs90 w200 mt15\"></select></div>\n\t<div class=\"mt10\"><input type=\"text\" id=\"doctags\" class=\"fs80 w200\"></div>\n\t<div id=\"atts\" class=\"fs80 gray mt15 ml2\"></div>\n</div>","style": {"": "font-size:14pt; line-height:1.5em"," textarea": "border:none;min-height:0!important;font-size:14pt;transition: color 0.3s;resize:none;"," .todo": "width:700px;overflow:hidden;cursor:move;padding:4px 0 4px 10px;"," #isdone": "width:30px;display:inline-block;vertical-align:top;padding:1px 10px 3px 0;font-size:120%;opacity:0.7"," #text": "margin:0;height:35px;width:660px;padding:0;display:inline-block;vertical-align:top;"," .fi-checkbox+#text": "text-decoration:line-through;opacity:0.7;color:inherit;"," .sub": "padding:0px 0 2px 10px;"," .sub #isdone": "opacity:0.4"," .sub textarea": "font-size:12.5pt;height: 1.2em;"," .imp1 textarea": "color:#05a;"," .imp2 textarea": "color:#c02;"," .imp3 textarea": "font-weight:bolder;font-size:1.1em;"," .button": "border-radius:100px"," .todoActive>.done": "display:none"," .todoDone>div:not(.done)": "display:none"}},"raw": {"name": "ToDo","title": "ToDo List","version": "2","build": 23,"com": [{"stamp": "1406848222680","id": "Root","type": "js","data": "({\n\t// CloudWall simple ToDo list\n  // (c) 2018 ermouth\n  \n\tdata:{ \n\t\tcmd:\"\",\n\t\tfilter:[\"All\"],\n\t\teditor:{\n\t\t\t// Doc struct to edit/save\n\t\t\t_id:\"\", name:\"\", \n\t\t\ttype:\"todo\", stamp:\"\", \n\t\t\tcreator:\"\", \n\t\t\ttop:{done:\"\", text:\"\", stamp:\"\"},\n\t\t\tlist:[{done:\"\", text:\"\", stamp:\"\", isnew:true}], log:[]\n\t\t},\n\t\tkey:\"_\"\n\t},\n\t// Init function, renders HTML\n\t// and start some event monitors\n\tinit: function ($o, form) {\n\t\tvar that=this, d = form.data;\n\t\t$o.html(that.FormHTML);\n\t\t//enc key\n\t\tform.data.key= form.data.editor.crypto||\"_\";\n\t},\n\t// UI↔data bindings\n\tui:{\n\t\t\"#name\":\"editor.name\",\n\t\t\"#encrypt\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.key=v;\n\t\t\t\t\tif (v!=\"_\") d.editor.crypto=v;\n\t\t\t\t\telse delete d.editor.crypto;\n\t\t\t\t}\n\t\t\t\treturn v||d.key;\n\t\t\t},\n\t\t\tinit: function($o) {\n\t\t\t\t$o.html(\n\t\t\t\t\t[ {id:\"_\",name:\"No encryption\"} ]\n\t\t\t\t\t.add( cw.crypto.keys() )\n\t\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t\t},\"\")\n\t\t\t\t).select2();\n\t\t\t}\n\t\t},\n\t\t\"#doctags\":{\n\t\t\tbind:\"editor.tags\",\n\t\t\tinit: function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:this.db&&this.db.tags?this.db.tags():[],\n\t\t\t\t\tplaceholder:\"Doc tags\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"#list\":{\n\t\t\tbind:\"editor.list\",\n\t\t\tmanifest:\"ToDoLine\",\t// Defined later\n\t\t\tlist:'<div class=\"todo\"></div>',\n\t\t\tinit:function($o, form) {\n\t\t\t\t$o.sortable();\t\t\t// make items draggable\n\t\t\t}\n\t\t},\n\t\t\"#filter\":{\n\t\t\tbind:function (d,v,$o){\n\t\t\t\tif (v!=null) d.filter=v;\n\t\t\t\t$o.my(\"find\",\"#list\")\n\t\t\t\t\t.removeClass(\"todoAll todoDone todoActive\")\n\t\t\t\t\t.addClass(\"todo\"+d.filter);\n\t\t\t\treturn d.filter;\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\t$o.tags({tags:[[\"Active\",\"Done\"]], empty:{\"All\":\"All\"}});\n\t\t\t}\n\t\t},\n\t\t\"#btn-save\":{\n\t\t\tbind: function (d,v,$o){ if (v!=null) $o.trigger(\"commit\");},\n\t\t\tevents:\"click\",\n\t\t\tcss:{\n\t\t\t\t\":disabled\":function (d){ return !d.editor.name }\n\t\t\t},\n\t\t\twatch:\"#name\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind:function(d,v,$o){ if (v!=null) $o.trigger(\"cancel\");},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t\"#atts\":{\n\t\t\tdelay:50,\n\t\t\tinit: function ($o, form) {\n\t\t\t\t$o.my(\"cw.Sys.Attachments\", {\n\t\t\t\t\tdoc:form.data.editor,\n\t\t\t\t\ttruncate:20\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind: function (){}\n\t\t}\n\t}\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1406848723158","id": ".ToDoLine","type": "js","data": "({\n\t\t// Single line manifest\n\tid:\"TodoLine\",\n\tdata:{done:\"\", text:\"\", stamp:\"\", isnew:true},\n\tinit: function($o, form) {\n\t\t$o.html('<div id=\"isdone\"></div>'\n\t\t\t\t\t\t+'<textarea id=\"text\" placeholder='\n\t\t\t\t\t\t+'\"What need to be done?\"></textarea>');\n\t\tif (!form.data.stamp) form.data.stamp=Date.now();\n\t},\n\tui:{\n\t\t\"#isdone\":{\n\t\t\tbind:function (d,v,$o) {\n\t\t\t\tif (v!=null) d.done = d.done?\"\":\"done\";\n\t\t\t\t$o.toggleClass(\"fi-checkbox green o80\", !!d.done)\n\t\t\t\t.toggleClass(\"fi-check lgray\", !d.done)\n\t\t\t\t.parent().toggleClass(\"done\", !!d.done);\n\t\t\t},\n\t\t\tevents:\"click\"\n\t\t},\n\t\t\"#text\":{\n\t\t\tbind:function (d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.text = v.replace(/^-\\s/,\"— \");\n\t\t\t\t\tvar idx = $o.my(\"index\")+1, \n\t\t\t\t\t\t\t$list=$o.parents(\".my-form-list:eq(0)\");\n\t\t\t\t\tif (!d.text && !d.isnew \n\t\t\t\t\t\t\t&& $list.find(\">div\").size()>1\n\t\t\t\t\t\t ) {\n\t\t\t\t\t\t// focus back after delay\n\t\t\t\t\t\t(function(){\n\t\t\t\t\t\t\t$list.find(\">div:eq(\"+(idx-2).clamp(0,1e5)+\") #text\").focus();\n\t\t\t\t\t\t\t$o.trigger(\"remove\");\n\t\t\t\t\t\t}).delay(100);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\tif (v.length) d.isnew=false;\n\t\t\t\t\t// we have split\n\t\t\t\t\tif (/[\\r\\n]/.test(v)) {\n\t\t\t\t\t\tvar a = v.split(/[\\r\\n]/);\n\t\t\t\t\t\t\n\t\t\t\t\t\td.text=a[0];\n\n\t\t\t\t\t\tif (!a[0].compact()) {\n\t\t\t\t\t\t\td.text=a[1];  idx-=1;\n\t\t\t\t\t\t\t$o.trigger(\"insert\",\"before\");\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse if (!a[1].compact()) $o.trigger(\"insert\",\"after\");\n\t\t\t\t\t\telse $o.trigger(\"insert\",{where:\"after\", what:{text:a[1]}});\n\n\t\t\t\t\t\t// focus back after delay\n\t\t\t\t\t\t(function(){\n\t\t\t\t\t\t\t$list.find(\">div:eq(\"+idx+\") #text\").focus();\n\t\t\t\t\t\t}).delay(100);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ($o.is(\":visible\")) (function(){$o.height(0).height($o[0].scrollHeight);}).delay(40);\n\t\t\t\treturn d.text;\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"sub\":function(d) {return /^(—.|–.|\\*.|--)$/.test(d.text.to(2))},\n\t\t\t\t\"imp1\":function(d){return /[^!]!$/.test(d.text)},\n\t\t\t\t\"imp2\":function(d){return /!!$/.test(d.text)},\n\t\t\t\t\"imp3\":function(d){return /^\\d*\\./.test(d.text)}\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1406848296963","id": ".FormHTML","type": "html","data": "<div id=\"cont\" class=\"w700 oh dib vat\" style=\"margin:0 30px 0 30px\">\n\t<div id=\"head\" class=\"pb10\">\n\t\t<div class=\"w500 dib vat\">\n\t\t\t<input id=\"name\" type=\"text\" class=\"w500 fs130 p8\" placeholder=\"ToDo title\" />\n\t\t</div><div \n\t\tclass=\"w200 vat dib fs90 tar pt10 mt4\">\n\t\t\t<span id=\"filter\"></span>\n\t\t</div>\n\t</div>\n\t<div id=\"list\"></div>\n</div><div \nid=\"panel\" class=\"w200 dib vat mr\">\n\t<div class=\"my-row\">\n\t\t<input type=\"button\" id=\"btn-save\" class=\"fs110 green w100 ml-5 mr5 tac br100\" value=\"Save\"><input \n\t\ttype=\"button\" id=\"btn-cancel\" class=\"fs110 w100 mr0 tac br100\" value=\"Close\">\n\t</div>\n\t<div class=\"mt15\"><select id=\"encrypt\" class=\"fs90 w200 mt15\"></select></div>\n\t<div class=\"mt10\"><input type=\"text\" id=\"doctags\" class=\"fs80 w200\"></div>\n\t<div id=\"atts\" class=\"fs80 gray mt15 ml2\"></div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1427605420453","id": ".style","type": "js","data": "({\n\t// Stylesheet\n\t\"\":\"font-size:14pt; line-height:1.5em\",\n\t\" textarea\":\t\"border:none;min-height:0!important;font-size:14pt;transition: color 0.3s;resize:none;\",\n\t\" .todo\":\t\t\t'width:700px;overflow:hidden;cursor:move;padding:4px 0 4px 10px;',\n\t\" #isdone\":\t\t'width:30px;display:inline-block;vertical-align:top;'\n\t+'padding:1px 10px 3px 0;font-size:120%;opacity:0.7',\n\t\" #text\":\t\t\t\"margin:0;height:35px;width:660px;padding:0;display:inline-block;vertical-align:top;\",\n\t\" .fi-checkbox+#text\":\"text-decoration:line-through;opacity:0.7;color:inherit;\",\n\t\" .sub\":\t'padding:0px 0 2px 10px;',\n\t\" .sub #isdone\":\"opacity:0.4\",\n\t\" .sub textarea\":\t\"font-size:12.5pt;height: 1.2em;\",\n\t\" .imp1 textarea\":\"color:#05a;\",\n\t\" .imp2 textarea\":\"color:#c02;\",\n\t\" .imp3 textarea\":\"font-weight:bolder;font-size:1.1em;\",\n\t\" .button\":\t\t\"border-radius:100px\",\n\t\" .todoActive>.done\":\t\t\t\t\"display:none\",\n\t\" .todoDone>div:not(.done)\":\"display:none\"\n})","active": false,"opts": [],"err": [],"color": ["orange"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzcwQjMxRCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik05Mi43MTcsNDQuODg1IEw4Ni42MzUsMzguODAxIEM4Ni40MjIsMzguNTg4IDg2LjEzMywzOC40NjggODUuODMsMzguNDY4IEM4NS41MjgsMzguNDY4IDg1LjIzOSwzOC41ODggODUuMDI1LDM4LjgwMSBMNjMuMDQ4LDYwLjc3OSBMNTguNzY1LDU2LjQ5NyBDNTguMzIxLDU2LjA1MyA1Ny42LDU2LjA1MyA1Ny4xNTUsNTYuNDk3IEw1MS4wNzIsNjIuNTgxIEM1MC44NTgsNjIuNzk0IDUwLjczOCw2My4wODQgNTAuNzM4LDYzLjM4NiBDNTAuNzM4LDYzLjY4NyA1MC44NTgsNjMuOTc3IDUxLjA3Miw2NC4xOTEgTDYyLjIwNyw3NS4zMjMgQzYyLjQyLDc1LjUzNiA2Mi43MDksNzUuNjU3IDYzLjAxMiw3NS42NTcgQzYzLjAyNSw3NS42NTcgNjMuMDM4LDc1LjY1IDYzLjA1Miw3NS42NSBDNjMuMDYzLDc1LjY1IDYzLjA3NSw3NS42NTYgNjMuMDg3LDc1LjY1NiBDNjMuMzc5LDc1LjY1NiA2My42NjksNzUuNTQ1IDYzLjg5Miw3NS4zMjIgTDkyLjcxNyw0Ni40OTUgQzkzLjE2Miw0Ni4wNSA5My4xNjIsNDUuMzI5IDkyLjcxNyw0NC44ODUgeiIgZmlsbD0iIzY2QTMxQSIvPgogICAgICA8cGF0aCBkPSJNNzguNTk1LDY1LjU1MiBMNzguNTk1LDgwLjQ4MSBMNDcuNTIsODAuNDgxIEw0Ny41Miw0OS40MDUgTDY5LjQzNCw0OS40MDUgTDc2LjQ3NSw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNyBDNDQuMTI3LDQyLjM3IDQ0LjExMiw0Mi4zNjUgNDQuMDk1LDQyLjM2NSBDNDIuMTI4LDQyLjM2NSA0MC41MzYsNDMuOTM4IDQwLjQ4OCw0NS44OTMgTDQwLjQ3OSw0NS44OTMgTDQwLjQ3OSw4My45OTMgTDQwLjQ4OSw4My45OTMgQzQwLjUzNiw4NS45MTggNDIuMDgyLDg3LjQ2NCA0NC4wMDcsODcuNTEyIEw0NC4wMDcsODcuNTIxIEw0NC4wOTUsODcuNTIxIEw0NC4wOTYsODcuNTIxIEM0NC4wOTYsODcuNTIxIDQ0LjA5Niw4Ny41MjEgNDQuMDk2LDg3LjUyMSBMODIuMDE4LDg3LjUyMSBMODIuMDE5LDg3LjUyMSBDODIuMDE5LDg3LjUyMSA4Mi4wMTksODcuNTIxIDgyLjAxOSw4Ny41MjEgTDgyLjEwNyw4Ny41MjEgTDgyLjEwNyw4Ny41MTIgQzg0LjAzMyw4Ny40NjQgODUuNTc5LDg1LjkxOCA4NS42MjYsODMuOTkzIEw4NS42MzUsODMuOTkzIEw4NS42MzUsNTguNTEyIEw3OC41OTUsNjUuNTUyIHoiIGZpbGw9IiM2NkEzMUEiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "todo","actions": ["edit","create"]}],"_opts": {"compileTo": ["js"],"runWidth": "1000","runMode": ["fullscreen"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Demo ToDo app, a little like TodoMVC. ","timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzcwQjMxRCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik05Mi43MTcsNDQuODg1IEw4Ni42MzUsMzguODAxIEM4Ni40MjIsMzguNTg4IDg2LjEzMywzOC40NjggODUuODMsMzguNDY4IEM4NS41MjgsMzguNDY4IDg1LjIzOSwzOC41ODggODUuMDI1LDM4LjgwMSBMNjMuMDQ4LDYwLjc3OSBMNTguNzY1LDU2LjQ5NyBDNTguMzIxLDU2LjA1MyA1Ny42LDU2LjA1MyA1Ny4xNTUsNTYuNDk3IEw1MS4wNzIsNjIuNTgxIEM1MC44NTgsNjIuNzk0IDUwLjczOCw2My4wODQgNTAuNzM4LDYzLjM4NiBDNTAuNzM4LDYzLjY4NyA1MC44NTgsNjMuOTc3IDUxLjA3Miw2NC4xOTEgTDYyLjIwNyw3NS4zMjMgQzYyLjQyLDc1LjUzNiA2Mi43MDksNzUuNjU3IDYzLjAxMiw3NS42NTcgQzYzLjAyNSw3NS42NTcgNjMuMDM4LDc1LjY1IDYzLjA1Miw3NS42NSBDNjMuMDYzLDc1LjY1IDYzLjA3NSw3NS42NTYgNjMuMDg3LDc1LjY1NiBDNjMuMzc5LDc1LjY1NiA2My42NjksNzUuNTQ1IDYzLjg5Miw3NS4zMjIgTDkyLjcxNyw0Ni40OTUgQzkzLjE2Miw0Ni4wNSA5My4xNjIsNDUuMzI5IDkyLjcxNyw0NC44ODUgeiIgZmlsbD0iIzY2QTMxQSIvPgogICAgICA8cGF0aCBkPSJNNzguNTk1LDY1LjU1MiBMNzguNTk1LDgwLjQ4MSBMNDcuNTIsODAuNDgxIEw0Ny41Miw0OS40MDUgTDY5LjQzNCw0OS40MDUgTDc2LjQ3NSw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNyBDNDQuMTI3LDQyLjM3IDQ0LjExMiw0Mi4zNjUgNDQuMDk1LDQyLjM2NSBDNDIuMTI4LDQyLjM2NSA0MC41MzYsNDMuOTM4IDQwLjQ4OCw0NS44OTMgTDQwLjQ3OSw0NS44OTMgTDQwLjQ3OSw4My45OTMgTDQwLjQ4OSw4My45OTMgQzQwLjUzNiw4NS45MTggNDIuMDgyLDg3LjQ2NCA0NC4wMDcsODcuNTEyIEw0NC4wMDcsODcuNTIxIEw0NC4wOTUsODcuNTIxIEw0NC4wOTYsODcuNTIxIEM0NC4wOTYsODcuNTIxIDQ0LjA5Niw4Ny41MjEgNDQuMDk2LDg3LjUyMSBMODIuMDE4LDg3LjUyMSBMODIuMDE5LDg3LjUyMSBDODIuMDE5LDg3LjUyMSA4Mi4wMTksODcuNTIxIDgyLjAxOSw4Ny41MjEgTDgyLjEwNyw4Ny41MjEgTDgyLjEwNyw4Ny41MTIgQzg0LjAzMyw4Ny40NjQgODUuNTc5LDg1LjkxOCA4NS42MjYsODMuOTkzIEw4NS42MzUsODMuOTkzIEw4NS42MzUsNTguNTEyIEw3OC41OTUsNjUuNTUyIHoiIGZpbGw9IiM2NkEzMUEiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": "editor._id","nodetitle": "editor.name","nodedoc": "editor","nodecmd": "cmd","types": "","width": [1000],"collapsed": [],"padding": "auto"},"log": [[1539884005510,"update","ermouth-524yb546",24,"dev-cloudwall2"]],"id": "cw.ToDo","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iIzcwQjMxRCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik05Mi43MTcsNDQuODg1IEw4Ni42MzUsMzguODAxIEM4Ni40MjIsMzguNTg4IDg2LjEzMywzOC40NjggODUuODMsMzguNDY4IEM4NS41MjgsMzguNDY4IDg1LjIzOSwzOC41ODggODUuMDI1LDM4LjgwMSBMNjMuMDQ4LDYwLjc3OSBMNTguNzY1LDU2LjQ5NyBDNTguMzIxLDU2LjA1MyA1Ny42LDU2LjA1MyA1Ny4xNTUsNTYuNDk3IEw1MS4wNzIsNjIuNTgxIEM1MC44NTgsNjIuNzk0IDUwLjczOCw2My4wODQgNTAuNzM4LDYzLjM4NiBDNTAuNzM4LDYzLjY4NyA1MC44NTgsNjMuOTc3IDUxLjA3Miw2NC4xOTEgTDYyLjIwNyw3NS4zMjMgQzYyLjQyLDc1LjUzNiA2Mi43MDksNzUuNjU3IDYzLjAxMiw3NS42NTcgQzYzLjAyNSw3NS42NTcgNjMuMDM4LDc1LjY1IDYzLjA1Miw3NS42NSBDNjMuMDYzLDc1LjY1IDYzLjA3NSw3NS42NTYgNjMuMDg3LDc1LjY1NiBDNjMuMzc5LDc1LjY1NiA2My42NjksNzUuNTQ1IDYzLjg5Miw3NS4zMjIgTDkyLjcxNyw0Ni40OTUgQzkzLjE2Miw0Ni4wNSA5My4xNjIsNDUuMzI5IDkyLjcxNyw0NC44ODUgeiIgZmlsbD0iIzY2QTMxQSIvPgogICAgICA8cGF0aCBkPSJNNzguNTk1LDY1LjU1MiBMNzguNTk1LDgwLjQ4MSBMNDcuNTIsODAuNDgxIEw0Ny41Miw0OS40MDUgTDY5LjQzNCw0OS40MDUgTDc2LjQ3NSw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNjUgTDQ0LjE0Myw0Mi4zNyBDNDQuMTI3LDQyLjM3IDQ0LjExMiw0Mi4zNjUgNDQuMDk1LDQyLjM2NSBDNDIuMTI4LDQyLjM2NSA0MC41MzYsNDMuOTM4IDQwLjQ4OCw0NS44OTMgTDQwLjQ3OSw0NS44OTMgTDQwLjQ3OSw4My45OTMgTDQwLjQ4OSw4My45OTMgQzQwLjUzNiw4NS45MTggNDIuMDgyLDg3LjQ2NCA0NC4wMDcsODcuNTEyIEw0NC4wMDcsODcuNTIxIEw0NC4wOTUsODcuNTIxIEw0NC4wOTYsODcuNTIxIEM0NC4wOTYsODcuNTIxIDQ0LjA5Niw4Ny41MjEgNDQuMDk2LDg3LjUyMSBMODIuMDE4LDg3LjUyMSBMODIuMDE5LDg3LjUyMSBDODIuMDE5LDg3LjUyMSA4Mi4wMTksODcuNTIxIDgyLjAxOSw4Ny41MjEgTDgyLjEwNyw4Ny41MjEgTDgyLjEwNyw4Ny41MTIgQzg0LjAzMyw4Ny40NjQgODUuNTc5LDg1LjkxOCA4NS42MjYsODMuOTkzIEw4NS42MzUsODMuOTkzIEw4NS42MzUsNTguNTEyIEw3OC41OTUsNjUuNTUyIHoiIGZpbGw9IiM2NkEzMUEiLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=","stamp": 1539884005509,"creator": "ermouth-1ermouth"},{"_id": "cw-Sys-JSON-4vx1","_rev": "225-4c47b9844444f814380823d2f3516fc3","name": "Sys.JSON","title": "JSON Editor","type": "manifest","desc": "JSON editor, recognizes timestamps, functions, base64 binaries and so on.","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Sys.JSON","build": 5,"app": {"name": "Sys.JSON","title": "JSON Editor","version": "2.5","build": 5,"timeout": "5000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NGOThGRiIvPgogICAgPHBhdGggZD0iTTM5LjkyMSw0OS44OTMgTDM3LjU0OSw1Mi41MTcgTDI3LjI1Niw2My45MDMgTDM3LjU1OCw3NS40OTMgTDM5Ljg4Miw3OC4xMDcgTDMwLjQxMiw3OC4xMDcgTDI5Ljk0Myw3Ny41OCBMMTguNzA2LDY0LjkzOCBMMTcuNzcxLDYzLjg4NiBMMTguNzE1LDYyLjg0MSBMMjkuOTUyLDUwLjQxIEwzMC40MTksNDkuODkzIEwzOS45MjEsNDkuODkzIHogTTU4Ljk0NywzMS45NDkgTDUzLjA5MiwzMS45NDkgQzQ3LjQ0OSwzMS45NDkgNDIuNzQzLDM2LjY1NSA0Mi43NDMsNDMuMDAxIEw0Mi43NDMsNTcuMzk4IEM0Mi43NDMsNTkuNDc4IDQxLjkyNiw2MC42NzQgNDAuNjYxLDYwLjY3NCBMMzkuMDkxLDYwLjY3NCBMMzkuMDkxLDY3LjMyNiBMNDAuNjYxLDY3LjMyNiBDNDEuOTI2LDY3LjMyNiA0Mi43NDMsNjguNTIyIDQyLjc0Myw3MC42MDIgTDQyLjc0Myw4NS4wNyBDNDIuNzQzLDkxLjM1OCA0Ny40NjEsOTYuMDUxIDUzLjA5Miw5Ni4wNTEgTDU4Ljk0Nyw5Ni4wNTEgTDU4Ljk0Nyw4OS4wNDcgTDUzLjA5Miw4OS4wNDcgQzUxLjQ0OSw4OS4wNDcgNTAuMDI4LDg3LjM2IDUwLjAyOCw4NC45OTkgTDUwLjAyOCw3MC4xOCBDNDkuOTI3LDY4LjAxMyA0OS42MzUsNjUuNTggNDcuOTU2LDY0IEM0OS42MzcsNjIuNDY0IDQ5Ljk1Miw1OS45NSA1MC4wMjgsNTcuODIgTDUwLjAyOCw0My4wMDEgQzUwLjAyOCw0MC41OTcgNTEuNDI0LDM4Ljk1MyA1My4wOTIsMzguOTUzIEw1OC45NDcsMzguOTUzIEw1OC45NDcsMzEuOTQ5IHogTTc0LjQyMywzMS45NDkgTDY4LjU2OCwzMS45NDkgTDY4LjU2OCwzOC45NTMgTDc0LjQyMywzOC45NTMgQzc2LjA5MSwzOC45NTMgNzcuNDg3LDQwLjU5NyA3Ny40ODcsNDMuMDAxIEw3Ny40ODcsNTcuODIgQzc3LjU4OCw1OS45ODcgNzcuODgsNjIuNDIgNzkuNTU5LDY0IEM3Ny44NzksNjUuNTM2IDc3LjU2Myw2OC4wNSA3Ny40ODcsNzAuMTggTDc3LjQ4Nyw4NC45OTkgQzc3LjQ4Nyw4Ny4zNiA3Ni4wNjYsODkuMDQ3IDc0LjQyMyw4OS4wNDcgTDY4LjU2OCw4OS4wNDcgTDY4LjU2OCw5Ni4wNTEgTDc0LjQyMyw5Ni4wNTEgQzgwLjEwMSw5Ni4wNTEgODQuNzcyLDkxLjM4IDg0Ljc3Miw4NS4wNyBMODQuNzcyLDcwLjYwMiBDODQuNzcyLDY4LjUyMiA4NS41ODksNjcuMzI2IDg2Ljg1NCw2Ny4zMjYgTDg4LjQyNCw2Ny4zMjYgTDg4LjQyNCw2MC42NzQgTDg2Ljg1NCw2MC42NzQgQzg1LjU4OSw2MC42NzQgODQuNzcyLDU5LjQ3OCA4NC43NzIsNTcuMzk4IEw4NC43NzIsNDMuMDAxIEM4NC43NzIsMzYuNjMzIDgwLjExMywzMS45NDkgNzQuNDIzLDMxLjk0OSB6IE05Ny41OCw0OS44OTMgTDg4LjA3OSw0OS44OTMgTDkwLjQ1MSw1Mi41MTcgTDEwMC43NDQsNjMuOTAzIEw5MC40NDIsNzUuNDkzIEw4OC4xMTgsNzguMTA3IEw5Ny41ODgsNzguMTA3IEw5OC4wNTcsNzcuNTggTDEwOS4yOTQsNjQuOTM4IEwxMTAuMjI5LDYzLjg4NiBMMTA5LjI4NSw2Mi44NDEgTDk4LjA0OCw1MC40MSBMOTcuNTgsNDkuODkzIHoiIGZpbGw9IiNCQTcwRDYiLz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": ["cmd","doc._id"],"nodetitle": "title","nodedoc": "doc","nodecmd": "cmd","width": [[820,1200],1000,1200],"collapsed": [".Event",".MAdd",".style"],"padding": "auto","types": {"*": ["create","json","edit"]}},"Version": "2.5","data": {"doc": {},"labelWidth": 130,"tree": {},"cmd": "","title": "Untitled JSON","raw": "","viewstate": {},"search": "","found": {}},"RT": "function (key) {return key?this[key]:this;}","MRoot": "function () {return this.my.root()}","params": {"restyle": 100,"delay": 0},"Lib": {"relist": "function ($o,that) {\n\t\tvar form = that;\n\t\tthat.List = that.MakeList(form.data);\n\t\t$($o[0].querySelector('.ilist')).trigger('recalc');\n\t\t$($o[0].querySelector('.idesc')).trigger('check');\n\t}","kick": "function (cont,obj) {\n\t\tfor (var i in cont) delete cont[i];\n\t\tObject.merge(cont,obj);\n\t}","isSystem": "function (d) {\n\t\tvar sys=false;\n\t\tif (d.level==1 && /^(_id|_rev)$/.test(d.key) && d.value) {\n\t\t\tsys = true;\n\t\t}\n\t\treturn sys;\n\t}","keyBind": "function (d,v,$o) {\n\t\tvar maxlen = this.labelWidth/3 | 0,\n\t\t\t\ts, re;\n\t\tif ((d.state & 4) && (re = this.RT('SearchRe'))) {\n\t\t\ts = d.key\n\t\t\t.replace(this.RT('SearchRe'), '\\ufff1$1\\ufff0')\n\t\t\t.escapeHTML()\n\t\t\t.replace('\\ufff1','<span class=\"jval-found-key\">')\n\t\t\t.replace('\\ufff0','</span>');\n\t\t}\n\t\telse {\n\t\t\tif (d.key.length > maxlen) $o.attr('title',d.key.escapeHTML());\n\t\t\ts = (!/^(|\\s+)$/.test(d.key))?d.key.truncate(maxlen,'right','…').escapeHTML():'\"'+d.key.escapeHTML()+'\"'; \n\t\t}\n\t\treturn s;\n\t}","initEdit": "function ($o,that,oncommit) {\n\t\tvar d = that.data;\n\t\t\n\t\t// invoke editor\n\t\t$o.on(\"click.my\", function(evt){\n\t\t\t\n\t\t\tvar $t = $(evt.target);\n\t\t\tif ($t.is('a') || $t.is('img')) return;\n\t\t\t\n\t\t\tvar $n = that.my.find('.inav');\n\t\t\tif (!$n.hasClass(\"iseditor\")) {\n\t\t\t\tvar isSystem = that.RT('Lib').isSystem.call(that, d);\n\t\t\t\tif (isSystem) {\n\t\t\t\t\tcw.lib.note(Object.isString(isSystem)?isSystem:\"Can’t change system properties.\",\"error\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\td.state = 2;\n\t\t\t\t\t$n.addClass(\"iseditor\");\n\t\t\t\t\t$o.addClass('hide');\n\t\t\t\t\t\n\t\t\t\t\t// Run editor\n\t\t\t\t\tthat.my.find('.ieditor').my(\n\t\t\t\t\t\tthat.RT('MEdit'), \n\t\t\t\t\t\t{text:d.value+'', mode:that.CM || 'auto'}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\tthat.my.root()\n\t\t.on(\"editorcommit.my\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $n = that.my.find('.inav');\n\t\t\tif ($n.hasClass(\"iseditor\")) {\n\t\t\t\tvar prev = d.value;\n\t\t\t\td.value = that.my.find('.ieditor').my('data').text;\n\t\t\t\t_closeEd();\n\t\t\t\tif (typeof oncommit == 'function') oncommit(d.value, prev);\n\t\t\t\telse {\n\t\t\t\t\t//$o.text('\"'+d.value.to(140)).escapeHTML().trigger(\"check\");\n\t\t\t\t\t$o.trigger(\"check\");\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.on(\"editorcancel.my\", function(evt){ \t\n\t\t\tevt.stopPropagation();\n\t\t\t_closeEd(); \n\t\t});\n\n\t\t// - - - - - -\n\n\t\tfunction _closeEd(){\n\t\t\td.state = 1;\n\t\t\td.hash = cw.lib.sdbm(d.value);\n\t\t\tthat.my.find('.ieditor').my('remove');\n\t\t\tthat.my.find('.inav').removeClass('iseditor');\n\t\t\t$o.removeClass('hide');\n\t\t\t//that.my.root().off('editorcommit.my').off('editorcancel.my')\n\t\t}\n\n\t}"},"MemState": "function (node) {\n\t\tvar d = this.data, old; \n\t\tif (!d.viewstate) this.data.viewstate={};\n\t\told = d.viewstate[cw.lib.sdbm(node.path.join('❀')+'❀'+node.key)];\n\t\tif (old != node.state) {\n\t\t\td.viewstate[cw.lib.sdbm(node.path.join('❀')+'❀'+node.key)] = node.state;\n\t\t\tif (d._id) this.MemStateSave();\n\t\t}\n\t}","MemStateSave": "function () {\n\t\t// debounced by init\n\t\tvar d = this.data;\n\t\tif (d._id && Object.size(d.viewstate)) {\n\t\t\tvar state = Object.keys(d.viewstate).reduce(function(a,b){\n\t\t\t\tif(d.viewstate[b]==2) a.push(b); \n\t\t\t\treturn a;\n\t\t\t},[]);\n\t\t\tthis.Ls(\"viewstate.\"+cw.lib.sdbm((d.dbname || '') + '/'+d._id), {stamp:Date.now(), state:state});\n\t\t}\n\t}","MemStateRestore": "function () {\n\t\t// debounced by init\n\t\tvar d = this.data;\n\t\tif (d._id) {\n\t\t\tvar state = this.Ls(\"viewstate.\"+cw.lib.sdbm((d.dbname || '') + '/'+d._id));\n\t\t\tif (!Object.isObject(state)) return;\n\t\t\td.viewstate = state.state.reduce(function(a,b){\n\t\t\t\ta[b] = 2;\n\t\t\t\treturn a;\n\t\t\t},{});\n\t\t}\n\t}","Rejoin": "function (d,list) {\n\t\tvar idx = this.Index;\n\t\tfor (var r, i=0;i<list.length;i++) {\n\t\t\tr=list[i];\n\t\t\tif (!/^(ob|ar)/.test(r.type)) d.value[r.key] = r.value;\n\t\t\tidx.dirty = true;\n\t\t}\n\t}","SearchRe": false,"Search": "function (re0) {\n\t\tvar that = this,\n\t\t\t\tvi = {},\n\t\t\t\tre = that.SearchRe || re0;\n\t\t\n\t\tif (!re) return that.data.found = {};\n\n\t\tif (that.Index.dirty) {\n\t\t\tthat.Index.idx = _index(that.Doc.value);\n\t\t\tthat.Index.dirty = false;\n\t\t}\n\t\t\n\t\tfor (var m = 0, row, idx = that.Index.idx, i=0, pl = 0; i<idx.length; i++) {\n\t\t\tm = 0;\n\t\t\trow = idx[i];\n\t\t\tpl = row.p.length;\n\t\t\tif (re.test(row.k)) m = m | 4;\n\t\t\tif (row.v && re.test(row.v)) m = m | 8;\n\t\t\tif (m) for (var tp, j=1; j<pl; j++) {\n\t\t\t\ttp = row.p.slice(0,j);\n\t\t\t\tvi[cw.lib.sdbm(tp.join('❀') +'❀'+row.p[j])] = j == pl-1?m:3;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn that.data.found = vi;\n\t\t\n\t\t// - - - - - -\n\t\t\n\t\tfunction _index(doc) {\n\t\t\tvar stack = ['Root'], a=[];\n\t\t\tfunction _ob(v){\n\t\t\t\tObject.keys(v).forEach(function(i){\n\t\t\t\t\tvar t = $.type(v[i]);\n\t\t\t\t\tif (t == 'object' || t=='array') {\n\t\t\t\t\t\t//a.push({k:i.toLowerCase(), p:stack.slice(0).add(i), v:false});\n\t\t\t\t\t\tstack.push(i);\n\t\t\t\t\t\t_ob(v[i]);\n\t\t\t\t\t\ta.push({k:i.toLowerCase(), p:stack.slice(0), v:false});\n\t\t\t\t\t\tstack.pop();\n\t\t\t\t\t}\n\t\t\t\t\telse if (t == 'string') {\n\t\t\t\t\t\ta.push({\n\t\t\t\t\t\t\tk:i.toLowerCase(),\n\t\t\t\t\t\t\tp:stack.slice(0).add(i),\n\t\t\t\t\t\t\tv:v[i].toLowerCase().replace(/[\\r\\n\\t\\s]+/g,' ')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ta.push({\n\t\t\t\t\t\t\tk:i.toLowerCase(),\n\t\t\t\t\t\t\tp:stack.slice(0).add(i), \n\t\t\t\t\t\t\tv:(v[i]+'')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\t_ob(doc);\n\t\t\treturn a;\n\t\t}\n\t}","init": "function ($o,form) {\n\tvar i, that = this,\n\t\t\td = form.data,\n\t\t\tdur = Date.now(),\n\t\t\ttypeNames = Object.keys(that).map(function(e){return /^\\$[a-z]/.test(e)?e.from(1):''}).compact(true);\n\t\t\n\t// Singletone constructors init\n\tthat.Ls = that.Ls('');\n\tif (Object.isFunction(that.Db)) that.Db = that.Db($o);\n\t\n\t// Render HTML\n\t$o.html(that.HTML.Main);\n\t\n\t// Debounce viewstate saver\n\tthat.MemStateSave = that.MemStateSave.debounce(700);\n\t\n\t// Prepare types\n\ttypeNames.forEach(function(i){\n\t\tvar e = that['$'+i];\n\t\te.labelWidth = d.labelWidth;\n\t\te.RT = that.RT;\n\t\te.Root = that.Root;\n\t\tif (i=='multi') {\n\t\t\te.HTML = that.HTML.ItemComplex;\n\t\t}\n\t\telse {\n\t\t\tif (!e[e.init?'HTML':'init']) e[e.init?'HTML':'init'] = that.HTML.ItemSimple;\n\t\t\tif (!e.ui['.ikey'].bind) e.ui['.ikey'].bind = that.Lib.keyBind;\n\t\t\tif (e.F && !e.F.initEdit) e.F.initEdit = that.Lib.initEdit;\n\t\t}\n\t\te.MakeList = that.MakeList;\n\t\tif (!e.params) e.params = {};\n\t\te.params.strict = true;\n\t});\n\t\n\t// First recursion step\n\t$.extend(that.Doc, {\n\t\tstate:2,\n\t\tlevel:0,\n\t\tpath:[],\n\t\ttype:\"object\",\n\t\tkey:\"Root\",\n\t\tvalue:form.data.doc\n\t});\n\t\n\td._id = d._id || d.doc._id || '';\n\t\n\tif (d.doc._rev === null) delete d.doc._rev;\n\n\t// Global handlers for buttons\n\t'add takeout copy'\n\t.split(' ').forEach(function(e){\n\t\t$o.on(\"click.my\", \".btn-\"+e, that.Event[e].fill(undefined, undefined, that, that.MRoot()));\n\t});\n\t\n\t// Global handler for click on ikey\n\t$o.on('click.my', '.ikeysimple', function(evt){\n\t\tvar $k = $(evt.currentTarget),\n\t\t\t\t$f = $k.my().root,\n\t\t\t\tdata = $k.my().data;\n\t\t$f.trigger('editorcancel.my');\n\t});\n\t\n\t// Replaces clean doc root node to ‘close doc’ action\n\t$o.on(\"click.my\", \"#doc>.iact>.btn-del\", function(evt){\n\t\tevt.stopPropagation();\n\t\t$o.trigger(\"cancel\");\n\t});\n\t\n\t// Load viewstate if applicable\n\tif (that.MemStateRestore) that.MemStateRestore();\n  \n    // If CloudWall, load additional info\n  if (d.cmd != 'create' && that.db && that.app && that.app.local) {\n  \treturn that.db.get(d.doc._id, {attachments:true, revs_info:true, conflicts:true}).then(function(res){\n    \t$.extend(d.doc, Object.select(res, ['_attachments']));\n      if (res._conflicts && res._conflicts.length) d.doc._conflicts = res._conflicts.slice(0);\n      d.doc._revs_info = res._revs_info.filter(function(e){return e.status!='missing'});\n    });\n  }\n\n}","die": "function () {\n\t\tvar i, b = this.Blobs;\n\t\t// Free blobs objURLs cache\n\t\tfor (i in b) URL.revokeObjectURL (b[i]);\n\t}","Blobs": {},"Doc": {},"Index": {"dirty": true,"idx": []},"ui": {"#btn-save": {"bind": "function (d,v,$o) {\n\t\t\tvar that =this;\n\t\t\tif (v!=null) {\n\t\t\t\t\n\t\t\t\tthat.db.save(d.doc)\n\t\t\t\t.then(\n\t\t\t\t\tfunction (res){\n\t\t\t\t\t\tvar doc = {doc:res};\n\t\t\t\t\t\t//push to app\n\t\t\t\t\t\tthat.Lib.kick(d.doc, res);\t\t\t\n\n\t\t\t\t\t\tvar vs = that.Ls(\"viewstate.\"+res._id);\n\t\t\t\t\t\tif (vs && (vs.stamp>doc.stamp || !Object.size(d.viewstate))) {\n\t\t\t\t\t\t\td.viewstate = vs.state;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\td._id = res._id||\"\";\n\n\t\t\t\t\t\tthat.Doc.state=1;\n\t\t\t\t\t\t$o.my(\"find\",\"#doc\").trigger(\"recalc\");\n\t\t\t\t\t\t$o.my(\"find\",\"#doc .idesc:eq(0)\").trigger(\"click\");\n\n\n\t\t\t\t\t}, \n\t\t\t\t\tfunction (e,msg) {\n\t\t\t\t\t\tcw.lib.note('Save failed, see console', 'error');\n\t\t\t\t\t\tconsole.log(msg, e);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}"},"#doctitle": {"bind": "function (d) {\n\t\t\td._id = d.doc._id || d._id;\n\t\t\td._rev = d.doc._rev;\n\t\t\td.title = (d.doc._db||(this.db||{name:\"NoDB\"}).name)+\"\\u2009/\\u2009\"+(d.doc._id||\"\");\n\t\t\treturn d.title;\n\t\t}","watch": ["#doc"],"delay": 30},"#json-search": {"delay": 200,"bind": "function (d,v) {\n\t\t\tif (v==null) return d.search;\n\t\t\tvar that = this,\n\t\t\t\t\tprev = d.search;\n\t\t\t\n\t\t\td.search = v.length<3?'':v;\n\t\t\tif (!d.search) {\n\t\t\t\tthat.SearchRe = false;\n\t\t\t\td.found = {};\n\t\t\t\tif (prev) that.my.trigger('#doc .idesc:eq(0)', 'click.my');\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\tthat.SearchRe = new RegExp('('+RegExp.escape(v.compact())+')', 'i');\n\t\t\tthat.Search();\n\t\t\tthat.my.trigger('#doc .idesc:eq(0)', 'click.my');\n\t\t\treturn v;\n\t\t}","css": {"my-search": "new RegExp(/^.{3,}$/)"},"events": "input.my check.my"},"#doc": {"delay": 20,"bind": "this.Doc","check": false,"manifest": "function (e) {\n\t\t\treturn this.$multi;\n\t\t}"}},"MakeList": "function (data,key,state) {\n\t\n\t// Object/array processor,\n\t// generates typed metaobject\n\t\n\tvar that=this,\n\t\t\ta=[], \n\t\t\tb = data.value,\n\t\t\tsdbm = cw.lib.sdbm,\n\t\t\tatob = window.atob,\n\t\t\tvs = that.data.viewstate || {},\n\t\t\tfound = that.data.found || {},\n\t\t\tlevel = data.level + 1,\n\t\t\tisSearch = that.data.search.length > 2;\n\t\n\tObject.keys(b)\n\t.forEach(function(i){\n\t\tvar val = b[i],\n\t\t\t\tdt = $.type(val),\n\t\t\t\tman = dt == 'object' || dt == 'array' ? 'multi' : dt,\n\t\t\t\thash,\n\t\t\t\tbin,\n        reimg = /^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/;\n\t\t\n\t\t// viewstate\n\t\tvar path = data.path.slice(0).add(data.key),\n\t\t\t\tvkey = cw.lib.sdbm(path.join('❀')+'❀'+i);\n\t\t\n\t\tif (isSearch && !found[vkey]) return;\n\t\t\n\t\t// Detect string-derived types\n\t\tif (dt == 'string'){\n\t\t\tif (isSearch && (found[vkey] | 8)) {\n\t\t\t\tman = 'found';\n\t\t\t\thash = sdbm(val);\n\t\t\t}\n\t\t\telse if (val.length > 11 && val.to(8) == 'function' && /\\}[\\r\\n\\t\\s]*$/.test(val.substr(-10))) {\n\t\t\t\tman = 'function';\n\t\t\t}\n\t\t\telse if(\n\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+$/.test(val.substr(0,158))\n\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+={0,2}$/.test(val)\n\t\t\t) {\n\t\t\t\tbin = _atob(val);\n\t\t\t\thash = sdbm(val);\n\t\t\t\tman = 'base64';\n\t\t\t}\n\t\t\telse if(\n\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t&& reimg.test(val)\n\t\t\t) {\n\t\t\t\tbin = _atob(val.replace(reimg,''));\n\t\t\t\thash = sdbm(val);\n\t\t\t\tman = 'base64';\n\t\t\t}\n\t\t\telse hash = sdbm(val);\n\t\t}\n\t\t\n\t\tif (!isSearch || found[vkey]) a.push({\n\t\t\tstate:state?state:!isSearch?vs[vkey] || 1:found[vkey],\n\t\t\tlevel:level,\n\t\t\tmanifest:'$'+man,\n\t\t\tpath:  path,\n\t\t\ttype:  dt,\n\t\t\tkey:   i,\n\t\t\tid:    i,\n\t\t\tvalue: b[i],\n\t\t\tbin:   bin,\n\t\t\thash:  hash\n\t\t});\n\t});\n\t\n\treturn a;\n\t\n\t// - - -\n\t\n\tfunction _atob(s){\n\t\tvar bin = '';\n\t\ttry {\n\t\t\tbin = atob(s);\n\t\t} catch(e){}\n\t\treturn bin;\n\t}\n\t\n}","Ls": "function () {\n\t\n\t// Local storage manager\n\tvar ls = window.localStorage;\n\t\n\tvar storage =  function LS (key0, data){\n\t\tvar x,  key = \"JSON.Editor.\"+key0;\n\t\tif (data) {\n\t\t\treturn ls.setItem(key, JSON.stringify(data));\n\t\t}\n\t\telse if (data===null || data===false) {\n\t\t\treturn ls.removeItem(key);\n\t\t}\n\t\telse {\n\t\t\tvar x = ls.getItem(key);\n\t\t\tif (Object.isString(x)) return JSON.parse(x);\n\t\t\telse return null;\n\t\t}\n\t};\n\t\n\treturn storage;\n}","j2h": "function j2h(source,maxChars,startKeys,depth,keysOnly) {\n\n\tvar k0 = startKeys || [],\n\t\t\tk1 = cw.lib.a2o(k0),\n\t\t\tko = !!keysOnly;\n\tvar h = [];\n\n\t_unwrap(_parse(source, maxChars, 0));\n\t\n\treturn h;\n\n\t// ================================================\n\n\tfunction _parseObj(src, chars, lvl) {\n\n\t\tvar res = {\n\t\t\tkey:null,\n\t\t\tval:null,\n\t\t\tempty:false,\n\t\t\tsize:2, \n\t\t\tleft:'{', \n\t\t\tright:'}',\n\t\t\ttrim:0,\n\t\t\ttype:'object',\n\t\t\trows:[]\n\t\t};\n\n\t\tvar i, j, tval, ckey, tkey;\n\t\tvar len = 0;\n\n\t\tvar skip = {},\n\t\t\t\tk = Object.keys(src);\n\n\t\t// empty obj\n\t\tif (!k.length) {\n\t\t\tres.empty = true;\n\t\t\tres.size = 2;\n\t\t\tres.val = '';\n\t\t\treturn res;\n\t\t}\n\n\t\t// return shortcut, no traverse\n\t\tif (lvl >= depth || k.length>50) {\n\t\t\tres.trim = k.length;\n\t\t\tres.size = 2;\n\t\t\treturn res;\n\t\t}\n\t\t\n\t\t// \n\n\t\tvar childchars = (1.5 * chars / k.length | 0).clamp(10, chars*0.9 | 0),\n\t\t\t\tctr = 0,\n\t\t\t\tskip = {};\n\n\t\t// Process priviledged keys\n\t\tfor (i=0; i<k0.length && len < chars - childchars/3; i++) {\n\t\t\tckey = k0[i];\n\t\t\tif (undefined != src[ckey]) {\n\t\t\t\tskip[ckey] = true;\n\t\t\t\ttkey = ckey.truncate((childchars/(ko?1:2)).clamp(12,100),'right','…');\n\t\t\t\tif (/\\s/.test(tkey) || !tkey) tkey = '\"'+tkey+'\"';\n\t\t\t\ttval = _parse(src[ckey], childchars, lvl+1);\n\t\t\t\ttval.key = tkey;\n\t\t\t\tlen += tkey.length + (ko?0:tval.size);\n\t\t\t\tctr+=1;\n\t\t\t\tres.rows.push(tval);\n\t\t\t}\n\t\t}\n\n\t\t// Other keys\n\t\tfor (i=0; i<k.length && len < chars - childchars/3; i++) {\n\t\t\tckey = k[i];\n\t\t\tif (!skip[ckey]) {\n\t\t\t\ttkey = ckey.truncate((childchars/(ko?1:2)).clamp(12,100),'right','…');\n\t\t\t\tif (/\\s/.test(tkey) || !tkey) tkey = '\"'+tkey+'\"';\n\t\t\t\ttval = _parse(src[ckey], childchars, lvl+1);\n\t\t\t\ttval.key = tkey;\n\t\t\t\tlen += tkey.length + (ko?0:tval.size);\n\t\t\t\tctr+=1;\n\t\t\t\tres.rows.push(tval);\n\t\t\t}\n\t\t}\n\t\tres.trim = k.length - ctr;\n\t\tres.size = len;\n\t\treturn res;\n\t}\n\n\n\t// ================================================\n\n\tfunction _parse(src, chars, lvl) {\n\t\t// returns {size: charsSpent, left:'{', right:'r', rows:[]}\n\t\t// strings in .r should be treated as a markup\n\n\t\tvar res = {\n\t\t\tkey:null,\n\t\t\tval:null,\n\t\t\tempty:false,\n\t\t\tsize:0, \n\t\t\tleft:'', \n\t\t\tright:'',\n\t\t\ttrim:0,\n\t\t\ttype:'',\n\t\t\trows:[]\n\t\t};\n\t\tvar i, j, tval, tdiff;\n\t\tvar len = 0,\n\t\t\t\tclen = 0,\n\t\t\t\tchildchars = 0,\n\t\t\t\ttype = typeof src;\n\n\t\t// we have simple type ----------------------------\n\t\tif (null===src ||  type != 'object') {\n\n\t\t\tif (type != 'string') {\n\t\t\t\tres.type = type!='number'?'simple':type;\n\t\t\t\ttval = src+'';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tres.type = 'string';\n\t\t\t\tclen = src.length;\n\t\t\t\tif (clen <= chars-1) tval = src;\n\t\t\t\telse {\n\t\t\t\t\ttval = src.substr(0, chars);\n\t\t\t\t\tres.trim = clen - chars;\n\t\t\t\t}\n\t\t\t\tif (!tval.length || tval[0]=='-' || /\\s/.test(tval)) {\n\t\t\t\t\tres.left = res.right = '\"';\n\t\t\t\t\tlen+=2;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlen += tval.length;\n\t\t\tres.size = len;\n\t\t\tres.empty = !tval.length;\n\t\t\tres.val = tval;\n\t\t\treturn res;\n\t\t} \n\n\t\t// we have an array -----------------------------\n\t\telse if (Object.isArray(src)) {\n\t\t\tres.type='array';\n\t\t\tres.left='['; res.right=']'; len +=2;\n\t\t\t// empty arr\n\t\t\tif (!src.length) {\n\t\t\t\tres.empty = true;\n\t\t\t\tlen = 2;\n\t\t\t\tres.val = '';\n\t\t\t}\n\t\t\t// array with elts\n\t\t\telse {\n\t\t\t\tif (lvl < depth && src.length<50 && chars / src.length > 5) {\n\t\t\t\t\tvar childchars = (1.5 * chars / src.length | 0).clamp(10, chars*0.9 | 0),\n\t\t\t\t\t\t\tclen = 0,\n\t\t\t\t\t\t\tctr = 0;\n\n\t\t\t\t\tfor (i=0; i<src.length && clen < chars - childchars/3; i++) {\n\t\t\t\t\t\t// recursion\n\t\t\t\t\t\ttval = _parse(src[i], childchars, lvl + 1);\n\t\t\t\t\t\tlen += tval.size;\n\t\t\t\t\t\tclen += tval.size;\n\t\t\t\t\t\tctr+=1;\n\t\t\t\t\t\tres.rows.push(tval);\n\t\t\t\t\t}\n\n\t\t\t\t\tres.trim = src.length - ctr;\n\n\t\t\t\t}\n\t\t\t\telse res.trim = src.length;\n\t\t\t}\n\t\t}\n\n\t\t// we have an object ----------------------------\n\t\telse {\n\t\t\treturn _parseObj(src, chars, lvl);\n\t\t}\n\n\t\t// return result\n\n\t\tres.size = len;\n\t\treturn res;\n\t}\n\t\n\t\t\n\t// ================================================\n\n\n\tfunction p(a,b){ h.push([a,b]);}\n\n\tfunction _unwrap(x){\n\n\t\tif (null != x.key) {\n\t\t\tp('key', x.key);\n\t\t\tif (!ko) p('', ': ');\n\t\t}\n\n\t\t// empty\n\t\tif (x.empty) {\n\t\t\tp('empty', x.left+(x.val||'')+x.right); \n\t\t\treturn;\n\t\t}\n\n\t\tvar t = x.type,\n\t\t\t\tvalset = false;\n\n\t\t// val defined\n\t\tif (x.val != null){\n\t\t\tif (x.left) p('bracket', x.left);\n\t\t\tif (x.val.length < maxChars/5 && k1[x.key]) {\n\t\t\t\tvalset = true;\n\t\t\t}\n\t\t\tif (!ko || valset) {\n\t\t\t\tif (ko && valset) p('', ': ');\n\t\t\t\tp(t, x.val.escapeHTML());\n\t\t\t\tif (x.trim) {\n\t\t\t\t\tvar prefix = '+';\n\t\t\t\t\tif (t == 'object' || t == 'array') \tp('trim', prefix+x.trim);\n\t\t\t\t\telse p('trim','…');\n\t\t\t\t}\n\t\t\t} \n\t\t\tif (x.right) p('bracket', x.right);\n\t\t\t\n\t\t\tif (!valset && ko && !x.right && t !='simple' && t !='number') {\n\t\t\t\tp('bracket', t=='string'?'\"\"':t=='object'?'{}':'[]')\n\t\t\t}\n\t\t}\n\n\t\t// rows\n\n\t\telse if (x.rows.length){\n\t\t\tif (x.left) p('bracket', x.left);\n\n\t\t\tvar i, rl = x.rows.length;\n\t\t\tfor (i=0; i<rl;i++) {\n\t\t\t\t_unwrap(x.rows[i]);\n\t\t\t\tif (i!=rl-1 || x.trim) p('',', ');\n\t\t\t}\n\n\t\t\tif (x.trim) {\n\t\t\t\tvar prefix = '+';\n\t\t\t\tif (t == 'object' || t == 'array') \tp('trim', prefix+x.trim);\n\t\t\t\telse p('trim','…');\n\t\t\t}\n\t\t\tif (x.right) p('bracket', x.right);\n\t\t}\n\n\t\t// no rows, trim\n\t\telse if (x.trim) {\n\t\t\tif (t == 'object') \t\t\tp('short', '{'+x.trim+'}');\n\t\t\telse if (t == 'array') \tp('short', '['+x.trim+']');\n\t\t}\n\t}\n\n}","Event": {"add": "function (evt,data,that,$o) {\n\tevt.stopPropagation();\n\tvar $b = $(this),\n\t\t\t$f = $b.parents(\".my-form\").eq(0);\t\t\n\tvar $p = $b,\n\t\t\tp = $f.data(\"my\").data,\n\t\t\tmn = $f.data(\"my\").manifest,\n\t\t\tt = $.type(p.value),\n\t\t\tisa = t==\"array\",\n\t\t\tkey = $f.my(\"data\").key,\n\t\t\tclip = that.Ls(\"Clip\")||{type:\"\"},\n\t\t\tsample = {\n\t\t\t\tobject:{},\n\t\t\t\tarray:[],\n\t\t\t\tstring:\"\",\n\t\t\t\tboolean:true,\n\t\t\t\tnumber:0\n\t\t\t};\n\t$b.parent().addClass(\"hover\");\n\t$f.addClass(\"hover\");\n\t$(this).modal({\n\t\tmanifest:that.MAdd,\n\t\tdata:{\n\t\t\tcmd:'prepend',\n\t\t\ttext:'New '+(isa?'member':'property')+' in <b>'+p.key+':'+(isa?'[]':'{}')+'</b>',\n\t\t\tprepend:(isa?'Insert':'Prepend'),\n\t\t\tappend:(isa?'':'Append'),\n\t\t\tisarray:isa,\n\t\t\tkey:isa?\"0\":'',\n\t\t\tclip:clip,\n\t\t\tkeys:isa?{}:Object.keys(p.value).reduce(function(a,b){a[b]=true;return a;},{}),\n\t\t\tfile:{}\n\t\t},\n\t\twidth:310,\n    align:\"top:103%;right:-114px;\",\n\t\troot:$o,\n\t\tbound:1,\n\t\tnose:\"top\",\n\t\tscreen:\"rgba(255,255,255,0)\",\n\t\tclose:false,\n\t\tesc:true,\n\t\tenter:true\n\t})\n\t.then(function(data){\n\t\tvar i, cmd = data.cmd,\n\t\t\t\tredraw = true, \n\t\t\t\tkeys=[], vals=[], ins;\n\t\t\n\t\tif (data.clip.type && data.type==\"clip\") sample.clip = data.clip.value; \n\t\t\n\t\tins = Object.clone(data.type==\"file\"?data.file:sample[data.type],true);\n\t\t\n\t\tif (!data.isarray) {\n\t\t\tif (data.type==\"string\" && data.file.data) ins=\"data:\"+data.file.content_type+\";base64,\"+data.file.data;\n\t\t\telse delete ins.name;\n\t\t}\n\t\t\t\t\n\t\tif (p.level==1 && /^(_id|_rev)$/.test(data.key)) {\n\t\t\tcw.lib.note(\"Can’t change system properties.\",\"error\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Object\n\t\tif (/^(ob)/.test(t)) {\n\t\t\t\n\t\t\t// Append/replace is simple\n\t\t\tif (cmd==\"append\" || p.value[data.key]!=null) { \n\t\t\t\tp.value[data.key] = ins; \n\t\t\t}\n\t\t\t\n\t\t\t// Prepend is more complex\n\t\t\telse if (cmd==\"prepend\") {\n\t\t\t\t\n\t\t\t\tkeys = Object.keys(p.value);\n\t\t\t\tfor (i in keys) {\n\t\t\t\t\tvals.push(p.value[keys[i]]);\n\t\t\t\t\tdelete p.value[keys[i]];\n\t\t\t\t}\n\t\t\t\tp.value[data.key] = ins;\n\t\t\t\tfor (i in keys) {\n\t\t\t\t\tif (keys[i]!==data.key) p.value[keys[i]] = vals[i];\n\t\t\t\t}\n\t\t\t\tvals=keys=null;\n\t\t\t}\n\t\t\t//Unknown cmd\n\t\t\telse redraw = false;\n\t\t}\n\t\t\n\t\t// Array\n\t\telse if (isa) {\n\t\t\tp.value.insert(ins, data.key);\n\t\t}\n\t\telse redraw = false;\n\t\t\n\t\tif (redraw) {\n\t\t\t// force redraw\n\t\t\tmn.ShowItems = null;\n\t\t\tmn.List = that.MakeList(p);\n\t\t\tp.state=2;\n\t\t\t$f.find(\".idesc:eq(0)\").trigger(\"check\");\n\t\t\t$f.find(\".ilist:eq(0)\").trigger(\"recalc\");\n\t\t}\n\t})\n\t.always(function(){\n\t\t$b.parent().removeClass(\"hover\");\n\t\t$f.removeClass(\"hover\");\n\t});\n}","takeout": "function (evt,data,that,$o) {\n\tevt.stopPropagation();\n\tvar $b = $(this),\n\t\t\t$f = $b.parents('.my-form').eq(0),\n\t\t\tp = $f.data('my').data,\n\t\t\tmn = $f.data('my').manifest;\n\t$b.parent().addClass('hover');\n\t$f.addClass('hover');\n\t$b.modal({\n\t\tmanifest:that.MTakeout,\n\t\tdata:{\n\t\t\tjson:JSON.stringify(p.value,null,'  '),\n\t\t\tpath:p.path,\n\t\t\tkey:p.key,\n\t\t\treplace:Object.size(p.value)?'Replace':'Save',\n\t\t\textend:Object.size(p.value)?'Extend':''\n\t\t},\n\t\twidth:($f.width()-160).clamp(500,1000),\n\t\talign:'top:103%;right:-76px;',\n\t\t//root:$o,\n    root:$o.find('section#editor').eq(0),\n\t\tnose:'top',\n\t\tscreen:'rgba(255,255,255,0)',\n\t\tclose:true,\n\t\tesc:true,\n\t\tenter:true\n\t})\n\t.then(function(res){\n\t\tvar redraw = true,\n\t\t\t\tres1;\n\n\t\tif (that.my.parent() && that.my.parent().data.isNew) res1 = res.node;\n\t\telse res1 = p.level == 0 ? Object.reject(res.node,/^(_id|_rev)$/) : res.node;\n\t\t\n\t\tif (res.cmd == 'extend') {\n\t\t\tObject.merge( p.value,  res1, true);\n\t\t}\n\t\telse if (res.cmd == 'replace') {\n\t\t\tvar temp = {};\n\t\t\tif (p.level == 0 && p.value._rev) temp = Object.select(p.value, /^(_id|_rev)$/);\n\t\t\tthat.RT('Lib').kick(p.value, res1);\n\t\t\tif (p.level == 0) Object.merge(p.value, temp);\n\t\t}\n\t\telse redraw = false;\n\t\t\n\t\tif (redraw) {\n\t\t\t// force redraw\n\t\t\tmn.ShowItems = null;\n\t\t\tp.state=2;\n\t\t\t\n\t\t\tthat.RT('Lib').relist($f, mn);\n\t\t}\n\t\t\n\t})\n\t.always(function(){\n\t\t$b.parent().removeClass('hover');\n\t\t$f.removeClass('hover');\n\t});\n}","copy": "function (evt,data,that,$o) {\n\tevt.stopPropagation();\n\tvar $b = $(this),\n\t\t\t$f = $b.parents(\".my-form\").eq(0),\n\t\t\tp = $f.data(\"my\").data,\n\t\t\tt = $.type(p.value),\n\t\t\tobj={};\n\t\n\tif (!p.level) obj = {key:\"\",type:p.type,value:p.value}\n\telse {\n\t\tobj={key:p.key,type:p.type,value:p.value}\n\t}\n\tthat.Ls(\"Clip\", obj);\n\tif (cw.lib) cw.lib.note(\"Clip stashed\",\"ok\");\n}"},"HTML": {"Main": "<section style=\"\">\n\t<section id=\"editor\" class=\"dib w100p\">\n\t\t<div class=\"pb5 fs130 nocwmin\">\n\t\t\t<div id=\"doctitle\" class=\"fs110 w60p pt4 bolder dib vat xgray nw oh ell pr10\" ></div>\n\t\t\t<div class=\"w20p fs90 dib vat\">\n\t\t\t\t<div class=\"fi-magnifying-glass xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>\n\t\t\t\t<input type=\"text\" id=\"json-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" \n\t\t\t\t\tplaceholder=\"Search\" style=\"background-image:none;padding-right:19px!important;\"><span \n\t\t\t\t\tclass=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"\n\t\t\t\t\tonclick=\"$(this).siblings('input:eq(0)').val('').trigger('check.my')\"></span>\n\t\t\t</div>\t\n\t\t\t\n\t\t\t<button class=\"button mr0 fr w150 fs90\" id=\"btn-save\">Save</button>\n\t\t</div>\n\t\t<div id=\"doc\" class=\"irow\txgray\"></div>\n\t</section>\n</section>","ItemComplex": "<div class=\"inav\"><div class=\"ikey\"></div><div class=\"idesc cp\">–</div></div><div class=\"ivalue imulti hide\"><div class=\"ilist\"></div></div><div class=\"iact buttons\"><button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button><button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button><button class=\"btn-copy button\" title=\"Stash node as clip\"><span class=\"fi-clipboard\"></span></button><button class=\"btn-del button red\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button></div>","ItemSimple": "<div class=\"inav\"><div class=\"ikey ikeysimple\"></div><div class=\"ivalue\"></div><div class=\"ieditor\"></div></div><div class=\"iact buttons\"><button class=\"btn-copy button\" title=\"Stash property as clip\"><span class=\"fi-clipboard\"></span></button><button class=\"btn-del button red\" title=\"Del property\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button></div>"},"style": {" ": "font-size:15px;font-family: '-apple-system','BlinkMacSystemFont','Helvetica Neue','Segoe UI',Helvetica,Tahoma,Verdana,Sans-serif;font-weight:300;min-height:500px;max-width:1900px;"," .bolder": "font-weight:bolder;"," #doctitle": "function ($o,b,c) {\n\t\treturn \"width:\"+($o.width().clamp(0,1500)-220-20-144)+\"px\"\n\t}","  .irow": "function () {\n\t\tvar x = this.data.labelWidth;\n\t\treturn {\n\t\t\t' .ikey':'width:'+x+'px;',\n\t\t\t' .inav':'padding-left:'+x+'px;',\n\t\t\t' .inav>.ikey':'margin-left:-'+x+'px;'\n\t\t}\n\t}"," .jval-bracket": "font-weight:inherit;color: rgba(0, 181, 161, 0.72);"," .jval-trim": "display:inline-block;border-radius:2px;padding:0px 2px 1px 2px;line-height:1.1em;color:rgba(213, 48, 89, 0.63);background-color:rgba(43, 107, 192, 0.07);"," .jval-short": "color:rgba(88,101,123,0.63);"," .jval-empty": "color:rgba(88,101,123,0.63);"," .jval-key": "font-weight:inherit;margin-left:3px;"," .jval-bracket+.jval-key": "margin-left:1px;"," .jval-simple": "color:rgba(52, 143, 27, 0.78);"," .jval-number": "color:rgba(255,97,0,0.87)"," .jval-null": "color:rgba(214,0,26,0.83)"," .jval-string": "color:#366599;"," .jval-function": "color:rgba(143,36,158,0.8);"," .jval-found-key": "background-color:rgba(255,221,0,0.7);padding-left:1px;padding-right:1px;border-radius:2px;","": {" textarea": "font-family:Cousine,'PT Mono',Monaco,'Lucida Console',monospace;"," .irow": "width:calc(100% - 1px);display:inline-block; vertical-align:top; padding:0px 0px 0px 25px; border-left:1px solid rgba(70,105,135,0.25); line-height:1.3em; margin-left:1px;"," .irow:before": "content:\"\";position:absolute;top:15px;left:0;width:18px;border-bottom:1px solid rgba(70,105,135,0.25);"," .irow:last-child": "border:none;"," .irow:last-child:after": "content:\"\";position:absolute;top:0;left:0;height:15px;border-left:1px solid rgba(70,105,135,0.25);"," .irow:hover,.irow.hover": "background-color:rgba(206, 214, 226, 0.2);"," .ikey": "padding-right:10px;display:inline-block; word-break:break-all;font-size:95%; line-height:1.2em;opacity:0.8; overflow:hidden;vertical-align:top;margin:0.25em 0 0.3em 0px;"," .ilabel": "font-size:80%;padding:0 5px; background-color: rgba(0,0,0,0.05); border-radius:2px;opacity:0.9; display:inline-block; margin:-1px 5px 0 0px;"," .ivalue, .ilist": "word-break: break-all;"," .ivalue": "line-height: 1.6em;cursor:pointer;"," .idesc": "line-height: 1.5em;"," .ivalue, .ilist, .idesc": "width:100%;display:inline-block; vertical-align:top;"," .imulti.ivalue": "cursor:inherit;"," .iseditor .ivalue": "word-wrap: break-word; white-space:pre; padding:0.2em 0.3em 0.2em 0.4em; font-family:Cousine,'PT Mono',Monaco,'Lucida Console',monospace; max-height:400px; overflow:auto;overflow:overlay; outline:none; border:1px solid rgba(0,0,0,0.2); font-size:90%; border-radius:2px;margin:-1px 0 -1px 0; tab-size:2; background-color:rgba(255,255,240,0.8); cursor:text;"," .iboolean-tag": "padding:0 9px 1px 9px; display:inline-block; vertical-align:top; border-radius:100px;"," .inav": "margin:2px 0;"," .inav .ieditor": "width:100%;display:none;word-break:normal;"," .inav .ivalue.hide~.ieditor": "display:inline-block;"," .inav .ieditor .icmframe": "overflow:hidden; border:1px solid #d1dfe9; border-radius:2px;"," .inav .ieditor .button": "padding: 0.25em 0.7em 0.15em 0.7em;margin-top: 0; margin-bottom: 0;"," .CodeMirror": "font-size:13.5px; font-family:Cousine,'PT Mono',Monaco,monospace; line-height:1.4em; color: #434e5d;"," .CodeMirror .CodeMirror-lines": "line-height:17px;"," .CodeMirror-scroll": "max-height:calc(20 * 16px + 6px);"," .CodeMirror-linenumbers": "transition: background-color 0.3s;"," .ed-error .CodeMirror-linenumbers": "background-color:rgba(255, 200, 200, 0.75);"," .CodeMirror .cm-property": "color:#434e5d;"," .CodeMirror .cm-variable": "color:#33bfad;"," .CodeMirror .cm-keyword": "color:#90259e;"," .my-modal-form .CodeMirror": "min-height:150px; height:auto;"," .my-modal-form .CodeMirror-scroll": "min-height:150px;"," .inav .ieditor .CodeMirror": "min-height:25px; height:auto;"," .iact": "position:absolute; top:3px; right:3px;opacity:0;transition:opacity 0.3s;border-radius:3px;"," .iact:hover, .iact.hover": "display:block;opacity:1!important;"," .inav:hover~.iact": "display:block;opacity:0.7;xbackground:rgba(255,255,255,0.8);"," .iact .button": "padding:0.25em 0 0.15em 0;margin-top:0;margin-bottom:0;text-align:center;width:36px;white-space:nowrap;"," .inav.iseditor~.iact": "display:none;"," #doc": "padding:0; border:none;overflow:visible;"," #doc:before, #doc:after": "display:none;"," #doc:hover": "background:white;"," #doc>.inav": "padding-left:120px;"," #doc>.inav .ikey": "font-size:105%;font-weight:bold;margin:0 0 0 -120px;width:120px;"," #doc>.iact": "opacity:0.3;top:0;right:0;"," .tag.active": "background-color: rgba(135, 212, 0, 0.17)!important;color: rgb(65, 132, 0)!important;"," .buttons button": "border-radius:0;margin-right:2px; padding:0.4em 0.7em 0.4em 0.7em;width:36px;font-size:90%;"," .buttons button:last-child": "border-top-right-radius:3px; border-bottom-right-radius:3px; margin-right:0;"," .buttons button:first-child": "border-top-left-radius:3px; border-bottom-left-radius:3px;"," .buttons .button": "border-radius:0;margin-right:2px;"," .buttons .button:last-child": "border-top-right-radius:3px; border-bottom-right-radius:3px; margin-right:0;"," .buttons .button:first-child": "border-top-left-radius:3px; border-bottom-left-radius:3px;"," a.base64image img": "background: white; border: 1px solid #ddd!important; padding: 3px; max-width: 10%; min-width: 2%; max-height: 60px;"," .base64image~div": "width:87%;"," .base64ico~div": "width:87%;"," .w55": "width:55px;"," .h55": "height:55px;"}},"MTakeout": {"init": "function ($o,form) {\n\t\tvar that = this;\n\t\tthat.StartHash = $.my.f.sdbmCode(form.data.json);\n\t\tthat.data.json = '('+that.data.json+')';\n\t\t$o.formgen([\n\t\t\t'<div id=\"title\" class=\"mb5 fs105 bolder\"></div>',\n\t\t\t'<div class=\"needsclick\" style=\"border:1px solid #ddd; margin:2px 0 8px 0;border-radius:2px\">',\n\t\t\t'<textarea id=\"json\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"></textarea>',\n\t\t\t'</div>',\n\t\t\t'<div>',\n\t\t\t'<div class=\"fr gray pt5\" id=\"info\"></div>',\n\t\t\t'<div class=\"buttons dib vat fs110 mt4\">',\n\t\t\t\t'<button class=\"button w90\" id=\"btn-replace\">Replace</button>',\n\t\t\t\t'<button class=\"button w90\" id=\"btn-extend\">Extend</button>',\n\t\t\t\t'<button class=\"button w90\" id=\"btn-cancel\">Cancel</button>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"lgray pl30 dib vat pt5\" id=\"info\">JSON or js expression ⇡</div>',\n\t\t\t'</div>' \n\t\t]);\n\n\t}","ui": {"#title": "function (d,v,$o) {\n\t\t\treturn \"JSON for \"+d.path.slice(0).add(d.key).join(\"/\").truncate(70,\"middle\",\"…\");\n\t\t}","#json": {"delay": 20,"bind": "json","init": "function ($o,form) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (that.data.json.length < 1e6) {\n\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\tmode:\"javascript\",\n\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\tviewportMargin:100,\n\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\tscrollbarStyle:null,\n\t\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\tautofocus:true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}"},"#btn-replace": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.node = this.Parsed;\n\t\t\t\t\td.cmd = \"replace\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.replace;\n\t\t\t}","css": {":disabled": "function (d,v) {return !this.Dirty || !this.Parsed;}","self:orange": "function (d,v) {return this.Dirty && !!this.Parsed;}"},"watch": "#info"},"#btn-extend": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.node = this.Parsed;\n\t\t\t\t\td.cmd = \"extend\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.extend;\n\t\t\t}","css": {":disabled": "function (d,v) {return !this.Dirty || !this.Parsed;}","self:orange": "function (d,v) {return this.Dirty && !!this.Parsed;}","self:hide": "function (d) { return !d.extend}"},"watch": "#info"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}"},"#info": {"delay": 400,"bind": "function (d,v,$o) {\n\t\t\t\tvar parse, \n\t\t\t\t\t\ts = unescape(encodeURIComponent(d.json)).length;\n\t\t\t\ttry {\n\t\t\t\t\tparse = eval(\"(\"+d.json+\")\");\n\t\t\t\t\tif (!Object.isObject(parse) && !Object.isArray(parse)) parse=null;\n\t\t\t\t\telse {\n\t\t\t\t\t\tparse = JSON.parse($.my.tojson(parse));\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\t//console.log(e)\n\t\t\t\t}\n\t\t\t\tthis.Parsed = parse?parse:null;\n\t\t\t\t\n\t\t\t\t$o.my().root.toggleClass(\"ed-error\",!parse);\n\n\t\t\t\tthis.Hash = $.my.f.sdbmCode(d.json);\n\t\t\t\tthis.Dirty = this.StartHash != this.Hash;\n\t\t\t\treturn s.metric(2)+\"b\";\n\t\t\t}","watch": "#json"}},"style": {" #json": "border: none; width: 100%;display: block;height: 300px;font-size: 0.7em;word-wrap: normal; overflow-x: hidden;"," .CodeMirror": {"": "min-height:150px;height:auto;font-size:13px!important;"," .CodeMirror-lines": "line-height:17px!important;"," .cm-property": "color:#434e5d;"," .cm-variable": "color:#33bfad;"," .cm-keyword": "color:#90259e;"}}},"MAdd": {"init": "function ($o,form) {\n\t\tvar that=this;\n\t\t$o.formgen(that.HTML);\n\t\tif (form.data.isarray) {\n\t\t\t$o.find(\"#nkey\").attr(\"type\",\"number\");\n\t\t}\n\t}","data": {"cmd": "","key": "","type": "string","isarray": false,"text": "Create new property","prepend": "Prepend","append": "Append","upload": "<span class=\"pseudolink dib w100p vat tac\">Select file...</span>","keys": {},"file": {}},"ui": {"#ntext": "text","#nkey": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (d.isarray) d.key = v.replace(/\\D/g,'');\n\t\t\t\t\telse d.key = v;\n\t\t\t\t}\n\t\t\t\treturn d.key;\n\t\t\t}","watch": "#ntype"},"#ntype": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.type=v;\n\t\t\t\t\tif (v==\"Clip\" && !d.key && !d.isarray) d.key = d.clip.key; \n\t\t\t\t}\n\t\t\t\treturn d.type;\n\t\t\t}","init": "function ($o,form) {\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[[\n\t\t\t\t\t\t{\"{}\":\"object\"},\n\t\t\t\t\t\t{\"[]\":\"array\"},\n\t\t\t\t\t\t{\"42\":\"number\"},\n\t\t\t\t\t\t{\"!0\":\"boolean\"},\n\t\t\t\t\t\t{\"File\":\"file\"}\n\t\t\t\t\t].add(form.data.clip.type?{\"Clip\":\"clip\"}:undefined)],\n\t\t\t\t\tempty:{'\"\"':\"string\"},\n\t\t\t\t\ttagcss:'tag blue cp pl6 pr6',\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t})\n\t\t\t}","recalc": "#nkeytype"},"#nkeytype": "function (d) {return (d.isarray?'Index':'Key')}","#xupload": {"watch": "#ntype","css": {"hide": "function (d) {return d.type!=\"file\"}"}},"#upload": {"bind": "function (d,v,$o) {\n\t\tvar f, a={}, data;\n\t\tif (v!=null && v) {\n\t\t\tf = $o[0].files[0];\n\t\t\tif (f.size>d.limit){\n\t\t\t\tcw.note(\"Max upload file size is \"+(d.limit*1).abbr(1)+\"b\",\"error\");\n\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t}\n\t\t\telse if (f) (function(){\n\t\t\t\ta.name = f.name;\n\t\t\t\ta.content_type = f.type||\"application/octet-stream\";\n\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\tfr.onload=function(e){\n\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\ta.data = data;\n\t\t\t\t\ta.length = sb64.length;\n\t\t\t\t\t\n\t\t\t\t\t$.extend(d.file, a);\n\t\t\t\t\tif (!d.key && !d.isarray) d.key = f.name;\n\t\t\t\t\tif (!d.key && d.isarray) 10000;\n\n\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\n\t\t\t\t\t$o.my(\"find\",\".cw-att-upload>span\")\n\t\t\t\t\t.text(f.name.truncate(15,\"middle\",\"…\")+\" \"+a.length.metric(2,false)+\"b\");\n\t\t\t\t\t\n\t\t\t\t\tif (d.key == f.name) {\n\t\t\t\t\t\t$o.my(\"find\",\"#nkey\").val(d.key).trigger(\"blur\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t})();\n\t\t}\n\t}","css": {"hide": "function (d) {return !d.upload}"}},".cw-att-upload": "upload","#btn-to0": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null){\n\t\t\t\t\td.cmd = \"prepend\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.keys[d.key]&&!d.isarray?'Replace':d.prepend;\n\t\t\t}","css": {":disabled": "function (d) {return !d.key}","self:red": "function (d) {return d.keys[d.key]&&!d.isarray;}"},"watch": "#nkey"},"#btn-to1": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null){\n\t\t\t\t\td.cmd = \"append\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.append;\n\t\t\t}","css": {":disabled": "function (d) {return !d.key}","self:hide": "function (d) {return !d.append || /^\\d+$/.test(d.key) || d.keys[d.key]}"},"watch": "#nkey"},"#btn-cancel": "function (d,v,$o) {\n\t\t\tif(v!=null) $o.trigger(\"cancel\");\n\t\t}"},"HTML": ["<div id=\"ntext\"></div>",{"label": "60px","row": "100%","rowCss": "my-row pt5 pb5","labelCss": "my-label gray fs90"},["<span id=\"nkeytype\">Key</span>","inp#nkey.w100p","msg.mt2.mb-2"],["Type","spn#ntype.div.vat.fs95"],"<div id=\"xupload\" class=\"pl60 mt5 mb10 hide\">","<span class=\"cw-att-upload button w100p\"></span>","<input id=\"upload\" class=\"pl60\" type=\"file\" />","</div>",{"rowCss": "my-row pt5 pb10 buttons pl60"},["","but#btn-to0.button.green.w85",{"txt": "Prepend"},"but#btn-to1.button.green.w85",{"txt": "Append"},"but#btn-cancel.button.w75.mr0",{"txt": "Cancel"}]],"style": {" .cw-att-item": "white-space:nowrap; overflow:hidden; padding:0.2em 0 0.2em 0; line-height:1.4em;"," input[type=file]": "width:240px;cursor:pointer;opacity:0; position:absolute;top:0;left:60px;height:35px;"}},"MEdit": {"data": {"text": "","mode": "auto","commitKeys": [],"cancelKeys": []},"init": ["<div style=\"width:calc(100% - 80px);\" class=\"icmframe dib vat mt-1 mb-1\">","<textarea id=\"ied\" style =\"width:100%;max-height:300px;\" class=\"xgray\"></textarea>","</div>","<div class=\"buttons w80 dib vat tar o100 pr3 pt0\">","<button id=\"btn-change\" class=\"button green w36\" title=\"Stash property as clip\"><span class=\"fi-check\"></span></button>","<button id=\"btn-discard\" class=\"button w36\" title=\"Del property\"><span class=\"fi-minus-circle\"></span></button>","</div>"],"ui": {"#ied": {"init": "function ($o) {\n\t\t\t\t\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data,\n\t\t\t\t\t\tt = d.text,\n\t\t\t\t\t\tmode = d.mode,\n\t\t\t\t\t\tisNumber = mode=='number',\n\t\t\t\t\t\tstart,\n\t\t\t\t\t\twrap = false,\n\t\t\t\t\t\tlnums = true;\n\t\t\t\t\n\t\t\t\t// Simple heuristics to guess mode\n\t\t\t\tif (mode == 'auto') {\n\t\t\t\t\tstart = t.substr(0,800);\n\t\t\t\t\tif ((start.match(/(var\\s|const\\s|function[\\s\\(]|return\\s|[\\s\\t]if\\s)/g)||[]).length > 2) {\n\t\t\t\t\t\tmode = \"text/javascript\";\n\t\t\t\t\t\tvar maxl = 0;\n\t\t\t\t\t\tt.lines().forEach(function(e,i){\n\t\t\t\t\t\t\tif (i>200) return;\n\t\t\t\t\t\t\tif (e.length > maxl) maxl = e.length;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (maxl>150 && maxl<1000) wrap = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (\n\t\t\t\t\t\t/<\\/(div|span|p|a|script|head|title|svg|path)/.test(start)\n\t\t\t\t\t\t|| /<(svg|path|group)\\s/.test(start)\n\t\t\t\t\t) {\n\t\t\t\t\t\tmode = 'text/html';\n\t\t\t\t\t\twrap = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (CodeMirror.modes.erlang && /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/.test(start)) {\n\t\t\t\t\t\tmode = 'erlang';\n\t\t\t\t\t\twrap = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tmode = 'text';\n\t\t\t\t\t\tif (!/[\\r\\n]/.test(start)) {\n\t\t\t\t\t\t\twrap = true;\n\t\t\t\t\t\t\tif (t.length < 800) lnums = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Special modes\n\t\t\t\tif (mode == 'number') {\n\t\t\t\t\tmode = \"text/javascript\";\n\t\t\t\t\tlnums = false;\n\t\t\t\t}\n\t\t\t\telse if (mode == 'b64') {\n\t\t\t\t\tmode = 'text/plain';\n\t\t\t\t\twrap = true;\n\t\t\t\t\tlnums = false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: \t\t\t\t\tmode,\n\t\t\t\t\tviewportMargin:\t100,\n\t\t\t\t\tlineNumbers:\t\tlnums,\n\t\t\t\t\tindentWithTabs:\t!0,\n\t\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\t\ttheme: \t\t\t\t\t'default',\n\t\t\t\t\tautofocus:\t\t\ttrue,\n\t\t\t\t\tlineWrapping:\t\ttrue, //wrap,\n\t\t\t\t\textraKeys:$.extend(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'Esc':_cancel,\n\t\t\t\t\t\t\t'Ctrl-Enter':_commit.debounce(20),\n\t\t\t\t\t\t\t'Cmd-Enter':_commit.debounce(20)\n\t\t\t\t\t\t}, \n\t\t\t\t\t\t!isNumber?{}:{'Enter':_commit},\n\t\t\t\t\t\td.commitKeys.reduce(function(a,b){ a[b] = _commit; return a;}, {}),\n\t\t\t\t\t\td.cancelKeys.reduce(function(a,b){ a[b] = _cancel; return a;}, {})\n\t\t\t\t\t)\n\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t// - - - -\n\t\t\t\tfunction _commit(){that.my.trigger('#ied','editorcommit.my')}\n\t\t\t\tfunction _cancel(){that.my.trigger('#ied','editorcancel.my')}\n\t\t\t}","bind": "text"},"#btn-change": {"bind": "function (d,v) {if(v!=null) this.my.trigger('#ied','editorcommit.my')}"},"#btn-discard": {"bind": "function (d,v) {if(v!=null) this.my.trigger('#ied','editorcancel.my')}"}}},"$multi": {"id": "Sys.JSON.Object","data": {},"List": [],"Txt": {"object": ["Object {","}"],"array": ["Array [","]"]},"init": "function _init_multi($o,form) {\n\t\tvar that = this, \n\t\t\t\td = that.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\tif (d.state > 1) that.List = that.MakeList(that.data);\n\t\t\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.RT('Rejoin')(d, that.List);\n\t\t}.debounce(300));\n\t\t\n\t\t$o.on(\"click.my\", \".ilist:eq(0) .btn-del\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $f = $(this).parents(\".my-form\").eq(0);\t\t\n\t\t\tvar p = $f.parent().data(\"my\").data,\n\t\t\t\t\tt = $.type(p.value),\n\t\t\t\t\tkey = $f.my(\"data\").key;\n\t\t\t\n\t\t\tif (t==\"object\") delete p.value[key];\n\t\t\telse if (t==\"array\") p.value.removeAt(key);\n\t\t\t\n\t\t\tthat.RT('Lib').relist($o, that, form);\n\t\t});\n\t\t\n\t}","ShowItems": null,"ui": {".ivalue": {"css": {"hide": "function () {return !this.List.length}"},"watch": [".idesc"]},".ilist": {"delay": 0,"bind": "this.List","list": "<div class=\"irow\"></div>","id": "function (e) {return 'X'+e.id;}","hash": "function (e) {return 'X'+e.hash;}","manifest": "function (e) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn that.RT(e.manifest)||that.RT('$string');\n\t\t\t}","watch": [".idesc"]},".ikey": {"delay": 10,"bind": "function (d,v,$o) {\t\t\t\t\n\t\t\t\tvar maxlen = this.labelWidth/3 | 0,\n\t\t\t\ts, re;\n\t\t\t\tif ((d.state & 4) && (re = this.RT('SearchRe'))) {\n\t\t\t\t\ts = d.key\n\t\t\t\t\t.replace(this.RT('SearchRe'), '\\ufff1$1\\ufff0')\n\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t.replace('\\ufff1','<span class=\"jval-found-key\">')\n\t\t\t\t\t.replace('\\ufff0','</span>');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (d.key.length > maxlen) $o.attr('title',d.key.escapeHTML());\n\t\t\t\t\ts = (!/^(|\\s+)$/.test(d.key))?d.key.truncate(maxlen,'right','…').escapeHTML():'\"'+d.key.escapeHTML()+'\"'; \n\t\t\t\t\tif (d.state == 2) s = '<span class=\"bold\">'+s+'</span>';\n\t\t\t\t}\n\t\t\t\treturn s;\n\t\t\t}","watch": [".idesc"]},".idesc": {"delay": 10,"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tlist = this.List, \n\t\t\t\t\t\tt = that.Txt[d.type],\n\t\t\t\t\t\tds = Object.size(d.value),\n\t\t\t\t\t\th=\"\";\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = ((d.state==1 && !(d.manifest==\"$multi\" && !ds))|| !d.level?2:1);\n\t\t\t\t\tif (d.state==2) that.List = that.MakeList(d);\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.List = [];\n\t\t\t\t\t\tthat.ShowItems = null;\n\t\t\t\t\t}\n\t\t\t\t\tthat.RT('MemState')(d);\n\t\t\t\t}\n\n\t\t\t\tif (!that.List.length) {\n\t\t\t\t\tif (!this.RT('SearchRe') || d.path.length) {\n\t\t\t\t\t\tvar a = that.RT('j2h')(d.value, 50, ['id','name','length','status'], d.type!='array'?1:2, d.type!='array');\n\t\t\t\t\t\tif (a.length==1 && a[0][0]=='short') {\n\t\t\t\t\t\t\tif (a[0][1][0] == '{') a[0][1] ='Object '+a[0][1];\n\t\t\t\t\t\t\telse if (a[0][1][0] == '[') a[0][1]='Array '+a[0][1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\th+=a.map(function(row){\n\t\t\t\t\t\t\tif (!row[0]) return row[1];\n\t\t\t\t\t\t\treturn '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n\t\t\t\t\t\t}).join('');\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Nothing found\n\t\t\t\t\t\th = '<span class=\"lh115 dib vat\">Found no nodes containing <span class=\"bolder\">{1}</span></span>'\n\t\t\t\t\t\t.assign(that.RT('data').search.escapeHTML());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn (d.type==\"object\"?'Object {'+ds+'}▾':'Array ['+ds+']▾');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t}","events": "click.my"}}},"$string": {"id": "Sys.JSON.String","CM": "auto","F": {},"ui": {".ikey": {},".ivalue": {"init": "function ($o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t}","bind": "function (d,v) {\n\t\t\t\tif (d.state != 2) {\n\t\t\t\t\treturn _conv(d.value);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn _conv(d.value);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// ---\n\t\t\t\t\n\t\t\t\tfunction _conv(value){\n\t\t\t\t\tvar h='<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\tif (value.length>140) {\n\t\t\t\t\t\th+=value.truncate(140).escapeHTML()\n\t\t\t\t\t\t+'&quot; <span class=\"ilabel\">'\n\t\t\t\t\t\t+ value.length\n\t\t\t\t\t\t+' chars</span>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=value.escapeHTML()+'<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t}","events": "input.my"}}},"$found": {"id": "Sys.JSON.Found","CM": "auto","F": {},"ui": {".ikey": {},".ivalue": {"init": "function ($o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t}","bind": "function (d,v) {\n\t\t\t\tvar maxlen = this.labelWidth/3 | 0,\n\t\t\t\t\t\ts, re, a, \n\t\t\t\t\t\tval = d.value;\n\t\t\t\tif ((d.state & 8) && (re = this.RT('SearchRe'))) {\n\t\t\t\t\ts = val.replace(this.RT('SearchRe'), '\\ufff1$1\\ufff1');\n\t\t\t\t\ta = s.split('\\ufff1');\n\t\t\t\t\ts = [\n\t\t\t\t\t\t'<span class=\"jval-bracket\">&quot;</span>',\n\t\t\t\t\t\ta[0].truncate(140, 'left', '…').escapeHTML(),\n\t\t\t\t\t\t'<span class=\"jval-found-key\">' + a[1].escapeHTML() +'</span>',\n\t\t\t\t\t\ta[2].truncate(140, 'right', '…').escapeHTML(),\n\t\t\t\t\t\t'<span class=\"jval-bracket\">&quot;</span>',\n\t\t\t\t\t\tval.length > 280 ?'<span class=\"ilabel\">'+ val.length+' chars</span>':''\n\t\t\t\t\t].join('');\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (d.state != 2) return _conv(d.value);\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\t\treturn _conv(d.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// ---\n\t\t\t\t\n\t\t\t\tfunction _conv(value){\n\t\t\t\t\tvar h='<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\tif (value.length>140) {\n\t\t\t\t\t\th+=value.truncate(140).escapeHTML()\n\t\t\t\t\t\t+'&quot; <span class=\"ilabel\">'\n\t\t\t\t\t\t+ value.length\n\t\t\t\t\t\t+' chars</span>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=value.escapeHTML()+'<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}","events": "input.my"}}},"$function": {"id": "Sys.JSON.Function","CM": "text/javascript","F": {},"ui": {".ikey": {},".ivalue": {"init": "function ($o,form) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t}","bind": "function (d,v) {\n\t\t\t\tif (d.state!=2) {\n\t\t\t\t\tvar h='';\n\t\t\t\t\tif (d.value.length>100) {\n\t\t\t\t\t\tvar head = d.value.split(\")\",1)[0];\n\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t'<span class=\"jval-function\">function</span> ',\n\t\t\t\t\t\t\thead.split('(')[0].replace('function',''),\n\t\t\t\t\t\t\t'(',\n\t\t\t\t\t\t\thead.split('(')[1]+') {',\n\t\t\t\t\t\t\t' <span class=\"ilabel lh140\">',\n\t\t\t\t\t\t\t((d.value.match(/[\\r\\n]+/g)||\"\").length+1)+' LOC, ',\n\t\t\t\t\t\t\td.value.length+' chars',\n\t\t\t\t\t\t\t'</span> ',\n\t\t\t\t\t\t\t'}'\n\t\t\t\t\t\t].join('')\n\t\t\t\t\t}\n\t\t\t\t\telse h = '<span class=\"jval-function\">function</span>'+d.value.replace(/^function/,'').escapeHTML();\n\t\t\t\t\t\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn d.value;\n\t\t\t\t}\n\t\t\t}","events": "input.my"}}},"$base64": {"id": "Sys.JSON.Base64","CM": "b64","F": {},"init": "function ($o) {\n\t\tvar sig, \n        that = this, \n\t\t\t\td = that.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\tif (!d.sig) {\n      \n      var reimg = /^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/,\n          isurl = reimg.test(d.value),\n          trimmed = isurl?d.value.replace(reimg,''):d.value;\n      \n      d.size = (trimmed.length/4*3).floor();\n      d.sig = sig = window.atob(trimmed.to(40));\n      \n      if (isurl) {\n      \t// we have dataURL\n        d.mime = d.value.to(30).split(';base64')[0].split(':')[1];\n      }\n      else {\n      \n        if (sig.to(4)===\"ÿØÿà\") d.mime = 'image/jpeg'; \n        else if (sig.to(4)===\"\\u0089PNG\") d.mime = 'image/png'; \n\t\t\t\n        if (!d.mime) {\n          // try to guess it by name\n          if (d.path.length==3 && d.path[1]==\"_attachments\") {\n            // we have couchdb doc\n            var i, \n                ico=\"fi-paperclip\", \n                mime=\"application/octet-stream\", \n                fname = d.path[2];\n            for (i in that.Mime) if (that.Mime[i].test(fname)) mime = i;\n            for (i in that.Ico) if (that.Ico[i].test(fname)) ico = i;\n            d.mime = mime;\n            d.ico = ico;\n            d.fname = fname;\n          }\n        }\n      }\n      \n      d.mime = d.mime || 'image/jpeg';\n\t\t\t\n\t\t\tthat.RT('Blobs')[d.hash] = URL.createObjectURL(\n\t\t\t\t$.my.f.base642blob(d.value.replace(/^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/,''), null, d.mime)\n\t\t\t);\n\t\t}\n\n\t}","ui": {".ikey": {},".ivalue": {"init": "function ($o,form) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t}","bind": "function (d,v,$o) {\n\t\t\t\tvar h=\"\", \n\t\t\t\t\t\tblobs = this.RT('Blobs'),\n\t\t\t\t\t\timg = /^image/.test(d.mime+\"\") && d.value.length < 5e5?blobs[d.hash]:null;\n\t\t\t\tif (d.state != 2) {\n\t\t\t\t\t\n\t\t\t\t\tvar w = $o.width();\n\t\t\t\t\t\n\t\t\t\t\tif (img) {\n\t\t\t\t\t\th+='<a href=\"'+img+'\" target=\"_blank\" class=\"base64image\"><img src=\"'+img+'\" '\n\t\t\t\t\t\t+'class=\"fl mr10\"/></a>';\n\t\t\t\t\t\tw=w-80;\n\t\t\t\t\t} \n\t\t\t\t\telse if (d.mime && d.ico && d.fname){\n\t\t\t\t\t\th+='<a href=\"' + blobs[d.hash] + '\" '\n\t\t\t\t\t\t\t+' class=\"base64ico w55 h55 tac dib vat mr10 lgray fs200 bg-lgray br2\" '\n\t\t\t\t\t\t\t+ 'download=\"'+d.fname+'\" '\n\t\t\t\t\t\t\t+' title=\"Download '+d.fname+'\" '\n\t\t\t\t\t\t+' style=\"line-height:55px\"><span class=\"'+d.ico+'\"></span></a>';\n\t\t\t\t\t\tw = w-80;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar trim = ((w/10*2.5)|0).clamp(140,600);\n\t\t\t\t\t\n\t\t\t\t\th+='<div class=\"dib vat base64string\">';\n\t\t\t\t\th+='\"';\n\t\t\t\t\tif (d.value.length>trim) {\n\t\t\t\t\t\th+=d.value.truncate(trim)\n\t\t\t\t\t\t+'\"&nbsp;<a href=\"'+blobs[d.hash]+'\" '\n\t\t\t\t\t\t+'target=\"_blank\" class=\"ilabel tdn\">'\n\t\t\t\t\t\t+(d.mime?'Open':'Download')\n\t\t\t\t\t\t+'&nbsp;'+d.size.metric(2)+'b</a>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=d.value+'\"';\n\t\t\t\t\tif (img) h+='</div>';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn d.value;\n\t\t\t\t}\n\t\t\t}","events": "input.my"}},"Mime": {"application/x-compressed": "new RegExp(/\\.zip$/i)","application/vnd.ms-excel": "new RegExp(/\\.xlsx?$/i)","application/octet-stream": "new RegExp(/\\.(cdr|dat|rar)$/i)","application/json": "new RegExp(/\\.(jsn|json)$/i)","application/javascript": "new RegExp(/\\.js$/i)","application/vnd.openxmlformats-officedocument.wordprocessingml.document": "new RegExp(/\\.docx$/i)","application/msword": "new RegExp(/\\.doc?$/i)","application/pdf": "new RegExp(/\\.pdf$/i)","text/plain": "new RegExp(/\\.txt$/i)","text/html": "new RegExp(/\\.([x]?htm[l]?)$/i)","text/xml": "new RegExp(/\\.(xml|xsd|xsf|xsl|xslt)$/i)","image/png": "new RegExp(/\\.png$/i)","image/jpeg": "new RegExp(/\\.jpe?g$/i)","image/gif": "new RegExp(/\\.gif$/i)","image/svg+xml": "new RegExp(/\\.svg$/i)"},"Ico": {"fi-photo": "new RegExp(/\\.(png|jp[e]?g|gif|tif[f]?|bmp|svg)$/i)","fi-social-adobe": "new RegExp(/\\.(pdf|ai|psd)$/i)","fi-page-doc": "new RegExp(/\\.(doc[x]?|txt|rtf)$/i)","fi-graph-pie": "new RegExp(/\\.(xls[x]?|csv)$/i)","fi-archive": "new RegExp(/\\.(zip|rar|7z|7zip)$/i)","fi-html5 pl2": "new RegExp(/\\.(htm[l]|php)$/i)","fi-css3 pl2": "new RegExp(/\\.css$/i)","fi-widget": "new RegExp(/\\.(js[on]?|php|asp|jar|c|erl)$/i)","fi-sound": "new RegExp(/\\.(wav|aiff|mp3|ogg|mpeg3)$/i)"}},"$number": {"id": "Sys.JSON.Number","CM": "number","F": {"N2S": "function (v) {\n\t\t\tvar h = '<span class=\"orange\">'+v.toString()+'</span>';\n\t\t\tif (v<1e13&&v>8e11&&v===(+v).floor()) {\n\t\t\t\th+=' <span class=\"ilabel xgray lh140 vat mt4\"><span class=\"fi-clock\"></span> '\n\t\t\t\t+Date.create(v).format('{d} {Mon} {yyyy}, {H}:{mm}:{ss}, Local')\n\t\t\t\t+'</span>';\n\t\t\t}\n\t\t\treturn h;\n\t\t}","Calc": "function (s,prev) {\n\t\t\tif (!isNaN(s)) return +s;\n\t\t\tvar n = null;\n\t\t\ttry {\n\t\t\t\tn = eval('('+s+')');\n\t\t\t} catch (e) {}\n\t\t\tif (n!==null && !isNaN(n)) return +n;\n\t\t\treturn prev;\n\t\t}"},"ui": {".ikey": {},".ivalue": {"init": "function ($o,form) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that, function(newval, prev){\n\t\t\t\t\td.value = that.F.Calc(newval, prev);\n\t\t\t\t\t$o.trigger(\"check\");\n\t\t\t\t});\n\t\t\t}","bind": "function (d,v) {\n\t\t\t\tif (d.state==1 || d.state == 4) return this.F.N2S(d.value);\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\td.value = this.F.Calc(v, d.value)\n\t\t\t\t\t\treturn v;\n\t\t\t\t\t}\n\t\t\t\t\tthis.F.N2S(d.value);\n\t\t\t\t}\n\t\t\t}","events": "input.my"}}},"$boolean": {"id": "Sys.JSON.Boolean","ui": {".ikey": {},".ivalue": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.value = !d.value;\n\t\t\t\treturn this.V[d.value?1:0];\n\t\t\t}","events": "click.my"}},"V": ["<span class=\"iboolean-tag gray\">true</span><span class=\"iboolean-tag green bg-green4 o80\">false</span>","<span class=\"iboolean-tag green bg-green4 o80\">true</span><span class=\"iboolean-tag gray\">false</span>"]},"$null": {"id": "Sys.JSON.Null","ui": {".ikey": {},".ivalue": {"bind": "function (d,v) {\n\t\t\t\treturn '<span class=\"red o80\">null</span>';\n\t\t\t}"}}}},"raw": {"name": "Sys.JSON","title": "JSON Editor","version": "2.5","build": 5,"com": [{"stamp": "1420332711469","id": "Root","type": "js","data": "({\n\n\t// JSON Editor\n\t// (c) ermouth\n\n\tVersion:\"2.5\",\n\t\n\tdata:{\n\t\tdoc:{/*_id:null,_rev:null*/},\n\t\tlabelWidth:130,\n\t\ttree:{},\n\t\tcmd:\"\",\n\t\ttitle:\"Untitled JSON\",\n\t\traw:\"\",\n\t\tviewstate:{},\n\t\tsearch:'',\n\t\tfound:{}\n\t},\n\n\tRT: function (key){return key?this[key]:this;},\n\tMRoot: function(){return this.my.root()},\n\tparams:{restyle:100, delay:0},\n\t\n\tLib:{  /* See tab */ },\n\t\n\tMemState: function(node) {\n\t\tvar d = this.data, old; \n\t\tif (!d.viewstate) this.data.viewstate={};\n\t\told = d.viewstate[cw.lib.sdbm(node.path.join('❀')+'❀'+node.key)];\n\t\tif (old != node.state) {\n\t\t\td.viewstate[cw.lib.sdbm(node.path.join('❀')+'❀'+node.key)] = node.state;\n\t\t\tif (d._id) this.MemStateSave();\n\t\t}\n\t},\n\t\n\tMemStateSave: function(){\n\t\t// debounced by init\n\t\tvar d = this.data;\n\t\tif (d._id && Object.size(d.viewstate)) {\n\t\t\tvar state = Object.keys(d.viewstate).reduce(function(a,b){\n\t\t\t\tif(d.viewstate[b]==2) a.push(b); \n\t\t\t\treturn a;\n\t\t\t},[]);\n\t\t\tthis.Ls(\"viewstate.\"+cw.lib.sdbm((d.dbname || '') + '/'+d._id), {stamp:Date.now(), state:state});\n\t\t}\n\t},\n\t\n\tMemStateRestore: function(){\n\t\t// debounced by init\n\t\tvar d = this.data;\n\t\tif (d._id) {\n\t\t\tvar state = this.Ls(\"viewstate.\"+cw.lib.sdbm((d.dbname || '') + '/'+d._id));\n\t\t\tif (!Object.isObject(state)) return;\n\t\t\td.viewstate = state.state.reduce(function(a,b){\n\t\t\t\ta[b] = 2;\n\t\t\t\treturn a;\n\t\t\t},{});\n\t\t}\n\t},\n\t\n\tRejoin: function (d, list) {\n\t\tvar idx = this.Index;\n\t\tfor (var r, i=0;i<list.length;i++) {\n\t\t\tr=list[i];\n\t\t\tif (!/^(ob|ar)/.test(r.type)) d.value[r.key] = r.value;\n\t\t\tidx.dirty = true;\n\t\t}\n\t},\n\t\n\tSearchRe:false,\n\tSearch: function(re0){\n\t\tvar that = this,\n\t\t\t\tvi = {},\n\t\t\t\tre = that.SearchRe || re0;\n\t\t\n\t\tif (!re) return that.data.found = {};\n\n\t\tif (that.Index.dirty) {\n\t\t\tthat.Index.idx = _index(that.Doc.value);\n\t\t\tthat.Index.dirty = false;\n\t\t}\n\t\t\n\t\tfor (var m = 0, row, idx = that.Index.idx, i=0, pl = 0; i<idx.length; i++) {\n\t\t\tm = 0;\n\t\t\trow = idx[i];\n\t\t\tpl = row.p.length;\n\t\t\tif (re.test(row.k)) m = m | 4;\n\t\t\tif (row.v && re.test(row.v)) m = m | 8;\n\t\t\tif (m) for (var tp, j=1; j<pl; j++) {\n\t\t\t\ttp = row.p.slice(0,j);\n\t\t\t\tvi[cw.lib.sdbm(tp.join('❀') +'❀'+row.p[j])] = j == pl-1?m:3;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn that.data.found = vi;\n\t\t\n\t\t// - - - - - -\n\t\t\n\t\tfunction _index(doc) {\n\t\t\tvar stack = ['Root'], a=[];\n\t\t\tfunction _ob(v){\n\t\t\t\tObject.keys(v).forEach(function(i){\n\t\t\t\t\tvar t = $.type(v[i]);\n\t\t\t\t\tif (t == 'object' || t=='array') {\n\t\t\t\t\t\t//a.push({k:i.toLowerCase(), p:stack.slice(0).add(i), v:false});\n\t\t\t\t\t\tstack.push(i);\n\t\t\t\t\t\t_ob(v[i]);\n\t\t\t\t\t\ta.push({k:i.toLowerCase(), p:stack.slice(0), v:false});\n\t\t\t\t\t\tstack.pop();\n\t\t\t\t\t}\n\t\t\t\t\telse if (t == 'string') {\n\t\t\t\t\t\ta.push({\n\t\t\t\t\t\t\tk:i.toLowerCase(),\n\t\t\t\t\t\t\tp:stack.slice(0).add(i),\n\t\t\t\t\t\t\tv:v[i].toLowerCase().replace(/[\\r\\n\\t\\s]+/g,' ')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ta.push({\n\t\t\t\t\t\t\tk:i.toLowerCase(),\n\t\t\t\t\t\t\tp:stack.slice(0).add(i), \n\t\t\t\t\t\t\tv:(v[i]+'')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\t_ob(doc);\n\t\t\treturn a;\n\t\t}\n\t},\n\n\tinit:\"\", // See tab\n\t\n\tdie: function(){\n\t\tvar i, b = this.Blobs;\n\t\t// Free blobs objURLs cache\n\t\tfor (i in b) URL.revokeObjectURL (b[i]);\n\t},\n\t\n\tBlobs:{},\n\t\n\tDoc:{},\n\t\n\tIndex: {\n\t\tdirty:true,\n\t\tidx:[]\n\t}\n})","active": true,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1503867459375","id": ".Lib","type": "js","data": "({\n\trelist: function($o, that/*, form*/){\n\t\tvar form = that;\n\t\tthat.List = that.MakeList(form.data);\n\t\t$($o[0].querySelector('.ilist')).trigger('recalc');\n\t\t$($o[0].querySelector('.idesc')).trigger('check');\n\t},\n\tkick: function(cont, obj){\n\t\tfor (var i in cont) delete cont[i];\n\t\tObject.merge(cont,obj);\n\t},\n\n\t// checks if node is system\n\tisSystem: function (d){\n\t\tvar sys=false;\n\t\tif (d.level==1 && /^(_id|_rev)$/.test(d.key) && d.value) {\n\t\t\tsys = true;\n\t\t}\n\t\treturn sys;\n\t},\n\n\t// std bind handler for node forms\n\tkeyBind: function(d,v,$o){\n\t\tvar maxlen = this.labelWidth/3 | 0,\n\t\t\t\ts, re;\n\t\tif ((d.state & 4) && (re = this.RT('SearchRe'))) {\n\t\t\ts = d.key\n\t\t\t.replace(this.RT('SearchRe'), '\\ufff1$1\\ufff0')\n\t\t\t.escapeHTML()\n\t\t\t.replace('\\ufff1','<span class=\"jval-found-key\">')\n\t\t\t.replace('\\ufff0','</span>');\n\t\t}\n\t\telse {\n\t\t\tif (d.key.length > maxlen) $o.attr('title',d.key.escapeHTML());\n\t\t\ts = (!/^(|\\s+)$/.test(d.key))?d.key.truncate(maxlen,'right','…').escapeHTML():'\"'+d.key.escapeHTML()+'\"'; \n\t\t}\n\t\treturn s;\n\t},\n\n\t// inits editor on node value click\n\tinitEdit: function($o, that, oncommit){\n\t\tvar d = that.data;\n\t\t\n\t\t// invoke editor\n\t\t$o.on(\"click.my\", function(evt){\n\t\t\t\n\t\t\tvar $t = $(evt.target);\n\t\t\tif ($t.is('a') || $t.is('img')) return;\n\t\t\t\n\t\t\tvar $n = that.my.find('.inav');\n\t\t\tif (!$n.hasClass(\"iseditor\")) {\n\t\t\t\tvar isSystem = that.RT('Lib').isSystem.call(that, d);\n\t\t\t\tif (isSystem) {\n\t\t\t\t\tcw.lib.note(Object.isString(isSystem)?isSystem:\"Can’t change system properties.\",\"error\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\td.state = 2;\n\t\t\t\t\t$n.addClass(\"iseditor\");\n\t\t\t\t\t$o.addClass('hide');\n\t\t\t\t\t\n\t\t\t\t\t// Run editor\n\t\t\t\t\tthat.my.find('.ieditor').my(\n\t\t\t\t\t\tthat.RT('MEdit'), \n\t\t\t\t\t\t{text:d.value+'', mode:that.CM || 'auto'}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\tthat.my.root()\n\t\t.on(\"editorcommit.my\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $n = that.my.find('.inav');\n\t\t\tif ($n.hasClass(\"iseditor\")) {\n\t\t\t\tvar prev = d.value;\n\t\t\t\td.value = that.my.find('.ieditor').my('data').text;\n\t\t\t\t_closeEd();\n\t\t\t\tif (typeof oncommit == 'function') oncommit(d.value, prev);\n\t\t\t\telse {\n\t\t\t\t\t//$o.text('\"'+d.value.to(140)).escapeHTML().trigger(\"check\");\n\t\t\t\t\t$o.trigger(\"check\");\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.on(\"editorcancel.my\", function(evt){ \t\n\t\t\tevt.stopPropagation();\n\t\t\t_closeEd(); \n\t\t});\n\n\t\t// - - - - - -\n\n\t\tfunction _closeEd(){\n\t\t\td.state = 1;\n\t\t\td.hash = cw.lib.sdbm(d.value);\n\t\t\tthat.my.find('.ieditor').my('remove');\n\t\t\tthat.my.find('.inav').removeClass('iseditor');\n\t\t\t$o.removeClass('hide');\n\t\t\t//that.my.root().off('editorcommit.my').off('editorcancel.my')\n\t\t}\n\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1420437012576","id": ".init","type": "js","data": "(function ($o, form) {\n\tvar i, that = this,\n\t\t\td = form.data,\n\t\t\tdur = Date.now(),\n\t\t\ttypeNames = Object.keys(that).map(function(e){return /^\\$[a-z]/.test(e)?e.from(1):''}).compact(true);\n\t\t\n\t// Singletone constructors init\n\tthat.Ls = that.Ls('');\n\tif (Object.isFunction(that.Db)) that.Db = that.Db($o);\n\t\n\t// Render HTML\n\t$o.html(that.HTML.Main);\n\t\n\t// Debounce viewstate saver\n\tthat.MemStateSave = that.MemStateSave.debounce(700);\n\t\n\t// Prepare types\n\ttypeNames.forEach(function(i){\n\t\tvar e = that['$'+i];\n\t\te.labelWidth = d.labelWidth;\n\t\te.RT = that.RT;\n\t\te.Root = that.Root;\n\t\tif (i=='multi') {\n\t\t\te.HTML = that.HTML.ItemComplex;\n\t\t}\n\t\telse {\n\t\t\tif (!e[e.init?'HTML':'init']) e[e.init?'HTML':'init'] = that.HTML.ItemSimple;\n\t\t\tif (!e.ui['.ikey'].bind) e.ui['.ikey'].bind = that.Lib.keyBind;\n\t\t\tif (e.F && !e.F.initEdit) e.F.initEdit = that.Lib.initEdit;\n\t\t}\n\t\te.MakeList = that.MakeList;\n\t\tif (!e.params) e.params = {};\n\t\te.params.strict = true;\n\t});\n\t\n\t// First recursion step\n\t$.extend(that.Doc, {\n\t\tstate:2,\n\t\tlevel:0,\n\t\tpath:[],\n\t\ttype:\"object\",\n\t\tkey:\"Root\",\n\t\tvalue:form.data.doc\n\t});\n\t\n\td._id = d._id || d.doc._id || '';\n\t\n\tif (d.doc._rev === null) delete d.doc._rev;\n\n\t// Global handlers for buttons\n\t'add takeout copy'\n\t.split(' ').forEach(function(e){\n\t\t$o.on(\"click.my\", \".btn-\"+e, that.Event[e].fill(undefined, undefined, that, that.MRoot()));\n\t});\n\t\n\t// Global handler for click on ikey\n\t$o.on('click.my', '.ikeysimple', function(evt){\n\t\tvar $k = $(evt.currentTarget),\n\t\t\t\t$f = $k.my().root,\n\t\t\t\tdata = $k.my().data;\n\t\t$f.trigger('editorcancel.my');\n\t});\n\t\n\t// Replaces clean doc root node to ‘close doc’ action\n\t$o.on(\"click.my\", \"#doc>.iact>.btn-del\", function(evt){\n\t\tevt.stopPropagation();\n\t\t$o.trigger(\"cancel\");\n\t});\n\t\n\t// Load viewstate if applicable\n\tif (that.MemStateRestore) that.MemStateRestore();\n  \n    // If CloudWall, load additional info\n  if (d.cmd != 'create' && that.db && that.app && that.app.local) {\n  \treturn that.db.get(d.doc._id, {attachments:true, revs_info:true, conflicts:true}).then(function(res){\n    \t$.extend(d.doc, Object.select(res, ['_attachments']));\n      if (res._conflicts && res._conflicts.length) d.doc._conflicts = res._conflicts.slice(0);\n      d.doc._revs_info = res._revs_info.filter(function(e){return e.status!='missing'});\n    });\n  }\n\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1420859810464","id": ".ui","type": "js","data": "({\n\t'#btn-save':{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that =this;\n\t\t\tif (v!=null) {\n\t\t\t\t\n\t\t\t\tthat.db.save(d.doc)\n\t\t\t\t.then(\n\t\t\t\t\tfunction (res){\n\t\t\t\t\t\tvar doc = {doc:res};\n\t\t\t\t\t\t//push to app\n\t\t\t\t\t\tthat.Lib.kick(d.doc, res);\t\t\t\n\n\t\t\t\t\t\tvar vs = that.Ls(\"viewstate.\"+res._id);\n\t\t\t\t\t\tif (vs && (vs.stamp>doc.stamp || !Object.size(d.viewstate))) {\n\t\t\t\t\t\t\td.viewstate = vs.state;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\td._id = res._id||\"\";\n\n\t\t\t\t\t\tthat.Doc.state=1;\n\t\t\t\t\t\t$o.my(\"find\",\"#doc\").trigger(\"recalc\");\n\t\t\t\t\t\t$o.my(\"find\",\"#doc .idesc:eq(0)\").trigger(\"click\");\n\n\n\t\t\t\t\t}, \n\t\t\t\t\tfunction (e,msg) {\n\t\t\t\t\t\tcw.lib.note('Save failed, see console', 'error');\n\t\t\t\t\t\tconsole.log(msg, e);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n\t\n\t'#doctitle':{\n\t\tbind:function(d){\n\t\t\td._id = d.doc._id || d._id;\n\t\t\td._rev = d.doc._rev;\n\t\t\td.title = (d.doc._db||(this.db||{name:\"NoDB\"}).name)+\"\\u2009/\\u2009\"+(d.doc._id||\"\");\n\t\t\treturn d.title;\n\t\t},\n\t\twatch:['#doc'],\n\t\tdelay:30\n\t},\n\t\n\t'#json-search':{\n\t\tdelay:200,\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return d.search;\n\t\t\tvar that = this,\n\t\t\t\t\tprev = d.search;\n\t\t\t\n\t\t\td.search = v.length<3?'':v;\n\t\t\tif (!d.search) {\n\t\t\t\tthat.SearchRe = false;\n\t\t\t\td.found = {};\n\t\t\t\tif (prev) that.my.trigger('#doc .idesc:eq(0)', 'click.my');\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\tthat.SearchRe = new RegExp('('+RegExp.escape(v.compact())+')', 'i');\n\t\t\tthat.Search();\n\t\t\tthat.my.trigger('#doc .idesc:eq(0)', 'click.my');\n\t\t\treturn v;\n\t\t},\n\t\tcss: { \t'my-search': /^.{3,}$/ },\n\t\tevents:'input.my check.my'\n\t},\n\t\n\t'#doc':{\n\t\tdelay:20,\n\t\tbind:'this.Doc',\n\t\tcheck:false,\n\t\tmanifest:function(e){\n\t\t\treturn this.$multi;\n\t\t},\n\t\t//watch:['#json-search']\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1420391993562","id": ".MakeList","type": "js","data": "(function(data, key, state){\n\t\n\t// Object/array processor,\n\t// generates typed metaobject\n\t\n\tvar that=this,\n\t\t\ta=[], \n\t\t\tb = data.value,\n\t\t\tsdbm = cw.lib.sdbm,\n\t\t\tatob = window.atob,\n\t\t\tvs = that.data.viewstate || {},\n\t\t\tfound = that.data.found || {},\n\t\t\tlevel = data.level + 1,\n\t\t\tisSearch = that.data.search.length > 2;\n\t\n\tObject.keys(b)\n\t.forEach(function(i){\n\t\tvar val = b[i],\n\t\t\t\tdt = $.type(val),\n\t\t\t\tman = dt == 'object' || dt == 'array' ? 'multi' : dt,\n\t\t\t\thash,\n\t\t\t\tbin,\n        reimg = /^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/;\n\t\t\n\t\t// viewstate\n\t\tvar path = data.path.slice(0).add(data.key),\n\t\t\t\tvkey = cw.lib.sdbm(path.join('❀')+'❀'+i);\n\t\t\n\t\tif (isSearch && !found[vkey]) return;\n\t\t\n\t\t// Detect string-derived types\n\t\tif (dt == 'string'){\n\t\t\tif (isSearch && (found[vkey] | 8)) {\n\t\t\t\tman = 'found';\n\t\t\t\thash = sdbm(val);\n\t\t\t}\n\t\t\telse if (val.length > 11 && val.to(8) == 'function' && /\\}[\\r\\n\\t\\s]*$/.test(val.substr(-10))) {\n\t\t\t\tman = 'function';\n\t\t\t}\n\t\t\telse if(\n\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+$/.test(val.substr(0,158))\n\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+={0,2}$/.test(val)\n\t\t\t) {\n\t\t\t\tbin = _atob(val);\n\t\t\t\thash = sdbm(val);\n\t\t\t\tman = 'base64';\n\t\t\t}\n\t\t\telse if(\n\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t&& reimg.test(val)\n\t\t\t) {\n\t\t\t\tbin = _atob(val.replace(reimg,''));\n\t\t\t\thash = sdbm(val);\n\t\t\t\tman = 'base64';\n\t\t\t}\n\t\t\telse hash = sdbm(val);\n\t\t}\n\t\t\n\t\tif (!isSearch || found[vkey]) a.push({\n\t\t\tstate:state?state:!isSearch?vs[vkey] || 1:found[vkey],\n\t\t\tlevel:level,\n\t\t\tmanifest:'$'+man,\n\t\t\tpath:  path,\n\t\t\ttype:  dt,\n\t\t\tkey:   i,\n\t\t\tid:    i,\n\t\t\tvalue: b[i],\n\t\t\tbin:   bin,\n\t\t\thash:  hash\n\t\t});\n\t});\n\t\n\treturn a;\n\t\n\t// - - -\n\t\n\tfunction _atob(s){\n\t\tvar bin = '';\n\t\ttry {\n\t\t\tbin = atob(s);\n\t\t} catch(e){}\n\t\treturn bin;\n\t}\n\t\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1420520783214","id": ".Ls","type": "js","data": "(function(){\n\t\n\t// Local storage manager\n\tvar ls = window.localStorage;\n\t\n\tvar storage =  function LS (key0, data){\n\t\tvar x,  key = \"JSON.Editor.\"+key0;\n\t\tif (data) {\n\t\t\treturn ls.setItem(key, JSON.stringify(data));\n\t\t}\n\t\telse if (data===null || data===false) {\n\t\t\treturn ls.removeItem(key);\n\t\t}\n\t\telse {\n\t\t\tvar x = ls.getItem(key);\n\t\t\tif (Object.isString(x)) return JSON.parse(x);\n\t\t\telse return null;\n\t\t}\n\t};\n\t\n\treturn storage;\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1504047848117","id": ".j2h","type": "js","data": "(function j2h (source, maxChars, startKeys, depth, keysOnly){\n\n\tvar k0 = startKeys || [],\n\t\t\tk1 = cw.lib.a2o(k0),\n\t\t\tko = !!keysOnly;\n\tvar h = [];\n\n\t_unwrap(_parse(source, maxChars, 0));\n\t\n\treturn h;\n\n\t// ================================================\n\n\tfunction _parseObj(src, chars, lvl) {\n\n\t\tvar res = {\n\t\t\tkey:null,\n\t\t\tval:null,\n\t\t\tempty:false,\n\t\t\tsize:2, \n\t\t\tleft:'{', \n\t\t\tright:'}',\n\t\t\ttrim:0,\n\t\t\ttype:'object',\n\t\t\trows:[]\n\t\t};\n\n\t\tvar i, j, tval, ckey, tkey;\n\t\tvar len = 0;\n\n\t\tvar skip = {},\n\t\t\t\tk = Object.keys(src);\n\n\t\t// empty obj\n\t\tif (!k.length) {\n\t\t\tres.empty = true;\n\t\t\tres.size = 2;\n\t\t\tres.val = '';\n\t\t\treturn res;\n\t\t}\n\n\t\t// return shortcut, no traverse\n\t\tif (lvl >= depth || k.length>50) {\n\t\t\tres.trim = k.length;\n\t\t\tres.size = 2;\n\t\t\treturn res;\n\t\t}\n\t\t\n\t\t// \n\n\t\tvar childchars = (1.5 * chars / k.length | 0).clamp(10, chars*0.9 | 0),\n\t\t\t\tctr = 0,\n\t\t\t\tskip = {};\n\n\t\t// Process priviledged keys\n\t\tfor (i=0; i<k0.length && len < chars - childchars/3; i++) {\n\t\t\tckey = k0[i];\n\t\t\tif (undefined != src[ckey]) {\n\t\t\t\tskip[ckey] = true;\n\t\t\t\ttkey = ckey.truncate((childchars/(ko?1:2)).clamp(12,100),'right','…');\n\t\t\t\tif (/\\s/.test(tkey) || !tkey) tkey = '\"'+tkey+'\"';\n\t\t\t\ttval = _parse(src[ckey], childchars, lvl+1);\n\t\t\t\ttval.key = tkey;\n\t\t\t\tlen += tkey.length + (ko?0:tval.size);\n\t\t\t\tctr+=1;\n\t\t\t\tres.rows.push(tval);\n\t\t\t}\n\t\t}\n\n\t\t// Other keys\n\t\tfor (i=0; i<k.length && len < chars - childchars/3; i++) {\n\t\t\tckey = k[i];\n\t\t\tif (!skip[ckey]) {\n\t\t\t\ttkey = ckey.truncate((childchars/(ko?1:2)).clamp(12,100),'right','…');\n\t\t\t\tif (/\\s/.test(tkey) || !tkey) tkey = '\"'+tkey+'\"';\n\t\t\t\ttval = _parse(src[ckey], childchars, lvl+1);\n\t\t\t\ttval.key = tkey;\n\t\t\t\tlen += tkey.length + (ko?0:tval.size);\n\t\t\t\tctr+=1;\n\t\t\t\tres.rows.push(tval);\n\t\t\t}\n\t\t}\n\t\tres.trim = k.length - ctr;\n\t\tres.size = len;\n\t\treturn res;\n\t}\n\n\n\t// ================================================\n\n\tfunction _parse(src, chars, lvl) {\n\t\t// returns {size: charsSpent, left:'{', right:'r', rows:[]}\n\t\t// strings in .r should be treated as a markup\n\n\t\tvar res = {\n\t\t\tkey:null,\n\t\t\tval:null,\n\t\t\tempty:false,\n\t\t\tsize:0, \n\t\t\tleft:'', \n\t\t\tright:'',\n\t\t\ttrim:0,\n\t\t\ttype:'',\n\t\t\trows:[]\n\t\t};\n\t\tvar i, j, tval, tdiff;\n\t\tvar len = 0,\n\t\t\t\tclen = 0,\n\t\t\t\tchildchars = 0,\n\t\t\t\ttype = typeof src;\n\n\t\t// we have simple type ----------------------------\n\t\tif (null===src ||  type != 'object') {\n\n\t\t\tif (type != 'string') {\n\t\t\t\tres.type = type!='number'?'simple':type;\n\t\t\t\ttval = src+'';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tres.type = 'string';\n\t\t\t\tclen = src.length;\n\t\t\t\tif (clen <= chars-1) tval = src;\n\t\t\t\telse {\n\t\t\t\t\ttval = src.substr(0, chars);\n\t\t\t\t\tres.trim = clen - chars;\n\t\t\t\t}\n\t\t\t\tif (!tval.length || tval[0]=='-' || /\\s/.test(tval)) {\n\t\t\t\t\tres.left = res.right = '\"';\n\t\t\t\t\tlen+=2;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlen += tval.length;\n\t\t\tres.size = len;\n\t\t\tres.empty = !tval.length;\n\t\t\tres.val = tval;\n\t\t\treturn res;\n\t\t} \n\n\t\t// we have an array -----------------------------\n\t\telse if (Object.isArray(src)) {\n\t\t\tres.type='array';\n\t\t\tres.left='['; res.right=']'; len +=2;\n\t\t\t// empty arr\n\t\t\tif (!src.length) {\n\t\t\t\tres.empty = true;\n\t\t\t\tlen = 2;\n\t\t\t\tres.val = '';\n\t\t\t}\n\t\t\t// array with elts\n\t\t\telse {\n\t\t\t\tif (lvl < depth && src.length<50 && chars / src.length > 5) {\n\t\t\t\t\tvar childchars = (1.5 * chars / src.length | 0).clamp(10, chars*0.9 | 0),\n\t\t\t\t\t\t\tclen = 0,\n\t\t\t\t\t\t\tctr = 0;\n\n\t\t\t\t\tfor (i=0; i<src.length && clen < chars - childchars/3; i++) {\n\t\t\t\t\t\t// recursion\n\t\t\t\t\t\ttval = _parse(src[i], childchars, lvl + 1);\n\t\t\t\t\t\tlen += tval.size;\n\t\t\t\t\t\tclen += tval.size;\n\t\t\t\t\t\tctr+=1;\n\t\t\t\t\t\tres.rows.push(tval);\n\t\t\t\t\t}\n\n\t\t\t\t\tres.trim = src.length - ctr;\n\n\t\t\t\t}\n\t\t\t\telse res.trim = src.length;\n\t\t\t}\n\t\t}\n\n\t\t// we have an object ----------------------------\n\t\telse {\n\t\t\treturn _parseObj(src, chars, lvl);\n\t\t}\n\n\t\t// return result\n\n\t\tres.size = len;\n\t\treturn res;\n\t}\n\t\n\t\t\n\t// ================================================\n\n\n\tfunction p(a,b){ h.push([a,b]);}\n\n\tfunction _unwrap(x){\n\n\t\tif (null != x.key) {\n\t\t\tp('key', x.key);\n\t\t\tif (!ko) p('', ': ');\n\t\t}\n\n\t\t// empty\n\t\tif (x.empty) {\n\t\t\tp('empty', x.left+(x.val||'')+x.right); \n\t\t\treturn;\n\t\t}\n\n\t\tvar t = x.type,\n\t\t\t\tvalset = false;\n\n\t\t// val defined\n\t\tif (x.val != null){\n\t\t\tif (x.left) p('bracket', x.left);\n\t\t\tif (x.val.length < maxChars/5 && k1[x.key]) {\n\t\t\t\tvalset = true;\n\t\t\t}\n\t\t\tif (!ko || valset) {\n\t\t\t\tif (ko && valset) p('', ': ');\n\t\t\t\tp(t, x.val.escapeHTML());\n\t\t\t\tif (x.trim) {\n\t\t\t\t\tvar prefix = '+';\n\t\t\t\t\tif (t == 'object' || t == 'array') \tp('trim', prefix+x.trim);\n\t\t\t\t\telse p('trim','…');\n\t\t\t\t}\n\t\t\t} \n\t\t\tif (x.right) p('bracket', x.right);\n\t\t\t\n\t\t\tif (!valset && ko && !x.right && t !='simple' && t !='number') {\n\t\t\t\tp('bracket', t=='string'?'\"\"':t=='object'?'{}':'[]')\n\t\t\t}\n\t\t}\n\n\t\t// rows\n\n\t\telse if (x.rows.length){\n\t\t\tif (x.left) p('bracket', x.left);\n\n\t\t\tvar i, rl = x.rows.length;\n\t\t\tfor (i=0; i<rl;i++) {\n\t\t\t\t_unwrap(x.rows[i]);\n\t\t\t\tif (i!=rl-1 || x.trim) p('',', ');\n\t\t\t}\n\n\t\t\tif (x.trim) {\n\t\t\t\tvar prefix = '+';\n\t\t\t\tif (t == 'object' || t == 'array') \tp('trim', prefix+x.trim);\n\t\t\t\telse p('trim','…');\n\t\t\t}\n\t\t\tif (x.right) p('bracket', x.right);\n\t\t}\n\n\t\t// no rows, trim\n\t\telse if (x.trim) {\n\t\t\tif (t == 'object') \t\t\tp('short', '{'+x.trim+'}');\n\t\t\telse if (t == 'array') \tp('short', '['+x.trim+']');\n\t\t}\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1437942899191","id": ".Event","type": "js","data": "({\n\t// Event hooks for addnode, takeout, copynode clicks,\n\t// see tabs\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1420437054742","id": ".Event.add","type": "js","data": "(function(evt, data, that, $o){\n\tevt.stopPropagation();\n\tvar $b = $(this),\n\t\t\t$f = $b.parents(\".my-form\").eq(0);\t\t\n\tvar $p = $b,\n\t\t\tp = $f.data(\"my\").data,\n\t\t\tmn = $f.data(\"my\").manifest,\n\t\t\tt = $.type(p.value),\n\t\t\tisa = t==\"array\",\n\t\t\tkey = $f.my(\"data\").key,\n\t\t\tclip = that.Ls(\"Clip\")||{type:\"\"},\n\t\t\tsample = {\n\t\t\t\tobject:{},\n\t\t\t\tarray:[],\n\t\t\t\tstring:\"\",\n\t\t\t\tboolean:true,\n\t\t\t\tnumber:0\n\t\t\t};\n\t$b.parent().addClass(\"hover\");\n\t$f.addClass(\"hover\");\n\t$(this).modal({\n\t\tmanifest:that.MAdd,\n\t\tdata:{\n\t\t\tcmd:'prepend',\n\t\t\ttext:'New '+(isa?'member':'property')+' in <b>'+p.key+':'+(isa?'[]':'{}')+'</b>',\n\t\t\tprepend:(isa?'Insert':'Prepend'),\n\t\t\tappend:(isa?'':'Append'),\n\t\t\tisarray:isa,\n\t\t\tkey:isa?\"0\":'',\n\t\t\tclip:clip,\n\t\t\tkeys:isa?{}:Object.keys(p.value).reduce(function(a,b){a[b]=true;return a;},{}),\n\t\t\tfile:{}\n\t\t},\n\t\twidth:310,\n    align:\"top:103%;right:-114px;\",\n\t\troot:$o,\n\t\tbound:1,\n\t\tnose:\"top\",\n\t\tscreen:\"rgba(255,255,255,0)\",\n\t\tclose:false,\n\t\tesc:true,\n\t\tenter:true\n\t})\n\t.then(function(data){\n\t\tvar i, cmd = data.cmd,\n\t\t\t\tredraw = true, \n\t\t\t\tkeys=[], vals=[], ins;\n\t\t\n\t\tif (data.clip.type && data.type==\"clip\") sample.clip = data.clip.value; \n\t\t\n\t\tins = Object.clone(data.type==\"file\"?data.file:sample[data.type],true);\n\t\t\n\t\tif (!data.isarray) {\n\t\t\tif (data.type==\"string\" && data.file.data) ins=\"data:\"+data.file.content_type+\";base64,\"+data.file.data;\n\t\t\telse delete ins.name;\n\t\t}\n\t\t\t\t\n\t\tif (p.level==1 && /^(_id|_rev)$/.test(data.key)) {\n\t\t\tcw.lib.note(\"Can’t change system properties.\",\"error\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Object\n\t\tif (/^(ob)/.test(t)) {\n\t\t\t\n\t\t\t// Append/replace is simple\n\t\t\tif (cmd==\"append\" || p.value[data.key]!=null) { \n\t\t\t\tp.value[data.key] = ins; \n\t\t\t}\n\t\t\t\n\t\t\t// Prepend is more complex\n\t\t\telse if (cmd==\"prepend\") {\n\t\t\t\t\n\t\t\t\tkeys = Object.keys(p.value);\n\t\t\t\tfor (i in keys) {\n\t\t\t\t\tvals.push(p.value[keys[i]]);\n\t\t\t\t\tdelete p.value[keys[i]];\n\t\t\t\t}\n\t\t\t\tp.value[data.key] = ins;\n\t\t\t\tfor (i in keys) {\n\t\t\t\t\tif (keys[i]!==data.key) p.value[keys[i]] = vals[i];\n\t\t\t\t}\n\t\t\t\tvals=keys=null;\n\t\t\t}\n\t\t\t//Unknown cmd\n\t\t\telse redraw = false;\n\t\t}\n\t\t\n\t\t// Array\n\t\telse if (isa) {\n\t\t\tp.value.insert(ins, data.key);\n\t\t}\n\t\telse redraw = false;\n\t\t\n\t\tif (redraw) {\n\t\t\t// force redraw\n\t\t\tmn.ShowItems = null;\n\t\t\tmn.List = that.MakeList(p);\n\t\t\tp.state=2;\n\t\t\t$f.find(\".idesc:eq(0)\").trigger(\"check\");\n\t\t\t$f.find(\".ilist:eq(0)\").trigger(\"recalc\");\n\t\t}\n\t})\n\t.always(function(){\n\t\t$b.parent().removeClass(\"hover\");\n\t\t$f.removeClass(\"hover\");\n\t});\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1420517551195","id": ".Event.takeout","type": "js","data": "(function(evt, data, that, $o){\n\tevt.stopPropagation();\n\tvar $b = $(this),\n\t\t\t$f = $b.parents('.my-form').eq(0),\n\t\t\tp = $f.data('my').data,\n\t\t\tmn = $f.data('my').manifest;\n\t$b.parent().addClass('hover');\n\t$f.addClass('hover');\n\t$b.modal({\n\t\tmanifest:that.MTakeout,\n\t\tdata:{\n\t\t\tjson:JSON.stringify(p.value,null,'  '),\n\t\t\tpath:p.path,\n\t\t\tkey:p.key,\n\t\t\treplace:Object.size(p.value)?'Replace':'Save',\n\t\t\textend:Object.size(p.value)?'Extend':''\n\t\t},\n\t\twidth:($f.width()-160).clamp(500,1000),\n\t\talign:'top:103%;right:-76px;',\n\t\t//root:$o,\n    root:$o.find('section#editor').eq(0),\n\t\tnose:'top',\n\t\tscreen:'rgba(255,255,255,0)',\n\t\tclose:true,\n\t\tesc:true,\n\t\tenter:true\n\t})\n\t.then(function(res){\n\t\tvar redraw = true,\n\t\t\t\tres1;\n\n\t\tif (that.my.parent() && that.my.parent().data.isNew) res1 = res.node;\n\t\telse res1 = p.level == 0 ? Object.reject(res.node,/^(_id|_rev)$/) : res.node;\n\t\t\n\t\tif (res.cmd == 'extend') {\n\t\t\tObject.merge( p.value,  res1, true);\n\t\t}\n\t\telse if (res.cmd == 'replace') {\n\t\t\tvar temp = {};\n\t\t\tif (p.level == 0 && p.value._rev) temp = Object.select(p.value, /^(_id|_rev)$/);\n\t\t\tthat.RT('Lib').kick(p.value, res1);\n\t\t\tif (p.level == 0) Object.merge(p.value, temp);\n\t\t}\n\t\telse redraw = false;\n\t\t\n\t\tif (redraw) {\n\t\t\t// force redraw\n\t\t\tmn.ShowItems = null;\n\t\t\tp.state=2;\n\t\t\t\n\t\t\tthat.RT('Lib').relist($f, mn);\n\t\t}\n\t\t\n\t})\n\t.always(function(){\n\t\t$b.parent().removeClass('hover');\n\t\t$f.removeClass('hover');\n\t});\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1420520420366","id": ".Event.copy","type": "js","data": "(function(evt, data, that, $o){\n\tevt.stopPropagation();\n\tvar $b = $(this),\n\t\t\t$f = $b.parents(\".my-form\").eq(0),\n\t\t\tp = $f.data(\"my\").data,\n\t\t\tt = $.type(p.value),\n\t\t\tobj={};\n\t\n\tif (!p.level) obj = {key:\"\",type:p.type,value:p.value}\n\telse {\n\t\tobj={key:p.key,type:p.type,value:p.value}\n\t}\n\tthat.Ls(\"Clip\", obj);\n\tif (cw.lib) cw.lib.note(\"Clip stashed\",\"ok\");\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1437942845067","id": ".HTML","type": "js","data": "({\n\t// Proxy obj, see tabs\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1420334181465","id": ".HTML.Main","type": "html","data": "<section style=\"\">\n\t<section id=\"editor\" class=\"dib w100p\">\n\t\t<div class=\"pb5 fs130 nocwmin\">\n\t\t\t<div id=\"doctitle\" class=\"fs110 w60p pt4 bolder dib vat xgray nw oh ell pr10\" ></div>\n\t\t\t<div class=\"w20p fs90 dib vat\">\n\t\t\t\t<div class=\"fi-magnifying-glass xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>\n\t\t\t\t<input type=\"text\" id=\"json-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" \n\t\t\t\t\tplaceholder=\"Search\" style=\"background-image:none;padding-right:19px!important;\"><span \n\t\t\t\t\tclass=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"\n\t\t\t\t\tonclick=\"$(this).siblings('input:eq(0)').val('').trigger('check.my')\"></span>\n\t\t\t</div>\t\n\t\t\t\n\t\t\t<button class=\"button mr0 fr w150 fs90\" id=\"btn-save\">Save</button>\n\t\t</div>\n\t\t<div id=\"doc\" class=\"irow\txgray\"></div>\n\t</section>\n</section>","active": false,"opts": [],"err": [],"color": ["orange"]},{"stamp": "1503806925683","id": ".HTML.ItemComplex","type": "js","data": "([\n\t'<div class=\"inav\">',\n\t\t'<div class=\"ikey\"></div>',\n\t\t'<div class=\"idesc cp\">–</div>',\n\t'</div>',\n\t'<div class=\"ivalue imulti hide\">',\n\t\t'<div class=\"ilist\"></div>',\n\t'</div>',\n\t'<div class=\"iact buttons\">',\n\t\t'<button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button>',\n\t\t'<button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button>',\n\t\t'<button class=\"btn-copy button\" title=\"Stash node as clip\"><span class=\"fi-clipboard\"></span></button>',\n\t\t'<button class=\"btn-del button red\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n\t'</div>'\n].join(''))","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503365103339","id": ".HTML.ItemSimple","type": "js","data": "([\n\t'<div class=\"inav\">',\n\t\t'<div class=\"ikey ikeysimple\"></div>',\n\t\t'<div class=\"ivalue\"></div>',\n\t\t'<div class=\"ieditor\"></div>',\n\t'</div>',\n\t'<div class=\"iact buttons\">',\n\t\t'<button class=\"btn-copy button\" title=\"Stash property as clip\"><span class=\"fi-clipboard\"></span></button>',\n\t\t'<button class=\"btn-del button red\" title=\"Del property\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n\t'</div>'\n].join(''))","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1420354370062","id": ".style","type": "js","data": "({\n\t//\" \":\"font-size:11pt;font-family:\\'PT Mono\\',Monaco,\\'Lucida Console\\',monospace;min-height:500px;max-width:1500px;\",\t\n\t\" \":[\n\t\t\"font-size:15px;\",\n\t\t\"font-family: '-apple-system','BlinkMacSystemFont','Helvetica Neue','Segoe UI',Helvetica,Tahoma,Verdana,Sans-serif;\",\n\t\t//\"font-family: inherit;\",\n\t\t\"font-weight:300;\",\n\t\t\"min-height:500px;max-width:1900px;\"\n\t].join(''),\n\t\n\t\" .bolder\":'font-weight:bolder;',\n\t\n\t\" #doctitle\": function($o,b,c){\n\t\treturn \"width:\"+($o.width().clamp(0,1500)-220-20-144)+\"px\"\n\t},\n\t'  .irow':function(){\n\t\tvar x = this.data.labelWidth;\n\t\treturn {\n\t\t\t' .ikey':'width:'+x+'px;',\n\t\t\t' .inav':'padding-left:'+x+'px;',\n\t\t\t' .inav>.ikey':'margin-left:-'+x+'px;'\n\t\t}\n\t},\n\t' .jval-bracket':'font-weight:inherit;color: rgba(0, 181, 161, 0.72);',\n\t\n\t' .jval-trim':'display:inline-block;border-radius:2px;padding:0px 2px 1px 2px;line-height:1.1em;'\n\t\t\t+'color:rgba(213, 48, 89, 0.63);background-color:rgba(43, 107, 192, 0.07);',\n\t\n\t' .jval-short':'color:rgba(88,101,123,0.63);',\n\t' .jval-empty':'color:rgba(88,101,123,0.63);',\n\t\n\t' .jval-key':'font-weight:inherit;margin-left:3px;',\n\t' .jval-bracket+.jval-key':'margin-left:1px;',\n\t\n\t' .jval-simple':'color:rgba(52, 143, 27, 0.78);',\n\t' .jval-number':'color:rgba(255,97,0,0.87)',\n\t' .jval-null':'color:rgba(214,0,26,0.83)',\n\t\n\t' .jval-string':'color:#366599;',\n\t' .jval-function':'color:rgba(143,36,158,0.8);',\n\t\n\t' .jval-found-key':'background-color:rgba(255,221,0,0.7);padding-left:1px;padding-right:1px;border-radius:2px;'\n})","active": false,"opts": [],"err": [],"color": ["orange"]},{"stamp": "1420674061323","id": ".style.","type": "css","data": "\ntextarea {font-family:Cousine,'PT Mono',Monaco,'Lucida Console',monospace;}\n.irow {\n\twidth:calc(100% - 1px);display:inline-block;\n\tvertical-align:top;\n\tpadding:0px 0px 0px 25px;\n\tborder-left:1px solid rgba(70,105,135,0.25);\n\tline-height:1.3em;\n\tmargin-left:1px;\n}\n.irow:before {content:\"\";position:absolute;top:15px;left:0;width:18px;border-bottom:1px solid rgba(70,105,135,0.25);}\n.irow:last-child {border:none;}\n.irow:last-child:after {content:\"\";position:absolute;top:0;left:0;height:15px;border-left:1px solid rgba(70,105,135,0.25);}\n.irow:hover,.irow.hover {background-color:rgba(206, 214, 226, 0.2);}\n\n.ikey {\n\tpadding-right:10px;display:inline-block;\n\tword-break:break-all;font-size:95%;\n\tline-height:1.2em;opacity:0.8;\n\toverflow:hidden;vertical-align:top;margin:0.25em 0 0.3em 0px;\n}\n\n.ilabel {\n\tfont-size:80%;padding:0 5px;\n\tbackground-color: rgba(0,0,0,0.05);\n\tborder-radius:2px;opacity:0.9;\n\tdisplay:inline-block; margin:-1px 5px 0 0px;\n}\n\n.ivalue, .ilist {word-break: break-all;}\n.ivalue {line-height: 1.6em;}\n.idesc {line-height: 1.5em;}\n.ivalue, .ilist, .idesc {\n\twidth:100%;display:inline-block;\n\tvertical-align:top;\n}\n\n.ivalue {cursor:pointer;}\n.imulti.ivalue {cursor:inherit;}\n.iseditor .ivalue {\n\tword-wrap: break-word;\n\twhite-space:pre; \n\tpadding:0.2em 0.3em 0.2em 0.4em;\n\tfont-family:Cousine,'PT Mono',Monaco,'Lucida Console',monospace;\n\tmax-height:400px;\n\toverflow:auto;overflow:overlay;\n\toutline:none; border:1px solid rgba(0,0,0,0.2);\n\tfont-size:90%;\n\tborder-radius:2px;margin:-1px 0 -1px 0;\n\ttab-size:2;\n\tbackground-color:rgba(255,255,240,0.8);\n\tcursor:text;\n}\n.iboolean-tag {\n\tpadding:0 9px 1px 9px; \n\tdisplay:inline-block;\n\tvertical-align:top;\n\tborder-radius:100px;\n}\n\n.inav {margin:2px 0 }\n\n.inav .ieditor {width:100%;display:none;}\n.inav .ivalue.hide~.ieditor{display:inline-block;}\n.inav .ieditor {word-break:normal;}\n.inav .ieditor .icmframe {overflow:hidden; border:1px solid #d1dfe9; border-radius:2px;}\n.inav .ieditor .button {padding: 0.25em 0.7em 0.15em 0.7em;margin-top: 0; margin-bottom: 0;}\n\n/* ====== CodeMirror ====== */\n\n.CodeMirror {\n\tfont-size:13.5px;\n\tfont-family:Cousine,'PT Mono',Monaco,monospace;\n\tline-height:1.4em;\n\tcolor: #434e5d;\n}\n.CodeMirror .CodeMirror-lines {line-height:17px;}\n.CodeMirror-scroll { max-height:calc(20 * 16px + 6px); }\n.CodeMirror-linenumbers { transition: background-color 0.3s }\n.ed-error .CodeMirror-linenumbers { background-color:rgba(255, 200, 200, 0.75) }\n\n.CodeMirror .cm-property \t{ color:#434e5d; }\n.CodeMirror .cm-variable \t{ color:#33bfad; }\n.CodeMirror .cm-keyword \t{ color:#90259e; }\n\n.my-modal-form .CodeMirror {\n\tmin-height:150px;\n\theight:auto;\n}\n.my-modal-form .CodeMirror-scroll {min-height:150px;}\n\n.inav .ieditor .CodeMirror {\n\tmin-height:25px;\n\theight:auto;\n}\n\n\n/* ====== Actions buttons panel ====== */\n\t\t\n.iact {position:absolute; top:3px; right:3px;opacity:0;transition:opacity 0.3s;border-radius:3px;}\n.iact:hover, .iact.hover {display:block;opacity:1!important;}\n.inav:hover~.iact {display:block;opacity:0.7;xbackground:rgba(255,255,255,0.8)}\n.iact .button {padding:0.25em 0 0.15em 0;margin-top:0;margin-bottom:0;text-align:center;width:36px;white-space:nowrap;}\n.inav.iseditor~.iact {display:none}\n\t\t\n\t\t\n#doc {padding:0; border:none;overflow:visible;}\n#doc:before, #doc:after {display:none}\n#doc:hover {background:white}\n#doc>.inav {padding-left:120px}\n#doc>.inav .ikey {font-size:105%;font-weight:bold;margin:0 0 0 -120px;width:120px;}\n#doc>.iact {opacity:0.3;top:0;right:0;}\n\t\t\n.tag.active {background-color: rgba(135, 212, 0, 0.17)!important;color: rgb(65, 132, 0)!important;}\n\n\t\n.buttons button { border-radius:0;margin-right:2px; padding:0.4em 0.7em 0.4em 0.7em;width:36px;font-size:90%;}\n.buttons button:last-child {border-top-right-radius:3px; border-bottom-right-radius:3px; margin-right:0;}\n.buttons button:first-child {border-top-left-radius:3px; border-bottom-left-radius:3px;}\n.buttons .button {border-radius:0;margin-right:2px;}\n.buttons .button:last-child {border-top-right-radius:3px; border-bottom-right-radius:3px; margin-right:0;}\n.buttons .button:first-child {border-top-left-radius:3px; border-bottom-left-radius:3px;}\n\t\n\na.base64image img {\n\tbackground: white;\n\tborder: 1px solid #ddd!important;\n\tpadding: 3px;\n\tmax-width: 10%;\n\tmin-width: 2%;\n\tmax-height: 60px;\n}\n.base64image~div {width:87%}\n.base64ico~div {width:87%}\n\n.w55 {width:55px;}\n.h55 {height:55px;}\n","active": false,"opts": [],"err": [],"color": ["orange"]},{"stamp": "1420586761278","id": ".MTakeout","type": "js","data": "({\n\tinit:function($o, form){\n\t\tvar that = this;\n\t\tthat.StartHash = $.my.f.sdbmCode(form.data.json);\n\t\tthat.data.json = '('+that.data.json+')';\n\t\t$o.formgen([\n\t\t\t'<div id=\"title\" class=\"mb5 fs105 bolder\"></div>',\n\t\t\t'<div class=\"needsclick\" style=\"border:1px solid #ddd; margin:2px 0 8px 0;border-radius:2px\">',\n\t\t\t'<textarea id=\"json\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"></textarea>',\n\t\t\t'</div>',\n\t\t\t'<div>',\n\t\t\t'<div class=\"fr gray pt5\" id=\"info\"></div>',\n\t\t\t'<div class=\"buttons dib vat fs110 mt4\">',\n\t\t\t\t'<button class=\"button w90\" id=\"btn-replace\">Replace</button>',\n\t\t\t\t'<button class=\"button w90\" id=\"btn-extend\">Extend</button>',\n\t\t\t\t'<button class=\"button w90\" id=\"btn-cancel\">Cancel</button>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"lgray pl30 dib vat pt5\" id=\"info\">JSON or js expression ⇡</div>',\n\t\t\t'</div>' \n\t\t]);\n\n\t},\n\tui:{\n\t\t\"#title\":function(d,v,$o){\n\t\t\treturn \"JSON for \"+d.path.slice(0).add(d.key).join(\"/\").truncate(70,\"middle\",\"…\");\n\t\t},\n\t\t\"#json\":{\n\t\t\tdelay:20,\n\t\t\tbind:\"json\",\n\t\t\tinit: function($o, form){\n\t\t\t\tvar that = this;\n\t\t\t\tif (that.data.json.length < 1e6) {\n\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\tmode:\"javascript\",\n\t\t\t\t\t\tlineNumbers:true,\n\t\t\t\t\t\tviewportMargin:100,\n\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\tscrollbarStyle:null,\n\t\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\ttheme: \"default\",\n\t\t\t\t\t\tautofocus:true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#btn-replace\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.node = this.Parsed;\n\t\t\t\t\td.cmd = \"replace\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.replace;\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d,v){return !this.Dirty || !this.Parsed;},\n\t\t\t\t\"self:orange\": function(d,v){return this.Dirty && !!this.Parsed;}\n\t\t\t},\n\t\t\twatch:\"#info\"\n\t\t},\n\t\t\"#btn-extend\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.node = this.Parsed;\n\t\t\t\t\td.cmd = \"extend\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.extend;\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d,v){return !this.Dirty || !this.Parsed;},\n\t\t\t\t\"self:orange\": function(d,v){return this.Dirty && !!this.Parsed;},\n\t\t\t\t\"self:hide\":function(d){ return !d.extend}\n\t\t\t},\n\t\t\twatch:\"#info\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#info\": {\n\t\t\tdelay:400,\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tvar parse, \n\t\t\t\t\t\ts = unescape(encodeURIComponent(d.json)).length;\n\t\t\t\ttry {\n\t\t\t\t\tparse = eval(\"(\"+d.json+\")\");\n\t\t\t\t\tif (!Object.isObject(parse) && !Object.isArray(parse)) parse=null;\n\t\t\t\t\telse {\n\t\t\t\t\t\tparse = JSON.parse($.my.tojson(parse));\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\t//console.log(e)\n\t\t\t\t}\n\t\t\t\tthis.Parsed = parse?parse:null;\n\t\t\t\t\n\t\t\t\t$o.my().root.toggleClass(\"ed-error\",!parse);\n\n\t\t\t\tthis.Hash = $.my.f.sdbmCode(d.json);\n\t\t\t\tthis.Dirty = this.StartHash != this.Hash;\n\t\t\t\treturn s.metric(2)+\"b\";\n\t\t\t},\n\t\t\twatch:\"#json\"\n\t\t}\n\t},\n\tstyle:{\n\t\t' #json':'border: none; width: 100%;display: block;height: 300px;font-size: 0.7em;word-wrap: normal; overflow-x: hidden;',\n\t\t' .CodeMirror':{\n\t\t\t'':'min-height:150px;height:auto;font-size:13px!important;',\n\t\t\t' .CodeMirror-lines':'line-height:17px!important;',\n\t\t\t\t' .cm-property':'color:#434e5d;',' .cm-variable':'color:#33bfad;',' .cm-keyword':'color:#90259e;' \n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1420429338317","id": ".MAdd","type": "js","data": "({\n\tinit:function($o,form) {\n\t\tvar that=this;\n\t\t$o.formgen(that.HTML);\n\t\tif (form.data.isarray) {\n\t\t\t$o.find(\"#nkey\").attr(\"type\",\"number\");\n\t\t}\n\t},\n\tdata:{ \n\t\tcmd:\"\",\n\t\tkey:\"\",\n\t\ttype:\"string\",\n\t\tisarray:false,\n\t\ttext:\"Create new property\",\n\t\tprepend:\"Prepend\",\n\t\tappend:\"Append\",\n\t\tupload:'<span class=\"pseudolink dib w100p vat tac\">Select file...</span>',\n\t\tkeys:{},\n\t\tfile:{}\n\t},\n\tui:{\n\t\t\"#ntext\":\"text\",\n\t\t\"#nkey\":{\n\t\t\tbind:function(d,v){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (d.isarray) d.key = v.replace(/\\D/g,'');\n\t\t\t\t\telse d.key = v;\n\t\t\t\t}\n\t\t\t\treturn d.key;\n\t\t\t},\n\t\t\twatch:\"#ntype\"\n\t\t},\n\t\t\"#ntype\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.type=v;\n\t\t\t\t\tif (v==\"Clip\" && !d.key && !d.isarray) d.key = d.clip.key; \n\t\t\t\t}\n\t\t\t\treturn d.type;\n\t\t\t},\n\t\t\tinit: function($o,form){\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[[\n\t\t\t\t\t\t{\"{}\":\"object\"},\n\t\t\t\t\t\t{\"[]\":\"array\"},\n\t\t\t\t\t\t{\"42\":\"number\"},\n\t\t\t\t\t\t{\"!0\":\"boolean\"},\n\t\t\t\t\t\t{\"File\":\"file\"}\n\t\t\t\t\t].add(form.data.clip.type?{\"Clip\":\"clip\"}:undefined)],\n\t\t\t\t\tempty:{'\"\"':\"string\"},\n\t\t\t\t\ttagcss:'tag blue cp pl6 pr6',\n\t\t\t\t\ttagshim:\"\",\n\t\t\t\t\tgroupshim:\"\"\n\t\t\t\t})\n\t\t\t},\n\t\t\trecalc:\"#nkeytype\"\n\t\t},\n\t\t\"#nkeytype\":function(d){return (d.isarray?'Index':'Key')},\n\t\t\"#xupload\":{\n\t\t\twatch:\"#ntype\",\n\t\t\tcss:{\n\t\t\t\t\"hide\":function(d){return d.type!=\"file\"}\n\t\t\t}\n\t\t},\n\t\t\"#upload\": {/* See tab */},\n\t\t\".cw-att-upload\":\"upload\",\n\t\t\"#btn-to0\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null){\n\t\t\t\t\td.cmd = \"prepend\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.keys[d.key]&&!d.isarray?'Replace':d.prepend;\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\":function(d){return !d.key},\n\t\t\t\t\"self:red\":function(d){return d.keys[d.key]&&!d.isarray;}\n\t\t\t},\n\t\t\twatch:\"#nkey\"\n\t\t},\n\t\t\"#btn-to1\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null){\n\t\t\t\t\td.cmd = \"append\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t\treturn d.append;\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\":function(d){return !d.key},\n\t\t\t\t\"self:hide\": function(d){return !d.append || /^\\d+$/.test(d.key) || d.keys[d.key]}\n\t\t\t},\n\t\t\twatch:\"#nkey\"\n\t\t},\n\t\t\"#btn-cancel\":function(d,v,$o){\n\t\t\tif(v!=null) $o.trigger(\"cancel\");\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div id=\"ntext\"></div>',\n\t\t{label:\"60px\", row:\"100%\", rowCss:'my-row pt5 pb5', labelCss:\"my-label gray fs90\"},\n\t\t['<span id=\"nkeytype\">Key</span>','inp#nkey.w100p','msg.mt2.mb-2'],\n\t\t['Type','spn#ntype.div.vat.fs95'],\n\t\t'<div id=\"xupload\" class=\"pl60 mt5 mb10 hide\">',\n\t\t\t'<span class=\"cw-att-upload button w100p\"></span>',\n\t\t\t'<input id=\"upload\" class=\"pl60\" type=\"file\" />',\n\t\t'</div>',\n\t\t{rowCss:'my-row pt5 pb10 buttons pl60'},\n\t\t['',\n\t\t 'but#btn-to0.button.green.w85',{txt:'Prepend'}, \n\t\t 'but#btn-to1.button.green.w85',{txt:'Append'}, \n\t\t 'but#btn-cancel.button.w75.mr0',{txt:'Cancel'},\n\t\t]\n\t],\n\tstyle:{\n\t\t\" .cw-att-item\":\"white-space:nowrap; overflow:hidden; padding:0.2em 0 0.2em 0; line-height:1.4em;\",\n\t\t\" input[type=file]\":\"width:240px;cursor:pointer;opacity:0; position:absolute;top:0;left:60px;height:35px;\"\n\t}\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1435443205328","id": ".MAdd.ui.#upload","type": "js","data": "({\n\tbind:function(d,v,$o) {\n\t\tvar f, a={}, data;\n\t\tif (v!=null && v) {\n\t\t\tf = $o[0].files[0];\n\t\t\tif (f.size>d.limit){\n\t\t\t\tcw.note(\"Max upload file size is \"+(d.limit*1).abbr(1)+\"b\",\"error\");\n\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t}\n\t\t\telse if (f) (function(){\n\t\t\t\ta.name = f.name;\n\t\t\t\ta.content_type = f.type||\"application/octet-stream\";\n\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\tfr.onload=function(e){\n\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\ta.data = data;\n\t\t\t\t\ta.length = sb64.length;\n\t\t\t\t\t\n\t\t\t\t\t$.extend(d.file, a);\n\t\t\t\t\tif (!d.key && !d.isarray) d.key = f.name;\n\t\t\t\t\tif (!d.key && d.isarray) 10000;\n\n\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\n\t\t\t\t\t$o.my(\"find\",\".cw-att-upload>span\")\n\t\t\t\t\t.text(f.name.truncate(15,\"middle\",\"…\")+\" \"+a.length.metric(2,false)+\"b\");\n\t\t\t\t\t\n\t\t\t\t\tif (d.key == f.name) {\n\t\t\t\t\t\t$o.my(\"find\",\"#nkey\").val(d.key).trigger(\"blur\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t})();\n\t\t}\n\t},\n\tcss:{\n\t\thide:function (d) {return !d.upload}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1503365425181","id": ".MEdit","type": "js","data": "({\n\tdata:{text:'', mode:'auto', commitKeys:[], cancelKeys:[]},\n\tinit:[\n\t\t'<div style=\"width:calc(100% - 80px);\" class=\"icmframe dib vat mt-1 mb-1\">',\n\t\t\t'<textarea id=\"ied\" style =\"width:100%;max-height:300px;\" class=\"xgray\"></textarea>',\n\t\t'</div>',\n\t\t'<div class=\"buttons w80 dib vat tar o100 pr3 pt0\">',\n\t\t\t'<button id=\"btn-change\" class=\"button green w36\" title=\"Stash property as clip\"><span class=\"fi-check\"></span></button>',\n\t\t\t'<button id=\"btn-discard\" class=\"button w36\" title=\"Del property\"><span class=\"fi-minus-circle\"></span></button>',\n\t\t'</div>'\n\t],\n\tui:{\n\t\t'#ied':{\n\t\t\tinit: function($o){\n\t\t\t\t\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data,\n\t\t\t\t\t\tt = d.text,\n\t\t\t\t\t\tmode = d.mode,\n\t\t\t\t\t\tisNumber = mode=='number',\n\t\t\t\t\t\tstart,\n\t\t\t\t\t\twrap = false,\n\t\t\t\t\t\tlnums = true;\n\t\t\t\t\n\t\t\t\t// Simple heuristics to guess mode\n\t\t\t\tif (mode == 'auto') {\n\t\t\t\t\tstart = t.substr(0,800);\n\t\t\t\t\tif ((start.match(/(var\\s|const\\s|function[\\s\\(]|return\\s|[\\s\\t]if\\s)/g)||[]).length > 2) {\n\t\t\t\t\t\tmode = \"text/javascript\";\n\t\t\t\t\t\tvar maxl = 0;\n\t\t\t\t\t\tt.lines().forEach(function(e,i){\n\t\t\t\t\t\t\tif (i>200) return;\n\t\t\t\t\t\t\tif (e.length > maxl) maxl = e.length;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (maxl>150 && maxl<1000) wrap = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (\n\t\t\t\t\t\t/<\\/(div|span|p|a|script|head|title|svg|path)/.test(start)\n\t\t\t\t\t\t|| /<(svg|path|group)\\s/.test(start)\n\t\t\t\t\t) {\n\t\t\t\t\t\tmode = 'text/html';\n\t\t\t\t\t\twrap = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (CodeMirror.modes.erlang && /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/.test(start)) {\n\t\t\t\t\t\tmode = 'erlang';\n\t\t\t\t\t\twrap = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tmode = 'text';\n\t\t\t\t\t\tif (!/[\\r\\n]/.test(start)) {\n\t\t\t\t\t\t\twrap = true;\n\t\t\t\t\t\t\tif (t.length < 800) lnums = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Special modes\n\t\t\t\tif (mode == 'number') {\n\t\t\t\t\tmode = \"text/javascript\";\n\t\t\t\t\tlnums = false;\n\t\t\t\t}\n\t\t\t\telse if (mode == 'b64') {\n\t\t\t\t\tmode = 'text/plain';\n\t\t\t\t\twrap = true;\n\t\t\t\t\tlnums = false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: \t\t\t\t\tmode,\n\t\t\t\t\tviewportMargin:\t100,\n\t\t\t\t\tlineNumbers:\t\tlnums,\n\t\t\t\t\tindentWithTabs:\t!0,\n\t\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\t\ttheme: \t\t\t\t\t'default',\n\t\t\t\t\tautofocus:\t\t\ttrue,\n\t\t\t\t\tlineWrapping:\t\ttrue, //wrap,\n\t\t\t\t\textraKeys:$.extend(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'Esc':_cancel,\n\t\t\t\t\t\t\t'Ctrl-Enter':_commit.debounce(20),\n\t\t\t\t\t\t\t'Cmd-Enter':_commit.debounce(20)\n\t\t\t\t\t\t}, \n\t\t\t\t\t\t!isNumber?{}:{'Enter':_commit},\n\t\t\t\t\t\td.commitKeys.reduce(function(a,b){ a[b] = _commit; return a;}, {}),\n\t\t\t\t\t\td.cancelKeys.reduce(function(a,b){ a[b] = _cancel; return a;}, {})\n\t\t\t\t\t)\n\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t// - - - -\n\t\t\t\tfunction _commit(){that.my.trigger('#ied','editorcommit.my')}\n\t\t\t\tfunction _cancel(){that.my.trigger('#ied','editorcancel.my')}\n\t\t\t},\n\t\t\tbind:'text'\n\t\t},\n\t\t'#btn-change':{\n\t\t\tbind:function(d,v){if(v!=null) this.my.trigger('#ied','editorcommit.my')}\n\t\t},\n\t\t'#btn-discard':{\n\t\t\tbind:function(d,v){if(v!=null) this.my.trigger('#ied','editorcancel.my')}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1420332992586","id": ".$multi","type": "js","data": "({\n\tid:\"Sys.JSON.Object\",\n\tdata:{},\n\tList:[],\n\tTxt:{\n\t\tobject:\t[\"Object {\",\"}\"],\n\t\tarray:\t[\"Array [\",\"]\"]\n\t},\n\tinit: function _init_multi($o, form){\n\t\tvar that = this, \n\t\t\t\td = that.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\tif (d.state > 1) that.List = that.MakeList(that.data);\n\t\t\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.RT('Rejoin')(d, that.List);\n\t\t}.debounce(300));\n\t\t\n\t\t$o.on(\"click.my\", \".ilist:eq(0) .btn-del\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $f = $(this).parents(\".my-form\").eq(0);\t\t\n\t\t\tvar p = $f.parent().data(\"my\").data,\n\t\t\t\t\tt = $.type(p.value),\n\t\t\t\t\tkey = $f.my(\"data\").key;\n\t\t\t\n\t\t\tif (t==\"object\") delete p.value[key];\n\t\t\telse if (t==\"array\") p.value.removeAt(key);\n\t\t\t\n\t\t\tthat.RT('Lib').relist($o, that, form);\n\t\t});\n\t\t\n\t},\n\t/*die:function($o){\n\t\tif ($o.find('#btn-takeout').data('modal')) {\n\t\t\t$o.find('#btn-takeout').modal(true);\n\t\t}\n\t\telse if ($o.find('#btn-add').data('modal')) $o.find('#btn-add').modal(true);\n\t},*/\n\tShowItems:null,\n\tui:{\n\t\t\".ivalue\":{\n\t\t\tcss:{\n\t\t\t\thide:function(){return !this.List.length}\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t\".ilist\":{\n\t\t\tdelay:0,\n\t\t\t//check:true,\n\t\t\t//merge:true,\n\t\t\tbind:\"this.List\",\n\t\t\tlist:'<div class=\"irow\"></div>',\n\t\t\tid:function(e){return 'X'+e.id;},\n\t\t\thash:function(e){return 'X'+e.hash;},\n\t\t\tmanifest: function(e) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn that.RT(e.manifest)||that.RT('$string');\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t\".ikey\":{\n\t\t\tdelay:10,\n\t\t\tbind:function(d,v,$o){\t\t\t\t\n\t\t\t\tvar maxlen = this.labelWidth/3 | 0,\n\t\t\t\ts, re;\n\t\t\t\tif ((d.state & 4) && (re = this.RT('SearchRe'))) {\n\t\t\t\t\ts = d.key\n\t\t\t\t\t.replace(this.RT('SearchRe'), '\\ufff1$1\\ufff0')\n\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t.replace('\\ufff1','<span class=\"jval-found-key\">')\n\t\t\t\t\t.replace('\\ufff0','</span>');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (d.key.length > maxlen) $o.attr('title',d.key.escapeHTML());\n\t\t\t\t\ts = (!/^(|\\s+)$/.test(d.key))?d.key.truncate(maxlen,'right','…').escapeHTML():'\"'+d.key.escapeHTML()+'\"'; \n\t\t\t\t\tif (d.state == 2) s = '<span class=\"bold\">'+s+'</span>';\n\t\t\t\t}\n\t\t\t\treturn s;\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t\".idesc\":{\n\t\t\tdelay:10,\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tlist = this.List, \n\t\t\t\t\t\tt = that.Txt[d.type],\n\t\t\t\t\t\tds = Object.size(d.value),\n\t\t\t\t\t\th=\"\";\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = ((d.state==1 && !(d.manifest==\"$multi\" && !ds))|| !d.level?2:1);\n\t\t\t\t\tif (d.state==2) that.List = that.MakeList(d);\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.List = [];\n\t\t\t\t\t\tthat.ShowItems = null;\n\t\t\t\t\t}\n\t\t\t\t\tthat.RT('MemState')(d);\n\t\t\t\t}\n\n\t\t\t\tif (!that.List.length) {\n\t\t\t\t\tif (!this.RT('SearchRe') || d.path.length) {\n\t\t\t\t\t\tvar a = that.RT('j2h')(d.value, 50, ['id','name','length','status'], d.type!='array'?1:2, d.type!='array');\n\t\t\t\t\t\tif (a.length==1 && a[0][0]=='short') {\n\t\t\t\t\t\t\tif (a[0][1][0] == '{') a[0][1] ='Object '+a[0][1];\n\t\t\t\t\t\t\telse if (a[0][1][0] == '[') a[0][1]='Array '+a[0][1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\th+=a.map(function(row){\n\t\t\t\t\t\t\tif (!row[0]) return row[1];\n\t\t\t\t\t\t\treturn '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n\t\t\t\t\t\t}).join('');\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Nothing found\n\t\t\t\t\t\th = '<span class=\"lh115 dib vat\">Found no nodes containing <span class=\"bolder\">{1}</span></span>'\n\t\t\t\t\t\t.assign(that.RT('data').search.escapeHTML());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn (d.type==\"object\"?'Object {'+ds+'}▾':'Array ['+ds+']▾');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1503365395414","id": ".$string","type": "js","data": "({\n\tid:\"Sys.JSON.String\",\n\tCM:'auto',\n\tF:{ /* mount on root app init */  },\n\tui:{\n\t\t\".ikey\":{ /* mount on root app init */ },\n\n\t\t\".ivalue\":{\n\t\t\tinit: function($o){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t},\n\t\t\tbind:function(d, v){\n\t\t\t\tif (d.state != 2) {\n\t\t\t\t\treturn _conv(d.value);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn _conv(d.value);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// ---\n\t\t\t\t\n\t\t\t\tfunction _conv(value){\n\t\t\t\t\tvar h='<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\tif (value.length>140) {\n\t\t\t\t\t\th+=value.truncate(140).escapeHTML()\n\t\t\t\t\t\t+'&quot; <span class=\"ilabel\">'\n\t\t\t\t\t\t+ value.length\n\t\t\t\t\t\t+' chars</span>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=value.escapeHTML()+'<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"input.my\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1506262714599","id": ".$found","type": "js","data": "({\n\tid:\"Sys.JSON.Found\",\n\tCM:'auto',\n\tF:{ /* mount on root app init */  },\n\tui:{\n\t\t\".ikey\":{ /* mount on root app init */ },\n\n\t\t\".ivalue\":{\n\t\t\tinit: function($o){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t},\n\t\t\tbind:function(d, v){\n\t\t\t\tvar maxlen = this.labelWidth/3 | 0,\n\t\t\t\t\t\ts, re, a, \n\t\t\t\t\t\tval = d.value;\n\t\t\t\tif ((d.state & 8) && (re = this.RT('SearchRe'))) {\n\t\t\t\t\ts = val.replace(this.RT('SearchRe'), '\\ufff1$1\\ufff1');\n\t\t\t\t\ta = s.split('\\ufff1');\n\t\t\t\t\ts = [\n\t\t\t\t\t\t'<span class=\"jval-bracket\">&quot;</span>',\n\t\t\t\t\t\ta[0].truncate(140, 'left', '…').escapeHTML(),\n\t\t\t\t\t\t'<span class=\"jval-found-key\">' + a[1].escapeHTML() +'</span>',\n\t\t\t\t\t\ta[2].truncate(140, 'right', '…').escapeHTML(),\n\t\t\t\t\t\t'<span class=\"jval-bracket\">&quot;</span>',\n\t\t\t\t\t\tval.length > 280 ?'<span class=\"ilabel\">'+ val.length+' chars</span>':''\n\t\t\t\t\t].join('');\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (d.state != 2) return _conv(d.value);\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\t\treturn _conv(d.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// ---\n\t\t\t\t\n\t\t\t\tfunction _conv(value){\n\t\t\t\t\tvar h='<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\tif (value.length>140) {\n\t\t\t\t\t\th+=value.truncate(140).escapeHTML()\n\t\t\t\t\t\t+'&quot; <span class=\"ilabel\">'\n\t\t\t\t\t\t+ value.length\n\t\t\t\t\t\t+' chars</span>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=value.escapeHTML()+'<span class=\"jval-bracket\">&quot;</span>';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\tevents:\"input.my\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1503370510598","id": ".$function","type": "js","data": "({\n\tid:\"Sys.JSON.Function\",\n\tCM:'text/javascript',\n\tF:{ /* mount on root app init */  },\n\tui:{\n\t\t\".ikey\":{ /* mount on root app init */ },\n\t\t\".ivalue\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t},\n\t\t\tbind:function(d, v){\n\t\t\t\tif (d.state!=2) {\n\t\t\t\t\tvar h='';\n\t\t\t\t\tif (d.value.length>100) {\n\t\t\t\t\t\tvar head = d.value.split(\")\",1)[0];\n\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t'<span class=\"jval-function\">function</span> ',\n\t\t\t\t\t\t\thead.split('(')[0].replace('function',''),\n\t\t\t\t\t\t\t'(',\n\t\t\t\t\t\t\thead.split('(')[1]+') {',\n\t\t\t\t\t\t\t' <span class=\"ilabel lh140\">',\n\t\t\t\t\t\t\t((d.value.match(/[\\r\\n]+/g)||\"\").length+1)+' LOC, ',\n\t\t\t\t\t\t\td.value.length+' chars',\n\t\t\t\t\t\t\t'</span> ',\n\t\t\t\t\t\t\t'}'\n\t\t\t\t\t\t].join('')\n\t\t\t\t\t}\n\t\t\t\t\telse h = '<span class=\"jval-function\">function</span>'+d.value.replace(/^function/,'').escapeHTML();\n\t\t\t\t\t\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn d.value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"input.my\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1420701826844","id": ".$base64","type": "js","data": "({\n\tid:\"Sys.JSON.Base64\",\n\tCM:'b64',\n\tF:{ /* mount on root app init */  },\n\tinit: function($o){\n\t\tvar sig, \n        that = this, \n\t\t\t\td = that.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\tif (!d.sig) {\n      \n      var reimg = /^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/,\n          isurl = reimg.test(d.value),\n          trimmed = isurl?d.value.replace(reimg,''):d.value;\n      \n      d.size = (trimmed.length/4*3).floor();\n      d.sig = sig = window.atob(trimmed.to(40));\n      \n      if (isurl) {\n      \t// we have dataURL\n        d.mime = d.value.to(30).split(';base64')[0].split(':')[1];\n      }\n      else {\n      \n        if (sig.to(4)===\"ÿØÿà\") d.mime = 'image/jpeg'; \n        else if (sig.to(4)===\"\\u0089PNG\") d.mime = 'image/png'; \n\t\t\t\n        if (!d.mime) {\n          // try to guess it by name\n          if (d.path.length==3 && d.path[1]==\"_attachments\") {\n            // we have couchdb doc\n            var i, \n                ico=\"fi-paperclip\", \n                mime=\"application/octet-stream\", \n                fname = d.path[2];\n            for (i in that.Mime) if (that.Mime[i].test(fname)) mime = i;\n            for (i in that.Ico) if (that.Ico[i].test(fname)) ico = i;\n            d.mime = mime;\n            d.ico = ico;\n            d.fname = fname;\n          }\n        }\n      }\n      \n      d.mime = d.mime || 'image/jpeg';\n\t\t\t\n\t\t\tthat.RT('Blobs')[d.hash] = URL.createObjectURL(\n\t\t\t\t$.my.f.base642blob(d.value.replace(/^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/,''), null, d.mime)\n\t\t\t);\n\t\t}\n\n\t},\n\tui:{\n\t\t\".ikey\":{ /* mount on root app init */ },\n\t\t\".ivalue\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that);\n\t\t\t},\n\t\t\tbind:function(d, v, $o){\n\t\t\t\tvar h=\"\", \n\t\t\t\t\t\tblobs = this.RT('Blobs'),\n\t\t\t\t\t\timg = /^image/.test(d.mime+\"\") && d.value.length < 5e5?blobs[d.hash]:null;\n\t\t\t\tif (d.state != 2) {\n\t\t\t\t\t\n\t\t\t\t\tvar w = $o.width();\n\t\t\t\t\t\n\t\t\t\t\tif (img) {\n\t\t\t\t\t\th+='<a href=\"'+img+'\" target=\"_blank\" class=\"base64image\"><img src=\"'+img+'\" '\n\t\t\t\t\t\t+'class=\"fl mr10\"/></a>';\n\t\t\t\t\t\tw=w-80;\n\t\t\t\t\t} \n\t\t\t\t\telse if (d.mime && d.ico && d.fname){\n\t\t\t\t\t\th+='<a href=\"' + blobs[d.hash] + '\" '\n\t\t\t\t\t\t\t+' class=\"base64ico w55 h55 tac dib vat mr10 lgray fs200 bg-lgray br2\" '\n\t\t\t\t\t\t\t+ 'download=\"'+d.fname+'\" '\n\t\t\t\t\t\t\t+' title=\"Download '+d.fname+'\" '\n\t\t\t\t\t\t+' style=\"line-height:55px\"><span class=\"'+d.ico+'\"></span></a>';\n\t\t\t\t\t\tw = w-80;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar trim = ((w/10*2.5)|0).clamp(140,600);\n\t\t\t\t\t\n\t\t\t\t\th+='<div class=\"dib vat base64string\">';\n\t\t\t\t\th+='\"';\n\t\t\t\t\tif (d.value.length>trim) {\n\t\t\t\t\t\th+=d.value.truncate(trim)\n\t\t\t\t\t\t+'\"&nbsp;<a href=\"'+blobs[d.hash]+'\" '\n\t\t\t\t\t\t+'target=\"_blank\" class=\"ilabel tdn\">'\n\t\t\t\t\t\t+(d.mime?'Open':'Download')\n\t\t\t\t\t\t+'&nbsp;'+d.size.metric(2)+'b</a>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=d.value+'\"';\n\t\t\t\t\tif (img) h+='</div>';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn d.value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"input.my\"\n\t\t}\n\t},\n\tMime:{\n\t\t\"application/x-compressed\":/\\.zip$/i,\n\t\t\"application/vnd.ms-excel\":/\\.xlsx?$/i,\n\t\t\"application/octet-stream\":/\\.(cdr|dat|rar)$/i,\n\t\t\"application/json\":/\\.(jsn|json)$/i,\n\t\t\"application/javascript\":/\\.js$/i,\n\t\t\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\":/\\.docx$/i,\n\t\t\"application/msword\":/\\.doc?$/i,\n\t\t\"application/pdf\":/\\.pdf$/i,\n\t\t\"text/plain\":/\\.txt$/i,\n\t\t\"text/html\":/\\.([x]?htm[l]?)$/i,\n\t\t\"text/xml\":/\\.(xml|xsd|xsf|xsl|xslt)$/i,\n\t\t\"image/png\":/\\.png$/i,\n\t\t\"image/jpeg\":/\\.jpe?g$/i,\n\t\t\"image/gif\":/\\.gif$/i,\n    \"image/svg+xml\":/\\.svg$/i\n\t},\n\tIco:{\n\t\t\"fi-photo\":/\\.(png|jp[e]?g|gif|tif[f]?|bmp|svg)$/i,\n\t\t\"fi-social-adobe\":/\\.(pdf|ai|psd)$/i,\n\t\t\"fi-page-doc\":/\\.(doc[x]?|txt|rtf)$/i,\n\t\t\"fi-graph-pie\":/\\.(xls[x]?|csv)$/i,\n\t\t\"fi-archive\":/\\.(zip|rar|7z|7zip)$/i,\n\t\t\"fi-html5 pl2\":/\\.(htm[l]|php)$/i,\n\t\t\"fi-css3 pl2\":/\\.css$/i,\n\t\t\"fi-widget\":/\\.(js[on]?|php|asp|jar|c|erl)$/i,\n\t\t\"fi-sound\":/\\.(wav|aiff|mp3|ogg|mpeg3)$/i\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1420352742900","id": ".$number","type": "js","data": "({\n\tid:\"Sys.JSON.Number\",\n\tCM:'number',\n\tF:{ \n\t\tN2S: function(v){\n\t\t\tvar h = '<span class=\"orange\">'+v.toString()+'</span>';\n\t\t\tif (v<1e13&&v>8e11&&v===(+v).floor()) {\n\t\t\t\th+=' <span class=\"ilabel xgray lh140 vat mt4\"><span class=\"fi-clock\"></span> '\n\t\t\t\t+Date.create(v).format('{d} {Mon} {yyyy}, {H}:{mm}:{ss}, Local')\n\t\t\t\t+'</span>';\n\t\t\t}\n\t\t\treturn h;\n\t\t},\n\t\tCalc: function(s, prev){\n\t\t\tif (!isNaN(s)) return +s;\n\t\t\tvar n = null;\n\t\t\ttry {\n\t\t\t\tn = eval('('+s+')');\n\t\t\t} catch (e) {}\n\t\t\tif (n!==null && !isNaN(n)) return +n;\n\t\t\treturn prev;\n\t\t}\n\t},\n\tui:{\n\t\t\".ikey\":{ /* mount on root app init */ },\n\t\t\".ivalue\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\td = that.data;\n\t\t\t\tthat.F.initEdit($o, that, function(newval, prev){\n\t\t\t\t\td.value = that.F.Calc(newval, prev);\n\t\t\t\t\t$o.trigger(\"check\");\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:function(d, v){\n\t\t\t\tif (d.state==1 || d.state == 4) return this.F.N2S(d.value);\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\td.value = this.F.Calc(v, d.value)\n\t\t\t\t\t\treturn v;\n\t\t\t\t\t}\n\t\t\t\t\tthis.F.N2S(d.value);\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"input.my\"\n\t\t}\n\t},\n\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1420411601599","id": ".$boolean","type": "js","data": "({\n\tid:\"Sys.JSON.Boolean\",\n\tui:{\n\t\t\".ikey\":{ /* mount on app init */ },\n\t\t\".ivalue\":{\n\t\t\tbind:function(d, v){\n\t\t\t\tif (v!=null) d.value = !d.value;\n\t\t\t\treturn this.V[d.value?1:0];\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t}\n\t},\n\t\n\tV:[\n\t\t'<span class=\"iboolean-tag gray\">true</span><span class=\"iboolean-tag green bg-green4 o80\">false</span>',\n\t\t'<span class=\"iboolean-tag green bg-green4 o80\">true</span><span class=\"iboolean-tag gray\">false</span>'\n\t]\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1420843797370","id": ".$null","type": "js","data": "({\n\tid:\"Sys.JSON.Null\",\n\tui:{\n\t\t\".ikey\":{ /* mount on app init */ },\n\t\t\".ivalue\":{\n\t\t\tbind:function(d, v){\n\t\t\t\treturn '<span class=\"red o80\">null</span>';\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1511072797641","id": ".data.doc2","type": "js","data": "({\n\tx:1,xvalueOf:2\n})","active": false,"err": [],"opts": ["nocompile"],"color": []},{"stamp": "1420401243492","id": ".data.doc","type": "js","data": "JSON.parse(cw.lib.json({\n\t_id:'dfkjghlasfghlkasjdlk asdjklfhlkjashfdl asdkjfhlafsh jsfgkjshdgkdjh asfdghfghsfkja',\n\t\"id\": \"cw.Sys.JSON\",\n\tstamp:1503371819117,\n\t\"params\": {\n\t},\n\t\"expose\": [\n\t\t\"dfgsd\",\n\t\t\"dsgfsg\",\n\t\t2345,\n\t\ttrue,\n\t\tnull,\n\t\t\"asjdghlskajhdglkjhasldkjgh\",\n\t\t\"sdgjhk\"\n\t],\n\t\"Root\": function (){\n\t\treturn this;\n\t},\n\t\"data\": {\n\t\t\"doc\": {\n\t\t},\n\t\t\"tree\": {\n\t\t}\n\t},\n\t\"init\": function ($o, form) {\n\t\tvar that = this;\n\t\t$o.html(that.HTML.Main);\n\t\t$.extend(that.Doc, {\n\t\t\tstate:2,\n\t\t\tlevel:0,\n\t\t\tpath:[],\n\t\t\ttype:\"object\",\n\t\t\tkey:\"Root\",\n\t\t\tvalue:form.data.doc\n\t\t})\n\t\t//console.log(that.Doc)\n\t},\n\t\"Doc\": {\n\t},\n\t\"ui\": {\n\t\t\"#doc\": {\n\t\t\t\"delay\": 50,\n\t\t\t\"bind\": \"this.Doc\",\n\t\t\t\"check\": false,\n\t\t\t\"manifest\": function (e){\n\t\t\t\treturn this.$multi;\n\t\t\t}\n\t\t}\n\t},\n\t\"$multi\": {\n\t\t\"id\": \"Sys.JSON.Object\",\n\t\t\"inherit\": \"Root\",\n\t\t\"data\": {\n\t\t},\n\t\t\"List\": [],\n\t\t\"Txt\": {\n\t\t\t\"object\": [\"Object {\",\n\t\t\t\t\"}\"],\n\t\t\t\"array\": [\"Array [\",\n\t\t\t\t\"]\"]\n\t\t},\n\t\t\"init\": function ($o, form){\n\t\tvar that = this, d = form.data;\n\t\t$o.html(that.Root().HTML.ItemComplex)\n\t\tif (d.state>1) that.List = that.Root().MakeList(d);\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.Root().Rejoin(d, that.List)\n\t\t}.debounce(300));\n\t},\n\t\t\"ui\": {\n\t\t\t\".ikey:eq(0)\": {\n\t\t\t\t\"bind\": function (d,v){\n\t\t\t\treturn d.key;\n\t\t\t},\n\t\t\t\t\"css\": {\n\t\t\t\t\t\"bold\": function (d){return d.state!=1}\n\t\t\t\t},\n\t\t\t\t\"watch\": [\".idesc:eq(0)\"]\n\t\t\t},\n\t\t\t\".idesc:eq(0)\": {\n\t\t\t\t\"bind\": function (d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tlist = this.List, \n\t\t\t\t\t\tt = that.Txt[d.type],\n\t\t\t\t\t\tds = Object.size(d.value),\n\t\t\t\t\t\th=\"\";\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = d.state==1?2:1;\n\t\t\t\t\tif (d.state==2) that.List = that.Root().MakeList(d);\n\t\t\t\t\telse that.List = [];\n\t\t\t\t}\n\t\t\t\th= t[0]+ds+t[1] +\" \"\n\t\t\t\t+(!ds?\"\":!that.List.length?\"▸\":\"▾\");\n\t\t\t\treturn h;\n\t\t\t},\n\t\t\t\t\"css\": {\n\t\t\t\t\t\"gray\": function (){return true}\n\t\t\t\t},\n\t\t\t\t\"events\": \"click.my\"\n\t\t\t},\n\t\t\t\".ilist:eq(0)\": {\n\t\t\t\t\"delay\": 30,\n\t\t\t\t\"check\": false,\n\t\t\t\t\"bind\": \"this.List\",\n\t\t\t\t\"list\": \">div.irow\",\n\t\t\t\t\"manifest\": function (e) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn that.Root()[e.manifest]||that.Root().$string;\n\t\t\t},\n\t\t\t\t\"watch\": [\".idesc:eq(0)\"]\n\t\t\t},\n\t\t\t\".ivalue:eq(0)\": {\n\t\t\t\t\"css\": {\n\t\t\t\t\t\"hide\": function (){return !this.List.length}\n\t\t\t\t},\n\t\t\t\t\"watch\": [\".idesc:eq(0)\"]\n\t\t\t}\n\t\t}\n\t},\n\t\"$string\": {\n\t\t\"id\": \"Sys.JSON.String\",\n\t\t\"inherit\": [\"Root\"],\n\t\t\"init\": function ($o, html){\n\t\tvar that = this;\n\t\t$o.html(that.Root().HTML.ItemSimple);\n\t},\n\t\t\"ui\": {\n\t\t\t\".ikey:eq(0)\": \"key\",\n\t\t\t\".ivalue:eq(0)\": {\n\t\t\t\t\"init\": function ($o, form){\n\t\t\t\t$o.on(\"click.my\", function(){\n\t\t\t\t\tif (!$o.hasClass(\"ced\")) {\n\t\t\t\t\t\tform.data.state = 2;\n\t\t\t\t\t\t$o.text(form.data.value).addClass(\"ced\").focus();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"blur.my\", function(){\n\t\t\t\t\tif ($o.hasClass(\"ced\")) {\n\t\t\t\t\t\tform.data.state = 1;\n\t\t\t\t\t\tform.data.value = $o.text();\n\t\t\t\t\t\t$o.text('\"'+form.data.value.to(140)).removeClass(\"ced\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t\t\"bind\": function (d, v){\n\t\t\t\tif (d.state==1) {\n\t\t\t\t\tvar h='\"';\n\t\t\t\t\tif (d.value.length>140) {\n\t\t\t\t\t\th+=d.value.truncate(140).escapeHTML()\n\t\t\t\t\t\t+'\" <span class=\"ilabel\">'+d.value.length+' chars</span>';\n\t\t\t\t\t}\n\t\t\t\t\telse h+=d.value.escapeHTML()+'\"';\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn d.value;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\t\"events\": \"input.my\"\n\t\t\t}\n\t\t}\n\t},\n\t\"$function\": {\n\t\t\"id\": \"Sys.JSON.Function\",\n\t\t\"inherit\": [\"Root\"],\n\t\t\"init\": function ($o, html){\n\t\tvar that = this;\n\t\t$o.html(that.Root().HTML.ItemSimple);\n\t},\n\t\t\"ui\": {\n\t\t\t\".ikey:eq(0)\": \"key\",\n\t\t\t\".ivalue:eq(0)\": {\n\t\t\t\t\"init\": function ($o, form){\n\t\t\t\t$o.on(\"click.my\", function(){\n\t\t\t\t\tif (!$o.hasClass(\"ced\")) {\n\t\t\t\t\t\tform.data.state = 2;\n\t\t\t\t\t\t$o.text(form.data.value).addClass(\"ced\").focus();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"blur.my\", function(){\n\t\t\t\t\tif ($o.hasClass(\"ced\")) {\n\t\t\t\t\t\tform.data.state = 1;\n\t\t\t\t\t\tform.data.value = $o.text();\n\t\t\t\t\t\t$o.text(form.data.value.to(50)).removeClass(\"ced\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t\t\"bind\": function (d, v){\n\t\t\t\tif (d.state==1) {\n\t\t\t\t\tvar h='';\n\t\t\t\t\th+='<span class=\"blue \">function</span> ('\n\t\t\t\t\t\t+d.value.split(\")\",1)[0].split('(')[1]+') {'\n\t\t\t\t\t+' <span class=\"ilabel\">'\n\t\t\t\t\t\t+ (d.value.match(/[\\r\\n]+/g).length+1)+' SLOC, '\n\t\t\t\t\t\t+d.value.length+' chars'\n\t\t\t\t\t+'</span> '\n\t\t\t\t\t+'}';\n\t\t\t\t\t\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = v;\n\t\t\t\t\treturn d.value;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\t\"events\": \"input.my\",\n\t\t\t\t\"css\": {\n\t\t\t\t\t\"xgray\": function (){return true}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\"$number\": {\n\t\t\"id\": \"Sys.JSON.Number\",\n\t\t\"inherit\": [\"Root\"],\n\t\t\"init\": function ($o, html){\n\t\tvar that = this;\n\t\t$o.html(that.Root().HTML.ItemSimple);\n\t},\n\t\t\"ui\": {\n\t\t\t\".ikey:eq(0)\": \"key\",\n\t\t\t\".ivalue:eq(0)\": {\n\t\t\t\t\"init\": function ($o, form){\n\t\t\t\t$o.on(\"click.my\", function(){\n\t\t\t\t\tif (!$o.hasClass(\"ced\")) {\n\t\t\t\t\t\tform.data.state = 2;\n\t\t\t\t\t\t$o.text(form.data.value).addClass(\"ced\").focus();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"blur.my\", function(){\n\t\t\t\t\tif ($o.hasClass(\"ced\")) {\n\t\t\t\t\t\tform.data.state = 1;\n\t\t\t\t\t\tform.data.value = +$o.text();\n\t\t\t\t\t\t$o.removeClass(\"ced\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t\t\"bind\": function (d, v){\n\t\t\t\tvar h=\"\";\n\t\t\t\tif (d.state==1) {\n\t\t\t\t\th+= d.value.toString();\n\t\t\t\t\tif (d.value<1e13&&d.value>8e11&&d.value===(+d.value).floor()) {\n\t\t\t\t\t\th+=' <span class=\"ilabel xgray\"><span class=\"fi-clock\"></span> '\n\t\t\t\t\t\t\t+Date.create(d.value).format('{d} {mon} {yyyy}, {h}:{mm}:{ss} GMT')\n\t\t\t\t\t\t+'</span>';\n\t\t\t\t\t}\n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (v!=null) d.value = isNaN(v)?d.value:+v;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\t\"events\": \"input.my\",\n\t\t\t\t\"css\": {\n\t\t\t\t\t\"orange\": function (){return true}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\"$boolean\": {\n\t\t\"id\": \"Sys.JSON.Boolean\",\n\t\t\"inherit\": [\"Root\"],\n\t\t\"init\": function ($o, html){\n\t\tvar that = this;\n\t\t$o.html(that.Root().HTML.ItemSimple);\n\t},\n\t\t\"ui\": {\n\t\t\t\".ikey:eq(0)\": \"key\",\n\t\t\t\".ivalue:eq(0)\": {\n\t\t\t\t\"init\": function ($o, form){\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[\"true\"],\n\t\t\t\t\tempty:\"false\",\n\t\t\t\t\ttagcss:\"tag gray cp\"\n\t\t\t\t})\n\t\t\t},\n\t\t\t\t\"bind\": function (d, v){\n\t\t\t\tif (v!=null) d.value = !!v.length;\n\t\t\t\treturn d.value?[\"true\"]:[]\n\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\"HTML\": {\n\t\t\"Main\": \"<div id=\\\"doc\\\" class=\\\"irow\\\"></div>\",\n\t\t\"ItemSimple\": \"<div class=\\\"inav\\\"><div \\nclass=\\\"ikey\\\"></div><div\\nclass=\\\"ivalue\\\"></div><div class=\\\"iact buttons\\\"><button \\nclass=\\\"btn-edit button\\\"><span class=\\\"fi-pencil\\\"></span></button></div></div>\",\n\t\t\"ItemComplex\": \"<div class=\\\"inav\\\"><div \\nclass=\\\"ikey\\\"></div><div class=\\\"idesc blue cp\\\">–</div></div><div\\nclass=\\\"ivalue imulti hide\\\"><div \\nclass=\\\"ilist\\\" ><div class=\\\"irow\\\"></div></div></div>\"\n\t},\n\t\"style\": {\n\t\t\"\": \"font-size:11pt;font-family:'PT Mono',Monaco,monospace;\",\n\t\t\" .irow\": {\n\t\t\t\"\": \"width:100%;display:inline-block;overflow:hidden;vertical-align:top;padding:0px 0px 0px 15px;border-left:1px solid #ddd;line-height:1.3em;\",\n\t\t\t\" .ikey\": \"width:85px;padding-right:10px;display:inline-block;word-break:break-all;font-size:95%;line-height:1.1em;opacity:0.7;overflow:hidden;vertical-align:top;margin:0.15em 0 0.4em 0px;\",\n\t\t\t\"\\t.ivalue, .ilist\": \"width:100%;display:inline-block;overflow:hidden;vertical-align:top;\",\n\t\t\t\" .idesc\": \"width:100%;display:inline-block;overflow:hidden;vertical-align:top;\",\n\t\t\t\"\\t.inav\": {\n\t\t\t\t\"\": \"padding-left:85px;margin:4px 0\",\n\t\t\t\t\" .ikey\": \"margin-left:-85px;\"\n\t\t\t},\n\t\t\t\" .iact\": \"position:absolute; top:-5px; right:2px;opacity:0;transition:opacity 0.3s;\",\n\t\t\t\" .iact:hover\": \"display:block;opacity:1;\",\n\t\t\t\" .ivalue:hover+.iact\": \"display:block;opacity:0.4;\",\n\t\t\t\"#doc\": {\n\t\t\t\t\"\": \"padding:0\",\n\t\t\t\t\":before,:after\": \"display:none\",\n\t\t\t\t\":hover\": \"background:white\",\n\t\t\t\t\">.inav\": \"padding-left:100px;\",\n\t\t\t\t\">.inav .ikey\": \"font-size:105%;font-weight:bold;margin:0 0 0 -100px;width:100px;\"\n\t\t\t},\n\t\t\t\" .tag.active\": \"background-color: rgba(135, 212, 0, 0.17)!important;color: rgb(65, 132, 0)!important;\",\n\t\t\t\":before\": \"content:\\\"\\\";position:absolute;top:15px;left:0;width:8px;border-bottom:1px solid #ddd\",\n\t\t\t\":last-child\": \"border:none;\",\n\t\t\t\":last-child:after\": \"content:\\\"\\\";position:absolute;top:0;left:0;height:15px;border-left:1px solid #ddd\",\n\t\t\t\":hover\": \"background-color:rgba(0,0,0,0.015)\",\n\t\t\t\" .ced\": \"-webkit-user-modify: read-write;word-wrap: break-word;-webkit-line-break: after-white-space;white-space:pre; padding:0.2em 0.4em 0.4em 0.5em;font-family:'PT Mono',Monaco,monospace;max-height:400px;overflow:overlay;outline:none; border:1px solid #aaa;font-size:90%;border-radius:2px;margin:-4px 0 -3px 0;tab-size:2;background-color:rgba(255,255,240,0.8)\",\n\t\t\t\" .ilabel\": \"font-size:80%;padding:0 5px;background-color: rgba(0,0,0,0.1);border-radius:2px;opacity:0.7;display:inline-block; margin:-1px 5px 0 5px;\"\n\t\t},\n\t\t\" .buttons\": {\n\t\t\t\"button\": \"border-radius:0;margin-right:2px; padding:0.2em 0.7em;\",\n\t\t\t\"button:last-child\": \"border-top-right-radius:4px; border-bottom-right-radius:4px; margin-right:0;\",\n\t\t\t\"button:first-child\": \"border-top-left-radius:4px; border-bottom-left-radius:4px;\",\n\t\t\t\" .button\": \"border-radius:0;margin-right:2px;\",\n\t\t\t\" .button:last-child\": \"border-top-right-radius:4px; border-bottom-right-radius:4px; margin-right:0;\",\n\t\t\t\" .button:first-child\": \"border-top-left-radius:4px; border-bottom-left-radius:4px;\"\n\t\t}\n\t},\n\t\"MakeList\": function (data, key){\n\tvar dt, a=[], man, b = data.value;\n\tfor (var i in b) {\n\t\tdt = $.type(b[i]);\n\t\tman = /^(ob|ar)/.test(dt)?\"multi\":(dt==\"string\"&&/^function\\s?\\([\\s\\S]+\\}$/.test(b[i]))?\"function\":dt;\n\t\ta.push({\n\t\t\tstate:1,\n\t\t\tlevel:data.level+1,\n\t\t\tmanifest:\"$\"+man,\n\t\t\tpath:data.path.slice(0).add(data.key),\n\t\t\ttype:dt,\n\t\t\tkey:i,\n\t\t\tid:i,\n\t\t\tvalue:b[i]\n\t\t})\n\t}\n\treturn a;\n\t\t},\n\t\"Rejoin\": function (d, list) {\n\tfor (var r, i=0;i<list.length;i++) {\n\t\tr=list[i];\n\t\tif (!/^(ob|ar)/.test(r.type)) d.value[r.key] = r.value;\n\t}\n\t\t},\n\t\"files\": {\n\t\t\"Снимок экрана 2014-12-13 в 16.54.44.png\": {\n\t\t\t\"content_type\": \"image/png\",\n\t\t\t\"digest\": \"md5-WKUqyep89XlXvpqv5D5dbQ==\",\n\t\t\t\"data\": \"iVBORw0KGgoAAAANSUhEUgAAAmAAAAHiCAYAAABP+3CeAAAKomlDQ1BJQ0MgUHJvZmlsZQAASImVlwdQFGkWx7/uyYk0MAQJQ85IjpLjkCWDiWEGZoYwDgODgJgQUcE1ICICJnQFRIE1ALIGRBQDi4Bi1gVZVNR1MQAqKtcDx3B3dVtX96pe9a9ef/3/Xn/9XtVrAMjXmQJBKiwDQBo/Uxjm60GPiY2j454BIpAHaMStmKwMgXtoaCD4W5u4ByDx9Y6pWOvv1/1Xk2UnZrAAgEIRTmBnsNIQPoN4E0sgzAQAxUbi2qsyBWLegrC8EEkQ4Soxc2a5ScwJs9w5syYizBPhBwDgyUymkAMA6Q8kTs9icRAdMhphcz6bx0fYGmEXFpeJ7ENG7gGTtLSVYj6EsEHCv+hw/k0zQaLJZHIkPPsuM4b34mUIUpk5/+dx/G9LSxXN7aGFOJkr9AsT74ecWW3KygAJ8xOCQ+aYx57NScxckV/kHLMyPOPmmM30CphjUUqk+xwzhfPP8jIZEXMsXBkm0U/M8A6X6CcyAiU5pAZLOInnw5jjXG5E9Bxn8aKC5zgjJTxgfo2nJC4UhUlyThL6SN4xLWM+NxZzPodMboTffG4xkhzYiV7ekjg/UrJekOkh0RSkhkrWJ6b6SuIZWeGSZzORApvjZKZ/6LxOqOR8AA8EASZgZSZmi+sKeK4U5Ah5HG4m3R3pkkQ6g88yM6FbmlsgFSjuudlP+pE200sQ7eZ8LL0dAIciJMiZjzG1ATj3AgDqxHxM+wNSDjsBuNDLEgmzZmPiUgcYpJulkV5WBupAGxgAU2AJbIETcAPewB+EgAgQC5YDFuCCNCAEq0Ae2AAKQTHYCfaACnAQHAG14CQ4BVrAeXAZXAO3QC8YAI/BIBgBb8AYmABTEAThIApEhZQhDUgXMoYsIXvIBfKGAqEwKBaKhzgQHxJBedBGqBgqgSqgw1Ad9At0DroM3YD6oIfQEDQKfYC+wiiYDMvDarAevBC2h93hADgCXgZz4HQ4Fy6At8PlcDV8Am6GL8O34AF4EH4Dj6MAioSioTRRpih7lCcqBBWHSkIJUWtRRagyVDWqAdWG6kLdQQ2i3qK+oLFoKpqONkU7of3QkWgWOh29Fr0NXYGuRTejO9F30EPoMfQPDAWjijHGOGIYmBgMB7MKU4gpwxzDnMVcxQxgRjATWCyWhtXH2mH9sLHYZOxq7Dbsfmwjth3bhx3GjuNwOGWcMc4ZF4Jj4jJxhbh9uBO4S7h+3AjuM56E18Bb4n3wcXg+Ph9fhj+Ov4jvx7/ETxFkCLoER0IIgU3IIewgHCW0EW4TRghTRFmiPtGZGEFMJm4glhMbiFeJT4gfSSSSFsmBtJjEI60nlZOaSNdJQ6QvZDmyEdmTvJQsIm8n15DbyQ/JHykUih7FjRJHyaRsp9RRrlCeUT5LUaXMpBhSbKl1UpVSzVL9Uu+kCdK60u7Sy6VzpcukT0vfln4rQ5DRk/GUYcqslamUOSdzX2ZcliprIRsimya7Tfa47A3ZV3I4OT05bzm2XIHcEbkrcsNUFFWb6kllUTdSj1KvUkfksfL68gz5ZPli+ZPyPfJjCnIK1gpRCtkKlQoXFAZpKJoejUFLpe2gnaLdo31VVFN0V0xU3KrYoNivOKm0QMlNKVGpSKlRaUDpqzJd2Vs5RXmXcovyUxW0ipHKYpVVKgdUrqq8XSC/wGkBa0HRglMLHqnCqkaqYaqrVY+odquOq6mr+aoJ1PapXVF7q05Td1NPVi9Vv6g+qkHVcNHgaZRqXNJ4TVegu9NT6eX0TvqYpqqmn6ZI87Bmj+aUlr5WpFa+VqPWU22itr12knapdof2mI6GTpBOnk69ziNdgq69Lld3r26X7qSevl603ma9Fr1X+kr6DP1c/Xr9JwYUA1eDdINqg7uGWEN7wxTD/Ya9RrCRjRHXqNLotjFsbGvMM95v3GeCMXEw4ZtUm9w3JZu6m2aZ1psOmdHMAs3yzVrM3i3UWRi3cNfCroU/zG3MU82Pmj+2kLPwt8i3aLP4YGlkybKstLxrRbHysVpn1Wr13trYOtH6gPUDG6pNkM1mmw6b77Z2tkLbBttROx27eLsqu/v28vah9tvsrztgHDwc1jmcd/jiaOuY6XjK8S8nU6cUp+NOrxbpL0pcdHTRsLOWM9P5sPOgC90l3uWQy6CrpivTtdr1uZu2G9vtmNtLd0P3ZPcT7u88zD2EHmc9Jj0dPdd4tnuhvHy9irx6vOW8I70rvJ/5aPlwfOp9xnxtfFf7tvth/AL8dvndZ6gxWIw6xpi/nf8a/84AckB4QEXA80CjQGFgWxAc5B+0O+hJsG4wP7glBIQwQnaHPA3VD00P/XUxdnHo4srFL8IswvLCusKp4SvCj4dPRHhE7Ih4HGkQKYrsiJKOWhpVFzUZ7RVdEj0YszBmTcytWJVYXmxrHC4uKu5Y3PgS7yV7lowstVlauPTeMv1l2ctuLFdZnrr8wgrpFcwVp+Mx8dHxx+O/MUOY1czxBEZCVcIYy5O1l/WG7cYuZY8mOieWJL5Mck4qSXrFcebs5oxyXbll3Lc8T14F732yX/LB5MmUkJSalOnU6NTGNHxafNo5vhw/hd+5Un1l9so+gbGgUDCY7pi+J31MGCA8lgFlLMtozZRHhptukYFok2goyyWrMuvzqqhVp7Nls/nZ3TlGOVtzXub65P68Gr2atbojTzNvQ97QGvc1h9dCaxPWdqzTXlewbmS97/raDcQNKRt+yzfPL8n/tDF6Y1uBWsH6guFNvpvqC6UKhYX3NzttPrgFvYW3pWer1dZ9W38UsYtuFpsXlxV/28badvMni5/Kf5renrS9Z4ftjgM7sTv5O+/tct1VWyJbklsyvDtod3MpvbSo9NOeFXtulFmXHdxL3CvaO1geWN66T2ffzn3fKrgVA5UelY1VqlVbqyb3s/f3H3A70HBQ7WDxwa+HeIceHPY93FytV112BHsk68iLo1FHu362/7numMqx4mPfa/g1g7VhtZ11dnV1x1WP76iH60X1oyeWnug96XWytcG04XAjrbG4CTSJml7/Ev/LvVMBpzpO259uOKN7puos9WxRM9Sc0zzWwm0ZbI1t7Tvnf66jzant7K9mv9ac1zxfeUHhwo6LxIsFF6cv5V4abxe0v73MuTzcsaLj8ZWYK3c7F3f2XA24ev2az7UrXe5dl647Xz9/w/HGuZv2N1tu2d5q7rbpPvubzW9ne2x7mm/b3W7tdeht61vUd7Hftf/yHa871+4y7t4aCB7ouxd578H9pfcHH7AfvHqY+vD9o6xHU4/XP8E8KXoq87Tsmeqz6t8Nf28ctB28MOQ11P08/PnjYdbwmz8y/vg2UvCC8qLspcbLuleWr86P+oz2vl7yeuSN4M3U28I/Zf+semfw7sxfbn91j8WMjbwXvp/+sO2j8seaT9afOsZDx59NpE1MTRZ9Vv5c+8X+S9fX6K8vp1Z9w30r/274ve1HwI8n02nT0wKmkDkzCqAQh5OSAPhQAwAlFpkdegEgSs3OxDMGzc7xMwT+jmfn5hmzBaDGDYDI9QAEIjPKAcR1ESYjV/FIFOEGYCsrif/TMpKsLGe1yMhkifk8Pf1RDQBcGwDfhdPTU/unp78fRZJ9CEB7+uwsLjYs8ofShBFTtzr3C/gP+wcVXQEVslVMUgAAAZ1pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjA4PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjQ4MjwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpCV1gTAABAAElEQVR4AeydB3wVxfbHT0gnhRRaKAmBIFKUKkVAaQoivSuK+uz14VMf1mfX97c9O/aCqPTeRZDeO6GGEhIIECAkBEjnv+diNECSe+/ubJ3f+Xzyyb27M2fO+c7ee8/OzpzxuaAIQUAABEAABEAABEAABAwjUMGwltAQCIAACIAACIAACICAiwACMFwIIAACIAACIAACIGAwAQRgBgNHcyAAAiAAAiAAAiCAAAzXAAiAAAiAAAiAAAgYTAABmMHA0RwIgAAIgAAIgAAIIADDNQACIAACIAACIAACBhNAAGYwcDQHAiAAAiAAAiAAAgjAcA2AAAiAAAiAAAiAgMEE/AxuD82BAAhYmADnZc7MzKITJ0/RyZMZyt8p1/usM9l0JusMZZ05o7w/Q9nZZyknJ4fOn1f+lP+5Obmu/3l5+VRUWESFRYVUWKD8FSmvCwvJx8eHfH0rUIUKvq7/vr7835eCAgMpMCiQgoOCKDg4yPW6ovI/PCyMwsLDKDw8lCqFh1NYWChFRIRT5ehoiq4cpfyPoooVgy1MEqaBAAiAQPkEfJAJv3xAOAsCTiJw4sRJSkk5QkfSjlJa2jFKO6r8Kf+PKH/p6Sfo1KkMKlACJztIkBK4cUBWrVoViompRjHVq1GNGhf/x9SoTrG1a1JoaIgdXIGNIAACEhJAACZhp8NlZxM4o4xWJSUdoL379lPywRRKPpRKycmpdCgllc6dO+9s5y/zLioqkuLialFcbG2Kja1JdePjKKFePMUr/wMC/C8rjbcgAAIgYBwBBGDGsUZLICCUQH5+Ae1N2k87duym3buTXK858Dp2PF1oO05Uxo8/OSCrn1CXEhLiqeHVV1GjRg2odq0arselTvQZPoEACFiLAAIwa/UHrAGBUglwsLVr117asnU7JSoBFwddHHzxcYg4AvzIslFDJRhr2ICaNGlIzZo2VkbQaotrAJpAAARA4E8CCMBwKYCABQkcO5ZOGzdtpU2bt9HmLUrQlbib8vLyLGip802KjKhETZs2Uf4aU/Nm1yhBWRMKCanofMfhIQiAgK4EEIDpihfKQcAzAqmpR2jd+k20dt3Fv0PKvC2INQnw48vGyuPK1q1b0HWtmlOrlk2V1Zph1jQWVoEACFiWAAIwy3YNDHMygYyMTFq1eh0tX7GGVqxcS0eOHHWyu472jVNs8PyxDte3pg7t21DzFtdSYECAo32GcyAAAtoJIADTzhAaQMAtAc6FxY8SF/+xQgm41rgeKXLOLYjzCHB6DB4Z69ixLXW+sT3VqRPrPCfhEQiAgGYCCMA0I4QCECidAKeDWLpsFS1evJyWLFtJp09nlV4QRx1NoE6d2tS5Uwfq2rkjtVQeV/r5If+1ozsczoGAhwQQgHkICsVAwBMCnOh0wW9LaP6CRbRm7UZXFnhP6qGMHAQ4o38XJRDr0b0zdezQlgKVnQAgIAACchJAACZnv8NrgQSOHjtO8+cvdgVd6zdsITxaFAjXwap466VOyiPKHt27uP5jayUHdzZcA4FSCCAAKwUKDoGAOwK8X+K8+Ytoxqz5tFYZ6YKAgBYCHIx163oD9e7VXZnI35b8/fGYUgtP1AUBOxBAAGaHXoKNliCQq+Th+v33pTR95jxapsztQhJUS3SL44zgTcdv6dGV+vXpSS2UFZUQEAABZxJAAObMfoVXAgls376TJk2ZRTOV0a6srDMCNUMVCJRPID4+lgYO6K0EY7e4Nh0vvzTOggAI2IkAAjA79RZsNYwAP2KcOm0OTZo8k3bvSTKsXTQEAqURqFChgmvS/uBBfahrl45YSVkaJBwDAZsRQABmsw6DufoS4Fxdv46bQrPnLKTc3Fx9G4N2EFBBoGrVyjRkUF8aMqQvxVSvpkIDqoAACFiBAAIwK/QCbDCVQE5ODk2fMY9++XUy7di5x1Rb0DgIeEqAR8U4v9jw2we6Rsc8rYdyIAAC1iCAAMwa/QArTCCQdvQY/fzzJBo3YRrxI0cICNiVQEK9eLprxFDq1/cWCgoKsqsbsBsEpCKAAEyq7oazTIAfM/7w4zhXGgneIggCAk4hwCsohw7pT3cMH0TVq1V1ilvwAwQcSQABmCO7FU6VRmDJ0pX05Vc/0rr1m0s7jWMg4BgCfn6+1FdZOXn/fXdSvbp1HOMXHAEBJxFAAOak3oQvVxDgES6eUP/V12OwmvEKOjggA4FuXW+kBx8YQc2aNpHBXfgIArYhgADMNl0FQ70hwElSp06bTaO/+IFSDx/xpirKgoAjCbRp05Ief/Q+atO6hSP9g1MgYDcCCMDs1mOwt1wCHHhNnjKTRn/5Ax05crTcsjgJAjISaH1dc1cg1rZtKxndh88gYBkCCMAs0xUwRAuBgoICmjhphivwSks7pkUV6oKAFARatWxGI594gHhkDAICIGA8AQRgxjNHiwIJXLhwgWbNXkAffvQlHUo5LFAzVIGAHAQ6tG9DTz35MDVp0lAOh+ElCFiEAAIwi3QEzPCewOI/ltP7H4zG5Hrv0aEGCFxBoEf3LjTynw9i1eQVZHAABPQhgABMH67QqiOBrdt20Nv//YjWb0A6CR0xQ7WEBDi7Pu83yY8mK1eOlpAAXAYB4wggADOONVrSSIAn1b/3wWc0c9YCjZpQHQRAoDwCISEV6YH7RtA/7rkNmfXLA4VzIKCBAAIwDfBQ1RgC2dln6Qslger3P/xKeXl5xjSKVkAABKh69aqu+WGc1NXHxwdEQAAEBBJAACYQJlSJJzBtxlx6591PKD39pHjl0AgCIOARgWbNmtDLLz6Nifoe0UIhEPCMAAIwzzihlMEEEnfsptdef482btpqcMtoDgRAoDQCPAI2ZHBfZUTsEYqMrFRaERwDARDwggACMC9goaj+BLKyzigrGz+nX8dPJU4xAQEBELAWgfDwMPqXkrbitqH9iSftQ0AABNQRQACmjhtq6UBg5qz59ObbH9LJk6d00A6VIAACIgk0vbYxvfH6c3R1g/oi1UIXCEhDAAGYNF1tXUc5gerLr/wfLV+xxrpGwjIQAIErCPj6+tI9d99GTzx2PwUHB11xHgdAAATKJoAArGw2OKMzgcLCQvrmu5/pk0+/odzcXJ1bg3oQAAG9CNSoUZ3eePU56tixrV5NQC8IOI4AAjDHdak9HNq9O4lGPf86JSbusofBsBIEQMAtgYEDetHzz44knicGAQEQKJ8AArDy+eCsYAL5+QVKTq8f6PPR31FBQaFg7VAHAiBgNoGqVSvTa688S127dDTbFLQPApYmgADM0t3jLON27d5LTz/zCvZudFa3whsQKJVAn97d6eWXnsFoWKl0cBAEiBCA4SrQnUBRUZEy12ssffjRl8QjYBAQAAE5CFSvVpX++/ZL1P761nI4DC9BwAsCCMC8gIWi3hNIST1M/x71GjbO9h4daoCAYwiMuHMIPfPUo9hX0jE9CkdEEEAAJoIidJRKYPKUWfT6m+/T2bPnSj2PgyAAAvIQqBsfRx+8/zo1btRAHqfhKQiUQwABWDlwcEodgTPZ2fSfl/+PZs1eoE4BaoEACDiSQIC/Pz3z9GN0913DHOkfnAIBbwggAPOGFsq6JbB12w4a+eQLlJJ6xG1ZFAABEJCTQOdO7ZW5Yf+hqMgIOQHAaxBQCCAAw2UghADv2/jNt2Ppgw9HI72EEKJQAgLOJsDpKj549zVq06alsx2FdyBQBgEEYGWAwWHPCfAG2s+MeoUWLV7ueSWUBAEQkJ4Ab+Y98okH6KEH7yYfHx/peQCAXAQQgMnV38K95Uz2jz3xHKUexiNH4XChEAQkIdDpxvb03juvUKVK4ZJ4DDdBgKgCIICAWgLjxk+lIcPuQ/ClFiDqgQAIuAj8sWQF9R0wgrZt2wkiICANAYyASdPV4hzNzcujV199lyZOniFOKTSBAAhIT4BXSb726rPEe0pCQMDpBBCAOb2HBft37Fi68sjxWdq8ZbtgzVAHAiAAAhcJ3HnHYNem3n5+fkACAo4lgADMsV0r3rFNm7bRo0+MovT0k+KVQyMIgAAIlCDQunUL+vjDtyg6KrLEUbwEAecQwBww5/Slrp5MmTqbho94CMGXrpShHARAoJjA2rUbqf/Au2j37qTiQ/gPAo4igBEwR3WnPs589PFX9Onn3+qjHFpBAARAoBwCoSEh9MnHb1OH9m3KKYVTIGA/AgjA7Ndnhlmcl5dPz7/4Jk2fMdewNtEQCIAACFxOwNfXV5mcP4qGDOp7+Sm8BwHbEkAAZtuu09fwzMwseuTxUcSPASAgAAIgYAUCnLD1XyMfQtJWK3QGbNBMAAGYZoTOU5CSepjuu/9J2n8g2XnOwSMQAAFbE+h1683KPpIvUWBAgK39gPEggAAM18AlBLZsTaQHHnqKTp3KuOQ43oAACICAVQi0atmMRn/2DkVEVLKKSbADBLwmgFWQXiNzboUFv/1Bw+98GMGXc7sYnoGAIwis37CZBg+7l5IPpTrCHzghJwEEYHL2+xVe/zR2givBam5u7hXncAAEQAAErEbg4MEUGjL0XmxfZLWOgT0eE8AjSI9RObfgF1/+QO//b7RzHYRnIAACjiXAaSq+/uoD4seSEBCwEwEEYHbqLR1s5cCLAzAICIAACNiVQFBQoDIn7F3kCrNrB0pqNwIwSTv+woUL9Obb/6Mfx4yXlADcBgEQcBIB3sibty7q2vUGJ7kFXxxMAAGYgzu3LNeKioroxZfepomTZ5RVBMdBAARAwHYEOGHre++8QpyqAgICVieAAMzqPSTYvoKCAnpm1Ks0a/YCwZqhDgRAAATMJ+Dj40NvvP4csuab3xWwwA0BBGBuADnpdG5eHv1z5Av0+6KlTnILvoAACIDAFQRefP5fdNeIoVccxwEQsAoBBGBW6Qmd7Th/PoceeezftHzFGp1bgnoQAAEQsAaBp558mHj7IggIWJEA8oBZsVcE28QjXwi+BEOFOhAAAcsT4FXeX30zxvJ2wkA5CSAAc3i/85wvfuyIkS+HdzTcAwEQKJXAu+99RmN/mVTqORwEATMJIAAzk77ObfNqR55wjzlfOoOGehAAAUsTePW1d2nK1NmWthHGyUcAAZhD+5zzfHGqCax2dGgHwy0QAAGvCDz3whs0d97vXtVBYRDQkwACMD3pmqibk6wiz5eJHYCmQQAELEWAnwj86+mXaPEfyy1lF4yRlwACMAf2PU88RYZ7B3YsXAIBENBEoKCgkB574jlatXqdJj2oDAIiCCAAE0HRQjp4X0fs7WihDoEpIAACliKQp6wKf/Dhp2njxq2WsgvGyEcAAZiD+vynsROIR78gIAACIAACZRPgvIj3PjCSEnfsLrsQzoCAzgSQiFVnwEapX/DbH8rQ+rPEk+8hIAACIAAC7glUqRJNkyd8TzEx1dwXRgkQEEwAAZhgoGao27I1kYbf+TDl5uaa0TzaBAEQAAHbEqhfvy6N//VrCgsNta0PMNyeBPAI0p799pfVKamH6YGHnkLw9RcRvAABEAABzwns3bufHlcm5nPSaggIGEkAAZiRtAW3lZmZRffd/ySdOpUhWDPUgQAIgIA8BFasXEsvvfxfeRyGp5YggADMEt3gvRF5efn0yOOjaP+BZO8rowYIgAAIgMAlBCZNnkmfj/7+kmN4AwJ6EkAApiddHXU//+KbtHbtRh1bgGoQAAEQkIvA/z76gmbMnC+X0/DWNAIIwExDr77hjz7+iqbPmKteAWqCAAiAAAiUSuC551+ndes3lXoOB0FAJAEEYCJpGqCLN5T99PNvDWgJTYAACICAfATy8vPp4Uf/TQcOHJLPeXhsKAGkoTAUt7bGNm3aRsNHPET5+Vito40kaoMACIBA+QTi42NdOcLCwpCeonxSOKuWAEbA1JIzuN6xY+n06BOjEHwZzB3NgQAIyEmAR8CeeuY/xJt4Q0BADwIIwPSgKlhnrrJ3GWe5T08/KVgz1IEACIAACJRFYPEfK+jDj78s6zSOg4AmAgjANOEzpvKrr75Lm7dsN6YxtAICIAACIPAXgdFf/EDz5i/66z1egIAoAgjARJHUSc+48VNp4uQZOmmHWhAAARAAAXcERj33Gu3bf9BdMZwHAa8IYBK+V7iMLZyYuIuGDLuPeFUOBARAAARAwDwCCQnxrkn5FSsGm2cEWnYUAYyAWbQ7s7LOKPO+nkPwZdH+gVkgAAJyEUhKOqBsV/S2XE7DW10JIADTFa865RcuXKBnRr1CqYePqFOAWiAAAiAAAsIJcJb8X36dIlwvFMpJAAGYBfv9m2/H0qLFyy1oGUwCARAAAbkJvPnWB5S4Y7fcEOC9EAKYAyYEozglW7ftoKG33UcFBYXilEITCIAACICAMAJ16tSmaZPHUEhIRWE6oUg+AhgBs1Cfn8nOppFPvoDgy0J9AlNAAARA4HICBw+m0Kuvv3v5YbwHAa8IIADzCpe+hf/z8v9RSirmfelLGdpBAARAQDuBqdPm0PQZ87QrggZpCSAAs0jXT54yi2bNXmARa2AGCIAACICAOwIvv/p/lHwo1V0xnAeBUglgDlipWIw9mJJ6mHr3vYPOnj1nbMNoDQRAAARAQBOBZs2a0LifvyJfX19NelBZPgIYATO5z3mj13+Peg3Bl8n9gOZBAARAQA2BzZu301dfj1FTFXUkJ4AAzOQL4JvvxtL6DZtNtgLNgwAIgAAIqCXw8adfIzWFWngS18MjSBM7f9fuvTRg0N2Un19gohVoGgRAAARAQCuBhHrxNG3KjxQYGKhVFepLQgAjYCZ1NAddTz/zCoIvk/ijWRAAARAQSSBp3wH630dfilQJXQ4ngADMpA4e/eX3tHtPkkmto1kQAAEQAAHRBL77/hfavGW7aLXQ51ACeARpQsfu3p1E/QaOQMJVE9ijSRAAARDQk4DrUeTUMRQYEKBnM9DtAAIYATO4EwsLC2nU868j+DKYO5oDARAAASMI8KPITz/71oim0IbNCSAAM7gDv1Y22k5M3GVwq2gOBEAABEDAKAJff/MTVkUaBdvG7eARpIGddyjlMPXsdRvl5uYa2CqaAgEQAAEQMJpA48ZX0+QJ3yFBq9HgbdQeRsAM7KyXX/k/BF8G8kZTIAACIGAWAX7S8dPYiWY1j3ZtQAABmEGdNHPWfFq+Yo1BraEZEAABEAABswl8+PGXdPTYcbPNQPsWJYAAzICOyco6Q2++/aEBLaEJEAABEAABqxDg/X1fe/09q5gDOyxGwM9i9jjSnPc/+JxOnjzlSN/s4hRnp46OjqLoqCiqGBJCAcoScf7z07iB7vbtiXT4yBG7YICdFiXQrWsXTXOFLly4QHn5eZSXm+ea5nA6M5NOKd85/J/PQcwj8NvCJbRo8XLq0rmDeUagZUsSQACmc7ck7thNv46fqnMrUH85gdDQUIqPr0NxsbEUFxdL4eHhlxcR8j4tLQ0BmBCScitp2vRa1w2BaAqc9ubIkTRKTk6m5EOHKCUlFQGZaMge6HvzrQ+offvWyA3mASuZiiAA07m3efgZd6A6Q/5Tvb+/P13d4Cpq0qSJK+jy8fExpmG0AgIWJeCrjPDWrl3L9deB2tPZs2dpx85dxCO3R48etajVzjOLV8B/++3P9MjD9zjPOXikmgACMNXo3FecNn0Obdy01X1BlNBEIDg4mK5r1ZJatmxBQUFBmnShMgg4mUCI8vidPyv8l5p6mFauWkX79u13ssuW8Y23n+vfryfFxFSzjE0wxFwCCMB04p+dfZbeee9TnbRDLRPw8/Oj9te3o1bKjwnP54KAAAh4TqBWrZo0ZPAgOnbsGC38fREdOpTieWWU9JpATk4uvf1/H9HHH77ldV1UcCYBBGA69esXX/5A6eknddIOtVddVZ+6de1KlSrpM7cLhEFAFgLVqlWj4bffpuzQsYN+X7TY9ZhSFt+N9nPuvN9p/YbN1KplM6ObRnsWJIA0FDp0ypEjR+n7H8fpoBkqeZ5Xn969aOCA/gi+cDmAgEACjRs3ovvvv5fq108QqBWqLifwlpKSCPOCL6ci53sEYDr0+3sffEZ5eXk6aJZbZdWqVekf99xF/EMBAQEQEE8gWJlDOWjgAOqqpMWoUAE/D+IJE23bvpNmzlqgh2rotBkBfMIEd9jWbTvw4RLMlNXVq1uXRtw5nKKUPF4QEAABfQm0vq4VDR0yGHMrdcLMN+nYE1gnuDZSiwBMcGe9/d+PBGuEumuaNKZBgwYQP36EgAAIGEOgTp04uv32YcSrjCFiCaSlHcM0FbFIbakNAZjAblv8x3LXBEuBKqVXxQkqb721Jx6HSH8lAIAZBGKqV6c7ht9O/GgSIpbAV1+PoczMLLFKoc1WBBCACeounlT5/gejBWmDGibAk4F7dL+ZkFAV1wMImEegcuVoGqykq+C0LxBxBM6cySYOwiDyEkAAJqjveVLl7j1JgrRBTc2aNahf3z4Y+cKlAAIWIOD6PPbrYwFLnGXCmLET6PjxE85yCt54TAABmMeoyi5YUFBAH338ZdkFcMYrAjznpH+/vrjj9ooaCoOAvgTqJyRQu3Zt9W1EMu2cnPWzz7+VzGu4W0wAAVgxCQ3/J06aQbzXF0QMgV69elJYWJgYZdACAiAgjMANHTtQrZo1hemDIqIJk6ZTirItFEQ+Aj7K3KUL8rktzuP8/ALqevMA4lUtEO0EeD/Hm2/qpl1RKRoyMjJo/4EDytYrxykj47RrGTiPXmqR7OxsLCfXAhB1XQQ4vYqWuY4VKvi4UkaEhoZS5cqVKbZ2bdcG3LwZt2jJzMykr7/5jvLz80Wrllbf4IF96K03X5DWf1kdRwCmsefHjZ9KL738X41aUJ0JVKxYkR568H4KDAwUBqSwsJC2b0+kDRs3ugIvYYqhCAQsTiAwMICuadKEWik5vSIjIoRau3LValqyZKlQnTIr8/Pzpd/mTaJatWrIjEE63xGAaehyHv3q1n0g8dZDEO0E+NEj/2CIkqSkfbRw4e+Ucfq0KJXQAwK2I8AZ7XlkmR8fitq0nm9seBSMR5UhYggMHqSMgr2BUTAxNO2hBXPANPTT1GmzEXxp4FeyKucbEhV88WPFufPm08RJkxF8lYSM11ISKCoqonXr1tN33/9IR4+KuVnkR5tdOt8oJU+9nObfk8OH0/RSD70WJIAATGWn8I/86C9+UFkb1S4ncP31YlZXnc/JoXHjJ9DmzVsubwLvQUBqAjxaNfbnX4lHhkVI/fr1KTo6WoQq6FAIFBQU0hdf/QgWEhFAAKays+fM/Z1SDx9RWRvVShKIjo5Skq7WL3lI1WveAH3C+ImUkpKqqj4qgYDTCfDE+clTptK+/fs1u8qLBtq2aa1ZDxT8TWDKlFmUnn7y7wN45WgCCMBUdi8yGKsEV0q1Nq1ba1oBxip5Me+06TPoSBqG8EtBjEMg8BcBfiQ5Zco0JQHo8b+OqX3RuHEjCgkJUVsd9S4jkKcEyD+OGXfZUbx1KgEEYCp6dsnSlch6r4JbaVV4e5Orr25Q2imvjq1avYb27dN+V+9VoygMAjYlwFMopkydTjxqrEV4LljjRg21qEDdywj8/OtkOqOkt4E4nwACMBV9/CWe06ugVnoVzq6tNe3EiRMnadmy5aU3gKMgAAKlEuA5YUuXLiv1nDcHGyEA8waX27LZ2Wfp13FT3JZDAfsTQADmZR9u3rKd1q3f7GUtFC+LQKPG2u+ef1u4kPixCgQEQMA7Aus3bFTmHKV7V+my0jExMRQZGXnZUbzVQuCHH8cpo5NIdKuFoR3qIgDzspf4gwERQ4AfX9SNj9ek7NChFDp4MFmTDlQGAVkJ8NzJZctXaHY/IaGeZh1Q8DcBnog/Z97Cvw/glSMJIADzolvTjh6jefMXeVEDRcsjwHfOPAdMi6xes0ZLddQFAekJ7N69R3NC1djataTnKBoAbvZFE7WePgRgXvTJzz9PIs4ADRFDIDa2tiZFWVlZmHiviSAqg8BFApu3bNWEopay9yRELIHExF20fgOmu4ilai1tCMA87I/z55UEnxOmeVgaxTwhUFvjXfPOXbs9aQZlQAAE3BDYuXOnmxLln64YHKwkZY0qvxDOek0Ao2BeI7NVBQRgHnbXjJnzKDMzy8PSKOYJgSqVK3tSrMwySUlJZZ7DCRAAAc8J8Heb1sn4lTV+nj23Vp6Svy1cgu3uHNzdCMA87NxflNwsEHEEeO5XaGioaoX8KDg19bDq+qgIAiBwKYFkZUGLFsFKSC30Sq/Lq7vHTZha+kkctT0BBGAedCGnntixc48HJVHEUwL8Zc1bmagVzuKN1BNq6aEeCFxJIE3jLhJRSEVxJVQBRyZOmkH5+QUCNEGF1QggAPOgRzD65QEkL4tERER4WePS4sfTT1x6AO9AAAQ0EdD6CDIiopKm9lG5dAInTpyihb8vKf0kjtqaAAIwN93HcyN4422IWAJBQYGaFGZlZmqqj8ogAAKXEtA6xzUwMOhShXgnjMAvvyIzvjCYFlKEAMxNZ0ydNodyc3PdlMJpbwkE+Pt7W+WS8tgr7RIceAMCmgnk5OQQ7xGpVvwDtH2m1bYrQ73Va9bTgQOHZHBVKh8RgLnp7kmTZ7opgdNqCPgHBKip9ledfGzT8RcLvAABUQTy8tVvf6P1pkqUD07VM3kKfouc1rcIwMrp0e3bd9LuPUh1UA4i1ae0flnna7hTV200KoKAwwkUaJjs7e+v7abK4Wg1uzd1+hwkAtdM0VoKEICV0x+Tpswq5yxOaSGgZQWkq11lDzsICICAWAK8N6RaqVBB/apmtW3KVO/48RO0fAW2XnNSnyMAK6M3c/PyaOas+WWcxWEQAAEQAAEQMJYApsQYy1vv1hCAlUH499+XUlbWmTLO4jAIgAAIgAAIGEvg90VL6fRprAA3lrp+rSEAK4PtdGXrIQgIeEMg2KcCxfgGuP74NQQEQAAERBLghKxz5yEtkkimZuryM7Nxq7bN+XCWLVtlVfNgl4UItAkKp96hVait8r+W/6V5kFLzc2h1ThbNzE6nNcp/CAiAAAhoJcBTY24bNkCrGtS3AAEEYKV0At9hYOuHUsDg0F8EmgeG0gvR8dRE+V+WcEA2iP/CqtK23Gx66+QB2qT8h4AACICAWgLr1m+mtKPHKKZ6NbUqUM8iBBCAldIRmHxfChQc+ovAXeEx9O+oOPL1Yi/La5RAbWxME3rnVDL9mJX2ly41L/r07k4dO7RVUxV1TCKQlHSAvvx6jEmto1mnEZg1awHdf9+dTnNLOn8QgF3W5XxnsXbdpsuO4i0IXCTwfFQdGlEpRhUODtiei65DNf0C6a1TB1Xp4ErXNGlE/fr2VF0fFY0nsGr1OgRgxmN3bIs8SIAAzP7di5nCl/Xh/PmLLzuCtyBwkcDtYdVUB18lGXIAx7ogIAACIKCGwM5deyk5OUVNVdSxEAEEYJd1xvwFCMAuQ4K3CoGr/CvS88qcL1HCulgnBARAAATUEJiH3yo12CxVBwFYie44ceIkbdi4pcQRvASBiwRGRceRnxdzvtxxY12sEwICIAACagjMn79ITTXUsRABBGAlOmPBb0tIy1YcJVThpYMI1PcPpvbBEcI9Yp0Jim4ICIAACHhLYJuyV/GRI0e9rYbyFiKAAKxEZ8xfgDuKEjjw8k8Ct4RU1o1FTx1162Y0FIMACFiCwPzfMGXGEh2h0ggEYH+CO3Mmm9as3agSI6o5mcB1SpJVvURP3XrZDL0gAALWILBw4RJrGAIrVBFAAPYntqVK5vvCwkJVEFHJ2QTqBuj3mFBP3c7uFXgHAiCwYeNW7Fls48sAAdifnbd48XIbdyNM15NApQr6pcvTU7eeTKAbBEDAfAI8aMCDBxB7EkAApvQbX8RLlq20Zw/Cat0JFF64oFsbeurWzWgoBgEQsAyBxX9g8MAyneGlIQjAFGCbt2yn06exWbKX1440xdML83TzVU/duhkNxSAAApYhsGQpps9YpjO8NAQBmAJs8R8rvMSG4jIR2J13Tjd39dStm9FQDAIgYBkCmZlZrkEEyxgEQzwmgABMQbVi5RqPgaGgfARWns/UzWk9detmNBSDAAhYisDy5fgNs1SHeGiM9AFYRkYmJSbu9hAXislIYM7ZE5R3oUi466yTdUNAAARAQAuB5RhE0ILPtLrSB2CrVq9D9nvTLj97NJxRVEATzhwTbizrZN0QEAABENBCYOvWHcS5LCH2IiB9ALZ8BYZu7XXJmmPtJxmpdKxA3GR81sU6ISAAAiCglUBRURGtXrNeqxrUN5iAfgmODHZEbXMrVq5VWxX1JCKQqYxUPXZsN42NaUyBFbTdt+QqX5asi3Wqkbz8PDp37ryaqqhjEoGcnFyTWkazshBYsWIt3dStkyzuOsJPqQOw1NQj2MzUEZexMU5sy8umJ9P30PtV6lNwBV9VjZ4vKqSn0vcS61Ir7773GfEfBARAAASKCWArvWIS9vmv7VbePn6Waum69ZtKPY6DIFAWgUXnMuj2tO10ON/7EQ2uw3VZBwQEQAAERBJI2neATp7Cd4tIpnrrkjoAW7sOAZjeF5gT9e9U8oL1OryZPstIoaxC948RuQyX5TpcFwICIAACehBYv36zHmqhUycCUj+CRACm01UlgdrzSgqJT06n0peZh+nG4EhqG1yJEvyDKcrX3+X9qcJ8Sso/T6uVHGJLzmcoaSz0285IAtxwEQRAwAMCa9dtpO43d/agJIpYgYC0AdixY+l06FCqFfoANtiYAAdWv5075fqzsRswHQRAwAEE1uGpjq16UdpHkBs3bbVVR8FYEAABEAABECiPwK7dSZSdfba8IjhnIQLSBmCbNm+zUDfAFBAAARAAARDQRuCCMiK/bfsObUpQ2zAC0j6C3Lxlu2GQzW7Iz09sNxcUuJ947tZnHx+3RVAABEBATgI+yveDr6+6VC+lEePApLCwsLRTjju2efN2atf2Osf55USHxP4y24RQfn6BNPs/3nBDR2p/fTthPbN58xaaO2++dn2YlK6dITSAgEMJBAYG0B3Dh1OVKpWFeMg3jeMnTFTm/aYI0WdlJTINLli5HzyxTcpHkLt27aW8PHHbyngC2owyLVo0Fxp87dmzl+bNX2CGK2gTBEBAIgK8c8D4CRMoKytLiNf8FGDQwAFUtWoVIfqsrGTzlkQrmwfbShCQMgDbstX5jx8bNLiKbr6pW4mu1vYyJSWVpk2fgY3LtWFEbRAAAQ8J8ObS48ZPoPPnxWy7FRgYSEOHDKZKlSp5aIE9i51SkrGmpB62p/GSWS1lAJa4Y7ejuzk2Npb69O5FPI9ChKSnn6BJkydLM4dCBDPoAAEQ0E7g5MlTNHHiZMrPz9euTNEQGhpKw4YOpuDgYCH6rKokMdHZv3FW5e6tXVIGYDscHIDxEPuggf1J1MR7fgTAd6HYTNjbjxbKgwAIiCBw+MgRmjZtBhUpm9iLkKioKBoyZBD5+19MmixCp9V07NiJAMxqfVKaPdIFYHl5+bQ3aX9pLGx/jIfWeYidh9pFCA/9c/CVna1+42gRdkAHCICA3ASS9u0Ts/jnT4w1YmJoQP9+VKGCM38Cd+zYI/cFYxPvnXn1lQOfNyzlVZBOEx5S56F1HmIXITzkz0P//AgAAgIgAAJmE9i6dRst/mOJMDPq1o2nW2+9RZg+KynCCJiVeqNsW6QLwJz4+JGH0ocqQ+o8tC5CeKh/6rTpxEP/EBAAARCwCoHVq9fQ+vUbhJnTpHFj6tK5kzB9VlGUnn6STpw4aRVzYEcZBKQLwHbt3lsGCnse5iH0AQP6UYwypC5K5s6dR/v2OfMxrShG0AMCIGAOgd8W/k47d+4S1nibNq2J/5wmvC0RxNoEpAvAkpIOWLtHvLSOh9Drxsd7Wavs4jzEv3Wb89N0lE0AZ0AABKxOYMbMWXTwYLIwMzt3upEaN24kTJ8VFDntt84KTEXbgABMNFED9XXp0pl4CF2UrFOG9nmIHwICIAACVibA0yQmT5lKR48eE2Imp+y5tafYm1khhmlQ4tTFZhqQWK6qVAEYJ/Y7djzdcp2gxiDXsHlrcft97di5kxYqQ/sQEAABELADAd7NhLcXyjh9Woi5vPdk//59lekc1YXoM1sJRsDM7gH37UsVgDnlguRRLx4yFyU8lD9z5mxR6qAHBEAABAwhcO7cORo/bgKdPXtWSHsBAQE0ZLCyoCkyUog+M5Xwin+ItQlIFYDtdcDEcp7vxfO+RGW5P3r0qGsoX1SSQ2tf7rAOBEDAaQR4BGzCxEmUm5srxLWKFSvS0KFDKCQkRIg+s5RkZZ0hXg0JsS4BqQKw5IMp1u0JDyzjoXEeIheVPDAjI0MZwp8kxcbkHuBVXYRzOTZpEEn9e8TRvcOucv3xaz7m0DyPqlmhIgjoQYDngk2ZOk3YdmkREZVceRUDAwP0MNcwnQeTDxnWFhrynoCf91XsWyP5UKptjXdtn6EMjfMQuQjhIftx4ycSD+FD1BGIqxVK/xhSn3p2rU2Vwkrvl8wzeTTn9xT6bsJeSk7FjgLqSKMWCLgnwFMpZs2aQ336iNkHt2rVqsq2bgNc35OFhYXuDbBgieTkVLquVXMLWgaTmIBcI2DKxWhHKd5AlofGRQgP1fPI12lBk1dF2GQnHX6+PjTqkWtp7pib6bZ+9coMvtgnDsy4DJflOlwXAgIgoA8B12Ki3xcJUx4bG0t9evcSps9oRXYedDCalRntSTUCdijFfgEYD4Fzlnve51GE8J0cD9UfOyZm+bYIm+ykI7JSAH3yejtq3ayKV2b7+VVwPZq85upIevylVZSRmedV/ZKFRz3zON15x+CSh/Da4gTWrN1I994/0uJWOsM8zpQfqszfateurRCHrr66AXW/+Saav+A3IfqMVJKcbO9pN0ayMqMtaQIw3pbh3LnzZjBW3SYvi+YhcB4KFyEXLlygmbNmC01gKMIuu+ioGOxLYz68kRrUUx8Mc+DGOoY+sojOnVf3WMPPz0/Yhut2YW93O/39pfmqtURX/bFkKYUo++Jee00TIfa0aNHctdJy+YqVQvQZpQQjYEaRVteONI8gU1KOqCNkYq2+fXoTD4GLkoXK0LzILTxE2WUXPe++2FpT8FXsJwdwrAsCAiCgH4E5c+ZS0r59whro2LEDNWvWVJg+IxSlpBw2ohm0oZKANAHYkbSjKhGZU61795uoQYOrhDW+atVqoZvYCjPMJor63hxLN3WsKcxa1sU6ISAAAvoQ4BH/qVOn0+HD4m6++VFk/fr19TFYB62cfPzsWSy00gGtEJXSBGBpafaZ89Sh/fXUorm4lStbt24jHpKHqCPgq0yc/+e94rZ8KrbiiX80JtYNAQEQ0IdAQUEBTVRyhJ08KSYfFqcA6te3N9WqVUsfg3XQmiZouyYdTJNepTwBmE0uQh7i5qFuUZKUtI/mzJ0nSp04Pcrea3aRjq2rUa0Y8UkZa9cIIdYNAQEQ0I/A+ZwcJZXEBDpz5oyQRngO5uBBA6hy5cpC9OmtxE6DD3qzsJp+eQIwG4yA8dA2D3GLEh56nzptOvFQvNXE10YZSrt2qKEbvi7t9dOtm9FQDAKlEOBFQ1YVzgrPeQ9zlGBMhAQFBbkStYaHh4lQp6sOBGC64tWkXJoA7IjFA7DatWu5hrZFZbnnVZ+8PQcPwVtR/P39NZlVdKFIU31vKjdtFOVNca/K6qnbK0NQGAQUAhc0fK44ABO1RZoenXHixAmaOGmKsO/EsLAwJQgbQsFKMGZlQQBm3d6RJgBLTz9h2V6oUqWyK90ED22LEB5qHz9hgrC7PRE2Xa5Da1LZ/HzjAsta1cU/fizmUVuHR5vFuvEfBLwloPVzpfVz7a293pZPTU2ladNnkqi9b6Ojo2mwskOJqO9ub/3xpPxxC//2eWK/k8tIEYDxI7hTpzIs2Y/h4eFKotXBxEPaIoSH2HmonYfcrSyhYaGazMvPV5/I1NuGg4PEBMaltaun7tLawzEQKI9Afn5+eafdngvT+Ll224CAAnv37hWaVLVmzRquPXqtOvp34uQpAdSgQg8CUgRgmZlZyrCzuqSXekAv1slD18OGDiYeyhYhrhU/kyYTD7VbXXhvSy2i9U7dm7bP5+o32qanbm98RFkQYAJaAzCtn2ujemHz5i20dNlyYc0l1KtHPXveIkyfSEUnTyAAE8lTpC4pAjAr3gG4VtIoWwzxELYI4SH1adNnUGqq9RPv8V1yxeBgTW7n5oqZTOuJEYfT9Mujo6duT3xDGRAoSUDr56qaoF07Stqk1+sVSlb7jRs3CVPPWfc7dbpBmD5Rik6etObTH1H+2VmPFAGY1e4AeKh6QP9+VLOGuBVw8+YvoL17k2xxLdasqS2hKe9nyQkGjZKtO/W7g9RTt1F80I5zCJw+nanJGa2fbU2Nq6jM+zvu2rVbRc3Sq7Rr25ZatWpZ+kmTjp4QlAPNJPMd3awcAZjF5n/xUHW9enWFXVhLly6jLVu2CtOnt6K6dbX5fvr0ab1NvET/opVpl7wX+UZP3SLthC45CGRo/GzxfKjAwEBbwZoxcxYdOnRImM3dunahhg2vFqZPq6KcnFzb7YOs1We71JciAOM5YFaRzp1uFLZBLPu0YeNGWrFylVXcc2sHp9mon1DPbbnyCmi9Sy9Pd2nnlqxKo7Rj4h9Dsk7WDQEBqxDQenNz8fOdYBV3PLKDR9QnTZ5Cx48f96i8u0L8hKN3r1upTp04d0UNO5+ZZZ3fQMOctkFDUgRgWQY+riqvz69Thqbbtm1TXhGvzvHQ+YIFC72qY3bh+vUTSOtS9fT0dEPdKCi8QJ/+uEN4m5/8sINYNwQErEJAxGeradNrrOKOx3bk5ua5Vo+LurnjnGg8zaR6dWvsdJGVae1V8R53lMMKyhGAWWAErFHDhtRVGZoWJcnJh4iHzu0mbVq31mwy+260TJx1kJauEbehO+uaNPug0W6gPRAolwDPrTyVoW3SdmxsrBJ4VC+3HSuePHv2LI1Xtiw6d07MaDc/ih2i5AiLiIgw3d0sQdswme6IwwzQL8GRhUCZPQLGQ9G9evUUliX62LHjNHnKFOKhcztJgvLokeeIaBFe7ZmiJFM0Q0a+spomftGF6sWFa2p+X3IWsS61smVrotL/9gu+1frrhHpJ+w7Yxo1Dyg1OVGSkJns73XiDa/9FTUpMqMzBJ+8gcvttwyggIECzBSEhITRs2BAaM2assMBOjVFZWcYtWlJjn6x15AjATExKykPQAwf0J1H7pPEQ+fgJE4mHzO0kvPXQTd26aTb5SFqa5lxFao3IPltAI0Yupc/fvJ7UbiG0ZccpeuSFlcS61Mqs2QuI/yAgoAcBHmFu1qypJtXx8XVcE9F37tylSY8ZldPSjtLUqdNpkLLhtojv7UhlBIyTbf/8y6+Ul2fO97aojcjN6A8ntynFI0gjUxaUvFj4g8dD0CLupFgvD43zEDkPldtNet7SQxmKr6TZ7F0mf6Gnn8yh4U/8Qb9M26dsZ+L5/C0uy3W4LuuAgIBVCSTt2yfkJqdH9+7E34F2lP0HDtDsOXOVvTE9/4yX52fxjbiovX7La6u0c2b9BpZmC479TUCKAIy35zFaeKL5UGXomYegRQjfOU2YMEnz/AwRtniro3PnTtSoUUNvq11RnjP9J+7YecVxow/k5RXRKx9sor7/WEjT5ifT+ZyyR7P4HJfhslyH60JAwMoE+Ltm127tubGCggJd34Ghodq2HTOLVWLiDlq8+A9hzfNUlN69bxWmzxtF5034DfTGPlnLSvEIkvOgGCk84sVDzqLu/niu15Sp0yjtqLhJ4Ebw4OH7Ht1vpmuvFbMqioMvURNkRfi/e38m/fvNdfTiuxuoacMoqh8fTpGVLuZAysjMpb0HsmiLksQVQZcI2tBhJIF169bTNU2aaG6SvwPvGnGHkuZhKh07dkyzPqMVrFm7jkKUALJN6+uENM2Lsc6dPUe/LfxdiD5PleScN/Y30FO7ZC8nRQBmZPTPQ8w850vU8mMeAueh8AMHDtrqWq0bH0/dbupK0Rr3fCx2moPQlStXFr+11H8OsNZtOeH6s5RhMAYEVBLghT579uyhq666SqWGv6uFh4e7grA1a9bS6jVrbDd/ddGixcqTjIrUpHHjv53S8Ioz5WdnZ9Oq1Ws0aPGuqtGDEN5ZJ29pKQIwI6P/Pr17CU3At0gZAuehcKsLB56VK0dTvBJ4NVYeN1arJjb/zbr1G0hUjh6rs4R9IGAFAosXLyHetYL3rdUqPBp+/fXtqGXLFrRDGcnes3cv8WT38+fPa1VtSP3Zs+cq+9dWVHjEC2mvk5KQm+fybt22XYg+d0qMHIRwZwvO/01A+yfrb12WfZVj0MbNN93UTegWFHzHuFYZAreyNG/ejDp2aE/Byubaek0wPXnqFC1bttzKGGAbCDiOAKdkWKp87rooczhFCefG4u8M/mPh+bkZSjs//PiTqCZ00cPpb3gayO23D6MaMTFC2rhFWZh07tx54kUPeosZ86D19skJ+qWYhJ+Xl697X7Vrp2zCqtzdiZLt2xOJR7+sLkHKFyovNNAr+OIJwVOVLz6egA8BARAwlgDfBO5NStKt0aCgIAoLC9NNv0jF+fn5FxdCKTeEIoS/M/v160M1a2jLjeiJLWalv/DENpnLSBGA6Z2wlCeZc+JBUbJ//8Ul0KL02VUP9xvn40lPP2FXF2A3CNiewPTpM+nwkSO290OEA/zIdNz4ia45XCL0cX7EwYMHUnR0lAh1ZeooLMTq6zLhmHgCAZhG+Jzd/ZYe3TVq+bs6JxrloW4e8pZZ+I5tsrJyivPxQEAABMwjwCM/45Wg49ChQ+YZYaGWMzOLk2GLWVnI0zeGDR2ijATql65D9t8TC10+l5giRQBWpFP0z9vq9OvbR9jjN57rxLm++AtPZjl58iT9NPZn2rd/v8wY4DsIWIZAbm4u/TpuAm3YsNEyNplpyPHj6UpqjSnCpkbwStGhQ4YQ507TQ/R+CqSHzTLolCIAK9RhNCk6OpoGDxpIPIQsQnhZMme5t8uqIBE+X66DvyRWK0uzv/9hDPEXHAQEQMA6BHgUZcFvC117PJ4SNA/KOt55b8mhQyk0Y+YsYdnyq1Sp7PpNEbHq9HJvCpTvVoj1CMgRgOlw8XXr1sW18k9Uly5bvoIyM7NEqbOdni1bttJXX39Di/9YIv0IoO06DwZLRYBzEn79zXc0Z+48YXOh7Apw9+49Qhcp1KpVi5o1vVY4Dr2eAgk3VDKFUgRgPj4+wrt17tz5JHKDU84Lw3m0ZJW4uDglf1od0qOvZGUKv0FALwL8BCChXj1hW63pZafeepsqwdJV9esLa4ZTUmzYuEmYvmJFFSqI/w0s1o3/6glIEYD5+op3Mysri8Yr87V4boQICVaWY/McALvum6aVAW/UzYsZ/nHPXcouAtW1qkN9EAABHQjw47GbunV1fU6vuqq+1DdMvACLt1oTJbwAa9q0GcIeaZa0q0IF35Jv8doiBMRHJhZxrKQZel186enpNHnKNBI1wTE8PMy1hyTvJSmrVK1alUbcOVxoTjVZWcJvEBBJIDIyku65ewTxVjp65f0Taa+eujgZq8gFWJz0duLEybpNv9BjEEJPvrLoliIA0/PiS05Oplmz5wi7a6latQoNGjhA6i843raEdxXo2qWzLJ9D+AkCliYQo4xKj1A21a5cubKl7TTCOA5EOXeXqAVY586dc6X54P96iewBs15cteqVJADTd/h1h7K3GU8eFyVxcbHUu/etotTZVk/r1tcJTXBrWxAwHARMJMBB19BhQ5S9EINNtMIaTVesWFF5SjGI+L8I4XyHPPJ1+vRpEerK1ME3tRDrEUAAJqhPeMuO9QJz5DRq2JC6YASIeIunxo0bCeolqAEBEPCGAOelGjRoAPEcVdmlOGs9j4CJEE7rwbsM8NwvvQUBmN6E1emXYjNu3q8wUx0fr2r9puTICVX2Rbz66gZe1SurcBtlBIhXWq5bt76sIqYfP3r0GG3Zus3lNz8+1WNfN57ompp6WEnTYUQvmo4UBoCAZQh0Vz57kRERwu3hZNO8xRhvxM0LmqwuvDq7f/++wjbiZn/nzV9gyEbc3FZgoLzzitl/q4oUAVigTtmFS+tUTswXElKRateuXdppr4/xPCgOwnbt2u11XSMqHDh4kPivWHh5ehNlxKp5i+bC7pp5UQIHYeMnTCxuBv9BAAR0JlCvXl3ikXiRsm/fftq4aRNxLjFRi5dE2leWLl6hXa9u3bJOe32c8z5y7kOjJDgYI5hGsfamHSkeQRo5fM5fKpOUPQxPnDjpTT+UWZbvvHr3ulUJ6GqVWcZKJ3gboSVLl9Ho0V/QRoH5bOrWjac6deKs5CpsAQFHE+jcqZMw//j78KeffqYJEydRUtI+WwVfN3TsQJzvS5Rw4LVcCcCMlCA8QjYSt8dtSTECZnT0n5OT4xqt4XQKIh7Jce6dgcrKyLHK/oiiAjuPrxCVBXNz82j+gt8oWdnAlwNIEdtrXN+uHR08mKzSIn2q+Si3MFWbhVLVa0MpPC6IAsMvfqRyswooKzmHjm/NpuObs+mC3Hur6wMfWnUjwDm+eGscEbJnzx5ly57ZuqVYEGFjWTo48Grf/vqyTnt9nEcA586b73U9rRX02mNSq12y15ciADPyEWTxBcXzGvhu747htyvP3wOLD6v+fzFR62D6ccxYW23/wY9O8/PylQCyP2mdCMqrQ/lHgeeOmC0V/Hyofr/KVL9vZQqKLH0/0JjrwqnBoKqUk5FPe6efoL3TTlBRwQWzTUf7IOCWwHVKri8Rwlv1TJ02XViaHhE2eapDj0SrZrEw8imQp3xRjkiKAKyiSc+/eUPpKVOn0ZDBgzQHH3yxhoeHu5ZA/zT2F+Lly3aRffv306JFi125vbTa3KRJE1q8+A+tajTVD6sdSNe/WIfCanoWWHOAds3dMVTnpiha+cZBOpOibfeEhHrxyiPpGpp8QGVjCWRkZNLmLduNbVRla/w9I2IOK3//idysWqU7qqrFxFQXmmg1Q0kzoWeiVXdOBiOFiDtEppyXIgALDwszBS43yo/MZs+Z63oMJ2KfQ84UP0gZTRo3fiLxMma7CKfoSEhIoPj4OppMvqp+gqkBWLUWodT22Tjyr+h9Xh0O2Lq8n0Cr/5tMxzZmq+YwdEg/uvuuYarro6LxBFatXkcj7n7M+IZVtFhf+Yxp/a5ypViYMZMKCgpUWGBuFV71yTfNdkq06o5YeHiouyI4bwIBKSbhhylb/JgpiYk7BCdqjXMFdGb6pKbtBcqcMK1BY1RUlGn7ZVaKD6J2z9dRFXwV8+LAjXWwLggIWJFAXGysZrM2KDdcJ06YP1XAW0dciVY56aygRKucboOnonC6DTOFt7mDWI+AFAGYFaJ/4YlaG9kvUSvvd8a7BmgVET8Q3trgV7ECtX+pDvkFaf/IsA6XLkUnBASsRqB2rLYUOjzqtWr1Gqu55daevxKtCsp7xjebvLl2WtpRt23rXSAsDCNgejNWo1+KX4BKypwGKwgnauVJqaKEE7Xyxrh2kvUbNmg2t3as8Sk5Gt1WjSpWFZfMkHWxTggIWIkAbzukdcshXnhz9uxZK7nl1hZXotV+9k206s5BjIC5I2TOeSkCMCtF/9OVeREpKanCertb1y7CMu8LM6ocRXw3qDWVRrTyGNJI8Q/1pXo9o4U3yTpZNwQErEIgOlr7Z2vrNnssNijJ3JVoVUk8K0qMTrTqzm4z50G7s03m81IEYBER1hgB4wvtYqLWKcQJS0VIcaLWWrWMHxVSa//epL1qq7rqRUSI2YvNUyNqd6xEvoHiPyqsk3VDQMAqBCI0Pn7LycmlQ0ruPztJR9GJVpWt2YxOtOqOd6VK1vkNdGerTOfF/6pYkF5lZXscKwknauVVjNnZ6lfClfSHk5zyhrm8TOrcCwAALr5JREFUDZAdRGsyVR7R1JpTzBtO1VroN4FVT93e+IiyIMAEtO77mJKSYqucX5xotYPoRKtz51nqYuLHjwEBpecqtJShEhojRQAWXVn7sLroa4MTtfLehrm52nJCFdvFifaGDR1s2grBYjs8+X/kSJqmL2ke9ROxw4AntnKZiPhgT4t6XU5P3V4bgwrSE+AcYFrk8OHDWqobWjehXj3XHrOiGj2SlmbJpLOVBTxWFsUIei4lIEcAFmXsI6tLEZf9rjhRq6hNaYsTtfLm1VYWTiKblXVGk4lG3tEFRemXLk9P3ZoAo7KUBLR+rrTO7zQKuivRar8+VKGCmJ9AsxOtlsctOtqav3/l2SzLOTFXn8VphYRUJKvuheVK1Dp7rqYRoZL4ixO1ivpiKalb5GuteXH8/YwbUvfx9RHp+iW69NR9SUN4AwIeEPDz1/a5OpVxyoNWzC0SGRkpPtHquAl07tw5cx0ro/XKle0xNaUM8x19WIoAjHvQavPASl5ViTvEJ2rt1atnySYs9zr7rLb5b/4GzmnIzy7UjZ+eunUzGoodSyBAYwBm9fQTrkSrQwYJTbTKWwzxCJhVRcTKVqv6Zne7pAnAqlWrYum+ciVqXa89R1axk40bNaIunTsVv7Xc/5zzOZps4oUHRsmZVDHz9EqzV0/dpbWHYyBQHgEtn6sLFy4Qr4K0qnCi1SGDBxKPgImQ4kSrPPfLymL13z4rs9PbNmkCsJgY6ye9/G3h72ITtbZpbdlErVr3iPMh/R4LXv6hS9+ubbTucn0l3+upu2Q7eA0CnhFQ/7kSNZfVMzu9K8ULd/opc75iYmK8q1hO6fnK1mpJ+/aVU8Iap2KqW/+3zxqkjLdCngDMJhchJ2pNTRWbqLVBg6uMv7LctKh1T0g36oWeTl2eKVRfSWV66i7ZDl6DgN4ErPyZ5kSrvOpRlHCi1c2bt4hSp6seOww+6ArAwsqlCcBq1LDHXQDfRU6cJDZRa5/evchOiVqt9nnJPJBDx7eKHwVjnawbAgIgoB+Bjh3aE+f7EiVbLJhotTzfYmKqlnca50wkIE0AZqdhWNkTtZr4eSiz6a3fKbnLii6Ued7bE6yLdUJAAAT0I+BKtKoEYKJk3779NNdiiVbd+Va9mj0GH9z54cTz8gRgNarbqv8uJmqdJGWiVit21Omk87T1e3EBE+tinRAQAAF9CNRT9nbs0f1mYcrTLJpotTwHq1atTP7+xi1YKs8WnLuSgDQ9E1u75pXeW/zI8ePHacrUaa6cNSK23ilO1PrT2F+Ik6FCvCOwd+oJCq8VSPHdteXVOTD/JLEutTJu/FRavmKN2uqoZwKBjAzrpikwAYfuTXKi1f79+gpNtDpBSTeRn5+vu+0iG4itbZ89gkX6bRdd0gRgoaEhFKVkxD91KsMufeOy05Wodc5c6t3rVuKVPFqFE7UOHNDftQ2SlSfNavVTr/obPjlMZ4/nU+M7qnndH7xMP3HsMdo1/rgm8/btP0j8BwEBELiSAO9nOWTwIGXkR1tS2WLNnGB1vLJ3r1UTrRbbWdr/uDgEYKVxscoxaR5BMnC7XoyJiWITtdapE0dWT9RqlQ9IaXZwALXsxQOUdcjzCfRclutoDb5KswfHQAAELhJwJVpV9sTl/yKER7xciVYz7HXjXuw7RsCKSVjzvzQjYIw/LrY2bdq0zZo94cYqTtTKjxBbtWzhpqRnpzlRa/aZbFq0+A/PKqDUJQSOb8mmBY/uoZjrwij2xkiq0jSUgiIu/TjlnC6gdKXcoSUZlLZW296XlzSONyAAAlcQ4BGvwRImWr0CRIkDdh10KOGCo19e+ovhaFeJYmPtNw+sZJf89ttCCgsNJVF5vdooiVp5sv/6DRtLNoPXnhJQFkVyYFUcXAWE+1Jg+MWPVG5WAeVl6beFkacmohwIyECgONFqDQkTrZbXv3GxeARZHh+zz0n1CLJufJzZvDW3LzxRa7euwgI6zc7ZXAEHXLy1EP8h+LJ5Z8J8WxEQnWh1uY0SrZbXUXXqxJZ3GudMJiBVAJZQL95k3NqbR6JW7QyhAQRAwDkE9Ei0ypnu7S7Vq1clXnwGsS4BqQKweGUErEIF+7uMRK3W/UDBMhAAAeMIINFq2awTEuw/4FC2d844Y/9oxIt+CAjwt+1KyMvdRKLWy4ngPQiAgEwEkGi1/N6un1C3/AI4azoBqQIwpu2Ex5DFV01xolZ+LClCihO1BgQEiFAHHSAAAiCgCwEkWnWPFSNg7hmZXUK6AKx+fWfdFRQnauUknyKkOFGrEx7ViuABHSAAAtYigESrnvUHRsA842RmKekCsIZXX2Umb13a5kStfyxZKkw3ErUKQwlFIAACAgkg0apnMDktR4OrEjwrjFKmEZAuAGvUqIFpsPVsePXqNULzeXGi1s6dO+lpMnSDAAiAgMcEkGjVY1QUr6SfqFgx2PMKKGkKAekCsNq1ajh2aS4nat29e4+wC6mtkqhVVOZ9YUZBEQiAgHQEkGjVuy536kCDdxSsX1q6AIw/yI0aOu8xZPGlhkStxSTwHwRAwCkEhCdaXbGSNm/e4hQ8V/jh5N+4K5y18QHpAjDuq0YNnfkYkn1DolamAAEBEHAKgQ4d2hPn+xIlW7Zuo2XLlotSZ0k9GAGzZLdcYZSUAViTJg2vAOGkA0jU6qTehC8gIC8BDrw4070o2bdvP82dO0+UOsvqaezQuc6WBa7SMCkDsGZNG6vEZZ9qSNRqn76CpSAAAlcSQKLVK5l4cqROndoUEVHJk6IoYzIBP5PbN6X5uLjaFKlcoBmnM01p36hGixO1Xt+unbAmeWL+wt8XadenzMWDgAAIgEBpBIKDg6lF8+aUkpJa2mmvj+Xn59PsOXOJ/ztdmjW9xukuOsY/KQMw7r2mTZsoubPsv+GquyuRE7Xyn+VEUOJYy/kFg0AABDQTOH/+PE2cNFmzHhkVNJXgCY9T+lXKR5DcebhInXIJww8QAAEQAIFiAs2VwQWIPQhIG4A1w0VqjysUVoIACIAACHhEICgokBo0SPCoLAqZT0DaR5DNm11Dvr6+rrQN5ncDLHACAR//IPINuTj5tfBsJl3Iz3GCW/ABBEDAJgR4/pefn7Q/6zbppb/NlLanQkIqEi/V3bptx9808AoEvCRQsV5LqtT8ZgpJaEUBUTGX1M47lUZnk9ZT5qYFdG7fhkvO4Q0IgAAIiCbQunVz0SqhT0cC0gZgzLR16xYIwHS8uJysOjjuGqre90kKrnV1mW5yQBbQujdFKn/nU3bS0Rkf0vnkbWWWxwkQAAEQ0EKgdSsEYFr4GV1X6gDsOuVi/ebbsUYzR3s2JxDVcShVu/Ux8qng67EnwbUbUp2HP6djsz+lU8vGe1yvtIJ9endXklO2Le0UjlmUQFLSAfry6zEWtQ5mOYGAv78fNWuGCfh26kupA7BWLZsS7w15ASkR7HTNmmprtT4jKbrDEFU2cMBWvfc/yT8yho4po2Fq5Zomjahf355qq6OeCQRWrV6HAMwE7jI1ee01jSkwMFAml23vq7SrILnnwsPDCHtm2f4aNsyByHYDVQdfJY3kAI51QUAABEBAFIF2bVuJUgU9BhGQOgBjxh2ub20QajRjZwKB1etR9T7/FOYC62KdEBAAARAQQaB9e/yWieBopA4EYO3bGMkbbdmUQLVej5OPr7gn9qyLdUJAAARAQCsBXtWP3JZaKRpfX/oArHmLa4mT10FAoCwCgdXqUuhV4u8uWWdgtfiymsVxEAABEPCIQBtlRT/yf3mEylKFpA/AAgMCiFdDQkCgLALhTbuUdUrz8fCmXTXrgAIQAAG5CXTAkxxbXgDSB2Dcax07Ykm/La9eg4yuWFe/AF1P3QbhQTMgAAImE+jQHr9hJneBquYRgCnYOt/YXhU8VJKDQGDVON0c1VO3bkZDMQiAgGUIxMXVpvj4WMvYA0M8J4AATGFVp06s8lfbc2ooKRUB3+Bw3fzVU7duRkMxCICAZQh06dTBMrbAEO8IIAD7k1dnXMTeXTkSlb5QVKibt3rq1s1oKAYBELAMgc6d8QTHMp3hpSEIwP4E1rVzRy/RobgsBArOnNLNVT1162Y0FIMACFiCQGhoCLVqqd8cVUs46WAjEID92bktlW2JwsJCHdzVcE0tgdy0JLVV3dbTU7fbxlEABEDA1gR4T1jeAxJiTwIIwP7sN86hgmfp9ryI9bY6e+9a3ZrQU7duRkMxCICAJQjcfFMnS9gBI9QRQABWgluPHl1KvMNLELhIIGvL71RUkCccB+tk3RAQAAEQ8JZAgL8/dcIKfm+xWao8ArAS3cHDucHBQSWO4CUIEBWePU2n18wQjoJ1sm4ICIAACHhLoEOHNsRzwCD2JYAArETfBQYG4o6iBA+8/JvA8QVfU35m+t8HNL5iXawTAgIgAAJqCHS/GU9s1HCzUh3M3rusN3p070Jz5+Gx0GVYpH9bdP4MpYx5luo89DlV8Ne2d2hRfq5LF+tUI3n5eXTu3Hk1VVHHJAI5ObkmtYxmnUjAz8+XunbByn279y0CsMt6kJ+p82PI8+dzLjuDt7ITyEnZSYd//g/VvP1VqhCg7lF1UV4OHf7lZWJdauXd9z4j/oOAAAjISaD99W2oUiX9EkTLSdV4r/EI8jLmFSsGU7euN1x2FG9B4CKBMzuW0cHPH6K8jDSvkXAdrss6ICAAAiCglkCf3j3UVkU9CxFAAFZKZ/Tu1b2UozgEAhcJ5BzZQ/veG07pv31HhR48RuQyXJbrcF0ICIAACKglEBQUiEECtfAsVg+PIEvpEN5ZPiIinE6fzirlLA6BANGF/BwlqPqGTiweQ6FXt6OQhJYUWK0u+YZEuPDw6sbcY/vpbNIGyt61ii7okMYC/QACICAfgW5dbyR+UgOxPwEEYKX0IWcWvqVHV/p13NRSzuIQCPxNgAOrM9uXuP7+PopXIAACIKAPATyh0YerGVrxCLIM6v369CzjDA6DAAiAAAiAgPEEoiIjiPNVQpxBAAFYGf3YosW1FB8fW8ZZHAYBEAABEAABYwn07XML9n40FrmurSEAKwfvwAG9yzmLUyAAAiAAAiBgHIGBA3oZ1xha0p0AArByEPdT7jYqVACichCpPnXhwgXVdbmiTwUfTfVRGQRA4EoCFTR8roqKtH2mr7QGR0oSaNLkamrQIKHkIby2OQFEF+V0YLVqVfC8vRw+Wk7l5edrqU4B/gGa6qMyCIDAlQT8NXyu8pUdGiD6EcATGf3YmqUZAZgb8oMH9XFTAqfVEMjL0/ZlHRiIAEwNd9QBgfIIBAT4l3e63HNab6rKVS75Sd6nuA/yUzruKkAA5qZLeb+tqlUruymF094SyNcYgIWHYxsOb5mjPAiURyAsLEzTlAutn+nybJP93K09u1F4eJjsGBznPwIwN13q5+dHQwb1dVMKp70loHVz4oiIiwlPvW0X5UEABEonoPUzpfUzXbpVOMoEbr9tIEA4kAACMA86dciQvpruDD1oQroiGaczNPlcvXp1TfVRGQRA4FICMdWrXXrAy3daP9NeNidN8UYNr6Km1zaWxl+ZHEUA5kFv8xdT504dPCiJIp4SyMg4TVpWQkZEVFK246joaXMoBwIg4IZAjRo13JQo/zR/piHiCWD0SzxTq2hEAOZhTwy/HUPAHqLyqFhhYSFlZWnba7Ne3XiP2kIhEACB8gn4+PhQnfg65Rdyc/bUKW2j2m7US3k6LCyUsPWQc7seAZiHfcvbPyTUww++h7g8KnY8Pd2jcmUVql+/flmncBwEQMALArVr16bgoCAvalxZNF3j5/lKjTjCq/Cx8bZzrwMEYF707V0jhnpRGkXdEUg5lOKuSLnnExLqUXBwcLllcBIEQMA9gWuvbeK+UDklzpw5Q6dP4xFkOYi8PsVJwEfcMcTreqhgHwIIwLzoq359b6FKlZD+wAtk5RY9pDEA8/X1paZNry23DZwEARAonwDfxDS8+uryC7k5eyhF282UG/VSnr6p241Us2aMlL7L4jQCMC96OkgZoh82tL8XNVC0PAJHjx2j3Nzc8oq4Pdem9XXK5rTqk0e6bQAFQMDhBNq2aU2cbkeLaL2Z0tK2U+vefdcwp7oGv/4kgADMy0vhjuGDlC8rXy9roXhpBHgV5N69SaWd8vgYr4TkIAwCAiDgPQFOvtqiRXPvK5aoIeJzXEIdXioErmnSkFq1bAYWDieAAMzLDq5erSr1VTbphoghkJi4Q7Oidu3aUlRkpGY9UAACshG4+eZuFBCgbVuv5ORDdPbsWdnQ6ervA/eP0FU/lFuDAAIwFf1w/313qqiFKqUROHDwoOYvb3580qdPL+I5YRAQAAHPCPD8yasErCRO3KH9Jsozi+UoVadObbr5pk5yOCu5lwjAVFwA9erWoW5db1RRE1UuJ8CPL7Zt2375Ya/fx8TEUPebb/K6HiqAgIwEaiifl5tv6qbZdZ7DuWvXbs16oOBvAvffeyd2Xvkbh6NfIQBT2b0PPoAhYpXorqi2dt16KigouOK4twf4jr7TjTd4Ww3lQUAqApUrV6YhQ3guq7aJ9wxt06bNlJeXJxU/PZ2tUiWa+iqr7SFyEEAAprKfmzVtQm3atFRZG9VKEuD5I1u3bSt5SPVrng/G81ogIAACVxKoVasW3XHH7ULy5/FNE988QcQRuPee4RSocU6eOGugSW8CCMA0EH780fs01EbVkgRWr14jZBSMdbZs0YJuv20Y8TYeEBAAgYsEWiurhW+/bajmjPfFPDdv2ap5/maxLvwnZSFRhNI/2PJOpmsBAZiG3m7TugW1vk7bEm4NzTuqamZmFnEQJkri4mLpvnvvVUYpW2Nyviio0GNLAjVqxNCIO++grl06C/ssnDt3jpYtW25LHlY1+r5771BGJrVtB2VV32BX6QR8lEnQF0o/haOeEFi9ej3defejnhRFGTcEeBXjA/ffSxEREW5KeneaH3Fu2ryFdu7cSSdOnPSuMkqDgA0JBAYGUL269ah582YUG1tbuAdz5s6jLcoIGEQMgciISvTHounY91EMTttoQQAmoKtuG/4grd+wWYAmqIiPr0NDhwwmHx8fXWBkZWURZ+DPyDhNuTk5VFBYqKmdffv2K0HdCU06UBkErmvVkipoSKPCnxeeOxQSGkpVq1SmatWq6baSLiUllcb+/As6TSCBp596lB5E7i+BRO2hSvsyGHv4qauVI594gO646xFd25BF+YEDB2nNmrXUtm0bXVwODw8n/hMl55VHMQjARNGUV88NN3TUnBDVCHrnz5+n6TNmGtGUNG1ERUXSHbcPksZfOPo3AcwB+5uF6le8GrJDe30CBtVG2bjiH0uWUurhwzb2AKaDgDMJzJ49l86cOeNM50zy6pGH7qGQkIomtY5mzSSAAEwQ/aeefFiQJqjhaYlTp06nzMxMwAABELAIgaXKpPu9Sdr2brWIK5Yxo0aN6jRsWH/L2ANDjCWAAEwQ7ybK5qk9uncRpA1qsrOzady4CcSrrSAgAALmEti4aROtWLHSXCMc2PoTj92PvF8O7FdPXUIA5ikpD8qN/OeDuk189aB5xxU5lZFB4ydMohxlsjwEBEDAHAI7lNXD8+f/Zk7jDm6Vt7Trh6z3Du5h964hAHPPyOMS/IEaPKiPx+VR0D2Bo0eP0k9jf8G8E/eoUAIEhBPYuHETTZ+OSffCwSoKn1FWPnLqHYi8BBCACe57XhGJCZViofIqwzE/jcVqQ7FYoQ0EyiTA8zCXLl1G8xdg5KtMSBpOtFaSeHftin1rNSB0RFUEYIK7sXLlaHrgPmzULRgrZWWdoR9+/Im2bdsuWjX0gQAIlCBwTkk1MXHSZFqxclWJo3gpksDzo/4pUh102ZQAAjAdOu4f99xG1atX1UGz3Crz8/Np1uw5NGvWbMrNzZUbBrwHAR0IJCcfou+++544wTBEHwL9+vakxo2v1kc5tNqKAAIwHborKCiIkJZCB7B/qty2PZG+/Oob2p6YqF8j0AwCEhHg7bpmzpxNv/w6TplvmS2R58a6GhQUSP968iFjG0VrliWAAEynrunb5xZq1qyJTtqhtvgHgyfoHzp0CEBAAARUEOCR5FWrVis3NF/jhkYFP2+rPPjAXRRTvZq31VDeoQSwFZFOHct7s7384tM0YPA9hP3OdYKsqE1NTaWffxlHNWvWoHZt21K9enWRCkQ/3NDsEAKcZ2+DssJxw4aNeJxvUJ/WrlWD7r/3DoNaQzN2IIAATMde4uSsQwb3VXJZTdOxFahmAocPH6FJk6coK1BDlPkVjahxo0bKPDzcaeLqAIFiAjzaxZnstyuP8A8eTMaNYTEYg/6/8NyTFBgYaFBraMYOBBCA6dxLTz35CM2d97trFZ/OTUG9QoAfTa5du871V7FiRYqLjaW4uFiqUrUKRUdFUXBwMDiBgOMJFBUVUcbp03Tq5CnXvqqHlMn1aUpOPYzGm9P1HTu0RdoJc9BbulUf5QN5wdIWOsC4n3+dTK+8+o4DPLG/CxyAcZ62gIAA15+fr7Z7kGPHjyNJrP0vC9M9qBsfr+nRedGFIuJVwnl5ea5Hipy2hYMwiPkEAvz9adaMXyg+PtZ8Y2CBpQggADOgO/iLcMiw+2jLVqzaMwA3mgABEAAByxB4/LH7iPd8hIDA5QQQgF1ORKf3O3ftof4D76bCwkKdWoBaEAABEAABKxHgUa+Z03/GhttW6hQL2YI0FAZ1RsOrr6J77r7NoNbQDAiAAAiAgNkEXnt5FIIvszvBwu0jADOwc3gYukaN6ga2iKZAAARAAATMINC/X09q27aVGU2jTZsQQABmYEcFBwfRG68+Z2CLaAoEQAAEQMBoAlFRkfTcqJFGN4v2bEYAAZjBHdaxY1saOKCXwa2iORAAARAAAaMIvPKfZygyspJRzaEdmxJAAGZCxz3/7EiqWrWyCS2jSRAAARAAAT0J9OjehW7p0VXPJqDbIQQQgJnQkeHhYcSTMyEgAAIgAALOIRAREU48+gUBAU8IIADzhJIOZbp2vYH69O6ug2aoBAEQAAEQMIPAf5T9f6Ojo8xoGm3akAACMBM77eWXnqHq1aqaaAGaBgEQAAEQEEGAHzv27oWbahEsZdGBRKwm9/SKlWvp7n88brIVaB4EQAAEQEAtAZ7TO1vZbigiAhPv1TKUsR5GwEzu9fbXt6YRdw4x2Qo0DwIgAAIgoJbAf998CcGXWngS10MAZoHOf+apR6lufJwFLIEJIAACIAAC3hAYfttA4vRCEBDwlgAeQXpLTKfyiTt20+Ch/6D8/AKdWoBaEAABEAABkQQS6sXT1Mk/UFBQkEi10CUJAYyAWaSjGzdqQP9+GnPBLNIdMAMEQAAEyiUQEBBAH37wBoKvcinhZHkEEICVR8fgc3ffNYw6d2pvcKtoDgRAAARAwFsCzz37T2rQIMHbaigPAn8RwCPIv1BY48WpjNPUu+9wOn78hDUMghUgAAIgAAKXEOjW9UYa/dk7lxzDGxDwlgACMG+JGVB+zZoNNOKex6ioqMiA1tAECIAACICApwRq1KhO06eMwapHT4GhXJkE8AiyTDTmnWjTpiWNfOIB8wxAyyAAAiAAAlcQ8Pf3o08+ehvB1xVkcEANAQRgaqgZUOehB++mTjdiPpgBqNEECIAACHhE4PlnR9K11zTyqCwKgYA7AgjA3BEy6byPjw+9984rVLNmjEkWoFkQAAEQAIFiAr1uvZnuGD64+C3+g4BmApgDphmhvgq2bdtJw26/n/Ly8/VtCNpBAARAAARKJcD5viZN+I5CQiqWeh4HQUANAYyAqaFmYJ1rrmlIr736rIEtoikQAAEQAIFiAqGhIfT5p+8g+CoGgv/CCCAAE4ZSP0UDB/SiO+/A0Ld+hKEZBEAABK4kwFNB/vf+6xQfH3vlSRwBAY0EEIBpBGhUdZ782bp1C6OaQzsgAAIgID2Bf418CIuhpL8K9AOAAEw/tkI1+/n50ccfvkUxMdWE6oUyEAABEACBKwnc0qMr8Wp0CAjoRQCT8PUiq5Pe3buTlEn5D1D22bM6tQC1IAACICA3AU418fNPo7HPo9yXge7eYwRMd8RiG+C9xz75+G3y9fUVqxjaQAAEQAAEXKl/vvrifQRfuBZ0J4AATHfE4hvo0L6NsjJylHjF0AgCIAACEhMICwulb776H0VHR0lMAa4bRQABmFGkBbczZFBfzE8QzBTqQAAE5CXA2wyNVtJNcM4vCAgYQQABmBGUdWqDV+hwdmYICIAACICANgJvvfEC8T68EBAwigACMKNI69AO56j579svUauWzXTQDpUgAAIgIAeBJx6/n/r17SmHs/DSMgQQgFmmK9QZEhgQQKM/e4fq1KmtTgFqgQAIgIDEBPr360mPP3qfxATgulkEkIbCLPKC200+lEpDht5LpzJOC9YMdSAAAiDgTAJt27Si7775iHj+FwQEjCaAETCjievUXlxsLWX1zocUGhKiUwtQCwIgAALOIdC48dXKHo//h+DLOV1qO08QgNmuy8o2mDfu/vqrD5T8NYFlF8IZEAABEJCcQEJCPH3/zcfEaScgIGAWAQRgZpHXqV2ekD/6s3cpwN9fpxagFgRAAATsSyAurjaN+f4zioysZF8nYLkjCCAAc0Q3XuoEJ2rlfSORLf9SLngHAiAgNwHeS3fM959SlSrRcoOA95YggADMEt0g3oiuXW+g9955hThVBQQEQAAEZCfAQddPP3xGNWpUlx0F/LcIAQRgFukIPczgJK1vvP6cHqqhEwRAAARsQyAiIpx+/O5T4sePEBCwCgEEYFbpCZ3s4C2LXnz+Xzpph1oQAAEQsDaB0NAQ+uHbT6h+/brWNhTWSUcAAZgEXX7XiKH01JMPS+ApXAQBEACBvwkEBwfRt0p6Hk45AQEBqxFAAGa1HtHJnocevJueefpRnbRDLQiAAAhYi0DxyFeLFtdayzBYAwJ/EkAmfMkuhbG/TKJXX3tXMq/hLgiAgEwEeM4XP3bEyJdMvW4/XxGA2a/PNFs8ecosev7FN6moqEizLigAARAAASsR4NWOPOEec76s1CuwpTQCCMBKoyLBsbnzfqd/Pf0SFRQUSuAtXAQBEJCBAOf54lQTWO0oQ2/b30cEYPbvQ9UeLFq8nB7/53OUl5enWgcqggAIgIAVCFzMcP8p8nxZoTNgg0cEEIB5hMm5hVatXkcPPvw0nT+f41wn4RkIgICjCfDejry9EDLcO7qbHeccVkE6rku9c6hd2+tck1V5xRAEBEAABOxGgCfa//LTlwi+7NZxsJcQgOEiIF6mPXbMaHyB4VoAARCwFYG2bVq55nxhY21bdRuM/ZMAAjBcCi4CjRs1oMkTvsfKIVwPIAACtiDQv19P+u6bjygsLNQW9sJIELicAOaAXU5E8vdnsrPp8SeeoxUr10pOAu6DAAhYlcDjj91HTzx2v1XNg10g4BEBBGAeYZKrUEFBAb308n9p0uSZcjkOb0EABCxNwN/fj9564wXq17enpe2EcSDgCQEEYJ5QkrTM56O/p/999IWk3sNtEAABKxHgR42jP32H2rRpaSWzYAsIqCaAAEw1Ojkqzpg5n557/nXKy8+Xw2F4CQIgYDkCNWvG0Ddf/Y8S6sVbzjYYBAJqCSAAU0tOonrr1m+ihx/9N2VmZknkNVwFARCwAoFrr2lEX33xPkVHR1nBHNgAAsIIYBWkMJTOVXRdq+Y0cdy3FB8f61wn4RkIgIDlCNzSo6srRQ6CL8t1DQwSQAAjYAIgyqLizJlseuqZ/9DiP1bI4jL8BAEQMIGAj48P/WvkQ/TQg3eb0DqaBAFjCCAAM4azY1opKiqiDz/+kkZ/8YNjfIIjIAAC1iHAu3L87/3XqdON7a1jFCwBAR0IIADTAaoMKufNX0SjnnuNzp07L4O78BEEQMAAAvXq1qHRn72L6Q4GsEYT5hPAHDDz+8CWFvTo3oWmTPqBeBNcCAiAAAhoJdDr1ptp8sTvEXxpBYn6tiGAETDbdJU1DeURsJdefps4XQUEBEAABLwlwMlVn392JN0xfLC3VVEeBGxNAAGYrbvPOsb/8usUevOtD5AvzDpdAktAwPIEatSoTp989DZxqgkICMhGAAGYbD2uo7+Jibto5FMv0sGDKTq2AtUgAAJOINCt64309psvUEREJSe4Ax9AwGsCCMC8RoYK5RE4e/Ycvfr6uzR12pzyiuEcCICApAQCAgLouWf/SXfcPkhSAnAbBC4SQACGK0EXAtNnzKOXX/0/4oAMAgIgAAJMgLcS+vCDN6hBgwQAAQHpCSAAk/4S0A9A8qFUevrfL9Pmzdv1awSaQQAEbEFg+G0D6dlRT1BQUJAt7IWRIKA3AQRgehOWXH9hYSF99fUY+vjTr6mgoFByGnAfBOQjULVqZfrvmy9Rx45t5XMeHoNAOQQQgJUDB6fEEUjcsZuefuZlStp3QJxSaAIBELA0Ad7L8bVXRmGivaV7CcaZRQABmFnkJWw3NzeX/vfRl/Td97/QhQsXJCQAl0FADgIREeH0nxefpt69usvhMLwEARUEEICpgIYq2ghs3rKdnnv+DYyGacOI2iBgSQK8S8Yr/3mGoqOjLGkfjAIBqxBAAGaVnpDMjty8PPr0s2/p629+Ip4nBgEBELA3gaioSFfgxY8dISAAAu4JIABzzwgldCTAc8NeeOkt4iSuEBAAAXsS6N+vJz03aiRFRiKpqj17EFabQQABmBnU0eYlBHgE7KexE+nDj79E3rBLyOANCFibQHx8LL328ihq27aVtQ2FdSBgQQIIwCzYKbKalHb0GL3+xvv028IlsiKA3yBgCwIB/v704AN30YMP3kWBSmZ7CAiAgPcEEIB5zww1dCawaPFy18beh1IO69wS1IMACHhLoGOHtvTSC08Rj35BQAAE1BNAAKaeHWrqSIAn6X/77c80+v/bu/PYKK4DjuM/vDa7xl5OA+bwQepCAQMmRYbWphBMiHIQokCqQmiKiuilqlXaSlXb/xtVqqrkjxytVHGoDYSCaQoJdyjUNDUQymUgjVsXbOOAbRLbCxgbTN9Mq0ooQWTD7uzOvO9Io/GuZ9/xee+Pn2Zn3/x6tbq7ryexJopGAIFPIlAwdrR+9pNnVVX1pU9yOucggMBdBAhgdwHi36kVaGm5qOd+8YK279ib2oZQOwKWCkQiYffrxlUrlyscDluqQLcRSLwAASzxppSYBIEj7xzTz597XidPnUlC6RSJAAIfJ/DEokf0g2e/pVH5Iz/u37yHAAL3IEAAuwc8PuqtgLN6/tZtu/TLX70o58oYGwIIJEegvPx+/fTH39fkyZ9LTgWUigACIoAxCXwn4DzSaPXaDe5Dvru6Yr5rPw1GIF0FPnNfsX70w+9oftWcdG0i7UIgMAIEsMAMpX0d6ejodEPYut9t5EZ9+4afHidQYPTofH3vu6v0xKKHFQqFElgyRSGAwJ0ECGB3kuF93whcutSmF1/6rTZuel03bvBYI98MHA1NuYDz+KBvf3OFli59kvW8Uj4aNMA2AQKYbSMe4P42NjXr5ZfXaMvrbxDEAjzOdO3eBYYMHqSV5leNy5ctUU7OgHsvkBIQQCBuAQJY3GR8IN0Fmpou6KVXVmvLHwli6T5WtM9bgaFDBpvg9bQJXk9pwIBsbyunNgQQuE2AAHYbBy+CJNDc3KJXfrNW1dXb1NPbG6Su0RcE4hIYPnyYvr5imZ42V7yysyNxfZaTEUAgOQIEsOS4UmoaCbS2tmvtug36/frNisWupFHLaAoCyRUoLi7QqpVf1SJzcz3PbEyuNaUjEK8AASxeMc73rUBXLKb1G6q1xixh4YQyNgSCKjCldKK+seoZLXhwrjIyMoLaTfqFgK8FCGC+Hj4a/2kEenp69eb23Vqz7jXV1Z39NEXwGQTSTsAJWg/On6MVX/uKZny+LO3aR4MQQOB2AQLY7R68skzAecSRc0Vs95796uvrs6z3dDcIAtForp5a8rieWf5ljRkzKghdog8IWCFAALNimOnk3QQuXHhfGzZu0R82/UltbZfvdjr/RyDlApMmjteypYu18LGH+EVjykeDBiAQvwABLH4zPhFggd7eG9qzd79eXV+tv9UeCXBP6ZofBcLhsB59ZL4bvKZNnezHLtBmBBD4nwABjKmAwB0EGhrOa3P1VrOw65tyVttnQyBVAs5DsZcsXqiFjy7QoEEDU9UM6kUAgQQKEMASiElRwRS4efOmag7WatPmrdr71gE5V8nYEEi2gLNo6qLHH9biJx/ThAklya6O8hFAwGMBApjH4FTnb4EPP+zQ9h17tXXbTh0+cszfnaH1aScQiYQ1v2qOe1/X7MpZysrKTLs20iAEEEiMAAEsMY6UYqFAS8tFbXtjlxvGzpx9z0IBupwIgczMkCq+ONMNXc4yEjwiKBGqlIFA+gsQwNJ/jGihDwTOnWvUjl37tHPnWzp56owPWkwTUynQPytLlZUz9dCCeaqaN5v7ulI5GNSNQIoECGApgqfa4Ao4S1rs3L1Pe8zaYu8cPSHnHjI2BHJzcjR79ix3dfq5cyqUm5sDCgIIWCxAALN48Ol68gU6O7t04C9va9+fa7T/wNvq6OhMfqXUkDYCRUUFmje3Ug88UGFWp5/OPV1pMzI0BIHUCxDAUj8GtMASAedK2LHjp1RTU6uav9bqxInTrL4fsLHPyRmgmeX3q7Jiptlnady4woD1kO4ggECiBAhgiZKkHATiFOjqirmLvR48eEi1h46q/p8NcZbA6akWcH6lOHXKZH1h1gxVVJSrbFqpMjP55WKqx4X6EfCDAAHMD6NEG60QaL/8gY6YpS0OHT6qw4f/rrPv1uvWrVtW9N0vnXSWiSibNkXl5dNVPmO6yspK5axOz4YAAgjEK0AAi1eM8xHwSCAWu6ITJ0/ruPna0vnq8tjxOl02IY3NO4Hi4gJNm1rqBq3p5uqWsyAqV7i886cmBIIsQAAL8ujSt8AJNDY1q67uXZ0+Y/bT/3CPra3tgeun1x3q16+fnLA1aeIETZo03j2Wmsf/DB48yOumUB8CCFgiQACzZKDpZnAF2tra3a8r6+sb9F79v+QcnfvJnF9gsn1UID9/hEpKxumzJff9/zhhfAkLoH6UincQQCCJAgSwJOJSNAKpFHCujDX8+7zOn2/SOWc3i8U6x8bGZjk/AAjyNmJEngoLxqqwcIyKCgtUVDTWHMeaq1yFrL8V5IGnbwj4SIAA5qPBoqkIJErgypWrann/oloumN05mscqXWptU1v7ZbW3mb39A/N3u7q7ryeqyoSUE43mKi9vqPKGmT1vmIYOHaL8kcM1alS+2UeafYR5PZL1thKiTSEIIJBMAQJYMnUpGwGfC1y9es1dPNb5OrOzy+ydMXP1rMu9gnatu1vd1667Ic3927zu6ekxK//3ueubOeue3TB7n3ltbrFSRkbI3MAeMscMhUIhdw+H+ys7O6KI+SVhxByzI2bPzlY0muM+nscJXAMHRjUwGnVf9++f5XNRmo8AAgj8V4AAxkxAAAEEEEAAAQQ8FsjwuD6qQwABBBBAAAEErBcggFk/BQBAAAEEEEAAAa8FCGBei1MfAggggAACCFgvQACzfgoAgAACCCCAAAJeCxDAvBanPgQQQAABBBCwXoAAZv0UAAABBBBAAAEEvBYggHktTn0IIIAAAgggYL0AAcz6KQAAAggggAACCHgtQADzWpz6EEAAAQQQQMB6AQKY9VMAAAQQQAABBBDwWoAA5rU49SGAAAIIIICA9QIEMOunAAAIIIAAAggg4LUAAcxrcepDAAEEEEAAAesFCGDWTwEAEEAAAQQQQMBrAQKY1+LUhwACCCCAAALWCxDArJ8CACCAAAIIIICA1wIEMK/FqQ8BBBBAAAEErBcggFk/BQBAAAEEEEAAAa8FCGBei1MfAggggAACCFgvQACzfgoAgAACCCCAAAJeCxDAvBanPgQQQAABBBCwXoAAZv0UAAABBBBAAAEEvBb4D98XPfeO52x/AAAAAElFTkSuQmCC\"\n\t\t},\n\t\t\"cat2.jpg\": {\n\t\t\t\"content_type\": \"image/jpeg\",\n\t\t\t\"digest\": \"md5-jSNf4n/wf51Ra+zemX3Rmw==\",\n\t\t\t\"data\": \"/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAA3AAD/7gAhQWRvYmUAZMAAAAABAwAQAwMGCQAAEQgAACSyAABDAv/bAIQABwUFBQUFBwUFBwoHBgcKDAkHBwkMDgsLDAsLDhEMDAwMDAwRDhAREREQDhUVFxcVFR8fHx8fIyMjIyMjIyMjIwEICAgODQ4bEhIbHhgUGB4jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj/8IAEQgAnwDgAwERAAIRAQMRAf/EAPEAAAIDAQEBAQAAAAAAAAAAAAQFAgMGAQcACAEAAgMBAQEAAAAAAAAAAAAAAwQBAgUABgcQAAICAgEEAgICAgMBAAAAAAECAAMRBBIQIRMFIDEwFCIGQRUyIzMkEQABAgQDBAYGCAYBBAMAAAABEQIAIRIDMUFRYXEiBIGRoTJCE/CxwdFSYhAg4XKCIxQFMPGSwjNDorLSY3NTgyQSAAAEAwYEBQQDAAAAAAAAAAABESEQ8DEgMEBBUWFxgZECscHR4RJQoSIycPFCEwEAAgIBAwMEAwEAAAAAAAABABEhMUHwUWFxgZEQobHRweHxIP/aAAwDAQACEQMRAAAAxX1Wex3O7kzV3JaWmO2vybG4rarfWG0BLusD0NJiRYlWtt++mIRMqTeLuBk3JYbYjIu0jn/SDpmtccZPS7uz0J77pDi3J71fxk+q+JdEGbx72Y8/tqpGal9MWxuck3CwvdHVety1rAW2Xljes+Ua7E+O+8UwvsFKbVhPGz30993cnvpmjpopJS0+4/MDbRbjxW8zJp5Nq8sxs+nHYjkrVA1Fl7lE+7n6vK71JIScbWcWdp9pgeP++SpNH3cVbpd0e6Mzyer6axSSrLz5lp73OttV5Dy30eVo9jrb0+jiiB+nuRLF9N7r51Jb5xXSQqsu/VYPg/1DMqLH3QVPfd33dCZl3Uz3BW2nnub+G0BsfR0GS4emahcprS/eikZHTueuTaNKu20ESdEQtjKAOAhO09Rg/n36akMxTluLr0JnkR9M9tEa2Y51t/5uzTwW1mM1/wCWLo1uGXZp7mdhSnoiuxOq4cQFCVxro0FIrq3TQjz0OB4D9FCl1RV2qVHQ7o90ZtdE/U6xWdB54mj+Z+jS5bRAb2WrVaLVyjhjVnprdPLW57bhxDsdc0O5weYT2G7KLZlHxb34cD6xaslS46Hd9XozM6zaHpJ3M8kdr4Tfiia9c11x5xsG1SYCVJ6vt4hZgqUnSpDAVjXFjGQLatsTqijN5z7MHmfukgWKE2iMTIFpx0em/MvHIJ9458vA0+hsxEUnozOitoVi7JC+92MbOr6VVJZ8B43nQpaFJtYpIsArM5/bjyj6bkZ/VrKa/UuQjclK4xYnl3H8uyN57RYJMTr0ijwfocGXd7FjbnqKA9Js5OCuz+e2VvWgW9XzGaFCfRw8FOdWmxXOvF8697l47fFUeJAIxwTMccyunDq3EzyhY7cg2fqn1xF/HvW+UsGX0/y3q/ThD1e3j+NNh8HaV9+pX2THfxvm98cRZXgxpc3QXz2zTz73uXj/AEIrI6QbleSaj5fTX04anVUrxe9yxGKp9cuVPpJK7jim97IgW0lExZF0c5sg84z6GEBG0qAPknD1qFHrsvzj6TkKnx9yj8zri+T0BcVsbq23r2I4uQ0BSqyPem5GNBQy5guzUe9d0fNp8XSvKLK5mnYIzh5Jy9nq03KOKt04yn0vzmU9UoIenPFOrvOPBZbEBxK8XdWstTQliGxbgGlqekrkqDdQec9LnscZzilXbKCfP0ABMWzURU9xBoVdDL+2ycb9HxhHBRnknyzWByWqhUqtW3rW9HSwzpZ3W0GgWtJ6O1WlCYfiu6tLOj2SqWylZZUgiLpYCL12gwnSnJl/f+fzXrUwWqVFjLfGd2AOh1e9xHTOYqJVterGhKiDbsqyLSbImPW0ou0Y+10rzrOaT0BlXDqdMRARMZzcWyHvshVqCGPSonY/4ptfR0unk8TXo3rcSCbUKGRyWn1p+KIUonLYdJamvgbEUhqtlZz1dJtASgbCgLOY+i4CP0aix0VTMfWjFfFNqUdOLT6bbRXapU9zpOiGVLzJEL1iYbY4TJrpZGvoZ7EtEWhEHDFy8XMKe2X+o+Wz20EFmnzVe37DfE9mXTZFvu7t4ttBlJI6fqEfRAVLTvDK0UzHJ4/oLGTUxJqp7Vyt70urKN6mL+n+dzuqOlqvxe+tGH+JbfZj7u50cnuzDCCOA2mEjq/QHY2JJieDtGesrbW1lvTihWYMgDAXpJyPrszHe7yV7kQaiZYhPf/aAAgBAgABBQH5GW3hYfYop19tbITOUJgPTMHUmZ6W7laRvarNazl+Iib9GIywLxOr7DyRbMzn2R+7PgPsBSmwDBaIW7co9kv3ugnrDgD8JlgyLEw3aMsq2mrj+0UT/bNH9tZwO27Rdp1i+0cFfbkweyQi/cNkHaZheevfuv4SwEY5G0TzYzyyywkKYuY/ThCYBK6xEmIYZp5LKO34O0v4zZHFmxLO0DRpV3DQCMYq5iiLA0MJM/zqnDL9fMy3lizbbF1gJLwz6jEmK5E5fyU4HImJ2jdoveBhOWeg+63Cmp+UHyzDCxm1xYXAZKzEAnCMuIMSsco1eAsCwDHQLLTmUJ2aaNg4Y+RnKO02rBH++gglo74msnfYPatezPiHvFnKEZitOWTo7IUAwdDCYDCZY0fZzNizMPRlirFQiXLCven7dGc2OBK0Ex1UwzE02bNCEQdDHaCzv5JY8tMsOSeijMSrEZZaYgzKAIV5Ma1ja2I7gTyrOUU4gPSixhNexiAejGXPPLGthtljRoRGMqIzG7S8yp5WBis9L7AiWESxO6ticsxDiB5rYlHeATMYzYeM88k5QmEQiEz7i3WLP5M1pAirAzLFsh2GnmnMmZ6dxAcwTUpzKkx0Lyy6W2QnpmZh68YcxTkHBFYxDXmeDkf0zhgwmIpAnIRq5xEpq5zW1+MWCW2YllkY5+JEECQpDXOEFYhSE9sCIAZbrBj4+MNQnCDEK5OhrkStcdbLMxj8iIIBBOMKTExMThOAhjLDCZgyqvvrAxPodHP4CYszMzMxCJx6GMYZmEQzVXMqScYPwCGY6gwGBpnoY8PQwtAcnSpwBAfxZjTMDTMzMzlOULQxoxjQypCW188R+AfDMzMzM5TlOc5znDZ2LwkzPTVXLVIVAgH4jDGgmZmZmTO/RzEmOx+hNGtRB0HX/9oACAEDAAEFAfmO8FDGMhH5VrJngMP4xPqeUiWVdTMQLCsxMdMQLPuYlnf8ghBiMRAFeLrGDVWDWWcVE4gxtdY2oIdZhPHwmIKyZ4xhh+Sofx44hq7ogBaNEMMLxYW72XExjAe46WDB/FiVA4GREEYRZb2i9gxgHdjiMcwzjFgwIT2buT+AdMSpYFmJ9wDEZQZx/i4yeIEs6E46YgjjAVTCMfiErPbPTMLTM74c8YLcloTCeheU9hs2YIMs+/wqsX6EEMMQ9gZsvka693aBCZ9Rui2ERxFWWLCPwCViCZgMMLSsxT2uxitlRUqMsYzPUjopzLFEPwEx0xFEXqzYDXElLO9YjmWmVvwT9iwwbnOLWTPG04w9wYI65BHwWYgE4wdQscEhYASa0xNivuc5s+szWQvYAZXZ2ZMwLiOMzhLRiH4KIFnHqJjpiNSjQYUV5MtIgRWZ0ngGSgx45iAzAI4YmJc8PXEVZn5d4YcQjumZdmM4yLcD9sZGD0cZnHER8TlmOcR2yT0Air8h0LTnOUBn3GfnPFgnJlmQabyB5OUFhnIzGYv1sWCHqq9DM/DPQxjAYrzlPJC0ZszkYo6CACCM3Z/s/jxGM4wiYmZmF4T0XpiCKMy0xpnrn5gQnpjoRCOoESCYgEVZxxLXyYZn8QmJiYhExOMKzjMQfajsIIWHFj+XHXExOM4zjMTh3xBMQCWnAP5B8+3QRY0z3ExNhifl/9oACAEBAAEFAZ99XlomtVlqPW7JX/Vu0u0bdecJbWQK1IKdFToe/QAuRwUGzitWpdc9XottpvabacMM/wAwdcZj1RM1t/XfcqgW5bZs+p1PYV+w9PdovdRwfwnyCv8Aiicomk5D6ZUiluITLFCAK56L0Q9gyKmsPJ3/ALTS9e+T2PbpjpnpmHprs1dnqd03Jrb2vc2zRXfX7T0njSv1pcD1b4/1tVdqass1F4t65bKf0HxbQyN6v0HmtDcBs71VITdvfZ/t9KvUfszEHQ9SItVzEKamtLA6Ps/3Zr+wJqv2LbaqeSCvJa5ey/8AFaCy2cVi1Dxa2jRWalMdUCXo7Qa4rb3JD+kbJPTHxIiqxPr7digWNpbC/pU6o19pbkqbMt7HUK2CzD2VqDLG411V85SvCJxE8olmWWzyvKa/+33KZ9TYp8nxEM7TXGoW1/U6fkvVgrU0Vym0BqrhUtuwbJr7X60bZVdrXtVa/JZaNXscFQi8znsX5Gw5FDiy72ytdRta/hjY+BmYAZjECo09dZsaxu2fIrusoMvJVNLcDbF6iva2BbjT1Tcj6a1JVjKpmKoVjhouuom/l39Xqh63XE95S7bLkseuJ3EWFVMC1yuzxCu3kLvulDLTxFJWrZtTyWbea9/1VHB/ZWr4devEa9EhLOKewyDLtVLJQ6gW2/y9xoPtR68kjoYIRAIDiHE8hU15eE5ahFlu+9KC0XXHaE29E3ew0uYt3F2Nq6z2emZr1Vk8cTGJiKygHDGxWSbjU8PYX1WtBP8AKKTDWQJiOeM5nKWf9YuVQ+4/j9lVdSNO2/RPsaKmGugM1FWf26210vt012vQ2bPrms2UrYbVBhuGEJR1OS/cbVdBO/RrlnwpmJQIQhV8Cc0jtmd883c6GlWdj3mny/r/APZf/p2QLqfTauyz0+o2gaFFXD+1Pt6f9i2PUbyb53NjeV2rA2tZedd/jLW+Q0WeOeYtNq12m84lncjojcQ18e4mcgZ/OwCrZJOvai0WMFp3bVqt1NB7/YbPrNXW9XXsbt2hXcEv2b9XTX22lbWnq/Q31+s1qPWwbL5DMwdV4lnR/NznI42rPHXt2+R2DYxCcR74bMTyZIaMLDPFXiljVOW004tnT9Jfsatvqbads6l/r7adfy6Wnq7Nes+j5bP9GeGxsbOs6OvGlwkFqut9HOeJUFl4WbW+1ksJJMZ8Sy7MLzmILOMyYAOSKI/ERKr3p0fX1/sGzlsb9ev4B7cpPR+3r0d2r3ld8V6UfUaqxN3QS2xaFqB1UYeFA5ZK12HCNtsxFrd8zMttnKFjMwcjOwCg5qwTUVxaERtS+6ua1+sab7Q1Vemuyx/r2nxrp2dPc0dq6tKmovG1vvmm2uw98O7iOxxYqINpgQ5bkSejOSczMEwon1OLE1pVkbLiDAXN01r1pTWsXh4U8Gvfj2Otp67Wpp61T7NtdZu5cmrdJTZdGZbJc6pNngx2HZS1hMY/ETOJnBP8Q+azTV5JTbXdYtflS0uagSGS1iKilhqdrbTthGs2fLYbAQjlXLJWLbQY1osXZbiXaMJiD4JiEAw5lBFcrrZY8IPg8nmss2FaUMCUxWtN4Dae8Xs2vYct2s8aq7QQdhmcC0TxEm6pkOxxLWdoYJifcAmZkQzviv8A86eyqnKCm0u6BUr1zdYlQIwbLeOKUs8O3Rq/zC2frrSZ+q6RCOLHiNq1cbNiWM+Ae3XI6YE4zE7g1M4qd9lyP2OTK2PGj1lUVETlSyp4dZMONfX8lVaGthWy66rnghrIYKbDx2+0syI0xAJjv//aAAgBAgIGPwG4qQqRz43rmGC3aig+XY3cPj3N3aa8Bws87Px7ay00G8DK8SG+Q/LUMD6BIcwtWD0DBO2njOobmGhtW6dgz9PYPB7aQeyV2n4cy9BkmwlbtrBHdMgQ+0jtrct1z4Agt05W1u0qeBOaA97e4SHxIrne44uDnMbahrhO0nDud80JmgMJlWCkHtIV6UHCFrBdQcNzp6h7bXuoeDQWZ3H7dScLnx8o0wMz9o5kYeozpF2D2vfAqHcgrhoZdBSw4y/iRwx2v//aAAgBAwIGPwHDNfVCG5D5E5eGMYNUParB/wCh4R53mw2DW1ODDYb37Xj4ZLO8ZnnQg9ctJ36Yvxn0whDgFtJkDPBrownQbhTw7wmaw+VTpwnLnD49xPrhDKDBTggKC5dsHwap9w0Vn3ngGp7S2ij9V4H5eQSnX18hng6zO8dQWjTm9PvwCFrKyhdRUl4rSWgpYdwhuQYx/l0IPDMV+moV8n1Tni+dh8RzhO8NrX//2gAIAQEBBj8B+t8JGuE9Tlvidp4QVhzRUCNZL2LALUngZoeqFINOa4gwW9IipJZwRp6LDjoD9A9M/qBrBPIfzhBxP1ThGszimyMASfX8KQAFIJKnd3jLALKKrls6lgkmz2JAtPk4BXCUifDvESj2/XnhAew0uGBEeS9LeeHBvGkUutNNyRQJxDYDjBRot3DIFsgdmyDWwqwyIwM5YrjhDmmYLa2nVuY6jATxDHUrSV/FHD4uFu9Fjt98OXFpRddkWwRNzWf8p+6AmZy0AxjYAvbFObsVn1gZDGA1sqyA0kzO0n0TrhvM36hyTENtoCOvGRUfLtgMtMbbCI1jPhbq7Sc9sK5PVM5nSKHCTQq5Ic95j2/wJShYa+2SHAqC1A72gxo9jQ99m3kD/sZaUlmpYCQR3S7AW7dxwbduNW09VZdGBpdJXDMYwbN8VDCrOeCw1zMGBzXa0HBNaSfQR3e45zwMM2/b1CG2yArSu5wROpY8wpNxcmwjPqMFxC0zA7B2iBLIU5ZIsGghHFXZKEQNb1Q57GggcKDbkFh3Ca5MbLDBTjNIfc5xpNruW7KzuS4l2AS6YNtiKyV25gwH4AT4WrHArqsHJ3ju03mGEjy2txnxdAyXWOW5wKjmUDRPQwR/B/KaXnRoXsgDmR5J+cOtjrcI5Z9lyFgqtXmuSk58bZt3j8QSDy3PWxZ50gKX8Nm8k6jTwtuJNr2yOI0jyeaLqgCBccAOtCZ5FROCzxJxZocFhwfskvSi5w47ip9fQIDk354/yhNkttICeuCHZ9HpIR5VvAAppLWE8WQMty7c5btYAutBe1HFnSuGUOcDxmTdmf2wGD/G3ITU9OO0x+WQ1zpKMToAfcYpYK3OUl/hw2TK5DpgvvK8WEQp3n91qSAReyJ9CYfwdflx7ID2v5y2xuXLXim8su1sA2ObDX843l70+J16z5NyoZefyzuHeWzgDlnXPLaQnLFwuG0VWqw+SzPcIC+GcYhxRXJhOWxcMUUEIZiEGOXrQQBkQoOu6BsHZ6GHDOlWjevqES8KN6QAvvjaQCT64c85z6soAHeJxCeGUjPo98Us2qkt5U9pMBlvicewbB78YqdJpwU6YyGmGMEAuZbRXTa0EJ4qfDqFnGb3u7wQBqdBOMOsuxuOmpICNnIieyUODsRiJSTLh0/gbM4a3mWupxc5qFAPfDL/ACX7lzNq4Z26C+naM5Sim+9vMHK4+0HqMg4huMoJts8v/wBRcW9Nt6p0JBrMjOuklwkOIjF4kKkntUCEfsSk1Y4TzBxa72wc3Aky1AVQNoh1vJrShWfDMT2doSLblk6c8lQgbsYDsancI+6SO0GG7f7QMYoGq7PSUKJOOfrji7mLvm0XXYE6IwLW/DnvcZzPTG7hGCQ7JjBU8kENaMAS7vHYAATDm2GuYwOHnXXH81y4VfCpGCqmOkDl7UiWuV2ijAQbILUxeRhsTcsSwy+ts2yjHqXqy9cBF2Sim1ceWPxsu/MY/UhQOJJcIVMYC1B2FJM00BGG5YqBP4lB/uMVJUAe8Dgd7Ztg3G5BTkKTioblhMLSUJzVi5upB2HgMsiF4otk9y6wVNRRJtRlnLsOyLfL1SaQK1UlrHOVxduHRFhqILJqfvcat+ARYeRm7g6QAnZBc1EGJxC4DrjCW3Z6LHF147zE/wCn+33xW9FaoXZmBAc4LNLNuctCAveOJLuzNryEa0nJC55k53UJQKkWaylBuXOCyADSPEd8Fx/ls+pPDZHDL29Puia+m+Mez7Y7xK/Cz2uI9UKKhk5SjTvxPVHDbdhOZcmnEglvjukatL2desA0XJhCiEka1NOW6CK+Md5OG5MYuY5JnORXOC95DbaTGCZVBvhI0jlmnwSlnUtodEjBaQCLdxH7rjxkPmx9DDye7cAp9ePRDbQM3cS7MAYXpGkv5wgK5BIBQochifYIQ9OzZ0QgmmuEeYJ3FCGLdoSDWjrgzksO5h9x6NClUbIYS0nhKHABGs7xPp6vrSjGDimeXYIVshqJH+rGFJqckq5runEmhfhqDfWqQqFd009UJ/ltj/TdE26UPU+vthl3lGi4228FzAJtJMmoCEBJTAYxaa0/lhpocDlW10vvJ6Ti3daUbetgud8jjWvW2cOBwcHBMCHNdL7DBuAi3yzWB9y+ZMDQ5y9PDhpDbFi/UXAIRmMGrUhGxccoqUKc3zPb7oXM9fWZwox7IUzPp4Y43AfLpv2wgCLOpPfEhPbBPP3XCy0KWNKNlqG445wnK2/JsjuNDZz1cZrGz0H1F+orSkI44YlqEfijvg7SYLLWi1XELW04uIpa2W2GXuZu0uugXLVoiq7S6YdcHcYDiBFn9xt91vC51JGIWi43ulrxKLdzl5MLiqT4brRIVIVVDVDHlKQwsO4U4H7hK9cPUzDpL6YRa/brQV3MuDWWgXN816uOLOKlgFb6ZmQ8Sh3LebduG3UbzuUsWhZYM3BhBLg0JMnpi2f1LeZ5C84W23m4Nc51NvzLfE0NeeEPtnFAYofwnGkhMezWEEjuhGnckVIrsteg5dEVFAuQJ9SRs2D3R+awOz454b5AwSCEbjxVHZsXWKlz4VUnbS3Zt+ohiZnqYOUIGKckn/xETc1hzU+sBe2A1pFx2Aoe2r2L1GKOYY+5nSlLxvtuQkbQYuWuTeSXNkxwnSFMiA0O0qT72sWuZ5aw39PdBfy95gNb23HlwFwgkKwmgSUAIcBD/wBsdyzbnN83Q4Ocr7lu3bcoe2ZDAhLTISWZy/PeHOHlyFIAdaYQ9xICmtzyoxkggNHDQO65ahRIqSq7E7YZzAaHd6ZkQ17gXhPvARyHPX7a/t7QWWXPAdb895qeHzBVwACHISWPKYzzvOVzLiyc14P5hIO8ntjlv2zmyx3OpbPMC02ii2x7XBj8GgOLcsASixQ81uVSmvsiq20dLiTFJy3xw9U064xX09MIkqwRUh0X15wazVj4vSUarpIbk+rjIwrnI34kn+EZx+VbcW7FdP5nSBigWinwgAkdRWFvMcz/ANjHD1gCKG8dpZNNRtg6ifD+CcOBqRV8u8jeJf8A5ZhtzBCUKpNxnFynmnft7wauYa03LTwU7zraUKQFVqdMfpv2txeHEF99Dxubg51x/E8DVE0GcAkHhaFc6qoE+pGwlJLgEk0KEJSlNAZJFyovL2BeAoi7QhaFlL1zjyf3Jqkgi+LjWuZcatVCFAoGs8CAZmAf2/8AcX8taUuPK+dcDWmVUg5Rluj/APBaptjbbpXVGMqJ3vWEdcttOjnI1ejCNVxQu9qwhttTUtXtkYUPl0e6BS4k9cZ9KQ65cuADQGfUFMEASGsydukenty+lIl2wiKcAmZ0ipr6nYBwFQH3UQdPZnFVyvYXyloAVPUI7q6hG+nXH5RNrKVynrIIEVPbbuj7rS7oexzHr0wBTftHAOUFgOHde1ow/wDP2Shv6r9PftM47Vi699l7RjTbJqLWk+A1MOSYxcu3LQbY4PKtWg264Vr8NSTEzhgIDuZt2uY5O+Q3zncRFU20nBBihE+oxaH7fY5O9dbdcHWuaqFDGN8BBxXNVbDr/O3H37wtuVrB00W24kNEmkmp2eUPSw4WW0Hy/Lo4nzqrUyGYSUebcldHdeELk8PEADKPIu8u4p42tRdoCJAqkNoLf+oJHCzHcnZHE0feb7oqyGeMTC+mUcIVuZHvlFNs0NzFKOP4p9kbOv6ZH6MCTvlEkDjLhRQM5uzIgTnrPskI8I2/aUjH+kL1zic95RN+MeZ5TRZP+65Tbtz/APLeLWnoi2/zgpP+hhTatx/kKPuNOwwbf6Z7mliF124eIGS+W5zXAeuGXX8i+46QJvHiZbZIL5dYdPHi3ZCH2P0loi4jb9gv81nl+K3MNBd2ZCYJjm/0txryLpFsuNX5X3yvCuJxkIbZ5jlRcDS17fKfxVN0a6nunV2EEudzVs2zcvDzHFHtABcFKoiyafVFVhwKkqq9OOcFwQHFwSFptlpzDUU6Sl1JBotNaRjSU3+hhCsscjFT3I0SLsQFwDtN8ZZ4fZDigcDPEH8SdGkYuTbEoy6fqbIXtjCo6fZnCuAA6Gdir2RUgDARVduVJPABoQq7ILhiQJwXWCGNtgV33NaKVwJcQWtJyDWlxyJjzrz3MuFD+pvjzeacNbVpz1tt2uI+/wCGHXeUY/l7bnBjuYcXXeau3T3bbSKXOuTCW7dPzOSZrtgvv1EMDCHhpYheLTgA17myquDhWTNY/S3L6XLBuHhK27bw0TBKAoXFgcZ95wThDbguGmyGK22SWjGllWbiZ4og0i4xVfZLu6FNMkfSBMTmBMCeSRYaXl9hxY8KaqaZB7T8ufXuZa83ioAHmTa0tFQLkTvia6qmMea5gZdVq7zJq4buiWUUNBaQaXY1MdgJidLviyzEVKA8yDkRc0cG4O16xC4EaY6J2/ZCghwwa4YbRPCCQ2SIR3kG7TdHCJ6D+0QEQjI4joMSwyjT6D9TM7RJvviZQHASBPQPWYptt70hhM6xWVNto78igcUFK9+48yAATJaWkgeUG2QxfLAW45lWKOI77vE5AdzZB3MXLjm2gZualb3pUWtLlBchm890TIWhrhZuU2eZu2y1z0JZynKvb5j2MBV3mOtrcuFaqTM1ul+otNoLLbblhkiWWg6jkmOd8TrjjzDpIoYkNtOKcDnOK4VyaNe6xcYuUjiRoCdJ9cWLgnb4W7CxzWggLvi5y18NRtRtpkBwu7DBwJQU/dy9BE+Jhb+YDNbeJlLBSDpjlCkrQApI71spTcXFAZE4jSSnzGHhc3iwwVHEs7pRVXDdCHvIgCycMhPiGyfTBJ8Uy1wlp64RKRquB3z7YcT+LJCcy3Logl09Se90/Quf1ZxPojGXpMw4tVxAAXxKfCwYD2x+nGDCjyDJ94yuITk3/GNgktRj8xwbat/5XNC0AmkABxQ3HGQBMzMyBh3NeUDZ5Vo8q0VcxVPk2ci6p9Vx7jN1LiglBN95q51zncxeMyOXa43LtzQm49hP/wBehgvcKH8zeN0sxoZYb5dpgzkXED7sNaFpCNY3Y0BTvcfXDmrwqgO4J7YNolBUWVZtDTiNseY5Wkg0prhPaC0GLLA6bamt6nNA64qmAbdt4XFougsb/S5WmLRfKRDsJnOWGBXoh9l03M/MYceMd8A4zaqfZAdb7p4hs1PvGkOLBxZjfIe5d0VYSmUQfiaVMoA7uuMjigMSlsGUKJ6/aIQ/Tj9GM/oljAuHG1VcaPmaBR1veOiAGhz7h/Lttb3jOmkJmSUQQOWtkOY1ans7ty53HvHyN7jckn4jHLWLKeZfJuq8Yvuu8myNtIav4jF51udo08vYDtJNBcdlq1P7x2xaQlPLVcCjnOIOxVXdBvOGC0gGaMmccB7d0NacQAVmnxb0Xrwi7cJQNuIrtC/jcThJpn0QBUGNfcQE4hrEeXH8JHTKG0YND3ofmaDbUZKHGXvh9X+q0LLznMgdj59EPtukQGul8Sm321xbuN71DXTwJCsd2tXYq6qW2+6oexfmmF60OycA0yAR1o/Dg5vtEKCr9R4vm6R2QfZn0Qi9EKPqz+mU1w+2HA1cRDXBZzdUVO2iDzBIa7uWCPDLieBlQ11LThUdkeWBU0oHAYEYCpwybpgIdzM2lli2y2dH3baKuApa+47HTbHlM1dIHIMHCuAAU1dsBjZNbQDc+60TaNmXtlBdalbYQy2AqVFCAF7xw2Z5w7yP8dszuKikEcROQl6obytqZcWsqy4WlS4CaK5ac8MYtBSXAtchnSgVocRjccqn5twjzHiRtiraLbhJfmpTeYuNf/k5gtugj4WOU/1Of2RwlD5Tm9Qq/tlCt8L3G2mjkeAo0KwwGUnDoXskUjimmR/7oHlkKzFrpcPhK7DLqgkyOhxnujX0y+pgY0jGJmPfEgusOARKrf8AkaCPGirksCV3yxJhShpDe8QAEUuUmCAEd0qNFLlMWP1JLVYx7jcmajbpawDYxi/imcVLQ5rWBTcc4iogAVk4bJdcOp4xNVJEghKkIZlFz3BBDS93AagwCQRUc6SAYOkNdkVKynJoSkAHtK9sXGgjz3VNY5VepH5hGnAOo74Y5j2KHiltQCp3UnEy1agqlAgJp6DOGOBmxqWwZKwZneVPZEyFpdTP5HYdEOpKFQWz2EOTKGls2hz8/uxS5pRMUmPYYNfEwhHataUU7UKGKTjsxG45j6Mfp//aAAgBAgMBPxCv+GJPsnMWa6rMoCX8f1C8I4TXi/VeP8lZAX9AMfQhRYspLl3PEu3r5lzTzX8RtF/Xrr1l/lNw/wCK+uISU9fEXBy9dd4WbF+h/PWY1gFnw+2rf8SAGgT9nnv25JSxyp9v3qZN6qBQfX2hI+P8gzzX5zBFvS/iIp1Z9/omz6fmGZv24I2cnJO2bHn+3Ymlvb59381XioK666956wV9r/4V/wAVNTSAow2tjr3hZp319/vqE70cub4ilPHga12/HjjVrsVVfznr3iDQ2PSsxXDirz2h13r88Rwb2Od9Zl7YGB5vHHYfHMRsVbjv17SupDfXX3m1j2XtrGtZc1mClU8uDx7fz60inbrr0mSlqUUrT9IrLv6Vj6VD65m8n2fm5cN/TaAJFMsOz9oBKXv/AD1d+u0Qduuv5lA31UsVvt18e8NZ83830QcdcBXXxCxT111mGYddfMFK66672eqW9cdYx3g289df1iIoOD88+vl/lh7Yjp7sqQ85/noqFgf91GqzFGC4Vlk8gewgb+0HCBdz+/zEtN9Pk6YnbUuwdePzjvqYHXX6iAOT8dKejKqh2x9/x1zBvHGPfn9/iUFSgvmMalBo68+PL/k4svPHXXeKy3rz/FXMjOPb+OO/eAUxcTnL/cpT6kqVA+giKt7rlke9vnVxBRXjP53DWnr3jvcaL11+/ZIHvHXXxE+L+uvaHY8v36Yer/UOB11iBENsuIAxrtLxVnY88dr59AC+1RjXA5W38L8Z7vdacT4epl9K+h9GFcJmoUIDeyz2wn3jnX0FEsx11+dQmgnb99Pr6xhf8Zqivf3JaK4c9eh+IKMBd+ZZLlsC9wtvHX3lz8dfdvsaqE5YD89+uKlrqVHg+34xl19oUQ+lfRYFwV9CF3qCuuY7TExFqVc+ZnR1115jCA3/ALGoPX8v41/VSrsC+uqmqevXXrFyYOktkQ4nhByMxTXYRHglIFuOrlRTmafRSqCwalBZ3gaacQ+fMeZUF5gGLmUl515jNOK/IzCvmH50/rxvcumPW8vH8GfZhFLHj9vbntF5P3+f0RJK5mYPLKapihi67y7Hvj7d4Zn09ij7RfMWZEEgtIhNweIV3EyQ5huCq8wBqBXqhg/EqHjD7Y9u6v7hPdGNYJw2jX82+yZmF29W/m7iccvI89d/4jtfCCaZ4S3aZuXNuIlx1D8fq4IsjsWIRyYMrMS3cJitgc/zKy9ddYgH7p+r7Ve/itS8X5iDwucJjK+v87+BCrzvr+K1KAB/bj5DqpRTz1r7ePuVz35/UeXzG3IwMrJWAJD6J4I8q8Rbc+/mBoYdeZVjmVh1AuVsUmY9sRnoRDiIOd+1/wB+8KVCHpnjZ4xs47QALB5L8Y5ubHTxX7rzCfX46uLXR575f7fExlv99+/8eLyWgrXSm/yY+xCCMA4+yp5O2/XcVe73Ip+GPZKizKfOIJ4iYqnxG6+IOQ2y516xEQzUJRMWJnlzcJhHCOuaive412684ZRMh11+e8zC0pjeL7+M+cOXKytLVNv46zm4KGAXj8wU3VtUf6FOb/JcA2iT3euXPpzzxHgJ/N/x3+JWnTfH9czGAXonR7QQCOvipxEuMkJzAj9/1GdA141zywiYz7vxBiYTOiy9C4QlYjPEBcBlp9HF3AGHnrz1ZTHEtWP31+IRgycdzrv/ADDkGr31x/sEunXXW5dKL9OuviAWT1FPbGPPEYYHs9ff7RI5lBlj8V9dee8zn9YAqgwO8o4jbRFlQx9CUVLYc4PoIqIYLMCVlYE1HZWZetyxvnr7RUenbrrMY247/wC/5FNGOuuIDj2gAuAYJ9LH6VKlQIRCdiaW6hJAGP1oGU+kuZlMkoMfKFRUKw/9B9FcfXXzMm3UsW+IK/P2lEX6NGMUTxFb7xdnaKmHXvAq5nwMNTlhK/5JUJlF1118S1BKCLIQCoUmcyfTQuplibxGjPIeJQI8QIED61K+pcyqzHKYEIMbfq5TSJzK8t79qit12jAZqRXb17zXGuuvHj6ALX0QhKhMQ+hH6UR0Ylo9kVLTsS4tuM/H2z1c5YxT+GUce+PvcH5fgmZULWF+v9y/MB+g+n//2gAIAQMDAT8Qr64hCXBpCsH7j+Rhf/D9bgSpU1NEWFdtQ5i/9n1oOYLRtUPvH2fG4NL/AJfV6d9RP314gZgqFpbK6jj7/RRD5SnfXrKpW/X9fjxuaUSlEiR/5P8Alod4As1+Ovjccv4cPf8As7TsLpjx44992sqgDL75/wA+1xrZc1g6/wAjh1EtNj4/2AKMvM7A5gVat+3Z6+naNqUadOa7vl+PapuP868bhJRZydPvHx/03B+lfQGm7P4IvTl7kpt069cemrVxx1194LqoqDr292ZK6xNr6yt9fiUuOurln1Jt8df5b6vBC8sN56314hYOnWv7bjNnbr28ErWYWm666uEtc5663Ls95X1r6bmIE3qa+Y7I/b9Q3WfqA9dfHaUbhvrr+5bLrrHyRUPn9fl+0Q3zn24/UujGJmLr99Z8dhZdy9dsfgNHzO/A65/WviAGjfX+69YMzl93889u3zEy0HXXeZFaqB47/Q+l/Sqln0ELsUM9/wBRSWCzcy+uvXohYEwjx+Oeve4O3TEX0D8/2Sy9bmeYNuddde0qY/p1y2eXUrO7e/68eMfiFfz116w0nK4Kq3216pfIynWOVDT070ei+zKgXzNTzE/5GvrUvZNh6+IcpdxpLSFwb3jr8REAf56xX+5hhvaY9ivy3Uch7Z+ev8l6p5lPXXpETHXXWYWa68/rql0c9HX42EoPd3/o0GnnYqBt+xwfO/M7EGcfow/4qHmMs0H0DEwndCy7dfzMFNY+/b365lQc7de8W64xLsddfiZBIAuun7R311v7Sk3M44R1TlmOKb7/AL+gjLgQIkCBAsarmEPo14hpCIJ3m/Drrmw9yvh6Wd1qV5zfBzo+2d6iWjzXr6Xft6MEVWPHX8sbY467Yl8Qe3Xv18xFwdfqFmWBBQeL++ff214jLxLgQIIwEIaYEMkccywWYhr2iFOh40PvFGnrrccsN3fzez2V21zUTHp17wGBbhvhvCN8Wxj3bBRzgPnUN5XYxX4Ou9QCzPXz2iW4PmHBeOus4goov7R0wbGBcRgwgmv0WTUupbxCPL11cUXn/K4997IrM96m5GsRgJmg669YmVb/AJ6ze+KwuVdNfIYz6L+fQC3Y+OL4sr2tb3MCz7T1On2Siud36fdDZg6+Y+CfipQsnKnX6/MoTAqVGLAhj6WKII/TKNiFnn5x56v0lKtH8ez868xtwO1w/nrMbgZXvj1vt6X+Zct/nm/vC1kr7eb+PtxdwAArtV3XjS5L9ckCKIEY2U4Jed58lasEEV79tnxlR6A8Q+sboLe609dFiasF6GfvuIPHx/Ua7t+f9hoJ3CIuXNEax1AhF0KYi/Q3AlEy7dfETeEddfZrEdyy2+zXbv8Aa+DgCA2+Ctd+OiFJVDmzXp1v4hsCw273l8UthhOxqHGsHd/kYL5AwFd1JbK8/Arv3XmcEs66/mPMWetxF118ZibP5i1h9maUutynnce5T6CM6ndgVFlx+ijFJhDsirv/AGBbs8ddu+O9wA3A9/H53+G6YtmtcZOHef6lKqVMAYeH30v8w0D+ICP5iuXy+/f8wTlJ56/H3lxj9wSoOvE5uuuqiMEWIkqUa+i/4XCuopt/qOptiyhzN/EvWYtXLEQKvEzQUK4mTnrr/Gek6+/5gDnr9/SUt9LLgUS1xFYN/R+l1DDO56p+I549Pfv1+md2MafTgxEYDDxDtEESETaUlO8Tc8vrlKjB+rOjz1icR110SqK5eumYHtUS364kYiQd4KuaWctRWZC+euuYK7xLDtcW/oy39Eh9Lj9XBBCjcYp9BcfoCpCiesFi/SUr1fEImZSutzca6uBbXeLFmPpiBLl/SoTbiUJVwMR+jl9GTmZlHf7QORrXvAgXDMk3euu8ucde0sth6683Fe4/SpUv6JK+lsvt9GYGZUogSiBCEpUx3y379owCuz8kEeGfySqvoRS7GY5H2V9Fly4M/9oACAEBAwE/EChpyEB2932laX47kxUwHF3iMqU84cmOJbNlSnJ4Yuw8vBzEgpeAHYV3Ggm6TilDq7aVvDX21Lo4pWmxYguE783MwKvl2hsKyvOe032vQ5q8j8mYSy3R4cmno9Ny9Bi1gKtwcbtjSXdDge2aPtEEVS4TygH7wxmsZyfH8SwweKOHzULsvXcj0VmynG84Hun7O4GbYPPueMM95cBRrXSgQHi++LS7qEoAJeePVwapjtNgaVTQuzYjwG994BXNCULehSBn44KG6ezd16w1VOOKXfiLwfUf7n2lr894mK7RM5ab7RrynLS1qVduGbKz5JlBLY48pxHrqALFFt7HY63AFZstYbHgubzWo1AaE28qEtvJAIoXADgtovBsx5YeGMvFmVCr7nNMrMLRSzhkjvQx3vtEcDSLCrAz9VCOkBqvCwb25r8SpGmWWwNKrWGZvxKOLKiu+cPWJDJZGnMfR6+IiFVSVtLVd96qaHAbhFOthUwN+ZWBsLF3JqGzOKBXqABZKDOFcK4Ge9wtpB4NAhkUUuPhuGiCJd5UGDOnGXTuJqlCilQ3rur/AJURWVuj7o1b7AQGkdN43BX+5SXVnh3EVd1X00pz61/MuXd7gUPjUQugObwh8cfMwQXMa7WYd2Jn7IKsSJWhbUu6kWjCvnYU7AhYmkOMBDgMUeAWMGrzTwxtGQdPhVitj5UZpTQRzYXkoqlwxG5bsly7m91mLpGkro2mjxd4S5QaJtBMctBMUVgLAtzKrzmE9oK6AQKxjfp3jSE6DhtsS0tp6dmDJkVAmWhwL9PMI92NgJ9BGd7gG1Q1idJQlK3mt3FaWre6K82cC+ILrNk5OWNmPFQc2FtbcVTooAAQqb1dPeuIaoUDS/bftmAVH2PeCtz3PbtMLKx8x1maeMwELL9Yl+kuHXv3is1K19guWIZKuHNUqe1PtyEPTWlVxpe642slkyiY07ME7QexiyICsrGGr0BTgKYzvALBesApRtvJbz7RhhlpkyF+wso/MCR5vHWOe6WGLytRgN0oxo0vMsUuAvBAro91+2KBWmWyvL2vQamyY69lBlWKKtfUik1CplC8UGhwHhyl6kaC9qr5arWPWVqA8WXDg+bo3fOCoY+C9mhFXZm07+WLpcjeqOQHAuA+IwQSgUmVpmgxOr7CVmTQyQoByzWO5jsVtumjnnfrvvURvx+PeVWeeff0m+rshWtkTF8ELXGXg7xyObNXMy1uiW3Xsrs5Jx5mvwFDX1eM+SGFDKjSqLLRs26w1+kyJ6TqHZPfPbS7BKKBEWDl2LZgSooFrajA5yq+5jvEsJhJsFl6HNjyQnu0BXN3Nelz0S4QYOSqigFazZ71EqY1RdZictIqUApYSrDblRmEtMpoi05R+O0UPBFthss2GhJvuAlQrWlcgPNOG7dr8QqwgUhQiNba1WHdzGxhGQUmx4NB7KjAh7FFuVLmAeFVKSY21AbZjgb4oy5lfMJVgL2SlABFyjZemFoNQcNYPW4276JW5Q1fMvHzFwfz3mlH2mV08Z67zJGnuL+swgPOzO4AyaYzmimkdRuyQOgrILHLjzCNDiO3qSPIO7NYWPHWsS17RA88D2guwi7nQcTRtkU5CMQFW0AGSDg+EF1SVuB3aCRsXeC9v5hkMoJTK0Pwpv1EtjEC5YaFvwHB7xkUHyXTaF8hvvAC20C0xTMt5avvcwGsQh21l8dkQLQmaDysvwrfmDlLiSqgwtn1C3JtEhDMqXk5I0Tba+9GRZSBoB2AODOc6HFNyzCEUZqDtFoxzKC4x9Fpv4MtynEcsBNCA4rRl5qzwXCdULd1rAThLKCgvWY0gEoZ8+TxNtkWv1EvJ6zb0zOxji0rQaZ+6RwIV1eaAUq4laVbjDePkPVoSGUB7wUAGCzsNJXsJim7mmmN2/EG0ToRQMUUgEdOwBqpurlHZdZ4q53MI9S0DP7JBARZwPRYdHSU7GNzPiAtFWzIVMh4IwiQppoxyoFu005qmigweC5eG47wX3u8VlBjAA++5e4H5KHcz6L48ykmVMUuuz3TpUUKyOKit0L2849o7U3RbZarh3dXd+jlJNAYzSB4uarzzelZNMEs0wC7CyujhULKpi4Gs6TBtZUTgGDgW0zwc3uM6DCZDGXQbq65xm4dNOqBAcV4r7wddyIBZ9psLxqUrLIdMmsq4DyxcYq87fL/AAiLteCUp78PeA2sO2zzxFItKyWduBuDs2cglMYgOGqXpqOfBWCh8C4d0Npb1LgXnK8j+oTK5EKHHgWLgwCi2GZK3gdAybR7Jx7vaGA4DQasqigffbp0C8Lb7nENAANU1l+op067rCW5eeFMC5XngsCCoO3YQBd59a57x3dUaucRIVWOF1ubrtGWexX6ZWw0CGDRbk5c+1wIACUWtwz4By3cDA4ClceV0+fS+0yHfU4Qcb711mG+2jhobfWvSNkxq7QMN3j1izdVQDiZCLYFnLqOp7humnCDjhqEHuUWneDe+N+Sch9b3D3tNiyurKM1FzS6Lf3NTDClCvxdRIFJ5Zk3xh7TKFFNFeazze8CCbiWL1mj6MMBJoXYo0GZnhuZICgNkISxbXRfH8Qk2hefvtcXhQTQPIhVayNM4RIoUBnZWszNG8sXguC+MwpGh5V4M8CLZZSRAlVxkksVXKdgL3H2QKol5q0qxk9RKotTrsFSucHJwJehVF1tVnRxhoMMxVK7zYurMI/crTUurQBxnN+0bFtDTwUmjb0z41LdxWijjyVe0zmobkF4wbPo1AEso0gPi7igXGFGF5juhlO7w0a5W+q57aMSuQq1VtFQHuxY+8tMOc5zZALq+8IV3ox/MRHX5IFKa8D394wzdmSil81ADdCI5Ae6kFVZFMRb3Ge/eICkYKO0ApE+SXiBEOVBHcVsHarYRg8KuBqAIBvvkhTF1XdAzbA4G7XEcLGmRAeYGIbvdsLOgEylIHMYAvNdizEWWks6G63sVe8YIofPOgRvOLdVeRAOja0CuePl6r7JVmCNYp1iUguEFZmlWFSTDjYq1f6mrkqgX7N49YWwS6Cc3mjvqXqVdCgOaTTvtLNW2YLc4VnrMDnBewM+4w+LuJ7a6WKaFGAHHEvdRbs74FtvhRxAgm1NS2kFmuThdVA83C18Xi4bm7p15lgirsKVHMvahqxHPrLskRjN06PLUuGcbFNHYfxMKcQCJ6GnsnChAATtheiz8hcfvSJq72S26wYUJri1QhChmLCxyxCAI3YwMdwaBXQDHCpBLrdFTssqLg2i/kgxCBiFAYuC9OkYRhsi488A3DorQgUbTC8VvdcS/YPFwMQunZLniLLyMoKLTik5kqjzKx9UgatdAMVofZULCFuB2vEtA13sXbz6S5GkAGCBXPb39paFi21GR4EdvEY6DTdDx4xDgAU22vrWcTEtDCwdd0EzWYAAXm6bfVK2UUAugaGCBBinN8moVhr/ACBZr4mJRxWUeIwnZbbiJq/cU1pEtjlA24gdsvQfCsZ0Y8ctuv1Fjwj0jAvRaBl8oY0sE4koxHcs+FRlhiJ2vLiqqYJnZ6EkFKubfwOGZsL5CxvS5xcrTRaGe64RdzAtDTg0S+caxGjtrQxTRoNFy7oIOplbDEyCBT6MRAuawE1tcGsKESC/IHpKo9ULENPaYZrAJeQCW9q0zmsRVcHhm2R5PBcLCLyshHjI16EFSNzMJ5BfEbAFjkeTAs9YMYA0AGsVioPjjxgL9BJYCSkiG8FMMYSNfILCnpqJtSDtXOPKY0yX6YGG6X+4A5QDdANcL7xpK0mhY4Gee2PUiOAGgi9AU4Sy3UK201Vu2wmh2AI5ir52GTgGutdqRrbAz7mEvEGlCmLZu8tWBt4xIeLwlBZFsFKjHKMNkwkFiqwUFaSVmiotY2qk4GhZxGqochwBtoWJwsaMudSFoJzgS+g1bZhjl1VuaoUJrFXDAHgybBGg2d65Yag7QIHlC3pnU4oxeobsAQrksPES5FxXIa/gvvC7oKNK1raC/v6wLUrFxh7Ps4INstgGpRq9i+Ypi55Xeayhh5a+wVY5FYQZqBVBF0qre1IoDZuuT3zBbSKmSy09NTf+8LDQYI7zU47JvFaGXfeNZr91hfEHKq84sDLBbNuK0DBRwVi/aEV2aUXfvflFYL5wMOHQFQpd6FqYG8gAekdHxNuAZQe59BKQnzCw0OH2Nj8lQHVe3A5Ep5DHeZafLNvii8ICbVi7DBTEa7lcyoroIsJEQMBKHCrDEK9yW8mgZmW0HLVjZpzDodTbMRRW0HxlNN6KSpRYXhdnPun9pkinfGUg4tAbhvEtxpLEuhKwyR5W1fOD6GIbJCglV54Od9o4SwWCNAnyNeYxNtAJgzhHA7LPNw43FAC9UsYfQitLLYEtL63FpY5Xm71LO7XxV+1TaX3uNUps3fVylWMcxSVXo1CLoZtVSvdcQc6xyql70V9jEntla+yWXf5dy6uSwCBsB5ltYBTincWeYevDPlZ7gsDGxEaoPclqF1prbZwE5HFkkKzx2DW01LQKRkK4jV/y4zwGxaA06eSCisWI+EtogUy002+FrszMQ5H7idEBEKLkA3SW4YIzUUplzCpt0sKDnIaSlAuPcO4L4IsmAsQBUcBsBHhks5+oab0lKTQTLs4WkCtQpYWxapTQQ82qZ4dsDKzwSU04u8R5CyNSVyVbFj4R7Ui2y6cu7HNhvmPVgZG4d8nBLq+WiWewxtt21VV7ZzHO8J33EDhikijiLOL9Br7uD3hTt7tmbOMKPLXiy2I1tzMY9ytTozAOoqkAJZt93tMq2IAGIOhtiJggM42vq4as4U23VkQuK7dIiNZmBSjFAnWucRKrYGQqEjt3TN1YgcrRQMA+wKCrsTXgvcKW9xoKuBVxwVSZHA5xRLXiD3prMD7rTki1QgBanVTpQvOYpAhFjYoiaDXYV2ZQathhE2ZDAC6saolyuxpJrrxBuFRSFXUsILBwk4hAs21YnKsVpUGhT5Fs8iyMVS2FNEpXgc86q4yBpXBxYf8ARrmPAKDgahMoXF7QpVJeRQ01x82zuAmlbK/NxnOnTzUyrXPfcvv8QL3Mar5iyUwaZftG1+YXMBa7X3N/E2wBBaWjItLNLpzGBi8coB710YbLEUGw4NbH8K8FxVg0tXUpi7xMFbMFUwNin5wXgFUrCk3tOWnfZGTsRSAK1zXYOAEWnKoltyU64YrNig2DNwW4QoUayVtlZS39tlArdYYu1BRs9gZSFBJIlGM5KmXF3OHgwDBTuKukfhcFSy2FIgo4ELvFeCGCwrysKkcg4t2jCjc0ZuqnZrFi8tyuWpREAiGscg1vUE5KcGiZCcXfpULxFqglu14+JfeAZofofiNL2drL+wSl6W9XU59dwTUUGUfEFrPQ7QRvJWblVBcLMUnGH3qVIbKBycMeR9m7iLdlgoihkUmr1zADcyqtWwKsn2Fm8ATBXAmu81ptG4gxQUG3uQGYvuWOtt0WZUW907sZJUAUtYRyiA4Vv1b4rirUaabtQ+aArkeBVgwKirLoNWN3EodIArt1YmRztcd1rWdIPMlqxXgFlANywqB67yqU9UKez7VSwMZsQ73mIc3Xa7EtepTSjFYVY+bw2W6BZ8g2mWgrc3KPFY9g8R6kHxABPdlnOENhQoNmj1L7HBjtCNyitQ77mrvJ6cylUW1p7Mwo57StCUNrqV1SqxBsh76zENU54HB9qioUMFl0609dOHm4Ke0JFQ7hT0cvMYvm+cgrnACEooyTLWJ2BNQS0OauIwDYNR/EENAo+QEMODAI8wFjLjKmVqjuqLF4FbvoL7GwkGrzlWGRmnsAxotUwFu4Ap6IbyNKADockZQwFFpe8ozyp52dFSOTaeGWUpLHKb2FPeziAszSRS81aPkcSmuU7bkC47aS+h4uXjWyF1WNDRDeDEALngGEPOOVrz6w7QDTcl2AMygAIG2Ur7o9EPSldhgCzNL/AJrMVi0Zcazz/aChQvldSnKvmcYm78EM9/uimq+GKrMnFMx0lG7GYI8/yrr2i8jas9CwoFFzIZZngJWjSvKcAO5MA3fQ3jev2lmaTKRNJLfdawUhNwj9kC9xfHiiVCBGQSBGoTBFd0MhfXFAiFReQG23Qh9sq9u3I5lwB6oIKQoBZz6pTg7mIWvvYIpSlqsazb5Gbsjs643cZGDvRib2Re76NF5js3wjHiLyM2nZtPpk7xo2NoAXOTSnIQsbAmS2FxaOTv8AzLK14JUnZSj1/cuSldSxoZBLAeQPECOa33Gt4Pv6xN5+Qo+0D5XuAjmmAK3jS4Sf/9k=\"\n\t\t}\n\t}\n}))","active": false,"opts": ["nocompile"],"err": [],"color": []},{"stamp": "1420957437155","id": ".IsSystem","type": "js","data": "({})","active": false,"opts": ["nocompile"],"err": [],"color": []}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NGOThGRiIvPgogICAgPHBhdGggZD0iTTM5LjkyMSw0OS44OTMgTDM3LjU0OSw1Mi41MTcgTDI3LjI1Niw2My45MDMgTDM3LjU1OCw3NS40OTMgTDM5Ljg4Miw3OC4xMDcgTDMwLjQxMiw3OC4xMDcgTDI5Ljk0Myw3Ny41OCBMMTguNzA2LDY0LjkzOCBMMTcuNzcxLDYzLjg4NiBMMTguNzE1LDYyLjg0MSBMMjkuOTUyLDUwLjQxIEwzMC40MTksNDkuODkzIEwzOS45MjEsNDkuODkzIHogTTU4Ljk0NywzMS45NDkgTDUzLjA5MiwzMS45NDkgQzQ3LjQ0OSwzMS45NDkgNDIuNzQzLDM2LjY1NSA0Mi43NDMsNDMuMDAxIEw0Mi43NDMsNTcuMzk4IEM0Mi43NDMsNTkuNDc4IDQxLjkyNiw2MC42NzQgNDAuNjYxLDYwLjY3NCBMMzkuMDkxLDYwLjY3NCBMMzkuMDkxLDY3LjMyNiBMNDAuNjYxLDY3LjMyNiBDNDEuOTI2LDY3LjMyNiA0Mi43NDMsNjguNTIyIDQyLjc0Myw3MC42MDIgTDQyLjc0Myw4NS4wNyBDNDIuNzQzLDkxLjM1OCA0Ny40NjEsOTYuMDUxIDUzLjA5Miw5Ni4wNTEgTDU4Ljk0Nyw5Ni4wNTEgTDU4Ljk0Nyw4OS4wNDcgTDUzLjA5Miw4OS4wNDcgQzUxLjQ0OSw4OS4wNDcgNTAuMDI4LDg3LjM2IDUwLjAyOCw4NC45OTkgTDUwLjAyOCw3MC4xOCBDNDkuOTI3LDY4LjAxMyA0OS42MzUsNjUuNTggNDcuOTU2LDY0IEM0OS42MzcsNjIuNDY0IDQ5Ljk1Miw1OS45NSA1MC4wMjgsNTcuODIgTDUwLjAyOCw0My4wMDEgQzUwLjAyOCw0MC41OTcgNTEuNDI0LDM4Ljk1MyA1My4wOTIsMzguOTUzIEw1OC45NDcsMzguOTUzIEw1OC45NDcsMzEuOTQ5IHogTTc0LjQyMywzMS45NDkgTDY4LjU2OCwzMS45NDkgTDY4LjU2OCwzOC45NTMgTDc0LjQyMywzOC45NTMgQzc2LjA5MSwzOC45NTMgNzcuNDg3LDQwLjU5NyA3Ny40ODcsNDMuMDAxIEw3Ny40ODcsNTcuODIgQzc3LjU4OCw1OS45ODcgNzcuODgsNjIuNDIgNzkuNTU5LDY0IEM3Ny44NzksNjUuNTM2IDc3LjU2Myw2OC4wNSA3Ny40ODcsNzAuMTggTDc3LjQ4Nyw4NC45OTkgQzc3LjQ4Nyw4Ny4zNiA3Ni4wNjYsODkuMDQ3IDc0LjQyMyw4OS4wNDcgTDY4LjU2OCw4OS4wNDcgTDY4LjU2OCw5Ni4wNTEgTDc0LjQyMyw5Ni4wNTEgQzgwLjEwMSw5Ni4wNTEgODQuNzcyLDkxLjM4IDg0Ljc3Miw4NS4wNyBMODQuNzcyLDcwLjYwMiBDODQuNzcyLDY4LjUyMiA4NS41ODksNjcuMzI2IDg2Ljg1NCw2Ny4zMjYgTDg4LjQyNCw2Ny4zMjYgTDg4LjQyNCw2MC42NzQgTDg2Ljg1NCw2MC42NzQgQzg1LjU4OSw2MC42NzQgODQuNzcyLDU5LjQ3OCA4NC43NzIsNTcuMzk4IEw4NC43NzIsNDMuMDAxIEM4NC43NzIsMzYuNjMzIDgwLjExMywzMS45NDkgNzQuNDIzLDMxLjk0OSB6IE05Ny41OCw0OS44OTMgTDg4LjA3OSw0OS44OTMgTDkwLjQ1MSw1Mi41MTcgTDEwMC43NDQsNjMuOTAzIEw5MC40NDIsNzUuNDkzIEw4OC4xMTgsNzguMTA3IEw5Ny41ODgsNzguMTA3IEw5OC4wNTcsNzcuNTggTDEwOS4yOTQsNjQuOTM4IEwxMTAuMjI5LDYzLjg4NiBMMTA5LjI4NSw2Mi44NDEgTDk4LjA0OCw1MC40MSBMOTcuNTgsNDkuODkzIHoiIGZpbGw9IiNCQTcwRDYiLz4KICA8L2c+Cjwvc3ZnPgo=","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "*","actions": ["create","json","edit"]}],"_opts": {"compileTo": ["js"],"runWidth": "1000","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "JSON editor, recognizes timestamps, functions, base64 binaries and so on.","timeout": "5000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NGOThGRiIvPgogICAgPHBhdGggZD0iTTM5LjkyMSw0OS44OTMgTDM3LjU0OSw1Mi41MTcgTDI3LjI1Niw2My45MDMgTDM3LjU1OCw3NS40OTMgTDM5Ljg4Miw3OC4xMDcgTDMwLjQxMiw3OC4xMDcgTDI5Ljk0Myw3Ny41OCBMMTguNzA2LDY0LjkzOCBMMTcuNzcxLDYzLjg4NiBMMTguNzE1LDYyLjg0MSBMMjkuOTUyLDUwLjQxIEwzMC40MTksNDkuODkzIEwzOS45MjEsNDkuODkzIHogTTU4Ljk0NywzMS45NDkgTDUzLjA5MiwzMS45NDkgQzQ3LjQ0OSwzMS45NDkgNDIuNzQzLDM2LjY1NSA0Mi43NDMsNDMuMDAxIEw0Mi43NDMsNTcuMzk4IEM0Mi43NDMsNTkuNDc4IDQxLjkyNiw2MC42NzQgNDAuNjYxLDYwLjY3NCBMMzkuMDkxLDYwLjY3NCBMMzkuMDkxLDY3LjMyNiBMNDAuNjYxLDY3LjMyNiBDNDEuOTI2LDY3LjMyNiA0Mi43NDMsNjguNTIyIDQyLjc0Myw3MC42MDIgTDQyLjc0Myw4NS4wNyBDNDIuNzQzLDkxLjM1OCA0Ny40NjEsOTYuMDUxIDUzLjA5Miw5Ni4wNTEgTDU4Ljk0Nyw5Ni4wNTEgTDU4Ljk0Nyw4OS4wNDcgTDUzLjA5Miw4OS4wNDcgQzUxLjQ0OSw4OS4wNDcgNTAuMDI4LDg3LjM2IDUwLjAyOCw4NC45OTkgTDUwLjAyOCw3MC4xOCBDNDkuOTI3LDY4LjAxMyA0OS42MzUsNjUuNTggNDcuOTU2LDY0IEM0OS42MzcsNjIuNDY0IDQ5Ljk1Miw1OS45NSA1MC4wMjgsNTcuODIgTDUwLjAyOCw0My4wMDEgQzUwLjAyOCw0MC41OTcgNTEuNDI0LDM4Ljk1MyA1My4wOTIsMzguOTUzIEw1OC45NDcsMzguOTUzIEw1OC45NDcsMzEuOTQ5IHogTTc0LjQyMywzMS45NDkgTDY4LjU2OCwzMS45NDkgTDY4LjU2OCwzOC45NTMgTDc0LjQyMywzOC45NTMgQzc2LjA5MSwzOC45NTMgNzcuNDg3LDQwLjU5NyA3Ny40ODcsNDMuMDAxIEw3Ny40ODcsNTcuODIgQzc3LjU4OCw1OS45ODcgNzcuODgsNjIuNDIgNzkuNTU5LDY0IEM3Ny44NzksNjUuNTM2IDc3LjU2Myw2OC4wNSA3Ny40ODcsNzAuMTggTDc3LjQ4Nyw4NC45OTkgQzc3LjQ4Nyw4Ny4zNiA3Ni4wNjYsODkuMDQ3IDc0LjQyMyw4OS4wNDcgTDY4LjU2OCw4OS4wNDcgTDY4LjU2OCw5Ni4wNTEgTDc0LjQyMyw5Ni4wNTEgQzgwLjEwMSw5Ni4wNTEgODQuNzcyLDkxLjM4IDg0Ljc3Miw4NS4wNyBMODQuNzcyLDcwLjYwMiBDODQuNzcyLDY4LjUyMiA4NS41ODksNjcuMzI2IDg2Ljg1NCw2Ny4zMjYgTDg4LjQyNCw2Ny4zMjYgTDg4LjQyNCw2MC42NzQgTDg2Ljg1NCw2MC42NzQgQzg1LjU4OSw2MC42NzQgODQuNzcyLDU5LjQ3OCA4NC43NzIsNTcuMzk4IEw4NC43NzIsNDMuMDAxIEM4NC43NzIsMzYuNjMzIDgwLjExMywzMS45NDkgNzQuNDIzLDMxLjk0OSB6IE05Ny41OCw0OS44OTMgTDg4LjA3OSw0OS44OTMgTDkwLjQ1MSw1Mi41MTcgTDEwMC43NDQsNjMuOTAzIEw5MC40NDIsNzUuNDkzIEw4OC4xMTgsNzguMTA3IEw5Ny41ODgsNzguMTA3IEw5OC4wNTcsNzcuNTggTDEwOS4yOTQsNjQuOTM4IEwxMTAuMjI5LDYzLjg4NiBMMTA5LjI4NSw2Mi44NDEgTDk4LjA0OCw1MC40MSBMOTcuNTgsNDkuODkzIHoiIGZpbGw9IiNCQTcwRDYiLz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": "","nodetitle": "title","nodedoc": "doc","nodecmd": "cmd","types": "","width": [[820,1200],1000,1200],"collapsed": [".Event",".MAdd",".style"],"padding": "auto"},"log": [[1536622566080,"update","admin-czpbhuup",223,"dev-cloudwall2"]],"id": "cw.Sys.JSON","stamp": 1536622740461,"creator": "ermouth-1ermouth","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NGOThGRiIvPgogICAgPHBhdGggZD0iTTM5LjkyMSw0OS44OTMgTDM3LjU0OSw1Mi41MTcgTDI3LjI1Niw2My45MDMgTDM3LjU1OCw3NS40OTMgTDM5Ljg4Miw3OC4xMDcgTDMwLjQxMiw3OC4xMDcgTDI5Ljk0Myw3Ny41OCBMMTguNzA2LDY0LjkzOCBMMTcuNzcxLDYzLjg4NiBMMTguNzE1LDYyLjg0MSBMMjkuOTUyLDUwLjQxIEwzMC40MTksNDkuODkzIEwzOS45MjEsNDkuODkzIHogTTU4Ljk0NywzMS45NDkgTDUzLjA5MiwzMS45NDkgQzQ3LjQ0OSwzMS45NDkgNDIuNzQzLDM2LjY1NSA0Mi43NDMsNDMuMDAxIEw0Mi43NDMsNTcuMzk4IEM0Mi43NDMsNTkuNDc4IDQxLjkyNiw2MC42NzQgNDAuNjYxLDYwLjY3NCBMMzkuMDkxLDYwLjY3NCBMMzkuMDkxLDY3LjMyNiBMNDAuNjYxLDY3LjMyNiBDNDEuOTI2LDY3LjMyNiA0Mi43NDMsNjguNTIyIDQyLjc0Myw3MC42MDIgTDQyLjc0Myw4NS4wNyBDNDIuNzQzLDkxLjM1OCA0Ny40NjEsOTYuMDUxIDUzLjA5Miw5Ni4wNTEgTDU4Ljk0Nyw5Ni4wNTEgTDU4Ljk0Nyw4OS4wNDcgTDUzLjA5Miw4OS4wNDcgQzUxLjQ0OSw4OS4wNDcgNTAuMDI4LDg3LjM2IDUwLjAyOCw4NC45OTkgTDUwLjAyOCw3MC4xOCBDNDkuOTI3LDY4LjAxMyA0OS42MzUsNjUuNTggNDcuOTU2LDY0IEM0OS42MzcsNjIuNDY0IDQ5Ljk1Miw1OS45NSA1MC4wMjgsNTcuODIgTDUwLjAyOCw0My4wMDEgQzUwLjAyOCw0MC41OTcgNTEuNDI0LDM4Ljk1MyA1My4wOTIsMzguOTUzIEw1OC45NDcsMzguOTUzIEw1OC45NDcsMzEuOTQ5IHogTTc0LjQyMywzMS45NDkgTDY4LjU2OCwzMS45NDkgTDY4LjU2OCwzOC45NTMgTDc0LjQyMywzOC45NTMgQzc2LjA5MSwzOC45NTMgNzcuNDg3LDQwLjU5NyA3Ny40ODcsNDMuMDAxIEw3Ny40ODcsNTcuODIgQzc3LjU4OCw1OS45ODcgNzcuODgsNjIuNDIgNzkuNTU5LDY0IEM3Ny44NzksNjUuNTM2IDc3LjU2Myw2OC4wNSA3Ny40ODcsNzAuMTggTDc3LjQ4Nyw4NC45OTkgQzc3LjQ4Nyw4Ny4zNiA3Ni4wNjYsODkuMDQ3IDc0LjQyMyw4OS4wNDcgTDY4LjU2OCw4OS4wNDcgTDY4LjU2OCw5Ni4wNTEgTDc0LjQyMyw5Ni4wNTEgQzgwLjEwMSw5Ni4wNTEgODQuNzcyLDkxLjM4IDg0Ljc3Miw4NS4wNyBMODQuNzcyLDcwLjYwMiBDODQuNzcyLDY4LjUyMiA4NS41ODksNjcuMzI2IDg2Ljg1NCw2Ny4zMjYgTDg4LjQyNCw2Ny4zMjYgTDg4LjQyNCw2MC42NzQgTDg2Ljg1NCw2MC42NzQgQzg1LjU4OSw2MC42NzQgODQuNzcyLDU5LjQ3OCA4NC43NzIsNTcuMzk4IEw4NC43NzIsNDMuMDAxIEM4NC43NzIsMzYuNjMzIDgwLjExMywzMS45NDkgNzQuNDIzLDMxLjk0OSB6IE05Ny41OCw0OS44OTMgTDg4LjA3OSw0OS44OTMgTDkwLjQ1MSw1Mi41MTcgTDEwMC43NDQsNjMuOTAzIEw5MC40NDIsNzUuNDkzIEw4OC4xMTgsNzguMTA3IEw5Ny41ODgsNzguMTA3IEw5OC4wNTcsNzcuNTggTDEwOS4yOTQsNjQuOTM4IEwxMTAuMjI5LDYzLjg4NiBMMTA5LjI4NSw2Mi44NDEgTDk4LjA0OCw1MC40MSBMOTcuNTgsNDkuODkzIHoiIGZpbGw9IiNCQTcwRDYiLz4KICA8L2c+Cjwvc3ZnPgo="},{"_id": "cw-Sys-Diff-4vx1","_rev": "28-d59853473c77f87b525581aa65839ac5","name": "Sys.Diff","title": "JSON Diff","type": "manifest","desc": "Diff viewer","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Sys.Diff","build": 27,"app": {"name": "Sys.Diff","title": "JSON Diff","version": "2","build": 27,"timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00Mi42NDYsNDIuNzEgTDYxLjk4NSw0Mi43MSBMNjEuOTg1LDg1LjI5IEw0Mi42NDYsODUuMjkgTDQyLjY0Niw0Mi43MSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik02Ny45MTgsNDIuNzEgTDg1LjY2OCw0Mi43MSBMODUuNjY4LDg1LjI5IEw2Ny45MTgsODUuMjkgTDY3LjkxOCw0Mi43MSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik00Mi43MSw4NS4yOSBDMzAuOTUxLDg1LjI5IDIxLjQxOSw3NS43NTggMjEuNDE5LDY0IEMyMS40MTksNTIuMjQyIDMwLjk1MSw0Mi43MSA0Mi43MSw0Mi43MSBDNTQuNDY4LDQyLjcxIDY0LDUyLjI0MiA2NCw2NCBDNjQsNzUuNzU4IDU0LjQ2OCw4NS4yOSA0Mi43MSw4NS4yOSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik04NS4yOSw4NS4yOSBDNzMuNTMyLDg1LjI5IDY0LDc1Ljc1OCA2NCw2NCBDNjQsNTIuMjQyIDczLjUzMiw0Mi43MSA4NS4yOSw0Mi43MSBDOTcuMDQ4LDQyLjcxIDEwNi41OCw1Mi4yNDIgMTA2LjU4LDY0IEMxMDYuNTgsNzUuNzU4IDk3LjA0OCw4NS4yOSA4NS4yOSw4NS4yOSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik0zMy4wMjUsNjIuMzQzIEw0Mi45NjgsNjIuMzQzIEw0Mi45NjgsNTIuMTcgTDQ2LjI4Myw1Mi4xNyBMNDYuMjgzLDYyLjM0MyBMNTYuMjI2LDYyLjM0MyBMNTYuMjI2LDY1LjY1NyBMNDYuMjgzLDY1LjY1NyBMNDYuMjgzLDc1LjgzIEw0Mi45NjgsNzUuODMgTDQyLjk2OCw2NS42NTcgTDMzLjAyNSw2NS42NTcgeiIgZmlsbD0iIzNFOEYwMCIvPgogICAgICA8cGF0aCBkPSJNNzUuMzc2LDYyLjI5NyBMOTQuMzcsNjIuMjk3IEw5NC4zNyw2NS43MDMgTDc1LjM3Niw2NS43MDMgeiIgZmlsbD0iI0Q2MDAwMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTYxLjk4NSw0My41ODUgTDY3LjkxOCw0My41ODUgTDY3LjkxOCw4NC43MjggTDYxLjk4NSw4NC43MjggTDYxLjk4NSw0My41ODUgeiIgZmlsbD0iI0ZGRDMwMCIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": ["cmd","doc._id"],"nodetitle": "title","nodedoc": "doc","nodecmd": "cmd","width": [900],"collapsed": [],"padding": "auto","types": {"*": ["edit","view","diff"]}},"require": [{"jsondiffpatch": "lib/diff.js"}],"params": {},"data": {"cmd": "","title": "Diff","doc": {},"json": [],"r": {},"settings": ["nolog"],"rev": ["-","-"]},"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data;\n\t\t$o.formgen([that.HTML]);\n\t\tthat.Diff = jsondiffpatch.create({\n        objectHash: function(obj, index) {\n\t\t\t\t\tif (Object.isArray(obj) && Object.isNumber(obj[0])) {\n\t\t\t\t\t\treturn obj[0]+\"\";\n\t\t\t\t\t} else if (Object.isObject(obj)){\n\t\t\t\t\t\tif (obj._id !== void 0) return obj._id+\"\";\n\t\t\t\t\t\tif (obj.id !== void 0) return obj.id+\"\";\n\t\t\t\t\t\tif (obj.name !== void 0) return obj.name+\"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn '$$index:' + index;\n        }\n    });\n\t\t$o.then(function(){\n\t\t\tif (d.doc._id) that.Req(d.doc._id);\n\t\t});\n\t\t\n\t\t//!WyJlZGl0IiwiMTQ0OTcwMDUyNzMyNXBjZzB4eDQiXQ--\n\t}","ui": {"#docid": "doc._id","input[name=\"settings\"]": "settings","#diff": {"delay": 100,"bind": "function (d) {\n\t\t\tvar that = this,\n\t\t\t\t\tdelta,\n\t\t\t\t\tj = d.json,\n\t\t\t\t\tlog = (d.settings.indexOf(\"nolog\")==-1),\n\t\t\t\t\ta0, a1;\n\t\t\tif (d.rev[0]==\"-\" || d.rev[1]==\"-\") return '<div class=\"tac p50 orange\">Select revisions</div>';\n\t\t\t\n\t\t\ta0 = log?j[0]:Object.reject(j[0],\"log\");\n\t\t\ta1 = log?j[1]:Object.reject(j[1],\"log\");\n\t\t\tdelta = that.Diff.diff(a0, a1);\n\t\t\tif (void 0 == delta) return '<div class=\"tac p50 green\">No diff</div>';\n\n\t\t\tif (d.settings.indexOf(\"unchanged\")==-1) jsondiffpatch.formatters.html.hideUnchanged();\n\t\t\telse jsondiffpatch.formatters.html.showUnchanged();\n\n\t\t\treturn jsondiffpatch.formatters.html.format(delta, a0);\n\t\t}","watch": "input[name=\"settings\"],#rev"},"#rev0": {"bind": "rev.0","init": "function ($o) {\n\t\t\t$o.select2();\n\t\t}"},"#rev1": {"bind": "rev.1","init": "function ($o) {\n\t\t\t$o.select2();\n\t\t}"},"#proxy": {"delay": 300,"bind": "function (d) {\n\t\t\tvar that = this;\n\t\t\tif (d.rev[0]!=\"-\" && d.rev[1]!=\"-\") that.Req.debounce(0)(d.doc._id, d.rev);\n\t\t}","watch": "#rev0,#rev1"}},"HTML": "<div class=\"fs80 w900 oh\">\n\t<div class=\"fr\">\n\t\t<label class=\"dib\"><input type=\"checkbox\" name=\"settings\" value=\"nolog\"> No .log</label>\n\t\t<label class=\"ml20 dib\"><input type=\"checkbox\" name=\"settings\" value=\"unchanged\"> Show unchanged</label>\n\t</div>\n\t<h3>Compare revisions of _id:<span id=\"docid\"></span></h3>\n\t<div class=\"mt10\">\n\t\t<select id=\"rev0\" class=\"w430 fs110\"><option value=\"-\">Source revision...</option></select><span \n\t\tclass=\"dib w40 tac\">vs</span><select id=\"rev1\" class=\"w430 fs110\"><option value=\"-\">Target revision...</option></select>\n\t</div>\n\t\n\t<div id=\"diff\" class=\"lh120 mt10 fs80\"></div>\n\t<div id=\"proxy\" class=\"hide\"></div>\n</div>","style": {" pre": "max-width:700px;overflow:hidden;text-overflow:ellipsis;white-space: auto;word-break:auto;"," .jsondiffpatch-delta": "padding-left:0"," .w430": "width:430px"},"Req": "function (id,rev) {\n\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tj = d.json,\n\t\t\tt = '<option value=\"{rev}\">{txt}</option>',\n\t\t\tctr = 2;\n\tif (!rev) {\n\t\tthat.db.get(id,{revs_info:true, conflicts:true})\n\t\t.then(function(doc){\n\t\t\tj[0] = Object.reject(doc, [\"_revs_info\",\"_conflicts\"]);\n\t\t\tvar p = [];\n\t\t\t$.extend(true,[],(doc._conflicts||[]))\n\t\t\t.forEach(function(e){\n\t\t\t\tp.push(t.assign({rev:e,txt:\"× \"+e}));\n\t\t\t});\n\t\t\t$.extend(true,[],doc._revs_info)\n\t\t\t.forEach(function(e){\n\t\t\t\te.txt = e.rev;\n\t\t\t\tif (e.status==\"available\") p.push(t.assign(e));\n\t\t\t});\n\t\t\tthat.my.find(\"#rev0\").append(p.join(\"\"));\n\t\t\tthat.my.find(\"#rev1\").append(p.join(\"\"));\n\t\t});\n\t} else {\n\t\t\n\t\t[0,1].forEach(function(i){\n\t\t\tif (d.r[rev[i]]) {\n\t\t\t\tj[i] = d.r[rev[i]];\n\t\t\t\t_ready();\n\t\t\t} else {\n\t\t\t\tthat.db.get(id,{rev:rev[i]})\n\t\t\t\t.then(function(doc){\n\t\t\t\t\td[doc._rev] = j[i] = doc;\n\t\t\t\t\t_ready();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction _ready(){\n\t\tctr-=1;\n\t\tif (!ctr) that.my.check(\"#diff\");\n\t}\n\t\n}"},"raw": {"name": "Sys.Diff","title": "JSON Diff","version": "2","build": 27,"com": [{"stamp": "1451182346843","id": "Root","type": "js","data": "({\n  \n  // CloudWall JSON diff\n  // (c) 2018 ermouth\n  \n\trequire:[{\n\t\t\"jsondiffpatch\":\"lib/diff.js\"\n\t}],\n\tparams:{},\n\tdata:{\n\t\tcmd:\"\",\n\t\ttitle:\"Diff\",\n\t\tdoc:{},\n\t\tjson:[],\n\t\tr:{},\n\t\tsettings:[\"nolog\"],\n\t\trev:[\"-\",\"-\"]\n\t},\n\tinit: function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td = form.data;\n\t\t$o.formgen([that.HTML]);\n\t\tthat.Diff = jsondiffpatch.create({\n        objectHash: function(obj, index) {\n\t\t\t\t\tif (Object.isArray(obj) && Object.isNumber(obj[0])) {\n\t\t\t\t\t\treturn obj[0]+\"\";\n\t\t\t\t\t} else if (Object.isObject(obj)){\n\t\t\t\t\t\tif (obj._id !== void 0) return obj._id+\"\";\n\t\t\t\t\t\tif (obj.id !== void 0) return obj.id+\"\";\n\t\t\t\t\t\tif (obj.name !== void 0) return obj.name+\"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn '$$index:' + index;\n        }\n    });\n\t\t$o.then(function(){\n\t\t\tif (d.doc._id) that.Req(d.doc._id);\n\t\t});\n\t\t\n\t\t//!WyJlZGl0IiwiMTQ0OTcwMDUyNzMyNXBjZzB4eDQiXQ--\n\t}\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1451206549174","id": ".ui","type": "js","data": "({\n\t\"#docid\":\"doc._id\",\n\t'input[name=\"settings\"]':\"settings\",\n\t\"#diff\":{\n\t\tdelay:100,\n\t\tbind: function(d){\n\t\t\tvar that = this,\n\t\t\t\t\tdelta,\n\t\t\t\t\tj = d.json,\n\t\t\t\t\tlog = (d.settings.indexOf(\"nolog\")==-1),\n\t\t\t\t\ta0, a1;\n\t\t\tif (d.rev[0]==\"-\" || d.rev[1]==\"-\") return '<div class=\"tac p50 orange\">Select revisions</div>';\n\t\t\t\n\t\t\ta0 = log?j[0]:Object.reject(j[0],\"log\");\n\t\t\ta1 = log?j[1]:Object.reject(j[1],\"log\");\n\t\t\tdelta = that.Diff.diff(a0, a1);\n\t\t\tif (void 0 == delta) return '<div class=\"tac p50 green\">No diff</div>';\n\n\t\t\tif (d.settings.indexOf(\"unchanged\")==-1) jsondiffpatch.formatters.html.hideUnchanged();\n\t\t\telse jsondiffpatch.formatters.html.showUnchanged();\n\n\t\t\treturn jsondiffpatch.formatters.html.format(delta, a0);\n\t\t},\n\t\twatch:'input[name=\"settings\"],#rev'\n\t},\n\t\"#rev0\":{\n\t\tbind: \"rev.0\",\n\t\tinit: function($o){\n\t\t\t$o.select2();\n\t\t}\n\t},\n\t\"#rev1\":{\n\t\tbind: \"rev.1\",\n\t\tinit: function($o){\n\t\t\t$o.select2();\n\t\t}\n\t},\n\t\"#proxy\":{\n\t\tdelay:300,\n\t\tbind: function(d){\n\t\t\tvar that = this;\n\t\t\tif (d.rev[0]!=\"-\" && d.rev[1]!=\"-\") that.Req.debounce(0)(d.doc._id, d.rev);\n\t\t},\n\t\twatch:\"#rev0,#rev1\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1451183287663","id": ".HTML","type": "html","data": "<div class=\"fs80 w900 oh\">\n\t<div class=\"fr\">\n\t\t<label class=\"dib\"><input type=\"checkbox\" name=\"settings\" value=\"nolog\"> No .log</label>\n\t\t<label class=\"ml20 dib\"><input type=\"checkbox\" name=\"settings\" value=\"unchanged\"> Show unchanged</label>\n\t</div>\n\t<h3>Compare revisions of _id:<span id=\"docid\"></span></h3>\n\t<div class=\"mt10\">\n\t\t<select id=\"rev0\" class=\"w430 fs110\"><option value=\"-\">Source revision...</option></select><span \n\t\tclass=\"dib w40 tac\">vs</span><select id=\"rev1\" class=\"w430 fs110\"><option value=\"-\">Target revision...</option></select>\n\t</div>\n\t\n\t<div id=\"diff\" class=\"lh120 mt10 fs80\"></div>\n\t<div id=\"proxy\" class=\"hide\"></div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1451184110806","id": ".style","type": "js","data": "({\n\t\" pre\":\"max-width:700px;overflow:hidden;text-overflow:ellipsis;white-space: auto;word-break:auto;\",\n\t\" .jsondiffpatch-delta\":\"padding-left:0\",\n\t\" .w430\":\"width:430px\"\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1451203770509","id": ".Req","type": "js","data": "(function(id, rev){\n\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tj = d.json,\n\t\t\tt = '<option value=\"{rev}\">{txt}</option>',\n\t\t\tctr = 2;\n\tif (!rev) {\n\t\tthat.db.get(id,{revs_info:true, conflicts:true})\n\t\t.then(function(doc){\n\t\t\tj[0] = Object.reject(doc, [\"_revs_info\",\"_conflicts\"]);\n\t\t\tvar p = [];\n\t\t\t$.extend(true,[],(doc._conflicts||[]))\n\t\t\t.forEach(function(e){\n\t\t\t\tp.push(t.assign({rev:e,txt:\"× \"+e}));\n\t\t\t});\n\t\t\t$.extend(true,[],doc._revs_info)\n\t\t\t.forEach(function(e){\n\t\t\t\te.txt = e.rev;\n\t\t\t\tif (e.status==\"available\") p.push(t.assign(e));\n\t\t\t});\n\t\t\tthat.my.find(\"#rev0\").append(p.join(\"\"));\n\t\t\tthat.my.find(\"#rev1\").append(p.join(\"\"));\n\t\t});\n\t} else {\n\t\t\n\t\t[0,1].forEach(function(i){\n\t\t\tif (d.r[rev[i]]) {\n\t\t\t\tj[i] = d.r[rev[i]];\n\t\t\t\t_ready();\n\t\t\t} else {\n\t\t\t\tthat.db.get(id,{rev:rev[i]})\n\t\t\t\t.then(function(doc){\n\t\t\t\t\td[doc._rev] = j[i] = doc;\n\t\t\t\t\t_ready();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction _ready(){\n\t\tctr-=1;\n\t\tif (!ctr) that.my.check(\"#diff\");\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1451182487136","id": ".data.doc","type": "js","data": "({\n\t_id:\"1449700527325pcg0xx4\"\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["green"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00Mi42NDYsNDIuNzEgTDYxLjk4NSw0Mi43MSBMNjEuOTg1LDg1LjI5IEw0Mi42NDYsODUuMjkgTDQyLjY0Niw0Mi43MSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik02Ny45MTgsNDIuNzEgTDg1LjY2OCw0Mi43MSBMODUuNjY4LDg1LjI5IEw2Ny45MTgsODUuMjkgTDY3LjkxOCw0Mi43MSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik00Mi43MSw4NS4yOSBDMzAuOTUxLDg1LjI5IDIxLjQxOSw3NS43NTggMjEuNDE5LDY0IEMyMS40MTksNTIuMjQyIDMwLjk1MSw0Mi43MSA0Mi43MSw0Mi43MSBDNTQuNDY4LDQyLjcxIDY0LDUyLjI0MiA2NCw2NCBDNjQsNzUuNzU4IDU0LjQ2OCw4NS4yOSA0Mi43MSw4NS4yOSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik04NS4yOSw4NS4yOSBDNzMuNTMyLDg1LjI5IDY0LDc1Ljc1OCA2NCw2NCBDNjQsNTIuMjQyIDczLjUzMiw0Mi43MSA4NS4yOSw0Mi43MSBDOTcuMDQ4LDQyLjcxIDEwNi41OCw1Mi4yNDIgMTA2LjU4LDY0IEMxMDYuNTgsNzUuNzU4IDk3LjA0OCw4NS4yOSA4NS4yOSw4NS4yOSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik0zMy4wMjUsNjIuMzQzIEw0Mi45NjgsNjIuMzQzIEw0Mi45NjgsNTIuMTcgTDQ2LjI4Myw1Mi4xNyBMNDYuMjgzLDYyLjM0MyBMNTYuMjI2LDYyLjM0MyBMNTYuMjI2LDY1LjY1NyBMNDYuMjgzLDY1LjY1NyBMNDYuMjgzLDc1LjgzIEw0Mi45NjgsNzUuODMgTDQyLjk2OCw2NS42NTcgTDMzLjAyNSw2NS42NTcgeiIgZmlsbD0iIzNFOEYwMCIvPgogICAgICA8cGF0aCBkPSJNNzUuMzc2LDYyLjI5NyBMOTQuMzcsNjIuMjk3IEw5NC4zNyw2NS43MDMgTDc1LjM3Niw2NS43MDMgeiIgZmlsbD0iI0Q2MDAwMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTYxLjk4NSw0My41ODUgTDY3LjkxOCw0My41ODUgTDY3LjkxOCw4NC43MjggTDYxLjk4NSw4NC43MjggTDYxLjk4NSw0My41ODUgeiIgZmlsbD0iI0ZGRDMwMCIvPgogIDwvZz4KPC9zdmc+Cg==","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "*","actions": ["edit","view","diff"]}],"_opts": {"compileTo": ["js"],"runWidth": "900","runMode": ["fullscreen"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Diff viewer","timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00Mi42NDYsNDIuNzEgTDYxLjk4NSw0Mi43MSBMNjEuOTg1LDg1LjI5IEw0Mi42NDYsODUuMjkgTDQyLjY0Niw0Mi43MSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik02Ny45MTgsNDIuNzEgTDg1LjY2OCw0Mi43MSBMODUuNjY4LDg1LjI5IEw2Ny45MTgsODUuMjkgTDY3LjkxOCw0Mi43MSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik00Mi43MSw4NS4yOSBDMzAuOTUxLDg1LjI5IDIxLjQxOSw3NS43NTggMjEuNDE5LDY0IEMyMS40MTksNTIuMjQyIDMwLjk1MSw0Mi43MSA0Mi43MSw0Mi43MSBDNTQuNDY4LDQyLjcxIDY0LDUyLjI0MiA2NCw2NCBDNjQsNzUuNzU4IDU0LjQ2OCw4NS4yOSA0Mi43MSw4NS4yOSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik04NS4yOSw4NS4yOSBDNzMuNTMyLDg1LjI5IDY0LDc1Ljc1OCA2NCw2NCBDNjQsNTIuMjQyIDczLjUzMiw0Mi43MSA4NS4yOSw0Mi43MSBDOTcuMDQ4LDQyLjcxIDEwNi41OCw1Mi4yNDIgMTA2LjU4LDY0IEMxMDYuNTgsNzUuNzU4IDk3LjA0OCw4NS4yOSA4NS4yOSw4NS4yOSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik0zMy4wMjUsNjIuMzQzIEw0Mi45NjgsNjIuMzQzIEw0Mi45NjgsNTIuMTcgTDQ2LjI4Myw1Mi4xNyBMNDYuMjgzLDYyLjM0MyBMNTYuMjI2LDYyLjM0MyBMNTYuMjI2LDY1LjY1NyBMNDYuMjgzLDY1LjY1NyBMNDYuMjgzLDc1LjgzIEw0Mi45NjgsNzUuODMgTDQyLjk2OCw2NS42NTcgTDMzLjAyNSw2NS42NTcgeiIgZmlsbD0iIzNFOEYwMCIvPgogICAgICA8cGF0aCBkPSJNNzUuMzc2LDYyLjI5NyBMOTQuMzcsNjIuMjk3IEw5NC4zNyw2NS43MDMgTDc1LjM3Niw2NS43MDMgeiIgZmlsbD0iI0Q2MDAwMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTYxLjk4NSw0My41ODUgTDY3LjkxOCw0My41ODUgTDY3LjkxOCw4NC43MjggTDYxLjk4NSw4NC43MjggTDYxLjk4NSw0My41ODUgeiIgZmlsbD0iI0ZGRDMwMCIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": "","nodetitle": "title","nodedoc": "doc","nodecmd": "cmd","types": "","width": [900],"collapsed": [],"padding": "auto"},"log": [[1539883834919,"update","ermouth-524yb546",28,"dev-cloudwall2"]],"id": "cw.Sys.Diff","stamp": 1539883834919,"creator": "ermouth-1ermouth","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPHBhdGggZD0iTTY0LDEyMi44NTkgQzMxLjQ5MywxMjIuODU5IDUuMTQxLDk2LjUwNyA1LjE0MSw2NCBDNS4xNDEsMzEuNDkzIDMxLjQ5Myw1LjE0MSA2NCw1LjE0MSBDOTYuNTA3LDUuMTQxIDEyMi44NTksMzEuNDkzIDEyMi44NTksNjQgQzEyMi44NTksOTYuNTA3IDk2LjUwNywxMjIuODU5IDY0LDEyMi44NTkgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik00Mi42NDYsNDIuNzEgTDYxLjk4NSw0Mi43MSBMNjEuOTg1LDg1LjI5IEw0Mi42NDYsODUuMjkgTDQyLjY0Niw0Mi43MSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik02Ny45MTgsNDIuNzEgTDg1LjY2OCw0Mi43MSBMODUuNjY4LDg1LjI5IEw2Ny45MTgsODUuMjkgTDY3LjkxOCw0Mi43MSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik00Mi43MSw4NS4yOSBDMzAuOTUxLDg1LjI5IDIxLjQxOSw3NS43NTggMjEuNDE5LDY0IEMyMS40MTksNTIuMjQyIDMwLjk1MSw0Mi43MSA0Mi43MSw0Mi43MSBDNTQuNDY4LDQyLjcxIDY0LDUyLjI0MiA2NCw2NCBDNjQsNzUuNzU4IDU0LjQ2OCw4NS4yOSA0Mi43MSw4NS4yOSB6IiBmaWxsPSIjQTZGMDZFIi8+CiAgICAgIDxwYXRoIGQ9Ik04NS4yOSw4NS4yOSBDNzMuNTMyLDg1LjI5IDY0LDc1Ljc1OCA2NCw2NCBDNjQsNTIuMjQyIDczLjUzMiw0Mi43MSA4NS4yOSw0Mi43MSBDOTcuMDQ4LDQyLjcxIDEwNi41OCw1Mi4yNDIgMTA2LjU4LDY0IEMxMDYuNTgsNzUuNzU4IDk3LjA0OCw4NS4yOSA4NS4yOSw4NS4yOSB6IiBmaWxsPSIjRkZBQ0FDIi8+CiAgICAgIDxwYXRoIGQ9Ik0zMy4wMjUsNjIuMzQzIEw0Mi45NjgsNjIuMzQzIEw0Mi45NjgsNTIuMTcgTDQ2LjI4Myw1Mi4xNyBMNDYuMjgzLDYyLjM0MyBMNTYuMjI2LDYyLjM0MyBMNTYuMjI2LDY1LjY1NyBMNDYuMjgzLDY1LjY1NyBMNDYuMjgzLDc1LjgzIEw0Mi45NjgsNzUuODMgTDQyLjk2OCw2NS42NTcgTDMzLjAyNSw2NS42NTcgeiIgZmlsbD0iIzNFOEYwMCIvPgogICAgICA8cGF0aCBkPSJNNzUuMzc2LDYyLjI5NyBMOTQuMzcsNjIuMjk3IEw5NC4zNyw2NS43MDMgTDc1LjM3Niw2NS43MDMgeiIgZmlsbD0iI0Q2MDAwMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTYxLjk4NSw0My41ODUgTDY3LjkxOCw0My41ODUgTDY3LjkxOCw4NC43MjggTDYxLjk4NSw4NC43MjggTDYxLjk4NSw0My41ODUgeiIgZmlsbD0iI0ZGRDMwMCIvPgogIDwvZz4KPC9zdmc+Cg=="},{"_id": "cw-Sys-Db-Dump-Apply-4vx1","_rev": "23-42411083fa1e0d16dd86354db1b63730","name": "Sys.Db.Dump.Apply","title": "Apply DB dump","type": "manifest","desc": "Applies DB *.json dump","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Sys.Db.Dump.Apply","build": 32,"app": {"name": "Sys.Db.Dump.Apply","title": "Apply DB dump","version": "2","build": 32,"timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik0xMTUuODY3LDIxLjg3IEw3MS42NDUsMjEuODcgQzY4Ljc5NSwxOC40NzUgNjUuODY2LDE0Ljg5OCA2NS4xMDYsMTMuODEyIEM2NC4zNywxMi4yNzcgNjIuNzkyLDExLjIyMSA2MC45NjYsMTEuMjIxIEwyOS4yNSwxMS4yMjEgQzI3Ljg2MiwxMS4yMjEgMjYuNTUsMTEuODQ2IDI1LjY4LDEyLjkxOSBMMTguNDUsMjEuODcxIEwxMi4xMzQsMjEuODcxIEM3Ljc4NCwyMS44NzEgNC4yMzcsMjUuMzk2IDQuMjM3LDI5LjczIEw0LjIzNyw5OC45MjMgQzQuMjM3LDEwMy4yNTcgNy43ODQsMTA2Ljc3OSAxMi4xMzQsMTA2Ljc3OSBMMTE1Ljg2NiwxMDYuNzc5IEMxMjAuMjE2LDEwNi43NzkgMTIzLjc2MywxMDMuMjU3IDEyMy43NjMsOTguOTIzIEwxMjMuNzYzLDI5LjcyOCBDMTIzLjc2NSwyNS4zOTUgMTIwLjIxNiwyMS44NyAxMTUuODY3LDIxLjg3IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTYwLjk2Niw4IEM2My44MzUsOC4wNjYgNjYuMzY5LDkuNTE5IDY3Ljc5MiwxMi4wMTMgQzY5LjUxMSwxNC4yNzkgNzEuMzM3LDE2LjQ2NyA3My4xNjIsMTguNjQ5IEwxMTUuODY3LDE4LjY0OSBDMTIyLjAwNiwxOC42NDkgMTI3LjAwMiwyMy42MTggMTI3LDI5LjcyOCBMMTI3LDk4LjkyMyBDMTI3LDEwNS4wMzQgMTIyLjAwNSwxMTAgMTE1Ljg2NiwxMTAgTDEyLjEzNCwxMTAgQzUuOTk1LDExMCAxLDEwNS4wMzQgMSw5OC45MjMgTDEsMjkuNzMgQzEsMjMuNjE5IDUuOTk1LDE4LjY1IDEyLjEzNCwxOC42NSBMMTYuODk5LDE4LjY1IEwyMy4xNjEsMTAuODk3IEMyNC42NDUsOS4wNjUgMjYuODg0LDggMjkuMjUsOCBMNjAuOTY2LDggeiBNNjAuOTY2LDE0LjQ0MiBMMjkuMjUsMTQuNDQyIEMyOC44NDEsMTQuNDQyIDI4LjQ1NiwxNC42MjYgMjguMjAzLDE0LjkzNyBMMjAuOTczLDIzLjg4OSBMMjAuMDAxLDI1LjA5MiBMMTIuMTM0LDI1LjA5MiBDOS41NywyNS4wOTIgNy40NzQsMjcuMTc3IDcuNDc0LDI5LjczIEw3LjQ3NCw5OC45MjMgQzcuNDc0LDEwMS40NzUgOS41NjksMTAzLjU1OCAxMi4xMzQsMTAzLjU1OCBMMTE1Ljg2NiwxMDMuNTU4IEMxMTguNDMxLDEwMy41NTggMTIwLjUyNiwxMDEuNDc1IDEyMC41MjYsOTguOTIzIEwxMjAuNTI2LDI5LjcyNyBDMTIwLjUyNywyNy4xNzYgMTE4LjQzMSwyNS4wOTEgMTE1Ljg2NywyNS4wOTEgTDcwLjEzMiwyNS4wOTEgTDY5LjE2MSwyMy45MzUgQzY1LjkzNSwyMC4wOTIgNjMuMjMzLDE2Ljc3MSA2Mi40NSwxNS42NTMgTDYyLjI5OSwxNS40MzcgTDYyLjE4NSwxNS4xOTkgQzYxLjk2NSwxNC43NDEgNjEuNDk2LDE0LjQ0MiA2MC45NjYsMTQuNDQyIHoiIGZpbGw9IiMwMUMzOUEiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik04NS41NzIsNTYuNzc1IEM4My4wOTYsNDcuNjYzIDc1LjM3LDQxLjI3NSA2Ni40MzMsNDEuMjc1IEM2MC4yMDIsNDEuMjc1IDU0LjM5Nyw0NC40MDIgNTAuNjI0LDQ5LjcxIEM0OS41NzcsNDkuNDczIDQ4LjUxNyw0OS4zNSA0Ny40NDksNDkuMzUgQzM5LjA2NCw0OS4zNDkgMzIuMjQsNTYuNzQ2IDMyLjI0LDY1Ljg0MiBDMzIuMjQsNjkuMTAzIDMzLjEyMyw3Mi4yNjIgMzQuNzg4LDc0Ljk3OSBDMzUuMTc5LDc1LjYxNCAzNS44MzksNzUuOTk2IDM2LjU0NCw3NS45OTYgTDUwLjU5Nyw3NS45OTYgQzUwLjY5Nyw2OS40OTMgNTYuMDE5LDY0LjI1IDYyLjU3OCw2NC4yNSBDNjkuMTM3LDY0LjI1IDc0LjQ1OCw2OS40OTMgNzQuNTU5LDc1Ljk5NiBMOTMuNTY0LDc1Ljk5NiBDOTQuMjMyLDc1Ljk5NiA5NC44NTksNzUuNjU1IDk1LjI1OSw3NS4wNzMgQzk2LjY0NSw3My4wNTQgOTcuMzc4LDcwLjY4MiA5Ny4zNzgsNjguMjE3IEM5Ny4zNzcsNjEuNDM5IDkxLjg2NSw1NS45NTQgODUuNTcyLDU2Ljc3NSB6IiBmaWxsPSIjMDFCQzk0Ii8+CiAgICA8cGF0aCBkPSJNNTQuOTQ1LDgwLjc1MSBMNjEuOTQsOTAuNDggQzYyLjA2Nyw5MC42NTYgNjIuMjczLDkwLjc2MSA2Mi40OSw5MC43NjEgTDYyLjQ5MSw5MC43NjEgQzYyLjcxLDkwLjc2MSA2Mi45MTMsOTAuNjU2IDYzLjA0MSw5MC40NzcgTDY5Ljk5MSw4MC43NTEgQzcwLjEzNyw4MC41NDYgNzAuMTU1LDgwLjI3OCA3MC4wNCw4MC4wNTIgQzY5LjkyNCw3OS44MjggNjkuNjkxLDc5LjY4OSA2OS40MzgsNzkuNjg5IEw2Ni4xNjksNzkuNjg5IEw2Ni4xNjksNzAuOTUxIEM2Ni4xNjksNzAuNTc4IDY1Ljg2Niw3MC4yNzcgNjUuNDk0LDcwLjI3NyBMNTkuNDQyLDcwLjI3NyBDNTkuMDY4LDcwLjI3NyA1OC43NjYsNzAuNTc4IDU4Ljc2Niw3MC45NTEgTDU4Ljc2Niw3OS42ODkgTDU1LjQ5NSw3OS42ODkgQzU1LjI0Miw3OS42ODkgNTUuMDEsNzkuODMxIDU0Ljg5NSw4MC4wNTIgQzU0Ljc3OCw4MC4yNzggNTQuNzk4LDgwLjU0NiA1NC45NDUsODAuNzUxIHoiIGZpbGw9IiNGRjRGMDAiLz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": "","nodetitle": "","width": [700],"collapsed": [],"padding": "auto"},"params": {},"data": {"url": "","doclist": null},"init": "function ($form,form) {\n\t\t$form.html(this.HTML)\n\t}","ui": {"#nurl": {"bind": "url","css": {"self:hide": "function (d) { return !!d.doclist}"}},"#nfile": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tf,\n\t\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\t\timg=\"\";\n\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tri = JSON.parse(e.target.result);\n\t\t\t\t\t\t\t} catch(e){}\n\n\t\t\t\t\t\t\tif (Object.isArray(ri)) {\n\t\t\t\t\t\t\t\td.doclist = ri;\n\t\t\t\t\t\t\t\tcw.lib.note('Loaded '+ri.length+' docs.', 'ok', 3000);\n\t\t\t\t\t\t\t\tthat.my.find('#btn-apply').trigger('click');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcw.lib.note('Unable to parse JSON or content is not Array.', 'error', 3000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsText(f);\t\n\t\t\t\t\t})();\n\t\t\t\t} // end if\n\n\n\t\t\t}"},"#dbname": "function () {return this.db.name}","#btn-apply": {"delay": 100,"bind": "function (d,v,$o) {\n\t\tvar that = this;\n\t\tif (v!=null){\n\t\t\tvar pi=$.Deferred(),  \n\t\t\t\t\turl = d.url;\n\t\t\t\n\t\t\tvar db = cw.db(that.db.name);\n\t\t\t\n\t\t\tpi.then(function(a){\n\t\t\t\t$.my.modal();\n\t\t\t\tcw.lib.note(a,\"ok\",5000);\n\t\t\t\t$o.trigger('cancel');\n\t\t\t}).fail(function(a){\n\t\t\t\t$.my.modal();\n\t\t\t\tcw.lib.note(a,\"error\", 3000);\n\t\t\t});\n\t\t\t\n\t\t\tif (d.doclist) _process(d.doclist);\n\t\t\telse {\n\t\t\t\n\t\t\t\t$.my.modal(\n\t\t\t\t\t'<div class=\" pt20 pb15 w350 tac blue\">'\n\t\t\t\t\t+'Loading dump...'\n\t\t\t\t\t+'<br><div class=\"cw-busy w90 mt10\"></div>'\n\t\t\t\t\t+'</div>'\n\t\t\t\t\t,function(){},300);\n\n\t\t\t\t// Read app list\t\n\t\t\t\t$.ajax({ url:url, type:'GET', dataType:'json', cache:false, timeout:600000, headers:{Accept:'application/json'} })\n\t\t\t\t.then(_process)\n\t\t\t\t.fail(function(a,b){\n\t\t\t\t\t$.my.modal();\n\t\t\t\t\tcw.lib.note(\"Failed reading system apps set. Please, try again in several seconds.\", \"error\", 5000)\n\t\t\t\t\tconsole.log(a,b);\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - \n\t\t\n\t\tfunction _process(a){\n\t\t\t\tvar b, i, j, o, news = {}, olds, del={};\n\t\t\t\tif (!Object.isArray(a) || !a.length) {\n\t\t\t\t\t$.my.modal();\n\t\t\t\t\tcw.lib.note(\"Server responded with error. See console for details.\", \"error\", 5000);\n\t\t\t\t\tconsole.log(a);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tb = Object.clone(a, !0)\n\t\t\t\t\tfor (var i=0;i<b.length;i++) {\n\t\t\t\t\t\to=b[i];\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (Object.isString(o)) {\n\t\t\t\t\t\t\t// Wire deletion\n\t\t\t\t\t\t\tdel[o]=true;\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\to.srcrev = o._rev;\n\t\t\t\t\t\t\tdelete o._rev;\n\t\t\t\t\t\t\tif (o._attachments) for (j in o._attachments) {\n\t\t\t\t\t\t\t\to._attachments[j] = Object.select(o._attachments[j],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t}\n              if (Object.isArray(o.log)) {\n              \to.log.length = 0;\n                o.log.unshift([\n                  Date.now(), \n                  'undump', \n                  cw.me()+'-'+cw.me('uid'), \n                  +o.srcrev.split('-')[0], \n                  that.db.name\n                ]);\n              }\n\t\t\t\t\t\t\tnews[o._id] = o;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdb.allDocs({keys:Object.keys(news).add(Object.keys(del)), include_docs:true})\n\t\t\t\t\t.then(\n\t\t\t\t\t\tfunction(res) {\n\t\t\t\t\t\t\tvar i, o, b;\n\n\t\t\t\t\t\t\t// Compare\n\t\t\t\t\t\t\tfor (i=0;i<res.rows.length;i++) {\n\t\t\t\t\t\t\t\to=res.rows[i].doc;\n\t\t\t\t\t\t\t\tif (o && news[o._id]){\n\t\t\t\t\t\t\t\t\tif (news[o._id].srcrev==o.srcrev) delete news[o._id];\n\t\t\t\t\t\t\t\t\telse news[o._id]._rev = o._rev;\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse if (o && del[o._id]){\n\t\t\t\t\t\t\t\t\tnews[o._id]={_id:o._id, _rev:o._rev, _deleted:true, name:o.name}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!Object.size(news)) {\n\t\t\t\t\t\t\t\tpi.resolve(\"All docs are up to date.\",\"ok\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tb = Object.values(news);\n\t\t\t\t\t\t\t\t$.my.modal(true);\n\t\t\t\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\t\t\t\twidth:500,\n\t\t\t\t\t\t\t\t\tmanifest:that.Confirm,\n\t\t\t\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t\t\t\ttext:'<p class=\"xgray\">Select apps and docs to update</p>'\n\t\t\t\t\t\t\t\t\t\t+b.map(function(e){\n\t\t\t\t\t\t\t\t\t\t\treturn '<div class=\"fs90 pb3 dib vat w250 pr20\"><label>'\n\t\t\t\t\t\t\t\t\t\t\t+'<input type=\"checkbox\" class=\"mr5 w15\" value=\"'\n\t\t\t\t\t\t\t\t\t\t\t+e._id+'\" name=\"apps\"/> '\n\t\t\t\t\t\t\t\t\t\t\t+'<span class=\"'+(e._deleted?'tdl':'')+'\">'\n\t\t\t\t\t\t\t\t\t\t\t+ (e._id[0]=='_'?e._id:(e.name || e._id)).stripTags()\n\t\t\t\t\t\t\t\t\t\t\t+'</span></label></div>';\t\n\t\t\t\t\t\t\t\t\t\t}).join(\"\"),\n\t\t\t\t\t\t\t\t\t\tapps:b.map(function(e){return e._id}),\n\t\t\t\t\t\t\t\t\t\tok:\"Update\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tesc:true\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function(res){\n\t\t\t\t\t\t\t\t\tif (Object.isObject(res) && res.apps.length) {\n\t\t\t\t\t\t\t\t\t\tvar list = cw.lib.a2o(res.apps),\n\t\t\t\t\t\t\t\t\t\t\t\tfin = [];\n\t\t\t\t\t\t\t\t\t\tfor(var i=0; i<b.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\tif (list[b[i]._id]) fin.push(b[i]);\t\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdb.bulkDocs({docs:fin}, function(e,res){\n\t\t\t\t\t\t\t\t\t\t\tif(e) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e, fin)\n\t\t\t\t\t\t\t\t\t\t\t\tpi.reject(\"Failed to write documents to local DB.\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t\tpi.resolve(\"Succesfully updated \"+fin.length+\" doc\"+(fin.length>1?\"s\":\"\")+\".\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t\t\t\tpi.reject(\"Update cancelled.\")\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t},\n\t\t\t\t\t\t//err\n\t\t\t\t\t\tfunction(err) {\n\t\t\t\t\t\t\tpi.reject(\"Error fetching new docs. Retry later.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t}"}},"HTML": "<div class=\"pl50 pr50 xgray lh170\">\n\t<h3 class=\"mb20\">Apply DB dump</h3>\n\t<p>\n\t\tThis app applies external DB dump over local DB <b id=\"dbname\"></b>.\n\t\tExternal dump must be JSON array of objects, that are valid CouchDB docs.\n\t</p>\n\t<p>\n\t\tArray can contain strings with doc _id, if destination DB has doc with this _id, doc wired to be deleted.\n\t</p>\n\t<p class=\"pb30\">\n\t\tAfter loading JSON dump app will ask you what changes to apply.\n\t</p>\n\t<div class=\"tac pb30\">\n\t\t<input type=\"text\" id=\"nurl\" placeholder = \"Valid URL of JSON dump\" class=\"w600 fs120\">\n\t\t<br>\n\t\t<input type=\"file\" id=\"nfile\" accept=\"application/json\" class=\"mb10 mt10 fs85 lh120 p10 w100p\" style=\"border:1px solid #ddd\">\n\t\t<br>\n\t\t<button id=\"btn-apply\" class=\"button green w150 br100 mt20 fs110\">Apply</button>\n\t</div>\n</div>","Confirm": {"params": {"delay": 5,"width": 500},"data": {"text": "","css": "xgray","ok": "Ok","cancel": "Cancel","cmd": ""},"init": "function ($o,form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t    '<div id=\"lbls\" class=\"'+d.css+'\" style=\"max-height:400px;overflow-y:scroll;\">'+d.text+'</div>',\n\t\t\t{label:\"70px\", row:\"500px\", rowCss:\"my-row mt15 pt15 fs90 mb-5 xgray btd\"},\n\t\t\t['', 'spn#btn-ok.mr5.button.green',{txt:d.ok}, \n\t\t\t\t'span#btn-cancel.button',{txt:d.cancel}]\n\t\t]);\n\t}","ui": {"#lbls": {"init": "function ($o) {\n      \t\n      }"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd = 'commit';\n\t\t\t\t\t$o.trigger('commit');\n\t\t\t\t}\n\t\t\t}","events": "click.my"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd = 'cancel';\n\t\t\t\t\t$o.trigger('cancel');\n\t\t\t\t}\n\t\t\t}","events": "click.my"},"input[name=apps]": "apps"},"style": {" label": "white-space: nowrap;overflow: hidden; text-overflow: ellipsis;"}}},"raw": {"name": "Sys.Db.Dump.Apply","title": "Apply DB dump","version": "2","build": 32,"com": [{"stamp": "1428279706053","id": "Root","type": "js","data": "({\n  \n  // CloudWall DB dump downloader\n  // (c) 2018 ermouth\n  \n\tparams:{},\n\tdata:{\n\t\turl:\"\",\n\t\tdoclist:null\n\t},\n\tinit: function ($form, form) {\n\t\t$form.html(this.HTML)\n\t},\n\tui:{\n\t\t\"#nurl\":{\n\t\t\tbind: 'url',\n\t\t\tcss:{\n\t\t\t\t'self:hide':function(d){ return !!d.doclist}\n\t\t\t}\n\t\t},\n\t\t\"#nfile\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tf,\n\t\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\t\timg=\"\";\n\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tri = JSON.parse(e.target.result);\n\t\t\t\t\t\t\t} catch(e){}\n\n\t\t\t\t\t\t\tif (Object.isArray(ri)) {\n\t\t\t\t\t\t\t\td.doclist = ri;\n\t\t\t\t\t\t\t\tcw.lib.note('Loaded '+ri.length+' docs.', 'ok', 3000);\n\t\t\t\t\t\t\t\tthat.my.find('#btn-apply').trigger('click');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcw.lib.note('Unable to parse JSON or content is not Array.', 'error', 3000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsText(f);\t\n\t\t\t\t\t})();\n\t\t\t\t} // end if\n\n\n\t\t\t}\n\t\t},\n\t\t\"#dbname\":function(){return this.db.name},\n\t\t\"#btn-apply\":{}\n\t}\n})","active": true,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1428280923811","id": ".ui.#btn-apply","type": "js","data": "({\n\tdelay:100,\n\tbind: function(d,v,$o){\n\t\tvar that = this;\n\t\tif (v!=null){\n\t\t\tvar pi=$.Deferred(),  \n\t\t\t\t\turl = d.url;\n\t\t\t\n\t\t\tvar db = cw.db(that.db.name);\n\t\t\t\n\t\t\tpi.then(function(a){\n\t\t\t\t$.my.modal();\n\t\t\t\tcw.lib.note(a,\"ok\",5000);\n\t\t\t\t$o.trigger('cancel');\n\t\t\t}).fail(function(a){\n\t\t\t\t$.my.modal();\n\t\t\t\tcw.lib.note(a,\"error\", 3000);\n\t\t\t});\n\t\t\t\n\t\t\tif (d.doclist) _process(d.doclist);\n\t\t\telse {\n\t\t\t\n\t\t\t\t$.my.modal(\n\t\t\t\t\t'<div class=\" pt20 pb15 w350 tac blue\">'\n\t\t\t\t\t+'Loading dump...'\n\t\t\t\t\t+'<br><div class=\"cw-busy w90 mt10\"></div>'\n\t\t\t\t\t+'</div>'\n\t\t\t\t\t,function(){},300);\n\n\t\t\t\t// Read app list\t\n\t\t\t\t$.ajax({ url:url, type:'GET', dataType:'json', cache:false, timeout:600000, headers:{Accept:'application/json'} })\n\t\t\t\t.then(_process)\n\t\t\t\t.fail(function(a,b){\n\t\t\t\t\t$.my.modal();\n\t\t\t\t\tcw.lib.note(\"Failed reading system apps set. Please, try again in several seconds.\", \"error\", 5000)\n\t\t\t\t\tconsole.log(a,b);\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t\t\n\t\t// - - - - - \n\t\t\n\t\tfunction _process(a){\n\t\t\t\tvar b, i, j, o, news = {}, olds, del={};\n\t\t\t\tif (!Object.isArray(a) || !a.length) {\n\t\t\t\t\t$.my.modal();\n\t\t\t\t\tcw.lib.note(\"Server responded with error. See console for details.\", \"error\", 5000);\n\t\t\t\t\tconsole.log(a);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tb = Object.clone(a, !0)\n\t\t\t\t\tfor (var i=0;i<b.length;i++) {\n\t\t\t\t\t\to=b[i];\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (Object.isString(o)) {\n\t\t\t\t\t\t\t// Wire deletion\n\t\t\t\t\t\t\tdel[o]=true;\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\to.srcrev = o._rev;\n\t\t\t\t\t\t\tdelete o._rev;\n\t\t\t\t\t\t\tif (o._attachments) for (j in o._attachments) {\n\t\t\t\t\t\t\t\to._attachments[j] = Object.select(o._attachments[j],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t}\n              if (Object.isArray(o.log)) {\n              \to.log.length = 0;\n                o.log.unshift([\n                  Date.now(), \n                  'undump', \n                  cw.me()+'-'+cw.me('uid'), \n                  +o.srcrev.split('-')[0], \n                  that.db.name\n                ]);\n              }\n\t\t\t\t\t\t\tnews[o._id] = o;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdb.allDocs({keys:Object.keys(news).add(Object.keys(del)), include_docs:true})\n\t\t\t\t\t.then(\n\t\t\t\t\t\tfunction(res) {\n\t\t\t\t\t\t\tvar i, o, b;\n\n\t\t\t\t\t\t\t// Compare\n\t\t\t\t\t\t\tfor (i=0;i<res.rows.length;i++) {\n\t\t\t\t\t\t\t\to=res.rows[i].doc;\n\t\t\t\t\t\t\t\tif (o && news[o._id]){\n\t\t\t\t\t\t\t\t\tif (news[o._id].srcrev==o.srcrev) delete news[o._id];\n\t\t\t\t\t\t\t\t\telse news[o._id]._rev = o._rev;\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse if (o && del[o._id]){\n\t\t\t\t\t\t\t\t\tnews[o._id]={_id:o._id, _rev:o._rev, _deleted:true, name:o.name}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!Object.size(news)) {\n\t\t\t\t\t\t\t\tpi.resolve(\"All docs are up to date.\",\"ok\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tb = Object.values(news);\n\t\t\t\t\t\t\t\t$.my.modal(true);\n\t\t\t\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\t\t\t\twidth:500,\n\t\t\t\t\t\t\t\t\tmanifest:that.Confirm,\n\t\t\t\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t\t\t\ttext:'<p class=\"xgray\">Select apps and docs to update</p>'\n\t\t\t\t\t\t\t\t\t\t+b.map(function(e){\n\t\t\t\t\t\t\t\t\t\t\treturn '<div class=\"fs90 pb3 dib vat w250 pr20\"><label>'\n\t\t\t\t\t\t\t\t\t\t\t+'<input type=\"checkbox\" class=\"mr5 w15\" value=\"'\n\t\t\t\t\t\t\t\t\t\t\t+e._id+'\" name=\"apps\"/> '\n\t\t\t\t\t\t\t\t\t\t\t+'<span class=\"'+(e._deleted?'tdl':'')+'\">'\n\t\t\t\t\t\t\t\t\t\t\t+ (e._id[0]=='_'?e._id:(e.name || e._id)).stripTags()\n\t\t\t\t\t\t\t\t\t\t\t+'</span></label></div>';\t\n\t\t\t\t\t\t\t\t\t\t}).join(\"\"),\n\t\t\t\t\t\t\t\t\t\tapps:b.map(function(e){return e._id}),\n\t\t\t\t\t\t\t\t\t\tok:\"Update\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tesc:true\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function(res){\n\t\t\t\t\t\t\t\t\tif (Object.isObject(res) && res.apps.length) {\n\t\t\t\t\t\t\t\t\t\tvar list = cw.lib.a2o(res.apps),\n\t\t\t\t\t\t\t\t\t\t\t\tfin = [];\n\t\t\t\t\t\t\t\t\t\tfor(var i=0; i<b.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\tif (list[b[i]._id]) fin.push(b[i]);\t\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdb.bulkDocs({docs:fin}, function(e,res){\n\t\t\t\t\t\t\t\t\t\t\tif(e) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e, fin)\n\t\t\t\t\t\t\t\t\t\t\t\tpi.reject(\"Failed to write documents to local DB.\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t\tpi.resolve(\"Succesfully updated \"+fin.length+\" doc\"+(fin.length>1?\"s\":\"\")+\".\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t\t\t\tpi.reject(\"Update cancelled.\")\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t},\n\t\t\t\t\t\t//err\n\t\t\t\t\t\tfunction(err) {\n\t\t\t\t\t\t\tpi.reject(\"Error fetching new docs. Retry later.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1428280030383","id": ".HTML","type": "html","data": "<div class=\"pl50 pr50 xgray lh170\">\n\t<h3 class=\"mb20\">Apply DB dump</h3>\n\t<p>\n\t\tThis app applies external DB dump over local DB <b id=\"dbname\"></b>.\n\t\tExternal dump must be JSON array of objects, that are valid CouchDB docs.\n\t</p>\n\t<p>\n\t\tArray can contain strings with doc _id, if destination DB has doc with this _id, doc wired to be deleted.\n\t</p>\n\t<p class=\"pb30\">\n\t\tAfter loading JSON dump app will ask you what changes to apply.\n\t</p>\n\t<div class=\"tac pb30\">\n\t\t<input type=\"text\" id=\"nurl\" placeholder = \"Valid URL of JSON dump\" class=\"w600 fs120\">\n\t\t<br>\n\t\t<input type=\"file\" id=\"nfile\" accept=\"application/json\" class=\"mb10 mt10 fs85 lh120 p10 w100p\" style=\"border:1px solid #ddd\">\n\t\t<br>\n\t\t<button id=\"btn-apply\" class=\"button green w150 br100 mt20 fs110\">Apply</button>\n\t</div>\n</div>","active": false,"opts": [],"err": [],"color": ["orange"]},{"stamp": "1428282911768","id": ".Confirm","type": "js","data": "({\n\tparams:{\n\t\tdelay:5, \n\t\twidth:500 \n\t},\n\tdata:{\n\t\ttext:\"\",\n\t\tcss:\"xgray\",\n\t\tok:\"Ok\",\n\t\tcancel:\"Cancel\",\n\t\tcmd:\"\"\n\t},\n\tinit: function ($o, form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t    '<div id=\"lbls\" class=\"'+d.css+'\" style=\"max-height:400px;overflow-y:scroll;\">'+d.text+'</div>',\n\t\t\t{label:\"70px\", row:\"500px\", rowCss:\"my-row mt15 pt15 fs90 mb-5 xgray btd\"},\n\t\t\t['', 'spn#btn-ok.mr5.button.green',{txt:d.ok}, \n\t\t\t\t'span#btn-cancel.button',{txt:d.cancel}]\n\t\t]);\n\t},\n\tui:{\n    '#lbls':{\n    \tinit:function($o){\n      \t\n      }\n    },\n\t\t'#btn-ok':{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd = 'commit';\n\t\t\t\t\t$o.trigger('commit');\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t},\n\t\t'#btn-cancel':{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd = 'cancel';\n\t\t\t\t\t$o.trigger('cancel');\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t},\n\t\t'input[name=apps]':'apps'\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1465354936924","id": ".Confirm.style","type": "js","data": "({\n\t\n\t' label':'white-space: nowrap;overflow: hidden; text-overflow: ellipsis;'\n})","active": false,"err": [],"opts": [],"color": ["orange"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik0xMTUuODY3LDIxLjg3IEw3MS42NDUsMjEuODcgQzY4Ljc5NSwxOC40NzUgNjUuODY2LDE0Ljg5OCA2NS4xMDYsMTMuODEyIEM2NC4zNywxMi4yNzcgNjIuNzkyLDExLjIyMSA2MC45NjYsMTEuMjIxIEwyOS4yNSwxMS4yMjEgQzI3Ljg2MiwxMS4yMjEgMjYuNTUsMTEuODQ2IDI1LjY4LDEyLjkxOSBMMTguNDUsMjEuODcxIEwxMi4xMzQsMjEuODcxIEM3Ljc4NCwyMS44NzEgNC4yMzcsMjUuMzk2IDQuMjM3LDI5LjczIEw0LjIzNyw5OC45MjMgQzQuMjM3LDEwMy4yNTcgNy43ODQsMTA2Ljc3OSAxMi4xMzQsMTA2Ljc3OSBMMTE1Ljg2NiwxMDYuNzc5IEMxMjAuMjE2LDEwNi43NzkgMTIzLjc2MywxMDMuMjU3IDEyMy43NjMsOTguOTIzIEwxMjMuNzYzLDI5LjcyOCBDMTIzLjc2NSwyNS4zOTUgMTIwLjIxNiwyMS44NyAxMTUuODY3LDIxLjg3IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTYwLjk2Niw4IEM2My44MzUsOC4wNjYgNjYuMzY5LDkuNTE5IDY3Ljc5MiwxMi4wMTMgQzY5LjUxMSwxNC4yNzkgNzEuMzM3LDE2LjQ2NyA3My4xNjIsMTguNjQ5IEwxMTUuODY3LDE4LjY0OSBDMTIyLjAwNiwxOC42NDkgMTI3LjAwMiwyMy42MTggMTI3LDI5LjcyOCBMMTI3LDk4LjkyMyBDMTI3LDEwNS4wMzQgMTIyLjAwNSwxMTAgMTE1Ljg2NiwxMTAgTDEyLjEzNCwxMTAgQzUuOTk1LDExMCAxLDEwNS4wMzQgMSw5OC45MjMgTDEsMjkuNzMgQzEsMjMuNjE5IDUuOTk1LDE4LjY1IDEyLjEzNCwxOC42NSBMMTYuODk5LDE4LjY1IEwyMy4xNjEsMTAuODk3IEMyNC42NDUsOS4wNjUgMjYuODg0LDggMjkuMjUsOCBMNjAuOTY2LDggeiBNNjAuOTY2LDE0LjQ0MiBMMjkuMjUsMTQuNDQyIEMyOC44NDEsMTQuNDQyIDI4LjQ1NiwxNC42MjYgMjguMjAzLDE0LjkzNyBMMjAuOTczLDIzLjg4OSBMMjAuMDAxLDI1LjA5MiBMMTIuMTM0LDI1LjA5MiBDOS41NywyNS4wOTIgNy40NzQsMjcuMTc3IDcuNDc0LDI5LjczIEw3LjQ3NCw5OC45MjMgQzcuNDc0LDEwMS40NzUgOS41NjksMTAzLjU1OCAxMi4xMzQsMTAzLjU1OCBMMTE1Ljg2NiwxMDMuNTU4IEMxMTguNDMxLDEwMy41NTggMTIwLjUyNiwxMDEuNDc1IDEyMC41MjYsOTguOTIzIEwxMjAuNTI2LDI5LjcyNyBDMTIwLjUyNywyNy4xNzYgMTE4LjQzMSwyNS4wOTEgMTE1Ljg2NywyNS4wOTEgTDcwLjEzMiwyNS4wOTEgTDY5LjE2MSwyMy45MzUgQzY1LjkzNSwyMC4wOTIgNjMuMjMzLDE2Ljc3MSA2Mi40NSwxNS42NTMgTDYyLjI5OSwxNS40MzcgTDYyLjE4NSwxNS4xOTkgQzYxLjk2NSwxNC43NDEgNjEuNDk2LDE0LjQ0MiA2MC45NjYsMTQuNDQyIHoiIGZpbGw9IiMwMUMzOUEiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik04NS41NzIsNTYuNzc1IEM4My4wOTYsNDcuNjYzIDc1LjM3LDQxLjI3NSA2Ni40MzMsNDEuMjc1IEM2MC4yMDIsNDEuMjc1IDU0LjM5Nyw0NC40MDIgNTAuNjI0LDQ5LjcxIEM0OS41NzcsNDkuNDczIDQ4LjUxNyw0OS4zNSA0Ny40NDksNDkuMzUgQzM5LjA2NCw0OS4zNDkgMzIuMjQsNTYuNzQ2IDMyLjI0LDY1Ljg0MiBDMzIuMjQsNjkuMTAzIDMzLjEyMyw3Mi4yNjIgMzQuNzg4LDc0Ljk3OSBDMzUuMTc5LDc1LjYxNCAzNS44MzksNzUuOTk2IDM2LjU0NCw3NS45OTYgTDUwLjU5Nyw3NS45OTYgQzUwLjY5Nyw2OS40OTMgNTYuMDE5LDY0LjI1IDYyLjU3OCw2NC4yNSBDNjkuMTM3LDY0LjI1IDc0LjQ1OCw2OS40OTMgNzQuNTU5LDc1Ljk5NiBMOTMuNTY0LDc1Ljk5NiBDOTQuMjMyLDc1Ljk5NiA5NC44NTksNzUuNjU1IDk1LjI1OSw3NS4wNzMgQzk2LjY0NSw3My4wNTQgOTcuMzc4LDcwLjY4MiA5Ny4zNzgsNjguMjE3IEM5Ny4zNzcsNjEuNDM5IDkxLjg2NSw1NS45NTQgODUuNTcyLDU2Ljc3NSB6IiBmaWxsPSIjMDFCQzk0Ii8+CiAgICA8cGF0aCBkPSJNNTQuOTQ1LDgwLjc1MSBMNjEuOTQsOTAuNDggQzYyLjA2Nyw5MC42NTYgNjIuMjczLDkwLjc2MSA2Mi40OSw5MC43NjEgTDYyLjQ5MSw5MC43NjEgQzYyLjcxLDkwLjc2MSA2Mi45MTMsOTAuNjU2IDYzLjA0MSw5MC40NzcgTDY5Ljk5MSw4MC43NTEgQzcwLjEzNyw4MC41NDYgNzAuMTU1LDgwLjI3OCA3MC4wNCw4MC4wNTIgQzY5LjkyNCw3OS44MjggNjkuNjkxLDc5LjY4OSA2OS40MzgsNzkuNjg5IEw2Ni4xNjksNzkuNjg5IEw2Ni4xNjksNzAuOTUxIEM2Ni4xNjksNzAuNTc4IDY1Ljg2Niw3MC4yNzcgNjUuNDk0LDcwLjI3NyBMNTkuNDQyLDcwLjI3NyBDNTkuMDY4LDcwLjI3NyA1OC43NjYsNzAuNTc4IDU4Ljc2Niw3MC45NTEgTDU4Ljc2Niw3OS42ODkgTDU1LjQ5NSw3OS42ODkgQzU1LjI0Miw3OS42ODkgNTUuMDEsNzkuODMxIDU0Ljg5NSw4MC4wNTIgQzU0Ljc3OCw4MC4yNzggNTQuNzk4LDgwLjU0NiA1NC45NDUsODAuNzUxIHoiIGZpbGw9IiNGRjRGMDAiLz4KICA8L2c+Cjwvc3ZnPgo=","_type": ["app"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "700","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Applies DB *.json dump","timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik0xMTUuODY3LDIxLjg3IEw3MS42NDUsMjEuODcgQzY4Ljc5NSwxOC40NzUgNjUuODY2LDE0Ljg5OCA2NS4xMDYsMTMuODEyIEM2NC4zNywxMi4yNzcgNjIuNzkyLDExLjIyMSA2MC45NjYsMTEuMjIxIEwyOS4yNSwxMS4yMjEgQzI3Ljg2MiwxMS4yMjEgMjYuNTUsMTEuODQ2IDI1LjY4LDEyLjkxOSBMMTguNDUsMjEuODcxIEwxMi4xMzQsMjEuODcxIEM3Ljc4NCwyMS44NzEgNC4yMzcsMjUuMzk2IDQuMjM3LDI5LjczIEw0LjIzNyw5OC45MjMgQzQuMjM3LDEwMy4yNTcgNy43ODQsMTA2Ljc3OSAxMi4xMzQsMTA2Ljc3OSBMMTE1Ljg2NiwxMDYuNzc5IEMxMjAuMjE2LDEwNi43NzkgMTIzLjc2MywxMDMuMjU3IDEyMy43NjMsOTguOTIzIEwxMjMuNzYzLDI5LjcyOCBDMTIzLjc2NSwyNS4zOTUgMTIwLjIxNiwyMS44NyAxMTUuODY3LDIxLjg3IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTYwLjk2Niw4IEM2My44MzUsOC4wNjYgNjYuMzY5LDkuNTE5IDY3Ljc5MiwxMi4wMTMgQzY5LjUxMSwxNC4yNzkgNzEuMzM3LDE2LjQ2NyA3My4xNjIsMTguNjQ5IEwxMTUuODY3LDE4LjY0OSBDMTIyLjAwNiwxOC42NDkgMTI3LjAwMiwyMy42MTggMTI3LDI5LjcyOCBMMTI3LDk4LjkyMyBDMTI3LDEwNS4wMzQgMTIyLjAwNSwxMTAgMTE1Ljg2NiwxMTAgTDEyLjEzNCwxMTAgQzUuOTk1LDExMCAxLDEwNS4wMzQgMSw5OC45MjMgTDEsMjkuNzMgQzEsMjMuNjE5IDUuOTk1LDE4LjY1IDEyLjEzNCwxOC42NSBMMTYuODk5LDE4LjY1IEwyMy4xNjEsMTAuODk3IEMyNC42NDUsOS4wNjUgMjYuODg0LDggMjkuMjUsOCBMNjAuOTY2LDggeiBNNjAuOTY2LDE0LjQ0MiBMMjkuMjUsMTQuNDQyIEMyOC44NDEsMTQuNDQyIDI4LjQ1NiwxNC42MjYgMjguMjAzLDE0LjkzNyBMMjAuOTczLDIzLjg4OSBMMjAuMDAxLDI1LjA5MiBMMTIuMTM0LDI1LjA5MiBDOS41NywyNS4wOTIgNy40NzQsMjcuMTc3IDcuNDc0LDI5LjczIEw3LjQ3NCw5OC45MjMgQzcuNDc0LDEwMS40NzUgOS41NjksMTAzLjU1OCAxMi4xMzQsMTAzLjU1OCBMMTE1Ljg2NiwxMDMuNTU4IEMxMTguNDMxLDEwMy41NTggMTIwLjUyNiwxMDEuNDc1IDEyMC41MjYsOTguOTIzIEwxMjAuNTI2LDI5LjcyNyBDMTIwLjUyNywyNy4xNzYgMTE4LjQzMSwyNS4wOTEgMTE1Ljg2NywyNS4wOTEgTDcwLjEzMiwyNS4wOTEgTDY5LjE2MSwyMy45MzUgQzY1LjkzNSwyMC4wOTIgNjMuMjMzLDE2Ljc3MSA2Mi40NSwxNS42NTMgTDYyLjI5OSwxNS40MzcgTDYyLjE4NSwxNS4xOTkgQzYxLjk2NSwxNC43NDEgNjEuNDk2LDE0LjQ0MiA2MC45NjYsMTQuNDQyIHoiIGZpbGw9IiMwMUMzOUEiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik04NS41NzIsNTYuNzc1IEM4My4wOTYsNDcuNjYzIDc1LjM3LDQxLjI3NSA2Ni40MzMsNDEuMjc1IEM2MC4yMDIsNDEuMjc1IDU0LjM5Nyw0NC40MDIgNTAuNjI0LDQ5LjcxIEM0OS41NzcsNDkuNDczIDQ4LjUxNyw0OS4zNSA0Ny40NDksNDkuMzUgQzM5LjA2NCw0OS4zNDkgMzIuMjQsNTYuNzQ2IDMyLjI0LDY1Ljg0MiBDMzIuMjQsNjkuMTAzIDMzLjEyMyw3Mi4yNjIgMzQuNzg4LDc0Ljk3OSBDMzUuMTc5LDc1LjYxNCAzNS44MzksNzUuOTk2IDM2LjU0NCw3NS45OTYgTDUwLjU5Nyw3NS45OTYgQzUwLjY5Nyw2OS40OTMgNTYuMDE5LDY0LjI1IDYyLjU3OCw2NC4yNSBDNjkuMTM3LDY0LjI1IDc0LjQ1OCw2OS40OTMgNzQuNTU5LDc1Ljk5NiBMOTMuNTY0LDc1Ljk5NiBDOTQuMjMyLDc1Ljk5NiA5NC44NTksNzUuNjU1IDk1LjI1OSw3NS4wNzMgQzk2LjY0NSw3My4wNTQgOTcuMzc4LDcwLjY4MiA5Ny4zNzgsNjguMjE3IEM5Ny4zNzcsNjEuNDM5IDkxLjg2NSw1NS45NTQgODUuNTcyLDU2Ljc3NSB6IiBmaWxsPSIjMDFCQzk0Ii8+CiAgICA8cGF0aCBkPSJNNTQuOTQ1LDgwLjc1MSBMNjEuOTQsOTAuNDggQzYyLjA2Nyw5MC42NTYgNjIuMjczLDkwLjc2MSA2Mi40OSw5MC43NjEgTDYyLjQ5MSw5MC43NjEgQzYyLjcxLDkwLjc2MSA2Mi45MTMsOTAuNjU2IDYzLjA0MSw5MC40NzcgTDY5Ljk5MSw4MC43NTEgQzcwLjEzNyw4MC41NDYgNzAuMTU1LDgwLjI3OCA3MC4wNCw4MC4wNTIgQzY5LjkyNCw3OS44MjggNjkuNjkxLDc5LjY4OSA2OS40MzgsNzkuNjg5IEw2Ni4xNjksNzkuNjg5IEw2Ni4xNjksNzAuOTUxIEM2Ni4xNjksNzAuNTc4IDY1Ljg2Niw3MC4yNzcgNjUuNDk0LDcwLjI3NyBMNTkuNDQyLDcwLjI3NyBDNTkuMDY4LDcwLjI3NyA1OC43NjYsNzAuNTc4IDU4Ljc2Niw3MC45NTEgTDU4Ljc2Niw3OS42ODkgTDU1LjQ5NSw3OS42ODkgQzU1LjI0Miw3OS42ODkgNTUuMDEsNzkuODMxIDU0Ljg5NSw4MC4wNTIgQzU0Ljc3OCw4MC4yNzggNTQuNzk4LDgwLjU0NiA1NC45NDUsODAuNzUxIHoiIGZpbGw9IiNGRjRGMDAiLz4KICA8L2c+Cjwvc3ZnPgo=","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [700],"collapsed": [],"padding": "auto"},"log": [[1539883656788,"update","ermouth-524yb546",23,"dev-cloudwall2"]],"id": "cw.Sys.Db.Dump.Apply","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik0xMTUuODY3LDIxLjg3IEw3MS42NDUsMjEuODcgQzY4Ljc5NSwxOC40NzUgNjUuODY2LDE0Ljg5OCA2NS4xMDYsMTMuODEyIEM2NC4zNywxMi4yNzcgNjIuNzkyLDExLjIyMSA2MC45NjYsMTEuMjIxIEwyOS4yNSwxMS4yMjEgQzI3Ljg2MiwxMS4yMjEgMjYuNTUsMTEuODQ2IDI1LjY4LDEyLjkxOSBMMTguNDUsMjEuODcxIEwxMi4xMzQsMjEuODcxIEM3Ljc4NCwyMS44NzEgNC4yMzcsMjUuMzk2IDQuMjM3LDI5LjczIEw0LjIzNyw5OC45MjMgQzQuMjM3LDEwMy4yNTcgNy43ODQsMTA2Ljc3OSAxMi4xMzQsMTA2Ljc3OSBMMTE1Ljg2NiwxMDYuNzc5IEMxMjAuMjE2LDEwNi43NzkgMTIzLjc2MywxMDMuMjU3IDEyMy43NjMsOTguOTIzIEwxMjMuNzYzLDI5LjcyOCBDMTIzLjc2NSwyNS4zOTUgMTIwLjIxNiwyMS44NyAxMTUuODY3LDIxLjg3IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTYwLjk2Niw4IEM2My44MzUsOC4wNjYgNjYuMzY5LDkuNTE5IDY3Ljc5MiwxMi4wMTMgQzY5LjUxMSwxNC4yNzkgNzEuMzM3LDE2LjQ2NyA3My4xNjIsMTguNjQ5IEwxMTUuODY3LDE4LjY0OSBDMTIyLjAwNiwxOC42NDkgMTI3LjAwMiwyMy42MTggMTI3LDI5LjcyOCBMMTI3LDk4LjkyMyBDMTI3LDEwNS4wMzQgMTIyLjAwNSwxMTAgMTE1Ljg2NiwxMTAgTDEyLjEzNCwxMTAgQzUuOTk1LDExMCAxLDEwNS4wMzQgMSw5OC45MjMgTDEsMjkuNzMgQzEsMjMuNjE5IDUuOTk1LDE4LjY1IDEyLjEzNCwxOC42NSBMMTYuODk5LDE4LjY1IEwyMy4xNjEsMTAuODk3IEMyNC42NDUsOS4wNjUgMjYuODg0LDggMjkuMjUsOCBMNjAuOTY2LDggeiBNNjAuOTY2LDE0LjQ0MiBMMjkuMjUsMTQuNDQyIEMyOC44NDEsMTQuNDQyIDI4LjQ1NiwxNC42MjYgMjguMjAzLDE0LjkzNyBMMjAuOTczLDIzLjg4OSBMMjAuMDAxLDI1LjA5MiBMMTIuMTM0LDI1LjA5MiBDOS41NywyNS4wOTIgNy40NzQsMjcuMTc3IDcuNDc0LDI5LjczIEw3LjQ3NCw5OC45MjMgQzcuNDc0LDEwMS40NzUgOS41NjksMTAzLjU1OCAxMi4xMzQsMTAzLjU1OCBMMTE1Ljg2NiwxMDMuNTU4IEMxMTguNDMxLDEwMy41NTggMTIwLjUyNiwxMDEuNDc1IDEyMC41MjYsOTguOTIzIEwxMjAuNTI2LDI5LjcyNyBDMTIwLjUyNywyNy4xNzYgMTE4LjQzMSwyNS4wOTEgMTE1Ljg2NywyNS4wOTEgTDcwLjEzMiwyNS4wOTEgTDY5LjE2MSwyMy45MzUgQzY1LjkzNSwyMC4wOTIgNjMuMjMzLDE2Ljc3MSA2Mi40NSwxNS42NTMgTDYyLjI5OSwxNS40MzcgTDYyLjE4NSwxNS4xOTkgQzYxLjk2NSwxNC43NDEgNjEuNDk2LDE0LjQ0MiA2MC45NjYsMTQuNDQyIHoiIGZpbGw9IiMwMUMzOUEiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik04NS41NzIsNTYuNzc1IEM4My4wOTYsNDcuNjYzIDc1LjM3LDQxLjI3NSA2Ni40MzMsNDEuMjc1IEM2MC4yMDIsNDEuMjc1IDU0LjM5Nyw0NC40MDIgNTAuNjI0LDQ5LjcxIEM0OS41NzcsNDkuNDczIDQ4LjUxNyw0OS4zNSA0Ny40NDksNDkuMzUgQzM5LjA2NCw0OS4zNDkgMzIuMjQsNTYuNzQ2IDMyLjI0LDY1Ljg0MiBDMzIuMjQsNjkuMTAzIDMzLjEyMyw3Mi4yNjIgMzQuNzg4LDc0Ljk3OSBDMzUuMTc5LDc1LjYxNCAzNS44MzksNzUuOTk2IDM2LjU0NCw3NS45OTYgTDUwLjU5Nyw3NS45OTYgQzUwLjY5Nyw2OS40OTMgNTYuMDE5LDY0LjI1IDYyLjU3OCw2NC4yNSBDNjkuMTM3LDY0LjI1IDc0LjQ1OCw2OS40OTMgNzQuNTU5LDc1Ljk5NiBMOTMuNTY0LDc1Ljk5NiBDOTQuMjMyLDc1Ljk5NiA5NC44NTksNzUuNjU1IDk1LjI1OSw3NS4wNzMgQzk2LjY0NSw3My4wNTQgOTcuMzc4LDcwLjY4MiA5Ny4zNzgsNjguMjE3IEM5Ny4zNzcsNjEuNDM5IDkxLjg2NSw1NS45NTQgODUuNTcyLDU2Ljc3NSB6IiBmaWxsPSIjMDFCQzk0Ii8+CiAgICA8cGF0aCBkPSJNNTQuOTQ1LDgwLjc1MSBMNjEuOTQsOTAuNDggQzYyLjA2Nyw5MC42NTYgNjIuMjczLDkwLjc2MSA2Mi40OSw5MC43NjEgTDYyLjQ5MSw5MC43NjEgQzYyLjcxLDkwLjc2MSA2Mi45MTMsOTAuNjU2IDYzLjA0MSw5MC40NzcgTDY5Ljk5MSw4MC43NTEgQzcwLjEzNyw4MC41NDYgNzAuMTU1LDgwLjI3OCA3MC4wNCw4MC4wNTIgQzY5LjkyNCw3OS44MjggNjkuNjkxLDc5LjY4OSA2OS40MzgsNzkuNjg5IEw2Ni4xNjksNzkuNjg5IEw2Ni4xNjksNzAuOTUxIEM2Ni4xNjksNzAuNTc4IDY1Ljg2Niw3MC4yNzcgNjUuNDk0LDcwLjI3NyBMNTkuNDQyLDcwLjI3NyBDNTkuMDY4LDcwLjI3NyA1OC43NjYsNzAuNTc4IDU4Ljc2Niw3MC45NTEgTDU4Ljc2Niw3OS42ODkgTDU1LjQ5NSw3OS42ODkgQzU1LjI0Miw3OS42ODkgNTUuMDEsNzkuODMxIDU0Ljg5NSw4MC4wNTIgQzU0Ljc3OCw4MC4yNzggNTQuNzk4LDgwLjU0NiA1NC45NDUsODAuNzUxIHoiIGZpbGw9IiNGRjRGMDAiLz4KICA8L2c+Cjwvc3ZnPgo=","stamp": 1539883656788,"creator": "ermouth-1ermouth"},{"_id": "cw-Sys-PassKeeper-4vx1","_rev": "20-c547d1a87d6557713ac1a67675ae8ef8","name": "Sys.PassKeeper","title": "Pass Keeper","type": "manifest","desc": "Encrypted storage for passwords","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Sys.PassKeeper","build": 19,"app": {"name": "Sys.PassKeeper","title": "Pass Keeper","version": "2","build": 19,"timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NFREQyMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTEwMi4zOTMsNTkuMjMzIEMxMDIuMzU1LDU4Ljg2IDEwMi4yMDEsNTguNDk3IDEwMS45MTUsNTguMjExIEMxMDEuNTg1LDU3Ljg4MSAxMDEuMTUzLDU3LjcxNiAxMDAuNzIyLDU3LjcxNiBMOTYuMTM2LDU3LjcxNiBMOTQuMDgxLDU3LjcxNiBMNjUuNjg1LDU3LjcxNiBDNjMuMzc2LDQ4Ljg2OCA1NS4zNCw0Mi4zMTIgNDUuNzc4LDQyLjMxMiBDMzQuNDIsNDIuMzEyIDI1LjE4Miw1MS41NSAyNS4xODIsNjIuOTA3IEMyNS4xODIsNzQuMjY4IDM0LjQyLDgzLjUwMyA0NS43NzgsODMuNTAzIEM1NS45MzcsODMuNTAzIDY0LjM3Nyw3Ni4xMDcgNjYuMDUyLDY2LjQyMyBMNzMuODU1LDY2LjQyMyBMNzMuODU1LDcwLjg5MSBMNzMuODU1LDc0LjkwNyBMNzMuODU1LDc3LjUzMyBMNzMuODY3LDc3LjUzMyBDNzMuOTMxLDc4LjQwNCA3NC42NTIsNzkuMDk0IDc1LjU0Miw3OS4wOTQgQzc1LjU2NSw3OS4wOTQgNzUuNTg1LDc5LjA4OSA3NS42MDgsNzkuMDg4IEw3NS42MDgsNzkuMDk4IEw4MS4wMjMsNzkuMDk4IEw4MS4wMjMsNzkuMDk1IEM4MS45MTIsNzkuMDk2IDgyLjYzMyw3OC40MDYgODIuNjk3LDc3LjUzNCBMODIuNzExLDc3LjUzNCBMODIuNzExLDcwLjg5MiBMODIuNzExLDcwLjg5MiBMODIuNzExLDY2LjQyMyBMODcuMTMxLDY2LjQyMyBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgzLjYwMiBMODcuMTQ0LDgzLjYwMiBDODcuMjExLDg0LjQ3NCA4Ny45Myw4NS4xNjMgODguODE5LDg1LjE2NSBDODguODI2LDg1LjE2NSA4OC44MzIsODUuMTYzIDg4LjgzOCw4NS4xNjMgTDk0LjI2Myw4NS4xNjMgQzk0LjI3LDg1LjE2MyA5NC4yNzYsODUuMTY1IDk0LjI4Miw4NS4xNjUgQzk1LjE3MSw4NS4xNjMgOTUuODksODQuNDc0IDk1Ljk1Nyw4My42MDIgTDk1Ljk3LDgzLjYwMiBMOTUuOTcsNzYuOTYxIEw5NS45Nyw3Ni45NjEgTDk1Ljk3LDY2LjQyMyBMOTYuMTM4LDY2LjQyMyBMMTAwLjcyNCw2Ni40MjMgTDEwMC43MjQsNjYuNDIxIEMxMDEuMTU1LDY2LjQyMSAxMDEuNTg3LDY2LjI1NiAxMDEuOTE3LDY1LjkyNSBDMTAyLjI0NSw2NS41OTUgMTAyLjQxLDY1LjE2NSAxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNTkuMjMyIEwxMDIuMzkzLDU5LjIzMiB6IE00NS43NzgsNzQuODYyIEMzOS4yNjQsNzQuODYyIDMzLjk2NSw2OS41NiAzMy45NjUsNjMuMDQ3IEMzMy45NjUsNTYuNTMzIDM5LjI2NCw1MS4yMzEgNDUuNzc4LDUxLjIzMSBDNTIuMjkxLDUxLjIzMSA1Ny41ODgsNTYuNTMzIDU3LjU4OCw2My4wNDcgQzU3LjU4OSw2OS41NiA1Mi4yOTEsNzQuODYyIDQ1Ljc3OCw3NC44NjIgeiIgZmlsbD0iI0JGRDAwMCIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": ["cmd","editor._id"],"nodetitle": "editor.name","nodedoc": "editor","nodecmd": "cmd","width": [840],"collapsed": [],"padding": "auto","types": {"passkeeper": ["edit","create"]}},"data": {"editor": {"type": "passkeeper","name": "","crypto": "-","urls": [{"url": "","users": [{"login": "","pass": "","roles": []}]}],"log": []},"cmd": ""},"init": "function ($app,form) {\n    var that =this;\n\t\t$app.formgen('init', that.HTML);\n\t}","ui": {"#name": "editor.name","#crypto": {"bind": "editor.crypto","init": "function ($o) {\n\t\t\t$o.html(\n\t\t\t\t[ {id:\"-\",name:\"Select cryptokey\"} ]\n\t\t\t\t.add( cw.crypto.keys() )\n\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t},\"\")\n\t\t\t).select2();\n\t\t}"},"#list": {"bind": "editor.urls","manifest": "Url","list": "<div class=\"item\"></div>","init": "function ($ctrl) {\n\t\t\t$ctrl.sortable({handle:\".fi-list\"});\n\t\t}"},"#btn-save": {"bind": "function (d,v,$o) { \n\t\t\tif (v!=null) {\n\t\t\t\tif (!d.editor.crypto || d.editor.crypto.length<6) \n\t\t\t\t\tcw.lib.note(\"Can’t save – select crypto key.\",\"error\");\n\t\t\t\telse $o.trigger(\"commit\");\n\t\t\t}\n\t\t}","events": "click.my","watch": "#name,#crypto","css": {":disabled": "function (d) {\n\t\t\t\treturn !d.editor.name || d.editor.crypto==\"-\";\n\t\t\t}"}},"#btn-close": {"bind": "function (d,v,$o) { if (v!=null) $o.trigger(\"cancel\");}","events": "click.my"},"#btn-addurl": {"bind": "function (data,val,$ctrl) {\n\t\t\tif (null!=val) $ctrl.my(\"find\",\"#list\").trigger(\"insert\",1e6);\n\t\t}","events": "click.my"},"#atts": {"delay": 50,"init": "function ($o,form) {\n\t\t\t$o.my(\"cw.Sys.Attachments\", {\n\t\t\t\tdoc:form.data.editor,\n\t\t\t\ttruncate:20\n\t\t\t});\n\t\t}","bind": "function () {}"}},"Url": {"data": {"url": "","users": [{"login": "","pass": "","roles": []}]},"init": "function ($form) {\n\t\t$form.html(this.FormHTML.join(''));\n\t}","ui": {"#url": "url","#go": {"bind": "function (data,val,$a) {\n\t\t\t\t$a.attr(\"href\", data.url);\n\t\t\t}","watch": "#url","css": {"o20": "function (data) {return !/^http[s]?:\\/\\/.+$/.test(data.url)}"}},"#users": {"bind": "users","manifest": "User","list": "<div class=\"user mt-1\"></div>"},"#btn-delurl": {"bind": "function (data,val,$ctrl) {\n\t\t\t\tif (null!=val) {\n\t\t\t\t\t$ctrl.trigger(\"remove\");\n\t\t\t\t}\n\t\t\t}","events": "click.my"}},"FormHTML": ["<span class=\"fi-list w20 dib vat lgray mt4 fs110\"></span>","<input id=\"url\" type=\"text\" class=\"w580 pr30 fs100 pt5 pb5\" placeholder=\"Auth URL\" style=\"\">","<div class=\"dib vat ml-30 w30 small pt5\"><a id=\"go\" target=\"_blank\">Go</a></div>","<div id=\"btn-delurl\" class=\"dib vat w30 pr5 fs90 pt2 hovershow tac\">","<span class=\"fi-x salmon\"></span>","</div>","<div id=\"users\" class=\"ml20 w610 mt0\"></div>"],"User": {"data": {"login": "","pass": "","roles": []},"init": "function ($o) {\n\t\t$o.html([\n\t\t\t'<div class=\"fi-torso picto fs80 blue o50\"></div>',\n\t\t\t\t'<input id=\"login\" type=\"text\" class=\"w250 mr-1 fs85 pl20\" placeholder=\"Login\" />',\n\t\t\t'<div class=\"fi-unlock picto fs75 blue o50\"></div>',\n      '<input id=\"pass\" type=\"text\"  class=\"fs85 pl20\" placeholder=\"Password\" style=\"width:331px;\"/>',\n\t\t\t'<div id=\"btn-addlogin\" class=\"dib vat w30 pr5 fs90 pt1 hovershow tac\">',\n\t\t\t'<span class=\"fi-plus green\"></span>',\n\t\t\t'</div>'\n\t\t].join(''));\n\t}","ui": {"#login": "login","#pass": "pass","#btn-addlogin": {"bind": "function (data,val,$ctrl) { \n\t\t\t\tif (null!=val) $ctrl.trigger(\"insert\", \"after\");\n\t\t\t}","events": "click.my"}}}},"HTML": "<div class=\"dib vat w630 mt2 xgray\">\n\t<div class=\"dib vat fs150 mr5 bolder\" style=\"width:405px\">\n\t\t<input type=\"text\" id=\"name\" style=\"width:100%; padding-left:0;border:0;\" \n\t\t\t\t\t class=\"fs95 dib vat pt3 pb5\" placeholder=\"Project name\">\n\t</div>\n\t<div class=\"w190 dib vat mt3\"><select id=\"crypto\" class=\"w190 o80\"></select></div>\n\t<div id=\"list\" class=\"w630 mb5\"></div>\n\t<span id=\"btn-addurl\" class=\"fs90\">\n\t\t<span class=\"fi-plus blue fs90 o40 ml2 mr2\"></span>\n\t\t<span class=\"pseudolink\">Add new URL</span>\n\t</span>\n</div><div class=\"w210 dib vat\">\n\t<div>\n\t\t<input type=\"button\" id=\"btn-save\" class=\"br100 fs110 green w100 ml-5 mr5 tac\" value=\"Save\" />\n\t\t<input type=\"button\" id=\"btn-close\" class=\"br100 fs110 w100 mr0 tac\"  value=\"Close\">\n\t</div>\n\t<div id=\"atts\" class=\"fs80 gray mt5 ml2\"></div>\n</div>","style": {"": {"": "font-size:18px;font-weight:300;"," input": "font-weight:inherit;"}," .bolder": "font-weight:bolder!important;"," .w630": "width:630px;"," .w610": "width:610px;"," .w580": "width:580px;"," input": "margin:0; xborder:none;"," .ml-30": "margin-left:-30px"," .hovershow": "opacity:0; transition:opacity 0.3s; cursor:pointer; font-size:80%; text-align:center;"," div:hover>.hovershow": "opacity:0.8"," .fi-list": "cursor:move"," .item": {"": "padding:5px 0 5px 0;"," input, .select2-choices": "border-color: rgb(206, 225, 240);"}," .user": {" input": "padding: 5px 0 5px 23px;"," .picto": "z-index:+2; display:inline-block; width:23px; margin-right:-23px;text-align: center;"}}},"raw": {"name": "Sys.PassKeeper","title": "Pass Keeper","version": "2","build": 19,"com": [{"stamp": "1406068090207","id": "Root","type": "js","data": "({\n  \n  // CloudWall password keeper\n  // (c) 2018 ermouth\n  \n\tdata:{\n\t\teditor:{\n\t\t\ttype:\t\t'passkeeper',\n\t\t\tname:\t\t'',\n\t\t\tcrypto:\t'-',\n\t\t\turls:[\n\t\t\t\t{\t\n          url:'', \n          users:[{\n            login:\t'', \n            pass:\t\t'', \n            roles:\t[]\n\n          }] \n        }\n\t\t\t],\n\t\t\tlog:[]\n\t\t},\n\t\tcmd:\t'' \n\t},\n\tinit: function ($app, form) {\n    var that =this;\n\t\t$app.formgen('init', that.HTML);\n\t},\n\tui: { /* See tab */ }\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1428257583943","id": ".ui","type": "js","data": "({\n\t\"#name\":\"editor.name\",\n\t\"#crypto\":{\n\t\tbind:\"editor.crypto\",\n\t\tinit: function($o) {\n\t\t\t$o.html(\n\t\t\t\t[ {id:\"-\",name:\"Select cryptokey\"} ]\n\t\t\t\t.add( cw.crypto.keys() )\n\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t},\"\")\n\t\t\t).select2();\n\t\t}\n\t},\n\t\"#list\":{\n\t\tbind:\"editor.urls\",\n\t\tmanifest:\"Url\",\n\t\tlist:'<div class=\"item\"></div>',\n\t\tinit: function ($ctrl) {\n\t\t\t$ctrl.sortable({handle:\".fi-list\"});\n\t\t}\n\t},\n\t\"#btn-save\":{\n\t\tbind: function (d,v,$o){ \n\t\t\tif (v!=null) {\n\t\t\t\tif (!d.editor.crypto || d.editor.crypto.length<6) \n\t\t\t\t\tcw.lib.note(\"Can’t save – select crypto key.\",\"error\");\n\t\t\t\telse $o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\tevents:\"click.my\",\n\t\twatch:\"#name,#crypto\",\n\t\tcss:{\n\t\t\t\":disabled\":function(d){\n\t\t\t\treturn !d.editor.name || d.editor.crypto==\"-\";\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-close\":{\n\t\tbind:function(d,v,$o){ if (v!=null) $o.trigger(\"cancel\");},\n\t\tevents:\"click.my\"\n\t},\n\t\"#btn-addurl\":{\n\t\tbind: function(data, val, $ctrl) {\n\t\t\tif (null!=val) $ctrl.my(\"find\",\"#list\").trigger(\"insert\",1e6);\n\t\t},\n\t\tevents:\"click.my\"\n\t},\n\t\"#atts\":{\n\t\tdelay:50,\n\t\tinit: function ($o, form) {\n\t\t\t$o.my(\"cw.Sys.Attachments\", {\n\t\t\t\tdoc:form.data.editor,\n\t\t\t\ttruncate:20\n\t\t\t});\n\t\t},\n\t\tbind: function (){}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1406068223472","id": ".Url","type": "js","data": "// URL section, child manifest of main form\n({\n\tdata: {\t\n\t\turl:\"\", \n\t\tusers:[{\n      login:'', \n      pass:'', \n      roles:[]\n    }] \n\t},\n\tinit: function ($form) {\n\t\t$form.html(this.FormHTML.join(''));\n\t},\n\tui:{\n\t\t\"#url\":\"url\",\n\t\t\"#go\":{\n\t\t\tbind: function(data, val, $a){\n\t\t\t\t$a.attr(\"href\", data.url);\n\t\t\t},\n\t\t\twatch:\"#url\",\n\t\t\tcss:{\n\t\t\t\t\"o20\":function (data) {return !/^http[s]?:\\/\\/.+$/.test(data.url)}\n\t\t\t}\n\t\t},\n\t\t\"#users\":{\n\t\t\tbind:\"users\",\n\t\t\tmanifest:\"User\",\n\t\t\tlist:'<div class=\"user mt-1\"></div>'\n\t\t},\n\t\t\"#btn-delurl\":{\n\t\t\tbind: function (data, val, $ctrl) {\n\t\t\t\tif (null!=val) {\n\t\t\t\t\t$ctrl.trigger(\"remove\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t}\n\t},\n\tFormHTML:[\n\t\t'<span class=\"fi-list w20 dib vat lgray mt4 fs110\"></span>',\n\t\t'<input id=\"url\" type=\"text\" class=\"w580 pr30 fs100 pt5 pb5\" placeholder=\"Auth URL\" '\n\t\t+'style=\"\">',\n\t\t'<div class=\"dib vat ml-30 w30 small pt5\"><a id=\"go\" target=\"_blank\">Go</a></div>',\n\t\t'<div id=\"btn-delurl\" class=\"dib vat w30 pr5 fs90 pt2 hovershow tac\">',\n\t\t'<span class=\"fi-x salmon\"></span>',\n\t\t'</div>',\n\t\t// List of logins\n\t\t'<div id=\"users\" class=\"ml20 w610 mt0\"></div>'\n\t]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1406068116508","id": ".Url.User","type": "js","data": "// User, child manifest of URL section\n({\n\tdata:{\n    login:'', \n    pass:\t'', \n    roles:[]\n  },\n\tinit: function($o){\n\t\t$o.html([\n\t\t\t'<div class=\"fi-torso picto fs80 blue o50\"></div>',\n\t\t\t\t'<input id=\"login\" type=\"text\" class=\"w250 mr-1 fs85 pl20\" placeholder=\"Login\" />',\n\t\t\t'<div class=\"fi-unlock picto fs75 blue o50\"></div>',\n      '<input id=\"pass\" type=\"text\"  class=\"fs85 pl20\" placeholder=\"Password\" style=\"width:331px;\"/>',\n\t\t\t'<div id=\"btn-addlogin\" class=\"dib vat w30 pr5 fs90 pt1 hovershow tac\">',\n\t\t\t'<span class=\"fi-plus green\"></span>',\n\t\t\t'</div>'\n\t\t].join(''));\n\t},\n\tui:{\n\t\t'#login':\t\t'login',\n\t\t'#pass':\t\t'pass',\n\t\t'#btn-addlogin':{\n\t\t\tbind: function(data, val, $ctrl){ \n\t\t\t\tif (null!=val) $ctrl.trigger(\"insert\", \"after\");\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1406068263673","id": ".HTML","type": "html","data": "<div class=\"dib vat w630 mt2 xgray\">\n\t<div class=\"dib vat fs150 mr5 bolder\" style=\"width:405px\">\n\t\t<input type=\"text\" id=\"name\" style=\"width:100%; padding-left:0;border:0;\" \n\t\t\t\t\t class=\"fs95 dib vat pt3 pb5\" placeholder=\"Project name\">\n\t</div>\n\t<div class=\"w190 dib vat mt3\"><select id=\"crypto\" class=\"w190 o80\"></select></div>\n\t<div id=\"list\" class=\"w630 mb5\"></div>\n\t<span id=\"btn-addurl\" class=\"fs90\">\n\t\t<span class=\"fi-plus blue fs90 o40 ml2 mr2\"></span>\n\t\t<span class=\"pseudolink\">Add new URL</span>\n\t</span>\n</div><div class=\"w210 dib vat\">\n\t<div>\n\t\t<input type=\"button\" id=\"btn-save\" class=\"br100 fs110 green w100 ml-5 mr5 tac\" value=\"Save\" />\n\t\t<input type=\"button\" id=\"btn-close\" class=\"br100 fs110 w100 mr0 tac\"  value=\"Close\">\n\t</div>\n\t<div id=\"atts\" class=\"fs80 gray mt5 ml2\"></div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1406068390378","id": ".style","type": "js","data": "({\n  '':{\n    '':'font-size:18px;font-weight:300;',\n  \t' input':'font-weight:inherit;',\n  },\n  ' .bolder':'font-weight:bolder!important;',\n  \" .w630\":\"width:630px;\",\n  \" .w610\":\"width:610px;\",\n  \" .w580\":\"width:580px;\",\n  \" input\":\"margin:0; xborder:none;\",\n  \" .ml-30\":\"margin-left:-30px\",\n  \" .hovershow\":\"opacity:0; transition:opacity 0.3s; cursor:pointer; font-size:80%; text-align:center;\",\n  \" div:hover>.hovershow\":\"opacity:0.8\",\n  \" .fi-list\":\"cursor:move\",\n  \" .item\":{\n    \"\":\"padding:5px 0 5px 0;\",\n    \" input, .select2-choices\":\"border-color: rgb(206, 225, 240);\"\n  },\n  \" .user\":{\n    \" input\":\"padding: 5px 0 5px 23px;\",\n    \" .picto\":\"z-index:+2; display:inline-block; width:23px; margin-right:-23px;text-align: center;\"\n  }\n})","active": false,"err": [],"opts": [],"color": ["orange"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NFREQyMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTEwMi4zOTMsNTkuMjMzIEMxMDIuMzU1LDU4Ljg2IDEwMi4yMDEsNTguNDk3IDEwMS45MTUsNTguMjExIEMxMDEuNTg1LDU3Ljg4MSAxMDEuMTUzLDU3LjcxNiAxMDAuNzIyLDU3LjcxNiBMOTYuMTM2LDU3LjcxNiBMOTQuMDgxLDU3LjcxNiBMNjUuNjg1LDU3LjcxNiBDNjMuMzc2LDQ4Ljg2OCA1NS4zNCw0Mi4zMTIgNDUuNzc4LDQyLjMxMiBDMzQuNDIsNDIuMzEyIDI1LjE4Miw1MS41NSAyNS4xODIsNjIuOTA3IEMyNS4xODIsNzQuMjY4IDM0LjQyLDgzLjUwMyA0NS43NzgsODMuNTAzIEM1NS45MzcsODMuNTAzIDY0LjM3Nyw3Ni4xMDcgNjYuMDUyLDY2LjQyMyBMNzMuODU1LDY2LjQyMyBMNzMuODU1LDcwLjg5MSBMNzMuODU1LDc0LjkwNyBMNzMuODU1LDc3LjUzMyBMNzMuODY3LDc3LjUzMyBDNzMuOTMxLDc4LjQwNCA3NC42NTIsNzkuMDk0IDc1LjU0Miw3OS4wOTQgQzc1LjU2NSw3OS4wOTQgNzUuNTg1LDc5LjA4OSA3NS42MDgsNzkuMDg4IEw3NS42MDgsNzkuMDk4IEw4MS4wMjMsNzkuMDk4IEw4MS4wMjMsNzkuMDk1IEM4MS45MTIsNzkuMDk2IDgyLjYzMyw3OC40MDYgODIuNjk3LDc3LjUzNCBMODIuNzExLDc3LjUzNCBMODIuNzExLDcwLjg5MiBMODIuNzExLDcwLjg5MiBMODIuNzExLDY2LjQyMyBMODcuMTMxLDY2LjQyMyBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgzLjYwMiBMODcuMTQ0LDgzLjYwMiBDODcuMjExLDg0LjQ3NCA4Ny45Myw4NS4xNjMgODguODE5LDg1LjE2NSBDODguODI2LDg1LjE2NSA4OC44MzIsODUuMTYzIDg4LjgzOCw4NS4xNjMgTDk0LjI2Myw4NS4xNjMgQzk0LjI3LDg1LjE2MyA5NC4yNzYsODUuMTY1IDk0LjI4Miw4NS4xNjUgQzk1LjE3MSw4NS4xNjMgOTUuODksODQuNDc0IDk1Ljk1Nyw4My42MDIgTDk1Ljk3LDgzLjYwMiBMOTUuOTcsNzYuOTYxIEw5NS45Nyw3Ni45NjEgTDk1Ljk3LDY2LjQyMyBMOTYuMTM4LDY2LjQyMyBMMTAwLjcyNCw2Ni40MjMgTDEwMC43MjQsNjYuNDIxIEMxMDEuMTU1LDY2LjQyMSAxMDEuNTg3LDY2LjI1NiAxMDEuOTE3LDY1LjkyNSBDMTAyLjI0NSw2NS41OTUgMTAyLjQxLDY1LjE2NSAxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNTkuMjMyIEwxMDIuMzkzLDU5LjIzMiB6IE00NS43NzgsNzQuODYyIEMzOS4yNjQsNzQuODYyIDMzLjk2NSw2OS41NiAzMy45NjUsNjMuMDQ3IEMzMy45NjUsNTYuNTMzIDM5LjI2NCw1MS4yMzEgNDUuNzc4LDUxLjIzMSBDNTIuMjkxLDUxLjIzMSA1Ny41ODgsNTYuNTMzIDU3LjU4OCw2My4wNDcgQzU3LjU4OSw2OS41NiA1Mi4yOTEsNzQuODYyIDQ1Ljc3OCw3NC44NjIgeiIgZmlsbD0iI0JGRDAwMCIvPgogIDwvZz4KPC9zdmc+Cg==","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "passkeeper","actions": ["edit","create"]}],"_opts": {"compileTo": ["js"],"runWidth": "840","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Encrypted storage for passwords","timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NFREQyMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTEwMi4zOTMsNTkuMjMzIEMxMDIuMzU1LDU4Ljg2IDEwMi4yMDEsNTguNDk3IDEwMS45MTUsNTguMjExIEMxMDEuNTg1LDU3Ljg4MSAxMDEuMTUzLDU3LjcxNiAxMDAuNzIyLDU3LjcxNiBMOTYuMTM2LDU3LjcxNiBMOTQuMDgxLDU3LjcxNiBMNjUuNjg1LDU3LjcxNiBDNjMuMzc2LDQ4Ljg2OCA1NS4zNCw0Mi4zMTIgNDUuNzc4LDQyLjMxMiBDMzQuNDIsNDIuMzEyIDI1LjE4Miw1MS41NSAyNS4xODIsNjIuOTA3IEMyNS4xODIsNzQuMjY4IDM0LjQyLDgzLjUwMyA0NS43NzgsODMuNTAzIEM1NS45MzcsODMuNTAzIDY0LjM3Nyw3Ni4xMDcgNjYuMDUyLDY2LjQyMyBMNzMuODU1LDY2LjQyMyBMNzMuODU1LDcwLjg5MSBMNzMuODU1LDc0LjkwNyBMNzMuODU1LDc3LjUzMyBMNzMuODY3LDc3LjUzMyBDNzMuOTMxLDc4LjQwNCA3NC42NTIsNzkuMDk0IDc1LjU0Miw3OS4wOTQgQzc1LjU2NSw3OS4wOTQgNzUuNTg1LDc5LjA4OSA3NS42MDgsNzkuMDg4IEw3NS42MDgsNzkuMDk4IEw4MS4wMjMsNzkuMDk4IEw4MS4wMjMsNzkuMDk1IEM4MS45MTIsNzkuMDk2IDgyLjYzMyw3OC40MDYgODIuNjk3LDc3LjUzNCBMODIuNzExLDc3LjUzNCBMODIuNzExLDcwLjg5MiBMODIuNzExLDcwLjg5MiBMODIuNzExLDY2LjQyMyBMODcuMTMxLDY2LjQyMyBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgzLjYwMiBMODcuMTQ0LDgzLjYwMiBDODcuMjExLDg0LjQ3NCA4Ny45Myw4NS4xNjMgODguODE5LDg1LjE2NSBDODguODI2LDg1LjE2NSA4OC44MzIsODUuMTYzIDg4LjgzOCw4NS4xNjMgTDk0LjI2Myw4NS4xNjMgQzk0LjI3LDg1LjE2MyA5NC4yNzYsODUuMTY1IDk0LjI4Miw4NS4xNjUgQzk1LjE3MSw4NS4xNjMgOTUuODksODQuNDc0IDk1Ljk1Nyw4My42MDIgTDk1Ljk3LDgzLjYwMiBMOTUuOTcsNzYuOTYxIEw5NS45Nyw3Ni45NjEgTDk1Ljk3LDY2LjQyMyBMOTYuMTM4LDY2LjQyMyBMMTAwLjcyNCw2Ni40MjMgTDEwMC43MjQsNjYuNDIxIEMxMDEuMTU1LDY2LjQyMSAxMDEuNTg3LDY2LjI1NiAxMDEuOTE3LDY1LjkyNSBDMTAyLjI0NSw2NS41OTUgMTAyLjQxLDY1LjE2NSAxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNTkuMjMyIEwxMDIuMzkzLDU5LjIzMiB6IE00NS43NzgsNzQuODYyIEMzOS4yNjQsNzQuODYyIDMzLjk2NSw2OS41NiAzMy45NjUsNjMuMDQ3IEMzMy45NjUsNTYuNTMzIDM5LjI2NCw1MS4yMzEgNDUuNzc4LDUxLjIzMSBDNTIuMjkxLDUxLjIzMSA1Ny41ODgsNTYuNTMzIDU3LjU4OCw2My4wNDcgQzU3LjU4OSw2OS41NiA1Mi4yOTEsNzQuODYyIDQ1Ljc3OCw3NC44NjIgeiIgZmlsbD0iI0JGRDAwMCIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": "","nodetitle": "editor.name","nodedoc": "editor","nodecmd": "cmd","types": "","width": [840],"collapsed": [],"padding": "auto"},"log": [[1539883875566,"update","ermouth-524yb546",20,"dev-cloudwall2"]],"id": "cw.Sys.PassKeeper","stamp": 1539883875565,"creator": "ermouth-1ermouth","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0NFREQyMCIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTEwMi4zOTMsNTkuMjMzIEMxMDIuMzU1LDU4Ljg2IDEwMi4yMDEsNTguNDk3IDEwMS45MTUsNTguMjExIEMxMDEuNTg1LDU3Ljg4MSAxMDEuMTUzLDU3LjcxNiAxMDAuNzIyLDU3LjcxNiBMOTYuMTM2LDU3LjcxNiBMOTQuMDgxLDU3LjcxNiBMNjUuNjg1LDU3LjcxNiBDNjMuMzc2LDQ4Ljg2OCA1NS4zNCw0Mi4zMTIgNDUuNzc4LDQyLjMxMiBDMzQuNDIsNDIuMzEyIDI1LjE4Miw1MS41NSAyNS4xODIsNjIuOTA3IEMyNS4xODIsNzQuMjY4IDM0LjQyLDgzLjUwMyA0NS43NzgsODMuNTAzIEM1NS45MzcsODMuNTAzIDY0LjM3Nyw3Ni4xMDcgNjYuMDUyLDY2LjQyMyBMNzMuODU1LDY2LjQyMyBMNzMuODU1LDcwLjg5MSBMNzMuODU1LDc0LjkwNyBMNzMuODU1LDc3LjUzMyBMNzMuODY3LDc3LjUzMyBDNzMuOTMxLDc4LjQwNCA3NC42NTIsNzkuMDk0IDc1LjU0Miw3OS4wOTQgQzc1LjU2NSw3OS4wOTQgNzUuNTg1LDc5LjA4OSA3NS42MDgsNzkuMDg4IEw3NS42MDgsNzkuMDk4IEw4MS4wMjMsNzkuMDk4IEw4MS4wMjMsNzkuMDk1IEM4MS45MTIsNzkuMDk2IDgyLjYzMyw3OC40MDYgODIuNjk3LDc3LjUzNCBMODIuNzExLDc3LjUzNCBMODIuNzExLDcwLjg5MiBMODIuNzExLDcwLjg5MiBMODIuNzExLDY2LjQyMyBMODcuMTMxLDY2LjQyMyBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgwLjA1NSBMODcuMTMxLDgzLjYwMiBMODcuMTQ0LDgzLjYwMiBDODcuMjExLDg0LjQ3NCA4Ny45Myw4NS4xNjMgODguODE5LDg1LjE2NSBDODguODI2LDg1LjE2NSA4OC44MzIsODUuMTYzIDg4LjgzOCw4NS4xNjMgTDk0LjI2Myw4NS4xNjMgQzk0LjI3LDg1LjE2MyA5NC4yNzYsODUuMTY1IDk0LjI4Miw4NS4xNjUgQzk1LjE3MSw4NS4xNjMgOTUuODksODQuNDc0IDk1Ljk1Nyw4My42MDIgTDk1Ljk3LDgzLjYwMiBMOTUuOTcsNzYuOTYxIEw5NS45Nyw3Ni45NjEgTDk1Ljk3LDY2LjQyMyBMOTYuMTM4LDY2LjQyMyBMMTAwLjcyNCw2Ni40MjMgTDEwMC43MjQsNjYuNDIxIEMxMDEuMTU1LDY2LjQyMSAxMDEuNTg3LDY2LjI1NiAxMDEuOTE3LDY1LjkyNSBDMTAyLjI0NSw2NS41OTUgMTAyLjQxLDY1LjE2NSAxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNjQuNzMzIEwxMDIuNDEsNTkuMjMyIEwxMDIuMzkzLDU5LjIzMiB6IE00NS43NzgsNzQuODYyIEMzOS4yNjQsNzQuODYyIDMzLjk2NSw2OS41NiAzMy45NjUsNjMuMDQ3IEMzMy45NjUsNTYuNTMzIDM5LjI2NCw1MS4yMzEgNDUuNzc4LDUxLjIzMSBDNTIuMjkxLDUxLjIzMSA1Ny41ODgsNTYuNTMzIDU3LjU4OCw2My4wNDcgQzU3LjU4OSw2OS41NiA1Mi4yOTEsNzQuODYyIDQ1Ljc3OCw3NC44NjIgeiIgZmlsbD0iI0JGRDAwMCIvPgogIDwvZz4KPC9zdmc+Cg=="},{"_id": "cw-Sys-Plugins-4vx1","_rev": "17-54aef53609bc70dad18b5f733071d4de","name": "Sys.Plugins","title": "Sys.Plugins","type": "manifest","desc": "Set of local plugins","beta": false,"tags": ["CW","CW components","CW libs"],"manifest": {"id": "cw.Sys.Plugins","build": 17,"data": {"msg": "Can‘t run this app."},"init": "function ($form,form) {\n\t\t$form.html('<div id=\"msg\"></div>')\n\t}","ui": {"#msg": "msg"}},"raw": {"name": "Sys.Plugins","title": "Sys.Plugins","version": "2","build": 17,"com": [{"stamp": "1429103218367","id": "Root","type": "js","data": "({\n\t\n\t// This manifest does nothing,\n\t// it only contains attachments\n\t// with plugins\n\t\n\tdata:{\n\t\tmsg:\"Can‘t run this app.\"\n\t},\n\tinit: function ($form, form) {\n\t\t$form.html('<div id=\"msg\"></div>')\n\t},\n\tui:{\n\t\t\"#msg\":\"msg\"\n\t}\n})","active": true,"opts": [],"err": [],"color": ["blue"]}],"pic": "","_type": ["manifest"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "800","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "Set of local plugins","timeout": "3000","author": "ermouth","ico": "","maskstate": "","nodetitle": "","nodedoc": "","nodecmd": "","types": "","width": [],"collapsed": [],"padding": "auto"},"log": [[1526694912811,"update","ermouth-524yb546",17,"dev-cloudwall2"]],"id": "cw.Sys.Plugins","stamp": 1526694912810,"creator": "ermouth-1ermouth","_attachments": {"gzip.js": {"content_type": "text/javascript","data": "LyogZ3ppcC5qcyAqLwoKKGZ1bmN0aW9uKCkgeyd1c2Ugc3RyaWN0Jzt2YXIgcD12b2lkIDAsdj0hMCxkYT10aGlzO2Z1bmN0aW9uIGZhKGYsZSl7dmFyIGM9Zi5zcGxpdCgiLiIpLGE9ZGE7IShjWzBdaW4gYSkmJmEuZXhlY1NjcmlwdCYmYS5leGVjU2NyaXB0KCJ2YXIgIitjWzBdKTtmb3IodmFyIGI7Yy5sZW5ndGgmJihiPWMuc2hpZnQoKSk7KSFjLmxlbmd0aCYmZSE9PXA/YVtiXT1lOmE9YVtiXT9hW2JdOmFbYl09e319O3ZhciBDPSJ1bmRlZmluZWQiIT09dHlwZW9mIFVpbnQ4QXJyYXkmJiJ1bmRlZmluZWQiIT09dHlwZW9mIFVpbnQxNkFycmF5JiYidW5kZWZpbmVkIiE9PXR5cGVvZiBVaW50MzJBcnJheSYmInVuZGVmaW5lZCIhPT10eXBlb2YgRGF0YVZpZXc7ZnVuY3Rpb24gRihmLGUpe3RoaXMuaW5kZXg9Im51bWJlciI9PT10eXBlb2YgZT9lOjA7dGhpcy5mPTA7dGhpcy5idWZmZXI9ZiBpbnN0YW5jZW9mKEM/VWludDhBcnJheTpBcnJheSk/ZjpuZXcgKEM/VWludDhBcnJheTpBcnJheSkoMzI3NjgpO2lmKDIqdGhpcy5idWZmZXIubGVuZ3RoPD10aGlzLmluZGV4KXRocm93IEVycm9yKCJpbnZhbGlkIGluZGV4Iik7dGhpcy5idWZmZXIubGVuZ3RoPD10aGlzLmluZGV4JiZnYSh0aGlzKX1mdW5jdGlvbiBnYShmKXt2YXIgZT1mLmJ1ZmZlcixjLGE9ZS5sZW5ndGgsYj1uZXcgKEM/VWludDhBcnJheTpBcnJheSkoYTw8MSk7aWYoQyliLnNldChlKTtlbHNlIGZvcihjPTA7YzxhOysrYyliW2NdPWVbY107cmV0dXJuIGYuYnVmZmVyPWJ9CkYucHJvdG90eXBlLmI9ZnVuY3Rpb24oZixlLGMpe3ZhciBhPXRoaXMuYnVmZmVyLGI9dGhpcy5pbmRleCxnPXRoaXMuZixsPWFbYl0sbTtjJiYxPGUmJihmPTg8ZT8oSFtmJjI1NV08PDI0fEhbZj4+PjgmMjU1XTw8MTZ8SFtmPj4+MTYmMjU1XTw8OHxIW2Y+Pj4yNCYyNTVdKT4+MzItZTpIW2ZdPj44LWUpO2lmKDg+ZStnKWw9bDw8ZXxmLGcrPWU7ZWxzZSBmb3IobT0wO208ZTsrK20pbD1sPDwxfGY+PmUtbS0xJjEsOD09PSsrZyYmKGc9MCxhW2IrK109SFtsXSxsPTAsYj09PWEubGVuZ3RoJiYoYT1nYSh0aGlzKSkpO2FbYl09bDt0aGlzLmJ1ZmZlcj1hO3RoaXMuZj1nO3RoaXMuaW5kZXg9Yn07Ri5wcm90b3R5cGUuZmluaXNoPWZ1bmN0aW9uKCl7dmFyIGY9dGhpcy5idWZmZXIsZT10aGlzLmluZGV4LGM7MDx0aGlzLmYmJihmW2VdPDw9OC10aGlzLmYsZltlXT1IW2ZbZV1dLGUrKyk7Qz9jPWYuc3ViYXJyYXkoMCxlKTooZi5sZW5ndGg9ZSxjPWYpO3JldHVybiBjfTsKdmFyIGlhPW5ldyAoQz9VaW50OEFycmF5OkFycmF5KSgyNTYpLE07Zm9yKE09MDsyNTY+TTsrK00pe2Zvcih2YXIgTj1NLFM9TixqYT03LE49Tj4+PjE7TjtOPj4+PTEpUzw8PTEsU3w9TiYxLC0tamE7aWFbTV09KFM8PGphJjI1NSk+Pj4wfXZhciBIPWlhO2Z1bmN0aW9uIGthKGYsZSxjKXt2YXIgYSxiPSJudW1iZXIiPT09dHlwZW9mIGU/ZTplPTAsZz0ibnVtYmVyIj09PXR5cGVvZiBjP2M6Zi5sZW5ndGg7YT0tMTtmb3IoYj1nJjc7Yi0tOysrZSlhPWE+Pj44XlRbKGFeZltlXSkmMjU1XTtmb3IoYj1nPj4zO2ItLTtlKz04KWE9YT4+PjheVFsoYV5mW2VdKSYyNTVdLGE9YT4+PjheVFsoYV5mW2UrMV0pJjI1NV0sYT1hPj4+OF5UWyhhXmZbZSsyXSkmMjU1XSxhPWE+Pj44XlRbKGFeZltlKzNdKSYyNTVdLGE9YT4+PjheVFsoYV5mW2UrNF0pJjI1NV0sYT1hPj4+OF5UWyhhXmZbZSs1XSkmMjU1XSxhPWE+Pj44XlRbKGFeZltlKzZdKSYyNTVdLGE9YT4+PjheVFsoYV5mW2UrN10pJjI1NV07cmV0dXJuKGFeNDI5NDk2NzI5NSk+Pj4wfQp2YXIgbGE9WzAsMTk5Njk1OTg5NCwzOTkzOTE5Nzg4LDI1Njc1MjQ3OTQsMTI0NjM0MTM3LDE4ODYwNTc2MTUsMzkxNTYyMTY4NSwyNjU3MzkyMDM1LDI0OTI2ODI3NCwyMDQ0NTA4MzI0LDM3NzIxMTUyMzAsMjU0NzE3Nzg2NCwxNjI5NDE5OTUsMjEyNTU2MTAyMSwzODg3NjA3MDQ3LDI0Mjg0NDQwNDksNDk4NTM2NTQ4LDE3ODk5Mjc2NjYsNDA4OTAxNjY0OCwyMjI3MDYxMjE0LDQ1MDU0ODg2MSwxODQzMjU4NjAzLDQxMDc1ODA3NTMsMjIxMTY3NzYzOSwzMjU4ODM5OTAsMTY4NDc3NzE1Miw0MjUxMTIyMDQyLDIzMjE5MjY2MzYsMzM1NjMzNDg3LDE2NjEzNjU0NjUsNDE5NTMwMjc1NSwyMzY2MTE1MzE3LDk5NzA3MzA5NiwxMjgxOTUzODg2LDM1Nzk4NTUzMzIsMjcyNDY4ODI0MiwxMDA2ODg4MTQ1LDEyNTg2MDc2ODcsMzUyNDEwMTYyOSwyNzY4OTQyNDQzLDkwMTA5NzcyMiwxMTE5MDAwNjg0LDM2ODY1MTcyMDYsMjg5ODA2NTcyOCw4NTMwNDQ0NTEsMTE3MjI2NjEwMSwzNzA1MDE1NzU5LAoyODgyNjE2NjY1LDY1MTc2Nzk4MCwxMzczNTAzNTQ2LDMzNjk1NTQzMDQsMzIxODEwNDU5OCw1NjU1MDcyNTMsMTQ1NDYyMTczMSwzNDg1MTExNzA1LDMwOTk0MzYzMDMsNjcxMjY2OTc0LDE1OTQxOTgwMjQsMzMyMjczMDkzMCwyOTcwMzQ3ODEyLDc5NTgzNTUyNywxNDgzMjMwMjI1LDMyNDQzNjcyNzUsMzA2MDE0OTU2NSwxOTk0MTQ2MTkyLDMxMTU4NTM0LDI1NjM5MDc3NzIsNDAyMzcxNzkzMCwxOTA3NDU5NDY1LDExMjYzNzIxNSwyNjgwMTUzMjUzLDM5MDQ0MjcwNTksMjAxMzc3NjI5MCwyNTE3MjIwMzYsMjUxNzIxNTM3NCwzNzc1ODMwMDQwLDIxMzc2NTY3NjMsMTQxMzc2ODEzLDI0MzkyNzc3MTksMzg2NTI3MTI5NywxODAyMTk1NDQ0LDQ3Njg2NDg2NiwyMjM4MDAxMzY4LDQwNjY1MDg4NzgsMTgxMjM3MDkyNSw0NTMwOTI3MzEsMjE4MTYyNTAyNSw0MTExNDUxMjIzLDE3MDYwODg5MDIsMzE0MDQyNzA0LDIzNDQ1MzIyMDIsNDI0MDAxNzUzMiwxNjU4NjU4MjcxLDM2NjYxOTk3NywKMjM2MjY3MDMyMyw0MjI0OTk0NDA1LDEzMDM1MzU5NjAsOTg0OTYxNDg2LDI3NDcwMDcwOTIsMzU2OTAzNzUzOCwxMjU2MTcwODE3LDEwMzc2MDQzMTEsMjc2NTIxMDczMywzNTU0MDc5OTk1LDExMzEwMTQ1MDYsODc5Njc5OTk2LDI5MDkyNDM0NjIsMzY2Mzc3MTg1NiwxMTQxMTI0NDY3LDg1NTg0MjI3NywyODUyODAxNjMxLDM3MDg2NDg2NDksMTM0MjUzMzk0OCw2NTQ0NTkzMDYsMzE4ODM5NjA0OCwzMzczMDE1MTc0LDE0NjY0Nzk5MDksNTQ0MTc5NjM1LDMxMTA1MjM5MTMsMzQ2MjUyMjAxNSwxNTkxNjcxMDU0LDcwMjEzODc3NiwyOTY2NDYwNDUwLDMzNTI3OTk0MTIsMTUwNDkxODgwNyw3ODM1NTE4NzMsMzA4MjY0MDQ0MywzMjMzNDQyOTg5LDM5ODgyOTIzODQsMjU5NjI1NDY0Niw2MjMxNzA2OCwxOTU3ODEwODQyLDM5Mzk4NDU5NDUsMjY0NzgxNjExMSw4MTQ3MDk5NywxOTQzODAzNTIzLDM4MTQ5MTg5MzAsMjQ4OTU5NjgwNCwyMjUyNzQ0MzAsMjA1Mzc5MDM3NiwzODI2MTc1NzU1LAoyNDY2OTA2MDEzLDE2NzgxNjc0MywyMDk3NjUxMzc3LDQwMjc1NTI1ODAsMjI2NTQ5MDM4Niw1MDM0NDQwNzIsMTc2MjA1MDgxNCw0MTUwNDE3MjQ1LDIxNTQxMjkzNTUsNDI2NTIyMjI1LDE4NTI1MDc4NzksNDI3NTMxMzUyNiwyMzEyMzE3OTIwLDI4Mjc1MzYyNiwxNzQyNTU1ODUyLDQxODk3MDgxNDMsMjM5NDg3Nzk0NSwzOTc5MTc3NjMsMTYyMjE4MzYzNywzNjA0MzkwODg4LDI3MTQ4NjY1NTgsOTUzNzI5NzMyLDEzNDAwNzY2MjYsMzUxODcxOTk4NSwyNzk3MzYwOTk5LDEwNjg4MjgzODEsMTIxOTYzODg1OSwzNjI0NzQxODUwLDI5MzY2NzUxNDgsOTA2MTg1NDYyLDEwOTA4MTI1MTIsMzc0NzY3MjAwMywyODI1Mzc5NjY5LDgyOTMyOTEzNSwxMTgxMzM1MTYxLDM0MTIxNzc4MDQsMzE2MDgzNDg0Miw2MjgwODU0MDgsMTM4MjYwNTM2NiwzNDIzMzY5MTA5LDMxMzgwNzg0NjcsNTcwNTYyMjMzLDE0MjY0MDA4MTUsMzMxNzMxNjU0MiwyOTk4NzMzNjA4LDczMzIzOTk1NCwxNTU1MjYxOTU2LAozMjY4OTM1NTkxLDMwNTAzNjA2MjUsNzUyNDU5NDAzLDE1NDEzMjAyMjEsMjYwNzA3MTkyMCwzOTY1OTczMDMwLDE5Njk5MjI5NzIsNDA3MzU0OTgsMjYxNzgzNzIyNSwzOTQzNTc3MTUxLDE5MTMwODc4NzcsODM5MDgzNzEsMjUxMjM0MTYzNCwzODAzNzQwNjkyLDIwNzUyMDg2MjIsMjEzMjYxMTEyLDI0NjMyNzI2MDMsMzg1NTk5MDI4NSwyMDk0ODU0MDcxLDE5ODk1ODg4MSwyMjYyMDI5MDEyLDQwNTcyNjA2MTAsMTc1OTM1OTk5Miw1MzQ0MTQxOTAsMjE3NjcxODU0MSw0MTM5MzI5MTE1LDE4NzM4MzYwMDEsNDE0NjY0NTY3LDIyODIyNDg5MzQsNDI3OTIwMDM2OCwxNzExNjg0NTU0LDI4NTI4MTExNiwyNDA1ODAxNzI3LDQxNjcyMTY3NDUsMTYzNDQ2Nzc5NSwzNzYyMjk3MDEsMjY4NTA2Nzg5NiwzNjA4MDA3NDA2LDEzMDg5MTg2MTIsOTU2NTQzOTM4LDI4MDg1NTUxMDUsMzQ5NTk1ODI2MywxMjMxNjM2MzAxLDEwNDc0MjcwMzUsMjkzMjk1OTgxOCwzNjU0NzAzODM2LDEwODgzNTkyNzAsCjkzNjkxOEUzLDI4NDc3MTQ4OTksMzczNjgzNzgyOSwxMjAyOTAwODYzLDgxNzIzMzg5NywzMTgzMzQyMTA4LDM0MDEyMzcxMzAsMTQwNDI3NzU1Miw2MTU4MTgxNTAsMzEzNDIwNzQ5MywzNDUzNDIxMjAzLDE0MjM4NTc0NDksNjAxNDUwNDMxLDMwMDk4Mzc2MTQsMzI5NDcxMDQ1NiwxNTY3MTAzNzQ2LDcxMTkyODcyNCwzMDIwNjY4NDcxLDMyNzIzODAwNjUsMTUxMDMzNDIzNSw3NTUxNjcxMTddLFQ9Qz9uZXcgVWludDMyQXJyYXkobGEpOmxhO2Z1bmN0aW9uIFUoZil7dGhpcy5idWZmZXI9bmV3IChDP1VpbnQxNkFycmF5OkFycmF5KSgyKmYpO3RoaXMubGVuZ3RoPTB9VS5wcm90b3R5cGUuZ2V0UGFyZW50PWZ1bmN0aW9uKGYpe3JldHVybiAyKigoZi0yKS80fDApfTtVLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKGYsZSl7dmFyIGMsYSxiPXRoaXMuYnVmZmVyLGc7Yz10aGlzLmxlbmd0aDtiW3RoaXMubGVuZ3RoKytdPWU7Zm9yKGJbdGhpcy5sZW5ndGgrK109ZjswPGM7KWlmKGE9dGhpcy5nZXRQYXJlbnQoYyksYltjXT5iW2FdKWc9YltjXSxiW2NdPWJbYV0sYlthXT1nLGc9YltjKzFdLGJbYysxXT1iW2ErMV0sYlthKzFdPWcsYz1hO2Vsc2UgYnJlYWs7cmV0dXJuIHRoaXMubGVuZ3RofTsKVS5wcm90b3R5cGUucG9wPWZ1bmN0aW9uKCl7dmFyIGYsZSxjPXRoaXMuYnVmZmVyLGEsYixnO2U9Y1swXTtmPWNbMV07dGhpcy5sZW5ndGgtPTI7Y1swXT1jW3RoaXMubGVuZ3RoXTtjWzFdPWNbdGhpcy5sZW5ndGgrMV07Zm9yKGc9MDs7KXtiPTIqZysyO2lmKGI+PXRoaXMubGVuZ3RoKWJyZWFrO2IrMjx0aGlzLmxlbmd0aCYmY1tiKzJdPmNbYl0mJihiKz0yKTtpZihjW2JdPmNbZ10pYT1jW2ddLGNbZ109Y1tiXSxjW2JdPWEsYT1jW2crMV0sY1tnKzFdPWNbYisxXSxjW2IrMV09YTtlbHNlIGJyZWFrO2c9Yn1yZXR1cm57aW5kZXg6Zix2YWx1ZTplLGxlbmd0aDp0aGlzLmxlbmd0aH19O2Z1bmN0aW9uIG1hKGYsZSl7dGhpcy5oPW5hO3RoaXMuaj0wO3RoaXMuaW5wdXQ9QyYmZiBpbnN0YW5jZW9mIEFycmF5P25ldyBVaW50OEFycmF5KGYpOmY7dGhpcy5jPTA7ZSYmKGUubGF6eSYmKHRoaXMuaj1lLmxhenkpLCJudW1iZXIiPT09dHlwZW9mIGUuY29tcHJlc3Npb25UeXBlJiYodGhpcy5oPWUuY29tcHJlc3Npb25UeXBlKSxlLm91dHB1dEJ1ZmZlciYmKHRoaXMuYT1DJiZlLm91dHB1dEJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5P25ldyBVaW50OEFycmF5KGUub3V0cHV0QnVmZmVyKTplLm91dHB1dEJ1ZmZlciksIm51bWJlciI9PT10eXBlb2YgZS5vdXRwdXRJbmRleCYmKHRoaXMuYz1lLm91dHB1dEluZGV4KSk7dGhpcy5hfHwodGhpcy5hPW5ldyAoQz9VaW50OEFycmF5OkFycmF5KSgzMjc2OCkpfXZhciBuYT0yLFY9W10sJDsKZm9yKCQ9MDsyODg+JDskKyspc3dpdGNoKHYpe2Nhc2UgMTQzPj0kOlYucHVzaChbJCs0OCw4XSk7YnJlYWs7Y2FzZSAyNTU+PSQ6Vi5wdXNoKFskLTE0NCs0MDAsOV0pO2JyZWFrO2Nhc2UgMjc5Pj0kOlYucHVzaChbJC0yNTYrMCw3XSk7YnJlYWs7Y2FzZSAyODc+PSQ6Vi5wdXNoKFskLTI4MCsxOTIsOF0pO2JyZWFrO2RlZmF1bHQ6dGhyb3ciaW52YWxpZCBsaXRlcmFsOiAiKyQ7fQptYS5wcm90b3R5cGUuZz1mdW5jdGlvbigpe3ZhciBmLGUsYyxhLGI9dGhpcy5pbnB1dDtzd2l0Y2godGhpcy5oKXtjYXNlIDA6Yz0wO2ZvcihhPWIubGVuZ3RoO2M8YTspe2U9Qz9iLnN1YmFycmF5KGMsYys2NTUzNSk6Yi5zbGljZShjLGMrNjU1MzUpO2MrPWUubGVuZ3RoO3ZhciBnPWUsbD1jPT09YSxtPXAsZD1wLGg9cCxzPXAseD1wLG49dGhpcy5hLGs9dGhpcy5jO2lmKEMpe2ZvcihuPW5ldyBVaW50OEFycmF5KHRoaXMuYS5idWZmZXIpO24ubGVuZ3RoPD1rK2cubGVuZ3RoKzU7KW49bmV3IFVpbnQ4QXJyYXkobi5sZW5ndGg8PDEpO24uc2V0KHRoaXMuYSl9bT1sPzE6MDtuW2srK109bXwwO2Q9Zy5sZW5ndGg7aD1+ZCs2NTUzNiY2NTUzNTtuW2srK109ZCYyNTU7bltrKytdPWQ+Pj44JjI1NTtuW2srK109aCYyNTU7bltrKytdPWg+Pj44JjI1NTtpZihDKW4uc2V0KGcsayksays9Zy5sZW5ndGgsbj1uLnN1YmFycmF5KDAsayk7ZWxzZXtzPTA7Zm9yKHg9Zy5sZW5ndGg7czx4OysrcyluW2srK109Cmdbc107bi5sZW5ndGg9a310aGlzLmM9azt0aGlzLmE9bn1icmVhaztjYXNlIDE6dmFyIHE9bmV3IEYoQz9uZXcgVWludDhBcnJheSh0aGlzLmEuYnVmZmVyKTp0aGlzLmEsdGhpcy5jKTtxLmIoMSwxLHYpO3EuYigxLDIsdik7dmFyIHU9b2EodGhpcyxiKSx3LGFhLHo7dz0wO2ZvcihhYT11Lmxlbmd0aDt3PGFhO3crKylpZih6PXVbd10sRi5wcm90b3R5cGUuYi5hcHBseShxLFZbel0pLDI1Njx6KXEuYih1Wysrd10sdVsrK3ddLHYpLHEuYih1Wysrd10sNSkscS5iKHVbKyt3XSx1Wysrd10sdik7ZWxzZSBpZigyNTY9PT16KWJyZWFrO3RoaXMuYT1xLmZpbmlzaCgpO3RoaXMuYz10aGlzLmEubGVuZ3RoO2JyZWFrO2Nhc2UgbmE6dmFyIEI9bmV3IEYoQz9uZXcgVWludDhBcnJheSh0aGlzLmEuYnVmZmVyKTp0aGlzLmEsdGhpcy5jKSxyYSxMLE8sUCxRLEhhPVsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSxXLHNhLFgsdGEsYmEsZWE9QXJyYXkoMTkpLAp1YSxSLGNhLHksdmE7cmE9bmE7Qi5iKDEsMSx2KTtCLmIocmEsMix2KTtMPW9hKHRoaXMsYik7Vz1wYSh0aGlzLm4sMTUpO3NhPXFhKFcpO1g9cGEodGhpcy5tLDcpO3RhPXFhKFgpO2ZvcihPPTI4NjsyNTc8TyYmMD09PVdbTy0xXTtPLS0pO2ZvcihQPTMwOzE8UCYmMD09PVhbUC0xXTtQLS0pO3ZhciB3YT1PLHhhPVAsRz1uZXcgKEM/VWludDMyQXJyYXk6QXJyYXkpKHdhK3hhKSxyLEksdCxZLEU9bmV3IChDP1VpbnQzMkFycmF5OkFycmF5KSgzMTYpLEQsQSxKPW5ldyAoQz9VaW50OEFycmF5OkFycmF5KSgxOSk7Zm9yKHI9ST0wO3I8d2E7cisrKUdbSSsrXT1XW3JdO2ZvcihyPTA7cjx4YTtyKyspR1tJKytdPVhbcl07aWYoIUMpe3I9MDtmb3IoWT1KLmxlbmd0aDtyPFk7KytyKUpbcl09MH1yPUQ9MDtmb3IoWT1HLmxlbmd0aDtyPFk7cis9SSl7Zm9yKEk9MTtyK0k8WSYmR1tyK0ldPT09R1tyXTsrK0kpO3Q9STtpZigwPT09R1tyXSlpZigzPnQpZm9yKDswPHQtLTspRVtEKytdPTAsCkpbMF0rKztlbHNlIGZvcig7MDx0OylBPTEzOD50P3Q6MTM4LEE+dC0zJiZBPHQmJihBPXQtMyksMTA+PUE/KEVbRCsrXT0xNyxFW0QrK109QS0zLEpbMTddKyspOihFW0QrK109MTgsRVtEKytdPUEtMTEsSlsxOF0rKyksdC09QTtlbHNlIGlmKEVbRCsrXT1HW3JdLEpbR1tyXV0rKyx0LS0sMz50KWZvcig7MDx0LS07KUVbRCsrXT1HW3JdLEpbR1tyXV0rKztlbHNlIGZvcig7MDx0OylBPTY+dD90OjYsQT50LTMmJkE8dCYmKEE9dC0zKSxFW0QrK109MTYsRVtEKytdPUEtMyxKWzE2XSsrLHQtPUF9Zj1DP0Uuc3ViYXJyYXkoMCxEKTpFLnNsaWNlKDAsRCk7YmE9cGEoSiw3KTtmb3IoeT0wOzE5Pnk7eSsrKWVhW3ldPWJhW0hhW3ldXTtmb3IoUT0xOTs0PFEmJjA9PT1lYVtRLTFdO1EtLSk7dWE9cWEoYmEpO0IuYihPLTI1Nyw1LHYpO0IuYihQLTEsNSx2KTtCLmIoUS00LDQsdik7Zm9yKHk9MDt5PFE7eSsrKUIuYihlYVt5XSwzLHYpO3k9MDtmb3IodmE9Zi5sZW5ndGg7eTx2YTt5KyspaWYoUj0KZlt5XSxCLmIodWFbUl0sYmFbUl0sdiksMTY8PVIpe3krKztzd2l0Y2goUil7Y2FzZSAxNjpjYT0yO2JyZWFrO2Nhc2UgMTc6Y2E9MzticmVhaztjYXNlIDE4OmNhPTc7YnJlYWs7ZGVmYXVsdDp0aHJvdyJpbnZhbGlkIGNvZGU6ICIrUjt9Qi5iKGZbeV0sY2Esdil9dmFyIHlhPVtzYSxXXSx6YT1bdGEsWF0sSyxBYSxaLGhhLEJhLENhLERhLEVhO0JhPXlhWzBdO0NhPXlhWzFdO0RhPXphWzBdO0VhPXphWzFdO0s9MDtmb3IoQWE9TC5sZW5ndGg7SzxBYTsrK0spaWYoWj1MW0tdLEIuYihCYVtaXSxDYVtaXSx2KSwyNTY8WilCLmIoTFsrK0tdLExbKytLXSx2KSxoYT1MWysrS10sQi5iKERhW2hhXSxFYVtoYV0sdiksQi5iKExbKytLXSxMWysrS10sdik7ZWxzZSBpZigyNTY9PT1aKWJyZWFrO3RoaXMuYT1CLmZpbmlzaCgpO3RoaXMuYz10aGlzLmEubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6dGhyb3ciaW52YWxpZCBjb21wcmVzc2lvbiB0eXBlIjt9cmV0dXJuIHRoaXMuYX07CmZ1bmN0aW9uIEZhKGYsZSl7dGhpcy5sZW5ndGg9Zjt0aGlzLms9ZX0KdmFyIEdhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZihiKXtzd2l0Y2godil7Y2FzZSAzPT09YjpyZXR1cm5bMjU3LGItMywwXTtjYXNlIDQ9PT1iOnJldHVyblsyNTgsYi00LDBdO2Nhc2UgNT09PWI6cmV0dXJuWzI1OSxiLTUsMF07Y2FzZSA2PT09YjpyZXR1cm5bMjYwLGItNiwwXTtjYXNlIDc9PT1iOnJldHVyblsyNjEsYi03LDBdO2Nhc2UgOD09PWI6cmV0dXJuWzI2MixiLTgsMF07Y2FzZSA5PT09YjpyZXR1cm5bMjYzLGItOSwwXTtjYXNlIDEwPT09YjpyZXR1cm5bMjY0LGItMTAsMF07Y2FzZSAxMj49YjpyZXR1cm5bMjY1LGItMTEsMV07Y2FzZSAxND49YjpyZXR1cm5bMjY2LGItMTMsMV07Y2FzZSAxNj49YjpyZXR1cm5bMjY3LGItMTUsMV07Y2FzZSAxOD49YjpyZXR1cm5bMjY4LGItMTcsMV07Y2FzZSAyMj49YjpyZXR1cm5bMjY5LGItMTksMl07Y2FzZSAyNj49YjpyZXR1cm5bMjcwLGItMjMsMl07Y2FzZSAzMD49YjpyZXR1cm5bMjcxLGItMjcsMl07Y2FzZSAzND49YjpyZXR1cm5bMjcyLApiLTMxLDJdO2Nhc2UgNDI+PWI6cmV0dXJuWzI3MyxiLTM1LDNdO2Nhc2UgNTA+PWI6cmV0dXJuWzI3NCxiLTQzLDNdO2Nhc2UgNTg+PWI6cmV0dXJuWzI3NSxiLTUxLDNdO2Nhc2UgNjY+PWI6cmV0dXJuWzI3NixiLTU5LDNdO2Nhc2UgODI+PWI6cmV0dXJuWzI3NyxiLTY3LDRdO2Nhc2UgOTg+PWI6cmV0dXJuWzI3OCxiLTgzLDRdO2Nhc2UgMTE0Pj1iOnJldHVyblsyNzksYi05OSw0XTtjYXNlIDEzMD49YjpyZXR1cm5bMjgwLGItMTE1LDRdO2Nhc2UgMTYyPj1iOnJldHVyblsyODEsYi0xMzEsNV07Y2FzZSAxOTQ+PWI6cmV0dXJuWzI4MixiLTE2Myw1XTtjYXNlIDIyNj49YjpyZXR1cm5bMjgzLGItMTk1LDVdO2Nhc2UgMjU3Pj1iOnJldHVyblsyODQsYi0yMjcsNV07Y2FzZSAyNTg9PT1iOnJldHVyblsyODUsYi0yNTgsMF07ZGVmYXVsdDp0aHJvdyJpbnZhbGlkIGxlbmd0aDogIitiO319dmFyIGU9W10sYyxhO2ZvcihjPTM7MjU4Pj1jO2MrKylhPWYoYyksZVtjXT1hWzJdPDwyNHwKYVsxXTw8MTZ8YVswXTtyZXR1cm4gZX0oKSxJYT1DP25ldyBVaW50MzJBcnJheShHYSk6R2E7CmZ1bmN0aW9uIG9hKGYsZSl7ZnVuY3Rpb24gYyhiLGUpe3ZhciBhPWIuayxjPVtdLGc9MCxmO2Y9SWFbYi5sZW5ndGhdO2NbZysrXT1mJjY1NTM1O2NbZysrXT1mPj4xNiYyNTU7Y1tnKytdPWY+PjI0O3ZhciBkO3N3aXRjaCh2KXtjYXNlIDE9PT1hOmQ9WzAsYS0xLDBdO2JyZWFrO2Nhc2UgMj09PWE6ZD1bMSxhLTIsMF07YnJlYWs7Y2FzZSAzPT09YTpkPVsyLGEtMywwXTticmVhaztjYXNlIDQ9PT1hOmQ9WzMsYS00LDBdO2JyZWFrO2Nhc2UgNj49YTpkPVs0LGEtNSwxXTticmVhaztjYXNlIDg+PWE6ZD1bNSxhLTcsMV07YnJlYWs7Y2FzZSAxMj49YTpkPVs2LGEtOSwyXTticmVhaztjYXNlIDE2Pj1hOmQ9WzcsYS0xMywyXTticmVhaztjYXNlIDI0Pj1hOmQ9WzgsYS0xNywzXTticmVhaztjYXNlIDMyPj1hOmQ9WzksYS0yNSwzXTticmVhaztjYXNlIDQ4Pj1hOmQ9WzEwLGEtMzMsNF07YnJlYWs7Y2FzZSA2ND49YTpkPVsxMSxhLTQ5LDRdO2JyZWFrO2Nhc2UgOTY+PWE6ZD1bMTIsYS0KNjUsNV07YnJlYWs7Y2FzZSAxMjg+PWE6ZD1bMTMsYS05Nyw1XTticmVhaztjYXNlIDE5Mj49YTpkPVsxNCxhLTEyOSw2XTticmVhaztjYXNlIDI1Nj49YTpkPVsxNSxhLTE5Myw2XTticmVhaztjYXNlIDM4ND49YTpkPVsxNixhLTI1Nyw3XTticmVhaztjYXNlIDUxMj49YTpkPVsxNyxhLTM4NSw3XTticmVhaztjYXNlIDc2OD49YTpkPVsxOCxhLTUxMyw4XTticmVhaztjYXNlIDEwMjQ+PWE6ZD1bMTksYS03NjksOF07YnJlYWs7Y2FzZSAxNTM2Pj1hOmQ9WzIwLGEtMTAyNSw5XTticmVhaztjYXNlIDIwNDg+PWE6ZD1bMjEsYS0xNTM3LDldO2JyZWFrO2Nhc2UgMzA3Mj49YTpkPVsyMixhLTIwNDksMTBdO2JyZWFrO2Nhc2UgNDA5Nj49YTpkPVsyMyxhLTMwNzMsMTBdO2JyZWFrO2Nhc2UgNjE0ND49YTpkPVsyNCxhLTQwOTcsMTFdO2JyZWFrO2Nhc2UgODE5Mj49YTpkPVsyNSxhLTYxNDUsMTFdO2JyZWFrO2Nhc2UgMTIyODg+PWE6ZD1bMjYsYS04MTkzLDEyXTticmVhaztjYXNlIDE2Mzg0Pj0KYTpkPVsyNyxhLTEyMjg5LDEyXTticmVhaztjYXNlIDI0NTc2Pj1hOmQ9WzI4LGEtMTYzODUsMTNdO2JyZWFrO2Nhc2UgMzI3Njg+PWE6ZD1bMjksYS0yNDU3NywxM107YnJlYWs7ZGVmYXVsdDp0aHJvdyJpbnZhbGlkIGRpc3RhbmNlIjt9Zj1kO2NbZysrXT1mWzBdO2NbZysrXT1mWzFdO2NbZysrXT1mWzJdO3ZhciBoLGw7aD0wO2ZvcihsPWMubGVuZ3RoO2g8bDsrK2gpbltrKytdPWNbaF07dVtjWzBdXSsrO3dbY1szXV0rKztxPWIubGVuZ3RoK2UtMTt4PW51bGx9dmFyIGEsYixnLGwsbSxkPXt9LGgscyx4LG49Qz9uZXcgVWludDE2QXJyYXkoMiplLmxlbmd0aCk6W10saz0wLHE9MCx1PW5ldyAoQz9VaW50MzJBcnJheTpBcnJheSkoMjg2KSx3PW5ldyAoQz9VaW50MzJBcnJheTpBcnJheSkoMzApLGFhPWYuaix6O2lmKCFDKXtmb3IoZz0wOzI4NT49ZzspdVtnKytdPTA7Zm9yKGc9MDsyOT49Zzspd1tnKytdPTB9dVsyNTZdPTE7YT0wO2ZvcihiPWUubGVuZ3RoO2E8YjsrK2Epe2c9Cm09MDtmb3IobD0zO2c8bCYmYStnIT09YjsrK2cpbT1tPDw4fGVbYStnXTtkW21dPT09cCYmKGRbbV09W10pO2g9ZFttXTtpZighKDA8cS0tKSl7Zm9yKDswPGgubGVuZ3RoJiYzMjc2ODxhLWhbMF07KWguc2hpZnQoKTtpZihhKzM+PWIpe3gmJmMoeCwtMSk7Zz0wO2ZvcihsPWItYTtnPGw7KytnKXo9ZVthK2ddLG5baysrXT16LCsrdVt6XTticmVha30wPGgubGVuZ3RoPyhzPUphKGUsYSxoKSx4P3gubGVuZ3RoPHMubGVuZ3RoPyh6PWVbYS0xXSxuW2srK109eiwrK3Vbel0sYyhzLDApKTpjKHgsLTEpOnMubGVuZ3RoPGFhP3g9czpjKHMsMCkpOng/Yyh4LC0xKTooej1lW2FdLG5baysrXT16LCsrdVt6XSl9aC5wdXNoKGEpfW5baysrXT0yNTY7dVsyNTZdKys7Zi5uPXU7Zi5tPXc7cmV0dXJuIEM/bi5zdWJhcnJheSgwLGspOm59CmZ1bmN0aW9uIEphKGYsZSxjKXt2YXIgYSxiLGc9MCxsLG0sZCxoLHM9Zi5sZW5ndGg7bT0wO2g9Yy5sZW5ndGg7YTpmb3IoO208aDttKyspe2E9Y1toLW0tMV07bD0zO2lmKDM8Zyl7Zm9yKGQ9ZzszPGQ7ZC0tKWlmKGZbYStkLTFdIT09ZltlK2QtMV0pY29udGludWUgYTtsPWd9Zm9yKDsyNTg+bCYmZStsPHMmJmZbYStsXT09PWZbZStsXTspKytsO2w+ZyYmKGI9YSxnPWwpO2lmKDI1OD09PWwpYnJlYWt9cmV0dXJuIG5ldyBGYShnLGUtYil9CmZ1bmN0aW9uIHBhKGYsZSl7dmFyIGM9Zi5sZW5ndGgsYT1uZXcgVSg1NzIpLGI9bmV3IChDP1VpbnQ4QXJyYXk6QXJyYXkpKGMpLGcsbCxtLGQsaDtpZighQylmb3IoZD0wO2Q8YztkKyspYltkXT0wO2ZvcihkPTA7ZDxjOysrZCkwPGZbZF0mJmEucHVzaChkLGZbZF0pO2c9QXJyYXkoYS5sZW5ndGgvMik7bD1uZXcgKEM/VWludDMyQXJyYXk6QXJyYXkpKGEubGVuZ3RoLzIpO2lmKDE9PT1nLmxlbmd0aClyZXR1cm4gYlthLnBvcCgpLmluZGV4XT0xLGI7ZD0wO2ZvcihoPWEubGVuZ3RoLzI7ZDxoOysrZClnW2RdPWEucG9wKCksbFtkXT1nW2RdLnZhbHVlO209S2EobCxsLmxlbmd0aCxlKTtkPTA7Zm9yKGg9Zy5sZW5ndGg7ZDxoOysrZCliW2dbZF0uaW5kZXhdPW1bZF07cmV0dXJuIGJ9CmZ1bmN0aW9uIEthKGYsZSxjKXtmdW5jdGlvbiBhKGIpe3ZhciBjPWRbYl1baFtiXV07Yz09PWU/KGEoYisxKSxhKGIrMSkpOi0tbFtjXTsrK2hbYl19dmFyIGI9bmV3IChDP1VpbnQxNkFycmF5OkFycmF5KShjKSxnPW5ldyAoQz9VaW50OEFycmF5OkFycmF5KShjKSxsPW5ldyAoQz9VaW50OEFycmF5OkFycmF5KShlKSxtPUFycmF5KGMpLGQ9QXJyYXkoYyksaD1BcnJheShjKSxzPSgxPDxjKS1lLHg9MTw8Yy0xLG4sayxxLHUsdztiW2MtMV09ZTtmb3Ioaz0wO2s8YzsrK2spczx4P2dba109MDooZ1trXT0xLHMtPXgpLHM8PD0xLGJbYy0yLWtdPShiW2MtMS1rXS8yfDApK2U7YlswXT1nWzBdO21bMF09QXJyYXkoYlswXSk7ZFswXT1BcnJheShiWzBdKTtmb3Ioaz0xO2s8YzsrK2spYltrXT4yKmJbay0xXStnW2tdJiYoYltrXT0yKmJbay0xXStnW2tdKSxtW2tdPUFycmF5KGJba10pLGRba109QXJyYXkoYltrXSk7Zm9yKG49MDtuPGU7KytuKWxbbl09Yztmb3IocT0wO3E8YltjLTFdOysrcSltW2MtCjFdW3FdPWZbcV0sZFtjLTFdW3FdPXE7Zm9yKG49MDtuPGM7KytuKWhbbl09MDsxPT09Z1tjLTFdJiYoLS1sWzBdLCsraFtjLTFdKTtmb3Ioaz1jLTI7MDw9azstLWspe3U9bj0wO3c9aFtrKzFdO2ZvcihxPTA7cTxiW2tdO3ErKyl1PW1baysxXVt3XSttW2srMV1bdysxXSx1PmZbbl0/KG1ba11bcV09dSxkW2tdW3FdPWUsdys9Mik6KG1ba11bcV09ZltuXSxkW2tdW3FdPW4sKytuKTtoW2tdPTA7MT09PWdba10mJmEoayl9cmV0dXJuIGx9CmZ1bmN0aW9uIHFhKGYpe3ZhciBlPW5ldyAoQz9VaW50MTZBcnJheTpBcnJheSkoZi5sZW5ndGgpLGM9W10sYT1bXSxiPTAsZyxsLG0sZDtnPTA7Zm9yKGw9Zi5sZW5ndGg7ZzxsO2crKyljW2ZbZ11dPShjW2ZbZ11dfDApKzE7Zz0xO2ZvcihsPTE2O2c8PWw7ZysrKWFbZ109YixiKz1jW2ddfDAsYjw8PTE7Zz0wO2ZvcihsPWYubGVuZ3RoO2c8bDtnKyspe2I9YVtmW2ddXTthW2ZbZ11dKz0xO209ZVtnXT0wO2ZvcihkPWZbZ107bTxkO20rKyllW2ddPWVbZ108PDF8YiYxLGI+Pj49MX1yZXR1cm4gZX07ZnVuY3Rpb24gTGEoZixlKXt0aGlzLmlucHV0PWY7dGhpcy5jPXRoaXMuaT0wO3RoaXMuZD17fTtlJiYoZS5mbGFncyYmKHRoaXMuZD1lLmZsYWdzKSwic3RyaW5nIj09PXR5cGVvZiBlLmZpbGVuYW1lJiYodGhpcy5maWxlbmFtZT1lLmZpbGVuYW1lKSwic3RyaW5nIj09PXR5cGVvZiBlLmNvbW1lbnQmJih0aGlzLmw9ZS5jb21tZW50KSxlLmRlZmxhdGVPcHRpb25zJiYodGhpcy5lPWUuZGVmbGF0ZU9wdGlvbnMpKTt0aGlzLmV8fCh0aGlzLmU9e30pfQpMYS5wcm90b3R5cGUuZz1mdW5jdGlvbigpe3ZhciBmLGUsYyxhLGIsZyxsLG0sZD1uZXcgKEM/VWludDhBcnJheTpBcnJheSkoMzI3NjgpLGg9MCxzPXRoaXMuaW5wdXQseD10aGlzLmksbj10aGlzLmZpbGVuYW1lLGs9dGhpcy5sO2RbaCsrXT0zMTtkW2grK109MTM5O2RbaCsrXT04O2Y9MDt0aGlzLmQuZm5hbWUmJihmfD1NYSk7dGhpcy5kLmZjb21tZW50JiYoZnw9TmEpO3RoaXMuZC5maGNyYyYmKGZ8PU9hKTtkW2grK109ZjtlPShEYXRlLm5vdz9EYXRlLm5vdygpOituZXcgRGF0ZSkvMUUzfDA7ZFtoKytdPWUmMjU1O2RbaCsrXT1lPj4+OCYyNTU7ZFtoKytdPWU+Pj4xNiYyNTU7ZFtoKytdPWU+Pj4yNCYyNTU7ZFtoKytdPTA7ZFtoKytdPVBhO2lmKHRoaXMuZC5mbmFtZSE9PXApe2w9MDtmb3IobT1uLmxlbmd0aDtsPG07KytsKWc9bi5jaGFyQ29kZUF0KGwpLDI1NTxnJiYoZFtoKytdPWc+Pj44JjI1NSksZFtoKytdPWcmMjU1O2RbaCsrXT0wfWlmKHRoaXMuZC5jb21tZW50KXtsPQowO2ZvcihtPWsubGVuZ3RoO2w8bTsrK2wpZz1rLmNoYXJDb2RlQXQobCksMjU1PGcmJihkW2grK109Zz4+PjgmMjU1KSxkW2grK109ZyYyNTU7ZFtoKytdPTB9dGhpcy5kLmZoY3JjJiYoYz1rYShkLDAsaCkmNjU1MzUsZFtoKytdPWMmMjU1LGRbaCsrXT1jPj4+OCYyNTUpO3RoaXMuZS5vdXRwdXRCdWZmZXI9ZDt0aGlzLmUub3V0cHV0SW5kZXg9aDtiPW5ldyBtYShzLHRoaXMuZSk7ZD1iLmcoKTtoPWIuYztDJiYoaCs4PmQuYnVmZmVyLmJ5dGVMZW5ndGg/KHRoaXMuYT1uZXcgVWludDhBcnJheShoKzgpLHRoaXMuYS5zZXQobmV3IFVpbnQ4QXJyYXkoZC5idWZmZXIpKSxkPXRoaXMuYSk6ZD1uZXcgVWludDhBcnJheShkLmJ1ZmZlcikpO2E9a2EocyxwLHApO2RbaCsrXT1hJjI1NTtkW2grK109YT4+PjgmMjU1O2RbaCsrXT1hPj4+MTYmMjU1O2RbaCsrXT1hPj4+MjQmMjU1O209cy5sZW5ndGg7ZFtoKytdPW0mMjU1O2RbaCsrXT1tPj4+OCYyNTU7ZFtoKytdPW0+Pj4xNiYyNTU7ZFtoKytdPQptPj4+MjQmMjU1O3RoaXMuaT14O0MmJmg8ZC5sZW5ndGgmJih0aGlzLmE9ZD1kLnN1YmFycmF5KDAsaCkpO3JldHVybiBkfTt2YXIgUGE9MjU1LE9hPTIsTWE9OCxOYT0xNjtmYSgiWmxpYi5HemlwIixMYSk7ZmEoIlpsaWIuR3ppcC5wcm90b3R5cGUuY29tcHJlc3MiLExhLnByb3RvdHlwZS5nKTt9KS5jYWxsKHRoaXMpOwoK"},"uglify.js": {"content_type": "text/javascript","data": "IWZ1bmN0aW9uKGUsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQoZSl7Zm9yKHZhciBuPU9iamVjdC5jcmVhdGUobnVsbCksdD0wO3Q8ZS5sZW5ndGg7Kyt0KW5bZVt0XV09ITA7cmV0dXJuIG59ZnVuY3Rpb24gcihlKXtyZXR1cm4gZS5zcGxpdCgiIil9ZnVuY3Rpb24gaShlLG4pe3JldHVybiBuLmluZGV4T2YoZSk+PTB9ZnVuY3Rpb24gbyhlLG4pe2Zvcih2YXIgdD0wLHI9bi5sZW5ndGg7dDxyOysrdClpZihlKG5bdF0pKXJldHVybiBuW3RdfWZ1bmN0aW9uIHUoZSxuKXtpZihuPD0wKXJldHVybiIiO2lmKDE9PW4pcmV0dXJuIGU7dmFyIHQ9dShlLG4+PjEpO3JldHVybiB0Kz10LDEmbiYmKHQrPWUpLHR9ZnVuY3Rpb24gYShlLG4pe0Vycm9yLmNhbGwodGhpcyxlKSx0aGlzLm1zZz1lLHRoaXMuZGVmcz1ufWZ1bmN0aW9uIHMoZSxuLHQpe2U9PT0hMCYmKGU9e30pO3ZhciByPWV8fHt9O2lmKHQpZm9yKHZhciBpIGluIHIpeShyLGkpJiYheShuLGkpJiZhLmNyb2FrKCJgIitpKyJgIGlzIG5vdCBhIHN1cHBvcnRlZCBvcHRpb24iLG4pO2Zvcih2YXIgaSBpbiBuKXkobixpKSYmKHJbaV09ZSYmeShlLGkpP2VbaV06bltpXSk7cmV0dXJuIHJ9ZnVuY3Rpb24gYyhlLG4pe3ZhciB0PTA7Zm9yKHZhciByIGluIG4peShuLHIpJiYoZVtyXT1uW3JdLHQrKyk7cmV0dXJuIHR9ZnVuY3Rpb24gZigpe31mdW5jdGlvbiBsKCl7cmV0dXJuITF9ZnVuY3Rpb24gcCgpe3JldHVybiEwfWZ1bmN0aW9uIGQoZSxuKXtlLmluZGV4T2Yobik8MCYmZS5wdXNoKG4pfWZ1bmN0aW9uIGgoZSxuKXtyZXR1cm4gZS5yZXBsYWNlKC9ceyguKz8pXH0vZyxmdW5jdGlvbihlLHQpe3JldHVybiBuW3RdfSl9ZnVuY3Rpb24gRChlLG4pe2Zvcih2YXIgdD1lLmxlbmd0aDstLXQ+PTA7KWVbdF09PT1uJiZlLnNwbGljZSh0LDEpfWZ1bmN0aW9uIG0oZSxuKXtmdW5jdGlvbiB0KGUsdCl7Zm9yKHZhciByPVtdLGk9MCxvPTAsdT0wO2k8ZS5sZW5ndGgmJm88dC5sZW5ndGg7KW4oZVtpXSx0W29dKTw9MD9yW3UrK109ZVtpKytdOnJbdSsrXT10W28rK107cmV0dXJuIGk8ZS5sZW5ndGgmJnIucHVzaC5hcHBseShyLGUuc2xpY2UoaSkpLG88dC5sZW5ndGgmJnIucHVzaC5hcHBseShyLHQuc2xpY2UobykpLHJ9ZnVuY3Rpb24gcihlKXtpZihlLmxlbmd0aDw9MSlyZXR1cm4gZTt2YXIgbj1NYXRoLmZsb29yKGUubGVuZ3RoLzIpLGk9ZS5zbGljZSgwLG4pLG89ZS5zbGljZShuKTtyZXR1cm4gaT1yKGkpLG89cihvKSx0KGksbyl9cmV0dXJuIGUubGVuZ3RoPDI/ZS5zbGljZSgpOnIoZSl9ZnVuY3Rpb24gdihlKXtmdW5jdGlvbiBuKGUpe3JldHVybiBKU09OLnN0cmluZ2lmeShlKS5yZXBsYWNlKC9bXHUyMDI4XHUyMDI5XS9nLGZ1bmN0aW9uKGUpe3N3aXRjaChlKXtjYXNlIlx1MjAyOCI6cmV0dXJuIlxcdTIwMjgiO2Nhc2UiXHUyMDI5IjpyZXR1cm4iXFx1MjAyOSJ9cmV0dXJuIGV9KX1mdW5jdGlvbiB0KGUpe2lmKDE9PWUubGVuZ3RoKXJldHVybiByKz0icmV0dXJuIHN0ciA9PT0gIituKGVbMF0pKyI7IjtyKz0ic3dpdGNoKHN0cil7Ijtmb3IodmFyIHQ9MDt0PGUubGVuZ3RoOysrdClyKz0iY2FzZSAiK24oZVt0XSkrIjoiO3IrPSJyZXR1cm4gdHJ1ZX1yZXR1cm4gZmFsc2U7In1lIGluc3RhbmNlb2YgQXJyYXl8fChlPWUuc3BsaXQoIiAiKSk7dmFyIHI9IiIsaT1bXTtlOmZvcih2YXIgbz0wO288ZS5sZW5ndGg7KytvKXtmb3IodmFyIHU9MDt1PGkubGVuZ3RoOysrdSlpZihpW3VdWzBdLmxlbmd0aD09ZVtvXS5sZW5ndGgpe2lbdV0ucHVzaChlW29dKTtjb250aW51ZSBlfWkucHVzaChbZVtvXV0pfWlmKGkubGVuZ3RoPjMpe2kuc29ydChmdW5jdGlvbihlLG4pe3JldHVybiBuLmxlbmd0aC1lLmxlbmd0aH0pLHIrPSJzd2l0Y2goc3RyLmxlbmd0aCl7Ijtmb3IodmFyIG89MDtvPGkubGVuZ3RoOysrbyl7dmFyIGE9aVtvXTtyKz0iY2FzZSAiK2FbMF0ubGVuZ3RoKyI6Iix0KGEpfXIrPSJ9In1lbHNlIHQoZSk7cmV0dXJuIG5ldyBGdW5jdGlvbigic3RyIixyKX1mdW5jdGlvbiBfKGUsbil7Zm9yKHZhciB0PWUubGVuZ3RoOy0tdD49MDspaWYoIW4oZVt0XSkpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gZygpe3RoaXMuX3ZhbHVlcz1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuX3NpemU9MH1mdW5jdGlvbiB5KGUsbil7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLG4pfWZ1bmN0aW9uIGIobix0LHIsaSl7YXJndW1lbnRzLmxlbmd0aDw0JiYoaT1LKSx0PXQ/dC5zcGxpdCgvXHMrLyk6W107dmFyIG89dDtpJiZpLlBST1BTJiYodD10LmNvbmNhdChpLlBST1BTKSk7Zm9yKHZhciB1PSJyZXR1cm4gZnVuY3Rpb24gQVNUXyIrbisiKHByb3BzKXsgaWYgKHByb3BzKSB7ICIsYT10Lmxlbmd0aDstLWE+PTA7KXUrPSJ0aGlzLiIrdFthXSsiID0gcHJvcHMuIit0W2FdKyI7Ijt2YXIgcz1pJiZuZXcgaTsocyYmcy5pbml0aWFsaXplfHxyJiZyLmluaXRpYWxpemUpJiYodSs9InRoaXMuaW5pdGlhbGl6ZSgpOyIpLHUrPSJ9fSI7dmFyIGM9bmV3IEZ1bmN0aW9uKHUpKCk7aWYocyYmKGMucHJvdG90eXBlPXMsYy5CQVNFPWkpLGkmJmkuU1VCQ0xBU1NFUy5wdXNoKGMpLGMucHJvdG90eXBlLkNUT1I9YyxjLlBST1BTPXR8fG51bGwsYy5TRUxGX1BST1BTPW8sYy5TVUJDTEFTU0VTPVtdLG4mJihjLnByb3RvdHlwZS5UWVBFPWMuVFlQRT1uKSxyKWZvcihhIGluIHIpeShyLGEpJiYoL15cJC8udGVzdChhKT9jW2Euc3Vic3RyKDEpXT1yW2FdOmMucHJvdG90eXBlW2FdPXJbYV0pO3JldHVybiBjLkRFRk1FVEhPRD1mdW5jdGlvbihlLG4pe3RoaXMucHJvdG90eXBlW2VdPW59LGVbIkFTVF8iK25dPWMsY31mdW5jdGlvbiBFKGUsbil7ZS5ib2R5IGluc3RhbmNlb2YgSz9lLmJvZHkuX3dhbGsobik6ZS5ib2R5LmZvckVhY2goZnVuY3Rpb24oZSl7ZS5fd2FsayhuKX0pfWZ1bmN0aW9uIEEoZSl7dGhpcy52aXNpdD1lLHRoaXMuc3RhY2s9W10sdGhpcy5kaXJlY3RpdmVzPU9iamVjdC5jcmVhdGUobnVsbCl9ZnVuY3Rpb24gRihlLG4pe3ZhciB0PWUuY2hhckF0KG4pO3JldHVybiB0Pj0i77+9IiYmdDw9Iu+/vSI/dCtlLmNoYXJBdChuKzEpOnR9ZnVuY3Rpb24gdyhlLG4pe3JldHVybiB4KGUuY2hhckF0KG4pKT82NTUzNisoZS5jaGFyQ29kZUF0KG4pLTU1Mjk2PDwxMCkrZS5jaGFyQ29kZUF0KG4rMSktNTYzMjA6ZS5jaGFyQ29kZUF0KG4pfWZ1bmN0aW9uIEMoZSl7Zm9yKHZhciBuPTAsdD0wO3Q8ZS5sZW5ndGg7dCsrKWUuY2hhckNvZGVBdCh0KT49NTUyOTYmJmUuY2hhckNvZGVBdCh0KTw9NTYzMTkmJmUuY2hhckNvZGVBdCh0KzEpPj01NjMyMCYmZS5jaGFyQ29kZUF0KHQrMSk8PTU3MzQzJiYobisrLHQrKyk7cmV0dXJuIGUubGVuZ3RoLW59ZnVuY3Rpb24gayhlKXtyZXR1cm4gZT42NTUzNT8oZS09NjU1MzYsU3RyaW5nLmZyb21DaGFyQ29kZSgoZT4+MTApKzU1Mjk2KStTdHJpbmcuZnJvbUNoYXJDb2RlKGUlMTAyNCs1NjMyMCkpOlN0cmluZy5mcm9tQ2hhckNvZGUoZSl9ZnVuY3Rpb24geChlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGUmJihlPWUuY2hhckNvZGVBdCgwKSksZT49NTUyOTYmJmU8PTU2MzE5fWZ1bmN0aW9uIEIoZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiYoZT1lLmNoYXJDb2RlQXQoMCkpLGU+PTU2MzIwJiZlPD01NzM0M31mdW5jdGlvbiBTKGUpe3JldHVybiBlPj00OCYmZTw9NTd9ZnVuY3Rpb24gVChlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGUmJiFvdChlKX1mdW5jdGlvbiAkKGUpe3ZhciBuPWUuY2hhckNvZGVBdCgwKTtyZXR1cm4geXQuSURfU3RhcnQudGVzdChlKXx8MzY9PW58fDk1PT1ufWZ1bmN0aW9uIE8oZSl7dmFyIG49ZS5jaGFyQ29kZUF0KDApO3JldHVybiB5dC5JRF9Db250aW51ZS50ZXN0KGUpfHwzNj09bnx8OTU9PW58fDgyMDQ9PW58fDgyMDU9PW59ZnVuY3Rpb24gcShlKXtyZXR1cm4vXlthLXpfJF1bYS16MC05XyRdKiQvaS50ZXN0KGUpfWZ1bmN0aW9uIE0oZSl7aWYoY3QudGVzdChlKSlyZXR1cm4gcGFyc2VJbnQoZS5zdWJzdHIoMiksMTYpO2lmKGZ0LnRlc3QoZSkpcmV0dXJuIHBhcnNlSW50KGUuc3Vic3RyKDEpLDgpO2lmKGx0LnRlc3QoZSkpcmV0dXJuIHBhcnNlSW50KGUuc3Vic3RyKDIpLDgpO2lmKHB0LnRlc3QoZSkpcmV0dXJuIHBhcnNlSW50KGUuc3Vic3RyKDIpLDIpO2lmKGR0LnRlc3QoZSkpcmV0dXJuIHBhcnNlRmxvYXQoZSk7dmFyIG49cGFyc2VGbG9hdChlKTtyZXR1cm4gbj09ZT9uOnZvaWQgMH1mdW5jdGlvbiB6KGUsbix0LHIsaSl7dGhpcy5tZXNzYWdlPWUsdGhpcy5maWxlbmFtZT1uLHRoaXMubGluZT10LHRoaXMuY29sPXIsdGhpcy5wb3M9aSx0aGlzLnN0YWNrPShuZXcgRXJyb3IpLnN0YWNrfWZ1bmN0aW9uIE4oZSxuLHQscixpKXt0aHJvdyBuZXcgeihlLG4sdCxyLGkpfWZ1bmN0aW9uIGooZSxuLHQpe3JldHVybiBlLnR5cGU9PW4mJihudWxsPT10fHxlLnZhbHVlPT10KX1mdW5jdGlvbiBIKGUsbix0LHIpe2Z1bmN0aW9uIGkoKXtyZXR1cm4gRihxLnRleHQscS5wb3MpfWZ1bmN0aW9uIG8oZSxuKXt2YXIgdD1GKHEudGV4dCxxLnBvcysrKTtpZihlJiYhdCl0aHJvdyBidDtyZXR1cm4gbXQodCk/KHEubmV3bGluZV9iZWZvcmU9cS5uZXdsaW5lX2JlZm9yZXx8IW4sKytxLmxpbmUscS5jb2w9MCxufHwiXHIiIT10fHwiXG4iIT1pKCl8fCgrK3EucG9zLHQ9IlxuIikpOih4KHQpJiYoKytxLnBvcywrK3EuY29sKSwrK3EuY29sKSx0fWZ1bmN0aW9uIHUoZSl7Zm9yKDtlLS0gPjA7KW8oKX1mdW5jdGlvbiBhKGUpe3JldHVybiBxLnRleHQuc3Vic3RyKHEucG9zLGUubGVuZ3RoKT09ZX1mdW5jdGlvbiBzKCl7Zm9yKHZhciBlPXEudGV4dCxuPXEucG9zLHQ9cS50ZXh0Lmxlbmd0aDtuPHQ7KytuKXt2YXIgcj1lW25dO2lmKG10KHIpKXJldHVybiBufXJldHVybi0xfWZ1bmN0aW9uIGMoZSxuKXt2YXIgdD1xLnRleHQuaW5kZXhPZihlLHEucG9zKTtpZihuJiZ0PT0tMSl0aHJvdyBidDtyZXR1cm4gdH1mdW5jdGlvbiBmKCl7cS50b2tsaW5lPXEubGluZSxxLnRva2NvbD1xLmNvbCxxLnRva3Bvcz1xLnBvc31mdW5jdGlvbiBsKHQscixpKXtxLnJlZ2V4X2FsbG93ZWQ9Im9wZXJhdG9yIj09dCYmIUF0KHIpfHwia2V5d29yZCI9PXQmJnV0KHIpfHwicHVuYyI9PXQmJl90KHIpfHwiYXJyb3ciPT10LHo9InB1bmMiPT10JiYiLiI9PXI7dmFyIG89e3R5cGU6dCx2YWx1ZTpyLGxpbmU6cS50b2tsaW5lLGNvbDpxLnRva2NvbCxwb3M6cS50b2twb3MsZW5kbGluZTpxLmxpbmUsZW5kY29sOnEuY29sLGVuZHBvczpxLnBvcyxubGI6cS5uZXdsaW5lX2JlZm9yZSxmaWxlOm59O2lmKC9eKD86bnVtfHN0cmluZ3xyZWdleHApJC9pLnRlc3QodCkmJihvLnJhdz1lLnN1YnN0cmluZyhvLnBvcyxvLmVuZHBvcykpLCFpKXtvLmNvbW1lbnRzX2JlZm9yZT1xLmNvbW1lbnRzX2JlZm9yZSxxLmNvbW1lbnRzX2JlZm9yZT1bXTtmb3IodmFyIHU9MCxhPW8uY29tbWVudHNfYmVmb3JlLmxlbmd0aDt1PGE7dSsrKW8ubmxiPW8ubmxifHxvLmNvbW1lbnRzX2JlZm9yZVt1XS5ubGJ9cmV0dXJuIHEubmV3bGluZV9iZWZvcmU9ITEsbmV3IFoobyl9ZnVuY3Rpb24gcCgpe2Zvcig7RHQoaSgpKTspbygpfWZ1bmN0aW9uIGQoZSl7Zm9yKHZhciBuLHQ9IiIscj0wOyhuPWkoKSkmJmUobixyKyspOyl0Kz1vKCk7cmV0dXJuIHR9ZnVuY3Rpb24gaChlKXtOKGUsbixxLnRva2xpbmUscS50b2tjb2wscS50b2twb3MpfWZ1bmN0aW9uIEQoZSl7dmFyIG49ITEsdD0hMSxyPSExLGk9Ii4iPT1lLG89ZChmdW5jdGlvbihvLHUpe3ZhciBhPW8uY2hhckNvZGVBdCgwKTtzd2l0Y2goYSl7Y2FzZSA5ODpjYXNlIDY2OnJldHVybiByPSEwO2Nhc2UgMTExOmNhc2UgNzk6Y2FzZSAxMjA6Y2FzZSA4ODpyZXR1cm4hciYmKHI9ITApO2Nhc2UgMTAxOmNhc2UgNjk6cmV0dXJuISFyfHwhbiYmKG49dD0hMCk7Y2FzZSA0NTpyZXR1cm4gdHx8MD09dSYmIWU7Y2FzZSA0MzpyZXR1cm4gdDtjYXNlIHQ9ITEsNDY6cmV0dXJuIShpfHxyfHxuKSYmKGk9ITApfXJldHVybiBzdC50ZXN0KG8pfSk7ZSYmKG89ZStvKSxmdC50ZXN0KG8pJiZULmhhc19kaXJlY3RpdmUoInVzZSBzdHJpY3QiKSYmaCgiU3ludGF4RXJyb3I6IExlZ2FjeSBvY3RhbCBsaXRlcmFscyBhcmUgbm90IGFsbG93ZWQgaW4gc3RyaWN0IG1vZGUiKTt2YXIgdT1NKG8pO3JldHVybiBpc05hTih1KT92b2lkIGgoIlN5bnRheEVycm9yOiBJbnZhbGlkIHN5bnRheDogIitvKTpsKCJudW0iLHUpfWZ1bmN0aW9uIG0oZSl7dmFyIG49byghMCxlKTtzd2l0Y2gobi5jaGFyQ29kZUF0KDApKXtjYXNlIDExMDpyZXR1cm4iXG4iO2Nhc2UgMTE0OnJldHVybiJcciI7Y2FzZSAxMTY6cmV0dXJuIlx0IjtjYXNlIDk4OnJldHVybiJcYiI7Y2FzZSAxMTg6cmV0dXJuIlx2IjtjYXNlIDEwMjpyZXR1cm4iXGYiO2Nhc2UgMTIwOnJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKF8oMikpO2Nhc2UgMTE3OmlmKCJ7Ij09aSgpKXtmb3IobyghMCksIn0iPT09aSgpJiZoKCJTeW50YXhFcnJvcjogRXhwZWN0aW5nIGhleC1jaGFyYWN0ZXIgYmV0d2VlbiB7fSIpOyIwIj09aSgpOylvKCEwKTt2YXIgdCxyPWMoIn0iLCEwKS1xLnBvcztyZXR1cm4ocj42fHwodD1fKHIpKT4xMTE0MTExKSYmaCgiU3ludGF4RXJyb3I6IFVuaWNvZGUgcmVmZXJlbmNlIG91dCBvZiBib3VuY2UiKSxvKCEwKSxrKHQpfXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKF8oNCkpO2Nhc2UgMTA6cmV0dXJuIiI7Y2FzZSAxMzppZigiXG4iPT1pKCkpcmV0dXJuIG8oITAsZSksIiJ9cmV0dXJuIG4+PSIwIiYmbjw9IjciP3Yobik6bn1mdW5jdGlvbiB2KGUpe3ZhciBuPWkoKTtyZXR1cm4gbj49IjAiJiZuPD0iNyImJihlKz1vKCEwKSxlWzBdPD0iMyImJihuPWkoKSk+PSIwIiYmbjw9IjciJiYoZSs9byghMCkpKSwiMCI9PT1lPyJcMCI6KGUubGVuZ3RoPjAmJlQuaGFzX2RpcmVjdGl2ZSgidXNlIHN0cmljdCIpJiZoKCJTeW50YXhFcnJvcjogTGVnYWN5IG9jdGFsIGVzY2FwZSBzZXF1ZW5jZXMgYXJlIG5vdCBhbGxvd2VkIGluIHN0cmljdCBtb2RlIiksU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChlLDgpKSl9ZnVuY3Rpb24gXyhlKXtmb3IodmFyIG49MDtlPjA7LS1lKXt2YXIgdD1wYXJzZUludChvKCEwKSwxNik7aXNOYU4odCkmJmgoIlN5bnRheEVycm9yOiBJbnZhbGlkIGhleC1jaGFyYWN0ZXIgcGF0dGVybiBpbiBzdHJpbmciKSxuPW48PDR8dH1yZXR1cm4gbn1mdW5jdGlvbiBnKGUpe3ZhciBuLHQ9cS5yZWdleF9hbGxvd2VkLHI9cygpO3JldHVybiByPT0tMT8obj1xLnRleHQuc3Vic3RyKHEucG9zKSxxLnBvcz1xLnRleHQubGVuZ3RoKToobj1xLnRleHQuc3Vic3RyaW5nKHEucG9zLHIpLHEucG9zPXIpLHEuY29sPXEudG9rY29sKyhxLnBvcy1xLnRva3BvcykscS5jb21tZW50c19iZWZvcmUucHVzaChsKGUsbiwhMCkpLHEucmVnZXhfYWxsb3dlZD10LFR9ZnVuY3Rpb24geShlKXtmdW5jdGlvbiBuKGUpe2lmKCFpKCkpcmV0dXJuIGU7dmFyIHQ9ZStpKCk7cmV0dXJuIGh0KHQpPyhvKCksbih0KSk6ZX1yZXR1cm4gbCgib3BlcmF0b3IiLG4oZXx8bygpKSl9ZnVuY3Rpb24gYigpe3N3aXRjaChvKCksaSgpKXtjYXNlIi8iOnJldHVybiBvKCksZygiY29tbWVudDEiKTtjYXNlIioiOnJldHVybiBvKCksSSgpfXJldHVybiBxLnJlZ2V4X2FsbG93ZWQ/VSgiIik6eSgiLyIpfWZ1bmN0aW9uIEUoKXtyZXR1cm4gbygpLCI+Ij09PWkoKT8obygpLGwoImFycm93IiwiPT4iKSk6eSgiPSIpfWZ1bmN0aW9uIEEoKXtyZXR1cm4gbygpLFMoaSgpLmNoYXJDb2RlQXQoMCkpP0QoIi4iKToiLiI9PT1pKCk/KG8oKSxvKCksbCgiZXhwYW5kIiwiLi4uIikpOmwoInB1bmMiLCIuIil9ZnVuY3Rpb24gdygpe3ZhciBlPVAoKTtyZXR1cm4gej9sKCJuYW1lIixlKTppdChlKT9sKCJhdG9tIixlKTpydChlKT9odChlKT9sKCJvcGVyYXRvciIsZSk6bCgia2V5d29yZCIsZSk6bCgibmFtZSIsZSl9ZnVuY3Rpb24gQihlLG4pe3JldHVybiBmdW5jdGlvbih0KXt0cnl7cmV0dXJuIG4odCl9Y2F0Y2gobil7aWYobiE9PWJ0KXRocm93IG47aChlKX19fWZ1bmN0aW9uIFQoZSl7aWYobnVsbCE9ZSlyZXR1cm4gVShlKTtmb3IoOzspe2lmKHAoKSxmKCksdCl7aWYoYSgiPCEtLSIpKXt1KDQpLGcoImNvbW1lbnQzIik7Y29udGludWV9aWYoYSgiLS0+IikmJnEubmV3bGluZV9iZWZvcmUpe3UoMyksZygiY29tbWVudDQiKTtjb250aW51ZX19dmFyIG49aSgpO2lmKCFuKXJldHVybiBsKCJlb2YiKTt2YXIgcz1uLmNoYXJDb2RlQXQoMCk7c3dpdGNoKHMpe2Nhc2UgMzQ6Y2FzZSAzOTpyZXR1cm4gaihuKTtjYXNlIDQ2OnJldHVybiBBKCk7Y2FzZSA0Nzp2YXIgYz1iKCk7aWYoYz09PVQpY29udGludWU7cmV0dXJuIGM7Y2FzZSA2MTpyZXR1cm4gRSgpO2Nhc2UgOTY6cmV0dXJuIEgoITApO2Nhc2UgMTIzOnEuYnJhY2VfY291bnRlcisrO2JyZWFrO2Nhc2UgMTI1OmlmKHEuYnJhY2VfY291bnRlci0tLHEudGVtcGxhdGVfYnJhY2VzLmxlbmd0aD4wJiZxLnRlbXBsYXRlX2JyYWNlc1txLnRlbXBsYXRlX2JyYWNlcy5sZW5ndGgtMV09PT1xLmJyYWNlX2NvdW50ZXIpcmV0dXJuIEgoITEpfWlmKFMocykpcmV0dXJuIEQoKTtpZihndChuKSlyZXR1cm4gbCgicHVuYyIsbygpKTtpZihhdChuKSlyZXR1cm4geSgpO2lmKDkyPT1zfHwkKG4pKXJldHVybiB3KCk7aWYoIXJ8fDAhPXEucG9zfHwhYSgiIyEiKSlicmVhazt1KDIpLGcoImNvbW1lbnQ1Iil9aCgiU3ludGF4RXJyb3I6IFVuZXhwZWN0ZWQgY2hhcmFjdGVyICciK24rIiciKX12YXIgcT17dGV4dDplLGZpbGVuYW1lOm4scG9zOjAsdG9rcG9zOjAsbGluZToxLHRva2xpbmU6MCxjb2w6MCx0b2tjb2w6MCxuZXdsaW5lX2JlZm9yZTohMSxyZWdleF9hbGxvd2VkOiExLGJyYWNlX2NvdW50ZXI6MCx0ZW1wbGF0ZV9icmFjZXM6W10sY29tbWVudHNfYmVmb3JlOltdLGRpcmVjdGl2ZXM6e30sZGlyZWN0aXZlX3N0YWNrOltdfSx6PSExLGo9QigiU3ludGF4RXJyb3I6IFVudGVybWluYXRlZCBzdHJpbmcgY29uc3RhbnQiLGZ1bmN0aW9uKGUpe2Zvcih2YXIgbj1vKCksdD0iIjs7KXt2YXIgcj1vKCEwLCEwKTtpZigiXFwiPT1yKXI9bSghMCk7ZWxzZSBpZihtdChyKSloKCJTeW50YXhFcnJvcjogVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudCIpO2Vsc2UgaWYocj09bilicmVhazt0Kz1yfXZhciBpPWwoInN0cmluZyIsdCk7cmV0dXJuIGkucXVvdGU9ZSxpfSksSD1CKCJTeW50YXhFcnJvcjogVW50ZXJtaW5hdGVkIHRlbXBsYXRlIixmdW5jdGlvbihlKXtlJiZxLnRlbXBsYXRlX2JyYWNlcy5wdXNoKHEuYnJhY2VfY291bnRlcik7dmFyIG4sdCxyPSIiLHU9IiI7Zm9yKG8oITAsITApOyJgIiE9PShuPW8oITAsITApKTspe2lmKCIkIj09PW4mJiJ7Ij09PWkoKSlyZXR1cm4gbyghMCwhMCkscS5icmFjZV9jb3VudGVyKyssdD1sKGU/InRlbXBsYXRlX2hlYWQiOiJ0ZW1wbGF0ZV9zdWJzdGl0dXRpb24iLHIpLHQuYmVnaW49ZSx0LnJhdz11LHQuZW5kPSExLHQ7aWYodSs9biwiXFwiPT09bil7dmFyIGE9cS5wb3M7bj1tKCksdSs9cS50ZXh0LnN1YnN0cihhLHEucG9zLWEpfXIrPW59cmV0dXJuIHEudGVtcGxhdGVfYnJhY2VzLnBvcCgpLHQ9bChlPyJ0ZW1wbGF0ZV9oZWFkIjoidGVtcGxhdGVfc3Vic3RpdHV0aW9uIixyKSx0LmJlZ2luPWUsdC5yYXc9dSx0LmVuZD0hMCx0fSksST1CKCJTeW50YXhFcnJvcjogVW50ZXJtaW5hdGVkIG11bHRpbGluZSBjb21tZW50IixmdW5jdGlvbigpe3ZhciBlPXEucmVnZXhfYWxsb3dlZCxuPWMoIiovIiwhMCksdD1xLnRleHQuc3Vic3RyaW5nKHEucG9zLG4pLnJlcGxhY2UoL1xyXG58XHJ8XHUyMDI4fFx1MjAyOS9nLCJcbiIpO3JldHVybiB1KEModCkrMikscS5jb21tZW50c19iZWZvcmUucHVzaChsKCJjb21tZW50MiIsdCwhMCkpLHEubmV3bGluZV9iZWZvcmU9cS5uZXdsaW5lX2JlZm9yZXx8dC5pbmRleE9mKCJcbiIpPj0wLHEucmVnZXhfYWxsb3dlZD1lLFR9KSxQPUIoIlN5bnRheEVycm9yOiBVbnRlcm1pbmF0ZWQgaWRlbnRpZmllciBuYW1lIixmdW5jdGlvbigpe3ZhciBlLG49IiIsdD0hMSxyPWZ1bmN0aW9uKCl7cmV0dXJuIHQ9ITAsbygpLCJ1IiE9PWkoKSYmaCgiU3ludGF4RXJyb3I6IEV4cGVjdGluZyBVbmljb2RlRXNjYXBlU2VxdWVuY2UgLS0gdVhYWFggb3IgdXtYWFhYfSIpLG0oKX07aWYoIlxcIj09PShuPWkoKSkpbj1yKCksJChuKXx8aCgiU3ludGF4RXJyb3I6IEZpcnN0IGlkZW50aWZpZXIgY2hhciBpcyBhbiBpbnZhbGlkIGlkZW50aWZpZXIgY2hhciIpO2Vsc2V7aWYoISQobikpcmV0dXJuIiI7bygpfWZvcig7bnVsbCE9KGU9aSgpKTspe2lmKCJcXCI9PT0oZT1pKCkpKWU9cigpLE8oZSl8fGgoIlN5bnRheEVycm9yOiBJbnZhbGlkIGVzY2FwZWQgaWRlbnRpZmllciBjaGFyIik7ZWxzZXtpZighTyhlKSlicmVhaztvKCl9bis9ZX1yZXR1cm4gb3QobikmJnQmJmgoIlN5bnRheEVycm9yOiBFc2NhcGVkIGNoYXJhY3RlcnMgYXJlIG5vdCBhbGxvd2VkIGluIGtleXdvcmRzIiksbn0pLFU9QigiU3ludGF4RXJyb3I6IFVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb24iLGZ1bmN0aW9uKGUpe2Zvcih2YXIgbix0PSExLHI9ITE7bj1vKCEwKTspaWYobXQobikpaCgiU3ludGF4RXJyb3I6IFVuZXhwZWN0ZWQgbGluZSB0ZXJtaW5hdG9yIik7ZWxzZSBpZih0KWUrPSJcXCIrbix0PSExO2Vsc2UgaWYoIlsiPT1uKXI9ITAsZSs9bjtlbHNlIGlmKCJdIj09biYmcilyPSExLGUrPW47ZWxzZXtpZigiLyI9PW4mJiFyKWJyZWFrOyJcXCI9PW4/dD0hMDplKz1ufXZhciBpPVAoKTt0cnl7cmV0dXJuIGwoInJlZ2V4cCIsbmV3IFJlZ0V4cChlLGkpKX1jYXRjaChlKXtoKCJTeW50YXhFcnJvcjogIitlLm1lc3NhZ2UpfX0pO3JldHVybiBULm5leHQ9byxULnBlZWs9aSxULmNvbnRleHQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJihxPWUpLHF9LFQuYWRkX2RpcmVjdGl2ZT1mdW5jdGlvbihlKXtxLmRpcmVjdGl2ZV9zdGFja1txLmRpcmVjdGl2ZV9zdGFjay5sZW5ndGgtMV0ucHVzaChlKSx2b2lkIDA9PT1xLmRpcmVjdGl2ZXNbZV0/cS5kaXJlY3RpdmVzW2VdPTE6cS5kaXJlY3RpdmVzW2VdKyt9LFQucHVzaF9kaXJlY3RpdmVzX3N0YWNrPWZ1bmN0aW9uKCl7cS5kaXJlY3RpdmVfc3RhY2sucHVzaChbXSl9LFQucG9wX2RpcmVjdGl2ZXNfc3RhY2s9ZnVuY3Rpb24oKXtmb3IodmFyIGU9cS5kaXJlY3RpdmVfc3RhY2tbcS5kaXJlY3RpdmVfc3RhY2subGVuZ3RoLTFdLG49MDtuPGUubGVuZ3RoO24rKylxLmRpcmVjdGl2ZXNbZVtuXV0tLTtxLmRpcmVjdGl2ZV9zdGFjay5wb3AoKX0sVC5oYXNfZGlyZWN0aXZlPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDAhPT1xLmRpcmVjdGl2ZXNbZV0mJnEuZGlyZWN0aXZlc1tlXT4wfSxUfWZ1bmN0aW9uIEkoZSxuKXtmdW5jdGlvbiB0KGUsbil7cmV0dXJuIGooeWUudG9rZW4sZSxuKX1mdW5jdGlvbiByKCl7cmV0dXJuIHllLnBlZWtlZHx8KHllLnBlZWtlZD15ZS5pbnB1dCgpKX1mdW5jdGlvbiBpKCl7cmV0dXJuIHllLnByZXY9eWUudG9rZW4seWUucGVla2VkPyh5ZS50b2tlbj15ZS5wZWVrZWQseWUucGVla2VkPW51bGwpOnllLnRva2VuPXllLmlucHV0KCkseWUuaW5fZGlyZWN0aXZlcz15ZS5pbl9kaXJlY3RpdmVzJiYoInN0cmluZyI9PXllLnRva2VuLnR5cGV8fHQoInB1bmMiLCI7IikpLHllLnRva2VufWZ1bmN0aW9uIHUoKXtyZXR1cm4geWUucHJldn1mdW5jdGlvbiBhKGUsbix0LHIpe3ZhciBpPXllLmlucHV0LmNvbnRleHQoKTtOKGUsaS5maWxlbmFtZSxudWxsIT1uP246aS50b2tsaW5lLG51bGwhPXQ/dDppLnRva2NvbCxudWxsIT1yP3I6aS50b2twb3MpfWZ1bmN0aW9uIGMoZSxuKXthKG4sZS5saW5lLGUuY29sKX1mdW5jdGlvbiBmKGUpe251bGw9PWUmJihlPXllLnRva2VuKSxjKGUsIlN5bnRheEVycm9yOiBVbmV4cGVjdGVkIHRva2VuOiAiK2UudHlwZSsiICgiK2UudmFsdWUrIikiKX1mdW5jdGlvbiBsKGUsbil7cmV0dXJuIHQoZSxuKT9pKCk6dm9pZCBjKHllLnRva2VuLCJTeW50YXhFcnJvcjogVW5leHBlY3RlZCB0b2tlbiAiK3llLnRva2VuLnR5cGUrIiDCqyIreWUudG9rZW4udmFsdWUrIsK7LCBleHBlY3RlZCAiK2UrIiDCqyIrbisiwrsiKX1mdW5jdGlvbiBwKGUpe3JldHVybiBsKCJwdW5jIixlKX1mdW5jdGlvbiBkKCl7cmV0dXJuIW4uc3RyaWN0JiYoeWUudG9rZW4ubmxifHx0KCJlb2YiKXx8dCgicHVuYyIsIn0iKSl9ZnVuY3Rpb24gaCgpe3JldHVybiB5ZS5pbl9nZW5lcmF0b3I9PT15ZS5pbl9mdW5jdGlvbn1mdW5jdGlvbiBEKGUpe3QoInB1bmMiLCI7Iik/aSgpOmV8fGQoKXx8ZigpfWZ1bmN0aW9uIG0oKXtwKCIoIik7dmFyIGU9cnQoITApO3JldHVybiBwKCIpIiksZX1mdW5jdGlvbiB2KGUpe3JldHVybiBmdW5jdGlvbigpe3ZhciBuPXllLnRva2VuLHQ9ZS5hcHBseShudWxsLGFyZ3VtZW50cykscj11KCk7cmV0dXJuIHQuc3RhcnQ9bix0LmVuZD1yLHR9fWZ1bmN0aW9uIF8oKXsodCgib3BlcmF0b3IiLCIvIil8fHQoIm9wZXJhdG9yIiwiLz0iKSkmJih5ZS5wZWVrZWQ9bnVsbCx5ZS50b2tlbj15ZS5pbnB1dCh5ZS50b2tlbi52YWx1ZS5zdWJzdHIoMSkpKX1mdW5jdGlvbiBnKCl7dmFyIGU9UShqbik7InlpZWxkIj09PWUubmFtZSYmaCgpJiZjKHllLnByZXYsIlN5bnRheEVycm9yOiBZaWVsZCBjYW5ub3QgYmUgdXNlZCBhcyBsYWJlbCBpbnNpZGUgZ2VuZXJhdG9ycyIpLG8oZnVuY3Rpb24obil7cmV0dXJuIG4ubmFtZT09ZS5uYW1lfSx5ZS5sYWJlbHMpJiZhKCJTeW50YXhFcnJvcjogTGFiZWwgIitlLm5hbWUrIiBkZWZpbmVkIHR3aWNlIikscCgiOiIpLHllLmxhYmVscy5wdXNoKGUpO3ZhciBuPUJlKCk7cmV0dXJuIHllLmxhYmVscy5wb3AoKSxuIGluc3RhbmNlb2Ygc2V8fGUucmVmZXJlbmNlcy5mb3JFYWNoKGZ1bmN0aW9uKG4pe24gaW5zdGFuY2VvZiBNZSYmKG49bi5sYWJlbC5zdGFydCxhKCJTeW50YXhFcnJvcjogQ29udGludWUgbGFiZWwgYCIrZS5uYW1lKyJgIHJlZmVycyB0byBub24tSXRlcmF0aW9uU3RhdGVtZW50LiIsbi5saW5lLG4uY29sLG4ucG9zKSl9KSxuZXcgYWUoe2JvZHk6bixsYWJlbDplfSl9ZnVuY3Rpb24geShlKXtyZXR1cm4gbmV3IHRlKHtib2R5OihlPXJ0KCEwKSxEKCksZSl9KX1mdW5jdGlvbiBiKGUpe3ZhciBuLHQ9bnVsbDtkKCl8fCh0PVEoSW4sITApKSxudWxsIT10PyhuPW8oZnVuY3Rpb24oZSl7cmV0dXJuIGUubmFtZT09dC5uYW1lfSx5ZS5sYWJlbHMpLG58fGEoIlN5bnRheEVycm9yOiBVbmRlZmluZWQgbGFiZWwgIit0Lm5hbWUpLHQudGhlZGVmPW4pOjA9PXllLmluX2xvb3AmJmEoIlN5bnRheEVycm9yOiAiK2UuVFlQRSsiIG5vdCBpbnNpZGUgYSBsb29wIG9yIHN3aXRjaCIpLEQoKTt2YXIgcj1uZXcgZSh7bGFiZWw6dH0pO3JldHVybiBuJiZuLnJlZmVyZW5jZXMucHVzaChyKSxyfWZ1bmN0aW9uIEUoKXtwKCIoIik7dmFyIGU9bnVsbDtpZighdCgicHVuYyIsIjsiKSl7ZT10KCJrZXl3b3JkIiwidmFyIik/KGkoKSxqZSghMCkpOnQoImtleXdvcmQiLCJsZXQiKT8oaSgpLG9uKCEwKSk6dCgia2V5d29yZCIsImNvbnN0Iik/KGkoKSxkbighMCkpOnJ0KCEwLCEwKTt2YXIgbj10KCJvcGVyYXRvciIsImluIikscj10KCJuYW1lIiwib2YiKTtpZihufHxyKXJldHVybiBlIGluc3RhbmNlb2YgTGUmJmUuZGVmaW5pdGlvbnMubGVuZ3RoPjEmJmEoIlN5bnRheEVycm9yOiBPbmx5IG9uZSB2YXJpYWJsZSBkZWNsYXJhdGlvbiBhbGxvd2VkIGluIGZvci4uaW4gbG9vcCIpLGkoKSxuP3coZSk6RihlKX1yZXR1cm4gQShlKX1mdW5jdGlvbiBBKGUpe3AoIjsiKTt2YXIgbj10KCJwdW5jIiwiOyIpP251bGw6cnQoITApO3AoIjsiKTt2YXIgcj10KCJwdW5jIiwiKSIpP251bGw6cnQoITApO3JldHVybiBwKCIpIiksbmV3IHBlKHtpbml0OmUsY29uZGl0aW9uOm4sc3RlcDpyLGJvZHk6bWUoQmUpfSl9ZnVuY3Rpb24gRihlKXt2YXIgbj1lIGluc3RhbmNlb2YgTGU/ZS5kZWZpbml0aW9uc1swXS5uYW1lOm51bGwsdD1ydCghMCk7cmV0dXJuIHAoIikiKSxuZXcgaGUoe2luaXQ6ZSxuYW1lOm4sb2JqZWN0OnQsYm9keTptZShCZSl9KX1mdW5jdGlvbiB3KGUpe3ZhciBuPWUgaW5zdGFuY2VvZiBMZT9lLmRlZmluaXRpb25zWzBdLm5hbWU6bnVsbCx0PXJ0KCEwKTtyZXR1cm4gcCgiKSIpLG5ldyBkZSh7aW5pdDplLG5hbWU6bixvYmplY3Q6dCxib2R5Om1lKEJlKX0pfWZ1bmN0aW9uIEMoZSxuKXt2YXIgdD17fSxyPSExLGk9ITEsbz0hMSx1PSEhbixhPXthZGRfcGFyYW1ldGVyOmZ1bmN0aW9uKG4pe2lmKHZvaWQgMCE9PXRbIiQiK24udmFsdWVdKXI9PT0hMSYmKHI9biksYS5jaGVja19zdHJpY3QoKTtlbHNlIGlmKHRbIiQiK24udmFsdWVdPSEwLGUpc3dpdGNoKG4udmFsdWUpe2Nhc2UiYXJndW1lbnRzIjpjYXNlImV2YWwiOmNhc2UieWllbGQiOnUmJmMobiwiU3ludGF4RXJyb3I6IFVuZXhwZWN0ZWQgIituLnZhbHVlKyIgaWRlbnRpZmllciBhcyBwYXJhbWV0ZXIgaW5zaWRlIHN0cmljdCBtb2RlIik7YnJlYWs7ZGVmYXVsdDpvdChuLnZhbHVlKSYmZigpfX0sbWFya19kZWZhdWx0X2Fzc2lnbm1lbnQ6ZnVuY3Rpb24oZSl7aT09PSExJiYoaT1lKX0sbWFya19zcHJlYWQ6ZnVuY3Rpb24oZSl7bz09PSExJiYobz1lKX0sbWFya19zdHJpY3RfbW9kZTpmdW5jdGlvbigpe3U9ITB9LGlzX3N0cmljdDpmdW5jdGlvbigpe3JldHVybiBpIT09ITF8fG8hPT0hMXx8dX0sY2hlY2tfc3RyaWN0OmZ1bmN0aW9uKCl7YS5pc19zdHJpY3QoKSYmciE9PSExJiZjKHIsIlN5bnRheEVycm9yOiBQYXJhbWV0ZXIgIityLnZhbHVlKyIgd2FzIHVzZWQgYWxyZWFkeSIpfX07cmV0dXJuIGF9ZnVuY3Rpb24gaygpe3ZhciBlPSh5ZS50b2tlbiwhMCksbj1bXSxyPUMoITAseWUuaW5wdXQuaGFzX2RpcmVjdGl2ZSgidXNlIHN0cmljdCIpKTtmb3IocCgiKCIpOyF0KCJwdW5jIiwiKSIpOyl7ZT9lPSExOnAoIiwiKTt2YXIgbz14KHIpO2lmKG4ucHVzaChvKSxvIGluc3RhbmNlb2YgX2UpYnJlYWt9cmV0dXJuIGkoKSxufWZ1bmN0aW9uIHgoZSxuKXt2YXIgcixvPSExO3JldHVybiB2b2lkIDA9PT1lJiYoZT1DKCEwLHllLmlucHV0Lmhhc19kaXJlY3RpdmUoInVzZSBzdHJpY3QiKSkpLHQoImV4cGFuZCIsIi4uLiIpJiYobz15ZS50b2tlbixlLm1hcmtfc3ByZWFkKHllLnRva2VuKSxpKCkpLHI9QihlLG4pLHQoIm9wZXJhdG9yIiwiPSIpJiZvPT09ITEmJihlLm1hcmtfZGVmYXVsdF9hc3NpZ25tZW50KHllLnRva2VuKSxpKCksci5kZWZhdWx0PXJ0KCExKSksbyE9PSExJiYodCgicHVuYyIsIikiKXx8ZigpLHI9bmV3IF9lKHtzdGFydDpvLGV4cHJlc3Npb246cixlbmQ6b30pKSxlLmNoZWNrX3N0cmljdCgpLHJ9ZnVuY3Rpb24gQihlLG4pe3ZhciBvLHM9W10sYz0hMCxsPSExLGQ9eWUudG9rZW47aWYodm9pZCAwPT09ZSYmKGU9QyghMSx5ZS5pbnB1dC5oYXNfZGlyZWN0aXZlKCJ1c2Ugc3RyaWN0IikpKSxuPXZvaWQgMD09PW4/Qm46bix0KCJwdW5jIiwiWyIpKXtmb3IoaSgpOyF0KCJwdW5jIiwiXSIpOyl7aWYoYz9jPSExOnAoIiwiKSx0KCJleHBhbmQiLCIuLi4iKSYmKGw9ITAsbz15ZS50b2tlbixlLm1hcmtfc3ByZWFkKHllLnRva2VuKSxpKCkpLHQoInB1bmMiKSlzd2l0Y2goeWUudG9rZW4udmFsdWUpe2Nhc2UiLCI6cy5wdXNoKG5ldyBabih7c3RhcnQ6eWUudG9rZW4sZW5kOnllLnRva2VufSkpO2NvbnRpbnVlO2Nhc2UiXSI6YnJlYWs7Y2FzZSJbIjpjYXNlInsiOnMucHVzaChCKGUsbikpO2JyZWFrO2RlZmF1bHQ6ZigpfWVsc2UgdCgibmFtZSIpPyhlLmFkZF9wYXJhbWV0ZXIoeWUudG9rZW4pLHMucHVzaChuZXcgbih7c3RhcnQ6eWUudG9rZW4sbmFtZTp5ZS50b2tlbi52YWx1ZSxlbmQ6eWUudG9rZW59KSksaSgpKTphKCJTeW50YXhFcnJvcjogSW52YWxpZCBmdW5jdGlvbiBwYXJhbWV0ZXIiKTt0KCJvcGVyYXRvciIsIj0iKSYmbD09PSExJiYoZS5tYXJrX2RlZmF1bHRfYXNzaWdubWVudCh5ZS50b2tlbiksaSgpLHNbcy5sZW5ndGgtMV0uZGVmYXVsdD1ydCghMSkpLGwmJih0KCJwdW5jIiwiXSIpfHxmKCksc1tzLmxlbmd0aC0xXT1uZXcgX2Uoe3N0YXJ0Om8sZXhwcmVzc2lvbjpzW3MubGVuZ3RoLTFdLGVuZDpvfSkpfXJldHVybiBwKCJdIiksZS5jaGVja19zdHJpY3QoKSxuZXcgd2Uoe3N0YXJ0OmQsbmFtZXM6cyxpc19hcnJheTohMCxlbmQ6dSgpfSl9aWYodCgicHVuYyIsInsiKSl7Zm9yKGkoKTshdCgicHVuYyIsIn0iKTspe2lmKGM/Yz0hMTpwKCIsIiksdCgibmFtZSIpJiYoaihyKCksInB1bmMiKXx8aihyKCksIm9wZXJhdG9yIikpJiZbIiwiLCJ9IiwiPSJdLmluZGV4T2YocigpLnZhbHVlKSE9PS0xKWUuYWRkX3BhcmFtZXRlcih5ZS50b2tlbikscy5wdXNoKG5ldyBuKHtzdGFydDp5ZS50b2tlbixuYW1lOnllLnRva2VuLnZhbHVlLGVuZDp5ZS50b2tlbn0pKSxpKCk7ZWxzZXtpZih0KCJwdW5jIiwifSIpKWNvbnRpbnVlO3ZhciBoPXllLnRva2VuLEQ9SigpO251bGw9PT1EP2YodSgpKToibmFtZSIhPT11KCkudHlwZXx8dCgicHVuYyIsIjoiKT8ocCgiOiIpLHMucHVzaChuZXcgaG4oe3N0YXJ0OmgscXVvdGU6aC5xdW90ZSxlbmQ6dSgpLGtleTpELHZhbHVlOkIoZSxuKX0pKSk6cy5wdXNoKG5ldyBCbih7c3RhcnQ6dSgpLG5hbWU6aCxlbmQ6dSgpfSkpfXQoIm9wZXJhdG9yIiwiPSIpJiYoZS5tYXJrX2RlZmF1bHRfYXNzaWdubWVudCh5ZS50b2tlbiksaSgpLHNbcy5sZW5ndGgtMV0uZGVmYXVsdD1ydCghMSkpfXJldHVybiBwKCJ9IiksZS5jaGVja19zdHJpY3QoKSxuZXcgd2Uoe3N0YXJ0OmQsbmFtZXM6cyxpc19hcnJheTohMSxlbmQ6dSgpfSl9cmV0dXJuIHQoIm5hbWUiKT8oZS5hZGRfcGFyYW1ldGVyKHllLnRva2VuKSxpKCksbmV3IG4oe3N0YXJ0OnUoKSxuYW1lOnUoKS52YWx1ZSxlbmQ6dSgpfSkpOnZvaWQgYSgiU3ludGF4RXJyb3I6IEludmFsaWQgZnVuY3Rpb24gcGFyYW1ldGVyIil9ZnVuY3Rpb24gUygpe3ZhciBlPXllLnRva2VuO3AoIigiKTtmb3IodmFyIG49ITAscj1bXTshdCgicHVuYyIsIikiKTspaWYobj9uPSExOnAoIiwiKSx0KCJleHBhbmQiLCIuLi4iKSl7dmFyIG89eWUudG9rZW47aSgpLHIucHVzaChuZXcgX2Uoe3N0YXJ0OnUoKSxleHByZXNzaW9uOkIodm9pZCAwLEJuKSxlbmQ6eWUudG9rZW59KSksdCgicHVuYyIsIikiKXx8ZihvKX1lbHNlIHIucHVzaChydCghMSkpO3ZhciBhPXllLnRva2VuO3JldHVybiBpKCksbmV3IGdlKHtzdGFydDplLGVuZDphLGV4cHJlc3Npb25zOnJ9KX1mdW5jdGlvbiBUKGUsbil7dmFyIHQ9eWUuaW5fbG9vcCxyPXllLmxhYmVscyxpPXllLmluX2dlbmVyYXRvcjtpZigrK3llLmluX2Z1bmN0aW9uLG4mJih5ZS5pbl9nZW5lcmF0b3I9eWUuaW5fZnVuY3Rpb24pLGUmJih5ZS5pbl9kaXJlY3RpdmVzPSEwKSx5ZS5pbl9sb29wPTAseWUubGFiZWxzPVtdLGUpe3llLmlucHV0LnB1c2hfZGlyZWN0aXZlc19zdGFjaygpO3ZhciBvPU0oKTt5ZS5pbnB1dC5wb3BfZGlyZWN0aXZlc19zdGFjaygpfWVsc2UgdmFyIG89cnQoITEpO3JldHVybi0teWUuaW5fZnVuY3Rpb24seWUuaW5fbG9vcD10LHllLmxhYmVscz1yLHllLmluX2dlbmVyYXRvcj1pLG99ZnVuY3Rpb24gJCgpe2goKXx8YSgiU3ludGF4RXJyb3I6IFVuZXhwZWN0ZWQgeWllbGQgZXhwcmVzc2lvbiBvdXRzaWRlIGdlbmVyYXRvciBmdW5jdGlvbiIseWUucHJldi5saW5lLHllLnByZXYuY29sLHllLnByZXYucG9zKTt2YXIgZT0hMSxuPSEwO3JldHVybiBkKCl8fHQoInB1bmMiKSYmdnQoeWUudG9rZW4udmFsdWUpP249ITE6dCgib3BlcmF0b3IiLCIqIikmJihlPSEwLGkoKSksbmV3IHR0KHtpc19zdGFyOmUsZXhwcmVzc2lvbjpuP3J0KCk6bnVsbH0pfWZ1bmN0aW9uIE8oKXt2YXIgZT1tKCksbj1CZSgpLHI9bnVsbDtyZXR1cm4gdCgia2V5d29yZCIsImVsc2UiKSYmKGkoKSxyPUJlKCkpLG5ldyB6ZSh7Y29uZGl0aW9uOmUsYm9keTpuLGFsdGVybmF0aXZlOnJ9KX1mdW5jdGlvbiBNKCl7cCgieyIpO2Zvcih2YXIgZT1bXTshdCgicHVuYyIsIn0iKTspdCgiZW9mIikmJmYoKSxlLnB1c2goQmUoKSk7cmV0dXJuIGkoKSxlfWZ1bmN0aW9uIHooKXtwKCJ7Iik7Zm9yKHZhciBlLG49W10scj1udWxsLG89bnVsbDshdCgicHVuYyIsIn0iKTspdCgiZW9mIikmJmYoKSx0KCJrZXl3b3JkIiwiY2FzZSIpPyhvJiYoby5lbmQ9dSgpKSxyPVtdLG89bmV3IEllKHtzdGFydDooZT15ZS50b2tlbixpKCksZSksZXhwcmVzc2lvbjpydCghMCksYm9keTpyfSksbi5wdXNoKG8pLHAoIjoiKSk6dCgia2V5d29yZCIsImRlZmF1bHQiKT8obyYmKG8uZW5kPXUoKSkscj1bXSxvPW5ldyBIZSh7c3RhcnQ6KGU9eWUudG9rZW4saSgpLHAoIjoiKSxlKSxib2R5OnJ9KSxuLnB1c2gobykpOihyfHxmKCksci5wdXNoKEJlKCkpKTtyZXR1cm4gbyYmKG8uZW5kPXUoKSksaSgpLG59ZnVuY3Rpb24gSSgpe3ZhciBlPU0oKSxuPW51bGwscj1udWxsO2lmKHQoImtleXdvcmQiLCJjYXRjaCIpKXt2YXIgbz15ZS50b2tlbjtpKCkscCgiKCIpO3ZhciBzPXgodm9pZCAwLE1uKTtwKCIpIiksbj1uZXcgVWUoe3N0YXJ0Om8sYXJnbmFtZTpzLGJvZHk6TSgpLGVuZDp1KCl9KX1pZih0KCJrZXl3b3JkIiwiZmluYWxseSIpKXt2YXIgbz15ZS50b2tlbjtpKCkscj1uZXcgUmUoe3N0YXJ0Om8sYm9keTpNKCksZW5kOnUoKX0pfXJldHVybiBufHxyfHxhKCJTeW50YXhFcnJvcjogTWlzc2luZyBjYXRjaC9maW5hbGx5IGJsb2NrcyIpLG5ldyBQZSh7Ym9keTplLGJjYXRjaDpuLGJmaW5hbGx5OnJ9KX1mdW5jdGlvbiBQKGUsbil7Zm9yKHZhciByLG89W107Oyl7dmFyIGE9InZhciI9PT1uP3duOiJjb25zdCI9PT1uP2tuOiJsZXQiPT09bj94bjpudWxsO2lmKHI9bmV3IFplKHQoInB1bmMiLCJ7Iil8fHQoInB1bmMiLCJbIik/e3N0YXJ0OnllLnRva2VuLG5hbWU6Qih2b2lkIDAsYSksdmFsdWU6dCgib3BlcmF0b3IiLCI9Iik/KGwoIm9wZXJhdG9yIiwiPSIpLHJ0KCExLGUpKTpudWxsLGVuZDp1KCl9OntzdGFydDp5ZS50b2tlbixuYW1lOlEoYSksdmFsdWU6dCgib3BlcmF0b3IiLCI9Iik/KGkoKSxydCghMSxlKSk6bnVsbCxlbmQ6dSgpfSksby5wdXNoKHIpLCF0KCJwdW5jIiwiLCIpKWJyZWFrO2koKX1yZXR1cm4gb31mdW5jdGlvbiBVKCl7dmFyIGUsbj15ZS50b2tlbjtzd2l0Y2gobi50eXBlKXtjYXNlIm5hbWUiOmNhc2Uia2V5d29yZCI6ZT1LKEhuKTticmVhaztjYXNlIm51bSI6ZT1uZXcgVm4oe3N0YXJ0Om4sZW5kOm4sdmFsdWU6bi52YWx1ZX0pO2JyZWFrO2Nhc2Uic3RyaW5nIjplPW5ldyBMbih7c3RhcnQ6bixlbmQ6bix2YWx1ZTpuLnZhbHVlLHF1b3RlOm4ucXVvdGV9KTticmVhaztjYXNlInJlZ2V4cCI6ZT1uZXcgV24oe3N0YXJ0Om4sZW5kOm4sdmFsdWU6bi52YWx1ZX0pO2JyZWFrO2Nhc2UiYXRvbSI6c3dpdGNoKG4udmFsdWUpe2Nhc2UiZmFsc2UiOmU9bmV3IGV0KHtzdGFydDpuLGVuZDpufSk7YnJlYWs7Y2FzZSJ0cnVlIjplPW5ldyBudCh7c3RhcnQ6bixlbmQ6bn0pO2JyZWFrO2Nhc2UibnVsbCI6ZT1uZXcgWG4oe3N0YXJ0Om4sZW5kOm59KX1icmVhaztjYXNlIm9wZXJhdG9yIjpxKG4udmFsdWUpfHxhKCJTeW50YXhFcnJvcjogSW52YWxpZCBnZXR0ZXIvc2V0dGVyIG5hbWU6ICIrbi52YWx1ZSxuLmxpbmUsbi5jb2wsbi5wb3MpLGU9SyhIbil9cmV0dXJuIGkoKSxlfWZ1bmN0aW9uIFIoKXt2YXIgZT1bXSxuPXllLnRva2VuO2ZvcihlLnB1c2gobmV3IHhlKHtzdGFydDp5ZS50b2tlbixyYXc6eWUudG9rZW4ucmF3LHZhbHVlOnllLnRva2VuLnZhbHVlLGVuZDp5ZS50b2tlbn0pKTt5ZS50b2tlbi5lbmQ9PT0hMTspaSgpLGUucHVzaChydCgpKSxqKCJ0ZW1wbGF0ZV9zdWJzdGl0dXRpb24iKXx8ZigpLGUucHVzaChuZXcgeGUoe3N0YXJ0OnllLnRva2VuLHJhdzp5ZS50b2tlbi5yYXcsdmFsdWU6eWUudG9rZW4udmFsdWUsZW5kOnllLnRva2VufSkpO3JldHVybiBpKCksbmV3IGtlKHtzdGFydDpuLHNlZ21lbnRzOmUsZW5kOnllLnRva2VufSl9ZnVuY3Rpb24gTChlLG4scil7Zm9yKHZhciBvPSEwLHU9W107IXQoInB1bmMiLGUpJiYobz9vPSExOnAoIiwiKSwhbnx8IXQoInB1bmMiLGUpKTspdCgicHVuYyIsIiwiKSYmcj91LnB1c2gobmV3IFpuKHtzdGFydDp5ZS50b2tlbixlbmQ6eWUudG9rZW59KSk6dCgiZXhwYW5kIiwiLi4uIik/KGkoKSx1LnB1c2gobmV3IF9lKHtzdGFydDp5ZS50b2tlbixleHByZXNzaW9uOnJ0KCksZW5kOnllLnRva2VufSkpKTp1LnB1c2gocnQoITEpKTtyZXR1cm4gaSgpLHV9ZnVuY3Rpb24gVihlKXt2YXIgbixyLG8sYSxzPVtdO2Zvcih5ZS5pbnB1dC5wdXNoX2RpcmVjdGl2ZXNfc3RhY2soKSx5ZS5pbnB1dC5hZGRfZGlyZWN0aXZlKCJ1c2Ugc3RyaWN0IiksIm5hbWUiPT15ZS50b2tlbi50eXBlJiYiZXh0ZW5kcyIhPXllLnRva2VuLnZhbHVlJiYobz1RKGU9PT1nbj9PbjpxbikpLGUhPT1nbnx8b3x8ZigpLCJleHRlbmRzIj09eWUudG9rZW4udmFsdWUmJihpKCksYT1ydCghMCkpLHAoInsiKSx0KCJwdW5jIiwiOyIpJiZpKCk7IXQoInB1bmMiLCJ9Iik7KW49eWUudG9rZW4scj1XKEooKSxuLCEwKSxyfHxmKCkscy5wdXNoKHIpLHQoInB1bmMiLCI7IikmJmkoKTtyZXR1cm4geWUuaW5wdXQucG9wX2RpcmVjdGl2ZXNfc3RhY2soKSxpKCksbmV3IGUoe3N0YXJ0Om4sbmFtZTpvLGV4dGVuZHM6YSxwcm9wZXJ0aWVzOnMsZW5kOnUoKX0pfWZ1bmN0aW9uIFcoZSxuLHIpe3ZhciBpPWZ1bmN0aW9uKGUsbil7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlfHwibnVtYmVyIj09dHlwZW9mIGU/bmV3IFRuKHtzdGFydDpuLG5hbWU6ZSxlbmQ6dSgpfSk6KG51bGw9PT1lJiZmKCksZSl9LG89ITEsYT0hMSxzPW47aWYociYmInN0YXRpYyI9PT1lJiYhdCgicHVuYyIsIigiKSYmKG89ITAscz15ZS50b2tlbixlPUooKSksbnVsbD09PWUmJihhPSEwLHM9eWUudG9rZW4sZT1KKCksbnVsbD09PWUmJmYoKSksdCgicHVuYyIsIigiKSl7ZT1pKGUsbik7dmFyIGM9bmV3IHZuKHtzdGFydDpuLHN0YXRpYzpvLGlzX2dlbmVyYXRvcjphLGtleTplLHF1b3RlOmUgaW5zdGFuY2VvZiBUbj9zLnF1b3RlOnZvaWQgMCx2YWx1ZTpPZShiZSxhKSxlbmQ6dSgpfSk7cmV0dXJuIGN9aWYocz15ZS50b2tlbiwiZ2V0Ij09ZSl7aWYoIXQoInB1bmMiKXx8dCgicHVuYyIsIlsiKSlyZXR1cm4gZT1pKEooKSxuKSxuZXcgbW4oe3N0YXJ0Om4sc3RhdGljOm8sa2V5OmUscXVvdGU6ZSBpbnN0YW5jZW9mIFRuP3MucXVvdGU6dm9pZCAwLHZhbHVlOk9lKGJlKSxlbmQ6dSgpfSl9ZWxzZSBpZigic2V0Ij09ZSYmKCF0KCJwdW5jIil8fHQoInB1bmMiLCJbIikpKXJldHVybiBlPWkoSigpLG4pLG5ldyBEbih7c3RhcnQ6bixzdGF0aWM6byxrZXk6ZSxxdW90ZTplIGluc3RhbmNlb2YgVG4/cy5xdW90ZTp2b2lkIDAsdmFsdWU6T2UoYmUpLGVuZDp1KCl9KX1mdW5jdGlvbiBZKCl7dmFyIGUsbixyPXUoKTtpZih0KCJuYW1lIikmJihlPVEoem4pKSx0KCJwdW5jIiwiLCIpJiZpKCksdCgicHVuYyIsInsiKSl7Zm9yKGkoKSxuPVtdOyF0KCJwdW5jIiwifSIpOyluLnB1c2goWCgpKSx0KCJwdW5jIiwiLCIpJiZpKCk7aSgpfShufHxlKSYmbCgibmFtZSIsImZyb20iKTt2YXIgbz15ZS50b2tlbjtyZXR1cm4ic3RyaW5nIiE9PW8udHlwZSYmZigpLGkoKSxuZXcgR2Uoe3N0YXJ0OnIsaW1wb3J0ZWRfbmFtZTplLGltcG9ydGVkX25hbWVzOm4sbW9kdWxlX25hbWU6bmV3IExuKHtzdGFydDpvLHZhbHVlOm8udmFsdWUscXVvdGU6by5xdW90ZSxlbmQ6b30pLGVuZDp5ZS50b2tlbn0pfWZ1bmN0aW9uIFgoKXt2YXIgZSxuLHQ9eWUudG9rZW47cmV0dXJuImFzIj09PXIoKS52YWx1ZSYmIm5hbWUiPT09cigpLnR5cGUmJihlPVEoTm4pLGkoKSksbj1RKHpuKSx2b2lkIDA9PT1lJiYoZT1uZXcgTm4oe25hbWU6bi5uYW1lLHN0YXJ0Om4uc3RhcnQsZW5kOm4uZW5kfSkpLG5ldyBYZSh7c3RhcnQ6dCxmb3JlaWduX25hbWU6ZSxuYW1lOm4sZW5kOnUoKX0pfWZ1bmN0aW9uIEcoKXt2YXIgZSxuLHIsbz15ZS50b2tlbjt0KCJrZXl3b3JkIiwiZGVmYXVsdCIpJiYoZT0hMCxpKCkpO3ZhciBhPXQoImtleXdvcmQiLCJ2YXIiKXx8dCgia2V5d29yZCIsImxldCIpfHx0KCJrZXl3b3JkIiwiY29uc3QiKXx8dCgia2V5d29yZCIsImNsYXNzIil8fHQoImtleXdvcmQiLCJmdW5jdGlvbiIpO3JldHVybiBhP3I9QmUoKToobj1ydCgpLEQoKSksbmV3IEplKHtzdGFydDpvLGlzX2RlZmF1bHQ6ZSxleHBvcnRlZF92YWx1ZTpuLGV4cG9ydGVkX2RlZmluaXRpb246cixlbmQ6dSgpfSl9ZnVuY3Rpb24gSigpe3ZhciBlPXllLnRva2VuO3N3aXRjaChpKCksZS50eXBlKXtjYXNlInB1bmMiOmlmKCJbIj09PWUudmFsdWUpe3ZhciBuPXJ0KCExKTtyZXR1cm4gcCgiXSIpLG59ZihlKTtjYXNlIm9wZXJhdG9yIjppZigiKiI9PT1lLnZhbHVlKXJldHVybiBudWxsO1siZGVsZXRlIiwiaW4iLCJpbnN0YW5jZW9mIiwibmV3IiwidHlwZW9mIiwidm9pZCJdLmluZGV4T2YoZS52YWx1ZSk9PT0tMSYmZihlKTtjYXNlIm5hbWUiOiJ5aWVsZCI9PT1lLnZhbHVlJiZ5ZS5pbnB1dC5oYXNfZGlyZWN0aXZlKCJ1c2Ugc3RyaWN0IikmJiFoKCkmJmMoZSwiU3ludGF4RXJyb3I6IFVuZXhwZWN0ZWQgeWllbGQgaWRlbnRpZmllciBpbnNpZGUgc3RyaWN0IG1vZGUiKTtjYXNlInN0cmluZyI6Y2FzZSJudW0iOmNhc2Uia2V5d29yZCI6Y2FzZSJhdG9tIjpyZXR1cm4gZS52YWx1ZTtkZWZhdWx0OmYoZSl9fWZ1bmN0aW9uIFooKXt2YXIgZT15ZS50b2tlbjtzd2l0Y2goaSgpLGUudHlwZSl7Y2FzZSJuYW1lIjpjYXNlIm9wZXJhdG9yIjpjYXNlImtleXdvcmQiOmNhc2UiYXRvbSI6cmV0dXJuIGUudmFsdWU7ZGVmYXVsdDpmKCl9fWZ1bmN0aW9uIEsoZSl7dmFyIG49eWUudG9rZW4udmFsdWU7cmV0dXJuIG5ldygidGhpcyI9PW4/UG46InN1cGVyIj09bj9VbjplKSh7bmFtZTpTdHJpbmcobiksc3RhcnQ6eWUudG9rZW4sZW5kOnllLnRva2VufSl9ZnVuY3Rpb24gUShlLG4pe2lmKCF0KCJuYW1lIikpcmV0dXJuIG58fGEoIlN5bnRheEVycm9yOiBOYW1lIGV4cGVjdGVkIiksbnVsbDt0KCJuYW1lIiwieWllbGQiKSYmeWUuaW5wdXQuaGFzX2RpcmVjdGl2ZSgidXNlIHN0cmljdCIpJiZjKHllLnByZXYsIlN5bnRheEVycm9yOiBVbmV4cGVjdGVkIHlpZWxkIGlkZW50aWZpZXIgaW5zaWRlIHN0cmljdCBtb2RlIik7dmFyIHI9SyhlKTtyZXR1cm4gaSgpLHJ9ZnVuY3Rpb24gcmUoZSxuLHQpe3JldHVybiIrKyIhPW4mJiItLSIhPW58fGNlKHQpfHxhKCJTeW50YXhFcnJvcjogSW52YWxpZCB1c2Ugb2YgIituKyIgb3BlcmF0b3IiKSxuZXcgZSh7b3BlcmF0b3I6bixleHByZXNzaW9uOnR9KX1mdW5jdGlvbiB1ZShlKXtyZXR1cm4gSm4oR24oITApLDAsZSl9ZnVuY3Rpb24gY2UoZSl7cmV0dXJuIW4uc3RyaWN0fHwhKGUgaW5zdGFuY2VvZiBQbikmJighKGUgaW5zdGFuY2VvZiBVbikmJihlIGluc3RhbmNlb2Ygbm58fGUgaW5zdGFuY2VvZiBibikpfWZ1bmN0aW9uIG1lKGUpeysreWUuaW5fbG9vcDt2YXIgbj1lKCk7cmV0dXJuLS15ZS5pbl9sb29wLG59bj1zKG4se3N0cmljdDohMSxmaWxlbmFtZTpudWxsLHRvcGxldmVsOm51bGwsZXhwcmVzc2lvbjohMSxodG1sNV9jb21tZW50czohMCxiYXJlX3JldHVybnM6ITEsc2hlYmFuZzohMH0pO3ZhciB5ZT17aW5wdXQ6InN0cmluZyI9PXR5cGVvZiBlP0goZSxuLmZpbGVuYW1lLG4uaHRtbDVfY29tbWVudHMsbi5zaGViYW5nKTplLHRva2VuOm51bGwscHJldjpudWxsLHBlZWtlZDpudWxsLGluX2Z1bmN0aW9uOjAsaW5fZ2VuZXJhdG9yOi0xLGluX2RpcmVjdGl2ZXM6ITAsaW5fbG9vcDowLGxhYmVsczpbXX07eWUudG9rZW49aSgpO3ZhciBCZT12KGZ1bmN0aW9uKCl7dmFyIGU7c3dpdGNoKF8oKSx5ZS50b2tlbi50eXBlKXtjYXNlInN0cmluZyI6dmFyIG89ITE7eWUuaW5fZGlyZWN0aXZlcz09PSEwJiYoKGoocigpLCJwdW5jIiwiOyIpfHxyKCkubmxiKSYmeWUudG9rZW4ucmF3LmluZGV4T2YoIlxcIik9PT0tMT95ZS5pbnB1dC5hZGRfZGlyZWN0aXZlKHllLnRva2VuLnZhbHVlKTp5ZS5pbl9kaXJlY3RpdmVzPSExKTt2YXIgbz15ZS5pbl9kaXJlY3RpdmVzLHM9eSgpO3JldHVybiBvP25ldyBuZSh7c3RhcnQ6cy5ib2R5LnN0YXJ0LGVuZDpzLmJvZHkuZW5kLHF1b3RlOnMuYm9keS5xdW90ZSx2YWx1ZTpzLmJvZHkudmFsdWV9KTpzO2Nhc2UidGVtcGxhdGVfaGVhZCI6Y2FzZSJudW0iOmNhc2UicmVnZXhwIjpjYXNlIm9wZXJhdG9yIjpjYXNlImF0b20iOnJldHVybiB5KCk7Y2FzZSJuYW1lIjpyZXR1cm4gaihyKCksInB1bmMiLCI6Iik/ZygpOnkoKTtjYXNlInB1bmMiOnN3aXRjaCh5ZS50b2tlbi52YWx1ZSl7Y2FzZSJ7IjpyZXR1cm4gbmV3IGllKHtzdGFydDp5ZS50b2tlbixib2R5Ok0oKSxlbmQ6dSgpfSk7Y2FzZSJbIjpjYXNlIigiOnJldHVybiB5KCk7Y2FzZSI7IjpyZXR1cm4geWUuaW5fZGlyZWN0aXZlcz0hMSxpKCksbmV3IG9lO2RlZmF1bHQ6ZigpfWNhc2Uia2V5d29yZCI6c3dpdGNoKGU9eWUudG9rZW4udmFsdWUsaSgpLGUpe2Nhc2UiYnJlYWsiOnJldHVybiBiKHFlKTtjYXNlImNvbnRpbnVlIjpyZXR1cm4gYihNZSk7Y2FzZSJkZWJ1Z2dlciI6cmV0dXJuIEQoKSxuZXcgZWU7Y2FzZSJkbyI6cmV0dXJuIG5ldyBmZSh7Ym9keTptZShCZSksY29uZGl0aW9uOihsKCJrZXl3b3JkIiwid2hpbGUiKSxlPW0oKSxEKCEwKSxlKX0pO2Nhc2Uid2hpbGUiOnJldHVybiBuZXcgbGUoe2NvbmRpdGlvbjptKCksYm9keTptZShCZSl9KTtjYXNlImZvciI6cmV0dXJuIEUoKTtjYXNlImNsYXNzIjpyZXR1cm4gVihnbik7Y2FzZSJmdW5jdGlvbiI6cmV0dXJuIE9lKEZlKTtjYXNlImlmIjpyZXR1cm4gTygpO2Nhc2UicmV0dXJuIjpyZXR1cm4gMCE9eWUuaW5fZnVuY3Rpb258fG4uYmFyZV9yZXR1cm5zfHxhKCJTeW50YXhFcnJvcjogJ3JldHVybicgb3V0c2lkZSBvZiBmdW5jdGlvbiIpLG5ldyBUZSh7dmFsdWU6dCgicHVuYyIsIjsiKT8oaSgpLG51bGwpOmQoKT9udWxsOihlPXJ0KCEwKSxEKCksZSl9KTtjYXNlInN3aXRjaCI6cmV0dXJuIG5ldyBOZSh7ZXhwcmVzc2lvbjptKCksYm9keTptZSh6KX0pO2Nhc2UidGhyb3ciOnJldHVybiB5ZS50b2tlbi5ubGImJmEoIlN5bnRheEVycm9yOiBJbGxlZ2FsIG5ld2xpbmUgYWZ0ZXIgJ3Rocm93JyIpLG5ldyAkZSh7dmFsdWU6KGU9cnQoITApLEQoKSxlKX0pO2Nhc2UidHJ5IjpyZXR1cm4gSSgpO2Nhc2UidmFyIjpyZXR1cm4gZT1qZSgpLEQoKSxlO2Nhc2UibGV0IjpyZXR1cm4gZT1vbigpLEQoKSxlO2Nhc2UiY29uc3QiOnJldHVybiBlPWRuKCksRCgpLGU7Y2FzZSJ3aXRoIjpyZXR1cm4geWUuaW5wdXQuaGFzX2RpcmVjdGl2ZSgidXNlIHN0cmljdCIpJiZhKCJTeW50YXhFcnJvcjogU3RyaWN0IG1vZGUgbWF5IG5vdCBpbmNsdWRlIGEgd2l0aCBzdGF0ZW1lbnQiKSxuZXcgRGUoe2V4cHJlc3Npb246bSgpLGJvZHk6QmUoKX0pO2Nhc2UiaW1wb3J0IjpyZXR1cm4gZT1ZKCksRCgpLGU7Y2FzZSJleHBvcnQiOnJldHVybiBHKCk7ZGVmYXVsdDpmKCl9fX0pLFNlPWZ1bmN0aW9uKGUpe3llLnRva2VuLm5sYiYmYSgiU3ludGF4RXJyb3I6IFVuZXhwZWN0ZWQgbmV3bGluZSBiZWZvcmUgYXJyb3cgKD0+KSIpLGwoImFycm93IiwiPT4iKTt2YXIgbjtuPSJudW1iZXIiPT10eXBlb2YgZS5sZW5ndGg/ZTplLmFzX3BhcmFtcyhhKTt2YXIgcj1UKHQoInB1bmMiLCJ7Iik/ITA6ITEpO3JldHVybiBuZXcgQWUoe3N0YXJ0OmUuc3RhcnQsZW5kOnIuZW5kLGFyZ25hbWVzOm4sYm9keTpyfSl9LE9lPWZ1bmN0aW9uKGUsbil7dmFyIHI9KHllLnRva2VuLGU9PT1GZSksbz10KCJvcGVyYXRvciIsIioiKTtvJiZpKCk7dmFyIHU9dCgibmFtZSIpP1Eocj9Tbjokbik6bnVsbDtyJiYhdSYmZigpO3ZhciBhPWsoKSxzPVQoITAsb3x8bik7cmV0dXJuIG5ldyBlKHtzdGFydDphLnN0YXJ0LGVuZDpzLmVuZCxpc19nZW5lcmF0b3I6byxuYW1lOnUsYXJnbmFtZXM6YSxib2R5OnN9KX0samU9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBWZSh7c3RhcnQ6dSgpLGRlZmluaXRpb25zOlAoZSwidmFyIiksZW5kOnUoKX0pfSxvbj1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IFdlKHtzdGFydDp1KCksZGVmaW5pdGlvbnM6UChlLCJsZXQiKSxlbmQ6dSgpfSl9LGRuPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBZZSh7c3RhcnQ6dSgpLGRlZmluaXRpb25zOlAoITEsImNvbnN0IiksZW5kOnUoKX0pfSxfbj1mdW5jdGlvbihlKXt2YXIgbj15ZS50b2tlbjtpZihsKCJvcGVyYXRvciIsIm5ldyIpLHQoInB1bmMiLCIuIikpcmV0dXJuIGkoKSxsKCJuYW1lIiwidGFyZ2V0IiksUm4obmV3IEVuKHtzdGFydDpuLGVuZDp1KCl9KSxlKTt2YXIgcixvPUFuKCExKTtyZXR1cm4gdCgicHVuYyIsIigiKT8oaSgpLHI9TCgiKSIpKTpyPVtdLFJuKG5ldyBRZSh7c3RhcnQ6bixleHByZXNzaW9uOm8sYXJnczpyLGVuZDp1KCl9KSxlKX0sQW49ZnVuY3Rpb24oZSl7aWYodCgib3BlcmF0b3IiLCJuZXciKSlyZXR1cm4gX24oZSk7dmFyIG49eWUudG9rZW47aWYodCgicHVuYyIpKXtzd2l0Y2gobi52YWx1ZSl7Y2FzZSIoIjp2YXIgcj1TKCk7cmV0dXJuIHIuc3RhcnQ9bixyLmVuZD15ZS50b2tlbix0KCJhcnJvdyIsIj0+Iik/U2Uocik6Um4oci5hc19leHByKGEpLGUpO2Nhc2UiWyI6cmV0dXJuIFJuKEZuKCksZSk7Y2FzZSJ7IjpyZXR1cm4gUm4oQ24oKSxlKX1mKCl9aWYodCgia2V5d29yZCIsImZ1bmN0aW9uIikpe2koKTt2YXIgbz1PZShFZSk7cmV0dXJuIG8uc3RhcnQ9bixvLmVuZD11KCksUm4obyxlKX1pZih0KCJrZXl3b3JkIiwiY2xhc3MiKSl7aSgpO3ZhciBzPVYoeW4pO3JldHVybiBzLnN0YXJ0PW4scy5lbmQ9dSgpLFJuKHMsZSl9cmV0dXJuIHQoInRlbXBsYXRlX2hlYWQiKT9SbihSKCksZSk6Q3RbeWUudG9rZW4udHlwZV0/Um4oVSgpLGUpOnZvaWQgZigpfSxGbj12KGZ1bmN0aW9uKCl7cmV0dXJuIHAoIlsiKSxuZXcgbG4oe2VsZW1lbnRzOkwoIl0iLCFuLnN0cmljdCwhMCl9KX0pLENuPXYoZnVuY3Rpb24oKXt2YXIgZT15ZS50b2tlbixyPSEwLG89W107Zm9yKHAoInsiKTshdCgicHVuYyIsIn0iKSYmKHI/cj0hMTpwKCIsIiksbi5zdHJpY3R8fCF0KCJwdW5jIiwifSIpKTspe2U9eWUudG9rZW47dmFyIGE9ZS50eXBlLHM9SigpO2lmKHQoInB1bmMiLCI6IikpbnVsbD09PXMmJmYodSgpKTtlbHNle3ZhciBjPVcocyxlKTtpZihjKXtvLnB1c2goYyk7Y29udGludWV9fSJwdW5jIiE9YXx8IlsiIT1lLnZhbHVlP3QoIm9wZXJhdG9yIiwiPSIpPyhpKCksby5wdXNoKG5ldyBmbih7c3RhcnQ6ZSxsZWZ0Om5ldyBIbih7c3RhcnQ6ZSxlbmQ6ZSxuYW1lOnN9KSxvcGVyYXRvcjoiPSIscmlnaHQ6cnQoITEpLGVuZDp1KCl9KSkpOnQoInB1bmMiLCI6Iik/KHAoIjoiKSxvLnB1c2gobmV3IGhuKHtzdGFydDplLHF1b3RlOmUucXVvdGUsa2V5OnMsdmFsdWU6cnQoITEpLGVuZDp1KCl9KSkpOm8ucHVzaChuZXcgaG4oe3N0YXJ0OmUsa2V5OnMsdmFsdWU6bmV3IEhuKHtzdGFydDplLGVuZDp1KCksbmFtZTpzfSksZW5kOmV9KSk6KHAoIjoiKSxvLnB1c2gobmV3IGhuKHtzdGFydDplLGtleTpzLHZhbHVlOnJ0KCExKSxlbmQ6dSgpfSkpKX1yZXR1cm4gaSgpLG5ldyBwbih7cHJvcGVydGllczpvfSl9KSxSbj1mdW5jdGlvbihlLG4pe3ZhciByPWUuc3RhcnQ7aWYodCgicHVuYyIsIi4iKSlyZXR1cm4gaSgpLFJuKG5ldyB0bih7c3RhcnQ6cixleHByZXNzaW9uOmUscHJvcGVydHk6WigpLGVuZDp1KCl9KSxuKTtpZih0KCJwdW5jIiwiWyIpKXtpKCk7dmFyIG89cnQoITApO3JldHVybiBwKCJdIiksUm4obmV3IHJuKHtzdGFydDpyLGV4cHJlc3Npb246ZSxwcm9wZXJ0eTpvLGVuZDp1KCl9KSxuKX1yZXR1cm4gbiYmdCgicHVuYyIsIigiKT8oaSgpLFJuKG5ldyBLZSh7c3RhcnQ6cixleHByZXNzaW9uOmUsYXJnczpZbigpLGVuZDp1KCl9KSwhMCkpOnQoInRlbXBsYXRlX2hlYWQiKT9SbihuZXcgQ2Uoe3N0YXJ0OnIscHJlZml4OmUsdGVtcGxhdGVfc3RyaW5nOlIoKX0pLG4pOmV9LFluPXYoZnVuY3Rpb24oKXtmb3IodmFyIGU9ITAsbj1bXTshdCgicHVuYyIsIikiKTspZT9lPSExOnAoIiwiKSx0KCJleHBhbmQiLCIuLi4iKT8oaSgpLG4ucHVzaChuZXcgX2Uoe3N0YXJ0OnUoKSxleHByZXNzaW9uOnJ0KCExKX0pKSk6bi5wdXNoKHJ0KCExKSk7cmV0dXJuIGkoKSxufSksR249ZnVuY3Rpb24oZSl7dmFyIG49eWUudG9rZW47aWYodCgib3BlcmF0b3IiKSYmRXQobi52YWx1ZSkpe2koKSxfKCk7dmFyIHI9cmUodW4sbi52YWx1ZSxHbihlKSk7cmV0dXJuIHIuc3RhcnQ9bixyLmVuZD11KCkscn1mb3IodmFyIG89QW4oZSk7dCgib3BlcmF0b3IiKSYmQXQoeWUudG9rZW4udmFsdWUpJiYheWUudG9rZW4ubmxiOylvPXJlKGFuLHllLnRva2VuLnZhbHVlLG8pLG8uc3RhcnQ9bixvLmVuZD15ZS50b2tlbixpKCk7cmV0dXJuIG99LEpuPWZ1bmN0aW9uKGUsbixyKXt2YXIgbz10KCJvcGVyYXRvciIpP3llLnRva2VuLnZhbHVlOm51bGw7ImluIj09byYmciYmKG89bnVsbCksIioqIj09byYmZSBpbnN0YW5jZW9mIHVuJiZlLmVuZD09PXllLnByZXYmJiItLSIhPT1lLm9wZXJhdG9yJiYiKysiIT09ZS5vcGVyYXRvciYmZihlLnN0YXJ0KTt2YXIgdT1udWxsIT1vP3d0W29dOm51bGw7aWYobnVsbCE9dSYmKHU+bnx8IioqIj09PW8mJm49PT11KSl7aSgpO3ZhciBhPUpuKEduKCEwKSx1LHIpO3JldHVybiBKbihuZXcgc24oe3N0YXJ0OmUuc3RhcnQsbGVmdDplLG9wZXJhdG9yOm8scmlnaHQ6YSxlbmQ6YS5lbmR9KSxuLHIpfXJldHVybiBlfSxLbj1mdW5jdGlvbihlKXt2YXIgbj15ZS50b2tlbixyPXVlKGUpO2lmKHQoIm9wZXJhdG9yIiwiPyIpKXtpKCk7dmFyIG89cnQoITEpO3JldHVybiBwKCI6IiksbmV3IGNuKHtzdGFydDpuLGNvbmRpdGlvbjpyLGNvbnNlcXVlbnQ6byxhbHRlcm5hdGl2ZTpydCghMSxlKSxlbmQ6dSgpfSl9cmV0dXJuIHJ9LFFuPWZ1bmN0aW9uKGUpe3ZhciBuPXllLnRva2VuO2lmKCJuYW1lIj09bi50eXBlJiYieWllbGQiPT1uLnZhbHVlKXtpZihoKCkpcmV0dXJuIGkoKSwkKCk7eWUuaW5wdXQuaGFzX2RpcmVjdGl2ZSgidXNlIHN0cmljdCIpJiZjKHllLnRva2VuLCJTeW50YXhFcnJvcjogVW5leHBlY3RlZCB5aWVsZCBpZGVudGlmaWVyIGluc2lkZSBzdHJpY3QgbW9kZSIpfWlmKCJwdW5jIj09bi50eXBlJiYiKCI9PW4udmFsdWUmJiIpIj09cigpLnZhbHVlKXJldHVybiBpKCksaSgpLFNlKFtdKTtpZih0KCJuYW1lIikmJmoocigpLCJhcnJvdyIpKXt2YXIgbz1uZXcgQm4oe25hbWU6bi52YWx1ZSxzdGFydDpuLGVuZDpufSk7cmV0dXJuIGkoKSxTZShbb10pfXZhciBzPUtuKGUpLGY9eWUudG9rZW4udmFsdWU7aWYodCgib3BlcmF0b3IiKSYmRnQoZikpe2lmKGNlKHMpKXJldHVybiBpKCksbmV3IGZuKHtzdGFydDpuLGxlZnQ6cyxvcGVyYXRvcjpmLHJpZ2h0OlFuKGUpLGVuZDp1KCl9KTthKCJTeW50YXhFcnJvcjogSW52YWxpZCBhc3NpZ25tZW50Iil9cmV0dXJuIHN9LHJ0PWZ1bmN0aW9uKGUsbil7dmFyIG89eWUudG9rZW4sdT1RbihuKTtyZXR1cm4gdSBpbnN0YW5jZW9mIEhuJiZ0KCJhcnJvdyIsIj0+Iik/KHU9bmV3IGdlKHtzdGFydDp1LnN0YXJ0LGVuZDp1LmVuZCxleHByZXNzaW9uczpbdV19KSxTZSh1KSk6ZSYmdCgicHVuYyIsIiwiKT8oaSgpLG5ldyBlbih7c3RhcnQ6byxjYXI6dSxjZHI6cnQoITAsbiksZW5kOnIoKX0pKTp1fTtyZXR1cm4gbi5leHByZXNzaW9uP3J0KCEwKTpmdW5jdGlvbigpe3ZhciBlPXllLnRva2VuLHI9W107Zm9yKHllLmlucHV0LnB1c2hfZGlyZWN0aXZlc19zdGFjaygpOyF0KCJlb2YiKTspci5wdXNoKEJlKCkpO3llLmlucHV0LnBvcF9kaXJlY3RpdmVzX3N0YWNrKCk7dmFyIGk9dSgpLG89bi50b3BsZXZlbDtyZXR1cm4gbz8oby5ib2R5PW8uYm9keS5jb25jYXQociksby5lbmQ9aSk6bz1uZXcgdmUoe3N0YXJ0OmUsYm9keTpyLGVuZDppfSksb30oKX1mdW5jdGlvbiBQKGUsbil7QS5jYWxsKHRoaXMpLHRoaXMuYmVmb3JlPWUsdGhpcy5hZnRlcj1ufWZ1bmN0aW9uIFUoZSxuLHQpe3RoaXMubmFtZT10Lm5hbWUsdGhpcy5vcmlnPVt0XSx0aGlzLnNjb3BlPWUsdGhpcy5yZWZlcmVuY2VzPVtdLHRoaXMuZ2xvYmFsPSExLHRoaXMuZXhwb3J0PSExLHRoaXMubWFuZ2xlZF9uYW1lPW51bGwsdGhpcy5vYmplY3RfZGVzdHJ1Y3R1cmluZ19hcmc9ITEsdGhpcy51bmRlY2xhcmVkPSExLHRoaXMuY29uc3RhbnQ9ITEsdGhpcy5pbmRleD1uLHRoaXMuaWQ9VS5uZXh0X2lkKyt9ZnVuY3Rpb24gUihlKXt2YXIgbj1lLnZhbHVlLHQ9ZS50eXBlO3JldHVybiJjb21tZW50MiI9PXQ/L0BwcmVzZXJ2ZXxAbGljZW5zZXxAY2Nfb24vaS50ZXN0KG4pOiJjb21tZW50NSI9PXR9ZnVuY3Rpb24gTChlKXtyZXR1cm4iY29tbWVudDUiPT1lLnR5cGV9ZnVuY3Rpb24gVihlKXtmdW5jdGlvbiBuKG4sdCl7cmV0dXJuIG4ucmVwbGFjZSgvW1x1ZDgwMC1cdWRiZmZdW1x1ZGMwMC1cdWRmZmZdfFtcdTAwMDAtXHUwMDFmXHUwMDdmLVx1ZmZmZl0vZyxmdW5jdGlvbihuKXt2YXIgcj13KG4sMCkudG9TdHJpbmcoMTYpO2lmKHQmJjE9PT1yLmxlbmd0aCYmZS5lY21hPj02fHxyLmxlbmd0aD40KXJldHVybiBlLmVjbWE8Nj90P246IlxcdSIrbi5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSsiXFx1IituLmNoYXJDb2RlQXQoMSkudG9TdHJpbmcoMTYpOiJcXHV7IityKyJ9IjtpZihyLmxlbmd0aDw9MiYmIXQpe2Zvcig7ci5sZW5ndGg8Mjspcj0iMCIrcjtyZXR1cm4iXFx4IityfWZvcig7ci5sZW5ndGg8NDspcj0iMCIrcjtyZXR1cm4iXFx1IityfSl9ZnVuY3Rpb24gdCh0LHIpe2Z1bmN0aW9uIGkoKXtyZXR1cm4iJyIrdC5yZXBsYWNlKC9ceDI3L2csIlxcJyIpKyInIn1mdW5jdGlvbiBvKCl7cmV0dXJuJyInK3QucmVwbGFjZSgvXHgyMi9nLCdcXCInKSsnIid9ZnVuY3Rpb24gdSgpe3JldHVybiBlLmFzY2lpX29ubHl8fCh0PXQucmVwbGFjZSgvXFwobnxyfHUyMDI4fHUyMDI5KS9nLGZ1bmN0aW9uKGUsbil7c3dpdGNoKG4pe2Nhc2UibiI6cmV0dXJuIlxuIjtjYXNlInIiOnJldHVybiJcciI7Y2FzZSJ1MjAyOCI6cmV0dXJuIlx1MjAyOCI7Y2FzZSJ1MjAyOSI6cmV0dXJuIlx1MjAyOSJ9cmV0dXJuIGV9KSksImAiK3QucmVwbGFjZSgvYC9nLCJcXGAiKSsiYCJ9dmFyIGE9MCxzPTA7aWYodD10LnJlcGxhY2UoL1tcXFxiXGZcblxyXHZcdFx4MjJceDI3XHUyMDI4XHUyMDI5XDBcdWZlZmZdL2csZnVuY3Rpb24obixyKXtzd2l0Y2gobil7Y2FzZSciJzpyZXR1cm4rK2EsJyInO2Nhc2UiJyI6cmV0dXJuKytzLCInIjtjYXNlIlxcIjpyZXR1cm4iXFxcXCI7Y2FzZSJcbiI6cmV0dXJuIlxcbiI7Y2FzZSJcciI6cmV0dXJuIlxcciI7Y2FzZSJcdCI6cmV0dXJuIlxcdCI7Y2FzZSJcYiI6cmV0dXJuIlxcYiI7Y2FzZSJcZiI6cmV0dXJuIlxcZiI7Y2FzZSJcdiI6cmV0dXJuIGUuc2NyZXdfaWU4PyJcXHYiOiJcXHgwQiI7Y2FzZSJcdTIwMjgiOnJldHVybiJcXHUyMDI4IjtjYXNlIlx1MjAyOSI6cmV0dXJuIlxcdTIwMjkiO2Nhc2UiXHVmZWZmIjpyZXR1cm4iXFx1ZmVmZiI7Y2FzZSJcMCI6cmV0dXJuL1swLTddLy50ZXN0KEYodCxyKzEpKT8iXFx4MDAiOiJcXDAifXJldHVybiBufSksZS5hc2NpaV9vbmx5JiYodD1uKHQpKSwiYCI9PT1yKXJldHVybiB1KCk7c3dpdGNoKGUucXVvdGVfc3R5bGUpe2Nhc2UgMTpyZXR1cm4gaSgpO2Nhc2UgMjpyZXR1cm4gbygpO2Nhc2UgMzpyZXR1cm4iJyI9PXI/aSgpOm8oKTtkZWZhdWx0OnJldHVybiBhPnM/aSgpOm8oKX19ZnVuY3Rpb24gcihuLHIpe3ZhciBpPXQobixyKTtyZXR1cm4gZS5pbmxpbmVfc2NyaXB0JiYoaT1pLnJlcGxhY2UoLzxceDJmc2NyaXB0KFs+XC9cdFxuXGZcciBdKS9naSwiPFxcL3NjcmlwdCQxIiksaT1pLnJlcGxhY2UoL1x4M2MhLS0vZywiXFx4M2MhLS0iKSxpPWkucmVwbGFjZSgvLS1ceDNlL2csIi0tXFx4M2UiKSksaX1mdW5jdGlvbiBpKHQpe3JldHVybiB0PXQudG9TdHJpbmcoKSxlLmFzY2lpX2lkZW50aWZpZXJzJiYodD1uKHQsITApKSx0fWZ1bmN0aW9uIG8obil7cmV0dXJuIHUoIiAiLGUuaW5kZW50X3N0YXJ0K3gtbiplLmluZGVudF9sZXZlbCl9ZnVuY3Rpb24gYSgpe3ZhciBlPU4uY2hhckF0KE4ubGVuZ3RoLTEpO3JldHVybiBCKGUpP04uY2hhckF0KE4ubGVuZ3RoLTIpK2U6ZTsKfWZ1bmN0aW9uIGMoKXtlLm1heF9saW5lX2xlbiYmUz5lLm1heF9saW5lX2xlbiYmZCgiXG4iKX1mdW5jdGlvbiBkKG4pe249U3RyaW5nKG4pO3ZhciB0PUYobiwwKTtpZih6JiYoej0hMSx0JiYhKCI7fSIuaW5kZXhPZih0KTwwKXx8L1s7XSQvLnRlc3QoTil8fChlLnNlbWljb2xvbnN8fGoodCk/KHErPSI7IixTKyssJCsrKToocSs9IlxuIiwkKyssVCsrLFM9MCwvXlxzKyQvLnRlc3QobikmJih6PSEwKSksZS5iZWF1dGlmeXx8KE09ITEpKSksIWUuYmVhdXRpZnkmJmUucHJlc2VydmVfbGluZSYmWFtYLmxlbmd0aC0xXSlmb3IodmFyIHI9WFtYLmxlbmd0aC0xXS5zdGFydC5saW5lO1Q8cjspcSs9IlxuIiwkKyssVCsrLFM9MCxNPSExO2lmKE0pe3ZhciBpPWEoKTsoTyhpKSYmKE8odCl8fCJcXCI9PXQpfHwvXltcK1wtXC9dJC8udGVzdCh0KSYmdD09aSkmJihxKz0iICIsUysrLCQrKyksTT0hMX12YXIgbz1uLnNwbGl0KC9ccj9cbi8pLHU9by5sZW5ndGgtMTtUKz11LDA9PXU/Uys9b1t1XS5sZW5ndGg6Uz1vW3VdLmxlbmd0aCwkKz1uLmxlbmd0aCxOPW4scSs9bn1mdW5jdGlvbiBoKCl7ej0hMSxkKCI7Iil9ZnVuY3Rpb24gRCgpe3JldHVybiB4K2UuaW5kZW50X2xldmVsfWZ1bmN0aW9uIG0oZSl7dmFyIG47cmV0dXJuIGQoInsiKSxWKCksVShEKCksZnVuY3Rpb24oKXtuPWUoKX0pLFAoKSxkKCJ9Iiksbn1mdW5jdGlvbiBfKGUpe2QoIigiKTt2YXIgbj1lKCk7cmV0dXJuIGQoIikiKSxufWZ1bmN0aW9uIGcoZSl7ZCgiWyIpO3ZhciBuPWUoKTtyZXR1cm4gZCgiXSIpLG59ZnVuY3Rpb24geSgpe2QoIiwiKSxJKCl9ZnVuY3Rpb24gYigpe2QoIjoiKSxlLnNwYWNlX2NvbG9uJiZJKCl9ZnVuY3Rpb24gRSgpe3JldHVybiBxfWU9cyhlLHtpbmRlbnRfc3RhcnQ6MCxpbmRlbnRfbGV2ZWw6NCxxdW90ZV9rZXlzOiExLHNwYWNlX2NvbG9uOiEwLGFzY2lpX29ubHk6ITEsYXNjaWlfaWRlbnRpZmllcnM6dm9pZCAwLHVuZXNjYXBlX3JlZ2V4cHM6ITEsaW5saW5lX3NjcmlwdDohMSx3aWR0aDo4MCxtYXhfbGluZV9sZW46MzJlMyxiZWF1dGlmeTohMSxzb3VyY2VfbWFwOm51bGwsYnJhY2tldGl6ZTohMSxzZW1pY29sb25zOiEwLGNvbW1lbnRzOiExLHNoZWJhbmc6ITAscHJlc2VydmVfbGluZTohMSxzY3Jld19pZTg6ITAscHJlYW1ibGU6bnVsbCxxdW90ZV9zdHlsZTowLGtlZXBfcXVvdGVkX3Byb3BzOiExLHNob3J0aGFuZDp2b2lkIDAsZWNtYTo1LHdyYXBfaWlmZTohMX0sITApLCJ1bmRlZmluZWQiPT10eXBlb2YgZS5hc2NpaV9pZGVudGlmaWVycyYmKGUuYXNjaWlfaWRlbnRpZmllcnM9ZS5hc2NpaV9vbmx5KSx2b2lkIDA9PT1lLnNob3J0aGFuZCYmKGUuc2hvcnRoYW5kPWUuZWNtYT41KTt2YXIgQT1lLnNoZWJhbmc/TDpsO2lmKGUuY29tbWVudHMpe3ZhciBDPWUuY29tbWVudHM7aWYoInN0cmluZyI9PXR5cGVvZiBlLmNvbW1lbnRzJiYvXlwvLipcL1thLXpBLVpdKiQvLnRlc3QoZS5jb21tZW50cykpe3ZhciBrPWUuY29tbWVudHMubGFzdEluZGV4T2YoIi8iKTtDPW5ldyBSZWdFeHAoZS5jb21tZW50cy5zdWJzdHIoMSxrLTEpLGUuY29tbWVudHMuc3Vic3RyKGsrMSkpfUE9QyBpbnN0YW5jZW9mIFJlZ0V4cD9mdW5jdGlvbihlKXtyZXR1cm4iY29tbWVudDUiPT1lLnR5cGV8fEMudGVzdChlLnZhbHVlKX06ImZ1bmN0aW9uIj09dHlwZW9mIEM/ZnVuY3Rpb24oZSl7cmV0dXJuImNvbW1lbnQ1Ij09ZS50eXBlfHxDKHRoaXMsZSl9OiJzb21lIj09PUM/UjpwfXZhciB4PTAsUz0wLFQ9MSwkPTAscT0iIixNPSExLHo9ITEsTj1udWxsLGo9digiKCBbICsgKiAvIC0gLCAuIiksSD1mdW5jdGlvbigpe2QoIioiKX0sST1lLmJlYXV0aWZ5P2Z1bmN0aW9uKCl7ZCgiICIpfTpmdW5jdGlvbigpe009ITB9LFA9ZS5iZWF1dGlmeT9mdW5jdGlvbihuKXtlLmJlYXV0aWZ5JiZkKG8obj8uNTowKSl9OmYsVT1lLmJlYXV0aWZ5P2Z1bmN0aW9uKGUsbil7ZT09PSEwJiYoZT1EKCkpO3ZhciB0PXg7eD1lO3ZhciByPW4oKTtyZXR1cm4geD10LHJ9OmZ1bmN0aW9uKGUsbil7cmV0dXJuIG4oKX0sVj1lLmJlYXV0aWZ5P2Z1bmN0aW9uKCl7ZCgiXG4iKX06YyxXPWUuYmVhdXRpZnk/ZnVuY3Rpb24oKXtkKCI7Iil9OmZ1bmN0aW9uKCl7ej0hMH0sWT1lLnNvdXJjZV9tYXA/ZnVuY3Rpb24obix0KXt0cnl7biYmZS5zb3VyY2VfbWFwLmFkZChuLmZpbGV8fCI/IixULFMsbi5saW5lLG4uY29sLHR8fCJuYW1lIiE9bi50eXBlP3Q6bi52YWx1ZSl9Y2F0Y2goZSl7Sy53YXJuKCJDb3VsZG4ndCBmaWd1cmUgb3V0IG1hcHBpbmcgZm9yIHtmaWxlfTp7bGluZX0se2NvbH0g4oaSIHtjbGluZX0se2Njb2x9IFt7bmFtZX1dIix7ZmlsZTpuLmZpbGUsbGluZTpuLmxpbmUsY29sOm4uY29sLGNsaW5lOlQsY2NvbDpTLG5hbWU6dHx8IiJ9KX19OmY7ZS5wcmVhbWJsZSYmZChlLnByZWFtYmxlLnJlcGxhY2UoL1xyXG4/fFtcblx1MjAyOFx1MjAyOV18XHMqJC9nLCJcbiIpKTt2YXIgWD1bXTtyZXR1cm57Z2V0OkUsdG9TdHJpbmc6RSxpbmRlbnQ6UCxpbmRlbnRhdGlvbjpmdW5jdGlvbigpe3JldHVybiB4fSxjdXJyZW50X3dpZHRoOmZ1bmN0aW9uKCl7cmV0dXJuIFMteH0sc2hvdWxkX2JyZWFrOmZ1bmN0aW9uKCl7cmV0dXJuIGUud2lkdGgmJnRoaXMuY3VycmVudF93aWR0aCgpPj1lLndpZHRofSxuZXdsaW5lOlYscHJpbnQ6ZCxzdGFyOkgsc3BhY2U6SSxjb21tYTp5LGNvbG9uOmIsbGFzdDpmdW5jdGlvbigpe3JldHVybiBOfSxzZW1pY29sb246Vyxmb3JjZV9zZW1pY29sb246aCx0b19hc2NpaTpuLHByaW50X25hbWU6ZnVuY3Rpb24oZSl7ZChpKGUpKX0scHJpbnRfc3RyaW5nOmZ1bmN0aW9uKGUsbix0KXt2YXIgaT1yKGUsbik7dD09PSEwJiZpLmluZGV4T2YoIlxcIik9PT0tMSYmKHh0LnRlc3QocSl8fGgoKSxoKCkpLGQoaSl9LHByaW50X3RlbXBsYXRlX3N0cmluZ19jaGFyczpmdW5jdGlvbihlKXt2YXIgbj1yKGUsImAiKS5yZXBsYWNlKC9cJHsvZywiXFwkeyIpO3JldHVybiBkKG4uc3Vic3RyKDEsbi5sZW5ndGgtMikpfSxlbmNvZGVfc3RyaW5nOnIsbmV4dF9pbmRlbnQ6RCx3aXRoX2luZGVudDpVLHdpdGhfYmxvY2s6bSx3aXRoX3BhcmVuczpfLHdpdGhfc3F1YXJlOmcsYWRkX21hcHBpbmc6WSxvcHRpb246ZnVuY3Rpb24obil7cmV0dXJuIGVbbl19LGNvbW1lbnRfZmlsdGVyOkEsbGluZTpmdW5jdGlvbigpe3JldHVybiBUfSxjb2w6ZnVuY3Rpb24oKXtyZXR1cm4gU30scG9zOmZ1bmN0aW9uKCl7cmV0dXJuICR9LHB1c2hfbm9kZTpmdW5jdGlvbihlKXtYLnB1c2goZSl9LHBvcF9ub2RlOmZ1bmN0aW9uKCl7cmV0dXJuIFgucG9wKCl9LHN0YWNrOmZ1bmN0aW9uKCl7cmV0dXJuIFh9LHBhcmVudDpmdW5jdGlvbihlKXtyZXR1cm4gWFtYLmxlbmd0aC0yLShlfHwwKV19fX1mdW5jdGlvbiBXKGUsbil7aWYoISh0aGlzIGluc3RhbmNlb2YgVykpcmV0dXJuIG5ldyBXKGUsbik7UC5jYWxsKHRoaXMsdGhpcy5iZWZvcmUsdGhpcy5hZnRlciksdGhpcy5vcHRpb25zPXMoZSx7c2VxdWVuY2VzOiFuLHByb3BlcnRpZXM6IW4sZGVhZF9jb2RlOiFuLGRyb3BfZGVidWdnZXI6IW4sdW5zYWZlOiExLHVuc2FmZV9jb21wczohMSxjb25kaXRpb25hbHM6IW4sY29tcGFyaXNvbnM6IW4sZXZhbHVhdGU6IW4sYm9vbGVhbnM6IW4sbG9vcHM6IW4sdW51c2VkOiFuLGhvaXN0X2Z1bnM6IW4sa2VlcF9mYXJnczohMCxrZWVwX2ZuYW1lczohMSxob2lzdF92YXJzOiExLGlmX3JldHVybjohbixqb2luX3ZhcnM6IW4sY29sbGFwc2VfdmFyczohMSxyZWR1Y2VfdmFyczohMSxjYXNjYWRlOiFuLHNpZGVfZWZmZWN0czohbixwdXJlX2dldHRlcnM6ITEscHVyZV9mdW5jczpudWxsLG5lZ2F0ZV9paWZlOiFuLHNjcmV3X2llODohMCxkcm9wX2NvbnNvbGU6ITEsYW5ndWxhcjohMSx3YXJuaW5nczohMCxnbG9iYWxfZGVmczp7fSxwYXNzZXM6MX0sITApO3ZhciB0PXRoaXMub3B0aW9ucy5zZXF1ZW5jZXM7dGhpcy5zZXF1ZW5jZXNfbGltaXQ9MT09dD8yMDA6MHx0LHRoaXMud2FybmluZ3NfcHJvZHVjZWQ9e319ZnVuY3Rpb24gWShlKXtmdW5jdGlvbiBuKG4saSxvLHUsYSxzKXtpZihyKXt2YXIgYz1yLm9yaWdpbmFsUG9zaXRpb25Gb3Ioe2xpbmU6dSxjb2x1bW46YX0pO2lmKG51bGw9PT1jLnNvdXJjZSlyZXR1cm47bj1jLnNvdXJjZSx1PWMubGluZSxhPWMuY29sdW1uLHM9Yy5uYW1lfHxzfXQuYWRkTWFwcGluZyh7Z2VuZXJhdGVkOntsaW5lOmkrZS5kZXN0X2xpbmVfZGlmZixjb2x1bW46b30sb3JpZ2luYWw6e2xpbmU6dStlLm9yaWdfbGluZV9kaWZmLGNvbHVtbjphfSxzb3VyY2U6bixuYW1lOnN9KX1lPXMoZSx7ZmlsZTpudWxsLHJvb3Q6bnVsbCxvcmlnOm51bGwsb3JpZ19saW5lX2RpZmY6MCxkZXN0X2xpbmVfZGlmZjowfSk7dmFyIHQ9bmV3IE1PWl9Tb3VyY2VNYXAuU291cmNlTWFwR2VuZXJhdG9yKHtmaWxlOmUuZmlsZSxzb3VyY2VSb290OmUucm9vdH0pLHI9ZS5vcmlnJiZuZXcgTU9aX1NvdXJjZU1hcC5Tb3VyY2VNYXBDb25zdW1lcihlLm9yaWcpO3JldHVybiByJiZBcnJheS5pc0FycmF5KGUub3JpZy5zb3VyY2VzKSYmci5fc291cmNlcy50b0FycmF5KCkuZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgbj1yLnNvdXJjZUNvbnRlbnRGb3IoZSwhMCk7biYmdC5zZXRTb3VyY2VDb250ZW50KGUsbil9KSx7YWRkOm4sZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHR9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHQudG9KU09OKCkpfX19ZnVuY3Rpb24gWCgpe2Z1bmN0aW9uIGUoZSl7ZChpLGUpfXZhciB0PVsiU3ltYm9sIiwiTWFwIiwiUHJvbWlzZSIsIlByb3h5IiwiUmVmbGVjdCIsIlNldCIsIldlYWtNYXAiLCJXZWFrU2V0Il0scj17fTt0LmZvckVhY2goZnVuY3Rpb24oZSl7cltlXT1uW2VdfHxuZXcgRnVuY3Rpb259KTt2YXIgaT1bXTtyZXR1cm5bT2JqZWN0LEFycmF5LEZ1bmN0aW9uLE51bWJlcixTdHJpbmcsQm9vbGVhbixFcnJvcixNYXRoLERhdGUsUmVnRXhwLHIuU3ltYm9sLEFycmF5QnVmZmVyLERhdGFWaWV3LGRlY29kZVVSSSxkZWNvZGVVUklDb21wb25lbnQsZW5jb2RlVVJJLGVuY29kZVVSSUNvbXBvbmVudCxldmFsLEV2YWxFcnJvcixGbG9hdDMyQXJyYXksRmxvYXQ2NEFycmF5LEludDhBcnJheSxJbnQxNkFycmF5LEludDMyQXJyYXksaXNGaW5pdGUsaXNOYU4sSlNPTixyLk1hcCxwYXJzZUZsb2F0LHBhcnNlSW50LHIuUHJvbWlzZSxyLlByb3h5LFJhbmdlRXJyb3IsUmVmZXJlbmNlRXJyb3Isci5SZWZsZWN0LHIuU2V0LFN5bnRheEVycm9yLFR5cGVFcnJvcixVaW50OEFycmF5LFVpbnQ4Q2xhbXBlZEFycmF5LFVpbnQxNkFycmF5LFVpbnQzMkFycmF5LFVSSUVycm9yLHIuV2Vha01hcCxyLldlYWtTZXRdLmZvckVhY2goZnVuY3Rpb24obil7T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobikubWFwKGUpLG4ucHJvdG90eXBlJiZPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuLnByb3RvdHlwZSkubWFwKGUpfSksaX1mdW5jdGlvbiBHKGUsbil7ZnVuY3Rpb24gdChlKXtyZXR1cm4hKHYuaW5kZXhPZihlKT49MCkmJighKGMuaW5kZXhPZihlKT49MCkmJihuLm9ubHlfY2FjaGU/Zi5wcm9wcy5oYXMoZSk6IS9eWzAtOS5dKyQvLnRlc3QoZSkpKX1mdW5jdGlvbiByKGUpe3JldHVybiEoaCYmZSBpbiBfKSYmKCEocCYmIXAudGVzdChlKSkmJighKGMuaW5kZXhPZihlKT49MCkmJihmLnByb3BzLmhhcyhlKXx8bS5pbmRleE9mKGUpPj0wKSkpfWZ1bmN0aW9uIGkoZSxuKXtyZXR1cm4gbj92b2lkKF9bZV09ITApOih0KGUpJiZkKG0sZSksdm9pZChyKGUpfHxkKHYsZSkpKX1mdW5jdGlvbiBvKGUpe2lmKCFyKGUpKXJldHVybiBlO3ZhciBuPWYucHJvcHMuZ2V0KGUpO2lmKCFuKXtpZihEKXt2YXIgaT0iXyQiK2UrIiQiK2wrIl8iOyF0KGkpfHxoJiZpIGluIF98fChuPWkpfWlmKCFuKWRvIG49a3QoKytmLmNuYW1lKTt3aGlsZSghdChuKXx8aCYmbiBpbiBfKTtmLnByb3BzLnNldChlLG4pfXJldHVybiBufWZ1bmN0aW9uIHUoZSxuKXt2YXIgdD17fTt0cnl7IWZ1bmN0aW9uIGUocil7ci53YWxrKG5ldyBBKGZ1bmN0aW9uKHIpe2lmKHIgaW5zdGFuY2VvZiBlbilyZXR1cm4gZShyLmNkciksITA7aWYociBpbnN0YW5jZW9mIExuKXJldHVybiBpKHIudmFsdWUsbiksITA7aWYociBpbnN0YW5jZW9mIGNuKXJldHVybiBlKHIuY29uc2VxdWVudCksZShyLmFsdGVybmF0aXZlKSwhMDt0aHJvdyB0fSkpfShlKX1jYXRjaChlKXtpZihlIT09dCl0aHJvdyBlfX1mdW5jdGlvbiBhKGUpe3JldHVybiBlLnRyYW5zZm9ybShuZXcgUChmdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIGVuP2UuY2RyPWEoZS5jZHIpOmUgaW5zdGFuY2VvZiBMbj9lLnZhbHVlPW8oZS52YWx1ZSk6ZSBpbnN0YW5jZW9mIGNuJiYoZS5jb25zZXF1ZW50PWEoZS5jb25zZXF1ZW50KSxlLmFsdGVybmF0aXZlPWEoZS5hbHRlcm5hdGl2ZSkpLGV9KSl9bj1zKG4se3Jlc2VydmVkOm51bGwsY2FjaGU6bnVsbCxvbmx5X2NhY2hlOiExLHJlZ2V4Om51bGwsaWdub3JlX3F1b3RlZDohMSxkZWJ1ZzohMX0pO3ZhciBjPW4ucmVzZXJ2ZWQ7bnVsbD09YyYmKGM9WCgpKTt2YXIgZj1uLmNhY2hlO251bGw9PWYmJihmPXtjbmFtZTotMSxwcm9wczpuZXcgZ30pO3ZhciBsLHA9bi5yZWdleCxoPW4uaWdub3JlX3F1b3RlZCxEPW4uZGVidWchPT0hMTtEJiYobD1uLmRlYnVnPT09ITA/IiI6bi5kZWJ1Zyk7dmFyIG09W10sdj1bXSxfPXt9O3JldHVybiBlLndhbGsobmV3IEEoZnVuY3Rpb24oZSl7ZSBpbnN0YW5jZW9mIGhuP2koZS5rZXksaCYmZS5xdW90ZSk6ZSBpbnN0YW5jZW9mIGRuP2koZS5rZXkubmFtZSk6ZSBpbnN0YW5jZW9mIHRuP2koZS5wcm9wZXJ0eSk6ZSBpbnN0YW5jZW9mIHJuP3UoZS5wcm9wZXJ0eSxoKTplIGluc3RhbmNlb2Ygdm4mJmkoZS5uYW1lLm5hbWUpfSkpLGUudHJhbnNmb3JtKG5ldyBQKGZ1bmN0aW9uKGUpe2UgaW5zdGFuY2VvZiBobj9oJiZlLnF1b3RlfHwoZS5rZXk9byhlLmtleSkpOmUgaW5zdGFuY2VvZiBkbj9lLmtleS5uYW1lPW8oZS5rZXkubmFtZSk6ZSBpbnN0YW5jZW9mIHRuP2UucHJvcGVydHk9byhlLnByb3BlcnR5KTplIGluc3RhbmNlb2Ygcm4/aHx8KGUucHJvcGVydHk9YShlLnByb3BlcnR5KSk6ZSBpbnN0YW5jZW9mIHZuJiZyKGUubmFtZS5uYW1lKSYmKGUubmFtZS5uYW1lPW8oZS5uYW1lLm5hbWUpKX0pKX1hLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSksYS5wcm90b3R5cGUuY29uc3RydWN0b3I9YSxhLmNyb2FrPWZ1bmN0aW9uKGUsbil7dGhyb3cgbmV3IGEoZSxuKX07dmFyIEo9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsbyx1KXtmdW5jdGlvbiBhKCl7dmFyIGE9byhlW3NdLHMpLGw9YSBpbnN0YW5jZW9mIHI7cmV0dXJuIGwmJihhPWEudiksYSBpbnN0YW5jZW9mIG4/KGE9YS52LGEgaW5zdGFuY2VvZiB0P2YucHVzaC5hcHBseShmLHU/YS52LnNsaWNlKCkucmV2ZXJzZSgpOmEudik6Zi5wdXNoKGEpKTphIT09aSYmKGEgaW5zdGFuY2VvZiB0P2MucHVzaC5hcHBseShjLHU/YS52LnNsaWNlKCkucmV2ZXJzZSgpOmEudik6Yy5wdXNoKGEpKSxsfXZhciBzLGM9W10sZj1bXTtpZihlIGluc3RhbmNlb2YgQXJyYXkpaWYodSl7Zm9yKHM9ZS5sZW5ndGg7LS1zPj0wJiYhYSgpOyk7Yy5yZXZlcnNlKCksZi5yZXZlcnNlKCl9ZWxzZSBmb3Iocz0wO3M8ZS5sZW5ndGgmJiFhKCk7KytzKTtlbHNlIGZvcihzIGluIGUpaWYoeShlLHMpJiZhKCkpYnJlYWs7cmV0dXJuIGYuY29uY2F0KGMpfWZ1bmN0aW9uIG4oZSl7dGhpcy52PWV9ZnVuY3Rpb24gdChlKXt0aGlzLnY9ZX1mdW5jdGlvbiByKGUpe3RoaXMudj1lfWUuYXRfdG9wPWZ1bmN0aW9uKGUpe3JldHVybiBuZXcgbihlKX0sZS5zcGxpY2U9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyB0KGUpfSxlLmxhc3Q9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyByKGUpfTt2YXIgaT1lLnNraXA9e307cmV0dXJuIGV9KCk7Zy5wcm90b3R5cGU9e3NldDpmdW5jdGlvbihlLG4pe3JldHVybiB0aGlzLmhhcyhlKXx8Kyt0aGlzLl9zaXplLHRoaXMuX3ZhbHVlc1siJCIrZV09bix0aGlzfSxhZGQ6ZnVuY3Rpb24oZSxuKXtyZXR1cm4gdGhpcy5oYXMoZSk/dGhpcy5nZXQoZSkucHVzaChuKTp0aGlzLnNldChlLFtuXSksdGhpc30sZ2V0OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl92YWx1ZXNbIiQiK2VdfSxkZWw6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaGFzKGUpJiYoLS10aGlzLl9zaXplLGRlbGV0ZSB0aGlzLl92YWx1ZXNbIiQiK2VdKSx0aGlzfSxoYXM6ZnVuY3Rpb24oZSl7cmV0dXJuIiQiK2UgaW4gdGhpcy5fdmFsdWVzfSxlYWNoOmZ1bmN0aW9uKGUpe2Zvcih2YXIgbiBpbiB0aGlzLl92YWx1ZXMpZSh0aGlzLl92YWx1ZXNbbl0sbi5zdWJzdHIoMSkpfSxzaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NpemV9LG1hcDpmdW5jdGlvbihlKXt2YXIgbj1bXTtmb3IodmFyIHQgaW4gdGhpcy5fdmFsdWVzKW4ucHVzaChlKHRoaXMuX3ZhbHVlc1t0XSx0LnN1YnN0cigxKSkpO3JldHVybiBufSx0b09iamVjdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl92YWx1ZXN9fSxnLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7dmFyIG49bmV3IGc7cmV0dXJuIG4uX3NpemU9YyhuLl92YWx1ZXMsZSksbn07dmFyIFo9YigiVG9rZW4iLCJ0eXBlIHZhbHVlIGxpbmUgY29sIHBvcyBlbmRsaW5lIGVuZGNvbCBlbmRwb3MgbmxiIGNvbW1lbnRzX2JlZm9yZSBmaWxlIHJhdyIse30sbnVsbCksSz1iKCJOb2RlIiwic3RhcnQgZW5kIix7Y2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHRoaXMuQ1RPUih0aGlzKX0sJGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3Mgb2YgYWxsIEFTVCBub2RlcyIsJHByb3Bkb2M6e3N0YXJ0OiJbQVNUX1Rva2VuXSBUaGUgZmlyc3QgdG9rZW4gb2YgdGhpcyBub2RlIixlbmQ6IltBU1RfVG9rZW5dIFRoZSBsYXN0IHRva2VuIG9mIHRoaXMgbm9kZSJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzKX0sd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fd2FsayhlKX19LG51bGwpO0sud2Fybl9mdW5jdGlvbj1udWxsLEsud2Fybj1mdW5jdGlvbihlLG4pe0sud2Fybl9mdW5jdGlvbiYmSy53YXJuX2Z1bmN0aW9uKGgoZSxuKSl9O3ZhciBRPWIoIlN0YXRlbWVudCIsbnVsbCx7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3Mgb2YgYWxsIHN0YXRlbWVudHMifSksZWU9YigiRGVidWdnZXIiLG51bGwseyRkb2N1bWVudGF0aW9uOiJSZXByZXNlbnRzIGEgZGVidWdnZXIgc3RhdGVtZW50In0sUSksbmU9YigiRGlyZWN0aXZlIiwidmFsdWUgc2NvcGUgcXVvdGUiLHskZG9jdW1lbnRhdGlvbjonUmVwcmVzZW50cyBhIGRpcmVjdGl2ZSwgbGlrZSAidXNlIHN0cmljdCI7JywkcHJvcGRvYzp7dmFsdWU6IltzdHJpbmddIFRoZSB2YWx1ZSBvZiB0aGlzIGRpcmVjdGl2ZSBhcyBhIHBsYWluIHN0cmluZyAoaXQncyBub3QgYW4gQVNUX1N0cmluZyEpIixzY29wZToiW0FTVF9TY29wZS9TXSBUaGUgc2NvcGUgdGhhdCB0aGlzIGRpcmVjdGl2ZSBhZmZlY3RzIixxdW90ZToiW3N0cmluZ10gdGhlIG9yaWdpbmFsIHF1b3RlIGNoYXJhY3RlciJ9fSxRKSx0ZT1iKCJTaW1wbGVTdGF0ZW1lbnQiLCJib2R5Iix7JGRvY3VtZW50YXRpb246IkEgc3RhdGVtZW50IGNvbnNpc3Rpbmcgb2YgYW4gZXhwcmVzc2lvbiwgaS5lLiBhID0gMSArIDIiLCRwcm9wZG9jOntib2R5OiJbQVNUX05vZGVdIGFuIGV4cHJlc3Npb24gbm9kZSAoc2hvdWxkIG5vdCBiZSBpbnN0YW5jZW9mIEFTVF9TdGF0ZW1lbnQpIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmJvZHkuX3dhbGsoZSl9KX19LFEpLHJlPWIoIkJsb2NrIiwiYm9keSIseyRkb2N1bWVudGF0aW9uOiJBIGJvZHkgb2Ygc3RhdGVtZW50cyAodXN1YWxseSBicmFja2V0ZWQpIiwkcHJvcGRvYzp7Ym9keToiW0FTVF9TdGF0ZW1lbnQqXSBhbiBhcnJheSBvZiBzdGF0ZW1lbnRzIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXtFKHRoaXMsZSl9KX19LFEpLGllPWIoIkJsb2NrU3RhdGVtZW50IixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBibG9jayBzdGF0ZW1lbnQifSxyZSksb2U9YigiRW1wdHlTdGF0ZW1lbnQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJUaGUgZW1wdHkgc3RhdGVtZW50IChlbXB0eSBibG9jayBvciBzaW1wbHkgYSBzZW1pY29sb24pIixfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyl9fSxRKSx1ZT1iKCJTdGF0ZW1lbnRXaXRoQm9keSIsImJvZHkiLHskZG9jdW1lbnRhdGlvbjoiQmFzZSBjbGFzcyBmb3IgYWxsIHN0YXRlbWVudHMgdGhhdCBjb250YWluIG9uZSBuZXN0ZWQgYm9keTogYEZvcmAsIGBGb3JJbmAsIGBEb2AsIGBXaGlsZWAsIGBXaXRoYCIsJHByb3Bkb2M6e2JvZHk6IltBU1RfU3RhdGVtZW50XSB0aGUgYm9keTsgdGhpcyBzaG91bGQgYWx3YXlzIGJlIHByZXNlbnQsIGV2ZW4gaWYgaXQncyBhbiBBU1RfRW1wdHlTdGF0ZW1lbnQifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMuYm9keS5fd2FsayhlKX0pfX0sUSksYWU9YigiTGFiZWxlZFN0YXRlbWVudCIsImxhYmVsIix7JGRvY3VtZW50YXRpb246IlN0YXRlbWVudCB3aXRoIGEgbGFiZWwiLCRwcm9wZG9jOntsYWJlbDoiW0FTVF9MYWJlbF0gYSBsYWJlbCBkZWZpbml0aW9uIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmxhYmVsLl93YWxrKGUpLHRoaXMuYm9keS5fd2FsayhlKX0pfX0sdWUpLHNlPWIoIkl0ZXJhdGlvblN0YXRlbWVudCIsbnVsbCx7JGRvY3VtZW50YXRpb246IkludGVybmFsIGNsYXNzLiAgQWxsIGxvb3BzIGluaGVyaXQgZnJvbSBpdC4ifSx1ZSksY2U9YigiRFdMb29wIiwiY29uZGl0aW9uIix7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGRvL3doaWxlIHN0YXRlbWVudHMiLCRwcm9wZG9jOntjb25kaXRpb246IltBU1RfTm9kZV0gdGhlIGxvb3AgY29uZGl0aW9uLiAgU2hvdWxkIG5vdCBiZSBpbnN0YW5jZW9mIEFTVF9TdGF0ZW1lbnQifX0sc2UpLGZlPWIoIkRvIixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBgZG9gIHN0YXRlbWVudCIsX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmJvZHkuX3dhbGsoZSksdGhpcy5jb25kaXRpb24uX3dhbGsoZSl9KX19LGNlKSxsZT1iKCJXaGlsZSIsbnVsbCx7JGRvY3VtZW50YXRpb246IkEgYHdoaWxlYCBzdGF0ZW1lbnQiLF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5jb25kaXRpb24uX3dhbGsoZSksdGhpcy5ib2R5Ll93YWxrKGUpfSl9fSxjZSkscGU9YigiRm9yIiwiaW5pdCBjb25kaXRpb24gc3RlcCIseyRkb2N1bWVudGF0aW9uOiJBIGBmb3JgIHN0YXRlbWVudCIsJHByb3Bkb2M6e2luaXQ6IltBU1RfTm9kZT9dIHRoZSBgZm9yYCBpbml0aWFsaXphdGlvbiBjb2RlLCBvciBudWxsIGlmIGVtcHR5Iixjb25kaXRpb246IltBU1RfTm9kZT9dIHRoZSBgZm9yYCB0ZXJtaW5hdGlvbiBjbGF1c2UsIG9yIG51bGwgaWYgZW1wdHkiLHN0ZXA6IltBU1RfTm9kZT9dIHRoZSBgZm9yYCB1cGRhdGUgY2xhdXNlLCBvciBudWxsIGlmIGVtcHR5In0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmluaXQmJnRoaXMuaW5pdC5fd2FsayhlKSx0aGlzLmNvbmRpdGlvbiYmdGhpcy5jb25kaXRpb24uX3dhbGsoZSksdGhpcy5zdGVwJiZ0aGlzLnN0ZXAuX3dhbGsoZSksdGhpcy5ib2R5Ll93YWxrKGUpfSl9fSxzZSksZGU9YigiRm9ySW4iLCJpbml0IG5hbWUgb2JqZWN0Iix7JGRvY3VtZW50YXRpb246IkEgYGZvciAuLi4gaW5gIHN0YXRlbWVudCIsJHByb3Bkb2M6e2luaXQ6IltBU1RfTm9kZV0gdGhlIGBmb3IvaW5gIGluaXRpYWxpemF0aW9uIGNvZGUiLG5hbWU6IltBU1RfU3ltYm9sUmVmP10gdGhlIGxvb3AgdmFyaWFibGUsIG9ubHkgaWYgYGluaXRgIGlzIEFTVF9WYXIiLG9iamVjdDoiW0FTVF9Ob2RlXSB0aGUgb2JqZWN0IHRoYXQgd2UncmUgbG9vcGluZyB0aHJvdWdoIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmluaXQuX3dhbGsoZSksdGhpcy5vYmplY3QuX3dhbGsoZSksdGhpcy5ib2R5Ll93YWxrKGUpfSl9fSxzZSksaGU9YigiRm9yT2YiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGBmb3IgLi4uIG9mYCBzdGF0ZW1lbnQifSxkZSksRGU9YigiV2l0aCIsImV4cHJlc3Npb24iLHskZG9jdW1lbnRhdGlvbjoiQSBgd2l0aGAgc3RhdGVtZW50IiwkcHJvcGRvYzp7ZXhwcmVzc2lvbjoiW0FTVF9Ob2RlXSB0aGUgYHdpdGhgIGV4cHJlc3Npb24ifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMuZXhwcmVzc2lvbi5fd2FsayhlKSx0aGlzLmJvZHkuX3dhbGsoZSl9KX19LHVlKSxtZT1iKCJTY29wZSIsImRpcmVjdGl2ZXMgdmFyaWFibGVzIGZ1bmN0aW9ucyB1c2VzX3dpdGggdXNlc19ldmFsIHBhcmVudF9zY29wZSBlbmNsb3NlZCBjbmFtZSIseyRkb2N1bWVudGF0aW9uOiJCYXNlIGNsYXNzIGZvciBhbGwgc3RhdGVtZW50cyBpbnRyb2R1Y2luZyBhIGxleGljYWwgc2NvcGUiLCRwcm9wZG9jOntkaXJlY3RpdmVzOiJbc3RyaW5nKi9TXSBhbiBhcnJheSBvZiBkaXJlY3RpdmVzIGRlY2xhcmVkIGluIHRoaXMgc2NvcGUiLHZhcmlhYmxlczoiW09iamVjdC9TXSBhIG1hcCBvZiBuYW1lIC0+IFN5bWJvbERlZiBmb3IgYWxsIHZhcmlhYmxlcy9mdW5jdGlvbnMgZGVmaW5lZCBpbiB0aGlzIHNjb3BlIixmdW5jdGlvbnM6IltPYmplY3QvU10gbGlrZSBgdmFyaWFibGVzYCwgYnV0IG9ubHkgbGlzdHMgZnVuY3Rpb24gZGVjbGFyYXRpb25zIix1c2VzX3dpdGg6Iltib29sZWFuL1NdIHRlbGxzIHdoZXRoZXIgdGhpcyBzY29wZSB1c2VzIHRoZSBgd2l0aGAgc3RhdGVtZW50Iix1c2VzX2V2YWw6Iltib29sZWFuL1NdIHRlbGxzIHdoZXRoZXIgdGhpcyBzY29wZSBjb250YWlucyBhIGRpcmVjdCBjYWxsIHRvIHRoZSBnbG9iYWwgYGV2YWxgIixwYXJlbnRfc2NvcGU6IltBU1RfU2NvcGU/L1NdIGxpbmsgdG8gdGhlIHBhcmVudCBzY29wZSIsZW5jbG9zZWQ6IltTeW1ib2xEZWYqL1NdIGEgbGlzdCBvZiBhbGwgc3ltYm9sIGRlZmluaXRpb25zIHRoYXQgYXJlIGFjY2Vzc2VkIGZyb20gdGhpcyBzY29wZSBvciBhbnkgc3Vic2NvcGVzIixjbmFtZToiW2ludGVnZXIvU10gY3VycmVudCBpbmRleCBmb3IgbWFuZ2xpbmcgdmFyaWFibGVzICh1c2VkIGludGVybmFsbHkgYnkgdGhlIG1hbmdsZXIpIn0sZ2V0X2RlZnVuX3Njb3BlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXM7ZS5pc19ibG9ja19zY29wZSgpJiZlLnBhcmVudF9zY29wZTspZT1lLnBhcmVudF9zY29wZTtyZXR1cm4gZX19LHJlKSx2ZT1iKCJUb3BsZXZlbCIsImdsb2JhbHMiLHskZG9jdW1lbnRhdGlvbjoiVGhlIHRvcGxldmVsIHNjb3BlIiwkcHJvcGRvYzp7Z2xvYmFsczoiW09iamVjdC9TXSBhIG1hcCBvZiBuYW1lIC0+IFN5bWJvbERlZiBmb3IgYWxsIHVuZGVjbGFyZWQgbmFtZXMifSx3cmFwX2VuY2xvc2U6ZnVuY3Rpb24oZSl7dmFyIG49dGhpcyx0PVtdLHI9W107ZS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3ZhciBuPWUubGFzdEluZGV4T2YoIjoiKTt0LnB1c2goZS5zdWJzdHIoMCxuKSksci5wdXNoKGUuc3Vic3RyKG4rMSkpfSk7dmFyIGk9IihmdW5jdGlvbigiK3Iuam9pbigiLCIpKyIpeyAnJE9SSUcnOyB9KSgiK3Quam9pbigiLCIpKyIpIjtyZXR1cm4gaT1JKGkpLGk9aS50cmFuc2Zvcm0obmV3IFAoZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mIG5lJiYiJE9SSUciPT1lLnZhbHVlKXJldHVybiBKLnNwbGljZShuLmJvZHkpfSkpfSx3cmFwX2NvbW1vbmpzOmZ1bmN0aW9uKGUsbil7dmFyIHQ9dGhpcyxyPVtdO24mJih0LmZpZ3VyZV9vdXRfc2NvcGUoKSx0LndhbGsobmV3IEEoZnVuY3Rpb24oZSl7ZSBpbnN0YW5jZW9mIEZuJiZlLmRlZmluaXRpb24oKS5nbG9iYWwmJihvKGZ1bmN0aW9uKG4pe3JldHVybiBuLm5hbWU9PWUubmFtZX0scil8fHIucHVzaChlKSl9KSkpO3ZhciBpPSIoZnVuY3Rpb24oZXhwb3J0cywgZ2xvYmFsKXsgJyRPUklHJzsgJyRFWFBPUlRTJzsgZ2xvYmFsWyciK2UrIiddID0gZXhwb3J0czsgfSh7fSwgKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCkpKSkiO3JldHVybiBpPUkoaSksaT1pLnRyYW5zZm9ybShuZXcgUChmdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgbmUpc3dpdGNoKGUudmFsdWUpe2Nhc2UiJE9SSUciOnJldHVybiBKLnNwbGljZSh0LmJvZHkpO2Nhc2UiJEVYUE9SVFMiOnZhciBuPVtdO3JldHVybiByLmZvckVhY2goZnVuY3Rpb24oZSl7bi5wdXNoKG5ldyB0ZSh7Ym9keTpuZXcgZm4oe2xlZnQ6bmV3IHJuKHtleHByZXNzaW9uOm5ldyBIbih7bmFtZToiZXhwb3J0cyJ9KSxwcm9wZXJ0eTpuZXcgTG4oe3ZhbHVlOmUubmFtZX0pfSksb3BlcmF0b3I6Ij0iLHJpZ2h0Om5ldyBIbihlKX0pfSkpfSksSi5zcGxpY2Uobil9fSkpfX0sbWUpLF9lPWIoIkV4cGFuc2lvbiIsImV4cHJlc3Npb24iLHskZG9jdW1lbnRhdGlvbjoiQW4gZXhwYW5kaWJsZSBhcmd1bWVudCwgc3VjaCBhcyAuLi5yZXN0LCBhIHNwbGF0LCBzdWNoIGFzIFsxLDIsLi4uYWxsXSwgb3IgYW4gZXhwYW5zaW9uIGluIGEgdmFyaWFibGUgZGVjbGFyYXRpb24sIHN1Y2ggYXMgdmFyIFtmaXJzdCwgLi4ucmVzdF0gPSBsaXN0IiwkcHJvcGRvYzp7ZXhwcmVzc2lvbjoiQVNUX1N5bWJvbCB0aGUgdGhpbmcgdG8gYmUgZXhwYW5kZWQifSxfd2FsazpmdW5jdGlvbihlKXt2YXIgbj10aGlzO3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7bi5leHByZXNzaW9uLndhbGsoZSl9KX19KSxnZT1iKCJBcnJvd1BhcmFtZXRlcnNPclNlcSIsImV4cHJlc3Npb25zIix7JGRvY3VtZW50YXRpb246J0Egc2V0IG9mIGFycm93IGZ1bmN0aW9uIHBhcmFtZXRlcnMgb3IgYSBzZXF1ZW5jZSBleHByZXNzaW9uLiBUaGlzIGlzIHVzZWQgYmVjYXVzZSB3aGVuIHRoZSBwYXJzZXIgc2VlcyBhICIoIiBpdCBjb3VsZCBiZSB0aGUgc3RhcnQgb2YgYSBzZXEsIG9yIHRoZSBzdGFydCBvZiBhIHBhcmFtZXRlciBsaXN0IG9mIGFuIGFycm93IGZ1bmN0aW9uLicsJHByb3Bkb2M6e2V4cHJlc3Npb25zOiJbQVNUX0V4cHJlc3Npb258QVNUX0Rlc3RydWN0dXJpbmd8QVNUX0V4cGFuc2lvbipdIGFycmF5IG9mIGV4cHJlc3Npb25zIG9yIGFyZ3VtZW50IG5hbWVzIG9yIGRlc3RydWN0dXJpbmdzLiJ9LGFzX3BhcmFtczpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5leHByZXNzaW9ucy5tYXAoZnVuY3Rpb24gbih0LHIsaSxvKXtyZXR1cm4gdCBpbnN0YW5jZW9mIHBuP25ldyB3ZSh7c3RhcnQ6dC5zdGFydCxlbmQ6dC5lbmQsaXNfYXJyYXk6ITEsZGVmYXVsdDpvLG5hbWVzOnQucHJvcGVydGllcy5tYXAobil9KTp0IGluc3RhbmNlb2YgaG4/KHQua2V5IGluc3RhbmNlb2YgSG4mJih0LmtleT1uKHQua2V5LDAsW3Qua2V5XSx0LmRlZmF1bHQpKSx0LnZhbHVlPW4odC52YWx1ZSwwLFt0LmtleV0sdC5kZWZhdWx0KSx0KTp0IGluc3RhbmNlb2YgWm4/dDp0IGluc3RhbmNlb2Ygd2U/KDA9PXQubmFtZXMubGVuZ3RoJiZlKCJJbnZhbGlkIGRlc3RydWN0dXJpbmcgZnVuY3Rpb24gcGFyYW1ldGVyIix0LnN0YXJ0LmxpbmUsdC5zdGFydC5jb2wpLHQubmFtZXM9dC5uYW1lcy5tYXAobiksdCk6dCBpbnN0YW5jZW9mIEhuP25ldyBCbih7bmFtZTp0Lm5hbWUsZGVmYXVsdDpvLHN0YXJ0OnQuc3RhcnQsZW5kOnQuZW5kfSk6dCBpbnN0YW5jZW9mIF9lP3Q6dCBpbnN0YW5jZW9mIGxuP25ldyB3ZSh7c3RhcnQ6dC5zdGFydCxlbmQ6dC5lbmQsaXNfYXJyYXk6ITAsZGVmYXVsdDpvLG5hbWVzOnQuZWxlbWVudHMubWFwKG4pfSk6dCBpbnN0YW5jZW9mIGZuP24odC5sZWZ0LHZvaWQgMCx2b2lkIDAsdC5yaWdodCk6dm9pZCBlKCJJbnZhbGlkIGZ1bmN0aW9uIHBhcmFtZXRlciIsdC5zdGFydC5saW5lLHQuc3RhcnQuY29sKX0pfSxhc19leHByOmZ1bmN0aW9uKGUpe3JldHVybiBlbi5mcm9tX2FycmF5KHRoaXMuZXhwcmVzc2lvbnMpfX0pLHllPWIoIkxhbWJkYSIsIm5hbWUgYXJnbmFtZXMgdXNlc19hcmd1bWVudHMgaXNfZ2VuZXJhdG9yIix7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGZ1bmN0aW9ucyIsJHByb3Bkb2M6e2lzX2dlbmVyYXRvcjoiW2Jvb2xlYW5dIGlzIGdlbmVyYXRvckZuIG9yIG5vdCIsbmFtZToiW0FTVF9TeW1ib2xEZWNsYXJhdGlvbj9dIHRoZSBuYW1lIG9mIHRoaXMgZnVuY3Rpb24iLGFyZ25hbWVzOiJbQVNUX1N5bWJvbEZ1bmFyZ3xBU1RfRGVzdHJ1Y3R1cmluZ3xBU1RfRXhwYW5zaW9uKl0gYXJyYXkgb2YgZnVuY3Rpb24gYXJndW1lbnRzLCBkZXN0cnVjdHVyaW5ncywgb3IgZXhwYW5kaW5nIGFyZ3VtZW50cyIsdXNlc19hcmd1bWVudHM6Iltib29sZWFuL1NdIHRlbGxzIHdoZXRoZXIgdGhpcyBmdW5jdGlvbiBhY2Nlc3NlcyB0aGUgYXJndW1lbnRzIGFycmF5In0sYXJnc19hc19uYW1lczpmdW5jdGlvbigpe2Zvcih2YXIgZT1bXSxuPTA7bjx0aGlzLmFyZ25hbWVzLmxlbmd0aDtuKyspdGhpcy5hcmduYW1lc1tuXWluc3RhbmNlb2Ygd2U/ZT1lLmNvbmNhdCh0aGlzLmFyZ25hbWVzW25dLmFsbF9zeW1ib2xzKCkpOmUucHVzaCh0aGlzLmFyZ25hbWVzW25dKTtyZXR1cm4gZX0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLm5hbWUmJnRoaXMubmFtZS5fd2FsayhlKSx0aGlzLmFyZ25hbWVzLmZvckVhY2goZnVuY3Rpb24obil7bi5fd2FsayhlKX0pLEUodGhpcyxlKX0pfX0sbWUpLGJlPWIoIkFjY2Vzc29yIixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBzZXR0ZXIvZ2V0dGVyIGZ1bmN0aW9uLiAgVGhlIGBuYW1lYCBwcm9wZXJ0eSBpcyBhbHdheXMgbnVsbC4ifSx5ZSksRWU9YigiRnVuY3Rpb24iLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGZ1bmN0aW9uIGV4cHJlc3Npb24ifSx5ZSksQWU9YigiQXJyb3ciLG51bGwseyRkb2N1bWVudGF0aW9uOiJBbiBFUzYgQXJyb3cgZnVuY3Rpb24gKChhKSA9PiBiKSJ9LHllKSxGZT1iKCJEZWZ1biIsbnVsbCx7JGRvY3VtZW50YXRpb246IkEgZnVuY3Rpb24gZGVmaW5pdGlvbiJ9LHllKSx3ZT1iKCJEZXN0cnVjdHVyaW5nIiwibmFtZXMgaXNfYXJyYXkgZGVmYXVsdCIseyRkb2N1bWVudGF0aW9uOiJBIGRlc3RydWN0dXJpbmcgb2Ygc2V2ZXJhbCBuYW1lcy4gVXNlZCBpbiBkZXN0cnVjdHVyaW5nIGFzc2lnbm1lbnQgYW5kIHdpdGggZGVzdHJ1Y3R1cmluZyBmdW5jdGlvbiBhcmd1bWVudCBuYW1lcyIsJHByb3Bkb2M6e25hbWVzOiJbQVNUX0Rlc3RydWN0dXJpbmd8QVNUX0V4cGFuc2lvbnxBU1RfSG9sZXxBU1RfT2JqZWN0S2V5VmFsfEFTVF9TeW1ib2xdIEFycmF5IG9mIHByb3BlcnRpZXMgb3IgZWxlbWVudHMiLGlzX2FycmF5OiJbQm9vbGVhbl0gV2hldGhlciB0aGUgZGVzdHJ1Y3R1cmluZyByZXByZXNlbnRzIGFuIG9iamVjdCBvciBhcnJheSIsZGVmYXVsdDoiW0FTVF9Ob2RlP10gRGVmYXVsdCBhc3NpZ24gdmFsdWUifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMubmFtZXMuZm9yRWFjaChmdW5jdGlvbihuKXtuLl93YWxrKGUpfSl9KX0sYWxsX3N5bWJvbHM6ZnVuY3Rpb24oKXt2YXIgZT1bXTtyZXR1cm4gdGhpcy53YWxrKG5ldyBBKGZ1bmN0aW9uKG4pe24gaW5zdGFuY2VvZiBibiYmZS5wdXNoKG4pLG4gaW5zdGFuY2VvZiBfZSYmZS5wdXNoKG4uZXhwcmVzc2lvbil9KSksZX19KSxDZT1iKCJQcmVmaXhlZFRlbXBsYXRlU3RyaW5nIiwidGVtcGxhdGVfc3RyaW5nIHByZWZpeCIseyRkb2N1bWVudGF0aW9uOiJBIHRlbXBsYXRlc3RyaW5nIHdpdGggYSBwcmVmaXgsIHN1Y2ggYXMgU3RyaW5nLnJhd2Bmb29iYXJiYXpgIiwkcHJvcGRvYzp7dGVtcGxhdGVfc3RyaW5nOiJbQVNUX1RlbXBsYXRlU3RyaW5nXSBUaGUgdGVtcGxhdGUgc3RyaW5nIixwcmVmaXg6IltBU1RfU3ltYm9sUmVmfEFTVF9Qcm9wQWNjZXNzXSBUaGUgcHJlZml4LCB3aGljaCBjYW4gYmUgYSBzeW1ib2wgc3VjaCBhcyBgZm9vYCBvciBhIGRvdHRlZCBleHByZXNzaW9uIHN1Y2ggYXMgYFN0cmluZy5yYXdgLiJ9LF93YWxrOmZ1bmN0aW9uKGUpe3RoaXMucHJlZml4Ll93YWxrKGUpLHRoaXMudGVtcGxhdGVfc3RyaW5nLl93YWxrKGUpfX0pLGtlPWIoIlRlbXBsYXRlU3RyaW5nIiwic2VnbWVudHMiLHskZG9jdW1lbnRhdGlvbjoiQSB0ZW1wbGF0ZSBzdHJpbmcgbGl0ZXJhbCIsJHByb3Bkb2M6e3NlZ21lbnRzOiJbQVNUX1RlbXBsYXRlU2VnbWVudHxBU1RfRXhwcmVzc2lvbl0qIE9uZSBvciBtb3JlIHNlZ21lbnRzLCBzdGFydGluZyB3aXRoIEFTVF9UZW1wbGF0ZVNlZ21lbnQuIEFTVF9FeHByZXNzaW9uIG1heSBmb2xsb3cgQVNUX1RlbXBsYXRlU2VnbWVudCwgYnV0IGVhY2ggQVNUX0V4cHJlc3Npb24gbXVzdCBiZSBmb2xsb3dlZCBieSBBU1RfVGVtcGxhdGVTZWdtZW50LiJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5zZWdtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dCUyIT09MCYmbi5fd2FsayhlKX0pfSl9fSkseGU9YigiVGVtcGxhdGVTZWdtZW50IiwidmFsdWUgcmF3Iix7JGRvY3VtZW50YXRpb246IkEgc2VnbWVudCBvZiBhIHRlbXBsYXRlIHN0cmluZyBsaXRlcmFsIiwkcHJvcGRvYzp7dmFsdWU6IkNvbnRlbnQgb2YgdGhlIHNlZ21lbnQiLHJhdzoiUmF3IGNvbnRlbnQgb2YgdGhlIHNlZ21lbnQifX0pLEJlPWIoIkp1bXAiLG51bGwseyRkb2N1bWVudGF0aW9uOiJCYXNlIGNsYXNzIGZvciDigJxqdW1wc+KAnSAoZm9yIG5vdyB0aGF0J3MgYHJldHVybmAsIGB0aHJvd2AsIGBicmVha2AgYW5kIGBjb250aW51ZWApIn0sUSksU2U9YigiRXhpdCIsInZhbHVlIix7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIOKAnGV4aXRz4oCdIChgcmV0dXJuYCBhbmQgYHRocm93YCkiLCRwcm9wZG9jOnt2YWx1ZToiW0FTVF9Ob2RlP10gdGhlIHZhbHVlIHJldHVybmVkIG9yIHRocm93biBieSB0aGlzIHN0YXRlbWVudDsgY291bGQgYmUgbnVsbCBmb3IgQVNUX1JldHVybiJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLHRoaXMudmFsdWUmJmZ1bmN0aW9uKCl7dGhpcy52YWx1ZS5fd2FsayhlKX0pfX0sQmUpLFRlPWIoIlJldHVybiIsbnVsbCx7JGRvY3VtZW50YXRpb246IkEgYHJldHVybmAgc3RhdGVtZW50In0sU2UpLCRlPWIoIlRocm93IixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBgdGhyb3dgIHN0YXRlbWVudCJ9LFNlKSxPZT1iKCJMb29wQ29udHJvbCIsImxhYmVsIix7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGxvb3AgY29udHJvbCBzdGF0ZW1lbnRzIChgYnJlYWtgIGFuZCBgY29udGludWVgKSIsJHByb3Bkb2M6e2xhYmVsOiJbQVNUX0xhYmVsUmVmP10gdGhlIGxhYmVsLCBvciBudWxsIGlmIG5vbmUifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyx0aGlzLmxhYmVsJiZmdW5jdGlvbigpe3RoaXMubGFiZWwuX3dhbGsoZSl9KX19LEJlKSxxZT1iKCJCcmVhayIsbnVsbCx7JGRvY3VtZW50YXRpb246IkEgYGJyZWFrYCBzdGF0ZW1lbnQifSxPZSksTWU9YigiQ29udGludWUiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGBjb250aW51ZWAgc3RhdGVtZW50In0sT2UpLHplPWIoIklmIiwiY29uZGl0aW9uIGFsdGVybmF0aXZlIix7JGRvY3VtZW50YXRpb246IkEgYGlmYCBzdGF0ZW1lbnQiLCRwcm9wZG9jOntjb25kaXRpb246IltBU1RfTm9kZV0gdGhlIGBpZmAgY29uZGl0aW9uIixhbHRlcm5hdGl2ZToiW0FTVF9TdGF0ZW1lbnQ/XSB0aGUgYGVsc2VgIHBhcnQsIG9yIG51bGwgaWYgbm90IHByZXNlbnQifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMuY29uZGl0aW9uLl93YWxrKGUpLHRoaXMuYm9keS5fd2FsayhlKSx0aGlzLmFsdGVybmF0aXZlJiZ0aGlzLmFsdGVybmF0aXZlLl93YWxrKGUpfSl9fSx1ZSksTmU9YigiU3dpdGNoIiwiZXhwcmVzc2lvbiIseyRkb2N1bWVudGF0aW9uOiJBIGBzd2l0Y2hgIHN0YXRlbWVudCIsJHByb3Bkb2M6e2V4cHJlc3Npb246IltBU1RfTm9kZV0gdGhlIGBzd2l0Y2hgIOKAnGRpc2NyaW1pbmFudOKAnSJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5leHByZXNzaW9uLl93YWxrKGUpLEUodGhpcyxlKX0pfX0scmUpLGplPWIoIlN3aXRjaEJyYW5jaCIsbnVsbCx7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGBzd2l0Y2hgIGJyYW5jaGVzIn0scmUpLEhlPWIoIkRlZmF1bHQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGBkZWZhdWx0YCBzd2l0Y2ggYnJhbmNoIn0samUpLEllPWIoIkNhc2UiLCJleHByZXNzaW9uIix7JGRvY3VtZW50YXRpb246IkEgYGNhc2VgIHN3aXRjaCBicmFuY2giLCRwcm9wZG9jOntleHByZXNzaW9uOiJbQVNUX05vZGVdIHRoZSBgY2FzZWAgZXhwcmVzc2lvbiJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5leHByZXNzaW9uLl93YWxrKGUpLEUodGhpcyxlKX0pfX0samUpLFBlPWIoIlRyeSIsImJjYXRjaCBiZmluYWxseSIseyRkb2N1bWVudGF0aW9uOiJBIGB0cnlgIHN0YXRlbWVudCIsJHByb3Bkb2M6e2JjYXRjaDoiW0FTVF9DYXRjaD9dIHRoZSBjYXRjaCBibG9jaywgb3IgbnVsbCBpZiBub3QgcHJlc2VudCIsYmZpbmFsbHk6IltBU1RfRmluYWxseT9dIHRoZSBmaW5hbGx5IGJsb2NrLCBvciBudWxsIGlmIG5vdCBwcmVzZW50In0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXtFKHRoaXMsZSksdGhpcy5iY2F0Y2gmJnRoaXMuYmNhdGNoLl93YWxrKGUpLHRoaXMuYmZpbmFsbHkmJnRoaXMuYmZpbmFsbHkuX3dhbGsoZSl9KX19LHJlKSxVZT1iKCJDYXRjaCIsImFyZ25hbWUiLHskZG9jdW1lbnRhdGlvbjoiQSBgY2F0Y2hgIG5vZGU7IG9ubHkgbWFrZXMgc2Vuc2UgYXMgcGFydCBvZiBhIGB0cnlgIHN0YXRlbWVudCIsJHByb3Bkb2M6e2FyZ25hbWU6IltBU1RfU3ltYm9sQ2F0Y2hdIHN5bWJvbCBmb3IgdGhlIGV4Y2VwdGlvbiJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5hcmduYW1lLl93YWxrKGUpLEUodGhpcyxlKX0pfX0scmUpLFJlPWIoIkZpbmFsbHkiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGBmaW5hbGx5YCBub2RlOyBvbmx5IG1ha2VzIHNlbnNlIGFzIHBhcnQgb2YgYSBgdHJ5YCBzdGF0ZW1lbnQifSxyZSksTGU9YigiRGVmaW5pdGlvbnMiLCJkZWZpbml0aW9ucyIseyRkb2N1bWVudGF0aW9uOiJCYXNlIGNsYXNzIGZvciBgdmFyYCBvciBgY29uc3RgIG5vZGVzICh2YXJpYWJsZSBkZWNsYXJhdGlvbnMvaW5pdGlhbGl6YXRpb25zKSIsJHByb3Bkb2M6e2RlZmluaXRpb25zOiJbQVNUX1ZhckRlZipdIGFycmF5IG9mIHZhcmlhYmxlIGRlZmluaXRpb25zIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmRlZmluaXRpb25zLmZvckVhY2goZnVuY3Rpb24obil7bi5fd2FsayhlKX0pfSl9fSxRKSxWZT1iKCJWYXIiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGB2YXJgIHN0YXRlbWVudCJ9LExlKSxXZT1iKCJMZXQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGBsZXRgIHN0YXRlbWVudCJ9LExlKSxZZT1iKCJDb25zdCIsbnVsbCx7JGRvY3VtZW50YXRpb246IkEgYGNvbnN0YCBzdGF0ZW1lbnQifSxMZSksWGU9YigiTmFtZUltcG9ydCIsImZvcmVpZ25fbmFtZSBuYW1lIix7JGRvY3VtZW50YXRpb246IlRoZSBwYXJ0IG9mIHRoZSBpbXBvcnQgc3RhdGVtZW50IHRoYXQgaW1wb3J0cyBuYW1lcyBmcm9tIGEgbW9kdWxlLiIsJHByb3Bkb2M6e2ZvcmVpZ25fbmFtZToiW0FTVF9TeW1ib2xJbXBvcnRGb3JlaWduXSBUaGUgbmFtZSBiZWluZyBpbXBvcnRlZCAoYXMgc3BlY2lmaWVkIGluIHRoZSBtb2R1bGUpIixuYW1lOiJbQVNUX1N5bWJvbEltcG9ydF0gVGhlIG5hbWUgYXMgaXQgYmVjb21lcyBhdmFpbGFibGUgdG8gdGhpcyBtb2R1bGUuIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmZvcmVpZ25fbmFtZS5fd2FsayhlKSx0aGlzLm5hbWUuX3dhbGsoZSl9KX19KSxHZT1iKCJJbXBvcnQiLCJpbXBvcnRlZF9uYW1lIGltcG9ydGVkX25hbWVzIG1vZHVsZV9uYW1lIix7JGRvY3VtZW50YXRpb246IkFuIGBpbXBvcnRgIHN0YXRlbWVudCIsJHByb3Bkb2M6e2ltcG9ydGVkX25hbWU6IltBU1RfU3ltYm9sSW1wb3J0XSBUaGUgbmFtZSBvZiB0aGUgdmFyaWFibGUgaG9sZGluZyB0aGUgbW9kdWxlJ3MgZGVmYXVsdCBleHBvcnQuIixpbXBvcnRlZF9uYW1lczoiW0FTVF9OYW1lSW1wb3J0Kl0gVGhlIG5hbWVzIG9mIG5vbi1kZWZhdWx0IGltcG9ydGVkIHZhcmlhYmxlcyIsbW9kdWxlX25hbWU6IltBU1RfU3RyaW5nXSBTdHJpbmcgbGl0ZXJhbCBkZXNjcmliaW5nIHdoZXJlIHRoaXMgbW9kdWxlIGNhbWUgZnJvbSJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5pbXBvcnRlZF9uYW1lJiZ0aGlzLmltcG9ydGVkX25hbWUuX3dhbGsoZSksdGhpcy5pbXBvcnRlZF9uYW1lcyYmdGhpcy5pbXBvcnRlZF9uYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uX3dhbGsoZSl9KSx0aGlzLm1vZHVsZV9uYW1lLl93YWxrKGUpfSl9fSksSmU9YigiRXhwb3J0IiwiZXhwb3J0ZWRfZGVmaW5pdGlvbiBleHBvcnRlZF92YWx1ZSBpc19kZWZhdWx0Iix7JGRvY3VtZW50YXRpb246IkFuIGBleHBvcnRgIHN0YXRlbWVudCIsJHByb3Bkb2M6e2V4cG9ydGVkX2RlZmluaXRpb246IltBU1RfRGVmdW58QVNUX0RlZmluaXRpb25zfEFTVF9EZWZDbGFzcz9dIEFuIGV4cG9ydGVkIGRlZmluaXRpb24iLGV4cG9ydGVkX3ZhbHVlOiJbQVNUX05vZGU/XSBBbiBleHBvcnRlZCB2YWx1ZSIsaXNfZGVmYXVsdDoiW0Jvb2xlYW5dIFdoZXRoZXIgdGhpcyBpcyB0aGUgZGVmYXVsdCBleHBvcnRlZCB2YWx1ZSBvZiB0aGlzIG1vZHVsZSJ9LF93YWxrOmZ1bmN0aW9uKGUpe2UuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmV4cG9ydGVkX2RlZmluaXRpb24mJnRoaXMuZXhwb3J0ZWRfZGVmaW5pdGlvbi5fd2FsayhlKSx0aGlzLmV4cG9ydGVkX3ZhbHVlJiZ0aGlzLmV4cG9ydGVkX3ZhbHVlLl93YWxrKGUpfSl9fSxRKSxaZT1iKCJWYXJEZWYiLCJuYW1lIHZhbHVlIix7JGRvY3VtZW50YXRpb246IkEgdmFyaWFibGUgZGVjbGFyYXRpb247IG9ubHkgYXBwZWFycyBpbiBhIEFTVF9EZWZpbml0aW9ucyBub2RlIiwkcHJvcGRvYzp7bmFtZToiW0FTVF9TeW1ib2xWYXJ8QVNUX1N5bWJvbENvbnN0fEFTVF9EZXN0cnVjdHVyaW5nXSBuYW1lIG9mIHRoZSB2YXJpYWJsZSIsdmFsdWU6IltBU1RfTm9kZT9dIGluaXRpYWxpemVyLCBvciBudWxsIG9mIHRoZXJlJ3Mgbm8gaW5pdGlhbGl6ZXIifSxpc19kZXN0cnVjdHVyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmFtZSBpbnN0YW5jZW9mIHdlfSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMubmFtZS5fd2FsayhlKSx0aGlzLnZhbHVlJiZ0aGlzLnZhbHVlLl93YWxrKGUpfSl9fSksS2U9YigiQ2FsbCIsImV4cHJlc3Npb24gYXJncyIseyRkb2N1bWVudGF0aW9uOiJBIGZ1bmN0aW9uIGNhbGwgZXhwcmVzc2lvbiIsJHByb3Bkb2M6e2V4cHJlc3Npb246IltBU1RfTm9kZV0gZXhwcmVzc2lvbiB0byBpbnZva2UgYXMgZnVuY3Rpb24iLGFyZ3M6IltBU1RfTm9kZSpdIGFycmF5IG9mIGFyZ3VtZW50cyJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5leHByZXNzaW9uLl93YWxrKGUpLHRoaXMuYXJncy5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uX3dhbGsoZSl9KX0pfX0pLFFlPWIoIk5ldyIsbnVsbCx7JGRvY3VtZW50YXRpb246IkFuIG9iamVjdCBpbnN0YW50aWF0aW9uLiAgRGVyaXZlcyBmcm9tIGEgZnVuY3Rpb24gY2FsbCBzaW5jZSBpdCBoYXMgZXhhY3RseSB0aGUgc2FtZSBwcm9wZXJ0aWVzIn0sS2UpLGVuPWIoIlNlcSIsImNhciBjZHIiLHskZG9jdW1lbnRhdGlvbjoiQSBzZXF1ZW5jZSBleHByZXNzaW9uICh0d28gY29tbWEtc2VwYXJhdGVkIGV4cHJlc3Npb25zKSIsJHByb3Bkb2M6e2NhcjoiW0FTVF9Ob2RlXSBmaXJzdCBlbGVtZW50IGluIHNlcXVlbmNlIixjZHI6IltBU1RfTm9kZV0gc2Vjb25kIGVsZW1lbnQgaW4gc2VxdWVuY2UifSwkY29uczpmdW5jdGlvbihlLG4pe3ZhciB0PW5ldyBlbihlKTtyZXR1cm4gdC5jYXI9ZSx0LmNkcj1uLHR9LCRmcm9tX2FycmF5OmZ1bmN0aW9uKGUpe2lmKDA9PWUubGVuZ3RoKXJldHVybiBudWxsO2lmKDE9PWUubGVuZ3RoKXJldHVybiBlWzBdLmNsb25lKCk7Zm9yKHZhciBuPW51bGwsdD1lLmxlbmd0aDstLXQ+PTA7KW49ZW4uY29ucyhlW3RdLG4pO2Zvcih2YXIgcj1uO3I7KXtpZihyLmNkciYmIXIuY2RyLmNkcil7ci5jZHI9ci5jZHIuY2FyO2JyZWFrfXI9ci5jZHJ9cmV0dXJuIG59LHRvX2FycmF5OmZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMsbj1bXTtlOyl7aWYobi5wdXNoKGUuY2FyKSxlLmNkciYmIShlLmNkciBpbnN0YW5jZW9mIGVuKSl7bi5wdXNoKGUuY2RyKTticmVha31lPWUuY2RyfXJldHVybiBufSxhZGQ6ZnVuY3Rpb24oZSl7Zm9yKHZhciBuPXRoaXM7bjspe2lmKCEobi5jZHIgaW5zdGFuY2VvZiBlbikpe3ZhciB0PWVuLmNvbnMobi5jZHIsZSk7cmV0dXJuIG4uY2RyPXR9bj1uLmNkcn19LGxlbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNkciBpbnN0YW5jZW9mIGVuP3RoaXMuY2RyLmxlbigpKzE6Mn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmNhci5fd2FsayhlKSx0aGlzLmNkciYmdGhpcy5jZHIuX3dhbGsoZSl9KX19KSxubj1iKCJQcm9wQWNjZXNzIiwiZXhwcmVzc2lvbiBwcm9wZXJ0eSIseyRkb2N1bWVudGF0aW9uOidCYXNlIGNsYXNzIGZvciBwcm9wZXJ0eSBhY2Nlc3MgZXhwcmVzc2lvbnMsIGkuZS4gYGEuZm9vYCBvciBgYVsiZm9vIl1gJywkcHJvcGRvYzp7ZXhwcmVzc2lvbjoiW0FTVF9Ob2RlXSB0aGUg4oCcY29udGFpbmVy4oCdIGV4cHJlc3Npb24iLHByb3BlcnR5OiJbQVNUX05vZGV8c3RyaW5nXSB0aGUgcHJvcGVydHkgdG8gYWNjZXNzLiAgRm9yIEFTVF9Eb3QgdGhpcyBpcyBhbHdheXMgYSBwbGFpbiBzdHJpbmcsIHdoaWxlIGZvciBBU1RfU3ViIGl0J3MgYW4gYXJiaXRyYXJ5IEFTVF9Ob2RlIn19KSx0bj1iKCJEb3QiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGRvdHRlZCBwcm9wZXJ0eSBhY2Nlc3MgZXhwcmVzc2lvbiIsX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmV4cHJlc3Npb24uX3dhbGsoZSl9KX19LG5uKSxybj1iKCJTdWIiLG51bGwseyRkb2N1bWVudGF0aW9uOidJbmRleC1zdHlsZSBwcm9wZXJ0eSBhY2Nlc3MsIGkuZS4gYGFbImZvbyJdYCcsX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmV4cHJlc3Npb24uX3dhbGsoZSksdGhpcy5wcm9wZXJ0eS5fd2FsayhlKX0pfX0sbm4pLG9uPWIoIlVuYXJ5Iiwib3BlcmF0b3IgZXhwcmVzc2lvbiIseyRkb2N1bWVudGF0aW9uOiJCYXNlIGNsYXNzIGZvciB1bmFyeSBleHByZXNzaW9ucyIsJHByb3Bkb2M6e29wZXJhdG9yOiJbc3RyaW5nXSB0aGUgb3BlcmF0b3IiLGV4cHJlc3Npb246IltBU1RfTm9kZV0gZXhwcmVzc2lvbiB0aGF0IHRoaXMgdW5hcnkgb3BlcmF0b3IgYXBwbGllcyB0byJ9LF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5leHByZXNzaW9uLl93YWxrKGUpfSl9fSksdW49YigiVW5hcnlQcmVmaXgiLG51bGwseyRkb2N1bWVudGF0aW9uOiJVbmFyeSBwcmVmaXggZXhwcmVzc2lvbiwgaS5lLiBgdHlwZW9mIGlgIG9yIGArK2lgIn0sb24pLGFuPWIoIlVuYXJ5UG9zdGZpeCIsbnVsbCx7JGRvY3VtZW50YXRpb246IlVuYXJ5IHBvc3RmaXggZXhwcmVzc2lvbiwgaS5lLiBgaSsrYCJ9LG9uKSxzbj1iKCJCaW5hcnkiLCJsZWZ0IG9wZXJhdG9yIHJpZ2h0Iix7JGRvY3VtZW50YXRpb246IkJpbmFyeSBleHByZXNzaW9uLCBpLmUuIGBhICsgYmAiLCRwcm9wZG9jOntsZWZ0OiJbQVNUX05vZGVdIGxlZnQtaGFuZCBzaWRlIGV4cHJlc3Npb24iLG9wZXJhdG9yOiJbc3RyaW5nXSB0aGUgb3BlcmF0b3IiLHJpZ2h0OiJbQVNUX05vZGVdIHJpZ2h0LWhhbmQgc2lkZSBleHByZXNzaW9uIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmxlZnQuX3dhbGsoZSksdGhpcy5yaWdodC5fd2FsayhlKX0pfX0pLGNuPWIoIkNvbmRpdGlvbmFsIiwiY29uZGl0aW9uIGNvbnNlcXVlbnQgYWx0ZXJuYXRpdmUiLHskZG9jdW1lbnRhdGlvbjoiQ29uZGl0aW9uYWwgZXhwcmVzc2lvbiB1c2luZyB0aGUgdGVybmFyeSBvcGVyYXRvciwgaS5lLiBgYSA/IGIgOiBjYCIsJHByb3Bkb2M6e2NvbmRpdGlvbjoiW0FTVF9Ob2RlXSIsY29uc2VxdWVudDoiW0FTVF9Ob2RlXSIsYWx0ZXJuYXRpdmU6IltBU1RfTm9kZV0ifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMuY29uZGl0aW9uLl93YWxrKGUpLHRoaXMuY29uc2VxdWVudC5fd2FsayhlKSx0aGlzLmFsdGVybmF0aXZlLl93YWxrKGUpfSl9fSksZm49YigiQXNzaWduIixudWxsLHskZG9jdW1lbnRhdGlvbjoiQW4gYXNzaWdubWVudCBleHByZXNzaW9uIOKAlCBgYSA9IGIgKyA1YCJ9LHNuKSxsbj1iKCJBcnJheSIsImVsZW1lbnRzIix7JGRvY3VtZW50YXRpb246IkFuIGFycmF5IGxpdGVyYWwiLCRwcm9wZG9jOntlbGVtZW50czoiW0FTVF9Ob2RlKl0gYXJyYXkgb2YgZWxlbWVudHMifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMuZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihuKXtuLl93YWxrKGUpfSl9KX19KSxwbj1iKCJPYmplY3QiLCJwcm9wZXJ0aWVzIix7JGRvY3VtZW50YXRpb246IkFuIG9iamVjdCBsaXRlcmFsIiwkcHJvcGRvYzp7cHJvcGVydGllczoiW0FTVF9PYmplY3RQcm9wZXJ0eSpdIGFycmF5IG9mIHByb3BlcnRpZXMifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMucHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uX3dhbGsoZSl9KX0pfX0pLGRuPWIoIk9iamVjdFByb3BlcnR5Iiwia2V5IHZhbHVlIix7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGxpdGVyYWwgb2JqZWN0IHByb3BlcnRpZXMiLCRwcm9wZG9jOntrZXk6IltzdHJpbmd8QVNUX05vZGVdIHRoZSBwcm9wZXJ0eSBuYW1lIGNvbnZlcnRlZCB0byBhIHN0cmluZyBmb3IgT2JqZWN0S2V5VmFsLiBGb3Igc2V0dGVycywgZ2V0dGVycyBhbmQgY29tcHV0ZWQgcHJvcGVydHkgdGhpcyBpcyBhbiBhcmJpdHJhcnkgQVNUX05vZGUiLHZhbHVlOiJbQVNUX05vZGVdIHByb3BlcnR5IHZhbHVlLiBGb3Igc2V0dGVycyBhbmQgZ2V0dGVycyB0aGlzIGlzIGFuIEFTVF9GdW5jdGlvbi4iLGRlZmF1bHQ6IltBU1RfRXhwcmVzc2lvbl0gVGhlIGRlZmF1bHQgZm9yIHRoaXMgcGFyYW1ldGVyLCBvbmx5IHVzZWQgd2hlbiBuZXN0ZWQgaW5zaWRlIGEgYmluZGluZyBwYXR0ZXJuIn0sX3dhbGs6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX3Zpc2l0KHRoaXMsZnVuY3Rpb24oKXt0aGlzLmtleSBpbnN0YW5jZW9mIEsmJnRoaXMua2V5Ll93YWxrKGUpLHRoaXMudmFsdWUuX3dhbGsoZSl9KX19KSxobj1iKCJPYmplY3RLZXlWYWwiLCJxdW90ZSBkZWZhdWx0Iix7JGRvY3VtZW50YXRpb246IkEga2V5OiB2YWx1ZSBvYmplY3QgcHJvcGVydHkiLCRwcm9wZG9jOntxdW90ZToiW3N0cmluZ10gdGhlIG9yaWdpbmFsIHF1b3RlIGNoYXJhY3RlciIsZGVmYXVsdDoiW0FTVF9FeHByZXNzaW9uXSBUaGUgZGVmYXVsdCBwYXJhbWV0ZXIgdmFsdWUsIG9ubHkgdXNlZCB3aGVuIG5lc3RlZCBpbnNpZGUgYSBiaW5kaW5nIHBhdHRlcm4ifX0sZG4pLERuPWIoIk9iamVjdFNldHRlciIsInF1b3RlIHN0YXRpYyIseyRwcm9wZG9jOntxdW90ZToiW3N0cmluZ3x1bmRlZmluZWRdIHRoZSBvcmlnaW5hbCBxdW90ZSBjaGFyYWN0ZXIsIGlmIGFueSIsc3RhdGljOiJbYm9vbGVhbl0gd2hldGhlciB0aGlzIGlzIGEgc3RhdGljIHNldHRlciAoY2xhc3NlcyBvbmx5KSJ9LCRkb2N1bWVudGF0aW9uOiJBbiBvYmplY3Qgc2V0dGVyIHByb3BlcnR5In0sZG4pLG1uPWIoIk9iamVjdEdldHRlciIsInF1b3RlIHN0YXRpYyIseyRwcm9wZG9jOntxdW90ZToiW3N0cmluZ3x1bmRlZmluZWRdIHRoZSBvcmlnaW5hbCBxdW90ZSBjaGFyYWN0ZXIsIGlmIGFueSIsc3RhdGljOiJbYm9vbGVhbl0gd2hldGhlciB0aGlzIGlzIGEgc3RhdGljIGdldHRlciAoY2xhc3NlcyBvbmx5KSJ9LCRkb2N1bWVudGF0aW9uOiJBbiBvYmplY3QgZ2V0dGVyIHByb3BlcnR5In0sZG4pLHZuPWIoIkNvbmNpc2VNZXRob2QiLCJxdW90ZSBzdGF0aWMgaXNfZ2VuZXJhdG9yIix7JHByb3Bkb2M6e3F1b3RlOiJbc3RyaW5nfHVuZGVmaW5lZF0gdGhlIG9yaWdpbmFsIHF1b3RlIGNoYXJhY3RlciwgaWYgYW55IixzdGF0aWM6Iltib29sZWFuXSB3aGV0aGVyIHRoaXMgbWV0aG9kIGlzIHN0YXRpYyAoY2xhc3NlcyBvbmx5KSIsaXNfZ2VuZXJhdG9yOiJbYm9vbGVhbl0gaXMgZ2VuZXJhdG9yRm4gb3Igbm90In0sJGRvY3VtZW50YXRpb246IkFuIEVTNiBjb25jaXNlIG1ldGhvZCBpbnNpZGUgYW4gb2JqZWN0IG9yIGNsYXNzIn0sZG4pLF9uPWIoIkNsYXNzIiwibmFtZSBleHRlbmRzIHByb3BlcnRpZXMiLHskcHJvcGRvYzp7bmFtZToiW0FTVF9TeW1ib2xDbGFzc3xBU1RfU3ltYm9sRGVmQ2xhc3M/XSBvcHRpb25hbCBjbGFzcyBuYW1lLiIsZXh0ZW5kczoiW0FTVF9Ob2RlXT8gb3B0aW9uYWwgcGFyZW50IGNsYXNzIixwcm9wZXJ0aWVzOiJbQVNUX09iamVjdFByb3BlcnR5Kl0gYXJyYXkgb2YgcHJvcGVydGllcyJ9LCRkb2N1bWVudGF0aW9uOiJBbiBFUzYgY2xhc3MiLF93YWxrOmZ1bmN0aW9uKGUpe3JldHVybiBlLl92aXNpdCh0aGlzLGZ1bmN0aW9uKCl7dGhpcy5uYW1lJiZ0aGlzLm5hbWUuX3dhbGsoZSksdGhpcy5leHRlbmRzJiZ0aGlzLmV4dGVuZHMuX3dhbGsoZSksdGhpcy5wcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24obil7bi5fd2FsayhlKX0pfSl9fSxtZSksZ249YigiRGVmQ2xhc3MiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGNsYXNzIGRlZmluaXRpb24ifSxfbikseW49YigiQ2xhc3NFeHByZXNzaW9uIixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBjbGFzcyBleHByZXNzaW9uLiJ9LF9uKSxibj1iKCJTeW1ib2wiLCJzY29wZSBuYW1lIHRoZWRlZiBkZWZhdWx0Iix7JHByb3Bkb2M6e25hbWU6IltzdHJpbmddIG5hbWUgb2YgdGhpcyBzeW1ib2wiLHNjb3BlOiJbQVNUX1Njb3BlL1NdIHRoZSBjdXJyZW50IHNjb3BlIChub3QgbmVjZXNzYXJpbHkgdGhlIGRlZmluaXRpb24gc2NvcGUpIix0aGVkZWY6IltTeW1ib2xEZWYvU10gdGhlIGRlZmluaXRpb24gb2YgdGhpcyBzeW1ib2wiLGRlZmF1bHQ6IltBU1RfRXhwcmVzc2lvbl0gVGhlIGRlZmF1bHQgcGFyYW1ldGVyIHZhbHVlLCBvbmx5IHVzZWQgd2hlbiBuZXN0ZWQgaW5zaWRlIGEgYmluZGluZyBwYXR0ZXJuIn0sJGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGFsbCBzeW1ib2xzIixfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyxmdW5jdGlvbigpe3RoaXMuZGVmYXVsdCYmdGhpcy5kZWZhdWx0Ll93YWxrKGUpfSl9fSksRW49YigiTmV3VGFyZ2V0IixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSByZWZlcmVuY2UgdG8gbmV3LnRhcmdldCJ9KSxBbj1iKCJTeW1ib2xBY2Nlc3NvciIsbnVsbCx7JGRvY3VtZW50YXRpb246IlRoZSBuYW1lIG9mIGEgcHJvcGVydHkgYWNjZXNzb3IgKHNldHRlci9nZXR0ZXIgZnVuY3Rpb24pIn0sYm4pLEZuPWIoIlN5bWJvbERlY2xhcmF0aW9uIiwiaW5pdCIseyRkb2N1bWVudGF0aW9uOiJBIGRlY2xhcmF0aW9uIHN5bWJvbCAoc3ltYm9sIGluIHZhci9jb25zdCwgZnVuY3Rpb24gbmFtZSBvciBhcmd1bWVudCwgc3ltYm9sIGluIGNhdGNoKSIsJHByb3Bkb2M6e2luaXQ6IltBU1RfTm9kZSovU10gYXJyYXkgb2YgaW5pdGlhbGl6ZXJzIGZvciB0aGlzIGRlY2xhcmF0aW9uLiJ9fSxibiksd249YigiU3ltYm9sVmFyIixudWxsLHskZG9jdW1lbnRhdGlvbjoiU3ltYm9sIGRlZmluaW5nIGEgdmFyaWFibGUifSxGbiksQ249YigiU3ltYm9sQmxvY2tEZWNsYXJhdGlvbiIsbnVsbCx7JGRvY3VtZW50YXRpb246IkJhc2UgY2xhc3MgZm9yIGJsb2NrLXNjb3BlZCBkZWNsYXJhdGlvbiBzeW1ib2xzIn0sRm4pLGtuPWIoIlN5bWJvbENvbnN0IixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBjb25zdGFudCBkZWNsYXJhdGlvbiJ9LENuKSx4bj1iKCJTeW1ib2xMZXQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGJsb2NrLXNjb3BlZCBgbGV0YCBkZWNsYXJhdGlvbiJ9LENuKSxCbj1iKCJTeW1ib2xGdW5hcmciLG51bGwseyRkb2N1bWVudGF0aW9uOiJTeW1ib2wgbmFtaW5nIGEgZnVuY3Rpb24gYXJndW1lbnQifSx3biksU249YigiU3ltYm9sRGVmdW4iLG51bGwseyRkb2N1bWVudGF0aW9uOiJTeW1ib2wgZGVmaW5pbmcgYSBmdW5jdGlvbiJ9LEZuKSxUbj1iKCJTeW1ib2xNZXRob2QiLG51bGwseyRkb2N1bWVudGF0aW9uOiJTeW1ib2wgaW4gYW4gb2JqZWN0IGRlZmluaW5nIGEgbWV0aG9kIn0sYm4pLCRuPWIoIlN5bWJvbExhbWJkYSIsbnVsbCx7JGRvY3VtZW50YXRpb246IlN5bWJvbCBuYW1pbmcgYSBmdW5jdGlvbiBleHByZXNzaW9uIn0sRm4pLE9uPWIoIlN5bWJvbERlZkNsYXNzIixudWxsLHskZG9jdW1lbnRhdGlvbjoiU3ltYm9sIG5hbWluZyBhIGNsYXNzJ3MgbmFtZSBpbiBhIGNsYXNzIGRlY2xhcmF0aW9uLiBMZXhpY2FsbHkgc2NvcGVkIHRvIGl0cyBjb250YWluaW5nIHNjb3BlLCBhbmQgYWNjZXNzaWJsZSB3aXRoaW4gdGhlIGNsYXNzLiJ9LENuKSxxbj1iKCJTeW1ib2xDbGFzcyIsbnVsbCx7JGRvY3VtZW50YXRpb246IlN5bWJvbCBuYW1pbmcgYSBjbGFzcydzIG5hbWUuIExleGljYWxseSBzY29wZWQgdG8gdGhlIGNsYXNzLiJ9LEZuKSxNbj1iKCJTeW1ib2xDYXRjaCIsbnVsbCx7JGRvY3VtZW50YXRpb246IlN5bWJvbCBuYW1pbmcgdGhlIGV4Y2VwdGlvbiBpbiBjYXRjaCJ9LENuKSx6bj1iKCJTeW1ib2xJbXBvcnQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJTeW1ib2wgcmVmZXJpbmcgdG8gYW4gaW1wb3J0ZWQgbmFtZSJ9LENuKSxObj1iKCJTeW1ib2xJbXBvcnRGb3JlaWduIixudWxsLHskZG9jdW1lbnRhdGlvbjoiQSBzeW1ib2wgaW1wb3J0ZWQgZnJvbSBhIG1vZHVsZSwgYnV0IGl0IGlzIGRlZmluZWQgaW4gdGhlIG90aGVyIG1vZHVsZSwgYW5kIGl0cyByZWFsIG5hbWUgaXMgaXJyZWxldmFudCBmb3IgdGhpcyBtb2R1bGUncyBwdXJwb3NlcyJ9LGJuKSxqbj1iKCJMYWJlbCIsInJlZmVyZW5jZXMiLHskZG9jdW1lbnRhdGlvbjoiU3ltYm9sIG5hbWluZyBhIGxhYmVsIChkZWNsYXJhdGlvbikiLCRwcm9wZG9jOntyZWZlcmVuY2VzOiJbQVNUX0xvb3BDb250cm9sKl0gYSBsaXN0IG9mIG5vZGVzIHJlZmVycmluZyB0byB0aGlzIGxhYmVsIn0saW5pdGlhbGl6ZTpmdW5jdGlvbigpe3RoaXMucmVmZXJlbmNlcz1bXSx0aGlzLnRoZWRlZj10aGlzfX0sYm4pLEhuPWIoIlN5bWJvbFJlZiIsbnVsbCx7JGRvY3VtZW50YXRpb246IlJlZmVyZW5jZSB0byBzb21lIHN5bWJvbCAobm90IGRlZmluaXRpb24vZGVjbGFyYXRpb24pIn0sYm4pLEluPWIoIkxhYmVsUmVmIixudWxsLHsKJGRvY3VtZW50YXRpb246IlJlZmVyZW5jZSB0byBhIGxhYmVsIHN5bWJvbCJ9LGJuKSxQbj1iKCJUaGlzIixudWxsLHskZG9jdW1lbnRhdGlvbjoiVGhlIGB0aGlzYCBzeW1ib2wifSxibiksVW49YigiU3VwZXIiLG51bGwseyRkb2N1bWVudGF0aW9uOiJUaGUgYHN1cGVyYCBzeW1ib2wifSxibiksUm49YigiQ29uc3RhbnQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJCYXNlIGNsYXNzIGZvciBhbGwgY29uc3RhbnRzIixnZXRWYWx1ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnZhbHVlfX0pLExuPWIoIlN0cmluZyIsInZhbHVlIHF1b3RlIix7JGRvY3VtZW50YXRpb246IkEgc3RyaW5nIGxpdGVyYWwiLCRwcm9wZG9jOnt2YWx1ZToiW3N0cmluZ10gdGhlIGNvbnRlbnRzIG9mIHRoaXMgc3RyaW5nIixxdW90ZToiW3N0cmluZ10gdGhlIG9yaWdpbmFsIHF1b3RlIGNoYXJhY3RlciJ9fSxSbiksVm49YigiTnVtYmVyIiwidmFsdWUgbGl0ZXJhbCIseyRkb2N1bWVudGF0aW9uOiJBIG51bWJlciBsaXRlcmFsIiwkcHJvcGRvYzp7dmFsdWU6IltudW1iZXJdIHRoZSBudW1lcmljIHZhbHVlIixsaXRlcmFsOiJbc3RyaW5nXSBudW1lcmljIHZhbHVlIGFzIHN0cmluZyAob3B0aW9uYWwpIn19LFJuKSxXbj1iKCJSZWdFeHAiLCJ2YWx1ZSIseyRkb2N1bWVudGF0aW9uOiJBIHJlZ2V4cCBsaXRlcmFsIiwkcHJvcGRvYzp7dmFsdWU6IltSZWdFeHBdIHRoZSBhY3R1YWwgcmVnZXhwIn19LFJuKSxZbj1iKCJBdG9tIixudWxsLHskZG9jdW1lbnRhdGlvbjoiQmFzZSBjbGFzcyBmb3IgYXRvbXMifSxSbiksWG49YigiTnVsbCIsbnVsbCx7JGRvY3VtZW50YXRpb246IlRoZSBgbnVsbGAgYXRvbSIsdmFsdWU6bnVsbH0sWW4pLEduPWIoIk5hTiIsbnVsbCx7JGRvY3VtZW50YXRpb246IlRoZSBpbXBvc3NpYmxlIHZhbHVlIix2YWx1ZTpOYU59LFluKSxKbj1iKCJVbmRlZmluZWQiLG51bGwseyRkb2N1bWVudGF0aW9uOiJUaGUgYHVuZGVmaW5lZGAgdmFsdWUiLHZhbHVlOnZvaWQgMH0sWW4pLFpuPWIoIkhvbGUiLG51bGwseyRkb2N1bWVudGF0aW9uOiJBIGhvbGUgaW4gYW4gYXJyYXkiLHZhbHVlOnZvaWQgMH0sWW4pLEtuPWIoIkluZmluaXR5IixudWxsLHskZG9jdW1lbnRhdGlvbjoiVGhlIGBJbmZpbml0eWAgdmFsdWUiLHZhbHVlOjEvMH0sWW4pLFFuPWIoIkJvb2xlYW4iLG51bGwseyRkb2N1bWVudGF0aW9uOiJCYXNlIGNsYXNzIGZvciBib29sZWFucyJ9LFluKSxldD1iKCJGYWxzZSIsbnVsbCx7JGRvY3VtZW50YXRpb246IlRoZSBgZmFsc2VgIGF0b20iLHZhbHVlOiExfSxRbiksbnQ9YigiVHJ1ZSIsbnVsbCx7JGRvY3VtZW50YXRpb246IlRoZSBgdHJ1ZWAgYXRvbSIsdmFsdWU6ITB9LFFuKSx0dD1iKCJZaWVsZCIsImV4cHJlc3Npb24gaXNfc3RhciIseyRkb2N1bWVudGF0aW9uOiJBIGB5aWVsZGAgc3RhdGVtZW50IiwkcHJvcGRvYzp7ZXhwcmVzc2lvbjoiW0FTVF9Ob2RlP10gdGhlIHZhbHVlIHJldHVybmVkIG9yIHRocm93biBieSB0aGlzIHN0YXRlbWVudDsgY291bGQgYmUgbnVsbCAocmVwcmVzZW50aW5nIHVuZGVmaW5lZCkgYnV0IG9ubHkgd2hlbiBpc19zdGFyIGlzIHNldCB0byBmYWxzZSIsaXNfc3RhcjoiW0Jvb2xlYW5dIFdoZXRoZXIgdGhpcyBpcyBhIHlpZWxkIG9yIHlpZWxkKiBzdGF0ZW1lbnQifSxfd2FsazpmdW5jdGlvbihlKXtyZXR1cm4gZS5fdmlzaXQodGhpcyx0aGlzLmV4cHJlc3Npb24mJmZ1bmN0aW9uKCl7dGhpcy5leHByZXNzaW9uLl93YWxrKGUpfSl9fSk7QS5wcm90b3R5cGU9e192aXNpdDpmdW5jdGlvbihlLG4pe3RoaXMucHVzaChlKTt2YXIgdD10aGlzLnZpc2l0KGUsbj9mdW5jdGlvbigpe24uY2FsbChlKX06Zik7cmV0dXJuIXQmJm4mJm4uY2FsbChlKSx0aGlzLnBvcChlKSx0fSxwYXJlbnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGgtMi0oZXx8MCldfSxwdXNoOmZ1bmN0aW9uKGUpe2UgaW5zdGFuY2VvZiB5ZT90aGlzLmRpcmVjdGl2ZXM9T2JqZWN0LmNyZWF0ZSh0aGlzLmRpcmVjdGl2ZXMpOmUgaW5zdGFuY2VvZiBuZT90aGlzLmRpcmVjdGl2ZXNbZS52YWx1ZV09IXRoaXMuZGlyZWN0aXZlc1tlLnZhbHVlXXx8InVwIjplIGluc3RhbmNlb2YgX24mJih0aGlzLmRpcmVjdGl2ZXM9T2JqZWN0LmNyZWF0ZSh0aGlzLmRpcmVjdGl2ZXMpLHRoaXMuZGlyZWN0aXZlc1sidXNlIHN0cmljdCJdPSF0aGlzLmRpcmVjdGl2ZXNbInVzZSBzdHJpY3QiXXx8InVwIiksdGhpcy5zdGFjay5wdXNoKGUpfSxwb3A6ZnVuY3Rpb24oZSl7dGhpcy5zdGFjay5wb3AoKSwoZSBpbnN0YW5jZW9mIHllfHxlIGluc3RhbmNlb2YgX24pJiYodGhpcy5kaXJlY3RpdmVzPU9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzLmRpcmVjdGl2ZXMpKX0sc2VsZjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoLTFdfSxmaW5kX3BhcmVudDpmdW5jdGlvbihlKXtmb3IodmFyIG49dGhpcy5zdGFjayx0PW4ubGVuZ3RoOy0tdD49MDspe3ZhciByPW5bdF07aWYociBpbnN0YW5jZW9mIGUpcmV0dXJuIHJ9fSxoYXNfZGlyZWN0aXZlOmZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuZGlyZWN0aXZlc1tlXTtpZihuKXJldHVybiBuO3ZhciB0PXRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGgtMV07aWYodCBpbnN0YW5jZW9mIG1lJiZ0LmJvZHkpZm9yKHZhciByPTA7cjx0LmJvZHkubGVuZ3RoOysrcil7dmFyIGk9dC5ib2R5W3JdO2lmKCEoaSBpbnN0YW5jZW9mIG5lKSlicmVhaztpZihpLnZhbHVlPT1lKXJldHVybiEwfX0saW5fYm9vbGVhbl9jb250ZXh0OmZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuc3RhY2ssbj1lLmxlbmd0aCx0PWVbLS1uXTtuPjA7KXt2YXIgcj1lWy0tbl07aWYociBpbnN0YW5jZW9mIHplJiZyLmNvbmRpdGlvbj09PXR8fHIgaW5zdGFuY2VvZiBjbiYmci5jb25kaXRpb249PT10fHxyIGluc3RhbmNlb2YgY2UmJnIuY29uZGl0aW9uPT09dHx8ciBpbnN0YW5jZW9mIHBlJiZyLmNvbmRpdGlvbj09PXR8fHIgaW5zdGFuY2VvZiB1biYmIiEiPT1yLm9wZXJhdG9yJiZyLmV4cHJlc3Npb249PT10KXJldHVybiEwO2lmKCEociBpbnN0YW5jZW9mIHNuKXx8IiYmIiE9ci5vcGVyYXRvciYmInx8IiE9ci5vcGVyYXRvcilyZXR1cm4hMTt0PXJ9fSxsb29wY29udHJvbF90YXJnZXQ6ZnVuY3Rpb24oZSl7dmFyIG49dGhpcy5zdGFjaztpZihlKWZvcih2YXIgdD1uLmxlbmd0aDstLXQ+PTA7KXt2YXIgcj1uW3RdO2lmKHIgaW5zdGFuY2VvZiBhZSYmci5sYWJlbC5uYW1lPT1lLm5hbWUpcmV0dXJuIHIuYm9keX1lbHNlIGZvcih2YXIgdD1uLmxlbmd0aDstLXQ+PTA7KXt2YXIgcj1uW3RdO2lmKHIgaW5zdGFuY2VvZiBOZXx8ciBpbnN0YW5jZW9mIHNlKXJldHVybiByfX19O3ZhciBydD0iYnJlYWsgY2FzZSBjYXRjaCBjbGFzcyBjb25zdCBjb250aW51ZSBkZWJ1Z2dlciBkZWZhdWx0IGRlbGV0ZSBkbyBlbHNlIGV4cG9ydCBleHRlbmRzIGZpbmFsbHkgZm9yIGZ1bmN0aW9uIGlmIGluIGluc3RhbmNlb2YgbmV3IHJldHVybiBzd2l0Y2ggdGhyb3cgdHJ5IHR5cGVvZiB2YXIgbGV0IHZvaWQgd2hpbGUgd2l0aCBpbXBvcnQiLGl0PSJmYWxzZSBudWxsIHRydWUiLG90PSJlbnVtIGltcGxlbWVudHMgaW50ZXJmYWNlIHBhY2thZ2UgcHJpdmF0ZSBwcm90ZWN0ZWQgcHVibGljIHN0YXRpYyBzdXBlciB0aGlzICIraXQrIiAiK3J0LHV0PSJyZXR1cm4gbmV3IGRlbGV0ZSB0aHJvdyBlbHNlIGNhc2UgeWllbGQiO3J0PXYocnQpLG90PXYob3QpLHV0PXYodXQpLGl0PXYoaXQpO3ZhciBhdD12KHIoIistKiYlPTw+IT98fl4iKSksc3Q9L1swLTlhLWZdL2ksY3Q9L14weFswLTlhLWZdKyQvaSxmdD0vXjBbMC03XSskLyxsdD0vXjBvWzAtN10rJC9pLHB0PS9eMGJbMDFdKyQvaSxkdD0vXlxkKlwuP1xkKig/OmVbKy1dP1xkKig/OlxkXC4/fFwuP1xkKVxkKik/JC9pLGh0PXYoWyJpbiIsImluc3RhbmNlb2YiLCJ0eXBlb2YiLCJuZXciLCJ2b2lkIiwiZGVsZXRlIiwiKysiLCItLSIsIisiLCItIiwiISIsIn4iLCImIiwifCIsIl4iLCIqIiwiKioiLCIvIiwiJSIsIj4+IiwiPDwiLCI+Pj4iLCI8IiwiPiIsIjw9IiwiPj0iLCI9PSIsIj09PSIsIiE9IiwiIT09IiwiPyIsIj0iLCIrPSIsIi09IiwiLz0iLCIqPSIsIioqPSIsIiU9IiwiPj49IiwiPDw9IiwiPj4+PSIsInw9IiwiXj0iLCImPSIsIiYmIiwifHwiXSksRHQ9dihyKCIgwqBcblxyXHRcZlx24oCL4oCA4oCB4oCC4oCD4oCE4oCF4oCG4oCH4oCI4oCJ4oCKXHUyMDI4XHUyMDI54oCv4oGf44CAXHVmZWZmIikpLG10PXYocigiXG5cclx1MjAyOFx1MjAyOSIpKSx2dD12KHIoIjtdKSw6IikpLF90PXYocigiW3soLC47OiIpKSxndD12KHIoIltde30oKSw7OiIpKSx5dD0odihyKCJnbXNpeSIpKSx7SURfU3RhcnQ6L1tBLVphLXpceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMC1cdTA4QjRcdTA5MDQtXHUwOTM5XHUwOTNEXHUwOTUwXHUwOTU4LVx1MDk2MVx1MDk3MS1cdTA5ODBcdTA5ODUtXHUwOThDXHUwOThGXHUwOTkwXHUwOTkzLVx1MDlBOFx1MDlBQS1cdTA5QjBcdTA5QjJcdTA5QjYtXHUwOUI5XHUwOUJEXHUwOUNFXHUwOURDXHUwOUREXHUwOURGLVx1MDlFMVx1MDlGMFx1MDlGMVx1MEEwNS1cdTBBMEFcdTBBMEZcdTBBMTBcdTBBMTMtXHUwQTI4XHUwQTJBLVx1MEEzMFx1MEEzMlx1MEEzM1x1MEEzNVx1MEEzNlx1MEEzOFx1MEEzOVx1MEE1OS1cdTBBNUNcdTBBNUVcdTBBNzItXHUwQTc0XHUwQTg1LVx1MEE4RFx1MEE4Ri1cdTBBOTFcdTBBOTMtXHUwQUE4XHUwQUFBLVx1MEFCMFx1MEFCMlx1MEFCM1x1MEFCNS1cdTBBQjlcdTBBQkRcdTBBRDBcdTBBRTBcdTBBRTFcdTBBRjlcdTBCMDUtXHUwQjBDXHUwQjBGXHUwQjEwXHUwQjEzLVx1MEIyOFx1MEIyQS1cdTBCMzBcdTBCMzJcdTBCMzNcdTBCMzUtXHUwQjM5XHUwQjNEXHUwQjVDXHUwQjVEXHUwQjVGLVx1MEI2MVx1MEI3MVx1MEI4M1x1MEI4NS1cdTBCOEFcdTBCOEUtXHUwQjkwXHUwQjkyLVx1MEI5NVx1MEI5OVx1MEI5QVx1MEI5Q1x1MEI5RVx1MEI5Rlx1MEJBM1x1MEJBNFx1MEJBOC1cdTBCQUFcdTBCQUUtXHUwQkI5XHUwQkQwXHUwQzA1LVx1MEMwQ1x1MEMwRS1cdTBDMTBcdTBDMTItXHUwQzI4XHUwQzJBLVx1MEMzOVx1MEMzRFx1MEM1OC1cdTBDNUFcdTBDNjBcdTBDNjFcdTBDODUtXHUwQzhDXHUwQzhFLVx1MEM5MFx1MEM5Mi1cdTBDQThcdTBDQUEtXHUwQ0IzXHUwQ0I1LVx1MENCOVx1MENCRFx1MENERVx1MENFMFx1MENFMVx1MENGMVx1MENGMlx1MEQwNS1cdTBEMENcdTBEMEUtXHUwRDEwXHUwRDEyLVx1MEQzQVx1MEQzRFx1MEQ0RVx1MEQ1Ri1cdTBENjFcdTBEN0EtXHUwRDdGXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MEUwMS1cdTBFMzBcdTBFMzJcdTBFMzNcdTBFNDAtXHUwRTQ2XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCMFx1MEVCMlx1MEVCM1x1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFREMtXHUwRURGXHUwRjAwXHUwRjQwLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGODgtXHUwRjhDXHUxMDAwLVx1MTAyQVx1MTAzRlx1MTA1MC1cdTEwNTVcdTEwNUEtXHUxMDVEXHUxMDYxXHUxMDY1XHUxMDY2XHUxMDZFLVx1MTA3MFx1MTA3NS1cdTEwODFcdTEwOEVcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxMVx1MTcyMC1cdTE3MzFcdTE3NDAtXHUxNzUxXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3ODAtXHUxN0IzXHUxN0Q3XHUxN0RDXHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRCXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDRTktXHUxQ0VDXHUxQ0VFLVx1MUNGMVx1MUNGNVx1MUNGNlx1MUQwMC1cdTFEQkZcdTFFMDAtXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMTAyXHUyMTA3XHUyMTBBLVx1MjExM1x1MjExNVx1MjExOC1cdTIxMURcdTIxMjRcdTIxMjZcdTIxMjhcdTIxMkEtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkMyRVx1MkMzMC1cdTJDNUVcdTJDNjAtXHUyQ0U0XHUyQ0VCLVx1MkNFRVx1MkNGMlx1MkNGM1x1MkQwMC1cdTJEMjVcdTJEMjdcdTJEMkRcdTJEMzAtXHUyRDY3XHUyRDZGXHUyRDgwLVx1MkQ5Nlx1MkRBMC1cdTJEQTZcdTJEQTgtXHUyREFFXHUyREIwLVx1MkRCNlx1MkRCOC1cdTJEQkVcdTJEQzAtXHUyREM2XHUyREM4LVx1MkRDRVx1MkREMC1cdTJERDZcdTJERDgtXHUyRERFXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMjlcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOUItXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjFGXHVBNjJBXHVBNjJCXHVBNjQwLVx1QTY2RVx1QTY3Ri1cdUE2OURcdUE2QTAtXHVBNkVGXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FEXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MDFcdUE4MDMtXHVBODA1XHVBODA3LVx1QTgwQVx1QTgwQy1cdUE4MjJcdUE4NDAtXHVBODczXHVBODgyLVx1QThCM1x1QThGMi1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MEEtXHVBOTI1XHVBOTMwLVx1QTk0Nlx1QTk2MC1cdUE5N0NcdUE5ODQtXHVBOUIyXHVBOUNGXHVBOUUwLVx1QTlFNFx1QTlFNi1cdUE5RUZcdUE5RkEtXHVBOUZFXHVBQTAwLVx1QUEyOFx1QUE0MC1cdUFBNDJcdUFBNDQtXHVBQTRCXHVBQTYwLVx1QUE3Nlx1QUE3QVx1QUE3RS1cdUFBQUZcdUFBQjFcdUFBQjVcdUFBQjZcdUFBQjktXHVBQUJEXHVBQUMwXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUFcdUFBRjItXHVBQUY0XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2NVx1QUI3MC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGNzVcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1REQwMC1cdUREMjdcdUREMzAtXHVERDYzXHVERTAwLVx1REYzNlx1REY0MC1cdURGNTVcdURGNjAtXHVERjY3XXxcdUQ4MDJbXHVEQzAwLVx1REMwNVx1REMwOFx1REMwQS1cdURDMzVcdURDMzdcdURDMzhcdURDM0NcdURDM0YtXHVEQzU1XHVEQzYwLVx1REM3Nlx1REM4MC1cdURDOUVcdURDRTAtXHVEQ0YyXHVEQ0Y0XHVEQ0Y1XHVERDAwLVx1REQxNVx1REQyMC1cdUREMzlcdUREODAtXHVEREI3XHVEREJFXHVEREJGXHVERTAwXHVERTEwLVx1REUxM1x1REUxNS1cdURFMTdcdURFMTktXHVERTMzXHVERTYwLVx1REU3Q1x1REU4MC1cdURFOUNcdURFQzAtXHVERUM3XHVERUM5LVx1REVFNFx1REYwMC1cdURGMzVcdURGNDAtXHVERjU1XHVERjYwLVx1REY3Mlx1REY4MC1cdURGOTFdfFx1RDgwM1tcdURDMDAtXHVEQzQ4XHVEQzgwLVx1RENCMlx1RENDMC1cdURDRjJdfFx1RDgwNFtcdURDMDMtXHVEQzM3XHVEQzgzLVx1RENBRlx1RENEMC1cdURDRThcdUREMDMtXHVERDI2XHVERDUwLVx1REQ3Mlx1REQ3Nlx1REQ4My1cdUREQjJcdUREQzEtXHVEREM0XHVERERBXHVERERDXHVERTAwLVx1REUxMVx1REUxMy1cdURFMkJcdURFODAtXHVERTg2XHVERTg4XHVERThBLVx1REU4RFx1REU4Ri1cdURFOURcdURFOUYtXHVERUE4XHVERUIwLVx1REVERVx1REYwNS1cdURGMENcdURGMEZcdURGMTBcdURGMTMtXHVERjI4XHVERjJBLVx1REYzMFx1REYzMlx1REYzM1x1REYzNS1cdURGMzlcdURGM0RcdURGNTBcdURGNUQtXHVERjYxXXxcdUQ4MDVbXHVEQzgwLVx1RENBRlx1RENDNFx1RENDNVx1RENDN1x1REQ4MC1cdUREQUVcdURERDgtXHVERERCXHVERTAwLVx1REUyRlx1REU0NFx1REU4MC1cdURFQUFcdURGMDAtXHVERjE5XXxcdUQ4MDZbXHVEQ0EwLVx1RENERlx1RENGRlx1REVDMC1cdURFRjhdfFx1RDgwOFtcdURDMDAtXHVERjk5XXxcdUQ4MDlbXHVEQzAwLVx1REM2RVx1REM4MC1cdURENDNdfFtcdUQ4MENcdUQ4NDAtXHVEODY4XHVEODZBLVx1RDg2Q1x1RDg2Ri1cdUQ4NzJdW1x1REMwMC1cdURGRkZdfFx1RDgwRFtcdURDMDAtXHVEQzJFXXxcdUQ4MTFbXHVEQzAwLVx1REU0Nl18XHVEODFBW1x1REMwMC1cdURFMzhcdURFNDAtXHVERTVFXHVERUQwLVx1REVFRFx1REYwMC1cdURGMkZcdURGNDAtXHVERjQzXHVERjYzLVx1REY3N1x1REY3RC1cdURGOEZdfFx1RDgxQltcdURGMDAtXHVERjQ0XHVERjUwXHVERjkzLVx1REY5Rl18XHVEODJDW1x1REMwMFx1REMwMV18XHVEODJGW1x1REMwMC1cdURDNkFcdURDNzAtXHVEQzdDXHVEQzgwLVx1REM4OFx1REM5MC1cdURDOTldfFx1RDgzNVtcdURDMDAtXHVEQzU0XHVEQzU2LVx1REM5Q1x1REM5RVx1REM5Rlx1RENBMlx1RENBNVx1RENBNlx1RENBOS1cdURDQUNcdURDQUUtXHVEQ0I5XHVEQ0JCXHVEQ0JELVx1RENDM1x1RENDNS1cdUREMDVcdUREMDctXHVERDBBXHVERDBELVx1REQxNFx1REQxNi1cdUREMUNcdUREMUUtXHVERDM5XHVERDNCLVx1REQzRVx1REQ0MC1cdURENDRcdURENDZcdURENEEtXHVERDUwXHVERDUyLVx1REVBNVx1REVBOC1cdURFQzBcdURFQzItXHVERURBXHVERURDLVx1REVGQVx1REVGQy1cdURGMTRcdURGMTYtXHVERjM0XHVERjM2LVx1REY0RVx1REY1MC1cdURGNkVcdURGNzAtXHVERjg4XHVERjhBLVx1REZBOFx1REZBQS1cdURGQzJcdURGQzQtXHVERkNCXXxcdUQ4M0FbXHVEQzAwLVx1RENDNF18XHVEODNCW1x1REUwMC1cdURFMDNcdURFMDUtXHVERTFGXHVERTIxXHVERTIyXHVERTI0XHVERTI3XHVERTI5LVx1REUzMlx1REUzNC1cdURFMzdcdURFMzlcdURFM0JcdURFNDJcdURFNDdcdURFNDlcdURFNEJcdURFNEQtXHVERTRGXHVERTUxXHVERTUyXHVERTU0XHVERTU3XHVERTU5XHVERTVCXHVERTVEXHVERTVGXHVERTYxXHVERTYyXHVERTY0XHVERTY3LVx1REU2QVx1REU2Qy1cdURFNzJcdURFNzQtXHVERTc3XHVERTc5LVx1REU3Q1x1REU3RVx1REU4MC1cdURFODlcdURFOEItXHVERTlCXHVERUExLVx1REVBM1x1REVBNS1cdURFQTlcdURFQUItXHVERUJCXXxcdUQ4NjlbXHVEQzAwLVx1REVENlx1REYwMC1cdURGRkZdfFx1RDg2RFtcdURDMDAtXHVERjM0XHVERjQwLVx1REZGRl18XHVEODZFW1x1REMwMC1cdURDMURcdURDMjAtXHVERkZGXXxcdUQ4NzNbXHVEQzAwLVx1REVBMV18XHVEODdFW1x1REMwMC1cdURFMURdLyxJRF9Db250aW51ZTovWzAtOUEtWl9hLXpceEFBXHhCNVx4QjdceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDMwMC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4My1cdTA0ODdcdTA0OEEtXHUwNTJGXHUwNTMxLVx1MDU1Nlx1MDU1OVx1MDU2MS1cdTA1ODdcdTA1OTEtXHUwNUJEXHUwNUJGXHUwNUMxXHUwNUMyXHUwNUM0XHUwNUM1XHUwNUM3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MTAtXHUwNjFBXHUwNjIwLVx1MDY2OVx1MDY2RS1cdTA2RDNcdTA2RDUtXHUwNkRDXHUwNkRGLVx1MDZFOFx1MDZFQS1cdTA2RkNcdTA2RkZcdTA3MTAtXHUwNzRBXHUwNzRELVx1MDdCMVx1MDdDMC1cdTA3RjVcdTA3RkFcdTA4MDAtXHUwODJEXHUwODQwLVx1MDg1Qlx1MDhBMC1cdTA4QjRcdTA4RTMtXHUwOTYzXHUwOTY2LVx1MDk2Rlx1MDk3MS1cdTA5ODNcdTA5ODUtXHUwOThDXHUwOThGXHUwOTkwXHUwOTkzLVx1MDlBOFx1MDlBQS1cdTA5QjBcdTA5QjJcdTA5QjYtXHUwOUI5XHUwOUJDLVx1MDlDNFx1MDlDN1x1MDlDOFx1MDlDQi1cdTA5Q0VcdTA5RDdcdTA5RENcdTA5RERcdTA5REYtXHUwOUUzXHUwOUU2LVx1MDlGMVx1MEEwMS1cdTBBMDNcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBM0NcdTBBM0UtXHUwQTQyXHUwQTQ3XHUwQTQ4XHUwQTRCLVx1MEE0RFx1MEE1MVx1MEE1OS1cdTBBNUNcdTBBNUVcdTBBNjYtXHUwQTc1XHUwQTgxLVx1MEE4M1x1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJDLVx1MEFDNVx1MEFDNy1cdTBBQzlcdTBBQ0ItXHUwQUNEXHUwQUQwXHUwQUUwLVx1MEFFM1x1MEFFNi1cdTBBRUZcdTBBRjlcdTBCMDEtXHUwQjAzXHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzQy1cdTBCNDRcdTBCNDdcdTBCNDhcdTBCNEItXHUwQjREXHUwQjU2XHUwQjU3XHUwQjVDXHUwQjVEXHUwQjVGLVx1MEI2M1x1MEI2Ni1cdTBCNkZcdTBCNzFcdTBCODJcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJCRS1cdTBCQzJcdTBCQzYtXHUwQkM4XHUwQkNBLVx1MEJDRFx1MEJEMFx1MEJEN1x1MEJFNi1cdTBCRUZcdTBDMDAtXHUwQzAzXHUwQzA1LVx1MEMwQ1x1MEMwRS1cdTBDMTBcdTBDMTItXHUwQzI4XHUwQzJBLVx1MEMzOVx1MEMzRC1cdTBDNDRcdTBDNDYtXHUwQzQ4XHUwQzRBLVx1MEM0RFx1MEM1NVx1MEM1Nlx1MEM1OC1cdTBDNUFcdTBDNjAtXHUwQzYzXHUwQzY2LVx1MEM2Rlx1MEM4MS1cdTBDODNcdTBDODUtXHUwQzhDXHUwQzhFLVx1MEM5MFx1MEM5Mi1cdTBDQThcdTBDQUEtXHUwQ0IzXHUwQ0I1LVx1MENCOVx1MENCQy1cdTBDQzRcdTBDQzYtXHUwQ0M4XHUwQ0NBLVx1MENDRFx1MENENVx1MENENlx1MENERVx1MENFMC1cdTBDRTNcdTBDRTYtXHUwQ0VGXHUwQ0YxXHUwQ0YyXHUwRDAxLVx1MEQwM1x1MEQwNS1cdTBEMENcdTBEMEUtXHUwRDEwXHUwRDEyLVx1MEQzQVx1MEQzRC1cdTBENDRcdTBENDYtXHUwRDQ4XHUwRDRBLVx1MEQ0RVx1MEQ1N1x1MEQ1Ri1cdTBENjNcdTBENjYtXHUwRDZGXHUwRDdBLVx1MEQ3Rlx1MEQ4Mlx1MEQ4M1x1MEQ4NS1cdTBEOTZcdTBEOUEtXHUwREIxXHUwREIzLVx1MERCQlx1MERCRFx1MERDMC1cdTBEQzZcdTBEQ0FcdTBEQ0YtXHUwREQ0XHUwREQ2XHUwREQ4LVx1MERERlx1MERFNi1cdTBERUZcdTBERjJcdTBERjNcdTBFMDEtXHUwRTNBXHUwRTQwLVx1MEU0RVx1MEU1MC1cdTBFNTlcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUI5XHUwRUJCLVx1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFQzgtXHUwRUNEXHUwRUQwLVx1MEVEOVx1MEVEQy1cdTBFREZcdTBGMDBcdTBGMThcdTBGMTlcdTBGMjAtXHUwRjI5XHUwRjM1XHUwRjM3XHUwRjM5XHUwRjNFLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGNzEtXHUwRjg0XHUwRjg2LVx1MEY5N1x1MEY5OS1cdTBGQkNcdTBGQzZcdTEwMDAtXHUxMDQ5XHUxMDUwLVx1MTA5RFx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzNUQtXHUxMzVGXHUxMzY5LVx1MTM3MVx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTRcdTE3MjAtXHUxNzM0XHUxNzQwLVx1MTc1M1x1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzcyXHUxNzczXHUxNzgwLVx1MTdEM1x1MTdEN1x1MTdEQ1x1MTdERFx1MTdFMC1cdTE3RTlcdTE4MEItXHUxODBEXHUxODEwLVx1MTgxOVx1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5MjAtXHUxOTJCXHUxOTMwLVx1MTkzQlx1MTk0Ni1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTE5RDAtXHUxOURBXHUxQTAwLVx1MUExQlx1MUEyMC1cdTFBNUVcdTFBNjAtXHUxQTdDXHUxQTdGLVx1MUE4OVx1MUE5MC1cdTFBOTlcdTFBQTdcdTFBQjAtXHUxQUJEXHUxQjAwLVx1MUI0Qlx1MUI1MC1cdTFCNTlcdTFCNkItXHUxQjczXHUxQjgwLVx1MUJGM1x1MUMwMC1cdTFDMzdcdTFDNDAtXHUxQzQ5XHUxQzRELVx1MUM3RFx1MUNEMC1cdTFDRDJcdTFDRDQtXHUxQ0Y2XHUxQ0Y4XHUxQ0Y5XHUxRDAwLVx1MURGNVx1MURGQy1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjAzRlx1MjA0MFx1MjA1NFx1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIwRDAtXHUyMERDXHUyMEUxXHUyMEU1LVx1MjBGMFx1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTgtXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ3Ri1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MkRFMC1cdTJERkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyRlx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5OS1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MkJcdUE2NDAtXHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY3Ri1cdUE2RjFcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QURcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgyN1x1QTg0MC1cdUE4NzNcdUE4ODAtXHVBOEM0XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MDAtXHVBOTJEXHVBOTMwLVx1QTk1M1x1QTk2MC1cdUE5N0NcdUE5ODAtXHVBOUMwXHVBOUNGLVx1QTlEOVx1QTlFMC1cdUE5RkVcdUFBMDAtXHVBQTM2XHVBQTQwLVx1QUE0RFx1QUE1MC1cdUFBNTlcdUFBNjAtXHVBQTc2XHVBQTdBLVx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVGXHVBQUYyLVx1QUFGNlx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMUQtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjEwLVx1RkYxOVx1RkYyMS1cdUZGM0FcdUZGM0ZcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVEREZEXHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURFRTBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGN0FcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1RENBMC1cdURDQTlcdUREMDAtXHVERDI3XHVERDMwLVx1REQ2M1x1REUwMC1cdURGMzZcdURGNDAtXHVERjU1XHVERjYwLVx1REY2N118XHVEODAyW1x1REMwMC1cdURDMDVcdURDMDhcdURDMEEtXHVEQzM1XHVEQzM3XHVEQzM4XHVEQzNDXHVEQzNGLVx1REM1NVx1REM2MC1cdURDNzZcdURDODAtXHVEQzlFXHVEQ0UwLVx1RENGMlx1RENGNFx1RENGNVx1REQwMC1cdUREMTVcdUREMjAtXHVERDM5XHVERDgwLVx1RERCN1x1RERCRVx1RERCRlx1REUwMC1cdURFMDNcdURFMDVcdURFMDZcdURFMEMtXHVERTEzXHVERTE1LVx1REUxN1x1REUxOS1cdURFMzNcdURFMzgtXHVERTNBXHVERTNGXHVERTYwLVx1REU3Q1x1REU4MC1cdURFOUNcdURFQzAtXHVERUM3XHVERUM5LVx1REVFNlx1REYwMC1cdURGMzVcdURGNDAtXHVERjU1XHVERjYwLVx1REY3Mlx1REY4MC1cdURGOTFdfFx1RDgwM1tcdURDMDAtXHVEQzQ4XHVEQzgwLVx1RENCMlx1RENDMC1cdURDRjJdfFx1RDgwNFtcdURDMDAtXHVEQzQ2XHVEQzY2LVx1REM2Rlx1REM3Ri1cdURDQkFcdURDRDAtXHVEQ0U4XHVEQ0YwLVx1RENGOVx1REQwMC1cdUREMzRcdUREMzYtXHVERDNGXHVERDUwLVx1REQ3M1x1REQ3Nlx1REQ4MC1cdUREQzRcdUREQ0EtXHVERENDXHVEREQwLVx1REREQVx1REREQ1x1REUwMC1cdURFMTFcdURFMTMtXHVERTM3XHVERTgwLVx1REU4Nlx1REU4OFx1REU4QS1cdURFOERcdURFOEYtXHVERTlEXHVERTlGLVx1REVBOFx1REVCMC1cdURFRUFcdURFRjAtXHVERUY5XHVERjAwLVx1REYwM1x1REYwNS1cdURGMENcdURGMEZcdURGMTBcdURGMTMtXHVERjI4XHVERjJBLVx1REYzMFx1REYzMlx1REYzM1x1REYzNS1cdURGMzlcdURGM0MtXHVERjQ0XHVERjQ3XHVERjQ4XHVERjRCLVx1REY0RFx1REY1MFx1REY1N1x1REY1RC1cdURGNjNcdURGNjYtXHVERjZDXHVERjcwLVx1REY3NF18XHVEODA1W1x1REM4MC1cdURDQzVcdURDQzdcdURDRDAtXHVEQ0Q5XHVERDgwLVx1RERCNVx1RERCOC1cdUREQzBcdURERDgtXHVEREREXHVERTAwLVx1REU0MFx1REU0NFx1REU1MC1cdURFNTlcdURFODAtXHVERUI3XHVERUMwLVx1REVDOVx1REYwMC1cdURGMTlcdURGMUQtXHVERjJCXHVERjMwLVx1REYzOV18XHVEODA2W1x1RENBMC1cdURDRTlcdURDRkZcdURFQzAtXHVERUY4XXxcdUQ4MDhbXHVEQzAwLVx1REY5OV18XHVEODA5W1x1REMwMC1cdURDNkVcdURDODAtXHVERDQzXXxbXHVEODBDXHVEODQwLVx1RDg2OFx1RDg2QS1cdUQ4NkNcdUQ4NkYtXHVEODcyXVtcdURDMDAtXHVERkZGXXxcdUQ4MERbXHVEQzAwLVx1REMyRV18XHVEODExW1x1REMwMC1cdURFNDZdfFx1RDgxQVtcdURDMDAtXHVERTM4XHVERTQwLVx1REU1RVx1REU2MC1cdURFNjlcdURFRDAtXHVERUVEXHVERUYwLVx1REVGNFx1REYwMC1cdURGMzZcdURGNDAtXHVERjQzXHVERjUwLVx1REY1OVx1REY2My1cdURGNzdcdURGN0QtXHVERjhGXXxcdUQ4MUJbXHVERjAwLVx1REY0NFx1REY1MC1cdURGN0VcdURGOEYtXHVERjlGXXxcdUQ4MkNbXHVEQzAwXHVEQzAxXXxcdUQ4MkZbXHVEQzAwLVx1REM2QVx1REM3MC1cdURDN0NcdURDODAtXHVEQzg4XHVEQzkwLVx1REM5OVx1REM5RFx1REM5RV18XHVEODM0W1x1REQ2NS1cdURENjlcdURENkQtXHVERDcyXHVERDdCLVx1REQ4Mlx1REQ4NS1cdUREOEJcdUREQUEtXHVEREFEXHVERTQyLVx1REU0NF18XHVEODM1W1x1REMwMC1cdURDNTRcdURDNTYtXHVEQzlDXHVEQzlFXHVEQzlGXHVEQ0EyXHVEQ0E1XHVEQ0E2XHVEQ0E5LVx1RENBQ1x1RENBRS1cdURDQjlcdURDQkJcdURDQkQtXHVEQ0MzXHVEQ0M1LVx1REQwNVx1REQwNy1cdUREMEFcdUREMEQtXHVERDE0XHVERDE2LVx1REQxQ1x1REQxRS1cdUREMzlcdUREM0ItXHVERDNFXHVERDQwLVx1REQ0NFx1REQ0Nlx1REQ0QS1cdURENTBcdURENTItXHVERUE1XHVERUE4LVx1REVDMFx1REVDMi1cdURFREFcdURFREMtXHVERUZBXHVERUZDLVx1REYxNFx1REYxNi1cdURGMzRcdURGMzYtXHVERjRFXHVERjUwLVx1REY2RVx1REY3MC1cdURGODhcdURGOEEtXHVERkE4XHVERkFBLVx1REZDMlx1REZDNC1cdURGQ0JcdURGQ0UtXHVERkZGXXxcdUQ4MzZbXHVERTAwLVx1REUzNlx1REUzQi1cdURFNkNcdURFNzVcdURFODRcdURFOUItXHVERTlGXHVERUExLVx1REVBRl18XHVEODNBW1x1REMwMC1cdURDQzRcdURDRDAtXHVEQ0Q2XXxcdUQ4M0JbXHVERTAwLVx1REUwM1x1REUwNS1cdURFMUZcdURFMjFcdURFMjJcdURFMjRcdURFMjdcdURFMjktXHVERTMyXHVERTM0LVx1REUzN1x1REUzOVx1REUzQlx1REU0Mlx1REU0N1x1REU0OVx1REU0Qlx1REU0RC1cdURFNEZcdURFNTFcdURFNTJcdURFNTRcdURFNTdcdURFNTlcdURFNUJcdURFNURcdURFNUZcdURFNjFcdURFNjJcdURFNjRcdURFNjctXHVERTZBXHVERTZDLVx1REU3Mlx1REU3NC1cdURFNzdcdURFNzktXHVERTdDXHVERTdFXHVERTgwLVx1REU4OVx1REU4Qi1cdURFOUJcdURFQTEtXHVERUEzXHVERUE1LVx1REVBOVx1REVBQi1cdURFQkJdfFx1RDg2OVtcdURDMDAtXHVERUQ2XHVERjAwLVx1REZGRl18XHVEODZEW1x1REMwMC1cdURGMzRcdURGNDAtXHVERkZGXXxcdUQ4NkVbXHVEQzAwLVx1REMxRFx1REMyMC1cdURGRkZdfFx1RDg3M1tcdURDMDAtXHVERUExXXxcdUQ4N0VbXHVEQzAwLVx1REUxRF18XHVEQjQwW1x1REQwMC1cdURERUZdL30pO3oucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWVzc2FnZSsiIChsaW5lOiAiK3RoaXMubGluZSsiLCBjb2w6ICIrdGhpcy5jb2wrIiwgcG9zOiAiK3RoaXMucG9zKyIpXG5cbiIrdGhpcy5zdGFja307dmFyIGJ0PXt9LEV0PXYoWyJ0eXBlb2YiLCJ2b2lkIiwiZGVsZXRlIiwiLS0iLCIrKyIsIiEiLCJ+IiwiLSIsIisiXSksQXQ9dihbIi0tIiwiKysiXSksRnQ9dihbIj0iLCIrPSIsIi09IiwiLz0iLCIqPSIsIioqPSIsIiU9IiwiPj49IiwiPDw9IiwiPj4+PSIsInw9IiwiXj0iLCImPSJdKSx3dD1mdW5jdGlvbihlLG4pe2Zvcih2YXIgdD0wO3Q8ZS5sZW5ndGg7Kyt0KWZvcih2YXIgcj1lW3RdLGk9MDtpPHIubGVuZ3RoOysraSluW3JbaV1dPXQrMTtyZXR1cm4gbn0oW1sifHwiXSxbIiYmIl0sWyJ8Il0sWyJeIl0sWyImIl0sWyI9PSIsIj09PSIsIiE9IiwiIT09Il0sWyI8IiwiPiIsIjw9IiwiPj0iLCJpbiIsImluc3RhbmNlb2YiXSxbIj4+IiwiPDwiLCI+Pj4iXSxbIisiLCItIl0sWyIqIiwiLyIsIiUiXSxbIioqIl1dLHt9KSxDdD0odChbImZvciIsImRvIiwid2hpbGUiLCJzd2l0Y2giXSksdChbImF0b20iLCJudW0iLCJzdHJpbmciLCJyZWdleHAiLCJuYW1lIl0pKTtQLnByb3RvdHlwZT1uZXcgQSxmdW5jdGlvbihlKXtmdW5jdGlvbiBuKG4sdCl7bi5ERUZNRVRIT0QoInRyYW5zZm9ybSIsZnVuY3Rpb24obixyKXt2YXIgaSxvO3JldHVybiBuLnB1c2godGhpcyksbi5iZWZvcmUmJihpPW4uYmVmb3JlKHRoaXMsdCxyKSksaT09PWUmJihuLmFmdGVyPyhuLnN0YWNrW24uc3RhY2subGVuZ3RoLTFdPWk9dGhpcyx0KGksbiksbz1uLmFmdGVyKGksciksbyE9PWUmJihpPW8pKTooaT10aGlzLHQoaSxuKSkpLG4ucG9wKHRoaXMpLGl9KX1mdW5jdGlvbiB0KGUsbil7cmV0dXJuIEooZSxmdW5jdGlvbihlKXtyZXR1cm4gZS50cmFuc2Zvcm0obiwhMCl9KX1uKEssZiksbihhZSxmdW5jdGlvbihlLG4pe2UubGFiZWw9ZS5sYWJlbC50cmFuc2Zvcm0obiksZS5ib2R5PWUuYm9keS50cmFuc2Zvcm0obil9KSxuKHRlLGZ1bmN0aW9uKGUsbil7ZS5ib2R5PWUuYm9keS50cmFuc2Zvcm0obil9KSxuKHJlLGZ1bmN0aW9uKGUsbil7ZS5ib2R5PXQoZS5ib2R5LG4pfSksbihjZSxmdW5jdGlvbihlLG4pe2UuY29uZGl0aW9uPWUuY29uZGl0aW9uLnRyYW5zZm9ybShuKSxlLmJvZHk9ZS5ib2R5LnRyYW5zZm9ybShuKX0pLG4ocGUsZnVuY3Rpb24oZSxuKXtlLmluaXQmJihlLmluaXQ9ZS5pbml0LnRyYW5zZm9ybShuKSksZS5jb25kaXRpb24mJihlLmNvbmRpdGlvbj1lLmNvbmRpdGlvbi50cmFuc2Zvcm0obikpLGUuc3RlcCYmKGUuc3RlcD1lLnN0ZXAudHJhbnNmb3JtKG4pKSxlLmJvZHk9ZS5ib2R5LnRyYW5zZm9ybShuKX0pLG4oZGUsZnVuY3Rpb24oZSxuKXtlLmluaXQ9ZS5pbml0LnRyYW5zZm9ybShuKSxlLm9iamVjdD1lLm9iamVjdC50cmFuc2Zvcm0obiksZS5ib2R5PWUuYm9keS50cmFuc2Zvcm0obil9KSxuKERlLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uPWUuZXhwcmVzc2lvbi50cmFuc2Zvcm0obiksZS5ib2R5PWUuYm9keS50cmFuc2Zvcm0obil9KSxuKFNlLGZ1bmN0aW9uKGUsbil7ZS52YWx1ZSYmKGUudmFsdWU9ZS52YWx1ZS50cmFuc2Zvcm0obikpfSksbihPZSxmdW5jdGlvbihlLG4pe2UubGFiZWwmJihlLmxhYmVsPWUubGFiZWwudHJhbnNmb3JtKG4pKX0pLG4oemUsZnVuY3Rpb24oZSxuKXtlLmNvbmRpdGlvbj1lLmNvbmRpdGlvbi50cmFuc2Zvcm0obiksZS5ib2R5PWUuYm9keS50cmFuc2Zvcm0obiksZS5hbHRlcm5hdGl2ZSYmKGUuYWx0ZXJuYXRpdmU9ZS5hbHRlcm5hdGl2ZS50cmFuc2Zvcm0obikpfSksbihOZSxmdW5jdGlvbihlLG4pe2UuZXhwcmVzc2lvbj1lLmV4cHJlc3Npb24udHJhbnNmb3JtKG4pLGUuYm9keT10KGUuYm9keSxuKX0pLG4oSWUsZnVuY3Rpb24oZSxuKXtlLmV4cHJlc3Npb249ZS5leHByZXNzaW9uLnRyYW5zZm9ybShuKSxlLmJvZHk9dChlLmJvZHksbil9KSxuKFBlLGZ1bmN0aW9uKGUsbil7ZS5ib2R5PXQoZS5ib2R5LG4pLGUuYmNhdGNoJiYoZS5iY2F0Y2g9ZS5iY2F0Y2gudHJhbnNmb3JtKG4pKSxlLmJmaW5hbGx5JiYoZS5iZmluYWxseT1lLmJmaW5hbGx5LnRyYW5zZm9ybShuKSl9KSxuKFVlLGZ1bmN0aW9uKGUsbil7ZS5hcmduYW1lPWUuYXJnbmFtZS50cmFuc2Zvcm0obiksZS5ib2R5PXQoZS5ib2R5LG4pfSksbihMZSxmdW5jdGlvbihlLG4pe2UuZGVmaW5pdGlvbnM9dChlLmRlZmluaXRpb25zLG4pfSksbihaZSxmdW5jdGlvbihlLG4pe2UubmFtZT1lLm5hbWUudHJhbnNmb3JtKG4pLGUudmFsdWUmJihlLnZhbHVlPWUudmFsdWUudHJhbnNmb3JtKG4pKX0pLG4od2UsZnVuY3Rpb24oZSxuKXtlLm5hbWVzPXQoZS5uYW1lcyxuKX0pLG4oeWUsZnVuY3Rpb24oZSxuKXtlLm5hbWUmJihlLm5hbWU9ZS5uYW1lLnRyYW5zZm9ybShuKSksZS5hcmduYW1lcz10KGUuYXJnbmFtZXMsbiksZS5ib2R5IGluc3RhbmNlb2YgSz9lLmJvZHk9ZS5ib2R5LnRyYW5zZm9ybShuKTplLmJvZHk9dChlLmJvZHksbil9KSxuKEtlLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uPWUuZXhwcmVzc2lvbi50cmFuc2Zvcm0obiksZS5hcmdzPXQoZS5hcmdzLG4pfSksbihlbixmdW5jdGlvbihlLG4pe2UuY2FyPWUuY2FyLnRyYW5zZm9ybShuKSxlLmNkcj1lLmNkci50cmFuc2Zvcm0obil9KSxuKHRuLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uPWUuZXhwcmVzc2lvbi50cmFuc2Zvcm0obil9KSxuKHJuLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uPWUuZXhwcmVzc2lvbi50cmFuc2Zvcm0obiksZS5wcm9wZXJ0eT1lLnByb3BlcnR5LnRyYW5zZm9ybShuKX0pLG4odHQsZnVuY3Rpb24oZSxuKXtlLmV4cHJlc3Npb24mJihlLmV4cHJlc3Npb249ZS5leHByZXNzaW9uLnRyYW5zZm9ybShuKSl9KSxuKG9uLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uPWUuZXhwcmVzc2lvbi50cmFuc2Zvcm0obil9KSxuKHNuLGZ1bmN0aW9uKGUsbil7ZS5sZWZ0PWUubGVmdC50cmFuc2Zvcm0obiksZS5yaWdodD1lLnJpZ2h0LnRyYW5zZm9ybShuKX0pLG4oY24sZnVuY3Rpb24oZSxuKXtlLmNvbmRpdGlvbj1lLmNvbmRpdGlvbi50cmFuc2Zvcm0obiksZS5jb25zZXF1ZW50PWUuY29uc2VxdWVudC50cmFuc2Zvcm0obiksZS5hbHRlcm5hdGl2ZT1lLmFsdGVybmF0aXZlLnRyYW5zZm9ybShuKX0pLG4obG4sZnVuY3Rpb24oZSxuKXtlLmVsZW1lbnRzPXQoZS5lbGVtZW50cyxuKX0pLG4ocG4sZnVuY3Rpb24oZSxuKXtlLnByb3BlcnRpZXM9dChlLnByb3BlcnRpZXMsbil9KSxuKGRuLGZ1bmN0aW9uKGUsbil7ZS5rZXkgaW5zdGFuY2VvZiBLJiYoZS5rZXk9ZS5rZXkudHJhbnNmb3JtKG4pKSxlLnZhbHVlPWUudmFsdWUudHJhbnNmb3JtKG4pfSksbihfbixmdW5jdGlvbihlLG4pe2UubmFtZSYmKGUubmFtZT1lLm5hbWUudHJhbnNmb3JtKG4pKSxlLmV4dGVuZHMmJihlLmV4dGVuZHM9ZS5leHRlbmRzLnRyYW5zZm9ybShuKSksZS5wcm9wZXJ0aWVzPXQoZS5wcm9wZXJ0aWVzLG4pfSksbihfZSxmdW5jdGlvbihlLG4pe2UuZXhwcmVzc2lvbj1lLmV4cHJlc3Npb24udHJhbnNmb3JtKG4pfSksbihrZSxmdW5jdGlvbihlLG4pe2Zvcih2YXIgdD0wO3Q8ZS5zZWdtZW50cy5sZW5ndGg7dCsrKWUuc2VnbWVudHNbdF1pbnN0YW5jZW9mIHhlfHwoZS5zZWdtZW50c1t0XT1lLnNlZ21lbnRzW3RdLnRyYW5zZm9ybShuKSl9KSxuKENlLGZ1bmN0aW9uKGUsbil7ZS50ZW1wbGF0ZV9zdHJpbmc9ZS50ZW1wbGF0ZV9zdHJpbmcudHJhbnNmb3JtKG4pfSl9KCksVS5uZXh0X2lkPTEsVS5wcm90b3R5cGU9e3VubWFuZ2xlYWJsZTpmdW5jdGlvbihlKXtyZXR1cm4gZXx8KGU9e30pLHRoaXMuZ2xvYmFsJiYhZS50b3BsZXZlbHx8dGhpcy5leHBvcnR8fHRoaXMub2JqZWN0X2Rlc3RydWN0dXJpbmdfYXJnfHx0aGlzLnVuZGVjbGFyZWR8fCFlLmV2YWwmJih0aGlzLnNjb3BlLnVzZXNfZXZhbHx8dGhpcy5zY29wZS51c2VzX3dpdGgpfHxlLmtlZXBfZm5hbWVzJiYodGhpcy5vcmlnWzBdaW5zdGFuY2VvZiAkbnx8dGhpcy5vcmlnWzBdaW5zdGFuY2VvZiBTbil8fHRoaXMub3JpZ1swXWluc3RhbmNlb2YgVG58fGUua2VlcF9jbGFzc25hbWVzJiYodGhpcy5vcmlnWzBdaW5zdGFuY2VvZiBxbnx8dGhpcy5vcmlnWzBdaW5zdGFuY2VvZiBPbil9LG1hbmdsZTpmdW5jdGlvbihlKXt2YXIgbj1lLmNhY2hlJiZlLmNhY2hlLnByb3BzO2lmKHRoaXMuZ2xvYmFsJiZuJiZuLmhhcyh0aGlzLm5hbWUpKXRoaXMubWFuZ2xlZF9uYW1lPW4uZ2V0KHRoaXMubmFtZSk7ZWxzZSBpZighdGhpcy5tYW5nbGVkX25hbWUmJiF0aGlzLnVubWFuZ2xlYWJsZShlKSl7dmFyIHQ9dGhpcy5zY29wZTshZS5zY3Jld19pZTgmJnRoaXMub3JpZ1swXWluc3RhbmNlb2YgJG4mJih0PXQucGFyZW50X3Njb3BlKSx0aGlzLm1hbmdsZWRfbmFtZT10Lm5leHRfbWFuZ2xlZChlLHRoaXMpLHRoaXMuZ2xvYmFsJiZuJiZuLnNldCh0aGlzLm5hbWUsdGhpcy5tYW5nbGVkX25hbWUpfX19LHZlLkRFRk1FVEhPRCgiZmlndXJlX291dF9zY29wZSIsZnVuY3Rpb24oZSl7ZT1zKGUse3NjcmV3X2llODohMCxjYWNoZTpudWxsfSk7dmFyIG4sdD10aGlzLHI9dC5wYXJlbnRfc2NvcGU9bnVsbCxpPW5ldyBnLG89bnVsbCx1PSExLGE9MCxjPW51bGwsZj1uZXcgQShmdW5jdGlvbih0LHMpe2lmKHQuaXNfYmxvY2tfc2NvcGUoKSl7dmFyIGw9cjtyZXR1cm4gcj1uZXcgbWUodCksci5pbml0X3Njb3BlX3ZhcnMoYSksci5wYXJlbnRfc2NvcGU9bCx0IGluc3RhbmNlb2YgbWV8fChyLnVzZXNfd2l0aD1sLnVzZXNfd2l0aCxyLnVzZXNfZXZhbD1sLnVzZXNfZXZhbCxyLmRpcmVjdGl2ZXM9bC5kaXJlY3RpdmVzKSxzKCkscj1sLCEwfWlmKHQgaW5zdGFuY2VvZiB3ZSYmdC5pc19hcnJheT09PSExKXJldHVybiBjPXQscygpLGM9bnVsbCwhMDtpZih0IGluc3RhbmNlb2YgbWUpe3QuaW5pdF9zY29wZV92YXJzKGEpO3ZhciBsPXQucGFyZW50X3Njb3BlPXIscD1vLGQ9aTtyZXR1cm4gbz1yPXQsaT1uZXcgZywrK2EscygpLC0tYSxyPWwsbz1wLGk9ZCwhMH1pZih0IGluc3RhbmNlb2YgSmUmJihuPSEwLHMoKSxuPSExKSx0IGluc3RhbmNlb2YgYWUpe3ZhciBEPXQubGFiZWw7aWYoaS5oYXMoRC5uYW1lKSl0aHJvdyBuZXcgRXJyb3IoaCgiTGFiZWwge25hbWV9IGRlZmluZWQgdHdpY2UiLEQpKTtyZXR1cm4gaS5zZXQoRC5uYW1lLEQpLHMoKSxpLmRlbChELm5hbWUpLCEwfWlmKHQgaW5zdGFuY2VvZiBEZSlmb3IodmFyIG09cjttO209bS5wYXJlbnRfc2NvcGUpbS51c2VzX3dpdGg9ITA7ZWxzZSBpZih0IGluc3RhbmNlb2YgYm4mJih0LnNjb3BlPXIpLHQgaW5zdGFuY2VvZiBCbiYmKHQub2JqZWN0X2Rlc3RydWN0dXJpbmdfYXJnPSEhYyxvLmRlZl92YXJpYWJsZSh0LG4pKSx0IGluc3RhbmNlb2Ygam4mJih0LnRoZWRlZj10LHQucmVmZXJlbmNlcz1bXSksdCBpbnN0YW5jZW9mICRuKW8uZGVmX2Z1bmN0aW9uKHQsbik7ZWxzZSBpZih0IGluc3RhbmNlb2YgU24pe2Zvcih2YXIgdj1vLnBhcmVudF9zY29wZTt2LmlzX2Jsb2NrX3Njb3BlKCk7KXY9di5wYXJlbnRfc2NvcGU7KHQuc2NvcGU9dikuZGVmX2Z1bmN0aW9uKHQsbil9ZWxzZSBpZih0IGluc3RhbmNlb2YgcW4pby5kZWZfdmFyaWFibGUodCxuKTtlbHNlIGlmKHQgaW5zdGFuY2VvZiB6bilyLmRlZl92YXJpYWJsZSh0LG4pO2Vsc2UgaWYodCBpbnN0YW5jZW9mIE9uKSh0LnNjb3BlPW8ucGFyZW50X3Njb3BlKS5kZWZfZnVuY3Rpb24odCxuKTtlbHNlIGlmKHQgaW5zdGFuY2VvZiBWZSl1PXQuaGFzX2NvbnN0X3ByYWdtYSgpO2Vsc2UgaWYodCBpbnN0YW5jZW9mIHdufHx0IGluc3RhbmNlb2Yga258fHQgaW5zdGFuY2VvZiB4bil7dmFyIF89KHQgaW5zdGFuY2VvZiBDbj9yOm8pLmRlZl92YXJpYWJsZSh0LG4pO18uY29uc3RhbnQ9dCBpbnN0YW5jZW9mIGtufHx1LF8uZGVzdHJ1Y3R1cmluZz1jLF8uaW5pdD1mLnBhcmVudCgpLnZhbHVlfWVsc2UgaWYodCBpbnN0YW5jZW9mIE1uKShlLnNjcmV3X2llOD9yOm8pLmRlZl92YXJpYWJsZSh0KTtlbHNlIGlmKHQgaW5zdGFuY2VvZiBJbil7dmFyIHk9aS5nZXQodC5uYW1lKTtpZigheSl0aHJvdyBuZXcgRXJyb3IoaCgiVW5kZWZpbmVkIGxhYmVsIHtuYW1lfSBbe2xpbmV9LHtjb2x9XSIse25hbWU6dC5uYW1lLGxpbmU6dC5zdGFydC5saW5lLGNvbDp0LnN0YXJ0LmNvbH0pKTt0LnRoZWRlZj15fX0pO3Qud2FsayhmKTt2YXIgbD1udWxsLHA9bnVsbCxkPXQuZ2xvYmFscz1uZXcgZyxmPW5ldyBBKGZ1bmN0aW9uKG4scil7ZnVuY3Rpb24gaShlLG4pe3ZhciB0PWYucGFyZW50KG4pO3JldHVybiB0IGluc3RhbmNlb2Ygb24mJigiKysiPT09dC5vcGVyYXRvcnx8Ii0tIj09PXQub3BlcmF0b3IpfHx0IGluc3RhbmNlb2YgZm4mJnQubGVmdD09PWV8fHQgaW5zdGFuY2VvZiBLZSYmdC5leHByZXNzaW9uPT09ZXx8KHQgaW5zdGFuY2VvZiBubiYmdC5leHByZXNzaW9uPT09ZT9pKHQsbisxKTp2b2lkIDApfWlmKG4gaW5zdGFuY2VvZiB5ZSl7dmFyIG89bDtyZXR1cm4gbD1uLHIoKSxsPW8sITB9aWYobiBpbnN0YW5jZW9mIF9uKXt2YXIgdT1wO3JldHVybiBwPW4scigpLHA9dSwhMH1pZihuIGluc3RhbmNlb2YgT2UmJm4ubGFiZWwpcmV0dXJuIG4ubGFiZWwudGhlZGVmLnJlZmVyZW5jZXMucHVzaChuKSwhMDtpZihuIGluc3RhbmNlb2YgSG4pe3ZhciBhPW4ubmFtZTtpZigiZXZhbCI9PWEmJmYucGFyZW50KClpbnN0YW5jZW9mIEtlKWZvcih2YXIgcz1uLnNjb3BlO3MmJiFzLnVzZXNfZXZhbDtzPXMucGFyZW50X3Njb3BlKXMudXNlc19ldmFsPSEwO3ZhciBjPW4uc2NvcGUuZmluZF92YXJpYWJsZShhKTtpZihuLnNjb3BlIGluc3RhbmNlb2YgeWUmJiJhcmd1bWVudHMiPT1hJiYobi5zY29wZS51c2VzX2FyZ3VtZW50cz0hMCksIWMpe3ZhciBoO2QuaGFzKGEpP2g9ZC5nZXQoYSk6KGg9bmV3IFUodCxkLnNpemUoKSxuKSxoLnVuZGVjbGFyZWQ9ITAsaC5nbG9iYWw9ITAsZC5zZXQoYSxoKSksYz1ofXJldHVybiBuLnRoZWRlZj1jLGkobiwwKSYmKGMubW9kaWZpZWQ9ITApLG4ucmVmZXJlbmNlKGUpLCEwfX0pO3Qud2FsayhmKSxlLmNhY2hlJiYodGhpcy5jbmFtZT1lLmNhY2hlLmNuYW1lKX0pLG1lLkRFRk1FVEhPRCgiaW5pdF9zY29wZV92YXJzIixmdW5jdGlvbihlKXt0aGlzLnZhcmlhYmxlcz1uZXcgZyx0aGlzLmZ1bmN0aW9ucz1uZXcgZyx0aGlzLnVzZXNfd2l0aD0hMSx0aGlzLnVzZXNfZXZhbD0hMSx0aGlzLnBhcmVudF9zY29wZT1udWxsLHRoaXMuZW5jbG9zZWQ9W10sdGhpcy5jbmFtZT0tMSx0aGlzLm5lc3Rpbmc9ZX0pLEsuREVGTUVUSE9EKCJpc19ibG9ja19zY29wZSIsZnVuY3Rpb24oKXtyZXR1cm4hMX0pLHJlLkRFRk1FVEhPRCgiaXNfYmxvY2tfc2NvcGUiLGZ1bmN0aW9uKCl7cmV0dXJuISh0aGlzIGluc3RhbmNlb2YgeWV8fHRoaXMgaW5zdGFuY2VvZiB2ZXx8dGhpcyBpbnN0YW5jZW9mIF9ufHx0aGlzIGluc3RhbmNlb2YgamUpfSkseWUuREVGTUVUSE9EKCJpbml0X3Njb3BlX3ZhcnMiLGZ1bmN0aW9uKCl7bWUucHJvdG90eXBlLmluaXRfc2NvcGVfdmFycy5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy51c2VzX2FyZ3VtZW50cz0hMTt2YXIgZT1uZXcgWmUoe25hbWU6ImFyZ3VtZW50cyIsc3RhcnQ6dGhpcy5zdGFydCxlbmQ6dGhpcy5lbmR9KSxuPW5ldyBVKHRoaXMsdGhpcy52YXJpYWJsZXMuc2l6ZSgpLGUpO3RoaXMudmFyaWFibGVzLnNldChlLm5hbWUsbil9KSxIbi5ERUZNRVRIT0QoInJlZmVyZW5jZSIsZnVuY3Rpb24oZSl7dmFyIG49dGhpcy5kZWZpbml0aW9uKCk7bi5yZWZlcmVuY2VzLnB1c2godGhpcyk7Zm9yKHZhciB0PXRoaXMuc2NvcGU7dCYmKGQodC5lbmNsb3NlZCxuKSx0IT09bi5zY29wZSk7KWUua2VlcF9mbmFtZXMmJnQudmFyaWFibGVzLmVhY2goZnVuY3Rpb24oZSl7ZChuLnNjb3BlLmVuY2xvc2VkLGUpfSksdD10LnBhcmVudF9zY29wZTt0aGlzLmZyYW1lPXRoaXMuc2NvcGUubmVzdGluZy1uLnNjb3BlLm5lc3Rpbmd9KSxtZS5ERUZNRVRIT0QoImZpbmRfdmFyaWFibGUiLGZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgYm4mJihlPWUubmFtZSksdGhpcy52YXJpYWJsZXMuZ2V0KGUpfHx0aGlzLnBhcmVudF9zY29wZSYmdGhpcy5wYXJlbnRfc2NvcGUuZmluZF92YXJpYWJsZShlKX0pLG1lLkRFRk1FVEhPRCgiZGVmX2Z1bmN0aW9uIixmdW5jdGlvbihlLG4pe3RoaXMuZnVuY3Rpb25zLnNldChlLm5hbWUsdGhpcy5kZWZfdmFyaWFibGUoZSxuKSl9KSxtZS5ERUZNRVRIT0QoImRlZl92YXJpYWJsZSIsZnVuY3Rpb24oZSxuKXt2YXIgdDtyZXR1cm4gdGhpcy52YXJpYWJsZXMuaGFzKGUubmFtZSk/KHQ9dGhpcy52YXJpYWJsZXMuZ2V0KGUubmFtZSksdC5vcmlnLnB1c2goZSkpOih0PW5ldyBVKHRoaXMsdGhpcy52YXJpYWJsZXMuc2l6ZSgpLGUpLHRoaXMudmFyaWFibGVzLnNldChlLm5hbWUsdCksdC5vYmplY3RfZGVzdHJ1Y3R1cmluZ19hcmc9ZS5vYmplY3RfZGVzdHJ1Y3R1cmluZ19hcmcsbiYmKHQuZXhwb3J0PSEwKSx0Lmdsb2JhbD0hKHRoaXMucGFyZW50X3Njb3BlfHxlIGluc3RhbmNlb2YgQ24pKSxlLnRoZWRlZj10fSksbWUuREVGTUVUSE9EKCJuZXh0X21hbmdsZWQiLGZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuZW5jbG9zZWQ7ZTpmb3IoOzspe3ZhciB0PWt0KCsrdGhpcy5jbmFtZSk7aWYoVCh0KSYmIShlLmV4Y2VwdC5pbmRleE9mKHQpPj0wKSl7Zm9yKHZhciByPW4ubGVuZ3RoOy0tcj49MDspe3ZhciBpPW5bcl0sbz1pLm1hbmdsZWRfbmFtZXx8aS51bm1hbmdsZWFibGUoZSkmJmkubmFtZTtpZih0PT1vKWNvbnRpbnVlIGV9cmV0dXJuIHR9fX0pLEVlLkRFRk1FVEhPRCgibmV4dF9tYW5nbGVkIixmdW5jdGlvbihlLG4pe2Zvcih2YXIgdD1uLm9yaWdbMF1pbnN0YW5jZW9mIEJuJiZ0aGlzLm5hbWUmJnRoaXMubmFtZS5kZWZpbml0aW9uKCkscj10P3QubWFuZ2xlZF9uYW1lfHx0Lm5hbWU6bnVsbDs7KXt2YXIgaT15ZS5wcm90b3R5cGUubmV4dF9tYW5nbGVkLmNhbGwodGhpcyxlLG4pO2lmKCFyfHxyIT1pKXJldHVybiBpfX0pLGJuLkRFRk1FVEhPRCgidW5tYW5nbGVhYmxlIixmdW5jdGlvbihlKXt2YXIgbj10aGlzLmRlZmluaXRpb24oKTtyZXR1cm4gbiYmbi51bm1hbmdsZWFibGUoZSl9KSxBbi5ERUZNRVRIT0QoInVubWFuZ2xlYWJsZSIsZnVuY3Rpb24oKXtyZXR1cm4hMH0pLGpuLkRFRk1FVEhPRCgidW5tYW5nbGVhYmxlIixmdW5jdGlvbigpe3JldHVybiExfSksYm4uREVGTUVUSE9EKCJ1bnJlZmVyZW5jZWQiLGZ1bmN0aW9uKCl7cmV0dXJuIDA9PXRoaXMuZGVmaW5pdGlvbigpLnJlZmVyZW5jZXMubGVuZ3RoJiYhKHRoaXMuc2NvcGUudXNlc19ldmFsfHx0aGlzLnNjb3BlLnVzZXNfd2l0aCl9KSxibi5ERUZNRVRIT0QoInVuZGVjbGFyZWQiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGVmaW5pdGlvbigpLnVuZGVjbGFyZWR9KSxJbi5ERUZNRVRIT0QoInVuZGVjbGFyZWQiLGZ1bmN0aW9uKCl7cmV0dXJuITF9KSxqbi5ERUZNRVRIT0QoInVuZGVjbGFyZWQiLGZ1bmN0aW9uKCl7cmV0dXJuITF9KSxibi5ERUZNRVRIT0QoImRlZmluaXRpb24iLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudGhlZGVmfSksYm4uREVGTUVUSE9EKCJnbG9iYWwiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGVmaW5pdGlvbigpLmdsb2JhbH0pLFZlLkRFRk1FVEhPRCgiaGFzX2NvbnN0X3ByYWdtYSIsZnVuY3Rpb24oKXt2YXIgZT10aGlzLnN0YXJ0JiZ0aGlzLnN0YXJ0LmNvbW1lbnRzX2JlZm9yZSxuPWUmJmVbZS5sZW5ndGgtMV07cmV0dXJuIG4mJi9AY29uc3RcYi8udGVzdChuLnZhbHVlKX0pLHZlLkRFRk1FVEhPRCgiX2RlZmF1bHRfbWFuZ2xlcl9vcHRpb25zIixmdW5jdGlvbihlKXtyZXR1cm4gcyhlLHtleGNlcHQ6W10sZXZhbDohMSxzb3J0OiExLHRvcGxldmVsOiExLHNjcmV3X2llODohMCxrZWVwX2ZuYW1lczohMSxrZWVwX2NsYXNzbmFtZXM6ITF9KX0pLHZlLkRFRk1FVEhPRCgibWFuZ2xlX25hbWVzIixmdW5jdGlvbihlKXtlPXRoaXMuX2RlZmF1bHRfbWFuZ2xlcl9vcHRpb25zKGUpLGUuZXhjZXB0LnB1c2goImFyZ3VtZW50cyIpO3ZhciBuPS0xLHQ9W107ZS5jYWNoZSYmdGhpcy5nbG9iYWxzLmVhY2goZnVuY3Rpb24obil7ZS5leGNlcHQuaW5kZXhPZihuLm5hbWUpPDAmJnQucHVzaChuKX0pO3ZhciByPW5ldyBBKGZ1bmN0aW9uKGksbyl7aWYoaSBpbnN0YW5jZW9mIGFlKXt2YXIgdT1uO3JldHVybiBvKCksbj11LCEwfWlmKGkgaW5zdGFuY2VvZiBtZSl7dmFyIGE9KHIucGFyZW50KCksW10pO3JldHVybiBpLnZhcmlhYmxlcy5lYWNoKGZ1bmN0aW9uKG4pe2UuZXhjZXB0LmluZGV4T2Yobi5uYW1lKTwwJiZhLnB1c2gobil9KSx2b2lkIHQucHVzaC5hcHBseSh0LGEpfWlmKGkgaW5zdGFuY2VvZiBqbil7dmFyIHM7ZG8gcz1rdCgrK24pO3doaWxlKCFUKHMpKTtyZXR1cm4gaS5tYW5nbGVkX25hbWU9cywhMH12YXIgYz1lLnNjcmV3X2llOCYmaSBpbnN0YW5jZW9mIE1ufHxpIGluc3RhbmNlb2YgQ247aWYoYylyZXR1cm4gdm9pZCB0LnB1c2goaS5kZWZpbml0aW9uKCkpfSk7dGhpcy53YWxrKHIpLHQuZm9yRWFjaChmdW5jdGlvbihuKXtuLmRlc3RydWN0dXJpbmcmJiFuLmRlc3RydWN0dXJpbmcuaXNfYXJyYXl8fG4ubWFuZ2xlKGUpfSksZS5jYWNoZSYmKGUuY2FjaGUuY25hbWU9dGhpcy5jbmFtZSl9KSx2ZS5ERUZNRVRIT0QoImNvbXB1dGVfY2hhcl9mcmVxdWVuY3kiLGZ1bmN0aW9uKGUpe2U9dGhpcy5fZGVmYXVsdF9tYW5nbGVyX29wdGlvbnMoZSk7dmFyIG49bmV3IEEoZnVuY3Rpb24obil7biBpbnN0YW5jZW9mIFJuP2t0LmNvbnNpZGVyKG4ucHJpbnRfdG9fc3RyaW5nKCkpOm4gaW5zdGFuY2VvZiBUZT9rdC5jb25zaWRlcigicmV0dXJuIik6biBpbnN0YW5jZW9mICRlP2t0LmNvbnNpZGVyKCJ0aHJvdyIpOm4gaW5zdGFuY2VvZiBNZT9rdC5jb25zaWRlcigiY29udGludWUiKTpuIGluc3RhbmNlb2YgcWU/a3QuY29uc2lkZXIoImJyZWFrIik6biBpbnN0YW5jZW9mIGVlP2t0LmNvbnNpZGVyKCJkZWJ1Z2dlciIpOm4gaW5zdGFuY2VvZiBuZT9rdC5jb25zaWRlcihuLnZhbHVlKTpuIGluc3RhbmNlb2YgbGU/a3QuY29uc2lkZXIoIndoaWxlIik6biBpbnN0YW5jZW9mIGZlP2t0LmNvbnNpZGVyKCJkbyB3aGlsZSIpOm4gaW5zdGFuY2VvZiB6ZT8oa3QuY29uc2lkZXIoImlmIiksbi5hbHRlcm5hdGl2ZSYma3QuY29uc2lkZXIoImVsc2UiKSk6biBpbnN0YW5jZW9mIFZlP2t0LmNvbnNpZGVyKCJ2YXIiKTpuIGluc3RhbmNlb2YgWWU/a3QuY29uc2lkZXIoImNvbnN0Iik6biBpbnN0YW5jZW9mIHllP2t0LmNvbnNpZGVyKCJmdW5jdGlvbiIpOm4gaW5zdGFuY2VvZiBwZT9rdC5jb25zaWRlcigiZm9yIik6biBpbnN0YW5jZW9mIGRlP2t0LmNvbnNpZGVyKCJmb3IgaW4iKTpuIGluc3RhbmNlb2YgTmU/a3QuY29uc2lkZXIoInN3aXRjaCIpOm4gaW5zdGFuY2VvZiBJZT9rdC5jb25zaWRlcigiY2FzZSIpOm4gaW5zdGFuY2VvZiBIZT9rdC5jb25zaWRlcigiZGVmYXVsdCIpOm4gaW5zdGFuY2VvZiBEZT9rdC5jb25zaWRlcigid2l0aCIpOm4gaW5zdGFuY2VvZiBEbj9rdC5jb25zaWRlcigic2V0IisoInN0cmluZyI9PXR5cGVvZiBuLmtleT9uLmtleToiIikpOm4gaW5zdGFuY2VvZiBtbj9rdC5jb25zaWRlcigiZ2V0IisoInN0cmluZyI9PXR5cGVvZiBuLmtleT9uLmtleToiIikpOm4gaW5zdGFuY2VvZiBobiYmInN0cmluZyI9PXR5cGVvZiBuLmtleT9rdC5jb25zaWRlcihuLmtleSk6biBpbnN0YW5jZW9mIHZuJiYic3RyaW5nIj09dHlwZW9mIG4ua2V5P2t0LmNvbnNpZGVyKG4ua2V5KTpuIGluc3RhbmNlb2YgUWU/a3QuY29uc2lkZXIoIm5ldyIpOm4gaW5zdGFuY2VvZiBQbj9rdC5jb25zaWRlcigidGhpcyIpOm4gaW5zdGFuY2VvZiBVbj9rdC5jb25zaWRlcigic3VwZXIiKTpuIGluc3RhbmNlb2YgUGU/a3QuY29uc2lkZXIoInRyeSIpOm4gaW5zdGFuY2VvZiBVZT9rdC5jb25zaWRlcigiY2F0Y2giKTpuIGluc3RhbmNlb2YgUmU/a3QuY29uc2lkZXIoImZpbmFsbHkiKTpuIGluc3RhbmNlb2YgdHQ/a3QuY29uc2lkZXIoInlpZWxkIik6biBpbnN0YW5jZW9mIGJuJiZuLnVubWFuZ2xlYWJsZShlKT9rdC5jb25zaWRlcihuLm5hbWUpOm4gaW5zdGFuY2VvZiBvbnx8biBpbnN0YW5jZW9mIHNuP2t0LmNvbnNpZGVyKG4ub3BlcmF0b3IpOm4gaW5zdGFuY2VvZiB0biYma3QuY29uc2lkZXIobi5wcm9wZXJ0eSl9KTt0aGlzLndhbGsobiksa3Quc29ydCgpfSk7dmFyIGt0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3I9T2JqZWN0LmNyZWF0ZShudWxsKSx0PWkuc3BsaXQoIiIpLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gZS5jaGFyQ29kZUF0KDApfSksdC5mb3JFYWNoKGZ1bmN0aW9uKGUpe3JbZV09MH0pfWZ1bmN0aW9uIG4oZSl7dmFyIG49IiIscj01NDtlKys7ZG8gZS0tLG4rPVN0cmluZy5mcm9tQ2hhckNvZGUodFtlJXJdKSxlPU1hdGguZmxvb3IoZS9yKSxyPTY0O3doaWxlKGU+MCk7cmV0dXJuIG59dmFyIHQscixpPSJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJF8wMTIzNDU2Nzg5IjtyZXR1cm4gbi5jb25zaWRlcj1mdW5jdGlvbihlKXtmb3IodmFyIG49ZS5sZW5ndGg7LS1uPj0wOyl7dmFyIHQ9ZS5jaGFyQ29kZUF0KG4pO3QgaW4gciYmKytyW3RdfX0sbi5zb3J0PWZ1bmN0aW9uKCl7dD1tKHQsZnVuY3Rpb24oZSxuKXtyZXR1cm4gUyhlKSYmIVMobik/MTpTKG4pJiYhUyhlKT8tMTpyW25dLXJbZV19KX0sbi5yZXNldD1lLGUoKSxuLmdldD1mdW5jdGlvbigpe3JldHVybiB0fSxuLmZyZXE9ZnVuY3Rpb24oKXtyZXR1cm4gcn0sbn0oKTt2ZS5ERUZNRVRIT0QoInNjb3BlX3dhcm5pbmdzIixmdW5jdGlvbihlKXtlPXMoZSx7dW5kZWNsYXJlZDohMSx1bnJlZmVyZW5jZWQ6ITAsYXNzaWduX3RvX2dsb2JhbDohMCxmdW5jX2FyZ3VtZW50czohMCxuZXN0ZWRfZGVmdW5zOiEwLGV2YWw6ITB9KTt2YXIgbj1uZXcgQShmdW5jdGlvbih0KXtpZihlLnVuZGVjbGFyZWQmJnQgaW5zdGFuY2VvZiBIbiYmdC51bmRlY2xhcmVkKCkmJksud2FybigiVW5kZWNsYXJlZCBzeW1ib2w6IHtuYW1lfSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHsKbmFtZTp0Lm5hbWUsZmlsZTp0LnN0YXJ0LmZpbGUsbGluZTp0LnN0YXJ0LmxpbmUsY29sOnQuc3RhcnQuY29sfSksZS5hc3NpZ25fdG9fZ2xvYmFsKXt2YXIgcj1udWxsO3QgaW5zdGFuY2VvZiBmbiYmdC5sZWZ0IGluc3RhbmNlb2YgSG4/cj10LmxlZnQ6dCBpbnN0YW5jZW9mIGRlJiZ0LmluaXQgaW5zdGFuY2VvZiBIbiYmKHI9dC5pbml0KSxyJiYoci51bmRlY2xhcmVkKCl8fHIuZ2xvYmFsKCkmJnIuc2NvcGUhPT1yLmRlZmluaXRpb24oKS5zY29wZSkmJksud2Fybigie21zZ306IHtuYW1lfSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHttc2c6ci51bmRlY2xhcmVkKCk/IkFjY2lkZW50YWwgZ2xvYmFsPyI6IkFzc2lnbm1lbnQgdG8gZ2xvYmFsIixuYW1lOnIubmFtZSxmaWxlOnIuc3RhcnQuZmlsZSxsaW5lOnIuc3RhcnQubGluZSxjb2w6ci5zdGFydC5jb2x9KX1lLmV2YWwmJnQgaW5zdGFuY2VvZiBIbiYmdC51bmRlY2xhcmVkKCkmJiJldmFsIj09dC5uYW1lJiZLLndhcm4oIkV2YWwgaXMgdXNlZCBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHQuc3RhcnQpLGUudW5yZWZlcmVuY2VkJiYodCBpbnN0YW5jZW9mIEZufHx0IGluc3RhbmNlb2Ygam4pJiYhKHQgaW5zdGFuY2VvZiBNbikmJnQudW5yZWZlcmVuY2VkKCkmJksud2Fybigie3R5cGV9IHtuYW1lfSBpcyBkZWNsYXJlZCBidXQgbm90IHJlZmVyZW5jZWQgW3tmaWxlfTp7bGluZX0se2NvbH1dIix7dHlwZTp0IGluc3RhbmNlb2Ygam4/IkxhYmVsIjoiU3ltYm9sIixuYW1lOnQubmFtZSxmaWxlOnQuc3RhcnQuZmlsZSxsaW5lOnQuc3RhcnQubGluZSxjb2w6dC5zdGFydC5jb2x9KSxlLmZ1bmNfYXJndW1lbnRzJiZ0IGluc3RhbmNlb2YgeWUmJnQudXNlc19hcmd1bWVudHMmJksud2FybigiYXJndW1lbnRzIHVzZWQgaW4gZnVuY3Rpb24ge25hbWV9IFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIse25hbWU6dC5uYW1lP3QubmFtZS5uYW1lOiJhbm9ueW1vdXMiLGZpbGU6dC5zdGFydC5maWxlLGxpbmU6dC5zdGFydC5saW5lLGNvbDp0LnN0YXJ0LmNvbH0pLGUubmVzdGVkX2RlZnVucyYmdCBpbnN0YW5jZW9mIEZlJiYhKG4ucGFyZW50KClpbnN0YW5jZW9mIG1lKSYmSy53YXJuKCdGdW5jdGlvbiB7bmFtZX0gZGVjbGFyZWQgaW4gbmVzdGVkIHN0YXRlbWVudCAie3R5cGV9IiBbe2ZpbGV9OntsaW5lfSx7Y29sfV0nLHtuYW1lOnQubmFtZS5uYW1lLHR5cGU6bi5wYXJlbnQoKS5UWVBFLGZpbGU6dC5zdGFydC5maWxlLGxpbmU6dC5zdGFydC5saW5lLGNvbDp0LnN0YXJ0LmNvbH0pfSk7dGhpcy53YWxrKG4pfSk7dmFyIHh0PS9eJHxbO3tdW1xzXG5dKiQvOyFmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSxuKXtlLkRFRk1FVEhPRCgiX2NvZGVnZW4iLG4pfWZ1bmN0aW9uIG4oZSx0KXtBcnJheS5pc0FycmF5KGUpP2UuZm9yRWFjaChmdW5jdGlvbihlKXtuKGUsdCl9KTplLkRFRk1FVEhPRCgibmVlZHNfcGFyZW5zIix0KX1mdW5jdGlvbiB0KGUsbix0LHIpe3ZhciBpPWUubGVuZ3RoLTE7dj1yLGUuZm9yRWFjaChmdW5jdGlvbihlLHIpe3YhPT0hMHx8ZSBpbnN0YW5jZW9mIG5lfHxlIGluc3RhbmNlb2Ygb2V8fGUgaW5zdGFuY2VvZiB0ZSYmZS5ib2R5IGluc3RhbmNlb2YgTG58fCh2PSExKSxlIGluc3RhbmNlb2Ygb2V8fCh0LmluZGVudCgpLGUucHJpbnQodCkscj09aSYmbnx8KHQubmV3bGluZSgpLG4mJnQubmV3bGluZSgpKSksdj09PSEwJiZlIGluc3RhbmNlb2YgdGUmJmUuYm9keSBpbnN0YW5jZW9mIExuJiYodj0hMSl9KSx2PSExfWZ1bmN0aW9uIHIoZSxuLHIpe2UubGVuZ3RoPjA/bi53aXRoX2Jsb2NrKGZ1bmN0aW9uKCl7dChlLCExLG4scil9KTpuLnByaW50KCJ7fSIpfWZ1bmN0aW9uIGkoZSxuKXtpZihuLm9wdGlvbigiYnJhY2tldGl6ZSIpKXJldHVybiB2b2lkIGQoZS5ib2R5LG4pO2lmKCFlLmJvZHkpcmV0dXJuIG4uZm9yY2Vfc2VtaWNvbG9uKCk7aWYoZS5ib2R5IGluc3RhbmNlb2YgZmUpcmV0dXJuIHZvaWQgZChlLmJvZHksbik7Zm9yKHZhciB0PWUuYm9keTs7KWlmKHQgaW5zdGFuY2VvZiB6ZSl7aWYoIXQuYWx0ZXJuYXRpdmUpcmV0dXJuIHZvaWQgZChlLmJvZHksbik7dD10LmFsdGVybmF0aXZlfWVsc2V7aWYoISh0IGluc3RhbmNlb2YgdWUpKWJyZWFrO3Q9dC5ib2R5fWEoZS5ib2R5LG4pfWZ1bmN0aW9uIG8oZSxuLHQpe2lmKHQpdHJ5e2Uud2FsayhuZXcgQShmdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2Ygc24mJiJpbiI9PWUub3BlcmF0b3IpdGhyb3cgbn0pKSxlLnByaW50KG4pfWNhdGNoKHQpe2lmKHQhPT1uKXRocm93IHQ7ZS5wcmludChuLCEwKX1lbHNlIGUucHJpbnQobil9ZnVuY3Rpb24gdShlKXtyZXR1cm5bOTIsNDcsNDYsNDMsNDIsNjMsNDAsNDEsOTEsOTMsMTIzLDEyNSwzNiw5NCw1OCwxMjQsMzMsMTAsMTMsMCw2NTI3OSw4MjMyLDgyMzNdLmluZGV4T2YoZSk8MH1mdW5jdGlvbiBhKGUsbil7bi5vcHRpb24oImJyYWNrZXRpemUiKT8hZXx8ZSBpbnN0YW5jZW9mIG9lP24ucHJpbnQoInt9Iik6ZSBpbnN0YW5jZW9mIGllP2UucHJpbnQobik6bi53aXRoX2Jsb2NrKGZ1bmN0aW9uKCl7bi5pbmRlbnQoKSxlLnByaW50KG4pLG4ubmV3bGluZSgpfSk6IWV8fGUgaW5zdGFuY2VvZiBvZT9uLmZvcmNlX3NlbWljb2xvbigpOmUucHJpbnQobil9ZnVuY3Rpb24gcyhlKXtmb3IodmFyIG49ZS5zdGFjaygpLHQ9bi5sZW5ndGgscj1uWy0tdF0saT1uWy0tdF07dD4wOyl7aWYoaSBpbnN0YW5jZW9mIFEmJmkuYm9keT09PXIpcmV0dXJuITA7aWYoIShpIGluc3RhbmNlb2YgZW4mJmkuY2FyPT09cnx8aSBpbnN0YW5jZW9mIEtlJiZpLmV4cHJlc3Npb249PT1yJiYhKGkgaW5zdGFuY2VvZiBRZSl8fGkgaW5zdGFuY2VvZiB0biYmaS5leHByZXNzaW9uPT09cnx8aSBpbnN0YW5jZW9mIHJuJiZpLmV4cHJlc3Npb249PT1yfHxpIGluc3RhbmNlb2YgY24mJmkuY29uZGl0aW9uPT09cnx8aSBpbnN0YW5jZW9mIHNuJiZpLmxlZnQ9PT1yfHxpIGluc3RhbmNlb2YgYW4mJmkuZXhwcmVzc2lvbj09PXIpKXJldHVybiExO3I9aSxpPW5bLS10XX19ZnVuY3Rpb24gYyhlLG4pe3JldHVybiBlLmFyZ3MubGVuZ3RoPjB8fG4ub3B0aW9uKCJiZWF1dGlmeSIpfWZ1bmN0aW9uIGwoZSl7Zm9yKHZhciBuPWVbMF0sdD1uLmxlbmd0aCxyPTE7cjxlLmxlbmd0aDsrK3IpZVtyXS5sZW5ndGg8dCYmKG49ZVtyXSx0PW4ubGVuZ3RoKTtyZXR1cm4gbn1mdW5jdGlvbiBwKGUpe3ZhciBuLHQ9ZS50b1N0cmluZygxMCkscj1bdC5yZXBsYWNlKC9eMFwuLywiLiIpLnJlcGxhY2UoImUrIiwiZSIpXTtyZXR1cm4gTWF0aC5mbG9vcihlKT09PWU/KGU+PTA/ci5wdXNoKCIweCIrZS50b1N0cmluZygxNikudG9Mb3dlckNhc2UoKSwiMCIrZS50b1N0cmluZyg4KSk6ci5wdXNoKCItMHgiKygtZSkudG9TdHJpbmcoMTYpLnRvTG93ZXJDYXNlKCksIi0wIisoLWUpLnRvU3RyaW5nKDgpKSwobj0vXiguKj8pKDArKSQvLmV4ZWMoZSkpJiZyLnB1c2goblsxXSsiZSIrblsyXS5sZW5ndGgpKToobj0vXjA/XC4oMCspKC4qKSQvLmV4ZWMoZSkpJiZyLnB1c2goblsyXSsiZS0iKyhuWzFdLmxlbmd0aCtuWzJdLmxlbmd0aCksdC5zdWJzdHIodC5pbmRleE9mKCIuIikpKSxsKHIpfWZ1bmN0aW9uIGQoZSxuKXtyZXR1cm4gZSBpbnN0YW5jZW9mIGllP3ZvaWQgZS5wcmludChuKTp2b2lkIG4ud2l0aF9ibG9jayhmdW5jdGlvbigpe24uaW5kZW50KCksZS5wcmludChuKSxuLm5ld2xpbmUoKX0pfWZ1bmN0aW9uIGgoZSxuKXtlLkRFRk1FVEhPRCgiYWRkX3NvdXJjZV9tYXAiLGZ1bmN0aW9uKGUpe24odGhpcyxlKX0pfWZ1bmN0aW9uIEQoZSxuKXtuLmFkZF9tYXBwaW5nKGUuc3RhcnQpfXZhciBtPSExLHY9ITE7Sy5ERUZNRVRIT0QoInByaW50IixmdW5jdGlvbihlLG4pe2Z1bmN0aW9uIHQoKXtyLmFkZF9jb21tZW50cyhlKSxyLmFkZF9zb3VyY2VfbWFwKGUpLGkocixlKX12YXIgcj10aGlzLGk9ci5fY29kZWdlbixvPW07ciBpbnN0YW5jZW9mIG5lJiYidXNlIGFzbSI9PXIudmFsdWUmJmUucGFyZW50KClpbnN0YW5jZW9mIG1lJiYobT0hMCksZS5wdXNoX25vZGUociksbnx8ci5uZWVkc19wYXJlbnMoZSk/ZS53aXRoX3BhcmVucyh0KTp0KCksZS5wb3Bfbm9kZSgpLHIgaW5zdGFuY2VvZiBtZSYmKG09byl9KSxLLkRFRk1FVEhPRCgicHJpbnRfdG9fc3RyaW5nIixmdW5jdGlvbihlKXt2YXIgbj1WKGUpO3JldHVybiBlfHwobi5fcmVhZG9ubHk9ITApLHRoaXMucHJpbnQobiksbi5nZXQoKX0pLEsuREVGTUVUSE9EKCJhZGRfY29tbWVudHMiLGZ1bmN0aW9uKGUpe2lmKCFlLl9yZWFkb25seSl7dmFyIG49dGhpcyx0PW4uc3RhcnQ7aWYodCYmIXQuX2NvbW1lbnRzX2R1bXBlZCl7dC5fY29tbWVudHNfZHVtcGVkPSEwO3ZhciByPXQuY29tbWVudHNfYmVmb3JlfHxbXTtuIGluc3RhbmNlb2YgU2UmJm4udmFsdWUmJm4udmFsdWUud2FsayhuZXcgQShmdW5jdGlvbihlKXtpZihlLnN0YXJ0JiZlLnN0YXJ0LmNvbW1lbnRzX2JlZm9yZSYmKHI9ci5jb25jYXQoZS5zdGFydC5jb21tZW50c19iZWZvcmUpLGUuc3RhcnQuY29tbWVudHNfYmVmb3JlPVtdKSxlIGluc3RhbmNlb2YgRWV8fGUgaW5zdGFuY2VvZiBsbnx8ZSBpbnN0YW5jZW9mIHBuKXJldHVybiEwfSkpLHI9ci5maWx0ZXIoZS5jb21tZW50X2ZpbHRlcixuKSwhZS5vcHRpb24oImJlYXV0aWZ5IikmJnIubGVuZ3RoPjAmJi9jb21tZW50WzEzNF0vLnRlc3QoclswXS50eXBlKSYmMCE9PWUuY29sKCkmJnJbMF0ubmxiJiZlLnByaW50KCJcbiIpLHIuZm9yRWFjaChmdW5jdGlvbihuKXsvY29tbWVudFsxMzRdLy50ZXN0KG4udHlwZSk/KGUucHJpbnQoIi8vIituLnZhbHVlKyJcbiIpLGUuaW5kZW50KCkpOiJjb21tZW50MiI9PW4udHlwZT8oZS5wcmludCgiLyoiK24udmFsdWUrIiovIiksdC5ubGI/KGUucHJpbnQoIlxuIiksZS5pbmRlbnQoKSk6ZS5zcGFjZSgpKTowPT09ZS5wb3MoKSYmImNvbW1lbnQ1Ij09bi50eXBlJiZlLm9wdGlvbigic2hlYmFuZyIpJiYoZS5wcmludCgiIyEiK24udmFsdWUrIlxuIiksZS5pbmRlbnQoKSl9KX19fSksbihLLGZ1bmN0aW9uKCl7cmV0dXJuITF9KSxuKEVlLGZ1bmN0aW9uKGUpe2lmKHMoZSkpcmV0dXJuITA7aWYoZS5vcHRpb24oIndyYXBfaWlmZSIpKXt2YXIgbj1lLnBhcmVudCgpO3JldHVybiBuIGluc3RhbmNlb2YgS2UmJm4uZXhwcmVzc2lvbj09PXRoaXN9cmV0dXJuITF9KSxuKHBuLGZ1bmN0aW9uKGUpe3JldHVybiBzKGUpfSksbihbb24sSm5dLGZ1bmN0aW9uKGUpe3ZhciBuPWUucGFyZW50KCk7cmV0dXJuIG4gaW5zdGFuY2VvZiBubiYmbi5leHByZXNzaW9uPT09dGhpc3x8biBpbnN0YW5jZW9mIEtlJiZuLmV4cHJlc3Npb249PT10aGlzfHxuIGluc3RhbmNlb2Ygc24mJiIqKiI9PT1uLm9wZXJhdG9yJiZ0aGlzIGluc3RhbmNlb2YgdW4mJm4ubGVmdD09PXRoaXMmJiIrKyIhPT10aGlzLm9wZXJhdG9yJiYiLS0iIT09dGhpcy5vcGVyYXRvcn0pLG4oZW4sZnVuY3Rpb24oZSl7dmFyIG49ZS5wYXJlbnQoKTtyZXR1cm4gbiBpbnN0YW5jZW9mIEtlfHxuIGluc3RhbmNlb2Ygb258fG4gaW5zdGFuY2VvZiBzbnx8biBpbnN0YW5jZW9mIFplfHxuIGluc3RhbmNlb2Ygbm58fG4gaW5zdGFuY2VvZiBsbnx8biBpbnN0YW5jZW9mIGRufHxuIGluc3RhbmNlb2Yga24mJm4uZGVmYXVsdD09PXRoaXN8fG4gaW5zdGFuY2VvZiB4biYmbi5kZWZhdWx0PT09dGhpc3x8biBpbnN0YW5jZW9mIHduJiZuLmRlZmF1bHQ9PT10aGlzfHxuIGluc3RhbmNlb2YgTW4mJm4uZGVmYXVsdD09PXRoaXN8fG4gaW5zdGFuY2VvZiBjbnx8biBpbnN0YW5jZW9mIEFlfSksbihzbixmdW5jdGlvbihlKXt2YXIgbj1lLnBhcmVudCgpO2lmKG4gaW5zdGFuY2VvZiBLZSYmbi5leHByZXNzaW9uPT09dGhpcylyZXR1cm4hMDtpZihuIGluc3RhbmNlb2Ygb24pcmV0dXJuITA7aWYobiBpbnN0YW5jZW9mIG5uJiZuLmV4cHJlc3Npb249PT10aGlzKXJldHVybiEwO2lmKG4gaW5zdGFuY2VvZiBzbil7dmFyIHQ9bi5vcGVyYXRvcixyPXd0W3RdLGk9dGhpcy5vcGVyYXRvcixvPXd0W2ldO2lmKHI+b3x8cj09byYmdGhpcz09PW4ucmlnaHQpcmV0dXJuITB9fSksbih0dCxmdW5jdGlvbihlKXt2YXIgbj1lLnBhcmVudCgpO3JldHVybiBuIGluc3RhbmNlb2Ygc24mJiI9IiE9PW4ub3BlcmF0b3J8fChuIGluc3RhbmNlb2YgY24mJm4uY29uZGl0aW9uPT09dGhpc3x8KG4gaW5zdGFuY2VvZiBvbnx8KG4gaW5zdGFuY2VvZiB0biYmbi5leHByZXNzaW9uPT09dGhpc3x8KG4gaW5zdGFuY2VvZiBybiYmbi5leHByZXNzaW9uPT09dGhpc3x8dm9pZCAwKSkpKX0pLG4obm4sZnVuY3Rpb24oZSl7dmFyIG49ZS5wYXJlbnQoKTtpZihuIGluc3RhbmNlb2YgUWUmJm4uZXhwcmVzc2lvbj09PXRoaXMpdHJ5e3RoaXMud2FsayhuZXcgQShmdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgS2UpdGhyb3cgbn0pKX1jYXRjaChlKXtpZihlIT09bil0aHJvdyBlO3JldHVybiEwfX0pLG4oS2UsZnVuY3Rpb24oZSl7dmFyIG4sdD1lLnBhcmVudCgpO3JldHVybiB0IGluc3RhbmNlb2YgUWUmJnQuZXhwcmVzc2lvbj09PXRoaXN8fHRoaXMuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEVlJiZ0IGluc3RhbmNlb2Ygbm4mJnQuZXhwcmVzc2lvbj09PXRoaXMmJihuPWUucGFyZW50KDEpKWluc3RhbmNlb2YgZm4mJm4ubGVmdD09PXR9KSxuKFFlLGZ1bmN0aW9uKGUpe3ZhciBuPWUucGFyZW50KCk7aWYoIWModGhpcyxlKSYmKG4gaW5zdGFuY2VvZiBubnx8biBpbnN0YW5jZW9mIEtlJiZuLmV4cHJlc3Npb249PT10aGlzKSlyZXR1cm4hMH0pLG4oVm4sZnVuY3Rpb24oZSl7dmFyIG49ZS5wYXJlbnQoKTtpZihuIGluc3RhbmNlb2Ygbm4mJm4uZXhwcmVzc2lvbj09PXRoaXMpe3ZhciB0PXRoaXMuZ2V0VmFsdWUoKTtpZih0PDB8fC9eMC8udGVzdChwKHQpKSlyZXR1cm4hMH19KSxuKFtmbixjbl0sZnVuY3Rpb24oZSl7dmFyIG49ZS5wYXJlbnQoKTtyZXR1cm4gbiBpbnN0YW5jZW9mIG9ufHwobiBpbnN0YW5jZW9mIHNuJiYhKG4gaW5zdGFuY2VvZiBmbil8fChuIGluc3RhbmNlb2YgS2UmJm4uZXhwcmVzc2lvbj09PXRoaXN8fChuIGluc3RhbmNlb2YgY24mJm4uY29uZGl0aW9uPT09dGhpc3x8KG4gaW5zdGFuY2VvZiBubiYmbi5leHByZXNzaW9uPT09dGhpc3x8dm9pZCAwKSkpKX0pLGUobmUsZnVuY3Rpb24oZSxuKXtuLnByaW50X3N0cmluZyhlLnZhbHVlLGUucXVvdGUpLG4uc2VtaWNvbG9uKCl9KSxlKF9lLGZ1bmN0aW9uKGUsbil7bi5wcmludCgiLi4uIiksZS5leHByZXNzaW9uLnByaW50KG4pfSksZSh3ZSxmdW5jdGlvbihlLG4pe24ucHJpbnQoZS5pc19hcnJheT8iWyI6InsiKTt2YXIgdD0hMCxyPWUubmFtZXMubGVuZ3RoO2UubmFtZXMuZm9yRWFjaChmdW5jdGlvbihlLGkpe3Q/dD0hMToobi5jb21tYSgpLG4uc3BhY2UoKSksZS5wcmludChuKSxpPT09ci0xJiZlIGluc3RhbmNlb2YgWm4mJm4uY29tbWEoKX0pLG4ucHJpbnQoZS5pc19hcnJheT8iXSI6In0iKSxlLmRlZmF1bHQmJihuLnNwYWNlKCksbi5wcmludCgiPSIpLG4uc3BhY2UoKSxlLmRlZmF1bHQucHJpbnQobikpfSksZShlZSxmdW5jdGlvbihlLG4pe24ucHJpbnQoImRlYnVnZ2VyIiksbi5zZW1pY29sb24oKX0pLHVlLkRFRk1FVEhPRCgiX2RvX3ByaW50X2JvZHkiLGZ1bmN0aW9uKGUpe2EodGhpcy5ib2R5LGUpfSksZShRLGZ1bmN0aW9uKGUsbil7ZS5ib2R5LnByaW50KG4pLG4uc2VtaWNvbG9uKCl9KSxlKHZlLGZ1bmN0aW9uKGUsbil7dChlLmJvZHksITAsbiwhMCksbi5wcmludCgiIil9KSxlKGFlLGZ1bmN0aW9uKGUsbil7ZS5sYWJlbC5wcmludChuKSxuLmNvbG9uKCksZS5ib2R5LnByaW50KG4pfSksZSh0ZSxmdW5jdGlvbihlLG4pe2UuYm9keS5wcmludChuKSxuLnNlbWljb2xvbigpfSksZShpZSxmdW5jdGlvbihlLG4pe3IoZS5ib2R5LG4pfSksZShvZSxmdW5jdGlvbihlLG4pe24uc2VtaWNvbG9uKCl9KSxlKGZlLGZ1bmN0aW9uKGUsbil7bi5wcmludCgiZG8iKSxuLnNwYWNlKCksZS5fZG9fcHJpbnRfYm9keShuKSxuLnNwYWNlKCksbi5wcmludCgid2hpbGUiKSxuLnNwYWNlKCksbi53aXRoX3BhcmVucyhmdW5jdGlvbigpe2UuY29uZGl0aW9uLnByaW50KG4pfSksbi5zZW1pY29sb24oKX0pLGUobGUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJ3aGlsZSIpLG4uc3BhY2UoKSxuLndpdGhfcGFyZW5zKGZ1bmN0aW9uKCl7ZS5jb25kaXRpb24ucHJpbnQobil9KSxuLnNwYWNlKCksZS5fZG9fcHJpbnRfYm9keShuKX0pLGUocGUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJmb3IiKSxuLnNwYWNlKCksbi53aXRoX3BhcmVucyhmdW5jdGlvbigpeyFlLmluaXR8fGUuaW5pdCBpbnN0YW5jZW9mIG9lP24ucHJpbnQoIjsiKTooZS5pbml0IGluc3RhbmNlb2YgTGU/ZS5pbml0LnByaW50KG4pOm8oZS5pbml0LG4sITApLG4ucHJpbnQoIjsiKSxuLnNwYWNlKCkpLGUuY29uZGl0aW9uPyhlLmNvbmRpdGlvbi5wcmludChuKSxuLnByaW50KCI7Iiksbi5zcGFjZSgpKTpuLnByaW50KCI7IiksZS5zdGVwJiZlLnN0ZXAucHJpbnQobil9KSxuLnNwYWNlKCksZS5fZG9fcHJpbnRfYm9keShuKX0pLGUoZGUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJmb3IiKSxuLnNwYWNlKCksbi53aXRoX3BhcmVucyhmdW5jdGlvbigpe2UuaW5pdC5wcmludChuKSxuLnNwYWNlKCksZSBpbnN0YW5jZW9mIGhlP24ucHJpbnQoIm9mIik6bi5wcmludCgiaW4iKSxuLnNwYWNlKCksZS5vYmplY3QucHJpbnQobil9KSxuLnNwYWNlKCksZS5fZG9fcHJpbnRfYm9keShuKX0pLGUoRGUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJ3aXRoIiksbi5zcGFjZSgpLG4ud2l0aF9wYXJlbnMoZnVuY3Rpb24oKXtlLmV4cHJlc3Npb24ucHJpbnQobil9KSxuLnNwYWNlKCksZS5fZG9fcHJpbnRfYm9keShuKX0pLHllLkRFRk1FVEhPRCgiX2RvX3ByaW50IixmdW5jdGlvbihlLG4pe3ZhciB0PXRoaXM7bnx8KGUucHJpbnQoImZ1bmN0aW9uIiksdGhpcy5pc19nZW5lcmF0b3ImJmUuc3RhcigpLHQubmFtZSYmZS5zcGFjZSgpKSx0Lm5hbWUgaW5zdGFuY2VvZiBibj90Lm5hbWUucHJpbnQoZSk6biYmdC5uYW1lIGluc3RhbmNlb2YgSyYmZS53aXRoX3NxdWFyZShmdW5jdGlvbigpe3QubmFtZS5wcmludChlKX0pLGUud2l0aF9wYXJlbnMoZnVuY3Rpb24oKXt0LmFyZ25hbWVzLmZvckVhY2goZnVuY3Rpb24obix0KXt0JiZlLmNvbW1hKCksbi5wcmludChlKX0pfSksZS5zcGFjZSgpLHIodC5ib2R5LGUsITApfSksZSh5ZSxmdW5jdGlvbihlLG4pe2UuX2RvX3ByaW50KG4pfSksZShDZSxmdW5jdGlvbihlLG4pe2UucHJlZml4LnByaW50KG4pLGUudGVtcGxhdGVfc3RyaW5nLnByaW50KG4pfSksZShrZSxmdW5jdGlvbihlLG4pe3ZhciB0PW4ucGFyZW50KClpbnN0YW5jZW9mIENlO24ucHJpbnQoImAiKTtmb3IodmFyIHI9MDtyPGUuc2VnbWVudHMubGVuZ3RoO3IrKyllLnNlZ21lbnRzW3JdaW5zdGFuY2VvZiB4ZT90P24ucHJpbnQoZS5zZWdtZW50c1tyXS5yYXcpOm4ucHJpbnRfdGVtcGxhdGVfc3RyaW5nX2NoYXJzKGUuc2VnbWVudHNbcl0udmFsdWUpOihuLnByaW50KCIkeyIpLGUuc2VnbWVudHNbcl0ucHJpbnQobiksbi5wcmludCgifSIpKTtuLnByaW50KCJgIil9KSxBZS5ERUZNRVRIT0QoIl9kb19wcmludCIsZnVuY3Rpb24oZSl7dmFyIG49dGhpcyx0PWUucGFyZW50KCksaT10IGluc3RhbmNlb2Ygc258fHQgaW5zdGFuY2VvZiBvbnx8dCBpbnN0YW5jZW9mIEtlJiZuPT09dC5leHByZXNzaW9uO2kmJmUucHJpbnQoIigiKSwxPT09bi5hcmduYW1lcy5sZW5ndGgmJm4uYXJnbmFtZXNbMF1pbnN0YW5jZW9mIGJuJiYhbi5hcmduYW1lc1swXS5kZWZhdWx0P24uYXJnbmFtZXNbMF0ucHJpbnQoZSk6ZS53aXRoX3BhcmVucyhmdW5jdGlvbigpe24uYXJnbmFtZXMuZm9yRWFjaChmdW5jdGlvbihuLHQpe3QmJmUuY29tbWEoKSxuLnByaW50KGUpfSl9KSxlLnNwYWNlKCksZS5wcmludCgiPT4iKSxlLnNwYWNlKCksbi5ib2R5IGluc3RhbmNlb2YgSz90aGlzLmJvZHkucHJpbnQoZSk6cih0aGlzLmJvZHksZSksaSYmZS5wcmludCgiKSIpfSksU2UuREVGTUVUSE9EKCJfZG9fcHJpbnQiLGZ1bmN0aW9uKGUsbil7ZS5wcmludChuKSx0aGlzLnZhbHVlJiYoZS5zcGFjZSgpLHRoaXMudmFsdWUucHJpbnQoZSkpLGUuc2VtaWNvbG9uKCl9KSxlKFRlLGZ1bmN0aW9uKGUsbil7ZS5fZG9fcHJpbnQobiwicmV0dXJuIil9KSxlKCRlLGZ1bmN0aW9uKGUsbil7ZS5fZG9fcHJpbnQobiwidGhyb3ciKX0pLGUodHQsZnVuY3Rpb24oZSxuKXt2YXIgdD1lLmlzX3N0YXI/IioiOiIiO24ucHJpbnQoInlpZWxkIit0KSxlLmV4cHJlc3Npb24mJihuLnNwYWNlKCksZS5leHByZXNzaW9uLnByaW50KG4pKX0pLE9lLkRFRk1FVEhPRCgiX2RvX3ByaW50IixmdW5jdGlvbihlLG4pe2UucHJpbnQobiksdGhpcy5sYWJlbCYmKGUuc3BhY2UoKSx0aGlzLmxhYmVsLnByaW50KGUpKSxlLnNlbWljb2xvbigpfSksZShxZSxmdW5jdGlvbihlLG4pe2UuX2RvX3ByaW50KG4sImJyZWFrIil9KSxlKE1lLGZ1bmN0aW9uKGUsbil7ZS5fZG9fcHJpbnQobiwiY29udGludWUiKX0pLGUoemUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJpZiIpLG4uc3BhY2UoKSxuLndpdGhfcGFyZW5zKGZ1bmN0aW9uKCl7ZS5jb25kaXRpb24ucHJpbnQobil9KSxuLnNwYWNlKCksZS5hbHRlcm5hdGl2ZT8oaShlLG4pLG4uc3BhY2UoKSxuLnByaW50KCJlbHNlIiksbi5zcGFjZSgpLGEoZS5hbHRlcm5hdGl2ZSxuKSk6ZS5fZG9fcHJpbnRfYm9keShuKX0pLGUoTmUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJzd2l0Y2giKSxuLnNwYWNlKCksbi53aXRoX3BhcmVucyhmdW5jdGlvbigpe2UuZXhwcmVzc2lvbi5wcmludChuKX0pLG4uc3BhY2UoKSxlLmJvZHkubGVuZ3RoPjA/bi53aXRoX2Jsb2NrKGZ1bmN0aW9uKCl7ZS5ib2R5LmZvckVhY2goZnVuY3Rpb24oZSx0KXt0JiZuLm5ld2xpbmUoKSxuLmluZGVudCghMCksZS5wcmludChuKX0pfSk6bi5wcmludCgie30iKX0pLGplLkRFRk1FVEhPRCgiX2RvX3ByaW50X2JvZHkiLGZ1bmN0aW9uKGUpe3RoaXMuYm9keS5sZW5ndGg+MCYmKGUubmV3bGluZSgpLHRoaXMuYm9keS5mb3JFYWNoKGZ1bmN0aW9uKG4pe2UuaW5kZW50KCksbi5wcmludChlKSxlLm5ld2xpbmUoKX0pKX0pLGUoSGUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJkZWZhdWx0OiIpLGUuX2RvX3ByaW50X2JvZHkobil9KSxlKEllLGZ1bmN0aW9uKGUsbil7bi5wcmludCgiY2FzZSIpLG4uc3BhY2UoKSxlLmV4cHJlc3Npb24ucHJpbnQobiksbi5wcmludCgiOiIpLGUuX2RvX3ByaW50X2JvZHkobil9KSxlKFBlLGZ1bmN0aW9uKGUsbil7bi5wcmludCgidHJ5Iiksbi5zcGFjZSgpLHIoZS5ib2R5LG4pLGUuYmNhdGNoJiYobi5zcGFjZSgpLGUuYmNhdGNoLnByaW50KG4pKSxlLmJmaW5hbGx5JiYobi5zcGFjZSgpLGUuYmZpbmFsbHkucHJpbnQobikpfSksZShVZSxmdW5jdGlvbihlLG4pe24ucHJpbnQoImNhdGNoIiksbi5zcGFjZSgpLG4ud2l0aF9wYXJlbnMoZnVuY3Rpb24oKXtlLmFyZ25hbWUucHJpbnQobil9KSxuLnNwYWNlKCkscihlLmJvZHksbil9KSxlKFJlLGZ1bmN0aW9uKGUsbil7bi5wcmludCgiZmluYWxseSIpLG4uc3BhY2UoKSxyKGUuYm9keSxuKX0pLExlLkRFRk1FVEhPRCgiX2RvX3ByaW50IixmdW5jdGlvbihlLG4pe2UucHJpbnQobiksZS5zcGFjZSgpLHRoaXMuZGVmaW5pdGlvbnMuZm9yRWFjaChmdW5jdGlvbihuLHQpe3QmJmUuY29tbWEoKSxuLnByaW50KGUpfSk7dmFyIHQ9ZS5wYXJlbnQoKSxyPXQgaW5zdGFuY2VvZiBwZXx8dCBpbnN0YW5jZW9mIGRlLGk9ciYmdC5pbml0PT09dGhpcztpfHxlLnNlbWljb2xvbigpfSksZShXZSxmdW5jdGlvbihlLG4pe2UuX2RvX3ByaW50KG4sImxldCIpfSksZShWZSxmdW5jdGlvbihlLG4pe2UuX2RvX3ByaW50KG4sInZhciIpfSksZShZZSxmdW5jdGlvbihlLG4pe2UuX2RvX3ByaW50KG4sImNvbnN0Iil9KSxlKEdlLGZ1bmN0aW9uKGUsbil7bi5wcmludCgiaW1wb3J0Iiksbi5zcGFjZSgpLGUuaW1wb3J0ZWRfbmFtZSYmZS5pbXBvcnRlZF9uYW1lLnByaW50KG4pLGUuaW1wb3J0ZWRfbmFtZSYmZS5pbXBvcnRlZF9uYW1lcyYmKG4ucHJpbnQoIiwiKSxuLnNwYWNlKCkpLGUuaW1wb3J0ZWRfbmFtZXMmJihuLnByaW50KCJ7IiksZS5pbXBvcnRlZF9uYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKHQscil7bi5zcGFjZSgpLHQucHJpbnQobikscjxlLmltcG9ydGVkX25hbWVzLmxlbmd0aC0xJiYobi5wcmludCgiLCIpLG4uc3BhY2UoKSl9KSxuLnNwYWNlKCksbi5wcmludCgifSIpKSwoZS5pbXBvcnRlZF9uYW1lfHxlLmltcG9ydGVkX25hbWVzKSYmKG4uc3BhY2UoKSxuLnByaW50KCJmcm9tIiksbi5zcGFjZSgpKSxlLm1vZHVsZV9uYW1lLnByaW50KG4pLG4uc2VtaWNvbG9uKCl9KSxlKFhlLGZ1bmN0aW9uKGUsbil7dmFyIHQ9ZS5uYW1lLmRlZmluaXRpb24oKSxyPSh0JiZ0Lm1hbmdsZWRfbmFtZXx8ZS5uYW1lLm5hbWUpIT09ZS5mb3JlaWduX25hbWUubmFtZTtyPyhuLnByaW50KGUuZm9yZWlnbl9uYW1lLm5hbWUpLG4uc3BhY2UoKSxuLnByaW50KCJhcyIpLG4uc3BhY2UoKSxlLm5hbWUucHJpbnQobikpOmUubmFtZS5wcmludChuKX0pLGUoSmUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJleHBvcnQiKSxuLnNwYWNlKCksZS5pc19kZWZhdWx0JiYobi5wcmludCgiZGVmYXVsdCIpLG4uc3BhY2UoKSksZS5leHBvcnRlZF92YWx1ZT9lLmV4cG9ydGVkX3ZhbHVlLnByaW50KG4pOmUuZXhwb3J0ZWRfZGVmaW5pdGlvbiYmZS5leHBvcnRlZF9kZWZpbml0aW9uLnByaW50KG4pLG4uc2VtaWNvbG9uKCl9KSxlKFplLGZ1bmN0aW9uKGUsbil7aWYoZS5uYW1lLnByaW50KG4pLGUudmFsdWUpe24uc3BhY2UoKSxuLnByaW50KCI9Iiksbi5zcGFjZSgpO3ZhciB0PW4ucGFyZW50KDEpLHI9dCBpbnN0YW5jZW9mIHBlfHx0IGluc3RhbmNlb2YgZGU7byhlLnZhbHVlLG4scil9fSksZShLZSxmdW5jdGlvbihlLG4pe2UuZXhwcmVzc2lvbi5wcmludChuKSxlIGluc3RhbmNlb2YgUWUmJiFjKGUsbil8fG4ud2l0aF9wYXJlbnMoZnVuY3Rpb24oKXtlLmFyZ3MuZm9yRWFjaChmdW5jdGlvbihlLHQpe3QmJm4uY29tbWEoKSxlLnByaW50KG4pfSl9KX0pLGUoUWUsZnVuY3Rpb24oZSxuKXtuLnByaW50KCJuZXciKSxuLnNwYWNlKCksS2UucHJvdG90eXBlLl9jb2RlZ2VuKGUsbil9KSxlbi5ERUZNRVRIT0QoIl9kb19wcmludCIsZnVuY3Rpb24oZSl7dGhpcy5jYXIucHJpbnQoZSksdGhpcy5jZHImJihlLmNvbW1hKCksZS5zaG91bGRfYnJlYWsoKSYmKGUubmV3bGluZSgpLGUuaW5kZW50KCkpLHRoaXMuY2RyLnByaW50KGUpKX0pLGUoZW4sZnVuY3Rpb24oZSxuKXtlLl9kb19wcmludChuKX0pLGUodG4sZnVuY3Rpb24oZSxuKXt2YXIgdD1lLmV4cHJlc3Npb247dC5wcmludChuKSx0IGluc3RhbmNlb2YgVm4mJnQuZ2V0VmFsdWUoKT49MCYmKC9beGEtZi4pXS9pLnRlc3Qobi5sYXN0KCkpfHxuLnByaW50KCIuIikpLG4ucHJpbnQoIi4iKSxuLmFkZF9tYXBwaW5nKGUuZW5kKSxuLnByaW50X25hbWUoZS5wcm9wZXJ0eSl9KSxlKHJuLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uLnByaW50KG4pLG4ucHJpbnQoIlsiKSxlLnByb3BlcnR5LnByaW50KG4pLG4ucHJpbnQoIl0iKX0pLGUodW4sZnVuY3Rpb24oZSxuKXt2YXIgdD1lLm9wZXJhdG9yO24ucHJpbnQodCksKC9eW2Etel0vaS50ZXN0KHQpfHwvWystXSQvLnRlc3QodCkmJmUuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIHVuJiYvXlsrLV0vLnRlc3QoZS5leHByZXNzaW9uLm9wZXJhdG9yKSkmJm4uc3BhY2UoKSxlLmV4cHJlc3Npb24ucHJpbnQobil9KSxlKGFuLGZ1bmN0aW9uKGUsbil7ZS5leHByZXNzaW9uLnByaW50KG4pLG4ucHJpbnQoZS5vcGVyYXRvcil9KSxlKHNuLGZ1bmN0aW9uKGUsbil7dmFyIHQ9ZS5vcGVyYXRvcjtlLmxlZnQucHJpbnQobiksIj4iPT10WzBdJiZlLmxlZnQgaW5zdGFuY2VvZiBhbiYmIi0tIj09ZS5sZWZ0Lm9wZXJhdG9yP24ucHJpbnQoIiAiKTpuLnNwYWNlKCksbi5wcmludCh0KSwoIjwiPT10fHwiPDwiPT10KSYmZS5yaWdodCBpbnN0YW5jZW9mIHVuJiYiISI9PWUucmlnaHQub3BlcmF0b3ImJmUucmlnaHQuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIHVuJiYiLS0iPT1lLnJpZ2h0LmV4cHJlc3Npb24ub3BlcmF0b3I/bi5wcmludCgiICIpOm4uc3BhY2UoKSxlLnJpZ2h0LnByaW50KG4pfSksZShjbixmdW5jdGlvbihlLG4pe2UuY29uZGl0aW9uLnByaW50KG4pLG4uc3BhY2UoKSxuLnByaW50KCI/Iiksbi5zcGFjZSgpLGUuY29uc2VxdWVudC5wcmludChuKSxuLnNwYWNlKCksbi5jb2xvbigpLGUuYWx0ZXJuYXRpdmUucHJpbnQobil9KSxlKGxuLGZ1bmN0aW9uKGUsbil7bi53aXRoX3NxdWFyZShmdW5jdGlvbigpe3ZhciB0PWUuZWxlbWVudHMscj10Lmxlbmd0aDtyPjAmJm4uc3BhY2UoKSx0LmZvckVhY2goZnVuY3Rpb24oZSx0KXt0JiZuLmNvbW1hKCksZS5wcmludChuKSx0PT09ci0xJiZlIGluc3RhbmNlb2YgWm4mJm4uY29tbWEoKX0pLHI+MCYmbi5zcGFjZSgpfSl9KSxlKHBuLGZ1bmN0aW9uKGUsbil7ZS5wcm9wZXJ0aWVzLmxlbmd0aD4wP24ud2l0aF9ibG9jayhmdW5jdGlvbigpe2UucHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKGUsdCl7dCYmKG4ucHJpbnQoIiwiKSxuLm5ld2xpbmUoKSksbi5pbmRlbnQoKSxlLnByaW50KG4pfSksbi5uZXdsaW5lKCl9KTpuLnByaW50KCJ7fSIpfSksZShfbixmdW5jdGlvbihlLG4pe24ucHJpbnQoImNsYXNzIiksbi5zcGFjZSgpLGUubmFtZSYmKGUubmFtZS5wcmludChuKSxuLnNwYWNlKCkpLGUuZXh0ZW5kcyYmKG4ucHJpbnQoImV4dGVuZHMiKSxuLnNwYWNlKCksZS5leHRlbmRzLnByaW50KG4pLG4uc3BhY2UoKSksZS5wcm9wZXJ0aWVzLmxlbmd0aD4wP24ud2l0aF9ibG9jayhmdW5jdGlvbigpe2UucHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKGUsdCl7dCYmbi5uZXdsaW5lKCksbi5pbmRlbnQoKSxlLnByaW50KG4pfSksbi5uZXdsaW5lKCl9KTpuLnByaW50KCJ7fSIpfSksZShFbixmdW5jdGlvbihlLG4pe24ucHJpbnQoIm5ldy50YXJnZXQiKX0pLGRuLkRFRk1FVEhPRCgicHJpbnRfcHJvcGVydHlfbmFtZSIsZnVuY3Rpb24oZSxuLHQpe3Qub3B0aW9uKCJxdW90ZV9rZXlzIik/dC5wcmludF9zdHJpbmcoZSsiIik6KCJudW1iZXIiPT10eXBlb2YgZXx8IXQub3B0aW9uKCJiZWF1dGlmeSIpJiYrZSsiIj09ZSkmJnBhcnNlRmxvYXQoZSk+PTA/dC5wcmludChwKGUpKToob3QoZSk/dC5vcHRpb24oInNjcmV3X2llOCIpOnEoZSkpP24mJnQub3B0aW9uKCJrZWVwX3F1b3RlZF9wcm9wcyIpP3QucHJpbnRfc3RyaW5nKGUsbik6dC5wcmludF9uYW1lKGUpOnQucHJpbnRfc3RyaW5nKGUsbil9KSxlKGhuLGZ1bmN0aW9uKGUsbil7ZnVuY3Rpb24gdChlKXt2YXIgbj1lLnZhbHVlLmRlZmluaXRpb24oKTtyZXR1cm4gbj9uLm1hbmdsZWRfbmFtZXx8bi5uYW1lOmUudmFsdWUubmFtZX1uLm9wdGlvbigic2hvcnRoYW5kIikmJmUudmFsdWUgaW5zdGFuY2VvZiBibiYmcShlLmtleSkmJnQoZSk9PT1lLmtleT9lLnByaW50X3Byb3BlcnR5X25hbWUoZS5rZXksZS5xdW90ZSxuKTooZS5rZXkgaW5zdGFuY2VvZiBLP24ud2l0aF9zcXVhcmUoZnVuY3Rpb24oKXtlLmtleS5wcmludChuKX0pOmUucHJpbnRfcHJvcGVydHlfbmFtZShlLmtleSxlLnF1b3RlLG4pLG4uY29sb24oKSxlLnZhbHVlLnByaW50KG4pKSxlLmRlZmF1bHQmJihuLnNwYWNlKCksbi5wcmludCgiPSIpLG4uc3BhY2UoKSxlLmRlZmF1bHQucHJpbnQobikpfSksZG4uREVGTUVUSE9EKCJfcHJpbnRfZ2V0dGVyX3NldHRlciIsZnVuY3Rpb24oZSxuLHQpe24uc3RhdGljJiYodC5wcmludCgic3RhdGljIiksdC5zcGFjZSgpKSx0LnByaW50KGUpLHQuc3BhY2UoKSxuLmtleSBpbnN0YW5jZW9mIFRuP24ucHJpbnRfcHJvcGVydHlfbmFtZShuLmtleS5uYW1lLG4ucXVvdGUsdCk6dC53aXRoX3NxdWFyZShmdW5jdGlvbigpe24ua2V5LnByaW50KHQpfSksbi52YWx1ZS5fZG9fcHJpbnQodCwhMCl9KSxlKERuLGZ1bmN0aW9uKGUsbil7ZS5fcHJpbnRfZ2V0dGVyX3NldHRlcigic2V0IixlLG4pfSksZShtbixmdW5jdGlvbihlLG4pe2UuX3ByaW50X2dldHRlcl9zZXR0ZXIoImdldCIsZSxuKX0pLGUodm4sZnVuY3Rpb24oZSxuKXtlLnN0YXRpYyYmKG4ucHJpbnQoInN0YXRpYyIpLG4uc3BhY2UoKSksZS5pc19nZW5lcmF0b3ImJm4ucHJpbnQoIioiKSxuLnNwYWNlKCksZS5rZXkgaW5zdGFuY2VvZiBUbj9lLnByaW50X3Byb3BlcnR5X25hbWUoZS5rZXkubmFtZSxlLnF1b3RlLG4pOm4ud2l0aF9zcXVhcmUoZnVuY3Rpb24oKXtlLmtleS5wcmludChuKX0pLGUudmFsdWUuX2RvX3ByaW50KG4sITApfSksYm4uREVGTUVUSE9EKCJfZG9fcHJpbnQiLGZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuZGVmaW5pdGlvbigpO2UucHJpbnRfbmFtZShuP24ubWFuZ2xlZF9uYW1lfHxuLm5hbWU6dGhpcy5uYW1lKX0pLGUoYm4sZnVuY3Rpb24oZSxuKXtlLl9kb19wcmludChuKX0pLGUoRm4sZnVuY3Rpb24oZSxuKXtlLl9kb19wcmludChuKSxlLmRlZmF1bHQmJihuLnNwYWNlKCksbi5wcmludCgiPSIpLG4uc3BhY2UoKSxlLmRlZmF1bHQucHJpbnQobikpfSksZShKbixmdW5jdGlvbihlLG4pe24ucHJpbnQoInZvaWQgMCIpfSksZShabixmKSxlKEtuLGZ1bmN0aW9uKGUsbil7bi5wcmludCgiSW5maW5pdHkiKX0pLGUoR24sZnVuY3Rpb24oZSxuKXtuLnByaW50KCJOYU4iKX0pLGUoUG4sZnVuY3Rpb24oZSxuKXtuLnByaW50KCJ0aGlzIil9KSxlKFVuLGZ1bmN0aW9uKGUsbil7bi5wcmludCgic3VwZXIiKX0pLGUoUm4sZnVuY3Rpb24oZSxuKXtuLnByaW50KGUuZ2V0VmFsdWUoKSl9KSxlKExuLGZ1bmN0aW9uKGUsbil7bi5wcmludF9zdHJpbmcoZS5nZXRWYWx1ZSgpLGUucXVvdGUsdil9KSxlKFZuLGZ1bmN0aW9uKGUsbil7bSYmZS5zdGFydCYmbnVsbCE9ZS5zdGFydC5yYXc/bi5wcmludChlLnN0YXJ0LnJhdyk6bi5wcmludChwKGUuZ2V0VmFsdWUoKSkpfSksZShXbixmdW5jdGlvbihlLG4pe3ZhciB0PWUuZ2V0VmFsdWUoKS50b1N0cmluZygpO24ub3B0aW9uKCJhc2NpaV9vbmx5Iik/dD1uLnRvX2FzY2lpKHQpOm4ub3B0aW9uKCJ1bmVzY2FwZV9yZWdleHBzIikmJih0PXQuc3BsaXQoIlxcXFwiKS5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUucmVwbGFjZSgvXFx1WzAtOWEtZkEtRl17NH18XFx4WzAtOWEtZkEtRl17Mn0vZyxmdW5jdGlvbihlKXt2YXIgbj1wYXJzZUludChlLnN1YnN0cigyKSwxNik7cmV0dXJuIHUobik/U3RyaW5nLmZyb21DaGFyQ29kZShuKTplfSl9KS5qb2luKCJcXFxcIikpLG4ucHJpbnQodCk7dmFyIHI9bi5wYXJlbnQoKTtyIGluc3RhbmNlb2Ygc24mJi9eaW4vLnRlc3Qoci5vcGVyYXRvcikmJnIubGVmdD09PWUmJm4ucHJpbnQoIiAiKX0pLGgoSyxmKSxoKG5lLEQpLGgoZWUsRCksaChibixEKSxoKEJlLEQpLGgodWUsRCksaChhZSxmKSxoKHllLEQpLGgoTmUsRCksaChqZSxEKSxoKGllLEQpLGgodmUsZiksaChRZSxEKSxoKFBlLEQpLGgoVWUsRCksaChSZSxEKSxoKExlLEQpLGgoUm4sRCksaChEbixmdW5jdGlvbihlLG4pe24uYWRkX21hcHBpbmcoZS5zdGFydCxlLmtleS5uYW1lKX0pLGgobW4sZnVuY3Rpb24oZSxuKXtuLmFkZF9tYXBwaW5nKGUuc3RhcnQsZS5rZXkubmFtZSl9KSxoKGRuLGZ1bmN0aW9uKGUsbil7bi5hZGRfbWFwcGluZyhlLnN0YXJ0LGUua2V5KX0pfSgpLFcucHJvdG90eXBlPW5ldyBQLGMoVy5wcm90b3R5cGUse29wdGlvbjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5vcHRpb25zW2VdfSxjb21wcmVzczpmdW5jdGlvbihlKXtmb3IodmFyIG49K3RoaXMub3B0aW9ucy5wYXNzZXN8fDEsdD0wO3Q8biYmdDwzOysrdCl0PjAmJmUuY2xlYXJfb3B0X2ZsYWdzKCksZT1lLnRyYW5zZm9ybSh0aGlzKTtyZXR1cm4gZX0sd2FybjpmdW5jdGlvbihlLG4pe2lmKHRoaXMub3B0aW9ucy53YXJuaW5ncyl7dmFyIHQ9aChlLG4pO3QgaW4gdGhpcy53YXJuaW5nc19wcm9kdWNlZHx8KHRoaXMud2FybmluZ3NfcHJvZHVjZWRbdF09ITAsSy53YXJuLmFwcGx5KEssYXJndW1lbnRzKSl9fSxjbGVhcl93YXJuaW5nczpmdW5jdGlvbigpe3RoaXMud2FybmluZ3NfcHJvZHVjZWQ9e319LGJlZm9yZTpmdW5jdGlvbihlLG4sdCl7aWYoZS5fc3F1ZWV6ZWQpcmV0dXJuIGU7dmFyIHI9ITE7cmV0dXJuIGUgaW5zdGFuY2VvZiBtZSYmKGU9ZS5ob2lzdF9kZWNsYXJhdGlvbnModGhpcykscj0hMCksbihlLHRoaXMpLGU9ZS5vcHRpbWl6ZSh0aGlzKSxyJiZlIGluc3RhbmNlb2YgbWUmJihlLmRyb3BfdW51c2VkKHRoaXMpLG4oZSx0aGlzKSksZS5fc3F1ZWV6ZWQ9ITAsZX19KSxmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSxuKXtlLkRFRk1FVEhPRCgib3B0aW1pemUiLGZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7aWYodC5fb3B0aW1pemVkKXJldHVybiB0O2lmKGUuaGFzX2RpcmVjdGl2ZSgidXNlIGFzbSIpKXJldHVybiB0O3ZhciByPW4odCxlKTtyZXR1cm4gci5fb3B0aW1pemVkPSEwLHI9PT10P3I6ci50cmFuc2Zvcm0oZSl9KX1mdW5jdGlvbiBuKGUsbix0KXtyZXR1cm4gdHx8KHQ9e30pLG4mJih0LnN0YXJ0fHwodC5zdGFydD1uLnN0YXJ0KSx0LmVuZHx8KHQuZW5kPW4uZW5kKSksbmV3IGUodCl9ZnVuY3Rpb24gdChlLHQscil7aWYodCBpbnN0YW5jZW9mIEspcmV0dXJuIHQudHJhbnNmb3JtKGUpO3N3aXRjaCh0eXBlb2YgdCl7Y2FzZSJzdHJpbmciOnJldHVybiBuKExuLHIse3ZhbHVlOnR9KS5vcHRpbWl6ZShlKTtjYXNlIm51bWJlciI6cmV0dXJuIGlzTmFOKHQpP24oR24scik6MS90PDA/bih1bixyLHtvcGVyYXRvcjoiLSIsZXhwcmVzc2lvbjpuKFZuLHIse3ZhbHVlOi10fSl9KTpuKFZuLHIse3ZhbHVlOnR9KS5vcHRpbWl6ZShlKTtjYXNlImJvb2xlYW4iOnJldHVybiBuKHQ/bnQ6ZXQscikub3B0aW1pemUoZSk7Y2FzZSJ1bmRlZmluZWQiOnJldHVybiBuKEpuLHIpLm9wdGltaXplKGUpO2RlZmF1bHQ6aWYobnVsbD09PXQpcmV0dXJuIG4oWG4scix7dmFsdWU6bnVsbH0pLm9wdGltaXplKGUpO2lmKHQgaW5zdGFuY2VvZiBSZWdFeHApcmV0dXJuIG4oV24scix7dmFsdWU6dH0pLm9wdGltaXplKGUpO3Rocm93IG5ldyBFcnJvcihoKCJDYW4ndCBoYW5kbGUgY29uc3RhbnQgb2YgdHlwZToge3R5cGV9Iix7dHlwZTp0eXBlb2YgdH0pKX19ZnVuY3Rpb24gcihlLHQscil7cmV0dXJuIGUgaW5zdGFuY2VvZiBLZSYmZS5leHByZXNzaW9uPT09dCYmKHIgaW5zdGFuY2VvZiBubnx8ciBpbnN0YW5jZW9mIEhuJiYiZXZhbCI9PT1yLm5hbWUpP24oZW4sdCx7Y2FyOm4oVm4sdCx7dmFsdWU6MH0pLGNkcjpyfSk6cn1mdW5jdGlvbiB1KGUpe2lmKG51bGw9PT1lKXJldHVybltdO2lmKGUgaW5zdGFuY2VvZiBpZSlyZXR1cm4gZS5ib2R5O2lmKGUgaW5zdGFuY2VvZiBvZSlyZXR1cm5bXTtpZihlIGluc3RhbmNlb2YgUSlyZXR1cm5bZV07dGhyb3cgbmV3IEVycm9yKCJDYW4ndCBjb252ZXJ0IHRoaW5nIHRvIHN0YXRlbWVudCBhcnJheSIpfWZ1bmN0aW9uIGEoZSl7cmV0dXJuIG51bGw9PT1lfHwoZSBpbnN0YW5jZW9mIG9lfHxlIGluc3RhbmNlb2YgaWUmJjA9PWUuYm9keS5sZW5ndGgpfWZ1bmN0aW9uIHMoZSl7cmV0dXJuIShlIGluc3RhbmNlb2YgZ258fGUgaW5zdGFuY2VvZiBXZXx8ZSBpbnN0YW5jZW9mIFllKX1mdW5jdGlvbiBjKGUpe3JldHVybiBlIGluc3RhbmNlb2YgTmU/ZTooZSBpbnN0YW5jZW9mIHBlfHxlIGluc3RhbmNlb2YgZGV8fGUgaW5zdGFuY2VvZiBjZSkmJmUuYm9keSBpbnN0YW5jZW9mIGllP2UuYm9keTplfWZ1bmN0aW9uIGYoZSx0KXtmdW5jdGlvbiBpKGUsdCl7ZnVuY3Rpb24gbyhlLG4pe3JldHVybiBlIGluc3RhbmNlb2YgSG4mJihuIGluc3RhbmNlb2YgZm4mJmU9PT1uLmxlZnR8fG4gaW5zdGFuY2VvZiBvbiYmbi5leHByZXNzaW9uPT09ZSYmKCIrKyI9PW4ub3BlcmF0b3J8fCItLSI9PW4ub3BlcmF0b3IpKX1mdW5jdGlvbiB1KGksdSxjKXtpZihvKGksdSkpcmV0dXJuIGk7dmFyIHA9cih1LGksZy52YWx1ZSk7cmV0dXJuIGcudmFsdWU9bnVsbCxkLnNwbGljZShfLDEpLDA9PT1kLmxlbmd0aCYmKGVbbF09bihvZSxhKSxzPSEwKSxmLmNsZWFyX29wdF9mbGFncygpLHQud2FybigiUmVwbGFjaW5nICIrKGM/ImNvbnN0YW50IjoidmFyaWFibGUiKSsiICIrYisiIFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsaS5zdGFydCkseT0hMCxwfWZvcih2YXIgYT10LnNlbGYoKSxzPSExLGM9ZS5sZW5ndGg7LS1jPj0wOyl7dmFyIGY9ZVtjXTtpZighKGYgaW5zdGFuY2VvZiBMZSkpe2lmKFtmLGYuYm9keSxmLmFsdGVybmF0aXZlLGYuYmNhdGNoLGYuYmZpbmFsbHldLmZvckVhY2goZnVuY3Rpb24oZSl7ZSYmZS5ib2R5JiZpKGUuYm9keSx0KX0pLGM8PTApYnJlYWs7dmFyIGw9Yy0xLHA9ZVtsXTtpZihwIGluc3RhbmNlb2YgTGUpe3ZhciBkPXAuZGVmaW5pdGlvbnM7aWYobnVsbCE9ZClmb3IodmFyIGg9e30sRD0hMSxtPSExLHY9e30sXz1kLmxlbmd0aDstLV8+PTA7KXt2YXIgZz1kW19dO2lmKG51bGw9PWcudmFsdWUpYnJlYWs7dmFyIGI9Zy5uYW1lLm5hbWU7aWYoIWJ8fCFiLmxlbmd0aClicmVhaztpZihiIGluIGgpYnJlYWs7aFtiXT0hMDt2YXIgRT1hLmZpbmRfdmFyaWFibGUmJmEuZmluZF92YXJpYWJsZShiKTtpZihFJiZFLnJlZmVyZW5jZXMmJjE9PT1FLnJlZmVyZW5jZXMubGVuZ3RoJiYiYXJndW1lbnRzIiE9Yil7dmFyIEY9RS5yZWZlcmVuY2VzWzBdO2lmKEYuc2NvcGUudXNlc19ldmFsfHxGLnNjb3BlLnVzZXNfd2l0aClicmVhaztpZihnLnZhbHVlLmlzX2NvbnN0YW50KCkpe3ZhciB3PW5ldyBQKGZ1bmN0aW9uKGUpe2lmKGU9PT1GKXJldHVybiB1KGUsdy5wYXJlbnQoKSwhMCl9KTtmLnRyYW5zZm9ybSh3KX1lbHNlIGlmKCEoRHw9bSkpaWYoRi5zY29wZS5nZXRfZGVmdW5fc2NvcGUoKT09PWEpe3ZhciBDPW5ldyBBKGZ1bmN0aW9uKGUpe2UgaW5zdGFuY2VvZiBIbiYmbyhlLEMucGFyZW50KCkpJiYodltlLm5hbWVdPW09ITApfSk7Zy52YWx1ZS53YWxrKEMpO3ZhciBrPSExLHg9bmV3IFAoZnVuY3Rpb24oZSl7aWYoaylyZXR1cm4gZTt2YXIgbj14LnBhcmVudCgpO3JldHVybiBlIGluc3RhbmNlb2YgeWV8fGUgaW5zdGFuY2VvZiBQZXx8ZSBpbnN0YW5jZW9mIERlfHxlIGluc3RhbmNlb2YgSWV8fGUgaW5zdGFuY2VvZiBzZXx8biBpbnN0YW5jZW9mIHplJiZlIT09bi5jb25kaXRpb258fG4gaW5zdGFuY2VvZiBjbiYmZSE9PW4uY29uZGl0aW9ufHxuIGluc3RhbmNlb2Ygc24mJigiJiYiPT1uLm9wZXJhdG9yfHwifHwiPT1uLm9wZXJhdG9yKSYmZT09PW4ucmlnaHR8fG4gaW5zdGFuY2VvZiBOZSYmZSE9PW4uZXhwcmVzc2lvbj8oRD1rPSEwLGUpOnZvaWQgMH0sZnVuY3Rpb24oZSl7cmV0dXJuIGs/ZTplPT09Rj8oaz0hMCx1KGUseC5wYXJlbnQoKSwhMSkpOihEfD1lLmhhc19zaWRlX2VmZmVjdHModCkpPyhrPSEwLGUpOm0mJmUgaW5zdGFuY2VvZiBIbiYmZS5uYW1lIGluIHY/KEQ9ITAsaz0hMCxlKTp2b2lkIDB9KTtmLnRyYW5zZm9ybSh4KX1lbHNlIER8PWcudmFsdWUuaGFzX3NpZGVfZWZmZWN0cyh0KX1lbHNlIEQ9ITB9fX19aWYocylmb3IodmFyIEI9ZS5sZW5ndGg7LS1CPj0wOyllLmxlbmd0aD4xJiZlW0JdaW5zdGFuY2VvZiBvZSYmZS5zcGxpY2UoQiwxKTtyZXR1cm4gZX1mdW5jdGlvbiBvKGUpe2Z1bmN0aW9uIHIoZSl7cmV0dXJuL0BuZ0luamVjdC8udGVzdChlLnZhbHVlKX1mdW5jdGlvbiBpKGUpe3ZhciByPSExO3JldHVybiBlLmFyZ25hbWVzLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIHdlJiYodC53YXJuKCJGdW5jdGlvbiB3aXRoIGRlc3RydWN0dXJpbmcgYXJndW1lbnRzIG1hcmtlZCB3aXRoIEBuZ0luamVjdCBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHRva2VuKSxyPSEwKSxyP251bGw6bihMbixlLHt2YWx1ZTplLm5hbWV9KX0pLmZpbHRlcihmdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9PWV9KX1mdW5jdGlvbiBvKGUsdCl7cmV0dXJuIG4obG4sZSx7ZWxlbWVudHM6dH0pfWZ1bmN0aW9uIHUoZSx0KXtyZXR1cm4gbih0ZSxlLHtib2R5Om4oZm4sZSx7b3BlcmF0b3I6Ij0iLGxlZnQ6bih0bix0LHtleHByZXNzaW9uOm4oSG4sdCx0KSxwcm9wZXJ0eToiJGluamVjdCJ9KSxyaWdodDpvKGUsaShlKSl9KX0pfWZ1bmN0aW9uIGEoZSl7ZSYmZS5hcmdzJiYoZS5hcmdzLmZvckVhY2goZnVuY3Rpb24oZSxuLHQpe3ZhciB1PWUuc3RhcnQuY29tbWVudHNfYmVmb3JlO2UgaW5zdGFuY2VvZiB5ZSYmdS5sZW5ndGgmJnIodVswXSkmJih0W25dPW8oZSxpKGUpLmNvbmNhdChlKSkpfSksZS5leHByZXNzaW9uJiZlLmV4cHJlc3Npb24uZXhwcmVzc2lvbiYmYShlLmV4cHJlc3Npb24uZXhwcmVzc2lvbikpfXJldHVybiBlLnJlZHVjZShmdW5jdGlvbihlLG4pe2lmKGUucHVzaChuKSxuLmJvZHkmJm4uYm9keS5hcmdzKWEobi5ib2R5KTtlbHNle3ZhciBpPW4uc3RhcnQsbz1pLmNvbW1lbnRzX2JlZm9yZTtpZihvJiZvLmxlbmd0aD4wKXt2YXIgcz1vLnBvcCgpO3IocykmJihuIGluc3RhbmNlb2YgRmU/ZS5wdXNoKHUobixuLm5hbWUpKTpuIGluc3RhbmNlb2YgTGU/bi5kZWZpbml0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKG4pe24udmFsdWUmJm4udmFsdWUgaW5zdGFuY2VvZiB5ZSYmZS5wdXNoKHUobi52YWx1ZSxuLm5hbWUpKX0pOnQud2FybigiVW5rbm93biBzdGF0ZW1lbnQgbWFya2VkIHdpdGggQG5nSW5qZWN0IFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsaSkpfX1yZXR1cm4gZX0sW10pfWZ1bmN0aW9uIGEoZSl7dmFyIG49W107cmV0dXJuIGUucmVkdWNlKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQgaW5zdGFuY2VvZiBpZSYmXyh0LmJvZHkscyk/KHk9ITAsZS5wdXNoLmFwcGx5KGUsYSh0LmJvZHkpKSk6dCBpbnN0YW5jZW9mIG9lP3k9ITA6dCBpbnN0YW5jZW9mIG5lP24uaW5kZXhPZih0LnZhbHVlKTwwPyhlLnB1c2godCksbi5wdXNoKHQudmFsdWUpKTp5PSEwOmUucHVzaCh0KSxlfSxbXSl9ZnVuY3Rpb24gZihlLHQpe2Z1bmN0aW9uIHIoZSl7Zm9yKHZhciBuPTAsdD1lLmxlbmd0aDstLXQ+PTA7KXt2YXIgcj1lW3RdO2lmKHIgaW5zdGFuY2VvZiB6ZSYmci5ib2R5IGluc3RhbmNlb2YgVGUmJisrbj4xKXJldHVybiEwfXJldHVybiExfXZhciBpPXQuc2VsZigpLG89cihlKSxhPWkgaW5zdGFuY2VvZiB5ZSxzPVtdO2U6Zm9yKHZhciBmPWUubGVuZ3RoOy0tZj49MDspe3ZhciBsPWVbZl07c3dpdGNoKCEwKXtjYXNlIGEmJmwgaW5zdGFuY2VvZiBUZSYmIWwudmFsdWUmJjA9PXMubGVuZ3RoOnk9ITA7Y29udGludWUgZTtjYXNlIGwgaW5zdGFuY2VvZiB6ZTppZihsLmJvZHkgaW5zdGFuY2VvZiBUZSl7aWYoKGEmJjA9PXMubGVuZ3RofHxzWzBdaW5zdGFuY2VvZiBUZSYmIXNbMF0udmFsdWUpJiYhbC5ib2R5LnZhbHVlJiYhbC5hbHRlcm5hdGl2ZSl7eT0hMDt2YXIgcD1uKHRlLGwuY29uZGl0aW9uLHtib2R5OmwuY29uZGl0aW9ufSk7cy51bnNoaWZ0KHApO2NvbnRpbnVlIGV9aWYoc1swXWluc3RhbmNlb2YgVGUmJmwuYm9keS52YWx1ZSYmc1swXS52YWx1ZSYmIWwuYWx0ZXJuYXRpdmUpe3k9ITAsbD1sLmNsb25lKCksbC5hbHRlcm5hdGl2ZT1zWzBdLHNbMF09bC50cmFuc2Zvcm0odCk7Y29udGludWUgZX1pZihvJiYoMD09cy5sZW5ndGh8fHNbMF1pbnN0YW5jZW9mIFRlKSYmbC5ib2R5LnZhbHVlJiYhbC5hbHRlcm5hdGl2ZSYmYSl7eT0hMCxsPWwuY2xvbmUoKSxsLmFsdGVybmF0aXZlPXNbMF18fG4oVGUsbCx7dmFsdWU6bihKbixsKX0pLHNbMF09bC50cmFuc2Zvcm0odCk7Y29udGludWUgZX1pZighbC5ib2R5LnZhbHVlJiZhKXt5PSEwLGw9bC5jbG9uZSgpLGwuY29uZGl0aW9uPWwuY29uZGl0aW9uLm5lZ2F0ZSh0KTt2YXIgaD11KGwuYWx0ZXJuYXRpdmUpLmNvbmNhdChzKSxtPWQoaCk7bC5ib2R5PW4oaWUsbCx7Ym9keTpofSksbC5hbHRlcm5hdGl2ZT1udWxsLHM9bS5jb25jYXQoW2wudHJhbnNmb3JtKHQpXSk7Y29udGludWUgZX1pZih0Lm9wdGlvbigic2VxdWVuY2VzIikmJjE9PXMubGVuZ3RoJiZhJiZzWzBdaW5zdGFuY2VvZiB0ZSYmKCFsLmFsdGVybmF0aXZlfHxsLmFsdGVybmF0aXZlIGluc3RhbmNlb2YgdGUpKXt5PSEwLHMucHVzaChuKFRlLHNbMF0se3ZhbHVlOm4oSm4sc1swXSl9KS50cmFuc2Zvcm0odCkpLHM9dShsLmFsdGVybmF0aXZlKS5jb25jYXQocykscy51bnNoaWZ0KGwpO2NvbnRpbnVlIGV9fXZhciB2PXcobC5ib2R5KSxfPXYgaW5zdGFuY2VvZiBPZT90Lmxvb3Bjb250cm9sX3RhcmdldCh2LmxhYmVsKTpudWxsO2lmKHYmJih2IGluc3RhbmNlb2YgVGUmJiF2LnZhbHVlJiZhfHx2IGluc3RhbmNlb2YgTWUmJmk9PT1jKF8pfHx2IGluc3RhbmNlb2YgcWUmJl8gaW5zdGFuY2VvZiBpZSYmaT09PV8pKXt2LmxhYmVsJiZEKHYubGFiZWwudGhlZGVmLnJlZmVyZW5jZXMsdikseT0hMDt2YXIgaD11KGwuYm9keSkuc2xpY2UoMCwtMSk7bD1sLmNsb25lKCksbC5jb25kaXRpb249bC5jb25kaXRpb24ubmVnYXRlKHQpLGwuYm9keT1uKGllLGwse2JvZHk6dShsLmFsdGVybmF0aXZlKS5jb25jYXQocyl9KSxsLmFsdGVybmF0aXZlPW4oaWUsbCx7Ym9keTpofSkscz1bbC50cmFuc2Zvcm0odCldO2NvbnRpbnVlIGV9dmFyIHY9dyhsLmFsdGVybmF0aXZlKSxfPXYgaW5zdGFuY2VvZiBPZT90Lmxvb3Bjb250cm9sX3RhcmdldCh2LmxhYmVsKTpudWxsO2lmKHYmJih2IGluc3RhbmNlb2YgVGUmJiF2LnZhbHVlJiZhfHx2IGluc3RhbmNlb2YgTWUmJmk9PT1jKF8pfHx2IGluc3RhbmNlb2YgcWUmJl8gaW5zdGFuY2VvZiBpZSYmaT09PV8pKXt2LmxhYmVsJiZEKHYubGFiZWwudGhlZGVmLnJlZmVyZW5jZXMsdikseT0hMCxsPWwuY2xvbmUoKSxsLmJvZHk9bihpZSxsLmJvZHkse2JvZHk6dShsLmJvZHkpLmNvbmNhdChzKX0pLGwuYWx0ZXJuYXRpdmU9bihpZSxsLmFsdGVybmF0aXZlLHtib2R5OnUobC5hbHRlcm5hdGl2ZSkuc2xpY2UoMCwtMSl9KSxzPVtsLnRyYW5zZm9ybSh0KV07Y29udGludWUgZX1zLnVuc2hpZnQobCk7YnJlYWs7ZGVmYXVsdDpzLnVuc2hpZnQobCl9fXJldHVybiBzfWZ1bmN0aW9uIGwoZSxuKXt2YXIgdD0hMSxyPWUubGVuZ3RoLGk9bi5zZWxmKCk7cmV0dXJuIGU9ZS5yZWR1Y2UoZnVuY3Rpb24oZSxyKXtpZih0KWIobixyLGUpO2Vsc2V7aWYociBpbnN0YW5jZW9mIE9lKXt2YXIgbz1uLmxvb3Bjb250cm9sX3RhcmdldChyLmxhYmVsKTtyIGluc3RhbmNlb2YgcWUmJm8gaW5zdGFuY2VvZiBpZSYmYyhvKT09PWl8fHIgaW5zdGFuY2VvZiBNZSYmYyhvKT09PWk/ci5sYWJlbCYmRChyLmxhYmVsLnRoZWRlZi5yZWZlcmVuY2VzLHIpOmUucHVzaChyKX1lbHNlIGUucHVzaChyKTt3KHIpJiYodD0hMCl9cmV0dXJuIGV9LFtdKSx5PWUubGVuZ3RoIT1yLGV9ZnVuY3Rpb24gcChlLHQpe2Z1bmN0aW9uIHIoKXtpPWVuLmZyb21fYXJyYXkoaSksaSYmby5wdXNoKG4odGUsaSx7Ym9keTppfSkpLGk9W119aWYoZS5sZW5ndGg8MilyZXR1cm4gZTt2YXIgaT1bXSxvPVtdO3JldHVybiBlLmZvckVhY2goZnVuY3Rpb24oZSl7ZSBpbnN0YW5jZW9mIHRlJiZoKGkpPHQuc2VxdWVuY2VzX2xpbWl0P2kucHVzaChlLmJvZHkpOihyKCksby5wdXNoKGUpKX0pLHIoKSxvPW0obyx0KSx5PW8ubGVuZ3RoIT1lLmxlbmd0aCxvfWZ1bmN0aW9uIGgoZSl7Zm9yKHZhciBuPTAsdD0wO3Q8ZS5sZW5ndGg7Kyt0KXt2YXIgcj1lW3RdO3IgaW5zdGFuY2VvZiBlbj9uKz1yLmxlbigpOm4rK31yZXR1cm4gbn1mdW5jdGlvbiBtKGUsdCl7ZnVuY3Rpb24gcihlKXtpLnBvcCgpO3ZhciBuPW8uYm9keTtyZXR1cm4gbiBpbnN0YW5jZW9mIGVuP24uYWRkKGUpOm49ZW4uY29ucyhuLGUpLG4udHJhbnNmb3JtKHQpfXZhciBpPVtdLG89bnVsbDtyZXR1cm4gZS5mb3JFYWNoKGZ1bmN0aW9uKGUpe2lmKG8paWYoZSBpbnN0YW5jZW9mIHBlKXt2YXIgdD17fTt0cnl7by5ib2R5LndhbGsobmV3IEEoZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mIHNuJiYiaW4iPT1lLm9wZXJhdG9yKXRocm93IHR9KSksIWUuaW5pdHx8ZS5pbml0IGluc3RhbmNlb2YgTGU/ZS5pbml0fHwoZS5pbml0PW8uYm9keSxpLnBvcCgpKTplLmluaXQ9cihlLmluaXQpfWNhdGNoKGUpe2lmKGUhPT10KXRocm93IGV9fWVsc2UgZSBpbnN0YW5jZW9mIHplP2UuY29uZGl0aW9uPXIoZS5jb25kaXRpb24pOmUgaW5zdGFuY2VvZiBEZT9lLmV4cHJlc3Npb249cihlLmV4cHJlc3Npb24pOmUgaW5zdGFuY2VvZiBTZSYmZS52YWx1ZT9lLnZhbHVlPXIoZS52YWx1ZSk6ZSBpbnN0YW5jZW9mIFNlP2UudmFsdWU9cihuKEpuLGUpKTplIGluc3RhbmNlb2YgTmUmJihlLmV4cHJlc3Npb249cihlLmV4cHJlc3Npb24pKTtpLnB1c2goZSksbz1lIGluc3RhbmNlb2YgdGU/ZTpudWxsfSksaX1mdW5jdGlvbiB2KGUsbil7dmFyIHQ9bnVsbDtyZXR1cm4gZS5yZWR1Y2UoZnVuY3Rpb24oZSxuKXtyZXR1cm4gbiBpbnN0YW5jZW9mIExlJiZ0JiZ0LlRZUEU9PW4uVFlQRT8odC5kZWZpbml0aW9ucz10LmRlZmluaXRpb25zLmNvbmNhdChuLmRlZmluaXRpb25zKSx5PSEwKTpuIGluc3RhbmNlb2YgcGUmJnQgaW5zdGFuY2VvZiBWZSYmKCFuLmluaXR8fG4uaW5pdC5UWVBFPT10LlRZUEUpPyh5PSEwLGUucG9wKCksbi5pbml0P24uaW5pdC5kZWZpbml0aW9ucz10LmRlZmluaXRpb25zLmNvbmNhdChuLmluaXQuZGVmaW5pdGlvbnMpOm4uaW5pdD10LGUucHVzaChuKSx0PW4pOih0PW4sZS5wdXNoKG4pKSxlfSxbXSl9ZnVuY3Rpb24gZyhlLHQpe2Z1bmN0aW9uIHIoZSl7cmV0dXJuIGUgaW5zdGFuY2VvZiBLZSYmKGUuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEVlfHxyKGUuZXhwcmVzc2lvbikpfWUuZm9yRWFjaChmdW5jdGlvbihlKXtlIGluc3RhbmNlb2YgdGUmJihlLmJvZHk9ZnVuY3Rpb24gZSh0KXtyZXR1cm4gdC50cmFuc2Zvcm0obmV3IFAoZnVuY3Rpb24odCl7aWYodCBpbnN0YW5jZW9mIFFlKXJldHVybiB0O2lmKHIodCkpcmV0dXJuIG4odW4sdCx7b3BlcmF0b3I6IiEiLGV4cHJlc3Npb246dH0pO2lmKHQgaW5zdGFuY2VvZiBLZSl0LmV4cHJlc3Npb249ZSh0LmV4cHJlc3Npb24pO2Vsc2UgaWYodCBpbnN0YW5jZW9mIGVuKXQuY2FyPWUodC5jYXIpO2Vsc2UgaWYodCBpbnN0YW5jZW9mIGNuKXt2YXIgaT1lKHQuY29uZGl0aW9uKTtpZihpIT09dC5jb25kaXRpb24pe3QuY29uZGl0aW9uPWk7dmFyIG89dC5jb25zZXF1ZW50O3QuY29uc2VxdWVudD10LmFsdGVybmF0aXZlLHQuYWx0ZXJuYXRpdmU9b319cmV0dXJuIHR9KSl9KGUuYm9keSkpfSl9dmFyIHksRT0xMDtkbyB5PSExLHQub3B0aW9uKCJhbmd1bGFyIikmJihlPW8oZSkpLGU9YShlKSx0Lm9wdGlvbigiZGVhZF9jb2RlIikmJihlPWwoZSx0KSksdC5vcHRpb24oImlmX3JldHVybiIpJiYoZT1mKGUsdCkpLHQuc2VxdWVuY2VzX2xpbWl0PjAmJihlPXAoZSx0KSksdC5vcHRpb24oImpvaW5fdmFycyIpJiYoZT12KGUsdCkpLHQub3B0aW9uKCJjb2xsYXBzZV92YXJzIikmJihlPWkoZSx0KSk7d2hpbGUoeSYmRS0tID4wKTtyZXR1cm4gdC5vcHRpb24oIm5lZ2F0ZV9paWZlIikmJmcoZSx0KSxlfWZ1bmN0aW9uIGQoZSl7Zm9yKHZhciBuPVtdLHQ9ZS5sZW5ndGgtMTt0Pj0wOy0tdCl7dmFyIHI9ZVt0XTtyIGluc3RhbmNlb2YgRmUmJihlLnNwbGljZSh0LDEpLG4udW5zaGlmdChyKSl9cmV0dXJuIG59ZnVuY3Rpb24gYihlLG4sdCl7biBpbnN0YW5jZW9mIEZlfHxlLndhcm4oIkRyb3BwaW5nIHVucmVhY2hhYmxlIGNvZGUgW3tmaWxlfTp7bGluZX0se2NvbH1dIixuLnN0YXJ0KSxuLndhbGsobmV3IEEoZnVuY3Rpb24obil7cmV0dXJuIG4gaW5zdGFuY2VvZiBWZT8oZS53YXJuKCJEZWNsYXJhdGlvbnMgaW4gdW5yZWFjaGFibGUgY29kZSEgW3tmaWxlfTp7bGluZX0se2NvbH1dIixuLnN0YXJ0KSxuLnJlbW92ZV9pbml0aWFsaXplcnMoKSx0LnB1c2gobiksITApOm4gaW5zdGFuY2VvZiBGZT8odC5wdXNoKG4pLCEwKTpuIGluc3RhbmNlb2YgbWV8fHZvaWQgMH0pKX1mdW5jdGlvbiBFKGUsbil7cmV0dXJuIG4gaW5zdGFuY2VvZiBvbiYmKCIrKyI9PT1uLm9wZXJhdG9yfHwiLS0iPT09bi5vcGVyYXRvcil8fG4gaW5zdGFuY2VvZiBmbiYmbi5sZWZ0PT09ZX1mdW5jdGlvbiBGKGUsbil7cmV0dXJuIGUucHJpbnRfdG9fc3RyaW5nKCkubGVuZ3RoPm4ucHJpbnRfdG9fc3RyaW5nKCkubGVuZ3RoP246ZX1mdW5jdGlvbiB3KGUpe3JldHVybiBlJiZlLmFib3J0cygpfWZ1bmN0aW9uIEMoZSx0KXtmdW5jdGlvbiByKHIpe3I9dShyKSxlLmJvZHkgaW5zdGFuY2VvZiBpZT8oZS5ib2R5PWUuYm9keS5jbG9uZSgpLGUuYm9keS5ib2R5PXIuY29uY2F0KGUuYm9keS5ib2R5LnNsaWNlKDEpKSxlLmJvZHk9ZS5ib2R5LnRyYW5zZm9ybSh0KSk6ZS5ib2R5PW4oaWUsZS5ib2R5LHtib2R5OnJ9KS50cmFuc2Zvcm0odCksQyhlLHQpfXZhciBpPWUuYm9keSBpbnN0YW5jZW9mIGllP2UuYm9keS5ib2R5WzBdOmUuYm9keTtpIGluc3RhbmNlb2YgemUmJihpLmJvZHkgaW5zdGFuY2VvZiBxZSYmdC5sb29wY29udHJvbF90YXJnZXQoaS5ib2R5LmxhYmVsKT09PWU/KGUuY29uZGl0aW9uP2UuY29uZGl0aW9uPW4oc24sZS5jb25kaXRpb24se2xlZnQ6ZS5jb25kaXRpb24sb3BlcmF0b3I6IiYmIixyaWdodDppLmNvbmRpdGlvbi5uZWdhdGUodCl9KTplLmNvbmRpdGlvbj1pLmNvbmRpdGlvbi5uZWdhdGUodCkscihpLmFsdGVybmF0aXZlKSk6aS5hbHRlcm5hdGl2ZSBpbnN0YW5jZW9mIHFlJiZ0Lmxvb3Bjb250cm9sX3RhcmdldChpLmFsdGVybmF0aXZlLmxhYmVsKT09PWUmJihlLmNvbmRpdGlvbj9lLmNvbmRpdGlvbj1uKHNuLGUuY29uZGl0aW9uLHtsZWZ0OmUuY29uZGl0aW9uLG9wZXJhdG9yOiImJiIscmlnaHQ6aS5jb25kaXRpb259KTplLmNvbmRpdGlvbj1pLmNvbmRpdGlvbixyKGkuYm9keSkpKX1mdW5jdGlvbiBrKGUsbil7dmFyIHQ9bi5vcHRpb24oInB1cmVfZ2V0dGVycyIpO24ub3B0aW9ucy5wdXJlX2dldHRlcnM9ITE7dmFyIHI9ZS5oYXNfc2lkZV9lZmZlY3RzKG4pO3JldHVybiBuLm9wdGlvbnMucHVyZV9nZXR0ZXJzPXQscn1mdW5jdGlvbiB4KGUsdCl7cmV0dXJuIHQub3B0aW9uKCJib29sZWFucyIpJiZ0LmluX2Jvb2xlYW5fY29udGV4dCgpJiYhZS5oYXNfc2lkZV9lZmZlY3RzKHQpP24obnQsZSk6ZX1lKEssZnVuY3Rpb24oZSxuKXtyZXR1cm4gZX0pLEsuREVGTUVUSE9EKCJlcXVpdmFsZW50X3RvIixmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5wcmludF90b19zdHJpbmcoKT09ZS5wcmludF90b19zdHJpbmcoKX0pLEsuREVGTUVUSE9EKCJjbGVhcl9vcHRfZmxhZ3MiLGZ1bmN0aW9uKCl7dGhpcy53YWxrKG5ldyBBKGZ1bmN0aW9uKGUpe2lmKGUgaW5zdGFuY2VvZiBIbil7dmFyIG49ZS5kZWZpbml0aW9uKCk7biYmbi5pbml0JiZkZWxldGUgbi5pbml0Ll9ldmFsdWF0ZWR9ZSBpbnN0YW5jZW9mIG5lfHxlIGluc3RhbmNlb2YgUm58fChlLl9zcXVlZXplZD0hMSxlLl9vcHRpbWl6ZWQ9ITEpfSkpfSksZnVuY3Rpb24oZSl7dmFyIG49WyIhIiwiZGVsZXRlIl0sdD1bImluIiwiaW5zdGFuY2VvZiIsIj09IiwiIT0iLCI9PT0iLCIhPT0iLCI8IiwiPD0iLCI+PSIsIj4iXTtlKEssbCksZSh1bixmdW5jdGlvbigpe3JldHVybiBpKHRoaXMub3BlcmF0b3Isbil9KSxlKHNuLGZ1bmN0aW9uKCl7cmV0dXJuIGkodGhpcy5vcGVyYXRvcix0KXx8KCImJiI9PXRoaXMub3BlcmF0b3J8fCJ8fCI9PXRoaXMub3BlcmF0b3IpJiZ0aGlzLmxlZnQuaXNfYm9vbGVhbigpJiZ0aGlzLnJpZ2h0LmlzX2Jvb2xlYW4oKX0pLGUoY24sZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb25zZXF1ZW50LmlzX2Jvb2xlYW4oKSYmdGhpcy5hbHRlcm5hdGl2ZS5pc19ib29sZWFuKCl9KSxlKGZuLGZ1bmN0aW9uKCl7cmV0dXJuIj0iPT10aGlzLm9wZXJhdG9yJiZ0aGlzLnJpZ2h0LmlzX2Jvb2xlYW4oKX0pLGUoZW4sZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jZHIuaXNfYm9vbGVhbigpfSksZShudCxwKSxlKGV0LHApfShmdW5jdGlvbihlLG4pe2UuREVGTUVUSE9EKCJpc19ib29sZWFuIixuKX0pLGZ1bmN0aW9uKGUpe2UoSyxmdW5jdGlvbigpe3JldHVybiExfSksZShMbixmdW5jdGlvbigpe3JldHVybiEwfSksZShrZSxmdW5jdGlvbigpe3JldHVybiAxPT09dGhpcy5zZWdtZW50cy5sZW5ndGh9KSxlKHVuLGZ1bmN0aW9uKCl7cmV0dXJuInR5cGVvZiI9PXRoaXMub3BlcmF0b3J9KSxlKHNuLGZ1bmN0aW9uKGUpe3JldHVybiIrIj09dGhpcy5vcGVyYXRvciYmKHRoaXMubGVmdC5pc19zdHJpbmcoZSl8fHRoaXMucmlnaHQuaXNfc3RyaW5nKGUpKX0pLGUoZm4sZnVuY3Rpb24oZSl7cmV0dXJuKCI9Ij09dGhpcy5vcGVyYXRvcnx8Iis9Ij09dGhpcy5vcGVyYXRvcikmJnRoaXMucmlnaHQuaXNfc3RyaW5nKGUpfSksZShlbixmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5jZHIuaXNfc3RyaW5nKGUpfSksZShjbixmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5jb25zZXF1ZW50LmlzX3N0cmluZyhlKSYmdGhpcy5hbHRlcm5hdGl2ZS5pc19zdHJpbmcoZSl9KSxlKEtlLGZ1bmN0aW9uKGUpe3JldHVybiBlLm9wdGlvbigidW5zYWZlIikmJnRoaXMuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEhuJiYiU3RyaW5nIj09dGhpcy5leHByZXNzaW9uLm5hbWUmJnRoaXMuZXhwcmVzc2lvbi51bmRlY2xhcmVkKCl9KX0oZnVuY3Rpb24oZSxuKXtlLkRFRk1FVEhPRCgiaXNfc3RyaW5nIixuKX0pLGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIG4oZSxuKXtpZighbil0aHJvdyBuZXcgRXJyb3IoIkNvbXByZXNzb3IgbXVzdCBiZSBwYXNzZWQiKTtyZXR1cm4gZS5fZXZhbChuKX1LLkRFRk1FVEhPRCgiZXZhbHVhdGUiLGZ1bmN0aW9uKG4pe2lmKCFuLm9wdGlvbigiZXZhbHVhdGUiKSlyZXR1cm5bdGhpc107dmFyIHI7dHJ5e3I9dGhpcy5fZXZhbChuKX1jYXRjaChuKXtpZihuIT09ZSl0aHJvdyBuO3JldHVyblt0aGlzXX12YXIgaTt0cnl7aT10KG4scix0aGlzKX1jYXRjaChlKXtyZXR1cm5bdGhpc119cmV0dXJuW0YoaSx0aGlzKSxyXX0pO3ZhciByPXYoIiEgfiAtICsiKTtLLkRFRk1FVEhPRCgiaXNfY29uc3RhbnQiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBSbj8hKHRoaXMgaW5zdGFuY2VvZiBXbik6dGhpcyBpbnN0YW5jZW9mIHVuJiZ0aGlzLmV4cHJlc3Npb24gaW5zdGFuY2VvZiBSbiYmcih0aGlzLm9wZXJhdG9yKX0pLEsuREVGTUVUSE9EKCJjb25zdGFudF92YWx1ZSIsZnVuY3Rpb24oZSl7aWYodGhpcyBpbnN0YW5jZW9mIFJuJiYhKHRoaXMgaW5zdGFuY2VvZiBXbikpcmV0dXJuIHRoaXMudmFsdWU7aWYodGhpcyBpbnN0YW5jZW9mIHVuJiZ0aGlzLmV4cHJlc3Npb24gaW5zdGFuY2VvZiBSbilzd2l0Y2godGhpcy5vcGVyYXRvcil7Y2FzZSIhIjpyZXR1cm4hdGhpcy5leHByZXNzaW9uLnZhbHVlO2Nhc2UifiI6cmV0dXJufnRoaXMuZXhwcmVzc2lvbi52YWx1ZTtjYXNlIi0iOnJldHVybi10aGlzLmV4cHJlc3Npb24udmFsdWU7Y2FzZSIrIjpyZXR1cm4rdGhpcy5leHByZXNzaW9uLnZhbHVlO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGgoIkNhbm5vdCBldmFsdWF0ZSB1bmFyeSBleHByZXNzaW9uIHt2YWx1ZX0iLHt2YWx1ZTp0aGlzLnByaW50X3RvX3N0cmluZygpfSkpfXZhciBuPXRoaXMuZXZhbHVhdGUoZSk7aWYobi5sZW5ndGg+MSlyZXR1cm4gblsxXTt0aHJvdyBuZXcgRXJyb3IoaCgiQ2Fubm90IGV2YWx1YXRlIGNvbnN0YW50IFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsdGhpcy5zdGFydCkpfSksZShRLGZ1bmN0aW9uKCl7dGhyb3cgbmV3IEVycm9yKGgoIkNhbm5vdCBldmFsdWF0ZSBhIHN0YXRlbWVudCBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHRoaXMuc3RhcnQpKX0pLGUoRWUsZnVuY3Rpb24oKXt0aHJvdyBlfSksZShBZSxmdW5jdGlvbigpe3Rocm93IGV9KSxlKF9uLGZ1bmN0aW9uKCl7dGhyb3cgZX0pLGUoSyxmdW5jdGlvbigpe3Rocm93IGV9KSxlKFJuLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VmFsdWUoKX0pLGUoa2UsZnVuY3Rpb24oKXtpZigxIT09dGhpcy5zZWdtZW50cy5sZW5ndGgpdGhyb3cgZTtyZXR1cm4gdGhpcy5zZWdtZW50c1swXS52YWx1ZX0pLGUobG4sZnVuY3Rpb24odCl7aWYodC5vcHRpb24oInVuc2FmZSIpKXJldHVybiB0aGlzLmVsZW1lbnRzLm1hcChmdW5jdGlvbihlKXsKcmV0dXJuIG4oZSx0KX0pO3Rocm93IGV9KSxlKHBuLGZ1bmN0aW9uKHQpe2lmKHQub3B0aW9uKCJ1bnNhZmUiKSl7Zm9yKHZhciByPXt9LGk9MCxvPXRoaXMucHJvcGVydGllcy5sZW5ndGg7aTxvO2krKyl7dmFyIHU9dGhpcy5wcm9wZXJ0aWVzW2ldLGE9dS5rZXk7aWYoYSBpbnN0YW5jZW9mIEsmJihhPW4oYSx0KSksImZ1bmN0aW9uIj09dHlwZW9mIE9iamVjdC5wcm90b3R5cGVbYV0pdGhyb3cgZTtyW2FdPW4odS52YWx1ZSx0KX1yZXR1cm4gcn10aHJvdyBlfSksZSh1bixmdW5jdGlvbih0KXt2YXIgcj10aGlzLmV4cHJlc3Npb247c3dpdGNoKHRoaXMub3BlcmF0b3Ipe2Nhc2UiISI6cmV0dXJuIW4ocix0KTtjYXNlInR5cGVvZiI6aWYociBpbnN0YW5jZW9mIEVlfHxyIGluc3RhbmNlb2YgQWUpcmV0dXJuImZ1bmN0aW9uIjtpZihyPW4ocix0KSxyIGluc3RhbmNlb2YgUmVnRXhwKXRocm93IGU7cmV0dXJuIHR5cGVvZiByO2Nhc2Uidm9pZCI6cmV0dXJuIHZvaWQgbihyLHQpO2Nhc2UifiI6cmV0dXJufm4ocix0KTtjYXNlIi0iOnJldHVybi1uKHIsdCk7Y2FzZSIrIjpyZXR1cm4rbihyLHQpfXRocm93IGV9KSxlKHNuLGZ1bmN0aW9uKHQpe3ZhciByLGk9dGhpcy5sZWZ0LG89dGhpcy5yaWdodDtzd2l0Y2godGhpcy5vcGVyYXRvcil7Y2FzZSImJiI6cj1uKGksdCkmJm4obyx0KTticmVhaztjYXNlInx8IjpyPW4oaSx0KXx8bihvLHQpO2JyZWFrO2Nhc2UifCI6cj1uKGksdCl8bihvLHQpO2JyZWFrO2Nhc2UiJiI6cj1uKGksdCkmbihvLHQpO2JyZWFrO2Nhc2UiXiI6cj1uKGksdClebihvLHQpO2JyZWFrO2Nhc2UiKyI6cj1uKGksdCkrbihvLHQpO2JyZWFrO2Nhc2UiKiI6cj1uKGksdCkqbihvLHQpO2JyZWFrO2Nhc2UiKioiOnI9TWF0aC5wb3cobihpLHQpLG4obyx0KSk7YnJlYWs7Y2FzZSIvIjpyPW4oaSx0KS9uKG8sdCk7YnJlYWs7Y2FzZSIlIjpyPW4oaSx0KSVuKG8sdCk7YnJlYWs7Y2FzZSItIjpyPW4oaSx0KS1uKG8sdCk7YnJlYWs7Y2FzZSI8PCI6cj1uKGksdCk8PG4obyx0KTticmVhaztjYXNlIj4+IjpyPW4oaSx0KT4+bihvLHQpO2JyZWFrO2Nhc2UiPj4+IjpyPW4oaSx0KT4+Pm4obyx0KTticmVhaztjYXNlIj09IjpyPW4oaSx0KT09bihvLHQpO2JyZWFrO2Nhc2UiPT09IjpyPW4oaSx0KT09PW4obyx0KTticmVhaztjYXNlIiE9IjpyPW4oaSx0KSE9bihvLHQpO2JyZWFrO2Nhc2UiIT09IjpyPW4oaSx0KSE9PW4obyx0KTticmVhaztjYXNlIjwiOnI9bihpLHQpPG4obyx0KTticmVhaztjYXNlIjw9IjpyPW4oaSx0KTw9bihvLHQpO2JyZWFrO2Nhc2UiPiI6cj1uKGksdCk+bihvLHQpO2JyZWFrO2Nhc2UiPj0iOnI9bihpLHQpPj1uKG8sdCk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBlfWlmKGlzTmFOKHIpJiZ0LmZpbmRfcGFyZW50KERlKSl0aHJvdyBlO3JldHVybiByfSksZShjbixmdW5jdGlvbihlKXtyZXR1cm4gbih0aGlzLmNvbmRpdGlvbixlKT9uKHRoaXMuY29uc2VxdWVudCxlKTpuKHRoaXMuYWx0ZXJuYXRpdmUsZSl9KSxlKEhuLGZ1bmN0aW9uKHQpe2lmKHRoaXMuX2V2YWx1YXRpbmcpdGhyb3cgZTt0aGlzLl9ldmFsdWF0aW5nPSEwO3RyeXt2YXIgcj10aGlzLmRlZmluaXRpb24oKTtpZihyJiYoci5jb25zdGFudHx8dC5vcHRpb24oInJlZHVjZV92YXJzIikmJiFyLm1vZGlmaWVkKSYmci5pbml0KXJldHVybiB0Lm9wdGlvbigidW5zYWZlIik/KHkoci5pbml0LCJfZXZhbHVhdGVkIil8fChyLmluaXQuX2V2YWx1YXRlZD1uKHIuaW5pdCx0KSksci5pbml0Ll9ldmFsdWF0ZWQpOm4oci5pbml0LHQpfWZpbmFsbHl7dGhpcy5fZXZhbHVhdGluZz0hMX10aHJvdyBlfSksZShubixmdW5jdGlvbih0KXtpZih0Lm9wdGlvbigidW5zYWZlIikpe3ZhciByPXRoaXMucHJvcGVydHk7ciBpbnN0YW5jZW9mIEsmJihyPW4ocix0KSk7dmFyIGk9bih0aGlzLmV4cHJlc3Npb24sdCk7aWYoaSYmeShpLHIpKXJldHVybiBpW3JdfXRocm93IGV9KX0oZnVuY3Rpb24oZSxuKXtlLkRFRk1FVEhPRCgiX2V2YWwiLG4pfSksZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlKXtyZXR1cm4gbih1bixlLHtvcGVyYXRvcjoiISIsZXhwcmVzc2lvbjplfSl9ZShLLGZ1bmN0aW9uKCl7cmV0dXJuIHQodGhpcyl9KSxlKFEsZnVuY3Rpb24oKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBuZWdhdGUgYSBzdGF0ZW1lbnQiKX0pLGUoRWUsZnVuY3Rpb24oKXtyZXR1cm4gdCh0aGlzKX0pLGUodW4sZnVuY3Rpb24oKXtyZXR1cm4iISI9PXRoaXMub3BlcmF0b3I/dGhpcy5leHByZXNzaW9uOnQodGhpcyl9KSxlKGVuLGZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuY2xvbmUoKTtyZXR1cm4gbi5jZHI9bi5jZHIubmVnYXRlKGUpLG59KSxlKGNuLGZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuY2xvbmUoKTtyZXR1cm4gbi5jb25zZXF1ZW50PW4uY29uc2VxdWVudC5uZWdhdGUoZSksbi5hbHRlcm5hdGl2ZT1uLmFsdGVybmF0aXZlLm5lZ2F0ZShlKSxGKHQodGhpcyksbil9KSxlKHNuLGZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuY2xvbmUoKSxyPXRoaXMub3BlcmF0b3I7aWYoZS5vcHRpb24oInVuc2FmZV9jb21wcyIpKXN3aXRjaChyKXtjYXNlIjw9IjpyZXR1cm4gbi5vcGVyYXRvcj0iPiIsbjtjYXNlIjwiOnJldHVybiBuLm9wZXJhdG9yPSI+PSIsbjtjYXNlIj49IjpyZXR1cm4gbi5vcGVyYXRvcj0iPCIsbjtjYXNlIj4iOnJldHVybiBuLm9wZXJhdG9yPSI8PSIsbn1zd2l0Y2gocil7Y2FzZSI9PSI6cmV0dXJuIG4ub3BlcmF0b3I9IiE9IixuO2Nhc2UiIT0iOnJldHVybiBuLm9wZXJhdG9yPSI9PSIsbjtjYXNlIj09PSI6cmV0dXJuIG4ub3BlcmF0b3I9IiE9PSIsbjtjYXNlIiE9PSI6cmV0dXJuIG4ub3BlcmF0b3I9Ij09PSIsbjtjYXNlIiYmIjpyZXR1cm4gbi5vcGVyYXRvcj0ifHwiLG4ubGVmdD1uLmxlZnQubmVnYXRlKGUpLG4ucmlnaHQ9bi5yaWdodC5uZWdhdGUoZSksRih0KHRoaXMpLG4pO2Nhc2UifHwiOnJldHVybiBuLm9wZXJhdG9yPSImJiIsbi5sZWZ0PW4ubGVmdC5uZWdhdGUoZSksbi5yaWdodD1uLnJpZ2h0Lm5lZ2F0ZShlKSxGKHQodGhpcyksbil9cmV0dXJuIHQodGhpcyl9KX0oZnVuY3Rpb24oZSxuKXtlLkRFRk1FVEhPRCgibmVnYXRlIixmdW5jdGlvbihlKXtyZXR1cm4gbi5jYWxsKHRoaXMsZSl9KX0pLGZ1bmN0aW9uKGUpe2UoSyxwKSxlKG9lLGwpLGUoUm4sbCksZShQbixsKSxlKEtlLGZ1bmN0aW9uKGUpe3ZhciBuPWUub3B0aW9uKCJwdXJlX2Z1bmNzIik7cmV0dXJuIW58fCgiZnVuY3Rpb24iPT10eXBlb2Ygbj9uKHRoaXMpOm4uaW5kZXhPZih0aGlzLmV4cHJlc3Npb24ucHJpbnRfdG9fc3RyaW5nKCkpPDApfSksZShyZSxmdW5jdGlvbihlKXtmb3IodmFyIG49dGhpcy5ib2R5Lmxlbmd0aDstLW4+PTA7KWlmKHRoaXMuYm9keVtuXS5oYXNfc2lkZV9lZmZlY3RzKGUpKXJldHVybiEwO3JldHVybiExfSksZSh0ZSxmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5ib2R5Lmhhc19zaWRlX2VmZmVjdHMoZSl9KSxlKEZlLHApLGUoRWUsbCksZShfbixsKSxlKGduLHApLGUoc24sZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubGVmdC5oYXNfc2lkZV9lZmZlY3RzKGUpfHx0aGlzLnJpZ2h0Lmhhc19zaWRlX2VmZmVjdHMoZSl9KSxlKGZuLHApLGUoY24sZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY29uZGl0aW9uLmhhc19zaWRlX2VmZmVjdHMoZSl8fHRoaXMuY29uc2VxdWVudC5oYXNfc2lkZV9lZmZlY3RzKGUpfHx0aGlzLmFsdGVybmF0aXZlLmhhc19zaWRlX2VmZmVjdHMoZSl9KSxlKG9uLGZ1bmN0aW9uKGUpe3JldHVybiBpKHRoaXMub3BlcmF0b3IsWyJkZWxldGUiLCIrKyIsIi0tIl0pfHx0aGlzLmV4cHJlc3Npb24uaGFzX3NpZGVfZWZmZWN0cyhlKX0pLGUoSG4sZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2xvYmFsKCkmJnRoaXMudW5kZWNsYXJlZCgpfSksZShwbixmdW5jdGlvbihlKXtmb3IodmFyIG49dGhpcy5wcm9wZXJ0aWVzLmxlbmd0aDstLW4+PTA7KWlmKHRoaXMucHJvcGVydGllc1tuXS5oYXNfc2lkZV9lZmZlY3RzKGUpKXJldHVybiEwO3JldHVybiExfSksZShkbixmdW5jdGlvbihlKXtyZXR1cm4hISh0aGlzLmtleSBpbnN0YW5jZW9mIGhuJiZ0aGlzLmtleS5oYXNfc2lkZV9lZmZlY3RzKGUpKXx8dGhpcy52YWx1ZS5oYXNfc2lkZV9lZmZlY3RzKGUpfSksZShsbixmdW5jdGlvbihlKXtmb3IodmFyIG49dGhpcy5lbGVtZW50cy5sZW5ndGg7LS1uPj0wOylpZih0aGlzLmVsZW1lbnRzW25dLmhhc19zaWRlX2VmZmVjdHMoZSkpcmV0dXJuITA7cmV0dXJuITF9KSxlKHRuLGZ1bmN0aW9uKGUpe3JldHVybiFlLm9wdGlvbigicHVyZV9nZXR0ZXJzIil8fHRoaXMuZXhwcmVzc2lvbi5oYXNfc2lkZV9lZmZlY3RzKGUpfSksZShybixmdW5jdGlvbihlKXtyZXR1cm4hZS5vcHRpb24oInB1cmVfZ2V0dGVycyIpfHwodGhpcy5leHByZXNzaW9uLmhhc19zaWRlX2VmZmVjdHMoZSl8fHRoaXMucHJvcGVydHkuaGFzX3NpZGVfZWZmZWN0cyhlKSl9KSxlKG5uLGZ1bmN0aW9uKGUpe3JldHVybiFlLm9wdGlvbigicHVyZV9nZXR0ZXJzIil9KSxlKGVuLGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmNhci5oYXNfc2lkZV9lZmZlY3RzKGUpfHx0aGlzLmNkci5oYXNfc2lkZV9lZmZlY3RzKGUpfSl9KGZ1bmN0aW9uKGUsbil7ZS5ERUZNRVRIT0QoImhhc19zaWRlX2VmZmVjdHMiLG4pfSksZnVuY3Rpb24oZSl7ZnVuY3Rpb24gbigpe3ZhciBlPXRoaXMuYm9keS5sZW5ndGg7cmV0dXJuIGU+MCYmdyh0aGlzLmJvZHlbZS0xXSl9ZShRLGZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9KSxlKEJlLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSxlKEdlLGZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9KSxlKGllLG4pLGUoamUsbiksZSh6ZSxmdW5jdGlvbigpe3JldHVybiB0aGlzLmFsdGVybmF0aXZlJiZ3KHRoaXMuYm9keSkmJncodGhpcy5hbHRlcm5hdGl2ZSkmJnRoaXN9KX0oZnVuY3Rpb24oZSxuKXtlLkRFRk1FVEhPRCgiYWJvcnRzIixuKX0pLGUobmUsZnVuY3Rpb24oZSx0KXtyZXR1cm4idXAiPT09dC5oYXNfZGlyZWN0aXZlKGUudmFsdWUpP24ob2UsZSk6ZX0pLGUoZWUsZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC5vcHRpb24oImRyb3BfZGVidWdnZXIiKT9uKG9lLGUpOmV9KSxlKGFlLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuYm9keSBpbnN0YW5jZW9mIHFlJiZ0Lmxvb3Bjb250cm9sX3RhcmdldChlLmJvZHkubGFiZWwpPT09ZS5ib2R5P24ob2UsZSk6MD09ZS5sYWJlbC5yZWZlcmVuY2VzLmxlbmd0aD9lLmJvZHk6ZX0pLGUocmUsZnVuY3Rpb24oZSxuKXtyZXR1cm4gZS5ib2R5IGluc3RhbmNlb2YgSz9lOihlLmJvZHk9ZihlLmJvZHksbiksZSl9KSxlKGllLGZ1bmN0aW9uKGUsdCl7c3dpdGNoKGUuYm9keT1mKGUuYm9keSx0KSxlLmJvZHkubGVuZ3RoKXtjYXNlIDE6aWYocyhlLmJvZHlbMF0pKXJldHVybiBlLmJvZHlbMF07YnJlYWs7Y2FzZSAwOnJldHVybiBuKG9lLGUpfXJldHVybiBlfSksbWUuREVGTUVUSE9EKCJkcm9wX3VudXNlZCIsZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztpZihlLmhhc19kaXJlY3RpdmUoInVzZSBhc20iKSlyZXR1cm4gdDtpZihlLm9wdGlvbigidW51c2VkIikmJiF0LnVzZXNfZXZhbCYmIXQudXNlc193aXRoKXt2YXIgcj1bXSxpPXt9LG89bmV3IGcsdT1udWxsLGE9ITEsYz10aGlzLGY9bmV3IEEoZnVuY3Rpb24obixzKXtpZihuIT09dCl7aWYobiBpbnN0YW5jZW9mIEZlfHxuIGluc3RhbmNlb2YgZ24pcmV0dXJuIG8uYWRkKG4ubmFtZS5uYW1lLG4pLCEwO2lmKG4gaW5zdGFuY2VvZiBMZSYmYz09PXQpcmV0dXJuIG4uZGVmaW5pdGlvbnMuZm9yRWFjaChmdW5jdGlvbihuKXtpZihuLnZhbHVlKXtpZihuLmlzX2Rlc3RydWN0dXJpbmcoKSl7dmFyIHQ9dTt1PW4udmFsdWUsYT0hMCxuLndhbGsoZiksYT0hMSx1PXR9ZWxzZSBvLmFkZChuLm5hbWUubmFtZSxuLnZhbHVlKTtuLnZhbHVlLmhhc19zaWRlX2VmZmVjdHMoZSkmJm4udmFsdWUud2FsayhmKX19KSwhMDtpZihuIGluc3RhbmNlb2YgSG4pe3ZhciBsPW4uZGVmaW5pdGlvbigpO3JldHVybiBsLmlkIGluIGl8fChpW2wuaWRdPSEwLHIucHVzaChsKSksITB9aWYobiBpbnN0YW5jZW9mIG1lKXt2YXIgcD1jO3JldHVybiBjPW4scygpLGM9cCwhMH1pZihuIGluc3RhbmNlb2Ygd2Upe2lmKCFhKXJldHVybiEwO2Zvcih2YXIgZD0wO2Q8bi5uYW1lcy5sZW5ndGg7ZCsrKWlmKG4ubmFtZXNbZF1pbnN0YW5jZW9mIHdlKW4ubmFtZXNbZF0ud2FsayhmKTtlbHNlIGlmKG4ubmFtZXNbZF1pbnN0YW5jZW9mIF9lKXtpZighKG4ubmFtZXNbZF0uZXhwcmVzc2lvbiBpbnN0YW5jZW9mIGJuKSl0aHJvdyBuZXcgRXJyb3IoaCgiQ2FuJ3QgaGFuZGxlIGV4cGFuc2lvbiBvZiB0eXBlOiB7dHlwZX0iLHt0eXBlOk9iamVjdC5nZXRQcm90b3R5cGVPZihuLm5hbWVzW2RdLmV4cHJlc3Npb24pLlRZUEV9KSk7by5hZGQobi5uYW1lc1tkXS5leHByZXNzaW9uLm5hbWUsdSl9ZWxzZXtpZihuLm5hbWVzW2RdaW5zdGFuY2VvZiBabiljb250aW51ZTtpZihuLm5hbWVzW2RdaW5zdGFuY2VvZiBobiYmInN0cmluZyI9PXR5cGVvZiBuLm5hbWVzW2RdLmtleSlvLmFkZChuLm5hbWVzW2RdLmtleSx1KTtlbHNle2lmKCEobi5uYW1lc1tkXWluc3RhbmNlb2YgYm4pKXRocm93IG5ldyBFcnJvcihoKCJVbmtub3duIGRlc3RydWN0dXJpbmcgZWxlbWVudCBvZiB0eXBlOiB7dHlwZX0iLHt0eXBlOk9iamVjdC5nZXRQcm90b3R5cGVPZihuLm5hbWVzW2RdKS5UWVBFfSkpO28uYWRkKG4ubmFtZXNbZF0ubmFtZSx1KX19cmV0dXJuITB9fX0pO3Qud2FsayhmKTtmb3IodmFyIGw9MDtsPHIubGVuZ3RoOysrbClyW2xdLm9yaWcuZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgbj1vLmdldChlLm5hbWUpO24mJm4uZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgbj1uZXcgQShmdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgSG4pe3ZhciBuPWUuZGVmaW5pdGlvbigpO24uaWQgaW4gaXx8KGlbbi5pZF09ITAsci5wdXNoKG4pKX19KTtlLndhbGsobil9KX0pO3ZhciBwPW5ldyBQKGZ1bmN0aW9uKHIsbyx1KXtpZihyIGluc3RhbmNlb2YgeWUmJiEociBpbnN0YW5jZW9mIGJlKSYmIWUub3B0aW9uKCJrZWVwX2ZhcmdzIikpZm9yKHZhciBhPXIuYXJnbmFtZXMsYz1hLmxlbmd0aDstLWM+PTAmJiEoYVtjXWluc3RhbmNlb2Ygd2UpOyl7dmFyIGY9YVtjXTtpZihmIGluc3RhbmNlb2YgX2UmJihmPWYuc3ltYm9sKSwhZi51bnJlZmVyZW5jZWQoKSlicmVhazthLnBvcCgpLGUud2FybigiRHJvcHBpbmcgdW51c2VkIGZ1bmN0aW9uIGFyZ3VtZW50IHtuYW1lfSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHtuYW1lOmYubmFtZSxmaWxlOmYuc3RhcnQuZmlsZSxsaW5lOmYuc3RhcnQubGluZSxjb2w6Zi5zdGFydC5jb2x9KX1pZigociBpbnN0YW5jZW9mIEZlfHxyIGluc3RhbmNlb2YgZ24pJiZyIT09dCl7dmFyIGw9ci5uYW1lLmRlZmluaXRpb24oKS5pZCBpbiBpfHxyLm5hbWUuZGVmaW5pdGlvbigpLmdsb2JhbDtyZXR1cm4gbD9yOihlLndhcm4oIkRyb3BwaW5nIHVudXNlZCBmdW5jdGlvbiB7bmFtZX0gW3tmaWxlfTp7bGluZX0se2NvbH1dIix7bmFtZTpyLm5hbWUubmFtZSxmaWxlOnIubmFtZS5zdGFydC5maWxlLGxpbmU6ci5uYW1lLnN0YXJ0LmxpbmUsY29sOnIubmFtZS5zdGFydC5jb2x9KSxuKG9lLHIpKX1pZihyIGluc3RhbmNlb2YgTGUmJiEocC5wYXJlbnQoKWluc3RhbmNlb2YgZGUpKXt2YXIgZD1yLmRlZmluaXRpb25zLmZpbHRlcihmdW5jdGlvbihuKXtpZihuLmlzX2Rlc3RydWN0dXJpbmcoKSlyZXR1cm4hMDtpZihuLm5hbWUuZGVmaW5pdGlvbigpLmlkIGluIGkpcmV0dXJuITA7aWYobi5uYW1lLmRlZmluaXRpb24oKS5nbG9iYWwpcmV0dXJuITA7dmFyIHQ9e25hbWU6bi5uYW1lLm5hbWUsZmlsZTpuLm5hbWUuc3RhcnQuZmlsZSxsaW5lOm4ubmFtZS5zdGFydC5saW5lLGNvbDpuLm5hbWUuc3RhcnQuY29sfTtyZXR1cm4gbi52YWx1ZSYmbi52YWx1ZS5oYXNfc2lkZV9lZmZlY3RzKGUpPyhuLl91bnVzZWRfc2lkZV9lZmZlY3RzPSEwLGUud2FybigiU2lkZSBlZmZlY3RzIGluIGluaXRpYWxpemF0aW9uIG9mIHVudXNlZCB2YXJpYWJsZSB7bmFtZX0gW3tmaWxlfTp7bGluZX0se2NvbH1dIix0KSwhMCk6KGUud2FybigiRHJvcHBpbmcgdW51c2VkIHZhcmlhYmxlIHtuYW1lfSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHQpLCExKX0pO2Q9bShkLGZ1bmN0aW9uKGUsbil7cmV0dXJuIWUudmFsdWUmJm4udmFsdWU/LTE6IW4udmFsdWUmJmUudmFsdWU/MTowfSk7Zm9yKHZhciBoPVtdLGM9MDtjPGQubGVuZ3RoOyl7dmFyIEQ9ZFtjXTtELl91bnVzZWRfc2lkZV9lZmZlY3RzPyhoLnB1c2goRC52YWx1ZSksZC5zcGxpY2UoYywxKSk6KGgubGVuZ3RoPjAmJihoLnB1c2goRC52YWx1ZSksRC52YWx1ZT1lbi5mcm9tX2FycmF5KGgpLGg9W10pLCsrYyl9cmV0dXJuIGg9aC5sZW5ndGg+MD9uKGllLHIse2JvZHk6W24odGUscix7Ym9keTplbi5mcm9tX2FycmF5KGgpfSldfSk6bnVsbCwwIT1kLmxlbmd0aHx8aD8wPT1kLmxlbmd0aD91P0ouc3BsaWNlKGguYm9keSk6aDooci5kZWZpbml0aW9ucz1kLGg/KGguYm9keS51bnNoaWZ0KHIpLHU/Si5zcGxpY2UoaC5ib2R5KTpoKTpyKTpuKG9lLHIpfWlmKHIgaW5zdGFuY2VvZiBwZSYmKG8ocix0aGlzKSxyLmluaXQgaW5zdGFuY2VvZiBpZSkpe3ZhciB2PXIuaW5pdC5ib2R5LnNsaWNlKDAsLTEpO3JldHVybiByLmluaXQ9ci5pbml0LmJvZHkuc2xpY2UoLTEpWzBdLmJvZHksdi5wdXNoKHIpLHU/Si5zcGxpY2Uodik6bihpZSxyLHtib2R5OnZ9KX1yZXR1cm4gciBpbnN0YW5jZW9mIGllJiYobyhyLHRoaXMpLHUmJl8oci5ib2R5LHMpKT9KLnNwbGljZShyLmJvZHkpOnIgaW5zdGFuY2VvZiBtZSYmciE9PXQ/cjp2b2lkIDB9KTt0LnRyYW5zZm9ybShwKX19KSxtZS5ERUZNRVRIT0QoImhvaXN0X2RlY2xhcmF0aW9ucyIsZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztpZihlLmhhc19kaXJlY3RpdmUoInVzZSBhc20iKSlyZXR1cm4gdDtpZighQXJyYXkuaXNBcnJheSh0LmJvZHkpKXJldHVybiB0O3ZhciByPWUub3B0aW9uKCJob2lzdF9mdW5zIiksaT1lLm9wdGlvbigiaG9pc3RfdmFycyIpO2lmKHJ8fGkpe3ZhciB1PVtdLGE9W10scz1uZXcgZyxjPTAsZj0wO3Qud2FsayhuZXcgQShmdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIG1lJiZlIT09dHx8KGUgaW5zdGFuY2VvZiBWZT8oKytmLCEwKTp2b2lkIDApfSkpLGk9aSYmZj4xO3ZhciBsPW5ldyBQKGZ1bmN0aW9uKGUpe2lmKGUhPT10KXtpZihlIGluc3RhbmNlb2YgbmUpcmV0dXJuIHUucHVzaChlKSxuKG9lLGUpO2lmKGUgaW5zdGFuY2VvZiBGZSYmcilyZXR1cm4gYS5wdXNoKGUpLG4ob2UsZSk7aWYoZSBpbnN0YW5jZW9mIFZlJiZpKXtlLmRlZmluaXRpb25zLmZvckVhY2goZnVuY3Rpb24oZSl7ZS5pc19kZXN0cnVjdHVyaW5nKCl8fChzLnNldChlLm5hbWUubmFtZSxlKSwrK2MpfSk7dmFyIG89ZS50b19hc3NpZ25tZW50cygpLGY9bC5wYXJlbnQoKTtpZihmIGluc3RhbmNlb2YgZGUmJmYuaW5pdD09PWUpe2lmKG51bGw9PW8pe3ZhciBwPWUuZGVmaW5pdGlvbnNbMF0ubmFtZTtyZXR1cm4gbihIbixwLHApfXJldHVybiBvfXJldHVybiBmIGluc3RhbmNlb2YgcGUmJmYuaW5pdD09PWU/bzpvP24odGUsZSx7Ym9keTpvfSk6bihvZSxlKX1pZihlIGluc3RhbmNlb2YgbWUpcmV0dXJuIGV9fSk7aWYodD10LnRyYW5zZm9ybShsKSxjPjApe3ZhciBwPVtdO2lmKHMuZWFjaChmdW5jdGlvbihlLG4pe3QgaW5zdGFuY2VvZiB5ZSYmbyhmdW5jdGlvbihuKXtyZXR1cm4gbi5uYW1lPT1lLm5hbWUubmFtZX0sdC5hcmdzX2FzX25hbWVzKCkpP3MuZGVsKG4pOihlPWUuY2xvbmUoKSxlLnZhbHVlPW51bGwscC5wdXNoKGUpLHMuc2V0KG4sZSkpfSkscC5sZW5ndGg+MCl7Zm9yKHZhciBkPTA7ZDx0LmJvZHkubGVuZ3RoOyl7aWYodC5ib2R5W2RdaW5zdGFuY2VvZiB0ZSl7dmFyIGgsbSx2PXQuYm9keVtkXS5ib2R5O2lmKHYgaW5zdGFuY2VvZiBmbiYmIj0iPT12Lm9wZXJhdG9yJiYoaD12LmxlZnQpaW5zdGFuY2VvZiBibiYmcy5oYXMoaC5uYW1lKSl7dmFyIF89cy5nZXQoaC5uYW1lKTtpZihfLnZhbHVlKWJyZWFrO18udmFsdWU9di5yaWdodCxEKHAsXykscC5wdXNoKF8pLHQuYm9keS5zcGxpY2UoZCwxKTtjb250aW51ZX1pZih2IGluc3RhbmNlb2YgZW4mJihtPXYuY2FyKWluc3RhbmNlb2YgZm4mJiI9Ij09bS5vcGVyYXRvciYmKGg9bS5sZWZ0KWluc3RhbmNlb2YgYm4mJnMuaGFzKGgubmFtZSkpe3ZhciBfPXMuZ2V0KGgubmFtZSk7aWYoXy52YWx1ZSlicmVhaztfLnZhbHVlPW0ucmlnaHQsRChwLF8pLHAucHVzaChfKSx0LmJvZHlbZF0uYm9keT12LmNkcjtjb250aW51ZX19aWYodC5ib2R5W2RdaW5zdGFuY2VvZiBvZSl0LmJvZHkuc3BsaWNlKGQsMSk7ZWxzZXtpZighKHQuYm9keVtkXWluc3RhbmNlb2YgaWUpKWJyZWFrO3ZhciB5PVtkLDFdLmNvbmNhdCh0LmJvZHlbZF0uYm9keSk7dC5ib2R5LnNwbGljZS5hcHBseSh0LmJvZHkseSl9fXA9bihWZSx0LHtkZWZpbml0aW9uczpwfSksYS5wdXNoKHApfX10LmJvZHk9dS5jb25jYXQoYSx0LmJvZHkpfXJldHVybiB0fSksZSh0ZSxmdW5jdGlvbihlLHQpe3JldHVybiB0Lm9wdGlvbigic2lkZV9lZmZlY3RzIikmJiFlLmJvZHkuaGFzX3NpZGVfZWZmZWN0cyh0KT8odC53YXJuKCJEcm9wcGluZyBzaWRlLWVmZmVjdC1mcmVlIHN0YXRlbWVudCBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLGUuc3RhcnQpLG4ob2UsZSkpOmV9KSxlKGNlLGZ1bmN0aW9uKGUsdCl7dmFyIHI9ZS5jb25kaXRpb24uZXZhbHVhdGUodCk7aWYoZS5jb25kaXRpb249clswXSwhdC5vcHRpb24oImxvb3BzIikpcmV0dXJuIGU7aWYoci5sZW5ndGg+MSl7aWYoclsxXSlyZXR1cm4gbihwZSxlLHtib2R5OmUuYm9keX0pO2lmKGUgaW5zdGFuY2VvZiBsZSYmdC5vcHRpb24oImRlYWRfY29kZSIpKXt2YXIgaT1bXTtyZXR1cm4gYih0LGUuYm9keSxpKSxuKGllLGUse2JvZHk6aX0pfX1yZXR1cm4gZX0pLGUobGUsZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC5vcHRpb24oImxvb3BzIik/KGU9Y2UucHJvdG90eXBlLm9wdGltaXplLmNhbGwoZSx0KSxlIGluc3RhbmNlb2YgbGUmJihDKGUsdCksZT1uKHBlLGUsZSkudHJhbnNmb3JtKHQpKSxlKTplfSksZShwZSxmdW5jdGlvbihlLHQpe3ZhciByPWUuY29uZGl0aW9uO2lmKHImJihyPXIuZXZhbHVhdGUodCksZS5jb25kaXRpb249clswXSksIXQub3B0aW9uKCJsb29wcyIpKXJldHVybiBlO2lmKHImJnIubGVuZ3RoPjEmJiFyWzFdJiZ0Lm9wdGlvbigiZGVhZF9jb2RlIikpe3ZhciBpPVtdO3JldHVybiBlLmluaXQgaW5zdGFuY2VvZiBRP2kucHVzaChlLmluaXQpOmUuaW5pdCYmaS5wdXNoKG4odGUsZS5pbml0LHtib2R5OmUuaW5pdH0pKSxiKHQsZS5ib2R5LGkpLG4oaWUsZSx7Ym9keTppfSl9cmV0dXJuIEMoZSx0KSxlfSksZSh6ZSxmdW5jdGlvbihlLHQpe2lmKCF0Lm9wdGlvbigiY29uZGl0aW9uYWxzIikpcmV0dXJuIGU7dmFyIHI9ZS5jb25kaXRpb24uZXZhbHVhdGUodCk7aWYoZS5jb25kaXRpb249clswXSxyLmxlbmd0aD4xKWlmKHJbMV0pe2lmKHQud2FybigiQ29uZGl0aW9uIGFsd2F5cyB0cnVlIFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsZS5jb25kaXRpb24uc3RhcnQpLHQub3B0aW9uKCJkZWFkX2NvZGUiKSl7dmFyIGk9W107cmV0dXJuIGUuYWx0ZXJuYXRpdmUmJmIodCxlLmFsdGVybmF0aXZlLGkpLGkucHVzaChlLmJvZHkpLG4oaWUsZSx7Ym9keTppfSkudHJhbnNmb3JtKHQpfX1lbHNlIGlmKHQud2FybigiQ29uZGl0aW9uIGFsd2F5cyBmYWxzZSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLGUuY29uZGl0aW9uLnN0YXJ0KSx0Lm9wdGlvbigiZGVhZF9jb2RlIikpe3ZhciBpPVtdO3JldHVybiBiKHQsZS5ib2R5LGkpLGUuYWx0ZXJuYXRpdmUmJmkucHVzaChlLmFsdGVybmF0aXZlKSxuKGllLGUse2JvZHk6aX0pLnRyYW5zZm9ybSh0KX1hKGUuYWx0ZXJuYXRpdmUpJiYoZS5hbHRlcm5hdGl2ZT1udWxsKTt2YXIgbz1lLmNvbmRpdGlvbi5uZWdhdGUodCksdT1lLmNvbmRpdGlvbi5wcmludF90b19zdHJpbmcoKS5sZW5ndGgscz1vLnByaW50X3RvX3N0cmluZygpLmxlbmd0aCxjPXM8dTtpZihlLmFsdGVybmF0aXZlJiZjKXtjPSExLGUuY29uZGl0aW9uPW87dmFyIGY9ZS5ib2R5O2UuYm9keT1lLmFsdGVybmF0aXZlfHxuKG9lKSxlLmFsdGVybmF0aXZlPWZ9aWYoYShlLmJvZHkpJiZhKGUuYWx0ZXJuYXRpdmUpKXJldHVybiBuKHRlLGUuY29uZGl0aW9uLHtib2R5OmUuY29uZGl0aW9ufSkudHJhbnNmb3JtKHQpO2lmKGUuYm9keSBpbnN0YW5jZW9mIHRlJiZlLmFsdGVybmF0aXZlIGluc3RhbmNlb2YgdGUpcmV0dXJuIG4odGUsZSx7Ym9keTpuKGNuLGUse2NvbmRpdGlvbjplLmNvbmRpdGlvbixjb25zZXF1ZW50OmUuYm9keS5ib2R5LGFsdGVybmF0aXZlOmUuYWx0ZXJuYXRpdmUuYm9keX0pfSkudHJhbnNmb3JtKHQpO2lmKGEoZS5hbHRlcm5hdGl2ZSkmJmUuYm9keSBpbnN0YW5jZW9mIHRlKXJldHVybiB1PT09cyYmIWMmJmUuY29uZGl0aW9uIGluc3RhbmNlb2Ygc24mJiJ8fCI9PWUuY29uZGl0aW9uLm9wZXJhdG9yJiYoYz0hMCksYz9uKHRlLGUse2JvZHk6bihzbixlLHtvcGVyYXRvcjoifHwiLGxlZnQ6byxyaWdodDplLmJvZHkuYm9keX0pfSkudHJhbnNmb3JtKHQpOm4odGUsZSx7Ym9keTpuKHNuLGUse29wZXJhdG9yOiImJiIsbGVmdDplLmNvbmRpdGlvbixyaWdodDplLmJvZHkuYm9keX0pfSkudHJhbnNmb3JtKHQpO2lmKGUuYm9keSBpbnN0YW5jZW9mIG9lJiZlLmFsdGVybmF0aXZlJiZlLmFsdGVybmF0aXZlIGluc3RhbmNlb2YgdGUpcmV0dXJuIG4odGUsZSx7Ym9keTpuKHNuLGUse29wZXJhdG9yOiJ8fCIsbGVmdDplLmNvbmRpdGlvbixyaWdodDplLmFsdGVybmF0aXZlLmJvZHl9KX0pLnRyYW5zZm9ybSh0KTtpZihlLmJvZHkgaW5zdGFuY2VvZiBTZSYmZS5hbHRlcm5hdGl2ZSBpbnN0YW5jZW9mIFNlJiZlLmJvZHkuVFlQRT09ZS5hbHRlcm5hdGl2ZS5UWVBFKXJldHVybiBuKGUuYm9keS5DVE9SLGUse3ZhbHVlOm4oY24sZSx7Y29uZGl0aW9uOmUuY29uZGl0aW9uLGNvbnNlcXVlbnQ6ZS5ib2R5LnZhbHVlfHxuKEpuLGUuYm9keSkub3B0aW1pemUodCksYWx0ZXJuYXRpdmU6ZS5hbHRlcm5hdGl2ZS52YWx1ZXx8bihKbixlLmFsdGVybmF0aXZlKS5vcHRpbWl6ZSh0KX0pfSkudHJhbnNmb3JtKHQpO2lmKGUuYm9keSBpbnN0YW5jZW9mIHplJiYhZS5ib2R5LmFsdGVybmF0aXZlJiYhZS5hbHRlcm5hdGl2ZSYmKGUuY29uZGl0aW9uPW4oc24sZS5jb25kaXRpb24se29wZXJhdG9yOiImJiIsbGVmdDplLmNvbmRpdGlvbixyaWdodDplLmJvZHkuY29uZGl0aW9ufSkudHJhbnNmb3JtKHQpLGUuYm9keT1lLmJvZHkuYm9keSksdyhlLmJvZHkpJiZlLmFsdGVybmF0aXZlKXt2YXIgbD1lLmFsdGVybmF0aXZlO3JldHVybiBlLmFsdGVybmF0aXZlPW51bGwsbihpZSxlLHtib2R5OltlLGxdfSkudHJhbnNmb3JtKHQpfWlmKHcoZS5hbHRlcm5hdGl2ZSkpe3ZhciBwPWUuYm9keTtyZXR1cm4gZS5ib2R5PWUuYWx0ZXJuYXRpdmUsZS5jb25kaXRpb249Yz9vOmUuY29uZGl0aW9uLm5lZ2F0ZSh0KSxlLmFsdGVybmF0aXZlPW51bGwsbihpZSxlLHtib2R5OltlLHBdfSkudHJhbnNmb3JtKHQpfXJldHVybiBlfSksZShOZSxmdW5jdGlvbihlLHQpe2lmKDA9PWUuYm9keS5sZW5ndGgmJnQub3B0aW9uKCJjb25kaXRpb25hbHMiKSlyZXR1cm4gbih0ZSxlLHtib2R5OmUuZXhwcmVzc2lvbn0pLnRyYW5zZm9ybSh0KTtmb3IoOzspe3ZhciByPWUuYm9keVtlLmJvZHkubGVuZ3RoLTFdO2lmKHIpe3ZhciBpPXIuYm9keVtyLmJvZHkubGVuZ3RoLTFdO2lmKGkgaW5zdGFuY2VvZiBxZSYmYyh0Lmxvb3Bjb250cm9sX3RhcmdldChpLmxhYmVsKSk9PT1lJiZyLmJvZHkucG9wKCksciBpbnN0YW5jZW9mIEhlJiYwPT1yLmJvZHkubGVuZ3RoKXtlLmJvZHkucG9wKCk7Y29udGludWV9fWJyZWFrfXZhciBvPWUuZXhwcmVzc2lvbi5ldmFsdWF0ZSh0KTtlOmlmKDI9PW8ubGVuZ3RoKXRyeXtpZihlLmV4cHJlc3Npb249b1swXSwhdC5vcHRpb24oImRlYWRfY29kZSIpKWJyZWFrIGU7dmFyIHU9b1sxXSxhPSExLHM9ITEsZj0hMSxsPSExLHA9ITEsZD1uZXcgUChmdW5jdGlvbihyLGksbyl7aWYociBpbnN0YW5jZW9mIHllfHxyIGluc3RhbmNlb2YgdGUpcmV0dXJuIHI7aWYociBpbnN0YW5jZW9mIE5lJiZyPT09ZSlyZXR1cm4gcj1yLmNsb25lKCksaShyLHRoaXMpLHA/cjpuKGllLHIse2JvZHk6ci5ib2R5LnJlZHVjZShmdW5jdGlvbihlLG4pe3JldHVybiBlLmNvbmNhdChuLmJvZHkpfSxbXSl9KS50cmFuc2Zvcm0odCk7aWYociBpbnN0YW5jZW9mIHplfHxyIGluc3RhbmNlb2YgUGUpe3ZhciBjPWE7cmV0dXJuIGE9IXMsaShyLHRoaXMpLGE9YyxyfWlmKHIgaW5zdGFuY2VvZiB1ZXx8ciBpbnN0YW5jZW9mIE5lKXt2YXIgYz1zO3JldHVybiBzPSEwLGkocix0aGlzKSxzPWMscn1pZihyIGluc3RhbmNlb2YgcWUmJnRoaXMubG9vcGNvbnRyb2xfdGFyZ2V0KHIubGFiZWwpPT09ZSlyZXR1cm4gYT8ocD0hMCxyKTpzP3I6KGw9ITAsbz9KLnNraXA6bihvZSxyKSk7aWYociBpbnN0YW5jZW9mIGplJiZ0aGlzLnBhcmVudCgpPT09ZSl7aWYobClyZXR1cm4gSi5za2lwO2lmKHIgaW5zdGFuY2VvZiBJZSl7dmFyIGQ9ci5leHByZXNzaW9uLmV2YWx1YXRlKHQpO2lmKGQubGVuZ3RoPDIpdGhyb3cgZTtyZXR1cm4gZFsxXT09PXV8fGY/KGY9ITAsdyhyKSYmKGw9ITApLGkocix0aGlzKSxyKTpKLnNraXB9cmV0dXJuIGkocix0aGlzKSxyfX0pO2Quc3RhY2s9dC5zdGFjay5zbGljZSgpLGU9ZS50cmFuc2Zvcm0oZCl9Y2F0Y2gobil7aWYobiE9PWUpdGhyb3cgbn1yZXR1cm4gZX0pLGUoSWUsZnVuY3Rpb24oZSxuKXtyZXR1cm4gZS5ib2R5PWYoZS5ib2R5LG4pLGV9KSxlKFBlLGZ1bmN0aW9uKGUsbil7cmV0dXJuIGUuYm9keT1mKGUuYm9keSxuKSxlfSksTGUuREVGTUVUSE9EKCJyZW1vdmVfaW5pdGlhbGl6ZXJzIixmdW5jdGlvbigpe3RoaXMuZGVmaW5pdGlvbnMuZm9yRWFjaChmdW5jdGlvbihlKXtlLnZhbHVlPW51bGx9KX0pLExlLkRFRk1FVEhPRCgidG9fYXNzaWdubWVudHMiLGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5kZWZpbml0aW9ucy5yZWR1Y2UoZnVuY3Rpb24oZSx0KXtpZih0LnZhbHVlJiYhdC5pc19kZXN0cnVjdHVyaW5nKCkpe3ZhciByPW4oSG4sdC5uYW1lLHQubmFtZSk7ZS5wdXNoKG4oZm4sdCx7b3BlcmF0b3I6Ij0iLGxlZnQ6cixyaWdodDp0LnZhbHVlfSkpfWVsc2UgaWYodC52YWx1ZSl7dmFyIGk9bihaZSx0LHtuYW1lOnQubmFtZSx2YWx1ZTp0LnZhbHVlfSksbz1uKFZlLHQse2RlZmluaXRpb25zOltpXX0pO2UucHVzaChvKX1yZXR1cm4gZX0sW10pO3JldHVybiAwPT1lLmxlbmd0aD9udWxsOmVuLmZyb21fYXJyYXkoZSl9KSxlKExlLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIDA9PWUuZGVmaW5pdGlvbnMubGVuZ3RoP24ob2UsZSk6ZX0pLGUoR2UsZnVuY3Rpb24oZSxuKXtyZXR1cm4gZX0pLGUoRWUsZnVuY3Rpb24oZSxuKXtyZXR1cm4gZT15ZS5wcm90b3R5cGUub3B0aW1pemUuY2FsbChlLG4pLG4ub3B0aW9uKCJ1bnVzZWQiKSYmIW4ub3B0aW9uKCJrZWVwX2ZuYW1lcyIpJiZlLm5hbWUmJmUubmFtZS51bnJlZmVyZW5jZWQoKSYmKGUubmFtZT1udWxsKSxlfSksZShLZSxmdW5jdGlvbihlLHIpe2lmKHIub3B0aW9uKCJ1bnNhZmUiKSl7dmFyIGk9ZS5leHByZXNzaW9uO2lmKGkgaW5zdGFuY2VvZiBIbiYmaS51bmRlY2xhcmVkKCkpc3dpdGNoKGkubmFtZSl7Y2FzZSJBcnJheSI6aWYoMSE9ZS5hcmdzLmxlbmd0aClyZXR1cm4gbihsbixlLHtlbGVtZW50czplLmFyZ3N9KS50cmFuc2Zvcm0ocik7YnJlYWs7Y2FzZSJPYmplY3QiOmlmKDA9PWUuYXJncy5sZW5ndGgpcmV0dXJuIG4ocG4sZSx7cHJvcGVydGllczpbXX0pO2JyZWFrO2Nhc2UiU3RyaW5nIjppZigwPT1lLmFyZ3MubGVuZ3RoKXJldHVybiBuKExuLGUse3ZhbHVlOiIifSk7aWYoZS5hcmdzLmxlbmd0aDw9MSlyZXR1cm4gbihzbixlLHtsZWZ0OmUuYXJnc1swXSxvcGVyYXRvcjoiKyIscmlnaHQ6bihMbixlLHt2YWx1ZToiIn0pfSkudHJhbnNmb3JtKHIpO2JyZWFrO2Nhc2UiTnVtYmVyIjppZigwPT1lLmFyZ3MubGVuZ3RoKXJldHVybiBuKFZuLGUse3ZhbHVlOjB9KTtpZigxPT1lLmFyZ3MubGVuZ3RoKXJldHVybiBuKHVuLGUse2V4cHJlc3Npb246ZS5hcmdzWzBdLG9wZXJhdG9yOiIrIn0pLnRyYW5zZm9ybShyKTtjYXNlIkJvb2xlYW4iOmlmKDA9PWUuYXJncy5sZW5ndGgpcmV0dXJuIG4oZXQsZSk7aWYoMT09ZS5hcmdzLmxlbmd0aClyZXR1cm4gbih1bixlLHtleHByZXNzaW9uOm4odW4sbnVsbCx7ZXhwcmVzc2lvbjplLmFyZ3NbMF0sb3BlcmF0b3I6IiEifSksb3BlcmF0b3I6IiEifSkudHJhbnNmb3JtKHIpO2JyZWFrO2Nhc2UiRnVuY3Rpb24iOmlmKDA9PWUuYXJncy5sZW5ndGgpcmV0dXJuIG4oRWUsZSx7YXJnbmFtZXM6W10sYm9keTpbXX0pO2lmKF8oZS5hcmdzLGZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgTG59KSl0cnl7dmFyIG89IihmdW5jdGlvbigiK2UuYXJncy5zbGljZSgwLC0xKS5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUudmFsdWV9KS5qb2luKCIsIikrIil7IitlLmFyZ3NbZS5hcmdzLmxlbmd0aC0xXS52YWx1ZSsifSkoKSIsdT1JKG8pO3UuZmlndXJlX291dF9zY29wZSh7c2NyZXdfaWU4OnIub3B0aW9uKCJzY3Jld19pZTgiKX0pO3ZhciBhPW5ldyBXKHIub3B0aW9ucyk7dT11LnRyYW5zZm9ybShhKSx1LmZpZ3VyZV9vdXRfc2NvcGUoe3NjcmV3X2llODpyLm9wdGlvbigic2NyZXdfaWU4Iil9KSx1Lm1hbmdsZV9uYW1lcygpO3ZhciBzO3RyeXt1LndhbGsobmV3IEEoZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mIHllKXRocm93IHM9ZSx1fSkpfWNhdGNoKGUpe2lmKGUhPT11KXRocm93IGV9aWYoIXMpcmV0dXJuIGU7dmFyIGM9cy5hcmduYW1lcy5tYXAoZnVuY3Rpb24odCxyKXtyZXR1cm4gbihMbixlLmFyZ3Nbcl0se3ZhbHVlOnQucHJpbnRfdG9fc3RyaW5nKCl9KX0pLG89VigpO3JldHVybiBpZS5wcm90b3R5cGUuX2NvZGVnZW4uY2FsbChzLHMsbyksbz1vLnRvU3RyaW5nKCkucmVwbGFjZSgvXlx7fFx9JC9nLCIiKSxjLnB1c2gobihMbixlLmFyZ3NbZS5hcmdzLmxlbmd0aC0xXSx7dmFsdWU6b30pKSxlLmFyZ3M9YyxlfWNhdGNoKG4pe2lmKCEobiBpbnN0YW5jZW9mIHopKXRocm93IGNvbnNvbGUubG9nKG4pLG47ci53YXJuKCJFcnJvciBwYXJzaW5nIGNvZGUgcGFzc2VkIHRvIG5ldyBGdW5jdGlvbiBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLGUuYXJnc1tlLmFyZ3MubGVuZ3RoLTFdLnN0YXJ0KSxyLndhcm4obi50b1N0cmluZygpKX1icmVhaztjYXNlIlN5bWJvbCI6cmV0dXJuIGUuYXJncz1bXSxlfWVsc2V7aWYoaSBpbnN0YW5jZW9mIHRuJiYidG9TdHJpbmciPT1pLnByb3BlcnR5JiYwPT1lLmFyZ3MubGVuZ3RoKXJldHVybiBuKHNuLGUse2xlZnQ6bihMbixlLHt2YWx1ZToiIn0pLG9wZXJhdG9yOiIrIixyaWdodDppLmV4cHJlc3Npb259KS50cmFuc2Zvcm0ocik7aWYoaSBpbnN0YW5jZW9mIHRuJiZpLmV4cHJlc3Npb24gaW5zdGFuY2VvZiBsbiYmImpvaW4iPT1pLnByb3BlcnR5KXt2YXIgZj0wPT1lLmFyZ3MubGVuZ3RoPyIsIjplLmFyZ3NbMF0uZXZhbHVhdGUocilbMV07aWYobnVsbCE9Zil7dmFyIGw9aS5leHByZXNzaW9uLmVsZW1lbnRzLnJlZHVjZShmdW5jdGlvbihlLG4pe2lmKG49bi5ldmFsdWF0ZShyKSwwPT1lLmxlbmd0aHx8MT09bi5sZW5ndGgpZS5wdXNoKG4pO2Vsc2V7dmFyIGk9ZVtlLmxlbmd0aC0xXTtpZigyPT1pLmxlbmd0aCl7dmFyIG89IiIraVsxXStmK25bMV07ZVtlLmxlbmd0aC0xXT1bdChyLG8saVswXSksb119ZWxzZSBlLnB1c2gobil9cmV0dXJuIGV9LFtdKTtpZigwPT1sLmxlbmd0aClyZXR1cm4gbihMbixlLHt2YWx1ZToiIn0pO2lmKDE9PWwubGVuZ3RoKXJldHVybiBsWzBdWzBdO2lmKCIiPT1mKXt2YXIgcDtyZXR1cm4gcD1sWzBdWzBdaW5zdGFuY2VvZiBMbnx8bFsxXVswXWluc3RhbmNlb2YgTG4/bC5zaGlmdCgpWzBdOm4oTG4sZSx7dmFsdWU6IiJ9KSxsLnJlZHVjZShmdW5jdGlvbihlLHQpe3JldHVybiBuKHNuLHRbMF0se29wZXJhdG9yOiIrIixsZWZ0OmUscmlnaHQ6dFswXX0pfSxwKS50cmFuc2Zvcm0ocil9dmFyIGQ9ZS5jbG9uZSgpO3JldHVybiBkLmV4cHJlc3Npb249ZC5leHByZXNzaW9uLmNsb25lKCksZC5leHByZXNzaW9uLmV4cHJlc3Npb249ZC5leHByZXNzaW9uLmV4cHJlc3Npb24uY2xvbmUoKSxkLmV4cHJlc3Npb24uZXhwcmVzc2lvbi5lbGVtZW50cz1sLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gZVswXX0pLEYoZSxkKX19fX1pZihyLm9wdGlvbigic2lkZV9lZmZlY3RzIikmJmUuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEVlJiYhZS5leHByZXNzaW9uLmlzX2dlbmVyYXRvciYmMD09ZS5hcmdzLmxlbmd0aCYmIXJlLnByb3RvdHlwZS5oYXNfc2lkZV9lZmZlY3RzLmNhbGwoZS5leHByZXNzaW9uLHIpKXJldHVybiBuKEpuLGUpLnRyYW5zZm9ybShyKTtpZihyLm9wdGlvbigiZHJvcF9jb25zb2xlIikmJmUuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIG5uKXtmb3IodmFyIGg9ZS5leHByZXNzaW9uLmV4cHJlc3Npb247aC5leHByZXNzaW9uOyloPWguZXhwcmVzc2lvbjtpZihoIGluc3RhbmNlb2YgSG4mJiJjb25zb2xlIj09aC5uYW1lJiZoLnVuZGVjbGFyZWQoKSlyZXR1cm4gbihKbixlKS50cmFuc2Zvcm0ocil9cmV0dXJuIGUuZXZhbHVhdGUocilbMF19KSxlKFFlLGZ1bmN0aW9uKGUsdCl7aWYodC5vcHRpb24oInVuc2FmZSIpKXt2YXIgcj1lLmV4cHJlc3Npb247aWYociBpbnN0YW5jZW9mIEhuJiZyLnVuZGVjbGFyZWQoKSlzd2l0Y2goci5uYW1lKXtjYXNlIk9iamVjdCI6Y2FzZSJSZWdFeHAiOmNhc2UiRnVuY3Rpb24iOmNhc2UiRXJyb3IiOmNhc2UiQXJyYXkiOnJldHVybiBuKEtlLGUsZSkudHJhbnNmb3JtKHQpfX1yZXR1cm4gZX0pLGUoZW4sZnVuY3Rpb24oZSx0KXtpZighdC5vcHRpb24oInNpZGVfZWZmZWN0cyIpKXJldHVybiBlO2lmKCFlLmNhci5oYXNfc2lkZV9lZmZlY3RzKHQpKXJldHVybiByKHQucGFyZW50KCksZSxlLmNkcik7aWYodC5vcHRpb24oImNhc2NhZGUiKSl7aWYoZS5jYXIgaW5zdGFuY2VvZiBmbiYmIWUuY2FyLmxlZnQuaGFzX3NpZGVfZWZmZWN0cyh0KSl7aWYoZS5jYXIubGVmdC5lcXVpdmFsZW50X3RvKGUuY2RyKSlyZXR1cm4gZS5jYXI7aWYoZS5jZHIgaW5zdGFuY2VvZiBLZSYmZS5jZHIuZXhwcmVzc2lvbi5lcXVpdmFsZW50X3RvKGUuY2FyLmxlZnQpKXJldHVybiBlLmNkci5leHByZXNzaW9uPWUuY2FyLGUuY2RyfWlmKCFlLmNhci5oYXNfc2lkZV9lZmZlY3RzKHQpJiYhZS5jZHIuaGFzX3NpZGVfZWZmZWN0cyh0KSYmZS5jYXIuZXF1aXZhbGVudF90byhlLmNkcikpcmV0dXJuIGUuY2FyfXJldHVybiBlLmNkciBpbnN0YW5jZW9mIHVuJiYidm9pZCI9PWUuY2RyLm9wZXJhdG9yJiYhZS5jZHIuZXhwcmVzc2lvbi5oYXNfc2lkZV9lZmZlY3RzKHQpPyhlLmNkci5leHByZXNzaW9uPWUuY2FyLGUuY2RyKTplLmNkciBpbnN0YW5jZW9mIEpuP24odW4sZSx7b3BlcmF0b3I6InZvaWQiLGV4cHJlc3Npb246ZS5jYXJ9KTplfSksb24uREVGTUVUSE9EKCJsaWZ0X3NlcXVlbmNlcyIsZnVuY3Rpb24oZSl7aWYoZS5vcHRpb24oInNlcXVlbmNlcyIpJiZ0aGlzLmV4cHJlc3Npb24gaW5zdGFuY2VvZiBlbil7dmFyIG49dGhpcy5leHByZXNzaW9uLHQ9bi50b19hcnJheSgpO3JldHVybiB0aGlzLmV4cHJlc3Npb249dC5wb3AoKSx0LnB1c2godGhpcyksbj1lbi5mcm9tX2FycmF5KHQpLnRyYW5zZm9ybShlKX1yZXR1cm4gdGhpc30pLGUoYW4sZnVuY3Rpb24oZSxuKXtyZXR1cm4gZS5saWZ0X3NlcXVlbmNlcyhuKX0pLGUodW4sZnVuY3Rpb24oZSx0KXtlPWUubGlmdF9zZXF1ZW5jZXModCk7dmFyIHI9ZS5leHByZXNzaW9uO2lmKHQub3B0aW9uKCJib29sZWFucyIpJiZ0LmluX2Jvb2xlYW5fY29udGV4dCgpKXtzd2l0Y2goZS5vcGVyYXRvcil7Y2FzZSIhIjppZihyIGluc3RhbmNlb2YgdW4mJiIhIj09ci5vcGVyYXRvcilyZXR1cm4gci5leHByZXNzaW9uO2JyZWFrO2Nhc2UidHlwZW9mIjpyZXR1cm4gdC53YXJuKCJCb29sZWFuIGV4cHJlc3Npb24gYWx3YXlzIHRydWUgW3tmaWxlfTp7bGluZX0se2NvbH1dIixlLnN0YXJ0KSxlLmV4cHJlc3Npb24uaGFzX3NpZGVfZWZmZWN0cyh0KT9uKGVuLGUse2NhcjplLmV4cHJlc3Npb24sY2RyOm4obnQsZSl9KTpuKG50LGUpfXIgaW5zdGFuY2VvZiBzbiYmIiEiPT1lLm9wZXJhdG9yJiYoZT1GKGUsci5uZWdhdGUodCkpKX1yZXR1cm4gZS5ldmFsdWF0ZSh0KVswXX0pLHNuLkRFRk1FVEhPRCgibGlmdF9zZXF1ZW5jZXMiLGZ1bmN0aW9uKGUpe2lmKGUub3B0aW9uKCJzZXF1ZW5jZXMiKSl7aWYodGhpcy5sZWZ0IGluc3RhbmNlb2YgZW4pe3ZhciBuPXRoaXMubGVmdCx0PW4udG9fYXJyYXkoKTtyZXR1cm4gdGhpcy5sZWZ0PXQucG9wKCksdC5wdXNoKHRoaXMpLG49ZW4uZnJvbV9hcnJheSh0KS50cmFuc2Zvcm0oZSl9aWYodGhpcy5yaWdodCBpbnN0YW5jZW9mIGVuJiZ0aGlzIGluc3RhbmNlb2YgZm4mJiFrKHRoaXMubGVmdCxlKSl7dmFyIG49dGhpcy5yaWdodCx0PW4udG9fYXJyYXkoKTtyZXR1cm4gdGhpcy5yaWdodD10LnBvcCgpLHQucHVzaCh0aGlzKSxuPWVuLmZyb21fYXJyYXkodCkudHJhbnNmb3JtKGUpfX1yZXR1cm4gdGhpc30pO3ZhciBCPXYoIj09ID09PSAhPSAhPT0gKiAmIHwgXiIpO2Uoc24sZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKG4scil7aWYocnx8IWUubGVmdC5oYXNfc2lkZV9lZmZlY3RzKHQpJiYhZS5yaWdodC5oYXNfc2lkZV9lZmZlY3RzKHQpKXtuJiYoZS5vcGVyYXRvcj1uKTt2YXIgaT1lLmxlZnQ7ZS5sZWZ0PWUucmlnaHQsZS5yaWdodD1pfX12YXIgbz1lLmxlZnQuZXZhbHVhdGUodCksdT1lLnJpZ2h0LmV2YWx1YXRlKHQpO2lmKG8ubGVuZ3RoPjEmJm9bMF0uaXNfY29uc3RhbnQoKSE9PWUubGVmdC5pc19jb25zdGFudCgpfHx1Lmxlbmd0aD4xJiZ1WzBdLmlzX2NvbnN0YW50KCkhPT1lLnJpZ2h0LmlzX2NvbnN0YW50KCkpcmV0dXJuIG4oc24sZSx7b3BlcmF0b3I6ZS5vcGVyYXRvcixsZWZ0Om9bMF0scmlnaHQ6dVswXX0pLm9wdGltaXplKHQpO2lmKEIoZS5vcGVyYXRvcikmJihlLnJpZ2h0IGluc3RhbmNlb2YgUm4mJiEoZS5sZWZ0IGluc3RhbmNlb2YgUm4pJiYoZS5sZWZ0IGluc3RhbmNlb2Ygc24mJnd0W2UubGVmdC5vcGVyYXRvcl0+PXd0W2Uub3BlcmF0b3JdfHxpKG51bGwsITApKSwvXlshPV09PT8kLy50ZXN0KGUub3BlcmF0b3IpKSl7aWYoZS5sZWZ0IGluc3RhbmNlb2YgSG4mJmUucmlnaHQgaW5zdGFuY2VvZiBjbil7aWYoZS5yaWdodC5jb25zZXF1ZW50IGluc3RhbmNlb2YgSG4mJmUucmlnaHQuY29uc2VxdWVudC5kZWZpbml0aW9uKCk9PT1lLmxlZnQuZGVmaW5pdGlvbigpKXtpZigvXj09Ly50ZXN0KGUub3BlcmF0b3IpKXJldHVybiBlLnJpZ2h0LmNvbmRpdGlvbjtpZigvXiE9Ly50ZXN0KGUub3BlcmF0b3IpKXJldHVybiBlLnJpZ2h0LmNvbmRpdGlvbi5uZWdhdGUodCl9aWYoZS5yaWdodC5hbHRlcm5hdGl2ZSBpbnN0YW5jZW9mIEhuJiZlLnJpZ2h0LmFsdGVybmF0aXZlLmRlZmluaXRpb24oKT09PWUubGVmdC5kZWZpbml0aW9uKCkpe2lmKC9ePT0vLnRlc3QoZS5vcGVyYXRvcikpcmV0dXJuIGUucmlnaHQuY29uZGl0aW9uLm5lZ2F0ZSh0KTtpZigvXiE9Ly50ZXN0KGUub3BlcmF0b3IpKXJldHVybiBlLnJpZ2h0LmNvbmRpdGlvbn19aWYoZS5yaWdodCBpbnN0YW5jZW9mIEhuJiZlLmxlZnQgaW5zdGFuY2VvZiBjbil7aWYoZS5sZWZ0LmNvbnNlcXVlbnQgaW5zdGFuY2VvZiBIbiYmZS5sZWZ0LmNvbnNlcXVlbnQuZGVmaW5pdGlvbigpPT09ZS5yaWdodC5kZWZpbml0aW9uKCkpe2lmKC9ePT0vLnRlc3QoZS5vcGVyYXRvcikpcmV0dXJuIGUubGVmdC5jb25kaXRpb247aWYoL14hPS8udGVzdChlLm9wZXJhdG9yKSlyZXR1cm4gZS5sZWZ0LmNvbmRpdGlvbi5uZWdhdGUodCl9aWYoZS5sZWZ0LmFsdGVybmF0aXZlIGluc3RhbmNlb2YgSG4mJmUubGVmdC5hbHRlcm5hdGl2ZS5kZWZpbml0aW9uKCk9PT1lLnJpZ2h0LmRlZmluaXRpb24oKSl7aWYoL149PS8udGVzdChlLm9wZXJhdG9yKSlyZXR1cm4gZS5sZWZ0LmNvbmRpdGlvbi5uZWdhdGUodCk7aWYoL14hPS8udGVzdChlLm9wZXJhdG9yKSlyZXR1cm4gZS5sZWZ0LmNvbmRpdGlvbn19fWlmKGU9ZS5saWZ0X3NlcXVlbmNlcyh0KSx0Lm9wdGlvbigiY29tcGFyaXNvbnMiKSlzd2l0Y2goZS5vcGVyYXRvcil7Y2FzZSI9PT0iOmNhc2UiIT09IjooZS5sZWZ0LmlzX3N0cmluZyh0KSYmZS5yaWdodC5pc19zdHJpbmcodCl8fGUubGVmdC5pc19ib29sZWFuKCkmJmUucmlnaHQuaXNfYm9vbGVhbigpKSYmKGUub3BlcmF0b3I9ZS5vcGVyYXRvci5zdWJzdHIoMCwyKSk7Y2FzZSI9PSI6Y2FzZSIhPSI6ZS5sZWZ0IGluc3RhbmNlb2YgTG4mJiJ1bmRlZmluZWQiPT1lLmxlZnQudmFsdWUmJmUucmlnaHQgaW5zdGFuY2VvZiB1biYmInR5cGVvZiI9PWUucmlnaHQub3BlcmF0b3ImJnQub3B0aW9uKCJ1bnNhZmUiKSYmKGUucmlnaHQuZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEhuJiZlLnJpZ2h0LmV4cHJlc3Npb24udW5kZWNsYXJlZCgpfHwoZS5yaWdodD1lLnJpZ2h0LmV4cHJlc3Npb24sZS5sZWZ0PW4oSm4sZS5sZWZ0KS5vcHRpbWl6ZSh0KSwyPT1lLm9wZXJhdG9yLmxlbmd0aCYmKGUub3BlcmF0b3IrPSI9IikpKX1pZih0Lm9wdGlvbigiYm9vbGVhbnMiKSYmdC5pbl9ib29sZWFuX2NvbnRleHQoKSlzd2l0Y2goZS5vcGVyYXRvcil7Y2FzZSImJiI6dmFyIGE9ZS5sZWZ0LmV2YWx1YXRlKHQpLHM9ZS5yaWdodC5ldmFsdWF0ZSh0KTtpZihhLmxlbmd0aD4xJiYhYVsxXXx8cy5sZW5ndGg+MSYmIXNbMV0pcmV0dXJuIHQud2FybigiQm9vbGVhbiAmJiBhbHdheXMgZmFsc2UgW3tmaWxlfTp7bGluZX0se2NvbH1dIixlLnN0YXJ0KSxlLmxlZnQuaGFzX3NpZGVfZWZmZWN0cyh0KT9uKGVuLGUse2NhcjplLmxlZnQsY2RyOm4oZXQpfSkub3B0aW1pemUodCk6bihldCxlKTtpZihhLmxlbmd0aD4xJiZhWzFdKXJldHVybiBzWzBdO2lmKHMubGVuZ3RoPjEmJnNbMV0pcmV0dXJuIGFbMF07YnJlYWs7Y2FzZSJ8fCI6dmFyIGE9ZS5sZWZ0LmV2YWx1YXRlKHQpLHM9ZS5yaWdodC5ldmFsdWF0ZSh0KTtpZihhLmxlbmd0aD4xJiZhWzFdfHxzLmxlbmd0aD4xJiZzWzFdKXJldHVybiB0Lndhcm4oIkJvb2xlYW4gfHwgYWx3YXlzIHRydWUgW3tmaWxlfTp7bGluZX0se2NvbH1dIixlLnN0YXJ0KSxlLmxlZnQuaGFzX3NpZGVfZWZmZWN0cyh0KT9uKGVuLGUse2NhcjplLmxlZnQsY2RyOm4obnQpfSkub3B0aW1pemUodCk6bihudCxlKTtpZihhLmxlbmd0aD4xJiYhYVsxXSlyZXR1cm4gc1swXTtpZihzLmxlbmd0aD4xJiYhc1sxXSlyZXR1cm4gYVswXTticmVhaztjYXNlIisiOnZhciBhPWUubGVmdC5ldmFsdWF0ZSh0KSxzPWUucmlnaHQuZXZhbHVhdGUodCk7aWYoYS5sZW5ndGg+MSYmYVswXWluc3RhbmNlb2YgTG4mJmFbMV0mJiFlLnJpZ2h0Lmhhc19zaWRlX2VmZmVjdHModCl8fHMubGVuZ3RoPjEmJnNbMF1pbnN0YW5jZW9mIExuJiZzWzFdJiYhZS5sZWZ0Lmhhc19zaWRlX2VmZmVjdHModCkpcmV0dXJuIHQud2FybigiKyBpbiBib29sZWFuIGNvbnRleHQgYWx3YXlzIHRydWUgW3tmaWxlfTp7bGluZX0se2NvbH1dIixlLnN0YXJ0KSxuKG50LGUpfWlmKHQub3B0aW9uKCJjb21wYXJpc29ucyIpJiZlLmlzX2Jvb2xlYW4oKSl7aWYoISh0LnBhcmVudCgpaW5zdGFuY2VvZiBzbil8fHQucGFyZW50KClpbnN0YW5jZW9mIGZuKXt2YXIgYz1uKHVuLGUse29wZXJhdG9yOiIhIixleHByZXNzaW9uOmUubmVnYXRlKHQpfSk7ZT1GKGUsYyl9aWYodC5vcHRpb24oInVuc2FmZV9jb21wcyIpKXN3aXRjaChlLm9wZXJhdG9yKXtjYXNlIjwiOmkoIj4iKTticmVhaztjYXNlIjw9IjppKCI+PSIpfX1pZigiKyI9PWUub3BlcmF0b3ImJmUucmlnaHQgaW5zdGFuY2VvZiBMbiYmIiI9PT1lLnJpZ2h0LmdldFZhbHVlKCkmJmUubGVmdCBpbnN0YW5jZW9mIHNuJiYiKyI9PWUubGVmdC5vcGVyYXRvciYmZS5sZWZ0LmlzX3N0cmluZyh0KSlyZXR1cm4gZS5sZWZ0O2lmKHQub3B0aW9uKCJldmFsdWF0ZSIpKXtzd2l0Y2goZS5vcGVyYXRvcil7Y2FzZSImJiI6aWYoZS5sZWZ0LmlzX2NvbnN0YW50KCkpcmV0dXJuIGUubGVmdC5jb25zdGFudF92YWx1ZSh0KT8odC53YXJuKCJDb25kaXRpb24gbGVmdCBvZiAmJiBhbHdheXMgdHJ1ZSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLGUuc3RhcnQpLHIodC5wYXJlbnQoKSxlLGUucmlnaHQpKToodC53YXJuKCJDb25kaXRpb24gbGVmdCBvZiAmJiBhbHdheXMgZmFsc2UgW3tmaWxlfTp7bGluZX0se2NvbH1dIixlLnN0YXJ0KSxyKHQucGFyZW50KCksZSxlLmxlZnQpKTticmVhaztjYXNlInx8IjppZihlLmxlZnQuaXNfY29uc3RhbnQoKSlyZXR1cm4gZS5sZWZ0LmNvbnN0YW50X3ZhbHVlKHQpPyh0Lndhcm4oIkNvbmRpdGlvbiBsZWZ0IG9mIHx8IGFsd2F5cyB0cnVlIFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsZS5zdGFydCkscih0LnBhcmVudCgpLGUsZS5sZWZ0KSk6KHQud2FybigiQ29uZGl0aW9uIGxlZnQgb2YgfHwgYWx3YXlzIGZhbHNlIFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsZS5zdGFydCkscih0LnBhcmVudCgpLGUsZS5yaWdodCkpfSIrIj09ZS5vcGVyYXRvciYmKGUubGVmdCBpbnN0YW5jZW9mIFJuJiZlLnJpZ2h0IGluc3RhbmNlb2Ygc24mJiIrIj09ZS5yaWdodC5vcGVyYXRvciYmZS5yaWdodC5sZWZ0IGluc3RhbmNlb2YgUm4mJmUucmlnaHQuaXNfc3RyaW5nKHQpJiYoZT1uKHNuLGUse29wZXJhdG9yOiIrIixsZWZ0Om4oTG4sbnVsbCx7dmFsdWU6IiIrZS5sZWZ0LmdldFZhbHVlKCkrZS5yaWdodC5sZWZ0LmdldFZhbHVlKCksc3RhcnQ6ZS5sZWZ0LnN0YXJ0LGVuZDplLnJpZ2h0LmxlZnQuZW5kfSkscmlnaHQ6ZS5yaWdodC5yaWdodH0pKSxlLnJpZ2h0IGluc3RhbmNlb2YgUm4mJmUubGVmdCBpbnN0YW5jZW9mIHNuJiYiKyI9PWUubGVmdC5vcGVyYXRvciYmZS5sZWZ0LnJpZ2h0IGluc3RhbmNlb2YgUm4mJmUubGVmdC5pc19zdHJpbmcodCkmJihlPW4oc24sZSx7b3BlcmF0b3I6IisiLGxlZnQ6ZS5sZWZ0LmxlZnQscmlnaHQ6bihMbixudWxsLHt2YWx1ZToiIitlLmxlZnQucmlnaHQuZ2V0VmFsdWUoKStlLnJpZ2h0LmdldFZhbHVlKCksc3RhcnQ6ZS5sZWZ0LnJpZ2h0LnN0YXJ0LGVuZDplLnJpZ2h0LmVuZH0pfSkpLGUubGVmdCBpbnN0YW5jZW9mIHNuJiYiKyI9PWUubGVmdC5vcGVyYXRvciYmZS5sZWZ0LmlzX3N0cmluZyh0KSYmZS5sZWZ0LnJpZ2h0IGluc3RhbmNlb2YgUm4mJmUucmlnaHQgaW5zdGFuY2VvZiBzbiYmIisiPT1lLnJpZ2h0Lm9wZXJhdG9yJiZlLnJpZ2h0LmxlZnQgaW5zdGFuY2VvZiBSbiYmZS5yaWdodC5pc19zdHJpbmcodCkmJihlPW4oc24sZSx7b3BlcmF0b3I6IisiLGxlZnQ6bihzbixlLmxlZnQse29wZXJhdG9yOiIrIixsZWZ0OmUubGVmdC5sZWZ0LHJpZ2h0Om4oTG4sbnVsbCx7dmFsdWU6IiIrZS5sZWZ0LnJpZ2h0LmdldFZhbHVlKCkrZS5yaWdodC5sZWZ0LmdldFZhbHVlKCksc3RhcnQ6ZS5sZWZ0LnJpZ2h0LnN0YXJ0LGVuZDplLnJpZ2h0LmxlZnQuZW5kfSl9KSxyaWdodDplLnJpZ2h0LnJpZ2h0fSkpKX1yZXR1cm4gZS5yaWdodCBpbnN0YW5jZW9mIHNuJiZlLnJpZ2h0Lm9wZXJhdG9yPT1lLm9wZXJhdG9yJiYoIiYmIj09ZS5vcGVyYXRvcnx8Inx8Ij09ZS5vcGVyYXRvcik/KGUubGVmdD1uKHNuLGUubGVmdCx7b3BlcmF0b3I6ZS5vcGVyYXRvcixsZWZ0OmUubGVmdCxyaWdodDplLnJpZ2h0LmxlZnR9KSxlLnJpZ2h0PWUucmlnaHQucmlnaHQsZS50cmFuc2Zvcm0odCkpOmUuZXZhbHVhdGUodClbMF19KSxlKEhuLGZ1bmN0aW9uKGUscil7aWYoZS51bmRlY2xhcmVkKCkmJiFFKGUsci5wYXJlbnQoKSkpe3ZhciBpPXIub3B0aW9uKCJnbG9iYWxfZGVmcyIpO2lmKGkmJnkoaSxlLm5hbWUpKXJldHVybiB0KHIsaVtlLm5hbWVdLGUpO2lmKCFlLnNjb3BlLnVzZXNfd2l0aHx8IXIuZmluZF9wYXJlbnQoRGUpKXN3aXRjaChlLm5hbWUpe2Nhc2UidW5kZWZpbmVkIjpyZXR1cm4gbihKbixlKTtjYXNlIk5hTiI6cmV0dXJuIG4oR24sZSkudHJhbnNmb3JtKHIpO2Nhc2UiSW5maW5pdHkiOnJldHVybiBuKEtuLGUpLnRyYW5zZm9ybShyKX19cmV0dXJuIGV9KSxlKEtuLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIG4oc24sZSx7b3BlcmF0b3I6Ii8iLGxlZnQ6bihWbixlLHt2YWx1ZToxfSkscmlnaHQ6bihWbixlLHt2YWx1ZTowfSl9KX0pLGUoSm4sZnVuY3Rpb24oZSx0KXtpZih0Lm9wdGlvbigidW5zYWZlIikpe3ZhciByPXQuZmluZF9wYXJlbnQobWUpLGk9ci5maW5kX3ZhcmlhYmxlKCJ1bmRlZmluZWQiKTtpZihpKXt2YXIgbz1uKEhuLGUse25hbWU6InVuZGVmaW5lZCIsc2NvcGU6cix0aGVkZWY6aX0pO3JldHVybiBvLnJlZmVyZW5jZSgpLG99fXJldHVybiBlfSk7dmFyIFM9WyIrIiwiLSIsIi8iLCIqIiwiJSIsIj4+IiwiPDwiLCI+Pj4iLCJ8IiwiXiIsIiYiXSxUPVsiKiIsInwiLCJeIiwiJiJdO2UoZm4sZnVuY3Rpb24oZSxuKXtyZXR1cm4gZT1lLmxpZnRfc2VxdWVuY2VzKG4pLCI9Ij09ZS5vcGVyYXRvciYmZS5sZWZ0IGluc3RhbmNlb2YgSG4mJmUucmlnaHQgaW5zdGFuY2VvZiBzbiYmKGUucmlnaHQubGVmdCBpbnN0YW5jZW9mIEhuJiZlLnJpZ2h0LmxlZnQubmFtZT09ZS5sZWZ0Lm5hbWUmJmkoZS5yaWdodC5vcGVyYXRvcixTKT8oZS5vcGVyYXRvcj1lLnJpZ2h0Lm9wZXJhdG9yKyI9IixlLnJpZ2h0PWUucmlnaHQucmlnaHQpOmUucmlnaHQucmlnaHQgaW5zdGFuY2VvZiBIbiYmZS5yaWdodC5yaWdodC5uYW1lPT1lLmxlZnQubmFtZSYmaShlLnJpZ2h0Lm9wZXJhdG9yLFQpJiYhZS5yaWdodC5sZWZ0Lmhhc19zaWRlX2VmZmVjdHMobikmJihlLm9wZXJhdG9yPWUucmlnaHQub3BlcmF0b3IrIj0iLGUucmlnaHQ9ZS5yaWdodC5sZWZ0KSksZX0pLGUoY24sZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKGUpe3JldHVybiBlLmlzX2Jvb2xlYW4oKT9lOm4odW4sZSx7b3BlcmF0b3I6IiEiLGV4cHJlc3Npb246ZS5uZWdhdGUodCl9KX1mdW5jdGlvbiBvKGUpe3JldHVybiBlIGluc3RhbmNlb2YgbnR8fGUgaW5zdGFuY2VvZiB1biYmIiEiPT1lLm9wZXJhdG9yJiZlLmV4cHJlc3Npb24gaW5zdGFuY2VvZiBSbiYmIWUuZXhwcmVzc2lvbi52YWx1ZX1mdW5jdGlvbiB1KGUpe3JldHVybiBlIGluc3RhbmNlb2YgZXR8fGUgaW5zdGFuY2VvZiB1biYmIiEiPT1lLm9wZXJhdG9yJiZlLmV4cHJlc3Npb24gaW5zdGFuY2VvZiBSbiYmISFlLmV4cHJlc3Npb24udmFsdWV9aWYoIXQub3B0aW9uKCJjb25kaXRpb25hbHMiKSlyZXR1cm4gZTtpZihlLmNvbmRpdGlvbiBpbnN0YW5jZW9mIGVuKXt2YXIgYT1lLmNvbmRpdGlvbi5jYXI7cmV0dXJuIGUuY29uZGl0aW9uPWUuY29uZGl0aW9uLmNkcixlbi5jb25zKGEsZSl9dmFyIHM9ZS5jb25kaXRpb24uZXZhbHVhdGUodCk7aWYocy5sZW5ndGg+MSlyZXR1cm4gc1sxXT8odC53YXJuKCJDb25kaXRpb24gYWx3YXlzIHRydWUgW3tmaWxlfTp7bGluZX0se2NvbH1dIixlLnN0YXJ0KSxyKHQucGFyZW50KCksZSxlLmNvbnNlcXVlbnQpKToodC53YXJuKCJDb25kaXRpb24gYWx3YXlzIGZhbHNlIFt7ZmlsZX06e2xpbmV9LHtjb2x9XSIsZS5zdGFydCkscih0LnBhcmVudCgpLGUsZS5hbHRlcm5hdGl2ZSkpO3ZhciBjPXNbMF0ubmVnYXRlKHQpO0Yoc1swXSxjKT09PWMmJihlPW4oY24sZSx7Y29uZGl0aW9uOmMsY29uc2VxdWVudDplLmFsdGVybmF0aXZlLGFsdGVybmF0aXZlOmUuY29uc2VxdWVudH0pKTt2YXIgZj1lLmNvbnNlcXVlbnQsbD1lLmFsdGVybmF0aXZlO2lmKGYgaW5zdGFuY2VvZiBmbiYmbCBpbnN0YW5jZW9mIGZuJiZmLm9wZXJhdG9yPT1sLm9wZXJhdG9yJiZmLmxlZnQuZXF1aXZhbGVudF90byhsLmxlZnQpJiYhZi5sZWZ0Lmhhc19zaWRlX2VmZmVjdHModCkpcmV0dXJuIG4oZm4sZSx7b3BlcmF0b3I6Zi5vcGVyYXRvcixsZWZ0OmYubGVmdCxyaWdodDpuKGNuLGUse2NvbmRpdGlvbjplLmNvbmRpdGlvbixjb25zZXF1ZW50OmYucmlnaHQsYWx0ZXJuYXRpdmU6bC5yaWdodH0pfSk7aWYoZiBpbnN0YW5jZW9mIEtlJiZsLlRZUEU9PT1mLlRZUEUmJmYuYXJncy5sZW5ndGg9PWwuYXJncy5sZW5ndGgmJiFmLmV4cHJlc3Npb24uaGFzX3NpZGVfZWZmZWN0cyh0KSYmZi5leHByZXNzaW9uLmVxdWl2YWxlbnRfdG8obC5leHByZXNzaW9uKSl7aWYoMD09Zi5hcmdzLmxlbmd0aClyZXR1cm4gbihlbixlLHtjYXI6ZS5jb25kaXRpb24sY2RyOmZ9KTtpZigxPT1mLmFyZ3MubGVuZ3RoKXJldHVybiBmLmFyZ3NbMF09bihjbixlLHtjb25kaXRpb246ZS5jb25kaXRpb24sY29uc2VxdWVudDpmLmFyZ3NbMF0sYWx0ZXJuYXRpdmU6bC5hcmdzWzBdfSksZn1pZihmIGluc3RhbmNlb2YgY24mJmYuYWx0ZXJuYXRpdmUuZXF1aXZhbGVudF90byhsKSlyZXR1cm4gbihjbixlLHtjb25kaXRpb246bihzbixlLHtsZWZ0OmUuY29uZGl0aW9uLG9wZXJhdG9yOiImJiIscmlnaHQ6Zi5jb25kaXRpb259KSxjb25zZXF1ZW50OmYuY29uc2VxdWVudCxhbHRlcm5hdGl2ZTpsfSk7aWYoZi5pc19jb25zdGFudCgpJiZsLmlzX2NvbnN0YW50KCkmJmYuZXF1aXZhbGVudF90byhsKSl7dmFyIHA9Zi5ldmFsdWF0ZSh0KVswXTtyZXR1cm4gZS5jb25kaXRpb24uaGFzX3NpZGVfZWZmZWN0cyh0KT9lbi5mcm9tX2FycmF5KFtlLmNvbmRpdGlvbixwXSk6cH1yZXR1cm4gbyhlLmNvbnNlcXVlbnQpP3UoZS5hbHRlcm5hdGl2ZSk/aShlLmNvbmRpdGlvbik6bihzbixlLHtvcGVyYXRvcjoifHwiLGxlZnQ6aShlLmNvbmRpdGlvbikscmlnaHQ6ZS5hbHRlcm5hdGl2ZX0pOnUoZS5jb25zZXF1ZW50KT9vKGUuYWx0ZXJuYXRpdmUpP2koZS5jb25kaXRpb24ubmVnYXRlKHQpKTpuKHNuLGUse29wZXJhdG9yOiImJiIsbGVmdDppKGUuY29uZGl0aW9uLm5lZ2F0ZSh0KSkscmlnaHQ6ZS5hbHRlcm5hdGl2ZX0pOm8oZS5hbHRlcm5hdGl2ZSk/bihzbixlLHtvcGVyYXRvcjoifHwiLGxlZnQ6aShlLmNvbmRpdGlvbi5uZWdhdGUodCkpLHJpZ2h0OmUuY29uc2VxdWVudH0pOnUoZS5hbHRlcm5hdGl2ZSk/bihzbixlLHtvcGVyYXRvcjoiJiYiLGxlZnQ6aShlLmNvbmRpdGlvbikscmlnaHQ6ZS5jb25zZXF1ZW50fSk6ZX0pLGUoUW4sZnVuY3Rpb24oZSx0KXtpZih0Lm9wdGlvbigiYm9vbGVhbnMiKSl7dmFyIHI9dC5wYXJlbnQoKTtyZXR1cm4gciBpbnN0YW5jZW9mIHNuJiYoIj09Ij09ci5vcGVyYXRvcnx8IiE9Ij09ci5vcGVyYXRvcik/KHQud2FybigiTm9uLXN0cmljdCBlcXVhbGl0eSBhZ2FpbnN0IGJvb2xlYW46IHtvcGVyYXRvcn0ge3ZhbHVlfSBbe2ZpbGV9OntsaW5lfSx7Y29sfV0iLHtvcGVyYXRvcjpyLm9wZXJhdG9yLHZhbHVlOmUudmFsdWUsZmlsZTpyLnN0YXJ0LmZpbGUsbGluZTpyLnN0YXJ0LmxpbmUsY29sOnIuc3RhcnQuY29sfSksbihWbixlLHt2YWx1ZTorZS52YWx1ZX0pKTpuKHVuLGUse29wZXJhdG9yOiIhIixleHByZXNzaW9uOm4oVm4sZSx7dmFsdWU6MS1lLnZhbHVlfSl9KX1yZXR1cm4gZX0pLGUocm4sZnVuY3Rpb24oZSx0KXt2YXIgcj1lLnByb3BlcnR5O2lmKHIgaW5zdGFuY2VvZiBMbiYmdC5vcHRpb24oInByb3BlcnRpZXMiKSl7aWYocj1yLmdldFZhbHVlKCksb3Qocik/dC5vcHRpb24oInNjcmV3X2llOCIpOnEocikpcmV0dXJuIG4odG4sZSx7ZXhwcmVzc2lvbjplLmV4cHJlc3Npb24scHJvcGVydHk6cn0pLm9wdGltaXplKHQpO3ZhciBpPXBhcnNlRmxvYXQocik7aXNOYU4oaSl8fGkudG9TdHJpbmcoKSE9cnx8KGUucHJvcGVydHk9bihWbixlLnByb3BlcnR5LHt2YWx1ZTppfSkpfXJldHVybiBlLmV2YWx1YXRlKHQpWzBdfSksZSh0bixmdW5jdGlvbihlLHQpe3ZhciByPWUucHJvcGVydHk7cmV0dXJuIG90KHIpJiYhdC5vcHRpb24oInNjcmV3X2llOCIpP24ocm4sZSx7ZXhwcmVzc2lvbjplLmV4cHJlc3Npb24scHJvcGVydHk6bihMbixlLHt2YWx1ZTpyfSl9KS5vcHRpbWl6ZSh0KTplLmV2YWx1YXRlKHQpWzBdfSksZShsbix4KSxlKHBuLHgpLGUoV24seCksZShUZSxmdW5jdGlvbihlLG4pe3JldHVybiBlLnZhbHVlIGluc3RhbmNlb2YgSm4mJihlLnZhbHVlPW51bGwpLGV9KSxlKF9uLGZ1bmN0aW9uKGUsbil7cmV0dXJuIGV9KSxlKHR0LGZ1bmN0aW9uKGUsbil7cmV0dXJuIWUuaXNfc3RhciYmZS5leHByZXNzaW9uIGluc3RhbmNlb2YgSm4mJihlLmV4cHJlc3Npb249bnVsbCksZX0pLGUoa2UsZnVuY3Rpb24oZSxuKXtpZighbi5vcHRpb24oImV2YWx1YXRlIil8fG4ucGFyZW50KClpbnN0YW5jZW9mIENlKXJldHVybiBlO2Zvcih2YXIgdD1bXSxyPTA7cjxlLnNlZ21lbnRzLmxlbmd0aDtyKyspaWYoZS5zZWdtZW50c1tyXWluc3RhbmNlb2YgSyl7dmFyIGk9ZS5zZWdtZW50c1tyXS5ldmFsdWF0ZShuKTtpZigxPT09aS5sZW5ndGgpe3QucHVzaChpWzBdKTtjb250aW51ZX1pZihpWzBdLnByaW50X3RvX3N0cmluZygpLmxlbmd0aCszPChpWzFdKyIiKS5sZW5ndGgpe3QucHVzaChpWzBdKTtjb250aW51ZX10W3QubGVuZ3RoLTFdLnZhbHVlPXRbdC5sZW5ndGgtMV0udmFsdWUraVsxXStlLnNlZ21lbnRzWysrcl0udmFsdWV9ZWxzZSB0LnB1c2goZS5zZWdtZW50c1tyXSk7cmV0dXJuIGUuc2VnbWVudHM9dCxlfSksZShDZSxmdW5jdGlvbihlLG4pe3JldHVybiBlfSl9KCksZnVuY3Rpb24oKXtmdW5jdGlvbiBuKGUpe2lmKCJMaXRlcmFsIj09ZS50eXBlKXJldHVybiBudWxsIT1lLnJhdz9lLnJhdzplLnZhbHVlKyIifWZ1bmN0aW9uIHQoZSl7dmFyIHQ9ZS5sb2Mscj10JiZ0LnN0YXJ0LGk9ZS5yYW5nZTtyZXR1cm4gbmV3IFooe2ZpbGU6dCYmdC5zb3VyY2UsbGluZTpyJiZyLmxpbmUsY29sOnImJnIuY29sdW1uLHBvczppP2lbMF06ZS5zdGFydCxlbmRsaW5lOnImJnIubGluZSxlbmRjb2w6ciYmci5jb2x1bW4sZW5kcG9zOmk/aVswXTplLnN0YXJ0LHJhdzpuKGUpfSl9ZnVuY3Rpb24gcihlKXt2YXIgdD1lLmxvYyxyPXQmJnQuZW5kLGk9ZS5yYW5nZTtyZXR1cm4gbmV3IFooe2ZpbGU6dCYmdC5zb3VyY2UsbGluZTpyJiZyLmxpbmUsY29sOnImJnIuY29sdW1uLHBvczppP2lbMV06ZS5lbmQsZW5kbGluZTpyJiZyLmxpbmUsZW5kY29sOnImJnIuY29sdW1uLGVuZHBvczppP2lbMV06ZS5lbmQscmF3Om4oZSl9KX1mdW5jdGlvbiBpKG4saSx1KXt2YXIgZj0iZnVuY3Rpb24gRnJvbV9Nb3pfIituKyIoTSl7XG4iO2YrPSJyZXR1cm4gbmV3IFUyLiIraS5uYW1lKyIoe1xuc3RhcnQ6IG15X3N0YXJ0X3Rva2VuKE0pLFxuZW5kOiBteV9lbmRfdG9rZW4oTSkiO3ZhciBwPSJmdW5jdGlvbiBUb19Nb3pfIituKyIoTSl7XG4iO3ArPSJyZXR1cm4ge1xudHlwZTogIitKU09OLnN0cmluZ2lmeShuKSx1JiZ1LnNwbGl0KC9ccyosXHMqLykuZm9yRWFjaChmdW5jdGlvbihlKXt2YXIgbj0vKFthLXowLTkkX10rKSg9fEB8PnwlKShbYS16MC05JF9dKykvaS5leGVjKGUpO2lmKCFuKXRocm93IG5ldyBFcnJvcigiQ2FuJ3QgdW5kZXJzdGFuZCBwcm9wZXJ0eSBtYXA6ICIrZSk7dmFyIHQ9blsxXSxyPW5bMl0saT1uWzNdO3N3aXRjaChmKz0iLFxuIitpKyI6ICIscCs9IixcbiIrdCsiOiAiLHIpe2Nhc2UiQCI6Zis9Ik0uIit0KyIubWFwKGZyb21fbW96KSIscCs9Ik0uIitpKyIubWFwKHRvX21veikiO2JyZWFrO2Nhc2UiPiI6Zis9ImZyb21fbW96KE0uIit0KyIpIixwKz0idG9fbW96KE0uIitpKyIpIjticmVhaztjYXNlIj0iOmYrPSJNLiIrdCxwKz0iTS4iK2k7YnJlYWs7Y2FzZSIlIjpmKz0iZnJvbV9tb3ooTS4iK3QrIikuYm9keSIscCs9InRvX21vel9ibG9jayhNKSI7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIkNhbid0IHVuZGVyc3RhbmQgb3BlcmF0b3IgaW4gcHJvcG1hcDogIitlKX19KSxmKz0iXG59KVxufSIscCs9IlxufVxufSIsZj1uZXcgRnVuY3Rpb24oIlUyIiwibXlfc3RhcnRfdG9rZW4iLCJteV9lbmRfdG9rZW4iLCJmcm9tX21veiIsInJldHVybigiK2YrIikiKShlLHQscixvKSxwPW5ldyBGdW5jdGlvbigidG9fbW96IiwidG9fbW96X2Jsb2NrIiwicmV0dXJuKCIrcCsiKSIpKHMsYyksCmxbbl09ZixhKGkscCl9ZnVuY3Rpb24gbyhlKXtwLnB1c2goZSk7dmFyIG49bnVsbCE9ZT9sW2UudHlwZV0oZSk6bnVsbDtyZXR1cm4gcC5wb3AoKSxufWZ1bmN0aW9uIHUoZSxuLHQpe3ZhciByPWUuc3RhcnQsaT1lLmVuZDtyZXR1cm4gbnVsbCE9ci5wb3MmJm51bGwhPWkuZW5kcG9zJiYobi5yYW5nZT1bci5wb3MsaS5lbmRwb3NdKSxyLmxpbmUmJihuLmxvYz17c3RhcnQ6e2xpbmU6ci5saW5lLGNvbHVtbjpyLmNvbH0sZW5kOmkuZW5kbGluZT97bGluZTppLmVuZGxpbmUsY29sdW1uOmkuZW5kY29sfTpudWxsfSxyLmZpbGUmJihuLmxvYy5zb3VyY2U9ci5maWxlKSksbn1mdW5jdGlvbiBhKGUsbil7ZS5ERUZNRVRIT0QoInRvX21vemlsbGFfYXN0IixmdW5jdGlvbigpe3JldHVybiB1KHRoaXMsbih0aGlzKSl9KX1mdW5jdGlvbiBzKGUpe3JldHVybiBudWxsIT1lP2UudG9fbW96aWxsYV9hc3QoKTpudWxsfWZ1bmN0aW9uIGMoZSl7cmV0dXJue3R5cGU6IkJsb2NrU3RhdGVtZW50Iixib2R5OmUuYm9keS5tYXAocyl9fXZhciBmPWZ1bmN0aW9uKGUpe2Zvcih2YXIgbj0hMCx0PTA7dDxlLmxlbmd0aDt0KyspbiYmZVt0XWluc3RhbmNlb2YgUSYmZVt0XS5ib2R5IGluc3RhbmNlb2YgTG4/ZVt0XT1uZXcgbmUoe3N0YXJ0OmVbdF0uc3RhcnQsZW5kOmVbdF0uZW5kLHZhbHVlOmVbdF0uYm9keS52YWx1ZX0pOiFufHxlW3RdaW5zdGFuY2VvZiBRJiZlW3RdLmJvZHkgaW5zdGFuY2VvZiBMbnx8KG49ITEpO3JldHVybiBlfSxsPXtQcm9ncmFtOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgdmUoe3N0YXJ0OnQoZSksZW5kOnIoZSksYm9keTpmKGUuYm9keS5tYXAobykpfSl9LEZ1bmN0aW9uRGVjbGFyYXRpb246ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBGZSh7c3RhcnQ6dChlKSxlbmQ6cihlKSxuYW1lOm8oZS5pZCksYXJnbmFtZXM6ZS5wYXJhbXMubWFwKG8pLGJvZHk6ZihvKGUuYm9keSkuYm9keSl9KX0sRnVuY3Rpb25FeHByZXNzaW9uOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgRWUoe3N0YXJ0OnQoZSksZW5kOnIoZSksbmFtZTpvKGUuaWQpLGFyZ25hbWVzOmUucGFyYW1zLm1hcChvKSxib2R5OmYobyhlLmJvZHkpLmJvZHkpfSl9LEV4cHJlc3Npb25TdGF0ZW1lbnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyB0ZSh7c3RhcnQ6dChlKSxlbmQ6cihlKSxib2R5Om8oZS5leHByZXNzaW9uKX0pfSxUcnlTdGF0ZW1lbnQ6ZnVuY3Rpb24oZSl7dmFyIG49ZS5oYW5kbGVyc3x8W2UuaGFuZGxlcl07aWYobi5sZW5ndGg+MXx8ZS5ndWFyZGVkSGFuZGxlcnMmJmUuZ3VhcmRlZEhhbmRsZXJzLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIk11bHRpcGxlIGNhdGNoIGNsYXVzZXMgYXJlIG5vdCBzdXBwb3J0ZWQuIik7cmV0dXJuIG5ldyBQZSh7c3RhcnQ6dChlKSxlbmQ6cihlKSxib2R5Om8oZS5ibG9jaykuYm9keSxiY2F0Y2g6byhuWzBdKSxiZmluYWxseTplLmZpbmFsaXplcj9uZXcgUmUobyhlLmZpbmFsaXplcikpOm51bGx9KX0sUHJvcGVydHk6ZnVuY3Rpb24oZSl7dmFyIG49ZS5rZXksaT0iSWRlbnRpZmllciI9PW4udHlwZT9uLm5hbWU6bi52YWx1ZSx1PXtzdGFydDp0KG4pLGVuZDpyKGUudmFsdWUpLGtleTppLHZhbHVlOm8oZS52YWx1ZSl9O3N3aXRjaChlLmtpbmQpe2Nhc2UiaW5pdCI6cmV0dXJuIG5ldyBobih1KTtjYXNlInNldCI6cmV0dXJuIHUudmFsdWUubmFtZT1vKG4pLG5ldyBEbih1KTtjYXNlImdldCI6cmV0dXJuIHUudmFsdWUubmFtZT1vKG4pLG5ldyBtbih1KX19LEFycmF5RXhwcmVzc2lvbjpmdW5jdGlvbihlKXtyZXR1cm4gbmV3IGxuKHtzdGFydDp0KGUpLGVuZDpyKGUpLGVsZW1lbnRzOmUuZWxlbWVudHMubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT09ZT9uZXcgWm46byhlKX0pfSl9LE9iamVjdEV4cHJlc3Npb246ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBwbih7c3RhcnQ6dChlKSxlbmQ6cihlKSxwcm9wZXJ0aWVzOmUucHJvcGVydGllcy5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUudHlwZT0iUHJvcGVydHkiLG8oZSl9KX0pfSxTZXF1ZW5jZUV4cHJlc3Npb246ZnVuY3Rpb24oZSl7cmV0dXJuIGVuLmZyb21fYXJyYXkoZS5leHByZXNzaW9ucy5tYXAobykpfSxNZW1iZXJFeHByZXNzaW9uOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcoZS5jb21wdXRlZD9ybjp0bikoe3N0YXJ0OnQoZSksZW5kOnIoZSkscHJvcGVydHk6ZS5jb21wdXRlZD9vKGUucHJvcGVydHkpOmUucHJvcGVydHkubmFtZSxleHByZXNzaW9uOm8oZS5vYmplY3QpfSl9LFN3aXRjaENhc2U6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyhlLnRlc3Q/SWU6SGUpKHtzdGFydDp0KGUpLGVuZDpyKGUpLGV4cHJlc3Npb246byhlLnRlc3QpLGJvZHk6ZS5jb25zZXF1ZW50Lm1hcChvKX0pfSxWYXJpYWJsZURlY2xhcmF0aW9uOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcoImNvbnN0Ij09PWUua2luZD9ZZTpWZSkoe3N0YXJ0OnQoZSksZW5kOnIoZSksZGVmaW5pdGlvbnM6ZS5kZWNsYXJhdGlvbnMubWFwKG8pfSl9LExpdGVyYWw6ZnVuY3Rpb24oZSl7dmFyIG49ZS52YWx1ZSxpPXtzdGFydDp0KGUpLGVuZDpyKGUpfTtpZihudWxsPT09bilyZXR1cm4gbmV3IFhuKGkpO3N3aXRjaCh0eXBlb2Ygbil7Y2FzZSJzdHJpbmciOnJldHVybiBpLnZhbHVlPW4sbmV3IExuKGkpO2Nhc2UibnVtYmVyIjpyZXR1cm4gaS52YWx1ZT1uLG5ldyBWbihpKTtjYXNlImJvb2xlYW4iOnJldHVybiBuZXcobj9udDpldCkoaSk7ZGVmYXVsdDp2YXIgbz1lLnJlZ2V4O3JldHVybiBvJiZvLnBhdHRlcm4/aS52YWx1ZT1uZXcgUmVnRXhwKG8ucGF0dGVybixvLmZsYWdzKS50b1N0cmluZygpOmkudmFsdWU9ZS5yZWdleCYmZS5yYXc/ZS5yYXc6bixuZXcgV24oaSl9fSxJZGVudGlmaWVyOmZ1bmN0aW9uKGUpe3ZhciBuPXBbcC5sZW5ndGgtMl07cmV0dXJuIG5ldygiTGFiZWxlZFN0YXRlbWVudCI9PW4udHlwZT9qbjoiVmFyaWFibGVEZWNsYXJhdG9yIj09bi50eXBlJiZuLmlkPT09ZT8iY29uc3QiPT1uLmtpbmQ/a246d246IkZ1bmN0aW9uRXhwcmVzc2lvbiI9PW4udHlwZT9uLmlkPT09ZT8kbjpCbjoiRnVuY3Rpb25EZWNsYXJhdGlvbiI9PW4udHlwZT9uLmlkPT09ZT9TbjpCbjoiQ2F0Y2hDbGF1c2UiPT1uLnR5cGU/TW46IkJyZWFrU3RhdGVtZW50Ij09bi50eXBlfHwiQ29udGludWVTdGF0ZW1lbnQiPT1uLnR5cGU/SW46SG4pKHtzdGFydDp0KGUpLGVuZDpyKGUpLG5hbWU6ZS5uYW1lfSl9fTtsLlVwZGF0ZUV4cHJlc3Npb249bC5VbmFyeUV4cHJlc3Npb249ZnVuY3Rpb24oZSl7dmFyIG49InByZWZpeCJpbiBlP2UucHJlZml4OiJVbmFyeUV4cHJlc3Npb24iPT1lLnR5cGU7cmV0dXJuIG5ldyhuP3VuOmFuKSh7c3RhcnQ6dChlKSxlbmQ6cihlKSxvcGVyYXRvcjplLm9wZXJhdG9yLGV4cHJlc3Npb246byhlLmFyZ3VtZW50KX0pfSxpKCJFbXB0eVN0YXRlbWVudCIsb2UpLGkoIkJsb2NrU3RhdGVtZW50IixpZSwiYm9keUBib2R5IiksaSgiSWZTdGF0ZW1lbnQiLHplLCJ0ZXN0PmNvbmRpdGlvbiwgY29uc2VxdWVudD5ib2R5LCBhbHRlcm5hdGU+YWx0ZXJuYXRpdmUiKSxpKCJMYWJlbGVkU3RhdGVtZW50IixhZSwibGFiZWw+bGFiZWwsIGJvZHk+Ym9keSIpLGkoIkJyZWFrU3RhdGVtZW50IixxZSwibGFiZWw+bGFiZWwiKSxpKCJDb250aW51ZVN0YXRlbWVudCIsTWUsImxhYmVsPmxhYmVsIiksaSgiV2l0aFN0YXRlbWVudCIsRGUsIm9iamVjdD5leHByZXNzaW9uLCBib2R5PmJvZHkiKSxpKCJTd2l0Y2hTdGF0ZW1lbnQiLE5lLCJkaXNjcmltaW5hbnQ+ZXhwcmVzc2lvbiwgY2FzZXNAYm9keSIpLGkoIlJldHVyblN0YXRlbWVudCIsVGUsImFyZ3VtZW50PnZhbHVlIiksaSgiVGhyb3dTdGF0ZW1lbnQiLCRlLCJhcmd1bWVudD52YWx1ZSIpLGkoIldoaWxlU3RhdGVtZW50IixsZSwidGVzdD5jb25kaXRpb24sIGJvZHk+Ym9keSIpLGkoIkRvV2hpbGVTdGF0ZW1lbnQiLGZlLCJ0ZXN0PmNvbmRpdGlvbiwgYm9keT5ib2R5IiksaSgiRm9yU3RhdGVtZW50IixwZSwiaW5pdD5pbml0LCB0ZXN0PmNvbmRpdGlvbiwgdXBkYXRlPnN0ZXAsIGJvZHk+Ym9keSIpLGkoIkZvckluU3RhdGVtZW50IixkZSwibGVmdD5pbml0LCByaWdodD5vYmplY3QsIGJvZHk+Ym9keSIpLGkoIkRlYnVnZ2VyU3RhdGVtZW50IixlZSksaSgiVmFyaWFibGVEZWNsYXJhdG9yIixaZSwiaWQ+bmFtZSwgaW5pdD52YWx1ZSIpLGkoIkNhdGNoQ2xhdXNlIixVZSwicGFyYW0+YXJnbmFtZSwgYm9keSVib2R5IiksaSgiVGhpc0V4cHJlc3Npb24iLFBuKSxpKCJCaW5hcnlFeHByZXNzaW9uIixzbiwib3BlcmF0b3I9b3BlcmF0b3IsIGxlZnQ+bGVmdCwgcmlnaHQ+cmlnaHQiKSxpKCJMb2dpY2FsRXhwcmVzc2lvbiIsc24sIm9wZXJhdG9yPW9wZXJhdG9yLCBsZWZ0PmxlZnQsIHJpZ2h0PnJpZ2h0IiksaSgiQXNzaWdubWVudEV4cHJlc3Npb24iLGZuLCJvcGVyYXRvcj1vcGVyYXRvciwgbGVmdD5sZWZ0LCByaWdodD5yaWdodCIpLGkoIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIsY24sInRlc3Q+Y29uZGl0aW9uLCBjb25zZXF1ZW50PmNvbnNlcXVlbnQsIGFsdGVybmF0ZT5hbHRlcm5hdGl2ZSIpLGkoIk5ld0V4cHJlc3Npb24iLFFlLCJjYWxsZWU+ZXhwcmVzc2lvbiwgYXJndW1lbnRzQGFyZ3MiKSxpKCJDYWxsRXhwcmVzc2lvbiIsS2UsImNhbGxlZT5leHByZXNzaW9uLCBhcmd1bWVudHNAYXJncyIpLGEodmUsZnVuY3Rpb24oZSl7cmV0dXJue3R5cGU6IlByb2dyYW0iLGJvZHk6ZS5ib2R5Lm1hcChzKX19KSxhKEZlLGZ1bmN0aW9uKGUpe3JldHVybnt0eXBlOiJGdW5jdGlvbkRlY2xhcmF0aW9uIixpZDpzKGUubmFtZSkscGFyYW1zOmUuYXJnbmFtZXMubWFwKHMpLGJvZHk6YyhlKX19KSxhKEVlLGZ1bmN0aW9uKGUpe3JldHVybnt0eXBlOiJGdW5jdGlvbkV4cHJlc3Npb24iLGlkOnMoZS5uYW1lKSxwYXJhbXM6ZS5hcmduYW1lcy5tYXAocyksYm9keTpjKGUpfX0pLGEobmUsZnVuY3Rpb24oZSl7cmV0dXJue3R5cGU6IkV4cHJlc3Npb25TdGF0ZW1lbnQiLGV4cHJlc3Npb246e3R5cGU6IkxpdGVyYWwiLHZhbHVlOmUudmFsdWV9fX0pLGEodGUsZnVuY3Rpb24oZSl7cmV0dXJue3R5cGU6IkV4cHJlc3Npb25TdGF0ZW1lbnQiLGV4cHJlc3Npb246cyhlLmJvZHkpfX0pLGEoamUsZnVuY3Rpb24oZSl7cmV0dXJue3R5cGU6IlN3aXRjaENhc2UiLHRlc3Q6cyhlLmV4cHJlc3Npb24pLGNvbnNlcXVlbnQ6ZS5ib2R5Lm1hcChzKX19KSxhKFBlLGZ1bmN0aW9uKGUpe3JldHVybnt0eXBlOiJUcnlTdGF0ZW1lbnQiLGJsb2NrOmMoZSksaGFuZGxlcjpzKGUuYmNhdGNoKSxndWFyZGVkSGFuZGxlcnM6W10sZmluYWxpemVyOnMoZS5iZmluYWxseSl9fSksYShVZSxmdW5jdGlvbihlKXtyZXR1cm57dHlwZToiQ2F0Y2hDbGF1c2UiLHBhcmFtOnMoZS5hcmduYW1lKSxndWFyZDpudWxsLGJvZHk6YyhlKX19KSxhKExlLGZ1bmN0aW9uKGUpe3JldHVybnt0eXBlOiJWYXJpYWJsZURlY2xhcmF0aW9uIixraW5kOmUgaW5zdGFuY2VvZiBZZT8iY29uc3QiOiJ2YXIiLGRlY2xhcmF0aW9uczplLmRlZmluaXRpb25zLm1hcChzKX19KSxhKGVuLGZ1bmN0aW9uKGUpe3JldHVybnt0eXBlOiJTZXF1ZW5jZUV4cHJlc3Npb24iLGV4cHJlc3Npb25zOmUudG9fYXJyYXkoKS5tYXAocyl9fSksYShubixmdW5jdGlvbihlKXt2YXIgbj1lIGluc3RhbmNlb2Ygcm47cmV0dXJue3R5cGU6Ik1lbWJlckV4cHJlc3Npb24iLG9iamVjdDpzKGUuZXhwcmVzc2lvbiksY29tcHV0ZWQ6bixwcm9wZXJ0eTpuP3MoZS5wcm9wZXJ0eSk6e3R5cGU6IklkZW50aWZpZXIiLG5hbWU6ZS5wcm9wZXJ0eX19fSksYShvbixmdW5jdGlvbihlKXtyZXR1cm57dHlwZToiKysiPT1lLm9wZXJhdG9yfHwiLS0iPT1lLm9wZXJhdG9yPyJVcGRhdGVFeHByZXNzaW9uIjoiVW5hcnlFeHByZXNzaW9uIixvcGVyYXRvcjplLm9wZXJhdG9yLHByZWZpeDplIGluc3RhbmNlb2YgdW4sYXJndW1lbnQ6cyhlLmV4cHJlc3Npb24pfX0pLGEoc24sZnVuY3Rpb24oZSl7cmV0dXJue3R5cGU6IiYmIj09ZS5vcGVyYXRvcnx8Inx8Ij09ZS5vcGVyYXRvcj8iTG9naWNhbEV4cHJlc3Npb24iOiJCaW5hcnlFeHByZXNzaW9uIixsZWZ0OnMoZS5sZWZ0KSxvcGVyYXRvcjplLm9wZXJhdG9yLHJpZ2h0OnMoZS5yaWdodCl9fSksYShsbixmdW5jdGlvbihlKXtyZXR1cm57dHlwZToiQXJyYXlFeHByZXNzaW9uIixlbGVtZW50czplLmVsZW1lbnRzLm1hcChzKX19KSxhKHBuLGZ1bmN0aW9uKGUpe3JldHVybnt0eXBlOiJPYmplY3RFeHByZXNzaW9uIixwcm9wZXJ0aWVzOmUucHJvcGVydGllcy5tYXAocyl9fSksYShkbixmdW5jdGlvbihlKXt2YXIgbix0PVQoZS5rZXkpP3t0eXBlOiJJZGVudGlmaWVyIixuYW1lOmUua2V5fTp7dHlwZToiTGl0ZXJhbCIsdmFsdWU6ZS5rZXl9O3JldHVybiBlIGluc3RhbmNlb2YgaG4/bj0iaW5pdCI6ZSBpbnN0YW5jZW9mIG1uP249ImdldCI6ZSBpbnN0YW5jZW9mIERuJiYobj0ic2V0Iikse3R5cGU6IlByb3BlcnR5IixraW5kOm4sa2V5OnQsdmFsdWU6cyhlLnZhbHVlKX19KSxhKGJuLGZ1bmN0aW9uKGUpe3ZhciBuPWUuZGVmaW5pdGlvbigpO3JldHVybnt0eXBlOiJJZGVudGlmaWVyIixuYW1lOm4/bi5tYW5nbGVkX25hbWV8fG4ubmFtZTplLm5hbWV9fSksYShXbixmdW5jdGlvbihlKXt2YXIgbj1lLnZhbHVlO3JldHVybnt0eXBlOiJMaXRlcmFsIix2YWx1ZTpuLHJhdzpuLnRvU3RyaW5nKCkscmVnZXg6e3BhdHRlcm46bi5zb3VyY2UsZmxhZ3M6bi50b1N0cmluZygpLm1hdGNoKC9bZ2ltdXldKiQvKVswXX19fSksYShSbixmdW5jdGlvbihlKXt2YXIgbj1lLnZhbHVlO3JldHVybiJudW1iZXIiPT10eXBlb2YgbiYmKG48MHx8MD09PW4mJjEvbjwwKT97dHlwZToiVW5hcnlFeHByZXNzaW9uIixvcGVyYXRvcjoiLSIscHJlZml4OiEwLGFyZ3VtZW50Ont0eXBlOiJMaXRlcmFsIix2YWx1ZTotbixyYXc6ZS5zdGFydC5yYXd9fTp7dHlwZToiTGl0ZXJhbCIsdmFsdWU6bixyYXc6ZS5zdGFydC5yYXd9fSksYShZbixmdW5jdGlvbihlKXtyZXR1cm57dHlwZToiSWRlbnRpZmllciIsbmFtZTpTdHJpbmcoZS52YWx1ZSl9fSksUW4uREVGTUVUSE9EKCJ0b19tb3ppbGxhX2FzdCIsUm4ucHJvdG90eXBlLnRvX21vemlsbGFfYXN0KSxYbi5ERUZNRVRIT0QoInRvX21vemlsbGFfYXN0IixSbi5wcm90b3R5cGUudG9fbW96aWxsYV9hc3QpLFpuLkRFRk1FVEhPRCgidG9fbW96aWxsYV9hc3QiLGZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9KSxyZS5ERUZNRVRIT0QoInRvX21vemlsbGFfYXN0IixpZS5wcm90b3R5cGUudG9fbW96aWxsYV9hc3QpLHllLkRFRk1FVEhPRCgidG9fbW96aWxsYV9hc3QiLEVlLnByb3RvdHlwZS50b19tb3ppbGxhX2FzdCk7dmFyIHA9bnVsbDtLLmZyb21fbW96aWxsYV9hc3Q9ZnVuY3Rpb24oZSl7dmFyIG49cDtwPVtdO3ZhciB0PW8oZSk7cmV0dXJuIHA9bix0fX0oKSxlLkNvbXByZXNzb3I9VyxlLkRlZmF1bHRzRXJyb3I9YSxlLkRpY3Rpb25hcnk9ZyxlLkpTX1BhcnNlX0Vycm9yPXosZS5NQVA9SixlLk91dHB1dFN0cmVhbT1WLGUuU291cmNlTWFwPVksZS5UcmVlVHJhbnNmb3JtZXI9UCxlLlRyZWVXYWxrZXI9QSxlLmJhc2U1ND1rdCxlLmRlZmF1bHRzPXMsZS5tYW5nbGVfcHJvcGVydGllcz1HLGUubWVyZ2U9YyxlLnBhcnNlPUksZS5wdXNoX3VuaXE9ZCxlLnN0cmluZ190ZW1wbGF0ZT1oLGUudG9rZW5pemVyPUgsZS5pc19pZGVudGlmaWVyPVQsZS5TeW1ib2xEZWY9VSwidW5kZWZpbmVkIiE9dHlwZW9mIERFQlVHJiZERUJVRyYmKGUuRVhQRUNUX0RJUkVDVElWRT14dCksbi5VZ2xpZnlKUz1lfSh7fSxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpKTs="},"underscore.js": {"content_type": "text/javascript","data": "LypVbmRlcnNjb3JlIDEuNyovCihmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXtmb3IodmFyIG49RS5sZW5ndGgscj0iZnVuY3Rpb24iPT10eXBlb2YgZS5jb25zdHJ1Y3Rvcj9hOmk7bi0tOyl7dmFyIG89RVtuXTsoImNvbnN0cnVjdG9yIj09PW8/bS5oYXMoZSxvKTpvIGluIGUmJmVbb10hPT1yW29dJiYhbS5jb250YWlucyh0LG8pKSYmdC5wdXNoKG8pfX12YXIgdD10aGlzLG49dC5fLHI9QXJyYXkucHJvdG90eXBlLGk9T2JqZWN0LnByb3RvdHlwZSxhPUZ1bmN0aW9uLnByb3RvdHlwZSxvPXIucHVzaCxzPXIuc2xpY2UsdT1pLnRvU3RyaW5nLGM9aS5oYXNPd25Qcm9wZXJ0eSxsPUFycmF5LmlzQXJyYXksZj1PYmplY3Qua2V5cyxkPWEuYmluZCxoPU9iamVjdC5jcmVhdGUscD1mdW5jdGlvbigpe30sbT1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIG0/ZTp0aGlzIGluc3RhbmNlb2YgbT92b2lkKHRoaXMuX3dyYXBwZWQ9ZSk6bmV3IG0oZSl9OyJ1bmRlZmluZWQiIT10eXBlb2YgZXhwb3J0cz8oInVuZGVmaW5lZCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzJiYoZXhwb3J0cz1tb2R1bGUuZXhwb3J0cz1tKSxleHBvcnRzLl89bSk6dC5fPW0sbS5WRVJTSU9OPSIxLjcuMCI7dmFyIGc9ZnVuY3Rpb24oZSx0LG4pe2lmKHZvaWQgMD09PXQpcmV0dXJuIGU7c3dpdGNoKG51bGw9PW4/MzpuKXtjYXNlIDE6cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBlLmNhbGwodCxuKX07Y2FzZSAyOnJldHVybiBmdW5jdGlvbihuLHIpe3JldHVybiBlLmNhbGwodCxuLHIpfTtjYXNlIDM6cmV0dXJuIGZ1bmN0aW9uKG4scixpKXtyZXR1cm4gZS5jYWxsKHQsbixyLGkpfTtjYXNlIDQ6cmV0dXJuIGZ1bmN0aW9uKG4scixpLGEpe3JldHVybiBlLmNhbGwodCxuLHIsaSxhKX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGUuYXBwbHkodCxhcmd1bWVudHMpfX0sdj1mdW5jdGlvbihlLHQsbil7cmV0dXJuIG51bGw9PWU/bS5pZGVudGl0eTptLmlzRnVuY3Rpb24oZSk/ZyhlLHQsbik6bS5pc09iamVjdChlKT9tLm1hdGNoZXMoZSk6bS5wcm9wZXJ0eShlKX07bS5pdGVyYXRlZT1mdW5jdGlvbihlLHQpe3JldHVybiB2KGUsdCwxLzApfTt2YXIgeT1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIG49YXJndW1lbnRzLmxlbmd0aDtpZigyPm58fG51bGw9PXQpcmV0dXJuIHQ7Zm9yKHZhciByPTA7bj5yO3IrKylmb3IodmFyIGk9YXJndW1lbnRzW3JdLGE9ZShpKSxvPWEubGVuZ3RoLHM9MDtvPnM7cysrKXt2YXIgdT1hW3NdO3RbdV09aVt1XX1yZXR1cm4gdH19LGI9ZnVuY3Rpb24oZSl7aWYoIW0uaXNPYmplY3QoZSkpcmV0dXJue307aWYoaClyZXR1cm4gaChlKTtwLnByb3RvdHlwZT1lO3ZhciB0PW5ldyBwO3JldHVybiBwLnByb3RvdHlwZT1udWxsLHR9O20uZWFjaD1tLmZvckVhY2g9ZnVuY3Rpb24oZSx0LG4pe2lmKG51bGw9PWUpcmV0dXJuIGU7dD1nKHQsbik7dmFyIHIsaT1lLmxlbmd0aDtpZihpPT09K2kpZm9yKHI9MDtpPnI7cisrKXQoZVtyXSxyLGUpO2Vsc2V7dmFyIGE9bS5rZXlzKGUpO2ZvcihyPTAsaT1hLmxlbmd0aDtpPnI7cisrKXQoZVthW3JdXSxhW3JdLGUpfXJldHVybiBlfSxtLm1hcD1tLmNvbGxlY3Q9ZnVuY3Rpb24oZSx0LG4pe2lmKG51bGw9PWUpcmV0dXJuW107dD12KHQsbik7Zm9yKHZhciByLGk9ZS5sZW5ndGghPT0rZS5sZW5ndGgmJm0ua2V5cyhlKSxhPShpfHxlKS5sZW5ndGgsbz1BcnJheShhKSxzPTA7YT5zO3MrKylyPWk/aVtzXTpzLG9bc109dChlW3JdLHIsZSk7cmV0dXJuIG99O3ZhciBrPSJSZWR1Y2Ugb2YgZW1wdHkgYXJyYXkgd2l0aCBubyBpbml0aWFsIHZhbHVlIjttLnJlZHVjZT1tLmZvbGRsPW0uaW5qZWN0PWZ1bmN0aW9uKGUsdCxuLHIpe251bGw9PWUmJihlPVtdKSx0PWcodCxyLDQpO3ZhciBpLGE9ZS5sZW5ndGghPT0rZS5sZW5ndGgmJm0ua2V5cyhlKSxvPShhfHxlKS5sZW5ndGgscz0wO2lmKGFyZ3VtZW50cy5sZW5ndGg8Myl7aWYoIW8pdGhyb3cgbmV3IFR5cGVFcnJvcihrKTtuPWVbYT9hW3MrK106cysrXX1mb3IoO28+cztzKyspaT1hP2Fbc106cyxuPXQobixlW2ldLGksZSk7cmV0dXJuIG59LG0ucmVkdWNlUmlnaHQ9bS5mb2xkcj1mdW5jdGlvbihlLHQsbixyKXtudWxsPT1lJiYoZT1bXSksdD1nKHQsciw0KTt2YXIgaSxhPWUubGVuZ3RoIT09K2UubGVuZ3RoJiZtLmtleXMoZSksbz0oYXx8ZSkubGVuZ3RoO2lmKGFyZ3VtZW50cy5sZW5ndGg8Myl7aWYoIW8pdGhyb3cgbmV3IFR5cGVFcnJvcihrKTtuPWVbYT9hWy0tb106LS1vXX1mb3IoO28tLTspaT1hP2Fbb106byxuPXQobixlW2ldLGksZSk7cmV0dXJuIG59LG0uZmluZD1tLmRldGVjdD1mdW5jdGlvbihlLHQsbil7dmFyIHI7cmV0dXJuIHI9ZS5sZW5ndGg9PT0rZS5sZW5ndGg/bS5maW5kSW5kZXgoZSx0LG4pOm0uZmluZEtleShlLHQsbiksdm9pZCAwIT09ciYmLTEhPT1yP2Vbcl06dm9pZCAwfSxtLmZpbHRlcj1tLnNlbGVjdD1mdW5jdGlvbihlLHQsbil7dmFyIHI9W107cmV0dXJuIG51bGw9PWU/cjoodD12KHQsbiksbS5lYWNoKGUsZnVuY3Rpb24oZSxuLGkpe3QoZSxuLGkpJiZyLnB1c2goZSl9KSxyKX0sbS5yZWplY3Q9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBtLmZpbHRlcihlLG0ubmVnYXRlKHYodCkpLG4pfSxtLmV2ZXJ5PW0uYWxsPWZ1bmN0aW9uKGUsdCxuKXtpZihudWxsPT1lKXJldHVybiEwO3Q9dih0LG4pO3ZhciByLGksYT1lLmxlbmd0aCE9PStlLmxlbmd0aCYmbS5rZXlzKGUpLG89KGF8fGUpLmxlbmd0aDtmb3Iocj0wO28+cjtyKyspaWYoaT1hP2Fbcl06ciwhdChlW2ldLGksZSkpcmV0dXJuITE7cmV0dXJuITB9LG0uc29tZT1tLmFueT1mdW5jdGlvbihlLHQsbil7aWYobnVsbD09ZSlyZXR1cm4hMTt0PXYodCxuKTt2YXIgcixpLGE9ZS5sZW5ndGghPT0rZS5sZW5ndGgmJm0ua2V5cyhlKSxvPShhfHxlKS5sZW5ndGg7Zm9yKHI9MDtvPnI7cisrKWlmKGk9YT9hW3JdOnIsdChlW2ldLGksZSkpcmV0dXJuITA7cmV0dXJuITF9LG0uY29udGFpbnM9bS5pbmNsdWRlcz1tLmluY2x1ZGU9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBudWxsPT1lPyExOihlLmxlbmd0aCE9PStlLmxlbmd0aCYmKGU9bS52YWx1ZXMoZSkpLG0uaW5kZXhPZihlLHQsIm51bWJlciI9PXR5cGVvZiBuJiZuKT49MCl9LG0uaW52b2tlPWZ1bmN0aW9uKGUsdCl7dmFyIG49cy5jYWxsKGFyZ3VtZW50cywyKSxyPW0uaXNGdW5jdGlvbih0KTtyZXR1cm4gbS5tYXAoZSxmdW5jdGlvbihlKXtyZXR1cm4ocj90OmVbdF0pLmFwcGx5KGUsbil9KX0sbS5wbHVjaz1mdW5jdGlvbihlLHQpe3JldHVybiBtLm1hcChlLG0ucHJvcGVydHkodCkpfSxtLndoZXJlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIG0uZmlsdGVyKGUsbS5tYXRjaGVzKHQpKX0sbS5maW5kV2hlcmU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbS5maW5kKGUsbS5tYXRjaGVzKHQpKX0sbS5tYXg9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksYT0tMS8wLG89LTEvMDtpZihudWxsPT10JiZudWxsIT1lKXtlPWUubGVuZ3RoPT09K2UubGVuZ3RoP2U6bS52YWx1ZXMoZSk7Zm9yKHZhciBzPTAsdT1lLmxlbmd0aDt1PnM7cysrKXI9ZVtzXSxyPmEmJihhPXIpfWVsc2UgdD12KHQsbiksbS5lYWNoKGUsZnVuY3Rpb24oZSxuLHIpe2k9dChlLG4sciksKGk+b3x8aT09PS0xLzAmJmE9PT0tMS8wKSYmKGE9ZSxvPWkpfSk7cmV0dXJuIGF9LG0ubWluPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpLGE9MS8wLG89MS8wO2lmKG51bGw9PXQmJm51bGwhPWUpe2U9ZS5sZW5ndGg9PT0rZS5sZW5ndGg/ZTptLnZhbHVlcyhlKTtmb3IodmFyIHM9MCx1PWUubGVuZ3RoO3U+cztzKyspcj1lW3NdLGE+ciYmKGE9cil9ZWxzZSB0PXYodCxuKSxtLmVhY2goZSxmdW5jdGlvbihlLG4scil7aT10KGUsbixyKSwobz5pfHwxLzA9PT1pJiYxLzA9PT1hKSYmKGE9ZSxvPWkpfSk7cmV0dXJuIGF9LG0uc2h1ZmZsZT1mdW5jdGlvbihlKXtmb3IodmFyIHQsbj1lJiZlLmxlbmd0aD09PStlLmxlbmd0aD9lOm0udmFsdWVzKGUpLHI9bi5sZW5ndGgsaT1BcnJheShyKSxhPTA7cj5hO2ErKyl0PW0ucmFuZG9tKDAsYSksdCE9PWEmJihpW2FdPWlbdF0pLGlbdF09blthXTtyZXR1cm4gaX0sbS5zYW1wbGU9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBudWxsPT10fHxuPyhlLmxlbmd0aCE9PStlLmxlbmd0aCYmKGU9bS52YWx1ZXMoZSkpLGVbbS5yYW5kb20oZS5sZW5ndGgtMSldKTptLnNodWZmbGUoZSkuc2xpY2UoMCxNYXRoLm1heCgwLHQpKX0sbS5zb3J0Qnk9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiB0PXYodCxuKSxtLnBsdWNrKG0ubWFwKGUsZnVuY3Rpb24oZSxuLHIpe3JldHVybnt2YWx1ZTplLGluZGV4Om4sY3JpdGVyaWE6dChlLG4scil9fSkuc29ydChmdW5jdGlvbihlLHQpe3ZhciBuPWUuY3JpdGVyaWEscj10LmNyaXRlcmlhO2lmKG4hPT1yKXtpZihuPnJ8fHZvaWQgMD09PW4pcmV0dXJuIDE7aWYocj5ufHx2b2lkIDA9PT1yKXJldHVybi0xfXJldHVybiBlLmluZGV4LXQuaW5kZXh9KSwidmFsdWUiKX07dmFyIHc9ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQsbixyKXt2YXIgaT17fTtyZXR1cm4gbj12KG4sciksbS5lYWNoKHQsZnVuY3Rpb24ocixhKXt2YXIgbz1uKHIsYSx0KTtlKGkscixvKX0pLGl9fTttLmdyb3VwQnk9dyhmdW5jdGlvbihlLHQsbil7bS5oYXMoZSxuKT9lW25dLnB1c2godCk6ZVtuXT1bdF19KSxtLmluZGV4Qnk9dyhmdW5jdGlvbihlLHQsbil7ZVtuXT10fSksbS5jb3VudEJ5PXcoZnVuY3Rpb24oZSx0LG4pe20uaGFzKGUsbik/ZVtuXSsrOmVbbl09MX0pLG0uc29ydGVkSW5kZXg9ZnVuY3Rpb24oZSx0LG4scil7bj12KG4sciwxKTtmb3IodmFyIGk9bih0KSxhPTAsbz1lLmxlbmd0aDtvPmE7KXt2YXIgcz1hK28+Pj4xO24oZVtzXSk8aT9hPXMrMTpvPXN9cmV0dXJuIGF9LG0udG9BcnJheT1mdW5jdGlvbihlKXtyZXR1cm4gZT9tLmlzQXJyYXkoZSk/cy5jYWxsKGUpOmUubGVuZ3RoPT09K2UubGVuZ3RoP20ubWFwKGUsbS5pZGVudGl0eSk6bS52YWx1ZXMoZSk6W119LG0uc2l6ZT1mdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09ZT8wOmUubGVuZ3RoPT09K2UubGVuZ3RoP2UubGVuZ3RoOm0ua2V5cyhlKS5sZW5ndGh9LG0ucGFydGl0aW9uPWZ1bmN0aW9uKGUsdCxuKXt0PXYodCxuKTt2YXIgcj1bXSxpPVtdO3JldHVybiBtLmVhY2goZSxmdW5jdGlvbihlLG4sYSl7KHQoZSxuLGEpP3I6aSkucHVzaChlKX0pLFtyLGldfSxtLmZpcnN0PW0uaGVhZD1tLnRha2U9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBudWxsPT1lP3ZvaWQgMDpudWxsPT10fHxuP2VbMF06bS5pbml0aWFsKGUsZS5sZW5ndGgtdCl9LG0uaW5pdGlhbD1mdW5jdGlvbihlLHQsbil7cmV0dXJuIHMuY2FsbChlLDAsTWF0aC5tYXgoMCxlLmxlbmd0aC0obnVsbD09dHx8bj8xOnQpKSl9LG0ubGFzdD1mdW5jdGlvbihlLHQsbil7cmV0dXJuIG51bGw9PWU/dm9pZCAwOm51bGw9PXR8fG4/ZVtlLmxlbmd0aC0xXTptLnJlc3QoZSxNYXRoLm1heCgwLGUubGVuZ3RoLXQpKX0sbS5yZXN0PW0udGFpbD1tLmRyb3A9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBzLmNhbGwoZSxudWxsPT10fHxuPzE6dCl9LG0uY29tcGFjdD1mdW5jdGlvbihlKXtyZXR1cm4gbS5maWx0ZXIoZSxtLmlkZW50aXR5KX07dmFyIHg9ZnVuY3Rpb24oZSx0LG4scil7Zm9yKHZhciBpLGE9W10sbz0wLHM9cnx8MCx1PWUmJmUubGVuZ3RoO3U+cztzKyspaWYoaT1lW3NdLGkmJmkubGVuZ3RoPj0wJiYobS5pc0FycmF5KGkpfHxtLmlzQXJndW1lbnRzKGkpKSl7dHx8KGk9eChpLHQsbikpO3ZhciBjPTAsbD1pLmxlbmd0aDtmb3IoYS5sZW5ndGgrPWw7bD5jOylhW28rK109aVtjKytdfWVsc2Ugbnx8KGFbbysrXT1pKTtyZXR1cm4gYX07bS5mbGF0dGVuPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHgoZSx0LCExKX0sbS53aXRob3V0PWZ1bmN0aW9uKGUpe3JldHVybiBtLmRpZmZlcmVuY2UoZSxzLmNhbGwoYXJndW1lbnRzLDEpKX0sbS51bmlxPW0udW5pcXVlPWZ1bmN0aW9uKGUsdCxuLHIpe2lmKG51bGw9PWUpcmV0dXJuW107bS5pc0Jvb2xlYW4odCl8fChyPW4sbj10LHQ9ITEpLG51bGwhPW4mJihuPXYobixyKSk7Zm9yKHZhciBpPVtdLGE9W10sbz0wLHM9ZS5sZW5ndGg7cz5vO28rKyl7dmFyIHU9ZVtvXSxjPW4/bih1LG8sZSk6dTt0PyhvJiZhPT09Y3x8aS5wdXNoKHUpLGE9Yyk6bj9tLmNvbnRhaW5zKGEsYyl8fChhLnB1c2goYyksaS5wdXNoKHUpKTptLmNvbnRhaW5zKGksdSl8fGkucHVzaCh1KX1yZXR1cm4gaX0sbS51bmlvbj1mdW5jdGlvbigpe3JldHVybiBtLnVuaXEoeChhcmd1bWVudHMsITAsITApKX0sbS5pbnRlcnNlY3Rpb249ZnVuY3Rpb24oZSl7aWYobnVsbD09ZSlyZXR1cm5bXTtmb3IodmFyIHQ9W10sbj1hcmd1bWVudHMubGVuZ3RoLHI9MCxpPWUubGVuZ3RoO2k+cjtyKyspe3ZhciBhPWVbcl07aWYoIW0uY29udGFpbnModCxhKSl7Zm9yKHZhciBvPTE7bj5vJiZtLmNvbnRhaW5zKGFyZ3VtZW50c1tvXSxhKTtvKyspO289PT1uJiZ0LnB1c2goYSl9fXJldHVybiB0fSxtLmRpZmZlcmVuY2U9ZnVuY3Rpb24oZSl7dmFyIHQ9eChhcmd1bWVudHMsITAsITAsMSk7cmV0dXJuIG0uZmlsdGVyKGUsZnVuY3Rpb24oZSl7cmV0dXJuIW0uY29udGFpbnModCxlKX0pfSxtLnppcD1mdW5jdGlvbihlKXtpZihudWxsPT1lKXJldHVybltdO2Zvcih2YXIgdD1tLm1heChhcmd1bWVudHMsImxlbmd0aCIpLmxlbmd0aCxuPUFycmF5KHQpO3QtLT4wOyluW3RdPW0ucGx1Y2soYXJndW1lbnRzLHQpO3JldHVybiBufSxtLnVuemlwPWZ1bmN0aW9uKGUpe3JldHVybiBtLnppcC5hcHBseShudWxsLGUpfSxtLm9iamVjdD1mdW5jdGlvbihlLHQpe2lmKG51bGw9PWUpcmV0dXJue307Zm9yKHZhciBuPXt9LHI9MCxpPWUubGVuZ3RoO2k+cjtyKyspdD9uW2Vbcl1dPXRbcl06bltlW3JdWzBdXT1lW3JdWzFdO3JldHVybiBufSxtLmluZGV4T2Y9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPTAsaT1lJiZlLmxlbmd0aDtpZigibnVtYmVyIj09dHlwZW9mIG4pcj0wPm4/TWF0aC5tYXgoMCxpK24pOm47ZWxzZSBpZihuJiZpKXJldHVybiByPW0uc29ydGVkSW5kZXgoZSx0KSxlW3JdPT09dD9yOi0xO2Zvcig7aT5yO3IrKylpZihlW3JdPT09dClyZXR1cm4gcjtyZXR1cm4tMX0sbS5sYXN0SW5kZXhPZj1mdW5jdGlvbihlLHQsbil7dmFyIHI9ZT9lLmxlbmd0aDowO2ZvcigibnVtYmVyIj09dHlwZW9mIG4mJihyPTA+bj9yK24rMTpNYXRoLm1pbihyLG4rMSkpOy0tcj49MDspaWYoZVtyXT09PXQpcmV0dXJuIHI7cmV0dXJuLTF9LG0uZmluZEluZGV4PWZ1bmN0aW9uKGUsdCxuKXt0PXYodCxuKTtmb3IodmFyIHI9bnVsbCE9ZT9lLmxlbmd0aDowLGk9MDtyPmk7aSsrKWlmKHQoZVtpXSxpLGUpKXJldHVybiBpO3JldHVybi0xfSxtLnJhbmdlPWZ1bmN0aW9uKGUsdCxuKXthcmd1bWVudHMubGVuZ3RoPD0xJiYodD1lfHwwLGU9MCksbj1ufHwxO2Zvcih2YXIgcj1NYXRoLm1heChNYXRoLmNlaWwoKHQtZSkvbiksMCksaT1BcnJheShyKSxhPTA7cj5hO2ErKyxlKz1uKWlbYV09ZTtyZXR1cm4gaX07dmFyIF89ZnVuY3Rpb24oZSx0LG4scixpKXtpZighKHIgaW5zdGFuY2VvZiB0KSlyZXR1cm4gZS5hcHBseShuLGkpO3ZhciBhPWIoZS5wcm90b3R5cGUpLG89ZS5hcHBseShhLGkpO3JldHVybiBtLmlzT2JqZWN0KG8pP286YX07bS5iaW5kPWZ1bmN0aW9uKGUsdCl7aWYoZCYmZS5iaW5kPT09ZClyZXR1cm4gZC5hcHBseShlLHMuY2FsbChhcmd1bWVudHMsMSkpO2lmKCFtLmlzRnVuY3Rpb24oZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQmluZCBtdXN0IGJlIGNhbGxlZCBvbiBhIGZ1bmN0aW9uIik7dmFyIG49cy5jYWxsKGFyZ3VtZW50cywyKTtyZXR1cm4gZnVuY3Rpb24gcigpe3JldHVybiBfKGUscix0LHRoaXMsbi5jb25jYXQocy5jYWxsKGFyZ3VtZW50cykpKX19LG0ucGFydGlhbD1mdW5jdGlvbihlKXt2YXIgdD1zLmNhbGwoYXJndW1lbnRzLDEpO3JldHVybiBmdW5jdGlvbiBuKCl7Zm9yKHZhciByPTAsaT10LnNsaWNlKCksYT0wLG89aS5sZW5ndGg7bz5hO2ErKylpW2FdPT09bSYmKGlbYV09YXJndW1lbnRzW3IrK10pO2Zvcig7cjxhcmd1bWVudHMubGVuZ3RoOylpLnB1c2goYXJndW1lbnRzW3IrK10pO3JldHVybiBfKGUsbix0aGlzLHRoaXMsaSl9fSxtLmJpbmRBbGw9ZnVuY3Rpb24oZSl7dmFyIHQsbixyPWFyZ3VtZW50cy5sZW5ndGg7aWYoMT49cil0aHJvdyBuZXcgRXJyb3IoImJpbmRBbGwgbXVzdCBiZSBwYXNzZWQgZnVuY3Rpb24gbmFtZXMiKTtmb3IodD0xO3I+dDt0Kyspbj1hcmd1bWVudHNbdF0sZVtuXT1tLmJpbmQoZVtuXSxlKTtyZXR1cm4gZX0sbS5tZW1vaXplPWZ1bmN0aW9uKGUsdCl7dmFyIG49ZnVuY3Rpb24ocil7dmFyIGk9bi5jYWNoZSxhPSIiKyh0P3QuYXBwbHkodGhpcyxhcmd1bWVudHMpOnIpO3JldHVybiBtLmhhcyhpLGEpfHwoaVthXT1lLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksaVthXX07cmV0dXJuIG4uY2FjaGU9e30sbn0sbS5kZWxheT1mdW5jdGlvbihlLHQpe3ZhciBuPXMuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseShudWxsLG4pfSx0KX0sbS5kZWZlcj1mdW5jdGlvbihlKXtyZXR1cm4gbS5kZWxheS5hcHBseShtLFtlLDFdLmNvbmNhdChzLmNhbGwoYXJndW1lbnRzLDEpKSl9LG0udGhyb3R0bGU9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksYSxvPW51bGwscz0wO258fChuPXt9KTt2YXIgdT1mdW5jdGlvbigpe3M9bi5sZWFkaW5nPT09ITE/MDptLm5vdygpLG89bnVsbCxhPWUuYXBwbHkocixpKSxvfHwocj1pPW51bGwpfTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYz1tLm5vdygpO3N8fG4ubGVhZGluZyE9PSExfHwocz1jKTt2YXIgbD10LShjLXMpO3JldHVybiByPXRoaXMsaT1hcmd1bWVudHMsMD49bHx8bD50PyhvJiYoY2xlYXJUaW1lb3V0KG8pLG89bnVsbCkscz1jLGE9ZS5hcHBseShyLGkpLG98fChyPWk9bnVsbCkpOm98fG4udHJhaWxpbmc9PT0hMXx8KG89c2V0VGltZW91dCh1LGwpKSxhfX0sbS5kZWJvdW5jZT1mdW5jdGlvbihlLHQsbil7dmFyIHIsaSxhLG8scyx1PWZ1bmN0aW9uKCl7dmFyIGM9bS5ub3coKS1vO3Q+YyYmYz49MD9yPXNldFRpbWVvdXQodSx0LWMpOihyPW51bGwsbnx8KHM9ZS5hcHBseShhLGkpLHJ8fChhPWk9bnVsbCkpKX07cmV0dXJuIGZ1bmN0aW9uKCl7YT10aGlzLGk9YXJndW1lbnRzLG89bS5ub3coKTt2YXIgYz1uJiYhcjtyZXR1cm4gcnx8KHI9c2V0VGltZW91dCh1LHQpKSxjJiYocz1lLmFwcGx5KGEsaSksYT1pPW51bGwpLHN9fSxtLndyYXA9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbS5wYXJ0aWFsKHQsZSl9LG0ubmVnYXRlPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiFlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19LG0uY29tcG9zZT1mdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cyx0PWUubGVuZ3RoLTE7cmV0dXJuIGZ1bmN0aW9uKCl7Zm9yKHZhciBuPXQscj1lW3RdLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtuLS07KXI9ZVtuXS5jYWxsKHRoaXMscik7cmV0dXJuIHJ9fSxtLmFmdGVyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuLS1lPDE/dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dm9pZCAwfX0sbS5iZWZvcmU9ZnVuY3Rpb24oZSx0KXt2YXIgbjtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4tLWU+MCYmKG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cykpLDE+PWUmJih0PW51bGwpLG59fSxtLm9uY2U9bS5wYXJ0aWFsKG0uYmVmb3JlLDIpO3ZhciBTPSF7dG9TdHJpbmc6bnVsbH0ucHJvcGVydHlJc0VudW1lcmFibGUoInRvU3RyaW5nIiksRT1bImNvbnN0cnVjdG9yIiwidmFsdWVPZiIsImlzUHJvdG90eXBlT2YiLCJ0b1N0cmluZyIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwiaGFzT3duUHJvcGVydHkiLCJ0b0xvY2FsZVN0cmluZyJdO20ua2V5cz1mdW5jdGlvbih0KXtpZighbS5pc09iamVjdCh0KSlyZXR1cm5bXTtpZihmKXJldHVybiBmKHQpO3ZhciBuPVtdO2Zvcih2YXIgciBpbiB0KW0uaGFzKHQscikmJm4ucHVzaChyKTtyZXR1cm4gUyYmZSh0LG4pLG59LG0ua2V5c0luPWZ1bmN0aW9uKHQpe2lmKCFtLmlzT2JqZWN0KHQpKXJldHVybltdO3ZhciBuPVtdO2Zvcih2YXIgciBpbiB0KW4ucHVzaChyKTtyZXR1cm4gUyYmZSh0LG4pLG59LG0udmFsdWVzPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1tLmtleXMoZSksbj10Lmxlbmd0aCxyPUFycmF5KG4pLGk9MDtuPmk7aSsrKXJbaV09ZVt0W2ldXTtyZXR1cm4gcn0sbS5wYWlycz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9bS5rZXlzKGUpLG49dC5sZW5ndGgscj1BcnJheShuKSxpPTA7bj5pO2krKylyW2ldPVt0W2ldLGVbdFtpXV1dO3JldHVybiByfSxtLmludmVydD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9e30sbj1tLmtleXMoZSkscj0wLGk9bi5sZW5ndGg7aT5yO3IrKyl0W2VbbltyXV1dPW5bcl07cmV0dXJuIHR9LG0uZnVuY3Rpb25zPW0ubWV0aG9kcz1mdW5jdGlvbihlKXt2YXIgdD1bXTtmb3IodmFyIG4gaW4gZSltLmlzRnVuY3Rpb24oZVtuXSkmJnQucHVzaChuKTtyZXR1cm4gdC5zb3J0KCl9LG0uZXh0ZW5kPXkobS5rZXlzSW4pLG0uYXNzaWduPXkobS5rZXlzKSxtLmZpbmRLZXk9ZnVuY3Rpb24oZSx0LG4pe3Q9dih0LG4pO2Zvcih2YXIgcixpPW0ua2V5cyhlKSxhPTAsbz1pLmxlbmd0aDtvPmE7YSsrKWlmKHI9aVthXSx0KGVbcl0scixlKSlyZXR1cm4gcn0sbS5waWNrPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpPXt9O2lmKG51bGw9PWUpcmV0dXJuIGk7aWYobS5pc0Z1bmN0aW9uKHQpKXt0PWcodCxuKTtmb3IociBpbiBlKXt2YXIgYT1lW3JdO3QoYSxyLGUpJiYoaVtyXT1hKX19ZWxzZXt2YXIgbz14KGFyZ3VtZW50cywhMSwhMSwxKTtlPW5ldyBPYmplY3QoZSk7Zm9yKHZhciBzPTAsdT1vLmxlbmd0aDt1PnM7cysrKXI9b1tzXSxyIGluIGUmJihpW3JdPWVbcl0pfXJldHVybiBpfSxtLm9taXQ9ZnVuY3Rpb24oZSx0LG4pe2lmKG0uaXNGdW5jdGlvbih0KSl0PW0ubmVnYXRlKHQpO2Vsc2V7dmFyIHI9bS5tYXAoeChhcmd1bWVudHMsITEsITEsMSksU3RyaW5nKTt0PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIW0uY29udGFpbnMocix0KX19cmV0dXJuIG0ucGljayhlLHQsbil9LG0uZGVmYXVsdHM9ZnVuY3Rpb24oZSl7aWYoIW0uaXNPYmplY3QoZSkpcmV0dXJuIGU7Zm9yKHZhciB0PTEsbj1hcmd1bWVudHMubGVuZ3RoO24+dDt0Kyspe3ZhciByPWFyZ3VtZW50c1t0XTtmb3IodmFyIGkgaW4gcil2b2lkIDA9PT1lW2ldJiYoZVtpXT1yW2ldKX1yZXR1cm4gZX0sbS5jcmVhdGU9ZnVuY3Rpb24oZSx0KXt2YXIgbj1iKGUpO3JldHVybiB0JiZtLmFzc2lnbihuLHQpLG59LG0uY2xvbmU9ZnVuY3Rpb24oZSl7cmV0dXJuIG0uaXNPYmplY3QoZSk/bS5pc0FycmF5KGUpP2Uuc2xpY2UoKTptLmV4dGVuZCh7fSxlKTplfSxtLnRhcD1mdW5jdGlvbihlLHQpe3JldHVybiB0KGUpLGV9O3ZhciBDPWZ1bmN0aW9uKGUsdCxuLHIpe2lmKGU9PT10KXJldHVybiAwIT09ZXx8MS9lPT09MS90O2lmKG51bGw9PWV8fG51bGw9PXQpcmV0dXJuIGU9PT10O2UgaW5zdGFuY2VvZiBtJiYoZT1lLl93cmFwcGVkKSx0IGluc3RhbmNlb2YgbSYmKHQ9dC5fd3JhcHBlZCk7dmFyIGk9dS5jYWxsKGUpO2lmKGkhPT11LmNhbGwodCkpcmV0dXJuITE7c3dpdGNoKGkpe2Nhc2UiW29iamVjdCBSZWdFeHBdIjpjYXNlIltvYmplY3QgU3RyaW5nXSI6cmV0dXJuIiIrZT09IiIrdDtjYXNlIltvYmplY3QgTnVtYmVyXSI6cmV0dXJuK2UhPT0rZT8rdCE9PSt0OjA9PT0rZT8xLytlPT09MS90OitlPT09K3Q7Y2FzZSJbb2JqZWN0IERhdGVdIjpjYXNlIltvYmplY3QgQm9vbGVhbl0iOnJldHVybitlPT09K3R9dmFyIGE9IltvYmplY3QgQXJyYXldIj09PWk7aWYoIWEpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8Im9iamVjdCIhPXR5cGVvZiB0KXJldHVybiExO3ZhciBvPWUuY29uc3RydWN0b3Iscz10LmNvbnN0cnVjdG9yO2lmKG8hPT1zJiYhKG0uaXNGdW5jdGlvbihvKSYmbyBpbnN0YW5jZW9mIG8mJm0uaXNGdW5jdGlvbihzKSYmcyBpbnN0YW5jZW9mIHMpJiYiY29uc3RydWN0b3IiaW4gZSYmImNvbnN0cnVjdG9yImluIHQpcmV0dXJuITF9Zm9yKHZhciBjPW4ubGVuZ3RoO2MtLTspaWYobltjXT09PWUpcmV0dXJuIHJbY109PT10O2lmKG4ucHVzaChlKSxyLnB1c2godCksYSl7aWYoYz1lLmxlbmd0aCxjIT09dC5sZW5ndGgpcmV0dXJuITE7Zm9yKDtjLS07KWlmKCFDKGVbY10sdFtjXSxuLHIpKXJldHVybiExfWVsc2V7dmFyIGwsZj1tLmtleXMoZSk7aWYoYz1mLmxlbmd0aCxtLmtleXModCkubGVuZ3RoIT09YylyZXR1cm4hMTtmb3IoO2MtLTspaWYobD1mW2NdLCFtLmhhcyh0LGwpfHwhQyhlW2xdLHRbbF0sbixyKSlyZXR1cm4hMX1yZXR1cm4gbi5wb3AoKSxyLnBvcCgpLCEwfTttLmlzRXF1YWw9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gQyhlLHQsW10sW10pfSxtLmlzRW1wdHk9ZnVuY3Rpb24oZSl7aWYobnVsbD09ZSlyZXR1cm4hMDtpZihtLmlzQXJyYXkoZSl8fG0uaXNTdHJpbmcoZSl8fG0uaXNBcmd1bWVudHMoZSkpcmV0dXJuIDA9PT1lLmxlbmd0aDtmb3IodmFyIHQgaW4gZSlpZihtLmhhcyhlLHQpKXJldHVybiExO3JldHVybiEwfSxtLmlzRWxlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4hKCFlfHwxIT09ZS5ub2RlVHlwZSl9LG0uaXNBcnJheT1sfHxmdW5jdGlvbihlKXtyZXR1cm4iW29iamVjdCBBcnJheV0iPT09dS5jYWxsKGUpfSxtLmlzT2JqZWN0PWZ1bmN0aW9uKGUpe3ZhciB0PXR5cGVvZiBlO3JldHVybiJmdW5jdGlvbiI9PT10fHwib2JqZWN0Ij09PXQmJiEhZX0sbS5lYWNoKFsiQXJndW1lbnRzIiwiRnVuY3Rpb24iLCJTdHJpbmciLCJOdW1iZXIiLCJEYXRlIiwiUmVnRXhwIiwiRXJyb3IiXSxmdW5jdGlvbihlKXttWyJpcyIrZV09ZnVuY3Rpb24odCl7cmV0dXJuIHUuY2FsbCh0KT09PSJbb2JqZWN0ICIrZSsiXSJ9fSksbS5pc0FyZ3VtZW50cyhhcmd1bWVudHMpfHwobS5pc0FyZ3VtZW50cz1mdW5jdGlvbihlKXtyZXR1cm4gbS5oYXMoZSwiY2FsbGVlIil9KSwiZnVuY3Rpb24iIT10eXBlb2YvLi8mJihtLmlzRnVuY3Rpb249ZnVuY3Rpb24oZSl7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIGV8fCExfSksbS5pc0Zpbml0ZT1mdW5jdGlvbihlKXtyZXR1cm4gaXNGaW5pdGUoZSkmJiFpc05hTihwYXJzZUZsb2F0KGUpKX0sbS5pc05hTj1mdW5jdGlvbihlKXtyZXR1cm4gbS5pc051bWJlcihlKSYmZSE9PStlfSxtLmlzQm9vbGVhbj1mdW5jdGlvbihlKXtyZXR1cm4gZT09PSEwfHxlPT09ITF8fCJbb2JqZWN0IEJvb2xlYW5dIj09PXUuY2FsbChlKX0sbS5pc051bGw9ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGw9PT1lfSxtLmlzVW5kZWZpbmVkPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lfSxtLmhhcz1mdW5jdGlvbihlLHQpe3JldHVybiBudWxsIT1lJiZjLmNhbGwoZSx0KX0sbS5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIHQuXz1uLHRoaXN9LG0uaWRlbnRpdHk9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LG0uY29uc3RhbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGV9fSxtLm5vb3A9ZnVuY3Rpb24oKXt9LG0ucHJvcGVydHk9ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10P3ZvaWQgMDp0W2VdfX0sbS5wcm9wZXJ0eU9mPWZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lP2Z1bmN0aW9uKCl7fTpmdW5jdGlvbih0KXtyZXR1cm4gZVt0XX19LG0ubWF0Y2hlcz1mdW5jdGlvbihlKXt2YXIgdD1tLnBhaXJzKGUpLG49dC5sZW5ndGg7cmV0dXJuIGZ1bmN0aW9uKGUpe2lmKG51bGw9PWUpcmV0dXJuIW47ZT1uZXcgT2JqZWN0KGUpO2Zvcih2YXIgcj0wO24+cjtyKyspe3ZhciBpPXRbcl0sYT1pWzBdO2lmKGlbMV0hPT1lW2FdfHwhKGEgaW4gZSkpcmV0dXJuITF9cmV0dXJuITB9fSxtLnRpbWVzPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcj1BcnJheShNYXRoLm1heCgwLGUpKTt0PWcodCxuLDEpO2Zvcih2YXIgaT0wO2U+aTtpKyspcltpXT10KGkpO3JldHVybiByfSxtLnJhbmRvbT1mdW5jdGlvbihlLHQpe3JldHVybiBudWxsPT10JiYodD1lLGU9MCksZStNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKHQtZSsxKSl9LG0ubm93PURhdGUubm93fHxmdW5jdGlvbigpe3JldHVybihuZXcgRGF0ZSkuZ2V0VGltZSgpfTt2YXIgVD17IiYiOiImYW1wOyIsIjwiOiImbHQ7IiwiPiI6IiZndDsiLCciJzoiJnF1b3Q7IiwiJyI6IiYjeDI3OyIsImAiOiImI3g2MDsifSxBPW0uaW52ZXJ0KFQpLE89ZnVuY3Rpb24oZSl7dmFyIHQ9ZnVuY3Rpb24odCl7cmV0dXJuIGVbdF19LG49Iig/OiIrbS5rZXlzKGUpLmpvaW4oInwiKSsiKSIscj1SZWdFeHAobiksaT1SZWdFeHAobiwiZyIpO3JldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gZT1udWxsPT1lPyIiOiIiK2Usci50ZXN0KGUpP2UucmVwbGFjZShpLHQpOmV9fTttLmVzY2FwZT1PKFQpLG0udW5lc2NhcGU9TyhBKSxtLnJlc3VsdD1mdW5jdGlvbihlLHQsbil7dmFyIHI9bnVsbD09ZT92b2lkIDA6ZVt0XTtyZXR1cm4gdm9pZCAwPT09ciYmKHI9biksbS5pc0Z1bmN0aW9uKHIpP3IuY2FsbChlKTpyfTt2YXIgaj0wO20udW5pcXVlSWQ9ZnVuY3Rpb24oZSl7dmFyIHQ9KytqKyIiO3JldHVybiBlP2UrdDp0fSxtLnRlbXBsYXRlU2V0dGluZ3M9e2V2YWx1YXRlOi88JShbXHNcU10rPyklPi9nLGludGVycG9sYXRlOi88JT0oW1xzXFNdKz8pJT4vZyxlc2NhcGU6LzwlLShbXHNcU10rPyklPi9nfTt2YXIgJD0vKC4pXi8sTD17IiciOiInIiwiXFwiOiJcXCIsIlxyIjoiciIsIlxuIjoibiIsIlx1MjAyOCI6InUyMDI4IiwiXHUyMDI5IjoidTIwMjkifSxOPS9cXHwnfFxyfFxufFx1MjAyOHxcdTIwMjkvZyxNPWZ1bmN0aW9uKGUpe3JldHVybiJcXCIrTFtlXX07bS50ZW1wbGF0ZT1mdW5jdGlvbihlLHQsbil7IXQmJm4mJih0PW4pLHQ9bS5kZWZhdWx0cyh7fSx0LG0udGVtcGxhdGVTZXR0aW5ncyk7dmFyIHI9UmVnRXhwKFsodC5lc2NhcGV8fCQpLnNvdXJjZSwodC5pbnRlcnBvbGF0ZXx8JCkuc291cmNlLCh0LmV2YWx1YXRlfHwkKS5zb3VyY2VdLmpvaW4oInwiKSsifCQiLCJnIiksaT0wLGE9Il9fcCs9JyI7ZS5yZXBsYWNlKHIsZnVuY3Rpb24odCxuLHIsbyxzKXtyZXR1cm4gYSs9ZS5zbGljZShpLHMpLnJlcGxhY2UoTixNKSxpPXMrdC5sZW5ndGgsbj9hKz0iJytcbigoX190PSgiK24rIikpPT1udWxsPycnOl8uZXNjYXBlKF9fdCkpK1xuJyI6cj9hKz0iJytcbigoX190PSgiK3IrIikpPT1udWxsPycnOl9fdCkrXG4nIjpvJiYoYSs9Iic7XG4iK28rIlxuX19wKz0nIiksdH0pLGErPSInO1xuIix0LnZhcmlhYmxlfHwoYT0id2l0aChvYmp8fHt9KXtcbiIrYSsifVxuIiksYT0idmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iK2ErInJldHVybiBfX3A7XG4iO3RyeXt2YXIgbz1uZXcgRnVuY3Rpb24odC52YXJpYWJsZXx8Im9iaiIsIl8iLGEpfWNhdGNoKHMpe3Rocm93IHMuc291cmNlPWEsc312YXIgdT1mdW5jdGlvbihlKXtyZXR1cm4gby5jYWxsKHRoaXMsZSxtKX0sYz10LnZhcmlhYmxlfHwib2JqIjtyZXR1cm4gdS5zb3VyY2U9ImZ1bmN0aW9uKCIrYysiKXtcbiIrYSsifSIsdX0sbS5jaGFpbj1mdW5jdGlvbihlKXt2YXIgdD1tKGUpO3JldHVybiB0Ll9jaGFpbj0hMCx0fTt2YXIgUj1mdW5jdGlvbihlLHQpe3JldHVybiBlLl9jaGFpbj9tKHQpLmNoYWluKCk6dH07bS5taXhpbj1mdW5jdGlvbihlKXttLmVhY2gobS5mdW5jdGlvbnMoZSksZnVuY3Rpb24odCl7dmFyIG49bVt0XT1lW3RdO20ucHJvdG90eXBlW3RdPWZ1bmN0aW9uKCl7dmFyIGU9W3RoaXMuX3dyYXBwZWRdO3JldHVybiBvLmFwcGx5KGUsYXJndW1lbnRzKSxSKHRoaXMsbi5hcHBseShtLGUpKX19KX0sbS5taXhpbihtKSxtLmVhY2goWyJwb3AiLCJwdXNoIiwicmV2ZXJzZSIsInNoaWZ0Iiwic29ydCIsInNwbGljZSIsInVuc2hpZnQiXSxmdW5jdGlvbihlKXt2YXIgdD1yW2VdO20ucHJvdG90eXBlW2VdPWZ1bmN0aW9uKCl7dmFyIG49dGhpcy5fd3JhcHBlZDtyZXR1cm4gdC5hcHBseShuLGFyZ3VtZW50cyksInNoaWZ0IiE9PWUmJiJzcGxpY2UiIT09ZXx8MCE9PW4ubGVuZ3RofHxkZWxldGUgblswXSxSKHRoaXMsbil9fSksbS5lYWNoKFsiY29uY2F0Iiwiam9pbiIsInNsaWNlIl0sZnVuY3Rpb24oZSl7dmFyIHQ9cltlXTttLnByb3RvdHlwZVtlXT1mdW5jdGlvbigpe3JldHVybiBSKHRoaXMsdC5hcHBseSh0aGlzLl93cmFwcGVkLGFyZ3VtZW50cykpfX0pLG0ucHJvdG90eXBlLnZhbHVlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3dyYXBwZWR9LCJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQmJmRlZmluZSgidW5kZXJzY29yZSIsW10sZnVuY3Rpb24oKXtyZXR1cm4gbX0pfSkuY2FsbCh0aGlzKTs="},"less.js": {"content_type": "text/javascript","data": "DQovKiENCiAqIExlc3MgLSBMZWFuZXIgQ1NTIHYyLjUuMQ0KICogaHR0cDovL2xlc3Njc3Mub3JnDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDA5LTIwMTUsIEFsZXhpcyBTZWxsaWVyIDxzZWxmQGNsb3VkaGVhZC5uZXQ+DQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIHYyIExpY2Vuc2UuDQogKg0KICovDQoNCiAvKiogKiBAbGljZW5zZSBBcGFjaGUgdjINCiAqLw0KDQohZnVuY3Rpb24oYSl7aWYoIm9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYidW5kZWZpbmVkIiE9dHlwZW9mIG1vZHVsZSltb2R1bGUuZXhwb3J0cz1hKCk7ZWxzZSBpZigiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kKWRlZmluZShbXSxhKTtlbHNle3ZhciBiO2I9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp0aGlzLGIubGVzcz1hKCl9fShmdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbiBhKGIsYyxkKXtmdW5jdGlvbiBlKGcsaCl7aWYoIWNbZ10pe2lmKCFiW2ddKXt2YXIgaT0iZnVuY3Rpb24iPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighaCYmaSlyZXR1cm4gaShnLCEwKTtpZihmKXJldHVybiBmKGcsITApO3ZhciBqPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK2crIiciKTt0aHJvdyBqLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGp9dmFyIGs9Y1tnXT17ZXhwb3J0czp7fX07YltnXVswXS5jYWxsKGsuZXhwb3J0cyxmdW5jdGlvbihhKXt2YXIgYz1iW2ddWzFdW2FdO3JldHVybiBlKGM/YzphKX0sayxrLmV4cG9ydHMsYSxiLGMsZCl9cmV0dXJuIGNbZ10uZXhwb3J0c31mb3IodmFyIGY9ImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsZz0wO2QubGVuZ3RoPmc7ZysrKWUoZFtnXSk7cmV0dXJuIGV9KHsxOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vdXRpbHMiKS5hZGREYXRhQXR0cixkPWEoIi4vYnJvd3NlciIpO2IuZXhwb3J0cz1mdW5jdGlvbihhLGIpe2MoYixkLmN1cnJlbnRTY3JpcHQoYSkpLHZvaWQgMD09PWIuaXNGaWxlUHJvdG9jb2wmJihiLmlzRmlsZVByb3RvY29sPS9eKGZpbGV8KGNocm9tZXxzYWZhcmkpKC1leHRlbnNpb24pP3xyZXNvdXJjZXxxcmN8YXBwKTovLnRlc3QoYS5sb2NhdGlvbi5wcm90b2NvbCkpLGIuYXN5bmM9Yi5hc3luY3x8ITEsYi5maWxlQXN5bmM9Yi5maWxlQXN5bmN8fCExLGIucG9sbD1iLnBvbGx8fChiLmlzRmlsZVByb3RvY29sPzFlMzoxNTAwKSxiLmVudj1iLmVudnx8KCIxMjcuMC4wLjEiPT1hLmxvY2F0aW9uLmhvc3RuYW1lfHwiMC4wLjAuMCI9PWEubG9jYXRpb24uaG9zdG5hbWV8fCJsb2NhbGhvc3QiPT1hLmxvY2F0aW9uLmhvc3RuYW1lfHxhLmxvY2F0aW9uLnBvcnQmJmEubG9jYXRpb24ucG9ydC5sZW5ndGg+MHx8Yi5pc0ZpbGVQcm90b2NvbD8iZGV2ZWxvcG1lbnQiOiJwcm9kdWN0aW9uIik7dmFyIGU9LyFkdW1wTGluZU51bWJlcnM6KGNvbW1lbnRzfG1lZGlhcXVlcnl8YWxsKS8uZXhlYyhhLmxvY2F0aW9uLmhhc2gpO2UmJihiLmR1bXBMaW5lTnVtYmVycz1lWzFdKSx2b2lkIDA9PT1iLnVzZUZpbGVDYWNoZSYmKGIudXNlRmlsZUNhY2hlPSEwKSx2b2lkIDA9PT1iLm9uUmVhZHkmJihiLm9uUmVhZHk9ITApfX0seyIuL2Jyb3dzZXIiOjMsIi4vdXRpbHMiOjl9XSwyOltmdW5jdGlvbihhLGIpe2EoInByb21pc2UvcG9seWZpbGwuanMiKTt2YXIgYz13aW5kb3cubGVzc3x8e307YSgiLi9hZGQtZGVmYXVsdC1vcHRpb25zIikod2luZG93LGMpO3ZhciBkPWIuZXhwb3J0cz1hKCIuL2luZGV4Iikod2luZG93LGMpO3dpbmRvdy5sZXNzPWQsYy5vblJlYWR5JiYoLyF3YXRjaC8udGVzdCh3aW5kb3cubG9jYXRpb24uaGFzaCkmJmQud2F0Y2goKSxkLnJlZ2lzdGVyU3R5bGVzaGVldHNJbW1lZGlhdGVseSgpLGQucGFnZUxvYWRGaW5pc2hlZD1kLnJlZnJlc2goImRldmVsb3BtZW50Ij09PWQuZW52KSl9LHsiLi9hZGQtZGVmYXVsdC1vcHRpb25zIjoxLCIuL2luZGV4Ijo3LCJwcm9taXNlL3BvbHlmaWxsLmpzIjo5NH1dLDM6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi91dGlscyIpO2IuZXhwb3J0cz17Y3JlYXRlQ1NTOmZ1bmN0aW9uKGEsYixkKXt2YXIgZT1kLmhyZWZ8fCIiLGY9Imxlc3M6IisoZC50aXRsZXx8Yy5leHRyYWN0SWQoZSkpLGc9YS5nZXRFbGVtZW50QnlJZChmKSxoPSExLGk9YS5jcmVhdGVFbGVtZW50KCJzdHlsZSIpO2kuc2V0QXR0cmlidXRlKCJ0eXBlIiwidGV4dC9jc3MiKSxkLm1lZGlhJiZpLnNldEF0dHJpYnV0ZSgibWVkaWEiLGQubWVkaWEpLGkuaWQ9ZixpLnN0eWxlU2hlZXR8fChpLmFwcGVuZENoaWxkKGEuY3JlYXRlVGV4dE5vZGUoYikpLGg9bnVsbCE9PWcmJmcuY2hpbGROb2Rlcy5sZW5ndGg+MCYmaS5jaGlsZE5vZGVzLmxlbmd0aD4wJiZnLmZpcnN0Q2hpbGQubm9kZVZhbHVlPT09aS5maXJzdENoaWxkLm5vZGVWYWx1ZSk7dmFyIGo9YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdO2lmKG51bGw9PT1nfHxoPT09ITEpe3ZhciBrPWQmJmQubmV4dFNpYmxpbmd8fG51bGw7az9rLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGksayk6ai5hcHBlbmRDaGlsZChpKX1pZihnJiZoPT09ITEmJmcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChnKSxpLnN0eWxlU2hlZXQpdHJ5e2kuc3R5bGVTaGVldC5jc3NUZXh0PWJ9Y2F0Y2gobCl7dGhyb3cgbmV3IEVycm9yKCJDb3VsZG4ndCByZWFzc2lnbiBzdHlsZVNoZWV0LmNzc1RleHQuIil9fSxjdXJyZW50U2NyaXB0OmZ1bmN0aW9uKGEpe3ZhciBiPWEuZG9jdW1lbnQ7cmV0dXJuIGIuY3VycmVudFNjcmlwdHx8ZnVuY3Rpb24oKXt2YXIgYT1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKTtyZXR1cm4gYVthLmxlbmd0aC0xXX0oKX19fSx7Ii4vdXRpbHMiOjl9XSw0OltmdW5jdGlvbihhLGIpe2IuZXhwb3J0cz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9bnVsbDtpZigiZGV2ZWxvcG1lbnQiIT09Yi5lbnYpdHJ5e2Q9InVuZGVmaW5lZCI9PXR5cGVvZiBhLmxvY2FsU3RvcmFnZT9udWxsOmEubG9jYWxTdG9yYWdlfWNhdGNoKGUpe31yZXR1cm57c2V0Q1NTOmZ1bmN0aW9uKGEsYixlKXtpZihkKXtjLmluZm8oInNhdmluZyAiK2ErIiB0byBjYWNoZS4iKTt0cnl7ZC5zZXRJdGVtKGEsZSksZC5zZXRJdGVtKGErIjp0aW1lc3RhbXAiLGIpfWNhdGNoKGYpe2MuZXJyb3IoJ2ZhaWxlZCB0byBzYXZlICInK2ErJyIgdG8gbG9jYWwgc3RvcmFnZSBmb3IgY2FjaGluZy4nKX19fSxnZXRDU1M6ZnVuY3Rpb24oYSxiKXt2YXIgYz1kJiZkLmdldEl0ZW0oYSksZT1kJiZkLmdldEl0ZW0oYSsiOnRpbWVzdGFtcCIpO3JldHVybiBlJiZiLmxhc3RNb2RpZmllZCYmbmV3IERhdGUoYi5sYXN0TW9kaWZpZWQpLnZhbHVlT2YoKT09PW5ldyBEYXRlKGUpLnZhbHVlT2YoKT9jOnZvaWQgMH19fX0se31dLDU6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi91dGlscyIpLGQ9YSgiLi9icm93c2VyIik7Yi5leHBvcnRzPWZ1bmN0aW9uKGEsYixlKXtmdW5jdGlvbiBmKGIsZil7dmFyIGcsaCxpPSJsZXNzLWVycm9yLW1lc3NhZ2U6IitjLmV4dHJhY3RJZChmfHwiIiksaj0nPGxpPjxsYWJlbD57bGluZX08L2xhYmVsPjxwcmUgY2xhc3M9IntjbGFzc30iPntjb250ZW50fTwvcHJlPjwvbGk+JyxrPWEuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksbD1bXSxtPWIuZmlsZW5hbWV8fGYsbj1tLm1hdGNoKC8oW15cL10rKFw/LiopPykkLylbMV07ay5pZD1pLGsuY2xhc3NOYW1lPSJsZXNzLWVycm9yLW1lc3NhZ2UiLGg9IjxoMz4iKyhiLnR5cGV8fCJTeW50YXgiKSsiRXJyb3I6ICIrKGIubWVzc2FnZXx8IlRoZXJlIGlzIGFuIGVycm9yIGluIHlvdXIgLmxlc3MgZmlsZSIpKyc8L2gzPjxwPmluIDxhIGhyZWY9IicrbSsnIj4nK24rIjwvYT4gIjt2YXIgbz1mdW5jdGlvbihhLGIsYyl7dm9pZCAwIT09YS5leHRyYWN0W2JdJiZsLnB1c2goai5yZXBsYWNlKC9ce2xpbmVcfS8sKHBhcnNlSW50KGEubGluZSwxMCl8fDApKyhiLTEpKS5yZXBsYWNlKC9ce2NsYXNzXH0vLGMpLnJlcGxhY2UoL1x7Y29udGVudFx9LyxhLmV4dHJhY3RbYl0pKX07Yi5leHRyYWN0JiYobyhiLDAsIiIpLG8oYiwxLCJsaW5lIiksbyhiLDIsIiIpLGgrPSJvbiBsaW5lICIrYi5saW5lKyIsIGNvbHVtbiAiKyhiLmNvbHVtbisxKSsiOjwvcD48dWw+IitsLmpvaW4oIiIpKyI8L3VsPiIpLGIuc3RhY2smJihiLmV4dHJhY3R8fGUubG9nTGV2ZWw+PTQpJiYoaCs9Ijxici8+U3RhY2sgVHJhY2U8L2JyIC8+IitiLnN0YWNrLnNwbGl0KCJcbiIpLnNsaWNlKDEpLmpvaW4oIjxici8+IikpLGsuaW5uZXJIVE1MPWgsZC5jcmVhdGVDU1MoYS5kb2N1bWVudCxbIi5sZXNzLWVycm9yLW1lc3NhZ2UgdWwsIC5sZXNzLWVycm9yLW1lc3NhZ2UgbGkgeyIsImxpc3Qtc3R5bGUtdHlwZTogbm9uZTsiLCJtYXJnaW4tcmlnaHQ6IDE1cHg7IiwicGFkZGluZzogNHB4IDA7IiwibWFyZ2luOiAwOyIsIn0iLCIubGVzcy1lcnJvci1tZXNzYWdlIGxhYmVsIHsiLCJmb250LXNpemU6IDEycHg7IiwibWFyZ2luLXJpZ2h0OiAxNXB4OyIsInBhZGRpbmc6IDRweCAwOyIsImNvbG9yOiAjY2M3Nzc3OyIsIn0iLCIubGVzcy1lcnJvci1tZXNzYWdlIHByZSB7IiwiY29sb3I6ICNkZDY2NjY7IiwicGFkZGluZzogNHB4IDA7IiwibWFyZ2luOiAwOyIsImRpc3BsYXk6IGlubGluZS1ibG9jazsiLCJ9IiwiLmxlc3MtZXJyb3ItbWVzc2FnZSBwcmUubGluZSB7IiwiY29sb3I6ICNmZjAwMDA7IiwifSIsIi5sZXNzLWVycm9yLW1lc3NhZ2UgaDMgeyIsImZvbnQtc2l6ZTogMjBweDsiLCJmb250LXdlaWdodDogYm9sZDsiLCJwYWRkaW5nOiAxNXB4IDAgNXB4IDA7IiwibWFyZ2luOiAwOyIsIn0iLCIubGVzcy1lcnJvci1tZXNzYWdlIGEgeyIsImNvbG9yOiAjMTBhIiwifSIsIi5sZXNzLWVycm9yLW1lc3NhZ2UgLmVycm9yIHsiLCJjb2xvcjogcmVkOyIsImZvbnQtd2VpZ2h0OiBib2xkOyIsInBhZGRpbmctYm90dG9tOiAycHg7IiwiYm9yZGVyLWJvdHRvbTogMXB4IGRhc2hlZCByZWQ7IiwifSJdLmpvaW4oIlxuIikse3RpdGxlOiJlcnJvci1tZXNzYWdlIn0pLGsuc3R5bGUuY3NzVGV4dD1bImZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZiIsImJvcmRlcjogMXB4IHNvbGlkICNlMDAiLCJiYWNrZ3JvdW5kLWNvbG9yOiAjZWVlIiwiYm9yZGVyLXJhZGl1czogNXB4IiwiLXdlYmtpdC1ib3JkZXItcmFkaXVzOiA1cHgiLCItbW96LWJvcmRlci1yYWRpdXM6IDVweCIsImNvbG9yOiAjZTAwIiwicGFkZGluZzogMTVweCIsIm1hcmdpbi1ib3R0b206IDE1cHgiXS5qb2luKCI7IiksImRldmVsb3BtZW50Ij09PWUuZW52JiYoZz1zZXRJbnRlcnZhbChmdW5jdGlvbigpe3ZhciBiPWEuZG9jdW1lbnQsYz1iLmJvZHk7YyYmKGIuZ2V0RWxlbWVudEJ5SWQoaSk/Yy5yZXBsYWNlQ2hpbGQoayxiLmdldEVsZW1lbnRCeUlkKGkpKTpjLmluc2VydEJlZm9yZShrLGMuZmlyc3RDaGlsZCksY2xlYXJJbnRlcnZhbChnKSl9LDEwKSl9ZnVuY3Rpb24gZyhhLGIpe2UuZXJyb3JSZXBvcnRpbmcmJiJodG1sIiE9PWUuZXJyb3JSZXBvcnRpbmc/ImNvbnNvbGUiPT09ZS5lcnJvclJlcG9ydGluZz9rKGEsYik6ImZ1bmN0aW9uIj09dHlwZW9mIGUuZXJyb3JSZXBvcnRpbmcmJmUuZXJyb3JSZXBvcnRpbmcoImFkZCIsYSxiKTpmKGEsYil9ZnVuY3Rpb24gaChiKXt2YXIgZD1hLmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZXNzLWVycm9yLW1lc3NhZ2U6IitjLmV4dHJhY3RJZChiKSk7ZCYmZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGQpfWZ1bmN0aW9uIGkoKXt9ZnVuY3Rpb24gaihhKXtlLmVycm9yUmVwb3J0aW5nJiYiaHRtbCIhPT1lLmVycm9yUmVwb3J0aW5nPyJjb25zb2xlIj09PWUuZXJyb3JSZXBvcnRpbmc/aShhKToiZnVuY3Rpb24iPT10eXBlb2YgZS5lcnJvclJlcG9ydGluZyYmZS5lcnJvclJlcG9ydGluZygicmVtb3ZlIixhKTpoKGEpfWZ1bmN0aW9uIGsoYSxjKXt2YXIgZD0ie2xpbmV9IHtjb250ZW50fSIsZj1hLmZpbGVuYW1lfHxjLGc9W10saD0oYS50eXBlfHwiU3ludGF4IikrIkVycm9yOiAiKyhhLm1lc3NhZ2V8fCJUaGVyZSBpcyBhbiBlcnJvciBpbiB5b3VyIC5sZXNzIGZpbGUiKSsiIGluICIrZisiICIsaT1mdW5jdGlvbihhLGIsYyl7dm9pZCAwIT09YS5leHRyYWN0W2JdJiZnLnB1c2goZC5yZXBsYWNlKC9ce2xpbmVcfS8sKHBhcnNlSW50KGEubGluZSwxMCl8fDApKyhiLTEpKS5yZXBsYWNlKC9ce2NsYXNzXH0vLGMpLnJlcGxhY2UoL1x7Y29udGVudFx9LyxhLmV4dHJhY3RbYl0pKX07YS5leHRyYWN0JiYoaShhLDAsIiIpLGkoYSwxLCJsaW5lIiksaShhLDIsIiIpLGgrPSJvbiBsaW5lICIrYS5saW5lKyIsIGNvbHVtbiAiKyhhLmNvbHVtbisxKSsiOlxuIitnLmpvaW4oIlxuIikpLGEuc3RhY2smJihhLmV4dHJhY3R8fGUubG9nTGV2ZWw+PTQpJiYoaCs9IlxuU3RhY2sgVHJhY2VcbiIrYS5zdGFjayksYi5sb2dnZXIuZXJyb3IoaCl9cmV0dXJue2FkZDpnLHJlbW92ZTpqfX19LHsiLi9icm93c2VyIjozLCIuL3V0aWxzIjo5fV0sNjpbZnVuY3Rpb24oYSxiKXtiLmV4cG9ydHM9ZnVuY3Rpb24oYixjKXtmdW5jdGlvbiBkKCl7aWYod2luZG93LlhNTEh0dHBSZXF1ZXN0JiYhKCJmaWxlOiI9PT13aW5kb3cubG9jYXRpb24ucHJvdG9jb2wmJiJBY3RpdmVYT2JqZWN0ImluIHdpbmRvdykpcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdDt0cnl7cmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpfWNhdGNoKGEpe3JldHVybiBjLmVycm9yKCJicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBBSkFYLiIpLG51bGx9fXZhciBlPWEoIi4uL2xlc3MvZW52aXJvbm1lbnQvYWJzdHJhY3QtZmlsZS1tYW5hZ2VyLmpzIiksZj17fSxnPWZ1bmN0aW9uKCl7fTtyZXR1cm4gZy5wcm90b3R5cGU9bmV3IGUsZy5wcm90b3R5cGUuYWx3YXlzTWFrZVBhdGhzQWJzb2x1dGU9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sZy5wcm90b3R5cGUuam9pbj1mdW5jdGlvbihhLGIpe3JldHVybiBhP3RoaXMuZXh0cmFjdFVybFBhcnRzKGIsYSkucGF0aDpifSxnLnByb3RvdHlwZS5kb1hIUj1mdW5jdGlvbihhLGUsZixnKXtmdW5jdGlvbiBoKGIsYyxkKXtiLnN0YXR1cz49MjAwJiYzMDA+Yi5zdGF0dXM/YyhiLnJlc3BvbnNlVGV4dCxiLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIikpOiJmdW5jdGlvbiI9PXR5cGVvZiBkJiZkKGIuc3RhdHVzLGEpfXZhciBpPWQoKSxqPWIuaXNGaWxlUHJvdG9jb2w/Yi5maWxlQXN5bmM6Yi5hc3luYzsiZnVuY3Rpb24iPT10eXBlb2YgaS5vdmVycmlkZU1pbWVUeXBlJiZpLm92ZXJyaWRlTWltZVR5cGUoInRleHQvY3NzIiksYy5kZWJ1ZygiWEhSOiBHZXR0aW5nICciK2ErIiciKSxpLm9wZW4oIkdFVCIsYSxqKSxpLnNldFJlcXVlc3RIZWFkZXIoIkFjY2VwdCIsZXx8InRleHQveC1sZXNzLCB0ZXh0L2NzczsgcT0wLjksICovKjsgcT0wLjUiKSxpLnNlbmQobnVsbCksYi5pc0ZpbGVQcm90b2NvbCYmIWIuZmlsZUFzeW5jPzA9PT1pLnN0YXR1c3x8aS5zdGF0dXM+PTIwMCYmMzAwPmkuc3RhdHVzP2YoaS5yZXNwb25zZVRleHQpOmcoaS5zdGF0dXMsYSk6aj9pLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpezQ9PWkucmVhZHlTdGF0ZSYmaChpLGYsZyl9OmgoaSxmLGcpfSxnLnByb3RvdHlwZS5zdXBwb3J0cz1mdW5jdGlvbigpe3JldHVybiEwfSxnLnByb3RvdHlwZS5jbGVhckZpbGVDYWNoZT1mdW5jdGlvbigpe2Y9e319LGcucHJvdG90eXBlLmxvYWRGaWxlPWZ1bmN0aW9uKGEsYixjLGQsZSl7YiYmIXRoaXMuaXNQYXRoQWJzb2x1dGUoYSkmJihhPWIrYSksYz1jfHx7fTt2YXIgZz10aGlzLmV4dHJhY3RVcmxQYXJ0cyhhLHdpbmRvdy5sb2NhdGlvbi5ocmVmKSxoPWcudXJsO2lmKGMudXNlRmlsZUNhY2hlJiZmW2hdKXRyeXt2YXIgaT1mW2hdO2UobnVsbCx7Y29udGVudHM6aSxmaWxlbmFtZTpoLHdlYkluZm86e2xhc3RNb2RpZmllZDpuZXcgRGF0ZX19KX1jYXRjaChqKXtlKHtmaWxlbmFtZTpoLG1lc3NhZ2U6IkVycm9yIGxvYWRpbmcgZmlsZSAiK2grIiBlcnJvciB3YXMgIitqLm1lc3NhZ2V9KX1lbHNlIHRoaXMuZG9YSFIoaCxjLm1pbWUsZnVuY3Rpb24oYSxiKXtmW2hdPWEsZShudWxsLHtjb250ZW50czphLGZpbGVuYW1lOmgsd2ViSW5mbzp7bGFzdE1vZGlmaWVkOmJ9fSl9LGZ1bmN0aW9uKGEsYil7ZSh7dHlwZToiRmlsZSIsbWVzc2FnZToiJyIrYisiJyB3YXNuJ3QgZm91bmQgKCIrYSsiKSIsaHJlZjpofSl9KX0sZ319LHsiLi4vbGVzcy9lbnZpcm9ubWVudC9hYnN0cmFjdC1maWxlLW1hbmFnZXIuanMiOjE0fV0sNzpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL3V0aWxzIikuYWRkRGF0YUF0dHIsZD1hKCIuL2Jyb3dzZXIiKTtiLmV4cG9ydHM9ZnVuY3Rpb24oYixlKXtmdW5jdGlvbiBmKGEpe3JldHVybiBlLnBvc3RQcm9jZXNzb3ImJiJmdW5jdGlvbiI9PXR5cGVvZiBlLnBvc3RQcm9jZXNzb3ImJihhPWUucG9zdFByb2Nlc3Nvci5jYWxsKGEsYSl8fGEpLGF9ZnVuY3Rpb24gZyhhKXt2YXIgYj17fTtmb3IodmFyIGMgaW4gYSlhLmhhc093blByb3BlcnR5KGMpJiYoYltjXT1hW2NdKTtyZXR1cm4gYn1mdW5jdGlvbiBoKGEsYil7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3ZhciBkPWMuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKSk7cmV0dXJuIGEuYXBwbHkoYixkKX19ZnVuY3Rpb24gaShhKXtmb3IodmFyIGIsYz1tLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzdHlsZSIpLGQ9MDtjLmxlbmd0aD5kO2QrKylpZihiPWNbZF0sYi50eXBlLm1hdGNoKHQpKXt2YXIgZj1nKGUpO2YubW9kaWZ5VmFycz1hO3ZhciBpPWIuaW5uZXJIVE1MfHwiIjtmLmZpbGVuYW1lPW0ubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8jLiokLywiIiksbi5yZW5kZXIoaSxmLGgoZnVuY3Rpb24oYSxiLGMpe2I/ci5hZGQoYiwiaW5saW5lIik6KGEudHlwZT0idGV4dC9jc3MiLGEuc3R5bGVTaGVldD9hLnN0eWxlU2hlZXQuY3NzVGV4dD1jLmNzczphLmlubmVySFRNTD1jLmNzcyl9LG51bGwsYikpfX1mdW5jdGlvbiBqKGEsYixkLGgsaSl7ZnVuY3Rpb24gaihjKXt2YXIgZT1jLmNvbnRlbnRzLGc9Yy5maWxlbmFtZSxpPWMud2ViSW5mbyxqPXtjdXJyZW50RGlyZWN0b3J5OnEuZ2V0UGF0aChnKSxmaWxlbmFtZTpnLHJvb3RGaWxlbmFtZTpnLHJlbGF0aXZlVXJsczprLnJlbGF0aXZlVXJsc307aWYoai5lbnRyeVBhdGg9ai5jdXJyZW50RGlyZWN0b3J5LGoucm9vdHBhdGg9ay5yb290cGF0aHx8ai5jdXJyZW50RGlyZWN0b3J5LGkmJihpLnJlbWFpbmluZz1oLCFrLm1vZGlmeVZhcnMpKXt2YXIgbD1zLmdldENTUyhnLGkpO2lmKCFkJiZsKXJldHVybiBpLmxvY2FsPSEwLHZvaWQgYihudWxsLGwsZSxhLGksZyl9ci5yZW1vdmUoZyksay5yb290RmlsZUluZm89aixuLnJlbmRlcihlLGssZnVuY3Rpb24oYyxkKXtjPyhjLmhyZWY9ZyxiKGMpKTooZC5jc3M9ZihkLmNzcyksay5tb2RpZnlWYXJzfHxzLnNldENTUyhhLmhyZWYsaS5sYXN0TW9kaWZpZWQsZC5jc3MpLGIobnVsbCxkLmNzcyxlLGEsaSxnKSl9KX12YXIgaz1nKGUpO2MoayxhKSxrLm1pbWU9YS50eXBlLGkmJihrLm1vZGlmeVZhcnM9aSkscS5sb2FkRmlsZShhLmhyZWYsbnVsbCxrLG8sZnVuY3Rpb24oYSxjKXtyZXR1cm4gYT92b2lkIGIoYSk6dm9pZCBqKGMpfSl9ZnVuY3Rpb24gayhhLGIsYyl7Zm9yKHZhciBkPTA7bi5zaGVldHMubGVuZ3RoPmQ7ZCsrKWoobi5zaGVldHNbZF0sYSxiLG4uc2hlZXRzLmxlbmd0aC0oZCsxKSxjKX1mdW5jdGlvbiBsKCl7ImRldmVsb3BtZW50Ij09PW4uZW52JiYobi53YXRjaFRpbWVyPXNldEludGVydmFsKGZ1bmN0aW9uKCl7bi53YXRjaE1vZGUmJihxLmNsZWFyRmlsZUNhY2hlKCksayhmdW5jdGlvbihhLGMsZSxmKXthP3IuYWRkKGEsYS5ocmVmfHxmLmhyZWYpOmMmJmQuY3JlYXRlQ1NTKGIuZG9jdW1lbnQsYyxmKX0pKX0sZS5wb2xsKSl9dmFyIG09Yi5kb2N1bWVudCxuPWEoIi4uL2xlc3MiKSgpO24ub3B0aW9ucz1lO3ZhciBvPW4uZW52aXJvbm1lbnQscD1hKCIuL2ZpbGUtbWFuYWdlciIpKGUsbi5sb2dnZXIpLHE9bmV3IHA7by5hZGRGaWxlTWFuYWdlcihxKSxuLkZpbGVNYW5hZ2VyPXAsYSgiLi9sb2ctbGlzdGVuZXIiKShuLGUpO3ZhciByPWEoIi4vZXJyb3ItcmVwb3J0aW5nIikoYixuLGUpLHM9bi5jYWNoZT1lLmNhY2hlfHxhKCIuL2NhY2hlIikoYixlLG4ubG9nZ2VyKTtlLmZ1bmN0aW9ucyYmbi5mdW5jdGlvbnMuZnVuY3Rpb25SZWdpc3RyeS5hZGRNdWx0aXBsZShlLmZ1bmN0aW9ucyk7dmFyIHQ9L150ZXh0XC8oeC0pP2xlc3MkLztyZXR1cm4gbi53YXRjaD1mdW5jdGlvbigpe3JldHVybiBuLndhdGNoTW9kZXx8KG4uZW52PSJkZXZlbG9wbWVudCIsbCgpKSx0aGlzLndhdGNoTW9kZT0hMCwhMH0sbi51bndhdGNoPWZ1bmN0aW9uKCl7cmV0dXJuIGNsZWFySW50ZXJ2YWwobi53YXRjaFRpbWVyKSx0aGlzLndhdGNoTW9kZT0hMSwhMX0sbi5yZWdpc3RlclN0eWxlc2hlZXRzSW1tZWRpYXRlbHk9ZnVuY3Rpb24oKXt2YXIgYT1tLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIik7bi5zaGVldHM9W107Zm9yKHZhciBiPTA7YS5sZW5ndGg+YjtiKyspKCJzdHlsZXNoZWV0L2xlc3MiPT09YVtiXS5yZWx8fGFbYl0ucmVsLm1hdGNoKC9zdHlsZXNoZWV0LykmJmFbYl0udHlwZS5tYXRjaCh0KSkmJm4uc2hlZXRzLnB1c2goYVtiXSl9LG4ucmVnaXN0ZXJTdHlsZXNoZWV0cz1mdW5jdGlvbigpe3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihhKXtuLnJlZ2lzdGVyU3R5bGVzaGVldHNJbW1lZGlhdGVseSgpLGEoKX0pfSxuLm1vZGlmeVZhcnM9ZnVuY3Rpb24oYSl7cmV0dXJuIG4ucmVmcmVzaCghMCxhLCExKX0sbi5yZWZyZXNoPWZ1bmN0aW9uKGEsYyxlKXtyZXR1cm4oYXx8ZSkmJmUhPT0hMSYmcS5jbGVhckZpbGVDYWNoZSgpLG5ldyBQcm9taXNlKGZ1bmN0aW9uKGUsZil7dmFyIGcsaCxqO2c9aD1uZXcgRGF0ZSxrKGZ1bmN0aW9uKGEsYyxpLGssbCl7cmV0dXJuIGE/KHIuYWRkKGEsYS5ocmVmfHxrLmhyZWYpLHZvaWQgZihhKSk6KG4ubG9nZ2VyLmluZm8obC5sb2NhbD8ibG9hZGluZyAiK2suaHJlZisiIGZyb20gY2FjaGUuIjoicmVuZGVyZWQgIitrLmhyZWYrIiBzdWNjZXNzZnVsbHkuIiksZC5jcmVhdGVDU1MoYi5kb2N1bWVudCxjLGspLG4ubG9nZ2VyLmluZm8oImNzcyBmb3IgIitrLmhyZWYrIiBnZW5lcmF0ZWQgaW4gIisobmV3IERhdGUtaCkrIm1zIiksMD09PWwucmVtYWluaW5nJiYoaj1uZXcgRGF0ZS1nLG4ubG9nZ2VyLmluZm8oImxlc3MgaGFzIGZpbmlzaGVkLiBjc3MgZ2VuZXJhdGVkIGluICIraisibXMiKSxlKHtzdGFydFRpbWU6ZyxlbmRUaW1lOmgsdG90YWxNaWxsaXNlY29uZHM6aixzaGVldHM6bi5zaGVldHMubGVuZ3RofSkpLHZvaWQoaD1uZXcgRGF0ZSkpfSxhLGMpLGkoYyl9KX0sbi5yZWZyZXNoU3R5bGVzPWksbn19LHsiLi4vbGVzcyI6MjksIi4vYnJvd3NlciI6MywiLi9jYWNoZSI6NCwiLi9lcnJvci1yZXBvcnRpbmciOjUsIi4vZmlsZS1tYW5hZ2VyIjo2LCIuL2xvZy1saXN0ZW5lciI6OCwiLi91dGlscyI6OX1dLDg6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPWZ1bmN0aW9uKGEsYil7dmFyIGM9NCxkPTMsZT0yLGY9MTtiLmxvZ0xldmVsPSJ1bmRlZmluZWQiIT10eXBlb2YgYi5sb2dMZXZlbD9iLmxvZ0xldmVsOiJkZXZlbG9wbWVudCI9PT1iLmVudj9kOmYsYi5sb2dnZXJzfHwoYi5sb2dnZXJzPVt7ZGVidWc6ZnVuY3Rpb24oYSl7Yi5sb2dMZXZlbD49YyYmY29uc29sZS5sb2coYSl9LGluZm86ZnVuY3Rpb24oYSl7Yi5sb2dMZXZlbD49ZCYmY29uc29sZS5sb2coYSl9LHdhcm46ZnVuY3Rpb24oYSl7Yi5sb2dMZXZlbD49ZSYmY29uc29sZS53YXJuKGEpfSxlcnJvcjpmdW5jdGlvbihhKXtiLmxvZ0xldmVsPj1mJiZjb25zb2xlLmVycm9yKGEpfX1dKTtmb3IodmFyIGc9MDtiLmxvZ2dlcnMubGVuZ3RoPmc7ZysrKWEubG9nZ2VyLmFkZExpc3RlbmVyKGIubG9nZ2Vyc1tnXSl9fSx7fV0sOTpbZnVuY3Rpb24oYSxiKXtiLmV4cG9ydHM9e2V4dHJhY3RJZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5yZXBsYWNlKC9eW2Etei1dKzpcLys/W15cL10rLywiIikucmVwbGFjZSgvW1w/XCZdbGl2ZXJlbG9hZD1cdysvLCIiKS5yZXBsYWNlKC9eXC8vLCIiKS5yZXBsYWNlKC9cLlthLXpBLVpdKyQvLCIiKS5yZXBsYWNlKC9bXlwuXHctXSsvZywiLSIpLnJlcGxhY2UoL1wuL2csIjoiKX0sYWRkRGF0YUF0dHI6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGMgaW4gYi5kYXRhc2V0KWlmKGIuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eShjKSlpZigiZW52Ij09PWN8fCJkdW1wTGluZU51bWJlcnMiPT09Y3x8InJvb3RwYXRoIj09PWN8fCJlcnJvclJlcG9ydGluZyI9PT1jKWFbY109Yi5kYXRhc2V0W2NdO2Vsc2UgdHJ5e2FbY109SlNPTi5wYXJzZShiLmRhdGFzZXRbY10pfWNhdGNoKGQpe319fX0se31dLDEwOltmdW5jdGlvbihhLGIpe3ZhciBjPXt9O2IuZXhwb3J0cz1jO3ZhciBkPWZ1bmN0aW9uKGEsYixjKXtpZihhKWZvcih2YXIgZD0wO2MubGVuZ3RoPmQ7ZCsrKWEuaGFzT3duUHJvcGVydHkoY1tkXSkmJihiW2NbZF1dPWFbY1tkXV0pfSxlPVsicGF0aHMiLCJyZWxhdGl2ZVVybHMiLCJyb290cGF0aCIsInN0cmljdEltcG9ydHMiLCJpbnNlY3VyZSIsImR1bXBMaW5lTnVtYmVycyIsImNvbXByZXNzIiwic3luY0ltcG9ydCIsImNodW5rSW5wdXQiLCJtaW1lIiwidXNlRmlsZUNhY2hlIiwicHJvY2Vzc0ltcG9ydHMiLCJyZWZlcmVuY2UiLCJwbHVnaW5NYW5hZ2VyIl07Yy5QYXJzZT1mdW5jdGlvbihhKXtkKGEsdGhpcyxlKSwic3RyaW5nIj09dHlwZW9mIHRoaXMucGF0aHMmJih0aGlzLnBhdGhzPVt0aGlzLnBhdGhzXSl9O3ZhciBmPVsicGF0aHMiLCJjb21wcmVzcyIsImllQ29tcGF0Iiwic3RyaWN0TWF0aCIsInN0cmljdFVuaXRzIiwic291cmNlTWFwIiwiaW1wb3J0TXVsdGlwbGUiLCJ1cmxBcmdzIiwiamF2YXNjcmlwdEVuYWJsZWQiLCJwbHVnaW5NYW5hZ2VyIiwiaW1wb3J0YW50U2NvcGUiXTtjLkV2YWw9ZnVuY3Rpb24oYSxiKXtkKGEsdGhpcyxmKSwic3RyaW5nIj09dHlwZW9mIHRoaXMucGF0aHMmJih0aGlzLnBhdGhzPVt0aGlzLnBhdGhzXSksdGhpcy5mcmFtZXM9Ynx8W10sdGhpcy5pbXBvcnRhbnRTY29wZT10aGlzLmltcG9ydGFudFNjb3BlfHxbXX0sYy5FdmFsLnByb3RvdHlwZS5pblBhcmVudGhlc2lzPWZ1bmN0aW9uKCl7dGhpcy5wYXJlbnNTdGFja3x8KHRoaXMucGFyZW5zU3RhY2s9W10pLHRoaXMucGFyZW5zU3RhY2sucHVzaCghMCl9LGMuRXZhbC5wcm90b3R5cGUub3V0T2ZQYXJlbnRoZXNpcz1mdW5jdGlvbigpe3RoaXMucGFyZW5zU3RhY2sucG9wKCl9LGMuRXZhbC5wcm90b3R5cGUuaXNNYXRoT249ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zdHJpY3RNYXRoP3RoaXMucGFyZW5zU3RhY2smJnRoaXMucGFyZW5zU3RhY2subGVuZ3RoOiEwfSxjLkV2YWwucHJvdG90eXBlLmlzUGF0aFJlbGF0aXZlPWZ1bmN0aW9uKGEpe3JldHVybiEvXig/OlthLXotXSs6fFwvfCMpL2kudGVzdChhKX0sYy5FdmFsLnByb3RvdHlwZS5ub3JtYWxpemVQYXRoPWZ1bmN0aW9uKGEpe3ZhciBiLGM9YS5zcGxpdCgiLyIpLnJldmVyc2UoKTtmb3IoYT1bXTswIT09Yy5sZW5ndGg7KXN3aXRjaChiPWMucG9wKCkpe2Nhc2UiLiI6YnJlYWs7Y2FzZSIuLiI6MD09PWEubGVuZ3RofHwiLi4iPT09YVthLmxlbmd0aC0xXT9hLnB1c2goYik6YS5wb3AoKTticmVhaztkZWZhdWx0OmEucHVzaChiKX1yZXR1cm4gYS5qb2luKCIvIil9fSx7fV0sMTE6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPXthbGljZWJsdWU6IiNmMGY4ZmYiLGFudGlxdWV3aGl0ZToiI2ZhZWJkNyIsYXF1YToiIzAwZmZmZiIsYXF1YW1hcmluZToiIzdmZmZkNCIsYXp1cmU6IiNmMGZmZmYiLGJlaWdlOiIjZjVmNWRjIixiaXNxdWU6IiNmZmU0YzQiLGJsYWNrOiIjMDAwMDAwIixibGFuY2hlZGFsbW9uZDoiI2ZmZWJjZCIsYmx1ZToiIzAwMDBmZiIsYmx1ZXZpb2xldDoiIzhhMmJlMiIsYnJvd246IiNhNTJhMmEiLGJ1cmx5d29vZDoiI2RlYjg4NyIsY2FkZXRibHVlOiIjNWY5ZWEwIixjaGFydHJldXNlOiIjN2ZmZjAwIixjaG9jb2xhdGU6IiNkMjY5MWUiLGNvcmFsOiIjZmY3ZjUwIixjb3JuZmxvd2VyYmx1ZToiIzY0OTVlZCIsY29ybnNpbGs6IiNmZmY4ZGMiLGNyaW1zb246IiNkYzE0M2MiLGN5YW46IiMwMGZmZmYiLGRhcmtibHVlOiIjMDAwMDhiIixkYXJrY3lhbjoiIzAwOGI4YiIsZGFya2dvbGRlbnJvZDoiI2I4ODYwYiIsZGFya2dyYXk6IiNhOWE5YTkiLGRhcmtncmV5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmtzbGF0ZWdyZXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZGltZ3JleToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmV5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IixpbmRpYW5yZWQ6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmF5OiIjZDNkM2QzIixsaWdodGdyZXk6IiNkM2QzZDMiLGxpZ2h0Z3JlZW46IiM5MGVlOTAiLGxpZ2h0cGluazoiI2ZmYjZjMSIsbGlnaHRzYWxtb246IiNmZmEwN2EiLGxpZ2h0c2VhZ3JlZW46IiMyMGIyYWEiLGxpZ2h0c2t5Ymx1ZToiIzg3Y2VmYSIsbGlnaHRzbGF0ZWdyYXk6IiM3Nzg4OTkiLGxpZ2h0c2xhdGVncmV5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc2xhdGVncmV5OiIjNzA4MDkwIixzbm93OiIjZmZmYWZhIixzcHJpbmdncmVlbjoiIzAwZmY3ZiIsc3RlZWxibHVlOiIjNDY4MmI0Iix0YW46IiNkMmI0OGMiLHRlYWw6IiMwMDgwODAiLHRoaXN0bGU6IiNkOGJmZDgiLHRvbWF0bzoiI2ZmNjM0NyIsdHVycXVvaXNlOiIjNDBlMGQwIix2aW9sZXQ6IiNlZTgyZWUiLHdoZWF0OiIjZjVkZWIzIix3aGl0ZToiI2ZmZmZmZiIsd2hpdGVzbW9rZToiI2Y1ZjVmNSIseWVsbG93OiIjZmZmZjAwIix5ZWxsb3dncmVlbjoiIzlhY2QzMiJ9fSx7fV0sMTI6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPXtjb2xvcnM6YSgiLi9jb2xvcnMiKSx1bml0Q29udmVyc2lvbnM6YSgiLi91bml0LWNvbnZlcnNpb25zIil9fSx7Ii4vY29sb3JzIjoxMSwiLi91bml0LWNvbnZlcnNpb25zIjoxM31dLDEzOltmdW5jdGlvbihhLGIpe2IuZXhwb3J0cz17bGVuZ3RoOnttOjEsY206LjAxLG1tOi4wMDEsImluIjouMDI1NCxweDouMDI1NC85NixwdDouMDI1NC83MixwYzouMDI1NC83MioxMn0sZHVyYXRpb246e3M6MSxtczouMDAxfSxhbmdsZTp7cmFkOjEvKDIqTWF0aC5QSSksZGVnOjEvMzYwLGdyYWQ6LjAwMjUsdHVybjoxfX19LHt9XSwxNDpbZnVuY3Rpb24oYSxiKXt2YXIgYz1mdW5jdGlvbigpe307Yy5wcm90b3R5cGUuZ2V0UGF0aD1mdW5jdGlvbihhKXt2YXIgYj1hLmxhc3RJbmRleE9mKCI/Iik7cmV0dXJuIGI+MCYmKGE9YS5zbGljZSgwLGIpKSxiPWEubGFzdEluZGV4T2YoIi8iKSwwPmImJihiPWEubGFzdEluZGV4T2YoIlxcIikpLDA+Yj8iIjphLnNsaWNlKDAsYisxKX0sYy5wcm90b3R5cGUudHJ5QXBwZW5kRXh0ZW5zaW9uPWZ1bmN0aW9uKGEsYil7cmV0dXJuLyhcLlthLXpdKiQpfChbXD87XS4qKSQvLnRlc3QoYSk/YTphK2J9LGMucHJvdG90eXBlLnRyeUFwcGVuZExlc3NFeHRlbnNpb249ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMudHJ5QXBwZW5kRXh0ZW5zaW9uKGEsIi5sZXNzIil9LGMucHJvdG90eXBlLnN1cHBvcnRzU3luYz1mdW5jdGlvbigpe3JldHVybiExfSxjLnByb3RvdHlwZS5hbHdheXNNYWtlUGF0aHNBYnNvbHV0ZT1mdW5jdGlvbigpe3JldHVybiExfSxjLnByb3RvdHlwZS5pc1BhdGhBYnNvbHV0ZT1mdW5jdGlvbihhKXtyZXR1cm4vXig/OlthLXotXSs6fFwvfFxcfCMpL2kudGVzdChhKX0sYy5wcm90b3R5cGUuam9pbj1mdW5jdGlvbihhLGIpe3JldHVybiBhP2ErYjpifSxjLnByb3RvdHlwZS5wYXRoRGlmZj1mdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmLGc9dGhpcy5leHRyYWN0VXJsUGFydHMoYSksaD10aGlzLmV4dHJhY3RVcmxQYXJ0cyhiKSxpPSIiO2lmKGcuaG9zdFBhcnQhPT1oLmhvc3RQYXJ0KXJldHVybiIiO2ZvcihkPU1hdGgubWF4KGguZGlyZWN0b3JpZXMubGVuZ3RoLGcuZGlyZWN0b3JpZXMubGVuZ3RoKSxjPTA7ZD5jJiZoLmRpcmVjdG9yaWVzW2NdPT09Zy5kaXJlY3Rvcmllc1tjXTtjKyspO2ZvcihmPWguZGlyZWN0b3JpZXMuc2xpY2UoYyksZT1nLmRpcmVjdG9yaWVzLnNsaWNlKGMpLGM9MDtmLmxlbmd0aC0xPmM7YysrKWkrPSIuLi8iO2ZvcihjPTA7ZS5sZW5ndGgtMT5jO2MrKylpKz1lW2NdKyIvIjtyZXR1cm4gaX0sYy5wcm90b3R5cGUuZXh0cmFjdFVybFBhcnRzPWZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlPS9eKCg/OlthLXotXSs6KT9cLys/KD86W15cL1w/I10qXC8pfChbXC9cXF0pKT8oKD86W15cL1xcXD8jXSpbXC9cXF0pKikoW15cL1xcXD8jXSopKFsjXD9dLiopPyQvaSxmPWEubWF0Y2goZSksZz17fSxoPVtdO2lmKCFmKXRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IHBhcnNlIHNoZWV0IGhyZWYgLSAnIithKyInIik7aWYoYiYmKCFmWzFdfHxmWzJdKSl7aWYoZD1iLm1hdGNoKGUpLCFkKXRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IHBhcnNlIHBhZ2UgdXJsIC0gJyIrYisiJyIpO2ZbMV09ZlsxXXx8ZFsxXXx8IiIsZlsyXXx8KGZbM109ZFszXStmWzNdKX1pZihmWzNdKXtmb3IoaD1mWzNdLnJlcGxhY2UoL1xcL2csIi8iKS5zcGxpdCgiLyIpLGM9MDtoLmxlbmd0aD5jO2MrKykiLiI9PT1oW2NdJiYoaC5zcGxpY2UoYywxKSxjLT0xKTtmb3IoYz0wO2gubGVuZ3RoPmM7YysrKSIuLiI9PT1oW2NdJiZjPjAmJihoLnNwbGljZShjLTEsMiksYy09Mil9cmV0dXJuIGcuaG9zdFBhcnQ9ZlsxXSxnLmRpcmVjdG9yaWVzPWgsZy5wYXRoPShmWzFdfHwiIikraC5qb2luKCIvIiksZy5maWxlVXJsPWcucGF0aCsoZls0XXx8IiIpLGcudXJsPWcuZmlsZVVybCsoZls1XXx8IiIpLGd9LGIuZXhwb3J0cz1jfSx7fV0sMTU6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi4vbG9nZ2VyIiksZD1mdW5jdGlvbihhLGIpe3RoaXMuZmlsZU1hbmFnZXJzPWJ8fFtdLGE9YXx8e307Zm9yKHZhciBjPVsiZW5jb2RlQmFzZTY0IiwibWltZUxvb2t1cCIsImNoYXJzZXRMb29rdXAiLCJnZXRTb3VyY2VNYXBHZW5lcmF0b3IiXSxkPVtdLGU9ZC5jb25jYXQoYyksZj0wO2UubGVuZ3RoPmY7ZisrKXt2YXIgZz1lW2ZdLGg9YVtnXTtoP3RoaXNbZ109aC5iaW5kKGEpOmQubGVuZ3RoPmYmJnRoaXMud2FybigibWlzc2luZyByZXF1aXJlZCBmdW5jdGlvbiBpbiBlbnZpcm9ubWVudCAtICIrZyl9fTtkLnByb3RvdHlwZS5nZXRGaWxlTWFuYWdlcj1mdW5jdGlvbihhLGIsZCxlLGYpe2F8fGMud2FybigiZ2V0RmlsZU1hbmFnZXIgY2FsbGVkIHdpdGggbm8gZmlsZW5hbWUuLiBQbGVhc2UgcmVwb3J0IHRoaXMgaXNzdWUuIGNvbnRpbnVpbmcuIiksbnVsbD09YiYmYy53YXJuKCJnZXRGaWxlTWFuYWdlciBjYWxsZWQgd2l0aCBudWxsIGRpcmVjdG9yeS4uIFBsZWFzZSByZXBvcnQgdGhpcyBpc3N1ZS4gY29udGludWluZy4iKTt2YXIgZz10aGlzLmZpbGVNYW5hZ2VycztkLnBsdWdpbk1hbmFnZXImJihnPVtdLmNvbmNhdChnKS5jb25jYXQoZC5wbHVnaW5NYW5hZ2VyLmdldEZpbGVNYW5hZ2VycygpKSk7Zm9yKHZhciBoPWcubGVuZ3RoLTE7aD49MDtoLS0pe3ZhciBpPWdbaF07aWYoaVtmPyJzdXBwb3J0c1N5bmMiOiJzdXBwb3J0cyJdKGEsYixkLGUpKXJldHVybiBpfXJldHVybiBudWxsfSxkLnByb3RvdHlwZS5hZGRGaWxlTWFuYWdlcj1mdW5jdGlvbihhKXt0aGlzLmZpbGVNYW5hZ2Vycy5wdXNoKGEpfSxkLnByb3RvdHlwZS5jbGVhckZpbGVNYW5hZ2Vycz1mdW5jdGlvbigpe3RoaXMuZmlsZU1hbmFnZXJzPVtdfSxiLmV4cG9ydHM9ZH0seyIuLi9sb2dnZXIiOjMxfV0sMTY6W2Z1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYSxiLGQpe3ZhciBlLGYsZyxoLGk9Yi5hbHBoYSxqPWQuYWxwaGEsaz1bXTtnPWoraSooMS1qKTtmb3IodmFyIGw9MDszPmw7bCsrKWU9Yi5yZ2JbbF0vMjU1LGY9ZC5yZ2JbbF0vMjU1LGg9YShlLGYpLGcmJihoPShqKmYraSooZS1qKihlK2YtaCkpKS9nKSxrW2xdPTI1NSpoO3JldHVybiBuZXcgYyhrLGcpfXZhciBjPWEoIi4uL3RyZWUvY29sb3IiKSxkPWEoIi4vZnVuY3Rpb24tcmVnaXN0cnkiKSxlPXttdWx0aXBseTpmdW5jdGlvbihhLGIpe3JldHVybiBhKmJ9LHNjcmVlbjpmdW5jdGlvbihhLGIpe3JldHVybiBhK2ItYSpifSxvdmVybGF5OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEqPTIsMT49YT9lLm11bHRpcGx5KGEsYik6ZS5zY3JlZW4oYS0xLGIpfSxzb2Z0bGlnaHQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz0xLGQ9YTtyZXR1cm4gYj4uNSYmKGQ9MSxjPWE+LjI1P01hdGguc3FydChhKTooKDE2KmEtMTIpKmErNCkqYSksYS0oMS0yKmIpKmQqKGMtYSl9LGhhcmRsaWdodDpmdW5jdGlvbihhLGIpe3JldHVybiBlLm92ZXJsYXkoYixhKX0sZGlmZmVyZW5jZTpmdW5jdGlvbihhLGIpe3JldHVybiBNYXRoLmFicyhhLWIpfSxleGNsdXNpb246ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYStiLTIqYSpifSxhdmVyYWdlOmZ1bmN0aW9uKGEsYil7cmV0dXJuKGErYikvMn0sbmVnYXRpb246ZnVuY3Rpb24oYSxiKXtyZXR1cm4gMS1NYXRoLmFicyhhK2ItMSl9fTtmb3IodmFyIGYgaW4gZSllLmhhc093blByb3BlcnR5KGYpJiYoYltmXT1iLmJpbmQobnVsbCxlW2ZdKSk7ZC5hZGRNdWx0aXBsZShiKX0seyIuLi90cmVlL2NvbG9yIjo0OCwiLi9mdW5jdGlvbi1yZWdpc3RyeSI6MjF9XSwxNzpbZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhKXtyZXR1cm4gTWF0aC5taW4oMSxNYXRoLm1heCgwLGEpKX1mdW5jdGlvbiBjKGEpe3JldHVybiBmLmhzbGEoYS5oLGEucyxhLmwsYS5hKX1mdW5jdGlvbiBkKGEpe2lmKGEgaW5zdGFuY2VvZiBnKXJldHVybiBwYXJzZUZsb2F0KGEudW5pdC5pcygiJSIpP2EudmFsdWUvMTAwOmEudmFsdWUpO2lmKCJudW1iZXIiPT10eXBlb2YgYSlyZXR1cm4gYTt0aHJvd3t0eXBlOiJBcmd1bWVudCIsbWVzc2FnZToiY29sb3IgZnVuY3Rpb25zIHRha2UgbnVtYmVycyBhcyBwYXJhbWV0ZXJzIn19ZnVuY3Rpb24gZShhLGIpe3JldHVybiBhIGluc3RhbmNlb2YgZyYmYS51bml0LmlzKCIlIik/cGFyc2VGbG9hdChhLnZhbHVlKmIvMTAwKTpkKGEpfXZhciBmLGc9YSgiLi4vdHJlZS9kaW1lbnNpb24iKSxoPWEoIi4uL3RyZWUvY29sb3IiKSxpPWEoIi4uL3RyZWUvcXVvdGVkIiksaj1hKCIuLi90cmVlL2Fub255bW91cyIpLGs9YSgiLi9mdW5jdGlvbi1yZWdpc3RyeSIpO2Y9e3JnYjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYucmdiYShhLGIsYywxKX0scmdiYTpmdW5jdGlvbihhLGIsYyxmKXt2YXIgZz1bYSxiLGNdLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gZShhLDI1NSl9KTtyZXR1cm4gZj1kKGYpLG5ldyBoKGcsZil9LGhzbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuaHNsYShhLGIsYywxKX0saHNsYTpmdW5jdGlvbihhLGMsZSxnKXtmdW5jdGlvbiBoKGEpe3JldHVybiBhPTA+YT9hKzE6YT4xP2EtMTphLDE+NiphP2orKGktaikqYSo2OjE+MiphP2k6Mj4zKmE/aisoaS1qKSooMi8zLWEpKjY6an1hPWQoYSklMzYwLzM2MCxjPWIoZChjKSksZT1iKGQoZSkpLGc9YihkKGcpKTt2YXIgaT0uNT49ZT9lKihjKzEpOmUrYy1lKmMsaj0yKmUtaTtyZXR1cm4gZi5yZ2JhKDI1NSpoKGErMS8zKSwyNTUqaChhKSwyNTUqaChhLTEvMyksZyl9LGhzdjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuaHN2YShhLGIsYywxKX0saHN2YTpmdW5jdGlvbihhLGIsYyxlKXthPWQoYSklMzYwLzM2MCozNjAsYj1kKGIpLGM9ZChjKSxlPWQoZSk7dmFyIGcsaDtnPU1hdGguZmxvb3IoYS82MCU2KSxoPWEvNjAtZzt2YXIgaT1bYyxjKigxLWIpLGMqKDEtaCpiKSxjKigxLSgxLWgpKmIpXSxqPVtbMCwzLDFdLFsyLDAsMV0sWzEsMCwzXSxbMSwyLDBdLFszLDEsMF0sWzAsMSwyXV07cmV0dXJuIGYucmdiYSgyNTUqaVtqW2ddWzBdXSwyNTUqaVtqW2ddWzFdXSwyNTUqaVtqW2ddWzJdXSxlKX0saHVlOmZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZyhhLnRvSFNMKCkuaCl9LHNhdHVyYXRpb246ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBnKDEwMCphLnRvSFNMKCkucywiJSIpfSxsaWdodG5lc3M6ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBnKDEwMCphLnRvSFNMKCkubCwiJSIpfSxoc3ZodWU6ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBnKGEudG9IU1YoKS5oKX0saHN2c2F0dXJhdGlvbjpmdW5jdGlvbihhKXtyZXR1cm4gbmV3IGcoMTAwKmEudG9IU1YoKS5zLCIlIil9LGhzdnZhbHVlOmZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZygxMDAqYS50b0hTVigpLnYsIiUiKX0scmVkOmZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZyhhLnJnYlswXSl9LGdyZWVuOmZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZyhhLnJnYlsxXSl9LGJsdWU6ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBnKGEucmdiWzJdKX0sYWxwaGE6ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBnKGEudG9IU0woKS5hKX0sbHVtYTpmdW5jdGlvbihhKXtyZXR1cm4gbmV3IGcoYS5sdW1hKCkqYS5hbHBoYSoxMDAsIiUiKX0sbHVtaW5hbmNlOmZ1bmN0aW9uKGEpe3ZhciBiPS4yMTI2KmEucmdiWzBdLzI1NSsuNzE1MiphLnJnYlsxXS8yNTUrLjA3MjIqYS5yZ2JbMl0vMjU1O3JldHVybiBuZXcgZyhiKmEuYWxwaGEqMTAwLCIlIil9LHNhdHVyYXRlOmZ1bmN0aW9uKGEsZCxlKXtpZighYS5yZ2IpcmV0dXJuIG51bGw7dmFyIGY9YS50b0hTTCgpO3JldHVybiBmLnMrPSJ1bmRlZmluZWQiIT10eXBlb2YgZSYmInJlbGF0aXZlIj09PWUudmFsdWU/Zi5zKmQudmFsdWUvMTAwOmQudmFsdWUvMTAwLGYucz1iKGYucyksYyhmKX0sZGVzYXR1cmF0ZTpmdW5jdGlvbihhLGQsZSl7dmFyIGY9YS50b0hTTCgpO3JldHVybiBmLnMtPSJ1bmRlZmluZWQiIT10eXBlb2YgZSYmInJlbGF0aXZlIj09PWUudmFsdWU/Zi5zKmQudmFsdWUvMTAwOmQudmFsdWUvMTAwLGYucz1iKGYucyksYyhmKX0sbGlnaHRlbjpmdW5jdGlvbihhLGQsZSl7dmFyIGY9YS50b0hTTCgpO3JldHVybiBmLmwrPSJ1bmRlZmluZWQiIT10eXBlb2YgZSYmInJlbGF0aXZlIj09PWUudmFsdWU/Zi5sKmQudmFsdWUvMTAwOmQudmFsdWUvMTAwLGYubD1iKGYubCksYyhmKX0sZGFya2VuOmZ1bmN0aW9uKGEsZCxlKXt2YXIgZj1hLnRvSFNMKCk7cmV0dXJuIGYubC09InVuZGVmaW5lZCIhPXR5cGVvZiBlJiYicmVsYXRpdmUiPT09ZS52YWx1ZT9mLmwqZC52YWx1ZS8xMDA6ZC52YWx1ZS8xMDAsZi5sPWIoZi5sKSxjKGYpfSxmYWRlaW46ZnVuY3Rpb24oYSxkLGUpe3ZhciBmPWEudG9IU0woKTtyZXR1cm4gZi5hKz0idW5kZWZpbmVkIiE9dHlwZW9mIGUmJiJyZWxhdGl2ZSI9PT1lLnZhbHVlP2YuYSpkLnZhbHVlLzEwMDpkLnZhbHVlLzEwMCxmLmE9YihmLmEpLGMoZil9LGZhZGVvdXQ6ZnVuY3Rpb24oYSxkLGUpe3ZhciBmPWEudG9IU0woKTtyZXR1cm4gZi5hLT0idW5kZWZpbmVkIiE9dHlwZW9mIGUmJiJyZWxhdGl2ZSI9PT1lLnZhbHVlP2YuYSpkLnZhbHVlLzEwMDpkLnZhbHVlLzEwMCxmLmE9YihmLmEpLGMoZil9LGZhZGU6ZnVuY3Rpb24oYSxkKXt2YXIgZT1hLnRvSFNMKCk7cmV0dXJuIGUuYT1kLnZhbHVlLzEwMCxlLmE9YihlLmEpLGMoZSl9LHNwaW46ZnVuY3Rpb24oYSxiKXt2YXIgZD1hLnRvSFNMKCksZT0oZC5oK2IudmFsdWUpJTM2MDtyZXR1cm4gZC5oPTA+ZT8zNjArZTplLGMoZCl9LG1peDpmdW5jdGlvbihhLGIsYyl7YS50b0hTTCYmYi50b0hTTHx8KGNvbnNvbGUubG9nKGIudHlwZSksY29uc29sZS5kaXIoYikpLGN8fChjPW5ldyBnKDUwKSk7dmFyIGQ9Yy52YWx1ZS8xMDAsZT0yKmQtMSxmPWEudG9IU0woKS5hLWIudG9IU0woKS5hLGk9KChlKmY9PS0xP2U6KGUrZikvKDErZSpmKSkrMSkvMixqPTEtaSxrPVthLnJnYlswXSppK2IucmdiWzBdKmosYS5yZ2JbMV0qaStiLnJnYlsxXSpqLGEucmdiWzJdKmkrYi5yZ2JbMl0qal0sbD1hLmFscGhhKmQrYi5hbHBoYSooMS1kKTtyZXR1cm4gbmV3IGgoayxsKX0sZ3JleXNjYWxlOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRlc2F0dXJhdGUoYSxuZXcgZygxMDApKX0sY29udHJhc3Q6ZnVuY3Rpb24oYSxiLGMsZSl7aWYoIWEucmdiKXJldHVybiBudWxsO2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgYyYmKGM9Zi5yZ2JhKDI1NSwyNTUsMjU1LDEpKSwidW5kZWZpbmVkIj09dHlwZW9mIGImJihiPWYucmdiYSgwLDAsMCwxKSksYi5sdW1hKCk+Yy5sdW1hKCkpe3ZhciBnPWM7Yz1iLGI9Z31yZXR1cm4gZT0idW5kZWZpbmVkIj09dHlwZW9mIGU/LjQzOmQoZSksYS5sdW1hKCk8ZT9jOmJ9LGFyZ2I6ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBqKGEudG9BUkdCKCkpfSxjb2xvcjpmdW5jdGlvbihhKXtpZihhIGluc3RhbmNlb2YgaSYmL14jKFthLWYwLTldezZ9fFthLWYwLTldezN9KSQvaS50ZXN0KGEudmFsdWUpKXJldHVybiBuZXcgaChhLnZhbHVlLnNsaWNlKDEpKTtpZihhIGluc3RhbmNlb2YgaHx8KGE9aC5mcm9tS2V5d29yZChhLnZhbHVlKSkpcmV0dXJuIGEudmFsdWU9dm9pZCAwLGE7dGhyb3d7dHlwZToiQXJndW1lbnQiLG1lc3NhZ2U6ImFyZ3VtZW50IG11c3QgYmUgYSBjb2xvciBrZXl3b3JkIG9yIDMvNiBkaWdpdCBoZXggZS5nLiAjRkZGIn19LHRpbnQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5taXgoZi5yZ2IoMjU1LDI1NSwyNTUpLGEsYil9LHNoYWRlOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGYubWl4KGYucmdiKDAsMCwwKSxhLGIpfX0say5hZGRNdWx0aXBsZShmKX0seyIuLi90cmVlL2Fub255bW91cyI6NDQsIi4uL3RyZWUvY29sb3IiOjQ4LCIuLi90cmVlL2RpbWVuc2lvbiI6NTQsIi4uL3RyZWUvcXVvdGVkIjo3MSwiLi9mdW5jdGlvbi1yZWdpc3RyeSI6MjF9XSwxODpbZnVuY3Rpb24oYSxiKXtiLmV4cG9ydHM9ZnVuY3Rpb24oYil7dmFyIGM9YSgiLi4vdHJlZS9xdW90ZWQiKSxkPWEoIi4uL3RyZWUvdXJsIiksZT1hKCIuL2Z1bmN0aW9uLXJlZ2lzdHJ5IiksZj1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgZChiLGEuaW5kZXgsYS5jdXJyZW50RmlsZUluZm8pLmV2YWwoYS5jb250ZXh0KX0sZz1hKCIuLi9sb2dnZXIiKTtlLmFkZCgiZGF0YS11cmkiLGZ1bmN0aW9uKGEsZSl7ZXx8KGU9YSxhPW51bGwpO3ZhciBoPWEmJmEudmFsdWUsaT1lLnZhbHVlLGo9dGhpcy5jdXJyZW50RmlsZUluZm8saz1qLnJlbGF0aXZlVXJscz9qLmN1cnJlbnREaXJlY3Rvcnk6ai5lbnRyeVBhdGgsbD1pLmluZGV4T2YoIiMiKSxtPSIiOy0xIT09bCYmKG09aS5zbGljZShsKSxpPWkuc2xpY2UoMCxsKSk7dmFyIG49Yi5nZXRGaWxlTWFuYWdlcihpLGssdGhpcy5jb250ZXh0LGIsITApO2lmKCFuKXJldHVybiBmKHRoaXMsZSk7dmFyIG89ITE7aWYoYSlvPS87YmFzZTY0JC8udGVzdChoKTtlbHNle2lmKGg9Yi5taW1lTG9va3VwKGkpLCJpbWFnZS9zdmcreG1sIj09PWgpbz0hMTtlbHNle3ZhciBwPWIuY2hhcnNldExvb2t1cChoKTtvPVsiVVMtQVNDSUkiLCJVVEYtOCJdLmluZGV4T2YocCk8MH1vJiYoaCs9IjtiYXNlNjQiKX12YXIgcT1uLmxvYWRGaWxlU3luYyhpLGssdGhpcy5jb250ZXh0LGIpO2lmKCFxLmNvbnRlbnRzKXJldHVybiBnLndhcm4oIlNraXBwZWQgZGF0YS11cmkgZW1iZWRkaW5nIG9mICIraSsiIGJlY2F1c2UgZmlsZSBub3QgZm91bmQiKSxmKHRoaXMsZXx8YSk7dmFyIHI9cS5jb250ZW50cztpZihvJiYhYi5lbmNvZGVCYXNlNjQpcmV0dXJuIGYodGhpcyxlKTtyPW8/Yi5lbmNvZGVCYXNlNjQocik6ZW5jb2RlVVJJQ29tcG9uZW50KHIpO3ZhciBzPSJkYXRhOiIraCsiLCIrcittLHQ9MzI3Njg7cmV0dXJuIHMubGVuZ3RoPj10JiZ0aGlzLmNvbnRleHQuaWVDb21wYXQhPT0hMT8oZy53YXJuKCJTa2lwcGVkIGRhdGEtdXJpIGVtYmVkZGluZyBvZiAiK2krIiBiZWNhdXNlIGl0cyBzaXplICgiK3MubGVuZ3RoKyIgY2hhcmFjdGVycykgZXhjZWVkcyBJRTgtc2FmZSAiK3QrIiBjaGFyYWN0ZXJzISIpLGYodGhpcyxlfHxhKSk6bmV3IGQobmV3IGMoJyInK3MrJyInLHMsITEsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyksdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyl9KX19LHsiLi4vbG9nZ2VyIjozMSwiLi4vdHJlZS9xdW90ZWQiOjcxLCIuLi90cmVlL3VybCI6NzgsIi4vZnVuY3Rpb24tcmVnaXN0cnkiOjIxfV0sMTk6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi4vdHJlZS9rZXl3b3JkIiksZD1hKCIuL2Z1bmN0aW9uLXJlZ2lzdHJ5IiksZT17ZXZhbDpmdW5jdGlvbigpe3ZhciBhPXRoaXMudmFsdWVfLGI9dGhpcy5lcnJvcl87aWYoYil0aHJvdyBiO3JldHVybiBudWxsIT1hP2E/Yy5UcnVlOmMuRmFsc2U6dm9pZCAwfSx2YWx1ZTpmdW5jdGlvbihhKXt0aGlzLnZhbHVlXz1hfSxlcnJvcjpmdW5jdGlvbihhKXt0aGlzLmVycm9yXz1hfSxyZXNldDpmdW5jdGlvbigpe3RoaXMudmFsdWVfPXRoaXMuZXJyb3JfPW51bGx9fTtkLmFkZCgiZGVmYXVsdCIsZS5ldmFsLmJpbmQoZSkpLGIuZXhwb3J0cz1lfSx7Ii4uL3RyZWUva2V5d29yZCI6NjMsIi4vZnVuY3Rpb24tcmVnaXN0cnkiOjIxfV0sMjA6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi4vdHJlZS9leHByZXNzaW9uIiksZD1mdW5jdGlvbihhLGIsYyxkKXt0aGlzLm5hbWU9YS50b0xvd2VyQ2FzZSgpLHRoaXMuaW5kZXg9Yyx0aGlzLmNvbnRleHQ9Yix0aGlzLmN1cnJlbnRGaWxlSW5mbz1kLHRoaXMuZnVuYz1iLmZyYW1lc1swXS5mdW5jdGlvblJlZ2lzdHJ5LmdldCh0aGlzLm5hbWUpfTtkLnByb3RvdHlwZS5pc1ZhbGlkPWZ1bmN0aW9uKCl7cmV0dXJuIEJvb2xlYW4odGhpcy5mdW5jKX0sZC5wcm90b3R5cGUuY2FsbD1mdW5jdGlvbihhKXtyZXR1cm4gQXJyYXkuaXNBcnJheShhKSYmKGE9YS5maWx0ZXIoZnVuY3Rpb24oYSl7cmV0dXJuIkNvbW1lbnQiPT09YS50eXBlPyExOiEwfSkubWFwKGZ1bmN0aW9uKGEpe2lmKCJFeHByZXNzaW9uIj09PWEudHlwZSl7dmFyIGI9YS52YWx1ZS5maWx0ZXIoZnVuY3Rpb24oYSl7cmV0dXJuIkNvbW1lbnQiPT09YS50eXBlPyExOiEwfSk7cmV0dXJuIDE9PT1iLmxlbmd0aD9iWzBdOm5ldyBjKGIpfXJldHVybiBhfSkpLHRoaXMuZnVuYy5hcHBseSh0aGlzLGEpfSxiLmV4cG9ydHM9ZH0seyIuLi90cmVlL2V4cHJlc3Npb24iOjU3fV0sMjE6W2Z1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhhKXtyZXR1cm57X2RhdGE6e30sYWRkOmZ1bmN0aW9uKGEsYil7YT1hLnRvTG93ZXJDYXNlKCksdGhpcy5fZGF0YS5oYXNPd25Qcm9wZXJ0eShhKSx0aGlzLl9kYXRhW2FdPWJ9LGFkZE11bHRpcGxlOmZ1bmN0aW9uKGEpe09iamVjdC5rZXlzKGEpLmZvckVhY2goZnVuY3Rpb24oYil7dGhpcy5hZGQoYixhW2JdKX0uYmluZCh0aGlzKSl9LGdldDpmdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5fZGF0YVtiXXx8YSYmYS5nZXQoYil9LGluaGVyaXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYyh0aGlzKX19fWIuZXhwb3J0cz1jKG51bGwpfSx7fV0sMjI6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPWZ1bmN0aW9uKGIpe3ZhciBjPXtmdW5jdGlvblJlZ2lzdHJ5OmEoIi4vZnVuY3Rpb24tcmVnaXN0cnkiKSxmdW5jdGlvbkNhbGxlcjphKCIuL2Z1bmN0aW9uLWNhbGxlciIpfTtyZXR1cm4gYSgiLi9kZWZhdWx0IiksYSgiLi9jb2xvciIpLGEoIi4vY29sb3ItYmxlbmRpbmciKSxhKCIuL2RhdGEtdXJpIikoYiksYSgiLi9tYXRoIiksYSgiLi9udW1iZXIiKSxhKCIuL3N0cmluZyIpLGEoIi4vc3ZnIikoYiksYSgiLi90eXBlcyIpLGN9fSx7Ii4vY29sb3IiOjE3LCIuL2NvbG9yLWJsZW5kaW5nIjoxNiwiLi9kYXRhLXVyaSI6MTgsIi4vZGVmYXVsdCI6MTksIi4vZnVuY3Rpb24tY2FsbGVyIjoyMCwiLi9mdW5jdGlvbi1yZWdpc3RyeSI6MjEsIi4vbWF0aCI6MjMsIi4vbnVtYmVyIjoyNCwiLi9zdHJpbmciOjI1LCIuL3N2ZyI6MjYsIi4vdHlwZXMiOjI3fV0sMjM6W2Z1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYSxiLGQpe2lmKCEoZCBpbnN0YW5jZW9mIGMpKXRocm93e3R5cGU6IkFyZ3VtZW50IixtZXNzYWdlOiJhcmd1bWVudCBtdXN0IGJlIGEgbnVtYmVyIn07cmV0dXJuIG51bGw9PWI/Yj1kLnVuaXQ6ZD1kLnVuaWZ5KCksbmV3IGMoYShwYXJzZUZsb2F0KGQudmFsdWUpKSxiKX12YXIgYz1hKCIuLi90cmVlL2RpbWVuc2lvbiIpLGQ9YSgiLi9mdW5jdGlvbi1yZWdpc3RyeSIpLGU9e2NlaWw6bnVsbCxmbG9vcjpudWxsLHNxcnQ6bnVsbCxhYnM6bnVsbCx0YW46IiIsc2luOiIiLGNvczoiIixhdGFuOiJyYWQiLGFzaW46InJhZCIsYWNvczoicmFkIn07Zm9yKHZhciBmIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShmKSYmKGVbZl09Yi5iaW5kKG51bGwsTWF0aFtmXSxlW2ZdKSk7ZS5yb3VuZD1mdW5jdGlvbihhLGMpe3ZhciBkPSJ1bmRlZmluZWQiPT10eXBlb2YgYz8wOmMudmFsdWU7cmV0dXJuIGIoZnVuY3Rpb24oYSl7cmV0dXJuIGEudG9GaXhlZChkKX0sbnVsbCxhKX0sZC5hZGRNdWx0aXBsZShlKX0seyIuLi90cmVlL2RpbWVuc2lvbiI6NTQsIi4vZnVuY3Rpb24tcmVnaXN0cnkiOjIxfV0sMjQ6W2Z1bmN0aW9uKGEpe3ZhciBiPWEoIi4uL3RyZWUvZGltZW5zaW9uIiksYz1hKCIuLi90cmVlL2Fub255bW91cyIpLGQ9YSgiLi9mdW5jdGlvbi1yZWdpc3RyeSIpLGU9ZnVuY3Rpb24oYSxkKXtzd2l0Y2goZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkKSxkLmxlbmd0aCl7Y2FzZSAwOnRocm93e3R5cGU6IkFyZ3VtZW50IixtZXNzYWdlOiJvbmUgb3IgbW9yZSBhcmd1bWVudHMgcmVxdWlyZWQifX12YXIgZSxmLGcsaCxpLGosayxsLG09W10sbj17fTtmb3IoZT0wO2QubGVuZ3RoPmU7ZSsrKWlmKGc9ZFtlXSxnIGluc3RhbmNlb2YgYilpZihoPSIiPT09Zy51bml0LnRvU3RyaW5nKCkmJnZvaWQgMCE9PWw/bmV3IGIoZy52YWx1ZSxsKS51bmlmeSgpOmcudW5pZnkoKSxqPSIiPT09aC51bml0LnRvU3RyaW5nKCkmJnZvaWQgMCE9PWs/azpoLnVuaXQudG9TdHJpbmcoKSxrPSIiIT09aiYmdm9pZCAwPT09a3x8IiIhPT1qJiYiIj09PW1bMF0udW5pZnkoKS51bml0LnRvU3RyaW5nKCk/ajprLGw9IiIhPT1qJiZ2b2lkIDA9PT1sP2cudW5pdC50b1N0cmluZygpOmwsZj12b2lkIDAhPT1uWyIiXSYmIiIhPT1qJiZqPT09az9uWyIiXTpuW2pdLHZvaWQgMCE9PWYpaT0iIj09PW1bZl0udW5pdC50b1N0cmluZygpJiZ2b2lkIDAhPT1sP25ldyBiKG1bZl0udmFsdWUsbCkudW5pZnkoKTptW2ZdLnVuaWZ5KCksKGEmJmkudmFsdWU+aC52YWx1ZXx8IWEmJmgudmFsdWU+aS52YWx1ZSkmJihtW2ZdPWcpO2Vsc2V7aWYodm9pZCAwIT09ayYmaiE9PWspdGhyb3d7dHlwZToiQXJndW1lbnQiLG1lc3NhZ2U6ImluY29tcGF0aWJsZSB0eXBlcyJ9O25bal09bS5sZW5ndGgsbS5wdXNoKGcpfWVsc2UgQXJyYXkuaXNBcnJheShkW2VdLnZhbHVlKSYmQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoZCxBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkW2VdLnZhbHVlKSk7cmV0dXJuIDE9PW0ubGVuZ3RoP21bMF06KGQ9bS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEudG9DU1ModGhpcy5jb250ZXh0KX0pLmpvaW4odGhpcy5jb250ZXh0LmNvbXByZXNzPyIsIjoiLCAiKSxuZXcgYygoYT8ibWluIjoibWF4IikrIigiK2QrIikiKSl9O2QuYWRkTXVsdGlwbGUoe21pbjpmdW5jdGlvbigpe3JldHVybiBlKCEwLGFyZ3VtZW50cyl9LG1heDpmdW5jdGlvbigpe3JldHVybiBlKCExLGFyZ3VtZW50cyl9LGNvbnZlcnQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5jb252ZXJ0VG8oYi52YWx1ZSl9LHBpOmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBiKE1hdGguUEkpfSxtb2Q6ZnVuY3Rpb24oYSxjKXtyZXR1cm4gbmV3IGIoYS52YWx1ZSVjLnZhbHVlLGEudW5pdCl9LHBvdzpmdW5jdGlvbihhLGMpe2lmKCJudW1iZXIiPT10eXBlb2YgYSYmIm51bWJlciI9PXR5cGVvZiBjKWE9bmV3IGIoYSksYz1uZXcgYihjKTtlbHNlIGlmKCEoYSBpbnN0YW5jZW9mIGImJmMgaW5zdGFuY2VvZiBiKSl0aHJvd3t0eXBlOiJBcmd1bWVudCIsbWVzc2FnZToiYXJndW1lbnRzIG11c3QgYmUgbnVtYmVycyJ9O3JldHVybiBuZXcgYihNYXRoLnBvdyhhLnZhbHVlLGMudmFsdWUpLGEudW5pdCl9LHBlcmNlbnRhZ2U6ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBiKDEwMCphLnZhbHVlLCIlIil9fSl9LHsiLi4vdHJlZS9hbm9ueW1vdXMiOjQ0LCIuLi90cmVlL2RpbWVuc2lvbiI6NTQsIi4vZnVuY3Rpb24tcmVnaXN0cnkiOjIxfV0sMjU6W2Z1bmN0aW9uKGEpe3ZhciBiPWEoIi4uL3RyZWUvcXVvdGVkIiksYz1hKCIuLi90cmVlL2Fub255bW91cyIpLGQ9YSgiLi4vdHJlZS9qYXZhc2NyaXB0IiksZT1hKCIuL2Z1bmN0aW9uLXJlZ2lzdHJ5Iik7ZS5hZGRNdWx0aXBsZSh7ZTpmdW5jdGlvbihhKXtyZXR1cm4gbmV3IGMoYSBpbnN0YW5jZW9mIGQ/YS5ldmFsdWF0ZWQ6YS52YWx1ZSl9LGVzY2FwZTpmdW5jdGlvbihhKXtyZXR1cm4gbmV3IGMoZW5jb2RlVVJJKGEudmFsdWUpLnJlcGxhY2UoLz0vZywiJTNEIikucmVwbGFjZSgvOi9nLCIlM0EiKS5yZXBsYWNlKC8jL2csIiUyMyIpLnJlcGxhY2UoLzsvZywiJTNCIikucmVwbGFjZSgvXCgvZywiJTI4IikucmVwbGFjZSgvXCkvZywiJTI5IikpfSxyZXBsYWNlOmZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmPWEudmFsdWU7cmV0dXJuIGQ9IlF1b3RlZCI9PT1kLnR5cGU/ZC52YWx1ZTpkLnRvQ1NTKCksZj1mLnJlcGxhY2UobmV3IFJlZ0V4cChjLnZhbHVlLGU/ZS52YWx1ZToiIiksZCksbmV3IGIoYS5xdW90ZXx8IiIsZixhLmVzY2FwZWQpfSwiJSI6ZnVuY3Rpb24oYSl7Zm9yKHZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxkPWEudmFsdWUsZT0wO2MubGVuZ3RoPmU7ZSsrKWQ9ZC5yZXBsYWNlKC8lW3NkYV0vaSxmdW5jdGlvbihhKXt2YXIgYj0iUXVvdGVkIj09PWNbZV0udHlwZSYmYS5tYXRjaCgvcy9pKT9jW2VdLnZhbHVlOmNbZV0udG9DU1MoKTtyZXR1cm4gYS5tYXRjaCgvW0EtWl0kLyk/ZW5jb2RlVVJJQ29tcG9uZW50KGIpOmJ9KTtyZXR1cm4gZD1kLnJlcGxhY2UoLyUlL2csIiUiKSxuZXcgYihhLnF1b3RlfHwiIixkLGEuZXNjYXBlZCl9fSl9LHsiLi4vdHJlZS9hbm9ueW1vdXMiOjQ0LCIuLi90cmVlL2phdmFzY3JpcHQiOjYxLCIuLi90cmVlL3F1b3RlZCI6NzEsIi4vZnVuY3Rpb24tcmVnaXN0cnkiOjIxfV0sMjY6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPWZ1bmN0aW9uKCl7dmFyIGI9YSgiLi4vdHJlZS9kaW1lbnNpb24iKSxjPWEoIi4uL3RyZWUvY29sb3IiKSxkPWEoIi4uL3RyZWUvZXhwcmVzc2lvbiIpLGU9YSgiLi4vdHJlZS9xdW90ZWQiKSxmPWEoIi4uL3RyZWUvdXJsIiksZz1hKCIuL2Z1bmN0aW9uLXJlZ2lzdHJ5Iik7Zy5hZGQoInN2Zy1ncmFkaWVudCIsZnVuY3Rpb24oYSl7ZnVuY3Rpb24gZygpe3Rocm93e3R5cGU6IkFyZ3VtZW50IixtZXNzYWdlOiJzdmctZ3JhZGllbnQgZXhwZWN0cyBkaXJlY3Rpb24sIHN0YXJ0X2NvbG9yIFtzdGFydF9wb3NpdGlvbl0sIFtjb2xvciBwb3NpdGlvbixdLi4uLCBlbmRfY29sb3IgW2VuZF9wb3NpdGlvbl0gb3IgZGlyZWN0aW9uLCBjb2xvciBsaXN0In19dmFyIGgsaSxqLGssbCxtLG4sbyxwPSJsaW5lYXIiLHE9J3g9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiJyxyPXtjb21wcmVzczohMX0scz1hLnRvQ1NTKHIpO3N3aXRjaCgyPT1hcmd1bWVudHMubGVuZ3RoPyhhcmd1bWVudHNbMV0udmFsdWUubGVuZ3RoPDImJmcoKSxoPWFyZ3VtZW50c1sxXS52YWx1ZSk6YXJndW1lbnRzLmxlbmd0aDwzP2coKTpoPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxzKXtjYXNlInRvIGJvdHRvbSI6aT0neDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiJzticmVhaztjYXNlInRvIHJpZ2h0IjppPSd4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIwJSInO2JyZWFrO2Nhc2UidG8gYm90dG9tIHJpZ2h0IjppPSd4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIic7YnJlYWs7Y2FzZSJ0byB0b3AgcmlnaHQiOmk9J3gxPSIwJSIgeTE9IjEwMCUiIHgyPSIxMDAlIiB5Mj0iMCUiJzticmVhaztjYXNlImVsbGlwc2UiOmNhc2UiZWxsaXBzZSBhdCBjZW50ZXIiOnA9InJhZGlhbCIsaT0nY3g9IjUwJSIgY3k9IjUwJSIgcj0iNzUlIicscT0neD0iLTUwIiB5PSItNTAiIHdpZHRoPSIxMDEiIGhlaWdodD0iMTAxIic7YnJlYWs7ZGVmYXVsdDp0aHJvd3t0eXBlOiJBcmd1bWVudCIsbWVzc2FnZToic3ZnLWdyYWRpZW50IGRpcmVjdGlvbiBtdXN0IGJlICd0byBib3R0b20nLCAndG8gcmlnaHQnLCAndG8gYm90dG9tIHJpZ2h0JywgJ3RvIHRvcCByaWdodCcgb3IgJ2VsbGlwc2UgYXQgY2VudGVyJyJ9fWZvcihqPSc8P3htbCB2ZXJzaW9uPSIxLjAiID8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PCcrcCsnR3JhZGllbnQgaWQ9ImdyYWRpZW50IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgJytpKyI+IiwNCms9MDtoLmxlbmd0aD5rO2srPTEpaFtrXWluc3RhbmNlb2YgZD8obD1oW2tdLnZhbHVlWzBdLG09aFtrXS52YWx1ZVsxXSk6KGw9aFtrXSxtPXZvaWQgMCksbCBpbnN0YW5jZW9mIGMmJigoMD09PWt8fGsrMT09PWgubGVuZ3RoKSYmdm9pZCAwPT09bXx8bSBpbnN0YW5jZW9mIGIpfHxnKCksbj1tP20udG9DU1Mocik6MD09PWs/IjAlIjoiMTAwJSIsbz1sLmFscGhhLGorPSc8c3RvcCBvZmZzZXQ9IicrbisnIiBzdG9wLWNvbG9yPSInK2wudG9SR0IoKSsnIicrKDE+bz8nIHN0b3Atb3BhY2l0eT0iJytvKyciJzoiIikrIi8+IjtyZXR1cm4gais9IjwvIitwKyJHcmFkaWVudD48cmVjdCAiK3ErJyBmaWxsPSJ1cmwoI2dyYWRpZW50KSIgLz48L3N2Zz4nLGo9ZW5jb2RlVVJJQ29tcG9uZW50KGopLGo9ImRhdGE6aW1hZ2Uvc3ZnK3htbCwiK2osbmV3IGYobmV3IGUoIiciK2orIiciLGosITEsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyksdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyl9KX19LHsiLi4vdHJlZS9jb2xvciI6NDgsIi4uL3RyZWUvZGltZW5zaW9uIjo1NCwiLi4vdHJlZS9leHByZXNzaW9uIjo1NywiLi4vdHJlZS9xdW90ZWQiOjcxLCIuLi90cmVlL3VybCI6NzgsIi4vZnVuY3Rpb24tcmVnaXN0cnkiOjIxfV0sMjc6W2Z1bmN0aW9uKGEpe3ZhciBiPWEoIi4uL3RyZWUva2V5d29yZCIpLGM9YSgiLi4vdHJlZS9kZXRhY2hlZC1ydWxlc2V0IiksZD1hKCIuLi90cmVlL2RpbWVuc2lvbiIpLGU9YSgiLi4vdHJlZS9jb2xvciIpLGY9YSgiLi4vdHJlZS9xdW90ZWQiKSxnPWEoIi4uL3RyZWUvYW5vbnltb3VzIiksaD1hKCIuLi90cmVlL3VybCIpLGk9YSgiLi4vdHJlZS9vcGVyYXRpb24iKSxqPWEoIi4vZnVuY3Rpb24tcmVnaXN0cnkiKSxrPWZ1bmN0aW9uKGEsYyl7cmV0dXJuIGEgaW5zdGFuY2VvZiBjP2IuVHJ1ZTpiLkZhbHNlfSxsPWZ1bmN0aW9uKGEsYyl7aWYodm9pZCAwPT09Yyl0aHJvd3t0eXBlOiJBcmd1bWVudCIsbWVzc2FnZToibWlzc2luZyB0aGUgcmVxdWlyZWQgc2Vjb25kIGFyZ3VtZW50IHRvIGlzdW5pdC4ifTtpZihjPSJzdHJpbmciPT10eXBlb2YgYy52YWx1ZT9jLnZhbHVlOmMsInN0cmluZyIhPXR5cGVvZiBjKXRocm93e3R5cGU6IkFyZ3VtZW50IixtZXNzYWdlOiJTZWNvbmQgYXJndW1lbnQgdG8gaXN1bml0IHNob3VsZCBiZSBhIHVuaXQgb3IgYSBzdHJpbmcuIn07cmV0dXJuIGEgaW5zdGFuY2VvZiBkJiZhLnVuaXQuaXMoYyk/Yi5UcnVlOmIuRmFsc2V9LG09ZnVuY3Rpb24oYSl7dmFyIGI9QXJyYXkuaXNBcnJheShhLnZhbHVlKT9hLnZhbHVlOkFycmF5KGEpO3JldHVybiBifTtqLmFkZE11bHRpcGxlKHtpc3J1bGVzZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGsoYSxjKX0saXNjb2xvcjpmdW5jdGlvbihhKXtyZXR1cm4gayhhLGUpfSxpc251bWJlcjpmdW5jdGlvbihhKXtyZXR1cm4gayhhLGQpfSxpc3N0cmluZzpmdW5jdGlvbihhKXtyZXR1cm4gayhhLGYpfSxpc2tleXdvcmQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGsoYSxiKX0saXN1cmw6ZnVuY3Rpb24oYSl7cmV0dXJuIGsoYSxoKX0saXNwaXhlbDpmdW5jdGlvbihhKXtyZXR1cm4gbChhLCJweCIpfSxpc3BlcmNlbnRhZ2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGwoYSwiJSIpfSxpc2VtOmZ1bmN0aW9uKGEpe3JldHVybiBsKGEsImVtIil9LGlzdW5pdDpsLHVuaXQ6ZnVuY3Rpb24oYSxjKXtpZighKGEgaW5zdGFuY2VvZiBkKSl0aHJvd3t0eXBlOiJBcmd1bWVudCIsbWVzc2FnZToidGhlIGZpcnN0IGFyZ3VtZW50IHRvIHVuaXQgbXVzdCBiZSBhIG51bWJlciIrKGEgaW5zdGFuY2VvZiBpPyIuIEhhdmUgeW91IGZvcmdvdHRlbiBwYXJlbnRoZXNpcz8iOiIiKX07cmV0dXJuIGM9Yz9jIGluc3RhbmNlb2YgYj9jLnZhbHVlOmMudG9DU1MoKToiIixuZXcgZChhLnZhbHVlLGMpfSwiZ2V0LXVuaXQiOmZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZyhhLnVuaXQpfSxleHRyYWN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9Yi52YWx1ZS0xLG0oYSlbYl19LGxlbmd0aDpmdW5jdGlvbihhKXtyZXR1cm4gbmV3IGQobShhKS5sZW5ndGgpfX0pfSx7Ii4uL3RyZWUvYW5vbnltb3VzIjo0NCwiLi4vdHJlZS9jb2xvciI6NDgsIi4uL3RyZWUvZGV0YWNoZWQtcnVsZXNldCI6NTMsIi4uL3RyZWUvZGltZW5zaW9uIjo1NCwiLi4vdHJlZS9rZXl3b3JkIjo2MywiLi4vdHJlZS9vcGVyYXRpb24iOjY5LCIuLi90cmVlL3F1b3RlZCI6NzEsIi4uL3RyZWUvdXJsIjo3OCwiLi9mdW5jdGlvbi1yZWdpc3RyeSI6MjF9XSwyODpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL2NvbnRleHRzIiksZD1hKCIuL3BhcnNlci9wYXJzZXIiKSxlPWEoIi4vcGx1Z2lucy9mdW5jdGlvbi1pbXBvcnRlciIpO2IuZXhwb3J0cz1mdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihhLGIpe3RoaXMucm9vdEZpbGVuYW1lPWIuZmlsZW5hbWUsdGhpcy5wYXRocz1hLnBhdGhzfHxbXSx0aGlzLmNvbnRlbnRzPXt9LHRoaXMuY29udGVudHNJZ25vcmVkQ2hhcnM9e30sdGhpcy5taW1lPWEubWltZSx0aGlzLmVycm9yPW51bGwsdGhpcy5jb250ZXh0PWEsdGhpcy5xdWV1ZT1bXSx0aGlzLmZpbGVzPXt9fTtyZXR1cm4gYi5wcm90b3R5cGUucHVzaD1mdW5jdGlvbihiLGYsZyxoLGkpe3ZhciBqPXRoaXM7dGhpcy5xdWV1ZS5wdXNoKGIpO3ZhciBrPWZ1bmN0aW9uKGEsYyxkKXtqLnF1ZXVlLnNwbGljZShqLnF1ZXVlLmluZGV4T2YoYiksMSk7dmFyIGU9ZD09PWoucm9vdEZpbGVuYW1lO2gub3B0aW9uYWwmJmE/aShudWxsLHtydWxlczpbXX0sITEsbnVsbCk6KGouZmlsZXNbZF09YyxhJiYhai5lcnJvciYmKGouZXJyb3I9YSksaShhLGMsZSxkKSl9LGw9e3JlbGF0aXZlVXJsczp0aGlzLmNvbnRleHQucmVsYXRpdmVVcmxzLGVudHJ5UGF0aDpnLmVudHJ5UGF0aCxyb290cGF0aDpnLnJvb3RwYXRoLHJvb3RGaWxlbmFtZTpnLnJvb3RGaWxlbmFtZX0sbT1hLmdldEZpbGVNYW5hZ2VyKGIsZy5jdXJyZW50RGlyZWN0b3J5LHRoaXMuY29udGV4dCxhKTtpZighbSlyZXR1cm4gdm9pZCBrKHttZXNzYWdlOiJDb3VsZCBub3QgZmluZCBhIGZpbGUtbWFuYWdlciBmb3IgIitifSk7ZiYmKGI9bS50cnlBcHBlbmRFeHRlbnNpb24oYixoLnBsdWdpbj8iLmpzIjoiLmxlc3MiKSk7dmFyIG49ZnVuY3Rpb24oYSl7dmFyIGI9YS5maWxlbmFtZSxmPWEuY29udGVudHMucmVwbGFjZSgvXlx1RkVGRi8sIiIpO2wuY3VycmVudERpcmVjdG9yeT1tLmdldFBhdGgoYiksbC5yZWxhdGl2ZVVybHMmJihsLnJvb3RwYXRoPW0uam9pbihqLmNvbnRleHQucm9vdHBhdGh8fCIiLG0ucGF0aERpZmYobC5jdXJyZW50RGlyZWN0b3J5LGwuZW50cnlQYXRoKSksIW0uaXNQYXRoQWJzb2x1dGUobC5yb290cGF0aCkmJm0uYWx3YXlzTWFrZVBhdGhzQWJzb2x1dGUoKSYmKGwucm9vdHBhdGg9bS5qb2luKGwuZW50cnlQYXRoLGwucm9vdHBhdGgpKSksbC5maWxlbmFtZT1iO3ZhciBpPW5ldyBjLlBhcnNlKGouY29udGV4dCk7aS5wcm9jZXNzSW1wb3J0cz0hMSxqLmNvbnRlbnRzW2JdPWYsKGcucmVmZXJlbmNlfHxoLnJlZmVyZW5jZSkmJihsLnJlZmVyZW5jZT0hMCksaC5wbHVnaW4/bmV3IGUoaSxsKS5ldmFsKGYsZnVuY3Rpb24oYSxjKXtrKGEsYyxiKX0pOmguaW5saW5lP2sobnVsbCxmLGIpOm5ldyBkKGksaixsKS5wYXJzZShmLGZ1bmN0aW9uKGEsYyl7ayhhLGMsYil9KX0sbz1tLmxvYWRGaWxlKGIsZy5jdXJyZW50RGlyZWN0b3J5LHRoaXMuY29udGV4dCxhLGZ1bmN0aW9uKGEsYil7YT9rKGEpOm4oYil9KTtvJiZvLnRoZW4obixrKX0sYn19LHsiLi9jb250ZXh0cyI6MTAsIi4vcGFyc2VyL3BhcnNlciI6MzYsIi4vcGx1Z2lucy9mdW5jdGlvbi1pbXBvcnRlciI6Mzh9XSwyOTpbZnVuY3Rpb24oYSxiKXtiLmV4cG9ydHM9ZnVuY3Rpb24oYixjKXt2YXIgZCxlLGYsZyxoLGk9e3ZlcnNpb246WzIsNSwxXSxkYXRhOmEoIi4vZGF0YSIpLHRyZWU6YSgiLi90cmVlIiksRW52aXJvbm1lbnQ6aD1hKCIuL2Vudmlyb25tZW50L2Vudmlyb25tZW50IiksQWJzdHJhY3RGaWxlTWFuYWdlcjphKCIuL2Vudmlyb25tZW50L2Fic3RyYWN0LWZpbGUtbWFuYWdlciIpLGVudmlyb25tZW50OmI9bmV3IGgoYixjKSx2aXNpdG9yczphKCIuL3Zpc2l0b3JzIiksUGFyc2VyOmEoIi4vcGFyc2VyL3BhcnNlciIpLGZ1bmN0aW9uczphKCIuL2Z1bmN0aW9ucyIpKGIpLGNvbnRleHRzOmEoIi4vY29udGV4dHMiKSxTb3VyY2VNYXBPdXRwdXQ6ZD1hKCIuL3NvdXJjZS1tYXAtb3V0cHV0IikoYiksU291cmNlTWFwQnVpbGRlcjplPWEoIi4vc291cmNlLW1hcC1idWlsZGVyIikoZCxiKSxQYXJzZVRyZWU6Zj1hKCIuL3BhcnNlLXRyZWUiKShlKSxJbXBvcnRNYW5hZ2VyOmc9YSgiLi9pbXBvcnQtbWFuYWdlciIpKGIpLHJlbmRlcjphKCIuL3JlbmRlciIpKGIsZixnKSxwYXJzZTphKCIuL3BhcnNlIikoYixmLGcpLExlc3NFcnJvcjphKCIuL2xlc3MtZXJyb3IiKSx0cmFuc2Zvcm1UcmVlOmEoIi4vdHJhbnNmb3JtLXRyZWUiKSx1dGlsczphKCIuL3V0aWxzIiksUGx1Z2luTWFuYWdlcjphKCIuL3BsdWdpbi1tYW5hZ2VyIiksbG9nZ2VyOmEoIi4vbG9nZ2VyIil9O3JldHVybiBpfX0seyIuL2NvbnRleHRzIjoxMCwiLi9kYXRhIjoxMiwiLi9lbnZpcm9ubWVudC9hYnN0cmFjdC1maWxlLW1hbmFnZXIiOjE0LCIuL2Vudmlyb25tZW50L2Vudmlyb25tZW50IjoxNSwiLi9mdW5jdGlvbnMiOjIyLCIuL2ltcG9ydC1tYW5hZ2VyIjoyOCwiLi9sZXNzLWVycm9yIjozMCwiLi9sb2dnZXIiOjMxLCIuL3BhcnNlIjozMywiLi9wYXJzZS10cmVlIjozMiwiLi9wYXJzZXIvcGFyc2VyIjozNiwiLi9wbHVnaW4tbWFuYWdlciI6MzcsIi4vcmVuZGVyIjozOSwiLi9zb3VyY2UtbWFwLWJ1aWxkZXIiOjQwLCIuL3NvdXJjZS1tYXAtb3V0cHV0Ijo0MSwiLi90cmFuc2Zvcm0tdHJlZSI6NDIsIi4vdHJlZSI6NjAsIi4vdXRpbHMiOjgxLCIuL3Zpc2l0b3JzIjo4NX1dLDMwOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vdXRpbHMiKSxkPWIuZXhwb3J0cz1mdW5jdGlvbihhLGIsZCl7RXJyb3IuY2FsbCh0aGlzKTt2YXIgZT1hLmZpbGVuYW1lfHxkO2lmKGImJmUpe3ZhciBmPWIuY29udGVudHNbZV0sZz1jLmdldExvY2F0aW9uKGEuaW5kZXgsZiksaD1nLmxpbmUsaT1nLmNvbHVtbixqPWEuY2FsbCYmYy5nZXRMb2NhdGlvbihhLmNhbGwsZikubGluZSxrPWYuc3BsaXQoIlxuIik7dGhpcy50eXBlPWEudHlwZXx8IlN5bnRheCIsdGhpcy5maWxlbmFtZT1lLHRoaXMuaW5kZXg9YS5pbmRleCx0aGlzLmxpbmU9Im51bWJlciI9PXR5cGVvZiBoP2grMTpudWxsLHRoaXMuY2FsbExpbmU9aisxLHRoaXMuY2FsbEV4dHJhY3Q9a1tqXSx0aGlzLmNvbHVtbj1pLHRoaXMuZXh0cmFjdD1ba1toLTFdLGtbaF0sa1toKzFdXX10aGlzLm1lc3NhZ2U9YS5tZXNzYWdlLHRoaXMuc3RhY2s9YS5zdGFja307aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBPYmplY3QuY3JlYXRlKXt2YXIgZT1mdW5jdGlvbigpe307ZS5wcm90b3R5cGU9RXJyb3IucHJvdG90eXBlLGQucHJvdG90eXBlPW5ldyBlfWVsc2UgZC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO2QucHJvdG90eXBlLmNvbnN0cnVjdG9yPWR9LHsiLi91dGlscyI6ODF9XSwzMTpbZnVuY3Rpb24oYSxiKXtiLmV4cG9ydHM9e2Vycm9yOmZ1bmN0aW9uKGEpe3RoaXMuX2ZpcmVFdmVudCgiZXJyb3IiLGEpfSx3YXJuOmZ1bmN0aW9uKGEpe3RoaXMuX2ZpcmVFdmVudCgid2FybiIsYSl9LGluZm86ZnVuY3Rpb24oYSl7dGhpcy5fZmlyZUV2ZW50KCJpbmZvIixhKX0sZGVidWc6ZnVuY3Rpb24oYSl7dGhpcy5fZmlyZUV2ZW50KCJkZWJ1ZyIsYSl9LGFkZExpc3RlbmVyOmZ1bmN0aW9uKGEpe3RoaXMuX2xpc3RlbmVycy5wdXNoKGEpfSxyZW1vdmVMaXN0ZW5lcjpmdW5jdGlvbihhKXtmb3IodmFyIGI9MDt0aGlzLl9saXN0ZW5lcnMubGVuZ3RoPmI7YisrKWlmKHRoaXMuX2xpc3RlbmVyc1tiXT09PWEpcmV0dXJuIHZvaWQgdGhpcy5fbGlzdGVuZXJzLnNwbGljZShiLDEpfSxfZmlyZUV2ZW50OmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTA7dGhpcy5fbGlzdGVuZXJzLmxlbmd0aD5jO2MrKyl7dmFyIGQ9dGhpcy5fbGlzdGVuZXJzW2NdW2FdO2QmJmQoYil9fSxfbGlzdGVuZXJzOltdfX0se31dLDMyOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbGVzcy1lcnJvciIpLGQ9YSgiLi90cmFuc2Zvcm0tdHJlZSIpLGU9YSgiLi9sb2dnZXIiKTtiLmV4cG9ydHM9ZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYSxiKXt0aGlzLnJvb3Q9YSx0aGlzLmltcG9ydHM9Yn07cmV0dXJuIGIucHJvdG90eXBlLnRvQ1NTPWZ1bmN0aW9uKGIpe3ZhciBmLGcsaD17fTt0cnl7Zj1kKHRoaXMucm9vdCxiKX1jYXRjaChpKXt0aHJvdyBuZXcgYyhpLHRoaXMuaW1wb3J0cyl9dHJ5e3ZhciBqPUJvb2xlYW4oYi5jb21wcmVzcyk7aiYmZS53YXJuKCJUaGUgY29tcHJlc3Mgb3B0aW9uIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFdlIHJlY29tbWVuZCB5b3UgdXNlIGEgZGVkaWNhdGVkIGNzcyBtaW5pZmllciwgZm9yIGluc3RhbmNlIHNlZSBsZXNzLXBsdWdpbi1jbGVhbi1jc3MuIik7dmFyIGs9e2NvbXByZXNzOmosZHVtcExpbmVOdW1iZXJzOmIuZHVtcExpbmVOdW1iZXJzLHN0cmljdFVuaXRzOkJvb2xlYW4oYi5zdHJpY3RVbml0cyksbnVtUHJlY2lzaW9uOjh9O2Iuc291cmNlTWFwPyhnPW5ldyBhKGIuc291cmNlTWFwKSxoLmNzcz1nLnRvQ1NTKGYsayx0aGlzLmltcG9ydHMpKTpoLmNzcz1mLnRvQ1NTKGspfWNhdGNoKGkpe3Rocm93IG5ldyBjKGksdGhpcy5pbXBvcnRzKX1pZihiLnBsdWdpbk1hbmFnZXIpZm9yKHZhciBsPWIucGx1Z2luTWFuYWdlci5nZXRQb3N0UHJvY2Vzc29ycygpLG09MDtsLmxlbmd0aD5tO20rKyloLmNzcz1sW21dLnByb2Nlc3MoaC5jc3Mse3NvdXJjZU1hcDpnLG9wdGlvbnM6YixpbXBvcnRzOnRoaXMuaW1wb3J0c30pO2Iuc291cmNlTWFwJiYoaC5tYXA9Zy5nZXRFeHRlcm5hbFNvdXJjZU1hcCgpKSxoLmltcG9ydHM9W107Zm9yKHZhciBuIGluIHRoaXMuaW1wb3J0cy5maWxlcyl0aGlzLmltcG9ydHMuZmlsZXMuaGFzT3duUHJvcGVydHkobikmJm4hPT10aGlzLmltcG9ydHMucm9vdEZpbGVuYW1lJiZoLmltcG9ydHMucHVzaChuKTtyZXR1cm4gaH0sYn19LHsiLi9sZXNzLWVycm9yIjozMCwiLi9sb2dnZXIiOjMxLCIuL3RyYW5zZm9ybS10cmVlIjo0Mn1dLDMzOltmdW5jdGlvbihhLGIpe3ZhciBjLGQ9YSgiLi9jb250ZXh0cyIpLGU9YSgiLi9wYXJzZXIvcGFyc2VyIiksZj1hKCIuL3BsdWdpbi1tYW5hZ2VyIik7Yi5leHBvcnRzPWZ1bmN0aW9uKGIsZyxoKXt2YXIgaT1mdW5jdGlvbihiLGcsail7aWYoZz1nfHx7fSwiZnVuY3Rpb24iPT10eXBlb2YgZyYmKGo9ZyxnPXt9KSwhail7Y3x8KGM9InVuZGVmaW5lZCI9PXR5cGVvZiBQcm9taXNlP2EoInByb21pc2UiKTpQcm9taXNlKTt2YXIgaz10aGlzO3JldHVybiBuZXcgYyhmdW5jdGlvbihhLGMpe2kuY2FsbChrLGIsZyxmdW5jdGlvbihiLGQpe2I/YyhiKTphKGQpfSl9KX12YXIgbCxtLG49bmV3IGYodGhpcyk7aWYobi5hZGRQbHVnaW5zKGcucGx1Z2lucyksZy5wbHVnaW5NYW5hZ2VyPW4sbD1uZXcgZC5QYXJzZShnKSxnLnJvb3RGaWxlSW5mbyltPWcucm9vdEZpbGVJbmZvO2Vsc2V7dmFyIG89Zy5maWxlbmFtZXx8ImlucHV0IixwPW8ucmVwbGFjZSgvW15cL1xcXSokLywiIik7bT17ZmlsZW5hbWU6byxyZWxhdGl2ZVVybHM6bC5yZWxhdGl2ZVVybHMscm9vdHBhdGg6bC5yb290cGF0aHx8IiIsY3VycmVudERpcmVjdG9yeTpwLGVudHJ5UGF0aDpwLHJvb3RGaWxlbmFtZTpvfSxtLnJvb3RwYXRoJiYiLyIhPT1tLnJvb3RwYXRoLnNsaWNlKC0xKSYmKG0ucm9vdHBhdGgrPSIvIil9dmFyIHE9bmV3IGgobCxtKTtuZXcgZShsLHEsbSkucGFyc2UoYixmdW5jdGlvbihhLGIpe3JldHVybiBhP2ooYSk6dm9pZCBqKG51bGwsYixxLGcpfSxnKX07cmV0dXJuIGl9fSx7Ii4vY29udGV4dHMiOjEwLCIuL3BhcnNlci9wYXJzZXIiOjM2LCIuL3BsdWdpbi1tYW5hZ2VyIjozNyxwcm9taXNlOnZvaWQgMH1dLDM0OltmdW5jdGlvbihhLGIpe2IuZXhwb3J0cz1mdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoYil7dmFyIGM9aC1xOzUxMj5jJiYhYnx8IWN8fChwLnB1c2goYS5zbGljZShxLGgrMSkpLHE9aCsxKX12YXIgZCxlLGYsZyxoLGksaixrLGwsbT1hLmxlbmd0aCxuPTAsbz0wLHA9W10scT0wO2ZvcihoPTA7bT5oO2grKylpZihqPWEuY2hhckNvZGVBdChoKSwhKGo+PTk3JiYxMjI+PWp8fDM0PmopKXN3aXRjaChqKXtjYXNlIDQwOm8rKyxlPWg7Y29udGludWU7Y2FzZSA0MTppZigtLW88MClyZXR1cm4gYigibWlzc2luZyBvcGVuaW5nIGAoYCIsaCk7Y29udGludWU7Y2FzZSA1OTpvfHxjKCk7Y29udGludWU7Y2FzZSAxMjM6bisrLGQ9aDtjb250aW51ZTtjYXNlIDEyNTppZigtLW48MClyZXR1cm4gYigibWlzc2luZyBvcGVuaW5nIGB7YCIsaCk7bnx8b3x8YygpO2NvbnRpbnVlO2Nhc2UgOTI6aWYobS0xPmgpe2grKztjb250aW51ZX1yZXR1cm4gYigidW5lc2NhcGVkIGBcXGAiLGgpO2Nhc2UgMzQ6Y2FzZSAzOTpjYXNlIDk2OmZvcihsPTAsaT1oLGgrPTE7bT5oO2grKylpZihrPWEuY2hhckNvZGVBdChoKSwhKGs+OTYpKXtpZihrPT1qKXtsPTE7YnJlYWt9aWYoOTI9PWspe2lmKGg9PW0tMSlyZXR1cm4gYigidW5lc2NhcGVkIGBcXGAiLGgpO2grK319aWYobCljb250aW51ZTtyZXR1cm4gYigidW5tYXRjaGVkIGAiK1N0cmluZy5mcm9tQ2hhckNvZGUoaikrImAiLGkpO2Nhc2UgNDc6aWYob3x8aD09bS0xKWNvbnRpbnVlO2lmKGs9YS5jaGFyQ29kZUF0KGgrMSksNDc9PWspZm9yKGgrPTI7bT5oJiYoaz1hLmNoYXJDb2RlQXQoaCksISgxMz49ayl8fDEwIT1rJiYxMyE9ayk7aCsrKTtlbHNlIGlmKDQyPT1rKXtmb3IoZj1pPWgsaCs9MjttLTE+aCYmKGs9YS5jaGFyQ29kZUF0KGgpLDEyNT09ayYmKGc9aCksNDIhPWt8fDQ3IT1hLmNoYXJDb2RlQXQoaCsxKSk7aCsrKTtpZihoPT1tLTEpcmV0dXJuIGIoIm1pc3NpbmcgY2xvc2luZyBgKi9gIixpKTtoKyt9Y29udGludWU7Y2FzZSA0MjppZihtLTE+aCYmNDc9PWEuY2hhckNvZGVBdChoKzEpKXJldHVybiBiKCJ1bm1hdGNoZWQgYC8qYCIsaCk7Y29udGludWV9cmV0dXJuIDAhPT1uP2Y+ZCYmZz5mP2IoIm1pc3NpbmcgY2xvc2luZyBgfWAgb3IgYCovYCIsZCk6YigibWlzc2luZyBjbG9zaW5nIGB9YCIsZCk6MCE9PW8/YigibWlzc2luZyBjbG9zaW5nIGApYCIsZSk6KGMoITApLHApfX0se31dLDM1OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vY2h1bmtlciIpO2IuZXhwb3J0cz1mdW5jdGlvbigpe3ZhciBhLGIsZCxlLGYsZyxoLGk9W10saj17fTtqLnNhdmU9ZnVuY3Rpb24oKXtoPWouaSxpLnB1c2goe2N1cnJlbnQ6ZyxpOmouaSxqOmJ9KX0sai5yZXN0b3JlPWZ1bmN0aW9uKGEpeyhqLmk+ZHx8ai5pPT09ZCYmYSYmIWUpJiYoZD1qLmksZT1hKTt2YXIgYz1pLnBvcCgpO2c9Yy5jdXJyZW50LGg9ai5pPWMuaSxiPWMuan0sai5mb3JnZXQ9ZnVuY3Rpb24oKXtpLnBvcCgpfSxqLmlzV2hpdGVzcGFjZT1mdW5jdGlvbihiKXt2YXIgYz1qLmkrKGJ8fDApLGQ9YS5jaGFyQ29kZUF0KGMpO3JldHVybiBkPT09a3x8ZD09PW58fGQ9PT1sfHxkPT09bX0sai4kcmU9ZnVuY3Rpb24oYSl7ai5pPmgmJihnPWcuc2xpY2Uoai5pLWgpLGg9ai5pKTt2YXIgYj1hLmV4ZWMoZyk7cmV0dXJuIGI/KHMoYlswXS5sZW5ndGgpLCJzdHJpbmciPT10eXBlb2YgYj9iOjE9PT1iLmxlbmd0aD9iWzBdOmIpOm51bGx9LGouJGNoYXI9ZnVuY3Rpb24oYil7cmV0dXJuIGEuY2hhckF0KGouaSkhPT1iP251bGw6KHMoMSksYil9LGouJHN0cj1mdW5jdGlvbihiKXtmb3IodmFyIGM9Yi5sZW5ndGgsZD0wO2M+ZDtkKyspaWYoYS5jaGFyQXQoai5pK2QpIT09Yi5jaGFyQXQoZCkpcmV0dXJuIG51bGw7cmV0dXJuIHMoYyksYn0sai4kcXVvdGVkPWZ1bmN0aW9uKCl7dmFyIGI9YS5jaGFyQXQoai5pKTtpZigiJyI9PT1ifHwnIic9PT1iKXtmb3IodmFyIGM9YS5sZW5ndGgsZD1qLmksZT0xO2M+ZStkO2UrKyl7dmFyIGY9YS5jaGFyQXQoZStkKTtzd2l0Y2goZil7Y2FzZSJcXCI6ZSsrO2NvbnRpbnVlO2Nhc2UiXHIiOmNhc2UiXG4iOmJyZWFrO2Nhc2UgYjp2YXIgZz1hLnN1YnN0cihkLGUrMSk7cmV0dXJuIHMoZSsxKSxnfX1yZXR1cm4gbnVsbH19O3ZhciBrPTMyLGw9OSxtPTEwLG49MTMsbz00MyxwPTQ0LHE9NDcscj01NztqLmF1dG9Db21tZW50QWJzb3JiPSEwLGouY29tbWVudFN0b3JlPVtdLGouZmluaXNoZWQ9ITE7dmFyIHM9ZnVuY3Rpb24oYyl7Zm9yKHZhciBkLGUsaSxvPWouaSxwPWIscj1qLmktaCx0PWouaStnLmxlbmd0aC1yLHU9ai5pKz1jLHY9YTt0PmouaTtqLmkrKyl7aWYoZD12LmNoYXJDb2RlQXQoai5pKSxqLmF1dG9Db21tZW50QWJzb3JiJiZkPT09cSl7aWYoZT12LmNoYXJBdChqLmkrMSksIi8iPT09ZSl7aT17aW5kZXg6ai5pLGlzTGluZUNvbW1lbnQ6ITB9O3ZhciB3PXYuaW5kZXhPZigiXG4iLGouaSsyKTswPncmJih3PXQpLGouaT13LGkudGV4dD12LnN1YnN0cihpLmksai5pLWkuaSksai5jb21tZW50U3RvcmUucHVzaChpKTtjb250aW51ZX1pZigiKiI9PT1lKXt2YXIgeD12LmluZGV4T2YoIiovIixqLmkrMik7aWYoeD49MCl7aT17aW5kZXg6ai5pLHRleHQ6di5zdWJzdHIoai5pLHgrMi1qLmkpLGlzTGluZUNvbW1lbnQ6ITF9LGouaSs9aS50ZXh0Lmxlbmd0aC0xLGouY29tbWVudFN0b3JlLnB1c2goaSk7Y29udGludWV9fWJyZWFrfWlmKGQhPT1rJiZkIT09bSYmZCE9PWwmJmQhPT1uKWJyZWFrfWlmKGc9Zy5zbGljZShjK2ouaS11K3IpLGg9ai5pLCFnLmxlbmd0aCl7aWYoZi5sZW5ndGgtMT5iKXJldHVybiBnPWZbKytiXSxzKDApLCEwO2ouZmluaXNoZWQ9ITB9cmV0dXJuIG8hPT1qLml8fHAhPT1ifTtyZXR1cm4gai5wZWVrPWZ1bmN0aW9uKGIpe2lmKCJzdHJpbmciPT10eXBlb2YgYil7Zm9yKHZhciBjPTA7Yi5sZW5ndGg+YztjKyspaWYoYS5jaGFyQXQoai5pK2MpIT09Yi5jaGFyQXQoYykpcmV0dXJuITE7cmV0dXJuITB9cmV0dXJuIGIudGVzdChnKX0sai5wZWVrQ2hhcj1mdW5jdGlvbihiKXtyZXR1cm4gYS5jaGFyQXQoai5pKT09PWJ9LGouY3VycmVudENoYXI9ZnVuY3Rpb24oKXtyZXR1cm4gYS5jaGFyQXQoai5pKX0sai5nZXRJbnB1dD1mdW5jdGlvbigpe3JldHVybiBhfSxqLnBlZWtOb3ROdW1lcmljPWZ1bmN0aW9uKCl7dmFyIGI9YS5jaGFyQ29kZUF0KGouaSk7cmV0dXJuIGI+cnx8bz5ifHxiPT09cXx8Yj09PXB9LGouc3RhcnQ9ZnVuY3Rpb24oZSxpLGspe2E9ZSxqLmk9Yj1oPWQ9MCxmPWk/YyhlLGspOltlXSxnPWZbMF0scygwKX0sai5lbmQ9ZnVuY3Rpb24oKXt2YXIgYixjPWouaT49YS5sZW5ndGg7cmV0dXJuIGQ+ai5pJiYoYj1lLGouaT1kKSx7aXNGaW5pc2hlZDpjLGZ1cnRoZXN0OmouaSxmdXJ0aGVzdFBvc3NpYmxlRXJyb3JNZXNzYWdlOmIsZnVydGhlc3RSZWFjaGVkRW5kOmouaT49YS5sZW5ndGgtMSxmdXJ0aGVzdENoYXI6YVtqLmldfX0san19LHsiLi9jaHVua2VyIjozNH1dLDM2OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4uL2xlc3MtZXJyb3IiKSxkPWEoIi4uL3RyZWUiKSxlPWEoIi4uL3Zpc2l0b3JzIiksZj1hKCIuL3BhcnNlci1pbnB1dCIpLGc9YSgiLi4vdXRpbHMiKSxoPWZ1bmN0aW9uIGkoYSxiLGgpe2Z1bmN0aW9uIGooYSxiKXt2YXIgYz0iW29iamVjdCBGdW5jdGlvbl0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpP2EuY2FsbChuKTpvLiRyZShhKTtyZXR1cm4gYz9jOnZvaWQgbChifHwoInN0cmluZyI9PXR5cGVvZiBhPyJleHBlY3RlZCAnIithKyInIGdvdCAnIitvLmN1cnJlbnRDaGFyKCkrIiciOiJ1bmV4cGVjdGVkIHRva2VuIikpfWZ1bmN0aW9uIGsoYSxiKXtyZXR1cm4gby4kY2hhcihhKT9hOnZvaWQgbChifHwiZXhwZWN0ZWQgJyIrYSsiJyBnb3QgJyIrby5jdXJyZW50Q2hhcigpKyInIil9ZnVuY3Rpb24gbChhLGQpe3Rocm93IG5ldyBjKHtpbmRleDpvLmksZmlsZW5hbWU6aC5maWxlbmFtZSx0eXBlOmR8fCJTeW50YXgiLG1lc3NhZ2U6YX0sYil9ZnVuY3Rpb24gbShhKXt2YXIgYj1oLmZpbGVuYW1lO3JldHVybntsaW5lTnVtYmVyOmcuZ2V0TG9jYXRpb24oYSxvLmdldElucHV0KCkpLmxpbmUrMSxmaWxlTmFtZTpifX12YXIgbixvPWYoKTtyZXR1cm57cGFyc2U6ZnVuY3Rpb24oZixnLGope3ZhciBrLGwsbSxuLHA9bnVsbCxxPSIiO2lmKGw9aiYmai5nbG9iYWxWYXJzP2kuc2VyaWFsaXplVmFycyhqLmdsb2JhbFZhcnMpKyJcbiI6IiIsbT1qJiZqLm1vZGlmeVZhcnM/IlxuIitpLnNlcmlhbGl6ZVZhcnMoai5tb2RpZnlWYXJzKToiIixhLnBsdWdpbk1hbmFnZXIpZm9yKHZhciByPWEucGx1Z2luTWFuYWdlci5nZXRQcmVQcm9jZXNzb3JzKCkscz0wO3IubGVuZ3RoPnM7cysrKWY9cltzXS5wcm9jZXNzKGYse2NvbnRleHQ6YSxpbXBvcnRzOmIsZmlsZUluZm86aH0pOyhsfHxqJiZqLmJhbm5lcikmJihxPShqJiZqLmJhbm5lcj9qLmJhbm5lcjoiIikrbCxuPWIuY29udGVudHNJZ25vcmVkQ2hhcnMsbltoLmZpbGVuYW1lXT1uW2guZmlsZW5hbWVdfHwwLG5baC5maWxlbmFtZV0rPXEubGVuZ3RoKSxmPWYucmVwbGFjZSgvXHJcbj8vZywiXG4iKSxmPXErZi5yZXBsYWNlKC9eXHVGRUZGLywiIikrbSxiLmNvbnRlbnRzW2guZmlsZW5hbWVdPWY7dHJ5e28uc3RhcnQoZixhLmNodW5rSW5wdXQsZnVuY3Rpb24oYSxkKXt0aHJvdyBuZXcgYyh7aW5kZXg6ZCx0eXBlOiJQYXJzZSIsbWVzc2FnZTphLGZpbGVuYW1lOmguZmlsZW5hbWV9LGIpfSksaz1uZXcgZC5SdWxlc2V0KG51bGwsdGhpcy5wYXJzZXJzLnByaW1hcnkoKSksay5yb290PSEwLGsuZmlyc3RSb290PSEwfWNhdGNoKHQpe3JldHVybiBnKG5ldyBjKHQsYixoLmZpbGVuYW1lKSl9dmFyIHU9by5lbmQoKTtpZighdS5pc0ZpbmlzaGVkKXt2YXIgdj11LmZ1cnRoZXN0UG9zc2libGVFcnJvck1lc3NhZ2U7dnx8KHY9IlVucmVjb2duaXNlZCBpbnB1dCIsIn0iPT09dS5mdXJ0aGVzdENoYXI/dis9Ii4gUG9zc2libHkgbWlzc2luZyBvcGVuaW5nICd7JyI6IikiPT09dS5mdXJ0aGVzdENoYXI/dis9Ii4gUG9zc2libHkgbWlzc2luZyBvcGVuaW5nICcoJyI6dS5mdXJ0aGVzdFJlYWNoZWRFbmQmJih2Kz0iLiBQb3NzaWJseSBtaXNzaW5nIHNvbWV0aGluZyIpKSxwPW5ldyBjKHt0eXBlOiJQYXJzZSIsbWVzc2FnZTp2LGluZGV4OnUuZnVydGhlc3QsZmlsZW5hbWU6aC5maWxlbmFtZX0sYil9dmFyIHc9ZnVuY3Rpb24oYSl7cmV0dXJuIGE9cHx8YXx8Yi5lcnJvcixhPyhhIGluc3RhbmNlb2YgY3x8KGE9bmV3IGMoYSxiLGguZmlsZW5hbWUpKSxnKGEpKTpnKG51bGwsayl9O3JldHVybiBhLnByb2Nlc3NJbXBvcnRzPT09ITE/dygpOnZvaWQgbmV3IGUuSW1wb3J0VmlzaXRvcihiLHcpLnJ1bihrKX0scGFyc2VyczpuPXtwcmltYXJ5OmZ1bmN0aW9uKCl7Zm9yKHZhciBhLGI9dGhpcy5taXhpbixjPVtdOzspe2Zvcig7Oyl7aWYoYT10aGlzLmNvbW1lbnQoKSwhYSlicmVhaztjLnB1c2goYSl9aWYoby5maW5pc2hlZClicmVhaztpZihvLnBlZWsoIn0iKSlicmVhaztpZihhPXRoaXMuZXh0ZW5kUnVsZSgpKWM9Yy5jb25jYXQoYSk7ZWxzZSBpZihhPWIuZGVmaW5pdGlvbigpfHx0aGlzLnJ1bGUoKXx8dGhpcy5ydWxlc2V0KCl8fGIuY2FsbCgpfHx0aGlzLnJ1bGVzZXRDYWxsKCl8fHRoaXMuZGlyZWN0aXZlKCkpYy5wdXNoKGEpO2Vsc2V7Zm9yKHZhciBkPSExO28uJGNoYXIoIjsiKTspZD0hMDtpZighZClicmVha319cmV0dXJuIGN9LGNvbW1lbnQ6ZnVuY3Rpb24oKXtpZihvLmNvbW1lbnRTdG9yZS5sZW5ndGgpe3ZhciBhPW8uY29tbWVudFN0b3JlLnNoaWZ0KCk7cmV0dXJuIG5ldyBkLkNvbW1lbnQoYS50ZXh0LGEuaXNMaW5lQ29tbWVudCxhLmluZGV4LGgpfX0sZW50aXRpZXM6e3F1b3RlZDpmdW5jdGlvbigpe3ZhciBhLGI9by5pLGM9ITE7cmV0dXJuIG8uc2F2ZSgpLG8uJGNoYXIoIn4iKSYmKGM9ITApLChhPW8uJHF1b3RlZCgpKT8oby5mb3JnZXQoKSxuZXcgZC5RdW90ZWQoYS5jaGFyQXQoMCksYS5zdWJzdHIoMSxhLmxlbmd0aC0yKSxjLGIsaCkpOnZvaWQgby5yZXN0b3JlKCl9LGtleXdvcmQ6ZnVuY3Rpb24oKXt2YXIgYT1vLiRjaGFyKCIlIil8fG8uJHJlKC9eW19BLVphLXotXVtfQS1aYS16MC05LV0qLyk7cmV0dXJuIGE/ZC5Db2xvci5mcm9tS2V5d29yZChhKXx8bmV3IGQuS2V5d29yZChhKTp2b2lkIDB9LGNhbGw6ZnVuY3Rpb24oKXt2YXIgYSxiLGMsZSxmPW8uaTtpZighby5wZWVrKC9edXJsXCgvaSkpcmV0dXJuIG8uc2F2ZSgpLChhPW8uJHJlKC9eKFtcdy1dK3wlfHByb2dpZDpbXHdcLl0rKVwoLykpPyhhPWFbMV0sYj1hLnRvTG93ZXJDYXNlKCksImFscGhhIj09PWImJihlPW4uYWxwaGEoKSk/KG8uZm9yZ2V0KCksZSk6KGM9dGhpcy5hcmd1bWVudHMoKSxvLiRjaGFyKCIpIik/KG8uZm9yZ2V0KCksbmV3IGQuQ2FsbChhLGMsZixoKSk6dm9pZCBvLnJlc3RvcmUoIkNvdWxkIG5vdCBwYXJzZSBjYWxsIGFyZ3VtZW50cyBvciBtaXNzaW5nICcpJyIpKSk6dm9pZCBvLmZvcmdldCgpfSxhcmd1bWVudHM6ZnVuY3Rpb24oKXtmb3IodmFyIGEsYj1bXTs7KXtpZihhPXRoaXMuYXNzaWdubWVudCgpfHxuLmV4cHJlc3Npb24oKSwhYSlicmVhaztpZihiLnB1c2goYSksIW8uJGNoYXIoIiwiKSlicmVha31yZXR1cm4gYn0sbGl0ZXJhbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpbWVuc2lvbigpfHx0aGlzLmNvbG9yKCl8fHRoaXMucXVvdGVkKCl8fHRoaXMudW5pY29kZURlc2NyaXB0b3IoKX0sYXNzaWdubWVudDpmdW5jdGlvbigpe3ZhciBhLGI7cmV0dXJuIG8uc2F2ZSgpLChhPW8uJHJlKC9eXHcrKD89XHM/PSkvaSkpJiZvLiRjaGFyKCI9IikmJihiPW4uZW50aXR5KCkpPyhvLmZvcmdldCgpLG5ldyBkLkFzc2lnbm1lbnQoYSxiKSk6dm9pZCBvLnJlc3RvcmUoKX0sdXJsOmZ1bmN0aW9uKCl7dmFyIGEsYj1vLmk7cmV0dXJuIG8uYXV0b0NvbW1lbnRBYnNvcmI9ITEsby4kc3RyKCJ1cmwoIik/KGE9dGhpcy5xdW90ZWQoKXx8dGhpcy52YXJpYWJsZSgpfHxvLiRyZSgvXig/Oig/OlxcW1woXCknIl0pfFteXChcKSciXSkrLyl8fCIiLG8uYXV0b0NvbW1lbnRBYnNvcmI9ITAsaygiKSIpLG5ldyBkLlVSTChudWxsIT1hLnZhbHVlfHxhIGluc3RhbmNlb2YgZC5WYXJpYWJsZT9hOm5ldyBkLkFub255bW91cyhhKSxiLGgpKTp2b2lkKG8uYXV0b0NvbW1lbnRBYnNvcmI9ITApfSx2YXJpYWJsZTpmdW5jdGlvbigpe3ZhciBhLGI9by5pO3JldHVybiJAIj09PW8uY3VycmVudENoYXIoKSYmKGE9by4kcmUoL15AQD9bXHctXSsvKSk/bmV3IGQuVmFyaWFibGUoYSxiLGgpOnZvaWQgMH0sdmFyaWFibGVDdXJseTpmdW5jdGlvbigpe3ZhciBhLGI9by5pO3JldHVybiJAIj09PW8uY3VycmVudENoYXIoKSYmKGE9by4kcmUoL15AXHsoW1x3LV0rKVx9LykpP25ldyBkLlZhcmlhYmxlKCJAIithWzFdLGIsaCk6dm9pZCAwfSxjb2xvcjpmdW5jdGlvbigpe3ZhciBhO2lmKCIjIj09PW8uY3VycmVudENoYXIoKSYmKGE9by4kcmUoL14jKFtBLUZhLWYwLTldezZ9fFtBLUZhLWYwLTldezN9KS8pKSl7dmFyIGI9YS5pbnB1dC5tYXRjaCgvXiMoW1x3XSspLiovKTtyZXR1cm4gYj1iWzFdLGIubWF0Y2goL15bQS1GYS1mMC05XSskLyl8fGwoIkludmFsaWQgSEVYIGNvbG9yIGNvZGUiKSxuZXcgZC5Db2xvcihhWzFdKX19LGRpbWVuc2lvbjpmdW5jdGlvbigpe2lmKCFvLnBlZWtOb3ROdW1lcmljKCkpe3ZhciBhPW8uJHJlKC9eKFsrLV0/XGQqXC4/XGQrKSglfFthLXpdKyk/L2kpO3JldHVybiBhP25ldyBkLkRpbWVuc2lvbihhWzFdLGFbMl0pOnZvaWQgMH19LHVuaWNvZGVEZXNjcmlwdG9yOmZ1bmN0aW9uKCl7dmFyIGE7cmV0dXJuIGE9by4kcmUoL15VXCtbMC05YS1mQS1GP10rKFwtWzAtOWEtZkEtRj9dKyk/LyksYT9uZXcgZC5Vbmljb2RlRGVzY3JpcHRvcihhWzBdKTp2b2lkIDB9LGphdmFzY3JpcHQ6ZnVuY3Rpb24oKXt2YXIgYSxiPW8uaTtvLnNhdmUoKTt2YXIgYz1vLiRjaGFyKCJ+IiksZT1vLiRjaGFyKCJgIik7cmV0dXJuIGU/KGE9by4kcmUoL15bXmBdKmAvKSk/KG8uZm9yZ2V0KCksbmV3IGQuSmF2YVNjcmlwdChhLnN1YnN0cigwLGEubGVuZ3RoLTEpLEJvb2xlYW4oYyksYixoKSk6dm9pZCBvLnJlc3RvcmUoImludmFsaWQgamF2YXNjcmlwdCBkZWZpbml0aW9uIik6dm9pZCBvLnJlc3RvcmUoKX19LHZhcmlhYmxlOmZ1bmN0aW9uKCl7dmFyIGE7cmV0dXJuIkAiPT09by5jdXJyZW50Q2hhcigpJiYoYT1vLiRyZSgvXihAW1x3LV0rKVxzKjovKSk/YVsxXTp2b2lkIDB9LHJ1bGVzZXRDYWxsOmZ1bmN0aW9uKCl7dmFyIGE7cmV0dXJuIkAiPT09by5jdXJyZW50Q2hhcigpJiYoYT1vLiRyZSgvXihAW1x3LV0rKVxzKlwoXHMqXClccyo7LykpP25ldyBkLlJ1bGVzZXRDYWxsKGFbMV0pOnZvaWQgMH0sZXh0ZW5kOmZ1bmN0aW9uKGEpe3ZhciBiLGMsZSxmLGcsaD1vLmk7aWYoby4kc3RyKGE/IiY6ZXh0ZW5kKCI6IjpleHRlbmQoIikpe2Rve2ZvcihlPW51bGwsYj1udWxsOyEoZT1vLiRyZSgvXihhbGwpKD89XHMqKFwpfCwpKS8pKSYmKGM9dGhpcy5lbGVtZW50KCkpOyliP2IucHVzaChjKTpiPVtjXTtlPWUmJmVbMV0sYnx8bCgiTWlzc2luZyB0YXJnZXQgc2VsZWN0b3IgZm9yIDpleHRlbmQoKS4iKSxnPW5ldyBkLkV4dGVuZChuZXcgZC5TZWxlY3RvcihiKSxlLGgpLGY/Zi5wdXNoKGcpOmY9W2ddfXdoaWxlKG8uJGNoYXIoIiwiKSk7cmV0dXJuIGooL15cKS8pLGEmJmooL147LyksZn19LGV4dGVuZFJ1bGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5leHRlbmQoITApfSxtaXhpbjp7Y2FsbDpmdW5jdGlvbigpe3ZhciBhLGIsYyxlLGYsZyxpPW8uY3VycmVudENoYXIoKSxqPSExLGw9by5pO2lmKCIuIj09PWl8fCIjIj09PWkpe2ZvcihvLnNhdmUoKTs7KXtpZihhPW8uaSxlPW8uJHJlKC9eWyMuXSg/Oltcdy1dfFxcKD86W0EtRmEtZjAtOV17MSw2fSA/fFteQS1GYS1mMC05XSkpKy8pLCFlKWJyZWFrO2M9bmV3IGQuRWxlbWVudChmLGUsYSxoKSxiP2IucHVzaChjKTpiPVtjXSxmPW8uJGNoYXIoIj4iKX1yZXR1cm4gYiYmKG8uJGNoYXIoIigiKSYmKGc9dGhpcy5hcmdzKCEwKS5hcmdzLGsoIikiKSksbi5pbXBvcnRhbnQoKSYmKGo9ITApLG4uZW5kKCkpPyhvLmZvcmdldCgpLG5ldyBkLm1peGluLkNhbGwoYixnLGwsaCxqKSk6dm9pZCBvLnJlc3RvcmUoKX19LGFyZ3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxlLGYsZyxoLGk9bi5lbnRpdGllcyxqPXthcmdzOm51bGwsdmFyaWFkaWM6ITF9LGs9W10sbT1bXSxwPVtdO2ZvcihvLnNhdmUoKTs7KXtpZihhKWg9bi5kZXRhY2hlZFJ1bGVzZXQoKXx8bi5leHByZXNzaW9uKCk7ZWxzZXtpZihvLmNvbW1lbnRTdG9yZS5sZW5ndGg9MCxvLiRzdHIoIi4uLiIpKXtqLnZhcmlhZGljPSEwLG8uJGNoYXIoIjsiKSYmIWImJihiPSEwKSwoYj9tOnApLnB1c2goe3ZhcmlhZGljOiEwfSk7YnJlYWt9aD1pLnZhcmlhYmxlKCl8fGkubGl0ZXJhbCgpfHxpLmtleXdvcmQoKX1pZighaClicmVhaztmPW51bGwsaC50aHJvd0F3YXlDb21tZW50cyYmaC50aHJvd0F3YXlDb21tZW50cygpLGc9aDt2YXIgcT1udWxsO2lmKGE/aC52YWx1ZSYmMT09aC52YWx1ZS5sZW5ndGgmJihxPWgudmFsdWVbMF0pOnE9aCxxJiZxIGluc3RhbmNlb2YgZC5WYXJpYWJsZSlpZihvLiRjaGFyKCI6Iikpe2lmKGsubGVuZ3RoPjAmJihiJiZsKCJDYW5ub3QgbWl4IDsgYW5kICwgYXMgZGVsaW1pdGVyIHR5cGVzIiksYz0hMCksZz1uLmRldGFjaGVkUnVsZXNldCgpfHxuLmV4cHJlc3Npb24oKSwhZyl7aWYoIWEpcmV0dXJuIG8ucmVzdG9yZSgpLGouYXJncz1bXSxqO2woImNvdWxkIG5vdCB1bmRlcnN0YW5kIHZhbHVlIGZvciBuYW1lZCBhcmd1bWVudCIpfWY9ZT1xLm5hbWV9ZWxzZXtpZighYSYmby4kc3RyKCIuLi4iKSl7ai52YXJpYWRpYz0hMCxvLiRjaGFyKCI7IikmJiFiJiYoYj0hMCksKGI/bTpwKS5wdXNoKHtuYW1lOmgubmFtZSx2YXJpYWRpYzohMH0pO2JyZWFrfWF8fChlPWY9cS5uYW1lLGc9bnVsbCl9ZyYmay5wdXNoKGcpLHAucHVzaCh7bmFtZTpmLHZhbHVlOmd9KSxvLiRjaGFyKCIsIil8fChvLiRjaGFyKCI7Iil8fGIpJiYoYyYmbCgiQ2Fubm90IG1peCA7IGFuZCAsIGFzIGRlbGltaXRlciB0eXBlcyIpLGI9ITAsay5sZW5ndGg+MSYmKGc9bmV3IGQuVmFsdWUoaykpLG0ucHVzaCh7bmFtZTplLHZhbHVlOmd9KSxlPW51bGwsaz1bXSxjPSExKX1yZXR1cm4gby5mb3JnZXQoKSxqLmFyZ3M9Yj9tOnAsan0sZGVmaW5pdGlvbjpmdW5jdGlvbigpe3ZhciBhLGIsYyxlLGY9W10sZz0hMTtpZighKCIuIiE9PW8uY3VycmVudENoYXIoKSYmIiMiIT09by5jdXJyZW50Q2hhcigpfHxvLnBlZWsoL15bXntdKlx9LykpKWlmKG8uc2F2ZSgpLGI9by4kcmUoL14oWyMuXSg/Oltcdy1dfFxcKD86W0EtRmEtZjAtOV17MSw2fSA/fFteQS1GYS1mMC05XSkpKylccypcKC8pKXthPWJbMV07dmFyIGg9dGhpcy5hcmdzKCExKTtpZihmPWguYXJncyxnPWgudmFyaWFkaWMsIW8uJGNoYXIoIikiKSlyZXR1cm4gdm9pZCBvLnJlc3RvcmUoIk1pc3NpbmcgY2xvc2luZyAnKSciKTtpZihvLmNvbW1lbnRTdG9yZS5sZW5ndGg9MCxvLiRzdHIoIndoZW4iKSYmKGU9aihuLmNvbmRpdGlvbnMsImV4cGVjdGVkIGNvbmRpdGlvbiIpKSxjPW4uYmxvY2soKSlyZXR1cm4gby5mb3JnZXQoKSxuZXcgZC5taXhpbi5EZWZpbml0aW9uKGEsZixjLGUsZyk7by5yZXN0b3JlKCl9ZWxzZSBvLmZvcmdldCgpfX0sZW50aXR5OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5lbnRpdGllcztyZXR1cm4gdGhpcy5jb21tZW50KCl8fGEubGl0ZXJhbCgpfHxhLnZhcmlhYmxlKCl8fGEudXJsKCl8fGEuY2FsbCgpfHxhLmtleXdvcmQoKXx8YS5qYXZhc2NyaXB0KCl9LGVuZDpmdW5jdGlvbigpe3JldHVybiBvLiRjaGFyKCI7Iil8fG8ucGVlaygifSIpfSxhbHBoYTpmdW5jdGlvbigpe3ZhciBhO2lmKG8uJHJlKC9eb3BhY2l0eT0vaSkpcmV0dXJuIGE9by4kcmUoL15cZCsvKSxhfHwoYT1qKHRoaXMuZW50aXRpZXMudmFyaWFibGUsIkNvdWxkIG5vdCBwYXJzZSBhbHBoYSIpKSxrKCIpIiksbmV3IGQuQWxwaGEoYSl9LGVsZW1lbnQ6ZnVuY3Rpb24oKXt2YXIgYSxiLGMsZT1vLmk7cmV0dXJuIGI9dGhpcy5jb21iaW5hdG9yKCksYT1vLiRyZSgvXig/OlxkK1wuXGQrfFxkKyklLyl8fG8uJHJlKC9eKD86Wy4jXT98OiopKD86W1x3LV18W15ceDAwLVx4OWZdfFxcKD86W0EtRmEtZjAtOV17MSw2fSA/fFteQS1GYS1mMC05XSkpKy8pfHxvLiRjaGFyKCIqIil8fG8uJGNoYXIoIiYiKXx8dGhpcy5hdHRyaWJ1dGUoKXx8by4kcmUoL15cKFteJigpQF0rXCkvKXx8by4kcmUoL15bXC4jOl0oPz1AKS8pfHx0aGlzLmVudGl0aWVzLnZhcmlhYmxlQ3VybHkoKSxhfHwoby5zYXZlKCksby4kY2hhcigiKCIpPyhjPXRoaXMuc2VsZWN0b3IoKSkmJm8uJGNoYXIoIikiKT8oYT1uZXcgZC5QYXJlbihjKSxvLmZvcmdldCgpKTpvLnJlc3RvcmUoIk1pc3NpbmcgY2xvc2luZyAnKSciKTpvLmZvcmdldCgpKSxhP25ldyBkLkVsZW1lbnQoYixhLGUsaCk6dm9pZCAwfSxjb21iaW5hdG9yOmZ1bmN0aW9uKCl7dmFyIGE9by5jdXJyZW50Q2hhcigpO2lmKCIvIj09PWEpe28uc2F2ZSgpO3ZhciBiPW8uJHJlKC9eXC9bYS16XStcLy9pKTtpZihiKXJldHVybiBvLmZvcmdldCgpLG5ldyBkLkNvbWJpbmF0b3IoYik7by5yZXN0b3JlKCl9aWYoIj4iPT09YXx8IisiPT09YXx8In4iPT09YXx8InwiPT09YXx8Il4iPT09YSl7Zm9yKG8uaSsrLCJeIj09PWEmJiJeIj09PW8uY3VycmVudENoYXIoKSYmKGE9Il5eIixvLmkrKyk7by5pc1doaXRlc3BhY2UoKTspby5pKys7cmV0dXJuIG5ldyBkLkNvbWJpbmF0b3IoYSl9cmV0dXJuIG5ldyBkLkNvbWJpbmF0b3Ioby5pc1doaXRlc3BhY2UoLTEpPyIgIjpudWxsKX0sbGVzc1NlbGVjdG9yOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2VsZWN0b3IoITApfSxzZWxlY3RvcjpmdW5jdGlvbihhKXtmb3IodmFyIGIsYyxlLGYsZyxpLGssbT1vLmk7KGEmJihjPXRoaXMuZXh0ZW5kKCkpfHxhJiYoaT1vLiRzdHIoIndoZW4iKSl8fChmPXRoaXMuZWxlbWVudCgpKSkmJihpP2s9aih0aGlzLmNvbmRpdGlvbnMsImV4cGVjdGVkIGNvbmRpdGlvbiIpOms/bCgiQ1NTIGd1YXJkIGNhbiBvbmx5IGJlIHVzZWQgYXQgdGhlIGVuZCBvZiBzZWxlY3RvciIpOmM/Zz1nP2cuY29uY2F0KGMpOmM6KGcmJmwoIkV4dGVuZCBjYW4gb25seSBiZSB1c2VkIGF0IHRoZSBlbmQgb2Ygc2VsZWN0b3IiKSxlPW8uY3VycmVudENoYXIoKSxiP2IucHVzaChmKTpiPVtmXSxmPW51bGwpLCJ7IiE9PWUmJiJ9IiE9PWUmJiI7IiE9PWUmJiIsIiE9PWUmJiIpIiE9PWUpOyk7cmV0dXJuIGI/bmV3IGQuU2VsZWN0b3IoYixnLGssbSxoKTp2b2lkKGcmJmwoIkV4dGVuZCBtdXN0IGJlIHVzZWQgdG8gZXh0ZW5kIGEgc2VsZWN0b3IsIGl0IGNhbm5vdCBiZSB1c2VkIG9uIGl0cyBvd24iKSl9LGF0dHJpYnV0ZTpmdW5jdGlvbigpe2lmKG8uJGNoYXIoIlsiKSl7dmFyIGEsYixjLGU9dGhpcy5lbnRpdGllcztyZXR1cm4oYT1lLnZhcmlhYmxlQ3VybHkoKSl8fChhPWooL14oPzpbX0EtWmEtejAtOS1cKl0qXHwpPyg/OltfQS1aYS16MC05LV18XFwuKSsvKSksYz1vLiRyZSgvXlt8fiokXl0/PS8pLGMmJihiPWUucXVvdGVkKCl8fG8uJHJlKC9eWzAtOV0rJS8pfHxvLiRyZSgvXltcdy1dKy8pfHxlLnZhcmlhYmxlQ3VybHkoKSksaygiXSIpLG5ldyBkLkF0dHJpYnV0ZShhLGMsYil9fSxibG9jazpmdW5jdGlvbigpe3ZhciBhO3JldHVybiBvLiRjaGFyKCJ7IikmJihhPXRoaXMucHJpbWFyeSgpKSYmby4kY2hhcigifSIpP2E6dm9pZCAwfSxibG9ja1J1bGVzZXQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmJsb2NrKCk7cmV0dXJuIGEmJihhPW5ldyBkLlJ1bGVzZXQobnVsbCxhKSksYX0sZGV0YWNoZWRSdWxlc2V0OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5ibG9ja1J1bGVzZXQoKTtyZXR1cm4gYT9uZXcgZC5EZXRhY2hlZFJ1bGVzZXQoYSk6dm9pZCAwfSxydWxlc2V0OmZ1bmN0aW9uKCl7dmFyIGIsYyxlLGY7Zm9yKG8uc2F2ZSgpLGEuZHVtcExpbmVOdW1iZXJzJiYoZj1tKG8uaSkpOzspe2lmKGM9dGhpcy5sZXNzU2VsZWN0b3IoKSwhYylicmVhaztpZihiP2IucHVzaChjKTpiPVtjXSxvLmNvbW1lbnRTdG9yZS5sZW5ndGg9MCxjLmNvbmRpdGlvbiYmYi5sZW5ndGg+MSYmbCgiR3VhcmRzIGFyZSBvbmx5IGN1cnJlbnRseSBhbGxvd2VkIG9uIGEgc2luZ2xlIHNlbGVjdG9yLiIpLCFvLiRjaGFyKCIsIikpYnJlYWs7Yy5jb25kaXRpb24mJmwoIkd1YXJkcyBhcmUgb25seSBjdXJyZW50bHkgYWxsb3dlZCBvbiBhIHNpbmdsZSBzZWxlY3Rvci4iKSxvLmNvbW1lbnRTdG9yZS5sZW5ndGg9MH1pZihiJiYoZT10aGlzLmJsb2NrKCkpKXtvLmZvcmdldCgpO3ZhciBnPW5ldyBkLlJ1bGVzZXQoYixlLGEuc3RyaWN0SW1wb3J0cyk7cmV0dXJuIGEuZHVtcExpbmVOdW1iZXJzJiYoZy5kZWJ1Z0luZm89ZiksZ31vLnJlc3RvcmUoKX0scnVsZTpmdW5jdGlvbihiKXt2YXIgYyxlLGYsZyxpLGo9by5pLGs9by5jdXJyZW50Q2hhcigpO2lmKCIuIiE9PWsmJiIjIiE9PWsmJiImIiE9PWsmJiI6IiE9PWspaWYoby5zYXZlKCksYz10aGlzLnZhcmlhYmxlKCl8fHRoaXMucnVsZVByb3BlcnR5KCkpe2lmKGk9InN0cmluZyI9PXR5cGVvZiBjLGkmJihlPXRoaXMuZGV0YWNoZWRSdWxlc2V0KCkpLG8uY29tbWVudFN0b3JlLmxlbmd0aD0wLCFlKXtnPSFpJiZjLmxlbmd0aD4xJiZjLnBvcCgpLnZhbHVlO3ZhciBsPSFiJiYoYS5jb21wcmVzc3x8aSk7aWYobCYmKGU9dGhpcy52YWx1ZSgpKSwhZSYmKGU9dGhpcy5hbm9ueW1vdXNWYWx1ZSgpKSlyZXR1cm4gby5mb3JnZXQoKSxuZXcgZC5SdWxlKGMsZSwhMSxnLGosaCk7bHx8ZXx8KGU9dGhpcy52YWx1ZSgpKSxmPXRoaXMuaW1wb3J0YW50KCl9aWYoZSYmdGhpcy5lbmQoKSlyZXR1cm4gby5mb3JnZXQoKSxuZXcgZC5SdWxlKGMsZSxmLGcsaixoKTtpZihvLnJlc3RvcmUoKSxlJiYhYilyZXR1cm4gdGhpcy5ydWxlKCEwKX1lbHNlIG8uZm9yZ2V0KCl9LGFub255bW91c1ZhbHVlOmZ1bmN0aW9uKCl7dmFyIGE9by4kcmUoL14oW15AK1wvJyIqYCg7e30tXSopOy8pO3JldHVybiBhP25ldyBkLkFub255bW91cyhhWzFdKTp2b2lkIDB9LCJpbXBvcnQiOmZ1bmN0aW9uKCl7dmFyIGEsYixjPW8uaSxlPW8uJHJlKC9eQGltcG9ydD9ccysvKTtpZihlKXt2YXIgZj0oZT90aGlzLmltcG9ydE9wdGlvbnMoKTpudWxsKXx8e307aWYoYT10aGlzLmVudGl0aWVzLnF1b3RlZCgpfHx0aGlzLmVudGl0aWVzLnVybCgpKXJldHVybiBiPXRoaXMubWVkaWFGZWF0dXJlcygpLG8uJGNoYXIoIjsiKXx8KG8uaT1jLGwoIm1pc3Npbmcgc2VtaS1jb2xvbiBvciB1bnJlY29nbmlzZWQgbWVkaWEgZmVhdHVyZXMgb24gaW1wb3J0IikpLGI9YiYmbmV3IGQuVmFsdWUoYiksbmV3IGQuSW1wb3J0KGEsYixmLGMsaCk7by5pPWMsbCgibWFsZm9ybWVkIGltcG9ydCBzdGF0ZW1lbnQiKX19LGltcG9ydE9wdGlvbnM6ZnVuY3Rpb24oKXt2YXIgYSxiLGMsZD17fTtpZighby4kY2hhcigiKCIpKXJldHVybiBudWxsO2RvIGlmKGE9dGhpcy5pbXBvcnRPcHRpb24oKSl7c3dpdGNoKGI9YSxjPSEwLGIpe2Nhc2UiY3NzIjpiPSJsZXNzIixjPSExO2JyZWFrO2Nhc2Uib25jZSI6Yj0ibXVsdGlwbGUiLGM9ITF9aWYoZFtiXT1jLCFvLiRjaGFyKCIsIikpYnJlYWt9d2hpbGUoYSk7cmV0dXJuIGsoIikiKSxkfSxpbXBvcnRPcHRpb246ZnVuY3Rpb24oKXt2YXIgYT1vLiRyZSgvXihsZXNzfGNzc3xtdWx0aXBsZXxvbmNlfGlubGluZXxyZWZlcmVuY2V8b3B0aW9uYWwpLyk7cmV0dXJuIGE/YVsxXTp2b2lkIDB9LG1lZGlhRmVhdHVyZTpmdW5jdGlvbigpe3ZhciBhLGIsYz10aGlzLmVudGl0aWVzLGU9W107by5zYXZlKCk7ZG8gaWYoYT1jLmtleXdvcmQoKXx8Yy52YXJpYWJsZSgpKWUucHVzaChhKTtlbHNlIGlmKG8uJGNoYXIoIigiKSl7aWYoYj10aGlzLnByb3BlcnR5KCksYT10aGlzLnZhbHVlKCksIW8uJGNoYXIoIikiKSlyZXR1cm4gby5yZXN0b3JlKCJNaXNzaW5nIGNsb3NpbmcgJyknIiksbnVsbDtpZihiJiZhKWUucHVzaChuZXcgZC5QYXJlbihuZXcgZC5SdWxlKGIsYSxudWxsLG51bGwsby5pLGgsITApKSk7ZWxzZXtpZighYSlyZXR1cm4gby5yZXN0b3JlKCJiYWRseSBmb3JtZWQgbWVkaWEgZmVhdHVyZSBkZWZpbml0aW9uIiksbnVsbDtlLnB1c2gobmV3IGQuUGFyZW4oYSkpfX13aGlsZShhKTtyZXR1cm4gby5mb3JnZXQoKSxlLmxlbmd0aD4wP25ldyBkLkV4cHJlc3Npb24oZSk6dm9pZCAwfSxtZWRpYUZlYXR1cmVzOmZ1bmN0aW9uKCl7dmFyIGEsYj10aGlzLmVudGl0aWVzLGM9W107ZG8gaWYoYT10aGlzLm1lZGlhRmVhdHVyZSgpKXtpZihjLnB1c2goYSksIW8uJGNoYXIoIiwiKSlicmVha31lbHNlIGlmKGE9Yi52YXJpYWJsZSgpLGEmJihjLnB1c2goYSksIW8uJGNoYXIoIiwiKSkpYnJlYWs7d2hpbGUoYSk7cmV0dXJuIGMubGVuZ3RoPjA/YzpudWxsfSxtZWRpYTpmdW5jdGlvbigpe3ZhciBiLGMsZSxmO3JldHVybiBhLmR1bXBMaW5lTnVtYmVycyYmKGY9bShvLmkpKSxvLnNhdmUoKSxvLiRzdHIoIkBtZWRpYSIpPyhiPXRoaXMubWVkaWFGZWF0dXJlcygpLChjPXRoaXMuYmxvY2soKSk/KG8uZm9yZ2V0KCksZT1uZXcgZC5NZWRpYShjLGIsby5pLGgpLGEuZHVtcExpbmVOdW1iZXJzJiYoZS5kZWJ1Z0luZm89ZiksZSk6dm9pZCBvLnJlc3RvcmUoIm1lZGlhIGRlZmluaXRpb25zIHJlcXVpcmUgYmxvY2sgc3RhdGVtZW50cyBhZnRlciBhbnkgZmVhdHVyZXMiKSk6dm9pZCBvLnJlc3RvcmUoKX0scGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGEsYj1vLmksYz1vLiRyZSgvXkBwbHVnaW4/XHMrLyk7aWYoYyl7dmFyIGU9e3BsdWdpbjohMH07aWYoYT10aGlzLmVudGl0aWVzLnF1b3RlZCgpfHx0aGlzLmVudGl0aWVzLnVybCgpKXJldHVybiBvLiRjaGFyKCI7Iil8fChvLmk9YixsKCJtaXNzaW5nIHNlbWktY29sb24gb24gcGx1Z2luIikpLG5ldyBkLkltcG9ydChhLG51bGwsZSxiLGgpO28uaT1iLGwoIm1hbGZvcm1lZCBwbHVnaW4gc3RhdGVtZW50Iil9fSxkaXJlY3RpdmU6ZnVuY3Rpb24oKXt2YXIgYixjLGUsZixnLGksaixrPW8uaSxuPSEwLHA9ITA7aWYoIkAiPT09by5jdXJyZW50Q2hhcigpKXtpZihjPXRoaXNbImltcG9ydCJdKCl8fHRoaXMucGx1Z2luKCl8fHRoaXMubWVkaWEoKSlyZXR1cm4gYztpZihvLnNhdmUoKSxiPW8uJHJlKC9eQFthLXotXSsvKSl7c3dpdGNoKGY9YiwiLSI9PWIuY2hhckF0KDEpJiZiLmluZGV4T2YoIi0iLDIpPjAmJihmPSJAIitiLnNsaWNlKGIuaW5kZXhPZigiLSIsMikrMSkpLGYpe2Nhc2UiQGNvdW50ZXItc3R5bGUiOmc9ITAsbj0hMDticmVhaztjYXNlIkBjaGFyc2V0IjpnPSEwLG49ITE7YnJlYWs7Y2FzZSJAbmFtZXNwYWNlIjppPSEwLG49ITE7YnJlYWs7Y2FzZSJAa2V5ZnJhbWVzIjpnPSEwO2JyZWFrO2Nhc2UiQGhvc3QiOmNhc2UiQHBhZ2UiOmo9ITA7YnJlYWs7Y2FzZSJAZG9jdW1lbnQiOmNhc2UiQHN1cHBvcnRzIjpqPSEwLHA9ITF9cmV0dXJuIG8uY29tbWVudFN0b3JlLmxlbmd0aD0wLGc/KGM9dGhpcy5lbnRpdHkoKSxjfHxsKCJleHBlY3RlZCAiK2IrIiBpZGVudGlmaWVyIikpOmk/KGM9dGhpcy5leHByZXNzaW9uKCksY3x8bCgiZXhwZWN0ZWQgIitiKyIgZXhwcmVzc2lvbiIpKTpqJiYoYz0oby4kcmUoL15bXns7XSsvKXx8IiIpLnRyaW0oKSxjJiYoYz1uZXcgZC5Bbm9ueW1vdXMoYykpKSxuJiYoZT10aGlzLmJsb2NrUnVsZXNldCgpKSxlfHwhbiYmYyYmby4kY2hhcigiOyIpPyhvLmZvcmdldCgpLG5ldyBkLkRpcmVjdGl2ZShiLGMsZSxrLGgsYS5kdW1wTGluZU51bWJlcnM/bShrKTpudWxsLCExLHApKTp2b2lkIG8ucmVzdG9yZSgiZGlyZWN0aXZlIG9wdGlvbnMgbm90IHJlY29nbmlzZWQiKX19fSx2YWx1ZTpmdW5jdGlvbigpe3ZhciBhLGI9W107ZG8gaWYoYT10aGlzLmV4cHJlc3Npb24oKSxhJiYoYi5wdXNoKGEpLCFvLiRjaGFyKCIsIikpKWJyZWFrO3doaWxlKGEpO3JldHVybiBiLmxlbmd0aD4wP25ldyBkLlZhbHVlKGIpOnZvaWQgMH0saW1wb3J0YW50OmZ1bmN0aW9uKCl7cmV0dXJuIiEiPT09by5jdXJyZW50Q2hhcigpP28uJHJlKC9eISAqaW1wb3J0YW50Lyk6dm9pZCAwfSxzdWI6ZnVuY3Rpb24oKXt2YXIgYSxiO3JldHVybiBvLnNhdmUoKSxvLiRjaGFyKCIoIik/KGE9dGhpcy5hZGRpdGlvbigpLGEmJm8uJGNoYXIoIikiKT8oby5mb3JnZXQoKSxiPW5ldyBkLkV4cHJlc3Npb24oW2FdKSxiLnBhcmVucz0hMCxiKTp2b2lkIG8ucmVzdG9yZSgiRXhwZWN0ZWQgJyknIikpOnZvaWQgby5yZXN0b3JlKCl9LG11bHRpcGxpY2F0aW9uOmZ1bmN0aW9uKCl7dmFyIGEsYixjLGUsZjtpZihhPXRoaXMub3BlcmFuZCgpKXtmb3IoZj1vLmlzV2hpdGVzcGFjZSgtMSk7Oyl7aWYoby5wZWVrKC9eXC9bKlwvXS8pKWJyZWFrO2lmKG8uc2F2ZSgpLGM9by4kY2hhcigiLyIpfHxvLiRjaGFyKCIqIiksIWMpe28uZm9yZ2V0KCk7YnJlYWt9aWYoYj10aGlzLm9wZXJhbmQoKSwhYil7by5yZXN0b3JlKCk7YnJlYWt9by5mb3JnZXQoKSxhLnBhcmVuc0luT3A9ITAsYi5wYXJlbnNJbk9wPSEwLGU9bmV3IGQuT3BlcmF0aW9uKGMsW2V8fGEsYl0sZiksZj1vLmlzV2hpdGVzcGFjZSgtMSl9cmV0dXJuIGV8fGF9fSxhZGRpdGlvbjpmdW5jdGlvbigpe3ZhciBhLGIsYyxlLGY7aWYoYT10aGlzLm11bHRpcGxpY2F0aW9uKCkpe2ZvcihmPW8uaXNXaGl0ZXNwYWNlKC0xKTs7KXtpZihjPW8uJHJlKC9eWy0rXVxzKy8pfHwhZiYmKG8uJGNoYXIoIisiKXx8by4kY2hhcigiLSIpKSwhYylicmVhaztpZihiPXRoaXMubXVsdGlwbGljYXRpb24oKSwhYilicmVhazthLnBhcmVuc0luT3A9ITAsYi5wYXJlbnNJbk9wPSEwLGU9bmV3IGQuT3BlcmF0aW9uKGMsW2V8fGEsYl0sZiksZj1vLmlzV2hpdGVzcGFjZSgtMSl9cmV0dXJuIGV8fGF9fSxjb25kaXRpb25zOmZ1bmN0aW9uKCl7dmFyIGEsYixjLGU9by5pO2lmKGE9dGhpcy5jb25kaXRpb24oKSl7Zm9yKDs7KXtpZighby5wZWVrKC9eLFxzKihub3RccyopP1woLyl8fCFvLiRjaGFyKCIsIikpYnJlYWs7aWYoYj10aGlzLmNvbmRpdGlvbigpLCFiKWJyZWFrO2M9bmV3IGQuQ29uZGl0aW9uKCJvciIsY3x8YSxiLGUpfXJldHVybiBjfHxhfX0sY29uZGl0aW9uOmZ1bmN0aW9uKCl7dmFyIGEsYixjLGUsZj10aGlzLmVudGl0aWVzLGc9by5pLGg9ITE7cmV0dXJuIG8uJHN0cigibm90IikmJihoPSEwKSxrKCIoIiksYT10aGlzLmFkZGl0aW9uKCl8fGYua2V5d29yZCgpfHxmLnF1b3RlZCgpLGE/KG8uJGNoYXIoIj4iKT9lPW8uJGNoYXIoIj0iKT8iPj0iOiI+IjpvLiRjaGFyKCI8Iik/ZT1vLiRjaGFyKCI9Iik/Ijw9IjoiPCI6by4kY2hhcigiPSIpJiYoZT1vLiRjaGFyKCI+Iik/Ij0+IjpvLiRjaGFyKCI8Iik/Ij08IjoiPSIpLGU/KGI9dGhpcy5hZGRpdGlvbigpfHxmLmtleXdvcmQoKXx8Zi5xdW90ZWQoKSxiP2M9bmV3IGQuQ29uZGl0aW9uKGUsYSxiLGcsaCk6bCgiZXhwZWN0ZWQgZXhwcmVzc2lvbiIpKTpjPW5ldyBkLkNvbmRpdGlvbigiPSIsYSxuZXcgZC5LZXl3b3JkKCJ0cnVlIiksZyxoKSxrKCIpIiksby4kc3RyKCJhbmQiKT9uZXcgZC5Db25kaXRpb24oImFuZCIsYyx0aGlzLmNvbmRpdGlvbigpKTpjKTp2b2lkIDB9LG9wZXJhbmQ6ZnVuY3Rpb24oKXt2YXIgYSxiPXRoaXMuZW50aXRpZXM7by5wZWVrKC9eLVtAXChdLykmJihhPW8uJGNoYXIoIi0iKSk7dmFyIGM9dGhpcy5zdWIoKXx8Yi5kaW1lbnNpb24oKXx8Yi5jb2xvcigpfHxiLnZhcmlhYmxlKCl8fGIuY2FsbCgpO3JldHVybiBhJiYoYy5wYXJlbnNJbk9wPSEwLGM9bmV3IGQuTmVnYXRpdmUoYykpLGN9LGV4cHJlc3Npb246ZnVuY3Rpb24oKXt2YXIgYSxiLGM9W107ZG8gYT10aGlzLmNvbW1lbnQoKSxhP2MucHVzaChhKTooYT10aGlzLmFkZGl0aW9uKCl8fHRoaXMuZW50aXR5KCksYSYmKGMucHVzaChhKSxvLnBlZWsoL15cL1tcLypdLyl8fChiPW8uJGNoYXIoIi8iKSxiJiZjLnB1c2gobmV3IGQuQW5vbnltb3VzKGIpKSkpKTt3aGlsZShhKTtyZXR1cm4gYy5sZW5ndGg+MD9uZXcgZC5FeHByZXNzaW9uKGMpOnZvaWQgMH0scHJvcGVydHk6ZnVuY3Rpb24oKXt2YXIgYT1vLiRyZSgvXihcKj8tP1tfYS16QS1aMC05LV0rKVxzKjovKTtyZXR1cm4gYT9hWzFdOnZvaWQgMH0scnVsZVByb3BlcnR5OmZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShhKXt2YXIgYj1vLmksYz1vLiRyZShhKTtyZXR1cm4gYz8oZi5wdXNoKGIpLGUucHVzaChjWzFdKSk6dm9pZCAwfXZhciBiLGMsZT1bXSxmPVtdO28uc2F2ZSgpO3ZhciBnPW8uJHJlKC9eKFtfYS16QS1aMC05LV0rKVxzKjovKTtpZihnKXJldHVybiBlPVtuZXcgZC5LZXl3b3JkKGdbMV0pXSxvLmZvcmdldCgpLGU7Zm9yKGEoL14oXCo/KS8pOzspaWYoIWEoL14oKD86W1x3LV0rKXwoPzpAXHtbXHctXStcfSkpLykpYnJlYWs7aWYoZS5sZW5ndGg+MSYmYSgvXigoPzpcK198XCspPylccyo6Lykpe2ZvcihvLmZvcmdldCgpLCIiPT09ZVswXSYmKGUuc2hpZnQoKSxmLnNoaWZ0KCkpLGM9MDtlLmxlbmd0aD5jO2MrKyliPWVbY10sZVtjXT0iQCIhPT1iLmNoYXJBdCgwKT9uZXcgZC5LZXl3b3JkKGIpOm5ldyBkLlZhcmlhYmxlKCJAIitiLnNsaWNlKDIsLTEpLGZbY10saCk7cmV0dXJuIGV9by5yZXN0b3JlKCl9fX19O2guc2VyaWFsaXplVmFycz1mdW5jdGlvbihhKXt2YXIgYj0iIjtmb3IodmFyIGMgaW4gYSlpZihPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChhLGMpKXt2YXIgZD1hW2NdO2IrPSgiQCI9PT1jWzBdPyIiOiJAIikrYysiOiAiK2QrKCI7Ij09PVN0cmluZyhkKS5zbGljZSgtMSk/IiI6IjsiKX1yZXR1cm4gYn0sYi5leHBvcnRzPWh9LHsiLi4vbGVzcy1lcnJvciI6MzAsIi4uL3RyZWUiOjYwLCIuLi91dGlscyI6ODEsIi4uL3Zpc2l0b3JzIjo4NSwiLi9wYXJzZXItaW5wdXQiOjM1fV0sMzc6W2Z1bmN0aW9uKGEsYil7dmFyIGM9ZnVuY3Rpb24oYSl7dGhpcy5sZXNzPWEsdGhpcy52aXNpdG9ycz1bXSx0aGlzLnByZVByb2Nlc3NvcnM9W10sdGhpcy5wb3N0UHJvY2Vzc29ycz1bXSx0aGlzLmluc3RhbGxlZFBsdWdpbnM9W10sdGhpcy5maWxlTWFuYWdlcnM9W119O2MucHJvdG90eXBlLmFkZFBsdWdpbnM9ZnVuY3Rpb24oYSl7aWYoYSlmb3IodmFyIGI9MDthLmxlbmd0aD5iO2IrKyl0aGlzLmFkZFBsdWdpbihhW2JdKX0sYy5wcm90b3R5cGUuYWRkUGx1Z2luPWZ1bmN0aW9uKGEpe3RoaXMuaW5zdGFsbGVkUGx1Z2lucy5wdXNoKGEpLGEuaW5zdGFsbCh0aGlzLmxlc3MsdGhpcyl9LGMucHJvdG90eXBlLmFkZFZpc2l0b3I9ZnVuY3Rpb24oYSl7dGhpcy52aXNpdG9ycy5wdXNoKGEpfSxjLnByb3RvdHlwZS5hZGRQcmVQcm9jZXNzb3I9ZnVuY3Rpb24oYSxiKXt2YXIgYztmb3IoYz0wO3RoaXMucHJlUHJvY2Vzc29ycy5sZW5ndGg+YyYmISh0aGlzLnByZVByb2Nlc3NvcnNbY10ucHJpb3JpdHk+PWIpO2MrKyk7dGhpcy5wcmVQcm9jZXNzb3JzLnNwbGljZShjLDAse3ByZVByb2Nlc3NvcjphLHByaW9yaXR5OmJ9KX0sYy5wcm90b3R5cGUuYWRkUG9zdFByb2Nlc3Nvcj1mdW5jdGlvbihhLGIpe3ZhciBjO2ZvcihjPTA7dGhpcy5wb3N0UHJvY2Vzc29ycy5sZW5ndGg+YyYmISh0aGlzLnBvc3RQcm9jZXNzb3JzW2NdLnByaW9yaXR5Pj1iKTtjKyspO3RoaXMucG9zdFByb2Nlc3NvcnMuc3BsaWNlKGMsMCx7cG9zdFByb2Nlc3NvcjphLHByaW9yaXR5OmJ9KX0sYy5wcm90b3R5cGUuYWRkRmlsZU1hbmFnZXI9ZnVuY3Rpb24oYSl7dGhpcy5maWxlTWFuYWdlcnMucHVzaChhKX0sYy5wcm90b3R5cGUuZ2V0UHJlUHJvY2Vzc29ycz1mdW5jdGlvbigpe2Zvcih2YXIgYT1bXSxiPTA7dGhpcy5wcmVQcm9jZXNzb3JzLmxlbmd0aD5iO2IrKylhLnB1c2godGhpcy5wcmVQcm9jZXNzb3JzW2JdLnByZVByb2Nlc3Nvcik7cmV0dXJuIGF9LGMucHJvdG90eXBlLmdldFBvc3RQcm9jZXNzb3JzPWZ1bmN0aW9uKCl7Zm9yKHZhciBhPVtdLGI9MDt0aGlzLnBvc3RQcm9jZXNzb3JzLmxlbmd0aD5iO2IrKylhLnB1c2godGhpcy5wb3N0UHJvY2Vzc29yc1tiXS5wb3N0UHJvY2Vzc29yKTtyZXR1cm4gYX0sYy5wcm90b3R5cGUuZ2V0VmlzaXRvcnM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy52aXNpdG9yc30sYy5wcm90b3R5cGUuZ2V0RmlsZU1hbmFnZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZmlsZU1hbmFnZXJzfSxiLmV4cG9ydHM9Y30se31dLDM4OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4uL2xlc3MtZXJyb3IiKSxkPWEoIi4uL3RyZWUiKSxlPWIuZXhwb3J0cz1mdW5jdGlvbihhLGIpe3RoaXMuZmlsZUluZm89Yn07ZS5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhLGIpe3ZhciBlLGYsZz17fTtmPXthZGQ6ZnVuY3Rpb24oYSxiKXtnW2FdPWJ9LGFkZE11bHRpcGxlOmZ1bmN0aW9uKGEpe09iamVjdC5rZXlzKGEpLmZvckVhY2goZnVuY3Rpb24oYil7Z1tiXT1hW2JdfSl9fTt0cnl7ZT1uZXcgRnVuY3Rpb24oImZ1bmN0aW9ucyIsInRyZWUiLCJmaWxlSW5mbyIsYSksZShmLGQsdGhpcy5maWxlSW5mbyl9Y2F0Y2goaCl7YihuZXcgYyh7bWVzc2FnZToiUGx1Z2luIGV2YWx1YXRpb24gZXJyb3I6ICciK2gubmFtZSsiOiAiK2gubWVzc2FnZS5yZXBsYWNlKC9bIl0vZywiJyIpKyInIixmaWxlbmFtZTp0aGlzLmZpbGVJbmZvLmZpbGVuYW1lfSksbnVsbCl9YihudWxsLHtmdW5jdGlvbnM6Z30pfX0seyIuLi9sZXNzLWVycm9yIjozMCwiLi4vdHJlZSI6NjB9XSwzOTpbZnVuY3Rpb24oYSxiKXt2YXIgYztiLmV4cG9ydHM9ZnVuY3Rpb24oYixkKXt2YXIgZT1mdW5jdGlvbihiLGYsZyl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGYmJihnPWYsZj17fSksIWcpe2N8fChjPSJ1bmRlZmluZWQiPT10eXBlb2YgUHJvbWlzZT9hKCJwcm9taXNlIik6UHJvbWlzZSk7dmFyIGg9dGhpcztyZXR1cm4gbmV3IGMoZnVuY3Rpb24oYSxjKXtlLmNhbGwoaCxiLGYsZnVuY3Rpb24oYixkKXtiP2MoYik6YShkKX0pfSl9dGhpcy5wYXJzZShiLGYsZnVuY3Rpb24oYSxiLGMsZSl7aWYoYSlyZXR1cm4gZyhhKTt2YXIgZjt0cnl7dmFyIGg9bmV3IGQoYixjKTtmPWgudG9DU1MoZSl9Y2F0Y2goYSl7cmV0dXJuIGcoYSl9ZyhudWxsLGYpfSl9O3JldHVybiBlfX0se3Byb21pc2U6dm9pZCAwfV0sNDA6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPWZ1bmN0aW9uKGEsYil7dmFyIGM9ZnVuY3Rpb24oYSl7dGhpcy5vcHRpb25zPWF9O3JldHVybiBjLnByb3RvdHlwZS50b0NTUz1mdW5jdGlvbihiLGMsZCl7dmFyIGU9bmV3IGEoe2NvbnRlbnRzSWdub3JlZENoYXJzTWFwOmQuY29udGVudHNJZ25vcmVkQ2hhcnMscm9vdE5vZGU6Yixjb250ZW50c01hcDpkLmNvbnRlbnRzLHNvdXJjZU1hcEZpbGVuYW1lOnRoaXMub3B0aW9ucy5zb3VyY2VNYXBGaWxlbmFtZSxzb3VyY2VNYXBVUkw6dGhpcy5vcHRpb25zLnNvdXJjZU1hcFVSTCxvdXRwdXRGaWxlbmFtZTp0aGlzLm9wdGlvbnMuc291cmNlTWFwT3V0cHV0RmlsZW5hbWUsc291cmNlTWFwQmFzZXBhdGg6dGhpcy5vcHRpb25zLnNvdXJjZU1hcEJhc2VwYXRoLHNvdXJjZU1hcFJvb3RwYXRoOnRoaXMub3B0aW9ucy5zb3VyY2VNYXBSb290cGF0aCxvdXRwdXRTb3VyY2VGaWxlczp0aGlzLm9wdGlvbnMub3V0cHV0U291cmNlRmlsZXMsc291cmNlTWFwR2VuZXJhdG9yOnRoaXMub3B0aW9ucy5zb3VyY2VNYXBHZW5lcmF0b3Isc291cmNlTWFwRmlsZUlubGluZTp0aGlzLm9wdGlvbnMuc291cmNlTWFwRmlsZUlubGluZX0pLGY9ZS50b0NTUyhjKTtyZXR1cm4gdGhpcy5zb3VyY2VNYXA9ZS5zb3VyY2VNYXAsdGhpcy5zb3VyY2VNYXBVUkw9ZS5zb3VyY2VNYXBVUkwsdGhpcy5vcHRpb25zLnNvdXJjZU1hcElucHV0RmlsZW5hbWUmJih0aGlzLnNvdXJjZU1hcElucHV0RmlsZW5hbWU9ZS5ub3JtYWxpemVGaWxlbmFtZSh0aGlzLm9wdGlvbnMuc291cmNlTWFwSW5wdXRGaWxlbmFtZSkpLGYrdGhpcy5nZXRDU1NBcHBlbmRhZ2UoKX0sYy5wcm90b3R5cGUuZ2V0Q1NTQXBwZW5kYWdlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5zb3VyY2VNYXBVUkw7aWYodGhpcy5vcHRpb25zLnNvdXJjZU1hcEZpbGVJbmxpbmUpe2lmKHZvaWQgMD09PXRoaXMuc291cmNlTWFwKXJldHVybiIiO2E9ImRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsIitiLmVuY29kZUJhc2U2NCh0aGlzLnNvdXJjZU1hcCl9cmV0dXJuIGE/Ii8qIyBzb3VyY2VNYXBwaW5nVVJMPSIrYSsiICovIjoiIn0sYy5wcm90b3R5cGUuZ2V0RXh0ZXJuYWxTb3VyY2VNYXA9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zb3VyY2VNYXB9LGMucHJvdG90eXBlLnNldEV4dGVybmFsU291cmNlTWFwPWZ1bmN0aW9uKGEpe3RoaXMuc291cmNlTWFwPWF9LGMucHJvdG90eXBlLmlzSW5saW5lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5zb3VyY2VNYXBGaWxlSW5saW5lfSxjLnByb3RvdHlwZS5nZXRTb3VyY2VNYXBVUkw9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zb3VyY2VNYXBVUkx9LGMucHJvdG90eXBlLmdldE91dHB1dEZpbGVuYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5zb3VyY2VNYXBPdXRwdXRGaWxlbmFtZX0sYy5wcm90b3R5cGUuZ2V0SW5wdXRGaWxlbmFtZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnNvdXJjZU1hcElucHV0RmlsZW5hbWV9LGN9fSx7fV0sNDE6W2Z1bmN0aW9uKGEsYil7Yi5leHBvcnRzPWZ1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGIpe3RoaXMuX2Nzcz1bXSx0aGlzLl9yb290Tm9kZT1iLnJvb3ROb2RlLHRoaXMuX2NvbnRlbnRzTWFwPWIuY29udGVudHNNYXAsdGhpcy5fY29udGVudHNJZ25vcmVkQ2hhcnNNYXA9Yi5jb250ZW50c0lnbm9yZWRDaGFyc01hcCxiLnNvdXJjZU1hcEZpbGVuYW1lJiYodGhpcy5fc291cmNlTWFwRmlsZW5hbWU9Yi5zb3VyY2VNYXBGaWxlbmFtZS5yZXBsYWNlKC9cXC9nLCIvIikpLHRoaXMuX291dHB1dEZpbGVuYW1lPWIub3V0cHV0RmlsZW5hbWUsdGhpcy5zb3VyY2VNYXBVUkw9Yi5zb3VyY2VNYXBVUkwsYi5zb3VyY2VNYXBCYXNlcGF0aCYmKHRoaXMuX3NvdXJjZU1hcEJhc2VwYXRoPWIuc291cmNlTWFwQmFzZXBhdGgucmVwbGFjZSgvXFwvZywiLyIpKSwNCmIuc291cmNlTWFwUm9vdHBhdGg/KHRoaXMuX3NvdXJjZU1hcFJvb3RwYXRoPWIuc291cmNlTWFwUm9vdHBhdGgucmVwbGFjZSgvXFwvZywiLyIpLCIvIiE9PXRoaXMuX3NvdXJjZU1hcFJvb3RwYXRoLmNoYXJBdCh0aGlzLl9zb3VyY2VNYXBSb290cGF0aC5sZW5ndGgtMSkmJih0aGlzLl9zb3VyY2VNYXBSb290cGF0aCs9Ii8iKSk6dGhpcy5fc291cmNlTWFwUm9vdHBhdGg9IiIsdGhpcy5fb3V0cHV0U291cmNlRmlsZXM9Yi5vdXRwdXRTb3VyY2VGaWxlcyx0aGlzLl9zb3VyY2VNYXBHZW5lcmF0b3JDb25zdHJ1Y3Rvcj1hLmdldFNvdXJjZU1hcEdlbmVyYXRvcigpLHRoaXMuX2xpbmVOdW1iZXI9MCx0aGlzLl9jb2x1bW49MH07cmV0dXJuIGIucHJvdG90eXBlLm5vcm1hbGl6ZUZpbGVuYW1lPWZ1bmN0aW9uKGEpe3JldHVybiBhPWEucmVwbGFjZSgvXFwvZywiLyIpLHRoaXMuX3NvdXJjZU1hcEJhc2VwYXRoJiYwPT09YS5pbmRleE9mKHRoaXMuX3NvdXJjZU1hcEJhc2VwYXRoKSYmKGE9YS5zdWJzdHJpbmcodGhpcy5fc291cmNlTWFwQmFzZXBhdGgubGVuZ3RoKSwoIlxcIj09PWEuY2hhckF0KDApfHwiLyI9PT1hLmNoYXJBdCgwKSkmJihhPWEuc3Vic3RyaW5nKDEpKSksKHRoaXMuX3NvdXJjZU1hcFJvb3RwYXRofHwiIikrYX0sYi5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKGEsYixjLGQpe2lmKGEpe3ZhciBlLGYsZyxoLGk7aWYoYil7dmFyIGo9dGhpcy5fY29udGVudHNNYXBbYi5maWxlbmFtZV07dGhpcy5fY29udGVudHNJZ25vcmVkQ2hhcnNNYXBbYi5maWxlbmFtZV0mJihjLT10aGlzLl9jb250ZW50c0lnbm9yZWRDaGFyc01hcFtiLmZpbGVuYW1lXSwwPmMmJihjPTApLGo9ai5zbGljZSh0aGlzLl9jb250ZW50c0lnbm9yZWRDaGFyc01hcFtiLmZpbGVuYW1lXSkpLGo9ai5zdWJzdHJpbmcoMCxjKSxmPWouc3BsaXQoIlxuIiksaD1mW2YubGVuZ3RoLTFdfWlmKGU9YS5zcGxpdCgiXG4iKSxnPWVbZS5sZW5ndGgtMV0sYilpZihkKWZvcihpPTA7ZS5sZW5ndGg+aTtpKyspdGhpcy5fc291cmNlTWFwR2VuZXJhdG9yLmFkZE1hcHBpbmcoe2dlbmVyYXRlZDp7bGluZTp0aGlzLl9saW5lTnVtYmVyK2krMSxjb2x1bW46MD09PWk/dGhpcy5fY29sdW1uOjB9LG9yaWdpbmFsOntsaW5lOmYubGVuZ3RoK2ksY29sdW1uOjA9PT1pP2gubGVuZ3RoOjB9LHNvdXJjZTp0aGlzLm5vcm1hbGl6ZUZpbGVuYW1lKGIuZmlsZW5hbWUpfSk7ZWxzZSB0aGlzLl9zb3VyY2VNYXBHZW5lcmF0b3IuYWRkTWFwcGluZyh7Z2VuZXJhdGVkOntsaW5lOnRoaXMuX2xpbmVOdW1iZXIrMSxjb2x1bW46dGhpcy5fY29sdW1ufSxvcmlnaW5hbDp7bGluZTpmLmxlbmd0aCxjb2x1bW46aC5sZW5ndGh9LHNvdXJjZTp0aGlzLm5vcm1hbGl6ZUZpbGVuYW1lKGIuZmlsZW5hbWUpfSk7MT09PWUubGVuZ3RoP3RoaXMuX2NvbHVtbis9Zy5sZW5ndGg6KHRoaXMuX2xpbmVOdW1iZXIrPWUubGVuZ3RoLTEsdGhpcy5fY29sdW1uPWcubGVuZ3RoKSx0aGlzLl9jc3MucHVzaChhKX19LGIucHJvdG90eXBlLmlzRW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4gMD09PXRoaXMuX2Nzcy5sZW5ndGh9LGIucHJvdG90eXBlLnRvQ1NTPWZ1bmN0aW9uKGEpe2lmKHRoaXMuX3NvdXJjZU1hcEdlbmVyYXRvcj1uZXcgdGhpcy5fc291cmNlTWFwR2VuZXJhdG9yQ29uc3RydWN0b3Ioe2ZpbGU6dGhpcy5fb3V0cHV0RmlsZW5hbWUsc291cmNlUm9vdDpudWxsfSksdGhpcy5fb3V0cHV0U291cmNlRmlsZXMpZm9yKHZhciBiIGluIHRoaXMuX2NvbnRlbnRzTWFwKWlmKHRoaXMuX2NvbnRlbnRzTWFwLmhhc093blByb3BlcnR5KGIpKXt2YXIgYz10aGlzLl9jb250ZW50c01hcFtiXTt0aGlzLl9jb250ZW50c0lnbm9yZWRDaGFyc01hcFtiXSYmKGM9Yy5zbGljZSh0aGlzLl9jb250ZW50c0lnbm9yZWRDaGFyc01hcFtiXSkpLHRoaXMuX3NvdXJjZU1hcEdlbmVyYXRvci5zZXRTb3VyY2VDb250ZW50KHRoaXMubm9ybWFsaXplRmlsZW5hbWUoYiksYyl9aWYodGhpcy5fcm9vdE5vZGUuZ2VuQ1NTKGEsdGhpcyksdGhpcy5fY3NzLmxlbmd0aD4wKXt2YXIgZCxlPUpTT04uc3RyaW5naWZ5KHRoaXMuX3NvdXJjZU1hcEdlbmVyYXRvci50b0pTT04oKSk7dGhpcy5zb3VyY2VNYXBVUkw/ZD10aGlzLnNvdXJjZU1hcFVSTDp0aGlzLl9zb3VyY2VNYXBGaWxlbmFtZSYmKGQ9dGhpcy5fc291cmNlTWFwRmlsZW5hbWUpLHRoaXMuc291cmNlTWFwVVJMPWQsdGhpcy5zb3VyY2VNYXA9ZX1yZXR1cm4gdGhpcy5fY3NzLmpvaW4oIiIpfSxifX0se31dLDQyOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vY29udGV4dHMiKSxkPWEoIi4vdmlzaXRvcnMiKSxlPWEoIi4vdHJlZSIpO2IuZXhwb3J0cz1mdW5jdGlvbihhLGIpe2I9Ynx8e307dmFyIGYsZz1iLnZhcmlhYmxlcyxoPW5ldyBjLkV2YWwoYik7Im9iamVjdCIhPXR5cGVvZiBnfHxBcnJheS5pc0FycmF5KGcpfHwoZz1PYmplY3Qua2V5cyhnKS5tYXAoZnVuY3Rpb24oYSl7dmFyIGI9Z1thXTtyZXR1cm4gYiBpbnN0YW5jZW9mIGUuVmFsdWV8fChiIGluc3RhbmNlb2YgZS5FeHByZXNzaW9ufHwoYj1uZXcgZS5FeHByZXNzaW9uKFtiXSkpLGI9bmV3IGUuVmFsdWUoW2JdKSksbmV3IGUuUnVsZSgiQCIrYSxiLCExLG51bGwsMCl9KSxoLmZyYW1lcz1bbmV3IGUuUnVsZXNldChudWxsLGcpXSk7dmFyIGksaj1bXSxrPVtuZXcgZC5Kb2luU2VsZWN0b3JWaXNpdG9yLG5ldyBkLkV4dGVuZFZpc2l0b3IsbmV3IGQuVG9DU1NWaXNpdG9yKHtjb21wcmVzczpCb29sZWFuKGIuY29tcHJlc3MpfSldO2lmKGIucGx1Z2luTWFuYWdlcil7dmFyIGw9Yi5wbHVnaW5NYW5hZ2VyLmdldFZpc2l0b3JzKCk7Zm9yKGk9MDtsLmxlbmd0aD5pO2krKyl7dmFyIG09bFtpXTttLmlzUHJlRXZhbFZpc2l0b3I/ai5wdXNoKG0pOm0uaXNQcmVWaXNpdG9yP2suc3BsaWNlKDAsMCxtKTprLnB1c2gobSl9fWZvcihpPTA7ai5sZW5ndGg+aTtpKyspaltpXS5ydW4oYSk7Zm9yKGY9YS5ldmFsKGgpLGk9MDtrLmxlbmd0aD5pO2krKylrW2ldLnJ1bihmKTtyZXR1cm4gZn19LHsiLi9jb250ZXh0cyI6MTAsIi4vdHJlZSI6NjAsIi4vdmlzaXRvcnMiOjg1fV0sNDM6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1mdW5jdGlvbihhKXt0aGlzLnZhbHVlPWF9O2QucHJvdG90eXBlPW5ldyBjLGQucHJvdG90eXBlLnR5cGU9IkFscGhhIixkLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy52YWx1ZT1hLnZpc2l0KHRoaXMudmFsdWUpfSxkLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnZhbHVlLmV2YWw/bmV3IGQodGhpcy52YWx1ZS5ldmFsKGEpKTp0aGlzfSxkLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtiLmFkZCgiYWxwaGEob3BhY2l0eT0iKSx0aGlzLnZhbHVlLmdlbkNTUz90aGlzLnZhbHVlLmdlbkNTUyhhLGIpOmIuYWRkKHRoaXMudmFsdWUpLGIuYWRkKCIpIil9LGIuZXhwb3J0cz1kfSx7Ii4vbm9kZSI6Njh9XSw0NDpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWZ1bmN0aW9uKGEsYixjLGQsZSl7dGhpcy52YWx1ZT1hLHRoaXMuaW5kZXg9Yix0aGlzLm1hcExpbmVzPWQsdGhpcy5jdXJyZW50RmlsZUluZm89Yyx0aGlzLnJ1bGVzZXRMaWtlPSJ1bmRlZmluZWQiPT10eXBlb2YgZT8hMTplfTtkLnByb3RvdHlwZT1uZXcgYyxkLnByb3RvdHlwZS50eXBlPSJBbm9ueW1vdXMiLGQucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGQodGhpcy52YWx1ZSx0aGlzLmluZGV4LHRoaXMuY3VycmVudEZpbGVJbmZvLHRoaXMubWFwTGluZXMsdGhpcy5ydWxlc2V0TGlrZSl9LGQucHJvdG90eXBlLmNvbXBhcmU9ZnVuY3Rpb24oYSl7cmV0dXJuIGEudG9DU1MmJnRoaXMudG9DU1MoKT09PWEudG9DU1MoKT8wOnZvaWQgMH0sZC5wcm90b3R5cGUuaXNSdWxlc2V0TGlrZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJ1bGVzZXRMaWtlfSxkLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtiLmFkZCh0aGlzLnZhbHVlLHRoaXMuY3VycmVudEZpbGVJbmZvLHRoaXMuaW5kZXgsdGhpcy5tYXBMaW5lcyl9LGIuZXhwb3J0cz1kfSx7Ii4vbm9kZSI6Njh9XSw0NTpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWZ1bmN0aW9uKGEsYil7dGhpcy5rZXk9YSx0aGlzLnZhbHVlPWJ9O2QucHJvdG90eXBlPW5ldyBjLGQucHJvdG90eXBlLnR5cGU9IkFzc2lnbm1lbnQiLGQucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLnZhbHVlPWEudmlzaXQodGhpcy52YWx1ZSl9LGQucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMudmFsdWUuZXZhbD9uZXcgZCh0aGlzLmtleSx0aGlzLnZhbHVlLmV2YWwoYSkpOnRoaXN9LGQucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe2IuYWRkKHRoaXMua2V5KyI9IiksdGhpcy52YWx1ZS5nZW5DU1M/dGhpcy52YWx1ZS5nZW5DU1MoYSxiKTpiLmFkZCh0aGlzLnZhbHVlKX0sYi5leHBvcnRzPWR9LHsiLi9ub2RlIjo2OH1dLDQ2OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9ZnVuY3Rpb24oYSxiLGMpe3RoaXMua2V5PWEsdGhpcy5vcD1iLHRoaXMudmFsdWU9Y307ZC5wcm90b3R5cGU9bmV3IGMsZC5wcm90b3R5cGUudHlwZT0iQXR0cmlidXRlIixkLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZCh0aGlzLmtleS5ldmFsP3RoaXMua2V5LmV2YWwoYSk6dGhpcy5rZXksdGhpcy5vcCx0aGlzLnZhbHVlJiZ0aGlzLnZhbHVlLmV2YWw/dGhpcy52YWx1ZS5ldmFsKGEpOnRoaXMudmFsdWUpfSxkLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtiLmFkZCh0aGlzLnRvQ1NTKGEpKX0sZC5wcm90b3R5cGUudG9DU1M9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5rZXkudG9DU1M/dGhpcy5rZXkudG9DU1MoYSk6dGhpcy5rZXk7cmV0dXJuIHRoaXMub3AmJihiKz10aGlzLm9wLGIrPXRoaXMudmFsdWUudG9DU1M/dGhpcy52YWx1ZS50b0NTUyhhKTp0aGlzLnZhbHVlKSwiWyIrYisiXSJ9LGIuZXhwb3J0cz1kfSx7Ii4vbm9kZSI6Njh9XSw0NzpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4uL2Z1bmN0aW9ucy9mdW5jdGlvbi1jYWxsZXIiKSxlPWZ1bmN0aW9uKGEsYixjLGQpe3RoaXMubmFtZT1hLHRoaXMuYXJncz1iLHRoaXMuaW5kZXg9Yyx0aGlzLmN1cnJlbnRGaWxlSW5mbz1kfTtlLnByb3RvdHlwZT1uZXcgYyxlLnByb3RvdHlwZS50eXBlPSJDYWxsIixlLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5hcmdzJiYodGhpcy5hcmdzPWEudmlzaXRBcnJheSh0aGlzLmFyZ3MpKX0sZS5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXt2YXIgYixjPXRoaXMuYXJncy5tYXAoZnVuY3Rpb24oYil7cmV0dXJuIGIuZXZhbChhKX0pLGY9bmV3IGQodGhpcy5uYW1lLGEsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyk7aWYoZi5pc1ZhbGlkKCkpdHJ5e2lmKGI9Zi5jYWxsKGMpLG51bGwhPWIpcmV0dXJuIGJ9Y2F0Y2goZyl7dGhyb3d7dHlwZTpnLnR5cGV8fCJSdW50aW1lIixtZXNzYWdlOiJlcnJvciBldmFsdWF0aW5nIGZ1bmN0aW9uIGAiK3RoaXMubmFtZSsiYCIrKGcubWVzc2FnZT8iOiAiK2cubWVzc2FnZToiIiksaW5kZXg6dGhpcy5pbmRleCxmaWxlbmFtZTp0aGlzLmN1cnJlbnRGaWxlSW5mby5maWxlbmFtZX19cmV0dXJuIG5ldyBlKHRoaXMubmFtZSxjLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8pfSxlLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtiLmFkZCh0aGlzLm5hbWUrIigiLHRoaXMuY3VycmVudEZpbGVJbmZvLHRoaXMuaW5kZXgpO2Zvcih2YXIgYz0wO3RoaXMuYXJncy5sZW5ndGg+YztjKyspdGhpcy5hcmdzW2NdLmdlbkNTUyhhLGIpLHRoaXMuYXJncy5sZW5ndGg+YysxJiZiLmFkZCgiLCAiKTtiLmFkZCgiKSIpfSxiLmV4cG9ydHM9ZX0seyIuLi9mdW5jdGlvbnMvZnVuY3Rpb24tY2FsbGVyIjoyMCwiLi9ub2RlIjo2OH1dLDQ4OltmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoYSxiKXtyZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgoYSwwKSxiKX1mdW5jdGlvbiBkKGEpe3JldHVybiIjIithLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYT1jKE1hdGgucm91bmQoYSksMjU1KSwoMTY+YT8iMCI6IiIpK2EudG9TdHJpbmcoMTYpfSkuam9pbigiIil9dmFyIGU9YSgiLi9ub2RlIiksZj1hKCIuLi9kYXRhL2NvbG9ycyIpLGc9ZnVuY3Rpb24oYSxiKXt0aGlzLnJnYj1BcnJheS5pc0FycmF5KGEpP2E6Nj09YS5sZW5ndGg/YS5tYXRjaCgvLnsyfS9nKS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIHBhcnNlSW50KGEsMTYpfSk6YS5zcGxpdCgiIikubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBwYXJzZUludChhK2EsMTYpfSksdGhpcy5hbHBoYT0ibnVtYmVyIj09dHlwZW9mIGI/YjoxfTtnLnByb3RvdHlwZT1uZXcgZSxnLnByb3RvdHlwZS50eXBlPSJDb2xvciIsZy5wcm90b3R5cGUubHVtYT1mdW5jdGlvbigpe3ZhciBhPXRoaXMucmdiWzBdLzI1NSxiPXRoaXMucmdiWzFdLzI1NSxjPXRoaXMucmdiWzJdLzI1NTtyZXR1cm4gYT0uMDM5Mjg+PWE/YS8xMi45MjpNYXRoLnBvdygoYSsuMDU1KS8xLjA1NSwyLjQpLGI9LjAzOTI4Pj1iP2IvMTIuOTI6TWF0aC5wb3coKGIrLjA1NSkvMS4wNTUsMi40KSxjPS4wMzkyOD49Yz9jLzEyLjkyOk1hdGgucG93KChjKy4wNTUpLzEuMDU1LDIuNCksLjIxMjYqYSsuNzE1MipiKy4wNzIyKmN9LGcucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe2IuYWRkKHRoaXMudG9DU1MoYSkpfSxnLnByb3RvdHlwZS50b0NTUz1mdW5jdGlvbihhLGIpe3ZhciBkLGUsZj1hJiZhLmNvbXByZXNzJiYhYjtpZih0aGlzLnZhbHVlKXJldHVybiB0aGlzLnZhbHVlO2lmKGU9dGhpcy5mcm91bmQoYSx0aGlzLmFscGhhKSwxPmUpcmV0dXJuInJnYmEoIit0aGlzLnJnYi5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGMoTWF0aC5yb3VuZChhKSwyNTUpfSkuY29uY2F0KGMoZSwxKSkuam9pbigiLCIrKGY/IiI6IiAiKSkrIikiO2lmKGQ9dGhpcy50b1JHQigpLGYpe3ZhciBnPWQuc3BsaXQoIiIpO2dbMV09PT1nWzJdJiZnWzNdPT09Z1s0XSYmZ1s1XT09PWdbNl0mJihkPSIjIitnWzFdK2dbM10rZ1s1XSl9cmV0dXJuIGR9LGcucHJvdG90eXBlLm9wZXJhdGU9ZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZD1bXSxlPXRoaXMuYWxwaGEqKDEtYy5hbHBoYSkrYy5hbHBoYSxmPTA7Mz5mO2YrKylkW2ZdPXRoaXMuX29wZXJhdGUoYSxiLHRoaXMucmdiW2ZdLGMucmdiW2ZdKTtyZXR1cm4gbmV3IGcoZCxlKX0sZy5wcm90b3R5cGUudG9SR0I9ZnVuY3Rpb24oKXtyZXR1cm4gZCh0aGlzLnJnYil9LGcucHJvdG90eXBlLnRvSFNMPWZ1bmN0aW9uKCl7dmFyIGEsYixjPXRoaXMucmdiWzBdLzI1NSxkPXRoaXMucmdiWzFdLzI1NSxlPXRoaXMucmdiWzJdLzI1NSxmPXRoaXMuYWxwaGEsZz1NYXRoLm1heChjLGQsZSksaD1NYXRoLm1pbihjLGQsZSksaT0oZytoKS8yLGo9Zy1oO2lmKGc9PT1oKWE9Yj0wO2Vsc2V7c3dpdGNoKGI9aT4uNT9qLygyLWctaCk6ai8oZytoKSxnKXtjYXNlIGM6YT0oZC1lKS9qKyhlPmQ/NjowKTticmVhaztjYXNlIGQ6YT0oZS1jKS9qKzI7YnJlYWs7Y2FzZSBlOmE9KGMtZCkvais0fWEvPTZ9cmV0dXJue2g6MzYwKmEsczpiLGw6aSxhOmZ9fSxnLnByb3RvdHlwZS50b0hTVj1mdW5jdGlvbigpe3ZhciBhLGIsYz10aGlzLnJnYlswXS8yNTUsZD10aGlzLnJnYlsxXS8yNTUsZT10aGlzLnJnYlsyXS8yNTUsZj10aGlzLmFscGhhLGc9TWF0aC5tYXgoYyxkLGUpLGg9TWF0aC5taW4oYyxkLGUpLGk9ZyxqPWctaDtpZihiPTA9PT1nPzA6ai9nLGc9PT1oKWE9MDtlbHNle3N3aXRjaChnKXtjYXNlIGM6YT0oZC1lKS9qKyhlPmQ/NjowKTticmVhaztjYXNlIGQ6YT0oZS1jKS9qKzI7YnJlYWs7Y2FzZSBlOmE9KGMtZCkvais0fWEvPTZ9cmV0dXJue2g6MzYwKmEsczpiLHY6aSxhOmZ9fSxnLnByb3RvdHlwZS50b0FSR0I9ZnVuY3Rpb24oKXtyZXR1cm4gZChbMjU1KnRoaXMuYWxwaGFdLmNvbmNhdCh0aGlzLnJnYikpfSxnLnByb3RvdHlwZS5jb21wYXJlPWZ1bmN0aW9uKGEpe3JldHVybiBhLnJnYiYmYS5yZ2JbMF09PT10aGlzLnJnYlswXSYmYS5yZ2JbMV09PT10aGlzLnJnYlsxXSYmYS5yZ2JbMl09PT10aGlzLnJnYlsyXSYmYS5hbHBoYT09PXRoaXMuYWxwaGE/MDp2b2lkIDB9LGcuZnJvbUtleXdvcmQ9ZnVuY3Rpb24oYSl7dmFyIGIsYz1hLnRvTG93ZXJDYXNlKCk7cmV0dXJuIGYuaGFzT3duUHJvcGVydHkoYyk/Yj1uZXcgZyhmW2NdLnNsaWNlKDEpKToidHJhbnNwYXJlbnQiPT09YyYmKGI9bmV3IGcoWzAsMCwwXSwwKSksYj8oYi52YWx1ZT1hLGIpOnZvaWQgMH0sYi5leHBvcnRzPWd9LHsiLi4vZGF0YS9jb2xvcnMiOjExLCIuL25vZGUiOjY4fV0sNDk6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1mdW5jdGlvbihhKXsiICI9PT1hPyh0aGlzLnZhbHVlPSIgIix0aGlzLmVtcHR5T3JXaGl0ZXNwYWNlPSEwKToodGhpcy52YWx1ZT1hP2EudHJpbSgpOiIiLHRoaXMuZW1wdHlPcldoaXRlc3BhY2U9IiI9PT10aGlzLnZhbHVlKX07ZC5wcm90b3R5cGU9bmV3IGMsZC5wcm90b3R5cGUudHlwZT0iQ29tYmluYXRvciI7dmFyIGU9eyIiOiEwLCIgIjohMCwifCI6ITB9O2QucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe3ZhciBjPWEuY29tcHJlc3N8fGVbdGhpcy52YWx1ZV0/IiI6IiAiO2IuYWRkKGMrdGhpcy52YWx1ZStjKX0sYi5leHBvcnRzPWR9LHsiLi9ub2RlIjo2OH1dLDUwOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9YSgiLi9kZWJ1Zy1pbmZvIiksZT1mdW5jdGlvbihhLGIsYyxkKXt0aGlzLnZhbHVlPWEsdGhpcy5pc0xpbmVDb21tZW50PWIsdGhpcy5jdXJyZW50RmlsZUluZm89ZH07ZS5wcm90b3R5cGU9bmV3IGMsZS5wcm90b3R5cGUudHlwZT0iQ29tbWVudCIsZS5wcm90b3R5cGUuZ2VuQ1NTPWZ1bmN0aW9uKGEsYil7dGhpcy5kZWJ1Z0luZm8mJmIuYWRkKGQoYSx0aGlzKSx0aGlzLmN1cnJlbnRGaWxlSW5mbyx0aGlzLmluZGV4KSxiLmFkZCh0aGlzLnZhbHVlKX0sZS5wcm90b3R5cGUuaXNTaWxlbnQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jdXJyZW50RmlsZUluZm8mJnRoaXMuY3VycmVudEZpbGVJbmZvLnJlZmVyZW5jZSYmIXRoaXMuaXNSZWZlcmVuY2VkLGM9YS5jb21wcmVzcyYmIiEiIT09dGhpcy52YWx1ZVsyXTtyZXR1cm4gdGhpcy5pc0xpbmVDb21tZW50fHxifHxjfSxlLnByb3RvdHlwZS5tYXJrUmVmZXJlbmNlZD1mdW5jdGlvbigpe3RoaXMuaXNSZWZlcmVuY2VkPSEwfSxiLmV4cG9ydHM9ZX0seyIuL2RlYnVnLWluZm8iOjUyLCIuL25vZGUiOjY4fV0sNTE6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1mdW5jdGlvbihhLGIsYyxkLGUpe3RoaXMub3A9YS50cmltKCksdGhpcy5sdmFsdWU9Yix0aGlzLnJ2YWx1ZT1jLHRoaXMuaW5kZXg9ZCx0aGlzLm5lZ2F0ZT1lfTtkLnByb3RvdHlwZT1uZXcgYyxkLnByb3RvdHlwZS50eXBlPSJDb25kaXRpb24iLGQucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLmx2YWx1ZT1hLnZpc2l0KHRoaXMubHZhbHVlKSx0aGlzLnJ2YWx1ZT1hLnZpc2l0KHRoaXMucnZhbHVlKX0sZC5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihhLGIsZCl7c3dpdGNoKGEpe2Nhc2UiYW5kIjpyZXR1cm4gYiYmZDtjYXNlIm9yIjpyZXR1cm4gYnx8ZDtkZWZhdWx0OnN3aXRjaChjLmNvbXBhcmUoYixkKSl7Y2FzZS0xOnJldHVybiI8Ij09PWF8fCI9PCI9PT1hfHwiPD0iPT09YTtjYXNlIDA6cmV0dXJuIj0iPT09YXx8Ij49Ij09PWF8fCI9PCI9PT1hfHwiPD0iPT09YTtjYXNlIDE6cmV0dXJuIj4iPT09YXx8Ij49Ij09PWE7ZGVmYXVsdDpyZXR1cm4hMX19fSh0aGlzLm9wLHRoaXMubHZhbHVlLmV2YWwoYSksdGhpcy5ydmFsdWUuZXZhbChhKSk7cmV0dXJuIHRoaXMubmVnYXRlPyFiOmJ9LGIuZXhwb3J0cz1kfSx7Ii4vbm9kZSI6Njh9XSw1MjpbZnVuY3Rpb24oYSxiKXt2YXIgYz1mdW5jdGlvbihhLGIsZCl7dmFyIGU9IiI7aWYoYS5kdW1wTGluZU51bWJlcnMmJiFhLmNvbXByZXNzKXN3aXRjaChhLmR1bXBMaW5lTnVtYmVycyl7Y2FzZSJjb21tZW50cyI6ZT1jLmFzQ29tbWVudChiKTticmVhaztjYXNlIm1lZGlhcXVlcnkiOmU9Yy5hc01lZGlhUXVlcnkoYik7YnJlYWs7Y2FzZSJhbGwiOmU9Yy5hc0NvbW1lbnQoYikrKGR8fCIiKStjLmFzTWVkaWFRdWVyeShiKX1yZXR1cm4gZX07Yy5hc0NvbW1lbnQ9ZnVuY3Rpb24oYSl7cmV0dXJuIi8qIGxpbmUgIithLmRlYnVnSW5mby5saW5lTnVtYmVyKyIsICIrYS5kZWJ1Z0luZm8uZmlsZU5hbWUrIiAqL1xuIn0sYy5hc01lZGlhUXVlcnk9ZnVuY3Rpb24oYSl7dmFyIGI9YS5kZWJ1Z0luZm8uZmlsZU5hbWU7cmV0dXJuL15bYS16XSs6XC9cLy9pLnRlc3QoYil8fChiPSJmaWxlOi8vIitiKSwiQG1lZGlhIC1zYXNzLWRlYnVnLWluZm97ZmlsZW5hbWV7Zm9udC1mYW1pbHk6IitiLnJlcGxhY2UoLyhbLjpcL1xcXSkvZyxmdW5jdGlvbihhKXtyZXR1cm4iXFwiPT1hJiYoYT0iLyIpLCJcXCIrYX0pKyJ9bGluZXtmb250LWZhbWlseTpcXDAwMDAzIithLmRlYnVnSW5mby5saW5lTnVtYmVyKyJ9fVxuIn0sYi5leHBvcnRzPWN9LHt9XSw1MzpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4uL2NvbnRleHRzIiksZT1mdW5jdGlvbihhLGIpe3RoaXMucnVsZXNldD1hLHRoaXMuZnJhbWVzPWJ9O2UucHJvdG90eXBlPW5ldyBjLGUucHJvdG90eXBlLnR5cGU9IkRldGFjaGVkUnVsZXNldCIsZS5wcm90b3R5cGUuZXZhbEZpcnN0PSEwLGUucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLnJ1bGVzZXQ9YS52aXNpdCh0aGlzLnJ1bGVzZXQpfSxlLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZnJhbWVzfHxhLmZyYW1lcy5zbGljZSgwKTtyZXR1cm4gbmV3IGUodGhpcy5ydWxlc2V0LGIpfSxlLnByb3RvdHlwZS5jYWxsRXZhbD1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5ydWxlc2V0LmV2YWwodGhpcy5mcmFtZXM/bmV3IGQuRXZhbChhLHRoaXMuZnJhbWVzLmNvbmNhdChhLmZyYW1lcykpOmEpfSxiLmV4cG9ydHM9ZX0seyIuLi9jb250ZXh0cyI6MTAsIi4vbm9kZSI6Njh9XSw1NDpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4uL2RhdGEvdW5pdC1jb252ZXJzaW9ucyIpLGU9YSgiLi91bml0IiksZj1hKCIuL2NvbG9yIiksZz1mdW5jdGlvbihhLGIpe3RoaXMudmFsdWU9cGFyc2VGbG9hdChhKSx0aGlzLnVuaXQ9YiYmYiBpbnN0YW5jZW9mIGU/YjpuZXcgZShiP1tiXTp2b2lkIDApfTtnLnByb3RvdHlwZT1uZXcgYyxnLnByb3RvdHlwZS50eXBlPSJEaW1lbnNpb24iLGcucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLnVuaXQ9YS52aXNpdCh0aGlzLnVuaXQpfSxnLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LGcucHJvdG90eXBlLnRvQ29sb3I9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGYoW3RoaXMudmFsdWUsdGhpcy52YWx1ZSx0aGlzLnZhbHVlXSl9LGcucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe2lmKGEmJmEuc3RyaWN0VW5pdHMmJiF0aGlzLnVuaXQuaXNTaW5ndWxhcigpKXRocm93IG5ldyBFcnJvcigiTXVsdGlwbGUgdW5pdHMgaW4gZGltZW5zaW9uLiBDb3JyZWN0IHRoZSB1bml0cyBvciB1c2UgdGhlIHVuaXQgZnVuY3Rpb24uIEJhZCB1bml0OiAiK3RoaXMudW5pdC50b1N0cmluZygpKTt2YXIgYz10aGlzLmZyb3VuZChhLHRoaXMudmFsdWUpLGQ9U3RyaW5nKGMpO2lmKDAhPT1jJiYxZS02PmMmJmM+LTFlLTYmJihkPWMudG9GaXhlZCgyMCkucmVwbGFjZSgvMCskLywiIikpLGEmJmEuY29tcHJlc3Mpe2lmKDA9PT1jJiZ0aGlzLnVuaXQuaXNMZW5ndGgoKSlyZXR1cm4gdm9pZCBiLmFkZChkKTtjPjAmJjE+YyYmKGQ9ZC5zdWJzdHIoMSkpfWIuYWRkKGQpLHRoaXMudW5pdC5nZW5DU1MoYSxiKX0sZy5wcm90b3R5cGUub3BlcmF0ZT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fb3BlcmF0ZShhLGIsdGhpcy52YWx1ZSxjLnZhbHVlKSxlPXRoaXMudW5pdC5jbG9uZSgpO2lmKCIrIj09PWJ8fCItIj09PWIpaWYoMD09PWUubnVtZXJhdG9yLmxlbmd0aCYmMD09PWUuZGVub21pbmF0b3IubGVuZ3RoKWU9Yy51bml0LmNsb25lKCksdGhpcy51bml0LmJhY2t1cFVuaXQmJihlLmJhY2t1cFVuaXQ9dGhpcy51bml0LmJhY2t1cFVuaXQpO2Vsc2UgaWYoMD09PWMudW5pdC5udW1lcmF0b3IubGVuZ3RoJiYwPT09ZS5kZW5vbWluYXRvci5sZW5ndGgpO2Vsc2V7aWYoYz1jLmNvbnZlcnRUbyh0aGlzLnVuaXQudXNlZFVuaXRzKCkpLGEuc3RyaWN0VW5pdHMmJmMudW5pdC50b1N0cmluZygpIT09ZS50b1N0cmluZygpKXRocm93IG5ldyBFcnJvcigiSW5jb21wYXRpYmxlIHVuaXRzLiBDaGFuZ2UgdGhlIHVuaXRzIG9yIHVzZSB0aGUgdW5pdCBmdW5jdGlvbi4gQmFkIHVuaXRzOiAnIitlLnRvU3RyaW5nKCkrIicgYW5kICciK2MudW5pdC50b1N0cmluZygpKyInLiIpO2Q9dGhpcy5fb3BlcmF0ZShhLGIsdGhpcy52YWx1ZSxjLnZhbHVlKX1lbHNlIioiPT09Yj8oZS5udW1lcmF0b3I9ZS5udW1lcmF0b3IuY29uY2F0KGMudW5pdC5udW1lcmF0b3IpLnNvcnQoKSxlLmRlbm9taW5hdG9yPWUuZGVub21pbmF0b3IuY29uY2F0KGMudW5pdC5kZW5vbWluYXRvcikuc29ydCgpLGUuY2FuY2VsKCkpOiIvIj09PWImJihlLm51bWVyYXRvcj1lLm51bWVyYXRvci5jb25jYXQoYy51bml0LmRlbm9taW5hdG9yKS5zb3J0KCksZS5kZW5vbWluYXRvcj1lLmRlbm9taW5hdG9yLmNvbmNhdChjLnVuaXQubnVtZXJhdG9yKS5zb3J0KCksZS5jYW5jZWwoKSk7cmV0dXJuIG5ldyBnKGQsZSl9LGcucHJvdG90eXBlLmNvbXBhcmU9ZnVuY3Rpb24oYSl7dmFyIGIsZDtpZighKGEgaW5zdGFuY2VvZiBnKSlyZXR1cm4gdm9pZCAwO2lmKHRoaXMudW5pdC5pc0VtcHR5KCl8fGEudW5pdC5pc0VtcHR5KCkpYj10aGlzLGQ9YTtlbHNlIGlmKGI9dGhpcy51bmlmeSgpLGQ9YS51bmlmeSgpLDAhPT1iLnVuaXQuY29tcGFyZShkLnVuaXQpKXJldHVybiB2b2lkIDA7cmV0dXJuIGMubnVtZXJpY0NvbXBhcmUoYi52YWx1ZSxkLnZhbHVlKX0sZy5wcm90b3R5cGUudW5pZnk9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb252ZXJ0VG8oe2xlbmd0aDoicHgiLGR1cmF0aW9uOiJzIixhbmdsZToicmFkIn0pfSxnLnByb3RvdHlwZS5jb252ZXJ0VG89ZnVuY3Rpb24oYSl7dmFyIGIsYyxlLGYsaCxpPXRoaXMudmFsdWUsaj10aGlzLnVuaXQuY2xvbmUoKSxrPXt9O2lmKCJzdHJpbmciPT10eXBlb2YgYSl7Zm9yKGIgaW4gZClkW2JdLmhhc093blByb3BlcnR5KGEpJiYoaz17fSxrW2JdPWEpO2E9a31oPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuaGFzT3duUHJvcGVydHkoYSk/KGI/aS89ZVthXS9lW2ZdOmkqPWVbYV0vZVtmXSxmKTphfTtmb3IoYyBpbiBhKWEuaGFzT3duUHJvcGVydHkoYykmJihmPWFbY10sZT1kW2NdLGoubWFwKGgpKTtyZXR1cm4gai5jYW5jZWwoKSxuZXcgZyhpLGopfSxiLmV4cG9ydHM9Z30seyIuLi9kYXRhL3VuaXQtY29udmVyc2lvbnMiOjEzLCIuL2NvbG9yIjo0OCwiLi9ub2RlIjo2OCwiLi91bml0Ijo3N31dLDU1OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9YSgiLi9zZWxlY3RvciIpLGU9YSgiLi9ydWxlc2V0IiksZj1mdW5jdGlvbihhLGIsYyxlLGYsZyxoLGkpe3ZhciBqO2lmKHRoaXMubmFtZT1hLHRoaXMudmFsdWU9YixjKWZvcihBcnJheS5pc0FycmF5KGMpP3RoaXMucnVsZXM9YzoodGhpcy5ydWxlcz1bY10sdGhpcy5ydWxlc1swXS5zZWxlY3RvcnM9bmV3IGQoW10sbnVsbCxudWxsLHRoaXMuaW5kZXgsZikuY3JlYXRlRW1wdHlTZWxlY3RvcnMoKSksaj0wO3RoaXMucnVsZXMubGVuZ3RoPmo7aisrKXRoaXMucnVsZXNbal0uYWxsb3dJbXBvcnRzPSEwO3RoaXMuaW5kZXg9ZSx0aGlzLmN1cnJlbnRGaWxlSW5mbz1mLHRoaXMuZGVidWdJbmZvPWcsdGhpcy5pc1JlZmVyZW5jZWQ9aCx0aGlzLmlzUm9vdGVkPWl8fCExfTtmLnByb3RvdHlwZT1uZXcgYyxmLnByb3RvdHlwZS50eXBlPSJEaXJlY3RpdmUiLGYucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLnZhbHVlLGM9dGhpcy5ydWxlcztjJiYodGhpcy5ydWxlcz1hLnZpc2l0QXJyYXkoYykpLGImJih0aGlzLnZhbHVlPWEudmlzaXQoYikpfSxmLnByb3RvdHlwZS5pc1J1bGVzZXRMaWtlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucnVsZXN8fCF0aGlzLmlzQ2hhcnNldCgpfSxmLnByb3RvdHlwZS5pc0NoYXJzZXQ9ZnVuY3Rpb24oKXtyZXR1cm4iQGNoYXJzZXQiPT09dGhpcy5uYW1lfSxmLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLnZhbHVlLGQ9dGhpcy5ydWxlcztiLmFkZCh0aGlzLm5hbWUsdGhpcy5jdXJyZW50RmlsZUluZm8sdGhpcy5pbmRleCksYyYmKGIuYWRkKCIgIiksYy5nZW5DU1MoYSxiKSksZD90aGlzLm91dHB1dFJ1bGVzZXQoYSxiLGQpOmIuYWRkKCI7Iil9LGYucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPXRoaXMudmFsdWUsZT10aGlzLnJ1bGVzO3JldHVybiBiPWEubWVkaWFQYXRoLGM9YS5tZWRpYUJsb2NrcyxhLm1lZGlhUGF0aD1bXSxhLm1lZGlhQmxvY2tzPVtdLGQmJihkPWQuZXZhbChhKSksZSYmKGU9W2VbMF0uZXZhbChhKV0sZVswXS5yb290PSEwKSxhLm1lZGlhUGF0aD1iLGEubWVkaWFCbG9ja3M9YyxuZXcgZih0aGlzLm5hbWUsZCxlLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8sdGhpcy5kZWJ1Z0luZm8sdGhpcy5pc1JlZmVyZW5jZWQsdGhpcy5pc1Jvb3RlZCl9LGYucHJvdG90eXBlLnZhcmlhYmxlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnJ1bGVzP2UucHJvdG90eXBlLnZhcmlhYmxlLmNhbGwodGhpcy5ydWxlc1swXSxhKTp2b2lkIDB9LGYucHJvdG90eXBlLmZpbmQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ydWxlcz9lLnByb3RvdHlwZS5maW5kLmFwcGx5KHRoaXMucnVsZXNbMF0sYXJndW1lbnRzKTp2b2lkIDB9LGYucHJvdG90eXBlLnJ1bGVzZXRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucnVsZXM/ZS5wcm90b3R5cGUucnVsZXNldHMuYXBwbHkodGhpcy5ydWxlc1swXSk6dm9pZCAwfSxmLnByb3RvdHlwZS5tYXJrUmVmZXJlbmNlZD1mdW5jdGlvbigpe3ZhciBhLGI7aWYodGhpcy5pc1JlZmVyZW5jZWQ9ITAsdGhpcy5ydWxlcylmb3IoYj10aGlzLnJ1bGVzLGE9MDtiLmxlbmd0aD5hO2ErKyliW2FdLm1hcmtSZWZlcmVuY2VkJiZiW2FdLm1hcmtSZWZlcmVuY2VkKCl9LGYucHJvdG90eXBlLmdldElzUmVmZXJlbmNlZD1mdW5jdGlvbigpe3JldHVybiF0aGlzLmN1cnJlbnRGaWxlSW5mb3x8IXRoaXMuY3VycmVudEZpbGVJbmZvLnJlZmVyZW5jZXx8dGhpcy5pc1JlZmVyZW5jZWR9LGYucHJvdG90eXBlLm91dHB1dFJ1bGVzZXQ9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU9Yy5sZW5ndGg7aWYoYS50YWJMZXZlbD0oMHxhLnRhYkxldmVsKSsxLGEuY29tcHJlc3Mpe2ZvcihiLmFkZCgieyIpLGQ9MDtlPmQ7ZCsrKWNbZF0uZ2VuQ1NTKGEsYik7cmV0dXJuIGIuYWRkKCJ9Iiksdm9pZCBhLnRhYkxldmVsLS19dmFyIGY9IlxuIitBcnJheShhLnRhYkxldmVsKS5qb2luKCIgICIpLGc9ZisiICAiO2lmKGUpe2ZvcihiLmFkZCgiIHsiK2cpLGNbMF0uZ2VuQ1NTKGEsYiksZD0xO2U+ZDtkKyspYi5hZGQoZyksY1tkXS5nZW5DU1MoYSxiKTtiLmFkZChmKyJ9Iil9ZWxzZSBiLmFkZCgiIHsiK2YrIn0iKTthLnRhYkxldmVsLS19LGIuZXhwb3J0cz1mfSx7Ii4vbm9kZSI6NjgsIi4vcnVsZXNldCI6NzQsIi4vc2VsZWN0b3IiOjc1fV0sNTY6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1hKCIuL3BhcmVuIiksZT1hKCIuL2NvbWJpbmF0b3IiKSxmPWZ1bmN0aW9uKGEsYixjLGQpe3RoaXMuY29tYmluYXRvcj1hIGluc3RhbmNlb2YgZT9hOm5ldyBlKGEpLHRoaXMudmFsdWU9InN0cmluZyI9PXR5cGVvZiBiP2IudHJpbSgpOmI/YjoiIix0aGlzLmluZGV4PWMsdGhpcy5jdXJyZW50RmlsZUluZm89ZH07Zi5wcm90b3R5cGU9bmV3IGMsZi5wcm90b3R5cGUudHlwZT0iRWxlbWVudCIsZi5wcm90b3R5cGUuYWNjZXB0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMudmFsdWU7dGhpcy5jb21iaW5hdG9yPWEudmlzaXQodGhpcy5jb21iaW5hdG9yKSwib2JqZWN0Ij09dHlwZW9mIGImJih0aGlzLnZhbHVlPWEudmlzaXQoYikpfSxmLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZih0aGlzLmNvbWJpbmF0b3IsdGhpcy52YWx1ZS5ldmFsP3RoaXMudmFsdWUuZXZhbChhKTp0aGlzLnZhbHVlLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8pfSxmLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtiLmFkZCh0aGlzLnRvQ1NTKGEpLHRoaXMuY3VycmVudEZpbGVJbmZvLHRoaXMuaW5kZXgpfSxmLnByb3RvdHlwZS50b0NTUz1mdW5jdGlvbihhKXthPWF8fHt9O3ZhciBiPXRoaXMudmFsdWUsYz1hLmZpcnN0U2VsZWN0b3I7cmV0dXJuIGIgaW5zdGFuY2VvZiBkJiYoYS5maXJzdFNlbGVjdG9yPSEwKSxiPWIudG9DU1M/Yi50b0NTUyhhKTpiLGEuZmlyc3RTZWxlY3Rvcj1jLCIiPT09YiYmIiYiPT09dGhpcy5jb21iaW5hdG9yLnZhbHVlLmNoYXJBdCgwKT8iIjp0aGlzLmNvbWJpbmF0b3IudG9DU1MoYSkrYn0sYi5leHBvcnRzPWZ9LHsiLi9jb21iaW5hdG9yIjo0OSwiLi9ub2RlIjo2OCwiLi9wYXJlbiI6NzB9XSw1NzpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4vcGFyZW4iKSxlPWEoIi4vY29tbWVudCIpLGY9ZnVuY3Rpb24oYSl7aWYodGhpcy52YWx1ZT1hLCFhKXRocm93IG5ldyBFcnJvcigiRXhwcmVzc2lvbiByZXF1aXJlcyBhbiBhcnJheSBwYXJhbWV0ZXIiKX07Zi5wcm90b3R5cGU9bmV3IGMsZi5wcm90b3R5cGUudHlwZT0iRXhwcmVzc2lvbiIsZi5wcm90b3R5cGUuYWNjZXB0PWZ1bmN0aW9uKGEpe3RoaXMudmFsdWU9YS52aXNpdEFycmF5KHRoaXMudmFsdWUpfSxmLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3ZhciBiLGM9dGhpcy5wYXJlbnMmJiF0aGlzLnBhcmVuc0luT3AsZT0hMTtyZXR1cm4gYyYmYS5pblBhcmVudGhlc2lzKCksdGhpcy52YWx1ZS5sZW5ndGg+MT9iPW5ldyBmKHRoaXMudmFsdWUubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBiLmV2YWwoYSl9KSk6MT09PXRoaXMudmFsdWUubGVuZ3RoPyh0aGlzLnZhbHVlWzBdLnBhcmVucyYmIXRoaXMudmFsdWVbMF0ucGFyZW5zSW5PcCYmKGU9ITApLGI9dGhpcy52YWx1ZVswXS5ldmFsKGEpKTpiPXRoaXMsYyYmYS5vdXRPZlBhcmVudGhlc2lzKCksdGhpcy5wYXJlbnMmJnRoaXMucGFyZW5zSW5PcCYmIWEuaXNNYXRoT24oKSYmIWUmJihiPW5ldyBkKGIpKSxifSxmLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MDt0aGlzLnZhbHVlLmxlbmd0aD5jO2MrKyl0aGlzLnZhbHVlW2NdLmdlbkNTUyhhLGIpLHRoaXMudmFsdWUubGVuZ3RoPmMrMSYmYi5hZGQoIiAiKX0sZi5wcm90b3R5cGUudGhyb3dBd2F5Q29tbWVudHM9ZnVuY3Rpb24oKXt0aGlzLnZhbHVlPXRoaXMudmFsdWUuZmlsdGVyKGZ1bmN0aW9uKGEpe3JldHVybiEoYSBpbnN0YW5jZW9mIGUpfSl9LGIuZXhwb3J0cz1mfSx7Ii4vY29tbWVudCI6NTAsIi4vbm9kZSI6NjgsIi4vcGFyZW4iOjcwfV0sNTg6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1mdW5jdGlvbiBlKGEsYixjKXtzd2l0Y2godGhpcy5zZWxlY3Rvcj1hLHRoaXMub3B0aW9uPWIsdGhpcy5pbmRleD1jLHRoaXMub2JqZWN0X2lkPWUubmV4dF9pZCsrLHRoaXMucGFyZW50X2lkcz1bdGhpcy5vYmplY3RfaWRdLGIpe2Nhc2UiYWxsIjp0aGlzLmFsbG93QmVmb3JlPSEwLHRoaXMuYWxsb3dBZnRlcj0hMDticmVhaztkZWZhdWx0OnRoaXMuYWxsb3dCZWZvcmU9ITEsdGhpcy5hbGxvd0FmdGVyPSExfX07ZC5uZXh0X2lkPTAsZC5wcm90b3R5cGU9bmV3IGMsZC5wcm90b3R5cGUudHlwZT0iRXh0ZW5kIixkLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5zZWxlY3Rvcj1hLnZpc2l0KHRoaXMuc2VsZWN0b3IpfSxkLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZCh0aGlzLnNlbGVjdG9yLmV2YWwoYSksdGhpcy5vcHRpb24sdGhpcy5pbmRleCl9LGQucHJvdG90eXBlLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBkKHRoaXMuc2VsZWN0b3IsdGhpcy5vcHRpb24sdGhpcy5pbmRleCl9LGQucHJvdG90eXBlLmZpbmRTZWxmU2VsZWN0b3JzPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZD1bXTtmb3IoYj0wO2EubGVuZ3RoPmI7YisrKWM9YVtiXS5lbGVtZW50cyxiPjAmJmMubGVuZ3RoJiYiIj09PWNbMF0uY29tYmluYXRvci52YWx1ZSYmKGNbMF0uY29tYmluYXRvci52YWx1ZT0iICIpLGQ9ZC5jb25jYXQoYVtiXS5lbGVtZW50cyk7dGhpcy5zZWxmU2VsZWN0b3JzPVt7ZWxlbWVudHM6ZH1dfSxiLmV4cG9ydHM9ZH0seyIuL25vZGUiOjY4fV0sNTk6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1hKCIuL21lZGlhIiksZT1hKCIuL3VybCIpLGY9YSgiLi9xdW90ZWQiKSxnPWEoIi4vcnVsZXNldCIpLGg9YSgiLi9hbm9ueW1vdXMiKSxpPWZ1bmN0aW9uKGEsYixjLGQsZSl7aWYodGhpcy5vcHRpb25zPWMsdGhpcy5pbmRleD1kLHRoaXMucGF0aD1hLHRoaXMuZmVhdHVyZXM9Yix0aGlzLmN1cnJlbnRGaWxlSW5mbz1lLHZvaWQgMCE9PXRoaXMub3B0aW9ucy5sZXNzfHx0aGlzLm9wdGlvbnMuaW5saW5lKXRoaXMuY3NzPSF0aGlzLm9wdGlvbnMubGVzc3x8dGhpcy5vcHRpb25zLmlubGluZTtlbHNle3ZhciBmPXRoaXMuZ2V0UGF0aCgpO2YmJi9bI1wuXCZcP1wvXWNzcyhbXD87XS4qKT8kLy50ZXN0KGYpJiYodGhpcy5jc3M9ITApfX07aS5wcm90b3R5cGU9bmV3IGMsaS5wcm90b3R5cGUudHlwZT0iSW1wb3J0IixpLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5mZWF0dXJlcyYmKHRoaXMuZmVhdHVyZXM9YS52aXNpdCh0aGlzLmZlYXR1cmVzKSksdGhpcy5wYXRoPWEudmlzaXQodGhpcy5wYXRoKSx0aGlzLm9wdGlvbnMucGx1Z2lufHx0aGlzLm9wdGlvbnMuaW5saW5lfHwhdGhpcy5yb290fHwodGhpcy5yb290PWEudmlzaXQodGhpcy5yb290KSl9LGkucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe3RoaXMuY3NzJiZ2b2lkIDA9PT10aGlzLnBhdGguY3VycmVudEZpbGVJbmZvLnJlZmVyZW5jZSYmKGIuYWRkKCJAaW1wb3J0ICIsdGhpcy5jdXJyZW50RmlsZUluZm8sdGhpcy5pbmRleCksdGhpcy5wYXRoLmdlbkNTUyhhLGIpLHRoaXMuZmVhdHVyZXMmJihiLmFkZCgiICIpLHRoaXMuZmVhdHVyZXMuZ2VuQ1NTKGEsYikpLGIuYWRkKCI7IikpfSxpLnByb3RvdHlwZS5nZXRQYXRoPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucGF0aCBpbnN0YW5jZW9mIGU/dGhpcy5wYXRoLnZhbHVlLnZhbHVlOnRoaXMucGF0aC52YWx1ZX0saS5wcm90b3R5cGUuaXNWYXJpYWJsZUltcG9ydD1mdW5jdGlvbigpe3ZhciBhPXRoaXMucGF0aDtyZXR1cm4gYSBpbnN0YW5jZW9mIGUmJihhPWEudmFsdWUpLGEgaW5zdGFuY2VvZiBmP2EuY29udGFpbnNWYXJpYWJsZXMoKTohMH0saS5wcm90b3R5cGUuZXZhbEZvckltcG9ydD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLnBhdGg7cmV0dXJuIGIgaW5zdGFuY2VvZiBlJiYoYj1iLnZhbHVlKSxuZXcgaShiLmV2YWwoYSksdGhpcy5mZWF0dXJlcyx0aGlzLm9wdGlvbnMsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyl9LGkucHJvdG90eXBlLmV2YWxQYXRoPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMucGF0aC5ldmFsKGEpLGM9dGhpcy5jdXJyZW50RmlsZUluZm8mJnRoaXMuY3VycmVudEZpbGVJbmZvLnJvb3RwYXRoO2lmKCEoYiBpbnN0YW5jZW9mIGUpKXtpZihjKXt2YXIgZD1iLnZhbHVlO2QmJmEuaXNQYXRoUmVsYXRpdmUoZCkmJihiLnZhbHVlPWMrZCl9Yi52YWx1ZT1hLm5vcm1hbGl6ZVBhdGgoYi52YWx1ZSl9cmV0dXJuIGJ9LGkucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7dmFyIGIsYyxlPXRoaXMuZmVhdHVyZXMmJnRoaXMuZmVhdHVyZXMuZXZhbChhKTtpZih0aGlzLm9wdGlvbnMucGx1Z2luKXJldHVybiBjPWEuZnJhbWVzWzBdJiZhLmZyYW1lc1swXS5mdW5jdGlvblJlZ2lzdHJ5LGMmJnRoaXMucm9vdCYmdGhpcy5yb290LmZ1bmN0aW9ucyYmYy5hZGRNdWx0aXBsZSh0aGlzLnJvb3QuZnVuY3Rpb25zKSxbXTtpZih0aGlzLnNraXAmJigiZnVuY3Rpb24iPT10eXBlb2YgdGhpcy5za2lwJiYodGhpcy5za2lwPXRoaXMuc2tpcCgpKSx0aGlzLnNraXApKXJldHVybltdO2lmKHRoaXMub3B0aW9ucy5pbmxpbmUpe3ZhciBmPW5ldyBoKHRoaXMucm9vdCwwLHtmaWxlbmFtZTp0aGlzLmltcG9ydGVkRmlsZW5hbWV9LCEwLCEwKTtyZXR1cm4gdGhpcy5mZWF0dXJlcz9uZXcgZChbZl0sdGhpcy5mZWF0dXJlcy52YWx1ZSk6W2ZdfWlmKHRoaXMuY3NzKXt2YXIgaj1uZXcgaSh0aGlzLmV2YWxQYXRoKGEpLGUsdGhpcy5vcHRpb25zLHRoaXMuaW5kZXgpO2lmKCFqLmNzcyYmdGhpcy5lcnJvcil0aHJvdyB0aGlzLmVycm9yO3JldHVybiBqfXJldHVybiBiPW5ldyBnKG51bGwsdGhpcy5yb290LnJ1bGVzLnNsaWNlKDApKSxiLmV2YWxJbXBvcnRzKGEpLHRoaXMuZmVhdHVyZXM/bmV3IGQoYi5ydWxlcyx0aGlzLmZlYXR1cmVzLnZhbHVlKTpiLnJ1bGVzfSxiLmV4cG9ydHM9aX0seyIuL2Fub255bW91cyI6NDQsIi4vbWVkaWEiOjY0LCIuL25vZGUiOjY4LCIuL3F1b3RlZCI6NzEsIi4vcnVsZXNldCI6NzQsIi4vdXJsIjo3OH1dLDYwOltmdW5jdGlvbihhLGIpe3ZhciBjPXt9O2MuTm9kZT1hKCIuL25vZGUiKSxjLkFscGhhPWEoIi4vYWxwaGEiKSxjLkNvbG9yPWEoIi4vY29sb3IiKSxjLkRpcmVjdGl2ZT1hKCIuL2RpcmVjdGl2ZSIpLGMuRGV0YWNoZWRSdWxlc2V0PWEoIi4vZGV0YWNoZWQtcnVsZXNldCIpLGMuT3BlcmF0aW9uPWEoIi4vb3BlcmF0aW9uIiksYy5EaW1lbnNpb249YSgiLi9kaW1lbnNpb24iKSxjLlVuaXQ9YSgiLi91bml0IiksYy5LZXl3b3JkPWEoIi4va2V5d29yZCIpLGMuVmFyaWFibGU9YSgiLi92YXJpYWJsZSIpLGMuUnVsZXNldD1hKCIuL3J1bGVzZXQiKSxjLkVsZW1lbnQ9YSgiLi9lbGVtZW50IiksYy5BdHRyaWJ1dGU9YSgiLi9hdHRyaWJ1dGUiKSxjLkNvbWJpbmF0b3I9YSgiLi9jb21iaW5hdG9yIiksYy5TZWxlY3Rvcj1hKCIuL3NlbGVjdG9yIiksYy5RdW90ZWQ9YSgiLi9xdW90ZWQiKSxjLkV4cHJlc3Npb249YSgiLi9leHByZXNzaW9uIiksYy5SdWxlPWEoIi4vcnVsZSIpLGMuQ2FsbD1hKCIuL2NhbGwiKSxjLlVSTD1hKCIuL3VybCIpLGMuSW1wb3J0PWEoIi4vaW1wb3J0IiksYy5taXhpbj17Q2FsbDphKCIuL21peGluLWNhbGwiKSxEZWZpbml0aW9uOmEoIi4vbWl4aW4tZGVmaW5pdGlvbiIpfSxjLkNvbW1lbnQ9YSgiLi9jb21tZW50IiksYy5Bbm9ueW1vdXM9YSgiLi9hbm9ueW1vdXMiKSxjLlZhbHVlPWEoIi4vdmFsdWUiKSxjLkphdmFTY3JpcHQ9YSgiLi9qYXZhc2NyaXB0IiksYy5Bc3NpZ25tZW50PWEoIi4vYXNzaWdubWVudCIpLGMuQ29uZGl0aW9uPWEoIi4vY29uZGl0aW9uIiksYy5QYXJlbj1hKCIuL3BhcmVuIiksYy5NZWRpYT1hKCIuL21lZGlhIiksYy5Vbmljb2RlRGVzY3JpcHRvcj1hKCIuL3VuaWNvZGUtZGVzY3JpcHRvciIpLGMuTmVnYXRpdmU9YSgiLi9uZWdhdGl2ZSIpLGMuRXh0ZW5kPWEoIi4vZXh0ZW5kIiksYy5SdWxlc2V0Q2FsbD1hKCIuL3J1bGVzZXQtY2FsbCIpLGIuZXhwb3J0cz1jfSx7Ii4vYWxwaGEiOjQzLCIuL2Fub255bW91cyI6NDQsIi4vYXNzaWdubWVudCI6NDUsIi4vYXR0cmlidXRlIjo0NiwiLi9jYWxsIjo0NywiLi9jb2xvciI6NDgsIi4vY29tYmluYXRvciI6NDksIi4vY29tbWVudCI6NTAsIi4vY29uZGl0aW9uIjo1MSwiLi9kZXRhY2hlZC1ydWxlc2V0Ijo1MywiLi9kaW1lbnNpb24iOjU0LCIuL2RpcmVjdGl2ZSI6NTUsIi4vZWxlbWVudCI6NTYsIi4vZXhwcmVzc2lvbiI6NTcsIi4vZXh0ZW5kIjo1OCwiLi9pbXBvcnQiOjU5LCIuL2phdmFzY3JpcHQiOjYxLCIuL2tleXdvcmQiOjYzLCIuL21lZGlhIjo2NCwiLi9taXhpbi1jYWxsIjo2NSwiLi9taXhpbi1kZWZpbml0aW9uIjo2NiwiLi9uZWdhdGl2ZSI6NjcsIi4vbm9kZSI6NjgsIi4vb3BlcmF0aW9uIjo2OSwiLi9wYXJlbiI6NzAsIi4vcXVvdGVkIjo3MSwiLi9ydWxlIjo3MiwiLi9ydWxlc2V0Ijo3NCwiLi9ydWxlc2V0LWNhbGwiOjczLCIuL3NlbGVjdG9yIjo3NSwiLi91bmljb2RlLWRlc2NyaXB0b3IiOjc2LCIuL3VuaXQiOjc3LCIuL3VybCI6NzgsIi4vdmFsdWUiOjc5LCIuL3ZhcmlhYmxlIjo4MH1dLDYxOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vanMtZXZhbC1ub2RlIiksZD1hKCIuL2RpbWVuc2lvbiIpLGU9YSgiLi9xdW90ZWQiKSxmPWEoIi4vYW5vbnltb3VzIiksZz1mdW5jdGlvbihhLGIsYyxkKXt0aGlzLmVzY2FwZWQ9Yix0aGlzLmV4cHJlc3Npb249YSx0aGlzLmluZGV4PWMsdGhpcy5jdXJyZW50RmlsZUluZm89ZH07Zy5wcm90b3R5cGU9bmV3IGMsZy5wcm90b3R5cGUudHlwZT0iSmF2YVNjcmlwdCIsZy5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmV2YWx1YXRlSmF2YVNjcmlwdCh0aGlzLmV4cHJlc3Npb24sYSk7cmV0dXJuIm51bWJlciI9PXR5cGVvZiBiP25ldyBkKGIpOiJzdHJpbmciPT10eXBlb2YgYj9uZXcgZSgnIicrYisnIicsYix0aGlzLmVzY2FwZWQsdGhpcy5pbmRleCk6bmV3IGYoQXJyYXkuaXNBcnJheShiKT9iLmpvaW4oIiwgIik6Yil9LGIuZXhwb3J0cz1nfSx7Ii4vYW5vbnltb3VzIjo0NCwiLi9kaW1lbnNpb24iOjU0LCIuL2pzLWV2YWwtbm9kZSI6NjIsIi4vcXVvdGVkIjo3MX1dLDYyOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9YSgiLi92YXJpYWJsZSIpLGU9ZnVuY3Rpb24oKXt9O2UucHJvdG90eXBlPW5ldyBjLGUucHJvdG90eXBlLmV2YWx1YXRlSmF2YVNjcmlwdD1mdW5jdGlvbihhLGIpe3ZhciBjLGU9dGhpcyxmPXt9O2lmKHZvaWQgMCE9PWIuamF2YXNjcmlwdEVuYWJsZWQmJiFiLmphdmFzY3JpcHRFbmFibGVkKXRocm93e21lc3NhZ2U6IllvdSBhcmUgdXNpbmcgSmF2YVNjcmlwdCwgd2hpY2ggaGFzIGJlZW4gZGlzYWJsZWQuIixmaWxlbmFtZTp0aGlzLmN1cnJlbnRGaWxlSW5mby5maWxlbmFtZSxpbmRleDp0aGlzLmluZGV4fTthPWEucmVwbGFjZSgvQFx7KFtcdy1dKylcfS9nLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIGUuanNpZnkobmV3IGQoIkAiK2MsZS5pbmRleCxlLmN1cnJlbnRGaWxlSW5mbykuZXZhbChiKSl9KTt0cnl7YT1uZXcgRnVuY3Rpb24oInJldHVybiAoIithKyIpIil9Y2F0Y2goZyl7dGhyb3d7bWVzc2FnZToiSmF2YVNjcmlwdCBldmFsdWF0aW9uIGVycm9yOiAiK2cubWVzc2FnZSsiIGZyb20gYCIrYSsiYCIsZmlsZW5hbWU6dGhpcy5jdXJyZW50RmlsZUluZm8uZmlsZW5hbWUsaW5kZXg6dGhpcy5pbmRleH19dmFyIGg9Yi5mcmFtZXNbMF0udmFyaWFibGVzKCk7Zm9yKHZhciBpIGluIGgpaC5oYXNPd25Qcm9wZXJ0eShpKSYmKGZbaS5zbGljZSgxKV09e3ZhbHVlOmhbaV0udmFsdWUsdG9KUzpmdW5jdGlvbigpe3JldHVybiB0aGlzLnZhbHVlLmV2YWwoYikudG9DU1MoKX19KTt0cnl7Yz1hLmNhbGwoZil9Y2F0Y2goZyl7dGhyb3d7bWVzc2FnZToiSmF2YVNjcmlwdCBldmFsdWF0aW9uIGVycm9yOiAnIitnLm5hbWUrIjogIitnLm1lc3NhZ2UucmVwbGFjZSgvWyJdL2csIiciKSsiJyIsZmlsZW5hbWU6dGhpcy5jdXJyZW50RmlsZUluZm8uZmlsZW5hbWUsaW5kZXg6dGhpcy5pbmRleH19cmV0dXJuIGN9LGUucHJvdG90eXBlLmpzaWZ5PWZ1bmN0aW9uKGEpe3JldHVybiBBcnJheS5pc0FycmF5KGEudmFsdWUpJiZhLnZhbHVlLmxlbmd0aD4xPyJbIithLnZhbHVlLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS50b0NTUygpfSkuam9pbigiLCAiKSsiXSI6YS50b0NTUygpfSxiLmV4cG9ydHM9ZX0seyIuL25vZGUiOjY4LCIuL3ZhcmlhYmxlIjo4MH1dLDYzOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9ZnVuY3Rpb24oYSl7dGhpcy52YWx1ZT1hfTtkLnByb3RvdHlwZT1uZXcgYyxkLnByb3RvdHlwZS50eXBlPSJLZXl3b3JkIixkLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtpZigiJSI9PT10aGlzLnZhbHVlKXRocm93e3R5cGU6IlN5bnRheCIsbWVzc2FnZToiSW52YWxpZCAlIHdpdGhvdXQgbnVtYmVyIn07Yi5hZGQodGhpcy52YWx1ZSl9LGQuVHJ1ZT1uZXcgZCgidHJ1ZSIpLGQuRmFsc2U9bmV3IGQoImZhbHNlIiksYi5leHBvcnRzPWR9LHsiLi9ub2RlIjo2OH1dLDY0OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vcnVsZXNldCIpLGQ9YSgiLi92YWx1ZSIpLGU9YSgiLi9zZWxlY3RvciIpLGY9YSgiLi9hbm9ueW1vdXMiKSxnPWEoIi4vZXhwcmVzc2lvbiIpLGg9YSgiLi9kaXJlY3RpdmUiKSxpPWZ1bmN0aW9uKGEsYixmLGcpe3RoaXMuaW5kZXg9Zix0aGlzLmN1cnJlbnRGaWxlSW5mbz1nO3ZhciBoPW5ldyBlKFtdLG51bGwsbnVsbCx0aGlzLmluZGV4LHRoaXMuY3VycmVudEZpbGVJbmZvKS5jcmVhdGVFbXB0eVNlbGVjdG9ycygpO3RoaXMuZmVhdHVyZXM9bmV3IGQoYiksdGhpcy5ydWxlcz1bbmV3IGMoaCxhKV0sdGhpcy5ydWxlc1swXS5hbGxvd0ltcG9ydHM9ITB9O2kucHJvdG90eXBlPW5ldyBoLGkucHJvdG90eXBlLnR5cGU9Ik1lZGlhIixpLnByb3RvdHlwZS5pc1J1bGVzZXRMaWtlPSEwLGkucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLmZlYXR1cmVzJiYodGhpcy5mZWF0dXJlcz1hLnZpc2l0KHRoaXMuZmVhdHVyZXMpKSx0aGlzLnJ1bGVzJiYodGhpcy5ydWxlcz1hLnZpc2l0QXJyYXkodGhpcy5ydWxlcykpfSxpLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXtiLmFkZCgiQG1lZGlhICIsdGhpcy5jdXJyZW50RmlsZUluZm8sdGhpcy5pbmRleCksdGhpcy5mZWF0dXJlcy5nZW5DU1MoYSxiKSx0aGlzLm91dHB1dFJ1bGVzZXQoYSxiLHRoaXMucnVsZXMpfSxpLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe2EubWVkaWFCbG9ja3N8fChhLm1lZGlhQmxvY2tzPVtdLGEubWVkaWFQYXRoPVtdKTt2YXIgYj1uZXcgaShudWxsLFtdLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8pO3RoaXMuZGVidWdJbmZvJiYodGhpcy5ydWxlc1swXS5kZWJ1Z0luZm89dGhpcy5kZWJ1Z0luZm8sYi5kZWJ1Z0luZm89dGhpcy5kZWJ1Z0luZm8pO3ZhciBjPSExO2Euc3RyaWN0TWF0aHx8KGM9ITAsYS5zdHJpY3RNYXRoPSEwKTt0cnl7Yi5mZWF0dXJlcz10aGlzLmZlYXR1cmVzLmV2YWwoYSl9ZmluYWxseXtjJiYoYS5zdHJpY3RNYXRoPSExKX1yZXR1cm4gYS5tZWRpYVBhdGgucHVzaChiKSxhLm1lZGlhQmxvY2tzLnB1c2goYiksdGhpcy5ydWxlc1swXS5mdW5jdGlvblJlZ2lzdHJ5PWEuZnJhbWVzWzBdLmZ1bmN0aW9uUmVnaXN0cnkuaW5oZXJpdCgpLGEuZnJhbWVzLnVuc2hpZnQodGhpcy5ydWxlc1swXSksYi5ydWxlcz1bdGhpcy5ydWxlc1swXS5ldmFsKGEpXSxhLmZyYW1lcy5zaGlmdCgpLGEubWVkaWFQYXRoLnBvcCgpLDA9PT1hLm1lZGlhUGF0aC5sZW5ndGg/Yi5ldmFsVG9wKGEpOmIuZXZhbE5lc3RlZChhKX0saS5wcm90b3R5cGUuZXZhbFRvcD1mdW5jdGlvbihhKXt2YXIgYj10aGlzO2lmKGEubWVkaWFCbG9ja3MubGVuZ3RoPjEpe3ZhciBkPW5ldyBlKFtdLG51bGwsbnVsbCx0aGlzLmluZGV4LHRoaXMuY3VycmVudEZpbGVJbmZvKS5jcmVhdGVFbXB0eVNlbGVjdG9ycygpO2I9bmV3IGMoZCxhLm1lZGlhQmxvY2tzKSxiLm11bHRpTWVkaWE9ITB9cmV0dXJuIGRlbGV0ZSBhLm1lZGlhQmxvY2tzLGRlbGV0ZSBhLm1lZGlhUGF0aCxifSxpLnByb3RvdHlwZS5ldmFsTmVzdGVkPWZ1bmN0aW9uKGEpe3ZhciBiLGUsaD1hLm1lZGlhUGF0aC5jb25jYXQoW3RoaXNdKTtmb3IoYj0wO2gubGVuZ3RoPmI7YisrKWU9aFtiXS5mZWF0dXJlcyBpbnN0YW5jZW9mIGQ/aFtiXS5mZWF0dXJlcy52YWx1ZTpoW2JdLmZlYXR1cmVzLGhbYl09QXJyYXkuaXNBcnJheShlKT9lOltlXTtyZXR1cm4gdGhpcy5mZWF0dXJlcz1uZXcgZCh0aGlzLnBlcm11dGUoaCkubWFwKGZ1bmN0aW9uKGEpe2ZvcihhPWEubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLnRvQ1NTP2E6bmV3IGYoYSl9KSxiPWEubGVuZ3RoLTE7Yj4wO2ItLSlhLnNwbGljZShiLDAsbmV3IGYoImFuZCIpKTtyZXR1cm4gbmV3IGcoYSl9KSksbmV3IGMoW10sW10pfSxpLnByb3RvdHlwZS5wZXJtdXRlPWZ1bmN0aW9uKGEpe2lmKDA9PT1hLmxlbmd0aClyZXR1cm5bXTtpZigxPT09YS5sZW5ndGgpcmV0dXJuIGFbMF07Zm9yKHZhciBiPVtdLGM9dGhpcy5wZXJtdXRlKGEuc2xpY2UoMSkpLGQ9MDtjLmxlbmd0aD5kO2QrKylmb3IodmFyIGU9MDthWzBdLmxlbmd0aD5lO2UrKyliLnB1c2goW2FbMF1bZV1dLmNvbmNhdChjW2RdKSk7cmV0dXJuIGJ9LGkucHJvdG90eXBlLmJ1YmJsZVNlbGVjdG9ycz1mdW5jdGlvbihhKXthJiYodGhpcy5ydWxlcz1bbmV3IGMoYS5zbGljZSgwKSxbdGhpcy5ydWxlc1swXV0pXSl9LGIuZXhwb3J0cz1pfSx7Ii4vYW5vbnltb3VzIjo0NCwiLi9kaXJlY3RpdmUiOjU1LCIuL2V4cHJlc3Npb24iOjU3LCIuL3J1bGVzZXQiOjc0LCIuL3NlbGVjdG9yIjo3NSwiLi92YWx1ZSI6Nzl9XSw2NTpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4vc2VsZWN0b3IiKSxlPWEoIi4vbWl4aW4tZGVmaW5pdGlvbiIpLGY9YSgiLi4vZnVuY3Rpb25zL2RlZmF1bHQiKSxnPWZ1bmN0aW9uKGEsYixjLGUsZil7dGhpcy5zZWxlY3Rvcj1uZXcgZChhKSx0aGlzLmFyZ3VtZW50cz1iJiZiLmxlbmd0aD9iOm51bGwsdGhpcy5pbmRleD1jLHRoaXMuY3VycmVudEZpbGVJbmZvPWUsdGhpcy5pbXBvcnRhbnQ9Zn07Zy5wcm90b3R5cGU9bmV3IGMsZy5wcm90b3R5cGUudHlwZT0iTWl4aW5DYWxsIixnLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5zZWxlY3RvciYmKHRoaXMuc2VsZWN0b3I9YS52aXNpdCh0aGlzLnNlbGVjdG9yKSksdGhpcy5hcmd1bWVudHMmJih0aGlzLmFyZ3VtZW50cz1hLnZpc2l0QXJyYXkodGhpcy5hcmd1bWVudHMpKX0sZy5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGIsYyl7dmFyIGQsZTtmb3Ioaz0wOzI+aztrKyspe2Zvcih3W2tdPSEwLGYudmFsdWUoayksZD0wO2MubGVuZ3RoPmQmJndba107ZCsrKWU9Y1tkXSxlLm1hdGNoQ29uZGl0aW9uJiYod1trXT13W2tdJiZlLm1hdGNoQ29uZGl0aW9uKG51bGwsYSkpO2IubWF0Y2hDb25kaXRpb24mJih3W2tdPXdba10mJmIubWF0Y2hDb25kaXRpb24oaCxhKSl9cmV0dXJuIHdbMF18fHdbMV0/d1swXSE9d1sxXT93WzFdP3o6QTp5Onh9dmFyIGMsZCxnLGgsaSxqLGssbCxtLG4sbyxwLHEscixzLHQ9W10sdT0hMSx2PVtdLHc9W10seD0tMSx5PTAsej0xLEE9Mjtmb3IoaD10aGlzLmFyZ3VtZW50cyYmdGhpcy5hcmd1bWVudHMubWFwKGZ1bmN0aW9uKGIpe3JldHVybntuYW1lOmIubmFtZSx2YWx1ZTpiLnZhbHVlLmV2YWwoYSl9fSkscz1mdW5jdGlvbihiKXtyZXR1cm4gYi5tYXRjaEFyZ3MobnVsbCxhKX0saT0wO2EuZnJhbWVzLmxlbmd0aD5pO2krKylpZigoYz1hLmZyYW1lc1tpXS5maW5kKHRoaXMuc2VsZWN0b3IsbnVsbCxzKSkubGVuZ3RoPjApe2ZvcihtPSEwLGo9MDtjLmxlbmd0aD5qO2orKyl7Zm9yKGQ9Y1tqXS5ydWxlLGc9Y1tqXS5wYXRoLGw9ITEsaz0wO2EuZnJhbWVzLmxlbmd0aD5rO2srKylpZighKGQgaW5zdGFuY2VvZiBlKSYmZD09PShhLmZyYW1lc1trXS5vcmlnaW5hbFJ1bGVzZXR8fGEuZnJhbWVzW2tdKSl7bD0hMDticmVha31sfHxkLm1hdGNoQXJncyhoLGEpJiYobz17bWl4aW46ZCxncm91cDpiKGQsZyl9LG8uZ3JvdXAhPT14JiZ2LnB1c2gobyksdT0hMCl9Zm9yKGYucmVzZXQoKSxxPVswLDAsMF0saj0wO3YubGVuZ3RoPmo7aisrKXFbdltqXS5ncm91cF0rKztpZihxW3ldPjApcD1BO2Vsc2UgaWYocD16LHFbel0rcVtBXT4xKXRocm93e3R5cGU6IlJ1bnRpbWUiLG1lc3NhZ2U6IkFtYmlndW91cyB1c2Ugb2YgYGRlZmF1bHQoKWAgZm91bmQgd2hlbiBtYXRjaGluZyBmb3IgYCIrdGhpcy5mb3JtYXQoaCkrImAiLGluZGV4OnRoaXMuaW5kZXgsZmlsZW5hbWU6dGhpcy5jdXJyZW50RmlsZUluZm8uZmlsZW5hbWV9O2ZvcihqPTA7di5sZW5ndGg+ajtqKyspaWYobz12W2pdLmdyb3VwLG89PT15fHxvPT09cCl0cnl7ZD12W2pdLm1peGluLGQgaW5zdGFuY2VvZiBlfHwocj1kLm9yaWdpbmFsUnVsZXNldHx8ZCxkPW5ldyBlKCIiLFtdLGQucnVsZXMsbnVsbCwhMSksZC5vcmlnaW5hbFJ1bGVzZXQ9ciksQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkodCxkLmV2YWxDYWxsKGEsaCx0aGlzLmltcG9ydGFudCkucnVsZXMpfWNhdGNoKEIpe3Rocm93e21lc3NhZ2U6Qi5tZXNzYWdlLGluZGV4OnRoaXMuaW5kZXgsZmlsZW5hbWU6dGhpcy5jdXJyZW50RmlsZUluZm8uZmlsZW5hbWUsc3RhY2s6Qi5zdGFja319aWYodSl7aWYoIXRoaXMuY3VycmVudEZpbGVJbmZvfHwhdGhpcy5jdXJyZW50RmlsZUluZm8ucmVmZXJlbmNlKWZvcihpPTA7dC5sZW5ndGg+aTtpKyspbj10W2ldLG4ubWFya1JlZmVyZW5jZWQmJm4ubWFya1JlZmVyZW5jZWQoKTtyZXR1cm4gdH19dGhyb3cgbT97dHlwZToiUnVudGltZSIsbWVzc2FnZToiTm8gbWF0Y2hpbmcgZGVmaW5pdGlvbiB3YXMgZm91bmQgZm9yIGAiK3RoaXMuZm9ybWF0KGgpKyJgIixpbmRleDp0aGlzLmluZGV4LGZpbGVuYW1lOnRoaXMuY3VycmVudEZpbGVJbmZvLmZpbGVuYW1lfTp7dHlwZToiTmFtZSIsbWVzc2FnZTp0aGlzLnNlbGVjdG9yLnRvQ1NTKCkudHJpbSgpKyIgaXMgdW5kZWZpbmVkIixpbmRleDp0aGlzLmluZGV4LGZpbGVuYW1lOnRoaXMuY3VycmVudEZpbGVJbmZvLmZpbGVuYW1lfX0sZy5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnNlbGVjdG9yLnRvQ1NTKCkudHJpbSgpKyIoIisoYT9hLm1hcChmdW5jdGlvbihhKXt2YXIgYj0iIjtyZXR1cm4gYS5uYW1lJiYoYis9YS5uYW1lKyI6IiksYis9YS52YWx1ZS50b0NTUz9hLnZhbHVlLnRvQ1NTKCk6Ij8/PyJ9KS5qb2luKCIsICIpOiIiKSsiKSJ9LGIuZXhwb3J0cz1nfSx7Ii4uL2Z1bmN0aW9ucy9kZWZhdWx0IjoxOSwiLi9taXhpbi1kZWZpbml0aW9uIjo2NiwiLi9ub2RlIjo2OCwiLi9zZWxlY3RvciI6NzV9XSw2NjpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL3NlbGVjdG9yIiksZD1hKCIuL2VsZW1lbnQiKSxlPWEoIi4vcnVsZXNldCIpLGY9YSgiLi9ydWxlIiksZz1hKCIuL2V4cHJlc3Npb24iKSxoPWEoIi4uL2NvbnRleHRzIiksaT1mdW5jdGlvbihhLGIsZSxmLGcsaCl7dGhpcy5uYW1lPWEsdGhpcy5zZWxlY3RvcnM9W25ldyBjKFtuZXcgZChudWxsLGEsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyldKV0sdGhpcy5wYXJhbXM9Yix0aGlzLmNvbmRpdGlvbj1mLHRoaXMudmFyaWFkaWM9Zyx0aGlzLmFyaXR5PWIubGVuZ3RoLHRoaXMucnVsZXM9ZSx0aGlzLl9sb29rdXBzPXt9LHRoaXMucmVxdWlyZWQ9Yi5yZWR1Y2UoZnVuY3Rpb24oYSxiKXtyZXR1cm4hYi5uYW1lfHxiLm5hbWUmJiFiLnZhbHVlP2ErMTphfSwwKSx0aGlzLmZyYW1lcz1ofTtpLnByb3RvdHlwZT1uZXcgZSxpLnByb3RvdHlwZS50eXBlPSJNaXhpbkRlZmluaXRpb24iLGkucHJvdG90eXBlLmV2YWxGaXJzdD0hMCxpLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5wYXJhbXMmJnRoaXMucGFyYW1zLmxlbmd0aCYmKHRoaXMucGFyYW1zPWEudmlzaXRBcnJheSh0aGlzLnBhcmFtcykpLHRoaXMucnVsZXM9YS52aXNpdEFycmF5KHRoaXMucnVsZXMpLHRoaXMuY29uZGl0aW9uJiYodGhpcy5jb25kaXRpb249YS52aXNpdCh0aGlzLmNvbmRpdGlvbikpfSxpLnByb3RvdHlwZS5ldmFsUGFyYW1zPWZ1bmN0aW9uKGEsYixjLGQpe3ZhciBpLGosayxsLG0sbixvLHAscT1uZXcgZShudWxsLG51bGwpLHI9dGhpcy5wYXJhbXMuc2xpY2UoMCkscz0wO2lmKGIuZnJhbWVzJiZiLmZyYW1lc1swXSYmYi5mcmFtZXNbMF0uZnVuY3Rpb25SZWdpc3RyeSYmKHEuZnVuY3Rpb25SZWdpc3RyeT1iLmZyYW1lc1swXS5mdW5jdGlvblJlZ2lzdHJ5LmluaGVyaXQoKSksYj1uZXcgaC5FdmFsKGIsW3FdLmNvbmNhdChiLmZyYW1lcykpLGMpZm9yKGM9Yy5zbGljZSgwKSxzPWMubGVuZ3RoLGs9MDtzPms7aysrKWlmKGo9Y1trXSxuPWomJmoubmFtZSl7Zm9yKG89ITEsbD0wO3IubGVuZ3RoPmw7bCsrKWlmKCFkW2xdJiZuPT09cltsXS5uYW1lKXtkW2xdPWoudmFsdWUuZXZhbChhKSxxLnByZXBlbmRSdWxlKG5ldyBmKG4sai52YWx1ZS5ldmFsKGEpKSksbz0hMDticmVha31pZihvKXtjLnNwbGljZShrLDEpLGstLTtjb250aW51ZX10aHJvd3t0eXBlOiJSdW50aW1lIixtZXNzYWdlOiJOYW1lZCBhcmd1bWVudCBmb3IgIit0aGlzLm5hbWUrIiAiK2Nba10ubmFtZSsiIG5vdCBmb3VuZCJ9fWZvcihwPTAsaz0wO3IubGVuZ3RoPms7aysrKWlmKCFkW2tdKXtpZihqPWMmJmNbcF0sbj1yW2tdLm5hbWUpaWYocltrXS52YXJpYWRpYyl7Zm9yKGk9W10sbD1wO3M+bDtsKyspaS5wdXNoKGNbbF0udmFsdWUuZXZhbChhKSk7cS5wcmVwZW5kUnVsZShuZXcgZihuLG5ldyBnKGkpLmV2YWwoYSkpKX1lbHNle2lmKG09aiYmai52YWx1ZSltPW0uZXZhbChhKTtlbHNle2lmKCFyW2tdLnZhbHVlKXRocm93e3R5cGU6IlJ1bnRpbWUiLG1lc3NhZ2U6Indyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yICIrdGhpcy5uYW1lKyIgKCIrcysiIGZvciAiK3RoaXMuYXJpdHkrIikifTttPXJba10udmFsdWUuZXZhbChiKSxxLnJlc2V0Q2FjaGUoKX1xLnByZXBlbmRSdWxlKG5ldyBmKG4sbSkpLGRba109bX1pZihyW2tdLnZhcmlhZGljJiZjKWZvcihsPXA7cz5sO2wrKylkW2xdPWNbbF0udmFsdWUuZXZhbChhKTtwKyt9cmV0dXJuIHF9LGkucHJvdG90eXBlLm1ha2VJbXBvcnRhbnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnJ1bGVzP3RoaXMucnVsZXMubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLm1ha2VJbXBvcnRhbnQ/YS5tYWtlSW1wb3J0YW50KCEwKTphfSk6dGhpcy5ydWxlcyxiPW5ldyBpKHRoaXMubmFtZSx0aGlzLnBhcmFtcyxhLHRoaXMuY29uZGl0aW9uLHRoaXMudmFyaWFkaWMsdGhpcy5mcmFtZXMpO3JldHVybiBifSxpLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgaSh0aGlzLm5hbWUsdGhpcy5wYXJhbXMsdGhpcy5ydWxlcyx0aGlzLmNvbmRpdGlvbix0aGlzLnZhcmlhZGljLHRoaXMuZnJhbWVzfHxhLmZyYW1lcy5zbGljZSgwKSl9LGkucHJvdG90eXBlLmV2YWxDYWxsPWZ1bmN0aW9uKGEsYixjKXt2YXIgZCxpLGo9W10saz10aGlzLmZyYW1lcz90aGlzLmZyYW1lcy5jb25jYXQoYS5mcmFtZXMpOmEuZnJhbWVzLGw9dGhpcy5ldmFsUGFyYW1zKGEsbmV3IGguRXZhbChhLGspLGIsaik7cmV0dXJuIGwucHJlcGVuZFJ1bGUobmV3IGYoIkBhcmd1bWVudHMiLG5ldyBnKGopLmV2YWwoYSkpKSxkPXRoaXMucnVsZXMuc2xpY2UoMCksaT1uZXcgZShudWxsLGQpLGkub3JpZ2luYWxSdWxlc2V0PXRoaXMsaT1pLmV2YWwobmV3IGguRXZhbChhLFt0aGlzLGxdLmNvbmNhdChrKSkpLGMmJihpPWkubWFrZUltcG9ydGFudCgpKSxpfSxpLnByb3RvdHlwZS5tYXRjaENvbmRpdGlvbj1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmNvbmRpdGlvbiYmIXRoaXMuY29uZGl0aW9uLmV2YWwobmV3IGguRXZhbChiLFt0aGlzLmV2YWxQYXJhbXMoYixuZXcgaC5FdmFsKGIsdGhpcy5mcmFtZXM/dGhpcy5mcmFtZXMuY29uY2F0KGIuZnJhbWVzKTpiLmZyYW1lcyksYSxbXSldLmNvbmNhdCh0aGlzLmZyYW1lc3x8W10pLmNvbmNhdChiLmZyYW1lcykpKT8hMTohMH0saS5wcm90b3R5cGUubWF0Y2hBcmdzPWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1hJiZhLmxlbmd0aHx8MDtpZih0aGlzLnZhcmlhZGljKXtpZih0aGlzLnJlcXVpcmVkLTE+ZClyZXR1cm4hMX1lbHNlew0KaWYodGhpcy5yZXF1aXJlZD5kKXJldHVybiExO2lmKGQ+dGhpcy5wYXJhbXMubGVuZ3RoKXJldHVybiExfWM9TWF0aC5taW4oZCx0aGlzLmFyaXR5KTtmb3IodmFyIGU9MDtjPmU7ZSsrKWlmKCF0aGlzLnBhcmFtc1tlXS5uYW1lJiYhdGhpcy5wYXJhbXNbZV0udmFyaWFkaWMmJmFbZV0udmFsdWUuZXZhbChiKS50b0NTUygpIT10aGlzLnBhcmFtc1tlXS52YWx1ZS5ldmFsKGIpLnRvQ1NTKCkpcmV0dXJuITE7cmV0dXJuITB9LGIuZXhwb3J0cz1pfSx7Ii4uL2NvbnRleHRzIjoxMCwiLi9lbGVtZW50Ijo1NiwiLi9leHByZXNzaW9uIjo1NywiLi9ydWxlIjo3MiwiLi9ydWxlc2V0Ijo3NCwiLi9zZWxlY3RvciI6NzV9XSw2NzpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4vb3BlcmF0aW9uIiksZT1hKCIuL2RpbWVuc2lvbiIpLGY9ZnVuY3Rpb24oYSl7dGhpcy52YWx1ZT1hfTtmLnByb3RvdHlwZT1uZXcgYyxmLnByb3RvdHlwZS50eXBlPSJOZWdhdGl2ZSIsZi5wcm90b3R5cGUuZ2VuQ1NTPWZ1bmN0aW9uKGEsYil7Yi5hZGQoIi0iKSx0aGlzLnZhbHVlLmdlbkNTUyhhLGIpfSxmLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3JldHVybiBhLmlzTWF0aE9uKCk/bmV3IGQoIioiLFtuZXcgZSgtMSksdGhpcy52YWx1ZV0pLmV2YWwoYSk6bmV3IGYodGhpcy52YWx1ZS5ldmFsKGEpKX0sYi5leHBvcnRzPWZ9LHsiLi9kaW1lbnNpb24iOjU0LCIuL25vZGUiOjY4LCIuL29wZXJhdGlvbiI6Njl9XSw2ODpbZnVuY3Rpb24oYSxiKXt2YXIgYz1mdW5jdGlvbigpe307Yy5wcm90b3R5cGUudG9DU1M9ZnVuY3Rpb24oYSl7dmFyIGI9W107cmV0dXJuIHRoaXMuZ2VuQ1NTKGEse2FkZDpmdW5jdGlvbihhKXtiLnB1c2goYSl9LGlzRW1wdHk6ZnVuY3Rpb24oKXtyZXR1cm4gMD09PWIubGVuZ3RofX0pLGIuam9pbigiIil9LGMucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe2IuYWRkKHRoaXMudmFsdWUpfSxjLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy52YWx1ZT1hLnZpc2l0KHRoaXMudmFsdWUpfSxjLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLl9vcGVyYXRlPWZ1bmN0aW9uKGEsYixjLGQpe3N3aXRjaChiKXtjYXNlIisiOnJldHVybiBjK2Q7Y2FzZSItIjpyZXR1cm4gYy1kO2Nhc2UiKiI6cmV0dXJuIGMqZDtjYXNlIi8iOnJldHVybiBjL2R9fSxjLnByb3RvdHlwZS5mcm91bmQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hJiZhLm51bVByZWNpc2lvbjtyZXR1cm4gbnVsbD09Yz9iOk51bWJlcigoYisyZS0xNikudG9GaXhlZChjKSl9LGMuY29tcGFyZT1mdW5jdGlvbihhLGIpe2lmKGEuY29tcGFyZSYmIlF1b3RlZCIhPT1iLnR5cGUmJiJBbm9ueW1vdXMiIT09Yi50eXBlKXJldHVybiBhLmNvbXBhcmUoYik7aWYoYi5jb21wYXJlKXJldHVybi1iLmNvbXBhcmUoYSk7aWYoYS50eXBlIT09Yi50eXBlKXJldHVybiB2b2lkIDA7aWYoYT1hLnZhbHVlLGI9Yi52YWx1ZSwhQXJyYXkuaXNBcnJheShhKSlyZXR1cm4gYT09PWI/MDp2b2lkIDA7aWYoYS5sZW5ndGghPT1iLmxlbmd0aClyZXR1cm4gdm9pZCAwO2Zvcih2YXIgZD0wO2EubGVuZ3RoPmQ7ZCsrKWlmKDAhPT1jLmNvbXBhcmUoYVtkXSxiW2RdKSlyZXR1cm4gdm9pZCAwO3JldHVybiAwfSxjLm51bWVyaWNDb21wYXJlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGI+YT8tMTphPT09Yj8wOmE+Yj8xOnZvaWQgMH0sYi5leHBvcnRzPWN9LHt9XSw2OTpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4vY29sb3IiKSxlPWEoIi4vZGltZW5zaW9uIiksZj1mdW5jdGlvbihhLGIsYyl7dGhpcy5vcD1hLnRyaW0oKSx0aGlzLm9wZXJhbmRzPWIsdGhpcy5pc1NwYWNlZD1jfTtmLnByb3RvdHlwZT1uZXcgYyxmLnByb3RvdHlwZS50eXBlPSJPcGVyYXRpb24iLGYucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLm9wZXJhbmRzPWEudmlzaXQodGhpcy5vcGVyYW5kcyl9LGYucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5vcGVyYW5kc1swXS5ldmFsKGEpLGM9dGhpcy5vcGVyYW5kc1sxXS5ldmFsKGEpO2lmKGEuaXNNYXRoT24oKSl7aWYoYiBpbnN0YW5jZW9mIGUmJmMgaW5zdGFuY2VvZiBkJiYoYj1iLnRvQ29sb3IoKSksYyBpbnN0YW5jZW9mIGUmJmIgaW5zdGFuY2VvZiBkJiYoYz1jLnRvQ29sb3IoKSksIWIub3BlcmF0ZSl0aHJvd3t0eXBlOiJPcGVyYXRpb24iLG1lc3NhZ2U6Ik9wZXJhdGlvbiBvbiBhbiBpbnZhbGlkIHR5cGUifTtyZXR1cm4gYi5vcGVyYXRlKGEsdGhpcy5vcCxjKX1yZXR1cm4gbmV3IGYodGhpcy5vcCxbYixjXSx0aGlzLmlzU3BhY2VkKX0sZi5wcm90b3R5cGUuZ2VuQ1NTPWZ1bmN0aW9uKGEsYil7dGhpcy5vcGVyYW5kc1swXS5nZW5DU1MoYSxiKSx0aGlzLmlzU3BhY2VkJiZiLmFkZCgiICIpLGIuYWRkKHRoaXMub3ApLHRoaXMuaXNTcGFjZWQmJmIuYWRkKCIgIiksdGhpcy5vcGVyYW5kc1sxXS5nZW5DU1MoYSxiKX0sYi5leHBvcnRzPWZ9LHsiLi9jb2xvciI6NDgsIi4vZGltZW5zaW9uIjo1NCwiLi9ub2RlIjo2OH1dLDcwOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9ZnVuY3Rpb24oYSl7dGhpcy52YWx1ZT1hfTtkLnByb3RvdHlwZT1uZXcgYyxkLnByb3RvdHlwZS50eXBlPSJQYXJlbiIsZC5wcm90b3R5cGUuZ2VuQ1NTPWZ1bmN0aW9uKGEsYil7Yi5hZGQoIigiKSx0aGlzLnZhbHVlLmdlbkNTUyhhLGIpLGIuYWRkKCIpIil9LGQucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBkKHRoaXMudmFsdWUuZXZhbChhKSl9LGIuZXhwb3J0cz1kfSx7Ii4vbm9kZSI6Njh9XSw3MTpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWEoIi4vanMtZXZhbC1ub2RlIiksZT1hKCIuL3ZhcmlhYmxlIiksZj1mdW5jdGlvbihhLGIsYyxkLGUpe3RoaXMuZXNjYXBlZD1udWxsPT1jPyEwOmMsdGhpcy52YWx1ZT1ifHwiIix0aGlzLnF1b3RlPWEuY2hhckF0KDApLHRoaXMuaW5kZXg9ZCx0aGlzLmN1cnJlbnRGaWxlSW5mbz1lfTtmLnByb3RvdHlwZT1uZXcgZCxmLnByb3RvdHlwZS50eXBlPSJRdW90ZWQiLGYucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe3RoaXMuZXNjYXBlZHx8Yi5hZGQodGhpcy5xdW90ZSx0aGlzLmN1cnJlbnRGaWxlSW5mbyx0aGlzLmluZGV4KSxiLmFkZCh0aGlzLnZhbHVlKSx0aGlzLmVzY2FwZWR8fGIuYWRkKHRoaXMucXVvdGUpfSxmLnByb3RvdHlwZS5jb250YWluc1ZhcmlhYmxlcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnZhbHVlLm1hdGNoKC8oYChbXmBdKylgKXxAXHsoW1x3LV0rKVx9Lyl9LGYucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhLGIsYyl7dmFyIGQ9YTtkbyBhPWQsZD1hLnJlcGxhY2UoYixjKTt3aGlsZShhIT09ZCk7cmV0dXJuIGR9dmFyIGM9dGhpcyxkPXRoaXMudmFsdWUsZz1mdW5jdGlvbihiLGQpe3JldHVybiBTdHJpbmcoYy5ldmFsdWF0ZUphdmFTY3JpcHQoZCxhKSl9LGg9ZnVuY3Rpb24oYixkKXt2YXIgZz1uZXcgZSgiQCIrZCxjLmluZGV4LGMuY3VycmVudEZpbGVJbmZvKS5ldmFsKGEsITApO3JldHVybiBnIGluc3RhbmNlb2YgZj9nLnZhbHVlOmcudG9DU1MoKX07cmV0dXJuIGQ9YihkLC9gKFteYF0rKWAvZyxnKSxkPWIoZCwvQFx7KFtcdy1dKylcfS9nLGgpLG5ldyBmKHRoaXMucXVvdGUrZCt0aGlzLnF1b3RlLGQsdGhpcy5lc2NhcGVkLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8pfSxmLnByb3RvdHlwZS5jb21wYXJlPWZ1bmN0aW9uKGEpe3JldHVybiJRdW90ZWQiIT09YS50eXBlfHx0aGlzLmVzY2FwZWR8fGEuZXNjYXBlZD9hLnRvQ1NTJiZ0aGlzLnRvQ1NTKCk9PT1hLnRvQ1NTKCk/MDp2b2lkIDA6Yy5udW1lcmljQ29tcGFyZSh0aGlzLnZhbHVlLGEudmFsdWUpfSxiLmV4cG9ydHM9Zn0seyIuL2pzLWV2YWwtbm9kZSI6NjIsIi4vbm9kZSI6NjgsIi4vdmFyaWFibGUiOjgwfV0sNzI6W2Z1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhhLGIpe3ZhciBjLGQ9IiIsZT1iLmxlbmd0aCxmPXthZGQ6ZnVuY3Rpb24oYSl7ZCs9YX19O2ZvcihjPTA7ZT5jO2MrKyliW2NdLmV2YWwoYSkuZ2VuQ1NTKGEsZik7cmV0dXJuIGR9dmFyIGQ9YSgiLi9ub2RlIiksZT1hKCIuL3ZhbHVlIiksZj1hKCIuL2tleXdvcmQiKSxnPWZ1bmN0aW9uKGEsYixjLGYsZyxoLGksail7dGhpcy5uYW1lPWEsdGhpcy52YWx1ZT1iIGluc3RhbmNlb2YgZD9iOm5ldyBlKFtiXSksdGhpcy5pbXBvcnRhbnQ9Yz8iICIrYy50cmltKCk6IiIsdGhpcy5tZXJnZT1mLHRoaXMuaW5kZXg9Zyx0aGlzLmN1cnJlbnRGaWxlSW5mbz1oLHRoaXMuaW5saW5lPWl8fCExLHRoaXMudmFyaWFibGU9dm9pZCAwIT09aj9qOmEuY2hhckF0JiYiQCI9PT1hLmNoYXJBdCgwKX07Zy5wcm90b3R5cGU9bmV3IGQsZy5wcm90b3R5cGUudHlwZT0iUnVsZSIsZy5wcm90b3R5cGUuZ2VuQ1NTPWZ1bmN0aW9uKGEsYil7Yi5hZGQodGhpcy5uYW1lKyhhLmNvbXByZXNzPyI6IjoiOiAiKSx0aGlzLmN1cnJlbnRGaWxlSW5mbyx0aGlzLmluZGV4KTt0cnl7dGhpcy52YWx1ZS5nZW5DU1MoYSxiKX1jYXRjaChjKXt0aHJvdyBjLmluZGV4PXRoaXMuaW5kZXgsYy5maWxlbmFtZT10aGlzLmN1cnJlbnRGaWxlSW5mby5maWxlbmFtZSxjfWIuYWRkKHRoaXMuaW1wb3J0YW50Kyh0aGlzLmlubGluZXx8YS5sYXN0UnVsZSYmYS5jb21wcmVzcz8iIjoiOyIpLHRoaXMuY3VycmVudEZpbGVJbmZvLHRoaXMuaW5kZXgpfSxnLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3ZhciBiLGQ9ITEsZT10aGlzLm5hbWUsaD10aGlzLnZhcmlhYmxlOyJzdHJpbmciIT10eXBlb2YgZSYmKGU9MT09PWUubGVuZ3RoJiZlWzBdaW5zdGFuY2VvZiBmP2VbMF0udmFsdWU6YyhhLGUpLGg9ITEpLCJmb250IiE9PWV8fGEuc3RyaWN0TWF0aHx8KGQ9ITAsYS5zdHJpY3RNYXRoPSEwKTt0cnl7aWYoYS5pbXBvcnRhbnRTY29wZS5wdXNoKHt9KSxiPXRoaXMudmFsdWUuZXZhbChhKSwhdGhpcy52YXJpYWJsZSYmIkRldGFjaGVkUnVsZXNldCI9PT1iLnR5cGUpdGhyb3d7bWVzc2FnZToiUnVsZXNldHMgY2Fubm90IGJlIGV2YWx1YXRlZCBvbiBhIHByb3BlcnR5LiIsaW5kZXg6dGhpcy5pbmRleCxmaWxlbmFtZTp0aGlzLmN1cnJlbnRGaWxlSW5mby5maWxlbmFtZX07dmFyIGk9dGhpcy5pbXBvcnRhbnQsaj1hLmltcG9ydGFudFNjb3BlLnBvcCgpO3JldHVybiFpJiZqLmltcG9ydGFudCYmKGk9ai5pbXBvcnRhbnQpLG5ldyBnKGUsYixpLHRoaXMubWVyZ2UsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyx0aGlzLmlubGluZSxoKX1jYXRjaChrKXt0aHJvdyJudW1iZXIiIT10eXBlb2Ygay5pbmRleCYmKGsuaW5kZXg9dGhpcy5pbmRleCxrLmZpbGVuYW1lPXRoaXMuY3VycmVudEZpbGVJbmZvLmZpbGVuYW1lKSxrfWZpbmFsbHl7ZCYmKGEuc3RyaWN0TWF0aD0hMSl9fSxnLnByb3RvdHlwZS5tYWtlSW1wb3J0YW50PWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBnKHRoaXMubmFtZSx0aGlzLnZhbHVlLCIhaW1wb3J0YW50Iix0aGlzLm1lcmdlLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8sdGhpcy5pbmxpbmUpfSxiLmV4cG9ydHM9Z30seyIuL2tleXdvcmQiOjYzLCIuL25vZGUiOjY4LCIuL3ZhbHVlIjo3OX1dLDczOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9YSgiLi92YXJpYWJsZSIpLGU9ZnVuY3Rpb24oYSl7dGhpcy52YXJpYWJsZT1hfTtlLnByb3RvdHlwZT1uZXcgYyxlLnByb3RvdHlwZS50eXBlPSJSdWxlc2V0Q2FsbCIsZS5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXt2YXIgYj1uZXcgZCh0aGlzLnZhcmlhYmxlKS5ldmFsKGEpO3JldHVybiBiLmNhbGxFdmFsKGEpfSxiLmV4cG9ydHM9ZX0seyIuL25vZGUiOjY4LCIuL3ZhcmlhYmxlIjo4MH1dLDc0OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9YSgiLi9ydWxlIiksZT1hKCIuL3NlbGVjdG9yIiksZj1hKCIuL2VsZW1lbnQiKSxnPWEoIi4vcGFyZW4iKSxoPWEoIi4uL2NvbnRleHRzIiksaT1hKCIuLi9mdW5jdGlvbnMvZnVuY3Rpb24tcmVnaXN0cnkiKSxqPWEoIi4uL2Z1bmN0aW9ucy9kZWZhdWx0Iiksaz1hKCIuL2RlYnVnLWluZm8iKSxsPWZ1bmN0aW9uKGEsYixjKXt0aGlzLnNlbGVjdG9ycz1hLHRoaXMucnVsZXM9Yix0aGlzLl9sb29rdXBzPXt9LHRoaXMuc3RyaWN0SW1wb3J0cz1jfTtsLnByb3RvdHlwZT1uZXcgYyxsLnByb3RvdHlwZS50eXBlPSJSdWxlc2V0IixsLnByb3RvdHlwZS5pc1J1bGVzZXQ9ITAsbC5wcm90b3R5cGUuaXNSdWxlc2V0TGlrZT0hMCxsLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5wYXRocz9hLnZpc2l0QXJyYXkodGhpcy5wYXRocywhMCk6dGhpcy5zZWxlY3RvcnMmJih0aGlzLnNlbGVjdG9ycz1hLnZpc2l0QXJyYXkodGhpcy5zZWxlY3RvcnMpKSx0aGlzLnJ1bGVzJiZ0aGlzLnJ1bGVzLmxlbmd0aCYmKHRoaXMucnVsZXM9YS52aXNpdEFycmF5KHRoaXMucnVsZXMpKX0sbC5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXt2YXIgYixjLGUsZixnPXRoaXMuc2VsZWN0b3JzLGg9ITE7aWYoZyYmKGM9Zy5sZW5ndGgpKXtmb3IoYj1bXSxqLmVycm9yKHt0eXBlOiJTeW50YXgiLG1lc3NhZ2U6Iml0IGlzIGN1cnJlbnRseSBvbmx5IGFsbG93ZWQgaW4gcGFyYW1ldHJpYyBtaXhpbiBndWFyZHMsIn0pLGY9MDtjPmY7ZisrKWU9Z1tmXS5ldmFsKGEpLGIucHVzaChlKSxlLmV2YWxkQ29uZGl0aW9uJiYoaD0hMCk7ai5yZXNldCgpfWVsc2UgaD0hMDt2YXIgayxtLG49dGhpcy5ydWxlcz90aGlzLnJ1bGVzLnNsaWNlKDApOm51bGwsbz1uZXcgbChiLG4sdGhpcy5zdHJpY3RJbXBvcnRzKTtvLm9yaWdpbmFsUnVsZXNldD10aGlzLG8ucm9vdD10aGlzLnJvb3Qsby5maXJzdFJvb3Q9dGhpcy5maXJzdFJvb3Qsby5hbGxvd0ltcG9ydHM9dGhpcy5hbGxvd0ltcG9ydHMsdGhpcy5kZWJ1Z0luZm8mJihvLmRlYnVnSW5mbz10aGlzLmRlYnVnSW5mbyksaHx8KG4ubGVuZ3RoPTApLG8uZnVuY3Rpb25SZWdpc3RyeT1mdW5jdGlvbihhKXtmb3IodmFyIGIsYz0wLGQ9YS5sZW5ndGg7YyE9PWQ7KytjKWlmKGI9YVtjXS5mdW5jdGlvblJlZ2lzdHJ5KXJldHVybiBiO3JldHVybiBpfShhLmZyYW1lcykuaW5oZXJpdCgpO3ZhciBwPWEuZnJhbWVzO3AudW5zaGlmdChvKTt2YXIgcT1hLnNlbGVjdG9ycztxfHwoYS5zZWxlY3RvcnM9cT1bXSkscS51bnNoaWZ0KHRoaXMuc2VsZWN0b3JzKSwoby5yb290fHxvLmFsbG93SW1wb3J0c3x8IW8uc3RyaWN0SW1wb3J0cykmJm8uZXZhbEltcG9ydHMoYSk7dmFyIHI9by5ydWxlcyxzPXI/ci5sZW5ndGg6MDtmb3IoZj0wO3M+ZjtmKyspcltmXS5ldmFsRmlyc3QmJihyW2ZdPXJbZl0uZXZhbChhKSk7dmFyIHQ9YS5tZWRpYUJsb2NrcyYmYS5tZWRpYUJsb2Nrcy5sZW5ndGh8fDA7Zm9yKGY9MDtzPmY7ZisrKSJNaXhpbkNhbGwiPT09cltmXS50eXBlPyhuPXJbZl0uZXZhbChhKS5maWx0ZXIoZnVuY3Rpb24oYSl7cmV0dXJuIGEgaW5zdGFuY2VvZiBkJiZhLnZhcmlhYmxlPyFvLnZhcmlhYmxlKGEubmFtZSk6ITB9KSxyLnNwbGljZS5hcHBseShyLFtmLDFdLmNvbmNhdChuKSkscys9bi5sZW5ndGgtMSxmKz1uLmxlbmd0aC0xLG8ucmVzZXRDYWNoZSgpKToiUnVsZXNldENhbGwiPT09cltmXS50eXBlJiYobj1yW2ZdLmV2YWwoYSkucnVsZXMuZmlsdGVyKGZ1bmN0aW9uKGEpe3JldHVybiBhIGluc3RhbmNlb2YgZCYmYS52YXJpYWJsZT8hMTohMH0pLHIuc3BsaWNlLmFwcGx5KHIsW2YsMV0uY29uY2F0KG4pKSxzKz1uLmxlbmd0aC0xLGYrPW4ubGVuZ3RoLTEsby5yZXNldENhY2hlKCkpO2ZvcihmPTA7ci5sZW5ndGg+ZjtmKyspaz1yW2ZdLGsuZXZhbEZpcnN0fHwocltmXT1rPWsuZXZhbD9rLmV2YWwoYSk6ayk7Zm9yKGY9MDtyLmxlbmd0aD5mO2YrKylpZihrPXJbZl0sayBpbnN0YW5jZW9mIGwmJmsuc2VsZWN0b3JzJiYxPT09ay5zZWxlY3RvcnMubGVuZ3RoJiZrLnNlbGVjdG9yc1swXS5pc0p1c3RQYXJlbnRTZWxlY3RvcigpKXtyLnNwbGljZShmLS0sMSk7Zm9yKHZhciB1PTA7ay5ydWxlcy5sZW5ndGg+dTt1KyspbT1rLnJ1bGVzW3VdLG0gaW5zdGFuY2VvZiBkJiZtLnZhcmlhYmxlfHxyLnNwbGljZSgrK2YsMCxtKX1pZihwLnNoaWZ0KCkscS5zaGlmdCgpLGEubWVkaWFCbG9ja3MpZm9yKGY9dDthLm1lZGlhQmxvY2tzLmxlbmd0aD5mO2YrKylhLm1lZGlhQmxvY2tzW2ZdLmJ1YmJsZVNlbGVjdG9ycyhiKTtyZXR1cm4gb30sbC5wcm90b3R5cGUuZXZhbEltcG9ydHM9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPXRoaXMucnVsZXM7aWYoZClmb3IoYj0wO2QubGVuZ3RoPmI7YisrKSJJbXBvcnQiPT09ZFtiXS50eXBlJiYoYz1kW2JdLmV2YWwoYSksYyYmYy5sZW5ndGg/KGQuc3BsaWNlLmFwcGx5KGQsW2IsMV0uY29uY2F0KGMpKSxiKz1jLmxlbmd0aC0xKTpkLnNwbGljZShiLDEsYyksdGhpcy5yZXNldENhY2hlKCkpfSxsLnByb3RvdHlwZS5tYWtlSW1wb3J0YW50PWZ1bmN0aW9uKCl7dmFyIGE9bmV3IGwodGhpcy5zZWxlY3RvcnMsdGhpcy5ydWxlcy5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEubWFrZUltcG9ydGFudD9hLm1ha2VJbXBvcnRhbnQoKTphfSksdGhpcy5zdHJpY3RJbXBvcnRzKTtyZXR1cm4gYX0sbC5wcm90b3R5cGUubWF0Y2hBcmdzPWZ1bmN0aW9uKGEpe3JldHVybiFhfHwwPT09YS5sZW5ndGh9LGwucHJvdG90eXBlLm1hdGNoQ29uZGl0aW9uPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5zZWxlY3RvcnNbdGhpcy5zZWxlY3RvcnMubGVuZ3RoLTFdO3JldHVybiBjLmV2YWxkQ29uZGl0aW9uP2MuY29uZGl0aW9uJiYhYy5jb25kaXRpb24uZXZhbChuZXcgaC5FdmFsKGIsYi5mcmFtZXMpKT8hMTohMDohMX0sbC5wcm90b3R5cGUucmVzZXRDYWNoZT1mdW5jdGlvbigpe3RoaXMuX3J1bGVzZXRzPW51bGwsdGhpcy5fdmFyaWFibGVzPW51bGwsdGhpcy5fbG9va3Vwcz17fX0sbC5wcm90b3R5cGUudmFyaWFibGVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3ZhcmlhYmxlc3x8KHRoaXMuX3ZhcmlhYmxlcz10aGlzLnJ1bGVzP3RoaXMucnVsZXMucmVkdWNlKGZ1bmN0aW9uKGEsYil7aWYoYiBpbnN0YW5jZW9mIGQmJmIudmFyaWFibGU9PT0hMCYmKGFbYi5uYW1lXT1iKSwiSW1wb3J0Ij09PWIudHlwZSYmYi5yb290JiZiLnJvb3QudmFyaWFibGVzKXt2YXIgYz1iLnJvb3QudmFyaWFibGVzKCk7Zm9yKHZhciBlIGluIGMpYy5oYXNPd25Qcm9wZXJ0eShlKSYmKGFbZV09Y1tlXSl9cmV0dXJuIGF9LHt9KTp7fSksdGhpcy5fdmFyaWFibGVzfSxsLnByb3RvdHlwZS52YXJpYWJsZT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy52YXJpYWJsZXMoKVthXX0sbC5wcm90b3R5cGUucnVsZXNldHM9ZnVuY3Rpb24oKXtpZighdGhpcy5ydWxlcylyZXR1cm5bXTt2YXIgYSxiLGM9W10sZD10aGlzLnJ1bGVzLGU9ZC5sZW5ndGg7Zm9yKGE9MDtlPmE7YSsrKWI9ZFthXSxiLmlzUnVsZXNldCYmYy5wdXNoKGIpO3JldHVybiBjfSxsLnByb3RvdHlwZS5wcmVwZW5kUnVsZT1mdW5jdGlvbihhKXt2YXIgYj10aGlzLnJ1bGVzO2I/Yi51bnNoaWZ0KGEpOnRoaXMucnVsZXM9W2FdfSxsLnByb3RvdHlwZS5maW5kPWZ1bmN0aW9uKGEsYixjKXtiPWJ8fHRoaXM7dmFyIGQsZixnPVtdLGg9YS50b0NTUygpO3JldHVybiBoIGluIHRoaXMuX2xvb2t1cHM/dGhpcy5fbG9va3Vwc1toXToodGhpcy5ydWxlc2V0cygpLmZvckVhY2goZnVuY3Rpb24oaCl7aWYoaCE9PWIpZm9yKHZhciBpPTA7aC5zZWxlY3RvcnMubGVuZ3RoPmk7aSsrKWlmKGQ9YS5tYXRjaChoLnNlbGVjdG9yc1tpXSkpe2lmKGEuZWxlbWVudHMubGVuZ3RoPmQpe2lmKCFjfHxjKGgpKXtmPWguZmluZChuZXcgZShhLmVsZW1lbnRzLnNsaWNlKGQpKSxiLGMpO2Zvcih2YXIgaj0wO2YubGVuZ3RoPmo7KytqKWZbal0ucGF0aC5wdXNoKGgpO0FycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGcsZil9fWVsc2UgZy5wdXNoKHtydWxlOmgscGF0aDpbXX0pO2JyZWFrfX0pLHRoaXMuX2xvb2t1cHNbaF09ZyxnKX0sbC5wcm90b3R5cGUuZ2VuQ1NTPWZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhhKXtyZXR1cm4iYm9vbGVhbiI9PXR5cGVvZiBhLmlzUnVsZXNldExpa2U/YS5pc1J1bGVzZXRMaWtlOiJmdW5jdGlvbiI9PXR5cGVvZiBhLmlzUnVsZXNldExpa2U/YS5pc1J1bGVzZXRMaWtlKCk6ITF9dmFyIGQsZSxmLGcsaCxpPVtdLGo9W107YS50YWJMZXZlbD1hLnRhYkxldmVsfHwwLHRoaXMucm9vdHx8YS50YWJMZXZlbCsrO3ZhciBsLG09YS5jb21wcmVzcz8iIjpBcnJheShhLnRhYkxldmVsKzEpLmpvaW4oIiAgIiksbj1hLmNvbXByZXNzPyIiOkFycmF5KGEudGFiTGV2ZWwpLmpvaW4oIiAgIiksbz0wLHA9MDtmb3IoZD0wO3RoaXMucnVsZXMubGVuZ3RoPmQ7ZCsrKWc9dGhpcy5ydWxlc1tkXSwiQ29tbWVudCI9PT1nLnR5cGU/KHA9PT1kJiZwKyssai5wdXNoKGcpKTpnLmlzQ2hhcnNldCYmZy5pc0NoYXJzZXQoKT8oai5zcGxpY2UobywwLGcpLG8rKyxwKyspOiJJbXBvcnQiPT09Zy50eXBlPyhqLnNwbGljZShwLDAsZykscCsrKTpqLnB1c2goZyk7aWYoaj1pLmNvbmNhdChqKSwhdGhpcy5yb290KXtmPWsoYSx0aGlzLG4pLGYmJihiLmFkZChmKSxiLmFkZChuKSk7dmFyIHEscj10aGlzLnBhdGhzLHM9ci5sZW5ndGg7Zm9yKGw9YS5jb21wcmVzcz8iLCI6IixcbiIrbixkPTA7cz5kO2QrKylpZihoPXJbZF0scT1oLmxlbmd0aClmb3IoZD4wJiZiLmFkZChsKSxhLmZpcnN0U2VsZWN0b3I9ITAsaFswXS5nZW5DU1MoYSxiKSxhLmZpcnN0U2VsZWN0b3I9ITEsZT0xO3E+ZTtlKyspaFtlXS5nZW5DU1MoYSxiKTtiLmFkZCgoYS5jb21wcmVzcz8ieyI6IiB7XG4iKSttKX1mb3IoZD0wO2oubGVuZ3RoPmQ7ZCsrKXtnPWpbZF0sZCsxPT09ai5sZW5ndGgmJihhLmxhc3RSdWxlPSEwKTt2YXIgdD1hLmxhc3RSdWxlO2MoZykmJihhLmxhc3RSdWxlPSExKSxnLmdlbkNTUz9nLmdlbkNTUyhhLGIpOmcudmFsdWUmJmIuYWRkKGcudmFsdWUudG9TdHJpbmcoKSksYS5sYXN0UnVsZT10LGEubGFzdFJ1bGU/YS5sYXN0UnVsZT0hMTpiLmFkZChhLmNvbXByZXNzPyIiOiJcbiIrbSl9dGhpcy5yb290fHwoYi5hZGQoYS5jb21wcmVzcz8ifSI6IlxuIituKyJ9IiksYS50YWJMZXZlbC0tKSxiLmlzRW1wdHkoKXx8YS5jb21wcmVzc3x8IXRoaXMuZmlyc3RSb290fHxiLmFkZCgiXG4iKX0sbC5wcm90b3R5cGUubWFya1JlZmVyZW5jZWQ9ZnVuY3Rpb24oKXt2YXIgYTtpZih0aGlzLnNlbGVjdG9ycylmb3IoYT0wO3RoaXMuc2VsZWN0b3JzLmxlbmd0aD5hO2ErKyl0aGlzLnNlbGVjdG9yc1thXS5tYXJrUmVmZXJlbmNlZCgpO2lmKHRoaXMucnVsZXMpZm9yKGE9MDt0aGlzLnJ1bGVzLmxlbmd0aD5hO2ErKyl0aGlzLnJ1bGVzW2FdLm1hcmtSZWZlcmVuY2VkJiZ0aGlzLnJ1bGVzW2FdLm1hcmtSZWZlcmVuY2VkKCl9LGwucHJvdG90eXBlLmdldElzUmVmZXJlbmNlZD1mdW5jdGlvbigpe3ZhciBhLGIsYyxkO2lmKHRoaXMucGF0aHMpZm9yKGE9MDt0aGlzLnBhdGhzLmxlbmd0aD5hO2ErKylmb3IoYz10aGlzLnBhdGhzW2FdLGI9MDtjLmxlbmd0aD5iO2IrKylpZihjW2JdLmdldElzUmVmZXJlbmNlZCYmY1tiXS5nZXRJc1JlZmVyZW5jZWQoKSlyZXR1cm4hMDtpZih0aGlzLnNlbGVjdG9ycylmb3IoYT0wO3RoaXMuc2VsZWN0b3JzLmxlbmd0aD5hO2ErKylpZihkPXRoaXMuc2VsZWN0b3JzW2FdLGQuZ2V0SXNSZWZlcmVuY2VkJiZkLmdldElzUmVmZXJlbmNlZCgpKXJldHVybiEwO3JldHVybiExfSxsLnByb3RvdHlwZS5qb2luU2VsZWN0b3JzPWZ1bmN0aW9uKGEsYixjKXtmb3IodmFyIGQ9MDtjLmxlbmd0aD5kO2QrKyl0aGlzLmpvaW5TZWxlY3RvcihhLGIsY1tkXSl9LGwucHJvdG90eXBlLmpvaW5TZWxlY3Rvcj1mdW5jdGlvbihhLGIsYyl7ZnVuY3Rpb24gZChhLGIpe3ZhciBjLGQ7aWYoMD09PWEubGVuZ3RoKWM9bmV3IGcoYVswXSk7ZWxzZXt2YXIgaD1bXTtmb3IoZD0wO2EubGVuZ3RoPmQ7ZCsrKWgucHVzaChuZXcgZihudWxsLGFbZF0sYi5pbmRleCxiLmN1cnJlbnRGaWxlSW5mbykpO2M9bmV3IGcobmV3IGUoaCkpfXJldHVybiBjfWZ1bmN0aW9uIGgoYSxiKXt2YXIgYyxkO3JldHVybiBjPW5ldyBmKG51bGwsYSxiLmluZGV4LGIuY3VycmVudEZpbGVJbmZvKSxkPW5ldyBlKFtjXSl9ZnVuY3Rpb24gaShhLGIsYyl7ZnVuY3Rpb24gZShhKXt2YXIgYjtyZXR1cm4iUGFyZW4iIT09YS52YWx1ZS50eXBlP251bGw6KGI9YS52YWx1ZS52YWx1ZSwiU2VsZWN0b3IiIT09Yi50eXBlP251bGw6Yil9dmFyIGcsbSxuLG8scCxxLHIscyx0LHUsdj0hMTtmb3Iobz1bXSxwPVtbXV0sZz0wO2MuZWxlbWVudHMubGVuZ3RoPmc7ZysrKWlmKHM9Yy5lbGVtZW50c1tnXSwiJiIhPT1zLnZhbHVlKXt2YXIgdz1lKHMpO2lmKG51bGwhPXcpe2wobyxwKTt2YXIgeCx5PVtdLHo9W107Zm9yKHg9aSh5LGIsdyksdj12fHx4LG49MDt5Lmxlbmd0aD5uO24rKyl7dmFyIEE9aChkKHlbbl0scykscyk7ayhwLFtBXSxzLGMseil9cD16LG89W119ZWxzZSBvLnB1c2gocyl9ZWxzZXtmb3Iodj0hMCxxPVtdLGwobyxwKSxtPTA7cC5sZW5ndGg+bTttKyspaWYocj1wW21dLDA9PT1iLmxlbmd0aClyLmxlbmd0aD4wJiZyWzBdLmVsZW1lbnRzLnB1c2gobmV3IGYocy5jb21iaW5hdG9yLCIiLHMuaW5kZXgscy5jdXJyZW50RmlsZUluZm8pKSxxLnB1c2gocik7ZWxzZSBmb3Iobj0wO2IubGVuZ3RoPm47bisrKXt2YXIgQj1qKHIsYltuXSxzLGMpO3EucHVzaChCKX1wPXEsbz1bXX1mb3IobChvLHApLGc9MDtwLmxlbmd0aD5nO2crKyl0PXBbZ10ubGVuZ3RoLHQ+MCYmKGEucHVzaChwW2ddKSx1PXBbZ11bdC0xXSxwW2ddW3QtMV09dS5jcmVhdGVEZXJpdmVkKHUuZWxlbWVudHMsYy5leHRlbmRMaXN0KSk7cmV0dXJuIHZ9ZnVuY3Rpb24gaihhLGIsYyxkKXt2YXIgZSxnLGg7aWYoZT1bXSxhLmxlbmd0aD4wPyhlPWEuc2xpY2UoMCksZz1lLnBvcCgpLGg9ZC5jcmVhdGVEZXJpdmVkKGcuZWxlbWVudHMuc2xpY2UoMCkpKTpoPWQuY3JlYXRlRGVyaXZlZChbXSksYi5sZW5ndGg+MCl7dmFyIGk9Yy5jb21iaW5hdG9yLGo9YlswXS5lbGVtZW50c1swXTtpLmVtcHR5T3JXaGl0ZXNwYWNlJiYhai5jb21iaW5hdG9yLmVtcHR5T3JXaGl0ZXNwYWNlJiYoaT1qLmNvbWJpbmF0b3IpLGguZWxlbWVudHMucHVzaChuZXcgZihpLGoudmFsdWUsYy5pbmRleCxjLmN1cnJlbnRGaWxlSW5mbykpLGguZWxlbWVudHM9aC5lbGVtZW50cy5jb25jYXQoYlswXS5lbGVtZW50cy5zbGljZSgxKSl9cmV0dXJuIDAhPT1oLmVsZW1lbnRzLmxlbmd0aCYmZS5wdXNoKGgpLGIubGVuZ3RoPjEmJihlPWUuY29uY2F0KGIuc2xpY2UoMSkpKSxlfWZ1bmN0aW9uIGsoYSxiLGMsZCxlKXt2YXIgZjtmb3IoZj0wO2EubGVuZ3RoPmY7ZisrKXt2YXIgZz1qKGFbZl0sYixjLGQpO2UucHVzaChnKX1yZXR1cm4gZX1mdW5jdGlvbiBsKGEsYil7dmFyIGMsZDtpZigwIT09YS5sZW5ndGgpe2lmKDA9PT1iLmxlbmd0aClyZXR1cm4gdm9pZCBiLnB1c2goW25ldyBlKGEpXSk7Zm9yKGM9MDtiLmxlbmd0aD5jO2MrKylkPWJbY10sZC5sZW5ndGg+MD9kW2QubGVuZ3RoLTFdPWRbZC5sZW5ndGgtMV0uY3JlYXRlRGVyaXZlZChkW2QubGVuZ3RoLTFdLmVsZW1lbnRzLmNvbmNhdChhKSk6ZC5wdXNoKG5ldyBlKGEpKX19dmFyIG0sbixvO2lmKG49W10sbz1pKG4sYixjKSwhbylpZihiLmxlbmd0aD4wKWZvcihuPVtdLG09MDtiLmxlbmd0aD5tO20rKyluLnB1c2goYlttXS5jb25jYXQoYykpO2Vsc2Ugbj1bW2NdXTtmb3IobT0wO24ubGVuZ3RoPm07bSsrKWEucHVzaChuW21dKX0sYi5leHBvcnRzPWx9LHsiLi4vY29udGV4dHMiOjEwLCIuLi9mdW5jdGlvbnMvZGVmYXVsdCI6MTksIi4uL2Z1bmN0aW9ucy9mdW5jdGlvbi1yZWdpc3RyeSI6MjEsIi4vZGVidWctaW5mbyI6NTIsIi4vZWxlbWVudCI6NTYsIi4vbm9kZSI6NjgsIi4vcGFyZW4iOjcwLCIuL3J1bGUiOjcyLCIuL3NlbGVjdG9yIjo3NX1dLDc1OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9YSgiLi9lbGVtZW50IiksZT1mdW5jdGlvbihhLGIsYyxkLGUsZil7dGhpcy5lbGVtZW50cz1hLHRoaXMuZXh0ZW5kTGlzdD1iLHRoaXMuY29uZGl0aW9uPWMsdGhpcy5jdXJyZW50RmlsZUluZm89ZXx8e30sdGhpcy5pc1JlZmVyZW5jZWQ9ZixjfHwodGhpcy5ldmFsZENvbmRpdGlvbj0hMCl9O2UucHJvdG90eXBlPW5ldyBjLGUucHJvdG90eXBlLnR5cGU9IlNlbGVjdG9yIixlLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy5lbGVtZW50cyYmKHRoaXMuZWxlbWVudHM9YS52aXNpdEFycmF5KHRoaXMuZWxlbWVudHMpKSx0aGlzLmV4dGVuZExpc3QmJih0aGlzLmV4dGVuZExpc3Q9YS52aXNpdEFycmF5KHRoaXMuZXh0ZW5kTGlzdCkpLHRoaXMuY29uZGl0aW9uJiYodGhpcy5jb25kaXRpb249YS52aXNpdCh0aGlzLmNvbmRpdGlvbikpfSxlLnByb3RvdHlwZS5jcmVhdGVEZXJpdmVkPWZ1bmN0aW9uKGEsYixjKXtjPW51bGwhPWM/Yzp0aGlzLmV2YWxkQ29uZGl0aW9uO3ZhciBkPW5ldyBlKGEsYnx8dGhpcy5leHRlbmRMaXN0LG51bGwsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyx0aGlzLmlzUmVmZXJlbmNlZCk7cmV0dXJuIGQuZXZhbGRDb25kaXRpb249YyxkLm1lZGlhRW1wdHk9dGhpcy5tZWRpYUVtcHR5LGR9LGUucHJvdG90eXBlLmNyZWF0ZUVtcHR5U2VsZWN0b3JzPWZ1bmN0aW9uKCl7dmFyIGE9bmV3IGQoIiIsIiYiLHRoaXMuaW5kZXgsdGhpcy5jdXJyZW50RmlsZUluZm8pLGI9W25ldyBlKFthXSxudWxsLG51bGwsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbyldO3JldHVybiBiWzBdLm1lZGlhRW1wdHk9ITAsYn0sZS5wcm90b3R5cGUubWF0Y2g9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPXRoaXMuZWxlbWVudHMsZT1kLmxlbmd0aDtpZihhLkNhY2hlRWxlbWVudHMoKSxiPWEuX2VsZW1lbnRzLmxlbmd0aCwwPT09Ynx8Yj5lKXJldHVybiAwO2ZvcihjPTA7Yj5jO2MrKylpZihkW2NdLnZhbHVlIT09YS5fZWxlbWVudHNbY10pcmV0dXJuIDA7cmV0dXJuIGJ9LGUucHJvdG90eXBlLkNhY2hlRWxlbWVudHM9ZnVuY3Rpb24oKXtpZighdGhpcy5fZWxlbWVudHMpe3ZhciBhPXRoaXMuZWxlbWVudHMubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLmNvbWJpbmF0b3IudmFsdWUrKGEudmFsdWUudmFsdWV8fGEudmFsdWUpfSkuam9pbigiIikubWF0Y2goL1ssJiNcKlwuXHctXShbXHctXXwoXFwuKSkqL2cpO2E/IiYiPT09YVswXSYmYS5zaGlmdCgpOmE9W10sdGhpcy5fZWxlbWVudHM9YX19LGUucHJvdG90eXBlLmlzSnVzdFBhcmVudFNlbGVjdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMubWVkaWFFbXB0eSYmMT09PXRoaXMuZWxlbWVudHMubGVuZ3RoJiYiJiI9PT10aGlzLmVsZW1lbnRzWzBdLnZhbHVlJiYoIiAiPT09dGhpcy5lbGVtZW50c1swXS5jb21iaW5hdG9yLnZhbHVlfHwiIj09PXRoaXMuZWxlbWVudHNbMF0uY29tYmluYXRvci52YWx1ZSl9LGUucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jb25kaXRpb24mJnRoaXMuY29uZGl0aW9uLmV2YWwoYSksYz10aGlzLmVsZW1lbnRzLGQ9dGhpcy5leHRlbmRMaXN0O3JldHVybiBjPWMmJmMubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBiLmV2YWwoYSl9KSxkPWQmJmQubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBiLmV2YWwoYSl9KSx0aGlzLmNyZWF0ZURlcml2ZWQoYyxkLGIpfSxlLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkO2lmKGEmJmEuZmlyc3RTZWxlY3Rvcnx8IiIhPT10aGlzLmVsZW1lbnRzWzBdLmNvbWJpbmF0b3IudmFsdWV8fGIuYWRkKCIgIix0aGlzLmN1cnJlbnRGaWxlSW5mbyx0aGlzLmluZGV4KSwhdGhpcy5fY3NzKWZvcihjPTA7dGhpcy5lbGVtZW50cy5sZW5ndGg+YztjKyspZD10aGlzLmVsZW1lbnRzW2NdLGQuZ2VuQ1NTKGEsYil9LGUucHJvdG90eXBlLm1hcmtSZWZlcmVuY2VkPWZ1bmN0aW9uKCl7dGhpcy5pc1JlZmVyZW5jZWQ9ITB9LGUucHJvdG90eXBlLmdldElzUmVmZXJlbmNlZD1mdW5jdGlvbigpe3JldHVybiF0aGlzLmN1cnJlbnRGaWxlSW5mby5yZWZlcmVuY2V8fHRoaXMuaXNSZWZlcmVuY2VkfSxlLnByb3RvdHlwZS5nZXRJc091dHB1dD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmV2YWxkQ29uZGl0aW9ufSxiLmV4cG9ydHM9ZX0seyIuL2VsZW1lbnQiOjU2LCIuL25vZGUiOjY4fV0sNzY6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1mdW5jdGlvbihhKXt0aGlzLnZhbHVlPWF9O2QucHJvdG90eXBlPW5ldyBjLGQucHJvdG90eXBlLnR5cGU9IlVuaWNvZGVEZXNjcmlwdG9yIixiLmV4cG9ydHM9ZH0seyIuL25vZGUiOjY4fV0sNzc6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi9ub2RlIiksZD1hKCIuLi9kYXRhL3VuaXQtY29udmVyc2lvbnMiKSxlPWZ1bmN0aW9uKGEsYixjKXt0aGlzLm51bWVyYXRvcj1hP2Euc2xpY2UoMCkuc29ydCgpOltdLHRoaXMuZGVub21pbmF0b3I9Yj9iLnNsaWNlKDApLnNvcnQoKTpbXSxjP3RoaXMuYmFja3VwVW5pdD1jOmEmJmEubGVuZ3RoJiYodGhpcy5iYWNrdXBVbml0PWFbMF0pfTtlLnByb3RvdHlwZT1uZXcgYyxlLnByb3RvdHlwZS50eXBlPSJVbml0IixlLnByb3RvdHlwZS5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgZSh0aGlzLm51bWVyYXRvci5zbGljZSgwKSx0aGlzLmRlbm9taW5hdG9yLnNsaWNlKDApLHRoaXMuYmFja3VwVW5pdCl9LGUucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe3ZhciBjPWEmJmEuc3RyaWN0VW5pdHM7MT09PXRoaXMubnVtZXJhdG9yLmxlbmd0aD9iLmFkZCh0aGlzLm51bWVyYXRvclswXSk6IWMmJnRoaXMuYmFja3VwVW5pdD9iLmFkZCh0aGlzLmJhY2t1cFVuaXQpOiFjJiZ0aGlzLmRlbm9taW5hdG9yLmxlbmd0aCYmYi5hZGQodGhpcy5kZW5vbWluYXRvclswXSl9LGUucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7dmFyIGEsYj10aGlzLm51bWVyYXRvci5qb2luKCIqIik7Zm9yKGE9MDt0aGlzLmRlbm9taW5hdG9yLmxlbmd0aD5hO2ErKyliKz0iLyIrdGhpcy5kZW5vbWluYXRvclthXTtyZXR1cm4gYn0sZS5wcm90b3R5cGUuY29tcGFyZT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pcyhhLnRvU3RyaW5nKCkpPzA6dm9pZCAwfSxlLnByb3RvdHlwZS5pcz1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy50b1N0cmluZygpLnRvVXBwZXJDYXNlKCk9PT1hLnRvVXBwZXJDYXNlKCl9LGUucHJvdG90eXBlLmlzTGVuZ3RoPWZ1bmN0aW9uKCl7cmV0dXJuIEJvb2xlYW4odGhpcy50b0NTUygpLm1hdGNoKC9weHxlbXwlfGlufGNtfG1tfHBjfHB0fGV4LykpfSxlLnByb3RvdHlwZS5pc0VtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuIDA9PT10aGlzLm51bWVyYXRvci5sZW5ndGgmJjA9PT10aGlzLmRlbm9taW5hdG9yLmxlbmd0aH0sZS5wcm90b3R5cGUuaXNTaW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiAxPj10aGlzLm51bWVyYXRvci5sZW5ndGgmJjA9PT10aGlzLmRlbm9taW5hdG9yLmxlbmd0aH0sZS5wcm90b3R5cGUubWFwPWZ1bmN0aW9uKGEpe3ZhciBiO2ZvcihiPTA7dGhpcy5udW1lcmF0b3IubGVuZ3RoPmI7YisrKXRoaXMubnVtZXJhdG9yW2JdPWEodGhpcy5udW1lcmF0b3JbYl0sITEpO2ZvcihiPTA7dGhpcy5kZW5vbWluYXRvci5sZW5ndGg+YjtiKyspdGhpcy5kZW5vbWluYXRvcltiXT1hKHRoaXMuZGVub21pbmF0b3JbYl0sITApfSxlLnByb3RvdHlwZS51c2VkVW5pdHM9ZnVuY3Rpb24oKXt2YXIgYSxiLGM9e307Yj1mdW5jdGlvbihiKXtyZXR1cm4gYS5oYXNPd25Qcm9wZXJ0eShiKSYmIWNbZV0mJihjW2VdPWIpLGJ9O2Zvcih2YXIgZSBpbiBkKWQuaGFzT3duUHJvcGVydHkoZSkmJihhPWRbZV0sdGhpcy5tYXAoYikpO3JldHVybiBjfSxlLnByb3RvdHlwZS5jYW5jZWw9ZnVuY3Rpb24oKXt2YXIgYSxiLGM9e307Zm9yKGI9MDt0aGlzLm51bWVyYXRvci5sZW5ndGg+YjtiKyspYT10aGlzLm51bWVyYXRvcltiXSxjW2FdPShjW2FdfHwwKSsxO2ZvcihiPTA7dGhpcy5kZW5vbWluYXRvci5sZW5ndGg+YjtiKyspYT10aGlzLmRlbm9taW5hdG9yW2JdLGNbYV09KGNbYV18fDApLTE7dGhpcy5udW1lcmF0b3I9W10sdGhpcy5kZW5vbWluYXRvcj1bXTtmb3IoYSBpbiBjKWlmKGMuaGFzT3duUHJvcGVydHkoYSkpe3ZhciBkPWNbYV07aWYoZD4wKWZvcihiPTA7ZD5iO2IrKyl0aGlzLm51bWVyYXRvci5wdXNoKGEpO2Vsc2UgaWYoMD5kKWZvcihiPTA7LWQ+YjtiKyspdGhpcy5kZW5vbWluYXRvci5wdXNoKGEpfXRoaXMubnVtZXJhdG9yLnNvcnQoKSx0aGlzLmRlbm9taW5hdG9yLnNvcnQoKX0sYi5leHBvcnRzPWV9LHsiLi4vZGF0YS91bml0LWNvbnZlcnNpb25zIjoxMywiLi9ub2RlIjo2OH1dLDc4OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9ZnVuY3Rpb24oYSxiLGMsZCl7dGhpcy52YWx1ZT1hLHRoaXMuY3VycmVudEZpbGVJbmZvPWMsdGhpcy5pbmRleD1iLHRoaXMuaXNFdmFsZD1kfTtkLnByb3RvdHlwZT1uZXcgYyxkLnByb3RvdHlwZS50eXBlPSJVcmwiLGQucHJvdG90eXBlLmFjY2VwdD1mdW5jdGlvbihhKXt0aGlzLnZhbHVlPWEudmlzaXQodGhpcy52YWx1ZSl9LGQucHJvdG90eXBlLmdlbkNTUz1mdW5jdGlvbihhLGIpe2IuYWRkKCJ1cmwoIiksdGhpcy52YWx1ZS5nZW5DU1MoYSxiKSxiLmFkZCgiKSIpfSxkLnByb3RvdHlwZS5ldmFsPWZ1bmN0aW9uKGEpe3ZhciBiLGM9dGhpcy52YWx1ZS5ldmFsKGEpO2lmKCF0aGlzLmlzRXZhbGQmJihiPXRoaXMuY3VycmVudEZpbGVJbmZvJiZ0aGlzLmN1cnJlbnRGaWxlSW5mby5yb290cGF0aCxiJiYic3RyaW5nIj09dHlwZW9mIGMudmFsdWUmJmEuaXNQYXRoUmVsYXRpdmUoYy52YWx1ZSkmJihjLnF1b3RlfHwoYj1iLnJlcGxhY2UoL1tcKFwpJyJcc10vZyxmdW5jdGlvbihhKXtyZXR1cm4iXFwiK2F9KSksYy52YWx1ZT1iK2MudmFsdWUpLGMudmFsdWU9YS5ub3JtYWxpemVQYXRoKGMudmFsdWUpLGEudXJsQXJncyYmIWMudmFsdWUubWF0Y2goL15ccypkYXRhOi8pKSl7dmFyIGU9LTE9PT1jLnZhbHVlLmluZGV4T2YoIj8iKT8iPyI6IiYiLGY9ZSthLnVybEFyZ3M7LTEhPT1jLnZhbHVlLmluZGV4T2YoIiMiKT9jLnZhbHVlPWMudmFsdWUucmVwbGFjZSgiIyIsZisiIyIpOmMudmFsdWUrPWZ9cmV0dXJuIG5ldyBkKGMsdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbywhMCl9LGIuZXhwb3J0cz1kfSx7Ii4vbm9kZSI6Njh9XSw3OTpbZnVuY3Rpb24oYSxiKXt2YXIgYz1hKCIuL25vZGUiKSxkPWZ1bmN0aW9uKGEpe2lmKHRoaXMudmFsdWU9YSwhYSl0aHJvdyBuZXcgRXJyb3IoIlZhbHVlIHJlcXVpcmVzIGFuIGFycmF5IGFyZ3VtZW50Iil9O2QucHJvdG90eXBlPW5ldyBjLGQucHJvdG90eXBlLnR5cGU9IlZhbHVlIixkLnByb3RvdHlwZS5hY2NlcHQ9ZnVuY3Rpb24oYSl7dGhpcy52YWx1ZSYmKHRoaXMudmFsdWU9YS52aXNpdEFycmF5KHRoaXMudmFsdWUpKX0sZC5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihhKXtyZXR1cm4gMT09PXRoaXMudmFsdWUubGVuZ3RoP3RoaXMudmFsdWVbMF0uZXZhbChhKTpuZXcgZCh0aGlzLnZhbHVlLm1hcChmdW5jdGlvbihiKXtyZXR1cm4gYi5ldmFsKGEpfSkpfSxkLnByb3RvdHlwZS5nZW5DU1M9ZnVuY3Rpb24oYSxiKXt2YXIgYztmb3IoYz0wO3RoaXMudmFsdWUubGVuZ3RoPmM7YysrKXRoaXMudmFsdWVbY10uZ2VuQ1NTKGEsYiksdGhpcy52YWx1ZS5sZW5ndGg+YysxJiZiLmFkZChhJiZhLmNvbXByZXNzPyIsIjoiLCAiKX0sYi5leHBvcnRzPWR9LHsiLi9ub2RlIjo2OH1dLDgwOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4vbm9kZSIpLGQ9ZnVuY3Rpb24oYSxiLGMpe3RoaXMubmFtZT1hLHRoaXMuaW5kZXg9Yix0aGlzLmN1cnJlbnRGaWxlSW5mbz1jfHx7fX07ZC5wcm90b3R5cGU9bmV3IGMsZC5wcm90b3R5cGUudHlwZT0iVmFyaWFibGUiLGQucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oYSl7dmFyIGIsYz10aGlzLm5hbWU7aWYoMD09PWMuaW5kZXhPZigiQEAiKSYmKGM9IkAiK25ldyBkKGMuc2xpY2UoMSksdGhpcy5pbmRleCx0aGlzLmN1cnJlbnRGaWxlSW5mbykuZXZhbChhKS52YWx1ZSksdGhpcy5ldmFsdWF0aW5nKXRocm93e3R5cGU6Ik5hbWUiLG1lc3NhZ2U6IlJlY3Vyc2l2ZSB2YXJpYWJsZSBkZWZpbml0aW9uIGZvciAiK2MsZmlsZW5hbWU6dGhpcy5jdXJyZW50RmlsZUluZm8uZmlsZW5hbWUsaW5kZXg6dGhpcy5pbmRleH07aWYodGhpcy5ldmFsdWF0aW5nPSEwLGI9dGhpcy5maW5kKGEuZnJhbWVzLGZ1bmN0aW9uKGIpe3ZhciBkPWIudmFyaWFibGUoYyk7aWYoZCl7aWYoZC5pbXBvcnRhbnQpe3ZhciBlPWEuaW1wb3J0YW50U2NvcGVbYS5pbXBvcnRhbnRTY29wZS5sZW5ndGgtMV07ZS5pbXBvcnRhbnQ9ZC5pbXBvcnRhbnR9cmV0dXJuIGQudmFsdWUuZXZhbChhKX19KSlyZXR1cm4gdGhpcy5ldmFsdWF0aW5nPSExLGI7dGhyb3d7dHlwZToiTmFtZSIsbWVzc2FnZToidmFyaWFibGUgIitjKyIgaXMgdW5kZWZpbmVkIixmaWxlbmFtZTp0aGlzLmN1cnJlbnRGaWxlSW5mby5maWxlbmFtZSxpbmRleDp0aGlzLmluZGV4fX0sZC5wcm90b3R5cGUuZmluZD1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYyxkPTA7YS5sZW5ndGg+ZDtkKyspaWYoYz1iLmNhbGwoYSxhW2RdKSlyZXR1cm4gYztyZXR1cm4gbnVsbH0sYi5leHBvcnRzPWR9LHsiLi9ub2RlIjo2OH1dLDgxOltmdW5jdGlvbihhLGIpe2IuZXhwb3J0cz17Z2V0TG9jYXRpb246ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9YSsxLGQ9bnVsbCxlPS0xOy0tYz49MCYmIlxuIiE9PWIuY2hhckF0KGMpOyllKys7cmV0dXJuIm51bWJlciI9PXR5cGVvZiBhJiYoZD0oYi5zbGljZSgwLGEpLm1hdGNoKC9cbi9nKXx8IiIpLmxlbmd0aCkse2xpbmU6ZCxjb2x1bW46ZX19fX0se31dLDgyOltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4uL3RyZWUiKSxkPWEoIi4vdmlzaXRvciIpLGU9YSgiLi4vbG9nZ2VyIiksZj1mdW5jdGlvbigpe3RoaXMuX3Zpc2l0b3I9bmV3IGQodGhpcyksdGhpcy5jb250ZXh0cz1bXSx0aGlzLmFsbEV4dGVuZHNTdGFjaz1bW11dfTtmLnByb3RvdHlwZT17cnVuOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuX3Zpc2l0b3IudmlzaXQoYSksYS5hbGxFeHRlbmRzPXRoaXMuYWxsRXh0ZW5kc1N0YWNrWzBdLGF9LHZpc2l0UnVsZTpmdW5jdGlvbihhLGIpe2IudmlzaXREZWVwZXI9ITF9LHZpc2l0TWl4aW5EZWZpbml0aW9uOmZ1bmN0aW9uKGEsYil7Yi52aXNpdERlZXBlcj0hMX0sdmlzaXRSdWxlc2V0OmZ1bmN0aW9uKGEpe2lmKCFhLnJvb3Qpe3ZhciBiLGQsZSxmLGc9W10saD1hLnJ1bGVzLGk9aD9oLmxlbmd0aDowO2ZvcihiPTA7aT5iO2IrKylhLnJ1bGVzW2JdaW5zdGFuY2VvZiBjLkV4dGVuZCYmKGcucHVzaChoW2JdKSxhLmV4dGVuZE9uRXZlcnlQYXRoPSEwKTt2YXIgaj1hLnBhdGhzO2ZvcihiPTA7ai5sZW5ndGg+YjtiKyspe3ZhciBrPWpbYl0sbD1rW2subGVuZ3RoLTFdLG09bC5leHRlbmRMaXN0O2ZvcihmPW0/bS5zbGljZSgwKS5jb25jYXQoZyk6ZyxmJiYoZj1mLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS5jbG9uZSgpfSkpLGQ9MDtmLmxlbmd0aD5kO2QrKyl0aGlzLmZvdW5kRXh0ZW5kcz0hMCxlPWZbZF0sZS5maW5kU2VsZlNlbGVjdG9ycyhrKSxlLnJ1bGVzZXQ9YSwwPT09ZCYmKGUuZmlyc3RFeHRlbmRPblRoaXNTZWxlY3RvclBhdGg9ITApLHRoaXMuYWxsRXh0ZW5kc1N0YWNrW3RoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aC0xXS5wdXNoKGUpfXRoaXMuY29udGV4dHMucHVzaChhLnNlbGVjdG9ycyl9fSx2aXNpdFJ1bGVzZXRPdXQ6ZnVuY3Rpb24oYSl7YS5yb290fHwodGhpcy5jb250ZXh0cy5sZW5ndGg9dGhpcy5jb250ZXh0cy5sZW5ndGgtMSl9LHZpc2l0TWVkaWE6ZnVuY3Rpb24oYSl7YS5hbGxFeHRlbmRzPVtdLHRoaXMuYWxsRXh0ZW5kc1N0YWNrLnB1c2goYS5hbGxFeHRlbmRzKX0sdmlzaXRNZWRpYU91dDpmdW5jdGlvbigpe3RoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aD10aGlzLmFsbEV4dGVuZHNTdGFjay5sZW5ndGgtMX0sdmlzaXREaXJlY3RpdmU6ZnVuY3Rpb24oYSl7YS5hbGxFeHRlbmRzPVtdLHRoaXMuYWxsRXh0ZW5kc1N0YWNrLnB1c2goYS5hbGxFeHRlbmRzKX0sdmlzaXREaXJlY3RpdmVPdXQ6ZnVuY3Rpb24oKXt0aGlzLmFsbEV4dGVuZHNTdGFjay5sZW5ndGg9dGhpcy5hbGxFeHRlbmRzU3RhY2subGVuZ3RoLTF9fTt2YXIgZz1mdW5jdGlvbigpe3RoaXMuX3Zpc2l0b3I9bmV3IGQodGhpcyl9O2cucHJvdG90eXBlPXtydW46ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IGY7aWYodGhpcy5leHRlbmRJbmRpY2llcz17fSxiLnJ1bihhKSwhYi5mb3VuZEV4dGVuZHMpcmV0dXJuIGE7YS5hbGxFeHRlbmRzPWEuYWxsRXh0ZW5kcy5jb25jYXQodGhpcy5kb0V4dGVuZENoYWluaW5nKGEuYWxsRXh0ZW5kcyxhLmFsbEV4dGVuZHMpKSx0aGlzLmFsbEV4dGVuZHNTdGFjaz1bYS5hbGxFeHRlbmRzXTt2YXIgYz10aGlzLl92aXNpdG9yLnZpc2l0KGEpO3JldHVybiB0aGlzLmNoZWNrRXh0ZW5kc0Zvck5vbk1hdGNoZWQoYS5hbGxFeHRlbmRzKSxjfSxjaGVja0V4dGVuZHNGb3JOb25NYXRjaGVkOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZXh0ZW5kSW5kaWNpZXM7YS5maWx0ZXIoZnVuY3Rpb24oYSl7cmV0dXJuIWEuaGFzRm91bmRNYXRjaGVzJiYxPT1hLnBhcmVudF9pZHMubGVuZ3RofSkuZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYz0iX3Vua25vd25fIjt0cnl7Yz1hLnNlbGVjdG9yLnRvQ1NTKHt9KX1jYXRjaChkKXt9YlthLmluZGV4KyIgIitjXXx8KGJbYS5pbmRleCsiICIrY109ITAsZS53YXJuKCJleHRlbmQgJyIrYysiJyBoYXMgbm8gbWF0Y2hlcyIpKX0pfSxkb0V4dGVuZENoYWluaW5nOmZ1bmN0aW9uKGEsYixkKXt2YXIgZSxmLGcsaCxpLGosayxsLG09W10sbj10aGlzO2ZvcihkPWR8fDAsZT0wO2EubGVuZ3RoPmU7ZSsrKWZvcihmPTA7Yi5sZW5ndGg+ZjtmKyspaj1hW2VdLGs9YltmXSxqLnBhcmVudF9pZHMuaW5kZXhPZihrLm9iamVjdF9pZCk+PTB8fChpPVtrLnNlbGZTZWxlY3RvcnNbMF1dLGc9bi5maW5kTWF0Y2goaixpKSxnLmxlbmd0aCYmKGouaGFzRm91bmRNYXRjaGVzPSEwLGouc2VsZlNlbGVjdG9ycy5mb3JFYWNoKGZ1bmN0aW9uKGEpe2g9bi5leHRlbmRTZWxlY3RvcihnLGksYSksbD1uZXcgYy5FeHRlbmQoay5zZWxlY3RvcixrLm9wdGlvbiwwKSxsLnNlbGZTZWxlY3RvcnM9aCxoW2gubGVuZ3RoLTFdLmV4dGVuZExpc3Q9W2xdLG0ucHVzaChsKSxsLnJ1bGVzZXQ9ay5ydWxlc2V0LGwucGFyZW50X2lkcz1sLnBhcmVudF9pZHMuY29uY2F0KGsucGFyZW50X2lkcyxqLnBhcmVudF9pZHMpLGsuZmlyc3RFeHRlbmRPblRoaXNTZWxlY3RvclBhdGgmJihsLmZpcnN0RXh0ZW5kT25UaGlzU2VsZWN0b3JQYXRoPSEwLGsucnVsZXNldC5wYXRocy5wdXNoKGgpKX0pKSk7aWYobS5sZW5ndGgpe2lmKHRoaXMuZXh0ZW5kQ2hhaW5Db3VudCsrLGQ+MTAwKXt2YXIgbz0ie3VuYWJsZSB0byBjYWxjdWxhdGV9IixwPSJ7dW5hYmxlIHRvIGNhbGN1bGF0ZX0iO3RyeXtvPW1bMF0uc2VsZlNlbGVjdG9yc1swXS50b0NTUygpLHA9bVswXS5zZWxlY3Rvci50b0NTUygpfWNhdGNoKHEpe310aHJvd3ttZXNzYWdlOiJleHRlbmQgY2lyY3VsYXIgcmVmZXJlbmNlIGRldGVjdGVkLiBPbmUgb2YgdGhlIGNpcmN1bGFyIGV4dGVuZHMgaXMgY3VycmVudGx5OiIrbysiOmV4dGVuZCgiK3ArIikifX1yZXR1cm4gbS5jb25jYXQobi5kb0V4dGVuZENoYWluaW5nKG0sYixkKzEpKX1yZXR1cm4gbX0sdmlzaXRSdWxlOmZ1bmN0aW9uKGEsYil7Yi52aXNpdERlZXBlcj0hMX0sdmlzaXRNaXhpbkRlZmluaXRpb246ZnVuY3Rpb24oYSxiKXtiLnZpc2l0RGVlcGVyPSExfSx2aXNpdFNlbGVjdG9yOmZ1bmN0aW9uKGEsYil7Yi52aXNpdERlZXBlcj0hMX0sdmlzaXRSdWxlc2V0OmZ1bmN0aW9uKGEpe2lmKCFhLnJvb3Qpe3ZhciBiLGMsZCxlLGY9dGhpcy5hbGxFeHRlbmRzU3RhY2tbdGhpcy5hbGxFeHRlbmRzU3RhY2subGVuZ3RoLTFdLGc9W10saD10aGlzO2ZvcihkPTA7Zi5sZW5ndGg+ZDtkKyspZm9yKGM9MDthLnBhdGhzLmxlbmd0aD5jO2MrKylpZihlPWEucGF0aHNbY10sIWEuZXh0ZW5kT25FdmVyeVBhdGgpe3ZhciBpPWVbZS5sZW5ndGgtMV0uZXh0ZW5kTGlzdDtpJiZpLmxlbmd0aHx8KGI9dGhpcy5maW5kTWF0Y2goZltkXSxlKSxiLmxlbmd0aCYmKGZbZF0uaGFzRm91bmRNYXRjaGVzPSEwLGZbZF0uc2VsZlNlbGVjdG9ycy5mb3JFYWNoKGZ1bmN0aW9uKGEpe2cucHVzaChoLmV4dGVuZFNlbGVjdG9yKGIsZSxhKSl9KSkpfWEucGF0aHM9YS5wYXRocy5jb25jYXQoZyl9fSxmaW5kTWF0Y2g6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZixnLGgsaSxqPXRoaXMsaz1hLnNlbGVjdG9yLmVsZW1lbnRzLGw9W10sbT1bXTtmb3IoYz0wO2IubGVuZ3RoPmM7YysrKWZvcihkPWJbY10sZT0wO2QuZWxlbWVudHMubGVuZ3RoPmU7ZSsrKWZvcihmPWQuZWxlbWVudHNbZV0sKGEuYWxsb3dCZWZvcmV8fDA9PT1jJiYwPT09ZSkmJmwucHVzaCh7cGF0aEluZGV4OmMsaW5kZXg6ZSxtYXRjaGVkOjAsaW5pdGlhbENvbWJpbmF0b3I6Zi5jb21iaW5hdG9yfSksaD0wO2wubGVuZ3RoPmg7aCsrKWk9bFtoXSxnPWYuY29tYmluYXRvci52YWx1ZSwiIj09PWcmJjA9PT1lJiYoZz0iICIpLCFqLmlzRWxlbWVudFZhbHVlc0VxdWFsKGtbaS5tYXRjaGVkXS52YWx1ZSxmLnZhbHVlKXx8aS5tYXRjaGVkPjAmJmtbaS5tYXRjaGVkXS5jb21iaW5hdG9yLnZhbHVlIT09Zz9pPW51bGw6aS5tYXRjaGVkKyssaSYmKGkuZmluaXNoZWQ9aS5tYXRjaGVkPT09ay5sZW5ndGgsaS5maW5pc2hlZCYmIWEuYWxsb3dBZnRlciYmKGQuZWxlbWVudHMubGVuZ3RoPmUrMXx8Yi5sZW5ndGg+YysxKSYmKGk9bnVsbCkpLGk/aS5maW5pc2hlZCYmKGkubGVuZ3RoPWsubGVuZ3RoLGkuZW5kUGF0aEluZGV4PWMsaS5lbmRQYXRoRWxlbWVudEluZGV4PWUrMSxsLmxlbmd0aD0wLG0ucHVzaChpKSk6KGwuc3BsaWNlKGgsMSksaC0tKTtyZXR1cm4gbX0saXNFbGVtZW50VmFsdWVzRXF1YWw6ZnVuY3Rpb24oYSxiKXtpZigic3RyaW5nIj09dHlwZW9mIGF8fCJzdHJpbmciPT10eXBlb2YgYilyZXR1cm4gYT09PWI7aWYoYSBpbnN0YW5jZW9mIGMuQXR0cmlidXRlKXJldHVybiBhLm9wIT09Yi5vcHx8YS5rZXkhPT1iLmtleT8hMTphLnZhbHVlJiZiLnZhbHVlPyhhPWEudmFsdWUudmFsdWV8fGEudmFsdWUsYj1iLnZhbHVlLnZhbHVlfHxiLnZhbHVlLGE9PT1iKTphLnZhbHVlfHxiLnZhbHVlPyExOiEwO2lmKGE9YS52YWx1ZSxiPWIudmFsdWUsYSBpbnN0YW5jZW9mIGMuU2VsZWN0b3Ipe2lmKCEoYiBpbnN0YW5jZW9mIGMuU2VsZWN0b3IpfHxhLmVsZW1lbnRzLmxlbmd0aCE9PWIuZWxlbWVudHMubGVuZ3RoKXJldHVybiExO2Zvcih2YXIgZD0wO2EuZWxlbWVudHMubGVuZ3RoPmQ7ZCsrKXtpZihhLmVsZW1lbnRzW2RdLmNvbWJpbmF0b3IudmFsdWUhPT1iLmVsZW1lbnRzW2RdLmNvbWJpbmF0b3IudmFsdWUmJigwIT09ZHx8KGEuZWxlbWVudHNbZF0uY29tYmluYXRvci52YWx1ZXx8IiAiKSE9PShiLmVsZW1lbnRzW2RdLmNvbWJpbmF0b3IudmFsdWV8fCIgIikpKXJldHVybiExO2lmKCF0aGlzLmlzRWxlbWVudFZhbHVlc0VxdWFsKGEuZWxlbWVudHNbZF0udmFsdWUsYi5lbGVtZW50c1tkXS52YWx1ZSkpcmV0dXJuITF9cmV0dXJuITB9cmV0dXJuITF9LGV4dGVuZFNlbGVjdG9yOmZ1bmN0aW9uKGEsYixkKXt2YXIgZSxmLGcsaCxpLGo9MCxrPTAsbD1bXTtmb3IoZT0wO2EubGVuZ3RoPmU7ZSsrKWg9YVtlXSxmPWJbaC5wYXRoSW5kZXhdLGc9bmV3IGMuRWxlbWVudChoLmluaXRpYWxDb21iaW5hdG9yLGQuZWxlbWVudHNbMF0udmFsdWUsZC5lbGVtZW50c1swXS5pbmRleCxkLmVsZW1lbnRzWzBdLmN1cnJlbnRGaWxlSW5mbyksaC5wYXRoSW5kZXg+aiYmaz4wJiYobFtsLmxlbmd0aC0xXS5lbGVtZW50cz1sW2wubGVuZ3RoLTFdLmVsZW1lbnRzLmNvbmNhdChiW2pdLmVsZW1lbnRzLnNsaWNlKGspKSxrPTAsaisrKSxpPWYuZWxlbWVudHMuc2xpY2UoayxoLmluZGV4KS5jb25jYXQoW2ddKS5jb25jYXQoZC5lbGVtZW50cy5zbGljZSgxKSksaj09PWgucGF0aEluZGV4JiZlPjA/bFtsLmxlbmd0aC0xXS5lbGVtZW50cz1sW2wubGVuZ3RoLTFdLmVsZW1lbnRzLmNvbmNhdChpKToobD1sLmNvbmNhdChiLnNsaWNlKGosaC5wYXRoSW5kZXgpKSxsLnB1c2gobmV3IGMuU2VsZWN0b3IoaSkpKSxqPWguZW5kUGF0aEluZGV4LGs9aC5lbmRQYXRoRWxlbWVudEluZGV4LGs+PWJbal0uZWxlbWVudHMubGVuZ3RoJiYoaz0wLGorKyk7cmV0dXJuIGIubGVuZ3RoPmomJms+MCYmKGxbbC5sZW5ndGgtMV0uZWxlbWVudHM9bFtsLmxlbmd0aC0xXS5lbGVtZW50cy5jb25jYXQoYltqXS5lbGVtZW50cy5zbGljZShrKSksaisrKSxsPWwuY29uY2F0KGIuc2xpY2UoaixiLmxlbmd0aCkpfSx2aXNpdFJ1bGVzZXRPdXQ6ZnVuY3Rpb24oKXt9LHZpc2l0TWVkaWE6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hbGxFeHRlbmRzLmNvbmNhdCh0aGlzLmFsbEV4dGVuZHNTdGFja1t0aGlzLmFsbEV4dGVuZHNTdGFjay5sZW5ndGgtMV0pO2I9Yi5jb25jYXQodGhpcy5kb0V4dGVuZENoYWluaW5nKGIsYS5hbGxFeHRlbmRzKSksdGhpcy5hbGxFeHRlbmRzU3RhY2sucHVzaChiKX0sdmlzaXRNZWRpYU91dDpmdW5jdGlvbigpe3ZhciBhPXRoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aC0xO3RoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aD1hfSx2aXNpdERpcmVjdGl2ZTpmdW5jdGlvbihhKXt2YXIgYj1hLmFsbEV4dGVuZHMuY29uY2F0KHRoaXMuYWxsRXh0ZW5kc1N0YWNrW3RoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aC0xXSk7Yj1iLmNvbmNhdCh0aGlzLmRvRXh0ZW5kQ2hhaW5pbmcoYixhLmFsbEV4dGVuZHMpKSx0aGlzLmFsbEV4dGVuZHNTdGFjay5wdXNoKGIpfSx2aXNpdERpcmVjdGl2ZU91dDpmdW5jdGlvbigpe3ZhciBhPXRoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aC0xO3RoaXMuYWxsRXh0ZW5kc1N0YWNrLmxlbmd0aD1hfX0sYi5leHBvcnRzPWd9LHsiLi4vbG9nZ2VyIjozMSwiLi4vdHJlZSI6NjAsIi4vdmlzaXRvciI6ODh9XSw4MzpbZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBjKGEpe3RoaXMuaW1wb3J0cz1bXSx0aGlzLnZhcmlhYmxlSW1wb3J0cz1bXSx0aGlzLl9vblNlcXVlbmNlckVtcHR5PWEsdGhpcy5fY3VycmVudERlcHRoPTB9Yy5wcm90b3R5cGUuYWRkSW1wb3J0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsYz17Y2FsbGJhY2s6YSxhcmdzOm51bGwsaXNSZWFkeTohMX07cmV0dXJuIHRoaXMuaW1wb3J0cy5wdXNoKGMpLGZ1bmN0aW9uKCl7Yy5hcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKSxjLmlzUmVhZHk9ITAsYi50cnlSdW4oKX19LGMucHJvdG90eXBlLmFkZFZhcmlhYmxlSW1wb3J0PWZ1bmN0aW9uKGEpe3RoaXMudmFyaWFibGVJbXBvcnRzLnB1c2goYSl9LGMucHJvdG90eXBlLnRyeVJ1bj1mdW5jdGlvbigpe3RoaXMuX2N1cnJlbnREZXB0aCsrO3RyeXtmb3IoOzspe2Zvcig7dGhpcy5pbXBvcnRzLmxlbmd0aD4wOyl7dmFyIGE9dGhpcy5pbXBvcnRzWzBdO2lmKCFhLmlzUmVhZHkpcmV0dXJuO3RoaXMuaW1wb3J0cz10aGlzLmltcG9ydHMuc2xpY2UoMSksYS5jYWxsYmFjay5hcHBseShudWxsLGEuYXJncyl9aWYoMD09PXRoaXMudmFyaWFibGVJbXBvcnRzLmxlbmd0aClicmVhazt2YXIgYj10aGlzLnZhcmlhYmxlSW1wb3J0c1swXTt0aGlzLnZhcmlhYmxlSW1wb3J0cz10aGlzLnZhcmlhYmxlSW1wb3J0cy5zbGljZSgxKSxiKCl9fWZpbmFsbHl7dGhpcy5fY3VycmVudERlcHRoLS19MD09PXRoaXMuX2N1cnJlbnREZXB0aCYmdGhpcy5fb25TZXF1ZW5jZXJFbXB0eSYmdGhpcy5fb25TZXF1ZW5jZXJFbXB0eSgpfSxiLmV4cG9ydHM9Y30se31dLDg0OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4uL2NvbnRleHRzIiksZD1hKCIuL3Zpc2l0b3IiKSxlPWEoIi4vaW1wb3J0LXNlcXVlbmNlciIpLGY9ZnVuY3Rpb24oYSxiKXt0aGlzLl92aXNpdG9yPW5ldyBkKHRoaXMpLHRoaXMuX2ltcG9ydGVyPWEsdGhpcy5fZmluaXNoPWIsdGhpcy5jb250ZXh0PW5ldyBjLkV2YWwsdGhpcy5pbXBvcnRDb3VudD0wLHRoaXMub25jZUZpbGVEZXRlY3Rpb25NYXA9e30sdGhpcy5yZWN1cnNpb25EZXRlY3Rvcj17fSx0aGlzLl9zZXF1ZW5jZXI9bmV3IGUodGhpcy5fb25TZXF1ZW5jZXJFbXB0eS5iaW5kKHRoaXMpKX07Zi5wcm90b3R5cGU9e2lzUmVwbGFjaW5nOiExLHJ1bjpmdW5jdGlvbihhKXt0cnl7dGhpcy5fdmlzaXRvci52aXNpdChhKX1jYXRjaChiKXt0aGlzLmVycm9yPWJ9dGhpcy5pc0ZpbmlzaGVkPSEwLHRoaXMuX3NlcXVlbmNlci50cnlSdW4oKX0sX29uU2VxdWVuY2VyRW1wdHk6ZnVuY3Rpb24oKXt0aGlzLmlzRmluaXNoZWQmJnRoaXMuX2ZpbmlzaCh0aGlzLmVycm9yKX0sdmlzaXRJbXBvcnQ6ZnVuY3Rpb24oYSxiKXt2YXIgZD1hLm9wdGlvbnMuaW5saW5lO2lmKCFhLmNzc3x8ZCl7dmFyIGU9bmV3IGMuRXZhbCh0aGlzLmNvbnRleHQsdGhpcy5jb250ZXh0LmZyYW1lcy5zbGljZSgwKSksZj1lLmZyYW1lc1swXTt0aGlzLmltcG9ydENvdW50KyssYS5pc1ZhcmlhYmxlSW1wb3J0KCk/dGhpcy5fc2VxdWVuY2VyLmFkZFZhcmlhYmxlSW1wb3J0KHRoaXMucHJvY2Vzc0ltcG9ydE5vZGUuYmluZCh0aGlzLGEsZSxmKSk6dGhpcy5wcm9jZXNzSW1wb3J0Tm9kZShhLGUsZil9Yi52aXNpdERlZXBlcj0hMX0scHJvY2Vzc0ltcG9ydE5vZGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU9YS5vcHRpb25zLmlubGluZTt0cnl7ZD1hLmV2YWxGb3JJbXBvcnQoYil9Y2F0Y2goZil7Zi5maWxlbmFtZXx8KGYuaW5kZXg9YS5pbmRleCxmLmZpbGVuYW1lPWEuY3VycmVudEZpbGVJbmZvLmZpbGVuYW1lKSxhLmNzcz0hMCxhLmVycm9yPWZ9aWYoIWR8fGQuY3NzJiYhZSl0aGlzLmltcG9ydENvdW50LS0sdGhpcy5pc0ZpbmlzaGVkJiZ0aGlzLl9zZXF1ZW5jZXIudHJ5UnVuKCk7ZWxzZXtkLm9wdGlvbnMubXVsdGlwbGUmJihiLmltcG9ydE11bHRpcGxlPSEwKTtmb3IodmFyIGc9dm9pZCAwPT09ZC5jc3MsaD0wO2MucnVsZXMubGVuZ3RoPmg7aCsrKWlmKGMucnVsZXNbaF09PT1hKXtjLnJ1bGVzW2hdPWQ7YnJlYWt9dmFyIGk9dGhpcy5vbkltcG9ydGVkLmJpbmQodGhpcyxkLGIpLGo9dGhpcy5fc2VxdWVuY2VyLmFkZEltcG9ydChpKTt0aGlzLl9pbXBvcnRlci5wdXNoKGQuZ2V0UGF0aCgpLGcsZC5jdXJyZW50RmlsZUluZm8sZC5vcHRpb25zLGopfX0sb25JbXBvcnRlZDpmdW5jdGlvbihhLGIsYyxkLGUsZil7YyYmKGMuZmlsZW5hbWV8fChjLmluZGV4PWEuaW5kZXgsYy5maWxlbmFtZT1hLmN1cnJlbnRGaWxlSW5mby5maWxlbmFtZSksdGhpcy5lcnJvcj1jKTt2YXIgZz10aGlzLGg9YS5vcHRpb25zLmlubGluZSxpPWEub3B0aW9ucy5wbHVnaW4saj1lfHxmIGluIGcucmVjdXJzaW9uRGV0ZWN0b3I7aWYoYi5pbXBvcnRNdWx0aXBsZXx8KGEuc2tpcD1qPyEwOmZ1bmN0aW9uKCl7cmV0dXJuIGYgaW4gZy5vbmNlRmlsZURldGVjdGlvbk1hcD8hMDooZy5vbmNlRmlsZURldGVjdGlvbk1hcFtmXT0hMCwhMSl9KSxkJiYoYS5yb290PWQsYS5pbXBvcnRlZEZpbGVuYW1lPWYsIShofHxpfHwhYi5pbXBvcnRNdWx0aXBsZSYmaikpKXtnLnJlY3Vyc2lvbkRldGVjdG9yW2ZdPSEwO3ZhciBrPXRoaXMuY29udGV4dDt0aGlzLmNvbnRleHQ9Yjt0cnl7dGhpcy5fdmlzaXRvci52aXNpdChkKX1jYXRjaChjKXt0aGlzLmVycm9yPWN9dGhpcy5jb250ZXh0PWt9Zy5pbXBvcnRDb3VudC0tLGcuaXNGaW5pc2hlZCYmZy5fc2VxdWVuY2VyLnRyeVJ1bigpfSx2aXNpdFJ1bGU6ZnVuY3Rpb24oYSxiKXsiRGV0YWNoZWRSdWxlc2V0Ij09PWEudmFsdWUudHlwZT90aGlzLmNvbnRleHQuZnJhbWVzLnVuc2hpZnQoYSk6Yi52aXNpdERlZXBlcj0hMX0sdmlzaXRSdWxlT3V0OmZ1bmN0aW9uKGEpeyJEZXRhY2hlZFJ1bGVzZXQiPT09YS52YWx1ZS50eXBlJiZ0aGlzLmNvbnRleHQuZnJhbWVzLnNoaWZ0KCl9LHZpc2l0RGlyZWN0aXZlOmZ1bmN0aW9uKGEpe3RoaXMuY29udGV4dC5mcmFtZXMudW5zaGlmdChhKX0sdmlzaXREaXJlY3RpdmVPdXQ6ZnVuY3Rpb24oKXt0aGlzLmNvbnRleHQuZnJhbWVzLnNoaWZ0KCl9LHZpc2l0TWl4aW5EZWZpbml0aW9uOmZ1bmN0aW9uKGEpe3RoaXMuY29udGV4dC5mcmFtZXMudW5zaGlmdChhKX0sdmlzaXRNaXhpbkRlZmluaXRpb25PdXQ6ZnVuY3Rpb24oKXt0aGlzLmNvbnRleHQuZnJhbWVzLnNoaWZ0KCl9LHZpc2l0UnVsZXNldDpmdW5jdGlvbihhKXt0aGlzLmNvbnRleHQuZnJhbWVzLnVuc2hpZnQoYSl9LHZpc2l0UnVsZXNldE91dDpmdW5jdGlvbigpe3RoaXMuY29udGV4dC5mcmFtZXMuc2hpZnQoKX0sdmlzaXRNZWRpYTpmdW5jdGlvbihhKXt0aGlzLmNvbnRleHQuZnJhbWVzLnVuc2hpZnQoYS5ydWxlc1swXSl9LHZpc2l0TWVkaWFPdXQ6ZnVuY3Rpb24oKXt0aGlzLmNvbnRleHQuZnJhbWVzLnNoaWZ0KCl9fSxiLmV4cG9ydHM9Zn0seyIuLi9jb250ZXh0cyI6MTAsIi4vaW1wb3J0LXNlcXVlbmNlciI6ODMsIi4vdmlzaXRvciI6ODh9XSw4NTpbZnVuY3Rpb24oYSxiKXt2YXIgYz17VmlzaXRvcjphKCIuL3Zpc2l0b3IiKSxJbXBvcnRWaXNpdG9yOmEoIi4vaW1wb3J0LXZpc2l0b3IiKSxFeHRlbmRWaXNpdG9yOmEoIi4vZXh0ZW5kLXZpc2l0b3IiKSxKb2luU2VsZWN0b3JWaXNpdG9yOmEoIi4vam9pbi1zZWxlY3Rvci12aXNpdG9yIiksVG9DU1NWaXNpdG9yOmEoIi4vdG8tY3NzLXZpc2l0b3IiKX07Yi5leHBvcnRzPWN9LHsiLi9leHRlbmQtdmlzaXRvciI6ODIsIi4vaW1wb3J0LXZpc2l0b3IiOjg0LCIuL2pvaW4tc2VsZWN0b3ItdmlzaXRvciI6ODYsIi4vdG8tY3NzLXZpc2l0b3IiOjg3LCIuL3Zpc2l0b3IiOjg4fV0sODY6W2Z1bmN0aW9uKGEsYil7dmFyIGM9YSgiLi92aXNpdG9yIiksZD1mdW5jdGlvbigpe3RoaXMuY29udGV4dHM9W1tdXSx0aGlzLl92aXNpdG9yPW5ldyBjKHRoaXMpfTtkLnByb3RvdHlwZT17cnVuOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl92aXNpdG9yLnZpc2l0KGEpfSx2aXNpdFJ1bGU6ZnVuY3Rpb24oYSxiKXtiLnZpc2l0RGVlcGVyPSExfSx2aXNpdE1peGluRGVmaW5pdGlvbjpmdW5jdGlvbihhLGIpe2IudmlzaXREZWVwZXI9ITF9LHZpc2l0UnVsZXNldDpmdW5jdGlvbihhKXt2YXIgYixjPXRoaXMuY29udGV4dHNbdGhpcy5jb250ZXh0cy5sZW5ndGgtMV0sZD1bXTt0aGlzLmNvbnRleHRzLnB1c2goZCksYS5yb290fHwoYj1hLnNlbGVjdG9ycyxiJiYoYj1iLmZpbHRlcihmdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRJc091dHB1dCgpfSksYS5zZWxlY3RvcnM9Yi5sZW5ndGg/YjpiPW51bGwsYiYmYS5qb2luU2VsZWN0b3JzKGQsYyxiKSksYnx8KGEucnVsZXM9bnVsbCksYS5wYXRocz1kKX0sdmlzaXRSdWxlc2V0T3V0OmZ1bmN0aW9uKCl7dGhpcy5jb250ZXh0cy5sZW5ndGg9dGhpcy5jb250ZXh0cy5sZW5ndGgtMX0sdmlzaXRNZWRpYTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLmNvbnRleHRzW3RoaXMuY29udGV4dHMubGVuZ3RoLTFdO2EucnVsZXNbMF0ucm9vdD0wPT09Yi5sZW5ndGh8fGJbMF0ubXVsdGlNZWRpYX0sdmlzaXREaXJlY3RpdmU6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jb250ZXh0c1t0aGlzLmNvbnRleHRzLmxlbmd0aC0xXTthLnJ1bGVzJiZhLnJ1bGVzLmxlbmd0aCYmKGEucnVsZXNbMF0ucm9vdD1hLmlzUm9vdGVkfHwwPT09Yi5sZW5ndGh8fG51bGwpfX0sYi5leHBvcnRzPWR9LHsiLi92aXNpdG9yIjo4OH1dLDg3OltmdW5jdGlvbihhLGIpe3ZhciBjPWEoIi4uL3RyZWUiKSxkPWEoIi4vdmlzaXRvciIpLGU9ZnVuY3Rpb24oYSl7dGhpcy5fdmlzaXRvcj1uZXcgZCh0aGlzKSx0aGlzLl9jb250ZXh0PWF9O2UucHJvdG90eXBlPXtpc1JlcGxhY2luZzohMCxydW46ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3Zpc2l0b3IudmlzaXQoYSl9LHZpc2l0UnVsZTpmdW5jdGlvbihhKXtyZXR1cm4gYS52YXJpYWJsZT92b2lkIDA6YX0sdmlzaXRNaXhpbkRlZmluaXRpb246ZnVuY3Rpb24oYSl7DQphLmZyYW1lcz1bXX0sdmlzaXRFeHRlbmQ6ZnVuY3Rpb24oKXt9LHZpc2l0Q29tbWVudDpmdW5jdGlvbihhKXtyZXR1cm4gYS5pc1NpbGVudCh0aGlzLl9jb250ZXh0KT92b2lkIDA6YX0sdmlzaXRNZWRpYTpmdW5jdGlvbihhLGIpe3JldHVybiBhLmFjY2VwdCh0aGlzLl92aXNpdG9yKSxiLnZpc2l0RGVlcGVyPSExLGEucnVsZXMubGVuZ3RoP2E6dm9pZCAwfSx2aXNpdEltcG9ydDpmdW5jdGlvbihhKXtyZXR1cm4gdm9pZCAwIT09YS5wYXRoLmN1cnJlbnRGaWxlSW5mby5yZWZlcmVuY2UmJmEuY3NzP3ZvaWQgMDphfSx2aXNpdERpcmVjdGl2ZTpmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGQoYSl7dmFyIGIsYz1hLnJ1bGVzOzEhPT1jLmxlbmd0aHx8Y1swXS5wYXRocyYmMCE9PWNbMF0ucGF0aHMubGVuZ3RofHwoYz1jWzBdLnJ1bGVzKTtmb3IodmFyIGQ9MDtjLmxlbmd0aD5kO2QrKylpZihiPWNbZF0sYi5nZXRJc1JlZmVyZW5jZWQmJmIuZ2V0SXNSZWZlcmVuY2VkKCkpcmV0dXJuITA7cmV0dXJuITF9aWYoIkBjaGFyc2V0Ij09PWEubmFtZSl7aWYoIWEuZ2V0SXNSZWZlcmVuY2VkKCkpcmV0dXJuO2lmKHRoaXMuY2hhcnNldCl7aWYoYS5kZWJ1Z0luZm8pe3ZhciBlPW5ldyBjLkNvbW1lbnQoIi8qICIrYS50b0NTUyh0aGlzLl9jb250ZXh0KS5yZXBsYWNlKC9cbi9nLCIiKSsiICovXG4iKTtyZXR1cm4gZS5kZWJ1Z0luZm89YS5kZWJ1Z0luZm8sdGhpcy5fdmlzaXRvci52aXNpdChlKX1yZXR1cm59dGhpcy5jaGFyc2V0PSEwfWlmKGEucnVsZXMmJmEucnVsZXMubGVuZ3RoKXtpZih0aGlzLl9tZXJnZVJ1bGVzKGEucnVsZXNbMF0ucnVsZXMpLGEuYWNjZXB0KHRoaXMuX3Zpc2l0b3IpLGIudmlzaXREZWVwZXI9ITEsYS5nZXRJc1JlZmVyZW5jZWQoKSlyZXR1cm4gYTtpZighYS5ydWxlc3x8IWEucnVsZXMubGVuZ3RoKXJldHVybjtpZihkKGEpKXJldHVybiBhLm1hcmtSZWZlcmVuY2VkKCksYX1lbHNlIGlmKGEuZ2V0SXNSZWZlcmVuY2VkKCkpcmV0dXJuIGF9LGNoZWNrUHJvcGVydGllc0luUm9vdDpmdW5jdGlvbihhKXtmb3IodmFyIGIsZD0wO2EubGVuZ3RoPmQ7ZCsrKWlmKGI9YVtkXSxiIGluc3RhbmNlb2YgYy5SdWxlJiYhYi52YXJpYWJsZSl0aHJvd3ttZXNzYWdlOiJwcm9wZXJ0aWVzIG11c3QgYmUgaW5zaWRlIHNlbGVjdG9yIGJsb2NrcywgdGhleSBjYW5ub3QgYmUgaW4gdGhlIHJvb3QuIixpbmRleDpiLmluZGV4LGZpbGVuYW1lOmIuY3VycmVudEZpbGVJbmZvP2IuY3VycmVudEZpbGVJbmZvLmZpbGVuYW1lOm51bGx9fSx2aXNpdFJ1bGVzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgZCxlPVtdO2lmKGEuZmlyc3RSb290JiZ0aGlzLmNoZWNrUHJvcGVydGllc0luUm9vdChhLnJ1bGVzKSxhLnJvb3QpYS5hY2NlcHQodGhpcy5fdmlzaXRvciksYi52aXNpdERlZXBlcj0hMSwoYS5maXJzdFJvb3R8fGEucnVsZXMmJmEucnVsZXMubGVuZ3RoPjApJiZlLnNwbGljZSgwLDAsYSk7ZWxzZXthLnBhdGhzJiYoYS5wYXRocz1hLnBhdGhzLmZpbHRlcihmdW5jdGlvbihhKXt2YXIgYjtmb3IoIiAiPT09YVswXS5lbGVtZW50c1swXS5jb21iaW5hdG9yLnZhbHVlJiYoYVswXS5lbGVtZW50c1swXS5jb21iaW5hdG9yPW5ldyBjLkNvbWJpbmF0b3IoIiIpKSxiPTA7YS5sZW5ndGg+YjtiKyspaWYoYVtiXS5nZXRJc1JlZmVyZW5jZWQoKSYmYVtiXS5nZXRJc091dHB1dCgpKXJldHVybiEwO3JldHVybiExfSkpO2Zvcih2YXIgZj1hLnJ1bGVzLGc9Zj9mLmxlbmd0aDowLGg9MDtnPmg7KWQ9ZltoXSxkJiZkLnJ1bGVzPyhlLnB1c2godGhpcy5fdmlzaXRvci52aXNpdChkKSksZi5zcGxpY2UoaCwxKSxnLS0pOmgrKztnPjA/YS5hY2NlcHQodGhpcy5fdmlzaXRvcik6YS5ydWxlcz1udWxsLGIudmlzaXREZWVwZXI9ITEsZj1hLnJ1bGVzLGYmJih0aGlzLl9tZXJnZVJ1bGVzKGYpLGY9YS5ydWxlcyksZiYmKHRoaXMuX3JlbW92ZUR1cGxpY2F0ZVJ1bGVzKGYpLGY9YS5ydWxlcyksZiYmZi5sZW5ndGg+MCYmYS5wYXRocy5sZW5ndGg+MCYmZS5zcGxpY2UoMCwwLGEpfXJldHVybiAxPT09ZS5sZW5ndGg/ZVswXTplfSxfcmVtb3ZlRHVwbGljYXRlUnVsZXM6ZnVuY3Rpb24oYSl7aWYoYSl7dmFyIGIsZCxlLGY9e307Zm9yKGU9YS5sZW5ndGgtMTtlPj0wO2UtLSlpZihkPWFbZV0sZCBpbnN0YW5jZW9mIGMuUnVsZSlpZihmW2QubmFtZV0pe2I9ZltkLm5hbWVdLGIgaW5zdGFuY2VvZiBjLlJ1bGUmJihiPWZbZC5uYW1lXT1bZltkLm5hbWVdLnRvQ1NTKHRoaXMuX2NvbnRleHQpXSk7dmFyIGc9ZC50b0NTUyh0aGlzLl9jb250ZXh0KTstMSE9PWIuaW5kZXhPZihnKT9hLnNwbGljZShlLDEpOmIucHVzaChnKX1lbHNlIGZbZC5uYW1lXT1kfX0sX21lcmdlUnVsZXM6ZnVuY3Rpb24oYSl7aWYoYSl7Zm9yKHZhciBiLGQsZSxmPXt9LGc9MDthLmxlbmd0aD5nO2crKylkPWFbZ10sZCBpbnN0YW5jZW9mIGMuUnVsZSYmZC5tZXJnZSYmKGU9W2QubmFtZSxkLmltcG9ydGFudD8iISI6IiJdLmpvaW4oIiwiKSxmW2VdP2Euc3BsaWNlKGctLSwxKTpmW2VdPVtdLGZbZV0ucHVzaChkKSk7T2JqZWN0LmtleXMoZikubWFwKGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGUoYSl7cmV0dXJuIG5ldyBjLkV4cHJlc3Npb24oYS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEudmFsdWV9KSl9ZnVuY3Rpb24gZyhhKXtyZXR1cm4gbmV3IGMuVmFsdWUoYS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGF9KSl9aWYoYj1mW2FdLGIubGVuZ3RoPjEpe2Q9YlswXTt2YXIgaD1bXSxpPVtdO2IubWFwKGZ1bmN0aW9uKGEpeyIrIj09PWEubWVyZ2UmJihpLmxlbmd0aD4wJiZoLnB1c2goZShpKSksaT1bXSksaS5wdXNoKGEpfSksaC5wdXNoKGUoaSkpLGQudmFsdWU9ZyhoKX19KX19fSxiLmV4cG9ydHM9ZX0seyIuLi90cmVlIjo2MCwiLi92aXNpdG9yIjo4OH1dLDg4OltmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoYSl7cmV0dXJuIGF9ZnVuY3Rpb24gZChhLGIpe3ZhciBjLGU7Zm9yKGMgaW4gYSlpZihhLmhhc093blByb3BlcnR5KGMpKXN3aXRjaChlPWFbY10sdHlwZW9mIGUpe2Nhc2UiZnVuY3Rpb24iOmUucHJvdG90eXBlJiZlLnByb3RvdHlwZS50eXBlJiYoZS5wcm90b3R5cGUudHlwZUluZGV4PWIrKyk7YnJlYWs7Y2FzZSJvYmplY3QiOmI9ZChlLGIpfXJldHVybiBifXZhciBlPWEoIi4uL3RyZWUiKSxmPXt2aXNpdERlZXBlcjohMH0sZz0hMSxoPWZ1bmN0aW9uKGEpe3RoaXMuX2ltcGxlbWVudGF0aW9uPWEsdGhpcy5fdmlzaXRGbkNhY2hlPVtdLGd8fChkKGUsMSksZz0hMCl9O2gucHJvdG90eXBlPXt2aXNpdDpmdW5jdGlvbihhKXtpZighYSlyZXR1cm4gYTt2YXIgYj1hLnR5cGVJbmRleDtpZighYilyZXR1cm4gYTt2YXIgZCxlPXRoaXMuX3Zpc2l0Rm5DYWNoZSxnPXRoaXMuX2ltcGxlbWVudGF0aW9uLGg9Yjw8MSxpPTF8aCxqPWVbaF0saz1lW2ldLGw9ZjtpZihsLnZpc2l0RGVlcGVyPSEwLGp8fChkPSJ2aXNpdCIrYS50eXBlLGo9Z1tkXXx8YyxrPWdbZCsiT3V0Il18fGMsZVtoXT1qLGVbaV09ayksaiE9PWMpe3ZhciBtPWouY2FsbChnLGEsbCk7Zy5pc1JlcGxhY2luZyYmKGE9bSl9cmV0dXJuIGwudmlzaXREZWVwZXImJmEmJmEuYWNjZXB0JiZhLmFjY2VwdCh0aGlzKSxrIT1jJiZrLmNhbGwoZyxhKSxhfSx2aXNpdEFycmF5OmZ1bmN0aW9uKGEsYil7aWYoIWEpcmV0dXJuIGE7dmFyIGMsZD1hLmxlbmd0aDtpZihifHwhdGhpcy5faW1wbGVtZW50YXRpb24uaXNSZXBsYWNpbmcpe2ZvcihjPTA7ZD5jO2MrKyl0aGlzLnZpc2l0KGFbY10pO3JldHVybiBhfXZhciBlPVtdO2ZvcihjPTA7ZD5jO2MrKyl7dmFyIGY9dGhpcy52aXNpdChhW2NdKTt2b2lkIDAhPT1mJiYoZi5zcGxpY2U/Zi5sZW5ndGgmJnRoaXMuZmxhdHRlbihmLGUpOmUucHVzaChmKSl9cmV0dXJuIGV9LGZsYXR0ZW46ZnVuY3Rpb24oYSxiKXtifHwoYj1bXSk7dmFyIGMsZCxlLGYsZyxoO2ZvcihkPTAsYz1hLmxlbmd0aDtjPmQ7ZCsrKWlmKGU9YVtkXSx2b2lkIDAhPT1lKWlmKGUuc3BsaWNlKWZvcihnPTAsZj1lLmxlbmd0aDtmPmc7ZysrKWg9ZVtnXSx2b2lkIDAhPT1oJiYoaC5zcGxpY2U/aC5sZW5ndGgmJnRoaXMuZmxhdHRlbihoLGIpOmIucHVzaChoKSk7ZWxzZSBiLnB1c2goZSk7cmV0dXJuIGJ9fSxiLmV4cG9ydHM9aH0seyIuLi90cmVlIjo2MH1dLDg5OltmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoKXtpZighZyl7Zz0hMDtmb3IodmFyIGEsYj1mLmxlbmd0aDtiOyl7YT1mLGY9W107Zm9yKHZhciBjPS0xOysrYzxiOylhW2NdKCk7Yj1mLmxlbmd0aH1nPSExfX1mdW5jdGlvbiBkKCl7fXZhciBlPWIuZXhwb3J0cz17fSxmPVtdLGc9ITE7ZS5uZXh0VGljaz1mdW5jdGlvbihhKXtmLnB1c2goYSksZ3x8c2V0VGltZW91dChjLDApfSxlLnRpdGxlPSJicm93c2VyIixlLmJyb3dzZXI9ITAsZS5lbnY9e30sZS5hcmd2PVtdLGUudmVyc2lvbj0iIixlLnZlcnNpb25zPXt9LGUub249ZCxlLmFkZExpc3RlbmVyPWQsZS5vbmNlPWQsZS5vZmY9ZCxlLnJlbW92ZUxpc3RlbmVyPWQsZS5yZW1vdmVBbGxMaXN0ZW5lcnM9ZCxlLmVtaXQ9ZCxlLmJpbmRpbmc9ZnVuY3Rpb24oKXt0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIil9LGUuY3dkPWZ1bmN0aW9uKCl7cmV0dXJuIi8ifSxlLmNoZGlyPWZ1bmN0aW9uKCl7dGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQiKX0sZS51bWFzaz1mdW5jdGlvbigpe3JldHVybiAwfX0se31dLDkwOltmdW5jdGlvbihhLGIpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBjKGEpe2Z1bmN0aW9uIGIoYSl7cmV0dXJuIG51bGw9PT1pP3ZvaWQgay5wdXNoKGEpOnZvaWQgZihmdW5jdGlvbigpe3ZhciBiPWk/YS5vbkZ1bGZpbGxlZDphLm9uUmVqZWN0ZWQ7aWYobnVsbD09PWIpcmV0dXJuIHZvaWQoaT9hLnJlc29sdmU6YS5yZWplY3QpKGopO3ZhciBjO3RyeXtjPWIoail9Y2F0Y2goZCl7cmV0dXJuIHZvaWQgYS5yZWplY3QoZCl9YS5yZXNvbHZlKGMpfSl9ZnVuY3Rpb24gYyhhKXt0cnl7aWYoYT09PWwpdGhyb3cgbmV3IFR5cGVFcnJvcigiQSBwcm9taXNlIGNhbm5vdCBiZSByZXNvbHZlZCB3aXRoIGl0c2VsZi4iKTtpZihhJiYoIm9iamVjdCI9PXR5cGVvZiBhfHwiZnVuY3Rpb24iPT10eXBlb2YgYSkpe3ZhciBiPWEudGhlbjtpZigiZnVuY3Rpb24iPT10eXBlb2YgYilyZXR1cm4gdm9pZCBlKGIuYmluZChhKSxjLGcpfWk9ITAsaj1hLGgoKX1jYXRjaChkKXtnKGQpfX1mdW5jdGlvbiBnKGEpe2k9ITEsaj1hLGgoKX1mdW5jdGlvbiBoKCl7Zm9yKHZhciBhPTAsYz1rLmxlbmd0aDtjPmE7YSsrKWIoa1thXSk7az1udWxsfWlmKCJvYmplY3QiIT10eXBlb2YgdGhpcyl0aHJvdyBuZXcgVHlwZUVycm9yKCJQcm9taXNlcyBtdXN0IGJlIGNvbnN0cnVjdGVkIHZpYSBuZXciKTtpZigiZnVuY3Rpb24iIT10eXBlb2YgYSl0aHJvdyBuZXcgVHlwZUVycm9yKCJub3QgYSBmdW5jdGlvbiIpO3ZhciBpPW51bGwsaj1udWxsLGs9W10sbD10aGlzO3RoaXMudGhlbj1mdW5jdGlvbihhLGMpe3JldHVybiBuZXcgbC5jb25zdHJ1Y3RvcihmdW5jdGlvbihlLGYpe2IobmV3IGQoYSxjLGUsZikpfSl9LGUoYSxjLGcpfWZ1bmN0aW9uIGQoYSxiLGMsZCl7dGhpcy5vbkZ1bGZpbGxlZD0iZnVuY3Rpb24iPT10eXBlb2YgYT9hOm51bGwsdGhpcy5vblJlamVjdGVkPSJmdW5jdGlvbiI9PXR5cGVvZiBiP2I6bnVsbCx0aGlzLnJlc29sdmU9Yyx0aGlzLnJlamVjdD1kfWZ1bmN0aW9uIGUoYSxiLGMpe3ZhciBkPSExO3RyeXthKGZ1bmN0aW9uKGEpe2R8fChkPSEwLGIoYSkpfSxmdW5jdGlvbihhKXtkfHwoZD0hMCxjKGEpKX0pfWNhdGNoKGUpe2lmKGQpcmV0dXJuO2Q9ITAsYyhlKX19dmFyIGY9YSgiYXNhcCIpO2IuZXhwb3J0cz1jfSx7YXNhcDo5Mn1dLDkxOltmdW5jdGlvbihhLGIpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBjKGEpe3RoaXMudGhlbj1mdW5jdGlvbihiKXtyZXR1cm4iZnVuY3Rpb24iIT10eXBlb2YgYj90aGlzOm5ldyBkKGZ1bmN0aW9uKGMsZCl7ZShmdW5jdGlvbigpe3RyeXtjKGIoYSkpfWNhdGNoKGUpe2QoZSl9fSl9KX19dmFyIGQ9YSgiLi9jb3JlLmpzIiksZT1hKCJhc2FwIik7Yi5leHBvcnRzPWQsYy5wcm90b3R5cGU9ZC5wcm90b3R5cGU7dmFyIGY9bmV3IGMoITApLGc9bmV3IGMoITEpLGg9bmV3IGMobnVsbCksaT1uZXcgYyh2b2lkIDApLGo9bmV3IGMoMCksaz1uZXcgYygiIik7ZC5yZXNvbHZlPWZ1bmN0aW9uKGEpe2lmKGEgaW5zdGFuY2VvZiBkKXJldHVybiBhO2lmKG51bGw9PT1hKXJldHVybiBoO2lmKHZvaWQgMD09PWEpcmV0dXJuIGk7aWYoYT09PSEwKXJldHVybiBmO2lmKGE9PT0hMSlyZXR1cm4gZztpZigwPT09YSlyZXR1cm4gajtpZigiIj09PWEpcmV0dXJuIGs7aWYoIm9iamVjdCI9PXR5cGVvZiBhfHwiZnVuY3Rpb24iPT10eXBlb2YgYSl0cnl7dmFyIGI9YS50aGVuO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBiKXJldHVybiBuZXcgZChiLmJpbmQoYSkpfWNhdGNoKGUpe3JldHVybiBuZXcgZChmdW5jdGlvbihhLGIpe2IoZSl9KX1yZXR1cm4gbmV3IGMoYSl9LGQuYWxsPWZ1bmN0aW9uKGEpe3ZhciBiPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGEpO3JldHVybiBuZXcgZChmdW5jdGlvbihhLGMpe2Z1bmN0aW9uIGQoZixnKXt0cnl7aWYoZyYmKCJvYmplY3QiPT10eXBlb2YgZ3x8ImZ1bmN0aW9uIj09dHlwZW9mIGcpKXt2YXIgaD1nLnRoZW47aWYoImZ1bmN0aW9uIj09dHlwZW9mIGgpcmV0dXJuIHZvaWQgaC5jYWxsKGcsZnVuY3Rpb24oYSl7ZChmLGEpfSxjKX1iW2ZdPWcsMD09PS0tZSYmYShiKX1jYXRjaChpKXtjKGkpfX1pZigwPT09Yi5sZW5ndGgpcmV0dXJuIGEoW10pO2Zvcih2YXIgZT1iLmxlbmd0aCxmPTA7Yi5sZW5ndGg+ZjtmKyspZChmLGJbZl0pfSl9LGQucmVqZWN0PWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZChmdW5jdGlvbihiLGMpe2MoYSl9KX0sZC5yYWNlPWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgZChmdW5jdGlvbihiLGMpe2EuZm9yRWFjaChmdW5jdGlvbihhKXtkLnJlc29sdmUoYSkudGhlbihiLGMpfSl9KX0sZC5wcm90b3R5cGVbImNhdGNoIl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMudGhlbihudWxsLGEpfX0seyIuL2NvcmUuanMiOjkwLGFzYXA6OTJ9XSw5MjpbZnVuY3Rpb24oYSxiKXsoZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYygpe2Zvcig7ZS5uZXh0Oyl7ZT1lLm5leHQ7dmFyIGE9ZS50YXNrO2UudGFzaz12b2lkIDA7dmFyIGI9ZS5kb21haW47YiYmKGUuZG9tYWluPXZvaWQgMCxiLmVudGVyKCkpO3RyeXthKCl9Y2F0Y2goZCl7aWYoaSl0aHJvdyBiJiZiLmV4aXQoKSxzZXRUaW1lb3V0KGMsMCksYiYmYi5lbnRlcigpLGQ7c2V0VGltZW91dChmdW5jdGlvbigpe3Rocm93IGR9LDApfWImJmIuZXhpdCgpfWc9ITF9ZnVuY3Rpb24gZChiKXtmPWYubmV4dD17dGFzazpiLGRvbWFpbjppJiZhLmRvbWFpbixuZXh0Om51bGx9LGd8fChnPSEwLGgoKSl9dmFyIGU9e3Rhc2s6dm9pZCAwLG5leHQ6bnVsbH0sZj1lLGc9ITEsaD12b2lkIDAsaT0hMTtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGEmJmEubmV4dFRpY2spaT0hMCxoPWZ1bmN0aW9uKCl7YS5uZXh0VGljayhjKX07ZWxzZSBpZigiZnVuY3Rpb24iPT10eXBlb2Ygc2V0SW1tZWRpYXRlKWg9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/c2V0SW1tZWRpYXRlLmJpbmQod2luZG93LGMpOmZ1bmN0aW9uKCl7c2V0SW1tZWRpYXRlKGMpfTtlbHNlIGlmKCJ1bmRlZmluZWQiIT10eXBlb2YgTWVzc2FnZUNoYW5uZWwpe3ZhciBqPW5ldyBNZXNzYWdlQ2hhbm5lbDtqLnBvcnQxLm9ubWVzc2FnZT1jLGg9ZnVuY3Rpb24oKXtqLnBvcnQyLnBvc3RNZXNzYWdlKDApfX1lbHNlIGg9ZnVuY3Rpb24oKXtzZXRUaW1lb3V0KGMsMCl9O2IuZXhwb3J0cz1kfSkuY2FsbCh0aGlzLGEoIl9wcm9jZXNzIikpfSx7X3Byb2Nlc3M6ODl9XSw5MzpbZnVuY3Rpb24oKXsiZnVuY3Rpb24iIT10eXBlb2YgUHJvbWlzZS5wcm90b3R5cGUuZG9uZSYmKFByb21pc2UucHJvdG90eXBlLmRvbmU9ZnVuY3Rpb24oKXt2YXIgYT1hcmd1bWVudHMubGVuZ3RoP3RoaXMudGhlbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dGhpczthLnRoZW4obnVsbCxmdW5jdGlvbihhKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dGhyb3cgYX0sMCl9KX0pfSx7fV0sOTQ6W2Z1bmN0aW9uKGEpe2EoImFzYXAiKTsidW5kZWZpbmVkIj09dHlwZW9mIFByb21pc2UmJihQcm9taXNlPWEoIi4vbGliL2NvcmUuanMiKSxhKCIuL2xpYi9lczYtZXh0ZW5zaW9ucy5qcyIpKSxhKCIuL3BvbHlmaWxsLWRvbmUuanMiKX0seyIuL2xpYi9jb3JlLmpzIjo5MCwiLi9saWIvZXM2LWV4dGVuc2lvbnMuanMiOjkxLCIuL3BvbHlmaWxsLWRvbmUuanMiOjkzLGFzYXA6OTJ9XX0se30sWzJdKSgyKX0pOw=="},"pattern.js": {"content_type": "text/javascript","data": "LyptYXRjaGVzLmpzIDAuNS4xIG1vZCovCiFmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBhKGEpe3ZhciBkPW5ldyBiKGEpLGU9YyhkKTtyZXR1cm4gZX1mdW5jdGlvbiBiKGEpe3RoaXMuaW5wdXQ9YSx0aGlzLmJ1ZmZlcj1hLHRoaXMucG9zPTB9ZnVuY3Rpb24gYyhhKXt2YXIgYj1kKGEuc2tpcFdzKCkpO3JldHVybiBhLnNraXBXcygpLmJ1ZmZlciYmZGIoYSksYn1mdW5jdGlvbiBkKGEpe3JldHVybiBNKGUoYSkpfWZ1bmN0aW9uIGUoYSl7cmV0dXJuIHkoZixhLHooKSl9ZnVuY3Rpb24gZihhKXtyZXR1cm4gaChhKXx8ZyhhKX1mdW5jdGlvbiBnKGEpe3JldHVybiBpKGEpfHxqKGEpfHxrKGEpfHxsKGEpfHxtKGEpfHxuKGEpfHxvKGEpfHxwKGEpfHxxKGEpfHxyKGEpfHx2KGEpfWZ1bmN0aW9uIGgoYSl7dmFyIGI9YS50YWtlQVBlZWsoIi4uLiIpO3JldHVybiBiP04oZyhhKXx8TygpKTp2b2lkIDB9ZnVuY3Rpb24gaShhKXtyZXR1cm4gYS50YWtlQVBlZWsoIl8iKT9PKCk6dm9pZCAwfWZ1bmN0aW9uIGooYSl7cmV0dXJuIGEudGFrZUFQZWVrKEViKT9QKCk6dm9pZCAwfWZ1bmN0aW9uIGsoYSl7cmV0dXJuIGEudGFrZUFQZWVrKERiKT9RKCk6dm9pZCAwfWZ1bmN0aW9uIGwoYSl7dmFyIGI9YS50YWtlQVBlZWsoRmIpO3JldHVybiBiP1IoYlswXSk6dm9pZCAwfWZ1bmN0aW9uIG0oYSl7dmFyIGI9SChhKTtyZXR1cm4gYj9TKGIpOnZvaWQgMH1mdW5jdGlvbiBuKGEpe3ZhciBiPUEoYSk7cmV0dXJuIGI/VChiKTp2b2lkIDB9ZnVuY3Rpb24gbyhhKXt2YXIgYj1hLnRha2VBUGVlayhJYik7aWYoYil7dmFyIGM9YlswXSxkPXIoYSk7cmV0dXJuIGQ/JChjLGQpOihkPXgoIigiLCIpIixlLFUsYSksZD8kKGMsZCk6JChjKSl9fWZ1bmN0aW9uIHAoYSl7ZnVuY3Rpb24gYihhKXtyZXR1cm4gXyhjWzFdLGEpfXZhciBjPWEudGFrZUFQZWVrKEpiKTtyZXR1cm4gYz94KCIoIiwiKSIsZyxiLGEpfHxfKGNbMV0pOnZvaWQgMH1mdW5jdGlvbiBxKGEpe3JldHVybiB4KCJbIiwiXSIsZSxVLGEpfWZ1bmN0aW9uIHIoYSl7cmV0dXJuIHgoInsiLCJ9IixzLFYsYSl9ZnVuY3Rpb24gcyhhKXtyZXR1cm4geSh0LGEpfWZ1bmN0aW9uIHQoYSl7dmFyIGI9dShhKTtpZihiKXtpZihhLnNraXBXcygpLnRha2VBUGVlaygiOiIpKXt2YXIgYz1nKGEuc2tpcFdzKCkpO2lmKGMpcmV0dXJuIFooYixjKX1yZXR1cm4gWShiKX19ZnVuY3Rpb24gdShhKXt2YXIgYj1BKGEpO2lmKGIpcmV0dXJuIGI7dmFyIGM9YS50YWtlQVBlZWsoSGIpO3JldHVybiBjP2NbMF06dm9pZCAwfWZ1bmN0aW9uIHYoYSl7dmFyIGI9YS50YWtlQVBlZWsoR2IpO2lmKGIpe2lmKGEudGFrZUFQZWVrKCJAIikpe3ZhciBjPXcoYSk7aWYoYylyZXR1cm4gVyhiWzBdLGMpfXJldHVybiBYKGJbMF0pfX1mdW5jdGlvbiB3KGEpe3JldHVybiBvKGEpfHxxKGEpfHxyKGEpfWZ1bmN0aW9uIHgoYSxiLGMsZCxlKXtpZihlLnRha2VBUGVlayhhKSl7dmFyIGY9YyhlLnNraXBXcygpKTtpZihlLnNraXBXcygpLnRha2VBUGVlayhiKSlyZXR1cm4gZChmKTtkYihlLCJFeHBlY3RlZCAiK2IpfX1mdW5jdGlvbiB5KGEsYixjKXtmb3IodmFyIGQsZT1bXTs7KXtpZihkPWEoYiksIShkJiYhY3x8ZCYmYyhkLGIpKSlicmVhaztpZihlLnB1c2goZCksIWIuc2tpcFdzKCkudGFrZUFQZWVrKCIsIikpYnJlYWs7Yi5za2lwV3MoKX1yZXR1cm4gZX1mdW5jdGlvbiB6KCl7dmFyIGE9MDtyZXR1cm4gZnVuY3Rpb24oYixjKXtyZXR1cm4icmVzdCI9PT1iLnR5cGUmJisrYT4xJiYoYy5wdXQoYi5wYXR0ZXJuKSxkYihjLCJNdWx0aXBsZSAuLi4ncyBub3QgYWxsb3dlZCIpKSwhMH19ZnVuY3Rpb24gQShhKXtyZXR1cm4gQignIicsS2IsYSl8fEIoIiciLExiLGEpfWZ1bmN0aW9uIEIoYSxiLGMpe2lmKGMudGFrZUFQZWVrKGEpKXt2YXIgZD1DKGIsYyk7aWYoYy50YWtlQVBlZWsoYSkpcmV0dXJuIGQ7ZGIoYywiRXhwZWN0ZWQgIithKX19ZnVuY3Rpb24gQyhhLGIpe2Zvcih2YXIgYz0iIjs7KXt2YXIgZD1iLnRha2VBUGVlayhhKTtpZihkKWMrPWQ7ZWxzZXtpZighYi5wZWVrKCJcXCIpKWJyZWFrO2lmKGQ9RChiKSwhZClicmVhaztjKz1kfX1yZXR1cm4gY31mdW5jdGlvbiBEKGEpe3JldHVybiBFKGEpfHxGKFFiLGEpfHxGKFBiLGEpfHxHKGEpfWZ1bmN0aW9uIEUoYSl7cmV0dXJuIGEudGFrZUFQZWVrKE9iKT8iXHgwMCI6dm9pZCAwfWZ1bmN0aW9uIEYoYSxiKXt2YXIgYz1iLnRha2VBUGVlayhhKTtyZXR1cm4gYz9TdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KCIweCIrY1sxXSkpOnZvaWQgMH1mdW5jdGlvbiBHKGEpe3ZhciBiPWEudGFrZUFQZWVrKE5iKTtyZXR1cm4gYj9iWzFdLnJlcGxhY2UoImIiLCJcYiIpLnJlcGxhY2UoImYiLCJcZiIpLnJlcGxhY2UoIm4iLCJcbiIpLnJlcGxhY2UoInIiLCJcciIpLnJlcGxhY2UoInQiLCIJIikucmVwbGFjZSgidiIsIgsiKTooYj1hLnRha2VBUGVlayhNYiksYj9iWzFdOnZvaWQgMCl9ZnVuY3Rpb24gSChhKXt2YXIgYj0iIjthLnRha2VBUGVlaygiLSIpJiYoYis9Ii0iKTt2YXIgYz1LKGEpO3JldHVybiBjJiYoYis9YyksYz1JKGEpLGMmJihiKz1jKSxiJiYiLSIhPT1iJiYoYz1KKGEpLGMmJihiKz1jKSksIi0iPT09YiYmZGIoYSwiRXhwZWN0ZWQgbnVtYmVyIiksYnx8bnVsbH1mdW5jdGlvbiBJKGEpe2lmKGEudGFrZUFQZWVrKCIuIikpe3ZhciBiPWEudGFrZUFQZWVrKFRiKTtpZihiKXJldHVybiIuIitiO2RiKGEsIkV4cGVjdGVkIGRpZ2l0Iil9fWZ1bmN0aW9uIEooYSl7dmFyIGI9YS50YWtlQVBlZWsoUmIpO2lmKGIpe3ZhciBjPWEudGFrZUFQZWVrKFRiKTtpZihjKXJldHVybiBiWzBdK2N9fWZ1bmN0aW9uIEsoYSl7cmV0dXJuIGEudGFrZUFQZWVrKFNiKXx8YS50YWtlQVBlZWsoVWIpfWZ1bmN0aW9uIEwoYSxiLGMsZCl7dmFyIGU9e3BhdHRlcm46Yix0eXBlOmF9O3JldHVybiB2b2lkIDAhPT1jJiYoZS52YWx1ZT1jKSx2b2lkIDAhPT1kJiYoZS5jaGlsZHJlbj1kKSxlfWZ1bmN0aW9uIE0oYSl7cmV0dXJuIEwoImFyZ3VtZW50TGlzdCIsYWIoYSkuam9pbigiLCIpLHZvaWQgMCxhKX1mdW5jdGlvbiBOKGEpe3JldHVybiBMKCJyZXN0IiwiLi4uIithLnBhdHRlcm4sdm9pZCAwLFthXSl9ZnVuY3Rpb24gTygpe3JldHVybiBMKCJ3aWxkY2FyZCIsIl8iKX1mdW5jdGlvbiBQKCl7cmV0dXJuIEwoIm51bGwiLCJudWxsIil9ZnVuY3Rpb24gUSgpe3JldHVybiBMKCJ1bmRlZmluZWQiLCJ1bmRlZmluZWQiKX1mdW5jdGlvbiBSKGEpe3JldHVybiBMKCJib29sZWFuIixhLCJ0cnVlIj09PWEpfWZ1bmN0aW9uIFMoYSl7cmV0dXJuIEwoIm51bWJlciIsYSxwYXJzZUZsb2F0KGEpKX1mdW5jdGlvbiBUKGEpe3JldHVybiBMKCJzdHJpbmciLGJiKGEpLGEpfWZ1bmN0aW9uIFUoYSl7cmV0dXJuIEwoImFycmF5IiwiWyIrYWIoYSkuam9pbigiLCIpKyJdIix2b2lkIDAsYSl9ZnVuY3Rpb24gVihhKXtyZXR1cm4gTCgib2JqZWN0IiwieyIrYWIoYSkuam9pbigiLCIpKyJ9Iix2b2lkIDAsYSl9ZnVuY3Rpb24gVyhhLGIpe3JldHVybiBMKCJiaW5kZXIiLGErIkAiK2IucGF0dGVybixhLFtiXSl9ZnVuY3Rpb24gWChhKXtyZXR1cm4gTCgiaWRlbnRpZmllciIsYSxhKX1mdW5jdGlvbiBZKGEpe3JldHVybiBhPWJiKGEpLEwoImtleSIsYSxhKX1mdW5jdGlvbiBaKGEsYil7cmV0dXJuIGE9YmIoYSksTCgia2V5VmFsdWUiLGErIjoiK2IucGF0dGVybixhLFtiXSl9ZnVuY3Rpb24gJChhLGIpe3ZhciBjPWE7cmV0dXJuIGImJihjKz0iYXJyYXkiPT09Yi50eXBlPyIoIitiLnBhdHRlcm4uc3Vic3RyaW5nKDEsYi5wYXR0ZXJuLmxlbmd0aC0xKSsiKSI6Yi5wYXR0ZXJuKSxMKCJjbGFzcyIsYyxhLGI/W2JdOnZvaWQgMCl9ZnVuY3Rpb24gXyhhLGIpe3JldHVybiBiP0woImV4dHJhY3RvciIsIiQiK2ErIigiK2IucGF0dGVybisiKSIsYSxbYl0pOkwoImV4dHJhY3RvciIsIiQiK2EsYSl9ZnVuY3Rpb24gYWIoYSl7cmV0dXJuIGEubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLnBhdHRlcm59KX1mdW5jdGlvbiBiYihhKXtyZXR1cm4nIicrYS5yZXBsYWNlKC9cXC9nLCJcXFxcIikucmVwbGFjZSgvIi9nLCdcXCInKS5yZXBsYWNlKC9ceDA4L2csIlxcYiIpLnJlcGxhY2UoL1x0L2csIlxcdCIpLnJlcGxhY2UoL1xuL2csIlxcbiIpLnJlcGxhY2UoL1xmL2csIlxcZiIpLnJlcGxhY2UoL1xyL2csIlxcciIpLnJlcGxhY2UoL1tceDAwLVx4MDdceDBCXHgwRS1ceDFGXHg4MC1cdUZGRkZdL2csY2IpKyciJ31mdW5jdGlvbiBjYihhKXt2YXIgYixjLGQ9YS5jaGFyQ29kZUF0KDApOzI1NT49ZD8oYj0ieCIsYz0yKTooYj0idSIsYz00KTt2YXIgZT1kLnRvU3RyaW5nKDE2KTtyZXR1cm4iXFwiK2IrQXJyYXkoYy1lLmxlbmd0aCkuam9pbigiMCIpK2V9ZnVuY3Rpb24gZGIoYSxiKXt0aHJvdyBifHwoYj0iVW5leHBlY3RlZCBjaGFyYWN0ZXIiKSxiKz0iIGF0IGNvbHVtbiAiKyhhLnBvcysxKSxuZXcgU3ludGF4RXJyb3IoYisiXG4iK2EuaW5wdXQrIlxuIitBcnJheShhLmlucHV0Lmxlbmd0aC1hLmJ1ZmZlci5sZW5ndGgrMSkuam9pbigiICIpKyJeIil9ZnVuY3Rpb24gZWIoYil7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBiJiYoYj1hKGIpKSxuZXcgRnVuY3Rpb24oWyJhcmdzIiwicnVudCJdLFsidmFyIHJldCA9IFtdOyIsZmIoYiksInJldHVybiByZXQ7Il0uam9pbigiXG4iKSl9ZnVuY3Rpb24gZmIoYSl7cmV0dXJuIGxiKCJhcmdzIixhKX1mdW5jdGlvbiBnYihhLGIpe3JldHVybiBWYltiLnR5cGVdKGEsYil9ZnVuY3Rpb24gaGIoKXtyZXR1cm4iIn1mdW5jdGlvbiBpYihhLGIpe3JldHVybiJpZiAoIithKyIgIT09ICIrYi5wYXR0ZXJuKyIpIHJldHVybiBmYWxzZTsifWZ1bmN0aW9uIGpiKGEpe3JldHVybiJyZXRbcmV0Lmxlbmd0aF0gPSAiK2ErIjsifWZ1bmN0aW9uIGtiKGEsYil7dmFyIGM9W2piKGEpLGdiKGEsYi5jaGlsZHJlblswXSldO3JldHVybiBjLmpvaW4oIlxuIil9ZnVuY3Rpb24gbGIoYSxiKXtyZXR1cm4gc2IoYik/bmIoYSxiKTptYihhLGIpfWZ1bmN0aW9uIG1iKGEsYil7Zm9yKHZhciBjLGQ9Yi5jaGlsZHJlbi5sZW5ndGgsZT1bImlmICghKCIrYSsiIGluc3RhbmNlb2YgQXJyYXkpIHx8ICIrYSsiLmxlbmd0aCAhPT0gIitkKyIpIHJldHVybiBmYWxzZTsiXSxmPTAsZz1iLmNoaWxkcmVuLmxlbmd0aDtnPmY7ZisrKWM9YSsiXyIrZixlLnB1c2goInZhciAiK2MrIiA9ICIrYSsiWyIrZisiXTsiLGdiKGMsYi5jaGlsZHJlbltmXSkpO3JldHVybiBlLmpvaW4oIlxuIil9ZnVuY3Rpb24gbmIoYSxiKXtmb3IodmFyIGMsZCxlLGY9Yi5jaGlsZHJlbi5sZW5ndGgsZz1mLTEsaD1hKyJfcG9zIixpPWErIl9yZXN0IixqPVsiaWYgKCEoIithKyIgaW5zdGFuY2VvZiBBcnJheSkgfHwiK2ErIi5sZW5ndGggPCAiK2crIikgcmV0dXJuIGZhbHNlOyIsInZhciAiK2grIiA9IDA7IiwidmFyICIraSsiOyJdLGs9MCxsPWIuY2hpbGRyZW4ubGVuZ3RoO2w+aztrKyspZD1iLmNoaWxkcmVuW2tdLGM9YSsiXyIraywicmVzdCI9PT1kLnR5cGU/KGs9PT1nP2oucHVzaChpKyIgPSAiK2ErIi5zbGljZSgiK2srIik7Iik6MD09PWs/ai5wdXNoKGgrIiA9ICIrYSsiLmxlbmd0aCAtICIrZysiOyIsaSsiID0gIithKyIuc2xpY2UoMCwgIitoKyIpOyIpOmoucHVzaChoKyIgPSAiK2ErIi5sZW5ndGggLSAiKyhnLWspKyI7IixpKyIgPSAiK2ErIi5zbGljZSgiK2srIiwgIitoKyIpOyIpLGU9ZC5jaGlsZHJlblswXS50eXBlLCJpZGVudGlmaWVyIj09PWU/ai5wdXNoKGpiKGkpKToid2lsZGNhcmQiIT09ZSYmai5wdXNoKHJiKGksZCkpKTpqLnB1c2goInZhciAiK2MrIiA9ICIrYSsiWyIraCsiKytdOyIsZ2IoYyxkKSk7cmV0dXJuIGouam9pbigiXG4iKX1mdW5jdGlvbiBvYihhLGIpe2Zvcih2YXIgYyxkLGU9WyJpZiAoISgiK2ErIiBpbnN0YW5jZW9mIE9iamVjdCkpIHJldHVybiBmYWxzZTsiXSxmPTAsZz1iLmNoaWxkcmVuLmxlbmd0aDtnPmY7ZisrKWQ9Yi5jaGlsZHJlbltmXSxjPWErIl8iK2YsZS5wdXNoKCJpZiAoISgiK2QudmFsdWUrIiBpbiAiK2ErIikpIHJldHVybiBmYWxzZTsiKSwia2V5Ij09PWQudHlwZT9lLnB1c2goamIoYSsiWyIrZC52YWx1ZSsiXSIpKTplLnB1c2goInZhciAiK2MrIiA9ICIrYSsiWyIrZC52YWx1ZSsiXTsiLGdiKGMsZC5jaGlsZHJlblswXSkpO3JldHVybiBlLmpvaW4oIlxuIil9ZnVuY3Rpb24gcGIoYSxiKXt2YXIgYz1bImlmICghcnVudC5tYXRjaGVzVHlwZU5hbWUoIithKycsICInK2IudmFsdWUrJyIpKSByZXR1cm4gZmFsc2U7J107aWYoYi5jaGlsZHJlbil7dmFyIGQ9ImFycmF5Ij09PWIuY2hpbGRyZW5bMF0udHlwZSxlPWQ/InVuYXBwbHkiOiJ1bmFwcGx5T2JqIixmPWQ/bGI6b2IsZz1hKyJfdmFscyI7Yy5wdXNoKCJpZiAoISIrYSsiLmNvbnN0cnVjdG9yIHx8ICEiK2ErIi5jb25zdHJ1Y3Rvci4iK2UrIikgcmV0dXJuIGZhbHNlOyIsInZhciAiK2crIiA9ICIrYSsiLmNvbnN0cnVjdG9yLiIrZSsiKCIrYSsiKTsiLGYoZyxiLmNoaWxkcmVuWzBdKSl9cmV0dXJuIGMuam9pbigiXG4iKX1mdW5jdGlvbiBxYihhLGIpe3ZhciBjPWErIl9leHQiLGQ9YSsiX3ZhbCIsZT1bInZhciAiK2MrJyA9IHJ1bnQuY2FsbEV4dHJhY3RvcigiJytiLnZhbHVlKyciLCAnK2ErIik7IiwiaWYgKCEiK2MrIiB8fCAhKCIrYysiIGluc3RhbmNlb2YgcnVudC5QYXNzKSkgcmV0dXJuIGZhbHNlOyJdO3JldHVybiBiLmNoaWxkcmVuJiYoZS5wdXNoKCJ2YXIgIitkKyIgPSAiK2MrIi52YWw7IiksZS5wdXNoKGdiKGQsYi5jaGlsZHJlblswXSkpKSxlLmpvaW4oIlxuIil9ZnVuY3Rpb24gcmIoYSxiKXtmb3IodmFyIGM9W10sZD1bXSxlPTAsZj10YihiKTtmPmU7ZSsrKWQucHVzaCgiW10iKTt2YXIgZz1hKyJfcmV0IixoPWErIl9sb29wIixpPWErIl9pIixqPWErIl9sZW4iLGs9YSsiX3JldGFyZ3MiO3JldHVybiBjLnB1c2goInZhciAiK2crIiA9IFsiK2Quam9pbigiLCIpKyJdOyIsInZhciAiK2grIiA9IGZ1bmN0aW9uICh2YWwpIHsiLCIgIHZhciByZXQgPSBbXTsiLHViKDIsZ2IoInZhbCIsYi5jaGlsZHJlblswXSkpLCIgIHJldHVybiByZXQ7IiwifTsiLCJ2YXIgIitpKyIgPSAwLCAiK2orIiA9ICIrYSsiLmxlbmd0aCwgIitrKyI7IiwiZm9yICg7ICIraSsiIDwgIitqKyI7ICIraSsiKyspIHsiLCIgICIraysiID0gIitoKyIoIithKyJbIitpKyJdKTsiLCIgIGlmICghIitrKyIpIHJldHVybiBmYWxzZTsiLGZ1bmN0aW9uKCl7dmFyIGE9W107Zm9yKGU9MDtmPmU7ZSsrKWEucHVzaCgiICAiK2crIlsiK2UrIl0ucHVzaCgiK2srIlsiK2UrIl0pOyIpO3JldHVybiBhLmpvaW4oIlxuIil9KCksIn0iLCJyZXQgPSBBcnJheS5wcm90b3R5cGUuY29uY2F0LmNhbGwocmV0LCAiK2crIik7IiksYy5qb2luKCJcbiIpfWZ1bmN0aW9uIHNiKGEpe2Zvcih2YXIgYixjPTA7Yj1hLmNoaWxkcmVuW2NdO2MrKylpZigicmVzdCI9PT1iLnR5cGUpcmV0dXJuITA7cmV0dXJuITF9ZnVuY3Rpb24gdGIoYSl7aWYoIWEuY2hpbGRyZW4pcmV0dXJuIDA7Zm9yKHZhciBiLGM9MCxkPTAsZT1hLmNoaWxkcmVuLmxlbmd0aDtlPmQ7ZCsrKWI9YS5jaGlsZHJlbltkXS50eXBlLGMrPSJpZGVudGlmaWVyIj09PWJ8fCJiaW5kZXIiPT09Ynx8ImtleSI9PT1iPzE6dGIoYS5jaGlsZHJlbltkXSk7cmV0dXJuIGN9ZnVuY3Rpb24gdWIoYSxiKXtyZXR1cm4gYi5yZXBsYWNlKC9eL2dtLEFycmF5KGErMSkuam9pbigiICIpKX1mdW5jdGlvbiB2YihhLGIsYyl7dGhpcy5wYXR0ZXJuRm49YSx0aGlzLnN1Y2Nlc3NGbj1iLHRoaXMubmV4dD1jfWZ1bmN0aW9uIHdiKGIpe3ZhciBjLGQ7cmV0dXJuIFpiLmhhc093blByb3BlcnR5KGIpfHwoYz1hKGIpLCRiLmhhc093blByb3BlcnR5KGMucGF0dGVybil8fChkPWViKGMpLGQucGF0dGVybj1jLnBhdHRlcm4sJGJbYy5wYXR0ZXJuXT1kKSxaYltiXT0kYltjLnBhdHRlcm5dKSxaYltiXX1mdW5jdGlvbiB4Yigpe3t2YXIgYSxiLGMsZCxlLGYsZyxoPXR5cGVvZiBhcmd1bWVudHNbMF0saT10eXBlb2YgYXJndW1lbnRzWzFdO3R5cGVvZiBhcmd1bWVudHNbMl19aWYoImZ1bmN0aW9uIiE9aHx8InVuZGVmaW5lZCIhPWkmJiJvYmplY3QiIT1pKXtpZigib2JqZWN0IiE9aHx8InVuZGVmaW5lZCIhPWkmJiJvYmplY3QiIT1pKXJldHVybiJmdW5jdGlvbiI9PWgmJiJmdW5jdGlvbiI9PWk/KGY9YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXS5jbG9uZSgpOm51bGwseWIoYXJndW1lbnRzWzBdLGFyZ3VtZW50c1sxXSxmKSk6KGQ9YXJndW1lbnRzWzBdLGU9YXJndW1lbnRzWzFdLGY9YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXS5jbG9uZSgpOm51bGwsYz13YihkKSx5YihjLGUsZikpO2I9YXJndW1lbnRzWzBdLGY9YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXS5jbG9uZSgpOm51bGw7Zm9yKGQgaW4gYilhPXhiKGQsYltkXSxmKSxmPWEuX19tYXRjaENoYWluO3JldHVybiBhfWlmKGE9YXJndW1lbnRzWzBdLGY9YXJndW1lbnRzWzFdLCFhLl9fbWF0Y2hDaGFpbil0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIG1hdGNoZXIgZnVuY3Rpb24iKTtyZXR1cm4gZj8oZj1mLmNsb25lKCksZi5sYXN0KCkubmV4dD1hLl9fbWF0Y2hDaGFpbi5jbG9uZSgpKTpmPWEuX19tYXRjaENoYWluLmNsb25lKCksZz1mLnBvcCgpLHliKGcucGF0dGVybkZuLGcuc3VjY2Vzc0ZuLGYpfWZ1bmN0aW9uIHliKGEsYixjKXt2YXIgZD1uZXcgdmIoYSxiKTtjP2MubGFzdCgpLm5leHQ9ZDpjPWQ7dmFyIGU9ZnVuY3Rpb24oKXtmb3IodmFyIGE9W10sYj0wLGQ9YXJndW1lbnRzLmxlbmd0aDtkPmI7YisrKWFbYl09YXJndW1lbnRzW2JdO3JldHVybiBjLm1hdGNoKGEsdGhpcyl9O3JldHVybiBlLmFsdD1mdW5jdGlvbigpe3ZhciBhPVliLmNhbGwoYXJndW1lbnRzKTtyZXR1cm4gYS5wdXNoKGMpLHhiLmFwcGx5KG51bGwsYSl9LGUuX19tYXRjaENoYWluPWMsZX1mdW5jdGlvbiB6Yigpe3ZhciBhPVliLmNhbGwoYXJndW1lbnRzLDAsLTEpLGI9YXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGgtMV0sYz10aGlzPT09ZXhwb3J0cz9udWxsOnRoaXM7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGIpe2lmKCFiLl9fbWF0Y2hDaGFpbil0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIG1hdGNoZXIgZnVuY3Rpb24iKTtyZXR1cm4gYi5hcHBseShjLGEpfXJldHVybiB4YihiKS5hcHBseShjLGEpfWZ1bmN0aW9uIEFiKCl7dmFyIGE9WWIuY2FsbChhcmd1bWVudHMsMSksYj10aGlzPT09ZXhwb3J0cz9udWxsOnRoaXMsYz13Yihhcmd1bWVudHNbMF0pO3JldHVybiBjLmNhbGwoYixhLFdiKXx8bnVsbH1mdW5jdGlvbiBCYigpe3ZhciBhPUFiLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbnVsbD09PWE/dm9pZCAwOmFbMF19ZnVuY3Rpb24gQ2IoYSl7ZnVuY3Rpb24gYihhKXt2YXIgYyxkLGU9e30sZj1udWxsO2ZvcihjIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShjKSlpZihkPWFbY10sZCBpbnN0YW5jZW9mIEFycmF5KWY9ZVtjXT1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYX19KGRbMF0pO2Vsc2UgaWYoInN0cmluZyI9PXR5cGVvZiBkKXtpZighZVtkXSl0aHJvdyBuZXcgU3ludGF4RXJyb3IoYVtkXT8iRWFybHkgcmVmZXJlbmNlICIrZCsiIGluIHJ1bGUgIitjOiJJbnZhbGlkIHJlZmVyZW5jZSAiK2QrIiBpbiBydWxlICIrYyk7Zj1lW2NdPWVbZF19ZWxzZSBpZigiZnVuY3Rpb24iPT10eXBlb2YgZClmPWVbY109ZDtlbHNlIGlmKCEwPT09ZCl7aWYobnVsbD09PWYpdGhyb3cgbmV3IFN5bnRheEVycm9yKCJObyBwcmVjZWRpbmcgcnVsZSBmb3IgcnVsZSAiK2MpO2VbY109Zn1lbHNlITE9PT1kfHxudWxsPT09ZD9mPWVbY109ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbH06ZCE9PU9iamVjdChkKXx8ZCBpbnN0YW5jZW9mIEFycmF5fHxkIGluc3RhbmNlb2YgUmVnRXhwfHwoZj1lW2NdPWIoZCkpO3JldHVybiB4YihlKX1yZXR1cm4gYihhKX1iLnByb3RvdHlwZS50YWtlPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYnVmZmVyLnN1YnN0cigwLGEpO3JldHVybiB0aGlzLmJ1ZmZlcj10aGlzLmJ1ZmZlci5zdWJzdHJpbmcoYSksdGhpcy5wb3MrPWIubGVuZ3RoLGJ9LGIucHJvdG90eXBlLnBlZWs9ZnVuY3Rpb24oYSl7cmV0dXJuIGEgaW5zdGFuY2VvZiBSZWdFeHA/dGhpcy5idWZmZXIubWF0Y2goYSk6dGhpcy5idWZmZXIuc3Vic3RyKDAsYS5sZW5ndGgpPT09YT9hOm51bGx9LGIucHJvdG90eXBlLnRha2VBUGVlaz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLnBlZWsoYSk7cmV0dXJuIGI/KHRoaXMudGFrZSgoYSBpbnN0YW5jZW9mIFJlZ0V4cD9iWzBdOmIpLmxlbmd0aCksYik6dm9pZCAwfSxiLnByb3RvdHlwZS5za2lwV3M9ZnVuY3Rpb24oKXtmb3IoO3RoaXMudGFrZUFQZWVrKCIgIik7KWNvbnRpbnVlO3JldHVybiB0aGlzfSxiLnByb3RvdHlwZS5wdXQ9ZnVuY3Rpb24oYSl7dGhpcy5idWZmZXI9YSt0aGlzLmJ1ZmZlcjt2YXIgYj10aGlzLnBvcy1hLmxlbmd0aDtyZXR1cm4gdGhpcy5wb3M9MD5iPzA6Yix0aGlzfTt2YXIgRGI9L14odW5kZWZpbmVkKVxiLyxFYj0vXihudWxsKVxiLyxGYj0vXih0cnVlfGZhbHNlKVxiLyxHYj0vXlthLXpdW18kYS16QS1aMC05XSovLEhiPS9eW18kYS16QS1aXVtfJGEtekEtWjAtOV0qLyxJYj0vXltBLVpdW18kYS16QS1aMC05XSovLEpiPS9eXCQoW18kYS16QS1aXVtfJGEtekEtWjAtOV0qKS8sS2I9L14oPyFbIlxcXSkuLyxMYj0vXig/IVsnXFxdKS4vLE1iPS9eXFwoLikvLE5iPS9eXFwoWyciXFxiZm5ydHZdKS8sT2I9L15cXDAoPyFbMC05XSkvLFBiPS9eXFx1KFswLTlhLWZBLUZdezR9KS8sUWI9L15cXHgoWzAtOWEtZkEtRl17Mn0pLyxSYj0vXltlRV0oXCt8LSk/LyxTYj0vXlsxLTldWzAtOV0rLyxUYj0vXlswLTldKy8sVWI9L15bMC05XS8sVmI9e3dpbGRjYXJkOmhiLCJudWxsIjppYix1bmRlZmluZWQ6aWIsImJvb2xlYW4iOmliLG51bWJlcjppYixzdHJpbmc6aWIsaWRlbnRpZmllcjpqYixiaW5kZXI6a2IsYXJyYXk6bGIsb2JqZWN0Om9iLCJjbGFzcyI6cGIsZXh0cmFjdG9yOnFifSxXYj17fSxYYj17fTtXYi5tYXRjaGVzVHlwZU5hbWU9ZnVuY3Rpb24oYSxiKXt2YXIgYz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSk7cmV0dXJuIGMuc3Vic3RyaW5nKDgsYy5sZW5ndGgtMSk9PT1iPyEwOiFhLmNvbnN0cnVjdG9yfHxhLmNvbnN0cnVjdG9yLmNsYXNzTmFtZSE9PWImJmEuY29uc3RydWN0b3IubmFtZSE9PWI/ITE6ITB9LFdiLmNhbGxFeHRyYWN0b3I9ZnVuY3Rpb24oYSxiKXtpZighWGIuaGFzT3duUHJvcGVydHkoYSkpdGhyb3cgbmV3IEVycm9yKCJFeHRyYWN0b3IgZG9lcyBub3QgZXhpc3Q6ICIrYSk7cmV0dXJuIFhiW2FdKGIsV2IuUGFzcyl9LFdiLlBhc3M9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBXYi5QYXNzPyh0aGlzLnZhbD1hLHZvaWQgMCk6bmV3IFdiLlBhc3MoYSl9LHZiLnByb3RvdHlwZS5tYXRjaD1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMucGF0dGVybkZuKGEsV2IpO2lmKGMpcmV0dXJuIHRoaXMuc3VjY2Vzc0ZuLmFwcGx5KGIsYyk7aWYodGhpcy5uZXh0KXJldHVybiB0aGlzLm5leHQubWF0Y2goYSxiKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJBbGwgcGF0dGVybnMgZXhoYXVzdGVkIil9LHZiLnByb3RvdHlwZS5jbG9uZT1mdW5jdGlvbigpe3ZhciBhPW5ldyB2Yih0aGlzLnBhdHRlcm5Gbix0aGlzLnN1Y2Nlc3NGbik7cmV0dXJuIHRoaXMubmV4dCYmKGEubmV4dD10aGlzLm5leHQuY2xvbmUoKSksYX0sdmIucHJvdG90eXBlLmxhc3Q9ZnVuY3Rpb24oKXtmb3IodmFyIGE9dGhpczthLm5leHQ7KWE9YS5uZXh0O3JldHVybiBhfSx2Yi5wcm90b3R5cGUucG9wPWZ1bmN0aW9uKCl7Zm9yKHZhciBhLGI9dGhpcztiLm5leHQ7KWE9YixiPWIubmV4dDtyZXR1cm4gYSYmKGEubmV4dD1udWxsKSxifTt2YXIgWWI9QXJyYXkucHJvdG90eXBlLnNsaWNlLFpiPXt9LCRiPXt9LF9iPXtwYXR0ZXJuOnhiLGNhc2VPZjp6YixleHRyYWN0OkFiLGV4dHJhY3RPbmU6QmIsZXh0cmFjdG9yczpYYixwYXJzZTphLGNvbXBpbGU6ZWIsY29tcGlsZXJzOlZiLHJ1bnRpbWU6V2IsTWF0Y2hlcjp2Yix0cmVlOkNifTsib2JqZWN0Ij09dHlwZW9mIGV4cG9ydHMmJihleHBvcnRzLlBhdHRlcm49X2IpLCJvYmplY3QiPT10eXBlb2Ygd2luZG93JiYod2luZG93LlBhdHRlcm49X2IpfSgpOw=="},"diff.js": {"content_type": "text/javascript","data": "LyogCiAgIEdvb2dsZSBEaWZmIE1hdGNoIGFuZCBQYXRjaAogICArCiAgIGpzb25kaWZmcGF0Y2ggMC4xLjM4CiovCgoKIWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiPT10eXBlb2YgZXhwb3J0cyYmInVuZGVmaW5lZCIhPXR5cGVvZiBtb2R1bGUpbW9kdWxlLmV4cG9ydHM9ZSgpO2Vsc2UgaWYoImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZClkZWZpbmUoW10sZSk7ZWxzZXt2YXIgZjsidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz9mPXdpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9mPWdsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGYmJihmPXNlbGYpLGYuanNvbmRpZmZwYXRjaD1lKCl9fShmdW5jdGlvbigpe3ZhciBkZWZpbmUsbW9kdWxlLGV4cG9ydHM7cmV0dXJuIChmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgZW52aXJvbm1lbnQ9cmVxdWlyZSgiLi9lbnZpcm9ubWVudCIpO2Vudmlyb25tZW50LmlzQnJvd3NlciYmKHdpbmRvdy5kaWZmX21hdGNoX3BhdGNoPXJlcXVpcmUoIi4uL3B1YmxpYy9leHRlcm5hbC9kaWZmX21hdGNoX3BhdGNoX3VuY29tcHJlc3NlZCIpKSxtb2R1bGUuZXhwb3J0cz1yZXF1aXJlKCIuL21haW4iKTsKfSx7Ii4uL3B1YmxpYy9leHRlcm5hbC9kaWZmX21hdGNoX3BhdGNoX3VuY29tcHJlc3NlZCI6MiwiLi9lbnZpcm9ubWVudCI6OSwiLi9tYWluIjoxNn1dLDI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpmdW5jdGlvbiBkaWZmX21hdGNoX3BhdGNoKCl7dGhpcy5EaWZmX1RpbWVvdXQ9MSx0aGlzLkRpZmZfRWRpdENvc3Q9NCx0aGlzLk1hdGNoX1RocmVzaG9sZD0uNSx0aGlzLk1hdGNoX0Rpc3RhbmNlPTFlMyx0aGlzLlBhdGNoX0RlbGV0ZVRocmVzaG9sZD0uNSx0aGlzLlBhdGNoX01hcmdpbj00LHRoaXMuTWF0Y2hfTWF4Qml0cz0zMn12YXIgRElGRl9ERUxFVEU9LTEsRElGRl9JTlNFUlQ9MSxESUZGX0VRVUFMPTA7ZGlmZl9tYXRjaF9wYXRjaC5EaWZmLGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfbWFpbj1mdW5jdGlvbih0LG4sZSxpKXsidW5kZWZpbmVkIj09dHlwZW9mIGkmJihpPXRoaXMuRGlmZl9UaW1lb3V0PD0wP051bWJlci5NQVhfVkFMVUU6KG5ldyBEYXRlKS5nZXRUaW1lKCkrMWUzKnRoaXMuRGlmZl9UaW1lb3V0KTt2YXIgaD1pO2lmKG51bGw9PXR8fG51bGw9PW4pdGhyb3cgbmV3IEVycm9yKCJOdWxsIGlucHV0LiAoZGlmZl9tYWluKSIpO2lmKHQ9PW4pcmV0dXJuIHQ/W1tESUZGX0VRVUFMLHRdXTpbXTsidW5kZWZpbmVkIj09dHlwZW9mIGUmJihlPSEwKTt2YXIgcj1lLGY9dGhpcy5kaWZmX2NvbW1vblByZWZpeCh0LG4pLGE9dC5zdWJzdHJpbmcoMCxmKTt0PXQuc3Vic3RyaW5nKGYpLG49bi5zdWJzdHJpbmcoZiksZj10aGlzLmRpZmZfY29tbW9uU3VmZml4KHQsbik7dmFyIHM9dC5zdWJzdHJpbmcodC5sZW5ndGgtZik7dD10LnN1YnN0cmluZygwLHQubGVuZ3RoLWYpLG49bi5zdWJzdHJpbmcoMCxuLmxlbmd0aC1mKTt2YXIgbD10aGlzLmRpZmZfY29tcHV0ZV8odCxuLHIsaCk7cmV0dXJuIGEmJmwudW5zaGlmdChbRElGRl9FUVVBTCxhXSkscyYmbC5wdXNoKFtESUZGX0VRVUFMLHNdKSx0aGlzLmRpZmZfY2xlYW51cE1lcmdlKGwpLGx9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY29tcHV0ZV89ZnVuY3Rpb24odCxuLGUsaSl7dmFyIGg7aWYoIXQpcmV0dXJuW1tESUZGX0lOU0VSVCxuXV07aWYoIW4pcmV0dXJuW1tESUZGX0RFTEVURSx0XV07dmFyIHI9dC5sZW5ndGg+bi5sZW5ndGg/dDpuLGY9dC5sZW5ndGg+bi5sZW5ndGg/bjp0LGE9ci5pbmRleE9mKGYpO2lmKC0xIT1hKXJldHVybiBoPVtbRElGRl9JTlNFUlQsci5zdWJzdHJpbmcoMCxhKV0sW0RJRkZfRVFVQUwsZl0sW0RJRkZfSU5TRVJULHIuc3Vic3RyaW5nKGErZi5sZW5ndGgpXV0sdC5sZW5ndGg+bi5sZW5ndGgmJihoWzBdWzBdPWhbMl1bMF09RElGRl9ERUxFVEUpLGg7aWYoMT09Zi5sZW5ndGgpcmV0dXJuW1tESUZGX0RFTEVURSx0XSxbRElGRl9JTlNFUlQsbl1dO3I9Zj1udWxsO3ZhciBzPXRoaXMuZGlmZl9oYWxmTWF0Y2hfKHQsbik7aWYocyl7dmFyIGw9c1swXSxnPXNbMV0sYz1zWzJdLF89c1szXSxvPXNbNF0sdT10aGlzLmRpZmZfbWFpbihsLGMsZSxpKSxwPXRoaXMuZGlmZl9tYWluKGcsXyxlLGkpO3JldHVybiB1LmNvbmNhdChbW0RJRkZfRVFVQUwsb11dLHApfXJldHVybiBlJiZ0Lmxlbmd0aD4xMDAmJm4ubGVuZ3RoPjEwMD90aGlzLmRpZmZfbGluZU1vZGVfKHQsbixpKTp0aGlzLmRpZmZfYmlzZWN0Xyh0LG4saSl9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfbGluZU1vZGVfPWZ1bmN0aW9uKHQsbixlKXt2YXIgaT10aGlzLmRpZmZfbGluZXNUb0NoYXJzXyh0LG4pO3Q9aVswXSxuPWlbMV07dmFyIGg9aVsyXSxyPXRoaXMuZGlmZl9iaXNlY3RfKHQsbixlKTt0aGlzLmRpZmZfY2hhcnNUb0xpbmVzXyhyLGgpLHRoaXMuZGlmZl9jbGVhbnVwU2VtYW50aWMociksci5wdXNoKFtESUZGX0VRVUFMLCIiXSk7Zm9yKHZhciBmPTAsYT0wLHM9MCxsPSIiLGc9IiI7ZjxyLmxlbmd0aDspe3N3aXRjaChyW2ZdWzBdKXtjYXNlIERJRkZfSU5TRVJUOnMrKyxnKz1yW2ZdWzFdO2JyZWFrO2Nhc2UgRElGRl9ERUxFVEU6YSsrLGwrPXJbZl1bMV07YnJlYWs7Y2FzZSBESUZGX0VRVUFMOmlmKGE+PTEmJnM+PTEpe3ZhciBpPXRoaXMuZGlmZl9tYWluKGwsZywhMSxlKTtyLnNwbGljZShmLWEtcyxhK3MpLGY9Zi1hLXM7Zm9yKHZhciBjPWkubGVuZ3RoLTE7Yz49MDtjLS0pci5zcGxpY2UoZiwwLGlbY10pO2YrPWkubGVuZ3RofXM9MCxhPTAsbD0iIixnPSIifWYrK31yZXR1cm4gci5wb3AoKSxyfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2Jpc2VjdF89ZnVuY3Rpb24odCxuLGUpe2Zvcih2YXIgaT10Lmxlbmd0aCxoPW4ubGVuZ3RoLHI9TWF0aC5jZWlsKChpK2gpLzIpLGY9cixhPTIqcixzPW5ldyBBcnJheShhKSxsPW5ldyBBcnJheShhKSxnPTA7YT5nO2crKylzW2ddPS0xLGxbZ109LTE7c1tmKzFdPTAsbFtmKzFdPTA7Zm9yKHZhciBjPWktaCxfPWMlMiE9MCxvPTAsdT0wLHA9MCxkPTAsRj0wO3I+RiYmISgobmV3IERhdGUpLmdldFRpbWUoKT5lKTtGKyspe2Zvcih2YXIgRT0tRitvO0YtdT49RTtFKz0yKXt2YXIgRCxJPWYrRTtEPUU9PS1GfHxFIT1GJiZzW0ktMV08c1tJKzFdP3NbSSsxXTpzW0ktMV0rMTtmb3IodmFyIG09RC1FO2k+RCYmaD5tJiZ0LmNoYXJBdChEKT09bi5jaGFyQXQobSk7KUQrKyxtKys7aWYoc1tJXT1ELEQ+aSl1Kz0yO2Vsc2UgaWYobT5oKW8rPTI7ZWxzZSBpZihfKXt2YXIgYj1mK2MtRTtpZihiPj0wJiZhPmImJi0xIT1sW2JdKXt2YXIgdj1pLWxbYl07aWYoRD49dilyZXR1cm4gdGhpcy5kaWZmX2Jpc2VjdFNwbGl0Xyh0LG4sRCxtLGUpfX19Zm9yKHZhciBMPS1GK3A7Ri1kPj1MO0wrPTIpe3ZhciB2LGI9ZitMO3Y9TD09LUZ8fEwhPUYmJmxbYi0xXTxsW2IrMV0/bFtiKzFdOmxbYi0xXSsxO2Zvcih2YXIgVD12LUw7aT52JiZoPlQmJnQuY2hhckF0KGktdi0xKT09bi5jaGFyQXQoaC1ULTEpOyl2KyssVCsrO2lmKGxbYl09dix2PmkpZCs9MjtlbHNlIGlmKFQ+aClwKz0yO2Vsc2UgaWYoIV8pe3ZhciBJPWYrYy1MO2lmKEk+PTAmJmE+SSYmLTEhPXNbSV0pe3ZhciBEPXNbSV0sbT1mK0QtSTtpZih2PWktdixEPj12KXJldHVybiB0aGlzLmRpZmZfYmlzZWN0U3BsaXRfKHQsbixELG0sZSl9fX19cmV0dXJuW1tESUZGX0RFTEVURSx0XSxbRElGRl9JTlNFUlQsbl1dfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2Jpc2VjdFNwbGl0Xz1mdW5jdGlvbih0LG4sZSxpLGgpe3ZhciByPXQuc3Vic3RyaW5nKDAsZSksZj1uLnN1YnN0cmluZygwLGkpLGE9dC5zdWJzdHJpbmcoZSkscz1uLnN1YnN0cmluZyhpKSxsPXRoaXMuZGlmZl9tYWluKHIsZiwhMSxoKSxnPXRoaXMuZGlmZl9tYWluKGEscywhMSxoKTtyZXR1cm4gbC5jb25jYXQoZyl9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfbGluZXNUb0NoYXJzXz1mdW5jdGlvbih0LG4pe2Z1bmN0aW9uIGUodCl7Zm9yKHZhciBuPSIiLGU9MCxyPS0xLGY9aS5sZW5ndGg7cjx0Lmxlbmd0aC0xOyl7cj10LmluZGV4T2YoIlxuIixlKSwtMT09ciYmKHI9dC5sZW5ndGgtMSk7dmFyIGE9dC5zdWJzdHJpbmcoZSxyKzEpO2U9cisxLChoLmhhc093blByb3BlcnR5P2guaGFzT3duUHJvcGVydHkoYSk6dm9pZCAwIT09aFthXSk/bis9U3RyaW5nLmZyb21DaGFyQ29kZShoW2FdKToobis9U3RyaW5nLmZyb21DaGFyQ29kZShmKSxoW2FdPWYsaVtmKytdPWEpfXJldHVybiBufXZhciBpPVtdLGg9e307aVswXT0iIjt2YXIgcj1lKHQpLGY9ZShuKTtyZXR1cm5bcixmLGldfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NoYXJzVG9MaW5lc189ZnVuY3Rpb24odCxuKXtmb3IodmFyIGU9MDtlPHQubGVuZ3RoO2UrKyl7Zm9yKHZhciBpPXRbZV1bMV0saD1bXSxyPTA7cjxpLmxlbmd0aDtyKyspaFtyXT1uW2kuY2hhckNvZGVBdChyKV07dFtlXVsxXT1oLmpvaW4oIiIpfX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9jb21tb25QcmVmaXg9ZnVuY3Rpb24odCxuKXtpZighdHx8IW58fHQuY2hhckF0KDApIT1uLmNoYXJBdCgwKSlyZXR1cm4gMDtmb3IodmFyIGU9MCxpPU1hdGgubWluKHQubGVuZ3RoLG4ubGVuZ3RoKSxoPWkscj0wO2g+ZTspdC5zdWJzdHJpbmcocixoKT09bi5zdWJzdHJpbmcocixoKT8oZT1oLHI9ZSk6aT1oLGg9TWF0aC5mbG9vcigoaS1lKS8yK2UpO3JldHVybiBofSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NvbW1vblN1ZmZpeD1mdW5jdGlvbih0LG4pe2lmKCF0fHwhbnx8dC5jaGFyQXQodC5sZW5ndGgtMSkhPW4uY2hhckF0KG4ubGVuZ3RoLTEpKXJldHVybiAwO2Zvcih2YXIgZT0wLGk9TWF0aC5taW4odC5sZW5ndGgsbi5sZW5ndGgpLGg9aSxyPTA7aD5lOyl0LnN1YnN0cmluZyh0Lmxlbmd0aC1oLHQubGVuZ3RoLXIpPT1uLnN1YnN0cmluZyhuLmxlbmd0aC1oLG4ubGVuZ3RoLXIpPyhlPWgscj1lKTppPWgsaD1NYXRoLmZsb29yKChpLWUpLzIrZSk7cmV0dXJuIGh9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY29tbW9uT3ZlcmxhcF89ZnVuY3Rpb24odCxuKXt2YXIgZT10Lmxlbmd0aCxpPW4ubGVuZ3RoO2lmKDA9PWV8fDA9PWkpcmV0dXJuIDA7ZT5pP3Q9dC5zdWJzdHJpbmcoZS1pKTppPmUmJihuPW4uc3Vic3RyaW5nKDAsZSkpO3ZhciBoPU1hdGgubWluKGUsaSk7aWYodD09bilyZXR1cm4gaDtmb3IodmFyIHI9MCxmPTE7Oyl7dmFyIGE9dC5zdWJzdHJpbmcoaC1mKSxzPW4uaW5kZXhPZihhKTtpZigtMT09cylyZXR1cm4gcjtmKz1zLCgwPT1zfHx0LnN1YnN0cmluZyhoLWYpPT1uLnN1YnN0cmluZygwLGYpKSYmKHI9ZixmKyspfX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9oYWxmTWF0Y2hfPWZ1bmN0aW9uKHQsbil7ZnVuY3Rpb24gZSh0LG4sZSl7Zm9yKHZhciBpLGgscixhLHM9dC5zdWJzdHJpbmcoZSxlK01hdGguZmxvb3IodC5sZW5ndGgvNCkpLGw9LTEsZz0iIjstMSE9KGw9bi5pbmRleE9mKHMsbCsxKSk7KXt2YXIgYz1mLmRpZmZfY29tbW9uUHJlZml4KHQuc3Vic3RyaW5nKGUpLG4uc3Vic3RyaW5nKGwpKSxfPWYuZGlmZl9jb21tb25TdWZmaXgodC5zdWJzdHJpbmcoMCxlKSxuLnN1YnN0cmluZygwLGwpKTtnLmxlbmd0aDxfK2MmJihnPW4uc3Vic3RyaW5nKGwtXyxsKStuLnN1YnN0cmluZyhsLGwrYyksaT10LnN1YnN0cmluZygwLGUtXyksaD10LnN1YnN0cmluZyhlK2MpLHI9bi5zdWJzdHJpbmcoMCxsLV8pLGE9bi5zdWJzdHJpbmcobCtjKSl9cmV0dXJuIDIqZy5sZW5ndGg+PXQubGVuZ3RoP1tpLGgscixhLGddOm51bGx9aWYodGhpcy5EaWZmX1RpbWVvdXQ8PTApcmV0dXJuIG51bGw7dmFyIGk9dC5sZW5ndGg+bi5sZW5ndGg/dDpuLGg9dC5sZW5ndGg+bi5sZW5ndGg/bjp0O2lmKGkubGVuZ3RoPDR8fDIqaC5sZW5ndGg8aS5sZW5ndGgpcmV0dXJuIG51bGw7dmFyIHIsZj10aGlzLGE9ZShpLGgsTWF0aC5jZWlsKGkubGVuZ3RoLzQpKSxzPWUoaSxoLE1hdGguY2VpbChpLmxlbmd0aC8yKSk7aWYoIWEmJiFzKXJldHVybiBudWxsO3I9cz9hJiZhWzRdLmxlbmd0aD5zWzRdLmxlbmd0aD9hOnM6YTt2YXIgbCxnLGMsXzt0Lmxlbmd0aD5uLmxlbmd0aD8obD1yWzBdLGc9clsxXSxjPXJbMl0sXz1yWzNdKTooYz1yWzBdLF89clsxXSxsPXJbMl0sZz1yWzNdKTt2YXIgbz1yWzRdO3JldHVybltsLGcsYyxfLG9dfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NsZWFudXBTZW1hbnRpYz1mdW5jdGlvbih0KXtmb3IodmFyIG49ITEsZT1bXSxpPTAsaD1udWxsLHI9MCxmPTAsYT0wLHM9MCxsPTA7cjx0Lmxlbmd0aDspdFtyXVswXT09RElGRl9FUVVBTD8oZVtpKytdPXIsZj1zLGE9bCxzPTAsbD0wLGg9dFtyXVsxXSk6KHRbcl1bMF09PURJRkZfSU5TRVJUP3MrPXRbcl1bMV0ubGVuZ3RoOmwrPXRbcl1bMV0ubGVuZ3RoLG51bGwhPT1oJiZoLmxlbmd0aDw9TWF0aC5tYXgoZixhKSYmaC5sZW5ndGg8PU1hdGgubWF4KHMsbCkmJih0LnNwbGljZShlW2ktMV0sMCxbRElGRl9ERUxFVEUsaF0pLHRbZVtpLTFdKzFdWzBdPURJRkZfSU5TRVJULGktLSxpLS0scj1pPjA/ZVtpLTFdOi0xLGY9MCxhPTAscz0wLGw9MCxoPW51bGwsbj0hMCkpLHIrKztmb3IobiYmdGhpcy5kaWZmX2NsZWFudXBNZXJnZSh0KSx0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljTG9zc2xlc3ModCkscj0xO3I8dC5sZW5ndGg7KXtpZih0W3ItMV1bMF09PURJRkZfREVMRVRFJiZ0W3JdWzBdPT1ESUZGX0lOU0VSVCl7dmFyIGc9dFtyLTFdWzFdLGM9dFtyXVsxXSxfPXRoaXMuZGlmZl9jb21tb25PdmVybGFwXyhnLGMpOyhfPj1nLmxlbmd0aC8yfHxfPj1jLmxlbmd0aC8yKSYmKHQuc3BsaWNlKHIsMCxbRElGRl9FUVVBTCxjLnN1YnN0cmluZygwLF8pXSksdFtyLTFdWzFdPWcuc3Vic3RyaW5nKDAsZy5sZW5ndGgtXyksdFtyKzFdWzFdPWMuc3Vic3RyaW5nKF8pLHIrKykscisrfXIrK319LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY2xlYW51cFNlbWFudGljTG9zc2xlc3M9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbih0LG4pe2lmKCF0fHwhbilyZXR1cm4gNTt2YXIgYT0wO3JldHVybih0LmNoYXJBdCh0Lmxlbmd0aC0xKS5tYXRjaChlKXx8bi5jaGFyQXQoMCkubWF0Y2goZSkpJiYoYSsrLCh0LmNoYXJBdCh0Lmxlbmd0aC0xKS5tYXRjaChpKXx8bi5jaGFyQXQoMCkubWF0Y2goaSkpJiYoYSsrLCh0LmNoYXJBdCh0Lmxlbmd0aC0xKS5tYXRjaChoKXx8bi5jaGFyQXQoMCkubWF0Y2goaCkpJiYoYSsrLCh0Lm1hdGNoKHIpfHxuLm1hdGNoKGYpKSYmYSsrKSkpLGF9Zm9yKHZhciBlPS9bXmEtekEtWjAtOV0vLGk9L1xzLyxoPS9bXHJcbl0vLHI9L1xuXHI/XG4kLyxmPS9eXHI/XG5ccj9cbi8sYT0xO2E8dC5sZW5ndGgtMTspe2lmKHRbYS0xXVswXT09RElGRl9FUVVBTCYmdFthKzFdWzBdPT1ESUZGX0VRVUFMKXt2YXIgcz10W2EtMV1bMV0sbD10W2FdWzFdLGc9dFthKzFdWzFdLGM9dGhpcy5kaWZmX2NvbW1vblN1ZmZpeChzLGwpO2lmKGMpe3ZhciBfPWwuc3Vic3RyaW5nKGwubGVuZ3RoLWMpO3M9cy5zdWJzdHJpbmcoMCxzLmxlbmd0aC1jKSxsPV8rbC5zdWJzdHJpbmcoMCxsLmxlbmd0aC1jKSxnPV8rZ31mb3IodmFyIG89cyx1PWwscD1nLGQ9bihzLGwpK24obCxnKTtsLmNoYXJBdCgwKT09PWcuY2hhckF0KDApOyl7cys9bC5jaGFyQXQoMCksbD1sLnN1YnN0cmluZygxKStnLmNoYXJBdCgwKSxnPWcuc3Vic3RyaW5nKDEpO3ZhciBGPW4ocyxsKStuKGwsZyk7Rj49ZCYmKGQ9RixvPXMsdT1sLHA9Zyl9dFthLTFdWzFdIT1vJiYobz90W2EtMV1bMV09bzoodC5zcGxpY2UoYS0xLDEpLGEtLSksdFthXVsxXT11LHA/dFthKzFdWzFdPXA6KHQuc3BsaWNlKGErMSwxKSxhLS0pKX1hKyt9fSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2NsZWFudXBFZmZpY2llbmN5PWZ1bmN0aW9uKHQpe2Zvcih2YXIgbj0hMSxlPVtdLGk9MCxoPSIiLHI9MCxmPSExLGE9ITEscz0hMSxsPSExO3I8dC5sZW5ndGg7KXRbcl1bMF09PURJRkZfRVFVQUw/KHRbcl1bMV0ubGVuZ3RoPHRoaXMuRGlmZl9FZGl0Q29zdCYmKHN8fGwpPyhlW2krK109cixmPXMsYT1sLGg9dFtyXVsxXSk6KGk9MCxoPSIiKSxzPWw9ITEpOih0W3JdWzBdPT1ESUZGX0RFTEVURT9sPSEwOnM9ITAsaCYmKGYmJmEmJnMmJmx8fGgubGVuZ3RoPHRoaXMuRGlmZl9FZGl0Q29zdC8yJiZmK2ErcytsPT0zKSYmKHQuc3BsaWNlKGVbaS0xXSwwLFtESUZGX0RFTEVURSxoXSksdFtlW2ktMV0rMV1bMF09RElGRl9JTlNFUlQsaS0tLGg9IiIsZiYmYT8ocz1sPSEwLGk9MCk6KGktLSxyPWk+MD9lW2ktMV06LTEscz1sPSExKSxuPSEwKSkscisrO24mJnRoaXMuZGlmZl9jbGVhbnVwTWVyZ2UodCl9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfY2xlYW51cE1lcmdlPWZ1bmN0aW9uKHQpe3QucHVzaChbRElGRl9FUVVBTCwiIl0pO2Zvcih2YXIgbixlPTAsaT0wLGg9MCxyPSIiLGY9IiI7ZTx0Lmxlbmd0aDspc3dpdGNoKHRbZV1bMF0pe2Nhc2UgRElGRl9JTlNFUlQ6aCsrLGYrPXRbZV1bMV0sZSsrO2JyZWFrO2Nhc2UgRElGRl9ERUxFVEU6aSsrLHIrPXRbZV1bMV0sZSsrO2JyZWFrO2Nhc2UgRElGRl9FUVVBTDppK2g+MT8oMCE9PWkmJjAhPT1oJiYobj10aGlzLmRpZmZfY29tbW9uUHJlZml4KGYsciksMCE9PW4mJihlLWktaD4wJiZ0W2UtaS1oLTFdWzBdPT1ESUZGX0VRVUFMP3RbZS1pLWgtMV1bMV0rPWYuc3Vic3RyaW5nKDAsbik6KHQuc3BsaWNlKDAsMCxbRElGRl9FUVVBTCxmLnN1YnN0cmluZygwLG4pXSksZSsrKSxmPWYuc3Vic3RyaW5nKG4pLHI9ci5zdWJzdHJpbmcobikpLG49dGhpcy5kaWZmX2NvbW1vblN1ZmZpeChmLHIpLDAhPT1uJiYodFtlXVsxXT1mLnN1YnN0cmluZyhmLmxlbmd0aC1uKSt0W2VdWzFdLGY9Zi5zdWJzdHJpbmcoMCxmLmxlbmd0aC1uKSxyPXIuc3Vic3RyaW5nKDAsci5sZW5ndGgtbikpKSwwPT09aT90LnNwbGljZShlLWktaCxpK2gsW0RJRkZfSU5TRVJULGZdKTowPT09aD90LnNwbGljZShlLWktaCxpK2gsW0RJRkZfREVMRVRFLHJdKTp0LnNwbGljZShlLWktaCxpK2gsW0RJRkZfREVMRVRFLHJdLFtESUZGX0lOU0VSVCxmXSksZT1lLWktaCsoaT8xOjApKyhoPzE6MCkrMSk6MCE9PWUmJnRbZS0xXVswXT09RElGRl9FUVVBTD8odFtlLTFdWzFdKz10W2VdWzFdLHQuc3BsaWNlKGUsMSkpOmUrKyxoPTAsaT0wLHI9IiIsZj0iIn0iIj09PXRbdC5sZW5ndGgtMV1bMV0mJnQucG9wKCk7dmFyIGE9ITE7Zm9yKGU9MTtlPHQubGVuZ3RoLTE7KXRbZS0xXVswXT09RElGRl9FUVVBTCYmdFtlKzFdWzBdPT1ESUZGX0VRVUFMJiYodFtlXVsxXS5zdWJzdHJpbmcodFtlXVsxXS5sZW5ndGgtdFtlLTFdWzFdLmxlbmd0aCk9PXRbZS0xXVsxXT8odFtlXVsxXT10W2UtMV1bMV0rdFtlXVsxXS5zdWJzdHJpbmcoMCx0W2VdWzFdLmxlbmd0aC10W2UtMV1bMV0ubGVuZ3RoKSx0W2UrMV1bMV09dFtlLTFdWzFdK3RbZSsxXVsxXSx0LnNwbGljZShlLTEsMSksYT0hMCk6dFtlXVsxXS5zdWJzdHJpbmcoMCx0W2UrMV1bMV0ubGVuZ3RoKT09dFtlKzFdWzFdJiYodFtlLTFdWzFdKz10W2UrMV1bMV0sdFtlXVsxXT10W2VdWzFdLnN1YnN0cmluZyh0W2UrMV1bMV0ubGVuZ3RoKSt0W2UrMV1bMV0sdC5zcGxpY2UoZSsxLDEpLGE9ITApKSxlKys7YSYmdGhpcy5kaWZmX2NsZWFudXBNZXJnZSh0KX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl94SW5kZXg9ZnVuY3Rpb24odCxuKXt2YXIgZSxpPTAsaD0wLHI9MCxmPTA7Zm9yKGU9MDtlPHQubGVuZ3RoJiYodFtlXVswXSE9PURJRkZfSU5TRVJUJiYoaSs9dFtlXVsxXS5sZW5ndGgpLHRbZV1bMF0hPT1ESUZGX0RFTEVURSYmKGgrPXRbZV1bMV0ubGVuZ3RoKSwhKGk+bikpO2UrKylyPWksZj1oO3JldHVybiB0Lmxlbmd0aCE9ZSYmdFtlXVswXT09PURJRkZfREVMRVRFP2Y6Zisobi1yKX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl9wcmV0dHlIdG1sPWZ1bmN0aW9uKHQpe2Zvcih2YXIgbj1bXSxlPTAsaT0vJi9nLGg9LzwvZyxyPS8+L2csZj0vXG4vZyxhPTA7YTx0Lmxlbmd0aDthKyspe3ZhciBzPXRbYV1bMF0sbD10W2FdWzFdLGc9bC5yZXBsYWNlKGksIiZhbXA7IikucmVwbGFjZShoLCImbHQ7IikucmVwbGFjZShyLCImZ3Q7IikucmVwbGFjZShmLCImcGFyYTs8YnI+Iik7c3dpdGNoKHMpe2Nhc2UgRElGRl9JTlNFUlQ6blthXT0nPGlucyBzdHlsZT0iYmFja2dyb3VuZDojZTZmZmU2OyI+JytnKyI8L2lucz4iO2JyZWFrO2Nhc2UgRElGRl9ERUxFVEU6blthXT0nPGRlbCBzdHlsZT0iYmFja2dyb3VuZDojZmZlNmU2OyI+JytnKyI8L2RlbD4iO2JyZWFrO2Nhc2UgRElGRl9FUVVBTDpuW2FdPSI8c3Bhbj4iK2crIjwvc3Bhbj4ifXMhPT1ESUZGX0RFTEVURSYmKGUrPWwubGVuZ3RoKX1yZXR1cm4gbi5qb2luKCIiKX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUuZGlmZl90ZXh0MT1mdW5jdGlvbih0KXtmb3IodmFyIG49W10sZT0wO2U8dC5sZW5ndGg7ZSsrKXRbZV1bMF0hPT1ESUZGX0lOU0VSVCYmKG5bZV09dFtlXVsxXSk7cmV0dXJuIG4uam9pbigiIil9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfdGV4dDI9ZnVuY3Rpb24odCl7Zm9yKHZhciBuPVtdLGU9MDtlPHQubGVuZ3RoO2UrKyl0W2VdWzBdIT09RElGRl9ERUxFVEUmJihuW2VdPXRbZV1bMV0pO3JldHVybiBuLmpvaW4oIiIpfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX2xldmVuc2h0ZWluPWZ1bmN0aW9uKHQpe2Zvcih2YXIgbj0wLGU9MCxpPTAsaD0wO2g8dC5sZW5ndGg7aCsrKXt2YXIgcj10W2hdWzBdLGY9dFtoXVsxXTtzd2l0Y2gocil7Y2FzZSBESUZGX0lOU0VSVDplKz1mLmxlbmd0aDticmVhaztjYXNlIERJRkZfREVMRVRFOmkrPWYubGVuZ3RoO2JyZWFrO2Nhc2UgRElGRl9FUVVBTDpuKz1NYXRoLm1heChlLGkpLGU9MCxpPTB9fXJldHVybiBuKz1NYXRoLm1heChlLGkpfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5kaWZmX3RvRGVsdGE9ZnVuY3Rpb24odCl7Zm9yKHZhciBuPVtdLGU9MDtlPHQubGVuZ3RoO2UrKylzd2l0Y2godFtlXVswXSl7Y2FzZSBESUZGX0lOU0VSVDpuW2VdPSIrIitlbmNvZGVVUkkodFtlXVsxXSk7YnJlYWs7Y2FzZSBESUZGX0RFTEVURTpuW2VdPSItIit0W2VdWzFdLmxlbmd0aDticmVhaztjYXNlIERJRkZfRVFVQUw6bltlXT0iPSIrdFtlXVsxXS5sZW5ndGh9cmV0dXJuIG4uam9pbigiCSIpLnJlcGxhY2UoLyUyMC9nLCIgIil9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLmRpZmZfZnJvbURlbHRhPWZ1bmN0aW9uKHQsbil7Zm9yKHZhciBlPVtdLGk9MCxoPTAscj1uLnNwbGl0KC9cdC9nKSxmPTA7ZjxyLmxlbmd0aDtmKyspe3ZhciBhPXJbZl0uc3Vic3RyaW5nKDEpO3N3aXRjaChyW2ZdLmNoYXJBdCgwKSl7Y2FzZSIrIjp0cnl7ZVtpKytdPVtESUZGX0lOU0VSVCxkZWNvZGVVUkkoYSldfWNhdGNoKHMpe3Rocm93IG5ldyBFcnJvcigiSWxsZWdhbCBlc2NhcGUgaW4gZGlmZl9mcm9tRGVsdGE6ICIrYSl9YnJlYWs7Y2FzZSItIjpjYXNlIj0iOnZhciBsPXBhcnNlSW50KGEsMTApO2lmKGlzTmFOKGwpfHwwPmwpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG51bWJlciBpbiBkaWZmX2Zyb21EZWx0YTogIithKTt2YXIgZz10LnN1YnN0cmluZyhoLGgrPWwpOyI9Ij09cltmXS5jaGFyQXQoMCk/ZVtpKytdPVtESUZGX0VRVUFMLGddOmVbaSsrXT1bRElGRl9ERUxFVEUsZ107YnJlYWs7ZGVmYXVsdDppZihyW2ZdKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkaWZmIG9wZXJhdGlvbiBpbiBkaWZmX2Zyb21EZWx0YTogIityW2ZdKX19aWYoaCE9dC5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJEZWx0YSBsZW5ndGggKCIraCsiKSBkb2VzIG5vdCBlcXVhbCBzb3VyY2UgdGV4dCBsZW5ndGggKCIrdC5sZW5ndGgrIikuIik7cmV0dXJuIGV9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLm1hdGNoX21haW49ZnVuY3Rpb24odCxuLGUpe2lmKG51bGw9PXR8fG51bGw9PW58fG51bGw9PWUpdGhyb3cgbmV3IEVycm9yKCJOdWxsIGlucHV0LiAobWF0Y2hfbWFpbikiKTtyZXR1cm4gZT1NYXRoLm1heCgwLE1hdGgubWluKGUsdC5sZW5ndGgpKSx0PT1uPzA6dC5sZW5ndGg/dC5zdWJzdHJpbmcoZSxlK24ubGVuZ3RoKT09bj9lOnRoaXMubWF0Y2hfYml0YXBfKHQsbixlKTotMX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUubWF0Y2hfYml0YXBfPWZ1bmN0aW9uKHQsbixlKXtmdW5jdGlvbiBpKHQsaSl7dmFyIGg9dC9uLmxlbmd0aCxmPU1hdGguYWJzKGUtaSk7cmV0dXJuIHIuTWF0Y2hfRGlzdGFuY2U/aCtmL3IuTWF0Y2hfRGlzdGFuY2U6Zj8xOmh9aWYobi5sZW5ndGg+dGhpcy5NYXRjaF9NYXhCaXRzKXRocm93IG5ldyBFcnJvcigiUGF0dGVybiB0b28gbG9uZyBmb3IgdGhpcyBicm93c2VyLiIpO3ZhciBoPXRoaXMubWF0Y2hfYWxwaGFiZXRfKG4pLHI9dGhpcyxmPXRoaXMuTWF0Y2hfVGhyZXNob2xkLGE9dC5pbmRleE9mKG4sZSk7LTEhPWEmJihmPU1hdGgubWluKGkoMCxhKSxmKSxhPXQubGFzdEluZGV4T2YobixlK24ubGVuZ3RoKSwtMSE9YSYmKGY9TWF0aC5taW4oaSgwLGEpLGYpKSk7dmFyIHM9MTw8bi5sZW5ndGgtMTthPS0xO2Zvcih2YXIgbCxnLGMsXz1uLmxlbmd0aCt0Lmxlbmd0aCxvPTA7bzxuLmxlbmd0aDtvKyspe2ZvcihsPTAsZz1fO2c+bDspaShvLGUrZyk8PWY/bD1nOl89ZyxnPU1hdGguZmxvb3IoKF8tbCkvMitsKTtfPWc7dmFyIHU9TWF0aC5tYXgoMSxlLWcrMSkscD1NYXRoLm1pbihlK2csdC5sZW5ndGgpK24ubGVuZ3RoLGQ9QXJyYXkocCsyKTtkW3ArMV09KDE8PG8pLTE7Zm9yKHZhciBGPXA7Rj49dTtGLS0pe3ZhciBFPWhbdC5jaGFyQXQoRi0xKV07aWYoMD09PW8/ZFtGXT0oZFtGKzFdPDwxfDEpJkU6ZFtGXT0oZFtGKzFdPDwxfDEpJkV8KChjW0YrMV18Y1tGXSk8PDF8MSl8Y1tGKzFdLGRbRl0mcyl7dmFyIEQ9aShvLEYtMSk7aWYoZj49RCl7aWYoZj1ELGE9Ri0xLCEoYT5lKSlicmVhazt1PU1hdGgubWF4KDEsMiplLWEpfX19aWYoaShvKzEsZSk+ZilicmVhaztjPWR9cmV0dXJuIGF9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLm1hdGNoX2FscGhhYmV0Xz1mdW5jdGlvbih0KXtmb3IodmFyIG49e30sZT0wO2U8dC5sZW5ndGg7ZSsrKW5bdC5jaGFyQXQoZSldPTA7Zm9yKHZhciBlPTA7ZTx0Lmxlbmd0aDtlKyspblt0LmNoYXJBdChlKV18PTE8PHQubGVuZ3RoLWUtMTtyZXR1cm4gbn0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfYWRkQ29udGV4dF89ZnVuY3Rpb24odCxuKXtpZigwIT1uLmxlbmd0aCl7Zm9yKHZhciBlPW4uc3Vic3RyaW5nKHQuc3RhcnQyLHQuc3RhcnQyK3QubGVuZ3RoMSksaT0wO24uaW5kZXhPZihlKSE9bi5sYXN0SW5kZXhPZihlKSYmZS5sZW5ndGg8dGhpcy5NYXRjaF9NYXhCaXRzLXRoaXMuUGF0Y2hfTWFyZ2luLXRoaXMuUGF0Y2hfTWFyZ2luOylpKz10aGlzLlBhdGNoX01hcmdpbixlPW4uc3Vic3RyaW5nKHQuc3RhcnQyLWksdC5zdGFydDIrdC5sZW5ndGgxK2kpO2krPXRoaXMuUGF0Y2hfTWFyZ2luO3ZhciBoPW4uc3Vic3RyaW5nKHQuc3RhcnQyLWksdC5zdGFydDIpO2gmJnQuZGlmZnMudW5zaGlmdChbRElGRl9FUVVBTCxoXSk7dmFyIHI9bi5zdWJzdHJpbmcodC5zdGFydDIrdC5sZW5ndGgxLHQuc3RhcnQyK3QubGVuZ3RoMStpKTtyJiZ0LmRpZmZzLnB1c2goW0RJRkZfRVFVQUwscl0pLHQuc3RhcnQxLT1oLmxlbmd0aCx0LnN0YXJ0Mi09aC5sZW5ndGgsdC5sZW5ndGgxKz1oLmxlbmd0aCtyLmxlbmd0aCx0Lmxlbmd0aDIrPWgubGVuZ3RoK3IubGVuZ3RofX0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfbWFrZT1mdW5jdGlvbih0LG4sZSl7dmFyIGksaDtpZigic3RyaW5nIj09dHlwZW9mIHQmJiJzdHJpbmciPT10eXBlb2YgbiYmInVuZGVmaW5lZCI9PXR5cGVvZiBlKWk9dCxoPXRoaXMuZGlmZl9tYWluKGksbiwhMCksaC5sZW5ndGg+MiYmKHRoaXMuZGlmZl9jbGVhbnVwU2VtYW50aWMoaCksdGhpcy5kaWZmX2NsZWFudXBFZmZpY2llbmN5KGgpKTtlbHNlIGlmKHQmJiJvYmplY3QiPT10eXBlb2YgdCYmInVuZGVmaW5lZCI9PXR5cGVvZiBuJiYidW5kZWZpbmVkIj09dHlwZW9mIGUpaD10LGk9dGhpcy5kaWZmX3RleHQxKGgpO2Vsc2UgaWYoInN0cmluZyI9PXR5cGVvZiB0JiZuJiYib2JqZWN0Ij09dHlwZW9mIG4mJiJ1bmRlZmluZWQiPT10eXBlb2YgZSlpPXQsaD1uO2Vsc2V7aWYoInN0cmluZyIhPXR5cGVvZiB0fHwic3RyaW5nIiE9dHlwZW9mIG58fCFlfHwib2JqZWN0IiE9dHlwZW9mIGUpdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNhbGwgZm9ybWF0IHRvIHBhdGNoX21ha2UuIik7aT10LGg9ZX1pZigwPT09aC5sZW5ndGgpcmV0dXJuW107Zm9yKHZhciByPVtdLGY9bmV3IGRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqLGE9MCxzPTAsbD0wLGc9aSxjPWksXz0wO188aC5sZW5ndGg7XysrKXt2YXIgbz1oW19dWzBdLHU9aFtfXVsxXTtzd2l0Y2goYXx8bz09PURJRkZfRVFVQUx8fChmLnN0YXJ0MT1zLGYuc3RhcnQyPWwpLG8pe2Nhc2UgRElGRl9JTlNFUlQ6Zi5kaWZmc1thKytdPWhbX10sZi5sZW5ndGgyKz11Lmxlbmd0aCxjPWMuc3Vic3RyaW5nKDAsbCkrdStjLnN1YnN0cmluZyhsKTticmVhaztjYXNlIERJRkZfREVMRVRFOmYubGVuZ3RoMSs9dS5sZW5ndGgsZi5kaWZmc1thKytdPWhbX10sYz1jLnN1YnN0cmluZygwLGwpK2Muc3Vic3RyaW5nKGwrdS5sZW5ndGgpO2JyZWFrO2Nhc2UgRElGRl9FUVVBTDp1Lmxlbmd0aDw9Mip0aGlzLlBhdGNoX01hcmdpbiYmYSYmaC5sZW5ndGghPV8rMT8oZi5kaWZmc1thKytdPWhbX10sZi5sZW5ndGgxKz11Lmxlbmd0aCxmLmxlbmd0aDIrPXUubGVuZ3RoKTp1Lmxlbmd0aD49Mip0aGlzLlBhdGNoX01hcmdpbiYmYSYmKHRoaXMucGF0Y2hfYWRkQ29udGV4dF8oZixnKSxyLnB1c2goZiksZj1uZXcgZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmosYT0wLGc9YyxzPWwpfW8hPT1ESUZGX0lOU0VSVCYmKHMrPXUubGVuZ3RoKSxvIT09RElGRl9ERUxFVEUmJihsKz11Lmxlbmd0aCl9cmV0dXJuIGEmJih0aGlzLnBhdGNoX2FkZENvbnRleHRfKGYsZyksci5wdXNoKGYpKSxyfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9kZWVwQ29weT1mdW5jdGlvbih0KXtmb3IodmFyIG49W10sZT0wO2U8dC5sZW5ndGg7ZSsrKXt2YXIgaT10W2VdLGg9bmV3IGRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqO2guZGlmZnM9W107Zm9yKHZhciByPTA7cjxpLmRpZmZzLmxlbmd0aDtyKyspaC5kaWZmc1tyXT1pLmRpZmZzW3JdLnNsaWNlKCk7aC5zdGFydDE9aS5zdGFydDEsaC5zdGFydDI9aS5zdGFydDIsaC5sZW5ndGgxPWkubGVuZ3RoMSxoLmxlbmd0aDI9aS5sZW5ndGgyLG5bZV09aH1yZXR1cm4gbn0sZGlmZl9tYXRjaF9wYXRjaC5wcm90b3R5cGUucGF0Y2hfYXBwbHk9ZnVuY3Rpb24odCxuKXtpZigwPT10Lmxlbmd0aClyZXR1cm5bbixbXV07dD10aGlzLnBhdGNoX2RlZXBDb3B5KHQpO3ZhciBlPXRoaXMucGF0Y2hfYWRkUGFkZGluZyh0KTtuPWUrbitlLHRoaXMucGF0Y2hfc3BsaXRNYXgodCk7Zm9yKHZhciBpPTAsaD1bXSxyPTA7cjx0Lmxlbmd0aDtyKyspe3ZhciBmLGE9dFtyXS5zdGFydDIraSxzPXRoaXMuZGlmZl90ZXh0MSh0W3JdLmRpZmZzKSxsPS0xO2lmKHMubGVuZ3RoPnRoaXMuTWF0Y2hfTWF4Qml0cz8oZj10aGlzLm1hdGNoX21haW4obixzLnN1YnN0cmluZygwLHRoaXMuTWF0Y2hfTWF4Qml0cyksYSksLTEhPWYmJihsPXRoaXMubWF0Y2hfbWFpbihuLHMuc3Vic3RyaW5nKHMubGVuZ3RoLXRoaXMuTWF0Y2hfTWF4Qml0cyksYStzLmxlbmd0aC10aGlzLk1hdGNoX01heEJpdHMpLCgtMT09bHx8Zj49bCkmJihmPS0xKSkpOmY9dGhpcy5tYXRjaF9tYWluKG4scyxhKSwtMT09ZiloW3JdPSExLGktPXRbcl0ubGVuZ3RoMi10W3JdLmxlbmd0aDE7ZWxzZXtoW3JdPSEwLGk9Zi1hO3ZhciBnO2lmKGc9LTE9PWw/bi5zdWJzdHJpbmcoZixmK3MubGVuZ3RoKTpuLnN1YnN0cmluZyhmLGwrdGhpcy5NYXRjaF9NYXhCaXRzKSxzPT1nKW49bi5zdWJzdHJpbmcoMCxmKSt0aGlzLmRpZmZfdGV4dDIodFtyXS5kaWZmcykrbi5zdWJzdHJpbmcoZitzLmxlbmd0aCk7ZWxzZXt2YXIgYz10aGlzLmRpZmZfbWFpbihzLGcsITEpO2lmKHMubGVuZ3RoPnRoaXMuTWF0Y2hfTWF4Qml0cyYmdGhpcy5kaWZmX2xldmVuc2h0ZWluKGMpL3MubGVuZ3RoPnRoaXMuUGF0Y2hfRGVsZXRlVGhyZXNob2xkKWhbcl09ITE7ZWxzZXt0aGlzLmRpZmZfY2xlYW51cFNlbWFudGljTG9zc2xlc3MoYyk7Zm9yKHZhciBfLG89MCx1PTA7dTx0W3JdLmRpZmZzLmxlbmd0aDt1Kyspe3ZhciBwPXRbcl0uZGlmZnNbdV07cFswXSE9PURJRkZfRVFVQUwmJihfPXRoaXMuZGlmZl94SW5kZXgoYyxvKSkscFswXT09PURJRkZfSU5TRVJUP249bi5zdWJzdHJpbmcoMCxmK18pK3BbMV0rbi5zdWJzdHJpbmcoZitfKTpwWzBdPT09RElGRl9ERUxFVEUmJihuPW4uc3Vic3RyaW5nKDAsZitfKStuLnN1YnN0cmluZyhmK3RoaXMuZGlmZl94SW5kZXgoYyxvK3BbMV0ubGVuZ3RoKSkpLHBbMF0hPT1ESUZGX0RFTEVURSYmKG8rPXBbMV0ubGVuZ3RoKX19fX19cmV0dXJuIG49bi5zdWJzdHJpbmcoZS5sZW5ndGgsbi5sZW5ndGgtZS5sZW5ndGgpLFtuLGhdfSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF9hZGRQYWRkaW5nPWZ1bmN0aW9uKHQpe2Zvcih2YXIgbj10aGlzLlBhdGNoX01hcmdpbixlPSIiLGk9MTtuPj1pO2krKyllKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpO2Zvcih2YXIgaT0wO2k8dC5sZW5ndGg7aSsrKXRbaV0uc3RhcnQxKz1uLHRbaV0uc3RhcnQyKz1uO3ZhciBoPXRbMF0scj1oLmRpZmZzO2lmKDA9PXIubGVuZ3RofHxyWzBdWzBdIT1ESUZGX0VRVUFMKXIudW5zaGlmdChbRElGRl9FUVVBTCxlXSksaC5zdGFydDEtPW4saC5zdGFydDItPW4saC5sZW5ndGgxKz1uLGgubGVuZ3RoMis9bjtlbHNlIGlmKG4+clswXVsxXS5sZW5ndGgpe3ZhciBmPW4tclswXVsxXS5sZW5ndGg7clswXVsxXT1lLnN1YnN0cmluZyhyWzBdWzFdLmxlbmd0aCkrclswXVsxXSxoLnN0YXJ0MS09ZixoLnN0YXJ0Mi09ZixoLmxlbmd0aDErPWYsaC5sZW5ndGgyKz1mfWlmKGg9dFt0Lmxlbmd0aC0xXSxyPWguZGlmZnMsMD09ci5sZW5ndGh8fHJbci5sZW5ndGgtMV1bMF0hPURJRkZfRVFVQUwpci5wdXNoKFtESUZGX0VRVUFMLGVdKSxoLmxlbmd0aDErPW4saC5sZW5ndGgyKz1uO2Vsc2UgaWYobj5yW3IubGVuZ3RoLTFdWzFdLmxlbmd0aCl7dmFyIGY9bi1yW3IubGVuZ3RoLTFdWzFdLmxlbmd0aDtyW3IubGVuZ3RoLTFdWzFdKz1lLnN1YnN0cmluZygwLGYpLGgubGVuZ3RoMSs9ZixoLmxlbmd0aDIrPWZ9cmV0dXJuIGV9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX3NwbGl0TWF4PWZ1bmN0aW9uKHQpe2Zvcih2YXIgbj10aGlzLk1hdGNoX01heEJpdHMsZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKHRbZV0ubGVuZ3RoMT5uKXt2YXIgaT10W2VdO3Quc3BsaWNlKGUtLSwxKTtmb3IodmFyIGg9aS5zdGFydDEscj1pLnN0YXJ0MixmPSIiOzAhPT1pLmRpZmZzLmxlbmd0aDspe3ZhciBhPW5ldyBkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaixzPSEwO2ZvcihhLnN0YXJ0MT1oLWYubGVuZ3RoLGEuc3RhcnQyPXItZi5sZW5ndGgsIiIhPT1mJiYoYS5sZW5ndGgxPWEubGVuZ3RoMj1mLmxlbmd0aCxhLmRpZmZzLnB1c2goW0RJRkZfRVFVQUwsZl0pKTswIT09aS5kaWZmcy5sZW5ndGgmJmEubGVuZ3RoMTxuLXRoaXMuUGF0Y2hfTWFyZ2luOyl7dmFyIGw9aS5kaWZmc1swXVswXSxnPWkuZGlmZnNbMF1bMV07bD09PURJRkZfSU5TRVJUPyhhLmxlbmd0aDIrPWcubGVuZ3RoLHIrPWcubGVuZ3RoLGEuZGlmZnMucHVzaChpLmRpZmZzLnNoaWZ0KCkpLHM9ITEpOmw9PT1ESUZGX0RFTEVURSYmMT09YS5kaWZmcy5sZW5ndGgmJmEuZGlmZnNbMF1bMF09PURJRkZfRVFVQUwmJmcubGVuZ3RoPjIqbj8oYS5sZW5ndGgxKz1nLmxlbmd0aCxoKz1nLmxlbmd0aCxzPSExLGEuZGlmZnMucHVzaChbbCxnXSksaS5kaWZmcy5zaGlmdCgpKTooZz1nLnN1YnN0cmluZygwLG4tYS5sZW5ndGgxLXRoaXMuUGF0Y2hfTWFyZ2luKSxhLmxlbmd0aDErPWcubGVuZ3RoLGgrPWcubGVuZ3RoLGw9PT1ESUZGX0VRVUFMPyhhLmxlbmd0aDIrPWcubGVuZ3RoLHIrPWcubGVuZ3RoKTpzPSExLGEuZGlmZnMucHVzaChbbCxnXSksZz09aS5kaWZmc1swXVsxXT9pLmRpZmZzLnNoaWZ0KCk6aS5kaWZmc1swXVsxXT1pLmRpZmZzWzBdWzFdLnN1YnN0cmluZyhnLmxlbmd0aCkpfWY9dGhpcy5kaWZmX3RleHQyKGEuZGlmZnMpLGY9Zi5zdWJzdHJpbmcoZi5sZW5ndGgtdGhpcy5QYXRjaF9NYXJnaW4pO3ZhciBjPXRoaXMuZGlmZl90ZXh0MShpLmRpZmZzKS5zdWJzdHJpbmcoMCx0aGlzLlBhdGNoX01hcmdpbik7IiIhPT1jJiYoYS5sZW5ndGgxKz1jLmxlbmd0aCxhLmxlbmd0aDIrPWMubGVuZ3RoLDAhPT1hLmRpZmZzLmxlbmd0aCYmYS5kaWZmc1thLmRpZmZzLmxlbmd0aC0xXVswXT09PURJRkZfRVFVQUw/YS5kaWZmc1thLmRpZmZzLmxlbmd0aC0xXVsxXSs9YzphLmRpZmZzLnB1c2goW0RJRkZfRVFVQUwsY10pKSxzfHx0LnNwbGljZSgrK2UsMCxhKX19fSxkaWZmX21hdGNoX3BhdGNoLnByb3RvdHlwZS5wYXRjaF90b1RleHQ9ZnVuY3Rpb24odCl7Zm9yKHZhciBuPVtdLGU9MDtlPHQubGVuZ3RoO2UrKyluW2VdPXRbZV07cmV0dXJuIG4uam9pbigiIil9LGRpZmZfbWF0Y2hfcGF0Y2gucHJvdG90eXBlLnBhdGNoX2Zyb21UZXh0PWZ1bmN0aW9uKHQpe3ZhciBuPVtdO2lmKCF0KXJldHVybiBuO2Zvcih2YXIgZT10LnNwbGl0KCJcbiIpLGk9MCxoPS9eQEAgLShcZCspLD8oXGQqKSBcKyhcZCspLD8oXGQqKSBAQCQvO2k8ZS5sZW5ndGg7KXt2YXIgcj1lW2ldLm1hdGNoKGgpO2lmKCFyKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXRjaCBzdHJpbmc6ICIrZVtpXSk7dmFyIGY9bmV3IGRpZmZfbWF0Y2hfcGF0Y2gucGF0Y2hfb2JqO2ZvcihuLnB1c2goZiksZi5zdGFydDE9cGFyc2VJbnQoclsxXSwxMCksIiI9PT1yWzJdPyhmLnN0YXJ0MS0tLGYubGVuZ3RoMT0xKToiMCI9PXJbMl0/Zi5sZW5ndGgxPTA6KGYuc3RhcnQxLS0sZi5sZW5ndGgxPXBhcnNlSW50KHJbMl0sMTApKSxmLnN0YXJ0Mj1wYXJzZUludChyWzNdLDEwKSwiIj09PXJbNF0/KGYuc3RhcnQyLS0sZi5sZW5ndGgyPTEpOiIwIj09cls0XT9mLmxlbmd0aDI9MDooZi5zdGFydDItLSxmLmxlbmd0aDI9cGFyc2VJbnQocls0XSwxMCkpLGkrKztpPGUubGVuZ3RoOyl7dmFyIGE9ZVtpXS5jaGFyQXQoMCk7dHJ5e3ZhciBzPWRlY29kZVVSSShlW2ldLnN1YnN0cmluZygxKSl9Y2F0Y2gobCl7dGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIGVzY2FwZSBpbiBwYXRjaF9mcm9tVGV4dDogIitzKX1pZigiLSI9PWEpZi5kaWZmcy5wdXNoKFtESUZGX0RFTEVURSxzXSk7ZWxzZSBpZigiKyI9PWEpZi5kaWZmcy5wdXNoKFtESUZGX0lOU0VSVCxzXSk7ZWxzZSBpZigiICI9PWEpZi5kaWZmcy5wdXNoKFtESUZGX0VRVUFMLHNdKTtlbHNle2lmKCJAIj09YSlicmVhaztpZigiIiE9PWEpdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhdGNoIG1vZGUgIicrYSsnIiBpbjogJytzKX1pKyt9fXJldHVybiBufSxkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaj1mdW5jdGlvbigpe3RoaXMuZGlmZnM9W10sdGhpcy5zdGFydDE9bnVsbCx0aGlzLnN0YXJ0Mj1udWxsLHRoaXMubGVuZ3RoMT0wLHRoaXMubGVuZ3RoMj0wfSxkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iai5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXt2YXIgdCxuO3Q9MD09PXRoaXMubGVuZ3RoMT90aGlzLnN0YXJ0MSsiLDAiOjE9PXRoaXMubGVuZ3RoMT90aGlzLnN0YXJ0MSsxOnRoaXMuc3RhcnQxKzErIiwiK3RoaXMubGVuZ3RoMSxuPTA9PT10aGlzLmxlbmd0aDI/dGhpcy5zdGFydDIrIiwwIjoxPT10aGlzLmxlbmd0aDI/dGhpcy5zdGFydDIrMTp0aGlzLnN0YXJ0MisxKyIsIit0aGlzLmxlbmd0aDI7Zm9yKHZhciBlLGk9WyJAQCAtIit0KyIgKyIrbisiIEBAXG4iXSxoPTA7aDx0aGlzLmRpZmZzLmxlbmd0aDtoKyspe3N3aXRjaCh0aGlzLmRpZmZzW2hdWzBdKXtjYXNlIERJRkZfSU5TRVJUOmU9IisiO2JyZWFrO2Nhc2UgRElGRl9ERUxFVEU6ZT0iLSI7YnJlYWs7Y2FzZSBESUZGX0VRVUFMOmU9IiAifWlbaCsxXT1lK2VuY29kZVVSSSh0aGlzLmRpZmZzW2hdWzFdKSsiXG4ifXJldHVybiBpLmpvaW4oIiIpLnJlcGxhY2UoLyUyMC9nLCIgIil9LHRoaXMuZGlmZl9tYXRjaF9wYXRjaD1kaWZmX21hdGNoX3BhdGNoLHRoaXMuRElGRl9ERUxFVEU9RElGRl9ERUxFVEUsdGhpcy5ESUZGX0lOU0VSVD1ESUZGX0lOU0VSVCx0aGlzLkRJRkZfRVFVQUw9RElGRl9FUVVBTDsKfSx7fV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBQaXBlPXJlcXVpcmUoIi4uL3BpcGUiKS5QaXBlLENvbnRleHQ9ZnVuY3Rpb24oKXt9O0NvbnRleHQucHJvdG90eXBlLnNldFJlc3VsdD1mdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5yZXN1bHQ9dCx0aGlzLmhhc1Jlc3VsdD0hMCx0aGlzfSxDb250ZXh0LnByb3RvdHlwZS5leGl0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXhpdGluZz0hMCx0aGlzfSxDb250ZXh0LnByb3RvdHlwZS5zd2l0Y2hUbz1mdW5jdGlvbih0LGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdHx8dCBpbnN0YW5jZW9mIFBpcGU/dGhpcy5uZXh0UGlwZT10Oih0aGlzLm5leHQ9dCxlJiYodGhpcy5uZXh0UGlwZT1lKSksdGhpc30sQ29udGV4dC5wcm90b3R5cGUucHVzaD1mdW5jdGlvbih0LGUpe3JldHVybiB0LnBhcmVudD10aGlzLCJ1bmRlZmluZWQiIT10eXBlb2YgZSYmKHQuY2hpbGROYW1lPWUpLHQucm9vdD10aGlzLnJvb3R8fHRoaXMsdC5vcHRpb25zPXQub3B0aW9uc3x8dGhpcy5vcHRpb25zLHRoaXMuY2hpbGRyZW4/KHRoaXMuY2hpbGRyZW5bdGhpcy5jaGlsZHJlbi5sZW5ndGgtMV0ubmV4dD10LHRoaXMuY2hpbGRyZW4ucHVzaCh0KSk6KHRoaXMuY2hpbGRyZW49W3RdLHRoaXMubmV4dEFmdGVyQ2hpbGRyZW49dGhpcy5uZXh0fHxudWxsLHRoaXMubmV4dD10KSx0Lm5leHQ9dGhpcyx0aGlzfSxleHBvcnRzLkNvbnRleHQ9Q29udGV4dDsKfSx7Ii4uL3BpcGUiOjE3fV0sNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBDb250ZXh0PXJlcXVpcmUoIi4vY29udGV4dCIpLkNvbnRleHQsRGlmZkNvbnRleHQ9ZnVuY3Rpb24odCxlKXt0aGlzLmxlZnQ9dCx0aGlzLnJpZ2h0PWUsdGhpcy5waXBlPSJkaWZmIn07RGlmZkNvbnRleHQucHJvdG90eXBlPW5ldyBDb250ZXh0LGV4cG9ydHMuRGlmZkNvbnRleHQ9RGlmZkNvbnRleHQ7Cn0seyIuL2NvbnRleHQiOjN9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIENvbnRleHQ9cmVxdWlyZSgiLi9jb250ZXh0IikuQ29udGV4dCxQYXRjaENvbnRleHQ9ZnVuY3Rpb24odCxlKXt0aGlzLmxlZnQ9dCx0aGlzLmRlbHRhPWUsdGhpcy5waXBlPSJwYXRjaCJ9O1BhdGNoQ29udGV4dC5wcm90b3R5cGU9bmV3IENvbnRleHQsZXhwb3J0cy5QYXRjaENvbnRleHQ9UGF0Y2hDb250ZXh0Owp9LHsiLi9jb250ZXh0IjozfV0sNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBDb250ZXh0PXJlcXVpcmUoIi4vY29udGV4dCIpLkNvbnRleHQsUmV2ZXJzZUNvbnRleHQ9ZnVuY3Rpb24oZSl7dGhpcy5kZWx0YT1lLHRoaXMucGlwZT0icmV2ZXJzZSJ9O1JldmVyc2VDb250ZXh0LnByb3RvdHlwZT1uZXcgQ29udGV4dCxleHBvcnRzLlJldmVyc2VDb250ZXh0PVJldmVyc2VDb250ZXh0Owp9LHsiLi9jb250ZXh0IjozfV0sNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPWZ1bmN0aW9uKGQsZSl7dmFyIHQ7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiYodD0vXihcZHs0fSktKFxkezJ9KS0oXGR7Mn0pVChcZHsyfSk6KFxkezJ9KTooXGR7Mn0pKD86XC4oXGQqKSk/KFp8KFsrXC1dKShcZHsyfSk6KFxkezJ9KSkkLy5leGVjKGUpKT9uZXcgRGF0ZShEYXRlLlVUQygrdFsxXSwrdFsyXS0xLCt0WzNdLCt0WzRdLCt0WzVdLCt0WzZdLCsodFs3XXx8MCkpKTplfTsKfSx7fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBQcm9jZXNzb3I9cmVxdWlyZSgiLi9wcm9jZXNzb3IiKS5Qcm9jZXNzb3IsUGlwZT1yZXF1aXJlKCIuL3BpcGUiKS5QaXBlLERpZmZDb250ZXh0PXJlcXVpcmUoIi4vY29udGV4dHMvZGlmZiIpLkRpZmZDb250ZXh0LFBhdGNoQ29udGV4dD1yZXF1aXJlKCIuL2NvbnRleHRzL3BhdGNoIikuUGF0Y2hDb250ZXh0LFJldmVyc2VDb250ZXh0PXJlcXVpcmUoIi4vY29udGV4dHMvcmV2ZXJzZSIpLlJldmVyc2VDb250ZXh0LHRyaXZpYWw9cmVxdWlyZSgiLi9maWx0ZXJzL3RyaXZpYWwiKSxuZXN0ZWQ9cmVxdWlyZSgiLi9maWx0ZXJzL25lc3RlZCIpLGFycmF5cz1yZXF1aXJlKCIuL2ZpbHRlcnMvYXJyYXlzIiksZGF0ZXM9cmVxdWlyZSgiLi9maWx0ZXJzL2RhdGVzIiksdGV4dHM9cmVxdWlyZSgiLi9maWx0ZXJzL3RleHRzIiksRGlmZlBhdGNoZXI9ZnVuY3Rpb24oZSl7dGhpcy5wcm9jZXNzb3I9bmV3IFByb2Nlc3NvcihlKSx0aGlzLnByb2Nlc3Nvci5waXBlKG5ldyBQaXBlKCJkaWZmIikuYXBwZW5kKG5lc3RlZC5jb2xsZWN0Q2hpbGRyZW5EaWZmRmlsdGVyLHRyaXZpYWwuZGlmZkZpbHRlcixkYXRlcy5kaWZmRmlsdGVyLHRleHRzLmRpZmZGaWx0ZXIsbmVzdGVkLm9iamVjdHNEaWZmRmlsdGVyLGFycmF5cy5kaWZmRmlsdGVyKS5zaG91bGRIYXZlUmVzdWx0KCkpLHRoaXMucHJvY2Vzc29yLnBpcGUobmV3IFBpcGUoInBhdGNoIikuYXBwZW5kKG5lc3RlZC5jb2xsZWN0Q2hpbGRyZW5QYXRjaEZpbHRlcixhcnJheXMuY29sbGVjdENoaWxkcmVuUGF0Y2hGaWx0ZXIsdHJpdmlhbC5wYXRjaEZpbHRlcix0ZXh0cy5wYXRjaEZpbHRlcixuZXN0ZWQucGF0Y2hGaWx0ZXIsYXJyYXlzLnBhdGNoRmlsdGVyKS5zaG91bGRIYXZlUmVzdWx0KCkpLHRoaXMucHJvY2Vzc29yLnBpcGUobmV3IFBpcGUoInJldmVyc2UiKS5hcHBlbmQobmVzdGVkLmNvbGxlY3RDaGlsZHJlblJldmVyc2VGaWx0ZXIsYXJyYXlzLmNvbGxlY3RDaGlsZHJlblJldmVyc2VGaWx0ZXIsdHJpdmlhbC5yZXZlcnNlRmlsdGVyLHRleHRzLnJldmVyc2VGaWx0ZXIsbmVzdGVkLnJldmVyc2VGaWx0ZXIsYXJyYXlzLnJldmVyc2VGaWx0ZXIpLnNob3VsZEhhdmVSZXN1bHQoKSl9O0RpZmZQYXRjaGVyLnByb3RvdHlwZS5vcHRpb25zPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJvY2Vzc29yLm9wdGlvbnMuYXBwbHkodGhpcy5wcm9jZXNzb3IsYXJndW1lbnRzKX0sRGlmZlBhdGNoZXIucHJvdG90eXBlLmRpZmY9ZnVuY3Rpb24oZSxyKXtyZXR1cm4gdGhpcy5wcm9jZXNzb3IucHJvY2VzcyhuZXcgRGlmZkNvbnRleHQoZSxyKSl9LERpZmZQYXRjaGVyLnByb3RvdHlwZS5wYXRjaD1mdW5jdGlvbihlLHIpe3JldHVybiB0aGlzLnByb2Nlc3Nvci5wcm9jZXNzKG5ldyBQYXRjaENvbnRleHQoZSxyKSl9LERpZmZQYXRjaGVyLnByb3RvdHlwZS5yZXZlcnNlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnByb2Nlc3Nvci5wcm9jZXNzKG5ldyBSZXZlcnNlQ29udGV4dChlKSl9LERpZmZQYXRjaGVyLnByb3RvdHlwZS51bnBhdGNoPWZ1bmN0aW9uKGUscil7cmV0dXJuIHRoaXMucGF0Y2goZSx0aGlzLnJldmVyc2UocikpfSxleHBvcnRzLkRpZmZQYXRjaGVyPURpZmZQYXRjaGVyOwp9LHsiLi9jb250ZXh0cy9kaWZmIjo0LCIuL2NvbnRleHRzL3BhdGNoIjo1LCIuL2NvbnRleHRzL3JldmVyc2UiOjYsIi4vZmlsdGVycy9hcnJheXMiOjEwLCIuL2ZpbHRlcnMvZGF0ZXMiOjExLCIuL2ZpbHRlcnMvbmVzdGVkIjoxMywiLi9maWx0ZXJzL3RleHRzIjoxNCwiLi9maWx0ZXJzL3RyaXZpYWwiOjE1LCIuL3BpcGUiOjE3LCIuL3Byb2Nlc3NvciI6MTh9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKZXhwb3J0cy5pc0Jyb3dzZXI9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c7Cn0se31dLDEwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKZnVuY3Rpb24gYXJyYXlzSGF2ZU1hdGNoQnlSZWYoZSx0LHIsaSl7Zm9yKHZhciBhPTA7cj5hO2ErKylmb3IodmFyIG49ZVthXSxsPTA7aT5sO2wrKyl7dmFyIHM9dFtsXTtpZihuPT09cylyZXR1cm4hMH19ZnVuY3Rpb24gbWF0Y2hJdGVtcyhlLHQscixpLGEpe3ZhciBuPWVbcl0sbD10W2ldO2lmKG49PT1sKXJldHVybiEwO2lmKCJvYmplY3QiIT10eXBlb2Ygbnx8Im9iamVjdCIhPXR5cGVvZiBsKXJldHVybiExO3ZhciBzPWEub2JqZWN0SGFzaDtpZighcylyZXR1cm4gYS5tYXRjaEJ5UG9zaXRpb24mJnI9PT1pO3ZhciBvLGY7cmV0dXJuIm51bWJlciI9PXR5cGVvZiByPyhhLmhhc2hDYWNoZTE9YS5oYXNoQ2FjaGUxfHxbXSxvPWEuaGFzaENhY2hlMVtyXSwidW5kZWZpbmVkIj09dHlwZW9mIG8mJihhLmhhc2hDYWNoZTFbcl09bz1zKG4scikpKTpvPXMobiksInVuZGVmaW5lZCI9PXR5cGVvZiBvPyExOigibnVtYmVyIj09dHlwZW9mIGk/KGEuaGFzaENhY2hlMj1hLmhhc2hDYWNoZTJ8fFtdLGY9YS5oYXNoQ2FjaGUyW2ldLCJ1bmRlZmluZWQiPT10eXBlb2YgZiYmKGEuaGFzaENhY2hlMltpXT1mPXMobCxpKSkpOmY9cyhsKSwidW5kZWZpbmVkIj09dHlwZW9mIGY/ITE6bz09PWYpfXZhciBEaWZmQ29udGV4dD1yZXF1aXJlKCIuLi9jb250ZXh0cy9kaWZmIikuRGlmZkNvbnRleHQsUGF0Y2hDb250ZXh0PXJlcXVpcmUoIi4uL2NvbnRleHRzL3BhdGNoIikuUGF0Y2hDb250ZXh0LFJldmVyc2VDb250ZXh0PXJlcXVpcmUoIi4uL2NvbnRleHRzL3JldmVyc2UiKS5SZXZlcnNlQ29udGV4dCxsY3M9cmVxdWlyZSgiLi9sY3MiKSxBUlJBWV9NT1ZFPTMsaXNBcnJheT0iZnVuY3Rpb24iPT10eXBlb2YgQXJyYXkuaXNBcnJheT9BcnJheS5pc0FycmF5OmZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgQXJyYXl9LGFycmF5SW5kZXhPZj0iZnVuY3Rpb24iPT10eXBlb2YgQXJyYXkucHJvdG90eXBlLmluZGV4T2Y/ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5pbmRleE9mKHQpfTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1lLmxlbmd0aCxpPTA7cj5pO2krKylpZihlW2ldPT09dClyZXR1cm4gaTtyZXR1cm4tMX0sZGlmZkZpbHRlcj1mdW5jdGlvbihlKXtpZihlLmxlZnRJc0FycmF5KXt2YXIgdCxyLGksYSxuPXtvYmplY3RIYXNoOmUub3B0aW9ucyYmZS5vcHRpb25zLm9iamVjdEhhc2gsbWF0Y2hCeVBvc2l0aW9uOmUub3B0aW9ucyYmZS5vcHRpb25zLm1hdGNoQnlQb3NpdGlvbn0sbD0wLHM9MCxvPWUubGVmdCxmPWUucmlnaHQsYz1vLmxlbmd0aCxoPWYubGVuZ3RoO2ZvcihjPjAmJmg+MCYmIW4ub2JqZWN0SGFzaCYmImJvb2xlYW4iIT10eXBlb2Ygbi5tYXRjaEJ5UG9zaXRpb24mJihuLm1hdGNoQnlQb3NpdGlvbj0hYXJyYXlzSGF2ZU1hdGNoQnlSZWYobyxmLGMsaCkpO2M+bCYmaD5sJiZtYXRjaEl0ZW1zKG8sZixsLGwsbik7KXQ9bCxhPW5ldyBEaWZmQ29udGV4dChlLmxlZnRbdF0sZS5yaWdodFt0XSksZS5wdXNoKGEsdCksbCsrO2Zvcig7Yz5zK2wmJmg+cytsJiZtYXRjaEl0ZW1zKG8sZixjLTEtcyxoLTEtcyxuKTspcj1jLTEtcyxpPWgtMS1zLGE9bmV3IERpZmZDb250ZXh0KGUubGVmdFtyXSxlLnJpZ2h0W2ldKSxlLnB1c2goYSxpKSxzKys7dmFyIHU7aWYobCtzPT09Yyl7aWYoYz09PWgpcmV0dXJuIHZvaWQgZS5zZXRSZXN1bHQodm9pZCAwKS5leGl0KCk7Zm9yKHU9dXx8e190OiJhIn0sdD1sO2gtcz50O3QrKyl1W3RdPVtmW3RdXTtyZXR1cm4gdm9pZCBlLnNldFJlc3VsdCh1KS5leGl0KCl9aWYobCtzPT09aCl7Zm9yKHU9dXx8e190OiJhIn0sdD1sO2Mtcz50O3QrKyl1WyJfIit0XT1bb1t0XSwwLDBdO3JldHVybiB2b2lkIGUuc2V0UmVzdWx0KHUpLmV4aXQoKX1kZWxldGUgbi5oYXNoQ2FjaGUxLGRlbGV0ZSBuLmhhc2hDYWNoZTI7dmFyIGQ9by5zbGljZShsLGMtcyksdj1mLnNsaWNlKGwsaC1zKSxwPWxjcy5nZXQoZCx2LG1hdGNoSXRlbXMsbikseT1bXTtmb3IodT11fHx7X3Q6ImEifSx0PWw7Yy1zPnQ7dCsrKWFycmF5SW5kZXhPZihwLmluZGljZXMxLHQtbCk8MCYmKHVbIl8iK3RdPVtvW3RdLDAsMF0seS5wdXNoKHQpKTt2YXIgeD0hMDtlLm9wdGlvbnMmJmUub3B0aW9ucy5hcnJheXMmJmUub3B0aW9ucy5hcnJheXMuZGV0ZWN0TW92ZT09PSExJiYoeD0hMSk7dmFyIG09ITE7ZS5vcHRpb25zJiZlLm9wdGlvbnMuYXJyYXlzJiZlLm9wdGlvbnMuYXJyYXlzLmluY2x1ZGVWYWx1ZU9uTW92ZSYmKG09ITApO3ZhciBDPXkubGVuZ3RoO2Zvcih0PWw7aC1zPnQ7dCsrKXt2YXIgUj1hcnJheUluZGV4T2YocC5pbmRpY2VzMix0LWwpO2lmKDA+Uil7dmFyIEE9ITE7aWYoeCYmQz4wKWZvcih2YXIgXz0wO0M+XztfKyspaWYocj15W19dLG1hdGNoSXRlbXMoZCx2LHItbCx0LWwsbikpe3VbIl8iK3JdLnNwbGljZSgxLDIsdCxBUlJBWV9NT1ZFKSxtfHwodVsiXyIrcl1bMF09IiIpLGk9dCxhPW5ldyBEaWZmQ29udGV4dChlLmxlZnRbcl0sZS5yaWdodFtpXSksZS5wdXNoKGEsaSkseS5zcGxpY2UoXywxKSxBPSEwO2JyZWFrfUF8fCh1W3RdPVtmW3RdXSl9ZWxzZSByPXAuaW5kaWNlczFbUl0rbCxpPXAuaW5kaWNlczJbUl0rbCxhPW5ldyBEaWZmQ29udGV4dChlLmxlZnRbcl0sZS5yaWdodFtpXSksZS5wdXNoKGEsaSl9ZS5zZXRSZXN1bHQodSkuZXhpdCgpfX07ZGlmZkZpbHRlci5maWx0ZXJOYW1lPSJhcnJheXMiO3ZhciBjb21wYXJlPXtudW1lcmljYWxseTpmdW5jdGlvbihlLHQpe3JldHVybiBlLXR9LG51bWVyaWNhbGx5Qnk6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQscil7cmV0dXJuIHRbZV0tcltlXX19fSxwYXRjaEZpbHRlcj1mdW5jdGlvbihlKXtpZihlLm5lc3RlZCYmImEiPT09ZS5kZWx0YS5fdCl7dmFyIHQscixpPWUuZGVsdGEsYT1lLmxlZnQsbj1bXSxsPVtdLHM9W107Zm9yKHQgaW4gaSlpZigiX3QiIT09dClpZigiXyI9PT10WzBdKXtpZigwIT09aVt0XVsyXSYmaVt0XVsyXSE9PUFSUkFZX01PVkUpdGhyb3cgbmV3IEVycm9yKCJvbmx5IHJlbW92YWwgb3IgbW92ZSBjYW4gYmUgYXBwbGllZCBhdCBvcmlnaW5hbCBhcnJheSBpbmRpY2VzLCBpbnZhbGlkIGRpZmYgdHlwZTogIitpW3RdWzJdKTtuLnB1c2gocGFyc2VJbnQodC5zbGljZSgxKSwxMCkpfWVsc2UgMT09PWlbdF0ubGVuZ3RoP2wucHVzaCh7aW5kZXg6cGFyc2VJbnQodCwxMCksdmFsdWU6aVt0XVswXX0pOnMucHVzaCh7aW5kZXg6cGFyc2VJbnQodCwxMCksZGVsdGE6aVt0XX0pO2ZvcihuPW4uc29ydChjb21wYXJlLm51bWVyaWNhbGx5KSx0PW4ubGVuZ3RoLTE7dD49MDt0LS0pe3I9blt0XTt2YXIgbz1pWyJfIityXSxmPWEuc3BsaWNlKHIsMSlbMF07b1syXT09PUFSUkFZX01PVkUmJmwucHVzaCh7aW5kZXg6b1sxXSx2YWx1ZTpmfSl9bD1sLnNvcnQoY29tcGFyZS5udW1lcmljYWxseUJ5KCJpbmRleCIpKTt2YXIgYz1sLmxlbmd0aDtmb3IodD0wO2M+dDt0Kyspe3ZhciBoPWxbdF07YS5zcGxpY2UoaC5pbmRleCwwLGgudmFsdWUpfXZhciB1LGQ9cy5sZW5ndGg7aWYoZD4wKWZvcih0PTA7ZD50O3QrKyl7dmFyIHY9c1t0XTt1PW5ldyBQYXRjaENvbnRleHQoZS5sZWZ0W3YuaW5kZXhdLHYuZGVsdGEpLGUucHVzaCh1LHYuaW5kZXgpfXJldHVybiBlLmNoaWxkcmVuP3ZvaWQgZS5leGl0KCk6dm9pZCBlLnNldFJlc3VsdChlLmxlZnQpLmV4aXQoKX19O3BhdGNoRmlsdGVyLmZpbHRlck5hbWU9ImFycmF5cyI7dmFyIGNvbGxlY3RDaGlsZHJlblBhdGNoRmlsdGVyPWZ1bmN0aW9uKGUpe2lmKGUmJmUuY2hpbGRyZW4mJiJhIj09PWUuZGVsdGEuX3Qpe2Zvcih2YXIgdCxyPWUuY2hpbGRyZW4ubGVuZ3RoLGk9MDtyPmk7aSsrKXQ9ZS5jaGlsZHJlbltpXSxlLmxlZnRbdC5jaGlsZE5hbWVdPXQucmVzdWx0O2Uuc2V0UmVzdWx0KGUubGVmdCkuZXhpdCgpfX07Y29sbGVjdENoaWxkcmVuUGF0Y2hGaWx0ZXIuZmlsdGVyTmFtZT0iYXJyYXlzQ29sbGVjdENoaWxkcmVuIjt2YXIgcmV2ZXJzZUZpbHRlcj1mdW5jdGlvbihlKXtpZighZS5uZXN0ZWQpcmV0dXJuIHZvaWQoZS5kZWx0YVsyXT09PUFSUkFZX01PVkUmJihlLm5ld05hbWU9Il8iK2UuZGVsdGFbMV0sZS5zZXRSZXN1bHQoW2UuZGVsdGFbMF0scGFyc2VJbnQoZS5jaGlsZE5hbWUuc3Vic3RyKDEpLDEwKSxBUlJBWV9NT1ZFXSkuZXhpdCgpKSk7aWYoImEiPT09ZS5kZWx0YS5fdCl7dmFyIHQscjtmb3IodCBpbiBlLmRlbHRhKSJfdCIhPT10JiYocj1uZXcgUmV2ZXJzZUNvbnRleHQoZS5kZWx0YVt0XSksZS5wdXNoKHIsdCkpO2UuZXhpdCgpfX07cmV2ZXJzZUZpbHRlci5maWx0ZXJOYW1lPSJhcnJheXMiO3ZhciByZXZlcnNlQXJyYXlEZWx0YUluZGV4PWZ1bmN0aW9uKGUsdCxyKXtpZigic3RyaW5nIj09dHlwZW9mIHQmJiJfIj09PXRbMF0pcmV0dXJuIHBhcnNlSW50KHQuc3Vic3RyKDEpLDEwKTtpZihpc0FycmF5KHIpJiYwPT09clsyXSlyZXR1cm4iXyIrdDt2YXIgaT0rdDtmb3IodmFyIGEgaW4gZSl7dmFyIG49ZVthXTtpZihpc0FycmF5KG4pKWlmKG5bMl09PT1BUlJBWV9NT1ZFKXt2YXIgbD1wYXJzZUludChhLnN1YnN0cigxKSwxMCkscz1uWzFdO2lmKHM9PT0rdClyZXR1cm4gbDtpPj1sJiZzPmk/aSsrOmw+PWkmJmk+cyYmaS0tfWVsc2UgaWYoMD09PW5bMl0pe3ZhciBvPXBhcnNlSW50KGEuc3Vic3RyKDEpLDEwKTtpPj1vJiZpKyt9ZWxzZSAxPT09bi5sZW5ndGgmJmk+PWEmJmktLX1yZXR1cm4gaX0sY29sbGVjdENoaWxkcmVuUmV2ZXJzZUZpbHRlcj1mdW5jdGlvbihlKXtpZihlJiZlLmNoaWxkcmVuJiYiYSI9PT1lLmRlbHRhLl90KXtmb3IodmFyIHQscj1lLmNoaWxkcmVuLmxlbmd0aCxpPXtfdDoiYSJ9LGE9MDtyPmE7YSsrKXt0PWUuY2hpbGRyZW5bYV07dmFyIG49dC5uZXdOYW1lOyJ1bmRlZmluZWQiPT10eXBlb2YgbiYmKG49cmV2ZXJzZUFycmF5RGVsdGFJbmRleChlLmRlbHRhLHQuY2hpbGROYW1lLHQucmVzdWx0KSksaVtuXSE9PXQucmVzdWx0JiYoaVtuXT10LnJlc3VsdCl9ZS5zZXRSZXN1bHQoaSkuZXhpdCgpfX07Y29sbGVjdENoaWxkcmVuUmV2ZXJzZUZpbHRlci5maWx0ZXJOYW1lPSJhcnJheXNDb2xsZWN0Q2hpbGRyZW4iLGV4cG9ydHMuZGlmZkZpbHRlcj1kaWZmRmlsdGVyLGV4cG9ydHMucGF0Y2hGaWx0ZXI9cGF0Y2hGaWx0ZXIsZXhwb3J0cy5jb2xsZWN0Q2hpbGRyZW5QYXRjaEZpbHRlcj1jb2xsZWN0Q2hpbGRyZW5QYXRjaEZpbHRlcixleHBvcnRzLnJldmVyc2VGaWx0ZXI9cmV2ZXJzZUZpbHRlcixleHBvcnRzLmNvbGxlY3RDaGlsZHJlblJldmVyc2VGaWx0ZXI9Y29sbGVjdENoaWxkcmVuUmV2ZXJzZUZpbHRlcjsKfSx7Ii4uL2NvbnRleHRzL2RpZmYiOjQsIi4uL2NvbnRleHRzL3BhdGNoIjo1LCIuLi9jb250ZXh0cy9yZXZlcnNlIjo2LCIuL2xjcyI6MTJ9XSwxMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBkaWZmRmlsdGVyPWZ1bmN0aW9uKHQpe3QubGVmdCBpbnN0YW5jZW9mIERhdGU/KHQucmlnaHQgaW5zdGFuY2VvZiBEYXRlP3QubGVmdC5nZXRUaW1lKCkhPT10LnJpZ2h0LmdldFRpbWUoKT90LnNldFJlc3VsdChbdC5sZWZ0LHQucmlnaHRdKTp0LnNldFJlc3VsdCh2b2lkIDApOnQuc2V0UmVzdWx0KFt0LmxlZnQsdC5yaWdodF0pLHQuZXhpdCgpKTp0LnJpZ2h0IGluc3RhbmNlb2YgRGF0ZSYmdC5zZXRSZXN1bHQoW3QubGVmdCx0LnJpZ2h0XSkuZXhpdCgpfTtkaWZmRmlsdGVyLmZpbHRlck5hbWU9ImRhdGVzIixleHBvcnRzLmRpZmZGaWx0ZXI9ZGlmZkZpbHRlcjsKfSx7fV0sMTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgZGVmYXVsdE1hdGNoPWZ1bmN0aW9uKHQsZSxuLHIpe3JldHVybiB0W25dPT09ZVtyXX0sbGVuZ3RoTWF0cml4PWZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBjLGEsaT10Lmxlbmd0aCx1PWUubGVuZ3RoLGY9W2krMV07Zm9yKGM9MDtpKzE+YztjKyspZm9yKGZbY109W3UrMV0sYT0wO3UrMT5hO2ErKylmW2NdW2FdPTA7Zm9yKGYubWF0Y2g9bixjPTE7aSsxPmM7YysrKWZvcihhPTE7dSsxPmE7YSsrKW4odCxlLGMtMSxhLTEscik/ZltjXVthXT1mW2MtMV1bYS0xXSsxOmZbY11bYV09TWF0aC5tYXgoZltjLTFdW2FdLGZbY11bYS0xXSk7cmV0dXJuIGZ9LGJhY2t0cmFjaz1mdW5jdGlvbih0LGUsbixyLGMsYSl7aWYoMD09PXJ8fDA9PT1jKXJldHVybntzZXF1ZW5jZTpbXSxpbmRpY2VzMTpbXSxpbmRpY2VzMjpbXX07aWYodC5tYXRjaChlLG4sci0xLGMtMSxhKSl7dmFyIGk9YmFja3RyYWNrKHQsZSxuLHItMSxjLTEsYSk7cmV0dXJuIGkuc2VxdWVuY2UucHVzaChlW3ItMV0pLGkuaW5kaWNlczEucHVzaChyLTEpLGkuaW5kaWNlczIucHVzaChjLTEpLGl9cmV0dXJuIHRbcl1bYy0xXT50W3ItMV1bY10/YmFja3RyYWNrKHQsZSxuLHIsYy0xLGEpOmJhY2t0cmFjayh0LGUsbixyLTEsYyxhKX0sZ2V0PWZ1bmN0aW9uKHQsZSxuLHIpe3I9cnx8e307dmFyIGM9bGVuZ3RoTWF0cml4KHQsZSxufHxkZWZhdWx0TWF0Y2gsciksYT1iYWNrdHJhY2soYyx0LGUsdC5sZW5ndGgsZS5sZW5ndGgscik7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0JiYic3RyaW5nIj09dHlwZW9mIGUmJihhLnNlcXVlbmNlPWEuc2VxdWVuY2Uuam9pbigiIikpLGF9O2V4cG9ydHMuZ2V0PWdldDsKfSx7fV0sMTM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgRGlmZkNvbnRleHQ9cmVxdWlyZSgiLi4vY29udGV4dHMvZGlmZiIpLkRpZmZDb250ZXh0LFBhdGNoQ29udGV4dD1yZXF1aXJlKCIuLi9jb250ZXh0cy9wYXRjaCIpLlBhdGNoQ29udGV4dCxSZXZlcnNlQ29udGV4dD1yZXF1aXJlKCIuLi9jb250ZXh0cy9yZXZlcnNlIikuUmV2ZXJzZUNvbnRleHQsY29sbGVjdENoaWxkcmVuRGlmZkZpbHRlcj1mdW5jdGlvbihlKXtpZihlJiZlLmNoaWxkcmVuKXtmb3IodmFyIHQsbD1lLmNoaWxkcmVuLmxlbmd0aCxyPWUucmVzdWx0LGk9MDtsPmk7aSsrKXQ9ZS5jaGlsZHJlbltpXSwidW5kZWZpbmVkIiE9dHlwZW9mIHQucmVzdWx0JiYocj1yfHx7fSxyW3QuY2hpbGROYW1lXT10LnJlc3VsdCk7ciYmZS5sZWZ0SXNBcnJheSYmKHIuX3Q9ImEiKSxlLnNldFJlc3VsdChyKS5leGl0KCl9fTtjb2xsZWN0Q2hpbGRyZW5EaWZmRmlsdGVyLmZpbHRlck5hbWU9ImNvbGxlY3RDaGlsZHJlbiI7dmFyIG9iamVjdHNEaWZmRmlsdGVyPWZ1bmN0aW9uKGUpe2lmKCFlLmxlZnRJc0FycmF5JiYib2JqZWN0Ij09PWUubGVmdFR5cGUpe3ZhciB0LGw7Zm9yKHQgaW4gZS5sZWZ0KWw9bmV3IERpZmZDb250ZXh0KGUubGVmdFt0XSxlLnJpZ2h0W3RdKSxlLnB1c2gobCx0KTtmb3IodCBpbiBlLnJpZ2h0KSJ1bmRlZmluZWQiPT10eXBlb2YgZS5sZWZ0W3RdJiYobD1uZXcgRGlmZkNvbnRleHQodm9pZCAwLGUucmlnaHRbdF0pLGUucHVzaChsLHQpKTtyZXR1cm4gZS5jaGlsZHJlbiYmMCE9PWUuY2hpbGRyZW4ubGVuZ3RoP3ZvaWQgZS5leGl0KCk6dm9pZCBlLnNldFJlc3VsdCh2b2lkIDApLmV4aXQoKX19O29iamVjdHNEaWZmRmlsdGVyLmZpbHRlck5hbWU9Im9iamVjdHMiO3ZhciBwYXRjaEZpbHRlcj1mdW5jdGlvbihlKXtpZihlLm5lc3RlZCYmIWUuZGVsdGEuX3Qpe3ZhciB0LGw7Zm9yKHQgaW4gZS5kZWx0YSlsPW5ldyBQYXRjaENvbnRleHQoZS5sZWZ0W3RdLGUuZGVsdGFbdF0pLGUucHVzaChsLHQpO2UuZXhpdCgpfX07cGF0Y2hGaWx0ZXIuZmlsdGVyTmFtZT0ib2JqZWN0cyI7dmFyIGNvbGxlY3RDaGlsZHJlblBhdGNoRmlsdGVyPWZ1bmN0aW9uKGUpe2lmKGUmJmUuY2hpbGRyZW4mJiFlLmRlbHRhLl90KXtmb3IodmFyIHQsbD1lLmNoaWxkcmVuLmxlbmd0aCxyPTA7bD5yO3IrKyl0PWUuY2hpbGRyZW5bcl0sZS5sZWZ0Lmhhc093blByb3BlcnR5KHQuY2hpbGROYW1lKSYmdm9pZCAwPT09dC5yZXN1bHQ/ZGVsZXRlIGUubGVmdFt0LmNoaWxkTmFtZV06ZS5sZWZ0W3QuY2hpbGROYW1lXSE9PXQucmVzdWx0JiYoZS5sZWZ0W3QuY2hpbGROYW1lXT10LnJlc3VsdCk7ZS5zZXRSZXN1bHQoZS5sZWZ0KS5leGl0KCl9fTtjb2xsZWN0Q2hpbGRyZW5QYXRjaEZpbHRlci5maWx0ZXJOYW1lPSJjb2xsZWN0Q2hpbGRyZW4iO3ZhciByZXZlcnNlRmlsdGVyPWZ1bmN0aW9uKGUpe2lmKGUubmVzdGVkJiYhZS5kZWx0YS5fdCl7dmFyIHQsbDtmb3IodCBpbiBlLmRlbHRhKWw9bmV3IFJldmVyc2VDb250ZXh0KGUuZGVsdGFbdF0pLGUucHVzaChsLHQpO2UuZXhpdCgpfX07cmV2ZXJzZUZpbHRlci5maWx0ZXJOYW1lPSJvYmplY3RzIjt2YXIgY29sbGVjdENoaWxkcmVuUmV2ZXJzZUZpbHRlcj1mdW5jdGlvbihlKXtpZihlJiZlLmNoaWxkcmVuJiYhZS5kZWx0YS5fdCl7Zm9yKHZhciB0LGw9ZS5jaGlsZHJlbi5sZW5ndGgscj17fSxpPTA7bD5pO2krKyl0PWUuY2hpbGRyZW5baV0sclt0LmNoaWxkTmFtZV0hPT10LnJlc3VsdCYmKHJbdC5jaGlsZE5hbWVdPXQucmVzdWx0KTtlLnNldFJlc3VsdChyKS5leGl0KCl9fTtjb2xsZWN0Q2hpbGRyZW5SZXZlcnNlRmlsdGVyLmZpbHRlck5hbWU9ImNvbGxlY3RDaGlsZHJlbiIsZXhwb3J0cy5jb2xsZWN0Q2hpbGRyZW5EaWZmRmlsdGVyPWNvbGxlY3RDaGlsZHJlbkRpZmZGaWx0ZXIsZXhwb3J0cy5vYmplY3RzRGlmZkZpbHRlcj1vYmplY3RzRGlmZkZpbHRlcixleHBvcnRzLnBhdGNoRmlsdGVyPXBhdGNoRmlsdGVyLGV4cG9ydHMuY29sbGVjdENoaWxkcmVuUGF0Y2hGaWx0ZXI9Y29sbGVjdENoaWxkcmVuUGF0Y2hGaWx0ZXIsZXhwb3J0cy5yZXZlcnNlRmlsdGVyPXJldmVyc2VGaWx0ZXIsZXhwb3J0cy5jb2xsZWN0Q2hpbGRyZW5SZXZlcnNlRmlsdGVyPWNvbGxlY3RDaGlsZHJlblJldmVyc2VGaWx0ZXI7Cn0seyIuLi9jb250ZXh0cy9kaWZmIjo0LCIuLi9jb250ZXh0cy9wYXRjaCI6NSwiLi4vY29udGV4dHMvcmV2ZXJzZSI6Nn1dLDE0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIFRFWFRfRElGRj0yLERFRkFVTFRfTUlOX0xFTkdUSD02MCxjYWNoZWREaWZmUGF0Y2g9bnVsbCxnZXREaWZmTWF0Y2hQYXRjaD1mdW5jdGlvbih0KXtpZighY2FjaGVkRGlmZlBhdGNoKXt2YXIgZTtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGRpZmZfbWF0Y2hfcGF0Y2gpZT0iZnVuY3Rpb24iPT10eXBlb2YgZGlmZl9tYXRjaF9wYXRjaD9uZXcgZGlmZl9tYXRjaF9wYXRjaDpuZXcgZGlmZl9tYXRjaF9wYXRjaC5kaWZmX21hdGNoX3BhdGNoO2Vsc2UgaWYoImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUpdHJ5e3ZhciBpPSJkaWZmX21hdGNoX3BhdGNoX3VuY29tcHJlc3NlZCIsZj1yZXF1aXJlKCIuLi8uLi9wdWJsaWMvZXh0ZXJuYWwvIitpKTtlPW5ldyBmLmRpZmZfbWF0Y2hfcGF0Y2h9Y2F0Y2gocil7ZT1udWxsfWlmKCFlKXtpZighdClyZXR1cm4gbnVsbDt2YXIgYT1uZXcgRXJyb3IoInRleHQgZGlmZl9tYXRjaF9wYXRjaCBsaWJyYXJ5IG5vdCBmb3VuZCIpO3Rocm93IGEuZGlmZl9tYXRjaF9wYXRjaF9ub3RfZm91bmQ9ITAsYX1jYWNoZWREaWZmUGF0Y2g9e2RpZmY6ZnVuY3Rpb24odCxpKXtyZXR1cm4gZS5wYXRjaF90b1RleHQoZS5wYXRjaF9tYWtlKHQsaSkpfSxwYXRjaDpmdW5jdGlvbih0LGkpe2Zvcih2YXIgZj1lLnBhdGNoX2FwcGx5KGUucGF0Y2hfZnJvbVRleHQoaSksdCkscj0wO3I8ZlsxXS5sZW5ndGg7cisrKWlmKCFmWzFdW3JdKXt2YXIgYT1uZXcgRXJyb3IoInRleHQgcGF0Y2ggZmFpbGVkIik7YS50ZXh0UGF0Y2hGYWlsZWQ9ITB9cmV0dXJuIGZbMF19fX1yZXR1cm4gY2FjaGVkRGlmZlBhdGNofSxkaWZmRmlsdGVyPWZ1bmN0aW9uKHQpe2lmKCJzdHJpbmciPT09dC5sZWZ0VHlwZSl7dmFyIGU9dC5vcHRpb25zJiZ0Lm9wdGlvbnMudGV4dERpZmYmJnQub3B0aW9ucy50ZXh0RGlmZi5taW5MZW5ndGh8fERFRkFVTFRfTUlOX0xFTkdUSDtpZih0LmxlZnQubGVuZ3RoPGV8fHQucmlnaHQubGVuZ3RoPGUpcmV0dXJuIHZvaWQgdC5zZXRSZXN1bHQoW3QubGVmdCx0LnJpZ2h0XSkuZXhpdCgpO3ZhciBpPWdldERpZmZNYXRjaFBhdGNoKCk7aWYoIWkpcmV0dXJuIHZvaWQgdC5zZXRSZXN1bHQoW3QubGVmdCx0LnJpZ2h0XSkuZXhpdCgpO3ZhciBmPWkuZGlmZjt0LnNldFJlc3VsdChbZih0LmxlZnQsdC5yaWdodCksMCxURVhUX0RJRkZdKS5leGl0KCl9fTtkaWZmRmlsdGVyLmZpbHRlck5hbWU9InRleHRzIjt2YXIgcGF0Y2hGaWx0ZXI9ZnVuY3Rpb24odCl7aWYoIXQubmVzdGVkJiZ0LmRlbHRhWzJdPT09VEVYVF9ESUZGKXt2YXIgZT1nZXREaWZmTWF0Y2hQYXRjaCghMCkucGF0Y2g7dC5zZXRSZXN1bHQoZSh0LmxlZnQsdC5kZWx0YVswXSkpLmV4aXQoKX19O3BhdGNoRmlsdGVyLmZpbHRlck5hbWU9InRleHRzIjt2YXIgdGV4dERlbHRhUmV2ZXJzZT1mdW5jdGlvbih0KXt2YXIgZSxpLGYscixhLGMsbCxuLGg9bnVsbCxkPS9eQEAgK1wtKFxkKyksKFxkKykgK1wrKFxkKyksKFxkKykgK0BAJC87Zm9yKGY9dC5zcGxpdCgiXG4iKSxlPTAsaT1mLmxlbmd0aDtpPmU7ZSsrKXtyPWZbZV07dmFyIG89ci5zbGljZSgwLDEpOyJAIj09PW8/KGg9ZC5leGVjKHIpLGM9ZSxsPW51bGwsbj1udWxsLGZbY109IkBAIC0iK2hbM10rIiwiK2hbNF0rIiArIitoWzFdKyIsIitoWzJdKyIgQEAiKToiKyI9PT1vPyhsPWUsZltlXT0iLSIrZltlXS5zbGljZSgxKSwiKyI9PT1mW2UtMV0uc2xpY2UoMCwxKSYmKGE9ZltlXSxmW2VdPWZbZS0xXSxmW2UtMV09YSkpOiItIj09PW8mJihuPWUsZltlXT0iKyIrZltlXS5zbGljZSgxKSl9cmV0dXJuIGYuam9pbigiXG4iKX0scmV2ZXJzZUZpbHRlcj1mdW5jdGlvbih0KXt0Lm5lc3RlZHx8dC5kZWx0YVsyXT09PVRFWFRfRElGRiYmdC5zZXRSZXN1bHQoW3RleHREZWx0YVJldmVyc2UodC5kZWx0YVswXSksMCxURVhUX0RJRkZdKS5leGl0KCl9O3JldmVyc2VGaWx0ZXIuZmlsdGVyTmFtZT0idGV4dHMiLGV4cG9ydHMuZGlmZkZpbHRlcj1kaWZmRmlsdGVyLGV4cG9ydHMucGF0Y2hGaWx0ZXI9cGF0Y2hGaWx0ZXIsZXhwb3J0cy5yZXZlcnNlRmlsdGVyPXJldmVyc2VGaWx0ZXI7Cn0se31dLDE1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGlzQXJyYXk9ImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5LmlzQXJyYXk/QXJyYXkuaXNBcnJheTpmdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIEFycmF5fSxkaWZmRmlsdGVyPWZ1bmN0aW9uKGUpe2lmKGUubGVmdD09PWUucmlnaHQpcmV0dXJuIHZvaWQgZS5zZXRSZXN1bHQodm9pZCAwKS5leGl0KCk7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlLmxlZnQpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlLnJpZ2h0KXRocm93IG5ldyBFcnJvcigiZnVuY3Rpb25zIGFyZSBub3Qgc3VwcG9ydGVkIik7cmV0dXJuIHZvaWQgZS5zZXRSZXN1bHQoW2UucmlnaHRdKS5leGl0KCl9aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlLnJpZ2h0KXJldHVybiB2b2lkIGUuc2V0UmVzdWx0KFtlLmxlZnQsMCwwXSkuZXhpdCgpO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlLmxlZnR8fCJmdW5jdGlvbiI9PXR5cGVvZiBlLnJpZ2h0KXRocm93IG5ldyBFcnJvcigiZnVuY3Rpb25zIGFyZSBub3Qgc3VwcG9ydGVkIik7cmV0dXJuIGUubGVmdFR5cGU9bnVsbD09PWUubGVmdD8ibnVsbCI6dHlwZW9mIGUubGVmdCxlLnJpZ2h0VHlwZT1udWxsPT09ZS5yaWdodD8ibnVsbCI6dHlwZW9mIGUucmlnaHQsZS5sZWZ0VHlwZSE9PWUucmlnaHRUeXBlP3ZvaWQgZS5zZXRSZXN1bHQoW2UubGVmdCxlLnJpZ2h0XSkuZXhpdCgpOiJib29sZWFuIj09PWUubGVmdFR5cGV8fCJudW1iZXIiPT09ZS5sZWZ0VHlwZT92b2lkIGUuc2V0UmVzdWx0KFtlLmxlZnQsZS5yaWdodF0pLmV4aXQoKTooIm9iamVjdCI9PT1lLmxlZnRUeXBlJiYoZS5sZWZ0SXNBcnJheT1pc0FycmF5KGUubGVmdCkpLCJvYmplY3QiPT09ZS5yaWdodFR5cGUmJihlLnJpZ2h0SXNBcnJheT1pc0FycmF5KGUucmlnaHQpKSxlLmxlZnRJc0FycmF5IT09ZS5yaWdodElzQXJyYXk/dm9pZCBlLnNldFJlc3VsdChbZS5sZWZ0LGUucmlnaHRdKS5leGl0KCk6dm9pZCAwKX07ZGlmZkZpbHRlci5maWx0ZXJOYW1lPSJ0cml2aWFsIjt2YXIgcGF0Y2hGaWx0ZXI9ZnVuY3Rpb24oZSl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBlLmRlbHRhP3ZvaWQgZS5zZXRSZXN1bHQoZS5sZWZ0KS5leGl0KCk6KGUubmVzdGVkPSFpc0FycmF5KGUuZGVsdGEpLGUubmVzdGVkP3ZvaWQgMDoxPT09ZS5kZWx0YS5sZW5ndGg/dm9pZCBlLnNldFJlc3VsdChlLmRlbHRhWzBdKS5leGl0KCk6Mj09PWUuZGVsdGEubGVuZ3RoP3ZvaWQgZS5zZXRSZXN1bHQoZS5kZWx0YVsxXSkuZXhpdCgpOjM9PT1lLmRlbHRhLmxlbmd0aCYmMD09PWUuZGVsdGFbMl0/dm9pZCBlLnNldFJlc3VsdCh2b2lkIDApLmV4aXQoKTp2b2lkIDApfTtwYXRjaEZpbHRlci5maWx0ZXJOYW1lPSJ0cml2aWFsIjt2YXIgcmV2ZXJzZUZpbHRlcj1mdW5jdGlvbihlKXtyZXR1cm4idW5kZWZpbmVkIj09dHlwZW9mIGUuZGVsdGE/dm9pZCBlLnNldFJlc3VsdChlLmRlbHRhKS5leGl0KCk6KGUubmVzdGVkPSFpc0FycmF5KGUuZGVsdGEpLGUubmVzdGVkP3ZvaWQgMDoxPT09ZS5kZWx0YS5sZW5ndGg/dm9pZCBlLnNldFJlc3VsdChbZS5kZWx0YVswXSwwLDBdKS5leGl0KCk6Mj09PWUuZGVsdGEubGVuZ3RoP3ZvaWQgZS5zZXRSZXN1bHQoW2UuZGVsdGFbMV0sZS5kZWx0YVswXV0pLmV4aXQoKTozPT09ZS5kZWx0YS5sZW5ndGgmJjA9PT1lLmRlbHRhWzJdP3ZvaWQgZS5zZXRSZXN1bHQoW2UuZGVsdGFbMF1dKS5leGl0KCk6dm9pZCAwKX07cmV2ZXJzZUZpbHRlci5maWx0ZXJOYW1lPSJ0cml2aWFsIixleHBvcnRzLmRpZmZGaWx0ZXI9ZGlmZkZpbHRlcixleHBvcnRzLnBhdGNoRmlsdGVyPXBhdGNoRmlsdGVyLGV4cG9ydHMucmV2ZXJzZUZpbHRlcj1yZXZlcnNlRmlsdGVyOwp9LHt9XSwxNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBlbnZpcm9ubWVudD1yZXF1aXJlKCIuL2Vudmlyb25tZW50IiksRGlmZlBhdGNoZXI9cmVxdWlyZSgiLi9kaWZmcGF0Y2hlciIpLkRpZmZQYXRjaGVyO2V4cG9ydHMuRGlmZlBhdGNoZXI9RGlmZlBhdGNoZXIsZXhwb3J0cy5jcmVhdGU9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBEaWZmUGF0Y2hlcihlKX0sZXhwb3J0cy5kYXRlUmV2aXZlcj1yZXF1aXJlKCIuL2RhdGUtcmV2aXZlciIpO3ZhciBkZWZhdWx0SW5zdGFuY2U7aWYoZXhwb3J0cy5kaWZmPWZ1bmN0aW9uKCl7cmV0dXJuIGRlZmF1bHRJbnN0YW5jZXx8KGRlZmF1bHRJbnN0YW5jZT1uZXcgRGlmZlBhdGNoZXIpLGRlZmF1bHRJbnN0YW5jZS5kaWZmLmFwcGx5KGRlZmF1bHRJbnN0YW5jZSxhcmd1bWVudHMpfSxleHBvcnRzLnBhdGNoPWZ1bmN0aW9uKCl7cmV0dXJuIGRlZmF1bHRJbnN0YW5jZXx8KGRlZmF1bHRJbnN0YW5jZT1uZXcgRGlmZlBhdGNoZXIpLGRlZmF1bHRJbnN0YW5jZS5wYXRjaC5hcHBseShkZWZhdWx0SW5zdGFuY2UsYXJndW1lbnRzKX0sZXhwb3J0cy51bnBhdGNoPWZ1bmN0aW9uKCl7cmV0dXJuIGRlZmF1bHRJbnN0YW5jZXx8KGRlZmF1bHRJbnN0YW5jZT1uZXcgRGlmZlBhdGNoZXIpLGRlZmF1bHRJbnN0YW5jZS51bnBhdGNoLmFwcGx5KGRlZmF1bHRJbnN0YW5jZSxhcmd1bWVudHMpfSxleHBvcnRzLnJldmVyc2U9ZnVuY3Rpb24oKXtyZXR1cm4gZGVmYXVsdEluc3RhbmNlfHwoZGVmYXVsdEluc3RhbmNlPW5ldyBEaWZmUGF0Y2hlciksZGVmYXVsdEluc3RhbmNlLnJldmVyc2UuYXBwbHkoZGVmYXVsdEluc3RhbmNlLGFyZ3VtZW50cyl9LGVudmlyb25tZW50LmlzQnJvd3NlcilleHBvcnRzLmhvbWVwYWdlPSJodHRwczovL2dpdGh1Yi5jb20vYmVuamFtaW5lL2pzb25kaWZmcGF0Y2giLGV4cG9ydHMudmVyc2lvbj0iMC4xLjM4IjtlbHNle3ZhciBwYWNrYWdlSW5mb01vZHVsZU5hbWU9Ii4uL3BhY2thZ2UuanNvbiIscGFja2FnZUluZm89cmVxdWlyZShwYWNrYWdlSW5mb01vZHVsZU5hbWUpO2V4cG9ydHMuaG9tZXBhZ2U9cGFja2FnZUluZm8uaG9tZXBhZ2UsZXhwb3J0cy52ZXJzaW9uPXBhY2thZ2VJbmZvLnZlcnNpb247dmFyIGZvcm1hdHRlck1vZHVsZU5hbWU9Ii4vZm9ybWF0dGVycyIsZm9ybWF0dGVycz1yZXF1aXJlKGZvcm1hdHRlck1vZHVsZU5hbWUpO2V4cG9ydHMuZm9ybWF0dGVycz1mb3JtYXR0ZXJzLGV4cG9ydHMuY29uc29sZT1mb3JtYXR0ZXJzLmNvbnNvbGV9Cn0seyIuL2RhdGUtcmV2aXZlciI6NywiLi9kaWZmcGF0Y2hlciI6OCwiLi9lbnZpcm9ubWVudCI6OX1dLDE3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIFBpcGU9ZnVuY3Rpb24odCl7dGhpcy5uYW1lPXQsdGhpcy5maWx0ZXJzPVtdfTtQaXBlLnByb3RvdHlwZS5wcm9jZXNzPWZ1bmN0aW9uKHQpe2lmKCF0aGlzLnByb2Nlc3Nvcil0aHJvdyBuZXcgRXJyb3IoImFkZCB0aGlzIHBpcGUgdG8gYSBwcm9jZXNzb3IgYmVmb3JlIHVzaW5nIGl0Iik7Zm9yKHZhciBlPXRoaXMuZGVidWcscj10aGlzLmZpbHRlcnMubGVuZ3RoLGk9dCxzPTA7cj5zO3MrKyl7dmFyIG89dGhpcy5maWx0ZXJzW3NdO2lmKGUmJnRoaXMubG9nKCJmaWx0ZXI6ICIrby5maWx0ZXJOYW1lKSxvKGkpLCJvYmplY3QiPT10eXBlb2YgaSYmaS5leGl0aW5nKXtpLmV4aXRpbmc9ITE7YnJlYWt9fSFpLm5leHQmJnRoaXMucmVzdWx0Q2hlY2smJnRoaXMucmVzdWx0Q2hlY2soaSl9LFBpcGUucHJvdG90eXBlLmxvZz1mdW5jdGlvbih0KXtjb25zb2xlLmxvZygiW2pzb25kaWZmcGF0Y2hdICIrdGhpcy5uYW1lKyIgcGlwZSwgIit0KX0sUGlwZS5wcm90b3R5cGUuYXBwZW5kPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZmlsdGVycy5wdXNoLmFwcGx5KHRoaXMuZmlsdGVycyxhcmd1bWVudHMpLHRoaXN9LFBpcGUucHJvdG90eXBlLnByZXBlbmQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5maWx0ZXJzLnVuc2hpZnQuYXBwbHkodGhpcy5maWx0ZXJzLGFyZ3VtZW50cyksdGhpc30sUGlwZS5wcm90b3R5cGUuaW5kZXhPZj1mdW5jdGlvbih0KXtpZighdCl0aHJvdyBuZXcgRXJyb3IoImEgZmlsdGVyIG5hbWUgaXMgcmVxdWlyZWQiKTtmb3IodmFyIGU9MDtlPHRoaXMuZmlsdGVycy5sZW5ndGg7ZSsrKXt2YXIgcj10aGlzLmZpbHRlcnNbZV07aWYoci5maWx0ZXJOYW1lPT09dClyZXR1cm4gZX10aHJvdyBuZXcgRXJyb3IoImZpbHRlciBub3QgZm91bmQ6ICIrdCl9LFBpcGUucHJvdG90eXBlLmxpc3Q9ZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8dGhpcy5maWx0ZXJzLmxlbmd0aDtlKyspe3ZhciByPXRoaXMuZmlsdGVyc1tlXTt0LnB1c2goci5maWx0ZXJOYW1lKX1yZXR1cm4gdH0sUGlwZS5wcm90b3R5cGUuYWZ0ZXI9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5pbmRleE9mKHQpLHI9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2lmKCFyLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoImEgZmlsdGVyIGlzIHJlcXVpcmVkIik7cmV0dXJuIHIudW5zaGlmdChlKzEsMCksQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseSh0aGlzLmZpbHRlcnMsciksdGhpc30sUGlwZS5wcm90b3R5cGUuYmVmb3JlPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuaW5kZXhPZih0KSxyPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtpZighci5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJhIGZpbHRlciBpcyByZXF1aXJlZCIpO3JldHVybiByLnVuc2hpZnQoZSwwKSxBcnJheS5wcm90b3R5cGUuc3BsaWNlLmFwcGx5KHRoaXMuZmlsdGVycyxyKSx0aGlzfSxQaXBlLnByb3RvdHlwZS5jbGVhcj1mdW5jdGlvbigpe3JldHVybiB0aGlzLmZpbHRlcnMubGVuZ3RoPTAsdGhpc30sUGlwZS5wcm90b3R5cGUuc2hvdWxkSGF2ZVJlc3VsdD1mdW5jdGlvbih0KXtpZih0PT09ITEpcmV0dXJuIHZvaWQodGhpcy5yZXN1bHRDaGVjaz1udWxsKTtpZighdGhpcy5yZXN1bHRDaGVjayl7dmFyIGU9dGhpcztyZXR1cm4gdGhpcy5yZXN1bHRDaGVjaz1mdW5jdGlvbih0KXtpZighdC5oYXNSZXN1bHQpe2NvbnNvbGUubG9nKHQpO3ZhciByPW5ldyBFcnJvcihlLm5hbWUrIiBmYWlsZWQiKTt0aHJvdyByLm5vUmVzdWx0PSEwLHJ9fSx0aGlzfX0sZXhwb3J0cy5QaXBlPVBpcGU7Cn0se31dLDE4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIFByb2Nlc3Nvcj1mdW5jdGlvbihlKXt0aGlzLnNlbGZPcHRpb25zPWUsdGhpcy5waXBlcz17fX07UHJvY2Vzc29yLnByb3RvdHlwZS5vcHRpb25zPWZ1bmN0aW9uKGUpe3JldHVybiBlJiYodGhpcy5zZWxmT3B0aW9ucz1lKSx0aGlzLnNlbGZPcHRpb25zfSxQcm9jZXNzb3IucHJvdG90eXBlLnBpcGU9ZnVuY3Rpb24oZSx0KXtpZigic3RyaW5nIj09dHlwZW9mIGUpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgdClyZXR1cm4gdGhpcy5waXBlc1tlXTt0aGlzLnBpcGVzW2VdPXR9aWYoZSYmZS5uYW1lKXtpZih0PWUsdC5wcm9jZXNzb3I9PT10aGlzKXJldHVybiB0O3RoaXMucGlwZXNbdC5uYW1lXT10fXJldHVybiB0LnByb2Nlc3Nvcj10aGlzLHR9LFByb2Nlc3Nvci5wcm90b3R5cGUucHJvY2Vzcz1mdW5jdGlvbihlLHQpe3ZhciBzPWU7cy5vcHRpb25zPXRoaXMub3B0aW9ucygpO2Zvcih2YXIgcixvLGk9dHx8ZS5waXBlfHwiZGVmYXVsdCI7aTspInVuZGVmaW5lZCIhPXR5cGVvZiBzLm5leHRBZnRlckNoaWxkcmVuJiYocy5uZXh0PXMubmV4dEFmdGVyQ2hpbGRyZW4scy5uZXh0QWZ0ZXJDaGlsZHJlbj1udWxsKSwic3RyaW5nIj09dHlwZW9mIGkmJihpPXRoaXMucGlwZShpKSksaS5wcm9jZXNzKHMpLG89cyxyPWksaT1udWxsLHMmJnMubmV4dCYmKHM9cy5uZXh0LGk9by5uZXh0UGlwZXx8cy5waXBlfHxyKTtyZXR1cm4gcy5oYXNSZXN1bHQ/cy5yZXN1bHQ6dm9pZCAwfSxleHBvcnRzLlByb2Nlc3Nvcj1Qcm9jZXNzb3I7Cn0se31dfSx7fSxbMV0pKDEpCn0pOwoKLyoganNvbmRpZmZwYXRjaCBmb3JtYXR0ZXJzICovCgohZnVuY3Rpb24oZSl7aWYoIm9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYidW5kZWZpbmVkIiE9dHlwZW9mIG1vZHVsZSltb2R1bGUuZXhwb3J0cz1lKCk7ZWxzZSBpZigiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kKWRlZmluZShbXSxlKTtlbHNle3ZhciBmOyJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P2Y9d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2Y9Z2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZiYmKGY9c2VsZiksKGYuanNvbmRpZmZwYXRjaHx8KGYuanNvbmRpZmZwYXRjaD17fSkpLmZvcm1hdHRlcnM9ZSgpfX0oZnVuY3Rpb24oKXt2YXIgZGVmaW5lLG1vZHVsZSxleHBvcnRzO3JldHVybiAoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHM9cmVxdWlyZSgiLi9mb3JtYXR0ZXJzIik7Cn0seyIuL2Zvcm1hdHRlcnMiOjZ9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKZXhwb3J0cy5pc0Jyb3dzZXI9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c7Cn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgYmFzZT1yZXF1aXJlKCIuL2Jhc2UiKSxCYXNlRm9ybWF0dGVyPWJhc2UuQmFzZUZvcm1hdHRlcixBbm5vdGF0ZWRGb3JtYXR0ZXI9ZnVuY3Rpb24oKXt0aGlzLmluY2x1ZGVNb3ZlRGVzdGluYXRpb25zPSExfTtBbm5vdGF0ZWRGb3JtYXR0ZXIucHJvdG90eXBlPW5ldyBCYXNlRm9ybWF0dGVyLEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUucHJlcGFyZUNvbnRleHQ9ZnVuY3Rpb24odCl7QmFzZUZvcm1hdHRlci5wcm90b3R5cGUucHJlcGFyZUNvbnRleHQuY2FsbCh0aGlzLHQpLHQuaW5kZW50PWZ1bmN0aW9uKHQpe3RoaXMuaW5kZW50TGV2ZWw9KHRoaXMuaW5kZW50TGV2ZWx8fDApKygidW5kZWZpbmVkIj09dHlwZW9mIHQ/MTp0KSx0aGlzLmluZGVudFBhZD1uZXcgQXJyYXkodGhpcy5pbmRlbnRMZXZlbCsxKS5qb2luKCImbmJzcDsmbmJzcDsiKX0sdC5yb3c9ZnVuY3Rpb24oZSxuKXt0Lm91dCgnPHRyPjx0ZCBzdHlsZT0id2hpdGUtc3BhY2U6IG5vd3JhcDsiPjxwcmUgY2xhc3M9Impzb25kaWZmcGF0Y2gtYW5ub3RhdGVkLWluZGVudCIgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jayI+JyksdC5vdXQodC5pbmRlbnRQYWQpLHQub3V0KCc8L3ByZT48cHJlIHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2siPicpLHQub3V0KGUpLHQub3V0KCc8L3ByZT48L3RkPjx0ZCBjbGFzcz0ianNvbmRpZmZwYXRjaC1kZWx0YS1ub3RlIj48ZGl2PicpLHQub3V0KG4pLHQub3V0KCI8L2Rpdj48L3RkPjwvdHI+Iil9fSxBbm5vdGF0ZWRGb3JtYXR0ZXIucHJvdG90eXBlLnR5cGVGb3JtYXR0dGVyRXJyb3JGb3JtYXR0ZXI9ZnVuY3Rpb24odCxlKXt0LnJvdygiIiwnPHByZSBjbGFzcz0ianNvbmRpZmZwYXRjaC1lcnJvciI+JytlKyI8L3ByZT4iKX0sQW5ub3RhdGVkRm9ybWF0dGVyLnByb3RvdHlwZS5mb3JtYXRUZXh0RGlmZlN0cmluZz1mdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMucGFyc2VUZXh0RGlmZihlKTt0Lm91dCgnPHVsIGNsYXNzPSJqc29uZGlmZnBhdGNoLXRleHRkaWZmIj4nKTtmb3IodmFyIG89MCxyPW4ubGVuZ3RoO3I+bztvKyspe3ZhciBhPW5bb107dC5vdXQoJzxsaT48ZGl2IGNsYXNzPSJqc29uZGlmZnBhdGNoLXRleHRkaWZmLWxvY2F0aW9uIj48c3BhbiBjbGFzcz0ianNvbmRpZmZwYXRjaC10ZXh0ZGlmZi1saW5lLW51bWJlciI+JythLmxvY2F0aW9uLmxpbmUrJzwvc3Bhbj48c3BhbiBjbGFzcz0ianNvbmRpZmZwYXRjaC10ZXh0ZGlmZi1jaGFyIj4nK2EubG9jYXRpb24uY2hyKyc8L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0ianNvbmRpZmZwYXRjaC10ZXh0ZGlmZi1saW5lIj4nKTtmb3IodmFyIGk9YS5waWVjZXMsZD0wLHA9aS5sZW5ndGg7cD5kO2QrKyl7dmFyIGY9aVtkXTt0Lm91dCgnPHNwYW4gY2xhc3M9Impzb25kaWZmcGF0Y2gtdGV4dGRpZmYtJytmLnR5cGUrJyI+JytmLnRleHQrIjwvc3Bhbj4iKX10Lm91dCgiPC9kaXY+PC9saT4iKX10Lm91dCgiPC91bD4iKX0sQW5ub3RhdGVkRm9ybWF0dGVyLnByb3RvdHlwZS5yb290QmVnaW49ZnVuY3Rpb24odCxlLG4pe3Qub3V0KCc8dGFibGUgY2xhc3M9Impzb25kaWZmcGF0Y2gtYW5ub3RhdGVkLWRlbHRhIj4nKSwibm9kZSI9PT1lJiYodC5yb3coInsiKSx0LmluZGVudCgpKSwiYXJyYXkiPT09biYmdC5yb3coJyJfdCI6ICJhIiwnLCJBcnJheSBkZWx0YSAobWVtYmVyIG5hbWVzIGluZGljYXRlIGFycmF5IGluZGljZXMpIil9LEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUucm9vdEVuZD1mdW5jdGlvbih0LGUpeyJub2RlIj09PWUmJih0LmluZGVudCgtMSksdC5yb3coIn0iKSksdC5vdXQoIjwvdGFibGU+Iil9LEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUubm9kZUJlZ2luPWZ1bmN0aW9uKHQsZSxuLG8scil7dC5yb3coIiZxdW90OyIrZSsiJnF1b3Q7OiB7IiksIm5vZGUiPT09byYmdC5pbmRlbnQoKSwiYXJyYXkiPT09ciYmdC5yb3coJyJfdCI6ICJhIiwnLCJBcnJheSBkZWx0YSAobWVtYmVyIG5hbWVzIGluZGljYXRlIGFycmF5IGluZGljZXMpIil9LEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUubm9kZUVuZD1mdW5jdGlvbih0LGUsbixvLHIsYSl7Im5vZGUiPT09byYmdC5pbmRlbnQoLTEpLHQucm93KCJ9IisoYT8iIjoiLCIpKX0sQW5ub3RhdGVkRm9ybWF0dGVyLnByb3RvdHlwZS5mb3JtYXRfdW5jaGFuZ2VkPWZ1bmN0aW9uKCl7fSxBbm5vdGF0ZWRGb3JtYXR0ZXIucHJvdG90eXBlLmZvcm1hdF9tb3ZlZGVzdGluYXRpb249ZnVuY3Rpb24oKXt9LEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X25vZGU9ZnVuY3Rpb24odCxlLG4pe3RoaXMuZm9ybWF0RGVsdGFDaGlsZHJlbih0LGUsbil9O3ZhciB3cmFwUHJvcGVydHlOYW1lPWZ1bmN0aW9uKHQpe3JldHVybic8cHJlIHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jayI+JnF1b3Q7Jyt0KyImcXVvdDs8L3ByZT4ifSxkZWx0YUFubm90YXRpb25zPXthZGRlZDpmdW5jdGlvbih0LGUsbixvKXt2YXIgcj0iIDxwcmU+KFtuZXdWYWx1ZV0pPC9wcmU+IjtyZXR1cm4idW5kZWZpbmVkIj09dHlwZW9mIG8/Im5ldyB2YWx1ZSIrcjoibnVtYmVyIj09dHlwZW9mIG8/Imluc2VydCBhdCBpbmRleCAiK28rcjoiYWRkIHByb3BlcnR5ICIrd3JhcFByb3BlcnR5TmFtZShvKStyfSxtb2RpZmllZDpmdW5jdGlvbih0LGUsbixvKXt2YXIgcj0iIDxwcmU+KFtwcmV2aW91c1ZhbHVlLCBuZXdWYWx1ZV0pPC9wcmU+IjtyZXR1cm4idW5kZWZpbmVkIj09dHlwZW9mIG8/Im1vZGlmeSB2YWx1ZSIrcjoibnVtYmVyIj09dHlwZW9mIG8/Im1vZGlmeSBhdCBpbmRleCAiK28rcjoibW9kaWZ5IHByb3BlcnR5ICIrd3JhcFByb3BlcnR5TmFtZShvKStyfSxkZWxldGVkOmZ1bmN0aW9uKHQsZSxuLG8pe3ZhciByPSIgPHByZT4oW3ByZXZpb3VzVmFsdWUsIDAsIDBdKTwvcHJlPiI7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBvPyJkZWxldGUgdmFsdWUiK3I6Im51bWJlciI9PXR5cGVvZiBvPyJyZW1vdmUgaW5kZXggIitvK3I6ImRlbGV0ZSBwcm9wZXJ0eSAiK3dyYXBQcm9wZXJ0eU5hbWUobykrcn0sbW92ZWQ6ZnVuY3Rpb24odCxlLG4sbyl7cmV0dXJuJ21vdmUgZnJvbSA8c3BhbiB0aXRsZT0iKHBvc2l0aW9uIHRvIHJlbW92ZSBhdCBvcmlnaW5hbCBzdGF0ZSkiPmluZGV4ICcrbysnPC9zcGFuPiB0byA8c3BhbiB0aXRsZT0iKHBvc2l0aW9uIHRvIGluc2VydCBhdCBmaW5hbCBzdGF0ZSkiPmluZGV4ICcrdFsxXSsiPC9zcGFuPiJ9LHRleHRkaWZmOmZ1bmN0aW9uKHQsZSxuLG8pe3ZhciByPSJ1bmRlZmluZWQiPT10eXBlb2Ygbz8iIjoibnVtYmVyIj09dHlwZW9mIG8/IiBhdCBpbmRleCAiK286IiBhdCBwcm9wZXJ0eSAiK3dyYXBQcm9wZXJ0eU5hbWUobyk7cmV0dXJuInRleHQgZGlmZiIrcisnLCBmb3JtYXQgaXMgPGEgaHJlZj0iaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9nb29nbGUtZGlmZi1tYXRjaC1wYXRjaC93aWtpL1VuaWRpZmYiPmEgdmFyaWF0aW9uIG9mIFVuaWRpZmY8L2E+J319LGZvcm1hdEFueUNoYW5nZT1mdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuZ2V0RGVsdGFUeXBlKGUpLG89ZGVsdGFBbm5vdGF0aW9uc1tuXSxyPW8mJm8uYXBwbHkobyxBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSkpLGE9SlNPTi5zdHJpbmdpZnkoZSxudWxsLDIpOyJ0ZXh0ZGlmZiI9PT1uJiYoYT1hLnNwbGl0KCJcXG4iKS5qb2luKCdcXG4iK1xuICAgIicpKSx0LmluZGVudCgpLHQucm93KGEsciksdC5pbmRlbnQoLTEpfTtBbm5vdGF0ZWRGb3JtYXR0ZXIucHJvdG90eXBlLmZvcm1hdF9hZGRlZD1mb3JtYXRBbnlDaGFuZ2UsQW5ub3RhdGVkRm9ybWF0dGVyLnByb3RvdHlwZS5mb3JtYXRfbW9kaWZpZWQ9Zm9ybWF0QW55Q2hhbmdlLEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X2RlbGV0ZWQ9Zm9ybWF0QW55Q2hhbmdlLEFubm90YXRlZEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X21vdmVkPWZvcm1hdEFueUNoYW5nZSxBbm5vdGF0ZWRGb3JtYXR0ZXIucHJvdG90eXBlLmZvcm1hdF90ZXh0ZGlmZj1mb3JtYXRBbnlDaGFuZ2UsZXhwb3J0cy5Bbm5vdGF0ZWRGb3JtYXR0ZXI9QW5ub3RhdGVkRm9ybWF0dGVyO3ZhciBkZWZhdWx0SW5zdGFuY2U7ZXhwb3J0cy5mb3JtYXQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gZGVmYXVsdEluc3RhbmNlfHwoZGVmYXVsdEluc3RhbmNlPW5ldyBBbm5vdGF0ZWRGb3JtYXR0ZXIpLGRlZmF1bHRJbnN0YW5jZS5mb3JtYXQodCxlKX07Cn0seyIuL2Jhc2UiOjR9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGlzQXJyYXk9ImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5LmlzQXJyYXk/QXJyYXkuaXNBcnJheTpmdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIEFycmF5fSxnZXRPYmplY3RLZXlzPSJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3Qua2V5cz9mdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmtleXMoZSl9OmZ1bmN0aW9uKGUpe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBlKWUuaGFzT3duUHJvcGVydHkocikmJnQucHVzaChyKTtyZXR1cm4gdH0sdHJpbVVuZGVyc2NvcmU9ZnVuY3Rpb24oZSl7cmV0dXJuIl8iPT09ZS5zdWJzdHIoMCwxKT9lLnNsaWNlKDEpOmV9LGFycmF5S2V5VG9Tb3J0TnVtYmVyPWZ1bmN0aW9uKGUpe3JldHVybiJfdCI9PT1lPy0xOiJfIj09PWUuc3Vic3RyKDAsMSk/cGFyc2VJbnQoZS5zbGljZSgxKSwxMCk6cGFyc2VJbnQoZSwxMCkrLjF9LGFycmF5S2V5Q29tcGFyZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gYXJyYXlLZXlUb1NvcnROdW1iZXIoZSktYXJyYXlLZXlUb1NvcnROdW1iZXIodCl9LEJhc2VGb3JtYXR0ZXI9ZnVuY3Rpb24oKXt9O0Jhc2VGb3JtYXR0ZXIucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihlLHQpe3ZhciByPXt9O3JldHVybiB0aGlzLnByZXBhcmVDb250ZXh0KHIpLHRoaXMucmVjdXJzZShyLGUsdCksdGhpcy5maW5hbGl6ZShyKX0sQmFzZUZvcm1hdHRlci5wcm90b3R5cGUucHJlcGFyZUNvbnRleHQ9ZnVuY3Rpb24oZSl7ZS5idWZmZXI9W10sZS5vdXQ9ZnVuY3Rpb24oKXt0aGlzLmJ1ZmZlci5wdXNoLmFwcGx5KHRoaXMuYnVmZmVyLGFyZ3VtZW50cyl9fSxCYXNlRm9ybWF0dGVyLnByb3RvdHlwZS50eXBlRm9ybWF0dHRlck5vdEZvdW5kPWZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZm9ybWF0IGRlbHRhIHR5cGU6ICIrdCl9LEJhc2VGb3JtYXR0ZXIucHJvdG90eXBlLnR5cGVGb3JtYXR0dGVyRXJyb3JGb3JtYXR0ZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC50b1N0cmluZygpfSxCYXNlRm9ybWF0dGVyLnByb3RvdHlwZS5maW5hbGl6ZT1mdW5jdGlvbihlKXtyZXR1cm4gaXNBcnJheShlLmJ1ZmZlcik/ZS5idWZmZXIuam9pbigiIik6dm9pZCAwfSxCYXNlRm9ybWF0dGVyLnByb3RvdHlwZS5yZWN1cnNlPWZ1bmN0aW9uKGUsdCxyLG8sbixhLGkpe3ZhciBmPXQmJmEscz1mP2EudmFsdWU6cjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHR8fCJ1bmRlZmluZWQiIT10eXBlb2Ygbyl7dmFyIHU9dGhpcy5nZXREZWx0YVR5cGUodCxhKSxwPSJub2RlIj09PXU/ImEiPT09dC5fdD8iYXJyYXkiOiJvYmplY3QiOiIiOyJ1bmRlZmluZWQiIT10eXBlb2Ygbz90aGlzLm5vZGVCZWdpbihlLG8sbix1LHAsaSk6dGhpcy5yb290QmVnaW4oZSx1LHApO3ZhciB5O3RyeXt5PXRoaXNbImZvcm1hdF8iK3VdfHx0aGlzLnR5cGVGb3JtYXR0dGVyTm90Rm91bmQoZSx1KSx5LmNhbGwodGhpcyxlLHQscyxvLG4sYSl9Y2F0Y2goZCl7dGhpcy50eXBlRm9ybWF0dHRlckVycm9yRm9ybWF0dGVyKGUsZCx0LHMsbyxuLGEpLCJ1bmRlZmluZWQiIT10eXBlb2YgY29uc29sZSYmY29uc29sZS5lcnJvciYmY29uc29sZS5lcnJvcihkLnN0YWNrKX0idW5kZWZpbmVkIiE9dHlwZW9mIG8/dGhpcy5ub2RlRW5kKGUsbyxuLHUscCxpKTp0aGlzLnJvb3RFbmQoZSx1LHApfX0sQmFzZUZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0RGVsdGFDaGlsZHJlbj1mdW5jdGlvbihlLHQscil7dmFyIG89dGhpczt0aGlzLmZvckVhY2hEZWx0YUtleSh0LHIsZnVuY3Rpb24obixhLGksZil7by5yZWN1cnNlKGUsdFtuXSxyP3JbYV06dm9pZCAwLG4sYSxpLGYpfSl9LEJhc2VGb3JtYXR0ZXIucHJvdG90eXBlLmZvckVhY2hEZWx0YUtleT1mdW5jdGlvbihlLHQscil7dmFyIG8sbj1nZXRPYmplY3RLZXlzKGUpLGE9ImEiPT09ZS5fdCxpPXt9O2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgdClmb3IobyBpbiB0KSJ1bmRlZmluZWQiIT10eXBlb2YgZVtvXXx8YSYmInVuZGVmaW5lZCIhPXR5cGVvZiBlWyJfIitvXXx8bi5wdXNoKG8pO2ZvcihvIGluIGUpe3ZhciBmPWVbb107aXNBcnJheShmKSYmMz09PWZbMl0mJihpW2ZbMV0udG9TdHJpbmcoKV09e2tleTpvLHZhbHVlOnQmJnRbcGFyc2VJbnQoby5zdWJzdHIoMSkpXX0sdGhpcy5pbmNsdWRlTW92ZURlc3RpbmF0aW9ucyE9PSExJiYidW5kZWZpbmVkIj09dHlwZW9mIHQmJiJ1bmRlZmluZWQiPT10eXBlb2YgZVtmWzFdXSYmbi5wdXNoKGZbMV0udG9TdHJpbmcoKSkpfWE/bi5zb3J0KGFycmF5S2V5Q29tcGFyZXIpOm4uc29ydCgpO2Zvcih2YXIgcz0wLHU9bi5sZW5ndGg7dT5zO3MrKyl7dmFyIHA9bltzXTtpZighYXx8Il90IiE9PXApe3ZhciB5PWE/Im51bWJlciI9PXR5cGVvZiBwP3A6cGFyc2VJbnQodHJpbVVuZGVyc2NvcmUocCksMTApOnAsZD1zPT09dS0xO3IocCx5LGlbeV0sZCl9fX0sQmFzZUZvcm1hdHRlci5wcm90b3R5cGUuZ2V0RGVsdGFUeXBlPWZ1bmN0aW9uKGUsdCl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlKXJldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgdD8ibW92ZWRlc3RpbmF0aW9uIjoidW5jaGFuZ2VkIjtpZihpc0FycmF5KGUpKXtpZigxPT09ZS5sZW5ndGgpcmV0dXJuImFkZGVkIjtpZigyPT09ZS5sZW5ndGgpcmV0dXJuIm1vZGlmaWVkIjtpZigzPT09ZS5sZW5ndGgmJjA9PT1lWzJdKXJldHVybiJkZWxldGVkIjtpZigzPT09ZS5sZW5ndGgmJjI9PT1lWzJdKXJldHVybiJ0ZXh0ZGlmZiI7aWYoMz09PWUubGVuZ3RoJiYzPT09ZVsyXSlyZXR1cm4ibW92ZWQifWVsc2UgaWYoIm9iamVjdCI9PXR5cGVvZiBlKXJldHVybiJub2RlIjtyZXR1cm4idW5rbm93biJ9LEJhc2VGb3JtYXR0ZXIucHJvdG90eXBlLnBhcnNlVGV4dERpZmY9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVtdLHI9ZS5zcGxpdCgiXG5AQCAiKSxvPTAsbj1yLmxlbmd0aDtuPm87bysrKXt2YXIgYT1yW29dLGk9e3BpZWNlczpbXX0sZj0vXig/OkBAICk/Wy0rXT8oXGQrKSwoXGQrKS8uZXhlYyhhKS5zbGljZSgxKTtpLmxvY2F0aW9uPXtsaW5lOmZbMF0sY2hyOmZbMV19O2Zvcih2YXIgcz1hLnNwbGl0KCJcbiIpLnNsaWNlKDEpLHU9MCxwPXMubGVuZ3RoO3A+dTt1Kyspe3ZhciB5PXNbdV07aWYoeS5sZW5ndGgpe3ZhciBkPXt0eXBlOiJjb250ZXh0In07IisiPT09eS5zdWJzdHIoMCwxKT9kLnR5cGU9ImFkZGVkIjoiLSI9PT15LnN1YnN0cigwLDEpJiYoZC50eXBlPSJkZWxldGVkIiksZC50ZXh0PXkuc2xpY2UoMSksaS5waWVjZXMucHVzaChkKX19dC5wdXNoKGkpfXJldHVybiB0fSxleHBvcnRzLkJhc2VGb3JtYXR0ZXI9QmFzZUZvcm1hdHRlcjsKfSx7fV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CmZ1bmN0aW9uIGh0bWxFc2NhcGUodCl7Zm9yKHZhciBlPXQsbz1bWy8mL2csIiZhbXA7Il0sWy88L2csIiZsdDsiXSxbLz4vZywiJmd0OyJdLFsvJy9nLCImYXBvczsiXSxbLyIvZywiJnF1b3Q7Il1dLGE9MDthPG8ubGVuZ3RoO2ErKyllPWUucmVwbGFjZShvW2FdWzBdLG9bYV1bMV0pO3JldHVybiBlfXZhciBiYXNlPXJlcXVpcmUoIi4vYmFzZSIpLEJhc2VGb3JtYXR0ZXI9YmFzZS5CYXNlRm9ybWF0dGVyLEh0bWxGb3JtYXR0ZXI9ZnVuY3Rpb24oKXt9O0h0bWxGb3JtYXR0ZXIucHJvdG90eXBlPW5ldyBCYXNlRm9ybWF0dGVyLEh0bWxGb3JtYXR0ZXIucHJvdG90eXBlLnR5cGVGb3JtYXR0dGVyRXJyb3JGb3JtYXR0ZXI9ZnVuY3Rpb24odCxlKXt0Lm91dCgnPHByZSBjbGFzcz0ianNvbmRpZmZwYXRjaC1lcnJvciI+JytlKyI8L3ByZT4iKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0VmFsdWU9ZnVuY3Rpb24odCxlKXt0Lm91dCgiPHByZT4iK2h0bWxFc2NhcGUoSlNPTi5zdHJpbmdpZnkoZSxudWxsLDIpKSsiPC9wcmU+Iil9LEh0bWxGb3JtYXR0ZXIucHJvdG90eXBlLmZvcm1hdFRleHREaWZmU3RyaW5nPWZ1bmN0aW9uKHQsZSl7dmFyIG89dGhpcy5wYXJzZVRleHREaWZmKGUpO3Qub3V0KCc8dWwgY2xhc3M9Impzb25kaWZmcGF0Y2gtdGV4dGRpZmYiPicpO2Zvcih2YXIgYT0wLHI9by5sZW5ndGg7cj5hO2ErKyl7dmFyIGk9b1thXTt0Lm91dCgnPGxpPjxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtdGV4dGRpZmYtbG9jYXRpb24iPjxzcGFuIGNsYXNzPSJqc29uZGlmZnBhdGNoLXRleHRkaWZmLWxpbmUtbnVtYmVyIj4nK2kubG9jYXRpb24ubGluZSsnPC9zcGFuPjxzcGFuIGNsYXNzPSJqc29uZGlmZnBhdGNoLXRleHRkaWZmLWNoYXIiPicraS5sb2NhdGlvbi5jaHIrJzwvc3Bhbj48L2Rpdj48ZGl2IGNsYXNzPSJqc29uZGlmZnBhdGNoLXRleHRkaWZmLWxpbmUiPicpO2Zvcih2YXIgbj1pLnBpZWNlcyxzPTAsZD1uLmxlbmd0aDtkPnM7cysrKXt2YXIgZj1uW3NdO3Qub3V0KCc8c3BhbiBjbGFzcz0ianNvbmRpZmZwYXRjaC10ZXh0ZGlmZi0nK2YudHlwZSsnIj4nK2h0bWxFc2NhcGUoZGVjb2RlVVJJQ29tcG9uZW50KGYudGV4dCkpKyI8L3NwYW4+Iil9dC5vdXQoIjwvZGl2PjwvbGk+Iil9dC5vdXQoIjwvdWw+Iil9O3ZhciBhZGp1c3RBcnJvd3M9ZnVuY3Rpb24odCl7dD10fHxkb2N1bWVudDt2YXIgZT1mdW5jdGlvbih0KXtyZXR1cm4gdC50ZXh0Q29udGVudHx8dC5pbm5lclRleHR9LG89ZnVuY3Rpb24odCxlLG8pe2Zvcih2YXIgYT10LnF1ZXJ5U2VsZWN0b3JBbGwoZSkscj0wLGk9YS5sZW5ndGg7aT5yO3IrKylvKGFbcl0pfSxhPWZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBvPTAsYT10LmNoaWxkcmVuLmxlbmd0aDthPm87bysrKWUodC5jaGlsZHJlbltvXSxvKX07byh0LCIuanNvbmRpZmZwYXRjaC1hcnJvdyIsZnVuY3Rpb24odCl7dmFyIG89dC5wYXJlbnROb2RlLHI9dC5jaGlsZHJlblswXSxpPXIuY2hpbGRyZW5bMV07ci5zdHlsZS5kaXNwbGF5PSJub25lIjt2YXIgbixzPWUoby5xdWVyeVNlbGVjdG9yKCIuanNvbmRpZmZwYXRjaC1tb3ZlZC1kZXN0aW5hdGlvbiIpKSxkPW8ucGFyZW50Tm9kZTtpZihhKGQsZnVuY3Rpb24odCl7dC5nZXRBdHRyaWJ1dGUoImRhdGEta2V5Iik9PT1zJiYobj10KX0pLG4pdHJ5e3ZhciBmPW4ub2Zmc2V0VG9wLW8ub2Zmc2V0VG9wO3Iuc2V0QXR0cmlidXRlKCJoZWlnaHQiLE1hdGguYWJzKGYpKzYpLHQuc3R5bGUudG9wPS04KyhmPjA/MDpmKSsicHgiO3ZhciBsPWY+MD8iTTMwLDAgUS0xMCwiK01hdGgucm91bmQoZi8yKSsiIDI2LCIrKGYtNCk6Ik0zMCwiKy1mKyIgUS0xMCwiK01hdGgucm91bmQoLWYvMikrIiAyNiw0IjtpLnNldEF0dHJpYnV0ZSgiZCIsbCksci5zdHlsZS5kaXNwbGF5PSIifWNhdGNoKGMpe3JldHVybn19KX07SHRtbEZvcm1hdHRlci5wcm90b3R5cGUucm9vdEJlZ2luPWZ1bmN0aW9uKHQsZSxvKXt2YXIgYT0ianNvbmRpZmZwYXRjaC0iK2UrKG8/IiBqc29uZGlmZnBhdGNoLWNoaWxkLW5vZGUtdHlwZS0iK286IiIpO3Qub3V0KCc8ZGl2IGNsYXNzPSJqc29uZGlmZnBhdGNoLWRlbHRhICcrYSsnIj4nKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUucm9vdEVuZD1mdW5jdGlvbih0KXt0Lm91dCgiPC9kaXY+IisodC5oYXNBcnJvd3M/JzxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij5zZXRUaW1lb3V0KCcrYWRqdXN0QXJyb3dzLnRvU3RyaW5nKCkrIiwxMCk7PC9zY3JpcHQ+IjoiIikpfSxIdG1sRm9ybWF0dGVyLnByb3RvdHlwZS5ub2RlQmVnaW49ZnVuY3Rpb24odCxlLG8sYSxyKXt2YXIgaT0ianNvbmRpZmZwYXRjaC0iK2ErKHI/IiBqc29uZGlmZnBhdGNoLWNoaWxkLW5vZGUtdHlwZS0iK3I6IiIpO3Qub3V0KCc8bGkgY2xhc3M9IicraSsnIiBkYXRhLWtleT0iJytvKyciPjxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtcHJvcGVydHktbmFtZSI+JytvKyI8L2Rpdj4iKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUubm9kZUVuZD1mdW5jdGlvbih0KXt0Lm91dCgiPC9saT4iKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X3VuY2hhbmdlZD1mdW5jdGlvbih0LGUsbyl7InVuZGVmaW5lZCIhPXR5cGVvZiBvJiYodC5vdXQoJzxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtdmFsdWUiPicpLHRoaXMuZm9ybWF0VmFsdWUodCxvKSx0Lm91dCgiPC9kaXY+IikpfSxIdG1sRm9ybWF0dGVyLnByb3RvdHlwZS5mb3JtYXRfbW92ZWRlc3RpbmF0aW9uPWZ1bmN0aW9uKHQsZSxvKXsidW5kZWZpbmVkIiE9dHlwZW9mIG8mJih0Lm91dCgnPGRpdiBjbGFzcz0ianNvbmRpZmZwYXRjaC12YWx1ZSI+JyksdGhpcy5mb3JtYXRWYWx1ZSh0LG8pLHQub3V0KCI8L2Rpdj4iKSl9LEh0bWxGb3JtYXR0ZXIucHJvdG90eXBlLmZvcm1hdF9ub2RlPWZ1bmN0aW9uKHQsZSxvKXt2YXIgYT0iYSI9PT1lLl90PyJhcnJheSI6Im9iamVjdCI7dC5vdXQoJzx1bCBjbGFzcz0ianNvbmRpZmZwYXRjaC1ub2RlIGpzb25kaWZmcGF0Y2gtbm9kZS10eXBlLScrYSsnIj4nKSx0aGlzLmZvcm1hdERlbHRhQ2hpbGRyZW4odCxlLG8pLHQub3V0KCI8L3VsPiIpfSxIdG1sRm9ybWF0dGVyLnByb3RvdHlwZS5mb3JtYXRfYWRkZWQ9ZnVuY3Rpb24odCxlKXt0Lm91dCgnPGRpdiBjbGFzcz0ianNvbmRpZmZwYXRjaC12YWx1ZSI+JyksdGhpcy5mb3JtYXRWYWx1ZSh0LGVbMF0pLHQub3V0KCI8L2Rpdj4iKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X21vZGlmaWVkPWZ1bmN0aW9uKHQsZSl7dC5vdXQoJzxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtdmFsdWUganNvbmRpZmZwYXRjaC1sZWZ0LXZhbHVlIj4nKSx0aGlzLmZvcm1hdFZhbHVlKHQsZVswXSksdC5vdXQoJzwvZGl2PjxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtdmFsdWUganNvbmRpZmZwYXRjaC1yaWdodC12YWx1ZSI+JyksdGhpcy5mb3JtYXRWYWx1ZSh0LGVbMV0pLHQub3V0KCI8L2Rpdj4iKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X2RlbGV0ZWQ9ZnVuY3Rpb24odCxlKXt0Lm91dCgnPGRpdiBjbGFzcz0ianNvbmRpZmZwYXRjaC12YWx1ZSI+JyksdGhpcy5mb3JtYXRWYWx1ZSh0LGVbMF0pLHQub3V0KCI8L2Rpdj4iKX0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X21vdmVkPWZ1bmN0aW9uKHQsZSl7dC5vdXQoJzxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtdmFsdWUiPicpLHRoaXMuZm9ybWF0VmFsdWUodCxlWzBdKSx0Lm91dCgnPC9kaXY+PGRpdiBjbGFzcz0ianNvbmRpZmZwYXRjaC1tb3ZlZC1kZXN0aW5hdGlvbiI+JytlWzFdKyI8L2Rpdj4iKSx0Lm91dCgnPGRpdiBjbGFzcz0ianNvbmRpZmZwYXRjaC1hcnJvdyIgc3R5bGU9InBvc2l0aW9uOiByZWxhdGl2ZTsgbGVmdDogLTM0cHg7Ij4gICAgICAgIDxzdmcgd2lkdGg9IjMwIiBoZWlnaHQ9IjYwIiBzdHlsZT0icG9zaXRpb246IGFic29sdXRlOyBkaXNwbGF5OiBub25lOyI+ICAgICAgICA8ZGVmcz4gICAgICAgICAgICA8bWFya2VyIGlkPSJtYXJrZXJBcnJvdyIgbWFya2VyV2lkdGg9IjgiIG1hcmtlckhlaWdodD0iOCIgcmVmeD0iMiIgcmVmeT0iNCIgICAgICAgICAgICAgICAgICAgb3JpZW50PSJhdXRvIiBtYXJrZXJVbml0cz0idXNlclNwYWNlT25Vc2UiPiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMSwxIEwxLDcgTDcsNCBMMSwxIiBzdHlsZT0iZmlsbDogIzMzOTsiIC8+ICAgICAgICAgICAgPC9tYXJrZXI+ICAgICAgICA8L2RlZnM+ICAgICAgICA8cGF0aCBkPSJNMzAsMCBRLTEwLDI1IDI2LDUwIiBzdHlsZT0ic3Ryb2tlOiAjODhmOyBzdHJva2Utd2lkdGg6IDJweDsgZmlsbDogbm9uZTsgICAgICAgIHN0cm9rZS1vcGFjaXR5OiAwLjU7IG1hcmtlci1lbmQ6IHVybCgjbWFya2VyQXJyb3cpOyI+PC9wYXRoPiAgICAgICAgPC9zdmc+ICAgICAgICA8L2Rpdj4nKSx0Lmhhc0Fycm93cz0hMH0sSHRtbEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0X3RleHRkaWZmPWZ1bmN0aW9uKHQsZSl7dC5vdXQoJzxkaXYgY2xhc3M9Impzb25kaWZmcGF0Y2gtdmFsdWUiPicpLHRoaXMuZm9ybWF0VGV4dERpZmZTdHJpbmcodCxlWzBdKSx0Lm91dCgiPC9kaXY+Iil9O3ZhciBzaG93VW5jaGFuZ2VkPWZ1bmN0aW9uKHQsZSxvKXt2YXIgYT1lfHxkb2N1bWVudC5ib2R5LHI9Impzb25kaWZmcGF0Y2gtdW5jaGFuZ2VkLSIsaT17c2hvd2luZzpyKyJzaG93aW5nIixoaWRpbmc6cisiaGlkaW5nIix2aXNpYmxlOnIrInZpc2libGUiLGhpZGRlbjpyKyJoaWRkZW4ifSxuPWEuY2xhc3NMaXN0O2lmKG4pe2lmKCFvKXJldHVybiBuLnJlbW92ZShpLnNob3dpbmcpLG4ucmVtb3ZlKGkuaGlkaW5nKSxuLnJlbW92ZShpLnZpc2libGUpLG4ucmVtb3ZlKGkuaGlkZGVuKSx2b2lkKHQ9PT0hMSYmbi5hZGQoaS5oaWRkZW4pKTt0PT09ITE/KG4ucmVtb3ZlKGkuc2hvd2luZyksbi5hZGQoaS52aXNpYmxlKSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bi5hZGQoaS5oaWRpbmcpfSwxMCkpOihuLnJlbW92ZShpLmhpZGluZyksbi5hZGQoaS5zaG93aW5nKSxuLnJlbW92ZShpLmhpZGRlbikpO3ZhciBzPXNldEludGVydmFsKGZ1bmN0aW9uKCl7YWRqdXN0QXJyb3dzKGEpfSwxMDApO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtuLnJlbW92ZShpLnNob3dpbmcpLG4ucmVtb3ZlKGkuaGlkaW5nKSx0PT09ITE/KG4uYWRkKGkuaGlkZGVuKSxuLnJlbW92ZShpLnZpc2libGUpKToobi5hZGQoaS52aXNpYmxlKSxuLnJlbW92ZShpLmhpZGRlbikpLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtuLnJlbW92ZShpLnZpc2libGUpLGNsZWFySW50ZXJ2YWwocyl9LG8rNDAwKX0sbyl9fSxoaWRlVW5jaGFuZ2VkPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHNob3dVbmNoYW5nZWQoITEsdCxlKX07ZXhwb3J0cy5IdG1sRm9ybWF0dGVyPUh0bWxGb3JtYXR0ZXIsZXhwb3J0cy5zaG93VW5jaGFuZ2VkPXNob3dVbmNoYW5nZWQsZXhwb3J0cy5oaWRlVW5jaGFuZ2VkPWhpZGVVbmNoYW5nZWQ7dmFyIGRlZmF1bHRJbnN0YW5jZTtleHBvcnRzLmZvcm1hdD1mdW5jdGlvbih0LGUpe3JldHVybiBkZWZhdWx0SW5zdGFuY2V8fChkZWZhdWx0SW5zdGFuY2U9bmV3IEh0bWxGb3JtYXR0ZXIpLGRlZmF1bHRJbnN0YW5jZS5mb3JtYXQodCxlKX07Cn0seyIuL2Jhc2UiOjR9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGVudmlyb25tZW50PXJlcXVpcmUoIi4uL2Vudmlyb25tZW50Iik7aWYoZXhwb3J0cy5iYXNlPXJlcXVpcmUoIi4vYmFzZSIpLGV4cG9ydHMuaHRtbD1yZXF1aXJlKCIuL2h0bWwiKSxleHBvcnRzLmFubm90YXRlZD1yZXF1aXJlKCIuL2Fubm90YXRlZCIpLCFlbnZpcm9ubWVudC5pc0Jyb3dzZXIpe3ZhciBjb25zb2xlTW9kdWxlTmFtZT0iLi9jb25zb2xlIjtleHBvcnRzLmNvbnNvbGU9cmVxdWlyZShjb25zb2xlTW9kdWxlTmFtZSl9Cn0seyIuLi9lbnZpcm9ubWVudCI6MiwiLi9hbm5vdGF0ZWQiOjMsIi4vYmFzZSI6NCwiLi9odG1sIjo1fV19LHt9LFsxXSkoMSkKfSk7"}}},{"_id": "cw-DdocLab-Editor-1ccd","_rev": "637-ad792ac1ba58faea645432655a682687","name": "DdocLab.Editor","title": "Ddoc Lab","type": "manifest","desc": "Ddoc source file editor","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.DdocLab.Editor","build": 38,"app": {"name": "DdocLab.Editor","title": "Ddoc Lab","version": "2.4","build": 38,"timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9IkdyYWRpZW50XzEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjEuMTMiIHkxPSI5MC40NDEiIHgyPSI2MS4xMyIgeTI9IjExMy4wMDIiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNGRkZGRkYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjZERkJEIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZyBpZD0iTGF5ZXJfMSI+CiAgICA8Zz4KICAgICAgPHBhdGggZD0iTTEyMy42ODYsNi42MzMgQzEyMy42ODYsNi42MzMgMTIzLjk0MSwxNy4xODUgMTIzLjk0MSwxNy4xODUgTDEwNC42NTgsMjYuNDU5IEMxMTMuOTcsMzcuMTAxIDExOC4zNTYsNTAuMDA1IDExOC43MSw2NC4wMzUgQzExOC43MSw5NS43MzcgOTMuMDQ1LDEyMS40MzcgNjEuMzg1LDEyMS40MzcgQzI5LjcyNSwxMjEuNDM3IDQuMDU5LDk1LjczNyA0LjA1OSw2NC4wMzUgQzQuNDU5LDMyLjA5NCAzMC45MDcsNi44MjQgNjAuOTgsNi42NDMgQzkxLjA1Myw2LjQ2MyAxMjMuNjg2LDYuNjMzIDEyMy42ODYsNi42MzMgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgICA8cGF0aCBkPSJNODUuMDM1LDMuNSBDMTA2LjY3OSwzLjUwNyA5Ni44NjgsMy40OTEgMTE0LjQ3LDMuNTMzIEMxMTYuOTgzLDMuNTQxIDExOS4yNTIsMy41NSAxMjEuMjM5LDMuNTU5IEMxMjEuOTM1LDMuNTYxIDEyMi41NDUsMy41NjQgMTIzLjA2NiwzLjU2NyBDMTIzLjM1NCwzLjU2OCAxMjMuMzU0LDMuNTY4IDEyMy41NCwzLjU2OSBDMTIzLjY3NCwzLjU3IDEyMy42NzQsMy41NyAxMjMuNzAyLDMuNTcgQzEyNS4zNTYsMy41NzggMTI2LjcwNCw0LjkwMyAxMjYuNzQ0LDYuNTU5IEMxMjYuNzUyLDYuODg5IDEyNi43NTIsNi44ODkgMTI2Ljc4NCw4LjIwOCBDMTI2LjgyNCw5Ljg1NyAxMjYuODI0LDkuODU3IDEyNi44NzIsMTEuODM1IEMxMjYuOTE5LDEzLjgxMyAxMjYuOTE5LDEzLjgxMyAxMjYuOTU5LDE1LjQ2MiBDMTI2Ljk5MSwxNi43ODEgMTI2Ljk5MSwxNi43ODEgMTI2Ljk5OSwxNy4xMTEgQzEyNy4wMjgsMTguMzE1IDEyNi4zNSwxOS40MjUgMTI1LjI2NSwxOS45NDYgTDEwOS40NDksMjcuNTUzIEMxMTcuNjU4LDM4LjAxOSAxMjEuMTg5LDUwLjgzNyAxMjEuNzY4LDYzLjk1NyBMMTIxLjc2OSw2NC4wMzUgQzEyMS43Nyw5Ny40MjkgOTQuNzM0LDEyNC41IDYxLjM4NSwxMjQuNSBDMjguMDM1LDEyNC41IDEsOTcuNDI5IDEsNjMuOTk2IEMxLjQxNSwzMC44NjcgMjguNzQsMy43NzQgNjAuOTYyLDMuNTggQzYzLjExMSwzLjU2NyA2NS4zMTEsMy41NTYgNjcuNTU3LDMuNTQ2IEM3Ny4yMjIsMy41MSA3MS4zOTYsMy41MjggODUuMDM1LDMuNSB6IE04NS4wNDMsOS42MjcgQzcxLjQxOCw5LjY1NSA3Ny4yMzgsOS42MzcgNjcuNTgzLDkuNjczIEM2NS4zNDEsOS42ODMgNjMuMTQ0LDkuNjk0IDYwLjk5OCw5LjcwNyBDMzIuMTA3LDkuODggNy40OTEsMzQuMjg3IDcuMTE4LDY0LjAzNSBDNy4xMTgsOTQuMDQ1IDMxLjQxNCwxMTguMzczIDYxLjM4NSwxMTguMzczIEM5MS44NzksMTE3Ljk3NiAxMTQuODg1LDk0LjMzOSAxMTUuNjUsNjQuMDcgQzExNS40MDQsNTAuNzA0IDExMC45MDUsMzguNjk5IDEwMi4zNTcsMjguNDc4IEMxMDEuMDIzLDI2Ljk1MyAxMDEuNTA5LDI0LjU3NSAxMDMuMzM0LDIzLjY5NyBMMTIwLjgzNCwxNS4yOCBDMTIwLjgwOCwxNC4xODEgMTIwLjc4MSwxMy4wODIgMTIwLjc1NSwxMS45ODMgQzEyMC43MzYsMTEuMjE3IDEyMC43MTcsMTAuNDUgMTIwLjY5OSw5LjY4MyBDMTE4LjYxNiw5LjY3NCAxMTYuNTM0LDkuNjY3IDExNC40NTEsOS42NiBDOTYuODY1LDkuNjE4IDEwNi42NjcsOS42MzQgODUuMDQzLDkuNjI3IHoiIGZpbGw9IiM2NURGQkQiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik0xMDIuMTM4LDkwLjQ0MSBDOTIuODgyLDEwNC43ODggNzguMDU5LDExMi41NzMgNjEuMTMsMTEzLjAwMiBDNDQuMDE3LDExMi44OTIgMjkuNTk3LDEwNC40ODYgMjAuMTIyLDkwLjQ0MSBMMTAyLjEzOCw5MC40NDEgeiIgZmlsbD0idXJsKCNHcmFkaWVudF8xKSIvPgogICAgPHBhdGggZD0iTTYxLjkxOSw4MSBDNzMuNzc1LDgxIDgyLDczLjY3OCA4Miw2Mi41MjggQzgyLDUxLjM3OCA3My43NzUsNDQgNjEuOTE5LDQ0IEw0Nyw0NCBMNDcsODEgeiBNNjEuOTE5LDc0LjA2NiBMNTUuMDU1LDc0LjA2NiBMNTUuMDU1LDUwLjkzNCBMNjEuOTE5LDUwLjkzNCBDNjkuNjksNTAuOTM0IDczLjc3NSw1NS45ODIgNzMuNzc1LDYyLjUyOCBDNzMuNzc1LDY4Ljc5NiA2OS40MDcsNzQuMDY2IDYxLjkxOSw3NC4wNjYgeiIgZmlsbD0iI0ZGNjU4QiIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": ["cmd","doc._id"],"nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","width": [[980,1420],1200,1420],"collapsed": [".AddImage",".DocParams"],"padding": "auto","types": {"ddlab": ["create","edit"]}},"Version": "2.4","params": {"restyle": 200},"require": [{"UglifyJS": "lib/uglify.js","Q": "lib/q.js","less": "lib/less.js"}],"expose": ["GetDoc","GetActiveId","RT","Path","GenId","getDup","Confirm","db","Att"],"creds": {},"Search": "","List": [],"Tablist": [],"Active": "","Expanded": {},"RT": "function () { return this; }","GetDoc": "function () { return this.data.doc; }","GenId": "function () {return $.my.f.sdbmCode(Date.now()+Number.random(1e11, 1e18))}","GetActiveId": "function () { return this.Active; }","MemoTabs": "function () {\n\t\tvar that=this, d = that.data.doc, di = d.items, a=[]; \n\t\ta.push(that.Path(that.List[0]));\n\t\tthat.Tablist.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (p!=a[0] && elt.data.length<50000) a.push(p);\n\t\t});\n\t\td.tabs = a;\n\t}","Path": "function (item,name) {\n\t\tvar sep = item.folder.to(1);\n\t\treturn name!=null?name:item.folder+(item.folder.length>1?sep:\"\")+item.name;\n\t}","SessionUrls": {},"die": "function () {\n\t\tvar u = this.SessionUrls;\n\t\t// Free resources \n\t\tObject.keys(u).forEach(function(i){ \n\t\t\tURL.revokeObjectURL(u[i]);\n\t\t});\n\t}","init": "function ($o,form) {\n\tvar i, j, that = this, \n\t\t\td = form.data.doc,\n\t\t\titems = d.items,\n      Iman;\n  \n  // Color Picker\n  var CPid = 'cw.Sys.Colorpicker';\n  that.ColorPicker = that.db.form(CPid) || $.my.cache(CPid);\n  \n  // Mount Inliner\n  if (that.db && that.db.form) {\n  \tIman = that.db.form('cw.Inliner');\n    if (Iman.Version < '4.0') Iman = null;\n  }\n  if (!Iman) Iman = $.my.cache('cw.Inliner');\n \t\n  that.Types.rtf.extend.Inliner = $.extend( true, {}, Iman || {});\n\n\t$o.formgen('init', that.HTML);\n\t\n\t// Parser\n\t//if (!window.HTMLParser)\n\tthat.HTMLParser(that);\n\t\n\t// CM-related stuff\n\tthat.InitCM();\n\t\t\n\t// Busy\n\tif (!that.app) that.app = {};\n\tif (!that.app.busy) {\n\t\tthat.app.busy = function(a){\n\t\t\t$o.toggleClass(\"cw-app-busy\", !!a);\n\t\t}\n\t}\n\n\t// prepare doc if it’s empty\n\tif (!d.items.length) {\n\t\td.items.push( \t$.extend(true, {},that.Item.data, {id:that.GenId()}) );\n\t}\n\n\t// extend runtime\n\tthat.AddItem.Typelist = Object.keys(that.Types).remove(\"attachment\");\n\t\n\t// correct doc\n\tif (d.s3) that.S3toCouch(d);\n\t\n\t// restore tabs\n\tif (Object.isArray(d.tabs) && d.tabs.length) {\n\t\tvar tabs = cw.lib.a2o(d.tabs);\n\t\td.items.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (tabs[p]) tabs[p] = elt;\n\t\t});\n\t\t\n\t\td.tabs.forEach(function(k,i) {\n\t\t\tvar t = tabs[k];\n\t\t\tif (\n\t\t\t\tObject.isObject(t)\n\t\t\t\t&& t.id\n\t\t\t\t&& (\n\t\t\t\t\t(t.state && t.state.savedSdbm != t.state.sdbm)\n\t\t\t\t\t|| !i\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tthat.Tablist.push(t);\n\t\t\t}\n\t\t});\n\t\tif (that.Tablist[0]) that.List.push(that.Tablist[0]);\n\t\tthat.Active = that.List[0].id;\n\t} \n\t\n\t\n\t// Expanded branches restore\n\t\n\tif (Object.isObject(d.expanded)){\n\t\tthat.Expanded = $.extend(!0, true, d.expanded);\n\t}\n\t\n\t\n\t// If stiil nothing to open – open first item\n\t\n\tif (!that.List.length) {\n\t\tthat.Active = d.items[0].id;\n\t\tthat.List.push(d.items[0]);\n\t\tthat.Tablist.push(d.items[0]);\n\t}\n\t\n\t\n\t// Dup searcher\n\tthat.getDup = function (item, name0) {\n\t\tvar i,e, ename, fname = that.Path(item, name0), u=false;\n\t\tfor (var i=0;i<d.items.length && !u; i++) {\n\t\t\te = d.items[i];\n\t\t\tename = that.Path(e);\n\t\t\tif (e.id!==item.id && ename===fname) u = e.type;\n\t\t}\n\t\treturn u;\n\t};\n\n\t//remember mimes\n\tfor (i=0;i<d.items.length;i++) {\n\t\tj = d.items[i];\n\t\tif (j.type===\"attachment\" && !j.mime) {\n\t\t\tj.mime = d._attachments[(j.folder?j.folder+\"/\":\"\")+j.name+\".\"+j.ext].content_type;\n\t\t}\n\t\tif (!j.state) j.state = {savedSdbm:\"\",sdbm:\"\",depends:{},impacts:{}};\n\t\tdelete j.savedSdbm; delete j.depends;\n\t}\n\t\n\t// Prepare Inliner\n\t\n\tvar Rtf = that.Types.rtf.extend;\n\tRtf.Inliner.T.img.Opts.style[' .tag-in-fmt'] =\n\tRtf.Inliner.T.embed.Opts.style[' .tag-in-fmt'] =\n\tRtf.style[' .tag-in-fmt'] = $.extend(true,{}, Rtf.Inliner.style[' .tag-in-fmt']);\n\t//Rtf.Inliner.Ed.doc.style = $.extend(true,{}, Rtf.Inliner.Ed.Theme);\n\n\t// 'delete item' event handler\n\n\t$o.on(\"delitem.my\", function(evt, item){\n\t\tvar ipos = d.items.findIndex(_find),\n\t\t\t\tlpos = that.List.findIndex(_find),\n\t\t\t\tfname = that.Path(item);\n\t\tif (d.items.length>1) {\n\t\t\t\n\t\t\tif (item.type==\"rtf\" || item.type==\"inliner\") {\n\t\t\t\t// del sub images\n\t\t\t\td.items.remove(_findDeps);\n\t\t\t\tthat.List.remove(_findDeps);\n\t\t\t\tthat.Tablist.remove(_findDeps);\n\t\t\t}\n\t\t\t\n\t\t\td.items.removeAt(ipos);\n\t\t\tthat.List.removeAt(lpos);\n\t\t\tthat.Tablist.removeAt(that.Tablist.findIndex(_find));\n\t\t\tif (d._attachments && d._attachments[fname.from(1)]) \n\t\t\t\tdelete d._attachments[fname.from(1)];\n\t\t\tthat.Expanded[item.id] = false;\n\t\t\t\n\t\t\tif (!that.Tablist) that.Tablist.push(d.items[0]);\n\n\t\t\tif (!that.List.length) that.List.push(that.Tablist[0]);\n\t\t\t\n\t\t\tthat.Active = that.List[0].id;\n\t\t\t$o.find(\"#items\").trigger(\"recalc\");\n\t\t}\n\t\telse {\n\t\t\t(window.l||cw.lib).note(\"Can’t remove last resource.\",\"error\");\n\t\t}\n\n\t\tfunction _find (e) { return e.id == item.id; }\n\t\tfunction _findDeps (e) { return (e.type==\"attachment\" && e.folder==\"/inliner\" && e.name.startsWith(item.id+\"/\"));}\n\t});\n  \n  // save request event handler\n  \n  $o.on('saveproject.my', function(){\n  \t$o.find('#nav #btn-save').trigger('click');\n  }.debounce(50));\n\n}","data": {"doc": {"_id": "","name": "Untitled project","tags": [],"type": "ddlab","owners": [],"previews": {},"acl": [],"export": {"path": "","options": ["extend"],"lastrev": "","lastcrc": ""},"items": [],"tabs": [],"expanded": {},"creds": {"crypto": ""},"couch": {"dburl": "","docid": "","login": "","pwd": ""},"site": {"siteBase": "","previewBase": ""},"log": []},"cmd": ""},"ui": {"#navlogo": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:$.extend(!0,{RT:this.RT},this.About),\n\t\t\t\t\tesc:true\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn this.files[\"logo70.png\"].url;\n\t\t}","events": "click.my"},"#search": {"delay": 150,"bind": "this.Search","css": {"my-search": "new RegExp(/^.{2,}$/)"},"recalc": "#ilist"},"#sname": {"bind": "function (d) {\n\t\t\tvar css = \"bold mt8 fs105 oh nw dib\",\n\t\t\t\t\tcdb = this.GetSettings(\"couch\"),\n\t\t\t\t\tcouch = cdb.dburl.replace(/\\/$/,'')+'/',\n\t\t\t\t\tid = cdb.docid,\n\t\t\t\t\turl = !(couch.from(1) || id)?\"\":couch+id;\n\t\t\t\n\t\t\tif (url) return '<a target=\"_blank\" href=\"'+url+'\" '\n\t\t\t\t+' title=\"Open remote doc in new tab\"'\n\t\t\t\t+' class=\"pseudolink o80 '+css+'\" style=\"max-width:100%;text-overflow: ellipsis;\">'\n\t\t\t\t+(d.doc.name||\"Untitled\")//.truncate(18,\"right\",\"…\")\n\t\t\t\t+'</a>';\n\t\t\telse return '<div style=\"max-width:100%;text-overflow: ellipsis;\" class=\"gray '+css+'\">'+(d.doc.name||\"Untitled\")+'</div>';\n\t\t\t\n\t\t}"},"#btn-params": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\telse $o.modal({\n\t\t\t\t\tmanifest:that.DocParams,\n\t\t\t\t\tdata:$.extend(true,{},\n\t\t\t\t\t\tObject.select(d.doc,'name tags s3 couch site owners creds _attachments items export'.split(' '))\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\twidth: 525,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tcss:\"fs90\",\n\t\t\t\t\tscreen:'rgba(255,255,255,0.5)',\n\t\t\t\t\tbound:10\n\t\t\t\t})\n        .then(function(res){\n\t\t\t\t\t$.extend(true, d.doc, res);\n          if (!res.couch.docid) {\n          \td.doc.pic = 'data:image/svg+xml;base64,'+cw.lib.base64(that.Icons.Component);\n          }\n          else {\n          \tdelete d.doc.pic;\n          }\n\t\t\t\t\tres.items = null; res._attachments=null;\n\t\t\t\t\tfor (var i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\td.doc.items[i].state.savedSdbm = '';\n\t\t\t\t\t\td.doc.items[i].state.remote = '';\n\t\t\t\t\t}\n          that.my.check('#sname');\n          that.my.check('#ilist');\n\t\t\t\t});\n\t\t\t}\n\t\t}","css": {"self:red": "function (d) {\n\t\t\t\tvar obj = this.GetSettings(\"couch\");\n\t\t\t\treturn (!obj.docid || !obj.dburl || (obj.login && !obj.pwd));\n\t\t\t}"},"watch": "#sname"},"#btn-addpic": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.AddImage,\n\t\t\t\t\twidth:820,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tdata:{},\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t})\n        .then(function(res){\n\t\t\t\t\tvar item = $.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{}, \n\t\t\t\t\t\tthat.Types.attachment.manifest.data,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid:that.GenId(), \n\t\t\t\t\t\t\tfolder:/^[\\.\\/]/.test(res.folder)?res.folder:\"/\"+res.folder,\n\t\t\t\t\t\t\tname:res.filename,\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"\",\n\t\t\t\t\t\t\tmime:res.mime,\n\t\t\t\t\t\t\tpreview:res.preview,\n\t\t\t\t\t\t\tsize:res.data.length/4*3\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\td.doc._attachments[that.Path(item).from(1)] = {content_type:res.mime, data: res.data};\n\t\t\t\t\td.doc.items.push(item);\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t\t//console.log(res);\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-additem": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(\n\t\t\t\t\t\ttrue,  that.AddItem, \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgetDup:that.getDup,\n\t\t\t\t\t\t\tTypes:that.Types,\n\t\t\t\t\t\t\tRT: function(){ return that; }\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, {}, that.Item.data, \n\t\t\t\t\t\t{id:that.GenId(),name:\"\",ext:\"\",folder:\".\",type:\"js\",mime:\"text/javascript\"}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t$.extend(res, that.Types[res.type].defaults||{});\n\t\t\t\t\tres.mime = that.Types[res.type].mime;\n\t\t\t\t\t//console.log(res);\n\t\t\t\t\td.doc.items.push($.extend(true, {}, res));\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-save": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar that=this, err;\n\t\tif (v!=null) {\n\t\t\tthat.MemoTabs();\n\t\t\td.doc.expanded = $.extend(!0,{},that.Expanded);\n\t\t\t$o.trigger(\"commit\");\n\t\t}\n\t}"},"#btn-close": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t}"},"#ilist": {"delay": 50,"init": "function ($o,form) {\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t\n\t\t$o.on(\"click.my\", \".siteitem\", function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.attr(\"id\").from(3),\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (!item) {\n\t\t\t\tif (that.Expanded[id]) that.Expanded[id] = false;\n\t\t\t\telse that.Expanded[id] = true;\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t\telse /*if (item.type!=\"attachment\")*/ {\n\t\t\t\tthat.Active = id;\n\t\t\t\tif (item.folder) that.Expanded[item.folder] = true;\n\t\t\t\tif ( (idx = that.List.indexOf(item)) !== -1) {\n\t\t\t\t\tthat.List.removeAt(idx);\n\t\t\t\t} \n\t\t\t\tthat.List.unshift(item);\n\t\t\t\tif (that.Tablist.indexOf(item)==-1) that.Tablist.unshift(item);\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t})\n\t}","bind": "function (d,v,$o) {\n\t\tvar that = this, \n\t\t\t\ti, e, html=\"\",\n\t\t\t\tlist = d.doc.items, \n\t\t\t\tres = [], fl = \"\",\n\t\t\t\tisSearch = that.Search && that.Search.length>1;\n\n\t\t// sort list\n\t\tlist = list.sortBy(function(e){\n\t\t\treturn [\n\t\t\t\te.folder.to(1),\n\t\t\t\t(!!e.folder.from(1)) *1,\n\t\t\t\te.folder,\n\t\t\t\te.snippet*1,\n\t\t\t\te.name,e.type\n\t\t\t].join(\"/\").toLowerCase();\n\t\t});\n\t\t\n\t\tif (isSearch) {\n\t\t\t// filter list\n\t\t\tvar re = new RegExp (RegExp.escape(that.Search), \"i\");\n\t\t\tlist = list.filter(function(e){\n\t\t\t\treturn re.test(e.name) || re.test(e.folder) || re.test(e.data);\n\t\t\t});\n\t\t}\n\t\t\n\t\t// gen items/folders final list\n\t\tfor (i=0; i<list.length; i++) {\n\t\t\te = list[i];\n\t\t\tif (e.folder && e.folder != fl) {\n\t\t\t\tfl = e.folder;\n\t\t\t\tres.push({\n\t\t\t\t\tid:fl,\n\t\t\t\t\thtml: '<span class=\"dib w12 fs60 '\n\t\t\t\t\t\t//+(that.Expanded[fl] || isSearch?\"▾\":\"▸\")\n          \t+(that.Expanded[fl] || isSearch?'blue2\">▼':'gray2\">►')\n\t\t\t\t\t\t+'</span>'\n\t\t\t\t\t\t+(e.folder==\"/\"\n\t\t\t\t\t\t\t?'<span class=\"fi-folder o50 blue mr1 \"></span> <b class=\"fs105 o90\">Attachments</b>'\n\t\t\t\t\t\t\t:e.folder==\".\"\n\t\t\t\t\t\t\t?'<span class=\"fi-align-left o50 blue mr1 \"></span> <b class=\"fs105 o90\">Doc root</b>'\n\t\t\t\t\t\t\t:fl.to(1)//+\"&thinsp;\"\n\t\t\t\t\t\t)\n\t\t\t\t\t\t+fl.from(1),\n\t\t\t\t\tcss:'xgray bolder fs95',\n\t\t\t\t\ttype:\"folder\"\n\t\t\t\t});\n\t\t\t} \n\t\t\tif (isSearch || (!e.folder || that.Expanded[e.folder])) {\n\t\t\t\tvar isdirty = (!e.state.savedSdbm || e.state.sdbm == \"Z\"  || (e.state.sdbm!==e.state.savedSdbm)),\n            ex = e.external;\n\t\t\t\tres.push({\n\t\t\t\t\tid:e.id,\n\t\t\t\t\thtml: '&nbsp;'\n\t\t\t\t\t\t+ e.name\n\t\t\t\t\t\t+(e.ext?\".\"+e.ext:\"\")\n          \t+ (e.parserActive?'<span class=\"fs90 ml4\">&gt;</span> ':'')\n\t\t\t\t\t\t+ (isdirty?'<span class=\"blue2 ml4\">•</span>':'')\n\t\t\t\t\t\t+ (e.type===\"attachment\"?' <span class=\"fi-paperclip blue1 fs95\"></span>':''),\n          css: (\n            e.snippet? \n              (ex?(ex.to(1).trim()?'orange-2 o70':'orange-2 o60 tdl') : 'gray') \n              : \n              (ex?(ex.to(1).trim()?'orange o90':'orange o80 tdl') : 'xgray')\n            )\n\t\t\t\t\t\t+ (e.id == that.Active?\" bg-active\":\"\"),\n\t\t\t\t\ttype:e.snippet?\"snippet\":\"item\",\n\t\t\t\t\ttitle: e.folder+\"/\"+e.name+(e.ext?\".\"+e.ext:\"\"),\n\t\t\t\t\tfolder: e.folder\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t// render list\n\t\tfor (i=0;i<res.length;i++) {\n\t\t\te = res[i];\n\t\t\thtml+='<div class=\"siteitem w200 oh '+e.css+(e.folder?\" pl12\":\"\")\n\t\t\t\t+'\" id=\"sx-'+e.id+'\" title=\"'\n\t\t\t\t+(e.title?e.title:\"\")+'\">'\n\t\t\t\t+e.html\n\t\t\t\t+'</div>';\n\t\t}\n\t\treturn html;\n\t}"},"#items": {"bind": "this.List","manifest": "function (e) {\n\t\tvar that = this,\n\t\t\t\tman = {},\n\t\t\t\tT = that.Types[e.type];\n\t\t\n\t\tif (!T.manifest) {\n\t\t\t$.extend( true,  man,  that.Item, T.extend );\n\t\t\t$.extend (man, T.replace)\n\t\t} \n\t\telse {\n\t\t\t$.extend( true, man,  T.manifest );\n\t\t}\n\t\t\n\t\treturn man;\n\t}","init": "function ($o,form) {\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t\n\t\t// Render tab preview\n\t\t\n\t\t$o.on(\"click.my\", \"#btn-rendertab\", function(evt){\n\t\t\tvar $c = $(evt.currentTarget), fd, path;\n\n\t\t\t\t\tfd = $c.my().root.my(\"data\");\n\t\t\t\t\tpath = that.Path(fd);\n\t\t\t\n\t\t\tif (true || !fd.snippet) {\n\t\t\t\tthat.Build($.extend(true, {}, d.doc), {\n\t\t\t\t\tpick:path, \n\t\t\t\t\tresolve:false,\n\t\t\t\t\tbuttons:true,\n\t\t\t\t\tsilent:true\n\t\t\t\t}, $c)\n\t\t\t\t.then(function(a){\n\t\t\t\t\tvar mod;\n\t\t\t\t\tif (path.to(1) == \"/\") {\n\t\t\t\t\t\tvar att = (a.result._attachments||{})[path.from(1)],\n\t\t\t\t\t\t\t\tmime;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (att) {\n\t\t\t\t\t\t\tmime = att.content_type;\n\t\t\t\t\t\t\tif (/^text\\/|(javascript|xml|xhtml|json)$/.test(mime)) {\n\t\t\t\t\t\t\t\t// we have text format\n\t\t\t\t\t\t\t\tmod = {\n\t\t\t\t\t\t\t\t\t//json:cw.lib.base64(att.data,true)\n\t\t\t\t\t\t\t\t\tjson:decodeURIComponent(escape(window.atob(att.data)))\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (/javascript$/.test(mime)) {\n\t\t\t\t\t\t\t\t\tvar parsed = that.ParseJS(mod.json, true);\n\t\t\t\t\t\t\t\t\tif (parsed.errors.length) {\n\t\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\t\tmod.comment+='<span class=\"red\">'+parsed.errors.join(\"; \")+'</span><br/>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (parsed.globals.length) {\n\t\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\t\tmod.comment+='Globals: '+parsed.globals.join(\", \");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (mod.comment) mod.comment = '<div class=\"mt10\">'+mod.comment+'</div>';\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_modal(mod);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else if (/^image\\//.test(mime)) {\n\t\t\t\t\t\t\t\t// we have image\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// we have something else\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcw.lib.note(\"Can’t build attachment.\",\"error\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_modal({\n\t\t\t\t\t\t\tjson:cw.lib.json(cw.lib.getref(a.result, path.from(1)), \"  \")\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t\t\n\t\t\t//- - - - - -\n\t\t\t\n\t\t\tfunction _modal(data){\n\t\t\t\treturn $c.modal({\n\t\t\t\t\tmanifest:that.Takeout,\n\t\t\t\t\tdata:data,\n\t\t\t\t\twidth:600,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tbound:10\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t});\n\t}","list": "<div class=\"s3item\"></div>","check": true,"id": "function (e) {return e.id}","hash": "function (e,i) {\n\t\tvar h =  (e.id===this.Active?(this.Search.length+1)+\"-\":\"0-\");\n\t\th+= $.my.f.sdbmCode(Object.reject(e,[\"data\",\"resolved\"]));\n\t\t//h+= this.Search?\"-1\":\"-0\"\n\t\treturn h;\n\t}","delay": 100,"recalc": "#ilist","watch": "#ilist","recalcDepth": 1},"#tabs": {"bind": "this.Tablist","init": "function ($o,form) {\n\t\t\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t$o.on('click.my', '#tabname', function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.List.indexOf(item)==-1) that.List.unshift(item);\n\t\t\tthat.Active = id;\n      that.my.check('#ilist');\n\t\t}.debounce(5));\n\t\t\n\t\t$o.on(\"click.my\", \".btn-tabclose\", function(){\n\t\t\tvar $l = $(this).parent(),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.Tablist.length>1) {\n\t\t\t\tthat.Tablist.remove(function(e){return e===item});\n\t\t\t\tthat.List.remove(function(e){return e===item});\n\t\t\t\tif (!that.List.length) that.List.push(that.Tablist[0]);\n\t\t\t\tthat.Active = that.List[0].id;\n\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t}\n\t\t}.debounce(100));\n\t\t\n\t\t$o.sortable();\n\t\t\n\t}","manifest": {"inherit": ["Path","GetActiveId"],"ui": {"#tabname": {"bind": "function (d) {\n\t\t\t\t\tvar h = (d.state && d.state.sdbm!=d.state.savedSdbm)?'<span class=\"blue2 btn-tabdirty\">●</span>':'';\n\t\t\t\t\treturn this.Path(d)+h;\n\t\t\t\t}","css": {"active": "function (d) {return d.id == this.GetActiveId()}"}}}},"id": "function (e) {return e.id}","hash": "function (e,i) {\n\t\tvar h =  (e.id===this.Active?\"1\":\"0\")+$.my.f.sdbmCode(Object.reject(e,['data','doc']));\n\t\treturn h;\n\t}","list": "<div class=\"vat dib cp tab-tab\"><span id=\"tabname\"></span><span class=\"btn-tabclose\">×</span></div>","watch": "#ilist,#items"},"#btn-publish": {"delay": 150,"css": {":disabled": "function (d) {\n\t\t\tvar obj = this.GetSettings(\"couch\");\n\t\t\treturn (!obj.docid || !obj.dburl || (obj.login && !obj.pwd));\n\t\t}"},"watch": "#sname","bind": "function (d,v,$o) {\n\t\tvar i, async = false,\n\t\t\t\tnote = cw.lib.note,\n\t\t\t\tthat = this,\n\t\t\t\trows, key,\n\t\t\t\terr = {}, atts2go,\n\t\t\t\terrors={},\n\t\t\t\t$root = $o.my().root,\n\t\t\t\toldhtml = $o.html(),\n\t\t\t\tproc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tproc = $.Deferred();\n\t\t\t$o.html('<span class=\"dib vat cw-busy w50 h8 br100 mt5\"></span>');\n\t\t\t$o.attr(\"disabled\", true);\n\t\t\tproc.then(\n\t\t\t\tfunction(msg, skipSave){\n\t\t\t\t\tcw.lib.note(msg || \"Published to CouchDB\",\"ok\");\n\t\t\t\t\tif (!skipSave)  {\n\t\t\t\t\t\td.doc.stamp = Date.now();\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t).always(function(){\n\t\t\t\t$o.attr(\"disabled\", false);\n\t\t\t\t$o.html(oldhtml);\n\t\t\t\tthat.CloseTabs(function(e){return e.folder==\"/inliner\" && e.type==\"attachment\"});\n\t\t\t\t$o.my().root.my(\"redraw\");\n\t\t\t});\n\t\t\t\n\t\t\t//-------\n\t\t\t\n\t\t\tthat.Build(d.doc, {\n\t\t\t\tbuttons:true, \n\t\t\t\tfooter:\"Above items won’t be included.\",\n\t\t\t\tcheckcreds:true\n\t\t\t}, $o)\n\t\t\t.then(function(a){\n\t\t\t\tatts2go = a;\n\t\t\t\t_getEnv ();\n\t\t\t})\n\t\t\t.fail(function(txt, msg, stack){\n\t\t\t\tproc.reject(txt, msg, stack);\n\t\t\t});\n\t\t}\n\t\t\n\t\t// - - - - - - -\n\t\t\n\t\tfunction _getEnv () {\n\t\t\t\n\t\t\tif (!Object.size(atts2go.upload)) {\n\t\t\t\tif (!Object.size(atts2go.err)) proc.resolve (\"All files are up to date, nothing to upload.\", true);\n\t\t\t\telse proc.reject (\"All files, scheduled to upload, have errors. Upload cancelled.\", \"error\");\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tthat.db.get(d.doc._id, {attachments:true})\n\t\t\t\t.then(\n\t\t\t\t\tfunction(odoc){\n\t\t\t\t\t\n\t\t\t\t\t\tif (!odoc) {\n\t\t\t\t\t\t\tproc.reject(\"Doc must be saved at least once before publishing.\", \"error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar ra, na, \n\t\t\t\t\t\t\t\tr = atts2go.result,\n\t\t\t\t\t\t\t\tu = atts2go.upload;\n\n\t\t\t\t\t\tif (Object.size(odoc._attachments)) {\n\t\t\t\t\t\t\tif (!r._attachments) atts2go.result._attachments = {};\n\t\t\t\t\t\t\tra = atts2go.result._attachments;\n\t\t\t\t\t\t\tna = odoc._attachments;\n\t\t\t\t\t\t\tObject.keys(na).forEach(function(i){\n\t\t\t\t\t\t\t\tif (!ra[i] || null==ra[i].data) {\n\t\t\t\t\t\t\t\t\tra[i] = {\n\t\t\t\t\t\t\t\t\t\tcontent_type:na[i].content_type,\n\t\t\t\t\t\t\t\t\t\tdata:na[i].data\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tu[\"/\"+i] = cw.lib.sdbm(na[i].digest);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_go()\n\t\t\t\t\t\t.then(function(msg,req){\n\t\t\t\t\t\t\tfor (var i=0;i<d.doc.items.length; i++) {\n\t\t\t\t\t\t\t\tvar item = d.doc.items[i];\n\t\t\t\t\t\t\t\tif (u[that.Path(item)] || item.snippet) {\n\t\t\t\t\t\t\t\t\tvar ssdbm = item.state.sdbm!=\"Z\" ? item.state.sdbm : u[that.Path(item)];\n\t\t\t\t\t\t\t\t\titem.state.savedSdbm = item.state.sdbm = ssdbm;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tproc.resolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(e,req){\n\t\t\t\t\t\t\tproc.reject(\"Failed to publish, see console\",e,req);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\tfunction (){\n\t\t\t\t\t\t\tproc.reject(\"Doc must be saved at least once before publishing.\", \"error\");\n\t\t\t\t\t});\t\t\t\t\n\t\t\t}\n\t\t}\n\n\t\t// - - - - - - - \n\n\t\tfunction _go(doc){\n\t\t\tvar pi = $.Deferred();\n\t\t\ttry {\n\t\t\t\tthat.Upload(d.doc, $o.my().root, atts2go)\n\t\t\t\t.then(function(msg) {\n\t\t\t\t\tpi.resolve(msg);\n\t\t\t\t})\n\t\t\t\t.fail(function(e,req){\n\t\t\t\t\tpi.reject(e,req);\n\t\t\t\t});\n\t\t\t} catch (e){\n\t\t\t\tpi.reject(e.message);\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\treturn pi.promise();\n\t\t}\n\t\t\n\t}"},"#btn-validate": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar that=this, errors = {}, tdoc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\telse {\n\t\t\t\t\n\t\t\t\t//var tdoc = $.extend(true, {}, d.doc);\n\t\t\t\ttry {\n\t\t\t\tthat.Build(d.doc, {blocking:false}, $o)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(res){\n\t\t\t\t\t\t// here better go some kind of stats\n\t\t\t\t\t\tthat.CloseTabs(function(e){return e.folder==\"/inliner\" && e.type==\"attachment\"});\n\t\t\t\t\t\t$o.my().root.my(\"redraw\");\n\t\t\t\t\t},\n\t\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e.message, e.stack);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}"},"#btn-render": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar a,err, that = this,errors = {}, tdoc, key;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\ttdoc = $.extend(true, {}, d.doc);\n\t\t\t\n\t\t\tthat.Build(tdoc, {\n\t\t\t\tsilent:true\n\t\t\t}, $o)\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\ta = res;\n\t\t\t\t\t_modal();\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t);\n\t\t\t\t\n\t\t\t//----\n\t\t\t// Modal\n\t\t\tfunction _modal () {\n\t\t\t\tvar json = $.my.tojson(a.result, '  '),\n\t\t\t\t\t\tobjurl = URL.createObjectURL(new Blob([json], {type : 'application/json'})),\n\t\t\t\t\t\tfname = (a.result._id+\"\").toLowerCase().replace(/[^a-z0-9\\-\\.]/g,\"-\")+\".json\";\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.Takeout,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tjson:json,\n\t\t\t\t\t\tobjurl: objurl,\n\t\t\t\t\t\tfname: fname\n\t\t\t\t\t},\n\t\t\t\t\twidth:800,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tbound:10\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tjson=\"\";\n\t\t\t\t\tURL.revokeObjectURL (objurl);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t}\n\t}"},"#btn-tar": {"delay": 150,"bind": "function (d,v,$o) {\n\t\tvar a,err, that = this,errors = {}, tdoc, key;\n\t\t\n\t\tif (v!=null) {\n\t\t\t\n\t\t\ttdoc = $.extend(true, {}, d.doc);\n\t\t\t\n\t\t\tthat.Build(tdoc, {\n\t\t\t\tsilent:true\n\t\t\t}, $o)\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tvar i, \n\t\t\t\t\t\tT = that.Tar.Tar(),\n\t\t\t\t\t\ttar = new T(), \n\t\t\t\t\t\ta = res.result._attachments,\n\t\t\t\t\t\turl,r;\n\t\t\t\t\t\n\t\t\t\t\tif (Object.size(a)) {\n\n\t\t\t\t\t\tfor (i in a) {\n\t\t\t\t\t\t\tr = tar.append(i, that.Tar.Bytes(a[i].data));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\turl = URL.createObjectURL(new Blob([r], {type : 'application/x-tar'}));\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\t\tinit:[\n\t\t\t\t\t\t\t\t\t\t'<p class=\"mt10\">Tar archive of _attachments:</p>',\n\t\t\t\t\t\t\t\t\t\t'<div id=\"atar\" class=\"fs110 bold pb10\"></div>'\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\t\t\t\"#atar\": function(d){\n\t\t\t\t\t\t\t\t\t\t\tvar name = tdoc.name.replace(/[^a-z0-9\\.\\-]/ig,'-').replace(/\\-{2,}/g,'-').toLowerCase()+\".tar\",\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml = '<a download=\"' + name + '\" href=\"' + d.url +'\">' +name+'</a>';\n\t\t\t\t\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata:{url:url},\n\t\t\t\t\t\t\t\talign:\"top:102%\",\n\t\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\t\twidth:230,\n\t\t\t\t\t\t\t\tcss:\"fs85 tac xgray\",\n\t\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\t\tenter:true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t}\n\t}"},"#btn-futon": {"bind": "function (d,v,$o) {\n\t\tvar that = this, \n\t\t\t\thref = \"\",\n\t\t\t\tcdb = that.GetSettings(\"couch\"),\n\t\t\t\tcouch = (cdb.dburl||\"\").replace(/\\/$/,'')+'/',\n\t\t\t\tid = cdb.docid;\n\t\t\n\t\tif (!id) id=\"\";\n\t\tif (couch==\"/\") return \"\";\n\t\telse return (\n\t\t\t'<span class=\"fi-database dib vat mt1 mb-1\"></span> <a target=\"_blank\" href=\"'\n\t\t\t+(\n\t\t\t\tid\n\t\t\t\t?(couch+id).replace(/^(http[s]?:\\/\\/[^\\/]+\\/)(.+)$/, \"$1_utils/document.html?$2\")\n\t\t\t\t:couch.replace(/^(http[s]?:\\/\\/[^\\/]+\\/)(.+)$/, \"$1_utils/database.html?$2\").replace(/\\/$/,'')\n\t\t\t)\n\t\t\t+'\">Futon</a>'\n\t\t);\n\t\t\n\t}","watch": "#sname"},"#btn-addfile": {"bind": "function (d,v,$o) {\n    var that = this;\n    if (v!=null) {\n\n      $o.modal({\n        manifest:$.extend(!0,  that.AddFiles, {RT:that.RT, getDup:that.getDup, Types:that.Types}),\n        data:$.extend(\n          true, \n          {doc:d.doc}, \n          {item:that.Types.attachment.manifest.data}, \n          {item:{\n            id:that.GenId(), name:\"\",\n            type:\"attachment\", ext:\"—\"\n          }}\n        ),\n        css:'p15',\n        esc:true,\n        enter:true,\n        width: 560,\n        global:true,\n        screen:true\n      })\n      .then(function(res){\n        \n        var files = res.files,\n            item0 = $.extend(\n              true, {}, \n              that.Types.attachment.manifest.data, \n              {id:'', name:\"\", type:\"attachment\", ext:\"—\"}\n            );\n        \n        if (files.length && !d.doc._attachments) d.doc._attachments = {};\n        \n        files.forEach(function(file){\n          \n          var item = $.extend(true, {}, item0, {\n            id:\t\t\tthat.GenId(),\n            name:\t\tfile.name,\n            folder: file.folder,\n            ext:\t\t'',\n            data:\t\t'File',\n            mime:\t\tfile.content_type,\n            size:\t\tfile.size\n          });\n          \n          var path = that.Path(item).from(1);\n          d.doc._attachments[path] = {\n            data:file.data,\n            content_type:\tfile.content_type,\n            length: file.size\n          };\n          \n          var i = 0, dup = -1;\n          for (i=0; i<d.doc.items.length && dup==-1; i++) {\n            if (that.Path(d.doc.items[i]).from(1) == path) dup = i;\n          }\n          if (dup>-1) d.doc.items[dup] = $.extend(true, {}, item);\n          else d.doc.items.push($.extend(true, {}, item));\n        });\n\n        $o.my(\"find\",\"#ilist\").trigger(\"check\");\n      });\n    }\n  }"}},"Types": {"html": {"name": "HTML","ext": "html","mime": "text/html","primary": true,"stringify": "function (e) { return e.data+\"\" }","postprocess": "function (item,att) {\n\t\tvar that = this;\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t// compress and uglify \n\t\t\tvar s = _compress(att+\"\");\n\t\t\treturn (item.desc?\"<\"+\"!-- \"+item.desc+\"--\"+\">\\n\":\"\") + s;\n\t\t}\n\t\t\n\t\t//- - - - - - - - - - -\n\t\t\n\t\tfunction _compress (h){\n\t\t\t\n\t\t\tvar parse = that.HTMLParser,\n\t\t\t\t\tkeepSpace = [],\n\t\t\t\t\tstack=[],\n\t\t\t\t\tres=[];\n\n\t\t\tparse(h, {\n\t\t\t\tstart: function(tag, attrs, unary) {\n\t\t\t\t\tvar t = tag.toLowerCase(),\n\t\t\t\t\t\t\thtml = _construct(t, attrs, unary);\n\t\t\t\t\tres.push(html);\n\t\t\t\t\tif (!unary) {\n\t\t\t\t\t\tif (/^(script|pre|textarea)$/.test(t)) {\n\t\t\t\t\t\t\tkeepSpace.push(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstack.push({tag:t, attrs:attrs});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function(tag) {\n\t\t\t\t\tvar a, s, process, type, src,\n\t\t\t\t\t\t\tt = tag.toLowerCase();\n\t\t\t\t\tif (t==\"script\") {\n\t\t\t\t\t\ta = stack.last().attrs;\n\t\t\t\t\t\tprocess = true;\n\t\t\t\t\t\tif (a && a.length) {\n\t\t\t\t\t\t\ttype = a.find(function(e){return e.name==\"type\"});\n\t\t\t\t\t\t\tsrc = a.find(function(e){return e.name==\"src\"});\n\t\t\t\t\t\t\tif (type && !/javascript$/i.test(type.value) && !type.value==\"js\") process=false;\n\t\t\t\t\t\t\tif (src) process = false;\n\t\t\t\t\t\t\tif (type && type.value == \"text/x-jquery-tmpl\") res.push(_compact(res.pop()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (process) {\n\t\t\t\t\t\t\ts = res.pop();\n\t\t\t\t\t\t\ttry {s = _compressJS(s);} catch(e){}\n\t\t\t\t\t\t\tres.push(s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tkeepSpace.pop();\n\t\t\t\t\t} \n\t\t\t\t\telse if (t==\"pre\" || t==\"textarea\") keepSpace.pop();\n\n\t\t\t\t\tres.push('</'+t+'>');\n\t\t\t\t\tstack.pop(); \n\t\t\t\t},\n\t\t\t\tchars: function(chars) {\n\t\t\t\t\tif (keepSpace.length) res.push (chars);\n\t\t\t\t\telse res.push (_compact(chars));\n\t\t\t\t},\n\t\t\t\tdoctype: function(t) {res.push(t);},\n\t\t\t});\n\n\t\t\treturn res.join(\"\");\n\t\t}\n\t\t\n\t\t\n\t\t//- - - - - - - - - - -\n\t\t\n\t\tfunction _compact(s){\n\t\t\treturn s.replace(/[\\s\\n\\r\\t]+/g,' ')\n\t\t}\n\t\t\n\t\t\n\t\t//- - - - - - - - - - -\n\n\t\tfunction _compressJS (s0) {\n\t\t\tvar s = s0;\n\t\t\t// compress and uglify \n\t\t\tvar u = UglifyJS,\n\t\t\t\t\tast = u.parse(s+\"\");\n\t\t\tast.figure_out_scope();\n\t\t\tast = ast.transform(u.Compressor({\n\t\t\t\tside_effects: false\n\t\t\t\t//inline_script:true\n\t\t\t}));\n\t\t\tast.figure_out_scope();\n\t\t\tast.mangle_names();\n\t\t\treturn ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>');\n\t\t}\n\n\n\t\t// - - - - - - - - - - - - - - - - - \n\n\t\tfunction _construct (tag, attrs, unary) {\n\t\t\tvar i, c={id:null}, h = '<'+tag;\n\t\t\tif (attrs && attrs.length) {\n\t\t\t\tfor (i=0;i<attrs.length;i++) {\n\t\t\t\t\tc[attrs[i].name] = attrs[i].name.toLowerCase()+(attrs[i].value!=null?'=\"'+attrs[i].escaped+'\"':'');\n\t\t\t\t}\n\t\t\t\tObject.keys(c).forEach(function(e){ if (null!=c[e]) h+=\" \"+c[e]; });\n\t\t\t}\n\t\t\th+=unary?'/>':'>';\n\t\t\treturn h;\n\t\t}\n\t}","defaults": {"data": "<!-- HTML -->\n\n\n","Uglify": false},"extend": {"CMmode": "function (d) {\n\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"htmlmixed\";\n\t\t\telse s.mode = \"ddhtml\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t}","Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Compress HTML code (experimental)</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before compressed code"}]]}},"replace": {},"manifest": null},"js": {"name": "JS","ext": "js","mime": "text/javascript","stringify": "function (item) {  \treturn item.data+\"\"; }","s2o": "function (src) {\n\t\tvar o, err1, err2, ast;\n\t\t// First, try eval assuming we have obj or function \n\t\t// inside our source\n\t\ttry {\n\t\t\to = eval(\"(\"+src+\")\");//JSON.parse(s);\n\t\t} \n\t\tcatch (e) { err1 = e; }\n\t\t\n\t\tif (err1) {\n\t\t\t// if eval fail, try Uglify, and if it parses – return source\n\t\t\ttry {\n\t\t\t\tast = UglifyJS.parse(src);\n\t\t\t} \n\t\t\tcatch (e) { err2 = e; }\n\t\t\tif (!err2) return src; \n\t\t\tthrow err2;\n\t\t}\n\t\t\n\t\tif (err1) throw err1;\n\t\t\n\t\treturn o;\n\t}","postprocess": "function (item,att) {\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t// compress and uglify \n\t\t\tvar u = UglifyJS,\n\t\t\t\t\tast = u.parse(att+\"\");\n\t\t\tast.figure_out_scope();\n\t\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\t\tast.figure_out_scope();\n\t\t\t// No char freq opt to avoid \n\t\t\t// different results from the same code\n\t\t\t//ast.compute_char_frequency();\n\t\t\tast.mangle_names();\n\t\t\treturn (item.desc?\"/*\"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\"*/\\n\":\"\") \n\t\t\t+ ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>');\n\t\t}\n\t}","defaults": {"data": "/* JS */\n\n\n","Uglify": false},"extend": {"CMmode": "function (d) {\n\t\t\tvar s = {autoMatchParens: true, readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"javascript\";\n\t\t\telse s.mode = \"ddjs\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t}","ui": {"#warn": {"delay": 300}},"Err": "function (s) {\n\t\t\tvar parse = this.RT().ParseJS(s);\n\t\t\treturn parse.errors.join(\"<br>\");\n\t\t}","Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Uglify code</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before uglified code"}]]},"validator": "function (d) {\n\t\t\tvar r, f, s = d.data;\n\t\t\ttry {\n\t\t\t\tf = new Function([], (s.to(1)==\"{\" && s.from(-1)==\"}\"?\"return(\"+s+\");\":s));\n\t\t\t} catch (e) {\n\t\t\t\tr = e.message;\n\t\t\t}\n\t\t\tf = null;\n\t\t\treturn r;\n\t\t}"},"replace": {},"manifest": null},"json": {"name": "JSON","ext": "json","mime": "application/json","stringify": "function (e) { \n\t\t\t/*var t;\n\t\t\ttry { t = eval (\"(\"+e.data+\")\"); } catch (err) {}\n\t\t\tif (undefined != t) return $.my.tojson(t);*/\n\t\t\treturn e.data;\n\t\t}","s2o": "function (src) {\n\t\t\tvar o={};\n\t\t\to = eval(\"(\"+src+\")\");//JSON.parse(s);\n\t\t\treturn o;\n\t\t}","s2s": "function (src) {\n\t\t\tvar o={};\n\t\t\to = eval(\"(\"+src+\")\");\n\t\t\treturn $.my.tojson(o);\n\t\t}","destringify": "function (s) {\n\t\t\tvar o={};\n\t\t\ttry {\n\t\t\t\to = eval(\"(\"+s+\")\")//JSON.parse(s);\n\t\t\t} catch(e){\n\t\t\tconsole.log(e,s)\n\t\t\t}\n\t\t\treturn o;\n\t\t}","defaults": {"data": "({\n\t/* Put JSON here */\n})"},"extend": {"CMmode": "function (d) {\n\t\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\t\tif (d.noIncludes) s.mode = \"javascript\";\n\t\t\t\telse s.mode = \"ddjs\";\n\t\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\t\treturn s;\n\t\t\t}","validator": "function (d) {\n\t\t\t\tvar r, f;\n\t\t\t\ttry {\n\t\t\t\t\tf = new Function([], \"return \"+d.data+\";\");\n\t\t\t\t\t$.my.tojson(f());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t\tf=null;\n\t\t\t\treturn r;\n\t\t\t}"},"replace": {},"manifest": null},"css": {"name": "CSS","ext": "css","mime": "text/css","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "/* CSS */"},"extend": {"CMmode": "function (d) {\n\t\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\t\tif (d.noIncludes) s.mode = \"text/css\";\n\t\t\t\telse s.mode = \"ddcss\";\n\t\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\t\treturn s;\n\t\t\t}"},"replace": {},"manifest": null},"txt": {"name": "Text","ext": "txt","mime": "text/plain","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "\n\n\n"},"replace": {},"manifest": null},"erl": {"name": "Erlang","ext": "erl","mime": "text/x-erlang","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "\n\n\n"},"extend": {"CMmode": "function (d) {\n\t\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\t\t/*if (d.noIncludes) s.mode = \"text/css\";\n\t\t\t\telse s.mode = \"ddcss\";\n\t\t\t\tif (s.readOnly) s.mode = \"text\";*/\n\t\t\t\ts.mode = \"erlang\";\n\t\t\t\treturn s;\n\t\t\t}"},"replace": {},"manifest": null},"attachment": {"name": "File attachment","ext": "","mime": "","stringify": "function (e) { return \"\"}","noInsert": true,"defaults": {},"manifest": {"inherit": ["GetDoc","GetActiveId","RT","Path"],"data": {"id": "","folder": "","name": "","mime": "","parser": "","parserActive": false,"ext": "","cache": "864000","data": "","snippet": false,"size": "?","desc": "","state": {"savedSdbm": "","sdbm": "Z","depends": {},"impacts": {}}},"init": "function ($o,form) {\n\t\t\tvar db, d = form.data,\n\t\t\t\t\tthat = this;\n\t\t\t$o.formgen(this.HTML);\n\t\t\t$o.then(function(){\n\t\t\t\tif (!d.preview && /^image\\//.test(d.mime)) {\n\t\t\t\t\t// generate preview\n\t\t\t\t\tvar path = that.Path(d).from(1),\n\t\t\t\t\t\t\tatts = that.GetDoc()._attachments || {},\n\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\trev = that.GetDoc()._rev,\n\t\t\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t\n\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\tvar ico = cw.lib.image($img, \"white\").resample(120);\n\t\t\t\t\t\tif (ico.height()>120) ico.resample(120 * 120/ico.height())\n\t\t\t\t\t\td.preview = ico.sharpen(0.1).contrast(1.05).jpeg(0.75);\n\t\t\t\t\t\t$o.find(\"#fpic\").trigger(\"recalc\");\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tif (rev) {\n\t\t\t\t\t\tvar att = atts[path];\n\t\t\t\t\t\tif (!att || !att.data) {\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdbatt.image(path).then(function(obj, data){\n\t\t\t\t\t\t\t\t//console.log(id, obj, data)\n\t\t\t\t\t\t\t\t$img.attr(\"src\", obj[path].image);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (att.data.length<1e7) {\n\t\t\t\t\t\t\t$img.attr(\"src\",\"data:\"+att.content_type+\";base64,\"+att.data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t}","ui": {"#fpic": "function (d) {\n\t\t\t\tif (d.preview) return '<img src=\"'+d.preview+'\"/>';\n\t\t\t\telse return \"\";\n\t\t\t}","#fname": {"bind": "function (d) {\n\t\t\t\t\tvar html=\"\", \n\t\t\t\t\t\t\tcdb = this.RT().GetSettings(\"couch\"),\n\t\t\t\t\t\t\tbase = cdb.dburl.replace(/\\/$/,'')+'/',\n\t\t\t\t\t\t\tid = cdb.docid,\n\t\t\t\t\t\t\tp = (\n\t\t\t\t\t\t\t\t!d.snippet \n\t\t\t\t\t\t\t\t&& /^http[s]?:\\/\\//.test(base) \n\t\t\t\t\t\t\t\t&& d.folder.to(1)!='.' \n\t\t\t\t\t\t\t\t&& d.state.remote\n\t\t\t\t\t\t\t\t&& id\n\t\t\t\t\t\t\t);\n\t\t\t\t\tif (p) html+='<span class=\"gray fs85 fi-eye\"></span>&nbsp;';\n\n\t\t\t\t\thtml+= d.folder+(d.folder.length>1?d.folder.to(1):\"\");\n\n\t\t\t\t\tif (p) {\n\n\t\t\t\t\t\thtml+='<a target=\"_blank\" href=\"'\n\t\t\t\t\t\t\t\t+(base?base.replace(/\\/$/,'')+\"/\":\"\")\n\t\t\t\t\t\t\t\t+id+\"/\"\n\t\t\t\t\t\t\t\t+(d.folder.length>1?d.folder.from(1)+\"/\":\"\")\n\t\t\t\t\t\t\t\t+d.name\n\t\t\t\t\t\t\t\t+'\">';\n\t\t\t\t\t}\n\t\t\t\t\thtml+= d.name\n\n\t\t\t\t\tif (p) html+='</a>';\n\n\t\t\t\t\treturn html;\n\t\t\t\t}"},"#fmime": {"bind": "mime","watch": "#fname"},"#fsize": {"bind": "function (d) {\n\t\t\t\t\treturn isNaN(d.size)?\"\":(d.size*1)+\" байт\"; \n\t\t\t\t}","watch": "#fname"},"#btn-settings": {"bind": "function (d,v,$o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\t\t\telse $o.modal({\n\t\t\t\t\t\t\tmanifest:this.Settings,\n\t\t\t\t\t\t\tdata:Object.select(d, [\"id\",\"folder\",\"mime\",\"size\",\"name\",\"ext\",\"cache\"]),\n\t\t\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t(window.l||cw).note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\twidth:550,\n\t\t\t\t\t\t\talign:\"top:0;right:0\", // nose:\"top\"\n\t\t\t\t\t\t}).then(function(res){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// moveAtt\n\t\t\t\t\t\t\tvar db, \n\t\t\t\t\t\t\t\t\tnold = that.RT().Path(d).from(1),\n\t\t\t\t\t\t\t\t\tnnew = that.RT().Path(res).from(1),\n\t\t\t\t\t\t\t\t\tdoc = that.RT().data.doc;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (nold != nnew && doc._attachments) {\t\n\t\t\t\t\t\t\t\tif (doc._attachments[nold].data) {\n\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(doc._attachments[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t// we need to load it\n\t\t\t\t\t\t\t\t\tif (db = that.RT().db) {\n\t\t\t\t\t\t\t\t\t\t// cloudwall.me runtime\n\t\t\t\t\t\t\t\t\t\tdb.att(doc._id).data(nold).then(function(att){\n\t\t\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(att[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse _fin();\n\n\t\t\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}","watch": "#fname","css": {":disabled": "function (d,v) {return d.folder == \"/inliner\"}"}},"#showhideproxy": {"bind": "function (d,v,$o) {\n\t\t\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t\t\t}"},"#btn-download": {"bind": "function (d,v,$o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tvar path = that.RT().Path(d).from(1),\n\t\t\t\t\t\t\t\tdoc = that.RT().data.doc,\n\t\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\t\tatt, url=\"\";\n\t\t\t\t\t\tif (doc._attachments && doc._attachments[path] && null!=doc._attachments[path].data) {\n\t\t\t\t\t\t\tatt = doc._attachments[path];\n\t\t\t\t\t\t\t_showModal(att);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// read att\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\tdbatt.data(path).then(function(obj){\n\t\t\t\t\t\t\t\t_showModal(obj[path]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//- - - - - -\n\t\t\t\t\t\n\t\t\t\t\tfunction _showModal(att) {\n\t\t\t\t\t\tvar blob = $.my.f.base642blob(att.data, null, att.content_type),\n\t\t\t\t\t\t\t\turl = URL.createObjectURL(blob);\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar links = [\n              '<div class=\"lh180\">',\n              '<span class=\"fi-download o80\"></span>&nbsp;',\n              '<a class=\"tdn nw\" href=\"'\t+url+'\" '\n                +'download=\"'+that.RT().Path(d).from(1).split(\"/\").last()+'\"'\n                +'target=\"_blank\">Download as a file</a>'\n\t\t\t\t\t\t];\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t/^image\\//.test(att.content_type)\n\t\t\t\t\t\t\t|| /^text\\//.test(att.content_type)\n\t\t\t\t\t\t\t|| /^application\\/(javascript|json)$/.test(att.content_type)\n\t\t\t\t\t\t\t|| /pdf$/.test(att.content_type)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tlinks.push(\n\t\t\t\t\t\t\t'<br/><span class=\"fi-eye o80\"></span> '\n\t\t\t\t\t\t\t\t+'<a class=\"tdn\" href=\"'\t+url+'\" '\n\t\t\t\t\t\t\t\t+'target=\"_blank\">Open in new tab</a>' \n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n            \n            links.push('</div>');\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\tinit:links,\n\t\t\t\t\t\t\t\tui:{ 'a':'a' }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:\"p20 blue fs90\",\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.7)\",\n\t\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\t\twidth:150\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}"}},"validator": "function () {}","HTML": ["<div class=\"b1 edwidth meditor\" id=\"xeditor\" style=\"min-height:200px; padding:35px 100px 35px 50px;\">","<div class=\"db epane\">","<div class=\"control\">","<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-download\" title=\"Render\">","<span class=\"fi-shopping-bag\" ></span>","</button></span>","<button class=\"btn button mr0 btn-r\" id=\"btn-settings\"><span class=\"fi-widget\"  title=\"Settings\"></span>&nbsp;</button>","</div>","</div>","<div id=\"fpic\" class=\"tac\"></div>","<div id=\"fname\" class=\"fs110 xgray lh120 tac\"></div> ","<div id=\"fmime\" class=\"fs80 gray tac\"></div> ","<div id=\"fsize\" class=\"fs80 gray tac\"></div> ","<div id=\"showhideproxy\"></div>","</div>"],"style": {" .epane": "width: 100px;position: absolute;top: 5px;right: 4px;z-index: +5;"," .control": {"": " font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;",":hover": "opacity:1"}," .btn": "width:2em; height:2em; border-radius:2em; line-height:1.6em; vertical-align:top; text-align:center;padding:0;display:inline-block;"," #fname": "word-wrap: break-word; white-space: pre;margin-top: 0px;"},"Settings": {"init": "function ($o,form) { $o.formgen(this.HTML); }","inherit": ["RT"],"ui": {"#npath": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn v;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\t\t\treturn s;\n\t\t\t\t\t}","check": "function (d,v) {\n\t\t\t\t\t\tif (!v) return \"Enter path like <b>/folder/fname.ext</b> for attach\";\n\t\t\t\t\t\tif (!/^[\\/]/.test(v)) return 'Attachment path must start with /';\n\t\t\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t\t\t\t\t}"},"#mime": {"bind": "mime","check": "new RegExp(/^[a-z0-9\\-+\\.]{1,20}\\/[a-z0-9\\-+\\.]{1,30}$/)"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t\t\t}"},"#btn-delitem": {"bind": "function (d,v,$o) {\n\t\t\t\t\t\tif (v!=null) {\n\n\t\t\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t\t\t.delay(60);\n\n\t\t\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}","css": {"self:hide": "function (d) {\n\t\t\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t\t\t}"},"watch": "#folder,#name"}},"HTML": ["<h4 class=\"mb10\">Attachment properties</h4>",{"row": "550px","label": "116px","rowCss": "my-row pb10","labelCss": "fs80 gray"},["","<span class=\"fr\">","inp#mime.w150",{"plc": "MIME"},"</span>","<div class=\"dib vat w380\">","inp#npath.w380",{"plc": "Resource path"},"msg.fs70","</div>","<span class=\"dib vat mt4 ml8\">:</span>"],{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Apply"}," ","btn#btn-cancel",{"val": "Cancel"}," ","btn#btn-delitem.red.fr",{"val": "Delete"}]]}}},"less": {"name": "less","ext": "less","mime": "text/x-less","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": "/* LESS */"},"postprocess": "function (item,att) {\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t\n\t\t\tvar ret=\"\";\n\t\t\tless.render(att+\"\", function(err, res){\n\t\t\t\tif (err) {\n\t\t\t\t\tthrow {message:err.message+\", line \"+err.line};\n\t\t\t\t}\n\t\t\t\telse ret = res.css;\n\t\t\t})\n\t\t\treturn (item.desc?\"/* \"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\" */\\n\":\"\")+ret;\n\t\t}\n\t}","extend": {"CMmode": "function (d) {\n\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"text/x-less\";\n\t\t\telse s.mode = \"ddless\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t}","Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.Uglify = !!(v+\"\");\n\t\t\t\t\t\t\tif (d.Uglify) d.mime = \"text/css\";\n\t\t\t\t\t\t\telse if (d.mime==\"text/css\") d.mime = \"text/x-less\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}","recalc": "#mime"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Compile to CSS</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before compressed code"}]]}},"replace": {},"manifest": null},"md": {"name": "MarkDown","ext": "md","mime": "text/x-markdown","stringify": "function (e) { return e.data+\"\"}","defaults": {"data": " \n\n\n"},"postprocess": "function (item,att) {\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\tvar s = window.marked(att+\"\");\n\t\t\treturn (item.desc?\"<\"+\"!-- \"+item.desc+\"--\"+\">\\n\":\"\") + s;\n\t\t}\n\t}","extend": {"CMmode": "function (d) {\n\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"gfm\";\n\t\t\telse s.mode = \"ddmd\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t}","Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.Uglify = !!(v+\"\");\n\t\t\t\t\t\t\tif (d.Uglify) d.mime = \"text/html\";\n\t\t\t\t\t\t\telse if (d.mime==\"text/html\") d.mime = \"text/x-markdown\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}","recalc": "#mime"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Compile to HTML</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before compiled code"}]]}},"replace": {},"manifest": null},"rtf": {"name": "RichHTML","ext": "html","mime": "text/html","stringify": "function (item) { \n\t\treturn JSON.stringify(item.doc);\n\t}","defaults": {"data": "","doc": {}},"postprocess": "function (item,att,doc) {\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\tvar that = this,\n\t\t\t\t\tobj = JSON.parse(att+\"\"),\n\t\t\t\t\ts, r, h,\n\t\t\t\t\titems = [], \n\t\t\t\t\tatts = doc._attachments||{}, \n\t\t\t\t\tdone = {},\n\t\t\t\t\toitems = {}, \n\t\t\t\t\titem0 = {data:\"\"};\n\t\t\t\n\t\t\tdoc.items.forEach(function(e){oitems[e.id] = e});\n\t\t\t\n\t\t\t// Prepare Inliner instance\n\t\t\t\n\t\t\tvar ed =  $.extend(true, {}, that.Types.rtf.extend.Inliner.Ed, {data:item.doc});\n\t\t\tif (!Object.size(ed.Items)) ed.Items = $.extend(true, {},that.Types.rtf.extend.Inliner.T);\n\t\t\tObject.keys(ed.Items).forEach(function(i){\n\t\t\t\ted.Items[i].RT = function(){return ed}\n\t\t\t});\n\t\t\t\n\t\t\t//console.log($.extend(true,{},ed));\n\t\t\t\n\t\t\tvar res = ed.To.html.call(ed, ed.data, {\n\t\t\t\tstyle:true, \n        //important:true,\n\t\t\t\tinitSync: false,\n        forceNoEdit:true,\n\t\t\t\tforceUpgradeWidgets:false,\n\t\t\t\t//path:'/file/'+id+'/'\n\t\t\t});\n\n\t\t\th = [\n        '<!-- stylesheet -->\\n<style>\\n'+res.style+'</style>\\n\\n',\n        '<!-- scripts -->\\n<sc'+'ript>'+(res.scripts||[]).join('\\n\\n')+'</sc'+'ript>\\n\\n',\n        res.html\n      ].join('');\n\t\t\t\n\t\t\treturn (item.desc?\"<\"+\"!-- \"+item.desc+\"--\"+\">\\n\":\"\") + h;\n\t\t\t\n\t\t}\n\t}","extend": {"params": {"restyle": 200},"inherit": ["db","GetDoc","GetActiveId","RT","Confirm","Att"],"CMmode": false,"ui": {"#editor": {"delay": 150,"init": "function ($o,form) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (form.data.data) {\n\t\t\t\t\t\tvar d = form.data.data;\n\t\t\t\t\t\tif (d.to(1)==\"{\") {\n\t\t\t\t\t\t\tform.data.doc=JSON.parse(d);\n\t\t\t\t\t\t\tform.data.data = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (d.to(1)==\"<\") {\n\t\t\t\t\t\t\tform.data.doc = {\n\t\t\t\t\t\t\t\t_id:\"\", \n\t\t\t\t\t\t\t\ttype:\"inliner\", \n\t\t\t\t\t\t\t\tname:\"\",\n\t\t\t\t\t\t\t\tmeta:{},\n\t\t\t\t\t\t\t\tcontent:[{\n\t\t\t\t\t\t\t\t\t_stamp:cw.lib.hash8(Number.random(1,1e6)+\"x\"+Date.now()),\n\t\t\t\t\t\t\t\t\ttype:\"html\",\n\t\t\t\t\t\t\t\t\tdata:d\n\t\t\t\t\t\t\t\t}], \n\t\t\t\t\t\t\t\ttags:[]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tform.data.data = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tform.data.doc._id = form.data.id;\n\t\t\t\t\tvar ed = $.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{},\n\t\t\t\t\t\tthat.Inliner.Ed,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdb:that.db,\n\t\t\t\t\t\t\tCleanHTML:that.Inliner.CleanHTML,\n\t\t\t\t\t\t\tCollapseItems:that.Inliner.CollapseItems,\n\t\t\t\t\t\t\tItems:that.Inliner.T||that.Inliner.Ed.Items,\n\t\t\t\t\t\t\tAtt: that.Att,\n              Config:{meta:{}},\n              Cmd: function(){return 'edit'},\n              EdContent:\t'#medium'\n            }\n\t\t\t\t\t);\n\t\t\t\t\t$o.my(ed, form.data.doc);\n\t\t\t\t\tvar b = navigator.userAgent;\n\t\t\t\t\tif (/Mac.+Firefox/.test(b)) $o.find(\"#edcontainer\").css({overflow:\"scroll\"});\n\t\t\t\t\telse if (!/Firefox/.test(b)) $o.find(\"#edcontainer\").niceScroll();\n\t\t\t\t}","bind": "doc"}},"Settings": {"ui": {"input[name=\"uglify\"]": {"bind": "function (d,v) {\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.Uglify = !!(v+\"\");\n\t\t\t\t\t\t\tif (d.Uglify) d.mime = \"text/html\";\n\t\t\t\t\t\t\telse if (d.mime==\"text/html\") d.mime = \"application/json\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}","recalc": "#mime"},"#desc": {"bind": "desc","css": {"hide": "function (d) { return !d.Uglify }"},"watch": "input[name=\"uglify\"]"}},"Aux": [[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>","<span> Compile to HTML</span>","</label>"],{"rowCss": "my-row pt3 pb10"},["Comment","inp#desc",{"plc": "Inserted before compiled code"}]]},"style": {" #xeditor": "font-size:111%;"," #topnav": {"": "width: calc(100% - 14px)!important;margin-bottom:1px!important;height:48px!important;font-size:90%;"," .btn-l": "padding-left:5px;"," .btn-c.w40": "width:36px!important;"," .btn-r": "padding-right:2px"," textarea": "padding-right:120px!important"}," .epane ": "top:13px!important;right:16px!important;font-size:90%;"," .my-modal.nose-top:before": "border: 1px solid rrgba(168, 180, 195,0.6)!important; border-top: none;border-right: none;"," .my-modal-overlay": " box-shadow: none!important; border: 1px solid rgba(168, 180, 195,0.6)!important;"," #edcontainer": "function ($form) {\n\t\t\t\tvar height = $form.height()-67;\n\t\t\t\treturn 'height:'+height+'px;padding-right:14px;margin-top:0!important;';\n\t\t\t}"}},"replace": {"HTML": ["<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:500px\">","<div class=\"db epane\">","<div class=\"control\">","<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-rendertab\" title=\"Render\">","<span class=\"fi-shopping-bag\" ></span>","</button></span>","<span><button class=\"btn mr2 button btn-c pl1 pr2 bold\" id=\"btn-parser\" title=\"Parser\">","<span class=\"lh100 fs110\" style=\"letter-spacing:-1px;\">&gt;_</span>","</button></span>","<span><button class=\"btn mr2 button btn-c pr1 pl1\" id=\"btn-deps\" title=\"Dependencies\">","<span class=\"fi-share\" ></span>","</button></span>","<span><button class=\"btn button mr0 btn-r pr3\" id=\"btn-settings\"  title=\"Settings\">","<span class=\"fi-widget\" ></span>","</button><span>","</div>","<div id=\"fname\" class=\"fs90 xgray lh120 hide\"></div> ","<div id=\"warn\" class=\"fs80 red fi-alert lh120 mt10 mr100\"></div> ","<div id=\"showhideproxy\"></div>","</div>","<div style=\"width:100%;margin:0 auto 0px auto;overflow:hidden;\">","<div id=\"editor\" class=\"meditor \" style=\"padding:15px 9px 0 23px;\"></div>","</div>","</div>","<div id=\"xparser\" class=\"edwidth\" style=\"opacity:0.005\">","<div style=\"position:absolute;top:3px;right:5px;z-index:+5\">","<button class=\"fs80 green tac btn-l mr2 button pr7 pl12 lh100\" id=\"btn-source\">","<span class=\"fi-page-edit\" title=\"Source\"></span>","</button>","<button  id=\"btn-play\" title=\"Run parser\" ","class=\"button green fs80 mt0 mb0 mr0 btn-r pl10 pr12 lh100\"><span class=\"fi-play\"></span></button>","</div>","<div class=\"dib vat b1g\" style=\"width:100%;min-height:200px\">","<textarea id=\"parser\" class=\"\" style=\"width:100%\"  class=\"edheight\"></textarea>","</div>","</div>"]},"manifest": null}},"Item": {"inherit": ["GetDoc","GetActiveId","RT","Confirm"],"data": {"id": "","type": "html","snippet": false,"folder": "/","name": "index.html","ext": "","mime": "text/html","desc": "","external": "","data": "<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title> Insert title </title>\n\t</head>\n\t<body>\n\t\tHello!\n\t</body>\n</html>","parser": "// Receives item source as a string, \n// must return new string representation of item\n(function (item){\n\n\treturn item.data+\"\";\n})","parserActive": false,"stashResolved": false,"isBinary": false,"noIncludes": false,"dropImport": false,"tags": [],"state": {"savedSdbm": "","sdbm": "","depends": {},"impacts": {},"crc": ""}},"Track": "function (item) {\n\t\tvar it=item, att,\n\t\t\t\tparser;\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t}\n\t}","init": "function ($o,form) {\n\tvar that = this;\n\t$o.html($.my.formgen(this.HTML)+$.my.formgen(this.HTMLtail));\n\t$o.then(function(){\n\t\t$o.find(\"#xparser\").addClass(\"hide\").css({opacity:1});\n\t\t$o.on(\"change.my\", function(){\n\t\t\tthat.Track(form.data);\n\t\t\tif (form.data.state.sdbm !== form.data.state.savedSdbm) {\n\t\t\t\t$o.parent().my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t}\n\t\t}.debounce(300));\n\t});\n\t\n\t// Error details modal\n\n\t$o.on(\"click.my\",\"#warn\", function(){\n\t\tvar $c = $(this);\n\t\tif ($c.data(\"modal\")) return $c.modal(true);\n\t\tif (that.Err) {\n\t\t\tvar e = that.Err(that.data.data);\n\t\t\t$c.modal({\n\t\t\t\twidth:250,\n\t\t\t\tnose:\"top\",\n\t\t\t\tbound:0,\n\t\t\t\talign:\"top:120%;left:0;\",\n\t\t\t\tesc:true,\n\t\t\t\tenter:true,\n\t\t\t\tmanifest:{\n\t\t\t\t\tinit:['<span id=\"t\" class=\"red lh150\"></span>'],\n\t\t\t\t\tui:{\"#t\":\"t\"}\n\t\t\t\t},\n\t\t\t\tdata:{t:e},\n\t\t\t\tcss:\"fs80\"\n\t\t\t});\n\t\t}\n\t});\n\t\n\t\n\t// Color Picker magic\n\n\t$o.on(\"contextmenu.my\",\".cm-csscolor\", function(evt){\n\t\tvar $i = $(evt.currentTarget),//$(this),\n\t\t\t\tc = $i[0].innerText+\"\",\n\t\t\t\tcm = $i.parents(\"#xeditor\").find(\"#editor\").next()[0].CodeMirror,\n\t\t\t\tx = evt.pageX,\n\t\t\t\ty = evt.pageY,\n\t\t\t\tup = $(window).height()/2>y;\n\n\t\t$i.modal({\n\t\t\twidth:272,\n\t\t\tcss:\"p0\",\n\t\t\tmanifest:that.RT().ColorPicker,\n\t\t\tdata:{css:c},\n\t\t\talign:up?\"top:100%\":\"bottom:140%\",\n\t\t\tnose:up?\"top\":\"bottom\",\n\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\tesc:true,\n\t\t\tenter:true,\n\t\t\tclose:false,\n\t\t\tfocus:\"#cprgb\"\n\t\t})\n\t\t.then(function(picker){\n\t\t\t//console.log(res);\n\t\t\tvar co = cm.coordsChar({left:x, top:y}),\n\t\t\t\t\tline = co.line,\n\t\t\t\t\tidx = co.ch,\n\t\t\t\t\tcd = cm.getDoc(),\n\t\t\t\t\ts = cd.getLine(line),\n\t\t\t\t\tsl = s.length,\n\t\t\t\t\tres = s;\n\t\t\tfor (var i=idx; i>-1; i--) {\n\t\t\t\tvar s0 = s.substr(i);\n\t\t\t\tif (s0.startsWith(c)) {\n\t\t\t\t\tres = s.to(i) + s0.replace(c, picker.css.toLowerCase());\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcd.replaceRange(res, {line:line, ch:0}, {line:line, ch:sl})\n\t\t\t//$i.text(picker.css).trigger(\"input\");\n\t\t});\n\t\treturn false;\n\t});\n\t\n\tif (that.params && that.params.restyle) {\n\t\t$o.then(function(){\n\t\t\t$o.my(\"restyle\");\n\t\t}.debounce(150))\n\t}\n}","ui": {"#editor": {"init": "function ($o,form) {\n      var that = this,\n          d = that.data;\n\t\t\tvar m = this.CMmode(form.data);\n\t\t\tvar ed = CodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: 'text',\n\t\t\t\tlineNumbers:\t\ttrue,\n\t\t\t\tindentWithTabs:\tfalse,\n\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\ttheme: \t\t\t\t\t'default',\n        extraKeys: {\n          'Ctrl-S':\tfunction(){$o.trigger('saveproject.my')},\n          'Cmd-S': \tfunction(){$o.trigger('saveproject.my')},\n          'Ctrl-F':\t_setSearch,\n          'Cmd-F':\t_setSearch\n        },\n        styleSelectedText:true,\n        highlightSelectionMatches: {minChars:3, /*showToken: /\\w/,*/ annotateScrollbar: true}\n\t\t\t});\n\t\t\tObject.keys(m).forEach(function(i){ ed.setOption(i,m[i]); });\n\t\t\t\n\t\t\tvar $cm = $o.next();\n\t\t\t$cm.toggleClass('readonly', !!m.readOnly);\n      \n      // - - - - - - - -\n      \n      function _setSearch(){\n        var s = $o[0].nextSibling.CodeMirror.getSelection();\n        if (s.length>2) {\n          that.RT().Search = that.RT().Search==s?'':s;\n          that.my.parent().my.recalc('#search');\n        }\n      }\n\t\t}","bind": "data"},"#warn": {"bind": "function (d,v,$o) {\n\t\t\tvar r, that = this;\n\t\t\tif (Object.isFunction(that.validator)){\n\t\t\t\ttry {\n\t\t\t\t\tr = that.validator(d);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t}\n\t\t\t$o.html(r?'<div class=\"pt4 pb4\"><span class=\"fi-alert o80\"></span> <span class=\"'\n              +(that.Err?'pseudolink red0 o90':'')+'\">'+r+'</span></div>':\"\");\n\t\t\t$o.toggleClass(\"hide\", !r);\n\t\t\tthat.my.find('#xeditor').toggleClass('b1r', !!r);\n\t\t}","watch": "#editor","delay": 200},"#found": {"delay": 200,"init": "function ($o) {\n      var that = this;\n      // highlight and scroll to found line\n      $o.on('click.my','.pseudolink', function(){\n      \tvar line = +$(this).text(),\n            ed = that.my.find('#editor').next()[0].CodeMirror;\n        \n        ed.scrollIntoView({line:line, char:1}, 48);\n\n        var f = function(){\n          ed.addLineClass(line-1,'background','bg-yellow4');\n          (function(){\n            ed.removeLineClass(line-1,'background','bg-yellow4');\n          }.debounce(100))()\n        };\n        \n        f.debounce(100)();\n        f.debounce(300)();\n      });\n    }","bind": "function (d) {\n\t\t\tvar that = this,\n\t\t\t\t\ts = that.RT().Search,\n\t\t\t\t\tlines = [];\n\t\t\tif (/^.{2,}$/.test(s) && that.GetActiveId() == d.id) {\n\t\t\t\tvar re = new RegExp (RegExp.escape(s), \"i\");\n\t\t\t\td.data.lines().forEach(function(l, i){\n\t\t\t\t\tif (re.test(l)) lines.push(i+1);\n\t\t\t\t});\n        if (lines.length) {\n          return '<div class=\"pt4 pb4\"><span class=\"fi-magnifying-glass fs90 o70\"></span> Found @ '+lines.map(function(e){\n          \treturn '<span class=\"pseudolink\">'+e+'</span>';\n          }).join(', ')+'</div>';\n        }\n\t\t\t}\n      return '';\n\t\t}"},"#fname": {"bind": "function (d) {\n\t\t\tvar html=\"\", \n\t\t\t\t\tbase = this.GetDoc().export.path, \n\t\t\t\t\tp = !d.snippet && (d.type!=\"attachment\");\n\n\t\t\thtml+= d.folder+(d.folder.length>1?d.folder.to(1):\"\");\n\t\t\thtml+= d.name\n\n\t\t\treturn html;\n\t\t}"},"#btn-settings": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this, $f;\n\t\t\tif (v!=null) {\n\t\t\t\t$f = $o;//.my().root;\n\t\t\t\tif ($f.data(\"modal\")) $f.modal(true);\n\t\t\t\telse $f.modal({\n\t\t\t\t\tmanifest: this.Settings,\n\t\t\t\t\tdata:Object.select(\n\t\t\t\t\t\td, \n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\"id type desc folder mime tags size name ext cache\"\n\t\t\t\t\t\t\t+ \" parserActive noIncludes snippet external dropImport\"\n\t\t\t\t\t\t\t+ \" stashResolved isBinary\"\n\t\t\t\t\t\t).split(\" \").add([/^[A-Z]/])\n\t\t\t\t\t),\n\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcw.lib.note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\talign:\"top:0;right:0\", \n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs100\"\n\t\t\t\t}).then(function(res){\n\n\t\t\t\t\t// moveAtt\n\t\t\t\t\tvar nold = that.RT().Path(d).from(1),\n\t\t\t\t\t\t\tnnew = that.RT().Path(res).from(1),\n\t\t\t\t\t\t\tdoc = that.RT().data.doc;\n\t\t\t\t\tif (nold != nnew && doc._attachments) {\n\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t}\n\t\t\t\t\t_fin();\n\n\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\tif (that.CMmode) {\n\t\t\t\t\t\t\tvar m = that.CMmode(d),\n\t\t\t\t\t\t\t\t\t$cm = $o.my(\"find\",\"#editor\").next(),\n\t\t\t\t\t\t\t\t\tcm =  $cm[0].CodeMirror;\n\n\t\t\t\t\t\t\tObject.keys(m).forEach(function(i){ cm.setOption(i,m[i]); });\n\t\t\t\t\t\t\tif (m.readOnly) $cm.addClass(\"readonly\");\n\t\t\t\t\t\t\telse $cm.removeClass(\"readonly\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}","watch": "#fname"},"#showhideproxy": {"bind": "function (d,v,$o) {\n\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t}"},"#btn-deps": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tvar that = this, h=\"\";\n\t\t\t\t\n\t\t\t\tthat.RT().Items2Atts(null, null, {}, true, true);\n\t\t\t\t\n\t\t\t\tvar deps=Object.keys(d.state.depends||{}),\n\t\t\t\t\t\timps = Object.keys(d.state.impacts||{});\n\t\t\t\t\n\t\t\t\t//console.log(d);\n\t\t\t\t\n\t\t\t\tif (deps.length) {\n\t\t\t\t\th+='<div>Depends:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+deps.map(function(i){\n\t\t\t\t\t\t\treturn d.state.depends[i] ? i:'<span class=\"red\">'+i+'</span>';\n\t\t\t\t\t\t}).join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (imps.length) {\n\t\t\t\t\th+='<div>Impacts:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+imps.join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (h) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:$.extend(true, {},that.Confirm,{params:{width:250}}),\n\t\t\t\t\t\twidth:250,\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttext:h, yes:\"Ok\", \tno:\"\", cancel:\"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\tcss:\"fs100 lh170 pb20\",\n\t\t\t\t\t\tesc:true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.lib.note(\"Item has no dependencies.\",\"ok\");\n\t\t\t\t}\n\t\t\t}\n\t\t}","watch": "#fname"},"#btn-rendertab": {"bind": "function () {}","watch": "#fname"},"#btn-source": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#xeditor\");\n\n\t\t\t\t$e.toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t}"},"#btn-parser": {"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#xeditor\");\n\n\t\t\t\t$e.toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t}","css": {"hide": "function (d) {return !d.parserActive}"},"watch": "#fname"},"#btn-play": {"delay": 100,"bind": "function (d,v,$o) {\n\t\t\tvar parser, res, err, atts={}, html=\"\", that=this;\n\t\t\tif (v!=null) {\n\t\t\t\t\n\t\t\t\tif(d.parserActive) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tparser = eval(d.parser);\n\t\t\t\t\t} catch (e){ \n\t\t\t\t\t\tconsole.log(err=\"Parser code has errors, \"+e.message, e.stack);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Object.isFunction(parser)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tres = parser.call(that.RT(), d, atts)+\"\";\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\tconsole.log(err=\"Parser/generator error, \"+e.message, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} \n\t\t\t\t\n\t\t\t\tif (res) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:\tthat.PlayParser,\n\t\t\t\t\t\tdata:\t\t\t{txt:res},\n\t\t\t\t\t\tesc:\t\t\ttrue,\n\t\t\t\t\t\tenter:\t\ttrue,\n\t\t\t\t\t\twidth:\t\t800,\n\t\t\t\t\t\tglobal:\t\ttrue,\n\t\t\t\t\t\tscreen:\t\ttrue\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (err) {\n\t\t\t\t\t(window.l||cw.lib)[\"note\"](err,\"error\");\n\t\t\t\t}\n\t\t\t}\n\t\t}","check": "function (d,v,$o) {\n\t\t\tvar parser, err;\n\t\t\ttry {parser = eval(d.parser);} catch (e){}\n\t\t\terr = (!Object.isFunction(parser)?\"Error\":\"\");\n\t\t\t$o.toggleClass(\"red\",!!err);\n\t\t\treturn err;\n\t\t}","watch": "#parser"},"#parser": {"bind": "parser","init": "function ($o,form) {\n\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: \"javascript\",\n\t\t\t\tlineNumbers:\t\ttrue,\n\t\t\t\tindentWithTabs:\tfalse,\n\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\ttheme: \t\t\t\t\t\"default\"\n\t\t\t});\n\t\t}"}},"validator": "function () {}","CMmode": "function (d) {\n\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\tif (d.noIncludes) s.mode = \"text\";\n\t\telse s.mode = \"ddtext\";\n\t\treturn s;\n\t}","HTMLtail": [],"PlayParser": {"init": "function ($o,form) {\n\t\t\t$o.html('<div><textarea id=\"txt\" disabled=\"disabled\"></textarea></div>')\n\t\t}","ui": {"#txt": "txt"},"style": {" textarea": "line-height:1.4em;font:12px Cousine,'PT Mono', Monaco,monospace;height:400px;overflow:scroll;width:800px; white-space:pre-wrap; word-break: break-all;color: #666!important;opacity: 1!important;"}},"HTML": ["<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:200px\">","<div class=\"db epane\">","<div class=\"control\">","<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-rendertab\" title=\"Render\">","<span class=\"fi-shopping-bag\" ></span>","</button></span>","<span><button class=\"btn mr2 button btn-c pl1 pr2 fw500\" id=\"btn-parser\" title=\"Parser\">","<span class=\"fs120 lh90\" style=\"letter-spacing:-2px;\">&gt;_</span>","</button></span>","<span><button class=\"btn mr2 button btn-c pr1 pl1\" id=\"btn-deps\" title=\"Dependencies\">","<span class=\"fi-share\" ></span>","</button></span>","<span><button class=\"btn button mr0 btn-r pr3\" id=\"btn-settings\"  title=\"Settings\">","<span class=\"fi-widget\" ></span>","</button><span>","</div>","<div id=\"fname\" class=\"fs90 xgray lh120 hide\"></div> ","<div id=\"warn\" class=\"fs80 red1 lh150 mb5 mr120 br2 pl6 pr3 bg-red4\"></div> ","<div id=\"found\" class=\"fs80 bg-yellow2 o80 br2 pl6 pr4 gray0 lh150 mr120 hoverlink\"></div> ","<div id=\"showhideproxy\"></div>","</div>","<textarea id=\"editor\" style=\"width:100%\" class=\"edheight\"></textarea>","</div>","<div id=\"xparser\" class=\"edwidth\" style=\"opacity:0.005\">","<div class=\"control\" style=\"position:absolute;top:6px;right:5px;z-index:+5\">","<span><button class=\" green tac btn-l mr2 button pr7 pl12\" id=\"btn-source\">","<span class=\"fi-page-edit\" title=\"Source\"></span>","</button></span>","<span><button  id=\"btn-play\" title=\"Run parser\" ","class=\"button green  mt0 mb0 mr0 btn-r pl10 pr12\"><span class=\"fi-play\"></span></button></span>","</div>","<div class=\"dib vat b1g\" style=\"width:100%;min-height:200px\">","<textarea id=\"parser\" class=\"\" style=\"width:100%\"  class=\"edheight\"></textarea>","</div>","</div>"],"style": {" .epane": "width:320px; position:absolute; top:5px; right:0px; z-index:+5; background:rgba(255,255,255,0.0);border-radius: 10px;padding: 0px 4px;"," .control": {"": " font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;",":hover": "opacity:1"}," .btn": "width:2em; height:2em; border-radius:2em; line-height:1.6em; vertical-align:top; text-align:center;padding:0;display:inline-block;"," #fname": "word-wrap: break-word; white-space: pre; padding: 5px 0;width: 250px;margin-top: 4px;"," .CodeMirror.readonly": "background-color:rgba(0,0,0,0.03);opacity: 0.6;"},"Settings": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML.add(this.Aux).add(this.Buttons));\n\t}","params": {"width": 550},"inherit": ["RT"],"ui": {"#npath": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\treturn s;\n\t\t\t}","check": "function (d,v) {\n\t\t\t\tif (!v) return \"Enter path like <b>.branch.prop</b> for doc branch or <b>/folder/fname.ext</b> for attach\";\n\t\t\t\tif (!/^[\\/\\.]/.test(v)) return 'Path must start with / or .';\n\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t}\n\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t}"},"#mime": {"bind": "mime","check": "new RegExp(/^[a-z0-9\\-+\\.]{1,30}\\/[a-z0-9\\-+\\.]{1,30}$/)","css": {":disabled": "function (d) {\n\t\t\t\t\treturn (d.folder.to(1)==\".\")\n\t\t\t\t}"},"watch": "#npath"},"#external": {"bind": "function (d,v,$o) {\n\t\t\t\t$o.height(0).height(($o[0].scrollHeight-10).clamp(20,250));\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.external = v;\n\t\t\t\t}\n\t\t\t\treturn d.external;\n\t\t\t}","check": "function (d,v) {\n\t\t\t\tif (!/^[x\\s]?(|(http|https|pouch|doc|local|query):\\/\\/[^\\s\\n\\t]+(\\s[\\S]+)?)$/.test(v)) {\n\t\t\t\t\treturn 'External URL or <i>local://doc_id propertyName</i>';\n\t\t\t\t}\n\t\t\t}","css": {"self:tdl": "function (d,v) {return v.to(1)==\"x\" || v.to(1)==\" \"}"}},"#keywords": {"bind": "tags","init": "function ($o) {\n\t\t\t\ttry {\n\t\t\t\t\t$o.select2({\n\t\t\t\t\t\ttags:Object.keys(this.RT().data.doc.items.reduce(function(a, it){\n\t\t\t\t\t\t\t(it.tags||[]).forEach(function(t){a[t]=true});\n\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t},{})).sort(),\n\t\t\t\t\t\tplaceholder:'Tags or keywords'\n\t\t\t\t\t})\n\t\t\t\t}catch(e) {\n\t\t\t\t\t$o.select2({tags:[]});\n\t\t\t\t}\n\t\t\t}"},"input[name=\"snippet\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t}","recalc": "#cache"},"input[name=\"parser\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.parserActive = !!(v+\"\");\n\t\t\t\treturn d.parserActive?[\"parser\"]:[];\n\t\t\t}"},"input[name=\"noincludes\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.noIncludes = !!(v+\"\");\n\t\t\t\treturn d.noIncludes?[\"noincludes\"]:[];\n\t\t\t}"},"input[name=\"dropimport\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.dropImport = !!(v+\"\");\n\t\t\t\treturn d.dropImport?[\"dropimport\"]:[];\n\t\t\t}","css": {"hide": "function (d,v) {return !d.external || d.external[0]==' ';}"},"watch": "#external"},"input[name=\"stashresolved\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.stashResolved = !!(v+\"\");\n\t\t\t\treturn d.stashResolved?[\"stashresolved\"]:[];\n\t\t\t}"},"input[name=\"isbinary\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.isBinary = !!(v+\"\");\n\t\t\t\treturn d.isBinary?[\"binary\"]:[];\n\t\t\t}"},"#ref": "function (d) {return 'local://'+this.RT().data.doc._id+\" items.id=\"+d.id+'.data' }","#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#btn-delitem": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t\n\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t})\n\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t.delay(50);\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}","css": {"self:hide": "function (d) {\n\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t}"},"watch": "#folder,#name"},"#itemtype": "function (d) {return this.RT().Types[d.type].name}"},"HTML": ["<h4 class=\"mb10\"><span id=\"itemtype\"></span> <span id=\"ref\" class=\"dib lh100 ml10 fs80 lgray\"></span></h4>",{"row": "550px","label": "84px","rowCss": "my-row pb10","labelCss": "fs80 gray pt3"},["","<span class=\"fr\">","inp#mime.w150",{"plc": "MIME"},"</span>","<div class=\"dib vat w380\">","inp#npath.w380",{"plc": "Resource path"},"msg.fs70","</div>","<span class=\"dib vat mt4 ml8\">:</span>"],["Linked to","txt#external.fs90",{"plc": "External resource URL"},"msg.fs80"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"dropimport\" value=\"dropimport\"/>","<span> Do not store imported data in document</span>","</label>"],["Keywords","inp#keywords.fs100","msg.fs80"],{"rowCss": "my-row pb3","labelCss": "fs80 gray pt1"},["Mode","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>"," Fragment (no resource created)","</label>"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"noincludes\" value=\"noincludes\"/>","<span> Skip includes</span>","</label>"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"parser\" value=\"parser\"/>","<span> Additional parser</span>","</label>"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"isbinary\" value=\"binary\"/>","<span> Result is a binary string</span>","</label>"],[" ","<label class=\"gray fs80 dib\">","<input type=\"checkbox\" name=\"stashresolved\" value=\"stashresolved\"/>","<span> Stash result as .resolved item‘s property</span>","</label>"]],"Aux": [],"Buttons": [{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green.w80",{"val": "Apply"}," ","btn#btn-cancel",{"val": "Cancel"}," ","btn#btn-delitem.red.fr",{"val": "Delete"}]],"style": {" textarea": "resize:none;"," .select2-search-field": "font-size:0.9em"}}},"Takeout": {"data": {"json": "error"},"init": ["<textarea id=\"json\" class=\"w100p h400 fs60 lh120 xgray o90\" disabled style=\"font-family:Cousine,'PT Mono'\"></textarea>",["","btn#btn-ok.green.w150.mr30",{"val": "Ok"},"<div class=\"gray fr mt7 fs80\" id=\"stats\"></div>","<a href=\"\" download=\"\" id=\"btn-dl\" target=\"_blank\" class=\"fs90\">Download as a file</a>"],"<div id=\"comment\" class=\"fs70 gray\"></div>"],"ui": {"#btn-ok": "function (d,v,$o) {\n\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t}","#json": "function (d) {\n\t\t\treturn d.json;\n\t\t}","#btn-dl": {"init": "function ($o,form) {\n\t\t\t\tif (form.data.objurl) {\n\t\t\t\t\t$o.attr(\"download\", form.data.fname);\n\t\t\t\t\t$o.attr(\"href\", form.data.objurl);\n\t\t\t\t}\n\t\t\t}","css": {"hide": "function (d) {return !d.objurl}"}},"#stats": {"bind": "function (d) {return d.json.length.metric(2,false)+\"b\"}"},"#comment": {"bind": "comment"}}},"AddItem": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML);\n\t}","params": {"width": 445},"ui": {"#npath": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\treturn s;\n\t\t\t}","check": "function (d,v) {\n\t\t\t\tif (!v) return \"Enter path like <b>.branch.prop</b> for doc branch or <b>/folder/fname.ext</b> for attach\";\n\t\t\t\tif (!/^[\\/\\.]/.test(v)) return 'Path must start with / or .';\n\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t}\n\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t}"},"#ntype": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.type = v+\"\";\n\t\t\t\t}\n\t\t\t\treturn [d.type]\n\t\t\t}","init": "function ($o) {\n\t\t\t\tvar i, r, x, \n\t\t\t\t\t\tt = this.RT().Types,\n\t\t\t\t\t\ta=[], em;\n\t\t\t\tfor (i in t) {\n\t\t\t\t\tr = t[i];\n\t\t\t\t\tif (!r.noInsert) {\n\t\t\t\t\t\n\t\t\t\t\t\tif (!em && r.primary) {\n\t\t\t\t\t\t\tem = {};\n\t\t\t\t\t\t\tem[r.name] = i;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tx = {};\n\t\t\t\t\t\t\tx[r.name] = i;\n\t\t\t\t\t\t\ta.push(x);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$o.tags({tags:[a], empty:em});\n\t\t\t\t}\n\t\t\t}"},"input[name=\"snippet\"]": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t}","recalc": "#cache"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.name || \n\t\t\t\t\t\tthis.getDup(d)\n\t\t\t\t\t);\n\t\t\t\t}"},"watch": "#npath"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"}},"HTML": [{"row": "445px","label": "116px","labelCss": "fs80 gray","rowCss": "my-row pt5 pb7"},"<h4 class=\"mt0\">Create resource</h4>",["","spn#ntype.fs90"],["","inp#npath",{"plc": "Resource path"},"msg.fs70"],{"rowCss": "my-row pt5 pb10"},["","<label class=\"gray fs80\">","<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>"," Fragment (no resource created)","</label>"],{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Create"}," ","btn#btn-cancel",{"val": "Cancel"}]],"Typelist": ["html"]},"AddFiles": {"init": "function ($o) {\n\t\tvar that = this;\n\t\t\n\t\t$o.html(that.HTML);\n\t}","data": {"files": []},"ui": {"#flist": {"bind": "files","list": ">div","merge": false,"id": ["name"],"hash": "function (e) {return cw.lib.sdbm([e.name, e.content_type, e.data.length, e.data.to(100)])}","manifest": {"inherit": ["getDup"],"data": {"folder": "","name": "","ext": ""},"ui": {"#fname": {"bind": "function (d,v) {\n              if (v!=null) {\n                d.name = d.ext = d.folder = '';\n                var sep = v.to(1);\n                var a = v.split(sep);\n                if (a.length == 2) {\n                  d.folder = sep;\n                  d.name = a[1];\n                } else {\n                  d.folder = sep+a[1];\n                  d.name = a.from(2).compact().join(sep);\n                }\n\n                return v;\n              }\n              var s =  d.folder+(d.folder.length>1?d.folder.to(1):'')+d.name;\n              return s;\n            }","check": "function (d,v) {\n              if (!v) return \"Enter path like <b>/folder/fname.ext</b>\";\n              if (!/^[\\/\\.]/.test(v)) return 'Path must start with /';\n              if (v.length<2) return 'Path can not be empty';\n              if (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n              if (this.getDup(d,v)) return \"Resource already exists\"\n            }"},"#fsize": "function (d,v) {\n\t\t\t\t\t\treturn (d.data.length/4*3|0).bytes(1).replace(/B$/,'b').replace(\n\t\t\t\t\t\t\t/^([0-9\\.]+)([a-z]+)$/i,\n\t\t\t\t\t\t\t'$1<div class=\"w35 dib tal pl2\">$2</div>'\n\t\t\t\t\t\t);\n\t\t\t\t\t}","#ftype": "content_type","#btn-fdel": {"delay": 10,"bind": "function (d,v) {\n              if (v!=null) {\n                this.my.root().trigger('layout.my');\n                this.my.remove();\n              }\n            }","events": "click.my"}}}},"#btn-attadd": {"bind": "function (d,v) {if(v!=null) this.my.commit();}","css": {":disabled": "function (d) {return !d.files.length}"},"watch": "#flist"},"#btn-attcancel": "function (d,v) {if(v!=null) this.my.cancel();}","#mupload": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v==null || !v) return;\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tflist = $o[0].files,\n\t\t\t\t\t\tfiles = [],\n\t\t\t\t\t\tresult = d.files.reduce(function(a,b){a[b.fname] = b;return a;},{}),\n\t\t\t\t\t\tpis = [];\n\t\t\t\t\n\t\t\t\tfor(var i=0; i<flist.length;i++) files.push(flist[i]);\n\t\t\t\t\n\t\t\t\tfiles.forEach(function(f, i){\n\t\t\t\t\tif (!f || result[f.name]) return;\n\t\t\t\t\t//a.name = f.name;\n\t\t\t\t\tvar data,\n\t\t\t\t\t\t\ta = {\n                fname:\tf.name,\n\t\t\t\t\t\t\t\tname: '/'+f.name.replace(/\\s+/g,'-'),\n\t\t\t\t\t\t\t\tcontent_type: f.type || 'application/octet-stream'\n\t\t\t\t\t\t\t}, \n\t\t\t\t\t\t\tpi = $.Deferred(),\n\t\t\t\t\t\t\tfr = new FileReader(), \n\t\t\t\t\t\t\tri, \n\t\t\t\t\t\t\tsb64 = [];\n\t\t\t\t\t\n\t\t\t\t\tfr.onload = function(e){\n\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\ta.size = sb64.length;\n\t\t\t\t\t\tresult[f.name] = a;\n\t\t\t\t\t\tpi.resolve();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t\tpis.push(pi.promise())\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tQ.allSettled(pis)\n\t\t\t\t.then((function(){\n\t\t\t\t\td.files = Object.values(result);\n\t\t\t\t\t$o.wrap('<'+'form>').closest('form').get(0).reset();\n\t\t\t\t\t$o.unwrap('form');\n\t\t\t\t\tthat.my.recalc('#flist');\n          that.my.check('#flist');\n          that.my.root().trigger('layout.my');\n\t\t\t\t}).debounce(0));\n\t\t\t}"}},"HTML": "<div class=\"fs120 lh160 bolder\">Add files</div><div id=\"flist\"><div class=\"frow  mb6\"><div id=\"btn-fdel\" class=\"red2 w20 dib vat pt3 cp\">✕</div><div class=\"w300 dib vat\"><input type=\"text\" class=\"w100p\" id=\"fname\" placeholder=\"File path/name.ext\"><div class=\"my-error-tip mt4 mb0\" style=\"display:none\"></div></div><div id=\"fsize\" class=\"w90 dib vat pt3 gray tar\"></div><div id=\"ftype\" class=\"w150 dib vat pt3 gray nw ell\"></div></div></div><div class=\"mt10\"><input id=\"mupload\" type=\"file\" multiple class=\"h30 w100p cp\" style=\"position:absolute;z-index:1;opacity:0;\"><div class=\"h30 pseudolink tdn\">Select files to attach...</div></div><div class=\"mt5 pt10 btd\"><button id=\"btn-attadd\" class=\"green mr2\">Attach files</button><button id=\"btn-attcancel\">Cancel</button></div>","style": {" ": "font-size:16px;"}},"AddImage": {"data": {"filename": "","folder": "","quality": "0.98","data": "","preview": "","mime": "image/jpeg","mode": ["inline"],"cropped": false,"width": "300","height": "200","scale": "1","crop": {},"srcsize": true},"params": {"width": 1020},"style": {" .jcrop-holder": "display:inline-block;vertical-align:middle"},"Recalc": "function (d,$o,update) {\n\t\tvar that = this;\n\t\tif (that.Active ==\"fh\") {\n\t\t\td.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fh\").trigger(\"check\");\n\t\t}\n\t\telse if (that.Active == \"fw\") {\n\t\t\td.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t\telse {\n\t\t\td.width = (d.crop.w*d.scale).floor();\n\t\t\td.height = (d.crop.h*d.scale).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t}","ui": {"#folder": {"bind": "folder","check": "new RegExp(/^[a-z0-9\\-\\.]{0,20}$/i)","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"#format": {"bind": "function (d,v) {\n\t\t\t\tif(v!=null) {\n\t\t\t\t\td.quality = v;\n\t\t\t\t\tif (v+\"\"==\"1\") {\n\t\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.png');\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.jpg');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.quality;\n\t\t\t}","init": "function ($o) {\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[[\n\t\t\t\t\t\t{\"High quality JPEG\":\"0.98\"},\n\t\t\t\t\t\t{\"Normal\":\"0.95\"},\n\t\t\t\t\t\t{\"Med\":\"0.88\"},\n\t\t\t\t\t\t{\"Low\":\"0.75\"},\n\t\t\t\t\t]],\n\t\t\t\t\tempty:{\"PNG\":\"1\"}\n\t\t\t\t})\n\t\t\t}","watch": "#folder","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"#fname": {"bind": "filename","check": "function (d,v) {\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\t//if (this.getDup(d, v)) return \"Имя занято\";\n\t\t\t}","watch": "#folder,#format","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"input[name=\"srcsize\"]": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.srcsize = !!(v+\"\");\n\t\t\t\t}\n\t\t\t\tif (d.srcsize) {\n\t\t\t\t\tthis.Active = \"\";\n\t\t\t\t\tthis.Recalc (d, $o, false);\n\t\t\t\t}\n\t\t\t\treturn d.srcsize?[\"srcsize\"]:[];\n\t\t\t}","watch": "#folder","css": {"hide": "function (d) { return !Object.size(d.crop)}"}},"#fw": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.width=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)\t) d.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.width+\"\";\n\t\t\t}","recalcDepth": 1,"delay": 20,"watch": "#fh,#folder,input[name=\"srcsize\"]","css": {"hide": "function (d) { return !Object.size(d.crop)}","self:gray": "function (d,v,$o) {\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}"}},"#fh": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.height=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)) d.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.height+\"\";\n\t\t\t}","watch": "#fw","recalcDepth": 1,"delay": 20,"css": {"self:gray": "function (d,v,$o) {\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}"}},"#file": {"bind": "function (d,v,$o) {\n\t\t\n\t    \t\tvar f,that = this,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\timg=\"\";\n\t    \t\t\n\t    \t\t\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\td.filename = f.name\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.replace(/[^a-z0-9\\-\\.]/gi,'');\n\t\t\t\t\t\t\t//.replace(/\\.[^\\.]+$/,\"\")+\".jpg\";\n\n\t\t\t\t\t\tvar ext = d.filename.split(\".\").last();\n\t\t\t\t\t\tif (ext==\"png\") d.quality=\"1\";\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\td.filename = d.filename.replace(/\\.[^\\.]+$/,\"\")+\".jpg\";\n\t\t\t\t\t\t\td.quality=\"0.98\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\timg = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tfr.onloadend = function (){\n\t\t\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\t\t\td.scale = $img[0].naturalWidth/$img.width();\n\t\t\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\t\t\tallowMove:true,\n\t\t\t\t\t\t\t\t\tbgColor:\"white\"\n\t\t\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\t\t\tthis.animateTo([0,0,100,100]);\n\t\t\t\t\t\t\t\t\td.crop.z=1;\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#folder\").trigger(\"check\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\timg=\"\";\n\t\t\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$img.removeClass(\"hide\")\n\t\t\t\t\t\t\t\t.attr(\"src\",\"data:image/jpeg;base64,\"+img);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//d.scale=$img[0].naturalWidth/$img.width();\t\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction preview(c){\n\t\t\t\t\t$.extend(d.crop, Object.select(c,[\"x\",\"y\",\"w\",\"h\"]));\n\t\t\t\t\td.cropped=true;\n\t\t\t\t\t\n\t\t\t\t\tthat.Recalc(d, $o, true);\n\t\t\t\t}\n\t\t\t}"},"#btn-apply": {"bind": "function (d,v,$o) {\n\t\tvar f, that = this,\n\t\t\t\t$r = $o.my().root,\n\t\t\t\t$c = $r.find(\"#x1\"),\n\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t$c2 = $r.find(\"#x2\"),\n\t\t\t\tn={k:d.scale}, img=\"\",\n\t\t\t\twidth=d.width*1.5;\n\n\t\tif (v!=null && d.cropped) {\n\t\t\t_create (d.crop);\n\t\t\t\n\t\t\tif (d.quality+\"\" !=\"1\") {\n\t\t\t\td.data = $o.my(\"find\",\"#x1\")[0].toDataURL('image/jpeg',+d.quality).substr(23);\n\t\t\t\td.mime = \"image/jpeg\";\n\t\t\t} else {\n\t\t\t\td.data = $o.my(\"find\",\"#x1\")[0].toDataURL('image/png').substr(22);\n\t\t\t\td.mime = \"image/png\";\n\t\t\t}\n\n\t\t\tvar ico = cw.lib.image($c,\"white\").resample(120);\n\t\t\tif (ico.height()>120) ico.resample(14400/ico.height())\n\t\t\td.preview = ico.sharpen(0.1).contrast(1.05).jpeg(0.65);\n\n\t\t\t$o.trigger(\"commit\");\n\t\t}\n\n\t\tfunction _create (c){\n\t\t\tif(parseInt(c.w) > 0) {\n\t\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\t\tk = n.k,\n\t\t\t\t\t\tw = c.w*k, // scale width/height\n\t\t\t\t\t\th = c.h*k; \n\n\t\t\t\tif (!that.Active) {\n\t\t\t\t\tcs = $c[0];\n\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\tctx.drawImage(img, (c.x*k).floor(), (c.y*k).floor(), d.width*1, d.height*1, 0, 0, d.width*1, d.height*1);\n\n\t\t\t\t} else { \n\t\t\t\t\tif (w>d.width*2) {\n\t\t\t\t\t\tcs2 = $c2[0];\n\t\t\t\t\t\tcs2.width=d.width*2;\n\t\t\t\t\t\tcs2.height=2*d.height;\n\t\t\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\t\t\tctx2.rect(0, 0, cs2.width, cs2.height);\n\t\t\t\t\t\tctx2.fillStyle='white';\n\t\t\t\t\t\tctx2.fill();\n\t\t\t\t\t\tctx2.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*2,d.height*2);\n\n\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\tctx.drawImage(cs2, 0, 0, d.width*2,d.height*2, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\tctx.rect(0, 0, cs.width, cs.height);\n\t\t\t\t\t\tctx.fillStyle='white';\n\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\tctx.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}","events": "click.my","watch": "#folder","css": {":disabled": "function (d) { return !Object.size(d.crop)}"}},"#btn-close": {"bind": "function (d,v,$o) {if (v!=null) $o.trigger(\"cancel\");}","events": "click.my"}},"init": "function ($o,form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\thtml = $.my.formgen([\n\t\t\t'<div class=\"fl mr20 tac vat bg-lgray\" style=\"'\n\t\t\t+'width:800px;height:600px;overflow:hidden;position:relative;line-height:600px;\" id=\"crop-frame\">',\n\t\t\t\t\t'<img id=\"source\" class=\"vam\" style=\"max-width:800px; max-height:600px;background-color:white; \" src=\"\" />',\n\t\t\t\t'<div class=\"w800  dib\" style=\"height:600px;position:absolute;top:0;left:0\">',\n\t\t\t\t\t'<span class=\"dib vam fs110 button\">',\n\t\t\t\t\t'<span class=\"fi-photo\"><span class=\"fs110\"> &nbsp;Select image</span></span>',\n\t\t\t\t\t'</span>',\n\t\t\t\t\t'<input type=\"file\" id=\"file\" class=\"w800 dib\" accept=\"image/jpeg,image/png\" '\n\t\t\t\t\t+'style=\"height:600px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xpreview\">',\n\t\t\t\t{row:\"200px\",rowCss:\"pb10 my-row\"},\n\t\t\t\t[\"\",\"inp#folder\",{plc:\"Folder\"},\"msg.fs70\"],\n\t\t\t\t[\"\",\"inp#fname\",{plc:\"Filename\"},\"msg.fs70\"],\n\t\t\t\t[\"\", \"spn#format.fs80\"],\n\t\t\t\t[\"\",\"num#fw.w90.fs110.sizer\",{min:20, max:3000, step:5},'&thinsp;&thinsp;×&thinsp;&thinsp;', \n\t\t\t\t \t\"num#fh.w90.fs110.sizer\", {min:20, max:3000, step:5}],\n\t\t\t\t/*[\"\",\"spn#mode.fs100.lh150\"],*/\n\t\t\t\t[\"\", '<label class=\"fs80\">',\n\t\t\t\t \t'<input type=\"checkbox\" name=\"srcsize\" value=\"srcsize\">',\n\t\t\t\t \t' &nbsp;Original dimensions',\n\t\t\t\t\t'</label>'],\n\t\t\t\t{rowCss:\"\"},\n\t\t\t\t[\"\",\n\t\t\t\t \"btn#btn-apply.w200.green.fs120.tac\",{val:\"Crop\"},\n\t\t\t\t //\"btn#btn-orig.w200.tac\",{val:\"Вставить оригинал\"},\n\t\t\t\t \"btn#btn-close.w200.tac\",{val:\"Cancel\"}\n\t\t\t\t],\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xwarn\"></div>',\n\t\t\t'<div class=\"hide\">',\n\t\t\t\t'<canvas id=\"x2\" width=400 height=400></canvas>',\n\t\t\t\t'<canvas id=\"x1\" width=200 height=200></canvas>',\n\t\t\t'</div>'\n\t\t]);\n\t\t$o.html(html);\n\t\tthat.Active = \"\";\n\t\t$o.on(\"focus.my\",\".sizer\", function(){\n\t\t\tif (!d.srcsize) {\n\t\t\t\tthat.Active = $(this).attr(\"id\");\n\t\t\t\t$(this).removeClass(\"gray\");\n\t\t\t} else {\n\t\t\t\tthat.Active = \"\";\n\t\t\t}\n\t\t});\n\t\t\n\t}"},"ParseErrors": {"init": "function ($o,form) {\n\t\t$o.formgen(this.HTML);\n\t}","params": {"width": 450},"ui": {"#errs": {"bind": "function (d,v,$o) {\n\t\t\t\tvar i, h = '<table width=\"450\">';\n\t\t\t\tfor (i in d.err) {\n\t\t\t\t\th+='<tr><td class=\"w150 xgray pr15 brw btd\">'\n\t\t\t\t\t\t+i+'</td><td class=\"red vam btd\">'\n\t\t\t\t\t\t+d.err[i].join(\"<br>\")\n\t\t\t\t\t\t+'</td></tr>';\n\t\t\t\t}\n\t\t\t\treturn h+'</table>'\n\t\t\t}"},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#errtitle": "function (d) {\n\t\t\tvar i = Object.size(d.err), e = Object.values(d.err).flatten().length;\n\t\t\treturn \"Found \"+e+\" error\"+(e>1?\"s\":\"\")+\" in \"+i+\" item\"+(i>1?\"s\":\"\");\n\t\t}","#efooter": {"bind": "function (d) { return \"&nbsp;\"+d.footer}","css": {"hide": "function (d) {return !d.footer}"}},".ebtns": {"css": {"hide": "function (d) {return !d.buttons}"}}},"HTML": ["<h4 class=\"mb10 fs100\" id=\"errtitle\"></h4>",{"row": "450px","label": "100px","rowCss": "my-row pb10","labelCss": "fs80 gray"},"<div id=\"errs\" class=\"fs80 w450\"></div>","<div id=\"efooter\" class=\"fs80 fi-alert xgray mt5\"></div>",{"rowCss": "my-row pt12 mt7 btd fs80 ebtns"},["","btn#btn-ok.green",{"val": "Proceed"}," ","btn#btn-cancel",{"val": "Cancel"}]],"style": {" td": "padding:4px 0; font-size:85%; line-height:1.2em;"," .brw": "word-break:break-word"," #errs": "max-height:400px;overflow-y:auto;"}},"Confirm": {"id": "cw.Sys.YesNoCancel","params": {"delay": 5,"width": 450},"data": {"text": "","css": "xgray","yes": "Yes","no": "No","cancel": "Cancel","cmd": ""},"init": "function ($o,form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t    '<div class=\"'+d.css+'\">'+d.text+'</div>',\n\t\t\t{label:\"70px\", row:form.params.width+\"px\", rowCss:\"my-row mt15 pt15 fs90 mb-5 xgray btd\"},\n\t\t\t['', 'spn#btn-yes.button.green.mr5',{txt:d.yes}, \n\t\t\t \t'spn#btn-no.button.mr5',{txt:d.no}, \n\t\t\t\t'spn#btn-cancel.button.fr',{txt:d.cancel}]\n\t\t]);\n\t}","ui": {"#btn-yes": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"yes\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.yes}"}},"#btn-no": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"no\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.no}"}},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"cancel\";\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.cancel}"}}}},"DocParams": {"inherit": ["Path","RT"],"init": "function ($o,form) { \n\t\t$o.formgen(this.HTML);\n\t\tvar that = this, d = form.data;\n\t\tif (!(d.creds.crypto + '')) {\n\t\t\t$.extend(!0, that.couch, d.couch);\n\t\t} else if (cw.crypto && cw.crypto.has(d.creds.crypto)) {\n\t\t\tif (!d.creds.CRYPTO) {\n\t\t\t\td.creds.crypto = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar obj = cw.crypto.dec(d.creds);\n\t\t\t\tif (!obj.CRYPTO) {\n\t\t\t\t\t$.extend(!0, that.couch, obj.couch);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthat.nokey = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t} else {\n\t\t\tthat.nokey = true;\n\t\t}\n\t}","nokey": false,"couch": {"dburl": "","docid": "","login": "","pwd": ""},"ui": {"#title": {"bind": "name","check": "new RegExp(/^.+$/)"},"#ddtags": {"init": "function ($o) {\n        $o.select2({\n          tags:this.RT().db && Object.isFunction(this.RT().db.tags)?this.RT().db.tags():[],\n          minimumResultsForSearch:15,\n          placeholder:'Project tags'\n        });\n      }","bind": "tags"},"#login": {"bind": "this.couch.login"},"#pwd": {"bind": "this.couch.pwd","check": "function (d,v) {\n\t\t\t\tif (this.couch.login && !v) return 'Password required';\n\t\t\t}","watch": "#login"},"#docid": {"bind": "this.couch.docid","check": "new RegExp(/^(_design\\/)?[^\\s\\r\\t\\n\\/_][^\\s\\r\\t\\n\\/]{0,200}$/i)"},"#url": {"bind": "function (d,v,$o) {\n\t\t\t\t$o.height(0).height($o[0].scrollHeight-8);\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tthis.couch.dburl = v;\n\t\t\t\t}\n\t\t\t\treturn this.couch.dburl;\n\t\t\t}","check": "new RegExp(/^(http[s]?:\\/)?\\/[^\\s\\r\\t\\n]{1,200}$|^\\.$/)"},"#preview": {"bind": "site.previewBase","check": "new RegExp(/^http[s]?:\\/\\/[^\\s\\r\\t\\n]{3,200}$/)","css": {"hide": "function () {return true}"}},"#btn-ok": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tvar that = this, i;\n\t\t\t\t\tif (d.creds.crypto+\"\" && !that.nokey) {\n\t\t\t\t\t\tfor (i in d.couch) d.couch[i]=\"\";\n\t\t\t\t\t\td.creds = cw.crypto.enc({\n\t\t\t\t\t\t\tcrypto:d.creds.crypto+\"\",\n\t\t\t\t\t\t\tcouch:Object.clone(that.couch, true)\t\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (!(d.creds.crypto+\"\")) {\n\t\t\t\t\t\t$.extend(d.couch,that.couch);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}"},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}"},"#cryptokey": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.creds.crypto=v;\n\t\t\t\t\tif (v!=\"_\") d.creds.crypto=v;\n\t\t\t\t\telse d.creds.crypto=\"\";\n\t\t\t\t}\n\t\t\t\treturn v||d.creds.crypto||\"_\";\n\t\t\t}","init": "function ($o) {\n\t\t\t\t$o.html(\n\t\t\t\t\t[ {id:\"_\",name:\"No encryption\"} ]\n\t\t\t\t\t.add( cw.crypto?cw.crypto.keys():[] )\n\t\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t\t},\"\")\n\t\t\t\t).select2();\n\t\t\t}","css": {"hide": "function () {return !cw.crypto || this.nokey;}"}},"#haskey": {"css": {"hide": "function () { return !!this.nokey}"}},"#nokey": {"css": {"hide": "function () {return !this.nokey}"}},"#exportmode": {"bind": "export.options","init": "function ($o) {\n\t\t\t\t$o.tags({tags:[[{\"Extend existing\":\"extend\"},{\"Replace it\":\"replace\"}]]});\n\t\t\t}"},"#btn-import": {"delay": 100,"bind": "function (d,v,$o) {\n    \n    if (v==null) return;\n    \n    var that = this, i, j, url,\n        obj = that.couch || that.RT().GetSettings(\"couch\"),\n        couch = obj.dburl.replace(/\\/$/,'')+'/',\n        creds = (obj.login && obj.pwd) ? obj.login +\":\" + obj.pwd :'',\n        id = obj.docid,\n        headers = {Accept:\"text/plain\"},\n        op;\n\n    if (couch == './') {\n      // local doc\n      op = that.RT().db.get(id, {attachments:true});\n    }\n    else {\n      // Remote doc\n      url = couch+id;\n      if (creds) headers.Authorization = 'Basic '+ cw.lib.base64(creds);\n\n      that.my.root().addClass('busy');\n\n      op = $.ajax({\n        url:\t\t\turl+'?attachments=true',\n        method:\t\t'GET',\n        cache:\t\tfalse,\n        dataType:\t'json',\n        headers:\theaders\n      });\n    }\n\n    // load doc\n    op.then(\n      _processDoc,\n      function(){\n        that.my.root().removeClass('busy');\n        cw.lib.note('Couldn‘t fetch doc to import.','error');\n      }\n    );\n\n    return;\n\n    // - - - - - - - - - - - - - - - - - -\n\n    function _processDoc (nd){\n      // merge\n      var i, \n          nda = nd._attachments,\n          od = d.items,\n          oda = nd._attachments && !d._attachments?(d._attachments={}):d._attachments,\n          nogo = {},\n          ctr = od.length;\n      // existing\n      od.forEach(function(e){nogo[that.Path(e)]=true});\n\n      that.my.root().removeClass(\"busy\");\n\n      //enum nodes\n      var ext = []; \n\n      var iter = function(e, node, start) {\n        var n1 = node || nd, \n            os = start ?Object.clone(start,true):({folder:'.',data:''});\n        if (nogo[(os.folder != '.'?os.folder:'')+'.'+e]) return;\n        if (!node && Object.isObject(n1[e])){\n          Object.keys(n1[e]).forEach(iter.fill(undefined, n1[e], {folder:'.'+e,data:''}));\n          return;\n        }\n        os.name = e;\n        if (Object.isString(n1[e])) {\n\n          var n2 = cw.lib.unjson([n1[e]]);\n          if (!Object.isString(n2[0])) {\n            ext.push($.extend(true, os, {\n              type:\t'json',\n              data:\t'('+cw.lib.js2txt(n2[0],'  ').replace(/\\n+/g,'\\n')+')',\n              mime:\t'application/json'\n            }));\n          }\n          else {\n            var tmode = _guessCodeType(n1[e]);\n            ext.push($.extend(true, os, {\n              type:\ttmode[0],\n              data:\tn1[e],\n              mime:\ttmode[1]\n            }));\n          }\n        }\n        else ext.push($.extend(true, os,{\n          type:\t'json',\n          data:\t'('+cw.lib.js2txt(cw.lib.unjson(n1[e]),'  ').replace(/\\n+/g,'\\n')+')',\n          mime:\t'application/json'\n        }));\n      };\n\n      Object.keys(Object.reject(nd,/^_/)).forEach(iter.fill(undefined, false, {folder:'.',data:''}));\n\n      ext.forEach(function(obj) {\n        var ni = $.extend(!0,{}, that.RT().Item.data, {id:that.RT().GenId()});\n        $.extend(ni, obj);\n        od.push(ni);\n      });\n\n      //enum new atts\n      Object.keys(nda||{}).forEach(function(i){\n\n        if (!nogo['/'+i]) {\n\n          var n = nda[i],\n              nm = n.content_type, \n              ni = $.extend(!0,{}, that.RT().Item.data, {id:that.RT().GenId(), data:''});\n\n          ni.type = 'attachment';\n          ni.mime = nm;\n          if (!i.has('/')) ni.name = i;\n          else {\n            var a = i.split('/');\n            ni.folder = \"/\"+a[0];\n            ni.name = a.slice(1).join(\"/\");\n          }\n\n          // look for editable attaches \n          if (nm == 'text/plain') \t\t\t\t\t\tni.type = 'txt';\n          else if (/\\/javascript$/i.test(nm)) ni.type = 'js';\n          else if (/\\/json$/i.test(nm)) \t\t\tni.type = 'json';\n          else if (/\\/css$/.test(nm)) \t\t\t\tni.type = 'css';\n          else if (/\\/[x]?htm[l]?$/.test(nm)) ni.type = 'html';\n\n          if (ni.type != 'attachment') ni.data = cw.lib.base64(n.data, true);\n          else oda[i] = {\n            content_type: nm || 'application/octet-stream',\n            data:\t\t\t\t\tn.data\n          };\n\n          if (typeof ni.data != 'string') {\n            ni.data = cw.lib.js2txt(ni.data, '  ');\n            if (ni.type == 'json' || ni.type=='js') ni.data = '('+ni.data+')';\n          }\n          od.push(ni);\n        }\n      });\n\n      if (od.length> ctr) {\n        cw.lib.note('Fetched '+(od.length - ctr)+' nodes. Click Apply button to merge with the project.','ok', 5000);\n      }\n      else {\n        cw.lib.note('Added no new nodes from imported doc.');\n      }\n    }\n\n    // - - - - - - - - - -  -\n\n    function _guessCodeType(t){\n      var start = t.substr(0,800),\n          mode = ['txt','text/plain'];\n      if ((start.match(/(var\\s|const\\s|function[\\s\\(]|return\\s|[\\s\\t]if\\s)/g)||[]).length > 2) {\n        mode = ['js','application/javascript'];\n      }\n      else if (\n        /<\\/(div|span|p|a|script|head|title|svg|path)/.test(start)\n        || /<(svg|path|group)\\s/.test(start)\n      ) {\n        mode = ['html','text/html'];\n      }\n      else if (CodeMirror.modes.erlang && /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/.test(start)) {\n        mode = ['erlang','text/x-erlang'];\n      }\n      return mode;\n    }\n  }","css": {":disabled": "function (d) {\n      var db = this.couch.dburl,\n          isurl = /^(http[s]?:\\/)?\\/[^\\s\\r\\t\\n]{1,200}$|^\\.$/.test(db);\n      return (!this.couch.docid || !isurl);\n    }"},"watch": "#docid,#url"}},"HTML": ["<h4 class=\"mb10\">Doc and remote CouchDB settings</h4>",{"row": "525px","label": "125px","rowCss": "my-row pb10 fs90","labelCss": "fs90 gray"},["Proj title","inp#title.bold"],["Proj tags","inp#ddtags.w100p.fs105"],["Preview URL","inp#preview",{"plc": "URL of an app or preview"}],["Remote DB","txt#url.fs100",{"plc": "Full CouchDB URL with port and DB name"}],["Doc _id","<span>","inp#docid.w310.mr10",{"plc": "Any valid CouchDB _id"},"</span><span>","btn#btn-import.w80",{"val": "Import"},"</span>"],"<section id=\"haskey\">",["Login / pwd","<span>","inp#login.w200.mr10",{"plc": "CouchDB login"},"</span>","<span>","inp#pwd.w190",{"plc": "CouchDB password"},"</span>"],["Encrypt creds","sel#cryptokey.w200"," <span class=\"fs90 gray pl10\">Key to encrypt secrets</span>"],"</section>","<section id=\"nokey\" class=\"hide red fs90 pt10 pb10\">","Credentials are encrypted with the key you don‘t have, sorry.","</section>",["If doc exists","spn#exportmode"],{"rowCss": "my-row pt15 mt7 btd fs90"},["","btn#btn-ok.green",{"val": "Apply"}," ","btn#btn-cancel",{"val": "Cancel"}]],"style": {" textarea": "resize:none;"}},"About": {"params": {"width": 400},"init": "function ($o) {\n\t\t$o.formgen([\n\t\t\t'<div class=\" fs90 xgray\">',\n\t\t\t\t'<img src=\"\" id=\"ico\" class=\"w25 mr7 dib vat ml-3\" />',\n\t\t\t\t'<h3 class=\"fs140 mt0 teal o80 dib vat mb0\"></h3>',\n\t\t\t\t'<p id=\"ver\" class=\"mt0 fs90 teal o70 mb20 pl30\"></p>',\n\t\t\t\t'<p class=\"fs90\">',\n\t\t\t\t\t'For more details about app visit ',\n\t\t\t\t\t'<a href=\"http://ddoc.me\" target=\"_blank\">Ddoc Lab project site</a>.',\n\t\t\t\t'</p>',\n\t\t\t\t'<p class=\"fs90\">',\n\t\t\t\t\t'This app was entirely created in browser ',\n\t\t\t\t\t'using <a href=\"http://cloudwall.me\" target=\"_blank\">cloudwall.me</a>. ',\n\t\t\t\t\t'No single line of code was written in standalone IDE.',\n\t\t\t\t'</p>',\n\t\t\t\t'<p class=\"fs90\">',\n\t\t\t\t\t'© 2018 ermouth',\n\t\t\t\t'</p>',\n\t\t\t'</div>'\n\t\t])\n\t}","ui": {"#ico": "function (d) {return this.RT().files[\"logo70.png\"].url}","h3": "function () {\n\t\t\treturn \"Ddoc Lab \"\n\t\t}","#ver": "function () {\n\t\t\treturn \"Version \" + this.RT().Version + (this.RT().build?\", build \" + this.RT().build:\"\");\n\t\t}"}},"Build": "function (doc0,opts0,$o) {\n\t\n\tvar i,j,that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\ttdoc = doc0 || that.data.doc,\n\t\t\t\n\t\t\topts = $.extend(!0,{ \n\t\t\t\tbuttons:true, \n\t\t\t\tfooter:\"\", \n\t\t\t\tcheckcreds:false,\n\t\t\t\tpick:\"\",\n\t\t\t\tresolve:true,\n\t\t\t\tsilent:false,\n\t\t\t\tblocking:true\n\t\t\t},Object.reject(opts0||{},\"errors\")),\n\t\t\t\n\t\t\terrors = (opts0||{}).errors || {},\n\t\t\tkey,\n\t\t\titems={},\n\t\t\t_process;\n\t\n\tfor (i=0;i<tdoc.items.length;i++) {\n\t\tif ( !tdoc.items[i].snippet && (j=that.Path(tdoc.items[i])).to(1) != \".\") {\n\t\t\titems[j.from(1)] = tdoc.items[i];\n\t\t}\n\t}\n\t\n\t// Make app busy\n\tif (that.app && that.app.busy) {\n\t\tpi.always(function(){ that.app.busy(false); });\n\t\tthat.app.busy(true);\n\t}\n\t\n\t// Decode / prepare creds\n\tvar couch = that.GetSettings(\"couch\");\n\t\n\tif (null==couch.docid) {\n\t\tif (opts.checkcreds) pi.reject(\"Can’t decode encrypted doc _id and credentials.\");\n\t}\n\t\n\t_process = _Process.debounce(100);\n\t\n\ttry {\n\t\tif (opts.resolve) that.ResolveExternals(tdoc, errors).always(_process);\n\t\telse _process();\n\n\t} catch(e) {\n\t\tpi.reject(\"Error during validation\", e.message, e.stack);\n\t}\n\t\n\treturn pi.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _Process (){\n\t\tvar a = that.Items2Atts(tdoc, that.Types, errors, opts.pick?opts.pick:true);\n\n\t\tif (couch.docid) a.result._id = couch.docid;\n\n\t\tif (Object.size(a.err)) {\n\t\t\t// Remove busy shield\n\t\t\tif (that.app && that.app.busy) that.app.busy(false);\n\t\t\t// Ask user what to do\n\t\t\t$o.modal({\n\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\tdata:$.extend(!0, {}, opts,a ),\n\t\t\t\tesc:true,\n\t\t\t\tenter:true,\n\t\t\t\tscreen:opts.blocking?'rgba(255,255,255,0.5)':false,\n\t\t\t\talign:\"top:105%\",\n\t\t\t\tnose:\"top\",\n\t\t\t\tbound:10,\n\t\t\t\tdrag:!opts.blocking\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\t_result(a);\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\tpi.reject(\"Cancelled\");\n\t\t\t});\n\t\t} \n\t\telse {\n\t\t\tif (!opts.silent) cw.lib.note(\"Doc integrity seems to be Ok.\");\n\t\t\t_result(a);\n\t\t}\n\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _result(a){\n\t\tif (a.result) {\n\t\t\tvar att  = a.result._attachments;\n\t\t\t\n\t\t\t// Make it last node of the doc\n\t\t\tdelete a.result._attachments;\n\t\t\ta.result._attachments = att;\n\n\t\t\t//console.log(a);\n\n\t\t\t// load binary atts\n\t\t\tthat.db.get(d.doc._id, {\n\t\t\t\tattachments:true\n\t\t\t})\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tif (res._attachments) for (var i in res._attachments) {\n\t\t\t\t\t\tif (!a.result._attachments[i] || null == a.result._attachments[i].data) {\n\t\t\t\t\t\t\ta.result._attachments[i] = {\n\t\t\t\t\t\t\t\tcontent_type:res._attachments[i].content_type,\n\t\t\t\t\t\t\t\tdata:res._attachments[i].data\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(items[i]) items[i].state.crc = $.my.f.sdbmCode(res._attachments[i].data);\n\t\t\t\t\t};\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t},\n\t\t\t\tfunction(){\n\t\t\t\t\tif (!opts.silent) cw.lib.note(\"Doc is not yet saved, you may need to save doc.\", \"warning\");\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t} // --end _result\n\t\n}","ResolveExternals": "function (doc0,errs) {\n\tvar that = this, \n\t\t\tpis,\n\t\t\tasync,\n\t\t\tpending = {},\n\t\t\tdoc = (doc0 || that.data.doc),\n\t\t\trows = doc.items,\n\t\t\tz = $.Deferred(),\n\t\t\thasErrors = false,\n\t\t\terr = errs || {},\n\t\t\toitems = {};\n\t\n\trows.forEach(function(e){oitems[e.id] = e});\n\t\n\tpis = rows.map(function(e,i){\n\t\tvar s=\"\", id='', p = e.external, pi; \n\t\tif (p && !/^[x\\s]/.test(p)) {\n\t\t\tasync = true;\n\t\t\tpi = $.Deferred();\n\t\t\t\n\t\t\t// Local doc\n\t\t\tif (p.startsWith(\"pouch://\") || p.startsWith(\"local://\")) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"pouch \"+id]) pending[\"pouch \"+id] = that.db.get(id, {attachments:true});\n\t\t\t\t\n\t\t\t\tpending[\"pouch \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process local doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load local doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){ pi.reject(\"Failed to load local doc '\"+id+\"'\"); }\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t// Local query\n\t\t\telse if (p.startsWith('query://')) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\t\n\t\t\t\t// check if query has db\n\t\t\t\tvar db,\n\t\t\t\t\t\tq = p[0].split(\"/\").to(3);\n\t\t\t\tif (q.length < 2 && q[0]!=='_all_docs') pi.reject('Too short path for query');\n\t\t\t\telse {\n\t\t\t\t\tdb = q[0]=='_all_docs'?cw.db(that.db.name):q.length<3?that.db:cw.db(q[0]);\n\t\t\t\t\tif (db) {\n\t\t\t\t\t\tvar query = q.last(2).join('/'),\n\t\t\t\t\t\t\t\tparams,\n\t\t\t\t\t\t\t\terr;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparams = eval (s?'('+s+')':'');\n\t\t\t\t\t\t\tif (params !== undefined && !Object.isObject(params)) err = 'Params must be an object';\n\t\t\t\t\t\t\telse params = params || {};\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\terr = 'Invalid params for query';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!pending['query '+p.join(' ')]) {\n\t\t\t\t\t\t\t\tpending['query '+p.join(' ')] = query=='_all_docs'?db.allDocs(params):db.query(query, params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpending['query '+p.join(' ')].then(\n\t\t\t\t\t\t\t\tfunction(res) {\n\t\t\t\t\t\t\t\t\tpi.resolve(res.rows);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfunction(){ pi.reject(\"Query '\"+p.join(\" \")+\"' failed\"); }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi.reject(\"PouchDB DB '\"+q[0]+' does not exist' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Local doc, other DB\n\t\t\telse if (p.startsWith(\"doc://\")) {\n\t\t\t\tp = p.from(6).split(/\\s+/).compact(true);\n\t\t\t\t\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tvar dbid = id.split(\"/\",1)[0];\n\t\t\t\tid = id.from(dbid.length+1);\n\t\t\t\t\n\t\t\t\tif (cw.db(dbid)) {\n\t\t\t\t\n\t\t\t\t\tif (!pending[\"doc \"+p[0]]) {\n\t\t\t\t\t\tpending[\"doc \"+p[0]] = cw.db(dbid).get(id, {attachments:true});\n\t\t\t\t\t}\n\n\t\t\t\t\tpending[\"doc \"+p[0]].then(\n\t\t\t\t\t\tfunction(doc) {\n\n\t\t\t\t\t\t\tif (!doc) {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse if (s) {\n\t\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\t\tif (r) pi.resolve(r);\n\t\t\t\t\t\t\t\telse pi.reject(\"Failed to process PouchDB doc '\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t +p[0]+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.resolve(doc);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\"); }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tpi.reject(\"PouchDB DB '\"+dbid+' does not exist' );\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// External request\n\t\t\telse if (/^http[s]?:\\/\\//.test(p)) {\n\t\t\t\tp = p.split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"url \"+id]) {\n\t\t\t\t\t\n\t\t\t\t\tif ('https:'==window.location.protocol && !id.startsWith(window.location.protocol)) {\n\t\t\t\t\t\tpending[\"url \"+id] = $.Deferred().reject('forbidden protocol').promise();\n\t\t\t\t\t}\n\t\t\t\t\telse \tpending[\"url \"+id] = $.ajax({\n\t\t\t\t\t\t\turl:id,\n\t\t\t\t\t\t\tcache:false,\n\t\t\t\t\t\t\ttype:\"GET\",\n\t\t\t\t\t\t\tdataType:s?\"json\":\"text\",\n\t\t\t\t\t\t\t//xhrFields:{withCredentials:/^https/.test(id)}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpending[\"url \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tvar json, r;\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tif (!Object.isObject(doc) && !Object.isArray(doc)) {\n\t\t\t\t\t\t\t\ttry { doc = JSON.parse(doc) } catch (e) { }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tr = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process external doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load external doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction (msg){ pi.reject(\"Failed to load external doc '\"+id+\"'\" + (Object.isString(msg)?': '+msg:'')); }\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t// Unknown, reject\n\t\t\telse {\n\t\t\t\tpi.reject(\"Failed to load resource \"+id+', protocol is unknown.');\n\t\t\t}\n\t\t\t\n\t\t\treturn pi.promise();\n\t\t\t\n\t\t} else {\n\t\t\treturn e.data;\n\t\t}\n\t});\n\n\tif (!async) z.resolve();\n\telse {\n\t\tQ.allSettled(pis)\n\t\t.then(\n\t\t\tfunction(reps){\n\t\t\t\treps.forEach(function(elt,i){\n\t\t\t\t\t\n\t\t\t\t\tvar d = rows[i], \n\t\t\t\t\t\t\taname = that.Path(d),\n\t\t\t\t\t\t\tfconv,\n\t\t\t\t\t\t\tconvresult,\n\t\t\t\t\t\t\tval;\n\t\t\t\t\tif (!d) {\n\t\t\t\t\t\t// possibly item was removed\n\t\t\t\t\t\t// by converter\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (elt.state ===\"fulfilled\") {\n\t\t\t\t\t\tval = elt.value;\n\n\t\t\t\t\t\tif (Object.isString(val)) rows[i].data = val;\n\t\t\t\t\t\telse if (Object.isObject(val)) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (val.type && that.X[val.type] && (fconv = that.X[val.type][rows[i].type])){\n\t\t\t\t\t\t\t\t// we have converter\n\t\t\t\t\t\t\t\ttry {  convresult = fconv.call (that, val, d, oitems);  } \n\t\t\t\t\t\t\t\tcatch(e) { convresult = e.message; }\n\n\t\t\t\t\t\t\t\tif (convresult) {\n\t\t\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t\t\t\t_e(aname, \"Converter error:\" + convresult);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (rows[i].ext=='js') {\n\t\t\t\t\t\t\t\trows[i].data = cw.lib.js2txt(cw.lib.unjson(elt.value),'\\t');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/*else if (rows[i].type==\"rtf\") {\n\t\t\t\t\t\t\t\tif (elt.value.type==\"inliner\") {\n\t\t\t\t\t\t\t\t\trows[i].doc = $.extend(!0,{},elt.value,{_id:rows[i].id});\n\t\t\t\t\t\t\t\t\trows[i].data = \"\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t\t\t\t_e(aname, 'Invalid external doctype, must be \"inliner\".');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}*/\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\trows[i].data = JSON.stringify(val, null, '\\t');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\trows[i].data = JSON.stringify(val, null, '\\t');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// error, promise rejected\n\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t_e(aname, elt.reason);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// apply oitems additions/deletions\n\t\t\t\t// to doc.items\n\t\t\t\t\n\t\t\t\tvar items = [], \n\t\t\t\t\t\tatts = doc._attachments||{}, \n\t\t\t\t\t\tdone = {};\n\n\t\t\t\tdoc.items.forEach(function(elt){\n\t\t\t\t\tif (oitems[elt.id]) {\n\t\t\t\t\t\t_item(oitems[elt.id]);\n\t\t\t\t\t\tdone[elt.id]=true;\n\t\t\t\t\t} \n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tObject.keys(oitems).forEach(function(i){\n\t\t\t\t\tif (done[i]) return;\n\t\t\t\t\tif (oitems[i]) _item(oitems[i]);\n\t\t\t\t\telse {\n\t\t\t\t\t\tif(doc._attachments) {\n\t\t\t\t\t\t\tvar item = doc.items.find(function(e){ return e.id==i });\n\t\t\t\t\t\t\tvar path = that.Path(item);\n\t\t\t\t\t\t\tif (path.to(1)==\"/\") {\n\t\t\t\t\t\t\t\tdelete doc._attachments[path.from(1)];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// put updated items list back into doc\n\t\t\t\t\n\t\t\t\tdoc.items = items;\n\t\t\t\t\t\t\n\t\t\t\tif (!hasErrors) z.resolve();\n\t\t\t\telse z.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t\t\n\t\t\t\t//- - - - - - - - - - - \n\t\t\t\t\n\t\t\t\tfunction _item(item0) {\n\t\t\t\t\t\n\t\t\t\t\t//console.log(item0)\n\t\t\t\t\t\n\t\t\t\t\tvar item = item0;\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\tif (item.type==\"attachment\" && Object.isObject(item.data)) {\n\n\t\t\t\t\t\t\tvar path = that.Path(item);\n\t\t\t\t\t\t\n\n\t\t\t\t\t\t\tif (path.to(1)==\"/\") {\n\t\t\t\t\t\t\t\tif (!doc._attachments) doc._attachments={};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdoc._attachments[path.from(1)] = Object.select(item.data, [\"content_type\",\"digest\",\"data\"]);\n\t\t\t\t\t\t\t\titem.data = \" Ext doc \";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//delete item.preview;\n\t\t\t\t\t\t//item.random = cw.lib.sdbm(Date.now+\"\");\n            if (!items.find(function(e){return e.id==item.id && e.state.crc == item.state.crc;})) {\n\t\t\t\t\t\t\titems.push(item);\n            }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tfunction(e){\n\t\t\t\tz.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t}\n\t\t)\n\t}\n\t\n\treturn z.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n}","Items2Atts": "function (doc0,Types,prevErrors,pick0,depsOnly) {\n\tvar i, j, e, item, \n\t\t\tthat=this,\n\t\t\tdoc = doc0 || that.data.doc,\n\t\t\tbuildAll = !!pick0,\n\t\t\tpick = Object.isString(pick0)?pick0:\"\",\n\t\t\tt = Types || that.Types, \n\t\t\terr = prevErrors || {},\n\t\t\t\n\t\t\tnames = {}, dirty = {},\n\t\t\taname=\"\", a={}, sn={}, pp={}, tmp = {},\n\t\t\tsrc = {}, fin = {}, stash = {},\n\t\t\t\n\t\t\tincls = {}, \n\t\t\tfvalidator = null, \n\t\t\tisinvalid = null,\n\t\t\tz={};\n\t\n\tvar reSnippet = /([{[]\\/\\*\\{\\{[.\\/-][.\\/_a-z0-9-]+\\}\\}\\*\\/[}\\]])|(\"\\{\\{[.\\/-][.\\/_a-z0-9-]+\\}\\}\")|(\\{\\{[.\\/-][.\\/_a-z0-9-]+\\}\\})/gi;\n\n\t\n\t// gen empty res obj\n\tvar couch = that.GetSettings(\"couch\");\n\t\n\tif (couch.docid) z._id = couch.docid;\n\tif (/^_design\\//.test(couch.docid)) z.name = doc.name\n\tz._attachments = {};\n\t\n\t// gen work structs\n\tfor (i=0;i<doc.items.length;i++) {\n\t\te = doc.items[i];\n\t\tif (e) {\n\t\t\taname = that.Path(e);\n\t\t\tnames[aname]=true;\n\t\t\tsn[aname]=e.snippet;\n\t\t\tsrc[aname]=doc.items[i];\n\t\t\tif (e.stashResolved) stash[aname] = true;\n\t\t\tif (Object.isFunction(t[e.type].postprocess)) pp[aname] = t[e.type].postprocess.bind(that);\n\t\t}\n\t}\n\t\n\t\n\t// stringify\n\tObject.keys(names).sortBy().forEach(_convert);\n\n\t\n\t// Resolves include directives.\n\t// Possible syntaxes are:\n\t// {{.res.name }} \t\t\t– inserts as is\n\t// {/*{{.res.name }}*/} – inserts as is\n\t// [/*{{.res.name }}*/] – inserts as is\n\t// \"{{.res.name }}\" \t\t– inserts stringified version\n\t\n\t// parse includes\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) _parseIncludes (i);\n\t}\n\t\n\t// merge snippets deps into files \n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\ttmp = {};\n\t\t\tfor (j in e.state.depends) \n\t\t\t\tif (sn[j] && src[j].state.depends) \n\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t$.extend(e.state.depends, tmp);\n\t\t\t//e.state.depends = tmp;\n\t\t}\n\t}\n\t\n\t// merge files deps into files \n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\tif (e) {\n\t\t\t\ttmp = {};\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j) && a[j] && !sn[j] && src[j].state.depends) {\n\t\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$.extend(e.state.depends, tmp);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// clean impacts\n\tfor (i in src) {\n\t\tif (src.hasOwnProperty(i)) {\n\t\t\tif (e = src[i]) {\n\t\t\t\te.state.impacts = {};\n\t\t\t}\n\t\t}\n\t}\n\t\t\n\t// rebuild impacts (reverse deps)\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) {\n\t\t\tif (e = src[i]) {\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j)) {\n\t\t\t\t\t\tif (src[j]) src[j].state.impacts[i] = true;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t//console.log(\"Missing include \"+j+\" in \"+i);\n\t\t\t\t\t\t\te.state.depends[j] = false;\n\t\t\t\t\t\t\t_e(i, \"Missing include '\"+j+\"'\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t\n\tif (depsOnly) return {\n\t\terr: err,\n\t\tdoc:doc\n\t};\n\t\t\n\t// build list of items to be updated\n\tvar imps = {};\n\tfor (i in a){\n\t\tif (a.hasOwnProperty(i) && (!pick || i === pick)) {\n\t\t\te = src[i];\n\t\t\tif (!!buildAll || e.state.sdbm !== e.state.savedSdbm) {\n\t\t\t\t$.extend (true, imps, e.state.impacts);\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t// add dependees to dirty list, \n\t// they also need to be updated\n\tfor (i in imps) {\n\t\tif (imps.hasOwnProperty(i)) {\n\t\t\te = src[i];\n\t\t\tif (e) {\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//console.log(\"Dirties wired to rebuild: \", dirty);\n\t\n\t// build snippets\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && sn[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving snippet include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\n\t// build files\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !sn[i] && src[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving file include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// validate finalized versions\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && (!sn[i] || i === pick) && !err[i] && src[i]) {\n\t\t\tfvalidator = null;\n\t\t\tisinvalid = null;\n\t\t\ttry {\n\t\t\t\tfvalidator = (t[src[i].type].manifest || t[src[i].type].extend || {}).validator;\n\t\t\t\tif (Object.isFunction(fvalidator)) {\n\t\t\t\t\tisinvalid = fvalidator ({data:fin[i]});\n\t\t\t\t}\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Final result is not of type '\"+src[i].type+\"': \"+er.message);\n\t\t\t}\n\t\t\tif (isinvalid != null) _e(i, \"Final result is not of type '\"+src[i].type+\"': \"+isinvalid);\n\t\t}\n\t}\n\t\n\n\t// build attachments and branches\n\tvar temp0;\n\tfunction _renderItemFin(i) {\n\t\tif (i.to(1) == \"/\") return t[src[i].type].s2s?t[src[i].type].s2s(fin[i]):fin[i];\n\t\telse return t[src[i].type].s2o?t[src[i].type].s2o(fin[i]):fin[i];\n\t}\n\t\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !err[i] && src[i]) {\n\t\t\t\n\t\t\ttemp0 = null;\n\t\t\t\n\t\t\tif (stash[i]) {\n\t\t\t\ttemp0 = _renderItemFin(i);\n\t\t\t\tstash[i] = temp0; \n\t\t\t}\n\t\t\t\n\t\t\tif (!sn[i] || i === pick) {\n\t\t\t\ttry {\t\n\t\t\t\t\t\n\t\t\t\t\tif (temp0 === null) temp0 = _renderItemFin(i);\n\t\t\t\t\t\n\t\t\t\t\tif (i.to(1)==\"/\") {\n\t\t\t\t\t\tif (src[i].isBinary && Object.isString(temp0) && /^[\\u0000-\\u00ff]+$/.test(temp0)) {\n\t\t\t\t\t\t\ta[i].data = window.btoa (temp0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ta[i].data = $.my.f.base64(temp0, false, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsrc[i].state.crc = $.my.f.sdbmCode(temp0);\n\t\t\t\t\t\tz._attachments[i.from(1)] = a[i];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$.extend(true,z, $.my.f.unmask(temp0, i.from(1)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (er) {\n\t\t\t\t\t_e(i, \"Include was not updated, error: \"+er.message);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\tvar process={};\n\tfor (i in src) {\n\t\tif (src.hasOwnProperty(i)) {\n\t\t\t\n\t\t\t//if (stash[i] && !err[i] && stash[i]!==true) src[i].resolved = stash[i];\n\t\t\tif (stash[i] && !err[i] && stash[i]!==true) {\n\t\t\t\tsrc[i].resolved = (typeof stash[i] == 'string'?stash[i]:JSON.parse($.my.tojson(stash[i])));\n\t\t\t}\n\t\t\telse delete src[i].resolved;\n      \n      if (src[i].dropImport && src[i].external && src[i].external[0]!=' ') {\n      \tsrc[i].data = '// This branch has no visible data\\n// since ‘Do not store imported data in document’\\n// option is set for the branch';\n      }\n\t\t\t\n\t\t\tif (\n\t\t\t\tsrc[i].type === \"attachment\"\n\t\t\t\t&& (!!buildAll || src[i].state.sdbm !== src[i].state.savedSdbm)\n\t\t\t\t&& (!pick || i===pick)\n\t\t\t) {\n\t\t\t\tprocess[i] = true;\n\t\t\t\t\n\t\t\t\t// May be we have not yet saved attaches\n\t\t\t\tif (doc._attachments && doc._attachments[i.from(1)] && doc._attachments[i.from(1)].data) {\n\t\t\t\t\tz._attachments[i.from(1)] = {\n\t\t\t\t\t\tcontent_type:doc._attachments[i.from(1)].content_type,\n\t\t\t\t\t\tdata:doc._attachments[i.from(1)].data\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!sn[i] && dirty[i] && !err[i]) process[i] = true;\n\t\t}\n\t}\n\t\n\treturn {\n\t\terr:err,\n\t\tdirty: dirty,\n\t\tdoc:doc,\n\t\tupload:process,\n\t\tresult:z\n\t};\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _parseIncludes (iname) {\n\t\tvar i = iname, deps,\n\t\t\t\tj, re, idx, str, \n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tdeps = src[i].state.depends={};\n\t\tif (incl && !src[i].noIncludes) {\t\t\n\t\t\tincls[i] = incl.slice(0);\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9_\\-\\.\\/]/gi,\"\");\n\t\t\t\tdeps[idx] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _resolveIncludes (iname) {\n\t\tvar i = iname, \n\t\t\t\tj, re, idx, str, \n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tfin[i] = a[i].data;\n\t\tif (incl) {\t\t\t\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9_\\-\\.\\/]/gi,\"\");\n\t\t\t\tre = new RegExp(RegExp.escape(incl[j]), 'g');\n\t\t\t\tif (idx === i) fin[i] = fin[i].replace(re,\"\");\n\t\t\t\telse if (a[idx]) {\n\t\t\t\t\tstr = fin[idx] || a[idx].data;\n\t\t\t\t\tvar s2s=t[src[idx].type].s2s;\n\t\t\t\t\tif (Object.isFunction(s2s)) str = s2s(str);\n\t\t\t\t\t\n\t\t\t\t\tif (incl[j].to(1) === '\"' && incl[j].from(-1) ==='\"') str = JSON.stringify(str);\n\t\t\t\t\tfin[i] = fin[i].split(re).join(str);\n\t\t\t\t} \n\t\t\t\t//else fin[i] = fin[i].replace(re,\"\");\n\t\t\t}\n\t\t}\n\t\t// post-process\n\t\tif (pp[i]) {\n\t\t\ttry { fin[i] = pp[i](src[i], fin[i], doc);  }\n\t\t\tcatch (e) {\n\t\t\t\t_e(i, \"Post-processor error: \"+e.message);\n\t\t\t\t//console.log(e.message, e.stack, e);\n\t\t\t\t//window.M = fin[i];\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _convert (iname) {\n\t\tvar it=src[iname], att,\n\t\t\t\tparser, eparser;\n\t\t\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\t// Item\t\t\t\n\t\t\tif(it.parserActive) {\n\t\t\t\ttry { \n\t\t\t\t\tparser = eval(it.parser).bind(that); \n\t\t\t\t} catch (e){ \n\t\t\t\t\tparser = null; \n\t\t\t\t\teparser = e.message;\n\t\t\t\t}\n\t\t\t\tif (!Object.isFunction(parser)) {\n\t\t\t\t\t_e (iname, \"Invalid custom parser: \"+eparser);\n\t\t\t\t\tparser = t[it.type].stringify.bind(that);\n\t\t\t\t}\n\t\t\t} \n\t\t\telse parser = t[it.type].stringify.bind(that);\n\t\t\n\t\t\ttry {\n\t\t\t\tatt = {\n\t\t\t\t\tcontent_type:it.mime||t[it.type].mime,\n\t\t\t\t\tdata:parser(it, doc._attachments, doc)+\"\"\n\t\t\t\t};\n\t\t\t} catch(e) {\n\t\t\t\tif (it.parserActive) _e(iname, \"Custom parser failed: \"+e.message);\n\t\t\t\telse _e(iname,\"Error parsing data: \"+e.message);\n\t\t\t}\n\t\t\tif (att ) {\n\t\t\t\ta[iname] = att;\n\t\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t// We have attachment\n\t\t\tif (doc._attachments && (att = doc._attachments[iname])) {\n\t\t\t\tif (att.digest) it.state.sdbm = $.my.f.sdbmCode(att.digest);\n\t\t\t} else {\n\t\t\t\tit.state.sdbm = \"Z\";\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n}","Upload": "function (doc,$root,opts) {\n\n\tvar that = this, i, j, url,\n\t\t\tpi = $.Deferred(),\n\t\t\tcdb = that.GetSettings(\"couch\"),\n\t\t\tcouch = cdb.dburl.replace(/\\/$/,'')+'/',\n\t\t\tcreds = (cdb.login && cdb.pwd) ? cdb.login +\":\" + cdb.pwd :'',\n\t\t\tid = cdb.docid,\n\t\t\theaders = {Accept:\"text/plain\"},\n\t\t\tmode = cw.lib.a2o(doc[\"export\"].options||[]),\n\t\t\tpaths = [],\n\t\t\tobj = opts.result,\n\t\t\titems={},\n\t\t\texclude = [];\n\n\tvar isA = Object.isArray, isB = Object.isBoolean, isS = Object.isString, isO = Object.isObject,\n\t\t\tisN = Object.isNumber, isR = Object.isRegExp, isF = Object.isFunction;\n  \n  // Build affected paths list\n\tfor (i=0;i<doc.items.length;i++) {\n\t\tif ( !doc.items[i].snippet){\n\t\t\tj = that.Path(doc.items[i])\n\t\t\tif ( j.to(1) != \".\") items[j.from(1)] = doc.items[i];\n\t\t\telse paths.push(j.from(1));\n\t\t}\n\t}\n\tpaths = paths.unique().sortBy();\n  \n  // Local Pouch =======\n  \n  if (couch == './') {\n    \n  \tconsole.log(\"LOCAL LOAD START\", id);\n    \n    that.db.get(id).then(\n      // doc exists\n      function(res){\n        _combine(res);\n        _save();\n      },\n      // doc likely not exist\n      _save\n    );\n  }\n  \n  // URL ===============\n  \n  else {\n    // Append current host root if no domain defined\n    if (couch.to(1)==\"/\") {\n      couch = window.location.protocol +'/'+'/' +window.location.host+'/'+couch;\n    }\n\n    url = couch+id;\n    if (creds) headers.Authorization = 'Basic ' + cw.lib.base64(creds);\n\n    console.log('LOAD START', url.to(500), headers);\n\n    $.ajax({\n      url:\t\t\turl,\n      method:\t\t'GET',\n      cache:\t\tfalse,\n      dataType:\t'json',\n      headers:\theaders\n    })\n    .then(\n      // doc exists\n      function(res){\n        _combine(res);\n        _save();\n      },\n      // doc likely not exist\n      _save\n    );\n  }\n\n\n\treturn pi.promise();\n\n\t//--------------------\n\n\tfunction _combine(doc0) {\n\t\tif (doc0) {\n\t\t\tif (doc0._rev) obj._rev = doc0._rev;\n\n\t\t\tif (mode.extend) {\n\t\t\t\tvar doc1 = Object.reject(doc0,\"_attachments\"),\n\t\t\t\t\t\tvals = paths.reduce(function(a, path){\n\t\t\t\t\t\t\ta.push(cw.lib.getref(obj, path));\n\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t},[]);\n\n\t\t\t\t_unmask(doc1, vals, paths);\n\n\t\t\t\tobj = Object.merge(doc1, {_attachments:obj._attachments});\n\n\t\t\t\tvar a = doc0._attachments;\n\t\t\t\tif (Object.size(a)) {\n\t\t\t\t\tif (!obj._attachments) obj._attachments={};\n\t\t\t\t\tObject.keys(a)\n\t\t\t\t\t.forEach(function(i){\n\t\t\t\t\t\tif (null==obj._attachments[i]) {\n\t\t\t\t\t\t\t// no local att, so keep remote att\n\t\t\t\t\t\t\tobj._attachments[i] = a[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!items[i]) {\n\t\t\t\t\t\t\tdelete obj._attachments[i];\n\t\t\t\t\t\t\tobj._attachments[i] = a[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (items[i].state.crc) {\n\t\t\t\t\t\t\t// have local, check is it eq to remote\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\titems[i].state.remote == items[i].state.crc+\"-\"+a[i].digest\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// no need to re-save\n\t\t\t\t\t\t\t\tobj._attachments[i] = a[i];\n\t\t\t\t\t\t\t\texclude.push(i);\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\telse items[i].state.remote=\"\";\n\t\t\t\t\t\t} \n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//--------------------\n\n\tfunction _unmask (dest, src0, mask0) {\n\t\t// unfolds masked into obj\n\t\t// _unmask ( {x:1, y:{}}, [{z:5},3],[\"m.n\",\"y.z\"]) => {x:1, m:{n:{z:5}, y:{z:3}}},\n\t\t// modifies dest\n\n\t\tvar mask = mask0, src = src0;\n\n\t\tif (isS(mask)) {\n\t\t\tmask = [mask]; src= [src];\n\t\t}\n\t\tif (isA(src) && isA(mask)) {\n\t\t\tfor (var i=0;i<mask.length;i++) {\n\t\t\t\tif (src[i]!=null) _blow(dest, src[i], mask[i]);\n\t\t\t}\n\t\t\treturn dest;\n\t\t} \n\t\telse return null;\n\n\t\t//- - -\n\t\tfunction _blow(data, val, ref) {\n\t\t\tvar ptr, path, preptr, i=0;\n\t\t\tif (!/\\./.test(ref)) {\n\t\t\t\t//ref is flat\n\t\t\t\tif (null!=val) data[ref] = val;\n\t\t\t} else {\n\t\t\t\tpath = ref.split(\".\").each(function (a,i){this[i]=String(a).compact();});\n\t\t\t\tptr = data;\n\t\t\t\tfor (;i<path.length;i++) {\n\t\t\t\t\tif (i===path.length-1) ptr[path[i]] = val; //we'r in the hole\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (i===0) {\n\t\t\t\t\t\t\tptr = data[path[0]];\n\t\t\t\t\t\t\tpreptr= data;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tpreptr = preptr[path[i-1]];\n\t\t\t\t\t\t\tptr = ptr[path[i]];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tnull == ptr \n\t\t\t\t\t\t\t|| !(isO(ptr) \n\t\t\t\t\t\t\t\t\t || !(\n\t\t\t\t\t\t\t\t\t\t isA(ptr) \n\t\t\t\t\t\t\t\t\t\t && !isNaN(path[i+1]) \n\t\t\t\t\t\t\t\t\t\t && +path[i]>-1)\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) ptr = preptr[path[i]] = {};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn data;\n\t\t}\n\t}\n\n\t//--------------------\n\n\tfunction _save () {\n\t\tconsole.log('SAVE', (url || id).to(500));\n    var op;\n    if (couch == './') op = that.db.put(cw.lib.dry(JSON.parse($.my.tojson(obj))));\n    else op = $.ajax({\n\t\t\turl:\t\t\turl,\n\t\t\tmethod:\t\t'PUT',\n\t\t\theaders:\theaders,\n      contentType:\t'application/json',\n\t\t\tdata:\t\t\t$.my.tojson(obj)\n\t\t});\n    \n    return op.then(\n      _load,\n      function(e){\n        console.log('FAIL', e)\n        pi.reject(e);\n      }\n    );\n\t}\n\n\t//--------------------\n\n\tfunction _load () {\n\t\tconsole.log('LOAD BACK', (url || id).to(500));\n    var op;\n    if (couch == './') op = that.db.get(id);\n\t\telse op = $.ajax({\n\t\t\turl:\t\t\turl,\n\t\t\tmethod:\t\t'GET',\n\t\t\tcache:\t\tfalse,\n\t\t\tdataType:\t'json',\n\t\t\theaders:\theaders\n\t\t});\n\t\t\n    return op.then(\n      _loadFinalize,\n      function(e){ pi.reject(e); }\n    );\n\t}\n  \n  //--------------------\n  \n  function _loadFinalize(res){\n    // memoize md5-s\n    Object.keys(res._attachments||{})\n    .forEach(function(i){\n      if (items[i]) {\n        items[i].state.remote = items[i].state.crc +'-' + res._attachments[i].digest;\n      }\n    });\n\t\t// we are done\n    pi.resolve();\n  }\n\n}","GetSettings": "function (section) {\n\tvar that = this,\n\t\t\tkey,\n\t\t\td = that.data;\n\t// Decode / prepare creds\n\tif ( cw.crypto && (key = d.doc.creds.crypto)) {\n\t\tif (!cw.crypto.has(key)) {\n\t\t\treturn {  };\n\t\t} else {\n\t\t\tvar obj = cw.crypto.dec(d.doc.creds)[section];\n\t\t\tif (obj) {\n\t\t\t\treturn obj;\n\t\t\t} else {\n\t\t\t\treturn {  };\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn Object.clone(d.doc[section], !0);\n\t}\n}","S3toCouch": "function (doc) {\n\t\n\t// this is service fn to maintain\n\t// compat with old preliminary test internal format\n\t\n\tvar that = this;\n\t\n\tif (doc.s3) {\n\t\tvar s3 = that.GetSettings(\"s3\"),\n\t\t\t\tobj = {\n\t\t\t\t\tlogin:s3.accessKeyId,\n\t\t\t\t\tpwd:s3.secretAccessKey,\n\t\t\t\t\tdocid:s3.region,\n\t\t\t\t\tdburl:doc.site.siteBase\n\t\t\t\t};\n\t\tif (doc.creds.crypto) {\n\t\t\tdoc.creds = cw.crypto.enc({\n\t\t\t\tcrypto:doc.creds.crypto+\"\",\n\t\t\t\tcouch:obj\t\n\t\t\t});\n\t\t}\n\t\tdelete doc.s3;\n\t\tdoc.site.siteBase=\"\";\n\t}\n\t\n}","Tar": {"Tar": "function () {\n\t\n\t\t// Tar implementation\n\t\t// https://github.com/beatgammit/tar-js\n\n\t\tvar header = _header(),\n\t\t\tutils = _utils(),\n\t\t\trecordSize = 512,\n\t\t\tblockSize;\n\n\t\tfunction Tar(recordsPerBlock) {\n\t\t\tthis.written = 0;\n\t\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t}\n\n\t\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\t\tvar data,\n\t\t\t\tchecksum,\n\t\t\t\tmode,\n\t\t\t\tmtime,\n\t\t\t\tuid,\n\t\t\t\tgid,\n\t\t\t\theaderArr;\n\n\t\t\tif (typeof input === 'string') {\n\t\t\t\tinput = utils.stringToUint8(input);\n\t\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t\t}\n\n\t\t\tif (typeof opts === 'function') {\n\t\t\t\tcallback = opts;\n\t\t\t\topts = {};\n\t\t\t}\n\n\t\t\topts = opts || {};\n\n\t\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\t\tuid = opts.uid || 0;\n\t\t\tgid = opts.gid || 0;\n\n\t\t\tdata = {\n\t\t\t\tfileName: filepath,\n\t\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\t\tuid: utils.pad(uid, 7),\n\t\t\t\tgid: utils.pad(gid, 7),\n\t\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\t\tchecksum: '        ',\n\t\t\t\ttype: '0', // just a file\n\t\t\t\tustar: 'ustar  ',\n\t\t\t\towner: opts.owner || '',\n\t\t\t\tgroup: opts.group || ''\n\t\t\t};\n\n\t\t\t// calculate the checksum\n\t\t\tchecksum = 0;\n\t\t\tObject.keys(data).forEach(function (key) {\n\t\t\t\tvar i, value = data[key], length;\n\n\t\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\t\theaderArr = header.format(data);\n\n\t\t\tvar i, offset, length;\n\n\t\t\tthis.out.set(headerArr, this.written);\n\n\t\t\tthis.written += headerArr.length;\n\n\t\t\t// If there is not enough space in this.out, we need to expand it to\n\t\t\t// fit the new input.\n\t\t\tif (this.written + input.length > this.out.length) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, input.length, blockSize);\n\t\t\t}\n\n\t\t\tthis.out.set(input, this.written);\n\n\t\t\t// to the nearest multiple of recordSize\n\t\t\tthis.written += input.length + (recordSize - (input.length % recordSize || recordSize));\n\n\t\t\t// make sure there's at least 2 empty records worth of extra space\n\t\t\tif (this.out.length - this.written < recordSize * 2) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, recordSize * 2, blockSize);\n\t\t\t}\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(this.out);\n\t\t\t}\n\n\t\t\treturn this.out;\n\t\t};\n\n\t\tTar.prototype.clear = function () {\n\t\t\tthis.written = 0;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t};\n\n\t\treturn Tar;\n\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\t\t// HEADER\n\n\t\tfunction _header () {\n\n\t\t/*\n\t\tstruct posix_header {             // byte offset\n\t\t\tchar name[100];               //   0\n\t\t\tchar mode[8];                 // 100\n\t\t\tchar uid[8];                  // 108\n\t\t\tchar gid[8];                  // 116\n\t\t\tchar size[12];                // 124\n\t\t\tchar mtime[12];               // 136\n\t\t\tchar chksum[8];               // 148\n\t\t\tchar typeflag;                // 156\n\t\t\tchar linkname[100];           // 157\n\t\t\tchar magic[6];                // 257\n\t\t\tchar version[2];              // 263\n\t\t\tchar uname[32];               // 265\n\t\t\tchar gname[32];               // 297\n\t\t\tchar devmajor[8];             // 329\n\t\t\tchar devminor[8];             // 337\n\t\t\tchar prefix[155];             // 345\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 500\n\t\t};\n\t\t*/\n\n\t\t\tvar utils = _utils(),\n\t\t\t\theaderFormat;\n\n\t\t\theaderFormat = [\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileMode',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'uid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'gid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileSize',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'mtime',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'checksum',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'type',\n\t\t\t\t\t'length': 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'linkName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'ustar',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'owner',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'group',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'majorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'minorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'filenamePrefix',\n\t\t\t\t\t'length': 155\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'padding',\n\t\t\t\t\t'length': 12\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tfunction formatHeader(data, cb) {\n\t\t\t\tvar buffer = utils.clean(512),\n\t\t\t\t\toffset = 0;\n\n\t\t\t\theaderFormat.forEach(function (value) {\n\t\t\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\t\t\ti, length;\n\n\t\t\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\t\t\toffset += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset += value.length - i; // space it out with nulls\n\t\t\t\t});\n\n\t\t\t\tif (typeof cb === 'function') {\n\t\t\t\t\treturn cb(buffer, offset);\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstructure:headerFormat,\n\t\t\t\tformat:formatHeader\n\t\t\t};\n\t\t}\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\n\t\t// UTILS\n\n\t\tfunction _utils () {\n\n\t\t\tvar lookup = [\n\t\t\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t\t\t];\n\t\t\tfunction clean(length) {\n\t\t\t\tvar i, buffer = new Uint8Array(length);\n\t\t\t\tfor (i = 0; i < length; i += 1) {\n\t\t\t\t\tbuffer[i] = 0;\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction extend(orig, length, addLength, multipleOf) {\n\t\t\t\tvar newSize = length + addLength,\n\t\t\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\t\t\tbuffer.set(orig);\n\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction pad(num, bytes, base) {\n\t\t\t\tnum = num.toString(base || 8);\n\t\t\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t\t\t}\t\n\n\t\t\tfunction stringToUint8 (input, out, offset) {\n\t\t\t\tvar i, length;\n\n\t\t\t\tout = out || clean(input.length);\n\n\t\t\t\toffset = offset || 0;\n\t\t\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\t\t\toffset += 1;\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction uint8ToBase64(uint8) {\n\t\t\t\tvar i,\n\t\t\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\t\t\toutput = \"\",\n\t\t\t\t\ttemp, length;\n\n\t\t\t\tfunction tripletToBase64 (num) {\n\t\t\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t\t\t};\n\n\t\t\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\t\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\t\t\toutput += tripletToBase64(temp);\n\t\t\t\t}\n\n\t\t\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\t\t\tswitch (output.length % 4) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\toutput += '=';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\toutput += '==';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tclean:clean,\n\t\t\t\tpad:pad,\n\t\t\t\textend:extend,\n\t\t\t\tstringToUint8:stringToUint8,\n\t\t\t\tuint8ToBase64:uint8ToBase64\n\t\t\t};\n\t\t}\n\t}","Bytes": "function (input) {\n\t\tvar binary = window.atob(input),\n\t\t\t\ti=0, len = binary.length,\n\t\t\t\tbuffer = new ArrayBuffer(len),\n\t\t\t\tview = new Uint8Array(buffer);\n\t\tfor (i; i<len;i++) view[i] = binary.charCodeAt(i);\n\t\treturn view;\n\t}"},"HTML": "<div id=\"nav\" class=\"mb9 fs100\">\n\t<div class=\"fr my-row fs85\">\n\t\t<input type=\"button\" style=\"\" class=\" tac mr5 green w100\" txt=\"\" value=\"Save\" id=\"btn-save\">\n    <input type=\"button\" style=\"\" class=\" tac w100\" txt=\"\" value=\"Close\" id=\"btn-close\">\n  </div>\n\t\n\t<div id=\"btns-main\" class=\"dib vat w220 oh fs80 \">\n\t\t<img id=\"navlogo\" src=\"\" class=\"cp w32 dib vat mr5\" title=\"About Ddoc Lab\">\n    <div class=\"w180 oh dib vat lh120 hoverlink teal pr5\" id=\"sname\"></div>\n\t</div>\n  <span class=\"fs80\">\n    <button title=\"Document and remote CouchDB settings\" class=\"tac btn-l mr2 button\" id=\"btn-params\" >\n      <span class=\"fi-wrench\"></span>\n    </button>\n  </span>\n  <span class=\"fs80 pr10\">\n    <button title = \"Upload changes to CouchDB\" class=\"tac btn-r button w110 pr0 pl0\" id=\"btn-publish\">\n      <span class=\"fi-upload-cloud lh100 fs130 dib vat mb-4\"></span>&thinsp; to Couch&nbsp;\n    </button>\n  </span>\n\t<span class=\"fs80 pr10 o80 buttons\">\n      <button class=\" tac btn-l button mr2\" id=\"btn-render\" title=\"Show final JSON\">\n        <span class=\"fi-shopping-bag\"></span> JSON\n      </button>\n      <button class=\" tac btn-r button mr2\" id=\"btn-tar\" title=\"Download as .tar\">\n        <span class=\"fi-archive\"> Files as .tar</span>\n      </button>\n  </span>\n\t<span class=\"fs80 o80 pr10\">\n    <button title = \"Resolve externals (if any) and check doc integrity\" style=\"\" class=\"button\" id=\"btn-validate\">\n      <span class=\"fi-checkbox\"> Rebuild</span>\n    </button>\n  </span>\n\t<span id=\"btn-futon\" class=\"dib vat fs80 mt3 blue\"></span>\n</div>\n<div class=\"fs90 w100p lh130\">\n\t\t<div class=\"w220 dib vat\">\n\t\t\t<div id=\"xsearch\" class=\"w210 fs75 mb5 o90\">\n\t\t\t\t<div class=\"fi-magnifying-glass blue o50\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.35em;\"></div>\n\t\t\t\t<input type=\"text\" id=\"search\" class=\"ui-search w200 ml0 mr0 mt0\" style=\"background-image: none;\">\n\t\t\t\t<span class=\"fi-x fs80 dib vat pt1 ml-15 blue ui-search-clear\" onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div id=\"ilist\" class=\"w200 fs90\"></div>\n\t\t\t\n\t\t\t<div id=\"btns-main\" class=\"w200 oh fs80 hoverlink gray pl7 lh190 pt8 mt13 bts\">\n\t\t\t\t<span class=\"fi-page-add\"></span> <span class=\"pseudolink\" id=\"btn-additem\">Add resource</span><br>\n\t\t\t\t<span class=\" fi-paperclip\"></span> <span class=\"pseudolink\" id=\"btn-addfile\">Import files</span><br>\n\t\t\t\t<span class=\"fi-photo ml-2\"></span> <span class=\"pseudolink\" id=\"btn-addpic\">Add image</span>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\t\t<div class=\"dib vat edpane\">\n\t\t\t<div id=\"tabs\" class=\"mb8 mt1\"></div>\n\t\t\t<div id=\"items\" class=\"edpane\"></div>\n\t\t</div>\n</div>","Icons": {"Component": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"128\" height=\"128\" viewBox=\"0, 0, 128, 128\">\n  <defs>\n    <linearGradient id=\"Gradient_1\" gradientUnits=\"userSpaceOnUse\" x1=\"61.3\" y1=\"90.1\" x2=\"61.3\" y2=\"112.7\">\n      <stop offset=\"0\" stop-color=\"#FFFFFF\"/>\n      <stop offset=\"1\" stop-color=\"#66DFBD\"/>\n    </linearGradient>\n  </defs>\n  <g id=\"Layer_2\">\n    <g>\n      <path d=\"M123.6,6.6 C123.6,6.6 123.9,17.1 123.9,17.1 L104.6,26.4 C113.9,37.1 118.3,50.0 118.7,64.0 C118.7,95.7 93.0,121.4 61.3,121.4 C29.7,121.4 4.0,95.7 4.0,64.0 C4.4,32.0 30.9,6.8 60.9,6.6 C91.0,6.4 123.6,6.6 123.6,6.6 z\" fill=\"#FFFFFF\"/>\n      <path d=\"M85.0,3.5 C106.6,3.5 96.8,3.4 114.4,3.5 C116.9,3.5 119.2,3.5 121.2,3.5 C121.9,3.5 122.5,3.5 123.0,3.5 C123.3,3.5 123.3,3.5 123.5,3.5 C123.6,3.5 123.6,3.5 123.7,3.5 C125.3,3.5 126.7,4.9 126.7,6.5 C126.7,6.8 126.7,6.8 126.7,8.2 C126.8,9.8 126.8,9.8 126.8,11.8 C126.9,13.8 126.9,13.8 126.9,15.4 C126.9,16.7 126.9,16.7 126.9,17.1 C127.0,18.3 126.3,19.4 125.2,19.9 L109.4,27.5 C117.6,38.0 121.1,50.8 121.7,63.9 L121.7,64.0 C121.7,97.4 94.7,124.5 61.3,124.5 C28.0,124.5 1,97.4 1,63.9 C1.4,30.8 28.7,3.7 60.9,3.5 C63.1,3.5 65.3,3.5 67.5,3.5 C77.2,3.5 71.3,3.5 85.0,3.5 z M85.0,9.6 C71.4,9.6 77.2,9.6 67.5,9.6 C65.3,9.6 63.1,9.6 60.9,9.7 C32.1,9.8 7.4,34.2 7.1,64.0 C7.1,94.0 31.4,118.3 61.3,118.3 C91.8,117.9 114.8,94.3 115.6,64.0 C115.4,50.7 110.9,38.6 102.3,28.4 C101.0,26.9 101.5,24.5 103.3,23.6 L120.8,15.2 C120.8,14.1 120.7,13.0 120.7,11.9 C120.7,11.2 120.7,10.4 120.6,9.6 C118.6,9.6 116.5,9.6 114.4,9.6 C96.8,9.6 106.6,9.6 85.0,9.6 z\" fill=\"#A5B6C0\"/>\n    </g>\n    <path d=\"M102.3,90.1 C93.1,104.5 78.3,112.3 61.3,112.7 C44.2,112.6 29.8,104.2 20.3,90.1 L102.3,90.1 z\" fill=\"url(#Gradient_1)\"/>\n    <path d=\"M83.7,60.2 L78.3,59.7 C78.0,58.4 77.5,57.1 76.8,55.9 L80.2,51.7 C80.6,51.3 80.6,50.6 80.2,50.2 L76.9,46.9 C76.7,46.7 76.4,46.6 76.1,46.6 C75.8,46.6 75.6,46.7 75.4,46.8 L71.1,50.3 C70.0,49.6 68.7,49.1 67.4,48.7 L66.9,43.3 C66.8,42.7 66.3,42.3 65.8,42.3 L61.1,42.3 C60.5,42.3 60.0,42.7 60.0,43.3 L59.5,48.7 C58.2,49.1 56.9,49.6 55.7,50.3 L51.5,46.8 C51.3,46.7 51.1,46.6 50.8,46.6 C50.5,46.6 50.2,46.7 50.0,46.9 L46.7,50.2 C46.3,50.6 46.3,51.3 46.6,51.7 L50.1,55.9 C49.4,57.1 48.9,58.4 48.6,59.7 L43.1,60.2 C42.6,60.3 42.1,60.7 42.1,61.3 L42.1,66.0 C42.1,66.6 42.6,67.1 43.1,67.1 L48.6,67.6 C48.9,68.9 49.4,70.2 50.1,71.4 L46.6,75.6 C46.3,76.0 46.3,76.7 46.7,77.1 L50.0,80.4 C50.2,80.6 50.5,80.7 50.8,80.7 C51.1,80.7 51.3,80.6 51.5,80.5 L55.7,77.0 C56.9,77.7 58.2,78.2 59.5,78.6 L60.0,84.0 C60.0,84.6 60.5,85.0 61.1,85.0 L65.8,85.0 C66.3,85.0 66.8,84.6 66.9,84.0 L67.4,78.6 C68.7,78.2 70.0,77.7 71.1,77.0 L75.4,80.5 C75.6,80.6 75.8,80.7 76.1,80.7 C76.4,80.7 76.7,80.6 76.9,80.4 L80.2,77.1 C80.6,76.7 80.6,76.0 80.2,75.6 L76.8,71.4 C77.5,70.2 78.0,68.9 78.3,67.6 L83.7,67.1 C84.3,67.1 84.8,66.6 84.8,66.0 L84.8,61.3 C84.8,60.7 84.3,60.3 83.7,60.2 z M63.4,71.3 C59.2,71.3 55.8,67.9 55.8,63.7 C55.8,59.4 59.2,56.0 63.4,56.0 C67.7,56.0 71.1,59.4 71.1,63.7 C71.1,67.9 67.7,71.3 63.4,71.3 z\" fill=\"#65DFBD\"/>\n  </g>\n</svg>"},"style": {" .s3item .my-modal-overlay": "font-size:110%;"," .s3item": {" .edwidth": "function ($form) {\n\t\t\treturn \"width:\"+($form.width()-220)+\"px;\"\n\t\t}"," .CodeMirror, .meditor": "function ($form) {\n\t\t\t\n\t\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\ttabs = ($form.find(\"#tabs\").outerHeight(true)||0).clamp(38,100),\n\t\t\t\tcss = \"height:\"+($(window).height()-(pad+ofs+nav+tabs+15))+\"px;\";\n\t\t\t\n\t\t\treturn \"min-height:300px;\"+css;\n\t\t}"," .btn-l": "border-radius:30px 0 0 30px!important;"," .btn-r": "border-radius:0 30px 30px 0!important;"," .btn-c": "border-radius:0 0 0 0!important;"," .b1r .CodeMirror-linenumbers": "background-color: rgba(255, 200, 200, 0.75);"}," .bg-active": "background-color:rgba(142, 211, 255, 0.25)",".my-app-busy": {">#nav": "opacity:0.2",">table": "opacity:0.2",">#sysload": {"": "display:block;"}}," .busy:before": "content:\" \"; width:100%;height:100%;position:absolute;top:0;left:0;background:rgba(255,255,255,0.5);z-index:+3;",".my-app-busy-high > #sysload #counter-size": "display:block;"," #sysload": {"": "display:none;position:absolute;width: 100%;text-align: center;height: 300px;padding-top:100px;left:0;top:0;"," div#counter-size": "margin-top:20px;display:none;"},".my-app-busy>#sysload": "display:block;"," #ilist": "function ($form) {\n\t\t\t\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\tcss = \"max-height:\"+($(window).height()-(pad+ofs+nav+150))+\"px;\";\n\n\t\treturn \"overflow-x:hidden;overflow-y:\"+(navigator.webkitGetUserMedia?\"overlay\":\"scroll\")+\";\"+css;\n\n\t}"," .edpane": "function ($o) {\n\t\treturn \"width:\"+($o.width()-220).clamp(750,1500)+\"px;\"\n\t}"," #nav button": "margin-top:0; margin-bottom:0"," div.tab-tab": {"": "white-space:nowrap;"," #tabname": "padding:1px 18px 1px 7px;color:#8292A3;font-size:80%; border:1px solid #DEE7EC;display:inline-block;background-color:white;border-radius:2px 10px 0 0;margin: 0 0 2px 0;"," .btn-tabclose": "opacity:0;transition:opacity 0.3s;display:inline-block;text-align:center;width:18px; margin:0px 2px 0 -18px;color:#c02;line-height:0.9em;padding-right:3px;"," .btn-tabdirty": "opacity:1;transition:opacity 0.3s;display:inline-block;vertical-align:top;font-size:75%;line-height:1em; width:16px; text-align:center; margin:4px -16px 0px 0px;"," #tabname.active": "background-color: rgba(142, 211, 255, 0.25);color:#274361;border-color:rgba(255,255,255,0);"," #tabname:hover": "color:#274361;",":hover .btn-tabclose": "opacity:0.6;",":hover .btn-tabdirty": "opacity:0;"}," #ilist>div": "cursor:pointer","  .CodeMirror": "function ($o) {\n  \tvar large = $o.width() > 1400;\n    return large?{\n    \t'': 'font-size:13.5px;line-height:17px',\n  \t\t' .CodeMirror-lines': 'line-height:17px;',\n    }:{\n    \t'': 'font-size:13px;line-height:16px',\n  \t\t' .CodeMirror-lines': 'line-height:16px;',\n    };\n  }"," .CodeMirror": "height:auto;padding:0px;font-family:Cousine,'PT Mono',Monaco,monospace;"," .cm-include": "color: #00d059;"," .cm-mustache": "color: #967713;"," .cm-csscolor": "color: rgba(255, 80, 212, 1); "," .cm-csscolor::selection": "cursor:pointer!important;background:red"," .CodeMirror-selected": "background: #d9dee0;"," .CodeMirror-focused .CodeMirror-selected": "background: #cae7ff;"," .CodeMirror-focused .CodeMirror-selectedtext": "background-color: #cae7ff!important;"," .cm-matchhighlight": "background-color:rgba(97,255,2,0.3); box-shadow: 0 -2px 0 0 rgba(97,255,2,0.3), 0 1px 0 0 rgba(97,255,2,0.3);border-radius:1px;"," .CodeMirror-selection-highlight-scrollbar": "background-color: rgba(165,230,255,0.5);"," .siteitem": "font-size:88%;word-wrap: break-word;line-height:1.1em;padding-top: 3px;padding-bottom: 3px;"," .b1": "border:1px solid #C1D0DA; border-radius:2px;"," .b1b": "border:1px solid #00BCF4; border-radius:2px;","\t.b1g": "border: 1px solid #A4D572;border-radius:2px;","\t.b1r": "border: 1px solid rgb(255, 134, 153);border-radius:2px;"," .red": "color:rgb(255, 134, 153)!important;"," .btn-l": "border-radius:3px 0 0 3px;"," .btn-r": "border-radius:0 3px 3px 0;"," .btn-c": "border-radius:0;"," .button": "outline:none!important"," .redactor_editor": "font-size:13pt; padding:0.7em; color:#444"," .redactor_box": "border:none"," .redactor_toolbar": "background: none;padding-top: 2px!important;border-bottom-color:#C1D0DA"," .redactor_toolbar li a:active, .redactor_toolbar li a.redactor_act ": " outline: none;border-color: #C5DCEA;background-color: #C5DCEA;"," .redactor_toolbar li.redactor_separator": "margin: 0 2px 0 3px !important;padding: 0;height: 27px;border-right: none;border-left: 1px solid #C1D0DA;"," .redactor_box textarea": "background-color:#333;padding:15px;"," .nicescroll-rails": "z-index:50!important;"},"ParseJS": "function (s,clean) {\n\t\n\tvar g=s,\n\t\t\tu = UglifyJS, \n\t\t\tast,\n\t\t\tres ={\n\t\t\t\tglobals:[],\n\t\t\t\terrors:[]\n\t\t\t},\n\t\t\tgl;\n\ttry{\n\t\tast = u.parse(s+\"\");\n\t} catch (e) {\n\t\tres.errors.push (e.message+\" @\"+e.line+\":\"+e.col)\n\t}\n\tif (ast) {\n\t\tast.figure_out_scope();\n\t\tif (Object.isObject(gl = ast.globals) && gl._size) {\n\t\t\tObject.keys(gl._values)\n\t\t\t.forEach(function(i){\n\t\t\t\tres.globals.push(gl._values[i].name);\n\t\t\t});\n\t\t\tres.globals.sort();\n\t\t\tif (clean) {\n\t\t\t\tres.globals = [].remove.apply(\n\t\t\t\t\tres.globals,\n\t\t\t\t\t(\"String Function Date Math Number Object Array RegExp isNaN undefined parseInt parseFloat \"\n\t\t\t\t\t\t+\"isFinite\").split(\" \")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n}","InitCM": "function () {\n\n\t// inits different CM stuff\n\t\n\tvar that = this;\n\t\n\tif (!CodeMirror.overlayMode) _ovl(CodeMirror);\n\n\tif (!CodeMirror.modes.markdown) _md(CodeMirror);\n\n\tif (!CodeMirror.modes.gfm) _gfm(CodeMirror);\n\t\n\tif (!window.marked) that.Marked(window);\n\t\n\tif (!CodeMirror.modes.erlang) that.Erlang(window);\n  \n  if (!CodeMirror.optionHandlers.highlightSelectionMatches) that.Highlighter(CodeMirror);\n\t\n\tthat.CMoverlays();\n\n\treturn ;\n\n\n\t// - - - - - - - - - -\n\n\tfunction _ovl(CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.overlayMode = function(base, overlay, combine) {\n\t\t\treturn {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.startState(base),\n\t\t\t\t\t\toverlay: CodeMirror.startState(overlay),\n\t\t\t\t\t\tbasePos: 0,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: 0,\n\t\t\t\t\t\toverlayCur: null,\n\t\t\t\t\t\tstreamSeen: null\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcopyState: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.copyState(base, state.base),\n\t\t\t\t\t\toverlay: CodeMirror.copyState(overlay, state.overlay),\n\t\t\t\t\t\tbasePos: state.basePos,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: state.overlayPos,\n\t\t\t\t\t\toverlayCur: null\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\ttoken: function(stream, state) {\n\t\t\t\t\tif (stream != state.streamSeen ||\n\t\t\t\t\t\t\tMath.min(state.basePos, state.overlayPos) < stream.start) {\n\t\t\t\t\t\tstate.streamSeen = stream;\n\t\t\t\t\t\tstate.basePos = state.overlayPos = stream.start;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stream.start == state.basePos) {\n\t\t\t\t\t\tstate.baseCur = base.token(stream, state.base);\n\t\t\t\t\t\tstate.basePos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.start == state.overlayPos) {\n\t\t\t\t\t\tstream.pos = stream.start;\n\t\t\t\t\t\tstate.overlayCur = overlay.token(stream, state.overlay);\n\t\t\t\t\t\tstate.overlayPos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tstream.pos = Math.min(state.basePos, state.overlayPos);\n\n\t\t\t\t\t// state.overlay.combineTokens always takes precedence over combine,\n\t\t\t\t\t// unless set to null\n\t\t\t\t\tif (state.overlayCur == null) return state.baseCur;\n\t\t\t\t\telse if (state.baseCur != null &&\n\t\t\t\t\t\t\t\t\t state.overlay.combineTokens ||\n\t\t\t\t\t\t\t\t\t combine && state.overlay.combineTokens == null)\n\t\t\t\t\t\treturn state.baseCur + \" \" + state.overlayCur;\n\t\t\t\t\telse return state.overlayCur;\n\t\t\t\t},\n\n\t\t\t\tindent: base.indent && function(state, textAfter) {\n\t\t\t\t\treturn base.indent(state.base, textAfter);\n\t\t\t\t},\n\t\t\t\telectricChars: base.electricChars,\n\n\t\t\t\tinnerMode: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstate: state.base,\n\t\t\t\t\t\tmode: base\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tblankLine: function(state) {\n\t\t\t\t\tif (base.blankLine) base.blankLine(state.base);\n\t\t\t\t\tif (overlay.blankLine) overlay.blankLine(state.overlay);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t}\n\n\t// - - - - - - - - - -\n\n\tfunction _gfm (CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.defineMode(\"gfm\", function(config, modeConfig) {\n\t\t\tvar codeDepth = 0;\n\n\t\t\tfunction blankLine(state) {\n\t\t\t\tstate.code = false;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tvar gfmOverlay = {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcode: false,\n\t\t\t\t\t\tcodeBlock: false,\n\t\t\t\t\t\tateSpace: false\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcopyState: function(s) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcode: s.code,\n\t\t\t\t\t\tcodeBlock: s.codeBlock,\n\t\t\t\t\t\tateSpace: s.ateSpace\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\ttoken: function(stream, state) {\n\t\t\t\t\tstate.combineTokens = null;\n\n\t\t\t\t\t// Hack to prevent formatting override inside code blocks (block and inline)\n\t\t\t\t\tif (state.codeBlock) {\n\t\t\t\t\t\tif (stream.match(/^```/)) {\n\t\t\t\t\t\t\tstate.codeBlock = false;\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.sol()) {\n\t\t\t\t\t\tstate.code = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.sol() && stream.match(/^```/)) {\n\t\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\t\tstate.codeBlock = true;\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\t// If this block is changed, it may need to be updated in Markdown mode\n\t\t\t\t\tif (stream.peek() === '`') {\n\t\t\t\t\t\tstream.next();\n\t\t\t\t\t\tvar before = stream.pos;\n\t\t\t\t\t\tstream.eatWhile('`');\n\t\t\t\t\t\tvar difference = 1 + stream.pos - before;\n\t\t\t\t\t\tif (!state.code) {\n\t\t\t\t\t\t\tcodeDepth = difference;\n\t\t\t\t\t\t\tstate.code = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (difference === codeDepth) { // Must be exact\n\t\t\t\t\t\t\t\tstate.code = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} else if (state.code) {\n\t\t\t\t\t\tstream.next();\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\t// Check if space. If so, links can be formatted later on\n\t\t\t\t\tif (stream.eatSpace()) {\n\t\t\t\t\t\tstate.ateSpace = true;\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.sol() || state.ateSpace) {\n\t\t\t\t\t\tstate.ateSpace = false;\n\t\t\t\t\t\tif (stream.match(/^(?:[a-zA-Z0-9\\-_]+\\/)?(?:[a-zA-Z0-9\\-_]+@)?(?:[a-f0-9]{7,40}\\b)/)) {\n\t\t\t\t\t\t\t// User/Project@SHA\n\t\t\t\t\t\t\t// User@SHA\n\t\t\t\t\t\t\t// SHA\n\t\t\t\t\t\t\tstate.combineTokens = true;\n\t\t\t\t\t\t\treturn \"link\";\n\t\t\t\t\t\t} else if (stream.match(/^(?:[a-zA-Z0-9\\-_]+\\/)?(?:[a-zA-Z0-9\\-_]+)?#[0-9]+\\b/)) {\n\t\t\t\t\t\t\t// User/Project#Num\n\t\t\t\t\t\t\t// User#Num\n\t\t\t\t\t\t\t// #Num\n\t\t\t\t\t\t\tstate.combineTokens = true;\n\t\t\t\t\t\t\treturn \"link\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.match(/^((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]|\\([^\\s()<>]*\\))+(?:\\([^\\s()<>]*\\)|[^\\s`*!()\\[\\]{};:'\".,<>?«»“”‘’]))/i) &&\n\t\t\t\t\t\t\tstream.string.slice(stream.start - 2, stream.start) != \"](\") {\n\t\t\t\t\t\t// URLs\n\t\t\t\t\t\t// Taken from http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n\t\t\t\t\t\t// And then (issue #1160) simplified to make it not crash the Chrome Regexp engine\n\t\t\t\t\t\tstate.combineTokens = true;\n\t\t\t\t\t\treturn \"link\";\n\t\t\t\t\t}\n\t\t\t\t\tstream.next();\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tblankLine: blankLine\n\t\t\t};\n\n\t\t\tvar markdownConfig = {\n\t\t\t\tunderscoresBreakWords: false,\n\t\t\t\ttaskLists: true,\n\t\t\t\tfencedCodeBlocks: true,\n\t\t\t\tstrikethrough: true\n\t\t\t};\n\t\t\tfor (var attr in modeConfig) {\n\t\t\t\tmarkdownConfig[attr] = modeConfig[attr];\n\t\t\t}\n\t\t\tmarkdownConfig.name = \"markdown\";\n\t\t\treturn CodeMirror.overlayMode(CodeMirror.getMode(config, markdownConfig), gfmOverlay);\n\n\t\t}, \"markdown\");\n\n\t\tCodeMirror.defineMIME(\"text/x-gfm\", \"gfm\");\n\t}\n\n\t// - - - - - -\n\n\tfunction _md (CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.defineMode(\"markdown\", function(cmCfg, modeCfg) {\n\n\t\t\tvar htmlFound = CodeMirror.modes.hasOwnProperty(\"xml\");\n\t\t\tvar htmlMode = CodeMirror.getMode(cmCfg, htmlFound ? {\n\t\t\t\tname: \"xml\",\n\t\t\t\thtmlMode: true\n\t\t\t} : \"text/plain\");\n\n\t\t\tfunction getMode(name) {\n\t\t\t\tif (CodeMirror.findModeByName) {\n\t\t\t\t\tvar found = CodeMirror.findModeByName(name);\n\t\t\t\t\tif (found) name = found.mime || found.mimes[0];\n\t\t\t\t}\n\t\t\t\tvar mode = CodeMirror.getMode(cmCfg, name);\n\t\t\t\treturn mode.name == \"null\" ? null : mode;\n\t\t\t}\n\n\t\t\t// Should characters that affect highlighting be highlighted separate?\n\t\t\t// Does not include characters that will be output (such as `1.` and `-` for lists)\n\t\t\tif (modeCfg.highlightFormatting === undefined)\n\t\t\t\tmodeCfg.highlightFormatting = false;\n\n\t\t\t// Maximum number of nested blockquotes. Set to 0 for infinite nesting.\n\t\t\t// Excess `>` will emit `error` token.\n\t\t\tif (modeCfg.maxBlockquoteDepth === undefined)\n\t\t\t\tmodeCfg.maxBlockquoteDepth = 0;\n\n\t\t\t// Should underscores in words open/close em/strong?\n\t\t\tif (modeCfg.underscoresBreakWords === undefined)\n\t\t\t\tmodeCfg.underscoresBreakWords = true;\n\n\t\t\t// Turn on fenced code blocks? (\"```\" to start/end)\n\t\t\tif (modeCfg.fencedCodeBlocks === undefined) modeCfg.fencedCodeBlocks = false;\n\n\t\t\t// Turn on task lists? (\"- [ ] \" and \"- [x] \")\n\t\t\tif (modeCfg.taskLists === undefined) modeCfg.taskLists = false;\n\n\t\t\t// Turn on strikethrough syntax\n\t\t\tif (modeCfg.strikethrough === undefined)\n\t\t\t\tmodeCfg.strikethrough = false;\n\n\t\t\tvar codeDepth = 0;\n\n\t\t\tvar header = 'header',\n\t\t\t\t\tcode = 'comment',\n\t\t\t\t\tquote = 'quote',\n\t\t\t\t\tlist1 = 'variable-2',\n\t\t\t\t\tlist2 = 'variable-3',\n\t\t\t\t\tlist3 = 'keyword',\n\t\t\t\t\thr = 'hr',\n\t\t\t\t\timage = 'tag',\n\t\t\t\t\tformatting = 'formatting',\n\t\t\t\t\tlinkinline = 'link',\n\t\t\t\t\tlinkemail = 'link',\n\t\t\t\t\tlinktext = 'link',\n\t\t\t\t\tlinkhref = 'string',\n\t\t\t\t\tem = 'em',\n\t\t\t\t\tstrong = 'strong',\n\t\t\t\t\tstrikethrough = 'strikethrough';\n\n\t\t\tvar hrRE = /^([*\\-_])(?:\\s*\\1){2,}\\s*$/,\n\t\t\t\t\tulRE = /^[*\\-+]\\s+/,\n\t\t\t\t\tolRE = /^[0-9]+([.)])\\s+/,\n\t\t\t\t\ttaskListRE = /^\\[(x| )\\](?=\\s)/ // Must follow ulRE or olRE\n\t\t\t,\n\t\t\t\t\tatxHeaderRE = /^(#+)(?: |$)/,\n\t\t\t\t\tsetextHeaderRE = /^ *(?:\\={1,}|-{1,})\\s*$/,\n\t\t\t\t\ttextRE = /^[^#!\\[\\]*_\\\\<>` \"'(~]+/;\n\n\t\t\tfunction switchInline(stream, state, f) {\n\t\t\t\tstate.f = state.inline = f;\n\t\t\t\treturn f(stream, state);\n\t\t\t}\n\n\t\t\tfunction switchBlock(stream, state, f) {\n\t\t\t\tstate.f = state.block = f;\n\t\t\t\treturn f(stream, state);\n\t\t\t}\n\n\n\t\t\t// Blocks\n\n\t\t\tfunction blankLine(state) {\n\t\t\t\t// Reset linkTitle state\n\t\t\t\tstate.linkTitle = false;\n\t\t\t\t// Reset EM state\n\t\t\t\tstate.em = false;\n\t\t\t\t// Reset STRONG state\n\t\t\t\tstate.strong = false;\n\t\t\t\t// Reset strikethrough state\n\t\t\t\tstate.strikethrough = false;\n\t\t\t\t// Reset state.quote\n\t\t\t\tstate.quote = 0;\n\t\t\t\t// Reset state.indentedCode\n\t\t\t\tstate.indentedCode = false;\n\t\t\t\tif (!htmlFound && state.f == htmlBlock) {\n\t\t\t\t\tstate.f = inlineNormal;\n\t\t\t\t\tstate.block = blockNormal;\n\t\t\t\t}\n\t\t\t\t// Reset state.trailingSpace\n\t\t\t\tstate.trailingSpace = 0;\n\t\t\t\tstate.trailingSpaceNewLine = false;\n\t\t\t\t// Mark this line as blank\n\t\t\t\tstate.thisLineHasContent = false;\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfunction blockNormal(stream, state) {\n\n\t\t\t\tvar sol = stream.sol();\n\n\t\t\t\tvar prevLineIsList = state.list !== false,\n\t\t\t\t\t\tprevLineIsIndentedCode = state.indentedCode;\n\n\t\t\t\tstate.indentedCode = false;\n\n\t\t\t\tif (prevLineIsList) {\n\t\t\t\t\tif (state.indentationDiff >= 0) { // Continued list\n\t\t\t\t\t\tif (state.indentationDiff < 4) { // Only adjust indentation if *not* a code block\n\t\t\t\t\t\t\tstate.indentation -= state.indentationDiff;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstate.list = null;\n\t\t\t\t\t} else if (state.indentation > 0) {\n\t\t\t\t\t\tstate.list = null;\n\t\t\t\t\t\tstate.listDepth = Math.floor(state.indentation / 4);\n\t\t\t\t\t} else { // No longer a list\n\t\t\t\t\t\tstate.list = false;\n\t\t\t\t\t\tstate.listDepth = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar match = null;\n\t\t\t\tif (state.indentationDiff >= 4) {\n\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\tif (prevLineIsIndentedCode || !state.prevLineHasContent) {\n\t\t\t\t\t\tstate.indentation -= 4;\n\t\t\t\t\t\tstate.indentedCode = true;\n\t\t\t\t\t\treturn code;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t} else if (stream.eatSpace()) {\n\t\t\t\t\treturn null;\n\t\t\t\t} else if ((match = stream.match(atxHeaderRE)) && match[1].length <= 6) {\n\t\t\t\t\tstate.header = match[1].length;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"header\";\n\t\t\t\t\tstate.f = state.inline;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (state.prevLineHasContent && !state.quote && !prevLineIsList && !prevLineIsIndentedCode && (match = stream.match(setextHeaderRE))) {\n\t\t\t\t\tstate.header = match[0].charAt(0) == '=' ? 1 : 2;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"header\";\n\t\t\t\t\tstate.f = state.inline;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (stream.eat('>')) {\n\t\t\t\t\tstate.quote = sol ? 1 : state.quote + 1;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"quote\";\n\t\t\t\t\tstream.eatSpace();\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (stream.peek() === '[') {\n\t\t\t\t\treturn switchInline(stream, state, footnoteLink);\n\t\t\t\t} else if (stream.match(hrRE, true)) {\n\t\t\t\t\tstate.hr = true;\n\t\t\t\t\treturn hr;\n\t\t\t\t} else if ((!state.prevLineHasContent || prevLineIsList) && (stream.match(ulRE, false) || stream.match(olRE, false))) {\n\t\t\t\t\tvar listType = null;\n\t\t\t\t\tif (stream.match(ulRE, true)) {\n\t\t\t\t\t\tlistType = 'ul';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.match(olRE, true);\n\t\t\t\t\t\tlistType = 'ol';\n\t\t\t\t\t}\n\t\t\t\t\tstate.indentation += 4;\n\t\t\t\t\tstate.list = true;\n\t\t\t\t\tstate.listDepth++;\n\t\t\t\t\tif (modeCfg.taskLists && stream.match(taskListRE, false)) {\n\t\t\t\t\t\tstate.taskList = true;\n\t\t\t\t\t}\n\t\t\t\t\tstate.f = state.inline;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = [\"list\", \"list-\" + listType];\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (modeCfg.fencedCodeBlocks && stream.match(/^```[ \\t]*([\\w+#]*)/, true)) {\n\t\t\t\t\t// try switching mode\n\t\t\t\t\tstate.localMode = getMode(RegExp.$1);\n\t\t\t\t\tif (state.localMode) state.localState = state.localMode.startState();\n\t\t\t\t\tstate.f = state.block = local;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"code-block\";\n\t\t\t\t\tstate.code = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\treturn switchInline(stream, state, state.inline);\n\t\t\t}\n\n\t\t\tfunction htmlBlock(stream, state) {\n\t\t\t\tvar style = htmlMode.token(stream, state.htmlState);\n\t\t\t\tif ((htmlFound && state.htmlState.tagStart === null &&\n\t\t\t\t\t\t (!state.htmlState.context && state.htmlState.tokenize.isInText)) ||\n\t\t\t\t\t\t(state.md_inside && stream.current().indexOf(\">\") > -1)) {\n\t\t\t\t\tstate.f = inlineNormal;\n\t\t\t\t\tstate.block = blockNormal;\n\t\t\t\t\tstate.htmlState = null;\n\t\t\t\t}\n\t\t\t\treturn style;\n\t\t\t}\n\n\t\t\tfunction local(stream, state) {\n\t\t\t\tif (stream.sol() && stream.match(\"```\", false)) {\n\t\t\t\t\tstate.localMode = state.localState = null;\n\t\t\t\t\tstate.f = state.block = leavingLocal;\n\t\t\t\t\treturn null;\n\t\t\t\t} else if (state.localMode) {\n\t\t\t\t\treturn state.localMode.token(stream, state.localState);\n\t\t\t\t} else {\n\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\treturn code;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction leavingLocal(stream, state) {\n\t\t\t\tstream.match(\"```\");\n\t\t\t\tstate.block = blockNormal;\n\t\t\t\tstate.f = inlineNormal;\n\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"code-block\";\n\t\t\t\tstate.code = true;\n\t\t\t\tvar returnType = getType(state);\n\t\t\t\tstate.code = false;\n\t\t\t\treturn returnType;\n\t\t\t}\n\n\t\t\t// Inline\n\n\t\t\tfunction getType(state) {\n\t\t\t\tvar styles = [];\n\n\t\t\t\tif (state.formatting) {\n\t\t\t\t\tstyles.push(formatting);\n\n\t\t\t\t\tif (typeof state.formatting === \"string\") state.formatting = [state.formatting];\n\n\t\t\t\t\tfor (var i = 0; i < state.formatting.length; i++) {\n\t\t\t\t\t\tstyles.push(formatting + \"-\" + state.formatting[i]);\n\n\t\t\t\t\t\tif (state.formatting[i] === \"header\") {\n\t\t\t\t\t\t\tstyles.push(formatting + \"-\" + state.formatting[i] + \"-\" + state.header);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add `formatting-quote` and `formatting-quote-#` for blockquotes\n\t\t\t\t\t\t// Add `error` instead if the maximum blockquote nesting depth is passed\n\t\t\t\t\t\tif (state.formatting[i] === \"quote\") {\n\t\t\t\t\t\t\tif (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {\n\t\t\t\t\t\t\t\tstyles.push(formatting + \"-\" + state.formatting[i] + \"-\" + state.quote);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstyles.push(\"error\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.taskOpen) {\n\t\t\t\t\tstyles.push(\"meta\");\n\t\t\t\t\treturn styles.length ? styles.join(' ') : null;\n\t\t\t\t}\n\t\t\t\tif (state.taskClosed) {\n\t\t\t\t\tstyles.push(\"property\");\n\t\t\t\t\treturn styles.length ? styles.join(' ') : null;\n\t\t\t\t}\n\n\t\t\t\tif (state.linkHref) {\n\t\t\t\t\tstyles.push(linkhref, \"url\");\n\t\t\t\t} else { // Only apply inline styles to non-url text\n\t\t\t\t\tif (state.strong) {\n\t\t\t\t\t\tstyles.push(strong);\n\t\t\t\t\t}\n\t\t\t\t\tif (state.em) {\n\t\t\t\t\t\tstyles.push(em);\n\t\t\t\t\t}\n\t\t\t\t\tif (state.strikethrough) {\n\t\t\t\t\t\tstyles.push(strikethrough);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.linkText) {\n\t\t\t\t\t\tstyles.push(linktext);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.code) {\n\t\t\t\t\t\tstyles.push(code);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.header) {\n\t\t\t\t\tstyles.push(header);\n\t\t\t\t\tstyles.push(header + \"-\" + state.header);\n\t\t\t\t}\n\n\t\t\t\tif (state.quote) {\n\t\t\t\t\tstyles.push(quote);\n\n\t\t\t\t\t// Add `quote-#` where the maximum for `#` is modeCfg.maxBlockquoteDepth\n\t\t\t\t\tif (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {\n\t\t\t\t\t\tstyles.push(quote + \"-\" + state.quote);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyles.push(quote + \"-\" + modeCfg.maxBlockquoteDepth);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.list !== false) {\n\t\t\t\t\tvar listMod = (state.listDepth - 1) % 3;\n\t\t\t\t\tif (!listMod) {\n\t\t\t\t\t\tstyles.push(list1);\n\t\t\t\t\t} else if (listMod === 1) {\n\t\t\t\t\t\tstyles.push(list2);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyles.push(list3);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.trailingSpaceNewLine) {\n\t\t\t\t\tstyles.push(\"trailing-space-new-line\");\n\t\t\t\t} else if (state.trailingSpace) {\n\t\t\t\t\tstyles.push(\"trailing-space-\" + (state.trailingSpace % 2 ? \"a\" : \"b\"));\n\t\t\t\t}\n\n\t\t\t\treturn styles.length ? styles.join(' ') : null;\n\t\t\t}\n\n\t\t\tfunction handleText(stream, state) {\n\t\t\t\tif (stream.match(textRE, true)) {\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tfunction inlineNormal(stream, state) {\n\t\t\t\tvar style = state.text(stream, state);\n\t\t\t\tif (typeof style !== 'undefined')\n\t\t\t\t\treturn style;\n\n\t\t\t\tif (state.list) { // List marker (*, +, -, 1., etc)\n\t\t\t\t\tstate.list = null;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tif (state.taskList) {\n\t\t\t\t\tvar taskOpen = stream.match(taskListRE, true)[1] !== \"x\";\n\t\t\t\t\tif (taskOpen) state.taskOpen = true;\n\t\t\t\t\telse state.taskClosed = true;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"task\";\n\t\t\t\t\tstate.taskList = false;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tstate.taskOpen = false;\n\t\t\t\tstate.taskClosed = false;\n\n\t\t\t\tif (state.header && stream.match(/^#+$/, true)) {\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"header\";\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\t// Get sol() value now, before character is consumed\n\t\t\t\tvar sol = stream.sol();\n\n\t\t\t\tvar ch = stream.next();\n\n\t\t\t\tif (ch === '\\\\') {\n\t\t\t\t\tstream.next();\n\t\t\t\t\tif (modeCfg.highlightFormatting) {\n\t\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\t\treturn type ? type + \" formatting-escape\" : \"formatting-escape\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Matches link titles present on next line\n\t\t\t\tif (state.linkTitle) {\n\t\t\t\t\tstate.linkTitle = false;\n\t\t\t\t\tvar matchCh = ch;\n\t\t\t\t\tif (ch === '(') {\n\t\t\t\t\t\tmatchCh = ')';\n\t\t\t\t\t}\n\t\t\t\t\tmatchCh = (matchCh + '').replace(/([.?*+^$[\\]\\\\(){}|-])/g, \"\\\\$1\");\n\t\t\t\t\tvar regex = '^\\\\s*(?:[^' + matchCh + '\\\\\\\\]+|\\\\\\\\\\\\\\\\|\\\\\\\\.)' + matchCh;\n\t\t\t\t\tif (stream.match(new RegExp(regex), true)) {\n\t\t\t\t\t\treturn linkhref;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If this block is changed, it may need to be updated in GFM mode\n\t\t\t\tif (ch === '`') {\n\t\t\t\t\tvar previousFormatting = state.formatting;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"code\";\n\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\tvar before = stream.pos;\n\t\t\t\t\tstream.eatWhile('`');\n\t\t\t\t\tvar difference = 1 + stream.pos - before;\n\t\t\t\t\tif (!state.code) {\n\t\t\t\t\t\tcodeDepth = difference;\n\t\t\t\t\t\tstate.code = true;\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (difference === codeDepth) { // Must be exact\n\t\t\t\t\t\t\tstate.code = false;\n\t\t\t\t\t\t\treturn t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstate.formatting = previousFormatting;\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t}\n\t\t\t\t} else if (state.code) {\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tif (ch === '!' && stream.match(/\\[[^\\]]*\\] ?(?:\\(|\\[)/, false)) {\n\t\t\t\t\tstream.match(/\\[[^\\]]*\\]/);\n\t\t\t\t\tstate.inline = state.f = linkHref;\n\t\t\t\t\treturn image;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '[' && stream.match(/.*\\](\\(.*\\)| ?\\[.*\\])/, false)) {\n\t\t\t\t\tstate.linkText = true;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tif (ch === ']' && state.linkText && stream.match(/\\(.*\\)| ?\\[.*\\]/, false)) {\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tstate.linkText = false;\n\t\t\t\t\tstate.inline = state.f = linkHref;\n\t\t\t\t\treturn type;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^(https?|ftps?):\\/\\/(?:[^\\\\>]|\\\\.)+>/, false)) {\n\t\t\t\t\tstate.f = state.inline = linkInline;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\ttype += \" \";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn type + linkinline;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^[^> \\\\]+@(?:[^\\\\>]|\\\\.)+>/, false)) {\n\t\t\t\t\tstate.f = state.inline = linkInline;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\ttype += \" \";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn type + linkemail;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^(!--|\\w)/, false)) {\n\t\t\t\t\tvar end = stream.string.indexOf(\">\", stream.pos);\n\t\t\t\t\tif (end != -1) {\n\t\t\t\t\t\tvar atts = stream.string.substring(stream.start, end);\n\t\t\t\t\t\tif (/markdown\\s*=\\s*('|\"){0,1}1('|\"){0,1}/.test(atts)) state.md_inside = true;\n\t\t\t\t\t}\n\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\tstate.htmlState = CodeMirror.startState(htmlMode);\n\t\t\t\t\treturn switchBlock(stream, state, htmlBlock);\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^\\/\\w*?>/)) {\n\t\t\t\t\tstate.md_inside = false;\n\t\t\t\t\treturn \"tag\";\n\t\t\t\t}\n\n\t\t\t\tvar ignoreUnderscore = false;\n\t\t\t\tif (!modeCfg.underscoresBreakWords) {\n\t\t\t\t\tif (ch === '_' && stream.peek() !== '_' && stream.match(/(\\w)/, false)) {\n\t\t\t\t\t\tvar prevPos = stream.pos - 2;\n\t\t\t\t\t\tif (prevPos >= 0) {\n\t\t\t\t\t\t\tvar prevCh = stream.string.charAt(prevPos);\n\t\t\t\t\t\t\tif (prevCh !== '_' && prevCh.match(/(\\w)/, false)) {\n\t\t\t\t\t\t\t\tignoreUnderscore = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (ch === '*' || (ch === '_' && !ignoreUnderscore)) {\n\t\t\t\t\tif (sol && stream.peek() === ' ') {\n\t\t\t\t\t\t// Do nothing, surrounded by newline and space\n\t\t\t\t\t} else if (state.strong === ch && stream.eat(ch)) { // Remove STRONG\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strong\";\n\t\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\t\tstate.strong = false;\n\t\t\t\t\t\treturn t;\n\t\t\t\t\t} else if (!state.strong && stream.eat(ch)) { // Add STRONG\n\t\t\t\t\t\tstate.strong = ch;\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strong\";\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t} else if (state.em === ch) { // Remove EM\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"em\";\n\t\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\t\tstate.em = false;\n\t\t\t\t\t\treturn t;\n\t\t\t\t\t} else if (!state.em) { // Add EM\n\t\t\t\t\t\tstate.em = ch;\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"em\";\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t}\n\t\t\t\t} else if (ch === ' ') {\n\t\t\t\t\tif (stream.eat('*') || stream.eat('_')) { // Probably surrounded by spaces\n\t\t\t\t\t\tif (stream.peek() === ' ') { // Surrounded by spaces, ignore\n\t\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t\t} else { // Not surrounded by spaces, back up pointer\n\t\t\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (modeCfg.strikethrough) {\n\t\t\t\t\tif (ch === '~' && stream.eatWhile(ch)) {\n\t\t\t\t\t\tif (state.strikethrough) { // Remove strikethrough\n\t\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strikethrough\";\n\t\t\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\t\t\tstate.strikethrough = false;\n\t\t\t\t\t\t\treturn t;\n\t\t\t\t\t\t} else if (stream.match(/^[^\\s]/, false)) { // Add strikethrough\n\t\t\t\t\t\t\tstate.strikethrough = true;\n\t\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strikethrough\";\n\t\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (ch === ' ') {\n\t\t\t\t\t\tif (stream.match(/^~~/, true)) { // Probably surrounded by space\n\t\t\t\t\t\t\tif (stream.peek() === ' ') { // Surrounded by spaces, ignore\n\t\t\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t\t\t} else { // Not surrounded by spaces, back up pointer\n\t\t\t\t\t\t\t\tstream.backUp(2);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (ch === ' ') {\n\t\t\t\t\tif (stream.match(/ +$/, false)) {\n\t\t\t\t\t\tstate.trailingSpace++;\n\t\t\t\t\t} else if (state.trailingSpace) {\n\t\t\t\t\t\tstate.trailingSpaceNewLine = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn getType(state);\n\t\t\t}\n\n\t\t\tfunction linkInline(stream, state) {\n\t\t\t\tvar ch = stream.next();\n\n\t\t\t\tif (ch === \">\") {\n\t\t\t\t\tstate.f = state.inline = inlineNormal;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\ttype += \" \";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn type + linkinline;\n\t\t\t\t}\n\n\t\t\t\tstream.match(/^[^>]+/, true);\n\n\t\t\t\treturn linkinline;\n\t\t\t}\n\n\t\t\tfunction linkHref(stream, state) {\n\t\t\t\t// Check if space, and return NULL if so (to avoid marking the space)\n\t\t\t\tif (stream.eatSpace()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tvar ch = stream.next();\n\t\t\t\tif (ch === '(' || ch === '[') {\n\t\t\t\t\tstate.f = state.inline = getLinkHrefInside(ch === \"(\" ? \")\" : \"]\");\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link-string\";\n\t\t\t\t\tstate.linkHref = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\t\t\t\treturn 'error';\n\t\t\t}\n\n\t\t\tfunction getLinkHrefInside(endChar) {\n\t\t\t\treturn function(stream, state) {\n\t\t\t\t\tvar ch = stream.next();\n\n\t\t\t\t\tif (ch === endChar) {\n\t\t\t\t\t\tstate.f = state.inline = inlineNormal;\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link-string\";\n\t\t\t\t\t\tvar returnState = getType(state);\n\t\t\t\t\t\tstate.linkHref = false;\n\t\t\t\t\t\treturn returnState;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stream.match(inlineRE(endChar), true)) {\n\t\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.linkHref = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction footnoteLink(stream, state) {\n\t\t\t\tif (stream.match(/^[^\\]]*\\]:/, false)) {\n\t\t\t\t\tstate.f = footnoteLinkInside;\n\t\t\t\t\tstream.next(); // Consume [\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tstate.linkText = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\t\t\t\treturn switchInline(stream, state, inlineNormal);\n\t\t\t}\n\n\t\t\tfunction footnoteLinkInside(stream, state) {\n\t\t\t\tif (stream.match(/^\\]:/, true)) {\n\t\t\t\t\tstate.f = state.inline = footnoteUrl;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar returnType = getType(state);\n\t\t\t\t\tstate.linkText = false;\n\t\t\t\t\treturn returnType;\n\t\t\t\t}\n\n\t\t\t\tstream.match(/^[^\\]]+/, true);\n\n\t\t\t\treturn linktext;\n\t\t\t}\n\n\t\t\tfunction footnoteUrl(stream, state) {\n\t\t\t\t// Check if space, and return NULL if so (to avoid marking the space)\n\t\t\t\tif (stream.eatSpace()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\t// Match URL\n\t\t\t\tstream.match(/^[^\\s]+/, true);\n\t\t\t\t// Check for link title\n\t\t\t\tif (stream.peek() === undefined) { // End of line, set flag to check next line\n\t\t\t\t\tstate.linkTitle = true;\n\t\t\t\t} else { // More content on line, check if link title\n\t\t\t\t\tstream.match(/^(?:\\s+(?:\"(?:[^\"\\\\]|\\\\\\\\|\\\\.)+\"|'(?:[^'\\\\]|\\\\\\\\|\\\\.)+'|\\((?:[^)\\\\]|\\\\\\\\|\\\\.)+\\)))?/, true);\n\t\t\t\t}\n\t\t\t\tstate.f = state.inline = inlineNormal;\n\t\t\t\treturn linkhref + \" url\";\n\t\t\t}\n\n\t\t\tvar savedInlineRE = [];\n\n\t\t\tfunction inlineRE(endChar) {\n\t\t\t\tif (!savedInlineRE[endChar]) {\n\t\t\t\t\t// Escape endChar for RegExp (taken from http://stackoverflow.com/a/494122/526741)\n\t\t\t\t\tendChar = (endChar + '').replace(/([.?*+^$[\\]\\\\(){}|-])/g, \"\\\\$1\");\n\t\t\t\t\t// Match any non-endChar, escaped character, as well as the closing\n\t\t\t\t\t// endChar.\n\t\t\t\t\tsavedInlineRE[endChar] = new RegExp('^(?:[^\\\\\\\\]|\\\\\\\\.)*?(' + endChar + ')');\n\t\t\t\t}\n\t\t\t\treturn savedInlineRE[endChar];\n\t\t\t}\n\n\t\t\tvar mode = {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tf: blockNormal,\n\n\t\t\t\t\t\tprevLineHasContent: false,\n\t\t\t\t\t\tthisLineHasContent: false,\n\n\t\t\t\t\t\tblock: blockNormal,\n\t\t\t\t\t\thtmlState: null,\n\t\t\t\t\t\tindentation: 0,\n\n\t\t\t\t\t\tinline: inlineNormal,\n\t\t\t\t\t\ttext: handleText,\n\n\t\t\t\t\t\tformatting: false,\n\t\t\t\t\t\tlinkText: false,\n\t\t\t\t\t\tlinkHref: false,\n\t\t\t\t\t\tlinkTitle: false,\n\t\t\t\t\t\tem: false,\n\t\t\t\t\t\tstrong: false,\n\t\t\t\t\t\theader: 0,\n\t\t\t\t\t\thr: false,\n\t\t\t\t\t\ttaskList: false,\n\t\t\t\t\t\tlist: false,\n\t\t\t\t\t\tlistDepth: 0,\n\t\t\t\t\t\tquote: 0,\n\t\t\t\t\t\ttrailingSpace: 0,\n\t\t\t\t\t\ttrailingSpaceNewLine: false,\n\t\t\t\t\t\tstrikethrough: false\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tcopyState: function(s) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tf: s.f,\n\n\t\t\t\t\t\tprevLineHasContent: s.prevLineHasContent,\n\t\t\t\t\t\tthisLineHasContent: s.thisLineHasContent,\n\n\t\t\t\t\t\tblock: s.block,\n\t\t\t\t\t\thtmlState: s.htmlState && CodeMirror.copyState(htmlMode, s.htmlState),\n\t\t\t\t\t\tindentation: s.indentation,\n\n\t\t\t\t\t\tlocalMode: s.localMode,\n\t\t\t\t\t\tlocalState: s.localMode ? CodeMirror.copyState(s.localMode, s.localState) : null,\n\n\t\t\t\t\t\tinline: s.inline,\n\t\t\t\t\t\ttext: s.text,\n\t\t\t\t\t\tformatting: false,\n\t\t\t\t\t\tlinkTitle: s.linkTitle,\n\t\t\t\t\t\tem: s.em,\n\t\t\t\t\t\tstrong: s.strong,\n\t\t\t\t\t\tstrikethrough: s.strikethrough,\n\t\t\t\t\t\theader: s.header,\n\t\t\t\t\t\thr: s.hr,\n\t\t\t\t\t\ttaskList: s.taskList,\n\t\t\t\t\t\tlist: s.list,\n\t\t\t\t\t\tlistDepth: s.listDepth,\n\t\t\t\t\t\tquote: s.quote,\n\t\t\t\t\t\tindentedCode: s.indentedCode,\n\t\t\t\t\t\ttrailingSpace: s.trailingSpace,\n\t\t\t\t\t\ttrailingSpaceNewLine: s.trailingSpaceNewLine,\n\t\t\t\t\t\tmd_inside: s.md_inside\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\ttoken: function(stream, state) {\n\n\t\t\t\t\t// Reset state.formatting\n\t\t\t\t\tstate.formatting = false;\n\n\t\t\t\t\tif (stream.sol()) {\n\t\t\t\t\t\tvar forceBlankLine = !! state.header || state.hr;\n\n\t\t\t\t\t\t// Reset state.header and state.hr\n\t\t\t\t\t\tstate.header = 0;\n\t\t\t\t\t\tstate.hr = false;\n\n\t\t\t\t\t\tif (stream.match(/^\\s*$/, true) || forceBlankLine) {\n\t\t\t\t\t\t\tstate.prevLineHasContent = false;\n\t\t\t\t\t\t\tblankLine(state);\n\t\t\t\t\t\t\treturn forceBlankLine ? this.token(stream, state) : null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate.prevLineHasContent = state.thisLineHasContent;\n\t\t\t\t\t\t\tstate.thisLineHasContent = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Reset state.taskList\n\t\t\t\t\t\tstate.taskList = false;\n\n\t\t\t\t\t\t// Reset state.code\n\t\t\t\t\t\tstate.code = false;\n\n\t\t\t\t\t\t// Reset state.trailingSpace\n\t\t\t\t\t\tstate.trailingSpace = 0;\n\t\t\t\t\t\tstate.trailingSpaceNewLine = false;\n\n\t\t\t\t\t\tstate.f = state.block;\n\t\t\t\t\t\tvar indentation = stream.match(/^\\s*/, true)[0].replace(/\\t/g, '    ').length;\n\t\t\t\t\t\tvar difference = Math.floor((indentation - state.indentation) / 4) * 4;\n\t\t\t\t\t\tif (difference > 4) difference = 4;\n\t\t\t\t\t\tvar adjustedIndentation = state.indentation + difference;\n\t\t\t\t\t\tstate.indentationDiff = adjustedIndentation - state.indentation;\n\t\t\t\t\t\tstate.indentation = adjustedIndentation;\n\t\t\t\t\t\tif (indentation > 0) return null;\n\t\t\t\t\t}\n\t\t\t\t\treturn state.f(stream, state);\n\t\t\t\t},\n\n\t\t\t\tinnerMode: function(state) {\n\t\t\t\t\tif (state.block == htmlBlock) return {\n\t\t\t\t\t\tstate: state.htmlState,\n\t\t\t\t\t\tmode: htmlMode\n\t\t\t\t\t};\n\t\t\t\t\tif (state.localState) return {\n\t\t\t\t\t\tstate: state.localState,\n\t\t\t\t\t\tmode: state.localMode\n\t\t\t\t\t};\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstate: state,\n\t\t\t\t\t\tmode: mode\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tblankLine: blankLine,\n\n\t\t\t\tgetType: getType,\n\n\t\t\t\tfold: \"markdown\"\n\t\t\t};\n\t\t\treturn mode;\n\t\t}, \"xml\");\n\n\t\tCodeMirror.defineMIME(\"text/x-markdown\", \"markdown\");\n\n\t}\n\n}","Marked": "function (global) {\n\t/**\n * marked - a markdown parser\n * Copyright (c) 2011-2014, Christopher Jeffrey. (MIT Licensed)\n * https://github.com/chjj/marked\n */\n\n\tvar block = {\n\t\tnewline: /^\\n+/,\n\t\tcode: /^( {4}[^\\n]+\\n*)+/,\n\t\tfences: noop,\n\t\thr: /^( *[-*_]){3,} *(?:\\n+|$)/,\n\t\theading: /^ *(#{1,6}) *([^\\n]+?) *#* *(?:\\n+|$)/,\n\t\tnptable: noop,\n\t\tlheading: /^([^\\n]+)\\n *(=|-){2,} *(?:\\n+|$)/,\n\t\tblockquote: /^( *>[^\\n]+(\\n(?!def)[^\\n]+)*\\n*)+/,\n\t\tlist: /^( *)(bull) [\\s\\S]+?(?:hr|def|\\n{2,}(?! )(?!\\1bull )\\n*|\\s*$)/,\n\t\thtml: /^ *(?:comment *(?:\\n|\\s*$)|closed *(?:\\n{2,}|\\s*$)|closing *(?:\\n{2,}|\\s*$))/,\n\t\tdef: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +[\"(]([^\\n]+)[\")])? *(?:\\n+|$)/,\n\t\ttable: noop,\n\t\tparagraph: /^((?:[^\\n]+\\n?(?!hr|heading|lheading|blockquote|tag|def))+)\\n*/,\n\t\ttext: /^[^\\n]+/\n\t};\n\n\tblock.bullet = /(?:[*+-]|\\d+\\.)/;\n\tblock.item = /^( *)(bull) [^\\n]*(?:\\n(?!\\1bull )[^\\n]*)*/;\n\tblock.item = replace(block.item, 'gm')\n\t(/bull/g, block.bullet)\n\t();\n\n\tblock.list = replace(block.list)\n\t(/bull/g, block.bullet)\n\t('hr', '\\\\n+(?=\\\\1?(?:[-*_] *){3,}(?:\\\\n+|$))')\n\t('def', '\\\\n+(?=' + block.def.source + ')')\n\t();\n\n\tblock.blockquote = replace(block.blockquote)\n\t('def', block.def)\n\t();\n\n\tblock._tag = '(?!(?:'\n\t+ 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code'\n\t+ '|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo'\n\t+ '|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:/|[^\\\\w\\\\s@]*@)\\\\b';\n\n\tblock.html = replace(block.html)\n\t('comment', /<!--[\\s\\S]*?-->/)\n\t('closed', /<(tag)[\\s\\S]+?<\\/\\1>/)\n\t('closing', /<tag(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/)\n\t(/tag/g, block._tag)\n\t();\n\n\tblock.paragraph = replace(block.paragraph)\n\t('hr', block.hr)\n\t('heading', block.heading)\n\t('lheading', block.lheading)\n\t('blockquote', block.blockquote)\n\t('tag', '<' + block._tag)\n\t('def', block.def)\n\t();\n\n\t/**\n * Normal Block Grammar\n */\n\n\tblock.normal = merge({}, block);\n\n\t/**\n * GFM Block Grammar\n */\n\n\tblock.gfm = merge({}, block.normal, {\n\t\tfences: /^ *(`{3,}|~{3,})[ \\.]*(\\S+)? *\\n([\\s\\S]*?)\\s*\\1 *(?:\\n+|$)/,\n\t\tparagraph: /^/,\n\t\theading: /^ *(#{1,6}) +([^\\n]+?) *#* *(?:\\n+|$)/\n\t});\n\n\tblock.gfm.paragraph = replace(block.paragraph)\n\t('(?!', '(?!'\n\t + block.gfm.fences.source.replace('\\\\1', '\\\\2') + '|'\n\t + block.list.source.replace('\\\\1', '\\\\3') + '|')\n\t();\n\n\t/**\n * GFM + Tables Block Grammar\n */\n\n\tblock.tables = merge({}, block.gfm, {\n\t\tnptable: /^ *(\\S.*\\|.*)\\n *([-:]+ *\\|[-| :]*)\\n((?:.*\\|.*(?:\\n|$))*)\\n*/,\n\t\ttable: /^ *\\|(.+)\\n *\\|( *[-:]+[-| :]*)\\n((?: *\\|.*(?:\\n|$))*)\\n*/\n\t});\n\n\t/**\n * Block Lexer\n */\n\n\tfunction Lexer(options) {\n\t\tthis.tokens = [];\n\t\tthis.tokens.links = {};\n\t\tthis.options = options || marked.defaults;\n\t\tthis.rules = block.normal;\n\n\t\tif (this.options.gfm) {\n\t\t\tif (this.options.tables) {\n\t\t\t\tthis.rules = block.tables;\n\t\t\t} else {\n\t\t\t\tthis.rules = block.gfm;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n * Expose Block Rules\n */\n\n\tLexer.rules = block;\n\n\t/**\n * Static Lex Method\n */\n\n\tLexer.lex = function(src, options) {\n\t\tvar lexer = new Lexer(options);\n\t\treturn lexer.lex(src);\n\t};\n\n\t/**\n * Preprocessing\n */\n\n\tLexer.prototype.lex = function(src) {\n\t\tsrc = src\n\t\t.replace(/\\r\\n|\\r/g, '\\n')\n\t\t.replace(/\\t/g, '    ')\n\t\t.replace(/\\u00a0/g, ' ')\n\t\t.replace(/\\u2424/g, '\\n');\n\n\t\treturn this.token(src, true);\n\t};\n\n\t/**\n * Lexing\n */\n\n\tLexer.prototype.token = function(src, top, bq) {\n\t\tvar src = src.replace(/^ +$/gm, '')\n\t\t, next\n\t\t, loose\n\t\t, cap\n\t\t, bull\n\t\t, b\n\t\t, item\n\t\t, space\n\t\t, i\n\t\t, l;\n\n\t\twhile (src) {\n\t\t\t// newline\n\t\t\tif (cap = this.rules.newline.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tif (cap[0].length > 1) {\n\t\t\t\t\tthis.tokens.push({\n\t\t\t\t\t\ttype: 'space'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// code\n\t\t\tif (cap = this.rules.code.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tcap = cap[0].replace(/^ {4}/gm, '');\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'code',\n\t\t\t\t\ttext: !this.options.pedantic\n\t\t\t\t\t? cap.replace(/\\n+$/, '')\n\t\t\t\t\t: cap\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// fences (gfm)\n\t\t\tif (cap = this.rules.fences.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'code',\n\t\t\t\t\tlang: cap[2],\n\t\t\t\t\ttext: cap[3] || ''\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// heading\n\t\t\tif (cap = this.rules.heading.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'heading',\n\t\t\t\t\tdepth: cap[1].length,\n\t\t\t\t\ttext: cap[2]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// table no leading pipe (gfm)\n\t\t\tif (top && (cap = this.rules.nptable.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\n\t\t\t\titem = {\n\t\t\t\t\ttype: 'table',\n\t\t\t\t\theader: cap[1].replace(/^ *| *\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\talign: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\tcells: cap[3].replace(/\\n$/, '').split('\\n')\n\t\t\t\t};\n\n\t\t\t\tfor (i = 0; i < item.align.length; i++) {\n\t\t\t\t\tif (/^ *-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'right';\n\t\t\t\t\t} else if (/^ *:-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'center';\n\t\t\t\t\t} else if (/^ *:-+ *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'left';\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.align[i] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < item.cells.length; i++) {\n\t\t\t\t\titem.cells[i] = item.cells[i].split(/ *\\| */);\n\t\t\t\t}\n\n\t\t\t\tthis.tokens.push(item);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// lheading\n\t\t\tif (cap = this.rules.lheading.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'heading',\n\t\t\t\t\tdepth: cap[2] === '=' ? 1 : 2,\n\t\t\t\t\ttext: cap[1]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// hr\n\t\t\tif (cap = this.rules.hr.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'hr'\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// blockquote\n\t\t\tif (cap = this.rules.blockquote.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'blockquote_start'\n\t\t\t\t});\n\n\t\t\t\tcap = cap[0].replace(/^ *> ?/gm, '');\n\n\t\t\t\t// Pass `top` to keep the current\n\t\t\t\t// \"toplevel\" state. This is exactly\n\t\t\t\t// how markdown.pl works.\n\t\t\t\tthis.token(cap, top, true);\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'blockquote_end'\n\t\t\t\t});\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// list\n\t\t\tif (cap = this.rules.list.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tbull = cap[2];\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'list_start',\n\t\t\t\t\tordered: bull.length > 1\n\t\t\t\t});\n\n\t\t\t\t// Get each top-level item.\n\t\t\t\tcap = cap[0].match(this.rules.item);\n\n\t\t\t\tnext = false;\n\t\t\t\tl = cap.length;\n\t\t\t\ti = 0;\n\n\t\t\t\tfor (; i < l; i++) {\n\t\t\t\t\titem = cap[i];\n\n\t\t\t\t\t// Remove the list item's bullet\n\t\t\t\t\t// so it is seen as the next token.\n\t\t\t\t\tspace = item.length;\n\t\t\t\t\titem = item.replace(/^ *([*+-]|\\d+\\.) +/, '');\n\n\t\t\t\t\t// Outdent whatever the\n\t\t\t\t\t// list item contains. Hacky.\n\t\t\t\t\tif (~item.indexOf('\\n ')) {\n\t\t\t\t\t\tspace -= item.length;\n\t\t\t\t\t\titem = !this.options.pedantic\n\t\t\t\t\t\t? item.replace(new RegExp('^ {1,' + space + '}', 'gm'), '')\n\t\t\t\t\t\t: item.replace(/^ {1,4}/gm, '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Determine whether the next list item belongs here.\n\t\t\t\t\t// Backpedal if it does not belong in this list.\n\t\t\t\t\tif (this.options.smartLists && i !== l - 1) {\n\t\t\t\t\t\tb = block.bullet.exec(cap[i + 1])[0];\n\t\t\t\t\t\tif (bull !== b && !(bull.length > 1 && b.length > 1)) {\n\t\t\t\t\t\t\tsrc = cap.slice(i + 1).join('\\n') + src;\n\t\t\t\t\t\t\ti = l - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Determine whether item is loose or not.\n\t\t\t\t\t// Use: /(^|\\n)(?! )[^\\n]+\\n\\n(?!\\s*$)/\n\t\t\t\t\t// for discount behavior.\n\t\t\t\t\tloose = next || /\\n\\n(?!\\s*$)/.test(item);\n\t\t\t\t\tif (i !== l - 1) {\n\t\t\t\t\t\tnext = item.charAt(item.length - 1) === '\\n';\n\t\t\t\t\t\tif (!loose) loose = next;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.tokens.push({\n\t\t\t\t\t\ttype: loose\n\t\t\t\t\t\t? 'loose_item_start'\n\t\t\t\t\t\t: 'list_item_start'\n\t\t\t\t\t});\n\n\t\t\t\t\t// Recurse.\n\t\t\t\t\tthis.token(item, false, bq);\n\n\t\t\t\t\tthis.tokens.push({\n\t\t\t\t\t\ttype: 'list_item_end'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'list_end'\n\t\t\t\t});\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// html\n\t\t\tif (cap = this.rules.html.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: this.options.sanitize\n\t\t\t\t\t? 'paragraph'\n\t\t\t\t\t: 'html',\n\t\t\t\t\tpre: !this.options.sanitizer\n\t\t\t\t\t&& (cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style'),\n\t\t\t\t\ttext: cap[0]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// def\n\t\t\tif ((!bq && top) && (cap = this.rules.def.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.links[cap[1].toLowerCase()] = {\n\t\t\t\t\thref: cap[2],\n\t\t\t\t\ttitle: cap[3]\n\t\t\t\t};\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// table (gfm)\n\t\t\tif (top && (cap = this.rules.table.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\n\t\t\t\titem = {\n\t\t\t\t\ttype: 'table',\n\t\t\t\t\theader: cap[1].replace(/^ *| *\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\talign: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\tcells: cap[3].replace(/(?: *\\| *)?\\n$/, '').split('\\n')\n\t\t\t\t};\n\n\t\t\t\tfor (i = 0; i < item.align.length; i++) {\n\t\t\t\t\tif (/^ *-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'right';\n\t\t\t\t\t} else if (/^ *:-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'center';\n\t\t\t\t\t} else if (/^ *:-+ *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'left';\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.align[i] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < item.cells.length; i++) {\n\t\t\t\t\titem.cells[i] = item.cells[i]\n\t\t\t\t\t.replace(/^ *\\| *| *\\| *$/g, '')\n\t\t\t\t\t.split(/ *\\| */);\n\t\t\t\t}\n\n\t\t\t\tthis.tokens.push(item);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// top-level paragraph\n\t\t\tif (top && (cap = this.rules.paragraph.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'paragraph',\n\t\t\t\t\ttext: cap[1].charAt(cap[1].length - 1) === '\\n'\n\t\t\t\t\t? cap[1].slice(0, -1)\n\t\t\t\t\t: cap[1]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// text\n\t\t\tif (cap = this.rules.text.exec(src)) {\n\t\t\t\t// Top-level should never reach here.\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\ttext: cap[0]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (src) {\n\t\t\t\tthrow new\n\t\t\t\tError('Infinite loop on byte: ' + src.charCodeAt(0));\n\t\t\t}\n\t\t}\n\n\t\treturn this.tokens;\n\t};\n\n\t/**\n * Inline-Level Grammar\n */\n\n\tvar inline = {\n\t\tescape: /^\\\\([\\\\`*{}\\[\\]()#+\\-.!_>])/,\n\t\tautolink: /^<([^ >]+(@|:\\/)[^ >]+)>/,\n\t\turl: noop,\n\t\ttag: /^<!--[\\s\\S]*?-->|^<\\/?\\w+(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/,\n\t\tlink: /^!?\\[(inside)\\]\\(href\\)/,\n\t\treflink: /^!?\\[(inside)\\]\\s*\\[([^\\]]*)\\]/,\n\t\tnolink: /^!?\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\]/,\n\t\tstrong: /^__([\\s\\S]+?)__(?!_)|^\\*\\*([\\s\\S]+?)\\*\\*(?!\\*)/,\n\t\tem: /^\\b_((?:[^_]|__)+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,\n\t\tcode: /^(`+)\\s*([\\s\\S]*?[^`])\\s*\\1(?!`)/,\n\t\tbr: /^ {2,}\\n(?!\\s*$)/,\n\t\tdel: noop,\n\t\ttext: /^[\\s\\S]+?(?=[\\\\<!\\[_*`]| {2,}\\n|$)/\n\t};\n\n\tinline._inside = /(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*/;\n\tinline._href = /\\s*<?([\\s\\S]*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*/;\n\n\tinline.link = replace(inline.link)\n\t('inside', inline._inside)\n\t('href', inline._href)\n\t();\n\n\tinline.reflink = replace(inline.reflink)\n\t('inside', inline._inside)\n\t();\n\n\t/**\n * Normal Inline Grammar\n */\n\n\tinline.normal = merge({}, inline);\n\n\t/**\n * Pedantic Inline Grammar\n */\n\n\tinline.pedantic = merge({}, inline.normal, {\n\t\tstrong: /^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,\n\t\tem: /^_(?=\\S)([\\s\\S]*?\\S)_(?!_)|^\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)/\n\t});\n\n\t/**\n * GFM Inline Grammar\n */\n\n\tinline.gfm = merge({}, inline.normal, {\n\t\tescape: replace(inline.escape)('])', '~|])')(),\n\t\turl: /^(https?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])/,\n\t\tdel: /^~~(?=\\S)([\\s\\S]*?\\S)~~/,\n\t\ttext: replace(inline.text)\n\t\t(']|', '~]|')\n\t\t('|', '|https?://|')\n\t\t()\n\t});\n\n\t/**\n * GFM + Line Breaks Inline Grammar\n */\n\n\tinline.breaks = merge({}, inline.gfm, {\n\t\tbr: replace(inline.br)('{2,}', '*')(),\n\t\ttext: replace(inline.gfm.text)('{2,}', '*')()\n\t});\n\n\t/**\n * Inline Lexer & Compiler\n */\n\n\tfunction InlineLexer(links, options) {\n\t\tthis.options = options || marked.defaults;\n\t\tthis.links = links;\n\t\tthis.rules = inline.normal;\n\t\tthis.renderer = this.options.renderer || new Renderer;\n\t\tthis.renderer.options = this.options;\n\n\t\tif (!this.links) {\n\t\t\tthrow new\n\t\t\tError('Tokens array requires a `links` property.');\n\t\t}\n\n\t\tif (this.options.gfm) {\n\t\t\tif (this.options.breaks) {\n\t\t\t\tthis.rules = inline.breaks;\n\t\t\t} else {\n\t\t\t\tthis.rules = inline.gfm;\n\t\t\t}\n\t\t} else if (this.options.pedantic) {\n\t\t\tthis.rules = inline.pedantic;\n\t\t}\n\t}\n\n\t/**\n * Expose Inline Rules\n */\n\n\tInlineLexer.rules = inline;\n\n\t/**\n * Static Lexing/Compiling Method\n */\n\n\tInlineLexer.output = function(src, links, options) {\n\t\tvar inline = new InlineLexer(links, options);\n\t\treturn inline.output(src);\n\t};\n\n\t/**\n * Lexing/Compiling\n */\n\n\tInlineLexer.prototype.output = function(src) {\n\t\tvar out = ''\n\t\t, link\n\t\t, text\n\t\t, href\n\t\t, cap;\n\n\t\twhile (src) {\n\t\t\t// escape\n\t\t\tif (cap = this.rules.escape.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += cap[1];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// autolink\n\t\t\tif (cap = this.rules.autolink.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tif (cap[2] === '@') {\n\t\t\t\t\ttext = cap[1].charAt(6) === ':'\n\t\t\t\t\t? this.mangle(cap[1].substring(7))\n\t\t\t\t\t: this.mangle(cap[1]);\n\t\t\t\t\thref = this.mangle('mailto:') + text;\n\t\t\t\t} else {\n\t\t\t\t\ttext = escape(cap[1]);\n\t\t\t\t\thref = text;\n\t\t\t\t}\n\t\t\t\tout += this.renderer.link(href, null, text);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// url (gfm)\n\t\t\tif (!this.inLink && (cap = this.rules.url.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\ttext = escape(cap[1]);\n\t\t\t\thref = text;\n\t\t\t\tout += this.renderer.link(href, null, text);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// tag\n\t\t\tif (cap = this.rules.tag.exec(src)) {\n\t\t\t\tif (!this.inLink && /^<a /i.test(cap[0])) {\n\t\t\t\t\tthis.inLink = true;\n\t\t\t\t} else if (this.inLink && /^<\\/a>/i.test(cap[0])) {\n\t\t\t\t\tthis.inLink = false;\n\t\t\t\t}\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.options.sanitize\n\t\t\t\t? this.options.sanitizer\n\t\t\t\t? this.options.sanitizer(cap[0])\n\t\t\t\t: escape(cap[0])\n\t\t\t\t: cap[0]\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// link\n\t\t\tif (cap = this.rules.link.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.inLink = true;\n\t\t\t\tout += this.outputLink(cap, {\n\t\t\t\t\thref: cap[2],\n\t\t\t\t\ttitle: cap[3]\n\t\t\t\t});\n\t\t\t\tthis.inLink = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// reflink, nolink\n\t\t\tif ((cap = this.rules.reflink.exec(src))\n\t\t\t\t\t|| (cap = this.rules.nolink.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tlink = (cap[2] || cap[1]).replace(/\\s+/g, ' ');\n\t\t\t\tlink = this.links[link.toLowerCase()];\n\t\t\t\tif (!link || !link.href) {\n\t\t\t\t\tout += cap[0].charAt(0);\n\t\t\t\t\tsrc = cap[0].substring(1) + src;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.inLink = true;\n\t\t\t\tout += this.outputLink(cap, link);\n\t\t\t\tthis.inLink = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// strong\n\t\t\tif (cap = this.rules.strong.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.strong(this.output(cap[2] || cap[1]));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// em\n\t\t\tif (cap = this.rules.em.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.em(this.output(cap[2] || cap[1]));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// code\n\t\t\tif (cap = this.rules.code.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.codespan(escape(cap[2], true));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// br\n\t\t\tif (cap = this.rules.br.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.br();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// del (gfm)\n\t\t\tif (cap = this.rules.del.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.del(this.output(cap[1]));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// text\n\t\t\tif (cap = this.rules.text.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.text(escape(this.smartypants(cap[0])));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (src) {\n\t\t\t\tthrow new\n\t\t\t\tError('Infinite loop on byte: ' + src.charCodeAt(0));\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t};\n\n\t/**\n * Compile Link\n */\n\n\tInlineLexer.prototype.outputLink = function(cap, link) {\n\t\tvar href = escape(link.href)\n\t\t, title = link.title ? escape(link.title) : null;\n\n\t\treturn cap[0].charAt(0) !== '!'\n\t\t? this.renderer.link(href, title, this.output(cap[1]))\n\t\t: this.renderer.image(href, title, escape(cap[1]));\n\t};\n\n\t/**\n * Smartypants Transformations\n */\n\n\tInlineLexer.prototype.smartypants = function(text) {\n\t\tif (!this.options.smartypants) return text;\n\t\treturn text\n\t\t// em-dashes\n\t\t.replace(/---/g, '\\u2014')\n\t\t// en-dashes\n\t\t.replace(/--/g, '\\u2013')\n\t\t// opening singles\n\t\t.replace(/(^|[-\\u2014/(\\[{\"\\s])'/g, '$1\\u2018')\n\t\t// closing singles & apostrophes\n\t\t.replace(/'/g, '\\u2019')\n\t\t// opening doubles\n\t\t.replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g, '$1\\u201c')\n\t\t// closing doubles\n\t\t.replace(/\"/g, '\\u201d')\n\t\t// ellipses\n\t\t.replace(/\\.{3}/g, '\\u2026');\n\t};\n\n\t/**\n * Mangle Links\n */\n\n\tInlineLexer.prototype.mangle = function(text) {\n\t\tif (!this.options.mangle) return text;\n\t\tvar out = ''\n\t\t, l = text.length\n\t\t, i = 0\n\t\t, ch;\n\n\t\tfor (; i < l; i++) {\n\t\t\tch = text.charCodeAt(i);\n\t\t\tif (Math.random() > 0.5) {\n\t\t\t\tch = 'x' + ch.toString(16);\n\t\t\t}\n\t\t\tout += '&#' + ch + ';';\n\t\t}\n\n\t\treturn out;\n\t};\n\n\t/**\n * Renderer\n */\n\n\tfunction Renderer(options) {\n\t\tthis.options = options || {};\n\t}\n\n\tRenderer.prototype.code = function(code, lang, escaped) {\n\t\tif (this.options.highlight) {\n\t\t\tvar out = this.options.highlight(code, lang);\n\t\t\tif (out != null && out !== code) {\n\t\t\t\tescaped = true;\n\t\t\t\tcode = out;\n\t\t\t}\n\t\t}\n\n\t\tif (!lang) {\n\t\t\treturn '<pre><code>'\n\t\t\t+ (escaped ? code : escape(code, true))\n\t\t\t+ '\\n</code></pre>';\n\t\t}\n\n\t\treturn '<pre><code class=\"'\n\t\t+ this.options.langPrefix\n\t\t+ escape(lang, true)\n\t\t+ '\">'\n\t\t+ (escaped ? code : escape(code, true))\n\t\t+ '\\n</code></pre>\\n';\n\t};\n\n\tRenderer.prototype.blockquote = function(quote) {\n\t\treturn '<blockquote>\\n' + quote + '</blockquote>\\n';\n\t};\n\n\tRenderer.prototype.html = function(html) {\n\t\treturn html;\n\t};\n\n\tRenderer.prototype.heading = function(text, level, raw) {\n\t\treturn '<h'\n\t\t+ level\n\t\t+ ' id=\"'\n\t\t+ this.options.headerPrefix\n\t\t+ raw.toLowerCase().replace(/[^\\w]+/g, '-')\n\t\t+ '\">'\n\t\t+ text\n\t\t+ '</h'\n\t\t+ level\n\t\t+ '>\\n';\n\t};\n\n\tRenderer.prototype.hr = function() {\n\t\treturn this.options.xhtml ? '<hr/>\\n' : '<hr>\\n';\n\t};\n\n\tRenderer.prototype.list = function(body, ordered) {\n\t\tvar type = ordered ? 'ol' : 'ul';\n\t\treturn '<' + type + '>\\n' + body + '</' + type + '>\\n';\n\t};\n\n\tRenderer.prototype.listitem = function(text) {\n\t\treturn '<li>' + text + '</li>\\n';\n\t};\n\n\tRenderer.prototype.paragraph = function(text) {\n\t\treturn '<p>' + text + '</p>\\n';\n\t};\n\n\tRenderer.prototype.table = function(header, body) {\n\t\treturn '<table>\\n'\n\t\t+ '<thead>\\n'\n\t\t+ header\n\t\t+ '</thead>\\n'\n\t\t+ '<tbody>\\n'\n\t\t+ body\n\t\t+ '</tbody>\\n'\n\t\t+ '</table>\\n';\n\t};\n\n\tRenderer.prototype.tablerow = function(content) {\n\t\treturn '<tr>\\n' + content + '</tr>\\n';\n\t};\n\n\tRenderer.prototype.tablecell = function(content, flags) {\n\t\tvar type = flags.header ? 'th' : 'td';\n\t\tvar tag = flags.align\n\t\t? '<' + type + ' style=\"text-align:' + flags.align + '\">'\n\t\t: '<' + type + '>';\n\t\treturn tag + content + '</' + type + '>\\n';\n\t};\n\n\t// span level renderer\n\tRenderer.prototype.strong = function(text) {\n\t\treturn '<strong>' + text + '</strong>';\n\t};\n\n\tRenderer.prototype.em = function(text) {\n\t\treturn '<em>' + text + '</em>';\n\t};\n\n\tRenderer.prototype.codespan = function(text) {\n\t\treturn '<code>' + text + '</code>';\n\t};\n\n\tRenderer.prototype.br = function() {\n\t\treturn this.options.xhtml ? '<br/>' : '<br>';\n\t};\n\n\tRenderer.prototype.del = function(text) {\n\t\treturn '<del>' + text + '</del>';\n\t};\n\n\tRenderer.prototype.link = function(href, title, text) {\n\t\tif (this.options.sanitize) {\n\t\t\ttry {\n\t\t\t\tvar prot = decodeURIComponent(unescape(href))\n\t\t\t\t.replace(/[^\\w:]/g, '')\n\t\t\t\t.toLowerCase();\n\t\t\t} catch (e) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tif (prot.indexOf('javascript:') === 0 || prot.indexOf('vbscript:') === 0) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\tvar out = '<a href=\"' + href + '\"';\n\t\tif (title) {\n\t\t\tout += ' title=\"' + title + '\"';\n\t\t}\n\t\tout += '>' + text + '</a>';\n\t\treturn out;\n\t};\n\n\tRenderer.prototype.image = function(href, title, text) {\n\t\tvar out = '<img src=\"' + href + '\" alt=\"' + text + '\"';\n\t\tif (title) {\n\t\t\tout += ' title=\"' + title + '\"';\n\t\t}\n\t\tout += this.options.xhtml ? '/>' : '>';\n\t\treturn out;\n\t};\n\n\tRenderer.prototype.text = function(text) {\n\t\treturn text;\n\t};\n\n\t/**\n * Parsing & Compiling\n */\n\n\tfunction Parser(options) {\n\t\tthis.tokens = [];\n\t\tthis.token = null;\n\t\tthis.options = options || marked.defaults;\n\t\tthis.options.renderer = this.options.renderer || new Renderer;\n\t\tthis.renderer = this.options.renderer;\n\t\tthis.renderer.options = this.options;\n\t}\n\n\t/**\n * Static Parse Method\n */\n\n\tParser.parse = function(src, options, renderer) {\n\t\tvar parser = new Parser(options, renderer);\n\t\treturn parser.parse(src);\n\t};\n\n\t/**\n * Parse Loop\n */\n\n\tParser.prototype.parse = function(src) {\n\t\tthis.inline = new InlineLexer(src.links, this.options, this.renderer);\n\t\tthis.tokens = src.reverse();\n\n\t\tvar out = '';\n\t\twhile (this.next()) {\n\t\t\tout += this.tok();\n\t\t}\n\n\t\treturn out;\n\t};\n\n\t/**\n * Next Token\n */\n\n\tParser.prototype.next = function() {\n\t\treturn this.token = this.tokens.pop();\n\t};\n\n\t/**\n * Preview Next Token\n */\n\n\tParser.prototype.peek = function() {\n\t\treturn this.tokens[this.tokens.length - 1] || 0;\n\t};\n\n\t/**\n * Parse Text Tokens\n */\n\n\tParser.prototype.parseText = function() {\n\t\tvar body = this.token.text;\n\n\t\twhile (this.peek().type === 'text') {\n\t\t\tbody += '\\n' + this.next().text;\n\t\t}\n\n\t\treturn this.inline.output(body);\n\t};\n\n\t/**\n * Parse Current Token\n */\n\n\tParser.prototype.tok = function() {\n\t\tswitch (this.token.type) {\n\t\t\tcase 'space': {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tcase 'hr': {\n\t\t\t\treturn this.renderer.hr();\n\t\t\t}\n\t\t\tcase 'heading': {\n\t\t\t\treturn this.renderer.heading(\n\t\t\t\t\tthis.inline.output(this.token.text),\n\t\t\t\t\tthis.token.depth,\n\t\t\t\t\tthis.token.text);\n\t\t\t}\n\t\t\tcase 'code': {\n\t\t\t\treturn this.renderer.code(this.token.text,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.token.lang,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.token.escaped);\n\t\t\t}\n\t\t\tcase 'table': {\n\t\t\t\tvar header = ''\n\t\t\t\t, body = ''\n\t\t\t\t, i\n\t\t\t\t, row\n\t\t\t\t, cell\n\t\t\t\t, flags\n\t\t\t\t, j;\n\n\t\t\t\t// header\n\t\t\t\tcell = '';\n\t\t\t\tfor (i = 0; i < this.token.header.length; i++) {\n\t\t\t\t\tflags = { header: true, align: this.token.align[i] };\n\t\t\t\t\tcell += this.renderer.tablecell(\n\t\t\t\t\t\tthis.inline.output(this.token.header[i]),\n\t\t\t\t\t\t{ header: true, align: this.token.align[i] }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\theader += this.renderer.tablerow(cell);\n\n\t\t\t\tfor (i = 0; i < this.token.cells.length; i++) {\n\t\t\t\t\trow = this.token.cells[i];\n\n\t\t\t\t\tcell = '';\n\t\t\t\t\tfor (j = 0; j < row.length; j++) {\n\t\t\t\t\t\tcell += this.renderer.tablecell(\n\t\t\t\t\t\t\tthis.inline.output(row[j]),\n\t\t\t\t\t\t\t{ header: false, align: this.token.align[j] }\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tbody += this.renderer.tablerow(cell);\n\t\t\t\t}\n\t\t\t\treturn this.renderer.table(header, body);\n\t\t\t}\n\t\t\tcase 'blockquote_start': {\n\t\t\t\tvar body = '';\n\n\t\t\t\twhile (this.next().type !== 'blockquote_end') {\n\t\t\t\t\tbody += this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.blockquote(body);\n\t\t\t}\n\t\t\tcase 'list_start': {\n\t\t\t\tvar body = ''\n\t\t\t\t, ordered = this.token.ordered;\n\n\t\t\t\twhile (this.next().type !== 'list_end') {\n\t\t\t\t\tbody += this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.list(body, ordered);\n\t\t\t}\n\t\t\tcase 'list_item_start': {\n\t\t\t\tvar body = '';\n\n\t\t\t\twhile (this.next().type !== 'list_item_end') {\n\t\t\t\t\tbody += this.token.type === 'text'\n\t\t\t\t\t? this.parseText()\n\t\t\t\t\t: this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.listitem(body);\n\t\t\t}\n\t\t\tcase 'loose_item_start': {\n\t\t\t\tvar body = '';\n\n\t\t\t\twhile (this.next().type !== 'list_item_end') {\n\t\t\t\t\tbody += this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.listitem(body);\n\t\t\t}\n\t\t\tcase 'html': {\n\t\t\t\tvar html = !this.token.pre && !this.options.pedantic\n\t\t\t\t? this.inline.output(this.token.text)\n\t\t\t\t: this.token.text;\n\t\t\t\treturn this.renderer.html(html);\n\t\t\t}\n\t\t\tcase 'paragraph': {\n\t\t\t\treturn this.renderer.paragraph(this.inline.output(this.token.text));\n\t\t\t}\n\t\t\tcase 'text': {\n\t\t\t\treturn this.renderer.paragraph(this.parseText());\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n * Helpers\n */\n\n\tfunction escape(html, encode) {\n\t\treturn html\n\t\t.replace(!encode ? /&(?!#?\\w+;)/g : /&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/\"/g, '&quot;')\n\t\t.replace(/'/g, '&#39;');\n\t}\n\n\tfunction unescape(html) {\n\t\treturn html.replace(/&([#\\w]+);/g, function(_, n) {\n\t\t\tn = n.toLowerCase();\n\t\t\tif (n === 'colon') return ':';\n\t\t\tif (n.charAt(0) === '#') {\n\t\t\t\treturn n.charAt(1) === 'x'\n\t\t\t\t? String.fromCharCode(parseInt(n.substring(2), 16))\n\t\t\t\t: String.fromCharCode(+n.substring(1));\n\t\t\t}\n\t\t\treturn '';\n\t\t});\n\t}\n\n\tfunction replace(regex, opt) {\n\t\tregex = regex.source;\n\t\topt = opt || '';\n\t\treturn function self(name, val) {\n\t\t\tif (!name) return new RegExp(regex, opt);\n\t\t\tval = val.source || val;\n\t\t\tval = val.replace(/(^|[^\\[])\\^/g, '$1');\n\t\t\tregex = regex.replace(name, val);\n\t\t\treturn self;\n\t\t};\n\t}\n\n\tfunction noop() {}\n\tnoop.exec = noop;\n\n\tfunction merge(obj) {\n\t\tvar i = 1\n\t\t, target\n\t\t, key;\n\n\t\tfor (; i < arguments.length; i++) {\n\t\t\ttarget = arguments[i];\n\t\t\tfor (key in target) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\t\t\tobj[key] = target[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\n\t/**\n * Marked\n */\n\n\tfunction marked(src, opt, callback) {\n\t\tif (callback || typeof opt === 'function') {\n\t\t\tif (!callback) {\n\t\t\t\tcallback = opt;\n\t\t\t\topt = null;\n\t\t\t}\n\n\t\t\topt = merge({}, marked.defaults, opt || {});\n\n\t\t\tvar highlight = opt.highlight\n\t\t\t, tokens\n\t\t\t, pending\n\t\t\t, i = 0;\n\n\t\t\ttry {\n\t\t\t\ttokens = Lexer.lex(src, opt)\n\t\t\t} catch (e) {\n\t\t\t\treturn callback(e);\n\t\t\t}\n\n\t\t\tpending = tokens.length;\n\n\t\t\tvar done = function(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\topt.highlight = highlight;\n\t\t\t\t\treturn callback(err);\n\t\t\t\t}\n\n\t\t\t\tvar out;\n\n\t\t\t\ttry {\n\t\t\t\t\tout = Parser.parse(tokens, opt);\n\t\t\t\t} catch (e) {\n\t\t\t\t\terr = e;\n\t\t\t\t}\n\n\t\t\t\topt.highlight = highlight;\n\n\t\t\t\treturn err\n\t\t\t\t? callback(err)\n\t\t\t\t: callback(null, out);\n\t\t\t};\n\n\t\t\tif (!highlight || highlight.length < 3) {\n\t\t\t\treturn done();\n\t\t\t}\n\n\t\t\tdelete opt.highlight;\n\n\t\t\tif (!pending) return done();\n\n\t\t\tfor (; i < tokens.length; i++) {\n\t\t\t\t(function(token) {\n\t\t\t\t\tif (token.type !== 'code') {\n\t\t\t\t\t\treturn --pending || done();\n\t\t\t\t\t}\n\t\t\t\t\treturn highlight(token.text, token.lang, function(err, code) {\n\t\t\t\t\t\tif (err) return done(err);\n\t\t\t\t\t\tif (code == null || code === token.text) {\n\t\t\t\t\t\t\treturn --pending || done();\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttoken.text = code;\n\t\t\t\t\t\ttoken.escaped = true;\n\t\t\t\t\t\t--pending || done();\n\t\t\t\t\t});\n\t\t\t\t})(tokens[i]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tif (opt) opt = merge({}, marked.defaults, opt);\n\t\t\treturn Parser.parse(Lexer.lex(src, opt), opt);\n\t\t} catch (e) {\n\t\t\te.message += '\\nPlease report this to https://github.com/chjj/marked.';\n\t\t\tif ((opt || marked.defaults).silent) {\n\t\t\t\treturn '<p>An error occured:</p><pre>'\n\t\t\t\t+ escape(e.message + '', true)\n\t\t\t\t+ '</pre>';\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\t/**\n * Options\n */\n\n\tmarked.options =\n\t\tmarked.setOptions = function(opt) {\n\t\tmerge(marked.defaults, opt);\n\t\treturn marked;\n\t};\n\n\tmarked.defaults = {\n\t\tgfm: true,\n\t\ttables: true,\n\t\tbreaks: false,\n\t\tpedantic: false,\n\t\tsanitize: false,\n\t\tsanitizer: null,\n\t\tmangle: true,\n\t\tsmartLists: false,\n\t\tsilent: false,\n\t\thighlight: null,\n\t\tlangPrefix: 'lang-',\n\t\tsmartypants: false,\n\t\theaderPrefix: '',\n\t\trenderer: new Renderer,\n\t\txhtml: false\n\t};\n\n\t/**\n * Expose\n */\n\n\tmarked.Parser = Parser;\n\tmarked.parser = Parser.parse;\n\n\tmarked.Renderer = Renderer;\n\n\tmarked.Lexer = Lexer;\n\tmarked.lexer = Lexer.lex;\n\n\tmarked.InlineLexer = InlineLexer;\n\tmarked.inlineLexer = InlineLexer.output;\n\n\tmarked.parse = marked;\n\n\tglobal.marked = marked;\n\n}","Erlang": "function (global) {\n\n\tvar CodeMirror = global.CodeMirror;\n\n\tCodeMirror.defineMIME(\"text/x-erlang\", \"erlang\");\n\n\tCodeMirror.defineMode(\"erlang\", function(cmCfg) {\n\t\t\"use strict\";\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// constants\n\n\t\tvar typeWords = [\n\t\t\t\"-type\", \"-spec\", \"-export_type\", \"-opaque\"\n\t\t];\n\n\t\tvar keywordWords = [\n\t\t\t\"after\", \"begin\", \"catch\", \"case\", \"cond\", \"end\", \"fun\", \"if\",\n\t\t\t\"let\", \"of\", \"query\", \"receive\", \"try\", \"when\"\n\t\t];\n\n\t\tvar separatorRE = /[\\->,;]/;\n\t\tvar separatorWords = [\n\t\t\t\"->\", \";\", \",\"\n\t\t];\n\n\t\tvar operatorAtomWords = [\n\t\t\t\"and\", \"andalso\", \"band\", \"bnot\", \"bor\", \"bsl\", \"bsr\", \"bxor\",\n\t\t\t\"div\", \"not\", \"or\", \"orelse\", \"rem\", \"xor\"\n\t\t];\n\n\t\tvar operatorSymbolRE = /[\\+\\-\\*\\/<>=\\|:!]/;\n\t\tvar operatorSymbolWords = [\n\t\t\t\"=\", \"+\", \"-\", \"*\", \"/\", \">\", \">=\", \"<\", \"=<\", \"=:=\", \"==\", \"=/=\", \"/=\", \"||\", \"<-\", \"!\"\n\t\t];\n\n\t\tvar openParenRE = /[<\\(\\[\\{]/;\n\t\tvar openParenWords = [\n\t\t\t\"<<\", \"(\", \"[\", \"{\"\n\t\t];\n\n\t\tvar closeParenRE = /[>\\)\\]\\}]/;\n\t\tvar closeParenWords = [\n\t\t\t\"}\", \"]\", \")\", \">>\"\n\t\t];\n\n\t\tvar guardWords = [\n\t\t\t\"is_atom\", \"is_binary\", \"is_bitstring\", \"is_boolean\", \"is_float\",\n\t\t\t\"is_function\", \"is_integer\", \"is_list\", \"is_number\", \"is_pid\",\n\t\t\t\"is_port\", \"is_record\", \"is_reference\", \"is_tuple\",\n\t\t\t\"atom\", \"binary\", \"bitstring\", \"boolean\", \"function\", \"integer\", \"list\",\n\t\t\t\"number\", \"pid\", \"port\", \"record\", \"reference\", \"tuple\"\n\t\t];\n\n\t\tvar bifWords = [\n\t\t\t\"abs\", \"adler32\", \"adler32_combine\", \"alive\", \"apply\", \"atom_to_binary\",\n\t\t\t\"atom_to_list\", \"binary_to_atom\", \"binary_to_existing_atom\",\n\t\t\t\"binary_to_list\", \"binary_to_term\", \"bit_size\", \"bitstring_to_list\",\n\t\t\t\"byte_size\", \"check_process_code\", \"contact_binary\", \"crc32\",\n\t\t\t\"crc32_combine\", \"date\", \"decode_packet\", \"delete_module\",\n\t\t\t\"disconnect_node\", \"element\", \"erase\", \"exit\", \"float\", \"float_to_list\",\n\t\t\t\"garbage_collect\", \"get\", \"get_keys\", \"group_leader\", \"halt\", \"hd\",\n\t\t\t\"integer_to_list\", \"internal_bif\", \"iolist_size\", \"iolist_to_binary\",\n\t\t\t\"is_alive\", \"is_atom\", \"is_binary\", \"is_bitstring\", \"is_boolean\",\n\t\t\t\"is_float\", \"is_function\", \"is_integer\", \"is_list\", \"is_number\", \"is_pid\",\n\t\t\t\"is_port\", \"is_process_alive\", \"is_record\", \"is_reference\", \"is_tuple\",\n\t\t\t\"length\", \"link\", \"list_to_atom\", \"list_to_binary\", \"list_to_bitstring\",\n\t\t\t\"list_to_existing_atom\", \"list_to_float\", \"list_to_integer\",\n\t\t\t\"list_to_pid\", \"list_to_tuple\", \"load_module\", \"make_ref\", \"module_loaded\",\n\t\t\t\"monitor_node\", \"node\", \"node_link\", \"node_unlink\", \"nodes\", \"notalive\",\n\t\t\t\"now\", \"open_port\", \"pid_to_list\", \"port_close\", \"port_command\",\n\t\t\t\"port_connect\", \"port_control\", \"pre_loaded\", \"process_flag\",\n\t\t\t\"process_info\", \"processes\", \"purge_module\", \"put\", \"register\",\n\t\t\t\"registered\", \"round\", \"self\", \"setelement\", \"size\", \"spawn\", \"spawn_link\",\n\t\t\t\"spawn_monitor\", \"spawn_opt\", \"split_binary\", \"statistics\",\n\t\t\t\"term_to_binary\", \"time\", \"throw\", \"tl\", \"trunc\", \"tuple_size\",\n\t\t\t\"tuple_to_list\", \"unlink\", \"unregister\", \"whereis\"\n\t\t];\n\n\t\t// upper case: [A-Z] [Ø-Þ] [À-Ö]\n\t\t// lower case: [a-z] [ß-ö] [ø-ÿ]\n\t\tvar anumRE = /[\\w@Ø-ÞÀ-Öß-öø-ÿ]/;\n\t\tvar escapesRE =\n\t\t\t\t/[0-7]{1,3}|[bdefnrstv\\\\\"']|\\^[a-zA-Z]|x[0-9a-zA-Z]{2}|x{[0-9a-zA-Z]+}/;\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// tokenizer\n\n\t\tfunction tokenizer(stream, state) {\n\t\t\t// in multi-line string\n\t\t\tif (state.in_string) {\n\t\t\t\tstate.in_string = (!doubleQuote(stream));\n\t\t\t\treturn rval(state, stream, \"string\");\n\t\t\t}\n\n\t\t\t// in multi-line atom\n\t\t\tif (state.in_atom) {\n\t\t\t\tstate.in_atom = (!singleQuote(stream));\n\t\t\t\treturn rval(state, stream, \"atom\");\n\t\t\t}\n\n\t\t\t// whitespace\n\t\t\tif (stream.eatSpace()) {\n\t\t\t\treturn rval(state, stream, \"whitespace\");\n\t\t\t}\n\n\t\t\t// attributes and type specs\n\t\t\tif (!peekToken(state) &&\n\t\t\t\t\tstream.match(/-\\s*[a-zß-öø-ÿ][\\wØ-ÞÀ-Öß-öø-ÿ]*/)) {\n\t\t\t\tif (is_member(stream.current(), typeWords)) {\n\t\t\t\t\treturn rval(state, stream, \"type\");\n\t\t\t\t} else {\n\t\t\t\t\treturn rval(state, stream, \"attribute\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar ch = stream.next();\n\n\t\t\t// comment\n\t\t\tif (ch == '%') {\n\t\t\t\tstream.skipToEnd();\n\t\t\t\treturn rval(state, stream, \"comment\");\n\t\t\t}\n\n\t\t\t// colon\n\t\t\tif (ch == \":\") {\n\t\t\t\treturn rval(state, stream, \"colon\");\n\t\t\t}\n\n\t\t\t// macro\n\t\t\tif (ch == '?') {\n\t\t\t\tstream.eatSpace();\n\t\t\t\tstream.eatWhile(anumRE);\n\t\t\t\treturn rval(state, stream, \"macro\");\n\t\t\t}\n\n\t\t\t// record\n\t\t\tif (ch == \"#\") {\n\t\t\t\tstream.eatSpace();\n\t\t\t\tstream.eatWhile(anumRE);\n\t\t\t\treturn rval(state, stream, \"record\");\n\t\t\t}\n\n\t\t\t// dollar escape\n\t\t\tif (ch == \"$\") {\n\t\t\t\tif (stream.next() == \"\\\\\" && !stream.match(escapesRE)) {\n\t\t\t\t\treturn rval(state, stream, \"error\");\n\t\t\t\t}\n\t\t\t\treturn rval(state, stream, \"number\");\n\t\t\t}\n\n\t\t\t// dot\n\t\t\tif (ch == \".\") {\n\t\t\t\treturn rval(state, stream, \"dot\");\n\t\t\t}\n\n\t\t\t// quoted atom\n\t\t\tif (ch == '\\'') {\n\t\t\t\tif (!(state.in_atom = (!singleQuote(stream)))) {\n\t\t\t\t\tif (stream.match(/\\s*\\/\\s*[0-9]/, false)) {\n\t\t\t\t\t\tstream.match(/\\s*\\/\\s*[0-9]/, true);\n\t\t\t\t\t\treturn rval(state, stream, \"fun\"); // 'f'/0 style fun\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.match(/\\s*\\(/, false) || stream.match(/\\s*:/, false)) {\n\t\t\t\t\t\treturn rval(state, stream, \"function\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rval(state, stream, \"atom\");\n\t\t\t}\n\n\t\t\t// string\n\t\t\tif (ch == '\"') {\n\t\t\t\tstate.in_string = (!doubleQuote(stream));\n\t\t\t\treturn rval(state, stream, \"string\");\n\t\t\t}\n\n\t\t\t// variable\n\t\t\tif (/[A-Z_Ø-ÞÀ-Ö]/.test(ch)) {\n\t\t\t\tstream.eatWhile(anumRE);\n\t\t\t\treturn rval(state, stream, \"variable\");\n\t\t\t}\n\n\t\t\t// atom/keyword/BIF/function\n\t\t\tif (/[a-z_ß-öø-ÿ]/.test(ch)) {\n\t\t\t\tstream.eatWhile(anumRE);\n\n\t\t\t\tif (stream.match(/\\s*\\/\\s*[0-9]/, false)) {\n\t\t\t\t\tstream.match(/\\s*\\/\\s*[0-9]/, true);\n\t\t\t\t\treturn rval(state, stream, \"fun\"); // f/0 style fun\n\t\t\t\t}\n\n\t\t\t\tvar w = stream.current();\n\n\t\t\t\tif (is_member(w, keywordWords)) {\n\t\t\t\t\treturn rval(state, stream, \"keyword\");\n\t\t\t\t} else if (is_member(w, operatorAtomWords)) {\n\t\t\t\t\treturn rval(state, stream, \"operator\");\n\t\t\t\t} else if (stream.match(/\\s*\\(/, false)) {\n\t\t\t\t\t// 'put' and 'erlang:put' are bifs, 'foo:put' is not\n\t\t\t\t\tif (is_member(w, bifWords) &&\n\t\t\t\t\t\t\t((peekToken(state).token != \":\") ||\n\t\t\t\t\t\t\t (peekToken(state, 2).token == \"erlang\"))) {\n\t\t\t\t\t\treturn rval(state, stream, \"builtin\");\n\t\t\t\t\t} else if (is_member(w, guardWords)) {\n\t\t\t\t\t\treturn rval(state, stream, \"guard\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn rval(state, stream, \"function\");\n\t\t\t\t\t}\n\t\t\t\t} else if (lookahead(stream) == \":\") {\n\t\t\t\t\tif (w == \"erlang\") {\n\t\t\t\t\t\treturn rval(state, stream, \"builtin\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn rval(state, stream, \"function\");\n\t\t\t\t\t}\n\t\t\t\t} else if (is_member(w, [\"true\", \"false\"])) {\n\t\t\t\t\treturn rval(state, stream, \"boolean\");\n\t\t\t\t} else {\n\t\t\t\t\treturn rval(state, stream, \"atom\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// number\n\t\t\tvar digitRE = /[0-9]/;\n\t\t\tvar radixRE = /[0-9a-zA-Z]/; // 36#zZ style int\n\t\t\tif (digitRE.test(ch)) {\n\t\t\t\tstream.eatWhile(digitRE);\n\t\t\t\tif (stream.eat('#')) { // 36#aZ  style integer\n\t\t\t\t\tif (!stream.eatWhile(radixRE)) {\n\t\t\t\t\t\tstream.backUp(1); //\"36#\" - syntax error\n\t\t\t\t\t}\n\t\t\t\t} else if (stream.eat('.')) { // float\n\t\t\t\t\tif (!stream.eatWhile(digitRE)) {\n\t\t\t\t\t\tstream.backUp(1); // \"3.\" - probably end of function\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (stream.eat(/[eE]/)) { // float with exponent\n\t\t\t\t\t\t\tif (stream.eat(/[-+]/)) {\n\t\t\t\t\t\t\t\tif (!stream.eatWhile(digitRE)) {\n\t\t\t\t\t\t\t\t\tstream.backUp(2); // \"2e-\" - syntax error\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (!stream.eatWhile(digitRE)) {\n\t\t\t\t\t\t\t\t\tstream.backUp(1); // \"2e\" - syntax error\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rval(state, stream, \"number\"); // normal integer\n\t\t\t}\n\n\t\t\t// open parens\n\t\t\tif (nongreedy(stream, openParenRE, openParenWords)) {\n\t\t\t\treturn rval(state, stream, \"open_paren\");\n\t\t\t}\n\n\t\t\t// close parens\n\t\t\tif (nongreedy(stream, closeParenRE, closeParenWords)) {\n\t\t\t\treturn rval(state, stream, \"close_paren\");\n\t\t\t}\n\n\t\t\t// separators\n\t\t\tif (greedy(stream, separatorRE, separatorWords)) {\n\t\t\t\treturn rval(state, stream, \"separator\");\n\t\t\t}\n\n\t\t\t// operators\n\t\t\tif (greedy(stream, operatorSymbolRE, operatorSymbolWords)) {\n\t\t\t\treturn rval(state, stream, \"operator\");\n\t\t\t}\n\n\t\t\treturn rval(state, stream, null);\n\t\t}\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// utilities\n\n\t\tfunction nongreedy(stream, re, words) {\n\t\t\tif (stream.current().length == 1 && re.test(stream.current())) {\n\t\t\t\tstream.backUp(1);\n\t\t\t\twhile (re.test(stream.peek())) {\n\t\t\t\t\tstream.next();\n\t\t\t\t\tif (is_member(stream.current(), words)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstream.backUp(stream.current().length - 1);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction greedy(stream, re, words) {\n\t\t\tif (stream.current().length == 1 && re.test(stream.current())) {\n\t\t\t\twhile (re.test(stream.peek())) {\n\t\t\t\t\tstream.next();\n\t\t\t\t}\n\t\t\t\twhile (0 < stream.current().length) {\n\t\t\t\t\tif (is_member(stream.current(), words)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstream.next();\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction doubleQuote(stream) {\n\t\t\treturn quote(stream, '\"', '\\\\');\n\t\t}\n\n\t\tfunction singleQuote(stream) {\n\t\t\treturn quote(stream, '\\'', '\\\\');\n\t\t}\n\n\t\tfunction quote(stream, quoteChar, escapeChar) {\n\t\t\twhile (!stream.eol()) {\n\t\t\t\tvar ch = stream.next();\n\t\t\t\tif (ch == quoteChar) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (ch == escapeChar) {\n\t\t\t\t\tstream.next();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction lookahead(stream) {\n\t\t\tvar m = stream.match(/([\\n\\s]+|%[^\\n]*\\n)*(.)/, false);\n\t\t\treturn m ? m.pop() : \"\";\n\t\t}\n\n\t\tfunction is_member(element, list) {\n\t\t\treturn (-1 < list.indexOf(element));\n\t\t}\n\n\t\tfunction rval(state, stream, type) {\n\n\t\t\t// parse stack\n\t\t\tpushToken(state, realToken(type, stream));\n\n\t\t\t// map erlang token type to CodeMirror style class\n\t\t\t//     erlang             -> CodeMirror tag\n\t\t\tswitch (type) {\n\t\t\t\tcase \"atom\":\n\t\t\t\t\treturn \"atom\";\n\t\t\t\tcase \"attribute\":\n\t\t\t\t\treturn \"attribute\";\n\t\t\t\tcase \"boolean\":\n\t\t\t\t\treturn \"atom\";\n\t\t\t\tcase \"builtin\":\n\t\t\t\t\treturn \"builtin\";\n\t\t\t\tcase \"close_paren\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"colon\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"comment\":\n\t\t\t\t\treturn \"comment\";\n\t\t\t\tcase \"dot\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"error\":\n\t\t\t\t\treturn \"error\";\n\t\t\t\tcase \"fun\":\n\t\t\t\t\treturn \"meta\";\n\t\t\t\tcase \"function\":\n\t\t\t\t\treturn \"tag\";\n\t\t\t\tcase \"guard\":\n\t\t\t\t\treturn \"property\";\n\t\t\t\tcase \"keyword\":\n\t\t\t\t\treturn \"keyword\";\n\t\t\t\tcase \"macro\":\n\t\t\t\t\treturn \"variable-2\";\n\t\t\t\tcase \"number\":\n\t\t\t\t\treturn \"number\";\n\t\t\t\tcase \"open_paren\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"operator\":\n\t\t\t\t\treturn \"operator\";\n\t\t\t\tcase \"record\":\n\t\t\t\t\treturn \"bracket\";\n\t\t\t\tcase \"separator\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"string\":\n\t\t\t\t\treturn \"string\";\n\t\t\t\tcase \"type\":\n\t\t\t\t\treturn \"def\";\n\t\t\t\tcase \"variable\":\n\t\t\t\t\treturn \"variable\";\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction aToken(tok, col, ind, typ) {\n\t\t\treturn {\n\t\t\t\ttoken: tok,\n\t\t\t\tcolumn: col,\n\t\t\t\tindent: ind,\n\t\t\t\ttype: typ\n\t\t\t};\n\t\t}\n\n\t\tfunction realToken(type, stream) {\n\t\t\treturn aToken(stream.current(),\n\t\t\t\t\t\t\t\t\t\tstream.column(),\n\t\t\t\t\t\t\t\t\t\tstream.indentation(),\n\t\t\t\t\t\t\t\t\t\ttype);\n\t\t}\n\n\t\tfunction fakeToken(type) {\n\t\t\treturn aToken(type, 0, 0, type);\n\t\t}\n\n\t\tfunction peekToken(state, depth) {\n\t\t\tvar len = state.tokenStack.length;\n\t\t\tvar dep = (depth ? depth : 1);\n\n\t\t\tif (len < dep) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn state.tokenStack[len - dep];\n\t\t\t}\n\t\t}\n\n\t\tfunction pushToken(state, token) {\n\n\t\t\tif (!(token.type == \"comment\" || token.type == \"whitespace\")) {\n\t\t\t\tstate.tokenStack = maybe_drop_pre(state.tokenStack, token);\n\t\t\t\tstate.tokenStack = maybe_drop_post(state.tokenStack);\n\t\t\t}\n\t\t}\n\n\t\tfunction maybe_drop_pre(s, token) {\n\t\t\tvar last = s.length - 1;\n\n\t\t\tif (0 < last && s[last].type === \"record\" && token.type === \"dot\") {\n\t\t\t\ts.pop();\n\t\t\t} else if (0 < last && s[last].type === \"group\") {\n\t\t\t\ts.pop();\n\t\t\t\ts.push(token);\n\t\t\t} else {\n\t\t\t\ts.push(token);\n\t\t\t}\n\t\t\treturn s;\n\t\t}\n\n\t\tfunction maybe_drop_post(s) {\n\t\t\tvar last = s.length - 1;\n\n\t\t\tif (s[last].type === \"dot\") {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tif (s[last].type === \"fun\" && s[last - 1].token === \"fun\") {\n\t\t\t\treturn s.slice(0, last - 1);\n\t\t\t}\n\t\t\tswitch (s[s.length - 1].token) {\n\t\t\t\tcase \"}\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\tg: [\"{\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"]\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"[\"]\n\t\t\t\t\t});\n\t\t\t\tcase \")\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"(\"]\n\t\t\t\t\t});\n\t\t\t\tcase \">>\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"<<\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"end\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"begin\", \"case\", \"fun\", \"if\", \"receive\", \"try\"]\n\t\t\t\t\t});\n\t\t\t\tcase \",\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"begin\", \"try\", \"when\", \"->\",\n\t\t\t\t\t\t\t\t\",\", \"(\", \"[\", \"{\", \"<<\"\n\t\t\t\t\t\t\t ]\n\t\t\t\t\t});\n\t\t\t\tcase \"->\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\tr: [\"when\"],\n\t\t\t\t\t\tm: [\"try\", \"if\", \"case\", \"receive\"]\n\t\t\t\t\t});\n\t\t\t\tcase \";\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\tE: [\"case\", \"fun\", \"if\", \"receive\", \"try\", \"when\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"catch\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"try\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"of\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"case\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"after\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"receive\", \"try\"]\n\t\t\t\t\t});\n\t\t\t\tdefault:\n\t\t\t\t\treturn s;\n\t\t\t}\n\t\t}\n\n\t\tfunction d(stack, tt) {\n\t\t\t// stack is a stack of Token objects.\n\t\t\t// tt is an object; {type:tokens}\n\t\t\t// type is a char, tokens is a list of token strings.\n\t\t\t// The function returns (possibly truncated) stack.\n\t\t\t// It will descend the stack, looking for a Token such that Token.token\n\t\t\t//  is a member of tokens. If it does not find that, it will normally (but\n\t\t\t//  see \"E\" below) return stack. If it does find a match, it will remove\n\t\t\t//  all the Tokens between the top and the matched Token.\n\t\t\t// If type is \"m\", that is all it does.\n\t\t\t// If type is \"i\", it will also remove the matched Token and the top Token.\n\t\t\t// If type is \"g\", like \"i\", but add a fake \"group\" token at the top.\n\t\t\t// If type is \"r\", it will remove the matched Token, but not the top Token.\n\t\t\t// If type is \"e\", it will keep the matched Token but not the top Token.\n\t\t\t// If type is \"E\", it behaves as for type \"e\", except if there is no match,\n\t\t\t//  in which case it will return an empty stack.\n\n\t\t\tfor (var type in tt) {\n\t\t\t\tvar len = stack.length - 1;\n\t\t\t\tvar tokens = tt[type];\n\t\t\t\tfor (var i = len - 1; - 1 < i; i--) {\n\t\t\t\t\tif (is_member(stack[i].token, tokens)) {\n\t\t\t\t\t\tvar ss = stack.slice(0, i);\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase \"m\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[i]).concat(stack[len]);\n\t\t\t\t\t\t\tcase \"r\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[len]);\n\t\t\t\t\t\t\tcase \"i\":\n\t\t\t\t\t\t\t\treturn ss;\n\t\t\t\t\t\t\tcase \"g\":\n\t\t\t\t\t\t\t\treturn ss.concat(fakeToken(\"group\"));\n\t\t\t\t\t\t\tcase \"E\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[i]);\n\t\t\t\t\t\t\tcase \"e\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (type == \"E\" ? [] : stack);\n\t\t}\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// indenter\n\n\t\tfunction indenter(state, textAfter) {\n\t\t\tvar t;\n\t\t\tvar unit = cmCfg.indentUnit;\n\t\t\tvar wordAfter = wordafter(textAfter);\n\t\t\tvar currT = peekToken(state, 1);\n\t\t\tvar prevT = peekToken(state, 2);\n\n\t\t\tif (state.in_string || state.in_atom) {\n\t\t\t\treturn CodeMirror.Pass;\n\t\t\t} else if (!prevT) {\n\t\t\t\treturn 0;\n\t\t\t} else if (currT.token == \"when\") {\n\t\t\t\treturn currT.column + unit;\n\t\t\t} else if (wordAfter === \"when\" && prevT.type === \"function\") {\n\t\t\t\treturn prevT.indent + unit;\n\t\t\t} else if (wordAfter === \"(\" && currT.token === \"fun\") {\n\t\t\t\treturn currT.column + 3;\n\t\t\t} else if (wordAfter === \"catch\" && (t = getToken(state, [\"try\"]))) {\n\t\t\t\treturn t.column;\n\t\t\t} else if (is_member(wordAfter, [\"end\", \"after\", \"of\"])) {\n\t\t\t\tt = getToken(state, [\"begin\", \"case\", \"fun\", \"if\", \"receive\", \"try\"]);\n\t\t\t\treturn t ? t.column : CodeMirror.Pass;\n\t\t\t} else if (is_member(wordAfter, closeParenWords)) {\n\t\t\t\tt = getToken(state, openParenWords);\n\t\t\t\treturn t ? t.column : CodeMirror.Pass;\n\t\t\t} else if (is_member(currT.token, [\",\", \"|\", \"||\"]) ||\n\t\t\t\t\t\t\t\t is_member(wordAfter, [\",\", \"|\", \"||\"])) {\n\t\t\t\tt = postcommaToken(state);\n\t\t\t\treturn t ? t.column + t.token.length : unit;\n\t\t\t} else if (currT.token == \"->\") {\n\t\t\t\tif (is_member(prevT.token, [\"receive\", \"case\", \"if\", \"try\"])) {\n\t\t\t\t\treturn prevT.column + unit + unit;\n\t\t\t\t} else {\n\t\t\t\t\treturn prevT.column + unit;\n\t\t\t\t}\n\t\t\t} else if (is_member(currT.token, openParenWords)) {\n\t\t\t\treturn currT.column + currT.token.length;\n\t\t\t} else {\n\t\t\t\tt = defaultToken(state);\n\t\t\t\treturn truthy(t) ? t.column + unit : 0;\n\t\t\t}\n\t\t}\n\n\t\tfunction wordafter(str) {\n\t\t\tvar m = str.match(/,|[a-z]+|\\}|\\]|\\)|>>|\\|+|\\(/);\n\n\t\t\treturn truthy(m) && (m.index === 0) ? m[0] : \"\";\n\t\t}\n\n\t\tfunction postcommaToken(state) {\n\t\t\tvar objs = state.tokenStack.slice(0, -1);\n\t\t\tvar i = getTokenIndex(objs, \"type\", [\"open_paren\"]);\n\n\t\t\treturn truthy(objs[i]) ? objs[i] : false;\n\t\t}\n\n\t\tfunction defaultToken(state) {\n\t\t\tvar objs = state.tokenStack;\n\t\t\tvar stop = getTokenIndex(objs, \"type\", [\"open_paren\", \"separator\", \"keyword\"]);\n\t\t\tvar oper = getTokenIndex(objs, \"type\", [\"operator\"]);\n\n\t\t\tif (truthy(stop) && truthy(oper) && stop < oper) {\n\t\t\t\treturn objs[stop + 1];\n\t\t\t} else if (truthy(stop)) {\n\t\t\t\treturn objs[stop];\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction getToken(state, tokens) {\n\t\t\tvar objs = state.tokenStack;\n\t\t\tvar i = getTokenIndex(objs, \"token\", tokens);\n\n\t\t\treturn truthy(objs[i]) ? objs[i] : false;\n\t\t}\n\n\t\tfunction getTokenIndex(objs, propname, propvals) {\n\n\t\t\tfor (var i = objs.length - 1; - 1 < i; i--) {\n\t\t\t\tif (is_member(objs[i][propname], propvals)) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction truthy(x) {\n\t\t\treturn (x !== false) && (x != null);\n\t\t}\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// this object defines the mode\n\n\t\treturn {\n\t\t\tstartState: function() {\n\t\t\t\treturn {\n\t\t\t\t\ttokenStack: [],\n\t\t\t\t\tin_string: false,\n\t\t\t\t\tin_atom: false\n\t\t\t\t};\n\t\t\t},\n\n\t\t\ttoken: function(stream, state) {\n\t\t\t\treturn tokenizer(stream, state);\n\t\t\t},\n\n\t\t\tindent: function(state, textAfter) {\n\t\t\t\treturn indenter(state, textAfter);\n\t\t\t},\n\n\t\t\tlineComment: \"%\"\n\t\t};\n\t});\n\n}","Highlighter": "function (CodeMirror) {\n\n  // https://codemirror.net/addon/selection/mark-selection.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Because sometimes you need to mark the selected *text*.\n  //\n  // Adds an option 'styleSelectedText' which, when enabled, gives\n  // selected text the CSS class given as option value, or\n  // \"CodeMirror-selectedtext\" when the value is not a string.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineOption(\"styleSelectedText\", false, function(cm, val, old) {\n      var prev = old && old != CodeMirror.Init;\n      if (val && !prev) {\n        cm.state.markedSelection = [];\n        cm.state.markedSelectionStyle = typeof val == \"string\" ? val : \"CodeMirror-selectedtext\";\n        reset(cm);\n        cm.on(\"cursorActivity\", onCursorActivity);\n        cm.on(\"change\", onChange);\n      } else if (!val && prev) {\n        cm.off(\"cursorActivity\", onCursorActivity);\n        cm.off(\"change\", onChange);\n        clear(cm);\n        cm.state.markedSelection = cm.state.markedSelectionStyle = null;\n      }\n    });\n\n    function onCursorActivity(cm) {\n      if (cm.state.markedSelection)\n        cm.operation(function() {\n          update(cm);\n        });\n    }\n\n    function onChange(cm) {\n      if (cm.state.markedSelection && cm.state.markedSelection.length)\n        cm.operation(function() {\n          clear(cm);\n        });\n    }\n\n    var CHUNK_SIZE = 8;\n    var Pos = CodeMirror.Pos;\n    var cmp = CodeMirror.cmpPos;\n\n    function coverRange(cm, from, to, addAt) {\n      if (cmp(from, to) == 0) return;\n      var array = cm.state.markedSelection;\n      var cls = cm.state.markedSelectionStyle;\n      for (var line = from.line;;) {\n        var start = line == from.line ? from : Pos(line, 0);\n        var endLine = line + CHUNK_SIZE,\n            atEnd = endLine >= to.line;\n        var end = atEnd ? to : Pos(endLine, 0);\n        var mark = cm.markText(start, end, {\n          className: cls\n        });\n        if (addAt == null) array.push(mark);\n        else array.splice(addAt++, 0, mark);\n        if (atEnd) break;\n        line = endLine;\n      }\n    }\n\n    function clear(cm) {\n      var array = cm.state.markedSelection;\n      for (var i = 0; i < array.length; ++i) array[i].clear();\n      array.length = 0;\n    }\n\n    function reset(cm) {\n      clear(cm);\n      var ranges = cm.listSelections();\n      for (var i = 0; i < ranges.length; i++)\n        coverRange(cm, ranges[i].from(), ranges[i].to());\n    }\n\n    function update(cm) {\n      if (!cm.somethingSelected()) return clear(cm);\n      if (cm.listSelections().length > 1) return reset(cm);\n\n      var from = cm.getCursor(\"start\"),\n          to = cm.getCursor(\"end\");\n\n      var array = cm.state.markedSelection;\n      if (!array.length) return coverRange(cm, from, to);\n\n      var coverStart = array[0].find(),\n          coverEnd = array[array.length - 1].find();\n      if (!coverStart || !coverEnd || to.line - from.line <= CHUNK_SIZE ||\n          cmp(from, coverEnd.to) >= 0 || cmp(to, coverStart.from) <= 0)\n        return reset(cm);\n\n      while (cmp(from, coverStart.from) > 0) {\n        array.shift().clear();\n        coverStart = array[0].find();\n      }\n      if (cmp(from, coverStart.from) < 0) {\n        if (coverStart.to.line - from.line < CHUNK_SIZE) {\n          array.shift().clear();\n          coverRange(cm, from, coverStart.to, 0);\n        } else {\n          coverRange(cm, from, coverStart.from, 0);\n        }\n      }\n\n      while (cmp(to, coverEnd.to) < 0) {\n        array.pop().clear();\n        coverEnd = array[array.length - 1].find();\n      }\n      if (cmp(to, coverEnd.to) > 0) {\n        if (to.line - coverEnd.from.line < CHUNK_SIZE) {\n          array.pop().clear();\n          coverRange(cm, coverEnd.from, to);\n        } else {\n          coverRange(cm, coverEnd.to, to);\n        }\n      }\n    }\n  });\n\n  //===================================================\n\n  // https://codemirror.net/addon/scroll/annotatescrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"annotateScrollbar\", function(options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      return new Annotation(this, options);\n    });\n\n    CodeMirror.defineOption(\"scrollButtonHeight\", 0);\n\n    function Annotation(cm, options) {\n      this.cm = cm;\n      this.options = options;\n      this.buttonHeight = options.scrollButtonHeight || cm.getOption(\"scrollButtonHeight\");\n      this.annotations = [];\n      this.doRedraw = this.doUpdate = null;\n      this.div = cm.getWrapperElement().appendChild(document.createElement(\"div\"));\n      this.div.style.cssText = \"position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none\";\n      this.computeScale();\n\n      function scheduleRedraw(delay) {\n        clearTimeout(self.doRedraw);\n        self.doRedraw = setTimeout(function() {\n          self.redraw();\n        }, delay);\n      }\n\n      var self = this;\n      cm.on(\"refresh\", this.resizeHandler = function() {\n        clearTimeout(self.doUpdate);\n        self.doUpdate = setTimeout(function() {\n          if (self.computeScale()) scheduleRedraw(20);\n        }, 100);\n      });\n      cm.on(\"markerAdded\", this.resizeHandler);\n      cm.on(\"markerCleared\", this.resizeHandler);\n      if (options.listenForChanges !== false)\n        cm.on(\"change\", this.changeHandler = function() {\n          scheduleRedraw(250);\n        });\n    }\n\n    Annotation.prototype.computeScale = function() {\n      var cm = this.cm;\n      var hScale = (cm.getWrapperElement().clientHeight - cm.display.barHeight - this.buttonHeight * 2) /\n          cm.getScrollerElement().scrollHeight\n      if (hScale != this.hScale) {\n        this.hScale = hScale;\n        return true;\n      }\n    };\n\n    Annotation.prototype.update = function(annotations) {\n      this.annotations = annotations;\n      this.redraw();\n    };\n\n    Annotation.prototype.redraw = function(compute) {\n      if (compute !== false) this.computeScale();\n      var cm = this.cm,\n          hScale = this.hScale;\n\n      var frag = document.createDocumentFragment(),\n          anns = this.annotations;\n\n      var wrapping = cm.getOption(\"lineWrapping\");\n      var singleLineH = wrapping && cm.defaultTextHeight() * 1.5;\n      var curLine = null,\n          curLineObj = null;\n\n      function getY(pos, top) {\n        if (curLine != pos.line) {\n          curLine = pos.line;\n          curLineObj = cm.getLineHandle(curLine);\n        }\n        if ((curLineObj.widgets && curLineObj.widgets.length) ||\n            (wrapping && curLineObj.height > singleLineH))\n          return cm.charCoords(pos, \"local\")[top ? \"top\" : \"bottom\"];\n        var topY = cm.heightAtLine(curLineObj, \"local\");\n        return topY + (top ? 0 : curLineObj.height);\n      }\n\n      var lastLine = cm.lastLine()\n      if (cm.display.barWidth)\n        for (var i = 0, nextTop; i < anns.length; i++) {\n          var ann = anns[i];\n          if (ann.to.line > lastLine) continue;\n          var top = nextTop || getY(ann.from, true) * hScale;\n          var bottom = getY(ann.to, false) * hScale;\n          while (i < anns.length - 1) {\n            if (anns[i + 1].to.line > lastLine) break;\n            nextTop = getY(anns[i + 1].from, true) * hScale;\n            if (nextTop > bottom + .9) break;\n            ann = anns[++i];\n            bottom = getY(ann.to, false) * hScale;\n          }\n          if (bottom == top) continue;\n          var height = Math.max(bottom - top, 3);\n\n          var elt = frag.appendChild(document.createElement(\"div\"));\n          elt.style.cssText = \"position: absolute; right: 0px; width: \" + Math.max(cm.display.barWidth - 1, 2) + \"px; top: \" + (top + this.buttonHeight) + \"px; height: \" + height + \"px\";\n          elt.className = this.options.className;\n          if (ann.id) {\n            elt.setAttribute(\"annotation-id\", ann.id);\n          }\n        }\n      this.div.textContent = \"\";\n      this.div.appendChild(frag);\n    };\n\n    Annotation.prototype.clear = function() {\n      this.cm.off(\"refresh\", this.resizeHandler);\n      this.cm.off(\"markerAdded\", this.resizeHandler);\n      this.cm.off(\"markerCleared\", this.resizeHandler);\n      if (this.changeHandler) this.cm.off(\"change\", this.changeHandler);\n      this.div.parentNode.removeChild(this.div);\n    };\n  });\n\n\n\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/matchesonscrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"showMatchesOnScrollbar\", function(query, caseFold, options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      if (!options) options = {};\n      return new SearchAnnotation(this, query, caseFold, options);\n    });\n\n    function SearchAnnotation(cm, query, caseFold, options) {\n      this.cm = cm;\n      this.options = options;\n      var annotateOptions = {\n        listenForChanges: false\n      };\n      for (var prop in options) annotateOptions[prop] = options[prop];\n      if (!annotateOptions.className) annotateOptions.className = \"CodeMirror-search-match\";\n      this.annotation = cm.annotateScrollbar(annotateOptions);\n      this.query = query;\n      this.caseFold = caseFold;\n      this.gap = {\n        from: cm.firstLine(),\n        to: cm.lastLine() + 1\n      };\n      this.matches = [];\n      this.update = null;\n\n      this.findMatches();\n      this.annotation.update(this.matches);\n\n      var self = this;\n      cm.on(\"change\", this.changeHandler = function(_cm, change) {\n        self.onChange(change);\n      });\n    }\n\n    var MAX_MATCHES = 1000;\n\n    SearchAnnotation.prototype.findMatches = function() {\n      if (!this.gap) return;\n      for (var i = 0; i < this.matches.length; i++) {\n        var match = this.matches[i];\n        if (match.from.line >= this.gap.to) break;\n        if (match.to.line >= this.gap.from) this.matches.splice(i--, 1);\n      }\n      var cursor = this.cm.getSearchCursor(this.query, CodeMirror.Pos(this.gap.from, 0), this.caseFold);\n      var maxMatches = this.options && this.options.maxMatches || MAX_MATCHES;\n      while (cursor.findNext()) {\n        var match = {\n          from: cursor.from(),\n          to: cursor.to()\n        };\n        if (match.from.line >= this.gap.to) break;\n        this.matches.splice(i++, 0, match);\n        if (this.matches.length > maxMatches) break;\n      }\n      this.gap = null;\n    };\n\n    function offsetLine(line, changeStart, sizeChange) {\n      if (line <= changeStart) return line;\n      return Math.max(changeStart, line + sizeChange);\n    }\n\n    SearchAnnotation.prototype.onChange = function(change) {\n      var startLine = change.from.line;\n      var endLine = CodeMirror.changeEnd(change).line;\n      var sizeChange = endLine - change.to.line;\n      if (this.gap) {\n        this.gap.from = Math.min(offsetLine(this.gap.from, startLine, sizeChange), change.from.line);\n        this.gap.to = Math.max(offsetLine(this.gap.to, startLine, sizeChange), change.from.line);\n      } else {\n        this.gap = {\n          from: change.from.line,\n          to: endLine + 1\n        };\n      }\n\n      if (sizeChange)\n        for (var i = 0; i < this.matches.length; i++) {\n          var match = this.matches[i];\n          var newFrom = offsetLine(match.from.line, startLine, sizeChange);\n          if (newFrom != match.from.line) match.from = CodeMirror.Pos(newFrom, match.from.ch);\n          var newTo = offsetLine(match.to.line, startLine, sizeChange);\n          if (newTo != match.to.line) match.to = CodeMirror.Pos(newTo, match.to.ch);\n        }\n      clearTimeout(this.update);\n      var self = this;\n      this.update = setTimeout(function() {\n        self.updateAfterChange();\n      }, 250);\n    };\n\n    SearchAnnotation.prototype.updateAfterChange = function() {\n      this.findMatches();\n      this.annotation.update(this.matches);\n    };\n\n    SearchAnnotation.prototype.clear = function() {\n      this.cm.off(\"change\", this.changeHandler);\n      this.annotation.clear();\n    };\n  });\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/searchcursor.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror)\n  })(function(CodeMirror) {\n    \"use strict\"\n    var Pos = CodeMirror.Pos\n\n    function regexpFlags(regexp) {\n      var flags = regexp.flags\n      return flags != null ? flags : (regexp.ignoreCase ? \"i\" : \"\") + (regexp.global ? \"g\" : \"\") + (regexp.multiline ? \"m\" : \"\")\n    }\n\n    function ensureFlags(regexp, flags) {\n      var current = regexpFlags(regexp),\n          target = current\n      for (var i = 0; i < flags.length; i++)\n        if (target.indexOf(flags.charAt(i)) == -1)\n          target += flags.charAt(i)\n          return current == target ? regexp : new RegExp(regexp.source, target)\n    }\n\n    function maybeMultiline(regexp) {\n      return /\\\\s|\\\\n|\\n|\\\\W|\\\\D|\\[\\^/.test(regexp.source)\n    }\n\n    function searchRegexpForward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {\n        regexp.lastIndex = ch\n        var string = doc.getLine(line),\n            match = regexp.exec(string)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpForwardMultiline(doc, regexp, start) {\n      if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)\n\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, last = doc.lastLine(); line <= last;) {\n        // This grows the search buffer in exponentially-sized chunks\n        // between matches, so that nearby matches are fast and don't\n        // require concatenating the whole document (in case we're\n        // searching for something that has tons of matches), but at the\n        // same time, the amount of retries is limited.\n        for (var i = 0; i < chunk; i++) {\n          if (line > last) break\n          var curLine = doc.getLine(line++)\n          string = string == null ? curLine : string + \"\\n\" + curLine\n        }\n        chunk = chunk * 2\n        regexp.lastIndex = start.ch\n        var match = regexp.exec(string)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = start.line + before.length - 1,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    function lastMatchIn(string, regexp) {\n      var cutOff = 0,\n          match\n      for (;;) {\n        regexp.lastIndex = cutOff\n        var newMatch = regexp.exec(string)\n        if (!newMatch) return match\n        match = newMatch\n        cutOff = match.index + (match[0].length || 1)\n        if (cutOff == string.length) return match\n          }\n    }\n\n    function searchRegexpBackward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {\n        var string = doc.getLine(line)\n        if (ch > -1) string = string.slice(0, ch)\n        var match = lastMatchIn(string, regexp)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpBackwardMultiline(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, first = doc.firstLine(); line >= first;) {\n        for (var i = 0; i < chunk; i++) {\n          var curLine = doc.getLine(line--)\n          string = string == null ? curLine.slice(0, start.ch) : curLine + \"\\n\" + string\n        }\n        chunk *= 2\n\n        var match = lastMatchIn(string, regexp)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = line + before.length,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    var doFold, noFold\n    if (String.prototype.normalize) {\n      doFold = function(str) {\n        return str.normalize(\"NFD\").toLowerCase()\n      }\n      noFold = function(str) {\n        return str.normalize(\"NFD\")\n      }\n    } else {\n      doFold = function(str) {\n        return str.toLowerCase()\n      }\n      noFold = function(str) {\n        return str\n      }\n    }\n\n    // Maps a position in a case-folded line back to a position in the original line\n    // (compensating for codepoints increasing in number during folding)\n\n    function adjustPos(orig, folded, pos, foldFunc) {\n      if (orig.length == folded.length) return pos\n      for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {\n        if (min == max) return min\n        var mid = (min + max) >> 1\n        var len = foldFunc(orig.slice(0, mid)).length\n        if (len == pos) return mid\n        else if (len > pos) max = mid\n        else min = mid + 1\n          }\n    }\n\n    function searchStringForward(doc, query, start, caseFold) {\n      // Empty string would match anything and never progress, so we\n      // define it to match nothing instead.\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {\n        var orig = doc.getLine(line).slice(ch),\n            string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.indexOf(lines[0])\n          if (found == -1) continue search\n          var start = adjustPos(orig, string, found, fold) + ch\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold) + ch),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)\n          }\n        } else {\n          var cutFrom = string.length - lines[0].length\n          if (string.slice(cutFrom) != lines[0]) continue search\n          for (var i = 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(line + i)) != lines[i]) continue search\n            var end = doc.getLine(line + lines.length - 1),\n                endString = fold(end),\n                lastLine = lines[lines.length - 1]\n            if (endString.slice(0, lastLine.length) != lastLine) continue search\n            return {\n              from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),\n              to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function searchStringBackward(doc, query, start, caseFold) {\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {\n        var orig = doc.getLine(line)\n        if (ch > -1) orig = orig.slice(0, ch)\n        var string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.lastIndexOf(lines[0])\n          if (found == -1) continue search\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold)),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))\n          }\n        } else {\n          var lastLine = lines[lines.length - 1]\n          if (string.slice(0, lastLine.length) != lastLine) continue search\n          for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(start + i)) != lines[i]) continue search\n            var top = doc.getLine(line + 1 - lines.length),\n                topString = fold(top)\n            if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search\n            return {\n              from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),\n              to: Pos(line, adjustPos(orig, string, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function SearchCursor(doc, query, pos, options) {\n      this.atOccurrence = false\n      this.doc = doc\n      pos = pos ? doc.clipPos(pos) : Pos(0, 0)\n      this.pos = {\n        from: pos,\n        to: pos\n      }\n\n      var caseFold\n      if (typeof options == \"object\") {\n        caseFold = options.caseFold\n      } else { // Backwards compat for when caseFold was the 4th argument\n        caseFold = options\n        options = null\n      }\n\n      if (typeof query == \"string\") {\n        if (caseFold == null) caseFold = false\n        this.matches = function(reverse, pos) {\n          return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)\n        }\n      } else {\n        query = ensureFlags(query, \"gm\")\n        if (!options || options.multiline !== false)\n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)\n          }; \n        else \n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)\n          };\n      }\n    }\n\n    SearchCursor.prototype = {\n      findNext: function() {\n        return this.find(false)\n      },\n      findPrevious: function() {\n        return this.find(true)\n      },\n\n      find: function(reverse) {\n        var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))\n\n        // Implements weird auto-growing behavior on null-matches for\n        // backwards-compatiblity with the vim code (unfortunately)\n        while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {\n          if (reverse) {\n            if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)\n            else if (result.from.line == this.doc.firstLine()) result = null\n            else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))\n              } else {\n                if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)\n                else if (result.to.line == this.doc.lastLine()) result = null\n                else result = this.matches(reverse, Pos(result.to.line + 1, 0))\n                  }\n        }\n\n        if (result) {\n          this.pos = result\n          this.atOccurrence = true\n          return this.pos.match || true\n        } else {\n          var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)\n          this.pos = {\n            from: end,\n            to: end\n          }\n          return this.atOccurrence = false\n        }\n      },\n\n      from: function() {\n        if (this.atOccurrence) return this.pos.from\n          },\n      to: function() {\n        if (this.atOccurrence) return this.pos.to\n          },\n\n      replace: function(newText, origin) {\n        if (!this.atOccurrence) return\n        var lines = CodeMirror.splitLines(newText)\n        this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)\n        this.pos.to = Pos(this.pos.from.line + lines.length - 1,\n                          lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))\n      }\n    }\n\n    CodeMirror.defineExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this.doc, query, pos, caseFold)\n    })\n    CodeMirror.defineDocExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this, query, pos, caseFold)\n    })\n\n    CodeMirror.defineExtension(\"selectMatches\", function(query, caseFold) {\n      var ranges = []\n      var cur = this.getSearchCursor(query, this.getCursor(\"from\"), caseFold)\n      while (cur.findNext()) {\n        if (CodeMirror.cmpPos(cur.to(), this.getCursor(\"to\")) > 0) break\n        ranges.push({\n          anchor: cur.from(),\n          head: cur.to()\n        })\n          }\n      if (ranges.length)\n        this.setSelections(ranges, 0)\n        })\n  });\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/match-highlighter.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Highlighting text that matches the selection\n  //\n  // Defines an option highlightSelectionMatches, which, when enabled,\n  // will style strings that match the selection throughout the\n  // document.\n  //\n  // The option can be set to true to simply enable it, or to a\n  // {minChars, style, wordsOnly, showToken, delay} object to explicitly\n  // configure it. minChars is the minimum amount of characters that should be\n  // selected for the behavior to occur, and style is the token style to\n  // apply to the matches. This will be prefixed by \"cm-\" to create an\n  // actual CSS class name. If wordsOnly is enabled, the matches will be\n  // highlighted only if the selected text is a word. showToken, when enabled,\n  // will cause the current token to be highlighted when nothing is selected.\n  // delay is used to specify how much time to wait, in milliseconds, before\n  // highlighting the matches. If annotateScrollbar is enabled, the occurences\n  // will be highlighted on the scrollbar via the matchesonscrollbar addon.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    var defaults = {\n      style: \"matchhighlight\",\n      minChars: 2,\n      maxChars: 200,\n      delay: 100,\n      wordsOnly: false,\n      annotateScrollbar: false,\n      showToken: false,\n      trim: true\n    }\n\n    function State(options) {\n      this.options = {}\n      for (var name in defaults)\n        this.options[name] = (options && options.hasOwnProperty(name) ? options : defaults)[name]\n        this.overlay = this.timeout = null;\n      this.matchesonscroll = null;\n      this.active = false;\n    }\n\n    CodeMirror.defineOption(\"highlightSelectionMatches\", false, function(cm, val, old) {\n      if (old && old != CodeMirror.Init) {\n        removeOverlay(cm);\n        clearTimeout(cm.state.matchHighlighter.timeout);\n        cm.state.matchHighlighter = null;\n        cm.off(\"cursorActivity\", cursorActivity);\n        cm.off(\"focus\", onFocus)\n      }\n      if (val) {\n        var state = cm.state.matchHighlighter = new State(val);\n        if (cm.hasFocus()) {\n          state.active = true\n          highlightMatches(cm)\n        } else {\n          cm.on(\"focus\", onFocus)\n        }\n        cm.on(\"cursorActivity\", cursorActivity);\n      }\n    });\n\n    function cursorActivity(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.active || cm.hasFocus()) scheduleHighlight(cm, state)\n        }\n\n    function onFocus(cm) {\n      var state = cm.state.matchHighlighter\n      if (!state.active) {\n        state.active = true\n        scheduleHighlight(cm, state)\n      }\n    }\n\n    function scheduleHighlight(cm, state) {\n      clearTimeout(state.timeout);\n      state.timeout = setTimeout(function() {\n        highlightMatches(cm);\n      }, state.options.delay);\n    }\n\n    function addOverlay(cm, query, hasBoundary, style) {\n      var state = cm.state.matchHighlighter;\n      cm.addOverlay(state.overlay = makeOverlay(query, hasBoundary, style));\n      if (state.options.annotateScrollbar && cm.showMatchesOnScrollbar) {\n        var searchFor = hasBoundary ? new RegExp(\"\\\\b\" + query.replace(/[\\\\\\[.+*?(){|^$]/g, \"\\\\$&\") + \"\\\\b\") : query;\n        state.matchesonscroll = cm.showMatchesOnScrollbar(searchFor, false, {\n          className: \"CodeMirror-selection-highlight-scrollbar\"\n        });\n      }\n    }\n\n    function removeOverlay(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.overlay) {\n        cm.removeOverlay(state.overlay);\n        state.overlay = null;\n        if (state.matchesonscroll) {\n          state.matchesonscroll.clear();\n          state.matchesonscroll = null;\n        }\n      }\n    }\n\n    function highlightMatches(cm) {\n      cm.operation(function() {\n        var state = cm.state.matchHighlighter;\n        removeOverlay(cm);\n        if (!cm.somethingSelected() && state.options.showToken) {\n          var re = state.options.showToken === true ? /[\\w$]/ : state.options.showToken;\n          var cur = cm.getCursor(),\n              line = cm.getLine(cur.line),\n              start = cur.ch,\n              end = start;\n          while (start && re.test(line.charAt(start - 1)))--start;\n          while (end < line.length && re.test(line.charAt(end)))++end;\n          if (start < end)\n            addOverlay(cm, line.slice(start, end), re, state.options.style);\n          return;\n        }\n        var from = cm.getCursor(\"from\"),\n            to = cm.getCursor(\"to\");\n        if (from.line != to.line) return;\n        if (state.options.wordsOnly && !isWord(cm, from, to)) return;\n        var selection = cm.getRange(from, to);\n        if (selection.length > state.options.maxChars) return;\n        if (state.options.trim) selection = selection.replace(/^\\s+|\\s+$/g, \"\")\n        if (selection.length >= state.options.minChars)\n          addOverlay(cm, selection, false, state.options.style);\n      });\n    }\n\n    function isWord(cm, from, to) {\n      var str = cm.getRange(from, to);\n      if (str.match(/^\\w+$/) !== null) {\n        if (from.ch > 0) {\n          var pos = {\n            line: from.line,\n            ch: from.ch - 1\n          };\n          var chr = cm.getRange(pos, from);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        if (to.ch < cm.getLine(from.line).length) {\n          var pos = {\n            line: to.line,\n            ch: to.ch + 1\n          };\n          var chr = cm.getRange(to, pos);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        return true;\n      } else return false;\n    }\n\n    function boundariesAround(stream, re) {\n      return (!stream.start || !re.test(stream.string.charAt(stream.start - 1))) &&\n        (stream.pos == stream.string.length || !re.test(stream.string.charAt(stream.pos)));\n    }\n\n    function makeOverlay(query, hasBoundary, style) {\n      return {\n        token: function(stream) {\n          if (stream.match(query) &&\n              (!hasBoundary || boundariesAround(stream, hasBoundary)))\n            return style;\n          stream.next();\n          stream.skipTo(query.charAt(0)) || stream.skipToEnd();\n        }\n      };\n    }\n  });\n}","CMoverlays": "function () {\n\n\t// Extends CM with includes {{.x.y }} syntax highlighter\n\t// and supplementary highlighting for color picker\n\t\n\tvar re_clr = /^(rgb[a]?\\s*\\([\\s0-9,\\.]+\\)|#[0-9a-fA-F]{8}|#[0-9a-fA-F]{6}|#[0-9a-fA-F]{3})/\n\n\tfunction _parseStream (stream, state) {\n\t\tvar ch, n1, n2;\n\n\t\tif (stream.match(/^\\{\\{[\\/\\.]/)) {\n\t\t\twhile ((ch = stream.next()) != null) {\n\t\t\t\tif (ch == \"}\" && stream.next() == \"}\") {\n\t\t\t\t\treturn \"include\";\n\t\t\t\t}\n\t\t\t\tif (!/[a-z0-9_\\/\\.\\-]/i.test(ch)) break;\n\t\t\t}\n\t\t} \n\t\telse if (n1 = stream.match(/^[\\[\\{\"]\\/\\*{{[\\.\\/]/)) {\n\t\t\tn2 = n1[0].to(1);\n\t\t\twhile (ch = stream.next()) {\n\t\t\t\tif (\n\t\t\t\t\tch == \"}\"  \n\t\t\t\t\t&& stream.next() == '}'\n\t\t\t\t\t&& stream.next() == '*'\n\t\t\t\t\t&& stream.next() == '/'\n\t\t\t\t\t&& stream.next() == (n2=='{'?'}':n2=='['?']':n2=='\"'?'\"':'')\n\t\t\t\t) {\n\t\t\t\t\treturn \"include\";\n\t\t\t\t}\n\t\t\t\telse if (!/[a-z0-9_\\/\\.\\-]/i.test(ch)) break;\n\t\t\t}\n\t\t} else if (stream.match(re_clr)){\n\t\t\tstream.eat(re_clr);\n\t\t\treturn \"csscolor\";\n\t\t}\n\t\twhile (\n\t\t\tstream.next() != null \n\t\t\t&& !stream.match(/^\\{\\{[\\/\\.]/, false) \n\t\t\t&& !stream.match(/^[\\[\\{\"]\\/\\*{{[\\/\\.]/, false)\n\t\t\t&& !stream.match(re_clr, false)\n\t\t) {}\n\t\treturn null;\n\t}\n\n\t// - - - - - - - - - - - - -\n\t\n\t[\n\t\t[\"ddtext\", \"text\"],\n\t\t[\"ddjs\", \"javascript\"],\n\t\t[\"ddhtml\", \"htmlmixed\"],\n\t\t[\"ddcss\", \"text/css\"],\n\t\t[\"ddless\", \"text/x-less\"],\n\t\t[\"ddmd\", \"gfm\"]\n\t].forEach(function(e){\n\t\tif (\n\t\t\t//true || \n\t\t\t!CodeMirror.modes[e[0]]\n\t\t) CodeMirror.defineMode(e[0], function(config, parserConfig) {\n\t\t\treturn CodeMirror.overlayMode(CodeMirror.getMode(config,e[1]), {token: _parseStream});\n\t\t});\n\t})\n\n}","CloseTabs": "function (mask0) {\n\t// removes tabs that matches mask,\n\t// does not redraw UI\n\t\n\tvar that = this,\n\t\t\tmask = Object.isFunction(mask0)?mask0:function(){return false},\n\t\t\td = that.data.doc,\n\t\t\tl1 = that.List.length,\n\t\t\tl2 = that.Tablist.length;\n\t\n\tthat.List.remove(mask);\n\tthat.Tablist.remove(mask);\n\t\n\tif (that.List.length != l1 || that.Tablist.length != l2) {\n\t\n\t\tif (that.Tablist[0] && that.List.indexOf(that.Tablist[0])==-1) that.List.push(that.Tablist[0]);\n\t\tif (that.List.length) that.Active = that.List[0].id;\n\t\telse {\n\t\t\tthat.Active = d.items[0].id;\n\t\t\tthat.List.push(d.items[0]);\n\t\t\tthat.Tablist.push(d.items[0]);\n\t\t}\n\t}\n}","X": {"inliner": {"html": "function (data,item,oitems) {\n\t// data is ext json of type==\"inliner\",\n\t// item is dest point, \n\t// oitems is {itemId:{item}, itemId1:{item}}\n\n\t// Can modify oitems obj –\n\t// add or remove items of type:\"attachment\".\n\t// attachment obj itself must be put into item‘s .data.\n\t// For remove appropriate key must be set to null.\n\n\t// Empty item of type:\"attachments\" –\n\t// this.Types.attachment.manifest.data\n\t// id generator – this.GenId()\n\n\t// this points to core app manifest.\n\n\t//console.log(\"Inliner2Html converter running, build 30\");\n\n\tvar that = this,\n\t\t\tatt0 = {\n\t\t\t\tid:\"\", folder:\"\", name:\"\", mime:\"\", parser:\"\", parserActive:false,\n\t\t\t\text:\"\", cache:\"864000\", data:\"\", snippet:false, size:\"?\",\n\t\t\t\ttype:\"attachment\",\n\t\t\t\tdesc:\"\", \n\t\t\t\tstate:{\n\t\t\t\t\tsavedSdbm:\"\", sdbm:\"Z\",\n\t\t\t\t\tdepends:{}, impacts:{}\n\t\t\t\t}\n\t\t\t},\n\t\t\tattKeys = Object.keys(oitems).filter(function(e){\n\t\t\t\treturn /inliner\\//.test(e);\n\t\t\t}), html = \"\",\n\t\t\tF = {\n\t\t\t\tleft1000:\"max\",\n\t\t\t\tleft750:\"wide\",\n\t\t\t\tleft500:\"medium\",\n\t\t\t\tleft300:\"small\",\n\t\t\t\tleft200:\"tiny\",\n\t\t\t\tright300:\"small-right\",\n\t\t\t\tright200:\"tiny-right\"\n\t\t\t},\n\t\t\tdocid = data._id;\n\n\t// mark unexisting appropriate items keys to null\n\tattKeys.forEach(function(id){\n\t\tif (data._id == id.split('/').last(2)[0] && !cw.lib.getref(data, \"content._stamp=\"+id.split('/').last())) {\n\t\t\toitems[id] = null;\n\t\t}\n\t});\n\n\t// get meta\n\tvar metakeys,\n\t\t\tmeta = '<meta inliner data-id=\"' + data._id + \n\t\t\t'\" data-name=\"'+(data.title||data.name||\"\").escapeHTML()+\n\t\t\t'\" data-tags=\"'+(JSON.stringify(data.tags)||\"\").escapeHTML() + '\"';\n\n\tmetakeys = data.meta && Object.isObject(data.meta)?Object.keys(data.meta):[];\n\tmetakeys.forEach(function(key){\n\t\tif (/^[a-z0-9]+$/i.test(key) \n\t\t\t\t&& !/^id$|^name$|^tags$/.test(key)) meta += ' data-' + key + '=\"' + data.meta[key].escapeHTML() + '\"';\n\t});\n\n\tmeta += '/>';\n\n\t// get html\n\tvar resrc = {};\n\tdata.content.forEach(function(elt){\n\n\t\tvar css = Object.isArray(elt.css)?elt.css:[];\n\n\t\t// add html\n\t\tif (elt.type == \"html\") {\n\t\t\tif (css.length) {\n\t\t\t\thtml+='<section class=\"'+css.map(function(e){\n\t\t\t\t\treturn \"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-');\n\t\t\t\t}).join(\" \")+'\">'\n\t\t\t}\n\t\t\thtml += elt.data;\n\t\t\tif (css.length) html+='</section>'\n\t\t\thtml+= '\\n\\n';\n\t\t\treturn;\n\t\t}\n\n\t\t// elt.format should be array\n\t\t// gen classes for sections\n\t\tvar classes = '';\n\t\tif (Object.isString(elt.format)) elt.format = [elt.format];\n\t\tif (Object.isArray(elt.format)) {\n\t\t\tclasses = elt.format.reduce(function(res,e){ \n\t\t\t\treturn res + ' in-item-' + (F[e]?F[e]:e);\n\t\t\t},'')\n\t\t}\n\t\tif (css.length) {\n\t\t\tclasses +=' '+css.map(function(e){return \"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-');}).join(\" \");\n\t\t} \n\n\t\t// add embed\n\t\tif (elt.type == \"embed\") {\n\t\t\thtml += '<figure class=\"' + classes + '\">' +\n\t\t\t\t'<section>' + elt.data + '</section>' +\n\t\t\t\t(elt.showdesc+\"\" == \"show\" ? ('<figcaption class=\"in-item-desc\">' + elt.desc + '</figcaption>') : '') +\n\t\t\t\t'</figure>' + '\\n\\n';\n\t\t}\n\n\t\t// add img\n\n\t\tif (elt.type == \"img\") {\n\t\t\t\n\t\t\tvar obj, id, file, ref;\n\t\t\t\n\t\t\t// Create item of type:\"attachment\"\n\t\t\tif (elt.ref) {\n\t\t\t\t// image is attached\n\t\t\t\tref = elt.ref.replace(\"inliner/\"+docid+\"/\",'');\n\t\t\t\tid = cw.lib.hash8(\"inliner/\" + docid +\"/\"+ref);\n\t\t\t\t\n\t\t\t\tif (data._attachments && data._attachments[elt.ref]) {\n\t\t\t\t\tfile = data._attachments[elt.ref];\n\t\t\t\t\tobj = $.extend(true, {}, att0, {\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tfolder: \"/inliner\",\n\t\t\t\t\t\tname: docid+\"/\"+ref,\n\t\t\t\t\t\tmime: file.content_type,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tcontent_type: file.content_type,\n\t\t\t\t\t\t\tdata: file.data\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstate:{\n\t\t\t\t\t\t\tcrc:cw.lib.sdbm(file.data)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\telt.ref = \"inliner/\"+ obj.name;\n\t\t\t\t} \n\t\t\t\telse {\n\t\t\t\t\tobj = $.extend(true, {}, att0, {\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tfolder: \"/inliner\",\n\t\t\t\t\t\tname: docid+\"/\"+ref,\n\t\t\t\t\t\tstate:{ crc:false }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t// image is inlined\n\t\t\t\tid = cw.lib.hash8(\"inliner/\" + docid +\"/\"+elt._stamp);\n\t\t\t\tobj = $.extend(true, {}, att0, {\n\t\t\t\t\tid: id,\n\t\t\t\t\tfolder: \"/inliner\",\n\t\t\t\t\tname: docid+\"/\"+elt._stamp+\".jpg\",\n\t\t\t\t\tmime: \"image/jpeg\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcontent_type: \"image/jpeg\",\n\t\t\t\t\t\tdata: elt.data\n\t\t\t\t\t},\n\t\t\t\t\tstate:{\n\t\t\t\t\t\tcrc:cw.lib.sdbm(elt.data)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\telt.data = \" \";\n\t\t\t\telt.ref = \"inliner/\"+ obj.name;\n\t\t\t}\n\t\t\t\n\t\t\tif (obj) {\n\t\t\t\t// put new type:\"attachment\" item into main doc\n\t\t\t\tresrc[obj.name] = obj.id;\n\t\t\t\tif (\n\t\t\t\t\t obj.state.crc && (\n\t\t\t\t\t\t!oitems[id] || \n\t\t\t\t\t\toitems[id].state.crc != obj.state.crc\n\t\t\t\t\t )\n\t\t\t\t) oitems[id] = obj;\n\t\t\t}\n\t\t\t\n\t\t\tif (obj) html += '<figure class=\"' + classes + '\">' +\n\t\t\t\t'<img src=\"' + obj.folder.slice(1) + '/' + obj.name + '\"/>' +\n\t\t\t\t(elt.showdesc+\"\" == \"show\" ? ('<figcaption class=\"in-item-desc\">' + elt.desc + '</figcaption>') : '') +\n\t\t\t\t'</figure>' + '\\n\\n';\n\t\t}\n\n\t\t// add widget-code\n\t\tif (elt.type == \"code\" && elt.tab && elt.tab.length) {\n\t\t\thtml += '<div id=\"inliner-widget-code-'+elt._stamp+'\" class=\"inliner-widget-code\">';\n\t\t\telt.tab.forEach(function(type){\n\t\t\t\thtml += '<div id=\"x'+type+'\" class=\"dib vat oh w750\">' +\n\t\t\t\t\t'<textarea id=\"' + type + '\" class=\"w750 fs80\"></textarea>' +\n\t\t\t\t\t'</div>';\n\t\t\t});\n\n\t\t\thtml += '</div>';\n\n\t\t\thtml += '<script>' + \n\t\t\t\t'$(function(){' +\n\t\t\t\t// TODO cut useless elt fields\n\t\t\t\t'var elt=' + cw.lib.js2txt(elt) + ';\\n' +\n\t\t\t\t'initCode(elt);\\n' +\n\t\t\t\tcw.lib.js2txt(initCode) +\n\t\t\t\t'})' +\n\t\t\t\t'</scr' + 'ipt>';\n\t\t}\n\n\t\t// add widget\n\t\tif (elt.type == \"widget\") {\n\t\t\thtml += '<div id=\"inliner-widget-'+elt._stamp+'\" class=\"inliner-widget\"></div>';\n\n\t\t\thtml += '<scr' + 'ipt>' + \n\t\t\t\t'$(function(){' +\n\t\t\t\t'var elt=' + cw.lib.js2txt(elt) + ';\\n' +\n\t\t\t\t'initWidget(elt);\\n' +\n\t\t\t\tcw.lib.js2txt(initWidget) +\n\t\t\t\t'})' +\n\t\t\t\t'</scr' + 'ipt>';\n\t\t}\n\t});\n\n\tObject.keys(oitems).forEach(function(i){\n\t\tvar it = oitems[i];\n\t\tif (it && it.folder==\"/inliner\" && it.name.startsWith(docid+\"/\")) {\n\t\t\tif (!resrc[it.name] || resrc[it.name] != it.id) oitems[i] = null;\n\t\t}\n\t});\n\n\t//item.data = JSON.stringify(data, null, '\\t');\n\titem.data = meta + '\\n' + html;\n\n\treturn undefined;\n\n\n\t//= = = = = = = = = = = = = = =\n\n\n\t// Must return undefined if all is ok\n\t// or error message if failed.\n\n\n\t// init widget code\n\tfunction initCode(elt) {\n\t\tvar $elt = $('#inliner-widget-code-'+elt._stamp),\n\t\t\t\tman = {\n\t\t\t\t\tparams:{strict:true},\n\t\t\t\t\tid:\"cw.Inliner.Editor.Items.code\",\n\t\t\t\t\tName:\"Code\",\n\t\t\t\t\tHoverpane:\".cw-widget-code\",\n\t\t\t\t\tCompiler: function ($form, html, css, repo, manifest) {\n\t\t\t\t\t\tvar h = $form[0].outerHTML, $h = $(h); \n\t\t\t\t\t\t$h.find(\"#tab\").remove();\n\t\t\t\t\t\t$h.find(\"input\").remove();\n\t\t\t\t\t\t$h.find(\".CodeMirror-sizer\").css({\"min-height\":\"none\"});\n\t\t\t\t\t\thtml.push($h[0].outerHTML);\n\t\t\t\t\t\tthis.CSSCompiler($form, css);\n\t\t\t\t\t},\n\t\t\t\t\tdata:{\n\t\t\t\t\t\ttype:\"code\", \n\t\t\t\t\t\tcode:\"Place your code\\nhere\", \n\t\t\t\t\t\ttab:[\"js\",\"css\",\"html\"],\n\t\t\t\t\t\toptions:[\"noedit\"],\n\t\t\t\t\t\tjs:\"// Place your javascript here\\n\",\n\t\t\t\t\t\thtml:\"<!-- Put HTML code here -->\\n\",\n\t\t\t\t\t\tcss:\"/* Container for CSS code */\\n\"\n\t\t\t\t\t},\n\t\t\t\t\tinit:function($o, form) {\n\t\t\t\t\t\t$o.formgen(this.HTML);\n\t\t\t\t\t},\n\t\t\t\t\tui:{\n\t\t\t\t\t\t\"#tab\":{\n\t\t\t\t\t\t\tbind:\"tab\",\n\t\t\t\t\t\t\tinit: function ($o) {\n\t\t\t\t\t\t\t\t$o.tags({tags:[{\"HTML\":\"html\"},{\"JS\":\"js\"}, {\"CSS\":\"css\"}]})\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trecalc:\"#xjs,#xhtml,#xcss\"\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\"#xjs\":{css:{hide: function (d) { return d.tab.indexOf(\"js\")==-1;}}},\n\t\t\t\t\t\t\"#js\":{\n\t\t\t\t\t\t\tbind:\"js\",\n\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\tif (!this.Runtime || form.data.tab.indexOf(\"js\")>-1) this.Cm($o, \"javascript\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\"#xcss\":{\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"css\")==-1;},\n\t\t\t\t\t\t\t\tbt1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#css\":{\n\t\t\t\t\t\t\tbind:\"css\",\n\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\tif (!this.Runtime || form.data.tab.indexOf(\"css\")>-1) this.Cm($o, \"css\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\"#xhtml\":{\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"html\")==-1;},\n\t\t\t\t\t\t\t\tbb1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#html\":{\n\t\t\t\t\t\t\tbind:\"html\",\n\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\tif (!this.Runtime || form.data.tab.indexOf(\"html\")>-1) this.Cm($o, \"htmlmixed\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: theme||\"default\"\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tHTML:[\n\t\t\t\t\t\t{row:\"750px\", label:\"0px\"},\n\t\t\t\t\t\t'<div class=\"cw-widget-code\">',\n\t\t\t\t\t\t'<div class=\"w180 db oh fs90 lh130 tar\" id=\"ovl\">',\n\t\t\t\t\t\t'<div class=\"w180 dib vat\">',\n\t\t\t\t\t\t'<span id=\"tab\" class=\"fs85\"></span>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xcode\" class=\"w750\">',\n\t\t\t\t\t\t'<div id=\"xhtml\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"html\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xjs\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"js\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\t\n\t\t\t\t\t\t'<div id=\"xcss\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"css\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t],\n\t\t\t\t\tstyle:{\n\t\t\t\t\t\t\" .b0\": \"border:none!important;\",\n\t\t\t\t\t\t\" .CodeMirror\":\"line-height:1.4em;font:14px Cousine,'PT Mono', Monaco,monospace;height:auto;padding:5px 5px 5px 6px;\",\n\t\t\t\t\t\t\" #ovl\" :\"transition: opacity 0.3s; opacity:0.4;position:absolute; top:3px;right:4px;z-index:+5;\",\n\t\t\t\t\t\t\" .bb1\":\"border-bottom:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\" .bt1\":\"border-top:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\"\":{\n\t\t\t\t\t\t\t\"\": \"border:1px solid #C1D0DA; border-radius:4px;overflow:hidden; display:block; min-height:48px;\"\n\t\t\t\t\t\t\t+\"clear:both;margin: 0 0 0.9em 0;padding-bottom:0!important;\",\n\t\t\t\t\t\t\t\":hover #ovl\":\"opacity:1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" label\":\"display:inline-block; color:#777; margin-right:20px;\"\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t//update man\n\t\t$.extend(true, man, {\n\t\t\tui: { \n\t\t\t\t\"#tab\" : {\n\t\t\t\t\tcss: {\n\t\t\t\t\t\thide:function () {return true}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: mode,\n\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\tindentUnit:2,\n\t\t\t\t\ttabSize:2,\n\t\t\t\t\ttheme: theme||\"default\",\n\t\t\t\t\t// edit\n\t\t\t\t\treadOnly: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$elt.my(man, elt);\n\t}\n\n\t// init widget\n\tfunction initWidget(elt) {\n\t\tvar $elt = $('#inliner-widget-'+elt._stamp),\n\t\t\t\tman = {\n\t\t\t\t\tparams:{strict:true},\n\t\t\t\t\tid:\"cw.Inliner.Editor.Items.widget\",\n\t\t\t\t\tName:\"App\",\n\t\t\t\t\tHoverpane:\".cw-widget\",\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\ttype: \"widget\",\n\t\t\t\t\t\ttab:[\"manifest\"],\n\t\t\t\t\t\tjs:\"// Widget manifest\\n({\\n\\tinit: function ($form, form) {\\n\\t\\t// Init code\\n\\t},\\n\\tui: \"\n\t\t\t\t\t\t+\"{\\n\\t\\t// UI bindings\\n\\t}\\t,\\n\\tstyle: {\\n\\t\\t// Local CSS rules\\n\\t}\\n})\",\n\t\t\t\t\t\thtml:\"\",\n\t\t\t\t\t\tdata:\"({\\n\\t//Put default data here\\n})\",\n\t\t\t\t\t\tstate:\"\",\n\t\t\t\t\t\tvalid:false,\n\t\t\t\t\t\terr:[],\n\t\t\t\t\t\toptions:[]\n\t\t\t\t\t},\n\t\t\t\t\tinit: function ($o, form) {\n\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t$o.formgen(this.HTML);\n\t\t\t\t\t\t$o.then(function(){\n\t\t\t\t\t\t\tif (form.data.state) {\n\t\t\t\t\t\t\t\t$o.find(\"#btn-run\").trigger(\"click\");\n\t\t\t\t\t\t\t} else that.XCode($o, form.data);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tui:{\n\t\t\t\t\t\t\"#tab\":{\n\t\t\t\t\t\t\tbind:function (d,v,$o){\n\t\t\t\t\t\t\t\tif (null!=v) {\n\t\t\t\t\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\t\t\t\t\tif ($x.is(\".my-form\")) $x.my(\"redraw\");\n\t\t\t\t\t\t\t\t\td.tab = v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn d.tab;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinit: function ($o) {\n\t\t\t\t\t\t\t\t$o.tags({tags:[{\"HTML\":\"html\"}, {\"Manifest\":\"manifest\"}, {\"Defaults\":\"data\"}]})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#btn-run\":{\n\t\t\t\t\t\t\tbind: function (d,v,$o){\n\t\t\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\t\t\tif (d.valid) {\n\t\t\t\t\t\t\t\t\t\td.state = \"running\";\n\t\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xcode,#tab\").addClass(\"hide\");\n\t\t\t\t\t\t\t\t\t\tvar $a = $o.my(\"find\",\"#xapp\"),\n\t\t\t\t\t\t\t\t\t\t\t\t$v = $o.my(\"find\",\"#xreflect\");\n\t\t\t\t\t\t\t\t\t\t$a.removeClass(\"hide\")\n\t\t\t\t\t\t\t\t\t\t.html(d.html)\n\t\t\t\t\t\t\t\t\t\t.my(eval(d.js),eval(d.data)||{})\n\t\t\t\t\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t\t\t\t\t$a.trigger(\"change\");\n\t\t\t\t\t\t\t\t\t\t}.debounce(50));\n\n\t\t\t\t\t\t\t\t\t\tif (d.options.indexOf(\"show data\")!=-1) {\n\t\t\t\t\t\t\t\t\t\t\t$a.on(\"change.my\", function(){\n\t\t\t\t\t\t\t\t\t\t\t\t$v.html(\n\t\t\t\t\t\t\t\t\t\t\t\t\tcw.lib.js2txt(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$a.my(\"data\"),\"  \")\n\t\t\t\t\t\t\t\t\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/^\\{/,'{ <span class=\"green\">// Form data</span>')\t\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}.debounce(2));\n\t\t\t\t\t\t\t\t\t\t\t$a.addClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t\t$v.addClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t$a.removeClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t\t$v.removeClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcw.lib.note(d.err.join(\".<br>\")+\".\", \"error\", 5000);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function(d){return !!d.state},\n\t\t\t\t\t\t\t\t\"red\": function (d) {return !d.valid},\n\t\t\t\t\t\t\t\t\"green\": function (d) {return d.valid}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents:\"click.my\",\n\t\t\t\t\t\t\twatch:\"#btn-code\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#btn-code\":{\n\t\t\t\t\t\t\tbind: function(d,v, $o){\n\t\t\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\t\t\td.state = \"\";\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xapp\").addClass(\"hide\").my(\"remove\");\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xcode, #tab\").removeClass(\"hide\");\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xreflect\").removeClass(\"xdata\");\n\t\t\t\t\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\t\t\t\t\tif (!$x.is(\".my-form\")) {\n\t\t\t\t\t\t\t\t\t\tthis.XCode($o.my().root, d);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function(d){return !d.state}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents:\"click.my\",\n\t\t\t\t\t\t\twatch:\"#btn-run\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#warn\":{\n\t\t\t\t\t\t\tbind:function (d) {\n\t\t\t\t\t\t\t\tvar t=d.js, o, err=[], data;\n\t\t\t\t\t\t\t\ttry { o = eval(t); } catch (e) {}\n\t\t\t\t\t\t\t\ttry { data = eval(d.data); } catch (e) {}\n\t\t\t\t\t\t\t\td.valid=false;\n\t\t\t\t\t\t\t\tif (!Object.isObject(o)) err.push(\"Invalid manifest\");\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tif ( !Object.isObject(o.ui)) err.push(\"No ui section\");\n\t\t\t\t\t\t\t\t\telse if ( !Object.size(o.ui)) err.push(\"No bindings in ui section\");\n\n\t\t\t\t\t\t\t\t\tif  ( !Object.isFunction(o.init) && !Object.isArray(o.init) && !(d.html+\"\").length)\n\t\t\t\t\t\t\t\t\t\terr.push(\"No HTML defined in init function or HTML tab\");\n\n\t\t\t\t\t\t\t\t\tif (!Object.isObject(data))  err.push(\"Defaults must be an object\");\n\n\t\t\t\t\t\t\t\t\tif (o.data!==undefined && !Object.isObject(o.data)) err.push(\"Section ‘data’ must be an object\");\n\t\t\t\t\t\t\t\t\tif (o.params!==undefined && !Object.isObject(o.params)) err.push(\"Section ‘params’ must be an object\");\n\t\t\t\t\t\t\t\t\tif (o.style!==undefined && !Object.isObject(o.style)) err.push(\"Section ‘style’ must be an object\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!err.length) d.valid = true;\n\t\t\t\t\t\t\t\td.err=err;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdelay:500,\n\t\t\t\t\t\t\trecalc:\"#btn-run\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tXCode: function ($form, d){\n\t\t\t\t\t\tthis.XCode3._compiled = this._compiled;\n\t\t\t\t\t\t$form.find(\"#xcode\")\n\t\t\t\t\t\t.my (this.XCode3, d)\n\t\t\t\t\t\t.on(\"change\", function(){\n\t\t\t\t\t\t\t$form.find(\"#warn\").trigger(\"check.my\");\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tXCode3:{\n\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\"#xjs\":{css:{hide: function (d) { return d.tab.indexOf(\"manifest\")==-1;}}},\n\t\t\t\t\t\t\t\"#js\":{\n\t\t\t\t\t\t\t\tbind:\"js\",\n\t\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"manifest\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t\"#xdata\":{\n\t\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"data\")==-1;},\n\t\t\t\t\t\t\t\t\tbt1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"#data\":{\n\t\t\t\t\t\t\t\tbind:\"data\",\n\t\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"data\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t\"#xhtml\":{\n\t\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"html\")==-1;},\n\t\t\t\t\t\t\t\t\tbb1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"#html\":{\n\t\t\t\t\t\t\t\tbind:\"html\",\n\t\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"html\")>-1) \n\t\t\t\t\t\t\t\t\t\tthis.Cm($o, \"htmlmixed\", true, \"base16-light\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t\"input[name=options]\":\"options\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\t\ttheme: theme||\"default\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tCompiler: function ($form, html, css, repo, manifest) {\n\t\t\t\t\t\tvar man = Object.clone(Object.reject(manifest, [\"Compiler\",\"Hoverpane\", /^_/]), true),\n\t\t\t\t\t\t\t\tdata = $form.my(\"data\"),\n\t\t\t\t\t\t\t\ttid = \"form\"+Number.random(1e6,1e7),\n\t\t\t\t\t\t\t\th=\"\", height,\n\t\t\t\t\t\t\t\tinsync=false;\n\t\t\t\t\t\tman.style[\" #xoptions\"] = \"display:none;\";\n\t\t\t\t\t\tman.style[\" #tab\"] = \"display:none;\";\n\t\t\t\t\t\tman._compiled = true;\n\n\t\t\t\t\t\theight = $form.height() - (!data.state?18:-7);\n\t\t\t\t\t\tinsync = data.options.indexOf(\"init sync\")>-1;\n\n\t\t\t\t\t\tif (data.options.indexOf(\"noedit\")>-1) {\n\t\t\t\t\t\t\t// Include only executable manifest\n\t\t\t\t\t\t\tif (data.err.length) throw (new Error (\"Error compiling widget manifest\") );\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tthis.CSSCompiler($form, css);\n\n\t\t\t\t\t\t\t\tvar refl = data.options.indexOf(\"show data\")>-1;\n\n\t\t\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t\t\t'<span id=\"'+tid+'\" class=\"db '+$form.attr(\"class\")+'\" '\n\t\t\t\t\t\t\t\t\t+'style=\"height:'+height+'px;overflow:hidden;\">',\n\t\t\t\t\t\t\t\t\t'<div class=\"cw-widget\">',\n\t\t\t\t\t\t\t\t\t'<div id=\"xapp\" class=\"oh vat'+(refl?' xdata':'')+'\">'+data.html+'</div>',\n\t\t\t\t\t\t\t\t\t(refl?'<div id=\"xreflect\" class=\"oh vat xdata\"></div>':\"\"),\n\t\t\t\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t\t\t\t'</span>',\n\t\t\t\t\t\t\t\t\t'<script>',\n\t\t\t\t\t\t\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t\t\t\t\t\t\t+'(function(){var $f=$(\"#'+tid+'\");$f.find(\"#xapp\").my('+data.js+\", \",\n\t\t\t\t\t\t\t\t\tdata.data+')',\n\t\t\t\t\t\t\t\t\t(refl?'.on(\"change.my\", function(){'\n\t\t\t\t\t\t\t\t\t +'$(this).parent().find(\"#xreflect\").html('\n\t\t\t\t\t\t\t\t\t +'cw.lib.js2txt($(this).my(\"data\"),\"  \").replace(/^\\{/,\\'{ <span class=\"green\">// App data</span>\\')'\n\t\t\t\t\t\t\t\t\t +');'\n\t\t\t\t\t\t\t\t\t +'}.debounce(20))':\"\"),\n\t\t\t\t\t\t\t\t\t'.then(function(){$f.css({\"height\":\"none\", overflow:\"none\"});}.debounce(100))',\n\t\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t\t'<'+'/script>'\n\t\t\t\t\t\t\t\t].join(\"\\n\");\n\n\t\t\t\t\t\t\t\thtml.push(h);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Include full code\n\t\t\t\t\t\t\tvar norepo = !repo[man.id];\n\t\t\t\t\t\t\trepo[man.id]=true;\n\t\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t\t'<span id=\"'+tid+'\" class=\"db cw-item\" style=\"height:'\n\t\t\t\t\t\t\t\t+height+'px;overflow:hidden;\"></span>',\n\t\t\t\t\t\t\t\t'<script>',\n\t\t\t\t\t\t\t\t(norepo?'$.my.cache('+cw.lib.js2txt(man,\"  \")+');' : ''),\n\t\t\t\t\t\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t\t\t\t\t\t+'(function(){var $f=$(\"#'+tid+'\"); $f.my(\"'+man.id+'\", ',\n\t\t\t\t\t\t\t\tcw.lib.js2txt(data,\"  \").replace(/<\\//g, '<\\\\u002F')+')',\n\t\t\t\t\t\t\t\t'.then(function(){$f.css({\"height\":\"none\", overflow:\"none\"});}.debounce(100))',\n\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t'<'+'/script>'\n\t\t\t\t\t\t\t].join('\\n');\n\t\t\t\t\t\t\thtml.push(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tHTML:[\n\t\t\t\t\t\t{row:\"750px\", label:\"0px\"},\n\t\t\t\t\t\t'<div class=\"cw-widget\">',\n\t\t\t\t\t\t'<div class=\"w280 db oh fs90 lh130\" id=\"ovl\">',\n\t\t\t\t\t\t'<div class=\"w200 dib pt7 vat\">',\n\t\t\t\t\t\t'<span id=\"tab\" class=\"fs85\"></span>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div  class=\"w80 dib vat fs95\">',\n\t\t\t\t\t\t'<span id=\"btn-run\" class=\"button fs80 lh130 pb6 fi-play-circle green br100 mr0 fr\"> ',\n\t\t\t\t\t\t'<span class=\"fs110\">Run&nbsp;</span>',\n\t\t\t\t\t\t'</span>',\n\t\t\t\t\t\t'<span id=\"btn-code\" class=\"hide button fs80 fi-pencil lh130 green br100 mr0 fr\">&thinsp;&thinsp;',\n\t\t\t\t\t\t'<span class=\"fs110\">Code</span>',\n\t\t\t\t\t\t'</span>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xcode\" class=\"w750\">',\n\t\t\t\t\t\t'<div id=\"xhtml\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"html\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xjs\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"js\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\t\n\t\t\t\t\t\t'<div id=\"xdata\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"data\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xoptions\" class=\"fs75 bt1 pl7 pt3 pb3\">',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"noedit\" />',\n\t\t\t\t\t\t' &nbsp;Disable editor at runtime',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"show data\" />',\n\t\t\t\t\t\t' &nbsp;Reflect form’s data',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"init sync\" />',\n\t\t\t\t\t\t' &nbsp;Init sync',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xapp\" class=\"oh hide vat fs80\"></div>',\n\t\t\t\t\t\t'<div id=\"xreflect\" class=\"oh vat\"></div>',\n\t\t\t\t\t\t'<div id=\"warn\" class=\"hide\"></div>',\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t],\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\" .b0\": \"border:none!important;\",\n\t\t\t\t\t\t\" .CodeMirror\":\"font:14px Cousine,'PT Mono',Monaco,monospace;line-height:1.4em;height:auto;\",\n\t\t\t\t\t\t\" #xapp\": {\n\t\t\t\t\t\t\t\"\":\"padding:20px 25px 25px 25px;display:inline-block;\",\n\t\t\t\t\t\t\t\".xdata\" :\"width:445px;padding-right:20px\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" #ovl\" :\"transition: opacity 0.3s; opacity:0.6;position:absolute; top:2px;right:5px;z-index:+2;\",\n\t\t\t\t\t\t\" .bb1\":\"border-bottom:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\" .bt1\":\"border-top:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\"\":{\n\t\t\t\t\t\t\t\"\": \"border:1px solid #C1D0DA; border-radius:4px;overflow:hidden; display:block; min-height:48px;\"\n\t\t\t\t\t\t\t+\"clear:both;margin: 0 0 0.9em 0;padding-bottom:0!important;\",\n\t\t\t\t\t\t\t\":hover #ovl\":\"opacity:1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" label\":\"display:inline-block; color:#777; margin-right:20px;\",\n\t\t\t\t\t\t\" #xreflect\":{\n\t\t\t\t\t\t\t\"\":\"padding:0px 7px 0px 15px; 10px; font:12px Cousine,'PT Mono',Monaco,monospace;line-height:1.2em;height:auto;\"\n\t\t\t\t\t\t\t+\"margin:18px 0 18px 0; border-left:1px dotted #C1D0DA; opacity:0.7;\"\n\t\t\t\t\t\t\t+\"white-space: pre-wrap;word-wrap: break-word;display:none;\",\n\t\t\t\t\t\t\t\".xdata\": \"display:inline-block;width:297px;\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" .my-form-list .fi-list\":\"opacity:0.8;cursor:move\"\n\t\t\t\t\t}\t\n\t\t\t\t};\t\n\n\t\t//update man\n\t\t$.extend(true, man, {\n\t\t\tinit: function ($o, form) {\n\t\t\t\tvar that = this;\n\t\t\t\t$o.formgen(this.HTML);\n\t\t\t\t$o.then(function(){\n\t\t\t\t\tif (form.data.state || form.data.options.find('noedit')) {\n\t\t\t\t\t\t$o.find(\"#btn-run\").trigger(\"click\");\n\t\t\t\t\t\tif (form.data.options.find('noedit')) {\n\t\t\t\t\t\t\t$o.find(\"#btn-run, #btn-code\").css({'display':'none;'});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else that.XCode($o, form.data);\n\t\t\t\t\t$o.find(\"#tab, #xoptions\").addClass('hide');\n\t\t\t\t});\n\t\t\t},\n\t\t\tui: {\n\t\t\t\t\"#btn-run\":{\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){return !!d.state}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#btn-code\":{\n\t\t\t\t\tbind: function(d,v, $o){\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.state = \"\";\n\t\t\t\t\t\t\t$o.my(\"find\",\"#xapp\").addClass(\"hide\").my(\"remove\");\n\t\t\t\t\t\t\t//edit\n\t\t\t\t\t\t\t$o.my(\"find\",\"#xcode\").removeClass(\"hide\");\n\t\t\t\t\t\t\t$o.my(\"find\",\"#xreflect\").removeClass(\"xdata\");\n\t\t\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\t\t\tif (!$x.is(\".my-form\")) {\n\t\t\t\t\t\t\t\tthis.XCode($o.my().root, d);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){return (!d.state || !!d.options.find('noedit'))}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: mode,\n\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\tindentUnit:2,\n\t\t\t\t\ttabSize:2,\n\t\t\t\t\ttheme: theme||\"default\",\n\t\t\t\t\treadOnly: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$elt.my(man, elt);\n\t}\n\n}","rtf": "function (data,item,oitems) {\n  \n  var that = this,\n      widgets = that.Types.rtf.extend.Inliner.Ed.Widgets;\n\n\t// Converts inliner docs to internal representation,\n\t// \n\titem.doc = $.extend(!0, {}, Object.reject(data,['_attachments','previews']), {_id:item.id, previews:{}});\n\titem.data = \"\";\n\n\t// Reformat references\n\t// and move attachments from imported doc\n\t// to local\n\n\tvar resrc = {}, \n\t\t\tatt0 = {\n\t\t\t\tid:\"\", folder:\"\", name:\"\", mime:\"\", parser:\"\", parserActive:false,\n\t\t\t\text:\"\", cache:\"864000\", data:\"\", snippet:false, size:\"?\",\n\t\t\t\ttype:\"attachment\",\n\t\t\t\tdesc:\"\", \n\t\t\t\tstate:{\n\t\t\t\t\tsavedSdbm:\"\", sdbm:\"Z\",\n\t\t\t\t\tdepends:{}, impacts:{}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdocid = item.doc._id;\n\n\titem.doc.content.forEach(function(elt){\n\t\t\n    _grabFiles(elt)\n\n\t});\n\t\n\tObject.keys(oitems).forEach(function(i){\n\t\tvar it = oitems[i];\n\t\tif (it && it.folder==\"/inliner\" && it.name.startsWith(docid+\"/\")) {\n\t\t\tif (!resrc[it.name] || resrc[it.name] != it.id) oitems[i] = null;\n\t\t}\n\t});\n\t\n\treturn undefined;\n  \n  // - - - - - - - - - - -\n  \n  function _grabFiles(elt) {\n    \n    // Grabs attaches from doc and replace pointers\n    \n    // Widget ====================\n    \n    if (elt.type == 'widget') {\n      var w;\n      if (\n        elt.source && elt.options.indexOf('autoupdate')>-1 \n        && (w = widgets[elt.source])\n        && w.To && w.To.files && w.To.data\n      ) {\n        var wdata = JSON.parse(elt.data.replace(/^\\(|\\)$/g,'')),\n            files = w.To.files(wdata);\n        \n        Object.keys(files).forEach(function(fname){\n        \tif (!data._attachments || !data._attachments[fname]) return;\n          var obj = _copyFile(fname);\n          files[fname] = (obj.folder+'/'+obj.name).substr(1);\n        });\n        \n        elt.data = w.To.data(elt, {Urls:files});\n      }\n    }\n    \n    // Image ====================\n    \n    if (elt.type == \"img\") { \n\n      var obj, id, file;\n\n      // Create item of type:\"attachment\"\n      if (elt.ref && data._attachments && data._attachments[elt.ref]) {\n        // image is attached\n        obj = _copyFile(elt.ref);\n        elt.ref = (obj.folder+'/'+obj.name).substr(1);\n      } \n      else {\n        // image is inlined\n        id = cw.lib.hash8(\"inliner/\" + docid +\"/\"+elt._stamp);\n        obj = $.extend(true, {}, att0, {\n          id: id,\n          folder: \"/inliner\",\n          name: docid+\"/\"+elt._stamp+\".jpg\",\n          mime: \"image/jpeg\",\n          data: {content_type: \"image/jpeg\", data: elt.data},\n          state:{ crc:cw.lib.sdbm(elt.data)}\n        });\n\n        elt.data = \" \";\n        elt.ref = \"inliner/\"+ obj.name;\n\n      }\n\n      if (obj) {\n        // put new type:\"attachment\" item into main doc\n        resrc[obj.name] = obj.id;\n        if (!oitems[id] || oitems[id].state.crc != obj.state.crc) oitems[id] = obj;\n      }\n\n    }\n    \n  }\n  \n  // - - - - - - - - - - -\n  \n  function _copyFile (fname) {\n    \n    // copies attach from inliner to doc,\n    // returns new fname\n    \n  \tvar id = cw.lib.hash8(\"inliner/\" + docid +\"/\"+fname),\n        file = data._attachments[fname];\n    \n    var obj = $.extend(true, {}, att0, {\n      id: id,\n      folder: \"/inliner\",\n      name: docid+\"/\"+fname,\n      mime: file.content_type,\n      data: {\n        content_type: file.content_type,\n        data: file.data\n      },\n      state:{\n        crc:cw.lib.sdbm(file.data)\n      }\n    });\n    \n    // put new type:\"attachment\" item into main doc\n    resrc[obj.name] = obj.id;\n    if (!oitems[id] || oitems[id].state.crc != obj.state.crc) oitems[id] = obj;\n    \n    return obj;\n  }\n\n}"}},"HTMLParser": "function (global) {\n\t\n\t/*!\n\t * HTML Parser By John Resig (ejohn.org)\n\t * Modified by Juriy \"kangax\" Zaytsev\n\t * Original code by Erik Arvidsson, Mozilla Public License\n\t * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js\n\t */\n\t\n\t'use strict';\n\n\t// Regular Expressions for parsing tags and attributes\n\tvar singleAttrIdentifier = /([\\w:\\.-]+)/,\n\t\t\tsingleAttrAssign = /=/,\n\t\t\tsingleAttrAssigns = [ singleAttrAssign ],\n\t\t\tsingleAttrValues = [\n\t\t\t\t/\"((?:\\\\.|[^\"])*)\"/.source, // attr value double quotes\n\t\t\t\t/'((?:\\\\.|[^'])*)'/.source, // attr value, single quotes\n\t\t\t\t/([^>\\s]+)/.source          // attr value, no quotes\n\t\t\t],\n\t\t\tstartTagOpen = /^<([\\w:-]+)/,\n\t\t\tstartTagClose = /\\s*(\\/?)>/,\n\t\t\tendTag = /^<\\/([\\w:-]+)[^>]*>/,\n\t\t\tendingSlash = /\\/>$/,\n\t\t\tdoctype = /^<!DOCTYPE [^>]+>/i;\n\n\tvar IS_REGEX_CAPTURING_BROKEN = false;\n\t'x'.replace(/x(.)?/g, function(m, g) {\n\t\tIS_REGEX_CAPTURING_BROKEN = g === '';\n\t});\n\n\t// Empty Elements - HTML 4.01\n\tvar empty = makeMap('area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,wbr');\n\n\t// Block Elements - HTML 4.01\n\tvar block = makeMap('a,address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul');\n\n\t// Inline Elements - HTML 4.01\n\tvar inline = makeMap('abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,noscript,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,svg,textarea,tt,u,var');\n\n\t// Elements that you can, intentionally, leave open\n\t// (and which close themselves)\n\tvar closeSelf = makeMap('colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source');\n\n\t// Attributes that have their values filled in disabled='disabled'\n\tvar fillAttrs = makeMap('checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected');\n\n\t// Special Elements (can contain anything)\n\tvar special = makeMap('script,style,noscript,svg');\n\n\tvar reCache = {}, stackedTag, reStackedTag, tagMatch;\n\n\tfunction startTagForHandler( handler ) {\n\t\tvar customStartTagAttrs;\n\n\t\tvar startTagAttrs = new RegExp(\n\t\t\t'(?:\\\\s*[\\\\w:\\\\.-]+'\n\t\t\t+   '(?:\\\\s*'\n\t\t\t+     '(?:' + joinSingleAttrAssigns(handler) + ')'\n\t\t\t+     '\\\\s*(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>\\\\s]+)'\n\t\t\t+   ')?'\n\t\t\t+ ')*'\n\t\t);\n\n\t\tif ( handler.customAttrSurround ) {\n\t\t\tvar attrClauses = [];\n\n\t\t\tfor ( var i = handler.customAttrSurround.length - 1; i >= 0; i-- ) {\n\t\t\t\t// Capture the custom attribute opening and closing markup surrounding the standard attribute rules\n\t\t\t\tattrClauses[i] = '(?:\\\\s*'\n\t\t\t\t+ handler.customAttrSurround[i][0].source\n\t\t\t\t+ startTagAttrs.source\n\t\t\t\t+ handler.customAttrSurround[i][1].source\n\t\t\t\t+ ')';\n\t\t\t}\n\t\t\tattrClauses.unshift(startTagAttrs.source);\n\n\t\t\tcustomStartTagAttrs = new RegExp(\n\t\t\t\t'((?:' + attrClauses.join('|') + ')*)'\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\t// No custom attribute wrappers specified, so just capture the standard attribute rules\n\t\t\tcustomStartTagAttrs = new RegExp('(' + startTagAttrs.source + ')');\n\t\t}\n\n\t\treturn new RegExp(startTagOpen.source + customStartTagAttrs.source + startTagClose.source);\n\t}\n\n\tfunction attrForHandler( handler ) {\n\t\tvar singleAttr = new RegExp(\n\t\t\tsingleAttrIdentifier.source\n\t\t\t+ '(?:\\\\s*'\n\t\t\t+ '(' + joinSingleAttrAssigns( handler ) + ')'\n\t\t\t+ '\\\\s*'\n\t\t\t+ '(?:'\n\t\t\t+ singleAttrValues.join('|')\n\t\t\t+ ')'\n\t\t\t+ ')?'\n\t\t);\n\n\t\tif ( handler.customAttrSurround ) {\n\t\t\tvar attrClauses = [];\n\t\t\tfor ( var i = handler.customAttrSurround.length - 1; i >= 0; i-- ) {\n\t\t\t\tattrClauses[i] = '(?:'\n\t\t\t\t+ '(' + handler.customAttrSurround[i][0].source + ')'\n\t\t\t\t+ singleAttr.source\n\t\t\t\t+ '(' + handler.customAttrSurround[i][1].source + ')'\n\t\t\t\t+ ')';\n\t\t\t}\n\t\t\tattrClauses.unshift('(?:' + singleAttr.source + ')');\n\n\t\t\treturn new RegExp(attrClauses.join('|'), 'g');\n\t\t}\n\t\telse {\n\t\t\treturn new RegExp(singleAttr.source, 'g');\n\t\t}\n\t}\n\n\tfunction joinSingleAttrAssigns( handler ) {\n\t\treturn singleAttrAssigns.concat(\n\t\t\thandler.customAttrAssign || []\n\t\t).map(function (assign) {\n\t\t\treturn '(?:' + assign.source + ')';\n\t\t}).join('|');\n\t}\n\n\tvar HTMLParser = global.HTMLParser = function( html, handler ) {\n\t\tvar index, chars, match, stack = [], last = html, prevTag, nextTag;\n\t\tstack.last = function() {\n\t\t\tvar last = this[ this.length - 1 ];\n\t\t\treturn last && last.tag;\n\t\t};\n\n\t\tvar startTag = startTagForHandler(handler);\n\t\tvar attr = attrForHandler(handler);\n\n\t\twhile ( html ) {\n\t\t\tchars = true;\n\n\t\t\t// Make sure we're not in a script or style element\n\t\t\tif ( !stack.last() || !special[ stack.last() ] ) {\n\n\t\t\t\t// Comment:\n\t\t\t\tif ( /^<!--/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf('-->');\n\n\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\tif ( handler.comment ) {\n\t\t\t\t\t\t\thandler.comment( html.substring( 4, index ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 3 );\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// http://en.wikipedia.org/wiki/Conditional_comment#Downlevel-revealed_conditional_comment\n\t\t\t\tif ( /^<!\\[/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf(']>');\n\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tif ( handler.comment ) {\n\t\t\t\t\t\t\thandler.comment( html.substring(2, index + 1 ), true /* non-standard */ );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 2 );\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ignored elements?\n\t\t\t\telse if ( /^<\\?/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf( '?>', 2 );\n\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\t\thandler.chars( html.substring( 0, index + 2 ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 2 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telse if ( /^<%/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf( '%>', 2 );\n\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\t\thandler.chars(html.substring( 0, index + 2) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 2 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Doctype:\n\t\t\t\telse if ( (match = doctype.exec( html )) ) {\n\t\t\t\t\tif ( handler.doctype ) {\n\t\t\t\t\t\thandler.doctype( match[0] );\n\t\t\t\t\t}\n\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\tchars = false;\n\t\t\t\t}\n\n\t\t\t\t// End tag:\n\t\t\t\telse if ( /^<\\//.test( html ) ) {\n\t\t\t\t\tmatch = html.match( endTag );\n\n\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\tmatch[0].replace( endTag, parseEndTag );\n\t\t\t\t\t\tprevTag = '/' + match[1].toLowerCase();\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t// Start tag:\n\t\t\t\telse if ( /^</.test( html ) ) {\n\t\t\t\t\tmatch = html.match( startTag );\n\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\tmatch[0].replace( startTag, parseStartTag );\n\t\t\t\t\t\tprevTag = match[1].toLowerCase();\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( chars ) {\n\t\t\t\t\tindex = html.indexOf('<');\n\n\t\t\t\t\tvar text = index < 0 ? html : html.substring( 0, index );\n\t\t\t\t\thtml = index < 0 ? '' : html.substring( index );\n\n\t\t\t\t\t// next tag\n\t\t\t\t\ttagMatch = html.match( startTag );\n\t\t\t\t\tif (tagMatch) {\n\t\t\t\t\t\tnextTag = tagMatch[1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ttagMatch = html.match( endTag );\n\t\t\t\t\t\tif (tagMatch) {\n\t\t\t\t\t\t\tnextTag = '/' + tagMatch[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnextTag = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\thandler.chars(text, prevTag, nextTag);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse {\n\n\t\t\t\tstackedTag = stack.last().toLowerCase();\n\t\t\t\treStackedTag = reCache[stackedTag] || (reCache[stackedTag] = new RegExp('([\\\\s\\\\S]*?)<\\/' + stackedTag + '[^>]*>', 'i'));\n\n\t\t\t\thtml = html.replace(reStackedTag, function(all, text) {\n\t\t\t\t\tif (stackedTag !== 'script' && stackedTag !== 'style' && stackedTag !== 'noscript') {\n\t\t\t\t\t\ttext = text\n\t\t\t\t\t\t.replace(/<!--([\\s\\S]*?)-->/g, '$1')\n\t\t\t\t\t\t.replace(/<!\\[CDATA\\[([\\s\\S]*?)\\]\\]>/g, '$1');\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\thandler.chars( text );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '';\n\t\t\t\t});\n\n\t\t\t\tparseEndTag( '', stackedTag );\n\t\t\t}\n\n\t\t\tif ( html === last ) {\n\t\t\t\tthrow 'Parse Error: ' + html;\n\t\t\t}\n\t\t\tlast = html;\n\t\t}\n\n\t\t// Clean up any remaining tags\n\t\tparseEndTag();\n\n\t\tfunction parseStartTag( tag, tagName, rest, unary ) {\n\t\t\tvar unarySlash = false;\n\t\t\t\n\t\t\tif (block[tagName]) {\n\t\t\t\twhile ( !handler.html5 && stack.last() && inline[ stack.last() ]) {\n\t\t\t\t\tparseEndTag( '', stack.last() );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( closeSelf[ tagName ] && stack.last() === tagName ) {\n\t\t\t\tparseEndTag( '', tagName );\n\t\t\t}\n\n\t\t\tunary = empty[ tagName ] || !!unary;\n\n\t\t\tvar attrs = [];\n\n\t\t\trest.replace(attr, function () {\n\t\t\t\tvar name, value, fallbackValue, customOpen, customClose, customAssign, quote;\n\t\t\t\tvar ncp = 7; // number of captured parts, scalar\n\n\t\t\t\t// hackish work around FF bug https://bugzilla.mozilla.org/show_bug.cgi?id=369778\n\t\t\t\tif (IS_REGEX_CAPTURING_BROKEN && arguments[0].indexOf('\"\"') === -1) {\n\t\t\t\t\tif (arguments[3] === '') { arguments[3] = undefined; }\n\t\t\t\t\tif (arguments[4] === '') { arguments[4] = undefined; }\n\t\t\t\t\tif (arguments[5] === '') { arguments[5] = undefined; }\n\t\t\t\t}\n\n\t\t\t\tname = arguments[1];\n\t\t\t\tif ( name ) {\n\t\t\t\t\tcustomAssign = arguments[2];\n\t\t\t\t\tfallbackValue = arguments[3];\n\t\t\t\t\tvalue = fallbackValue || arguments[4] || arguments[5];\n\n\t\t\t\t\tif (customAssign) {\n\t\t\t\t\t\tquote = arguments[0].charAt(name.length + customAssign.length);\n\t\t\t\t\t\tquote = (quote === '\\'' || quote === '\"') ? quote : '';\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse if ( handler.customAttrSurround ) {\n\t\t\t\t\tfor ( var i = handler.customAttrSurround.length - 1; i >= 0; i-- ) {\n\t\t\t\t\t\tname = arguments[i * ncp + 7];\n\t\t\t\t\t\tcustomAssign = arguments[i * ncp + 8];\n\t\t\t\t\t\tif ( name ) {\n\t\t\t\t\t\t\tfallbackValue = arguments[i * ncp + 9];\n\t\t\t\t\t\t\tvalue = fallbackValue\n\t\t\t\t\t\t\t|| arguments[i * ncp + 10]\n\t\t\t\t\t\t\t|| arguments[i * ncp + 11];\n\t\t\t\t\t\t\tcustomOpen = arguments[i * ncp + 6];\n\t\t\t\t\t\t\tcustomClose = arguments[i * ncp + 12];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( value === undefined ) {\n\t\t\t\t\tvalue = fillAttrs[name] ? name : fallbackValue;\n\t\t\t\t}\n\n\t\t\t\tattrs.push({\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\tescaped: value && value.replace(/(^|.)(\"+)/g, function(match) {\n\t\t\t\t\t\treturn match.replace(/\"/g, '&quot;');\n\t\t\t\t\t}),\n\t\t\t\t\tcustomAssign: customAssign || '=',\n\t\t\t\t\tcustomOpen:  customOpen || '',\n\t\t\t\t\tcustomClose: customClose || '',\n\t\t\t\t\tquote: quote || ''\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif ( !unary ) {\n\t\t\t\tstack.push( { tag: tagName, attrs: attrs } );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tunarySlash = tag.match( endingSlash );\n\t\t\t}\n\n\n\t\t\tif ( handler.start ) {\n\t\t\t\thandler.start( tagName, attrs, unary, unarySlash );\n\t\t\t}\n\t\t}\n\n\t\tfunction parseEndTag( tag, tagName ) {\n\t\t\tvar pos;\n\n\t\t\t// If no tag name is provided, clean shop\n\t\t\tif ( !tagName ) {\n\t\t\t\tpos = 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Find the closest opened tag of the same type\n\t\t\t\tvar needle = tagName.toLowerCase();\n\t\t\t\tfor ( pos = stack.length - 1; pos >= 0; pos-- ) {\n\t\t\t\t\tif ( stack[ pos ].tag.toLowerCase() === needle ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( pos >= 0 ) {\n\t\t\t\t// Close all the open elements, up the stack\n\t\t\t\tfor ( var i = stack.length - 1; i >= pos; i-- ) {\n\t\t\t\t\tif ( handler.end ) {\n\t\t\t\t\t\thandler.end( stack[ i ].tag, stack[ i ].attrs );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Remove the open elements from the stack\n\t\t\t\tstack.length = pos;\n\t\t\t}\n\t\t}\n\t};\n\n\tglobal.HTMLtoXML = function( html ) {\n\t\tvar results = '';\n\n\t\tnew HTMLParser(html, {\n\t\t\tstart: function( tag, attrs, unary ) {\n\t\t\t\tresults += '<' + tag;\n\n\t\t\t\tfor ( var i = 0; i < attrs.length; i++ ) {\n\t\t\t\t\tresults += ' ' + attrs[i].name + '=\"' + attrs[i].escaped + '\"';\n\t\t\t\t}\n\n\t\t\t\tresults += (unary ? '/' : '') + '>';\n\t\t\t},\n\t\t\tend: function( tag ) {\n\t\t\t\tresults += '</' + tag + '>';\n\t\t\t},\n\t\t\tchars: function( text ) {\n\t\t\t\tresults += text;\n\t\t\t},\n\t\t\tcomment: function( text ) {\n\t\t\t\tresults += '<!--' + text + '-->';\n\t\t\t},\n\t\t\tignore: function(text) {\n\t\t\t\tresults += text;\n\t\t\t}\n\t\t});\n\n\t\treturn results;\n\t};\n\n\t/*global.HTMLtoDOM = function( html, doc ) {\n\t\t// There can be only one of these elements\n\t\tvar one = makeMap('html,head,body,title');\n\n\t\t// Enforce a structure for the document\n\t\tvar structure = {\n\t\t\tlink: 'head',\n\t\t\tbase: 'head'\n\t\t};\n\n\t\tif ( !doc ) {\n\t\t\tif ( typeof DOMDocument !== 'undefined' ) {\n\t\t\t\tdoc = new DOMDocument();\n\t\t\t}\n\t\t\telse if ( typeof document !== 'undefined' && document.implementation && document.implementation.createDocument ) {\n\t\t\t\tdoc = document.implementation.createDocument('', '', null);\n\t\t\t}\n\t\t\telse if ( typeof ActiveX !== 'undefined' ) {\n\t\t\t\tdoc = new ActiveXObject('Msxml.DOMDocument');\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\tdoc = doc.ownerDocument ||\n\t\t\t\tdoc.getOwnerDocument && doc.getOwnerDocument() ||\n\t\t\t\tdoc;\n\t\t}\n\n\t\tvar elems = [],\n\t\t\t\tdocumentElement = doc.documentElement ||\n\t\t\t\tdoc.getDocumentElement && doc.getDocumentElement();\n\n\t\t// If we're dealing with an empty document then we\n\t\t// need to pre-populate it with the HTML document structure\n\t\tif ( !documentElement && doc.createElement ) {\n\t\t\t(function() {\n\t\t\t\tvar html = doc.createElement('html');\n\t\t\t\tvar head = doc.createElement('head');\n\t\t\t\thead.appendChild( doc.createElement('title') );\n\t\t\t\thtml.appendChild( head );\n\t\t\t\thtml.appendChild( doc.createElement('body') );\n\t\t\t\tdoc.appendChild( html );\n\t\t\t})();\n\t\t}\n\n\t\t// Find all the unique elements\n\t\tif ( doc.getElementsByTagName ) {\n\t\t\tfor ( var i in one ) {\n\t\t\t\tone[ i ] = doc.getElementsByTagName( i )[0];\n\t\t\t}\n\t\t}\n\n\t\t// If we're working with a document, inject contents into\n\t\t// the body element\n\t\tvar curParentNode = one.body;\n\n\t\tnew HTMLParser( html, {\n\t\t\tstart: function( tagName, attrs, unary ) {\n\t\t\t\t// If it's a pre-built element, then we can ignore\n\t\t\t\t// its construction\n\t\t\t\tif ( one[ tagName ] ) {\n\t\t\t\t\tcurParentNode = one[ tagName ];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar elem = doc.createElement( tagName );\n\n\t\t\t\tfor ( var attr in attrs ) {\n\t\t\t\t\telem.setAttribute( attrs[ attr ].name, attrs[ attr ].value );\n\t\t\t\t}\n\n\t\t\t\tif ( structure[ tagName ] && typeof one[ structure[ tagName ] ] !== 'boolean' ) {\n\t\t\t\t\tone[ structure[ tagName ] ].appendChild( elem );\n\t\t\t\t}\n\t\t\t\telse if ( curParentNode && curParentNode.appendChild ) {\n\t\t\t\t\tcurParentNode.appendChild( elem );\n\t\t\t\t}\n\n\t\t\t\tif ( !unary ) {\n\t\t\t\t\telems.push( elem );\n\t\t\t\t\tcurParentNode = elem;\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: function( //tag ) {\n\t\t\t\telems.length -= 1;\n\n\t\t\t\t// Init the new parentNode\n\t\t\t\tcurParentNode = elems[ elems.length - 1 ];\n\t\t\t},\n\t\t\tchars: function( text ) {\n\t\t\t\tcurParentNode.appendChild( doc.createTextNode( text ) );\n\t\t\t},\n\t\t\tcomment: function( // ) {\n\t\t\t\t// create comment node\n\t\t\t},\n\t\t\tignore: function( // ) {\n\t\t\t\t// What to do here?\n\t\t\t}\n\t\t});\n\n\t\treturn doc;\n\t};*/\n\n\tfunction makeMap(str) {\n\t\tvar obj = {}, items = str.split(',');\n\t\tfor ( var i = 0; i < items.length; i++ ) {\n\t\t\tobj[ items[i] ] = true;\n\t\t\tobj[ items[i].toUpperCase() ] = true;\n\t\t}\n\t\treturn obj;\n\t}\n}","Att": "function (fname,rtype) {\n\t//return undefined;\n\t\n\t// Returns attach in appropriate format, defined by rtype,\n\t// \"url\" returns session or data URL,\n\t// \"data\" returns data URL.\n\t// If rtype is object {content_type:\"mime/type\", data:\"b64\"},\n\t// appends this object to doc attachments.\n\t\n\tvar that = this,\n\t\t\tu = that.SessionUrls || (that.SessionUrls = {}),\n\t\t\td = that.data.doc,\n\t\t\ta = d._attachments || (d._attachments = {}),\n\t\t\tpending = that.PendingUrls || (that.PendingUrls = {});\n\t\n\t// Store\n\tif (fname && Object.isObject(rtype)) {\n\t\ta[fname] = rtype;\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t\treturn a;\n\t}\n\t\n\t// Recalc atts\n\tif (fname === true) {\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t}\n\t\n\tif (fname == null) return a;\n\t\n\tif (rtype == \"session\") return u;\n\t\n\tif (rtype==\"url\" && u[fname]) return u[fname];\n\telse {\n\t\tvar pi = $.Deferred(),\n\t\t\t\tid = that.data.doc._id,\n\t\t\t\tdb = that.db;\n\t\t\n\t\tif (!id) pi.reject();\n\t\telse {\n\t\t\t\n\t\t\t//-------------------\n\t\t\t\n\t\t\tif (rtype==\"url\") {\n\t\t\t\t\n\t\t\t\tif (a && a[fname] && a[fname].data) {\n\t\t\t\t\treturn 'data:'+a[fname].content_type+';base64,'+a[fname].data;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (pending[fname]) {\n\t\t\t\t\tpi.resolve();\n\t\t\t\t\treturn pending[fname];\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tpending[fname] = pi.promise();\n\t\t\t\t\tcw.db(that.db.name)\n\t\t\t\t\t.getAttachment(id, fname)\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\tvar url = URL.createObjectURL(blob);\n\t\t\t\t\t\t\tu[fname] = url;\n\t\t\t\t\t\t\tpi.resolve(url);\n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ \n\t\t\t\t\t\t\tpi.reject(); \n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//-------------------\n\t\t\t\n\t\t\telse if (rtype==\"data\") {\n\t\t\t\t\n\t\t\t\tif (a && a[fname] && a[fname].data) {\n\t\t\t\t\tpi.resolve (a[fname].data);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.db(that.db.name).getAttachment(id, fname)\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ pi.resolve(data); });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(); }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//-------------------\n\n\t\t\telse if (rtype == \"preview\") {\n\t\t\t\tvar names = [],\n\t\t\t\t\t\tres = [];\n\t\t\t\tif (Object.isString(fname)) names.push(fname);\n\t\t\t\telse if (Object.isArray(fname)) names = fname;\n\t\t\t\telse if (Object.isRegExp(fname)) {\n\t\t\t\t\tnames = Object.keys(a).filter(fname).sortBy();\n\t\t\t\t}\n\t\t\t\tif (!names.length) pi.resolve([]);\n\t\t\t\telse {\n\t\t\t\t\tvar icos = d.previews || (d.previews = {}),\n\t\t\t\t\t\t\tsubnames = Object.keys(icos).intersect(names);\n\t\t\t\t\tif (subnames.length == names.length) {\n\t\t\t\t\t\t// we have all previews\n\t\t\t\t\t\tnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// we have to generate previews\n\t\t\t\t\t\tsubnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar missing = names.subtract(subnames),\n\t\t\t\t\t\t\t\tpis = [];\n\t\t\t\t\t\t\n\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\tvar pi0 = $.Deferred();\n\t\t\t\t\t\t\tpis.push(pi0);\n\t\t\t\t\t\t\tif (a[i] && a[i].data) {\n\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, a[i].data, pi0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// load attach\n\t\t\t\t\t\t\t\tcw.db(that.db.name).getAttachment(id, i)\n\t\t\t\t\t\t\t\t.then (\n\t\t\t\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ \n\t\t\t\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, data, pi0);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfunction(){ pi0.resolve(null); }\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}); // end forEach\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now pis is list of promises\n\t\t\t\t\t\t$.when.apply(null, pis)\n\t\t\t\t\t\t.done(function(){\n\t\t\t\t\t\t\tfor (var t, j=0; j<arguments.length;j++) {\n\t\t\t\t\t\t\t\tvar t = arguments[j];\n\t\t\t\t\t\t\t\tif (t != null) icos[t.fname] = t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\t\tif (icos[i]) res.push(icos[i]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tres.sortBy('fname');\n\t\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn pi.promise();\n\n\t\t// - - - - - - - - - - - - - - - \n\n\t\tfunction _genPreview(name,mime, data, pi0){\n\t\t\tvar $i = $('<img src=\"\"/>'),\n\t\t\t\t\tpv = {\n\t\t\t\t\t\tfname:name,\n\t\t\t\t\t\tsize:'?',\n\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\tdim:'?×?',\n\t\t\t\t\t\tdata:''\n\t\t\t\t\t};\n\t\t\t$i.attr(\"src\",'data:'+mime+';base64,'+data);\n\t\t\t$i.load(function(){\n\t\t\t\tvar ico, \n\t\t\t\t\t\timg = cw.lib.image($i,\"white\");\n\t\t\t\tpv.dim = img.width() + '×'+ img.height();\n\t\t\t\tvar l = (data.length/4*3).round();\n\t\t\t\tpv.size = l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\";\n\t\t\t\tico = img.resample(150);\n\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height());\n\t\t\t\tpv.data = ico.sharpen(0.2).contrast(1.05).jpeg(0.65);\n\t\t\t\t$i.remove();\n\t\t\t\tpi0.resolve(pv);\n\t\t\t});\n\t\t} \n\t}\n\t\n}"},"raw": {"name": "DdocLab.Editor","title": "Ddoc Lab","version": "2.4","build": 38,"com": [{"stamp": "1408670524235","id": "Root","type": "js","data": "({\n\t// Ddoc Lab, Main Editor\n\t// (c) 2018 ermouth\n\t\n\tVersion:\"2.4\",\n\t\n\tparams:{restyle:200},\n\trequire:[{\n\t\tUglifyJS:\t'lib/uglify.js', \n\t\tQ:\t\t\t\t'lib/q.js',\n\t\tless:\t\t\t'lib/less.js' \n\t}],\n\t\n\texpose:[\"GetDoc\",\"GetActiveId\",\"RT\",\"Path\",\"GenId\",\"getDup\",\"Confirm\",\"db\",\"Att\"],\n\t\n\tcreds:{},\n\tSearch:\"\",\n\tList:[],\n\tTablist:[],\n\tActive:\"\", // active item\n\tExpanded:{},\t// list of expanded branches\n\t\n\tRT: function(){ return this; },\n\tGetDoc: function(){ return this.data.doc; },\n\tGenId: function(){return $.my.f.sdbmCode(Date.now()+Number.random(1e11, 1e18))},\n\tGetActiveId: function(){ return this.Active; },\n\t\n\tMemoTabs: function(){\n\t\tvar that=this, d = that.data.doc, di = d.items, a=[]; \n\t\ta.push(that.Path(that.List[0]));\n\t\tthat.Tablist.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (p!=a[0] && elt.data.length<50000) a.push(p);\n\t\t});\n\t\td.tabs = a;\n\t},\n\t\n\tPath: function(item, name) {\n\t\tvar sep = item.folder.to(1);\n\t\treturn name!=null?name:item.folder+(item.folder.length>1?sep:\"\")+item.name;\n\t},\n\t\n\tSessionUrls:{},\n\tdie: function(){\n\t\tvar u = this.SessionUrls;\n\t\t// Free resources \n\t\tObject.keys(u).forEach(function(i){ \n\t\t\tURL.revokeObjectURL(u[i]);\n\t\t});\n\t}\n\t\n})","active": true,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1432412784244","id": ".init","type": "js","data": "(function ($o, form) {\n\tvar i, j, that = this, \n\t\t\td = form.data.doc,\n\t\t\titems = d.items,\n      Iman;\n  \n  // Color Picker\n  var CPid = 'cw.Sys.Colorpicker';\n  that.ColorPicker = that.db.form(CPid) || $.my.cache(CPid);\n  \n  // Mount Inliner\n  if (that.db && that.db.form) {\n  \tIman = that.db.form('cw.Inliner');\n    if (Iman.Version < '4.0') Iman = null;\n  }\n  if (!Iman) Iman = $.my.cache('cw.Inliner');\n \t\n  that.Types.rtf.extend.Inliner = $.extend( true, {}, Iman || {});\n\n\t$o.formgen('init', that.HTML);\n\t\n\t// Parser\n\t//if (!window.HTMLParser)\n\tthat.HTMLParser(that);\n\t\n\t// CM-related stuff\n\tthat.InitCM();\n\t\t\n\t// Busy\n\tif (!that.app) that.app = {};\n\tif (!that.app.busy) {\n\t\tthat.app.busy = function(a){\n\t\t\t$o.toggleClass(\"cw-app-busy\", !!a);\n\t\t}\n\t}\n\n\t// prepare doc if it’s empty\n\tif (!d.items.length) {\n\t\td.items.push( \t$.extend(true, {},that.Item.data, {id:that.GenId()}) );\n\t}\n\n\t// extend runtime\n\tthat.AddItem.Typelist = Object.keys(that.Types).remove(\"attachment\");\n\t\n\t// correct doc\n\tif (d.s3) that.S3toCouch(d);\n\t\n\t// restore tabs\n\tif (Object.isArray(d.tabs) && d.tabs.length) {\n\t\tvar tabs = cw.lib.a2o(d.tabs);\n\t\td.items.forEach(function(elt){\n\t\t\tvar p = that.Path(elt);\n\t\t\tif (tabs[p]) tabs[p] = elt;\n\t\t});\n\t\t\n\t\td.tabs.forEach(function(k,i) {\n\t\t\tvar t = tabs[k];\n\t\t\tif (\n\t\t\t\tObject.isObject(t)\n\t\t\t\t&& t.id\n\t\t\t\t&& (\n\t\t\t\t\t(t.state && t.state.savedSdbm != t.state.sdbm)\n\t\t\t\t\t|| !i\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tthat.Tablist.push(t);\n\t\t\t}\n\t\t});\n\t\tif (that.Tablist[0]) that.List.push(that.Tablist[0]);\n\t\tthat.Active = that.List[0].id;\n\t} \n\t\n\t\n\t// Expanded branches restore\n\t\n\tif (Object.isObject(d.expanded)){\n\t\tthat.Expanded = $.extend(!0, true, d.expanded);\n\t}\n\t\n\t\n\t// If stiil nothing to open – open first item\n\t\n\tif (!that.List.length) {\n\t\tthat.Active = d.items[0].id;\n\t\tthat.List.push(d.items[0]);\n\t\tthat.Tablist.push(d.items[0]);\n\t}\n\t\n\t\n\t// Dup searcher\n\tthat.getDup = function (item, name0) {\n\t\tvar i,e, ename, fname = that.Path(item, name0), u=false;\n\t\tfor (var i=0;i<d.items.length && !u; i++) {\n\t\t\te = d.items[i];\n\t\t\tename = that.Path(e);\n\t\t\tif (e.id!==item.id && ename===fname) u = e.type;\n\t\t}\n\t\treturn u;\n\t};\n\n\t//remember mimes\n\tfor (i=0;i<d.items.length;i++) {\n\t\tj = d.items[i];\n\t\tif (j.type===\"attachment\" && !j.mime) {\n\t\t\tj.mime = d._attachments[(j.folder?j.folder+\"/\":\"\")+j.name+\".\"+j.ext].content_type;\n\t\t}\n\t\tif (!j.state) j.state = {savedSdbm:\"\",sdbm:\"\",depends:{},impacts:{}};\n\t\tdelete j.savedSdbm; delete j.depends;\n\t}\n\t\n\t// Prepare Inliner\n\t\n\tvar Rtf = that.Types.rtf.extend;\n\tRtf.Inliner.T.img.Opts.style[' .tag-in-fmt'] =\n\tRtf.Inliner.T.embed.Opts.style[' .tag-in-fmt'] =\n\tRtf.style[' .tag-in-fmt'] = $.extend(true,{}, Rtf.Inliner.style[' .tag-in-fmt']);\n\t//Rtf.Inliner.Ed.doc.style = $.extend(true,{}, Rtf.Inliner.Ed.Theme);\n\n\t// 'delete item' event handler\n\n\t$o.on(\"delitem.my\", function(evt, item){\n\t\tvar ipos = d.items.findIndex(_find),\n\t\t\t\tlpos = that.List.findIndex(_find),\n\t\t\t\tfname = that.Path(item);\n\t\tif (d.items.length>1) {\n\t\t\t\n\t\t\tif (item.type==\"rtf\" || item.type==\"inliner\") {\n\t\t\t\t// del sub images\n\t\t\t\td.items.remove(_findDeps);\n\t\t\t\tthat.List.remove(_findDeps);\n\t\t\t\tthat.Tablist.remove(_findDeps);\n\t\t\t}\n\t\t\t\n\t\t\td.items.removeAt(ipos);\n\t\t\tthat.List.removeAt(lpos);\n\t\t\tthat.Tablist.removeAt(that.Tablist.findIndex(_find));\n\t\t\tif (d._attachments && d._attachments[fname.from(1)]) \n\t\t\t\tdelete d._attachments[fname.from(1)];\n\t\t\tthat.Expanded[item.id] = false;\n\t\t\t\n\t\t\tif (!that.Tablist) that.Tablist.push(d.items[0]);\n\n\t\t\tif (!that.List.length) that.List.push(that.Tablist[0]);\n\t\t\t\n\t\t\tthat.Active = that.List[0].id;\n\t\t\t$o.find(\"#items\").trigger(\"recalc\");\n\t\t}\n\t\telse {\n\t\t\t(window.l||cw.lib).note(\"Can’t remove last resource.\",\"error\");\n\t\t}\n\n\t\tfunction _find (e) { return e.id == item.id; }\n\t\tfunction _findDeps (e) { return (e.type==\"attachment\" && e.folder==\"/inliner\" && e.name.startsWith(item.id+\"/\"));}\n\t});\n  \n  // save request event handler\n  \n  $o.on('saveproject.my', function(){\n  \t$o.find('#nav #btn-save').trigger('click');\n  }.debounce(50));\n\n})","active": false,"opts": [],"err": [],"color": ["violet"]},{"stamp": "1408678731282","id": ".data","type": "js","data": "({\n\tdoc:{\n\t\t_id:\"\",\n\t\tname:\"Untitled project\",\n    tags:[],\n\t\ttype:\"ddlab\",\n\t\towners:[],\n\t\tpreviews:{},\n\t\tacl:[],\n\t\t\"export\":{\n\t\t\t\tpath:\"\",\n\t\t\t\toptions:[\"extend\"],\n\t\t\t\tlastrev:\"\",\n\t\t\t\tlastcrc:\"\"\n\t\t},\n\t\titems:[],\n\t\ttabs:[],\n\t\texpanded:{},\n\t\tcreds:{\n\t\t\tcrypto:\"\"\n\t\t},\n\t\t\n\t\tcouch:{\n\t\t\tdburl:\"\",\n\t\t\tdocid:\"\",\n\t\t\tlogin:\"\",\n\t\t\tpwd:\"\"\n\t\t},\n\t\t\n\t\tsite:{\n\t\t\tsiteBase:\"\",\n\t\t\tpreviewBase:\"\"\n\t\t},\n\t\tlog:[]\n\t},\n\tcmd:\"\"\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1409438648501","id": ".ui","type": "js","data": "({\n\n\t\"#navlogo\":{\n\t\tbind: function(d, v, $o){\n\t\t\tif (v!=null) {\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:$.extend(!0,{RT:this.RT},this.About),\n\t\t\t\t\tesc:true\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn this.files[\"logo70.png\"].url;\n\t\t},\n\t\tevents:\"click.my\",\n\t},\n\t\n\t\"#search\":{\n\t\tdelay:150,\n\t\tbind:\"this.Search\",\n\t\tcss: { \t\"my-search\": /^.{2,}$/ },\n\t\trecalc:\"#ilist\"\n\t},\n\t\n\t\"#sname\":{\n\t\tbind: function(d){\n\t\t\tvar css = \"bold mt8 fs105 oh nw dib\",\n\t\t\t\t\tcdb = this.GetSettings(\"couch\"),\n\t\t\t\t\tcouch = cdb.dburl.replace(/\\/$/,'')+'/',\n\t\t\t\t\tid = cdb.docid,\n\t\t\t\t\turl = !(couch.from(1) || id)?\"\":couch+id;\n\t\t\t\n\t\t\tif (url) return '<a target=\"_blank\" href=\"'+url+'\" '\n\t\t\t\t+' title=\"Open remote doc in new tab\"'\n\t\t\t\t+' class=\"pseudolink o80 '+css+'\" style=\"max-width:100%;text-overflow: ellipsis;\">'\n\t\t\t\t+(d.doc.name||\"Untitled\")//.truncate(18,\"right\",\"…\")\n\t\t\t\t+'</a>';\n\t\t\telse return '<div style=\"max-width:100%;text-overflow: ellipsis;\" class=\"gray '+css+'\">'+(d.doc.name||\"Untitled\")+'</div>';\n\t\t\t\n\t\t}\n\t},\n\t\n\t\"#btn-params\":{\n\t\tbind: function(d,v, $o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\telse $o.modal({\n\t\t\t\t\tmanifest:that.DocParams,\n\t\t\t\t\tdata:$.extend(true,{},\n\t\t\t\t\t\tObject.select(d.doc,'name tags s3 couch site owners creds _attachments items export'.split(' '))\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\twidth: 525,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tcss:\"fs90\",\n\t\t\t\t\tscreen:'rgba(255,255,255,0.5)',\n\t\t\t\t\tbound:10\n\t\t\t\t})\n        .then(function(res){\n\t\t\t\t\t$.extend(true, d.doc, res);\n          if (!res.couch.docid) {\n          \td.doc.pic = 'data:image/svg+xml;base64,'+cw.lib.base64(that.Icons.Component);\n          }\n          else {\n          \tdelete d.doc.pic;\n          }\n\t\t\t\t\tres.items = null; res._attachments=null;\n\t\t\t\t\tfor (var i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\td.doc.items[i].state.savedSdbm = '';\n\t\t\t\t\t\td.doc.items[i].state.remote = '';\n\t\t\t\t\t}\n          that.my.check('#sname');\n          that.my.check('#ilist');\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t\"self:red\":function(d){\n\t\t\t\tvar obj = this.GetSettings(\"couch\");\n\t\t\t\treturn (!obj.docid || !obj.dburl || (obj.login && !obj.pwd));\n\t\t\t}\n\t\t},\n\t\twatch:\"#sname\"\n\t},\n\t\"#btn-addpic\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.AddImage,\n\t\t\t\t\twidth:820,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tdata:{},\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t})\n        .then(function(res){\n\t\t\t\t\tvar item = $.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{}, \n\t\t\t\t\t\tthat.Types.attachment.manifest.data,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid:that.GenId(), \n\t\t\t\t\t\t\tfolder:/^[\\.\\/]/.test(res.folder)?res.folder:\"/\"+res.folder,\n\t\t\t\t\t\t\tname:res.filename,\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"\",\n\t\t\t\t\t\t\tmime:res.mime,\n\t\t\t\t\t\t\tpreview:res.preview,\n\t\t\t\t\t\t\tsize:res.data.length/4*3\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\td.doc._attachments[that.Path(item).from(1)] = {content_type:res.mime, data: res.data};\n\t\t\t\t\td.doc.items.push(item);\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t\t//console.log(res);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t/*\"#btn-addfile\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(!0,  that.AddFile, {RT:that.RT, getDup:that.getDup, Types:that.Types}),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, \n\t\t\t\t\t\t{doc:d.doc}, \n\t\t\t\t\t\t{item:that.Types.attachment.manifest.data}, \n\t\t\t\t\t\t{item:{\n\t\t\t\t\t\t\tid:that.GenId(), name:\"\",\n\t\t\t\t\t\t\ttype:\"attachment\", ext:\"—\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\twidth: 535,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t})\n        .then(function(res){\n\t\t\t\t\tvar path, dup, i;\n\t\t\t\t\tres.item.data = \"File\";\t\n\t\t\t\t\tres.item.mime = res.file.content_type;\n\t\t\t\t\tres.item.size = res.file.size;\n\t\t\t\t\tif (res.file && res.file.data) {\n\t\t\t\t\t\tpath = that.Path(res.item).from(1);\n\t\t\t\t\t\tif (!d.doc._attachments) d.doc._attachments = {};\n\t\t\t\t\t\td.doc._attachments[path] = res.file;\n\t\t\t\t\t\tfor (i=0;i<d.doc.items.length;i++) {\n\t\t\t\t\t\t\tif (that.Path(d.doc.items[i]).from(1) == path) dup = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (null!=dup) d.doc.items[dup] = $.extend(true, {}, res.item);\n\t\t\t\t\t\telse d.doc.items.push($.extend(true, {}, res.item));\n\t\t\t\t\t}\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},*/\n\t\"#btn-additem\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:$.extend(\n\t\t\t\t\t\ttrue,  that.AddItem, \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgetDup:that.getDup,\n\t\t\t\t\t\t\tTypes:that.Types,\n\t\t\t\t\t\t\tRT: function(){ return that; }\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\ttrue, {}, that.Item.data, \n\t\t\t\t\t\t{id:that.GenId(),name:\"\",ext:\"\",folder:\".\",type:\"js\",mime:\"text/javascript\"}\n\t\t\t\t\t),\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true\n\t\t\t\t}).then(function(res){\n\t\t\t\t\t$.extend(res, that.Types[res.type].defaults||{});\n\t\t\t\t\tres.mime = that.Types[res.type].mime;\n\t\t\t\t\t//console.log(res);\n\t\t\t\t\td.doc.items.push($.extend(true, {}, res));\n\t\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-save\":{ /*See tab*/ },\n\t\"#btn-close\":{\n\t\tbind:function(d,v,$o){\n\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t}\n\t},\n\t/*\"#btn-view\":{\n\t\tbind: function(d,v,$o){\n\t\t\tvar base = d.doc.site.previewBase;\n\t\t\t$o.attr(\"href\", (base?base.replace(/\\/$/,'')+\"/index.html\":\"\"));\n\t\t},\n\t\twatch:\"#sname\",\n\t\tcss:{\n\t\t\thide:function(d,v,$o){$o.parent().toggleClass(\"hide\",!d.doc.site.previewBase)}\n\t\t}\n\t},*/\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1408681622106","id": ".ui.#ilist","type": "js","data": "({\n\tdelay:50,\n\t\n\t//- - - - - - - - - - - - - - - - - - - - -\n\t\n\tinit: function($o, form){\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t\n\t\t$o.on(\"click.my\", \".siteitem\", function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.attr(\"id\").from(3),\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (!item) {\n\t\t\t\tif (that.Expanded[id]) that.Expanded[id] = false;\n\t\t\t\telse that.Expanded[id] = true;\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t\telse /*if (item.type!=\"attachment\")*/ {\n\t\t\t\tthat.Active = id;\n\t\t\t\tif (item.folder) that.Expanded[item.folder] = true;\n\t\t\t\tif ( (idx = that.List.indexOf(item)) !== -1) {\n\t\t\t\t\tthat.List.removeAt(idx);\n\t\t\t\t} \n\t\t\t\tthat.List.unshift(item);\n\t\t\t\tif (that.Tablist.indexOf(item)==-1) that.Tablist.unshift(item);\n\t\t\t\t$o.trigger(\"check\");\n\t\t\t}\n\t\t})\n\t},\n\t\n\t///- - - - - - - - - - - - - - - - - - - - -\n\t\n\tbind:function(d,v,$o) {\n\t\tvar that = this, \n\t\t\t\ti, e, html=\"\",\n\t\t\t\tlist = d.doc.items, \n\t\t\t\tres = [], fl = \"\",\n\t\t\t\tisSearch = that.Search && that.Search.length>1;\n\n\t\t// sort list\n\t\tlist = list.sortBy(function(e){\n\t\t\treturn [\n\t\t\t\te.folder.to(1),\n\t\t\t\t(!!e.folder.from(1)) *1,\n\t\t\t\te.folder,\n\t\t\t\te.snippet*1,\n\t\t\t\te.name,e.type\n\t\t\t].join(\"/\").toLowerCase();\n\t\t});\n\t\t\n\t\tif (isSearch) {\n\t\t\t// filter list\n\t\t\tvar re = new RegExp (RegExp.escape(that.Search), \"i\");\n\t\t\tlist = list.filter(function(e){\n\t\t\t\treturn re.test(e.name) || re.test(e.folder) || re.test(e.data);\n\t\t\t});\n\t\t}\n\t\t\n\t\t// gen items/folders final list\n\t\tfor (i=0; i<list.length; i++) {\n\t\t\te = list[i];\n\t\t\tif (e.folder && e.folder != fl) {\n\t\t\t\tfl = e.folder;\n\t\t\t\tres.push({\n\t\t\t\t\tid:fl,\n\t\t\t\t\thtml: '<span class=\"dib w12 fs60 '\n\t\t\t\t\t\t//+(that.Expanded[fl] || isSearch?\"▾\":\"▸\")\n          \t+(that.Expanded[fl] || isSearch?'blue2\">▼':'gray2\">►')\n\t\t\t\t\t\t+'</span>'\n\t\t\t\t\t\t+(e.folder==\"/\"\n\t\t\t\t\t\t\t?'<span class=\"fi-folder o50 blue mr1 \"></span> <b class=\"fs105 o90\">Attachments</b>'\n\t\t\t\t\t\t\t:e.folder==\".\"\n\t\t\t\t\t\t\t?'<span class=\"fi-align-left o50 blue mr1 \"></span> <b class=\"fs105 o90\">Doc root</b>'\n\t\t\t\t\t\t\t:fl.to(1)//+\"&thinsp;\"\n\t\t\t\t\t\t)\n\t\t\t\t\t\t+fl.from(1),\n\t\t\t\t\tcss:'xgray bolder fs95',\n\t\t\t\t\ttype:\"folder\"\n\t\t\t\t});\n\t\t\t} \n\t\t\tif (isSearch || (!e.folder || that.Expanded[e.folder])) {\n\t\t\t\tvar isdirty = (!e.state.savedSdbm || e.state.sdbm == \"Z\"  || (e.state.sdbm!==e.state.savedSdbm)),\n            ex = e.external;\n\t\t\t\tres.push({\n\t\t\t\t\tid:e.id,\n\t\t\t\t\thtml: '&nbsp;'\n\t\t\t\t\t\t+ e.name\n\t\t\t\t\t\t+(e.ext?\".\"+e.ext:\"\")\n          \t+ (e.parserActive?'<span class=\"fs90 ml4\">&gt;</span> ':'')\n\t\t\t\t\t\t+ (isdirty?'<span class=\"blue2 ml4\">•</span>':'')\n\t\t\t\t\t\t+ (e.type===\"attachment\"?' <span class=\"fi-paperclip blue1 fs95\"></span>':''),\n          css: (\n            e.snippet? \n              (ex?(ex.to(1).trim()?'orange-2 o70':'orange-2 o60 tdl') : 'gray') \n              : \n              (ex?(ex.to(1).trim()?'orange o90':'orange o80 tdl') : 'xgray')\n            )\n\t\t\t\t\t\t+ (e.id == that.Active?\" bg-active\":\"\"),\n\t\t\t\t\ttype:e.snippet?\"snippet\":\"item\",\n\t\t\t\t\ttitle: e.folder+\"/\"+e.name+(e.ext?\".\"+e.ext:\"\"),\n\t\t\t\t\tfolder: e.folder\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t// render list\n\t\tfor (i=0;i<res.length;i++) {\n\t\t\te = res[i];\n\t\t\thtml+='<div class=\"siteitem w200 oh '+e.css+(e.folder?\" pl12\":\"\")\n\t\t\t\t+'\" id=\"sx-'+e.id+'\" title=\"'\n\t\t\t\t+(e.title?e.title:\"\")+'\">'\n\t\t\t\t+e.html\n\t\t\t\t+'</div>';\n\t\t}\n\t\treturn html;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1408800142685","id": ".ui.#items","type": "js","data": "({\n\tbind:\"this.List\",\n\tmanifest: function (e){\n\t\tvar that = this,\n\t\t\t\tman = {},\n\t\t\t\tT = that.Types[e.type];\n\t\t\n\t\tif (!T.manifest) {\n\t\t\t$.extend( true,  man,  that.Item, T.extend );\n\t\t\t$.extend (man, T.replace)\n\t\t} \n\t\telse {\n\t\t\t$.extend( true, man,  T.manifest );\n\t\t}\n\t\t\n\t\treturn man;\n\t},\n\tinit: function($o, form){\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t\n\t\t// Render tab preview\n\t\t\n\t\t$o.on(\"click.my\", \"#btn-rendertab\", function(evt){\n\t\t\tvar $c = $(evt.currentTarget), fd, path;\n\n\t\t\t\t\tfd = $c.my().root.my(\"data\");\n\t\t\t\t\tpath = that.Path(fd);\n\t\t\t\n\t\t\tif (true || !fd.snippet) {\n\t\t\t\tthat.Build($.extend(true, {}, d.doc), {\n\t\t\t\t\tpick:path, \n\t\t\t\t\tresolve:false,\n\t\t\t\t\tbuttons:true,\n\t\t\t\t\tsilent:true\n\t\t\t\t}, $c)\n\t\t\t\t.then(function(a){\n\t\t\t\t\tvar mod;\n\t\t\t\t\tif (path.to(1) == \"/\") {\n\t\t\t\t\t\tvar att = (a.result._attachments||{})[path.from(1)],\n\t\t\t\t\t\t\t\tmime;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (att) {\n\t\t\t\t\t\t\tmime = att.content_type;\n\t\t\t\t\t\t\tif (/^text\\/|(javascript|xml|xhtml|json)$/.test(mime)) {\n\t\t\t\t\t\t\t\t// we have text format\n\t\t\t\t\t\t\t\tmod = {\n\t\t\t\t\t\t\t\t\t//json:cw.lib.base64(att.data,true)\n\t\t\t\t\t\t\t\t\tjson:decodeURIComponent(escape(window.atob(att.data)))\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (/javascript$/.test(mime)) {\n\t\t\t\t\t\t\t\t\tvar parsed = that.ParseJS(mod.json, true);\n\t\t\t\t\t\t\t\t\tif (parsed.errors.length) {\n\t\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\t\tmod.comment+='<span class=\"red\">'+parsed.errors.join(\"; \")+'</span><br/>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (parsed.globals.length) {\n\t\t\t\t\t\t\t\t\t\tmod.comment=(mod.comment||\"\");\n\t\t\t\t\t\t\t\t\t\tmod.comment+='Globals: '+parsed.globals.join(\", \");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (mod.comment) mod.comment = '<div class=\"mt10\">'+mod.comment+'</div>';\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_modal(mod);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else if (/^image\\//.test(mime)) {\n\t\t\t\t\t\t\t\t// we have image\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// we have something else\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcw.lib.note(\"Can’t build attachment.\",\"error\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_modal({\n\t\t\t\t\t\t\tjson:cw.lib.json(cw.lib.getref(a.result, path.from(1)), \"  \")\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t\t\n\t\t\t//- - - - - -\n\t\t\t\n\t\t\tfunction _modal(data){\n\t\t\t\treturn $c.modal({\n\t\t\t\t\tmanifest:that.Takeout,\n\t\t\t\t\tdata:data,\n\t\t\t\t\twidth:600,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tbound:10\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t});\n\t},\n\tlist:'<div class=\"s3item\"></div>',\n\tcheck:true,\n\tid:function(e){return e.id},\n\thash: function(e, i){\n\t\tvar h =  (e.id===this.Active?(this.Search.length+1)+\"-\":\"0-\");\n\t\th+= $.my.f.sdbmCode(Object.reject(e,[\"data\",\"resolved\"]));\n\t\t//h+= this.Search?\"-1\":\"-0\"\n\t\treturn h;\n\t},\n\tdelay:100,\n\trecalc:\"#ilist\",\n\twatch:\"#ilist\",\n\trecalcDepth:1\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1435806397558","id": ".ui.#tabs","type": "js","data": "({\n\tbind: \"this.Tablist\",\n\tinit: function($o, form){\n\t\t\n\t\tvar that = this, idx, \n\t\t\t\td = form.data.doc;\n\t\t\n\t\t$o.on('click.my', '#tabname', function(){\n\t\t\tvar $l = $(this),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.List.indexOf(item)==-1) that.List.unshift(item);\n\t\t\tthat.Active = id;\n      that.my.check('#ilist');\n\t\t}.debounce(5));\n\t\t\n\t\t$o.on(\"click.my\", \".btn-tabclose\", function(){\n\t\t\tvar $l = $(this).parent(),\n\t\t\t\t\tid = $l.my().data.id,\n\t\t\t\t\titem = d.items.find (function(e){\n\t\t\t\t\t\treturn e.id === id;\n\t\t\t\t\t});\n\t\t\tif (that.Tablist.length>1) {\n\t\t\t\tthat.Tablist.remove(function(e){return e===item});\n\t\t\t\tthat.List.remove(function(e){return e===item});\n\t\t\t\tif (!that.List.length) that.List.push(that.Tablist[0]);\n\t\t\t\tthat.Active = that.List[0].id;\n\t\t\t\t$o.my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t}\n\t\t}.debounce(100));\n\t\t\n\t\t$o.sortable();\n\t\t\n\t},\n\tmanifest:{\n\t\tinherit:[\"Path\",\"GetActiveId\"],\n\t\tui:{\n\t\t\t\"#tabname\":{\n\t\t\t\tbind:function(d){\n\t\t\t\t\tvar h = (d.state && d.state.sdbm!=d.state.savedSdbm)?'<span class=\"blue2 btn-tabdirty\">●</span>':'';\n\t\t\t\t\treturn this.Path(d)+h;\n\t\t\t\t},\n\t\t\t\tcss:{\n\t\t\t\t\t\"active\":function(d){return d.id == this.GetActiveId()}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tid:function(e){return e.id},\n\thash: function(e, i){\n\t\tvar h =  (e.id===this.Active?\"1\":\"0\")+$.my.f.sdbmCode(Object.reject(e,['data','doc']));\n\t\treturn h;\n\t},\n\tlist:[\n\t\t'<div class=\"vat dib cp tab-tab\">',\n\t\t\t'<span id=\"tabname\"></span>',\n\t\t\t'<span class=\"btn-tabclose\">×</span>',\n\t\t'</div>'\n\t].join(\"\"),\n\twatch:\"#ilist,#items\"\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1427645731624","id": ".ui.#btn-save","type": "js","data": "({\n\tdelay:150,\n\tbind:function(d,v,$o){\n\t\tvar that=this, err;\n\t\tif (v!=null) {\n\t\t\tthat.MemoTabs();\n\t\t\td.doc.expanded = $.extend(!0,{},that.Expanded);\n\t\t\t$o.trigger(\"commit\");\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1410663596232","id": ".ui.#btn-publish","type": "js","data": "({\n\t// Publish\t\n\t\n\tdelay:150,\t\n\tcss:{\n\t\t\":disabled\":function(d){\n\t\t\tvar obj = this.GetSettings(\"couch\");\n\t\t\treturn (!obj.docid || !obj.dburl || (obj.login && !obj.pwd));\n\t\t}\n\t},\n\t\n\twatch:\"#sname\",\n\t\n\tbind: function (d, v, $o){\n\t\tvar i, async = false,\n\t\t\t\tnote = cw.lib.note,\n\t\t\t\tthat = this,\n\t\t\t\trows, key,\n\t\t\t\terr = {}, atts2go,\n\t\t\t\terrors={},\n\t\t\t\t$root = $o.my().root,\n\t\t\t\toldhtml = $o.html(),\n\t\t\t\tproc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tproc = $.Deferred();\n\t\t\t$o.html('<span class=\"dib vat cw-busy w50 h8 br100 mt5\"></span>');\n\t\t\t$o.attr(\"disabled\", true);\n\t\t\tproc.then(\n\t\t\t\tfunction(msg, skipSave){\n\t\t\t\t\tcw.lib.note(msg || \"Published to CouchDB\",\"ok\");\n\t\t\t\t\tif (!skipSave)  {\n\t\t\t\t\t\td.doc.stamp = Date.now();\n\t\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t).always(function(){\n\t\t\t\t$o.attr(\"disabled\", false);\n\t\t\t\t$o.html(oldhtml);\n\t\t\t\tthat.CloseTabs(function(e){return e.folder==\"/inliner\" && e.type==\"attachment\"});\n\t\t\t\t$o.my().root.my(\"redraw\");\n\t\t\t});\n\t\t\t\n\t\t\t//-------\n\t\t\t\n\t\t\tthat.Build(d.doc, {\n\t\t\t\tbuttons:true, \n\t\t\t\tfooter:\"Above items won’t be included.\",\n\t\t\t\tcheckcreds:true\n\t\t\t}, $o)\n\t\t\t.then(function(a){\n\t\t\t\tatts2go = a;\n\t\t\t\t_getEnv ();\n\t\t\t})\n\t\t\t.fail(function(txt, msg, stack){\n\t\t\t\tproc.reject(txt, msg, stack);\n\t\t\t});\n\t\t}\n\t\t\n\t\t// - - - - - - -\n\t\t\n\t\tfunction _getEnv () {\n\t\t\t\n\t\t\tif (!Object.size(atts2go.upload)) {\n\t\t\t\tif (!Object.size(atts2go.err)) proc.resolve (\"All files are up to date, nothing to upload.\", true);\n\t\t\t\telse proc.reject (\"All files, scheduled to upload, have errors. Upload cancelled.\", \"error\");\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tthat.db.get(d.doc._id, {attachments:true})\n\t\t\t\t.then(\n\t\t\t\t\tfunction(odoc){\n\t\t\t\t\t\n\t\t\t\t\t\tif (!odoc) {\n\t\t\t\t\t\t\tproc.reject(\"Doc must be saved at least once before publishing.\", \"error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar ra, na, \n\t\t\t\t\t\t\t\tr = atts2go.result,\n\t\t\t\t\t\t\t\tu = atts2go.upload;\n\n\t\t\t\t\t\tif (Object.size(odoc._attachments)) {\n\t\t\t\t\t\t\tif (!r._attachments) atts2go.result._attachments = {};\n\t\t\t\t\t\t\tra = atts2go.result._attachments;\n\t\t\t\t\t\t\tna = odoc._attachments;\n\t\t\t\t\t\t\tObject.keys(na).forEach(function(i){\n\t\t\t\t\t\t\t\tif (!ra[i] || null==ra[i].data) {\n\t\t\t\t\t\t\t\t\tra[i] = {\n\t\t\t\t\t\t\t\t\t\tcontent_type:na[i].content_type,\n\t\t\t\t\t\t\t\t\t\tdata:na[i].data\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tu[\"/\"+i] = cw.lib.sdbm(na[i].digest);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_go()\n\t\t\t\t\t\t.then(function(msg,req){\n\t\t\t\t\t\t\tfor (var i=0;i<d.doc.items.length; i++) {\n\t\t\t\t\t\t\t\tvar item = d.doc.items[i];\n\t\t\t\t\t\t\t\tif (u[that.Path(item)] || item.snippet) {\n\t\t\t\t\t\t\t\t\tvar ssdbm = item.state.sdbm!=\"Z\" ? item.state.sdbm : u[that.Path(item)];\n\t\t\t\t\t\t\t\t\titem.state.savedSdbm = item.state.sdbm = ssdbm;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tproc.resolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(e,req){\n\t\t\t\t\t\t\tproc.reject(\"Failed to publish, see console\",e,req);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\tfunction (){\n\t\t\t\t\t\t\tproc.reject(\"Doc must be saved at least once before publishing.\", \"error\");\n\t\t\t\t\t});\t\t\t\t\n\t\t\t}\n\t\t}\n\n\t\t// - - - - - - - \n\n\t\tfunction _go(doc){\n\t\t\tvar pi = $.Deferred();\n\t\t\ttry {\n\t\t\t\tthat.Upload(d.doc, $o.my().root, atts2go)\n\t\t\t\t.then(function(msg) {\n\t\t\t\t\tpi.resolve(msg);\n\t\t\t\t})\n\t\t\t\t.fail(function(e,req){\n\t\t\t\t\tpi.reject(e,req);\n\t\t\t\t});\n\t\t\t} catch (e){\n\t\t\t\tpi.reject(e.message);\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\treturn pi.promise();\n\t\t}\n\t\t\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1435859483641","id": ".ui.#btn-validate","type": "js","data": "({\n\tdelay:150,\n\tbind:function(d,v,$o){\n\t\tvar that=this, errors = {}, tdoc;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\telse {\n\t\t\t\t\n\t\t\t\t//var tdoc = $.extend(true, {}, d.doc);\n\t\t\t\ttry {\n\t\t\t\tthat.Build(d.doc, {blocking:false}, $o)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(res){\n\t\t\t\t\t\t// here better go some kind of stats\n\t\t\t\t\t\tthat.CloseTabs(function(e){return e.folder==\"/inliner\" && e.type==\"attachment\"});\n\t\t\t\t\t\t$o.my().root.my(\"redraw\");\n\t\t\t\t\t},\n\t\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e.message, e.stack);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1432423490003","id": ".ui.#btn-render","type": "js","data": "({\n\tdelay:150,\n\tbind: function(d,v,$o){\n\t\tvar a,err, that = this,errors = {}, tdoc, key;\n\t\tif (v!=null) {\n\t\t\t\n\t\t\ttdoc = $.extend(true, {}, d.doc);\n\t\t\t\n\t\t\tthat.Build(tdoc, {\n\t\t\t\tsilent:true\n\t\t\t}, $o)\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\ta = res;\n\t\t\t\t\t_modal();\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t);\n\t\t\t\t\n\t\t\t//----\n\t\t\t// Modal\n\t\t\tfunction _modal () {\n\t\t\t\tvar json = $.my.tojson(a.result, '  '),\n\t\t\t\t\t\tobjurl = URL.createObjectURL(new Blob([json], {type : 'application/json'})),\n\t\t\t\t\t\tfname = (a.result._id+\"\").toLowerCase().replace(/[^a-z0-9\\-\\.]/g,\"-\")+\".json\";\n\n\t\t\t\t$o.modal({\n\t\t\t\t\tmanifest:that.Takeout,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tjson:json,\n\t\t\t\t\t\tobjurl: objurl,\n\t\t\t\t\t\tfname: fname\n\t\t\t\t\t},\n\t\t\t\t\twidth:800,\n\t\t\t\t\talign:\"top:100%\",\n\t\t\t\t\tnose:\"top\",\n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\tbound:10\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tjson=\"\";\n\t\t\t\t\tURL.revokeObjectURL (objurl);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1427647144826","id": ".ui.#btn-tar","type": "js","data": "({\n\tdelay:150,\n\t\n\tbind: function(d,v,$o) {\n\t\tvar a,err, that = this,errors = {}, tdoc, key;\n\t\t\n\t\tif (v!=null) {\n\t\t\t\n\t\t\ttdoc = $.extend(true, {}, d.doc);\n\t\t\t\n\t\t\tthat.Build(tdoc, {\n\t\t\t\tsilent:true\n\t\t\t}, $o)\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tvar i, \n\t\t\t\t\t\tT = that.Tar.Tar(),\n\t\t\t\t\t\ttar = new T(), \n\t\t\t\t\t\ta = res.result._attachments,\n\t\t\t\t\t\turl,r;\n\t\t\t\t\t\n\t\t\t\t\tif (Object.size(a)) {\n\n\t\t\t\t\t\tfor (i in a) {\n\t\t\t\t\t\t\tr = tar.append(i, that.Tar.Bytes(a[i].data));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\turl = URL.createObjectURL(new Blob([r], {type : 'application/x-tar'}));\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tconsole.log(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\t\tinit:[\n\t\t\t\t\t\t\t\t\t\t'<p class=\"mt10\">Tar archive of _attachments:</p>',\n\t\t\t\t\t\t\t\t\t\t'<div id=\"atar\" class=\"fs110 bold pb10\"></div>'\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\t\t\t\"#atar\": function(d){\n\t\t\t\t\t\t\t\t\t\t\tvar name = tdoc.name.replace(/[^a-z0-9\\.\\-]/ig,'-').replace(/\\-{2,}/g,'-').toLowerCase()+\".tar\",\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml = '<a download=\"' + name + '\" href=\"' + d.url +'\">' +name+'</a>';\n\t\t\t\t\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata:{url:url},\n\t\t\t\t\t\t\t\talign:\"top:102%\",\n\t\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\t\twidth:230,\n\t\t\t\t\t\t\t\tcss:\"fs85 tac xgray\",\n\t\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\t\tenter:true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfunction(txt, msg, stack){\n\t\t\t\t\tconsole.log(msg, stack);\n\t\t\t\t\tcw.lib.note(\"Can’t build doc. \"+txt,\"error\");\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1436646919376","id": ".ui.#btn-futon","type": "js","data": "({\n\tbind: function(d,v,$o) {\n\t\tvar that = this, \n\t\t\t\thref = \"\",\n\t\t\t\tcdb = that.GetSettings(\"couch\"),\n\t\t\t\tcouch = (cdb.dburl||\"\").replace(/\\/$/,'')+'/',\n\t\t\t\tid = cdb.docid;\n\t\t\n\t\tif (!id) id=\"\";\n\t\tif (couch==\"/\") return \"\";\n\t\telse return (\n\t\t\t'<span class=\"fi-database dib vat mt1 mb-1\"></span> <a target=\"_blank\" href=\"'\n\t\t\t+(\n\t\t\t\tid\n\t\t\t\t?(couch+id).replace(/^(http[s]?:\\/\\/[^\\/]+\\/)(.+)$/, \"$1_utils/document.html?$2\")\n\t\t\t\t:couch.replace(/^(http[s]?:\\/\\/[^\\/]+\\/)(.+)$/, \"$1_utils/database.html?$2\").replace(/\\/$/,'')\n\t\t\t)\n\t\t\t+'\">Futon</a>'\n\t\t);\n\t\t\n\t},\n\twatch:\"#sname\"\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1537487910740","id": ".ui.#btn-addfile","type": "js","data": "({\n  bind: function(d,v,$o){\n    var that = this;\n    if (v!=null) {\n\n      $o.modal({\n        manifest:$.extend(!0,  that.AddFiles, {RT:that.RT, getDup:that.getDup, Types:that.Types}),\n        data:$.extend(\n          true, \n          {doc:d.doc}, \n          {item:that.Types.attachment.manifest.data}, \n          {item:{\n            id:that.GenId(), name:\"\",\n            type:\"attachment\", ext:\"—\"\n          }}\n        ),\n        css:'p15',\n        esc:true,\n        enter:true,\n        width: 560,\n        global:true,\n        screen:true\n      })\n      .then(function(res){\n        \n        var files = res.files,\n            item0 = $.extend(\n              true, {}, \n              that.Types.attachment.manifest.data, \n              {id:'', name:\"\", type:\"attachment\", ext:\"—\"}\n            );\n        \n        if (files.length && !d.doc._attachments) d.doc._attachments = {};\n        \n        files.forEach(function(file){\n          \n          var item = $.extend(true, {}, item0, {\n            id:\t\t\tthat.GenId(),\n            name:\t\tfile.name,\n            folder: file.folder,\n            ext:\t\t'',\n            data:\t\t'File',\n            mime:\t\tfile.content_type,\n            size:\t\tfile.size\n          });\n          \n          var path = that.Path(item).from(1);\n          d.doc._attachments[path] = {\n            data:file.data,\n            content_type:\tfile.content_type,\n            length: file.size\n          };\n          \n          var i = 0, dup = -1;\n          for (i=0; i<d.doc.items.length && dup==-1; i++) {\n            if (that.Path(d.doc.items[i]).from(1) == path) dup = i;\n          }\n          if (dup>-1) d.doc.items[dup] = $.extend(true, {}, item);\n          else d.doc.items.push($.extend(true, {}, item));\n        });\n\n        $o.my(\"find\",\"#ilist\").trigger(\"check\");\n      });\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1408679397963","id": ".Types","type": "js","data": "({\n\t\"html\": { /* See tab */ },\n\t\n\t// ##############################\n\t\n\t\"js\": { /* See tab */ },\n\t\n\t// ##############################\n\t\n\t\"json\": {\n\t\tname:\"JSON\",\n\t\text:\"json\",\n\t\tmime:\"application/json\",\n\t\tstringify: function(e) { \n\t\t\t/*var t;\n\t\t\ttry { t = eval (\"(\"+e.data+\")\"); } catch (err) {}\n\t\t\tif (undefined != t) return $.my.tojson(t);*/\n\t\t\treturn e.data;\n\t\t},\n\t\ts2o:function(src) {\n\t\t\tvar o={};\n\t\t\to = eval(\"(\"+src+\")\");//JSON.parse(s);\n\t\t\treturn o;\n\t\t},\n\t\ts2s:function(src) {\n\t\t\tvar o={};\n\t\t\to = eval(\"(\"+src+\")\");\n\t\t\treturn $.my.tojson(o);\n\t\t},\n\t\tdestringify: function(s){\n\t\t\tvar o={};\n\t\t\ttry {\n\t\t\t\to = eval(\"(\"+s+\")\")//JSON.parse(s);\n\t\t\t} catch(e){\n\t\t\tconsole.log(e,s)\n\t\t\t}\n\t\t\treturn o;\n\t\t},\n\t\tdefaults:{ data:'({\\n\\t/* Put JSON here */\\n})' },\n\t\textend:{\n\t\t\tCMmode: function(d){\n\t\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\t\tif (d.noIncludes) s.mode = \"javascript\";\n\t\t\t\telse s.mode = \"ddjs\";\n\t\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\t\treturn s;\n\t\t\t},\n\t\t\tvalidator: function(d){\n\t\t\t\tvar r, f;\n\t\t\t\ttry {\n\t\t\t\t\tf = new Function([], \"return \"+d.data+\";\");\n\t\t\t\t\t$.my.tojson(f());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t\tf=null;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t},\n\t\treplace:{},\n\t\tmanifest:null\n\t},\n\t\n\t// ##############################\n\t\n\t\"css\": {\n\t\tname:\"CSS\",\n\t\text:\"css\",\n\t\tmime:\"text/css\",\n\t\tstringify: function(e) { return e.data+\"\"},\n\t\tdefaults:{ data:'/* CSS */' },\n\t\textend:{\n\t\t\tCMmode: function(d){\n\t\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\t\tif (d.noIncludes) s.mode = \"text/css\";\n\t\t\t\telse s.mode = \"ddcss\";\n\t\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\t\treturn s;\n\t\t\t}\n\t\t},\n\t\treplace:{},\n\t\tmanifest:null\n\t},\n\t\n\t\n\t// ##############################\n\t\n\t\"txt\": {\n\t\tname:\"Text\",\n\t\text:\"txt\",\n\t\tmime:\"text/plain\",\n\t\tstringify: function(e) { return e.data+\"\"},\n\t\tdefaults:{data:'\\n\\n\\n'},\n\t\treplace:{},\n\t\tmanifest:null\n\t},\n\t\n\t// ##############################\n\t\n\t\"erl\": {\n\t\tname:\"Erlang\",\n\t\text:\"erl\",\n\t\tmime:\"text/x-erlang\",\n\t\tstringify: function(e) { return e.data+\"\"},\n\t\tdefaults:{data:'\\n\\n\\n'},\n\t\textend:{\n\t\t\tCMmode: function(d){\n\t\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\t\t/*if (d.noIncludes) s.mode = \"text/css\";\n\t\t\t\telse s.mode = \"ddcss\";\n\t\t\t\tif (s.readOnly) s.mode = \"text\";*/\n\t\t\t\ts.mode = \"erlang\";\n\t\t\t\treturn s;\n\t\t\t}\n\t\t},\n\t\treplace:{},\n\t\tmanifest:null\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1437525832901","id": ".Types.html","type": "js","data": "({\n\tname:\"HTML\",\n\text:\"html\",\n\tmime:\"text/html\",\n\tprimary:true,\n\tstringify: function(e) { return e.data+\"\" },\n\tpostprocess: function(item, att){\n\t\tvar that = this;\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t// compress and uglify \n\t\t\tvar s = _compress(att+\"\");\n\t\t\treturn (item.desc?\"<\"+\"!-- \"+item.desc+\"--\"+\">\\n\":\"\") + s;\n\t\t}\n\t\t\n\t\t//- - - - - - - - - - -\n\t\t\n\t\tfunction _compress (h){\n\t\t\t\n\t\t\tvar parse = that.HTMLParser,\n\t\t\t\t\tkeepSpace = [],\n\t\t\t\t\tstack=[],\n\t\t\t\t\tres=[];\n\n\t\t\tparse(h, {\n\t\t\t\tstart: function(tag, attrs, unary) {\n\t\t\t\t\tvar t = tag.toLowerCase(),\n\t\t\t\t\t\t\thtml = _construct(t, attrs, unary);\n\t\t\t\t\tres.push(html);\n\t\t\t\t\tif (!unary) {\n\t\t\t\t\t\tif (/^(script|pre|textarea)$/.test(t)) {\n\t\t\t\t\t\t\tkeepSpace.push(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstack.push({tag:t, attrs:attrs});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function(tag) {\n\t\t\t\t\tvar a, s, process, type, src,\n\t\t\t\t\t\t\tt = tag.toLowerCase();\n\t\t\t\t\tif (t==\"script\") {\n\t\t\t\t\t\ta = stack.last().attrs;\n\t\t\t\t\t\tprocess = true;\n\t\t\t\t\t\tif (a && a.length) {\n\t\t\t\t\t\t\ttype = a.find(function(e){return e.name==\"type\"});\n\t\t\t\t\t\t\tsrc = a.find(function(e){return e.name==\"src\"});\n\t\t\t\t\t\t\tif (type && !/javascript$/i.test(type.value) && !type.value==\"js\") process=false;\n\t\t\t\t\t\t\tif (src) process = false;\n\t\t\t\t\t\t\tif (type && type.value == \"text/x-jquery-tmpl\") res.push(_compact(res.pop()));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (process) {\n\t\t\t\t\t\t\ts = res.pop();\n\t\t\t\t\t\t\ttry {s = _compressJS(s);} catch(e){}\n\t\t\t\t\t\t\tres.push(s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tkeepSpace.pop();\n\t\t\t\t\t} \n\t\t\t\t\telse if (t==\"pre\" || t==\"textarea\") keepSpace.pop();\n\n\t\t\t\t\tres.push('</'+t+'>');\n\t\t\t\t\tstack.pop(); \n\t\t\t\t},\n\t\t\t\tchars: function(chars) {\n\t\t\t\t\tif (keepSpace.length) res.push (chars);\n\t\t\t\t\telse res.push (_compact(chars));\n\t\t\t\t},\n\t\t\t\tdoctype: function(t) {res.push(t);},\n\t\t\t});\n\n\t\t\treturn res.join(\"\");\n\t\t}\n\t\t\n\t\t\n\t\t//- - - - - - - - - - -\n\t\t\n\t\tfunction _compact(s){\n\t\t\treturn s.replace(/[\\s\\n\\r\\t]+/g,' ')\n\t\t}\n\t\t\n\t\t\n\t\t//- - - - - - - - - - -\n\n\t\tfunction _compressJS (s0) {\n\t\t\tvar s = s0;\n\t\t\t// compress and uglify \n\t\t\tvar u = UglifyJS,\n\t\t\t\t\tast = u.parse(s+\"\");\n\t\t\tast.figure_out_scope();\n\t\t\tast = ast.transform(u.Compressor({\n\t\t\t\tside_effects: false\n\t\t\t\t//inline_script:true\n\t\t\t}));\n\t\t\tast.figure_out_scope();\n\t\t\tast.mangle_names();\n\t\t\treturn ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>');\n\t\t}\n\n\n\t\t// - - - - - - - - - - - - - - - - - \n\n\t\tfunction _construct (tag, attrs, unary) {\n\t\t\tvar i, c={id:null}, h = '<'+tag;\n\t\t\tif (attrs && attrs.length) {\n\t\t\t\tfor (i=0;i<attrs.length;i++) {\n\t\t\t\t\tc[attrs[i].name] = attrs[i].name.toLowerCase()+(attrs[i].value!=null?'=\"'+attrs[i].escaped+'\"':'');\n\t\t\t\t}\n\t\t\t\tObject.keys(c).forEach(function(e){ if (null!=c[e]) h+=\" \"+c[e]; });\n\t\t\t}\n\t\t\th+=unary?'/>':'>';\n\t\t\treturn h;\n\t\t}\n\t},\n\tdefaults:{ \n\t\tdata:'<!-- HTML -->\\n\\n\\n',\n\t\tUglify: false\n\t},\n\textend:{\n\t\tCMmode: function(d){\n\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"htmlmixed\";\n\t\t\telse s.mode = \"ddhtml\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Compress HTML code (experimental)</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before compressed code\"} ]\n\t\t\t]\n\t\t}\n\t},\n\treplace:{\n\t\t//HTML:[]\n\t},\n\tmanifest:null\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1411092418927","id": ".Types.js","type": "js","data": "({\n\tname:\"JS\",\n\text:\"js\",\n\tmime:\"text/javascript\",\n\tstringify: function(item) {  \treturn item.data+\"\"; },\n\t/*s2o:function(src) {\n\t\tvar o={};\n\t\to = eval(\"(\"+src+\")\");//JSON.parse(s);\n\t\treturn o;\n\t},*/\n\ts2o:function(src) {\n\t\tvar o, err1, err2, ast;\n\t\t// First, try eval assuming we have obj or function \n\t\t// inside our source\n\t\ttry {\n\t\t\to = eval(\"(\"+src+\")\");//JSON.parse(s);\n\t\t} \n\t\tcatch (e) { err1 = e; }\n\t\t\n\t\tif (err1) {\n\t\t\t// if eval fail, try Uglify, and if it parses – return source\n\t\t\ttry {\n\t\t\t\tast = UglifyJS.parse(src);\n\t\t\t} \n\t\t\tcatch (e) { err2 = e; }\n\t\t\tif (!err2) return src; \n\t\t\tthrow err2;\n\t\t}\n\t\t\n\t\tif (err1) throw err1;\n\t\t\n\t\treturn o;\n\t},\n\tpostprocess: function(item, att){\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t// compress and uglify \n\t\t\tvar u = UglifyJS,\n\t\t\t\t\tast = u.parse(att+\"\");\n\t\t\tast.figure_out_scope();\n\t\t\tast = ast.transform(u.Compressor({side_effects: false}));\n\t\t\tast.figure_out_scope();\n\t\t\t// No char freq opt to avoid \n\t\t\t// different results from the same code\n\t\t\t//ast.compute_char_frequency();\n\t\t\tast.mangle_names();\n\t\t\treturn (item.desc?\"/*\"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\"*/\\n\":\"\") \n\t\t\t+ ast.print_to_string().replace(/<\\/script>/ig,'<\\\\u002fscript>');\n\t\t}\n\t},\n\tdefaults:{\n\t\tdata:'/* JS */\\n\\n\\n',\n\t\tUglify: false\n\t},\n\textend:{\t\n\t\tCMmode: function(d){\n\t\t\tvar s = {autoMatchParens: true, readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"javascript\";\n\t\t\telse s.mode = \"ddjs\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t},\n\t\tui:{\n\t\t\t\"#warn\":{\n\t\t\t\tdelay:300\n\t\t\t}\n\t\t},\n\t\tErr: function(s) {\n\t\t\tvar parse = this.RT().ParseJS(s);\n\t\t\treturn parse.errors.join(\"<br>\");\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) d.Uglify = !!(v+\"\");\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Uglify code</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before uglified code\"} ]\n\t\t\t]\n\t\t},\n\t\tvalidator: function(d){\n\t\t\tvar r, f, s = d.data;\n\t\t\ttry {\n\t\t\t\tf = new Function([], (s.to(1)==\"{\" && s.from(-1)==\"}\"?\"return(\"+s+\");\":s));\n\t\t\t} catch (e) {\n\t\t\t\tr = e.message;\n\t\t\t}\n\t\t\tf = null;\n\t\t\treturn r;\n\t\t}\n\t},\n\treplace:{},\n\tmanifest:null\n})","active": false,"opts": [],"err": [],"color": ["green"]},{"stamp": "1410999823546","id": ".Types.attachment","type": "js","data": "({\n\tname:\"File attachment\",\n\text:\"\",\n\tmime:\"\",\n\tstringify: function(e) { return \"\"},\n\tnoInsert:true,\n\tdefaults:{},\n\tmanifest:{\n\t\tinherit:[\"GetDoc\",\"GetActiveId\",\"RT\", \"Path\"],\n\t\tdata:{\n\t\t\tid:\"\", folder:\"\", name:\"\", mime:\"\", parser:\"\", parserActive:false,\n\t\t\text:\"\", cache:\"864000\", data:\"\", snippet:false, size:\"?\",\n\t\t\tdesc:\"\", \n\t\t\tstate:{\n\t\t\t\tsavedSdbm:\"\", sdbm:\"Z\",\n\t\t\t\tdepends:{}, impacts:{}\n\t\t\t}\n\t\t},\n\t\tinit: function($o, form){\n\t\t\tvar db, d = form.data,\n\t\t\t\t\tthat = this;\n\t\t\t$o.formgen(this.HTML);\n\t\t\t$o.then(function(){\n\t\t\t\tif (!d.preview && /^image\\//.test(d.mime)) {\n\t\t\t\t\t// generate preview\n\t\t\t\t\tvar path = that.Path(d).from(1),\n\t\t\t\t\t\t\tatts = that.GetDoc()._attachments || {},\n\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\trev = that.GetDoc()._rev,\n\t\t\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t\n\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\tvar ico = cw.lib.image($img, \"white\").resample(120);\n\t\t\t\t\t\tif (ico.height()>120) ico.resample(120 * 120/ico.height())\n\t\t\t\t\t\td.preview = ico.sharpen(0.1).contrast(1.05).jpeg(0.75);\n\t\t\t\t\t\t$o.find(\"#fpic\").trigger(\"recalc\");\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tif (rev) {\n\t\t\t\t\t\tvar att = atts[path];\n\t\t\t\t\t\tif (!att || !att.data) {\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdbatt.image(path).then(function(obj, data){\n\t\t\t\t\t\t\t\t//console.log(id, obj, data)\n\t\t\t\t\t\t\t\t$img.attr(\"src\", obj[path].image);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (att.data.length<1e7) {\n\t\t\t\t\t\t\t$img.attr(\"src\",\"data:\"+att.content_type+\";base64,\"+att.data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t},\n\t\tui:{\n\t\t\t\"#fpic\":function(d){\n\t\t\t\tif (d.preview) return '<img src=\"'+d.preview+'\"/>';\n\t\t\t\telse return \"\";\n\t\t\t},\n\t\t\t\"#fname\":{\n\t\t\t\tbind: function(d){\n\t\t\t\t\tvar html=\"\", \n\t\t\t\t\t\t\tcdb = this.RT().GetSettings(\"couch\"),\n\t\t\t\t\t\t\tbase = cdb.dburl.replace(/\\/$/,'')+'/',\n\t\t\t\t\t\t\tid = cdb.docid,\n\t\t\t\t\t\t\tp = (\n\t\t\t\t\t\t\t\t!d.snippet \n\t\t\t\t\t\t\t\t&& /^http[s]?:\\/\\//.test(base) \n\t\t\t\t\t\t\t\t&& d.folder.to(1)!='.' \n\t\t\t\t\t\t\t\t&& d.state.remote\n\t\t\t\t\t\t\t\t&& id\n\t\t\t\t\t\t\t);\n\t\t\t\t\tif (p) html+='<span class=\"gray fs85 fi-eye\"></span>&nbsp;';\n\n\t\t\t\t\thtml+= d.folder+(d.folder.length>1?d.folder.to(1):\"\");\n\n\t\t\t\t\tif (p) {\n\n\t\t\t\t\t\thtml+='<a target=\"_blank\" href=\"'\n\t\t\t\t\t\t\t\t+(base?base.replace(/\\/$/,'')+\"/\":\"\")\n\t\t\t\t\t\t\t\t+id+\"/\"\n\t\t\t\t\t\t\t\t+(d.folder.length>1?d.folder.from(1)+\"/\":\"\")\n\t\t\t\t\t\t\t\t+d.name\n\t\t\t\t\t\t\t\t+'\">';\n\t\t\t\t\t}\n\t\t\t\t\thtml+= d.name\n\n\t\t\t\t\tif (p) html+='</a>';\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#fmime\":{\n\t\t\t\tbind:\"mime\",\n\t\t\t\twatch:\"#fname\"\n\t\t\t},\n\t\t\t\"#fsize\":{\n\t\t\t\tbind:function(d) {\n\t\t\t\t\treturn isNaN(d.size)?\"\":(d.size*1)+\" байт\"; \n\t\t\t\t},\n\t\t\t\twatch:\"#fname\"\n\t\t\t},\n\t\t\t\"#btn-settings\":{\n\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tif ($o.data(\"modal\")) $o.modal(true);\n\t\t\t\t\t\telse $o.modal({\n\t\t\t\t\t\t\tmanifest:this.Settings,\n\t\t\t\t\t\t\tdata:Object.select(d, [\"id\",\"folder\",\"mime\",\"size\",\"name\",\"ext\",\"cache\"]),\n\t\t\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t(window.l||cw).note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tenter:true,\n\t\t\t\t\t\t\twidth:550,\n\t\t\t\t\t\t\talign:\"top:0;right:0\", // nose:\"top\"\n\t\t\t\t\t\t}).then(function(res){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// moveAtt\n\t\t\t\t\t\t\tvar db, \n\t\t\t\t\t\t\t\t\tnold = that.RT().Path(d).from(1),\n\t\t\t\t\t\t\t\t\tnnew = that.RT().Path(res).from(1),\n\t\t\t\t\t\t\t\t\tdoc = that.RT().data.doc;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (nold != nnew && doc._attachments) {\t\n\t\t\t\t\t\t\t\tif (doc._attachments[nold].data) {\n\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(doc._attachments[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t// we need to load it\n\t\t\t\t\t\t\t\t\tif (db = that.RT().db) {\n\t\t\t\t\t\t\t\t\t\t// cloudwall.me runtime\n\t\t\t\t\t\t\t\t\t\tdb.att(doc._id).data(nold).then(function(att){\n\t\t\t\t\t\t\t\t\t\t\tdoc._attachments[nnew] = Object.select(att[nold],[\"content_type\",\"data\"]);\n\t\t\t\t\t\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t\t\t\t\t\t\t_fin();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse _fin();\n\n\t\t\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\twatch:\"#fname\",\n\t\t\t\tcss:{\n\t\t\t\t\t\":disabled\":function(d,v){return d.folder == \"/inliner\"}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#showhideproxy\":{\n\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"#btn-download\":{\n\t\t\t\tbind: function(d,v,$o){\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\tvar path = that.RT().Path(d).from(1),\n\t\t\t\t\t\t\t\tdoc = that.RT().data.doc,\n\t\t\t\t\t\t\t\tid = that.GetDoc()._id,\n\t\t\t\t\t\t\t\tatt, url=\"\";\n\t\t\t\t\t\tif (doc._attachments && doc._attachments[path] && null!=doc._attachments[path].data) {\n\t\t\t\t\t\t\tatt = doc._attachments[path];\n\t\t\t\t\t\t\t_showModal(att);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// read att\n\t\t\t\t\t\t\tvar dbatt = that.RT().db.att(id);\n\t\t\t\t\t\t\tdbatt.data(path).then(function(obj){\n\t\t\t\t\t\t\t\t_showModal(obj[path]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//- - - - - -\n\t\t\t\t\t\n\t\t\t\t\tfunction _showModal(att) {\n\t\t\t\t\t\tvar blob = $.my.f.base642blob(att.data, null, att.content_type),\n\t\t\t\t\t\t\t\turl = URL.createObjectURL(blob);\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar links = [\n              '<div class=\"lh180\">',\n              '<span class=\"fi-download o80\"></span>&nbsp;',\n              '<a class=\"tdn nw\" href=\"'\t+url+'\" '\n                +'download=\"'+that.RT().Path(d).from(1).split(\"/\").last()+'\"'\n                +'target=\"_blank\">Download as a file</a>'\n\t\t\t\t\t\t];\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t/^image\\//.test(att.content_type)\n\t\t\t\t\t\t\t|| /^text\\//.test(att.content_type)\n\t\t\t\t\t\t\t|| /^application\\/(javascript|json)$/.test(att.content_type)\n\t\t\t\t\t\t\t|| /pdf$/.test(att.content_type)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tlinks.push(\n\t\t\t\t\t\t\t'<br/><span class=\"fi-eye o80\"></span> '\n\t\t\t\t\t\t\t\t+'<a class=\"tdn\" href=\"'\t+url+'\" '\n\t\t\t\t\t\t\t\t+'target=\"_blank\">Open in new tab</a>' \n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n            \n            links.push('</div>');\n\t\t\t\t\t\t\n\t\t\t\t\t\t$o.modal({\n\t\t\t\t\t\t\tmanifest:{\n\t\t\t\t\t\t\t\tinit:links,\n\t\t\t\t\t\t\t\tui:{ 'a':'a' }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:\"p20 blue fs90\",\n\t\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.7)\",\n\t\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\t\twidth:150\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tvalidator: function(){},\n\t\t\n\t\t// =============================================\n\t\t\n\t\tHTML:[\n\t\t\t'<div class=\"b1 edwidth meditor\" id=\"xeditor\" style=\"min-height:200px; padding:35px 100px 35px 50px;\">',\n\t\t\t\t'<div class=\"db epane\">',\n\t\t\t\t\t'<div class=\"control\">', \n\t\t\t\t\t\t'<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-download\" title=\"Render\">',\n\t\t\t\t\t\t\t\t'<span class=\"fi-shopping-bag\" ></span>',\n\t\t\t\t\t\t'</button></span>', \n\t\t\t\t\t\t'<button class=\"btn button mr0 btn-r\" id=\"btn-settings\"><span class=\"fi-widget\"  title=\"Settings\"></span>&nbsp;</button>',\n\t\t\t\t\t'</div>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div id=\"fpic\" class=\"tac\"></div>',\n\t\t\t\t'<div id=\"fname\" class=\"fs110 xgray lh120 tac\"></div> ',\n\t\t\t\t'<div id=\"fmime\" class=\"fs80 gray tac\"></div> ',\n\t\t\t\t'<div id=\"fsize\" class=\"fs80 gray tac\"></div> ',\n\t\t\t\t'<div id=\"showhideproxy\"></div>',\n\t\t\t'</div>'\n\t\t],\n\n\t\tstyle:{\n\n\t\t\t\" .epane\":\"width: 100px;position: absolute;top: 5px;right: 4px;z-index: +5;\",\n\n\t\t\t\" .control\":{\n\t\t\t\t\"\":\" font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;\",\n\t\t\t\t\":hover\":\"opacity:1\"\n\t\t\t},\n\n\t\t\t\" .btn\":\"width:2em; height:2em; border-radius:2em; line-height:1.6em; \"\n\t\t\t\t+\"vertical-align:top; text-align:center;padding:0;display:inline-block;\",\n\n\t\t\t\" #fname\":\"word-wrap: break-word; white-space: pre;\"\n\t\t\t\t\t+\"margin-top: 0px;\"\n\t\t}, \n\t\t\n\t\t// =============================================\n\t\t\n\t\tSettings: {\n\t\t\tinit: function($o, form){ $o.formgen(this.HTML); },\n\t\t\tinherit:[\"RT\"],\n\t\t\tui:{\n\t\t\t\t\"#npath\":{\n\t\t\t\t\tbind: function(d,v) {\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn v;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\t\t\treturn s;\n\t\t\t\t\t},\n\t\t\t\t\tcheck: function(d,v){\n\t\t\t\t\t\tif (!v) return \"Enter path like <b>/folder/fname.ext</b> for attach\";\n\t\t\t\t\t\tif (!/^[\\/]/.test(v)) return 'Attachment path must start with /';\n\t\t\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#mime\":{\n\t\t\t\t\tbind:\"mime\",\n\t\t\t\t\tcheck:/^[a-z0-9\\-+\\.]{1,20}\\/[a-z0-9\\-+\\.]{1,30}$/\n\t\t\t\t},\n\t\t\t\t\"#btn-ok\":{\n\t\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#btn-cancel\":{\n\t\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#btn-delitem\":{\n\t\t\t\t\tbind: function(d,v,$o) {\n\t\t\t\t\t\tif (v!=null) {\n\n\t\t\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t\t\t.delay(60);\n\n\t\t\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcss:{\n\t\t\t\t\t\t\"self:hide\": function(d){\n\t\t\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twatch:\"#folder,#name\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tHTML:[\n\t\t\t\t'<h4 class=\"mb10\">Attachment properties</h4>',\n\t\t\t\t{row:\"550px\", label:\"116px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray\"},\n\n\t\t\t\t[\"\",\n\t\t\t\t\t'<span class=\"fr\">','inp#mime.w150', {plc:\"MIME\"}, '</span>',\n\t\t\t\t\t'<div class=\"dib vat w380\">', \n\t\t\t\t\t\t\"inp#npath.w380\", {plc:\"Resource path\"},\"msg.fs70\",\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'<span class=\"dib vat mt4 ml8\">:</span>'\n\t\t\t\t],\n\n\t\t\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t\t\t[\"\", 'btn#btn-ok.green', {val:\"Apply\"},' ', \n\t\t\t\t 'btn#btn-cancel', {val:\"Cancel\"}, ' ', \n\t\t\t\t 'btn#btn-delitem.red.fr', {val:\"Delete\"}]\n\t\t\t]\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["green"]},{"stamp": "1437782957053","id": ".Types.less","type": "js","data": "({\n\tname:\"less\",\n\text:\"less\",\n\tmime:\"text/x-less\",\n\tstringify: function(e) { return e.data+\"\"},\n\tdefaults:{ data:'/* LESS */' },\n\tpostprocess: function(item, att){\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\t\n\t\t\tvar ret=\"\";\n\t\t\tless.render(att+\"\", function(err, res){\n\t\t\t\tif (err) {\n\t\t\t\t\tthrow {message:err.message+\", line \"+err.line};\n\t\t\t\t}\n\t\t\t\telse ret = res.css;\n\t\t\t})\n\t\t\treturn (item.desc?\"/* \"+item.desc.replace(/(\\/\\*|\\*\\/+)/g,'')+\" */\\n\":\"\")+ret;\n\t\t}\n\t},\n\textend:{\n\t\tCMmode: function(d){\n\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"text/x-less\";\n\t\t\telse s.mode = \"ddless\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.Uglify = !!(v+\"\");\n\t\t\t\t\t\t\tif (d.Uglify) d.mime = \"text/css\";\n\t\t\t\t\t\t\telse if (d.mime==\"text/css\") d.mime = \"text/x-less\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t},\n\t\t\t\t\trecalc:\"#mime\"\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Compile to CSS</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before compressed code\"} ]\n\t\t\t]\n\t\t}\n\t},\n\treplace:{},\n\tmanifest:null\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1439299593809","id": ".Types.md","type": "js","data": "({\n\tname:\"MarkDown\",\n\text:\"md\",\n\tmime:\"text/x-markdown\",\n\tstringify: function(e) { return e.data+\"\"},\n\tdefaults:{ data:' \\n\\n\\n' },\n\tpostprocess: function(item, att){\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\tvar s = window.marked(att+\"\");\n\t\t\treturn (item.desc?\"<\"+\"!-- \"+item.desc+\"--\"+\">\\n\":\"\") + s;\n\t\t}\n\t},\n\textend:{\n\t\tCMmode: function(d){\n\t\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\t\tif (d.noIncludes) s.mode = \"gfm\";\n\t\t\telse s.mode = \"ddmd\";\n\t\t\tif (s.readOnly) s.mode = \"text\";\n\t\t\treturn s;\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.Uglify = !!(v+\"\");\n\t\t\t\t\t\t\tif (d.Uglify) d.mime = \"text/html\";\n\t\t\t\t\t\t\telse if (d.mime==\"text/html\") d.mime = \"text/x-markdown\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t},\n\t\t\t\t\trecalc:\"#mime\"\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Compile to HTML</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before compiled code\"} ]\n\t\t\t]\n\t\t}\n\t},\n\treplace:{},\n\tmanifest:null\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1440445844595","id": ".Types.rtf","type": "js","data": "({\n\tname:\"RichHTML\",\n\text:\"html\",\n\tmime:\"text/html\",\n\tstringify: function(item) { \n\t\treturn JSON.stringify(item.doc);\n\t},\n\tdefaults:{ data: \"\", doc:{} },\n\tpostprocess: function(item, att, doc){\n\t\tif (!item.Uglify) return att;\n\t\telse {\n\t\t\tvar that = this,\n\t\t\t\t\tobj = JSON.parse(att+\"\"),\n\t\t\t\t\ts, r, h,\n\t\t\t\t\titems = [], \n\t\t\t\t\tatts = doc._attachments||{}, \n\t\t\t\t\tdone = {},\n\t\t\t\t\toitems = {}, \n\t\t\t\t\titem0 = {data:\"\"};\n\t\t\t\n\t\t\tdoc.items.forEach(function(e){oitems[e.id] = e});\n\t\t\t\n\t\t\t// Prepare Inliner instance\n\t\t\t\n\t\t\tvar ed =  $.extend(true, {}, that.Types.rtf.extend.Inliner.Ed, {data:item.doc});\n\t\t\tif (!Object.size(ed.Items)) ed.Items = $.extend(true, {},that.Types.rtf.extend.Inliner.T);\n\t\t\tObject.keys(ed.Items).forEach(function(i){\n\t\t\t\ted.Items[i].RT = function(){return ed}\n\t\t\t});\n\t\t\t\n\t\t\t//console.log($.extend(true,{},ed));\n\t\t\t\n\t\t\tvar res = ed.To.html.call(ed, ed.data, {\n\t\t\t\tstyle:true, \n        //important:true,\n\t\t\t\tinitSync: false,\n        forceNoEdit:true,\n\t\t\t\tforceUpgradeWidgets:false,\n\t\t\t\t//path:'/file/'+id+'/'\n\t\t\t});\n\n\t\t\th = [\n        '<!-- stylesheet -->\\n<style>\\n'+res.style+'</style>\\n\\n',\n        '<!-- scripts -->\\n<sc'+'ript>'+(res.scripts||[]).join('\\n\\n')+'</sc'+'ript>\\n\\n',\n        res.html\n      ].join('');\n\t\t\t\n\t\t\treturn (item.desc?\"<\"+\"!-- \"+item.desc+\"--\"+\">\\n\":\"\") + h;\n\t\t\t\n\t\t}\n\t},\n\textend:{\n\t\tparams:{restyle:200},\n\t\tinherit:[\"db\",\"GetDoc\",\"GetActiveId\",\"RT\",\"Confirm\",\"Att\"],\n\t\tCMmode:false,\n\t\tui:{\n\t\t\t\"#editor\":{\n\t\t\t\tdelay:150,\n\t\t\t\tinit: function($o, form){\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tif (form.data.data) {\n\t\t\t\t\t\tvar d = form.data.data;\n\t\t\t\t\t\tif (d.to(1)==\"{\") {\n\t\t\t\t\t\t\tform.data.doc=JSON.parse(d);\n\t\t\t\t\t\t\tform.data.data = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (d.to(1)==\"<\") {\n\t\t\t\t\t\t\tform.data.doc = {\n\t\t\t\t\t\t\t\t_id:\"\", \n\t\t\t\t\t\t\t\ttype:\"inliner\", \n\t\t\t\t\t\t\t\tname:\"\",\n\t\t\t\t\t\t\t\tmeta:{},\n\t\t\t\t\t\t\t\tcontent:[{\n\t\t\t\t\t\t\t\t\t_stamp:cw.lib.hash8(Number.random(1,1e6)+\"x\"+Date.now()),\n\t\t\t\t\t\t\t\t\ttype:\"html\",\n\t\t\t\t\t\t\t\t\tdata:d\n\t\t\t\t\t\t\t\t}], \n\t\t\t\t\t\t\t\ttags:[]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tform.data.data = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tform.data.doc._id = form.data.id;\n\t\t\t\t\tvar ed = $.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{},\n\t\t\t\t\t\tthat.Inliner.Ed,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdb:that.db,\n\t\t\t\t\t\t\tCleanHTML:that.Inliner.CleanHTML,\n\t\t\t\t\t\t\tCollapseItems:that.Inliner.CollapseItems,\n\t\t\t\t\t\t\tItems:that.Inliner.T||that.Inliner.Ed.Items,\n\t\t\t\t\t\t\tAtt: that.Att,\n              Config:{meta:{}},\n              Cmd: function(){return 'edit'},\n              EdContent:\t'#medium'\n            }\n\t\t\t\t\t);\n\t\t\t\t\t$o.my(ed, form.data.doc);\n\t\t\t\t\tvar b = navigator.userAgent;\n\t\t\t\t\tif (/Mac.+Firefox/.test(b)) $o.find(\"#edcontainer\").css({overflow:\"scroll\"});\n\t\t\t\t\telse if (!/Firefox/.test(b)) $o.find(\"#edcontainer\").niceScroll();\n\t\t\t\t},\n\t\t\t\tbind:\"doc\"\n\t\t\t}\n\t\t},\n\t\tSettings:{\n\t\t\tui:{\n\t\t\t\t'input[name=\"uglify\"]':{\n\t\t\t\t\tbind: function(d,v){\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.Uglify = !!(v+\"\");\n\t\t\t\t\t\t\tif (d.Uglify) d.mime = \"text/html\";\n\t\t\t\t\t\t\telse if (d.mime==\"text/html\") d.mime = \"application/json\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn d.Uglify?[\"uglify\"]:[];\n\t\t\t\t\t},\n\t\t\t\t\trecalc:\"#mime\"\n\t\t\t\t},\n\t\t\t\t\"#desc\":{\n\t\t\t\t\tbind:\"desc\",\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){ return !d.Uglify }\n\t\t\t\t\t},\n\t\t\t\t\twatch:'input[name=\"uglify\"]'\n\t\t\t\t}\n\t\t\t},\n\t\t\tAux:[\n\t\t\t\t[\" \", \n\t\t\t\t '<label class=\"gray fs80 dib\">',\n\t\t\t\t '<input type=\"checkbox\" name=\"uglify\" value=\"uglify\"/>',\n\t\t\t\t '<span> Compile to HTML</span>',\n\t\t\t\t '</label>'\n\t\t\t\t],\n\t\t\t\t{rowCss:\"my-row pt3 pb10\"},\n\t\t\t\t[\"Comment\", 'inp#desc', {plc:\"Inserted before compiled code\"} ]\n\t\t\t]\n\t\t},\n\t\tstyle:{\n\t\t\t//\" #topnav\":\"display:none\",\n\t\t\t' #xeditor':\"font-size:111%;\",\n\t\t\t\" #topnav\":{\n\t\t\t\t'':'width: calc(100% - 14px)!important;margin-bottom:1px!important;height:48px!important;font-size:90%;',\n\t\t\t\t\" .btn-l\":\"padding-left:5px;\",\n\t\t\t\t\" .btn-c.w40\":\"width:36px!important;\",\n\t\t\t\t\" .btn-r\":\"padding-right:2px\",\n\t\t\t\t\" textarea\":\"padding-right:120px!important\"\n\t\t\t},\n\t\t\t\" .epane \":\"top:13px!important;right:16px!important;font-size:90%;\",\n\t\t\t\" .my-modal.nose-top:before\": \"border: 1px solid rrgba(168, 180, 195,0.6)!important; border-top: none;border-right: none;\",\n\t\t\t\" .my-modal-overlay\": \" box-shadow: none!important; border: 1px solid rgba(168, 180, 195,0.6)!important;\",\n\t\t\t\n\t\t\t\" #edcontainer\": function($form){\n\t\t\t\tvar height = $form.height()-67;\n\t\t\t\treturn 'height:'+height+'px;padding-right:14px;margin-top:0!important;';\n\t\t\t}\n\t\t}\n\t},\n\treplace:{\n\t\tHTML:[\n\t\t'<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:500px\">',\n\t\t\t'<div class=\"db epane\">',\n\n\t\t\t\t'<div class=\"control\">', \n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-rendertab\" title=\"Render\">',\n\t\t\t\t\t\t\t'<span class=\"fi-shopping-bag\" ></span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-c pl1 pr2 bold\" id=\"btn-parser\" title=\"Parser\">',\n\t\t\t\t\t\t'<span class=\"lh100 fs110\" style=\"letter-spacing:-1px;\">&gt;_</span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-c pr1 pl1\" id=\"btn-deps\" title=\"Dependencies\">',\n\t\t\t\t\t\t'<span class=\"fi-share\" ></span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn button mr0 btn-r pr3\" id=\"btn-settings\"  title=\"Settings\">',\n\t\t\t\t\t\t'<span class=\"fi-widget\" ></span>',\n\t\t\t\t\t'</button><span>',\n\t\t\t\t'</div>',\n\n\t\t\t\t'<div id=\"fname\" class=\"fs90 xgray lh120 hide\"></div> ',\n\t\t\t\t'<div id=\"warn\" class=\"fs80 red fi-alert lh120 mt10 mr100\"></div> ',\n\t\t\t\t'<div id=\"showhideproxy\"></div>',\n\t\t\t'</div>',\n\t\t\t'<div style=\"width:100%;margin:0 auto 0px auto;overflow:hidden;\">',\n\t\t\t'<div id=\"editor\" class=\"meditor \" style=\"padding:15px 9px 0 23px;\"></div>',\n\t\t\t'</div>',\n\t\t'</div>',\n\t\t'<div id=\"xparser\" class=\"edwidth\" style=\"opacity:0.005\">',\n\t\t\t'<div style=\"position:absolute;top:3px;right:5px;z-index:+5\">',\n\t\t\t\t'<button class=\"fs80 green tac btn-l mr2 button pr7 pl12 lh100\" id=\"btn-source\">',\n\t\t\t\t'<span class=\"fi-page-edit\" title=\"Source\"></span>',\n\t\t\t\t'</button>' ,\n\t\t\t\t'<button  id=\"btn-play\" title=\"Run parser\" ',\n\t\t\t\t\t'class=\"button green fs80 mt0 mb0 mr0 btn-r pl10 pr12 lh100\"><span '\n\t\t\t\t\t+ 'class=\"fi-play\"></span></button>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"dib vat b1g\" style=\"width:100%;min-height:200px\">',\n\t\t\t\t'<textarea id=\"parser\" class=\"\" style=\"width:100%\"  class=\"edheight\"></textarea>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t]\n\t\n\t},\n\tmanifest:null\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1435891154995","id": ".Item","type": "js","data": "({\n\t// Item editor skeleton, \n\t// all controls except editor itself.\n\t// ui section is expanded when Item initialized\n\t\n\tinherit:[\"GetDoc\",\"GetActiveId\",\"RT\",\"Confirm\"],\n\t//params:{restyle:200},\n\tdata:{\n\t\tid:\"\", type:\"html\", snippet:false,\n\t\tfolder:\"/\", name:\"index.html\", ext:\"\",\n\t\tmime:\"text/html\", desc:\"\",\n\t\texternal:\"\",\n\t\tdata:\"<!DOCTYPE html>\\n<html>\\n\\t<head>\\n\\t\\t<title> Insert title </title>\\n\\t</head>\\n\\t<body>\\n\\t\\tHello!\\n\\t</body>\\n</html>\",\n\t\t\n\t\tparser:\"// Receives item source as a string, \\n// must return new string representation of item\\n\"\n\t\t\t+'(function (item){\\n\\n\\treturn item.data+\"\";\\n})',\n\t\t\n\t\tparserActive:false,\n\t\tstashResolved: false,\n\t\tisBinary:false,\n\t\tnoIncludes:false,\n    dropImport:false,\n\t\t//resolved:\"\",\n\t\t\n\t\ttags:[],\n\t\t\n\t\tstate:{\n\t\t\tsavedSdbm:\"\",\n\t\t\tsdbm:\"\",\n\t\t\tdepends:{},\n\t\t\timpacts:{},\n\t\t\tcrc:\"\"\n\t\t}\n\t\t\n\t},\n\tTrack: function(item) {\n\t\tvar it=item, att,\n\t\t\t\tparser;\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t}\n\t},\n\tinit: null /* See tabs */,\n\tui:{ /* See tabs */ },\n\t\n\tvalidator: function(){},\n\t\n\tCMmode: function(d){\n\t\tvar s = {readOnly:!!d.external && !/^[x\\s]/.test(d.external)};\n\t\tif (d.noIncludes) s.mode = \"text\";\n\t\telse s.mode = \"ddtext\";\n\t\treturn s;\n\t},\n\t\n\tHTMLtail:[],\n\t\n\tPlayParser:{\n\t\tinit: function($o, form){\n\t\t\t$o.html('<div><textarea id=\"txt\" disabled=\"disabled\"></textarea></div>')\n\t\t}, \n\t\tui:{\n\t\t\t\"#txt\":\"txt\"\n\t\t},\n\t\tstyle:{\n\t\t\t\" textarea\":\"line-height:1.4em;font:12px Cousine,'PT Mono', Monaco,monospace;height:400px;overflow:scroll;\"\n\t\t\t+\"width:800px; white-space:pre-wrap; word-break: break-all;color: #666!important;opacity: 1!important;\"\n\t\t}\n\t},\n\t\n\tHTML:[\n\t\t'<div class=\"b1 edwidth\" id=\"xeditor\" style=\"min-height:200px\">',\n\t\t\t'<div class=\"db epane\">',\n\n\t\t\t\t'<div class=\"control\">', \n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-l pl5 pr2\" id=\"btn-rendertab\" title=\"Render\">',\n\t\t\t\t\t\t\t'<span class=\"fi-shopping-bag\" ></span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-c pl1 pr2 fw500\" id=\"btn-parser\" title=\"Parser\">',\n\t\t\t\t\t\t'<span class=\"fs120 lh90\" style=\"letter-spacing:-2px;\">&gt;_</span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn mr2 button btn-c pr1 pl1\" id=\"btn-deps\" title=\"Dependencies\">',\n\t\t\t\t\t\t'<span class=\"fi-share\" ></span>',\n\t\t\t\t\t'</button></span>',\n\t\t\t\t\t'<span><button class=\"btn button mr0 btn-r pr3\" id=\"btn-settings\"  title=\"Settings\">',\n\t\t\t\t\t\t'<span class=\"fi-widget\" ></span>',\n\t\t\t\t\t'</button><span>',\n\t\t\t\t'</div>',\n\n\t\t\t\t'<div id=\"fname\" class=\"fs90 xgray lh120 hide\"></div> ',\n\t\t\t\t'<div id=\"warn\" class=\"fs80 red1 lh150 mb5 mr120 br2 pl6 pr3 bg-red4\"></div> ',\n\t\t\t\t'<div id=\"found\" class=\"fs80 bg-yellow2 o80 br2 pl6 pr4 gray0 lh150 mr120 hoverlink\"></div> ',\n\t\t\t\t'<div id=\"showhideproxy\"></div>',\n\t\t\t'</div>',\n\t\t\t'<textarea id=\"editor\" style=\"width:100%\" class=\"edheight\"></textarea>',\n\t\t'</div>',\n\t\t'<div id=\"xparser\" class=\"edwidth\" style=\"opacity:0.005\">',\n\t\t\t'<div class=\"control\" style=\"position:absolute;top:6px;right:5px;z-index:+5\">',\n\t\t\t\t'<span><button class=\" green tac btn-l mr2 button pr7 pl12\" id=\"btn-source\">',\n\t\t\t\t\t'<span class=\"fi-page-edit\" title=\"Source\"></span>',\n\t\t\t\t'</button></span>' ,\n\t\t\t\t'<span><button  id=\"btn-play\" title=\"Run parser\" ',\n\t\t\t\t\t'class=\"button green  mt0 mb0 mr0 btn-r pl10 pr12\"><span '\n\t\t\t\t\t+ 'class=\"fi-play\"></span></button></span>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"dib vat b1g\" style=\"width:100%;min-height:200px\">',\n\t\t\t\t'<textarea id=\"parser\" class=\"\" style=\"width:100%\"  class=\"edheight\"></textarea>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t],\n\tstyle:{\n\n\t\t\" .epane\":\t\"width:320px; position:absolute; top:5px; right:0px; z-index:+5; background:rgba(255,255,255,0.0);\"\n\t\t\t\t\t\t\t\t+\"border-radius: 10px;padding: 0px 4px;\",\n\n\t\t\" .control\":{\n\t\t\t\"\":\" font-size:85%; line-height:1.1em; opacity:0.7; transition:opacity 0.3s; float:right; z-index:+1;\",\n\t\t\t\":hover\":\"opacity:1\"\n\t\t},\n\n\t\t\" .btn\":\t\"width:2em; height:2em; border-radius:2em; line-height:1.6em; \"\n\t\t\t\t\t\t\t+\"vertical-align:top; text-align:center;padding:0;display:inline-block;\",\n\n\t\t\" #fname\":\"word-wrap: break-word; white-space: pre; padding: 5px 0;width: 250px;margin-top: 4px;\",\n\t\t/*\" #xeditor .CodeMirror\": function($o, form){\n\t\t\t\t\t\n\t\t\tif (form.data.external && !/^[\\sx]/.test(form.data.external)) return \"background-color:rgba(0,0,0,0.03);opacity: 0.6;\";\n\t\t\telse return \"\";\n\t\t},*/\n\t\t\" .CodeMirror.readonly\":\"background-color:rgba(0,0,0,0.03);opacity: 0.6;\"\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1458342427902","id": ".Item.init","type": "js","data": "(function($o, form){\n\tvar that = this;\n\t$o.html($.my.formgen(this.HTML)+$.my.formgen(this.HTMLtail));\n\t$o.then(function(){\n\t\t$o.find(\"#xparser\").addClass(\"hide\").css({opacity:1});\n\t\t$o.on(\"change.my\", function(){\n\t\t\tthat.Track(form.data);\n\t\t\tif (form.data.state.sdbm !== form.data.state.savedSdbm) {\n\t\t\t\t$o.parent().my(\"find\",\"#ilist\").trigger(\"check\");\n\t\t\t}\n\t\t}.debounce(300));\n\t});\n\t\n\t// Error details modal\n\n\t$o.on(\"click.my\",\"#warn\", function(){\n\t\tvar $c = $(this);\n\t\tif ($c.data(\"modal\")) return $c.modal(true);\n\t\tif (that.Err) {\n\t\t\tvar e = that.Err(that.data.data);\n\t\t\t$c.modal({\n\t\t\t\twidth:250,\n\t\t\t\tnose:\"top\",\n\t\t\t\tbound:0,\n\t\t\t\talign:\"top:120%;left:0;\",\n\t\t\t\tesc:true,\n\t\t\t\tenter:true,\n\t\t\t\tmanifest:{\n\t\t\t\t\tinit:['<span id=\"t\" class=\"red lh150\"></span>'],\n\t\t\t\t\tui:{\"#t\":\"t\"}\n\t\t\t\t},\n\t\t\t\tdata:{t:e},\n\t\t\t\tcss:\"fs80\"\n\t\t\t});\n\t\t}\n\t});\n\t\n\t\n\t// Color Picker magic\n\n\t$o.on(\"contextmenu.my\",\".cm-csscolor\", function(evt){\n\t\tvar $i = $(evt.currentTarget),//$(this),\n\t\t\t\tc = $i[0].innerText+\"\",\n\t\t\t\tcm = $i.parents(\"#xeditor\").find(\"#editor\").next()[0].CodeMirror,\n\t\t\t\tx = evt.pageX,\n\t\t\t\ty = evt.pageY,\n\t\t\t\tup = $(window).height()/2>y;\n\n\t\t$i.modal({\n\t\t\twidth:272,\n\t\t\tcss:\"p0\",\n\t\t\tmanifest:that.RT().ColorPicker,\n\t\t\tdata:{css:c},\n\t\t\talign:up?\"top:100%\":\"bottom:140%\",\n\t\t\tnose:up?\"top\":\"bottom\",\n\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\tesc:true,\n\t\t\tenter:true,\n\t\t\tclose:false,\n\t\t\tfocus:\"#cprgb\"\n\t\t})\n\t\t.then(function(picker){\n\t\t\t//console.log(res);\n\t\t\tvar co = cm.coordsChar({left:x, top:y}),\n\t\t\t\t\tline = co.line,\n\t\t\t\t\tidx = co.ch,\n\t\t\t\t\tcd = cm.getDoc(),\n\t\t\t\t\ts = cd.getLine(line),\n\t\t\t\t\tsl = s.length,\n\t\t\t\t\tres = s;\n\t\t\tfor (var i=idx; i>-1; i--) {\n\t\t\t\tvar s0 = s.substr(i);\n\t\t\t\tif (s0.startsWith(c)) {\n\t\t\t\t\tres = s.to(i) + s0.replace(c, picker.css.toLowerCase());\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcd.replaceRange(res, {line:line, ch:0}, {line:line, ch:sl})\n\t\t\t//$i.text(picker.css).trigger(\"input\");\n\t\t});\n\t\treturn false;\n\t});\n\t\n\tif (that.params && that.params.restyle) {\n\t\t$o.then(function(){\n\t\t\t$o.my(\"restyle\");\n\t\t}.debounce(150))\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1436263422489","id": ".Item.ui","type": "js","data": "({\n\n\t// Editor\n\t\"#editor\":{\n\t\tinit: function($o, form){\n      var that = this,\n          d = that.data;\n\t\t\tvar m = this.CMmode(form.data);\n\t\t\tvar ed = CodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: 'text',\n\t\t\t\tlineNumbers:\t\ttrue,\n\t\t\t\tindentWithTabs:\tfalse,\n\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\ttheme: \t\t\t\t\t'default',\n        extraKeys: {\n          'Ctrl-S':\tfunction(){$o.trigger('saveproject.my')},\n          'Cmd-S': \tfunction(){$o.trigger('saveproject.my')},\n          'Ctrl-F':\t_setSearch,\n          'Cmd-F':\t_setSearch\n        },\n        styleSelectedText:true,\n        highlightSelectionMatches: {minChars:3, /*showToken: /\\w/,*/ annotateScrollbar: true}\n\t\t\t});\n\t\t\tObject.keys(m).forEach(function(i){ ed.setOption(i,m[i]); });\n\t\t\t\n\t\t\tvar $cm = $o.next();\n\t\t\t$cm.toggleClass('readonly', !!m.readOnly);\n      \n      // - - - - - - - -\n      \n      function _setSearch(){\n        var s = $o[0].nextSibling.CodeMirror.getSelection();\n        if (s.length>2) {\n          that.RT().Search = that.RT().Search==s?'':s;\n          that.my.parent().my.recalc('#search');\n        }\n      }\n\t\t},\n\t\tbind:\"data\"\n\t},\n\n\t\"#warn\":{\n\t\tbind: function(d, v, $o){\n\t\t\tvar r, that = this;\n\t\t\tif (Object.isFunction(that.validator)){\n\t\t\t\ttry {\n\t\t\t\t\tr = that.validator(d);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tr = e.message;\n\t\t\t\t}\n\t\t\t}\n\t\t\t$o.html(r?'<div class=\"pt4 pb4\"><span class=\"fi-alert o80\"></span> <span class=\"'\n              +(that.Err?'pseudolink red0 o90':'')+'\">'+r+'</span></div>':\"\");\n\t\t\t$o.toggleClass(\"hide\", !r);\n\t\t\tthat.my.find('#xeditor').toggleClass('b1r', !!r);\n\t\t},\n\t\twatch:\"#editor\",\n\t\tdelay:200\n\t},\n\n\t\"#found\":{\n\t\tdelay:200,\n    init: function($o){\n      var that = this;\n      // highlight and scroll to found line\n      $o.on('click.my','.pseudolink', function(){\n      \tvar line = +$(this).text(),\n            ed = that.my.find('#editor').next()[0].CodeMirror;\n        \n        ed.scrollIntoView({line:line, char:1}, 48);\n\n        var f = function(){\n          ed.addLineClass(line-1,'background','bg-yellow4');\n          (function(){\n            ed.removeLineClass(line-1,'background','bg-yellow4');\n          }.debounce(100))()\n        };\n        \n        f.debounce(100)();\n        f.debounce(300)();\n      });\n    },\n\t\tbind: function(d){\n\t\t\tvar that = this,\n\t\t\t\t\ts = that.RT().Search,\n\t\t\t\t\tlines = [];\n\t\t\tif (/^.{2,}$/.test(s) && that.GetActiveId() == d.id) {\n\t\t\t\tvar re = new RegExp (RegExp.escape(s), \"i\");\n\t\t\t\td.data.lines().forEach(function(l, i){\n\t\t\t\t\tif (re.test(l)) lines.push(i+1);\n\t\t\t\t});\n        if (lines.length) {\n          return '<div class=\"pt4 pb4\"><span class=\"fi-magnifying-glass fs90 o70\"></span> Found @ '+lines.map(function(e){\n          \treturn '<span class=\"pseudolink\">'+e+'</span>';\n          }).join(', ')+'</div>';\n        }\n\t\t\t}\n      return '';\n\t\t}\n\t},\n\n\t\"#fname\":{\n\t\tbind: function(d){\n\t\t\tvar html=\"\", \n\t\t\t\t\tbase = this.GetDoc().export.path, \n\t\t\t\t\tp = !d.snippet && (d.type!=\"attachment\");\n\n\t\t\thtml+= d.folder+(d.folder.length>1?d.folder.to(1):\"\");\n\t\t\thtml+= d.name\n\n\t\t\treturn html;\n\t\t}\n\t},\n\n\t\"#btn-settings\":{\n\t\tbind: function(d,v,$o) {\n\t\t\tvar that = this, $f;\n\t\t\tif (v!=null) {\n\t\t\t\t$f = $o;//.my().root;\n\t\t\t\tif ($f.data(\"modal\")) $f.modal(true);\n\t\t\t\telse $f.modal({\n\t\t\t\t\tmanifest: this.Settings,\n\t\t\t\t\tdata:Object.select(\n\t\t\t\t\t\td, \n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\"id type desc folder mime tags size name ext cache\"\n\t\t\t\t\t\t\t+ \" parserActive noIncludes snippet external dropImport\"\n\t\t\t\t\t\t\t+ \" stashResolved isBinary\"\n\t\t\t\t\t\t).split(\" \").add([/^[A-Z]/])\n\t\t\t\t\t),\n\t\t\t\t\tdone: function(err){\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcw.lib.note(\"Fix errors\",\"error\");\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:true,\n\t\t\t\t\talign:\"top:0;right:0\", \n\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\tcss:\"fs100\"\n\t\t\t\t}).then(function(res){\n\n\t\t\t\t\t// moveAtt\n\t\t\t\t\tvar nold = that.RT().Path(d).from(1),\n\t\t\t\t\t\t\tnnew = that.RT().Path(res).from(1),\n\t\t\t\t\t\t\tdoc = that.RT().data.doc;\n\t\t\t\t\tif (nold != nnew && doc._attachments) {\n\t\t\t\t\t\tdelete doc._attachments[nold];\n\t\t\t\t\t}\n\t\t\t\t\t_fin();\n\n\t\t\t\t\tfunction _fin(){\n\t\t\t\t\t\t$.extend(d, res);\n\t\t\t\t\t\tif (that.CMmode) {\n\t\t\t\t\t\t\tvar m = that.CMmode(d),\n\t\t\t\t\t\t\t\t\t$cm = $o.my(\"find\",\"#editor\").next(),\n\t\t\t\t\t\t\t\t\tcm =  $cm[0].CodeMirror;\n\n\t\t\t\t\t\t\tObject.keys(m).forEach(function(i){ cm.setOption(i,m[i]); });\n\t\t\t\t\t\t\tif (m.readOnly) $cm.addClass(\"readonly\");\n\t\t\t\t\t\t\telse $cm.removeClass(\"readonly\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$o.my(\"find\",\"#fname\").trigger(\"check\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\twatch:\"#fname\"\n\t},\n\t\"#showhideproxy\":{\n\t\tbind: function(d,v,$o) {\n\t\t\t$o.my().root.toggleClass(\"hide\", this.GetActiveId() !== d.id);\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1436908616024","id": ".Item.ui","type": "js","data": "({\n\t\"#btn-deps\":{\n\t\tbind:function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tvar that = this, h=\"\";\n\t\t\t\t\n\t\t\t\tthat.RT().Items2Atts(null, null, {}, true, true);\n\t\t\t\t\n\t\t\t\tvar deps=Object.keys(d.state.depends||{}),\n\t\t\t\t\t\timps = Object.keys(d.state.impacts||{});\n\t\t\t\t\n\t\t\t\t//console.log(d);\n\t\t\t\t\n\t\t\t\tif (deps.length) {\n\t\t\t\t\th+='<div>Depends:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+deps.map(function(i){\n\t\t\t\t\t\t\treturn d.state.depends[i] ? i:'<span class=\"red\">'+i+'</span>';\n\t\t\t\t\t\t}).join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (imps.length) {\n\t\t\t\t\th+='<div>Impacts:</div><div class=\"fs80 lh130 gray\">'\n\t\t\t\t\t\t+imps.join(\"<br>\")\n\t\t\t\t\t\t+'</div>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (h) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:$.extend(true, {},that.Confirm,{params:{width:250}}),\n\t\t\t\t\t\twidth:250,\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttext:h, yes:\"Ok\", \tno:\"\", cancel:\"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\talign:\"top:103%\",\n\t\t\t\t\t\tnose:\"top\",\n\t\t\t\t\t\tbound:10,\n\t\t\t\t\t\tscreen:\"rgba(255,255,255,0.5)\",\n\t\t\t\t\t\tcss:\"fs100 lh170 pb20\",\n\t\t\t\t\t\tesc:true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.lib.note(\"Item has no dependencies.\",\"ok\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\twatch:\"#fname\"\n\t},\n\t\"#btn-rendertab\":{\n\t\tbind:function(){},\n\t\t/*css:{\n\t\t\t\":disabled\": function(d){return !!d.snippet}\n\t\t},*/\n\t\twatch:\"#fname\"\n\t},\n\t\"#btn-source\":{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#xeditor\");\n\n\t\t\t\t$e.toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\t\"#btn-parser\":{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) {\n\t\t\t\tvar $xp = $o.my(\"find\",\"#xparser\"),\n\t\t\t\t\t\t$e = $o.my(\"find\",\"#xeditor\");\n\n\t\t\t\t$e.toggleClass(\"hide\");\n\t\t\t\t$xp.toggleClass(\"hide\");\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t\"hide\": function(d){return !d.parserActive}\n\t\t},\n\t\twatch:\"#fname\"\n\t},\n\t\n\t// Parser\n\t\n\t\"#btn-play\":{\n\t\tdelay:100,\n\t\tbind: function (d,v,$o) {\n\t\t\tvar parser, res, err, atts={}, html=\"\", that=this;\n\t\t\tif (v!=null) {\n\t\t\t\t\n\t\t\t\tif(d.parserActive) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tparser = eval(d.parser);\n\t\t\t\t\t} catch (e){ \n\t\t\t\t\t\tconsole.log(err=\"Parser code has errors, \"+e.message, e.stack);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Object.isFunction(parser)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tres = parser.call(that.RT(), d, atts)+\"\";\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\tconsole.log(err=\"Parser/generator error, \"+e.message, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} \n\t\t\t\t\n\t\t\t\tif (res) {\n\t\t\t\t\t$o.modal({\n\t\t\t\t\t\tmanifest:\tthat.PlayParser,\n\t\t\t\t\t\tdata:\t\t\t{txt:res},\n\t\t\t\t\t\tesc:\t\t\ttrue,\n\t\t\t\t\t\tenter:\t\ttrue,\n\t\t\t\t\t\twidth:\t\t800,\n\t\t\t\t\t\tglobal:\t\ttrue,\n\t\t\t\t\t\tscreen:\t\ttrue\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (err) {\n\t\t\t\t\t(window.l||cw.lib)[\"note\"](err,\"error\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcheck:function(d,v,$o){\n\t\t\tvar parser, err;\n\t\t\ttry {parser = eval(d.parser);} catch (e){}\n\t\t\terr = (!Object.isFunction(parser)?\"Error\":\"\");\n\t\t\t$o.toggleClass(\"red\",!!err);\n\t\t\treturn err;\n\t\t},\n\t\twatch:\"#parser\"\n\t},\n\t\"#parser\":{\n\t\tbind:\"parser\",\n\t\tinit: function($o, form){\n\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\tmode: \"javascript\",\n\t\t\t\tlineNumbers:\t\ttrue,\n\t\t\t\tindentWithTabs:\tfalse,\n\t\t\t\tindentUnit:\t\t\t2,\n\t\t\t\ttabSize:\t\t\t\t2,\n\t\t\t\ttheme: \t\t\t\t\t\"default\"\n\t\t\t});\n\t\t}\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1436263450252","id": ".Item.Settings","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML.add(this.Aux).add(this.Buttons));\n\t},\n\tparams:{width:550},\n\tinherit:[\"RT\"],\n\tui:{\n\t\t\n\t\t\"#npath\":{\n\t\t\tbind: function(d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\treturn s;\n\t\t\t},\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return \"Enter path like <b>.branch.prop</b> for doc branch or <b>/folder/fname.ext</b> for attach\";\n\t\t\t\tif (!/^[\\/\\.]/.test(v)) return 'Path must start with / or .';\n\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t}\n\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t}\n\t\t},\n\t\t\"#mime\":{\n\t\t\tbind:\"mime\",\n\t\t\tcheck:/^[a-z0-9\\-+\\.]{1,30}\\/[a-z0-9\\-+\\.]{1,30}$/,\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d){\n\t\t\t\t\treturn (d.folder.to(1)==\".\")\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#npath\"\n\t\t},\n\t\t'#external':{\n\t\t\t//bind:\"external\",\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\t$o.height(0).height(($o[0].scrollHeight-10).clamp(20,250));\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.external = v;\n\t\t\t\t}\n\t\t\t\treturn d.external;\n\t\t\t},\n\t\t\tcheck: function(d,v) {\n\t\t\t\tif (!/^[x\\s]?(|(http|https|pouch|doc|local|query):\\/\\/[^\\s\\n\\t]+(\\s[\\S]+)?)$/.test(v)) {\n\t\t\t\t\treturn 'External URL or <i>local://doc_id propertyName</i>';\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"self:tdl\":function(d,v) {return v.to(1)==\"x\" || v.to(1)==\" \"}\n\t\t\t}\n\t\t},\n\t\t\"#keywords\":{\n\t\t\tbind:\"tags\",\n\t\t\tinit: function($o){\n\t\t\t\ttry {\n\t\t\t\t\t$o.select2({\n\t\t\t\t\t\ttags:Object.keys(this.RT().data.doc.items.reduce(function(a, it){\n\t\t\t\t\t\t\t(it.tags||[]).forEach(function(t){a[t]=true});\n\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t},{})).sort(),\n\t\t\t\t\t\tplaceholder:'Tags or keywords'\n\t\t\t\t\t})\n\t\t\t\t}catch(e) {\n\t\t\t\t\t$o.select2({tags:[]});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'input[name=\"snippet\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t},\n\t\t\trecalc:\"#cache\"\n\t\t},\n\t\t'input[name=\"parser\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.parserActive = !!(v+\"\");\n\t\t\t\treturn d.parserActive?[\"parser\"]:[];\n\t\t\t}\n\t\t},\n\t\t'input[name=\"noincludes\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.noIncludes = !!(v+\"\");\n\t\t\t\treturn d.noIncludes?[\"noincludes\"]:[];\n\t\t\t}\n\t\t},\n    'input[name=\"dropimport\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.dropImport = !!(v+\"\");\n\t\t\t\treturn d.dropImport?[\"dropimport\"]:[];\n\t\t\t},\n      css:{\n      \thide: function(d,v){return !d.external || d.external[0]==' ';}\n      },\n      watch:'#external'\n\t\t},\n\t\t'input[name=\"stashresolved\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.stashResolved = !!(v+\"\");\n\t\t\t\treturn d.stashResolved?[\"stashresolved\"]:[];\n\t\t\t}\n\t\t},\n\t\t'input[name=\"isbinary\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.isBinary = !!(v+\"\");\n\t\t\t\treturn d.isBinary?[\"binary\"]:[];\n\t\t\t}\n\t\t},\n\t\t'#ref':function(d){return 'local://'+this.RT().data.doc._id+\" items.id=\"+d.id+'.data' },\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-delitem\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\t\n\t\t\t\t\t(function($f, d){\n\t\t\t\t\t\t$f.trigger(\"delitem\", d);\n\t\t\t\t\t})\n\t\t\t\t\t.fill($o.parents(\".my-form\").eq(1), d)\n\t\t\t\t\t.delay(50);\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){\n\t\t\t\t\treturn (d.folder+\"/\"+d.name+\".\"+d.type === \"/index.html\");\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#folder,#name\"\n\t\t},\n\t\t\"#itemtype\":function(d){return this.RT().Types[d.type].name}\n\t},\n\tHTML:[\n\t\t'<h4 class=\"mb10\"><span id=\"itemtype\"></span> <span id=\"ref\" class=\"dib lh100 ml10 fs80 lgray\"></span></h4>',\n\t\t{row:\"550px\", label:\"84px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray pt3\"},\n\t\t\n\t\t[\"\",\n\t\t \t'<span class=\"fr\">','inp#mime.w150', {plc:\"MIME\"}, '</span>',\n\t\t \t'<div class=\"dib vat w380\">', \n\t\t \t\t\"inp#npath.w380\", {plc:\"Resource path\"},\"msg.fs70\",\n\t\t\t'</div>',\n\t\t\t'<span class=\"dib vat mt4 ml8\">:</span>'\n\t\t],\n\t\t\n\t\t[\"Linked to\",'txt#external.fs90',{plc:\"External resource URL\"},\"msg.fs80\"],\n    [\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"dropimport\" value=\"dropimport\"/>',\n\t\t '<span> Do not store imported data in document</span>',\n\t\t '</label>'\n\t\t],\n\t\t\n\t\t[\"Keywords\",'inp#keywords.fs100',\"msg.fs80\"],\n\t\t\n\t\t{rowCss:\"my-row pb3\", labelCss:\"fs80 gray pt1\"},\n\t\t[\"Mode\", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>',\n\t\t ' Fragment (no resource created)',\n\t\t '</label>'\n\t\t],\n\t\t[\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"noincludes\" value=\"noincludes\"/>',\n\t\t '<span> Skip includes</span>',\n\t\t '</label>'\n\t\t],\n\t\t[\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"parser\" value=\"parser\"/>',\n\t\t '<span> Additional parser</span>',\n\t\t '</label>'\n\t\t],\n\t\t[\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"isbinary\" value=\"binary\"/>',\n\t\t '<span> Result is a binary string</span>',\n\t\t '</label>'\n\t\t],\n\t\t[\" \", \n\t\t '<label class=\"gray fs80 dib\">',\n\t\t '<input type=\"checkbox\" name=\"stashresolved\" value=\"stashresolved\"/>',\n\t\t '<span> Stash result as .resolved item‘s property</span>',\n\t\t '</label>'\n\t\t]\n\t],\n\tAux:[],\n\tButtons:[\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green.w80', {val:\"Apply\"},' ', \n\t\t \t\t\t'btn#btn-cancel', {val:\"Cancel\"}, ' ', \n\t\t \t\t\t'btn#btn-delitem.red.fr', {val:\"Delete\"}]\n\t],\n\tstyle:{\n\t\t\" textarea\":\"resize:none;\",\n\t\t\" .select2-search-field\":\"font-size:0.9em\"\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1432578626651","id": ".Takeout","type": "js","data": "({\n\t//params:{width:800},\n\tdata:{json:\"error\"},\n\tinit:[\n\t\t'<textarea id=\"json\" class=\"w100p h400 fs60 lh120 xgray o90\" disabled style=\"font-family:Cousine,\\'PT Mono\\'\"></textarea>',\n\t\t[\"\",\"btn#btn-ok.green.w150.mr30\",{val:\"Ok\"}, \n\t\t '<div class=\"gray fr mt7 fs80\" id=\"stats\"></div>',\n\t\t '<a href=\"\" download=\"\" id=\"btn-dl\" target=\"_blank\" class=\"fs90\">Download as a file</a>'\n\t\t],\n\t\t'<div id=\"comment\" class=\"fs70 gray\"></div>'\n\t],\n\tui:{\n\t\t\"#btn-ok\":function(d,v,$o){\n\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t},\n\t\t\"#json\":function(d){\n\t\t\treturn d.json;\n\t\t},\n\t\t\"#btn-dl\":{\n\t\t\tinit: function($o, form){\n\t\t\t\tif (form.data.objurl) {\n\t\t\t\t\t$o.attr(\"download\", form.data.fname);\n\t\t\t\t\t$o.attr(\"href\", form.data.objurl);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\thide: function(d){return !d.objurl}\n\t\t\t}\n\t\t},\n\t\t\"#stats\":{\n\t\t\tbind:function(d) {return d.json.length.metric(2,false)+\"b\"}\n\t\t},\n\t\t'#comment':{\n\t\t\tbind:\"comment\"\n\t\t}\n\t}\n})","active": false,"opts": [],"err": [],"color": ["teal"]},{"stamp": "1408807909839","id": ".AddItem","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML);\n\t},\n\tparams:{width:445},\n\tui:{\n\t\t\"#npath\":{\n\t\t\tbind: function(d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\treturn s;\n\t\t\t},\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return \"Enter path like <b>.branch.prop</b> for doc branch or <b>/folder/fname.ext</b> for attach\";\n\t\t\t\tif (!/^[\\/\\.]/.test(v)) return 'Path must start with / or .';\n\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t}\n\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t}\n\t\t},\n\t\t\"#ntype\":{\n\t\t\tbind: function (d,v) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.type = v+\"\";\n\t\t\t\t}\n\t\t\t\treturn [d.type]\n\t\t\t},\n\t\t\tinit: function ($o) {\n\t\t\t\tvar i, r, x, \n\t\t\t\t\t\tt = this.RT().Types,\n\t\t\t\t\t\ta=[], em;\n\t\t\t\tfor (i in t) {\n\t\t\t\t\tr = t[i];\n\t\t\t\t\tif (!r.noInsert) {\n\t\t\t\t\t\n\t\t\t\t\t\tif (!em && r.primary) {\n\t\t\t\t\t\t\tem = {};\n\t\t\t\t\t\t\tem[r.name] = i;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tx = {};\n\t\t\t\t\t\t\tx[r.name] = i;\n\t\t\t\t\t\t\ta.push(x);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$o.tags({tags:[a], empty:em});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'input[name=\"snippet\"]':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v!=null) d.snippet = !!(v+\"\");\n\t\t\t\treturn d.snippet?[\"snippet\"]:[];\n\t\t\t},\n\t\t\trecalc:\"#cache\"\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d,v){\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.name || \n\t\t\t\t\t\tthis.getDup(d)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#npath\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t{'row':'445px', label:\"116px\", labelCss:\"fs80 gray\", rowCss:\"my-row pt5 pb7\"},\n\t\t'<h4 class=\"mt0\">Create resource</h4>',\n\t\t[\"\", \"spn#ntype.fs90\"],\n\t\t[\"\", \"inp#npath\", {plc:\"Resource path\"},\"msg.fs70\"],\n\n\t\t{rowCss:\"my-row pt5 pb10\"},\n\t\t[\"\", \n\t\t '<label class=\"gray fs80\">',\n\t\t '<input type=\"checkbox\" name=\"snippet\" value=\"snippet\"/>',\n\t\t ' Fragment (no resource created)',\n\t\t '</label>'\n\t\t],\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Create\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t],\n\tTypelist:[\"html\"]\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1408864311686","id": ".AddFile","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML);\n\t},\n\tui:{\n\t\t\"#npath\":{\n\t\t\tbind: function(d0,v) {\n\t\t\t\tvar d = d0.item;\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.name=d.ext=d.folder=\"\";\n\t\t\t\t\tvar sep = v.to(1);\n\t\t\t\t\tvar a = v.split(sep);\n\t\t\t\t\tif (a.length==2) {\n\t\t\t\t\t\td.folder=sep;\n\t\t\t\t\t\td.name = a[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.folder=sep+a[1];\n\t\t\t\t\t\td.name = a.from(2).compact().join(sep);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar s =  d.folder+(d.folder.length>1?d.folder.to(1):\"\")+d.name;\n\t\t\t\treturn s;\n\t\t\t},\n\t\t\tcheck: function(d0,v){\n\t\t\t\tvar d = d0.item;\n\t\t\t\tif (!v) return \"Enter path like <b>.branch.prop</b> for doc branch or <b>/folder/fname.ext</b> for attach\";\n\t\t\t\tif (!/^[\\/\\.]/.test(v)) return 'Path must start with / or .';\n\t\t\t\tif (v.length<2) return \"Path can not be empty\";\n\t\t\t\tif (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n\t\t\t\tif (v.to(1)==\".\") {\n\t\t\t\t\tif (v.last()==\".\") return \"Branch path can not end with .\";\n\t\t\t\t}\n\t\t\t\tif (this.RT().getDup(d,v)) return \"Resource already exist\"\n\t\t\t}\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t\":disabled\": function(d,v){\n\t\t\t\t\tvar dup = this.getDup(d.item);\n\t\t\t\t\treturn (\n\t\t\t\t\t\t!d.item.name || \n\t\t\t\t\t\t(dup && dup!=\"attachment\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#fext,#ffolder,#fname,#upload\"\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#upload\":{\n\t\t\tbind:function(d,v,$o) {\n\t\t\t\tvar f, a={}, data;\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f.size>1024*1024*20){\n\t\t\t\t\t\t(window.l||cw).note(\"20Mb max\",\"error\");\n\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t}\n\t\t\t\t\telse if (f) (function(){\n\t\t\t\t\t\ta.content_type = f.type||\"application/octet-stream\";\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [], fn = f.name.split(\".\");\n\t\t\t\t\t\td.item.ext = \"\";\n\t\t\t\t\t\td.item.name = f.name.replace(/\\s/g,'-');\n\t\t\t\t\t\td.item.folder = \"/\";\n\t\t\t\t\t\t$o.my(\"find\",\"#npath\").trigger(\"recalc\");\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\t\ta.size = sb64.length;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\td.file = a;\n\t\t\t\t\t\t\t$o.my(\"find\",\".cw-att-upload .pseudolink\").html(\"Other file...\");\n\t\t\t\t\t\t\t$o.my(\"find\",\".unhide\").removeClass(\"hide\");\n\t\t\t\t\t\t\t$o.wrap('<form>').closest('form').get(0).reset();\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:\"#npath\"\n\t\t}\n\t},\n\tHTML:[\n\t\t{'row':'535px', rowCss:\"my-row pt5 pb7 hide unhide\", label:\"166px\", labelCss:\"gray fs80\"},\n\t\t//'<h3>Добавить файл</h3>',\n\t\t'<div class=\"mt5 mb10\">'\n\t\t+'<h3 class=\"cw-att-upload fs100\"><span class=\"pseudolink\">Select a file...</span></h3>'\n\t\t+'<input id=\"upload\" type=\"file\" />'\n\t\t+'</div>',\n\t\t/*[\"\",\n\t\t '<span>', \n\t\t \t'inp#ffolder.w150.fs100', {plc:\"Folder\"} ,\n\t\t '</span> / <span class=\"dib vat w300\">', \n\t\t \t'inp#fname.w300.fs100', {plc:\"Name\"} , \"msg.fs70\",\n\t\t '</span> . ',\n\t\t 'spn#fext.w100.fs80'\n\t\t],*/\n\t\t\n\t\t[\"\", \"inp#npath\", {plc:\"Resource path\"},\"msg.fs70\"],\n\t\t\n\t\t\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Attach\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t\t\n\t],\n\tstyle:{\n\t\t\" input[type=file]\":\"width:100%;cursor:pointer;opacity:0; position:absolute;top:0;left:0;height:1.5em\"\n\t}\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["teal"]},{"stamp": "1537487490211","id": ".AddFiles","type": "js","data": "({\n\tinit: function($o){\n\t\tvar that = this;\n\t\t\n\t\t$o.html(that.HTML);\n\t},\n\tdata:{\n\t\tfiles:[]\n\t},\n\tui:{\n\t\t'#flist':{\n\t\t\tbind:'files',\n\t\t\tlist:'>div',\n\t\t\tmerge:false,\n\t\t\tid:['name'],\n\t\t\thash:function(e){return cw.lib.sdbm([e.name, e.content_type, e.data.length, e.data.to(100)])},\n\t\t\tmanifest:{\n        inherit:['getDup'],\n        data:{folder:'',name:'',ext:''},\n\t\t\t\tui:{\n          \"#fname\":{\n            bind: function(d,v) {\n              if (v!=null) {\n                d.name = d.ext = d.folder = '';\n                var sep = v.to(1);\n                var a = v.split(sep);\n                if (a.length == 2) {\n                  d.folder = sep;\n                  d.name = a[1];\n                } else {\n                  d.folder = sep+a[1];\n                  d.name = a.from(2).compact().join(sep);\n                }\n\n                return v;\n              }\n              var s =  d.folder+(d.folder.length>1?d.folder.to(1):'')+d.name;\n              return s;\n            },\n            check: function(d,v){\n              if (!v) return \"Enter path like <b>/folder/fname.ext</b>\";\n              if (!/^[\\/\\.]/.test(v)) return 'Path must start with /';\n              if (v.length<2) return 'Path can not be empty';\n              if (v.indexOf(\" \") !=-1) return 'Path can’t contain spaces';\n              if (this.getDup(d,v)) return \"Resource already exists\"\n            }\n          },\n\t\t\t\t\t'#fsize':function(d,v){\n\t\t\t\t\t\treturn (d.data.length/4*3|0).bytes(1).replace(/B$/,'b').replace(\n\t\t\t\t\t\t\t/^([0-9\\.]+)([a-z]+)$/i,\n\t\t\t\t\t\t\t'$1<div class=\"w35 dib tal pl2\">$2</div>'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\t'#ftype':'content_type',\n\t\t\t\t\t'#btn-fdel':{\n\t\t\t\t\t\tdelay:10,\n\t\t\t\t\t\tbind:function(d,v){\n              if (v!=null) {\n                this.my.root().trigger('layout.my');\n                this.my.remove();\n              }\n            },\n\t\t\t\t\t\tevents:'click.my'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'#btn-attadd':{\n\t\t\tbind:function(d,v){if(v!=null) this.my.commit();},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d){return !d.files.length}\n\t\t\t},\n\t\t\twatch:'#flist'\n\t\t},\n\t\t'#btn-attcancel':function(d,v){if(v!=null) this.my.cancel();},\n\t\t'#mupload':{\n\t\t\tbind:function(d,v,$o) {\n\t\t\t\tif (v==null || !v) return;\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tflist = $o[0].files,\n\t\t\t\t\t\tfiles = [],\n\t\t\t\t\t\tresult = d.files.reduce(function(a,b){a[b.fname] = b;return a;},{}),\n\t\t\t\t\t\tpis = [];\n\t\t\t\t\n\t\t\t\tfor(var i=0; i<flist.length;i++) files.push(flist[i]);\n\t\t\t\t\n\t\t\t\tfiles.forEach(function(f, i){\n\t\t\t\t\tif (!f || result[f.name]) return;\n\t\t\t\t\t//a.name = f.name;\n\t\t\t\t\tvar data,\n\t\t\t\t\t\t\ta = {\n                fname:\tf.name,\n\t\t\t\t\t\t\t\tname: '/'+f.name.replace(/\\s+/g,'-'),\n\t\t\t\t\t\t\t\tcontent_type: f.type || 'application/octet-stream'\n\t\t\t\t\t\t\t}, \n\t\t\t\t\t\t\tpi = $.Deferred(),\n\t\t\t\t\t\t\tfr = new FileReader(), \n\t\t\t\t\t\t\tri, \n\t\t\t\t\t\t\tsb64 = [];\n\t\t\t\t\t\n\t\t\t\t\tfr.onload = function(e){\n\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\ta.size = sb64.length;\n\t\t\t\t\t\tresult[f.name] = a;\n\t\t\t\t\t\tpi.resolve();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t\tpis.push(pi.promise())\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tQ.allSettled(pis)\n\t\t\t\t.then((function(){\n\t\t\t\t\td.files = Object.values(result);\n\t\t\t\t\t$o.wrap('<'+'form>').closest('form').get(0).reset();\n\t\t\t\t\t$o.unwrap('form');\n\t\t\t\t\tthat.my.recalc('#flist');\n          that.my.check('#flist');\n          that.my.root().trigger('layout.my');\n\t\t\t\t}).debounce(0));\n\t\t\t}\n\t\t}\n\t},\n\t\n\tHTML:[\n\t\t'<div class=\"fs120 lh160 bolder\">Add files</div>',\n\t\t\n\t\t'<div id=\"flist\">',\n\t\t\t'<div class=\"frow  mb6\">',\n\t\t\t\t'<div id=\"btn-fdel\" class=\"red2 w20 dib vat pt3 cp\">✕</div>',\n\t\t\t\t'<div class=\"w300 dib vat\">',\n    \t\t\t'<input type=\"text\" class=\"w100p\" id=\"fname\" placeholder=\"File path/name.ext\">',\n    \t\t\t'<div class=\"my-error-tip mt4 mb0\" style=\"display:none\"></div>',\n    \t\t'</div>',\n\t\t\t\t'<div id=\"fsize\" class=\"w90 dib vat pt3 gray tar\"></div>',\n\t\t\t\t'<div id=\"ftype\" class=\"w150 dib vat pt3 gray nw ell\"></div>',\n\t\t\t'</div>',\n\t\t'</div>',\n\t\t'<div class=\"mt10\">',\n\t\t\t'<input id=\"mupload\" type=\"file\" multiple class=\"h30 w100p cp\" style=\"position:absolute;z-index:1;opacity:0;\">',\n\t\t\t'<div class=\"h30 pseudolink tdn\">Select files to attach...</div>',\n\t\t'</div>',\n\t\t'<div class=\"mt5 pt10 btd\">',\n\t\t\t'<button id=\"btn-attadd\" class=\"green mr2\">Attach files</button>',\n\t\t\t'<button id=\"btn-attcancel\">Cancel</button>',\n\t\t'</div>'\n\t].join(''),\n  \n  style:{\n  \t\t' ':'font-size:16px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1409526912611","id": ".AddImage","type": "js","data": "({\n\t\"data\": {\n\t\tfilename: \"\",\n\t\tfolder:\"\",\n\t\tquality:\"0.98\",\n\t\tdata: \"\",\n\t\tpreview:\"\",\n\t\tmime:\"image/jpeg\",\n\t\tmode:[\"inline\"],\n\t\tcropped: false,\n\t\twidth: \"300\",\n\t\theight:\"200\",\n\t\tscale: \"1\",\n\t\tcrop: {},\n\t\tsrcsize:true\n\t},\n\tparams:{width:1020},\n\tinit: undefined /* See tab */,\n\tstyle:{\n\t\t\" .jcrop-holder\":\"display:inline-block;vertical-align:middle\"\n\t},\n\tRecalc: function (d , $o, update){\n\t\tvar that = this;\n\t\tif (that.Active ==\"fh\") {\n\t\t\td.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fh\").trigger(\"check\");\n\t\t}\n\t\telse if (that.Active == \"fw\") {\n\t\t\td.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t\telse {\n\t\t\td.width = (d.crop.w*d.scale).floor();\n\t\t\td.height = (d.crop.h*d.scale).floor();\n\t\t\tif (update) $o.my(\"find\",\"#fw\").trigger(\"check\");\n\t\t}\n\t},\n\tui: {\n\t\t\"#folder\":{\n\t\t\tbind:\"folder\",\n\t\t\tcheck:/^[a-z0-9\\-\\.]{0,20}$/i,\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !Object.size(d.crop)}\n\t\t\t}\n\t\t},\n\t\t\"#format\":{\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v!=null) {\n\t\t\t\t\td.quality = v;\n\t\t\t\t\tif (v+\"\"==\"1\") {\n\t\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.png');\n\t\t\t\t\t} else {\n\t\t\t\t\t\td.filename = d.filename.replace(/\\.[a-z0-9]+$/i,'.jpg');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.quality;\n\t\t\t},\n\t\t\tinit: function($o) {\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:[[\n\t\t\t\t\t\t{\"High quality JPEG\":\"0.98\"},\n\t\t\t\t\t\t{\"Normal\":\"0.95\"},\n\t\t\t\t\t\t{\"Med\":\"0.88\"},\n\t\t\t\t\t\t{\"Low\":\"0.75\"},\n\t\t\t\t\t]],\n\t\t\t\t\tempty:{\"PNG\":\"1\"}\n\t\t\t\t})\n\t\t\t},\n\t\t\twatch:\"#folder\",\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !Object.size(d.crop)}\n\t\t\t}\n\t\t},\n\t\t\"#fname\":{ \n\t\t\tbind:\"filename\",\n\t\t\tcheck:function(d,v){\n\t\t\t\tif (!/^[a-z0-9\\-\\.]{1,40}$/i.test(v)) return \"Latins, 40 chars max\";\n\t\t\t\t//if (this.getDup(d, v)) return \"Имя занято\";\n\t\t\t},\n\t\t\twatch:\"#folder,#format\",\n\t\t\tcss:{ hide: function(d){ return !Object.size(d.crop)} }\n\t\t},\n\t\t'input[name=\"srcsize\"]':{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.srcsize = !!(v+\"\");\n\t\t\t\t}\n\t\t\t\tif (d.srcsize) {\n\t\t\t\t\tthis.Active = \"\";\n\t\t\t\t\tthis.Recalc (d, $o, false);\n\t\t\t\t}\n\t\t\t\treturn d.srcsize?[\"srcsize\"]:[];\n\t\t\t},\n\t\t\twatch:\"#folder\",\n\t\t\tcss:{ hide: function(d){ return !Object.size(d.crop)} }\n\t\t},\n\t\t\"#fw\": {\n\t\t\t\"bind\": function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.width=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)\t) d.height = (d.width/d.crop.w*d.crop.h).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.width+\"\";\n\t\t\t},\n\t\t\trecalcDepth:1,\n\t\t\tdelay:20,\n\t\t\twatch:'#fh,#folder,input[name=\"srcsize\"]',\n\t\t\tcss:{\n\t\t\t\thide: function(d){ return !Object.size(d.crop)},\n\t\t\t\t\"self:gray\":function(d,v,$o){\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#fh\": {\n\t\t\t\"bind\": function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tif (this.Active === $o.attr(\"id\")) {\n\t\t\t\t\t\td.height=(parseInt(v)||300).clamp(0,3000);\n\t\t\t\t\t\tif (Object.size(d.crop)) d.width = (d.height/d.crop.h*d.crop.w).floor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn d.height+\"\";\n\t\t\t},\n\t\t\twatch:\"#fw\",\n\t\t\trecalcDepth:1,\n\t\t\tdelay:20,\n\t\t\tcss:{\n\t\t\t\t\"self:gray\":function(d,v,$o){\n\t\t\t\t\treturn (this.Active !== $o.attr(\"id\"));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#file\": {\n\t\t\t\"bind\": function (d, v, $o){\n\t\t\n\t    \t\tvar f,that = this,\n\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\timg=\"\";\n\t    \t\t\n\t    \t\t\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\td.filename = f.name\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.replace(/[^a-z0-9\\-\\.]/gi,'');\n\t\t\t\t\t\t\t//.replace(/\\.[^\\.]+$/,\"\")+\".jpg\";\n\n\t\t\t\t\t\tvar ext = d.filename.split(\".\").last();\n\t\t\t\t\t\tif (ext==\"png\") d.quality=\"1\";\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\td.filename = d.filename.replace(/\\.[^\\.]+$/,\"\")+\".jpg\";\n\t\t\t\t\t\t\td.quality=\"0.98\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\timg = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tfr.onloadend = function (){\n\t\t\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\t\t\td.scale = $img[0].naturalWidth/$img.width();\n\t\t\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\t\t\tallowMove:true,\n\t\t\t\t\t\t\t\t\tbgColor:\"white\"\n\t\t\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\t\t\tthis.animateTo([0,0,100,100]);\n\t\t\t\t\t\t\t\t\td.crop.z=1;\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#folder\").trigger(\"check\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\timg=\"\";\n\t\t\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$img.removeClass(\"hide\")\n\t\t\t\t\t\t\t\t.attr(\"src\",\"data:image/jpeg;base64,\"+img);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//d.scale=$img[0].naturalWidth/$img.width();\t\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction preview(c){\n\t\t\t\t\t$.extend(d.crop, Object.select(c,[\"x\",\"y\",\"w\",\"h\"]));\n\t\t\t\t\td.cropped=true;\n\t\t\t\t\t\n\t\t\t\t\tthat.Recalc(d, $o, true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#btn-apply\": { /* See tab */ },\n\t\t\"#btn-close\": {\n\t\t\t\"bind\": function (d,v,$o) {if (v!=null) $o.trigger(\"cancel\");},\n\t\t\t\"events\": \"click.my\"\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1438563922424","id": ".AddImage.init","type": "js","data": "(function ($o, form) {\n\t\tvar that = this,\n\t\t\t\td = form.data,\n\t\t\t\thtml = $.my.formgen([\n\t\t\t'<div class=\"fl mr20 tac vat bg-lgray\" style=\"'\n\t\t\t+'width:800px;height:600px;overflow:hidden;position:relative;line-height:600px;\" id=\"crop-frame\">',\n\t\t\t\t\t'<img id=\"source\" class=\"vam\" style=\"max-width:800px; max-height:600px;background-color:white; \" src=\"\" />',\n\t\t\t\t'<div class=\"w800  dib\" style=\"height:600px;position:absolute;top:0;left:0\">',\n\t\t\t\t\t'<span class=\"dib vam fs110 button\">',\n\t\t\t\t\t'<span class=\"fi-photo\"><span class=\"fs110\"> &nbsp;Select image</span></span>',\n\t\t\t\t\t'</span>',\n\t\t\t\t\t'<input type=\"file\" id=\"file\" class=\"w800 dib\" accept=\"image/jpeg,image/png\" '\n\t\t\t\t\t+'style=\"height:600px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xpreview\">',\n\t\t\t\t{row:\"200px\",rowCss:\"pb10 my-row\"},\n\t\t\t\t[\"\",\"inp#folder\",{plc:\"Folder\"},\"msg.fs70\"],\n\t\t\t\t[\"\",\"inp#fname\",{plc:\"Filename\"},\"msg.fs70\"],\n\t\t\t\t[\"\", \"spn#format.fs80\"],\n\t\t\t\t[\"\",\"num#fw.w90.fs110.sizer\",{min:20, max:3000, step:5},'&thinsp;&thinsp;×&thinsp;&thinsp;', \n\t\t\t\t \t\"num#fh.w90.fs110.sizer\", {min:20, max:3000, step:5}],\n\t\t\t\t/*[\"\",\"spn#mode.fs100.lh150\"],*/\n\t\t\t\t[\"\", '<label class=\"fs80\">',\n\t\t\t\t \t'<input type=\"checkbox\" name=\"srcsize\" value=\"srcsize\">',\n\t\t\t\t \t' &nbsp;Original dimensions',\n\t\t\t\t\t'</label>'],\n\t\t\t\t{rowCss:\"\"},\n\t\t\t\t[\"\",\n\t\t\t\t \"btn#btn-apply.w200.green.fs120.tac\",{val:\"Crop\"},\n\t\t\t\t //\"btn#btn-orig.w200.tac\",{val:\"Вставить оригинал\"},\n\t\t\t\t \"btn#btn-close.w200.tac\",{val:\"Cancel\"}\n\t\t\t\t],\n\t\t\t'</div>',\n\t\t\t'<div class=\"w200 dib vat\" id=\"xwarn\"></div>',\n\t\t\t'<div class=\"hide\">',\n\t\t\t\t'<canvas id=\"x2\" width=400 height=400></canvas>',\n\t\t\t\t'<canvas id=\"x1\" width=200 height=200></canvas>',\n\t\t\t'</div>'\n\t\t]);\n\t\t$o.html(html);\n\t\tthat.Active = \"\";\n\t\t$o.on(\"focus.my\",\".sizer\", function(){\n\t\t\tif (!d.srcsize) {\n\t\t\t\tthat.Active = $(this).attr(\"id\");\n\t\t\t\t$(this).removeClass(\"gray\");\n\t\t\t} else {\n\t\t\t\tthat.Active = \"\";\n\t\t\t}\n\t\t});\n\t\t\n\t})","active": false,"err": [],"opts": [],"color": []},{"stamp": "1438564123510","id": ".AddImage.ui.#btn-apply","type": "js","data": "({\n\n\t\"bind\": function (d,v,$o) {\n\t\tvar f, that = this,\n\t\t\t\t$r = $o.my().root,\n\t\t\t\t$c = $r.find(\"#x1\"),\n\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t$c2 = $r.find(\"#x2\"),\n\t\t\t\tn={k:d.scale}, img=\"\",\n\t\t\t\twidth=d.width*1.5;\n\n\t\tif (v!=null && d.cropped) {\n\t\t\t_create (d.crop);\n\t\t\t\n\t\t\tif (d.quality+\"\" !=\"1\") {\n\t\t\t\td.data = $o.my(\"find\",\"#x1\")[0].toDataURL('image/jpeg',+d.quality).substr(23);\n\t\t\t\td.mime = \"image/jpeg\";\n\t\t\t} else {\n\t\t\t\td.data = $o.my(\"find\",\"#x1\")[0].toDataURL('image/png').substr(22);\n\t\t\t\td.mime = \"image/png\";\n\t\t\t}\n\n\t\t\tvar ico = cw.lib.image($c,\"white\").resample(120);\n\t\t\tif (ico.height()>120) ico.resample(14400/ico.height())\n\t\t\td.preview = ico.sharpen(0.1).contrast(1.05).jpeg(0.65);\n\n\t\t\t$o.trigger(\"commit\");\n\t\t}\n\n\t\tfunction _create (c){\n\t\t\tif(parseInt(c.w) > 0) {\n\t\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\t\tk = n.k,\n\t\t\t\t\t\tw = c.w*k, // scale width/height\n\t\t\t\t\t\th = c.h*k; \n\n\t\t\t\tif (!that.Active) {\n\t\t\t\t\tcs = $c[0];\n\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\tctx.drawImage(img, (c.x*k).floor(), (c.y*k).floor(), d.width*1, d.height*1, 0, 0, d.width*1, d.height*1);\n\n\t\t\t\t} else { \n\t\t\t\t\tif (w>d.width*2) {\n\t\t\t\t\t\tcs2 = $c2[0];\n\t\t\t\t\t\tcs2.width=d.width*2;\n\t\t\t\t\t\tcs2.height=2*d.height;\n\t\t\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\t\t\tctx2.rect(0, 0, cs2.width, cs2.height);\n\t\t\t\t\t\tctx2.fillStyle='white';\n\t\t\t\t\t\tctx2.fill();\n\t\t\t\t\t\tctx2.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*2,d.height*2);\n\n\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\tctx.drawImage(cs2, 0, 0, d.width*2,d.height*2, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\tcs.width=d.width;\n\t\t\t\t\t\tcs.height=d.height;\n\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\tctx.rect(0, 0, cs.width, cs.height);\n\t\t\t\t\t\tctx.fillStyle='white';\n\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\tctx.drawImage(img, c.x*k, c.y*k, w, h, 0, 0, d.width*1, d.height*1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\"events\": \"click.my\",\n\twatch:\"#folder\",\n\tcss:{\n\t\t\":disabled\": function(d){ return !Object.size(d.crop)}\n\t}\n\n})","active": false,"err": [],"opts": [],"color": []},{"stamp": "1409263717515","id": ".ParseErrors","type": "js","data": "({\n\tinit: function($o, form){\n\t\t$o.formgen(this.HTML);\n\t},\n\tparams:{ width:450 },\n\tui:{\n\t\t\"#errs\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tvar i, h = '<table width=\"450\">';\n\t\t\t\tfor (i in d.err) {\n\t\t\t\t\th+='<tr><td class=\"w150 xgray pr15 brw btd\">'\n\t\t\t\t\t\t+i+'</td><td class=\"red vam btd\">'\n\t\t\t\t\t\t+d.err[i].join(\"<br>\")\n\t\t\t\t\t\t+'</td></tr>';\n\t\t\t\t}\n\t\t\t\treturn h+'</table>'\n\t\t\t}\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"commit\");\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#errtitle\":function(d){\n\t\t\tvar i = Object.size(d.err), e = Object.values(d.err).flatten().length;\n\t\t\treturn \"Found \"+e+\" error\"+(e>1?\"s\":\"\")+\" in \"+i+\" item\"+(i>1?\"s\":\"\");\n\t\t},\n\t\t\"#efooter\":{\n\t\t\tbind: function(d){ return \"&nbsp;\"+d.footer},\n\t\t\tcss:{\n\t\t\t\thide: function(d) {return !d.footer}\n\t\t\t}\n\t\t},\n\t\t\".ebtns\":{\n\t\t\tcss:{\n\t\t\t\thide: function(d) {return !d.buttons}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<h4 class=\"mb10 fs100\" id=\"errtitle\"></h4>',\n\t\t{row:\"450px\", label:\"100px\", rowCss:\"my-row pb10\", labelCss:\"fs80 gray\"},\n\t\t\n\t\t'<div id=\"errs\" class=\"fs80 w450\"></div>',\n\t\t\n\t\t'<div id=\"efooter\" class=\"fs80 fi-alert xgray mt5\"></div>',\n\t\t\n\t\t{rowCss:\"my-row pt12 mt7 btd fs80 ebtns\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Proceed\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t],\n\tstyle:{\n\t\t\" td\":\"padding:4px 0; font-size:85%; line-height:1.2em;\",\n\t\t\" .brw\":\"word-break:break-word\",\n\t\t\" #errs\":\"max-height:400px;overflow-y:auto;\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1436912097192","id": ".Confirm","type": "js","data": "({\n\tid:\"cw.Sys.YesNoCancel\",\n\tparams:{\n\t\tdelay:5, \n\t\twidth:450\n\t},\n\tdata:{\n\t\ttext:\"\",\n\t\tcss:\"xgray\",\n\t\tyes:\"Yes\",\n\t\tno:\"No\",\n\t\tcancel:\"Cancel\",\n\t\tcmd:\"\"\n\t},\n\tinit: function ($o, form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t    '<div class=\"'+d.css+'\">'+d.text+'</div>',\n\t\t\t{label:\"70px\", row:form.params.width+\"px\", rowCss:\"my-row mt15 pt15 fs90 mb-5 xgray btd\"},\n\t\t\t['', 'spn#btn-yes.button.green.mr5',{txt:d.yes}, \n\t\t\t \t'spn#btn-no.button.mr5',{txt:d.no}, \n\t\t\t\t'spn#btn-cancel.button.fr',{txt:d.cancel}]\n\t\t]);\n\t},\n\tui:{\n\t\t\"#btn-yes\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"yes\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.yes}\n\t\t\t}\n\t\t},\n\t\t\"#btn-no\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"no\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.no}\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"cancel\";\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.cancel}\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1409001251370","id": ".DocParams","type": "js","data": "({\n\tinherit:['Path','RT'],\n\tinit: function($o, form){ \n\t\t$o.formgen(this.HTML);\n\t\tvar that = this, d = form.data;\n\t\tif (!(d.creds.crypto + '')) {\n\t\t\t$.extend(!0, that.couch, d.couch);\n\t\t} else if (cw.crypto && cw.crypto.has(d.creds.crypto)) {\n\t\t\tif (!d.creds.CRYPTO) {\n\t\t\t\td.creds.crypto = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar obj = cw.crypto.dec(d.creds);\n\t\t\t\tif (!obj.CRYPTO) {\n\t\t\t\t\t$.extend(!0, that.couch, obj.couch);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthat.nokey = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t} else {\n\t\t\tthat.nokey = true;\n\t\t}\n\t},\n\tnokey:false,\n\tcouch:{\n\t\tdburl:\t'',\n\t\tdocid:\t'',\n\t\tlogin:\t'',\n\t\tpwd:\t\t''\n\t},\n\tui:{\n\t\t\"#title\":{\n\t\t\tbind:\t\t'name',\n\t\t\tcheck:\t/^.+$/\n\t\t},\n    '#ddtags':{\n      init: function($o){\n        $o.select2({\n          tags:this.RT().db && Object.isFunction(this.RT().db.tags)?this.RT().db.tags():[],\n          minimumResultsForSearch:15,\n          placeholder:'Project tags'\n        });\n      },\n      bind:'tags'\n    },\n\t\t\"#login\":{\n\t\t\tbind:'this.couch.login'\n\t\t},\n\t\t\"#pwd\":{\n\t\t\tbind:'this.couch.pwd',\n\t\t\tcheck:function(d, v){\n\t\t\t\tif (this.couch.login && !v) return 'Password required';\n\t\t\t},\n\t\t\twatch:'#login'\n\t\t},\n\t\t\"#docid\":{\n\t\t\tbind:\t\t'this.couch.docid',\n\t\t\tcheck:\t/^(_design\\/)?[^\\s\\r\\t\\n\\/_][^\\s\\r\\t\\n\\/]{0,200}$/i\n\t\t},\n\t\t\"#url\":{\n\t\t\t//bind:\"this.couch.dburl\",\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\t$o.height(0).height($o[0].scrollHeight-8);\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tthis.couch.dburl = v;\n\t\t\t\t}\n\t\t\t\treturn this.couch.dburl;\n\t\t\t},\n\t\t\tcheck:/^(http[s]?:\\/)?\\/[^\\s\\r\\t\\n]{1,200}$|^\\.$/\n\t\t},\n\t\t\"#preview\":{\n\t\t\tbind:\"site.previewBase\",\n\t\t\tcheck:/^http[s]?:\\/\\/[^\\s\\r\\t\\n]{3,200}$/,\n\t\t\tcss:{\n\t\t\t\thide: function (){return true}\n\t\t\t}\n\t\t},\n\t\t\"#btn-ok\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\tvar that = this, i;\n\t\t\t\t\tif (d.creds.crypto+\"\" && !that.nokey) {\n\t\t\t\t\t\tfor (i in d.couch) d.couch[i]=\"\";\n\t\t\t\t\t\td.creds = cw.crypto.enc({\n\t\t\t\t\t\t\tcrypto:d.creds.crypto+\"\",\n\t\t\t\t\t\t\tcouch:Object.clone(that.couch, true)\t\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (!(d.creds.crypto+\"\")) {\n\t\t\t\t\t\t$.extend(d.couch,that.couch);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"#btn-cancel\":{\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tif (v!=null) $o.trigger(\"cancel\");\n\t\t\t}\n\t\t},\n\t\t\"#cryptokey\":{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.creds.crypto=v;\n\t\t\t\t\tif (v!=\"_\") d.creds.crypto=v;\n\t\t\t\t\telse d.creds.crypto=\"\";\n\t\t\t\t}\n\t\t\t\treturn v||d.creds.crypto||\"_\";\n\t\t\t},\n\t\t\tinit: function($o) {\n\t\t\t\t$o.html(\n\t\t\t\t\t[ {id:\"_\",name:\"No encryption\"} ]\n\t\t\t\t\t.add( cw.crypto?cw.crypto.keys():[] )\n\t\t\t\t\t.reduce(function(a,b){\n\t\t\t\t\t\treturn a+('<option value=\"{id}\">{name}</option>').assign(b);\n\t\t\t\t\t},\"\")\n\t\t\t\t).select2();\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\thide: function() {return !cw.crypto || this.nokey;}\n\t\t\t}\n\t\t},\n\t\t\"#haskey\":{\n\t\t\tcss:{\n\t\t\t\thide: function(){ return !!this.nokey}\n\t\t\t}\n\t\t},\n\t\t\"#nokey\":{\n\t\t\tcss:{\n\t\t\t\thide: function(){return !this.nokey}\n\t\t\t}\n\t\t},\n\t\t\"#exportmode\":{\n\t\t\tbind:\"export.options\",\n\t\t\tinit: function($o) {\n\t\t\t\t$o.tags({tags:[[{\"Extend existing\":\"extend\"},{\"Replace it\":\"replace\"}]]});\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<h4 class=\"mb10\">Doc and remote CouchDB settings</h4>',\n\t\t{row:\"525px\", label:\"125px\", rowCss:\"my-row pb10 fs90\", labelCss:\"fs90 gray\"},\n\t\t\n\t\t['Proj title','inp#title.bold'],\n    ['Proj tags','inp#ddtags.w100p.fs105'],\n\t\t['Preview URL','inp#preview', {plc:\"URL of an app or preview\"}],\n\t\t\n\t\t['Remote DB','txt#url.fs100', {plc:\"Full CouchDB URL with port and DB name\"}],\n\t\t['Doc _id',\n\t\t \t'<span>', \n\t\t \t'inp#docid.w310.mr10', \n\t\t \t{plc:\"Any valid CouchDB _id\"}, \n\t\t \t'</span><span>',\n\t\t \t'btn#btn-import.w80', \n\t\t \t{val:\"Import\"},\n\t\t \t'</span>'\n\t\t],\n\t\t'<section id=\"haskey\">',\n\t\t\t['Login / pwd',\n\t\t\t '<span>','inp#login.w200.mr10',{plc:\"CouchDB login\"}, '</span>',\n\t\t\t '<span>', 'inp#pwd.w190',{plc:\"CouchDB password\"}, '</span>'\n\t\t\t],\n\n\t\t\t['Encrypt creds','sel#cryptokey.w200',' <span class=\"fs90 gray pl10\">Key to encrypt secrets</span>'],\n\t\t\n\t\t'</section>',\n\t\t'<section id=\"nokey\" class=\"hide red fs90 pt10 pb10\">',\n\t\t\t'Credentials are encrypted with the key you don‘t have, sorry.',\n\t\t'</section>',\n\t\t[\n\t\t\t'If doc exists', 'spn#exportmode'\n\t\t],\n\t\t{rowCss:\"my-row pt15 mt7 btd fs90\"},\n\t\t[\"\", 'btn#btn-ok.green', {val:\"Apply\"},' ', 'btn#btn-cancel', {val:\"Cancel\"}]\n\t],\n\tstyle:{\n\t\t\" textarea\":\"resize:none;\"\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1435956742566","id": ".DocParams.ui.#btn-import","type": "js","data": "({\n  delay:100,\n  bind: function(d,v,$o) {\n    \n    if (v==null) return;\n    \n    var that = this, i, j, url,\n        obj = that.couch || that.RT().GetSettings(\"couch\"),\n        couch = obj.dburl.replace(/\\/$/,'')+'/',\n        creds = (obj.login && obj.pwd) ? obj.login +\":\" + obj.pwd :'',\n        id = obj.docid,\n        headers = {Accept:\"text/plain\"},\n        op;\n\n    if (couch == './') {\n      // local doc\n      op = that.RT().db.get(id, {attachments:true});\n    }\n    else {\n      // Remote doc\n      url = couch+id;\n      if (creds) headers.Authorization = 'Basic '+ cw.lib.base64(creds);\n\n      that.my.root().addClass('busy');\n\n      op = $.ajax({\n        url:\t\t\turl+'?attachments=true',\n        method:\t\t'GET',\n        cache:\t\tfalse,\n        dataType:\t'json',\n        headers:\theaders\n      });\n    }\n\n    // load doc\n    op.then(\n      _processDoc,\n      function(){\n        that.my.root().removeClass('busy');\n        cw.lib.note('Couldn‘t fetch doc to import.','error');\n      }\n    );\n\n    return;\n\n    // - - - - - - - - - - - - - - - - - -\n\n    function _processDoc (nd){\n      // merge\n      var i, \n          nda = nd._attachments,\n          od = d.items,\n          oda = nd._attachments && !d._attachments?(d._attachments={}):d._attachments,\n          nogo = {},\n          ctr = od.length;\n      // existing\n      od.forEach(function(e){nogo[that.Path(e)]=true});\n\n      that.my.root().removeClass(\"busy\");\n\n      //enum nodes\n      var ext = []; \n\n      var iter = function(e, node, start) {\n        var n1 = node || nd, \n            os = start ?Object.clone(start,true):({folder:'.',data:''});\n        if (nogo[(os.folder != '.'?os.folder:'')+'.'+e]) return;\n        if (!node && Object.isObject(n1[e])){\n          Object.keys(n1[e]).forEach(iter.fill(undefined, n1[e], {folder:'.'+e,data:''}));\n          return;\n        }\n        os.name = e;\n        if (Object.isString(n1[e])) {\n\n          var n2 = cw.lib.unjson([n1[e]]);\n          if (!Object.isString(n2[0])) {\n            ext.push($.extend(true, os, {\n              type:\t'json',\n              data:\t'('+cw.lib.js2txt(n2[0],'  ').replace(/\\n+/g,'\\n')+')',\n              mime:\t'application/json'\n            }));\n          }\n          else {\n            var tmode = _guessCodeType(n1[e]);\n            ext.push($.extend(true, os, {\n              type:\ttmode[0],\n              data:\tn1[e],\n              mime:\ttmode[1]\n            }));\n          }\n        }\n        else ext.push($.extend(true, os,{\n          type:\t'json',\n          data:\t'('+cw.lib.js2txt(cw.lib.unjson(n1[e]),'  ').replace(/\\n+/g,'\\n')+')',\n          mime:\t'application/json'\n        }));\n      };\n\n      Object.keys(Object.reject(nd,/^_/)).forEach(iter.fill(undefined, false, {folder:'.',data:''}));\n\n      ext.forEach(function(obj) {\n        var ni = $.extend(!0,{}, that.RT().Item.data, {id:that.RT().GenId()});\n        $.extend(ni, obj);\n        od.push(ni);\n      });\n\n      //enum new atts\n      Object.keys(nda||{}).forEach(function(i){\n\n        if (!nogo['/'+i]) {\n\n          var n = nda[i],\n              nm = n.content_type, \n              ni = $.extend(!0,{}, that.RT().Item.data, {id:that.RT().GenId(), data:''});\n\n          ni.type = 'attachment';\n          ni.mime = nm;\n          if (!i.has('/')) ni.name = i;\n          else {\n            var a = i.split('/');\n            ni.folder = \"/\"+a[0];\n            ni.name = a.slice(1).join(\"/\");\n          }\n\n          // look for editable attaches \n          if (nm == 'text/plain') \t\t\t\t\t\tni.type = 'txt';\n          else if (/\\/javascript$/i.test(nm)) ni.type = 'js';\n          else if (/\\/json$/i.test(nm)) \t\t\tni.type = 'json';\n          else if (/\\/css$/.test(nm)) \t\t\t\tni.type = 'css';\n          else if (/\\/[x]?htm[l]?$/.test(nm)) ni.type = 'html';\n\n          if (ni.type != 'attachment') ni.data = cw.lib.base64(n.data, true);\n          else oda[i] = {\n            content_type: nm || 'application/octet-stream',\n            data:\t\t\t\t\tn.data\n          };\n\n          if (typeof ni.data != 'string') {\n            ni.data = cw.lib.js2txt(ni.data, '  ');\n            if (ni.type == 'json' || ni.type=='js') ni.data = '('+ni.data+')';\n          }\n          od.push(ni);\n        }\n      });\n\n      if (od.length> ctr) {\n        cw.lib.note('Fetched '+(od.length - ctr)+' nodes. Click Apply button to merge with the project.','ok', 5000);\n      }\n      else {\n        cw.lib.note('Added no new nodes from imported doc.');\n      }\n    }\n\n    // - - - - - - - - - -  -\n\n    function _guessCodeType(t){\n      var start = t.substr(0,800),\n          mode = ['txt','text/plain'];\n      if ((start.match(/(var\\s|const\\s|function[\\s\\(]|return\\s|[\\s\\t]if\\s)/g)||[]).length > 2) {\n        mode = ['js','application/javascript'];\n      }\n      else if (\n        /<\\/(div|span|p|a|script|head|title|svg|path)/.test(start)\n        || /<(svg|path|group)\\s/.test(start)\n      ) {\n        mode = ['html','text/html'];\n      }\n      else if (CodeMirror.modes.erlang && /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/.test(start)) {\n        mode = ['erlang','text/x-erlang'];\n      }\n      return mode;\n    }\n  },\n  css:{\n    \":disabled\":function(d){\n      var db = this.couch.dburl,\n          isurl = /^(http[s]?:\\/)?\\/[^\\s\\r\\t\\n]{1,200}$|^\\.$/.test(db);\n      return (!this.couch.docid || !isurl);\n    }\n  },\n  watch:\"#docid,#url\"\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1436986283736","id": ".About","type": "js","data": "({\n\tparams:{width:400},\n\tinit:function($o){\n\t\t$o.formgen([\n\t\t\t'<div class=\" fs90 xgray\">',\n\t\t\t\t'<img src=\"\" id=\"ico\" class=\"w25 mr7 dib vat ml-3\" />',\n\t\t\t\t'<h3 class=\"fs140 mt0 teal o80 dib vat mb0\"></h3>',\n\t\t\t\t'<p id=\"ver\" class=\"mt0 fs90 teal o70 mb20 pl30\"></p>',\n\t\t\t\t'<p class=\"fs90\">',\n\t\t\t\t\t'For more details about app visit ',\n\t\t\t\t\t'<a href=\"http://ddoc.me\" target=\"_blank\">Ddoc Lab project site</a>.',\n\t\t\t\t'</p>',\n\t\t\t\t'<p class=\"fs90\">',\n\t\t\t\t\t'This app was entirely created in browser ',\n\t\t\t\t\t'using <a href=\"http://cloudwall.me\" target=\"_blank\">cloudwall.me</a>. ',\n\t\t\t\t\t'No single line of code was written in standalone IDE.',\n\t\t\t\t'</p>',\n\t\t\t\t'<p class=\"fs90\">',\n\t\t\t\t\t'© 2018 ermouth',\n\t\t\t\t'</p>',\n\t\t\t'</div>'\n\t\t])\n\t},\n\tui:{\n\t\t'#ico':function(d){return this.RT().files[\"logo70.png\"].url},\n\t\t'h3': function(){\n\t\t\treturn \"Ddoc Lab \"\n\t\t},\n\t\t\"#ver\": function(){\n\t\t\treturn \"Version \" + this.RT().Version + (this.RT().build?\", build \" + this.RT().build:\"\");\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1436266156021","id": ".Build","type": "js","data": "(function (doc0, opts0, $o) {\n\t\n\tvar i,j,that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\ttdoc = doc0 || that.data.doc,\n\t\t\t\n\t\t\topts = $.extend(!0,{ \n\t\t\t\tbuttons:true, \n\t\t\t\tfooter:\"\", \n\t\t\t\tcheckcreds:false,\n\t\t\t\tpick:\"\",\n\t\t\t\tresolve:true,\n\t\t\t\tsilent:false,\n\t\t\t\tblocking:true\n\t\t\t},Object.reject(opts0||{},\"errors\")),\n\t\t\t\n\t\t\terrors = (opts0||{}).errors || {},\n\t\t\tkey,\n\t\t\titems={},\n\t\t\t_process;\n\t\n\tfor (i=0;i<tdoc.items.length;i++) {\n\t\tif ( !tdoc.items[i].snippet && (j=that.Path(tdoc.items[i])).to(1) != \".\") {\n\t\t\titems[j.from(1)] = tdoc.items[i];\n\t\t}\n\t}\n\t\n\t// Make app busy\n\tif (that.app && that.app.busy) {\n\t\tpi.always(function(){ that.app.busy(false); });\n\t\tthat.app.busy(true);\n\t}\n\t\n\t// Decode / prepare creds\n\tvar couch = that.GetSettings(\"couch\");\n\t\n\tif (null==couch.docid) {\n\t\tif (opts.checkcreds) pi.reject(\"Can’t decode encrypted doc _id and credentials.\");\n\t}\n\t\n\t_process = _Process.debounce(100);\n\t\n\ttry {\n\t\tif (opts.resolve) that.ResolveExternals(tdoc, errors).always(_process);\n\t\telse _process();\n\n\t} catch(e) {\n\t\tpi.reject(\"Error during validation\", e.message, e.stack);\n\t}\n\t\n\treturn pi.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _Process (){\n\t\tvar a = that.Items2Atts(tdoc, that.Types, errors, opts.pick?opts.pick:true);\n\n\t\tif (couch.docid) a.result._id = couch.docid;\n\n\t\tif (Object.size(a.err)) {\n\t\t\t// Remove busy shield\n\t\t\tif (that.app && that.app.busy) that.app.busy(false);\n\t\t\t// Ask user what to do\n\t\t\t$o.modal({\n\t\t\t\tmanifest:that.ParseErrors,\n\t\t\t\tdata:$.extend(!0, {}, opts,a ),\n\t\t\t\tesc:true,\n\t\t\t\tenter:true,\n\t\t\t\tscreen:opts.blocking?'rgba(255,255,255,0.5)':false,\n\t\t\t\talign:\"top:105%\",\n\t\t\t\tnose:\"top\",\n\t\t\t\tbound:10,\n\t\t\t\tdrag:!opts.blocking\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\t_result(a);\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\tpi.reject(\"Cancelled\");\n\t\t\t});\n\t\t} \n\t\telse {\n\t\t\tif (!opts.silent) cw.lib.note(\"Doc integrity seems to be Ok.\");\n\t\t\t_result(a);\n\t\t}\n\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - -\n\t\n\tfunction _result(a){\n\t\tif (a.result) {\n\t\t\tvar att  = a.result._attachments;\n\t\t\t\n\t\t\t// Make it last node of the doc\n\t\t\tdelete a.result._attachments;\n\t\t\ta.result._attachments = att;\n\n\t\t\t//console.log(a);\n\n\t\t\t// load binary atts\n\t\t\tthat.db.get(d.doc._id, {\n\t\t\t\tattachments:true\n\t\t\t})\n\t\t\t.then(\n\t\t\t\tfunction(res){\n\t\t\t\t\tif (res._attachments) for (var i in res._attachments) {\n\t\t\t\t\t\tif (!a.result._attachments[i] || null == a.result._attachments[i].data) {\n\t\t\t\t\t\t\ta.result._attachments[i] = {\n\t\t\t\t\t\t\t\tcontent_type:res._attachments[i].content_type,\n\t\t\t\t\t\t\t\tdata:res._attachments[i].data\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(items[i]) items[i].state.crc = $.my.f.sdbmCode(res._attachments[i].data);\n\t\t\t\t\t};\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t},\n\t\t\t\tfunction(){\n\t\t\t\t\tif (!opts.silent) cw.lib.note(\"Doc is not yet saved, you may need to save doc.\", \"warning\");\n\t\t\t\t\tpi.resolve(a);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t} // --end _result\n\t\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1427645817856","id": ".ResolveExternals","type": "js","data": "(function (doc0, errs) {\n\tvar that = this, \n\t\t\tpis,\n\t\t\tasync,\n\t\t\tpending = {},\n\t\t\tdoc = (doc0 || that.data.doc),\n\t\t\trows = doc.items,\n\t\t\tz = $.Deferred(),\n\t\t\thasErrors = false,\n\t\t\terr = errs || {},\n\t\t\toitems = {};\n\t\n\trows.forEach(function(e){oitems[e.id] = e});\n\t\n\tpis = rows.map(function(e,i){\n\t\tvar s=\"\", id='', p = e.external, pi; \n\t\tif (p && !/^[x\\s]/.test(p)) {\n\t\t\tasync = true;\n\t\t\tpi = $.Deferred();\n\t\t\t\n\t\t\t// Local doc\n\t\t\tif (p.startsWith(\"pouch://\") || p.startsWith(\"local://\")) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"pouch \"+id]) pending[\"pouch \"+id] = that.db.get(id, {attachments:true});\n\t\t\t\t\n\t\t\t\tpending[\"pouch \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process local doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load local doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction(){ pi.reject(\"Failed to load local doc '\"+id+\"'\"); }\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t// Local query\n\t\t\telse if (p.startsWith('query://')) {\n\t\t\t\tp = p.from(8).split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\t\n\t\t\t\t// check if query has db\n\t\t\t\tvar db,\n\t\t\t\t\t\tq = p[0].split(\"/\").to(3);\n\t\t\t\tif (q.length < 2 && q[0]!=='_all_docs') pi.reject('Too short path for query');\n\t\t\t\telse {\n\t\t\t\t\tdb = q[0]=='_all_docs'?cw.db(that.db.name):q.length<3?that.db:cw.db(q[0]);\n\t\t\t\t\tif (db) {\n\t\t\t\t\t\tvar query = q.last(2).join('/'),\n\t\t\t\t\t\t\t\tparams,\n\t\t\t\t\t\t\t\terr;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparams = eval (s?'('+s+')':'');\n\t\t\t\t\t\t\tif (params !== undefined && !Object.isObject(params)) err = 'Params must be an object';\n\t\t\t\t\t\t\telse params = params || {};\n\t\t\t\t\t\t} catch(e){\n\t\t\t\t\t\t\terr = 'Invalid params for query';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!pending['query '+p.join(' ')]) {\n\t\t\t\t\t\t\t\tpending['query '+p.join(' ')] = query=='_all_docs'?db.allDocs(params):db.query(query, params);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpending['query '+p.join(' ')].then(\n\t\t\t\t\t\t\t\tfunction(res) {\n\t\t\t\t\t\t\t\t\tpi.resolve(res.rows);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfunction(){ pi.reject(\"Query '\"+p.join(\" \")+\"' failed\"); }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.reject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi.reject(\"PouchDB DB '\"+q[0]+' does not exist' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Local doc, other DB\n\t\t\telse if (p.startsWith(\"doc://\")) {\n\t\t\t\tp = p.from(6).split(/\\s+/).compact(true);\n\t\t\t\t\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tvar dbid = id.split(\"/\",1)[0];\n\t\t\t\tid = id.from(dbid.length+1);\n\t\t\t\t\n\t\t\t\tif (cw.db(dbid)) {\n\t\t\t\t\n\t\t\t\t\tif (!pending[\"doc \"+p[0]]) {\n\t\t\t\t\t\tpending[\"doc \"+p[0]] = cw.db(dbid).get(id, {attachments:true});\n\t\t\t\t\t}\n\n\t\t\t\t\tpending[\"doc \"+p[0]].then(\n\t\t\t\t\t\tfunction(doc) {\n\n\t\t\t\t\t\t\tif (!doc) {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse if (s) {\n\t\t\t\t\t\t\t\tvar r = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\t\tif (r) pi.resolve(r);\n\t\t\t\t\t\t\t\telse pi.reject(\"Failed to process PouchDB doc '\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t +p[0]+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.resolve(doc);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(\"Failed to load PouchDB doc '\"+p[0]+\"'\"); }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tpi.reject(\"PouchDB DB '\"+dbid+' does not exist' );\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// External request\n\t\t\telse if (/^http[s]?:\\/\\//.test(p)) {\n\t\t\t\tp = p.split(/\\s+/).compact(true);\n\t\t\t\ts = p[1]||'';\n\t\t\t\tid = p[0];\n\t\t\t\t\n\t\t\t\tif (!pending[\"url \"+id]) {\n\t\t\t\t\t\n\t\t\t\t\tif ('https:'==window.location.protocol && !id.startsWith(window.location.protocol)) {\n\t\t\t\t\t\tpending[\"url \"+id] = $.Deferred().reject('forbidden protocol').promise();\n\t\t\t\t\t}\n\t\t\t\t\telse \tpending[\"url \"+id] = $.ajax({\n\t\t\t\t\t\t\turl:id,\n\t\t\t\t\t\t\tcache:false,\n\t\t\t\t\t\t\ttype:\"GET\",\n\t\t\t\t\t\t\tdataType:s?\"json\":\"text\",\n\t\t\t\t\t\t\t//xhrFields:{withCredentials:/^https/.test(id)}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpending[\"url \"+id].then(\n\t\t\t\t\tfunction(doc) {\n\t\t\t\t\t\tvar json, r;\n\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\tif (!Object.isObject(doc) && !Object.isArray(doc)) {\n\t\t\t\t\t\t\t\ttry { doc = JSON.parse(doc) } catch (e) { }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tr = cw.lib.getref(doc, s);\n\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\tpi.resolve(r);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpi.reject(\"Failed to process external doc '\"+id+\"', property '\"+s+\"' not found\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (doc) pi.resolve(doc);\n\t\t\t\t\t\t\telse pi.reject(\"Failed to load external doc '\"+id+\"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction (msg){ pi.reject(\"Failed to load external doc '\"+id+\"'\" + (Object.isString(msg)?': '+msg:'')); }\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t// Unknown, reject\n\t\t\telse {\n\t\t\t\tpi.reject(\"Failed to load resource \"+id+', protocol is unknown.');\n\t\t\t}\n\t\t\t\n\t\t\treturn pi.promise();\n\t\t\t\n\t\t} else {\n\t\t\treturn e.data;\n\t\t}\n\t});\n\n\tif (!async) z.resolve();\n\telse {\n\t\tQ.allSettled(pis)\n\t\t.then(\n\t\t\tfunction(reps){\n\t\t\t\treps.forEach(function(elt,i){\n\t\t\t\t\t\n\t\t\t\t\tvar d = rows[i], \n\t\t\t\t\t\t\taname = that.Path(d),\n\t\t\t\t\t\t\tfconv,\n\t\t\t\t\t\t\tconvresult,\n\t\t\t\t\t\t\tval;\n\t\t\t\t\tif (!d) {\n\t\t\t\t\t\t// possibly item was removed\n\t\t\t\t\t\t// by converter\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (elt.state ===\"fulfilled\") {\n\t\t\t\t\t\tval = elt.value;\n\n\t\t\t\t\t\tif (Object.isString(val)) rows[i].data = val;\n\t\t\t\t\t\telse if (Object.isObject(val)) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (val.type && that.X[val.type] && (fconv = that.X[val.type][rows[i].type])){\n\t\t\t\t\t\t\t\t// we have converter\n\t\t\t\t\t\t\t\ttry {  convresult = fconv.call (that, val, d, oitems);  } \n\t\t\t\t\t\t\t\tcatch(e) { convresult = e.message; }\n\n\t\t\t\t\t\t\t\tif (convresult) {\n\t\t\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t\t\t\t_e(aname, \"Converter error:\" + convresult);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (rows[i].ext=='js') {\n\t\t\t\t\t\t\t\trows[i].data = cw.lib.js2txt(cw.lib.unjson(elt.value),'\\t');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/*else if (rows[i].type==\"rtf\") {\n\t\t\t\t\t\t\t\tif (elt.value.type==\"inliner\") {\n\t\t\t\t\t\t\t\t\trows[i].doc = $.extend(!0,{},elt.value,{_id:rows[i].id});\n\t\t\t\t\t\t\t\t\trows[i].data = \"\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t\t\t\t_e(aname, 'Invalid external doctype, must be \"inliner\".');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}*/\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\trows[i].data = JSON.stringify(val, null, '\\t');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} \n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\trows[i].data = JSON.stringify(val, null, '\\t');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// error, promise rejected\n\t\t\t\t\t\thasErrors = true;\n\t\t\t\t\t\t_e(aname, elt.reason);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// apply oitems additions/deletions\n\t\t\t\t// to doc.items\n\t\t\t\t\n\t\t\t\tvar items = [], \n\t\t\t\t\t\tatts = doc._attachments||{}, \n\t\t\t\t\t\tdone = {};\n\n\t\t\t\tdoc.items.forEach(function(elt){\n\t\t\t\t\tif (oitems[elt.id]) {\n\t\t\t\t\t\t_item(oitems[elt.id]);\n\t\t\t\t\t\tdone[elt.id]=true;\n\t\t\t\t\t} \n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tObject.keys(oitems).forEach(function(i){\n\t\t\t\t\tif (done[i]) return;\n\t\t\t\t\tif (oitems[i]) _item(oitems[i]);\n\t\t\t\t\telse {\n\t\t\t\t\t\tif(doc._attachments) {\n\t\t\t\t\t\t\tvar item = doc.items.find(function(e){ return e.id==i });\n\t\t\t\t\t\t\tvar path = that.Path(item);\n\t\t\t\t\t\t\tif (path.to(1)==\"/\") {\n\t\t\t\t\t\t\t\tdelete doc._attachments[path.from(1)];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// put updated items list back into doc\n\t\t\t\t\n\t\t\t\tdoc.items = items;\n\t\t\t\t\t\t\n\t\t\t\tif (!hasErrors) z.resolve();\n\t\t\t\telse z.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t\t\n\t\t\t\t//- - - - - - - - - - - \n\t\t\t\t\n\t\t\t\tfunction _item(item0) {\n\t\t\t\t\t\n\t\t\t\t\t//console.log(item0)\n\t\t\t\t\t\n\t\t\t\t\tvar item = item0;\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\tif (item.type==\"attachment\" && Object.isObject(item.data)) {\n\n\t\t\t\t\t\t\tvar path = that.Path(item);\n\t\t\t\t\t\t\n\n\t\t\t\t\t\t\tif (path.to(1)==\"/\") {\n\t\t\t\t\t\t\t\tif (!doc._attachments) doc._attachments={};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdoc._attachments[path.from(1)] = Object.select(item.data, [\"content_type\",\"digest\",\"data\"]);\n\t\t\t\t\t\t\t\titem.data = \" Ext doc \";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//delete item.preview;\n\t\t\t\t\t\t//item.random = cw.lib.sdbm(Date.now+\"\");\n            if (!items.find(function(e){return e.id==item.id && e.state.crc == item.state.crc;})) {\n\t\t\t\t\t\t\titems.push(item);\n            }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tfunction(e){\n\t\t\t\tz.reject (\"Failed to load external resource(s)\",\"error\");\n\t\t\t}\n\t\t)\n\t}\n\t\n\treturn z.promise();\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1435744049339","id": ".Items2Atts","type": "js","data": "(function (doc0, Types, prevErrors, pick0, depsOnly) {\n\tvar i, j, e, item, \n\t\t\tthat=this,\n\t\t\tdoc = doc0 || that.data.doc,\n\t\t\tbuildAll = !!pick0,\n\t\t\tpick = Object.isString(pick0)?pick0:\"\",\n\t\t\tt = Types || that.Types, \n\t\t\terr = prevErrors || {},\n\t\t\t\n\t\t\tnames = {}, dirty = {},\n\t\t\taname=\"\", a={}, sn={}, pp={}, tmp = {},\n\t\t\tsrc = {}, fin = {}, stash = {},\n\t\t\t\n\t\t\tincls = {}, \n\t\t\tfvalidator = null, \n\t\t\tisinvalid = null,\n\t\t\tz={};\n\t\n\tvar reSnippet = /([{[]\\/\\*\\{\\{[.\\/-][.\\/_a-z0-9-]+\\}\\}\\*\\/[}\\]])|(\"\\{\\{[.\\/-][.\\/_a-z0-9-]+\\}\\}\")|(\\{\\{[.\\/-][.\\/_a-z0-9-]+\\}\\})/gi;\n\n\t\n\t// gen empty res obj\n\tvar couch = that.GetSettings(\"couch\");\n\t\n\tif (couch.docid) z._id = couch.docid;\n\tif (/^_design\\//.test(couch.docid)) z.name = doc.name\n\tz._attachments = {};\n\t\n\t// gen work structs\n\tfor (i=0;i<doc.items.length;i++) {\n\t\te = doc.items[i];\n\t\tif (e) {\n\t\t\taname = that.Path(e);\n\t\t\tnames[aname]=true;\n\t\t\tsn[aname]=e.snippet;\n\t\t\tsrc[aname]=doc.items[i];\n\t\t\tif (e.stashResolved) stash[aname] = true;\n\t\t\tif (Object.isFunction(t[e.type].postprocess)) pp[aname] = t[e.type].postprocess.bind(that);\n\t\t}\n\t}\n\t\n\t\n\t// stringify\n\tObject.keys(names).sortBy().forEach(_convert);\n\n\t\n\t// Resolves include directives.\n\t// Possible syntaxes are:\n\t// {{.res.name }} \t\t\t– inserts as is\n\t// {/*{{.res.name }}*/} – inserts as is\n\t// [/*{{.res.name }}*/] – inserts as is\n\t// \"{{.res.name }}\" \t\t– inserts stringified version\n\t\n\t// parse includes\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) _parseIncludes (i);\n\t}\n\t\n\t// merge snippets deps into files \n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\ttmp = {};\n\t\t\tfor (j in e.state.depends) \n\t\t\t\tif (sn[j] && src[j].state.depends) \n\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t$.extend(e.state.depends, tmp);\n\t\t\t//e.state.depends = tmp;\n\t\t}\n\t}\n\t\n\t// merge files deps into files \n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i) && !sn[i]) {\n\t\t\te = src[i]; \n\t\t\tif (e) {\n\t\t\t\ttmp = {};\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j) && a[j] && !sn[j] && src[j].state.depends) {\n\t\t\t\t\t\t$.extend(tmp, src[j].state.depends);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$.extend(e.state.depends, tmp);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// clean impacts\n\tfor (i in src) {\n\t\tif (src.hasOwnProperty(i)) {\n\t\t\tif (e = src[i]) {\n\t\t\t\te.state.impacts = {};\n\t\t\t}\n\t\t}\n\t}\n\t\t\n\t// rebuild impacts (reverse deps)\n\tfor (i in a) {\n\t\tif (a.hasOwnProperty(i)) {\n\t\t\tif (e = src[i]) {\n\t\t\t\tfor (j in e.state.depends) {\n\t\t\t\t\tif (e.state.depends.hasOwnProperty(j)) {\n\t\t\t\t\t\tif (src[j]) src[j].state.impacts[i] = true;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t//console.log(\"Missing include \"+j+\" in \"+i);\n\t\t\t\t\t\t\te.state.depends[j] = false;\n\t\t\t\t\t\t\t_e(i, \"Missing include '\"+j+\"'\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t\n\tif (depsOnly) return {\n\t\terr: err,\n\t\tdoc:doc\n\t};\n\t\t\n\t// build list of items to be updated\n\tvar imps = {};\n\tfor (i in a){\n\t\tif (a.hasOwnProperty(i) && (!pick || i === pick)) {\n\t\t\te = src[i];\n\t\t\tif (!!buildAll || e.state.sdbm !== e.state.savedSdbm) {\n\t\t\t\t$.extend (true, imps, e.state.impacts);\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t// add dependees to dirty list, \n\t// they also need to be updated\n\tfor (i in imps) {\n\t\tif (imps.hasOwnProperty(i)) {\n\t\t\te = src[i];\n\t\t\tif (e) {\n\t\t\t\tif (!e.snippet) $.extend (true, dirty, e.state.depends);\n\t\t\t\tdirty [i] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//console.log(\"Dirties wired to rebuild: \", dirty);\n\t\n\t// build snippets\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && sn[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving snippet include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\n\t// build files\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !sn[i] && src[i]) {\n\t\t\ttry {\n\t\t\t\t_resolveIncludes (i);\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Error resolving file include: \"+er.message);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// validate finalized versions\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && (!sn[i] || i === pick) && !err[i] && src[i]) {\n\t\t\tfvalidator = null;\n\t\t\tisinvalid = null;\n\t\t\ttry {\n\t\t\t\tfvalidator = (t[src[i].type].manifest || t[src[i].type].extend || {}).validator;\n\t\t\t\tif (Object.isFunction(fvalidator)) {\n\t\t\t\t\tisinvalid = fvalidator ({data:fin[i]});\n\t\t\t\t}\n\t\t\t} catch (er) {\n\t\t\t\t_e(i, \"Final result is not of type '\"+src[i].type+\"': \"+er.message);\n\t\t\t}\n\t\t\tif (isinvalid != null) _e(i, \"Final result is not of type '\"+src[i].type+\"': \"+isinvalid);\n\t\t}\n\t}\n\t\n\n\t// build attachments and branches\n\tvar temp0;\n\tfunction _renderItemFin(i) {\n\t\tif (i.to(1) == \"/\") return t[src[i].type].s2s?t[src[i].type].s2s(fin[i]):fin[i];\n\t\telse return t[src[i].type].s2o?t[src[i].type].s2o(fin[i]):fin[i];\n\t}\n\t\n\tfor (i in dirty) {\n\t\tif (dirty.hasOwnProperty(i) && !err[i] && src[i]) {\n\t\t\t\n\t\t\ttemp0 = null;\n\t\t\t\n\t\t\tif (stash[i]) {\n\t\t\t\ttemp0 = _renderItemFin(i);\n\t\t\t\tstash[i] = temp0; \n\t\t\t}\n\t\t\t\n\t\t\tif (!sn[i] || i === pick) {\n\t\t\t\ttry {\t\n\t\t\t\t\t\n\t\t\t\t\tif (temp0 === null) temp0 = _renderItemFin(i);\n\t\t\t\t\t\n\t\t\t\t\tif (i.to(1)==\"/\") {\n\t\t\t\t\t\tif (src[i].isBinary && Object.isString(temp0) && /^[\\u0000-\\u00ff]+$/.test(temp0)) {\n\t\t\t\t\t\t\ta[i].data = window.btoa (temp0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ta[i].data = $.my.f.base64(temp0, false, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsrc[i].state.crc = $.my.f.sdbmCode(temp0);\n\t\t\t\t\t\tz._attachments[i.from(1)] = a[i];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$.extend(true,z, $.my.f.unmask(temp0, i.from(1)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (er) {\n\t\t\t\t\t_e(i, \"Include was not updated, error: \"+er.message);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\tvar process={};\n\tfor (i in src) {\n\t\tif (src.hasOwnProperty(i)) {\n\t\t\t\n\t\t\t//if (stash[i] && !err[i] && stash[i]!==true) src[i].resolved = stash[i];\n\t\t\tif (stash[i] && !err[i] && stash[i]!==true) {\n\t\t\t\tsrc[i].resolved = (typeof stash[i] == 'string'?stash[i]:JSON.parse($.my.tojson(stash[i])));\n\t\t\t}\n\t\t\telse delete src[i].resolved;\n      \n      if (src[i].dropImport && src[i].external && src[i].external[0]!=' ') {\n      \tsrc[i].data = '// This branch has no visible data\\n// since ‘Do not store imported data in document’\\n// option is set for the branch';\n      }\n\t\t\t\n\t\t\tif (\n\t\t\t\tsrc[i].type === \"attachment\"\n\t\t\t\t&& (!!buildAll || src[i].state.sdbm !== src[i].state.savedSdbm)\n\t\t\t\t&& (!pick || i===pick)\n\t\t\t) {\n\t\t\t\tprocess[i] = true;\n\t\t\t\t\n\t\t\t\t// May be we have not yet saved attaches\n\t\t\t\tif (doc._attachments && doc._attachments[i.from(1)] && doc._attachments[i.from(1)].data) {\n\t\t\t\t\tz._attachments[i.from(1)] = {\n\t\t\t\t\t\tcontent_type:doc._attachments[i.from(1)].content_type,\n\t\t\t\t\t\tdata:doc._attachments[i.from(1)].data\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!sn[i] && dirty[i] && !err[i]) process[i] = true;\n\t\t}\n\t}\n\t\n\treturn {\n\t\terr:err,\n\t\tdirty: dirty,\n\t\tdoc:doc,\n\t\tupload:process,\n\t\tresult:z\n\t};\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _parseIncludes (iname) {\n\t\tvar i = iname, deps,\n\t\t\t\tj, re, idx, str, \n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tdeps = src[i].state.depends={};\n\t\tif (incl && !src[i].noIncludes) {\t\t\n\t\t\tincls[i] = incl.slice(0);\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9_\\-\\.\\/]/gi,\"\");\n\t\t\t\tdeps[idx] = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _resolveIncludes (iname) {\n\t\tvar i = iname, \n\t\t\t\tj, re, idx, str, \n\t\t\t\tincl = a[i].data.match(reSnippet);\n\t\t\n\t\tfin[i] = a[i].data;\n\t\tif (incl) {\t\t\t\n\t\t\tfor (j=0;j<incl.length;j++) {\n\t\t\t\tidx = incl[j].replace(/(\\/\\*|\\*\\/)/gi,\"\").replace(/[^a-z0-9_\\-\\.\\/]/gi,\"\");\n\t\t\t\tre = new RegExp(RegExp.escape(incl[j]), 'g');\n\t\t\t\tif (idx === i) fin[i] = fin[i].replace(re,\"\");\n\t\t\t\telse if (a[idx]) {\n\t\t\t\t\tstr = fin[idx] || a[idx].data;\n\t\t\t\t\tvar s2s=t[src[idx].type].s2s;\n\t\t\t\t\tif (Object.isFunction(s2s)) str = s2s(str);\n\t\t\t\t\t\n\t\t\t\t\tif (incl[j].to(1) === '\"' && incl[j].from(-1) ==='\"') str = JSON.stringify(str);\n\t\t\t\t\tfin[i] = fin[i].split(re).join(str);\n\t\t\t\t} \n\t\t\t\t//else fin[i] = fin[i].replace(re,\"\");\n\t\t\t}\n\t\t}\n\t\t// post-process\n\t\tif (pp[i]) {\n\t\t\ttry { fin[i] = pp[i](src[i], fin[i], doc);  }\n\t\t\tcatch (e) {\n\t\t\t\t_e(i, \"Post-processor error: \"+e.message);\n\t\t\t\t//console.log(e.message, e.stack, e);\n\t\t\t\t//window.M = fin[i];\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _convert (iname) {\n\t\tvar it=src[iname], att,\n\t\t\t\tparser, eparser;\n\t\t\n\t\tif (it.type!=\"attachment\") {\t\t\t\n\t\t\t// Item\t\t\t\n\t\t\tif(it.parserActive) {\n\t\t\t\ttry { \n\t\t\t\t\tparser = eval(it.parser).bind(that); \n\t\t\t\t} catch (e){ \n\t\t\t\t\tparser = null; \n\t\t\t\t\teparser = e.message;\n\t\t\t\t}\n\t\t\t\tif (!Object.isFunction(parser)) {\n\t\t\t\t\t_e (iname, \"Invalid custom parser: \"+eparser);\n\t\t\t\t\tparser = t[it.type].stringify.bind(that);\n\t\t\t\t}\n\t\t\t} \n\t\t\telse parser = t[it.type].stringify.bind(that);\n\t\t\n\t\t\ttry {\n\t\t\t\tatt = {\n\t\t\t\t\tcontent_type:it.mime||t[it.type].mime,\n\t\t\t\t\tdata:parser(it, doc._attachments, doc)+\"\"\n\t\t\t\t};\n\t\t\t} catch(e) {\n\t\t\t\tif (it.parserActive) _e(iname, \"Custom parser failed: \"+e.message);\n\t\t\t\telse _e(iname,\"Error parsing data: \"+e.message);\n\t\t\t}\n\t\t\tif (att ) {\n\t\t\t\ta[iname] = att;\n\t\t\t\tit.state.sdbm = $.my.f.sdbmCode(Object.reject(it, [\"state\"]));\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t// We have attachment\n\t\t\tif (doc._attachments && (att = doc._attachments[iname])) {\n\t\t\t\tif (att.digest) it.state.sdbm = $.my.f.sdbmCode(att.digest);\n\t\t\t} else {\n\t\t\t\tit.state.sdbm = \"Z\";\n\t\t\t}\n\t\t}\n\t}\n\t\n\t//- - - - - - - - - - - - - - - - - - - - - - - -\n\t\n\tfunction _e (iname, error) {\n\t\t// Logs error\n\t\tif (!err[iname]) err[iname] = [];\n\t\terr[iname].push(error);\n\t}\n\t\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1435860646862","id": ".Upload","type": "js","data": "(function (doc, $root, opts) {\n\n\tvar that = this, i, j, url,\n\t\t\tpi = $.Deferred(),\n\t\t\tcdb = that.GetSettings(\"couch\"),\n\t\t\tcouch = cdb.dburl.replace(/\\/$/,'')+'/',\n\t\t\tcreds = (cdb.login && cdb.pwd) ? cdb.login +\":\" + cdb.pwd :'',\n\t\t\tid = cdb.docid,\n\t\t\theaders = {Accept:\"text/plain\"},\n\t\t\tmode = cw.lib.a2o(doc[\"export\"].options||[]),\n\t\t\tpaths = [],\n\t\t\tobj = opts.result,\n\t\t\titems={},\n\t\t\texclude = [];\n\n\tvar isA = Object.isArray, isB = Object.isBoolean, isS = Object.isString, isO = Object.isObject,\n\t\t\tisN = Object.isNumber, isR = Object.isRegExp, isF = Object.isFunction;\n  \n  // Build affected paths list\n\tfor (i=0;i<doc.items.length;i++) {\n\t\tif ( !doc.items[i].snippet){\n\t\t\tj = that.Path(doc.items[i])\n\t\t\tif ( j.to(1) != \".\") items[j.from(1)] = doc.items[i];\n\t\t\telse paths.push(j.from(1));\n\t\t}\n\t}\n\tpaths = paths.unique().sortBy();\n  \n  // Local Pouch =======\n  \n  if (couch == './') {\n    \n  \tconsole.log(\"LOCAL LOAD START\", id);\n    \n    that.db.get(id).then(\n      // doc exists\n      function(res){\n        _combine(res);\n        _save();\n      },\n      // doc likely not exist\n      _save\n    );\n  }\n  \n  // URL ===============\n  \n  else {\n    // Append current host root if no domain defined\n    if (couch.to(1)==\"/\") {\n      couch = window.location.protocol +'/'+'/' +window.location.host+'/'+couch;\n    }\n\n    url = couch+id;\n    if (creds) headers.Authorization = 'Basic ' + cw.lib.base64(creds);\n\n    console.log('LOAD START', url.to(500), headers);\n\n    $.ajax({\n      url:\t\t\turl,\n      method:\t\t'GET',\n      cache:\t\tfalse,\n      dataType:\t'json',\n      headers:\theaders\n    })\n    .then(\n      // doc exists\n      function(res){\n        _combine(res);\n        _save();\n      },\n      // doc likely not exist\n      _save\n    );\n  }\n\n\n\treturn pi.promise();\n\n\t//--------------------\n\n\tfunction _combine(doc0) {\n\t\tif (doc0) {\n\t\t\tif (doc0._rev) obj._rev = doc0._rev;\n\n\t\t\tif (mode.extend) {\n\t\t\t\tvar doc1 = Object.reject(doc0,\"_attachments\"),\n\t\t\t\t\t\tvals = paths.reduce(function(a, path){\n\t\t\t\t\t\t\ta.push(cw.lib.getref(obj, path));\n\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t},[]);\n\n\t\t\t\t_unmask(doc1, vals, paths);\n\n\t\t\t\tobj = Object.merge(doc1, {_attachments:obj._attachments});\n\n\t\t\t\tvar a = doc0._attachments;\n\t\t\t\tif (Object.size(a)) {\n\t\t\t\t\tif (!obj._attachments) obj._attachments={};\n\t\t\t\t\tObject.keys(a)\n\t\t\t\t\t.forEach(function(i){\n\t\t\t\t\t\tif (null==obj._attachments[i]) {\n\t\t\t\t\t\t\t// no local att, so keep remote att\n\t\t\t\t\t\t\tobj._attachments[i] = a[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!items[i]) {\n\t\t\t\t\t\t\tdelete obj._attachments[i];\n\t\t\t\t\t\t\tobj._attachments[i] = a[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (items[i].state.crc) {\n\t\t\t\t\t\t\t// have local, check is it eq to remote\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\titems[i].state.remote == items[i].state.crc+\"-\"+a[i].digest\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// no need to re-save\n\t\t\t\t\t\t\t\tobj._attachments[i] = a[i];\n\t\t\t\t\t\t\t\texclude.push(i);\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\telse items[i].state.remote=\"\";\n\t\t\t\t\t\t} \n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//--------------------\n\n\tfunction _unmask (dest, src0, mask0) {\n\t\t// unfolds masked into obj\n\t\t// _unmask ( {x:1, y:{}}, [{z:5},3],[\"m.n\",\"y.z\"]) => {x:1, m:{n:{z:5}, y:{z:3}}},\n\t\t// modifies dest\n\n\t\tvar mask = mask0, src = src0;\n\n\t\tif (isS(mask)) {\n\t\t\tmask = [mask]; src= [src];\n\t\t}\n\t\tif (isA(src) && isA(mask)) {\n\t\t\tfor (var i=0;i<mask.length;i++) {\n\t\t\t\tif (src[i]!=null) _blow(dest, src[i], mask[i]);\n\t\t\t}\n\t\t\treturn dest;\n\t\t} \n\t\telse return null;\n\n\t\t//- - -\n\t\tfunction _blow(data, val, ref) {\n\t\t\tvar ptr, path, preptr, i=0;\n\t\t\tif (!/\\./.test(ref)) {\n\t\t\t\t//ref is flat\n\t\t\t\tif (null!=val) data[ref] = val;\n\t\t\t} else {\n\t\t\t\tpath = ref.split(\".\").each(function (a,i){this[i]=String(a).compact();});\n\t\t\t\tptr = data;\n\t\t\t\tfor (;i<path.length;i++) {\n\t\t\t\t\tif (i===path.length-1) ptr[path[i]] = val; //we'r in the hole\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (i===0) {\n\t\t\t\t\t\t\tptr = data[path[0]];\n\t\t\t\t\t\t\tpreptr= data;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tpreptr = preptr[path[i-1]];\n\t\t\t\t\t\t\tptr = ptr[path[i]];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tnull == ptr \n\t\t\t\t\t\t\t|| !(isO(ptr) \n\t\t\t\t\t\t\t\t\t || !(\n\t\t\t\t\t\t\t\t\t\t isA(ptr) \n\t\t\t\t\t\t\t\t\t\t && !isNaN(path[i+1]) \n\t\t\t\t\t\t\t\t\t\t && +path[i]>-1)\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) ptr = preptr[path[i]] = {};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn data;\n\t\t}\n\t}\n\n\t//--------------------\n\n\tfunction _save () {\n\t\tconsole.log('SAVE', (url || id).to(500));\n    var op;\n    if (couch == './') op = that.db.put(cw.lib.dry(JSON.parse($.my.tojson(obj))));\n    else op = $.ajax({\n\t\t\turl:\t\t\turl,\n\t\t\tmethod:\t\t'PUT',\n\t\t\theaders:\theaders,\n      contentType:\t'application/json',\n\t\t\tdata:\t\t\t$.my.tojson(obj)\n\t\t});\n    \n    return op.then(\n      _load,\n      function(e){\n        console.log('FAIL', e)\n        pi.reject(e);\n      }\n    );\n\t}\n\n\t//--------------------\n\n\tfunction _load () {\n\t\tconsole.log('LOAD BACK', (url || id).to(500));\n    var op;\n    if (couch == './') op = that.db.get(id);\n\t\telse op = $.ajax({\n\t\t\turl:\t\t\turl,\n\t\t\tmethod:\t\t'GET',\n\t\t\tcache:\t\tfalse,\n\t\t\tdataType:\t'json',\n\t\t\theaders:\theaders\n\t\t});\n\t\t\n    return op.then(\n      _loadFinalize,\n      function(e){ pi.reject(e); }\n    );\n\t}\n  \n  //--------------------\n  \n  function _loadFinalize(res){\n    // memoize md5-s\n    Object.keys(res._attachments||{})\n    .forEach(function(i){\n      if (items[i]) {\n        items[i].state.remote = items[i].state.crc +'-' + res._attachments[i].digest;\n      }\n    });\n\t\t// we are done\n    pi.resolve();\n  }\n\n})","active": false,"opts": [],"err": [],"color": ["red"]},{"stamp": "1437184882397","id": ".GetSettings","type": "js","data": "(function (section) {\n\tvar that = this,\n\t\t\tkey,\n\t\t\td = that.data;\n\t// Decode / prepare creds\n\tif ( cw.crypto && (key = d.doc.creds.crypto)) {\n\t\tif (!cw.crypto.has(key)) {\n\t\t\treturn {  };\n\t\t} else {\n\t\t\tvar obj = cw.crypto.dec(d.doc.creds)[section];\n\t\t\tif (obj) {\n\t\t\t\treturn obj;\n\t\t\t} else {\n\t\t\t\treturn {  };\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn Object.clone(d.doc[section], !0);\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1437186609919","id": ".S3toCouch","type": "js","data": "(function (doc) {\n\t\n\t// this is service fn to maintain\n\t// compat with old preliminary test internal format\n\t\n\tvar that = this;\n\t\n\tif (doc.s3) {\n\t\tvar s3 = that.GetSettings(\"s3\"),\n\t\t\t\tobj = {\n\t\t\t\t\tlogin:s3.accessKeyId,\n\t\t\t\t\tpwd:s3.secretAccessKey,\n\t\t\t\t\tdocid:s3.region,\n\t\t\t\t\tdburl:doc.site.siteBase\n\t\t\t\t};\n\t\tif (doc.creds.crypto) {\n\t\t\tdoc.creds = cw.crypto.enc({\n\t\t\t\tcrypto:doc.creds.crypto+\"\",\n\t\t\t\tcouch:obj\t\n\t\t\t});\n\t\t}\n\t\tdelete doc.s3;\n\t\tdoc.site.siteBase=\"\";\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1427646971204","id": ".Tar","type": "js","data": "({\n\tTar: function () {\n\t\n\t\t// Tar implementation\n\t\t// https://github.com/beatgammit/tar-js\n\n\t\tvar header = _header(),\n\t\t\tutils = _utils(),\n\t\t\trecordSize = 512,\n\t\t\tblockSize;\n\n\t\tfunction Tar(recordsPerBlock) {\n\t\t\tthis.written = 0;\n\t\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t}\n\n\t\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\t\tvar data,\n\t\t\t\tchecksum,\n\t\t\t\tmode,\n\t\t\t\tmtime,\n\t\t\t\tuid,\n\t\t\t\tgid,\n\t\t\t\theaderArr;\n\n\t\t\tif (typeof input === 'string') {\n\t\t\t\tinput = utils.stringToUint8(input);\n\t\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t\t}\n\n\t\t\tif (typeof opts === 'function') {\n\t\t\t\tcallback = opts;\n\t\t\t\topts = {};\n\t\t\t}\n\n\t\t\topts = opts || {};\n\n\t\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\t\tuid = opts.uid || 0;\n\t\t\tgid = opts.gid || 0;\n\n\t\t\tdata = {\n\t\t\t\tfileName: filepath,\n\t\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\t\tuid: utils.pad(uid, 7),\n\t\t\t\tgid: utils.pad(gid, 7),\n\t\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\t\tchecksum: '        ',\n\t\t\t\ttype: '0', // just a file\n\t\t\t\tustar: 'ustar  ',\n\t\t\t\towner: opts.owner || '',\n\t\t\t\tgroup: opts.group || ''\n\t\t\t};\n\n\t\t\t// calculate the checksum\n\t\t\tchecksum = 0;\n\t\t\tObject.keys(data).forEach(function (key) {\n\t\t\t\tvar i, value = data[key], length;\n\n\t\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\t\theaderArr = header.format(data);\n\n\t\t\tvar i, offset, length;\n\n\t\t\tthis.out.set(headerArr, this.written);\n\n\t\t\tthis.written += headerArr.length;\n\n\t\t\t// If there is not enough space in this.out, we need to expand it to\n\t\t\t// fit the new input.\n\t\t\tif (this.written + input.length > this.out.length) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, input.length, blockSize);\n\t\t\t}\n\n\t\t\tthis.out.set(input, this.written);\n\n\t\t\t// to the nearest multiple of recordSize\n\t\t\tthis.written += input.length + (recordSize - (input.length % recordSize || recordSize));\n\n\t\t\t// make sure there's at least 2 empty records worth of extra space\n\t\t\tif (this.out.length - this.written < recordSize * 2) {\n\t\t\t\tthis.out = utils.extend(this.out, this.written, recordSize * 2, blockSize);\n\t\t\t}\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(this.out);\n\t\t\t}\n\n\t\t\treturn this.out;\n\t\t};\n\n\t\tTar.prototype.clear = function () {\n\t\t\tthis.written = 0;\n\t\t\tthis.out = utils.clean(blockSize);\n\t\t};\n\n\t\treturn Tar;\n\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\t\t// HEADER\n\n\t\tfunction _header () {\n\n\t\t/*\n\t\tstruct posix_header {             // byte offset\n\t\t\tchar name[100];               //   0\n\t\t\tchar mode[8];                 // 100\n\t\t\tchar uid[8];                  // 108\n\t\t\tchar gid[8];                  // 116\n\t\t\tchar size[12];                // 124\n\t\t\tchar mtime[12];               // 136\n\t\t\tchar chksum[8];               // 148\n\t\t\tchar typeflag;                // 156\n\t\t\tchar linkname[100];           // 157\n\t\t\tchar magic[6];                // 257\n\t\t\tchar version[2];              // 263\n\t\t\tchar uname[32];               // 265\n\t\t\tchar gname[32];               // 297\n\t\t\tchar devmajor[8];             // 329\n\t\t\tchar devminor[8];             // 337\n\t\t\tchar prefix[155];             // 345\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 500\n\t\t};\n\t\t*/\n\n\t\t\tvar utils = _utils(),\n\t\t\t\theaderFormat;\n\n\t\t\theaderFormat = [\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileMode',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'uid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'gid',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'fileSize',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'mtime',\n\t\t\t\t\t'length': 12\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'checksum',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'type',\n\t\t\t\t\t'length': 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'linkName',\n\t\t\t\t\t'length': 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'ustar',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'owner',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'group',\n\t\t\t\t\t'length': 32\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'majorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'minorNumber',\n\t\t\t\t\t'length': 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'filenamePrefix',\n\t\t\t\t\t'length': 155\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'field': 'padding',\n\t\t\t\t\t'length': 12\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tfunction formatHeader(data, cb) {\n\t\t\t\tvar buffer = utils.clean(512),\n\t\t\t\t\toffset = 0;\n\n\t\t\t\theaderFormat.forEach(function (value) {\n\t\t\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\t\t\ti, length;\n\n\t\t\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\t\t\toffset += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset += value.length - i; // space it out with nulls\n\t\t\t\t});\n\n\t\t\t\tif (typeof cb === 'function') {\n\t\t\t\t\treturn cb(buffer, offset);\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstructure:headerFormat,\n\t\t\t\tformat:formatHeader\n\t\t\t};\n\t\t}\n\n\n\t\t// - - - - - - - - - - - - - - - - - - - \n\n\n\t\t// UTILS\n\n\t\tfunction _utils () {\n\n\t\t\tvar lookup = [\n\t\t\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t\t\t];\n\t\t\tfunction clean(length) {\n\t\t\t\tvar i, buffer = new Uint8Array(length);\n\t\t\t\tfor (i = 0; i < length; i += 1) {\n\t\t\t\t\tbuffer[i] = 0;\n\t\t\t\t}\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction extend(orig, length, addLength, multipleOf) {\n\t\t\t\tvar newSize = length + addLength,\n\t\t\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\t\t\tbuffer.set(orig);\n\n\t\t\t\treturn buffer;\n\t\t\t}\n\n\t\t\tfunction pad(num, bytes, base) {\n\t\t\t\tnum = num.toString(base || 8);\n\t\t\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t\t\t}\t\n\n\t\t\tfunction stringToUint8 (input, out, offset) {\n\t\t\t\tvar i, length;\n\n\t\t\t\tout = out || clean(input.length);\n\n\t\t\t\toffset = offset || 0;\n\t\t\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\t\t\toffset += 1;\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction uint8ToBase64(uint8) {\n\t\t\t\tvar i,\n\t\t\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\t\t\toutput = \"\",\n\t\t\t\t\ttemp, length;\n\n\t\t\t\tfunction tripletToBase64 (num) {\n\t\t\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t\t\t};\n\n\t\t\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\t\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\t\t\toutput += tripletToBase64(temp);\n\t\t\t\t}\n\n\t\t\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\t\t\tswitch (output.length % 4) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\toutput += '=';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\toutput += '==';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tclean:clean,\n\t\t\t\tpad:pad,\n\t\t\t\textend:extend,\n\t\t\t\tstringToUint8:stringToUint8,\n\t\t\t\tuint8ToBase64:uint8ToBase64\n\t\t\t};\n\t\t}\n\t},\n\tBytes: function (input){\n\t\tvar binary = window.atob(input),\n\t\t\t\ti=0, len = binary.length,\n\t\t\t\tbuffer = new ArrayBuffer(len),\n\t\t\t\tview = new Uint8Array(buffer);\n\t\tfor (i; i<len;i++) view[i] = binary.charCodeAt(i);\n\t\treturn view;\n\t}\n\t\n})","active": false,"opts": [],"err": [],"color": ["green"]},{"stamp": "1408681635064","id": ".HTML","type": "html","data": "<div id=\"nav\" class=\"mb9 fs100\">\n\t<div class=\"fr my-row fs85\">\n\t\t<input type=\"button\" style=\"\" class=\" tac mr5 green w100\" txt=\"\" value=\"Save\" id=\"btn-save\">\n    <input type=\"button\" style=\"\" class=\" tac w100\" txt=\"\" value=\"Close\" id=\"btn-close\">\n  </div>\n\t\n\t<div id=\"btns-main\" class=\"dib vat w220 oh fs80 \">\n\t\t<img id=\"navlogo\" src=\"\" class=\"cp w32 dib vat mr5\" title=\"About Ddoc Lab\">\n    <div class=\"w180 oh dib vat lh120 hoverlink teal pr5\" id=\"sname\"></div>\n\t</div>\n  <span class=\"fs80\">\n    <button title=\"Document and remote CouchDB settings\" class=\"tac btn-l mr2 button\" id=\"btn-params\" >\n      <span class=\"fi-wrench\"></span>\n    </button>\n  </span>\n  <span class=\"fs80 pr10\">\n    <button title = \"Upload changes to CouchDB\" class=\"tac btn-r button w110 pr0 pl0\" id=\"btn-publish\">\n      <span class=\"fi-upload-cloud lh100 fs130 dib vat mb-4\"></span>&thinsp; to Couch&nbsp;\n    </button>\n  </span>\n\t<span class=\"fs80 pr10 o80 buttons\">\n      <button class=\" tac btn-l button mr2\" id=\"btn-render\" title=\"Show final JSON\">\n        <span class=\"fi-shopping-bag\"></span> JSON\n      </button>\n      <button class=\" tac btn-r button mr2\" id=\"btn-tar\" title=\"Download as .tar\">\n        <span class=\"fi-archive\"> Files as .tar</span>\n      </button>\n  </span>\n\t<span class=\"fs80 o80 pr10\">\n    <button title = \"Resolve externals (if any) and check doc integrity\" style=\"\" class=\"button\" id=\"btn-validate\">\n      <span class=\"fi-checkbox\"> Rebuild</span>\n    </button>\n  </span>\n\t<span id=\"btn-futon\" class=\"dib vat fs80 mt3 blue\"></span>\n</div>\n<div class=\"fs90 w100p lh130\">\n\t\t<div class=\"w220 dib vat\">\n\t\t\t<div id=\"xsearch\" class=\"w210 fs75 mb5 o90\">\n\t\t\t\t<div class=\"fi-magnifying-glass blue o50\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.35em;\"></div>\n\t\t\t\t<input type=\"text\" id=\"search\" class=\"ui-search w200 ml0 mr0 mt0\" style=\"background-image: none;\">\n\t\t\t\t<span class=\"fi-x fs80 dib vat pt1 ml-15 blue ui-search-clear\" onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div id=\"ilist\" class=\"w200 fs90\"></div>\n\t\t\t\n\t\t\t<div id=\"btns-main\" class=\"w200 oh fs80 hoverlink gray pl7 lh190 pt8 mt13 bts\">\n\t\t\t\t<span class=\"fi-page-add\"></span> <span class=\"pseudolink\" id=\"btn-additem\">Add resource</span><br>\n\t\t\t\t<span class=\" fi-paperclip\"></span> <span class=\"pseudolink\" id=\"btn-addfile\">Import files</span><br>\n\t\t\t\t<span class=\"fi-photo ml-2\"></span> <span class=\"pseudolink\" id=\"btn-addpic\">Add image</span>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\t\t<div class=\"dib vat edpane\">\n\t\t\t<div id=\"tabs\" class=\"mb8 mt1\"></div>\n\t\t\t<div id=\"items\" class=\"edpane\"></div>\n\t\t</div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1536107783592","id": ".Icons.Component","type": "html","data": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"128\" height=\"128\" viewBox=\"0, 0, 128, 128\">\n  <defs>\n    <linearGradient id=\"Gradient_1\" gradientUnits=\"userSpaceOnUse\" x1=\"61.3\" y1=\"90.1\" x2=\"61.3\" y2=\"112.7\">\n      <stop offset=\"0\" stop-color=\"#FFFFFF\"/>\n      <stop offset=\"1\" stop-color=\"#66DFBD\"/>\n    </linearGradient>\n  </defs>\n  <g id=\"Layer_2\">\n    <g>\n      <path d=\"M123.6,6.6 C123.6,6.6 123.9,17.1 123.9,17.1 L104.6,26.4 C113.9,37.1 118.3,50.0 118.7,64.0 C118.7,95.7 93.0,121.4 61.3,121.4 C29.7,121.4 4.0,95.7 4.0,64.0 C4.4,32.0 30.9,6.8 60.9,6.6 C91.0,6.4 123.6,6.6 123.6,6.6 z\" fill=\"#FFFFFF\"/>\n      <path d=\"M85.0,3.5 C106.6,3.5 96.8,3.4 114.4,3.5 C116.9,3.5 119.2,3.5 121.2,3.5 C121.9,3.5 122.5,3.5 123.0,3.5 C123.3,3.5 123.3,3.5 123.5,3.5 C123.6,3.5 123.6,3.5 123.7,3.5 C125.3,3.5 126.7,4.9 126.7,6.5 C126.7,6.8 126.7,6.8 126.7,8.2 C126.8,9.8 126.8,9.8 126.8,11.8 C126.9,13.8 126.9,13.8 126.9,15.4 C126.9,16.7 126.9,16.7 126.9,17.1 C127.0,18.3 126.3,19.4 125.2,19.9 L109.4,27.5 C117.6,38.0 121.1,50.8 121.7,63.9 L121.7,64.0 C121.7,97.4 94.7,124.5 61.3,124.5 C28.0,124.5 1,97.4 1,63.9 C1.4,30.8 28.7,3.7 60.9,3.5 C63.1,3.5 65.3,3.5 67.5,3.5 C77.2,3.5 71.3,3.5 85.0,3.5 z M85.0,9.6 C71.4,9.6 77.2,9.6 67.5,9.6 C65.3,9.6 63.1,9.6 60.9,9.7 C32.1,9.8 7.4,34.2 7.1,64.0 C7.1,94.0 31.4,118.3 61.3,118.3 C91.8,117.9 114.8,94.3 115.6,64.0 C115.4,50.7 110.9,38.6 102.3,28.4 C101.0,26.9 101.5,24.5 103.3,23.6 L120.8,15.2 C120.8,14.1 120.7,13.0 120.7,11.9 C120.7,11.2 120.7,10.4 120.6,9.6 C118.6,9.6 116.5,9.6 114.4,9.6 C96.8,9.6 106.6,9.6 85.0,9.6 z\" fill=\"#A5B6C0\"/>\n    </g>\n    <path d=\"M102.3,90.1 C93.1,104.5 78.3,112.3 61.3,112.7 C44.2,112.6 29.8,104.2 20.3,90.1 L102.3,90.1 z\" fill=\"url(#Gradient_1)\"/>\n    <path d=\"M83.7,60.2 L78.3,59.7 C78.0,58.4 77.5,57.1 76.8,55.9 L80.2,51.7 C80.6,51.3 80.6,50.6 80.2,50.2 L76.9,46.9 C76.7,46.7 76.4,46.6 76.1,46.6 C75.8,46.6 75.6,46.7 75.4,46.8 L71.1,50.3 C70.0,49.6 68.7,49.1 67.4,48.7 L66.9,43.3 C66.8,42.7 66.3,42.3 65.8,42.3 L61.1,42.3 C60.5,42.3 60.0,42.7 60.0,43.3 L59.5,48.7 C58.2,49.1 56.9,49.6 55.7,50.3 L51.5,46.8 C51.3,46.7 51.1,46.6 50.8,46.6 C50.5,46.6 50.2,46.7 50.0,46.9 L46.7,50.2 C46.3,50.6 46.3,51.3 46.6,51.7 L50.1,55.9 C49.4,57.1 48.9,58.4 48.6,59.7 L43.1,60.2 C42.6,60.3 42.1,60.7 42.1,61.3 L42.1,66.0 C42.1,66.6 42.6,67.1 43.1,67.1 L48.6,67.6 C48.9,68.9 49.4,70.2 50.1,71.4 L46.6,75.6 C46.3,76.0 46.3,76.7 46.7,77.1 L50.0,80.4 C50.2,80.6 50.5,80.7 50.8,80.7 C51.1,80.7 51.3,80.6 51.5,80.5 L55.7,77.0 C56.9,77.7 58.2,78.2 59.5,78.6 L60.0,84.0 C60.0,84.6 60.5,85.0 61.1,85.0 L65.8,85.0 C66.3,85.0 66.8,84.6 66.9,84.0 L67.4,78.6 C68.7,78.2 70.0,77.7 71.1,77.0 L75.4,80.5 C75.6,80.6 75.8,80.7 76.1,80.7 C76.4,80.7 76.7,80.6 76.9,80.4 L80.2,77.1 C80.6,76.7 80.6,76.0 80.2,75.6 L76.8,71.4 C77.5,70.2 78.0,68.9 78.3,67.6 L83.7,67.1 C84.3,67.1 84.8,66.6 84.8,66.0 L84.8,61.3 C84.8,60.7 84.3,60.3 83.7,60.2 z M63.4,71.3 C59.2,71.3 55.8,67.9 55.8,63.7 C55.8,59.4 59.2,56.0 63.4,56.0 C67.7,56.0 71.1,59.4 71.1,63.7 C71.1,67.9 67.7,71.3 63.4,71.3 z\" fill=\"#65DFBD\"/>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1409438621693","id": ".style","type": "js","data": "({\n\t/*\"\": {\n\t\t\"\": \"font-size:15pt!important\"\n\t},*/\n\t\n\t\" .s3item .my-modal-overlay\":\"font-size:110%;\",\n\t\n\t\" .s3item\":{\n\t\t\" .edwidth\": function ($form){\n\t\t\treturn \"width:\"+($form.width()-220)+\"px;\"\n\t\t},\n\t\t\" .CodeMirror, .meditor\": function($form) {\n\t\t\t\n\t\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\ttabs = ($form.find(\"#tabs\").outerHeight(true)||0).clamp(38,100),\n\t\t\t\tcss = \"height:\"+($(window).height()-(pad+ofs+nav+tabs+15))+\"px;\";\n\t\t\t\n\t\t\treturn \"min-height:300px;\"+css;\n\t\t},\n\t\t\" .btn-l\": \"border-radius:30px 0 0 30px!important;\",\n\t\t\" .btn-r\": \"border-radius:0 30px 30px 0!important;\",\n\t\t\" .btn-c\": \"border-radius:0 0 0 0!important;\",\n\t\t\" .b1r .CodeMirror-linenumbers\": \"background-color: rgba(255, 200, 200, 0.75);\"\n\t},\n\t\n\t\" .bg-active\":\"background-color:rgba(142, 211, 255, 0.25)\",\n\t\n\t\".my-app-busy\": {\n\t\t\">#nav\": \"opacity:0.2\",\n\t\t\">table\": \"opacity:0.2\",\n\t\t\">#sysload\": {\n\t\t\t\"\": \"display:block;\"\n\t\t}\n\t},\n\t\" .busy:before\":'content:\" \"; width:100%;height:100%;position:absolute;top:0;left:0;background:rgba(255,255,255,0.5);z-index:+3;',\n\t\".my-app-busy-high > #sysload #counter-size\": \"display:block;\",\n\t\" #sysload\": {\n\t\t\"\": \"display:none;position:absolute;width: 100%;text-align: center;height: 300px;padding-top:100px;left:0;top:0;\",\n\t\t\" div#counter-size\": \"margin-top:20px;display:none;\"\n\t},\n\t\".my-app-busy>#sysload\": \"display:block;\",\n\t\" #ilist\": function($form) {\n\t\t\t\n\t\tvar ofs = $(\"#cw-header\").is(\":visible\")?$(\"#cw-header\").outerHeight(true):0,\n\t\t\t\tpad = parseInt($(\"#cw-space\").css(\"paddingTop\")) || 0,\n\t\t\t\tnav = ($form.find(\"#nav\").outerHeight(true)||0).clamp(42,100),\n\t\t\t\tcss = \"max-height:\"+($(window).height()-(pad+ofs+nav+150))+\"px;\";\n\n\t\treturn \"overflow-x:hidden;overflow-y:\"+(navigator.webkitGetUserMedia?\"overlay\":\"scroll\")+\";\"+css;\n\n\t},\n\t\" .edpane\": function($o){\n\t\treturn \"width:\"+($o.width()-220).clamp(750,1500)+\"px;\"\n\t},\n\t\n\t\" #nav button\":\"margin-top:0; margin-bottom:0\",\n\t\n\t' div.tab-tab':{\n\t\t\"\":\"white-space:nowrap;\",\n\t\t\" #tabname\":'padding:1px 18px 1px 7px;color:#8292A3;font-size:80%; border:1px solid #DEE7EC;'\n\t\t\t+'display:inline-block;background-color:white;border-radius:2px 10px 0 0;margin: 0 0 2px 0;',\n\t\t\n\t\t' .btn-tabclose' :'opacity:0;transition:opacity 0.3s;display:inline-block;'\n\t\t\t+'text-align:center;width:18px; margin:0px 2px 0 -18px;color:#c02;line-height:0.9em;padding-right:3px;',\n\t\t\n\t\t' .btn-tabdirty':'opacity:1;transition:opacity 0.3s;display:inline-block;vertical-align:top;'\n\t\t\t+'font-size:75%;line-height:1em; width:16px; text-align:center; margin:4px -16px 0px 0px;',\n\t\t\n\t\t\" #tabname.active\":\"background-color: rgba(142, 211, 255, 0.25);color:#274361;border-color:rgba(255,255,255,0);\",\n\t\t\" #tabname:hover\":'color:#274361;',\n\t\t\":hover .btn-tabclose\":'opacity:0.6;',\n\t\t\":hover .btn-tabdirty\":'opacity:0;'\n\t},\n\t\n\t\" #ilist>div\": \"cursor:pointer\",\n  \n  '  .CodeMirror': function($o) {\n  \tvar large = $o.width() > 1400;\n    return large?{\n    \t'': 'font-size:13.5px;line-height:17px',\n  \t\t' .CodeMirror-lines': 'line-height:17px;',\n    }:{\n    \t'': 'font-size:13px;line-height:16px',\n  \t\t' .CodeMirror-lines': 'line-height:16px;',\n    };\n  },\n  \n\t\" .CodeMirror\": \"height:auto;padding:0px;font-family:Cousine,'PT Mono',Monaco,monospace;\",\n  //\" .CodeMirror-lines\": \"line-height:17px\",\n\t\n\t\" .cm-include\": \"color: #00d059;\",\n\t\" .cm-mustache\": \"color: #967713;\",\n\t\" .cm-csscolor\": \"color: rgba(255, 80, 212, 1); \",\n\t\" .cm-csscolor::selection\":\"cursor:pointer!important;background:red\",\n  \n  ' .CodeMirror-selected':'background: #d9dee0;',\n  ' .CodeMirror-focused .CodeMirror-selected':'background: #cae7ff;',\n  \n  ' .CodeMirror-focused .CodeMirror-selectedtext':'background-color: #cae7ff!important;',\n  ' .cm-matchhighlight':'background-color:rgba(97,255,2,0.3); box-shadow: 0 -2px 0 0 rgba(97,255,2,0.3), 0 1px 0 0 rgba(97,255,2,0.3);'\n  \t\t\t\t\t\t+'border-radius:1px;',\n  ' .CodeMirror-selection-highlight-scrollbar':'background-color: rgba(165,230,255,0.5);',\n\t\n\t\n\t\" .siteitem\": \"font-size:88%;word-wrap: break-word;line-height:1.1em;padding-top: 3px;padding-bottom: 3px;\",\n\t\" .b1\": \"border:1px solid #C1D0DA; border-radius:2px;\",\n\t\" .b1b\": \"border:1px solid #00BCF4; border-radius:2px;\",\n\t\"\t.b1g\": \"border: 1px solid #A4D572;border-radius:2px;\",\n\t\"\t.b1r\": \"border: 1px solid rgb(255, 134, 153);border-radius:2px;\",\n\t\" .red\": \"color:rgb(255, 134, 153)!important;\",\n\t\" .btn-l\": \"border-radius:3px 0 0 3px;\",\n\t\" .btn-r\": \"border-radius:0 3px 3px 0;\",\n\t\" .btn-c\": \"border-radius:0;\",\n\t\" .button\":\"outline:none!important\",\n\t\n\t\" .redactor_editor\":\"font-size:13pt; padding:0.7em; color:#444\",\n\t\" .redactor_box\":\"border:none\",\n\t\" .redactor_toolbar\":\"background: none;padding-top: 2px!important;border-bottom-color:#C1D0DA\",\n\t\" .redactor_toolbar li a:active, .redactor_toolbar li a.redactor_act \":\n\t\t\" outline: none;border-color: #C5DCEA;background-color: #C5DCEA;\",\n\t\" .redactor_toolbar li.redactor_separator\":\n\t\t\t\"margin: 0 2px 0 3px !important;padding: 0;height: 27px;border-right: none;border-left: 1px solid #C1D0DA;\",\n\t\" .redactor_box textarea\":\"background-color:#333;padding:15px;\",\n\t\" .nicescroll-rails\":\"z-index:50!important;\",\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1438055631370","id": ".ParseJS","type": "js","data": "(function (s, clean) {\n\t\n\tvar g=s,\n\t\t\tu = UglifyJS, \n\t\t\tast,\n\t\t\tres ={\n\t\t\t\tglobals:[],\n\t\t\t\terrors:[]\n\t\t\t},\n\t\t\tgl;\n\ttry{\n\t\tast = u.parse(s+\"\");\n\t} catch (e) {\n\t\tres.errors.push (e.message+\" @\"+e.line+\":\"+e.col)\n\t}\n\tif (ast) {\n\t\tast.figure_out_scope();\n\t\tif (Object.isObject(gl = ast.globals) && gl._size) {\n\t\t\tObject.keys(gl._values)\n\t\t\t.forEach(function(i){\n\t\t\t\tres.globals.push(gl._values[i].name);\n\t\t\t});\n\t\t\tres.globals.sort();\n\t\t\tif (clean) {\n\t\t\t\tres.globals = [].remove.apply(\n\t\t\t\t\tres.globals,\n\t\t\t\t\t(\"String Function Date Math Number Object Array RegExp isNaN undefined parseInt parseFloat \"\n\t\t\t\t\t\t+\"isFinite\").split(\" \")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1439299659004","id": ".InitCM","type": "js","data": "(function () {\n\n\t// inits different CM stuff\n\t\n\tvar that = this;\n\t\n\tif (!CodeMirror.overlayMode) _ovl(CodeMirror);\n\n\tif (!CodeMirror.modes.markdown) _md(CodeMirror);\n\n\tif (!CodeMirror.modes.gfm) _gfm(CodeMirror);\n\t\n\tif (!window.marked) that.Marked(window);\n\t\n\tif (!CodeMirror.modes.erlang) that.Erlang(window);\n  \n  if (!CodeMirror.optionHandlers.highlightSelectionMatches) that.Highlighter(CodeMirror);\n\t\n\tthat.CMoverlays();\n\n\treturn ;\n\n\n\t// - - - - - - - - - -\n\n\tfunction _ovl(CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.overlayMode = function(base, overlay, combine) {\n\t\t\treturn {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.startState(base),\n\t\t\t\t\t\toverlay: CodeMirror.startState(overlay),\n\t\t\t\t\t\tbasePos: 0,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: 0,\n\t\t\t\t\t\toverlayCur: null,\n\t\t\t\t\t\tstreamSeen: null\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcopyState: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbase: CodeMirror.copyState(base, state.base),\n\t\t\t\t\t\toverlay: CodeMirror.copyState(overlay, state.overlay),\n\t\t\t\t\t\tbasePos: state.basePos,\n\t\t\t\t\t\tbaseCur: null,\n\t\t\t\t\t\toverlayPos: state.overlayPos,\n\t\t\t\t\t\toverlayCur: null\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\ttoken: function(stream, state) {\n\t\t\t\t\tif (stream != state.streamSeen ||\n\t\t\t\t\t\t\tMath.min(state.basePos, state.overlayPos) < stream.start) {\n\t\t\t\t\t\tstate.streamSeen = stream;\n\t\t\t\t\t\tstate.basePos = state.overlayPos = stream.start;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stream.start == state.basePos) {\n\t\t\t\t\t\tstate.baseCur = base.token(stream, state.base);\n\t\t\t\t\t\tstate.basePos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.start == state.overlayPos) {\n\t\t\t\t\t\tstream.pos = stream.start;\n\t\t\t\t\t\tstate.overlayCur = overlay.token(stream, state.overlay);\n\t\t\t\t\t\tstate.overlayPos = stream.pos;\n\t\t\t\t\t}\n\t\t\t\t\tstream.pos = Math.min(state.basePos, state.overlayPos);\n\n\t\t\t\t\t// state.overlay.combineTokens always takes precedence over combine,\n\t\t\t\t\t// unless set to null\n\t\t\t\t\tif (state.overlayCur == null) return state.baseCur;\n\t\t\t\t\telse if (state.baseCur != null &&\n\t\t\t\t\t\t\t\t\t state.overlay.combineTokens ||\n\t\t\t\t\t\t\t\t\t combine && state.overlay.combineTokens == null)\n\t\t\t\t\t\treturn state.baseCur + \" \" + state.overlayCur;\n\t\t\t\t\telse return state.overlayCur;\n\t\t\t\t},\n\n\t\t\t\tindent: base.indent && function(state, textAfter) {\n\t\t\t\t\treturn base.indent(state.base, textAfter);\n\t\t\t\t},\n\t\t\t\telectricChars: base.electricChars,\n\n\t\t\t\tinnerMode: function(state) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstate: state.base,\n\t\t\t\t\t\tmode: base\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tblankLine: function(state) {\n\t\t\t\t\tif (base.blankLine) base.blankLine(state.base);\n\t\t\t\t\tif (overlay.blankLine) overlay.blankLine(state.overlay);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t}\n\n\t// - - - - - - - - - -\n\n\tfunction _gfm (CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.defineMode(\"gfm\", function(config, modeConfig) {\n\t\t\tvar codeDepth = 0;\n\n\t\t\tfunction blankLine(state) {\n\t\t\t\tstate.code = false;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tvar gfmOverlay = {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcode: false,\n\t\t\t\t\t\tcodeBlock: false,\n\t\t\t\t\t\tateSpace: false\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tcopyState: function(s) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcode: s.code,\n\t\t\t\t\t\tcodeBlock: s.codeBlock,\n\t\t\t\t\t\tateSpace: s.ateSpace\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\ttoken: function(stream, state) {\n\t\t\t\t\tstate.combineTokens = null;\n\n\t\t\t\t\t// Hack to prevent formatting override inside code blocks (block and inline)\n\t\t\t\t\tif (state.codeBlock) {\n\t\t\t\t\t\tif (stream.match(/^```/)) {\n\t\t\t\t\t\t\tstate.codeBlock = false;\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.sol()) {\n\t\t\t\t\t\tstate.code = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.sol() && stream.match(/^```/)) {\n\t\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\t\tstate.codeBlock = true;\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\t// If this block is changed, it may need to be updated in Markdown mode\n\t\t\t\t\tif (stream.peek() === '`') {\n\t\t\t\t\t\tstream.next();\n\t\t\t\t\t\tvar before = stream.pos;\n\t\t\t\t\t\tstream.eatWhile('`');\n\t\t\t\t\t\tvar difference = 1 + stream.pos - before;\n\t\t\t\t\t\tif (!state.code) {\n\t\t\t\t\t\t\tcodeDepth = difference;\n\t\t\t\t\t\t\tstate.code = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (difference === codeDepth) { // Must be exact\n\t\t\t\t\t\t\t\tstate.code = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} else if (state.code) {\n\t\t\t\t\t\tstream.next();\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\t// Check if space. If so, links can be formatted later on\n\t\t\t\t\tif (stream.eatSpace()) {\n\t\t\t\t\t\tstate.ateSpace = true;\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.sol() || state.ateSpace) {\n\t\t\t\t\t\tstate.ateSpace = false;\n\t\t\t\t\t\tif (stream.match(/^(?:[a-zA-Z0-9\\-_]+\\/)?(?:[a-zA-Z0-9\\-_]+@)?(?:[a-f0-9]{7,40}\\b)/)) {\n\t\t\t\t\t\t\t// User/Project@SHA\n\t\t\t\t\t\t\t// User@SHA\n\t\t\t\t\t\t\t// SHA\n\t\t\t\t\t\t\tstate.combineTokens = true;\n\t\t\t\t\t\t\treturn \"link\";\n\t\t\t\t\t\t} else if (stream.match(/^(?:[a-zA-Z0-9\\-_]+\\/)?(?:[a-zA-Z0-9\\-_]+)?#[0-9]+\\b/)) {\n\t\t\t\t\t\t\t// User/Project#Num\n\t\t\t\t\t\t\t// User#Num\n\t\t\t\t\t\t\t// #Num\n\t\t\t\t\t\t\tstate.combineTokens = true;\n\t\t\t\t\t\t\treturn \"link\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.match(/^((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]|\\([^\\s()<>]*\\))+(?:\\([^\\s()<>]*\\)|[^\\s`*!()\\[\\]{};:'\".,<>?«»“”‘’]))/i) &&\n\t\t\t\t\t\t\tstream.string.slice(stream.start - 2, stream.start) != \"](\") {\n\t\t\t\t\t\t// URLs\n\t\t\t\t\t\t// Taken from http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n\t\t\t\t\t\t// And then (issue #1160) simplified to make it not crash the Chrome Regexp engine\n\t\t\t\t\t\tstate.combineTokens = true;\n\t\t\t\t\t\treturn \"link\";\n\t\t\t\t\t}\n\t\t\t\t\tstream.next();\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tblankLine: blankLine\n\t\t\t};\n\n\t\t\tvar markdownConfig = {\n\t\t\t\tunderscoresBreakWords: false,\n\t\t\t\ttaskLists: true,\n\t\t\t\tfencedCodeBlocks: true,\n\t\t\t\tstrikethrough: true\n\t\t\t};\n\t\t\tfor (var attr in modeConfig) {\n\t\t\t\tmarkdownConfig[attr] = modeConfig[attr];\n\t\t\t}\n\t\t\tmarkdownConfig.name = \"markdown\";\n\t\t\treturn CodeMirror.overlayMode(CodeMirror.getMode(config, markdownConfig), gfmOverlay);\n\n\t\t}, \"markdown\");\n\n\t\tCodeMirror.defineMIME(\"text/x-gfm\", \"gfm\");\n\t}\n\n\t// - - - - - -\n\n\tfunction _md (CodeMirror) {\n\t\t\"use strict\";\n\n\t\tCodeMirror.defineMode(\"markdown\", function(cmCfg, modeCfg) {\n\n\t\t\tvar htmlFound = CodeMirror.modes.hasOwnProperty(\"xml\");\n\t\t\tvar htmlMode = CodeMirror.getMode(cmCfg, htmlFound ? {\n\t\t\t\tname: \"xml\",\n\t\t\t\thtmlMode: true\n\t\t\t} : \"text/plain\");\n\n\t\t\tfunction getMode(name) {\n\t\t\t\tif (CodeMirror.findModeByName) {\n\t\t\t\t\tvar found = CodeMirror.findModeByName(name);\n\t\t\t\t\tif (found) name = found.mime || found.mimes[0];\n\t\t\t\t}\n\t\t\t\tvar mode = CodeMirror.getMode(cmCfg, name);\n\t\t\t\treturn mode.name == \"null\" ? null : mode;\n\t\t\t}\n\n\t\t\t// Should characters that affect highlighting be highlighted separate?\n\t\t\t// Does not include characters that will be output (such as `1.` and `-` for lists)\n\t\t\tif (modeCfg.highlightFormatting === undefined)\n\t\t\t\tmodeCfg.highlightFormatting = false;\n\n\t\t\t// Maximum number of nested blockquotes. Set to 0 for infinite nesting.\n\t\t\t// Excess `>` will emit `error` token.\n\t\t\tif (modeCfg.maxBlockquoteDepth === undefined)\n\t\t\t\tmodeCfg.maxBlockquoteDepth = 0;\n\n\t\t\t// Should underscores in words open/close em/strong?\n\t\t\tif (modeCfg.underscoresBreakWords === undefined)\n\t\t\t\tmodeCfg.underscoresBreakWords = true;\n\n\t\t\t// Turn on fenced code blocks? (\"```\" to start/end)\n\t\t\tif (modeCfg.fencedCodeBlocks === undefined) modeCfg.fencedCodeBlocks = false;\n\n\t\t\t// Turn on task lists? (\"- [ ] \" and \"- [x] \")\n\t\t\tif (modeCfg.taskLists === undefined) modeCfg.taskLists = false;\n\n\t\t\t// Turn on strikethrough syntax\n\t\t\tif (modeCfg.strikethrough === undefined)\n\t\t\t\tmodeCfg.strikethrough = false;\n\n\t\t\tvar codeDepth = 0;\n\n\t\t\tvar header = 'header',\n\t\t\t\t\tcode = 'comment',\n\t\t\t\t\tquote = 'quote',\n\t\t\t\t\tlist1 = 'variable-2',\n\t\t\t\t\tlist2 = 'variable-3',\n\t\t\t\t\tlist3 = 'keyword',\n\t\t\t\t\thr = 'hr',\n\t\t\t\t\timage = 'tag',\n\t\t\t\t\tformatting = 'formatting',\n\t\t\t\t\tlinkinline = 'link',\n\t\t\t\t\tlinkemail = 'link',\n\t\t\t\t\tlinktext = 'link',\n\t\t\t\t\tlinkhref = 'string',\n\t\t\t\t\tem = 'em',\n\t\t\t\t\tstrong = 'strong',\n\t\t\t\t\tstrikethrough = 'strikethrough';\n\n\t\t\tvar hrRE = /^([*\\-_])(?:\\s*\\1){2,}\\s*$/,\n\t\t\t\t\tulRE = /^[*\\-+]\\s+/,\n\t\t\t\t\tolRE = /^[0-9]+([.)])\\s+/,\n\t\t\t\t\ttaskListRE = /^\\[(x| )\\](?=\\s)/ // Must follow ulRE or olRE\n\t\t\t,\n\t\t\t\t\tatxHeaderRE = /^(#+)(?: |$)/,\n\t\t\t\t\tsetextHeaderRE = /^ *(?:\\={1,}|-{1,})\\s*$/,\n\t\t\t\t\ttextRE = /^[^#!\\[\\]*_\\\\<>` \"'(~]+/;\n\n\t\t\tfunction switchInline(stream, state, f) {\n\t\t\t\tstate.f = state.inline = f;\n\t\t\t\treturn f(stream, state);\n\t\t\t}\n\n\t\t\tfunction switchBlock(stream, state, f) {\n\t\t\t\tstate.f = state.block = f;\n\t\t\t\treturn f(stream, state);\n\t\t\t}\n\n\n\t\t\t// Blocks\n\n\t\t\tfunction blankLine(state) {\n\t\t\t\t// Reset linkTitle state\n\t\t\t\tstate.linkTitle = false;\n\t\t\t\t// Reset EM state\n\t\t\t\tstate.em = false;\n\t\t\t\t// Reset STRONG state\n\t\t\t\tstate.strong = false;\n\t\t\t\t// Reset strikethrough state\n\t\t\t\tstate.strikethrough = false;\n\t\t\t\t// Reset state.quote\n\t\t\t\tstate.quote = 0;\n\t\t\t\t// Reset state.indentedCode\n\t\t\t\tstate.indentedCode = false;\n\t\t\t\tif (!htmlFound && state.f == htmlBlock) {\n\t\t\t\t\tstate.f = inlineNormal;\n\t\t\t\t\tstate.block = blockNormal;\n\t\t\t\t}\n\t\t\t\t// Reset state.trailingSpace\n\t\t\t\tstate.trailingSpace = 0;\n\t\t\t\tstate.trailingSpaceNewLine = false;\n\t\t\t\t// Mark this line as blank\n\t\t\t\tstate.thisLineHasContent = false;\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfunction blockNormal(stream, state) {\n\n\t\t\t\tvar sol = stream.sol();\n\n\t\t\t\tvar prevLineIsList = state.list !== false,\n\t\t\t\t\t\tprevLineIsIndentedCode = state.indentedCode;\n\n\t\t\t\tstate.indentedCode = false;\n\n\t\t\t\tif (prevLineIsList) {\n\t\t\t\t\tif (state.indentationDiff >= 0) { // Continued list\n\t\t\t\t\t\tif (state.indentationDiff < 4) { // Only adjust indentation if *not* a code block\n\t\t\t\t\t\t\tstate.indentation -= state.indentationDiff;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstate.list = null;\n\t\t\t\t\t} else if (state.indentation > 0) {\n\t\t\t\t\t\tstate.list = null;\n\t\t\t\t\t\tstate.listDepth = Math.floor(state.indentation / 4);\n\t\t\t\t\t} else { // No longer a list\n\t\t\t\t\t\tstate.list = false;\n\t\t\t\t\t\tstate.listDepth = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar match = null;\n\t\t\t\tif (state.indentationDiff >= 4) {\n\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\tif (prevLineIsIndentedCode || !state.prevLineHasContent) {\n\t\t\t\t\t\tstate.indentation -= 4;\n\t\t\t\t\t\tstate.indentedCode = true;\n\t\t\t\t\t\treturn code;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t} else if (stream.eatSpace()) {\n\t\t\t\t\treturn null;\n\t\t\t\t} else if ((match = stream.match(atxHeaderRE)) && match[1].length <= 6) {\n\t\t\t\t\tstate.header = match[1].length;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"header\";\n\t\t\t\t\tstate.f = state.inline;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (state.prevLineHasContent && !state.quote && !prevLineIsList && !prevLineIsIndentedCode && (match = stream.match(setextHeaderRE))) {\n\t\t\t\t\tstate.header = match[0].charAt(0) == '=' ? 1 : 2;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"header\";\n\t\t\t\t\tstate.f = state.inline;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (stream.eat('>')) {\n\t\t\t\t\tstate.quote = sol ? 1 : state.quote + 1;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"quote\";\n\t\t\t\t\tstream.eatSpace();\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (stream.peek() === '[') {\n\t\t\t\t\treturn switchInline(stream, state, footnoteLink);\n\t\t\t\t} else if (stream.match(hrRE, true)) {\n\t\t\t\t\tstate.hr = true;\n\t\t\t\t\treturn hr;\n\t\t\t\t} else if ((!state.prevLineHasContent || prevLineIsList) && (stream.match(ulRE, false) || stream.match(olRE, false))) {\n\t\t\t\t\tvar listType = null;\n\t\t\t\t\tif (stream.match(ulRE, true)) {\n\t\t\t\t\t\tlistType = 'ul';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.match(olRE, true);\n\t\t\t\t\t\tlistType = 'ol';\n\t\t\t\t\t}\n\t\t\t\t\tstate.indentation += 4;\n\t\t\t\t\tstate.list = true;\n\t\t\t\t\tstate.listDepth++;\n\t\t\t\t\tif (modeCfg.taskLists && stream.match(taskListRE, false)) {\n\t\t\t\t\t\tstate.taskList = true;\n\t\t\t\t\t}\n\t\t\t\t\tstate.f = state.inline;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = [\"list\", \"list-\" + listType];\n\t\t\t\t\treturn getType(state);\n\t\t\t\t} else if (modeCfg.fencedCodeBlocks && stream.match(/^```[ \\t]*([\\w+#]*)/, true)) {\n\t\t\t\t\t// try switching mode\n\t\t\t\t\tstate.localMode = getMode(RegExp.$1);\n\t\t\t\t\tif (state.localMode) state.localState = state.localMode.startState();\n\t\t\t\t\tstate.f = state.block = local;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"code-block\";\n\t\t\t\t\tstate.code = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\treturn switchInline(stream, state, state.inline);\n\t\t\t}\n\n\t\t\tfunction htmlBlock(stream, state) {\n\t\t\t\tvar style = htmlMode.token(stream, state.htmlState);\n\t\t\t\tif ((htmlFound && state.htmlState.tagStart === null &&\n\t\t\t\t\t\t (!state.htmlState.context && state.htmlState.tokenize.isInText)) ||\n\t\t\t\t\t\t(state.md_inside && stream.current().indexOf(\">\") > -1)) {\n\t\t\t\t\tstate.f = inlineNormal;\n\t\t\t\t\tstate.block = blockNormal;\n\t\t\t\t\tstate.htmlState = null;\n\t\t\t\t}\n\t\t\t\treturn style;\n\t\t\t}\n\n\t\t\tfunction local(stream, state) {\n\t\t\t\tif (stream.sol() && stream.match(\"```\", false)) {\n\t\t\t\t\tstate.localMode = state.localState = null;\n\t\t\t\t\tstate.f = state.block = leavingLocal;\n\t\t\t\t\treturn null;\n\t\t\t\t} else if (state.localMode) {\n\t\t\t\t\treturn state.localMode.token(stream, state.localState);\n\t\t\t\t} else {\n\t\t\t\t\tstream.skipToEnd();\n\t\t\t\t\treturn code;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction leavingLocal(stream, state) {\n\t\t\t\tstream.match(\"```\");\n\t\t\t\tstate.block = blockNormal;\n\t\t\t\tstate.f = inlineNormal;\n\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"code-block\";\n\t\t\t\tstate.code = true;\n\t\t\t\tvar returnType = getType(state);\n\t\t\t\tstate.code = false;\n\t\t\t\treturn returnType;\n\t\t\t}\n\n\t\t\t// Inline\n\n\t\t\tfunction getType(state) {\n\t\t\t\tvar styles = [];\n\n\t\t\t\tif (state.formatting) {\n\t\t\t\t\tstyles.push(formatting);\n\n\t\t\t\t\tif (typeof state.formatting === \"string\") state.formatting = [state.formatting];\n\n\t\t\t\t\tfor (var i = 0; i < state.formatting.length; i++) {\n\t\t\t\t\t\tstyles.push(formatting + \"-\" + state.formatting[i]);\n\n\t\t\t\t\t\tif (state.formatting[i] === \"header\") {\n\t\t\t\t\t\t\tstyles.push(formatting + \"-\" + state.formatting[i] + \"-\" + state.header);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add `formatting-quote` and `formatting-quote-#` for blockquotes\n\t\t\t\t\t\t// Add `error` instead if the maximum blockquote nesting depth is passed\n\t\t\t\t\t\tif (state.formatting[i] === \"quote\") {\n\t\t\t\t\t\t\tif (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {\n\t\t\t\t\t\t\t\tstyles.push(formatting + \"-\" + state.formatting[i] + \"-\" + state.quote);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstyles.push(\"error\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.taskOpen) {\n\t\t\t\t\tstyles.push(\"meta\");\n\t\t\t\t\treturn styles.length ? styles.join(' ') : null;\n\t\t\t\t}\n\t\t\t\tif (state.taskClosed) {\n\t\t\t\t\tstyles.push(\"property\");\n\t\t\t\t\treturn styles.length ? styles.join(' ') : null;\n\t\t\t\t}\n\n\t\t\t\tif (state.linkHref) {\n\t\t\t\t\tstyles.push(linkhref, \"url\");\n\t\t\t\t} else { // Only apply inline styles to non-url text\n\t\t\t\t\tif (state.strong) {\n\t\t\t\t\t\tstyles.push(strong);\n\t\t\t\t\t}\n\t\t\t\t\tif (state.em) {\n\t\t\t\t\t\tstyles.push(em);\n\t\t\t\t\t}\n\t\t\t\t\tif (state.strikethrough) {\n\t\t\t\t\t\tstyles.push(strikethrough);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.linkText) {\n\t\t\t\t\t\tstyles.push(linktext);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.code) {\n\t\t\t\t\t\tstyles.push(code);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.header) {\n\t\t\t\t\tstyles.push(header);\n\t\t\t\t\tstyles.push(header + \"-\" + state.header);\n\t\t\t\t}\n\n\t\t\t\tif (state.quote) {\n\t\t\t\t\tstyles.push(quote);\n\n\t\t\t\t\t// Add `quote-#` where the maximum for `#` is modeCfg.maxBlockquoteDepth\n\t\t\t\t\tif (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {\n\t\t\t\t\t\tstyles.push(quote + \"-\" + state.quote);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyles.push(quote + \"-\" + modeCfg.maxBlockquoteDepth);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.list !== false) {\n\t\t\t\t\tvar listMod = (state.listDepth - 1) % 3;\n\t\t\t\t\tif (!listMod) {\n\t\t\t\t\t\tstyles.push(list1);\n\t\t\t\t\t} else if (listMod === 1) {\n\t\t\t\t\t\tstyles.push(list2);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyles.push(list3);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (state.trailingSpaceNewLine) {\n\t\t\t\t\tstyles.push(\"trailing-space-new-line\");\n\t\t\t\t} else if (state.trailingSpace) {\n\t\t\t\t\tstyles.push(\"trailing-space-\" + (state.trailingSpace % 2 ? \"a\" : \"b\"));\n\t\t\t\t}\n\n\t\t\t\treturn styles.length ? styles.join(' ') : null;\n\t\t\t}\n\n\t\t\tfunction handleText(stream, state) {\n\t\t\t\tif (stream.match(textRE, true)) {\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tfunction inlineNormal(stream, state) {\n\t\t\t\tvar style = state.text(stream, state);\n\t\t\t\tif (typeof style !== 'undefined')\n\t\t\t\t\treturn style;\n\n\t\t\t\tif (state.list) { // List marker (*, +, -, 1., etc)\n\t\t\t\t\tstate.list = null;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tif (state.taskList) {\n\t\t\t\t\tvar taskOpen = stream.match(taskListRE, true)[1] !== \"x\";\n\t\t\t\t\tif (taskOpen) state.taskOpen = true;\n\t\t\t\t\telse state.taskClosed = true;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"task\";\n\t\t\t\t\tstate.taskList = false;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tstate.taskOpen = false;\n\t\t\t\tstate.taskClosed = false;\n\n\t\t\t\tif (state.header && stream.match(/^#+$/, true)) {\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"header\";\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\t// Get sol() value now, before character is consumed\n\t\t\t\tvar sol = stream.sol();\n\n\t\t\t\tvar ch = stream.next();\n\n\t\t\t\tif (ch === '\\\\') {\n\t\t\t\t\tstream.next();\n\t\t\t\t\tif (modeCfg.highlightFormatting) {\n\t\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\t\treturn type ? type + \" formatting-escape\" : \"formatting-escape\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Matches link titles present on next line\n\t\t\t\tif (state.linkTitle) {\n\t\t\t\t\tstate.linkTitle = false;\n\t\t\t\t\tvar matchCh = ch;\n\t\t\t\t\tif (ch === '(') {\n\t\t\t\t\t\tmatchCh = ')';\n\t\t\t\t\t}\n\t\t\t\t\tmatchCh = (matchCh + '').replace(/([.?*+^$[\\]\\\\(){}|-])/g, \"\\\\$1\");\n\t\t\t\t\tvar regex = '^\\\\s*(?:[^' + matchCh + '\\\\\\\\]+|\\\\\\\\\\\\\\\\|\\\\\\\\.)' + matchCh;\n\t\t\t\t\tif (stream.match(new RegExp(regex), true)) {\n\t\t\t\t\t\treturn linkhref;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If this block is changed, it may need to be updated in GFM mode\n\t\t\t\tif (ch === '`') {\n\t\t\t\t\tvar previousFormatting = state.formatting;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"code\";\n\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\tvar before = stream.pos;\n\t\t\t\t\tstream.eatWhile('`');\n\t\t\t\t\tvar difference = 1 + stream.pos - before;\n\t\t\t\t\tif (!state.code) {\n\t\t\t\t\t\tcodeDepth = difference;\n\t\t\t\t\t\tstate.code = true;\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (difference === codeDepth) { // Must be exact\n\t\t\t\t\t\t\tstate.code = false;\n\t\t\t\t\t\t\treturn t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstate.formatting = previousFormatting;\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t}\n\t\t\t\t} else if (state.code) {\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tif (ch === '!' && stream.match(/\\[[^\\]]*\\] ?(?:\\(|\\[)/, false)) {\n\t\t\t\t\tstream.match(/\\[[^\\]]*\\]/);\n\t\t\t\t\tstate.inline = state.f = linkHref;\n\t\t\t\t\treturn image;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '[' && stream.match(/.*\\](\\(.*\\)| ?\\[.*\\])/, false)) {\n\t\t\t\t\tstate.linkText = true;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\n\t\t\t\tif (ch === ']' && state.linkText && stream.match(/\\(.*\\)| ?\\[.*\\]/, false)) {\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tstate.linkText = false;\n\t\t\t\t\tstate.inline = state.f = linkHref;\n\t\t\t\t\treturn type;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^(https?|ftps?):\\/\\/(?:[^\\\\>]|\\\\.)+>/, false)) {\n\t\t\t\t\tstate.f = state.inline = linkInline;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\ttype += \" \";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn type + linkinline;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^[^> \\\\]+@(?:[^\\\\>]|\\\\.)+>/, false)) {\n\t\t\t\t\tstate.f = state.inline = linkInline;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\ttype += \" \";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn type + linkemail;\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^(!--|\\w)/, false)) {\n\t\t\t\t\tvar end = stream.string.indexOf(\">\", stream.pos);\n\t\t\t\t\tif (end != -1) {\n\t\t\t\t\t\tvar atts = stream.string.substring(stream.start, end);\n\t\t\t\t\t\tif (/markdown\\s*=\\s*('|\"){0,1}1('|\"){0,1}/.test(atts)) state.md_inside = true;\n\t\t\t\t\t}\n\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\tstate.htmlState = CodeMirror.startState(htmlMode);\n\t\t\t\t\treturn switchBlock(stream, state, htmlBlock);\n\t\t\t\t}\n\n\t\t\t\tif (ch === '<' && stream.match(/^\\/\\w*?>/)) {\n\t\t\t\t\tstate.md_inside = false;\n\t\t\t\t\treturn \"tag\";\n\t\t\t\t}\n\n\t\t\t\tvar ignoreUnderscore = false;\n\t\t\t\tif (!modeCfg.underscoresBreakWords) {\n\t\t\t\t\tif (ch === '_' && stream.peek() !== '_' && stream.match(/(\\w)/, false)) {\n\t\t\t\t\t\tvar prevPos = stream.pos - 2;\n\t\t\t\t\t\tif (prevPos >= 0) {\n\t\t\t\t\t\t\tvar prevCh = stream.string.charAt(prevPos);\n\t\t\t\t\t\t\tif (prevCh !== '_' && prevCh.match(/(\\w)/, false)) {\n\t\t\t\t\t\t\t\tignoreUnderscore = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (ch === '*' || (ch === '_' && !ignoreUnderscore)) {\n\t\t\t\t\tif (sol && stream.peek() === ' ') {\n\t\t\t\t\t\t// Do nothing, surrounded by newline and space\n\t\t\t\t\t} else if (state.strong === ch && stream.eat(ch)) { // Remove STRONG\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strong\";\n\t\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\t\tstate.strong = false;\n\t\t\t\t\t\treturn t;\n\t\t\t\t\t} else if (!state.strong && stream.eat(ch)) { // Add STRONG\n\t\t\t\t\t\tstate.strong = ch;\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strong\";\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t} else if (state.em === ch) { // Remove EM\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"em\";\n\t\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\t\tstate.em = false;\n\t\t\t\t\t\treturn t;\n\t\t\t\t\t} else if (!state.em) { // Add EM\n\t\t\t\t\t\tstate.em = ch;\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"em\";\n\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t}\n\t\t\t\t} else if (ch === ' ') {\n\t\t\t\t\tif (stream.eat('*') || stream.eat('_')) { // Probably surrounded by spaces\n\t\t\t\t\t\tif (stream.peek() === ' ') { // Surrounded by spaces, ignore\n\t\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t\t} else { // Not surrounded by spaces, back up pointer\n\t\t\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (modeCfg.strikethrough) {\n\t\t\t\t\tif (ch === '~' && stream.eatWhile(ch)) {\n\t\t\t\t\t\tif (state.strikethrough) { // Remove strikethrough\n\t\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strikethrough\";\n\t\t\t\t\t\t\tvar t = getType(state);\n\t\t\t\t\t\t\tstate.strikethrough = false;\n\t\t\t\t\t\t\treturn t;\n\t\t\t\t\t\t} else if (stream.match(/^[^\\s]/, false)) { // Add strikethrough\n\t\t\t\t\t\t\tstate.strikethrough = true;\n\t\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"strikethrough\";\n\t\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (ch === ' ') {\n\t\t\t\t\t\tif (stream.match(/^~~/, true)) { // Probably surrounded by space\n\t\t\t\t\t\t\tif (stream.peek() === ' ') { // Surrounded by spaces, ignore\n\t\t\t\t\t\t\t\treturn getType(state);\n\t\t\t\t\t\t\t} else { // Not surrounded by spaces, back up pointer\n\t\t\t\t\t\t\t\tstream.backUp(2);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (ch === ' ') {\n\t\t\t\t\tif (stream.match(/ +$/, false)) {\n\t\t\t\t\t\tstate.trailingSpace++;\n\t\t\t\t\t} else if (state.trailingSpace) {\n\t\t\t\t\t\tstate.trailingSpaceNewLine = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn getType(state);\n\t\t\t}\n\n\t\t\tfunction linkInline(stream, state) {\n\t\t\t\tvar ch = stream.next();\n\n\t\t\t\tif (ch === \">\") {\n\t\t\t\t\tstate.f = state.inline = inlineNormal;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar type = getType(state);\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\ttype += \" \";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn type + linkinline;\n\t\t\t\t}\n\n\t\t\t\tstream.match(/^[^>]+/, true);\n\n\t\t\t\treturn linkinline;\n\t\t\t}\n\n\t\t\tfunction linkHref(stream, state) {\n\t\t\t\t// Check if space, and return NULL if so (to avoid marking the space)\n\t\t\t\tif (stream.eatSpace()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tvar ch = stream.next();\n\t\t\t\tif (ch === '(' || ch === '[') {\n\t\t\t\t\tstate.f = state.inline = getLinkHrefInside(ch === \"(\" ? \")\" : \"]\");\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link-string\";\n\t\t\t\t\tstate.linkHref = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\t\t\t\treturn 'error';\n\t\t\t}\n\n\t\t\tfunction getLinkHrefInside(endChar) {\n\t\t\t\treturn function(stream, state) {\n\t\t\t\t\tvar ch = stream.next();\n\n\t\t\t\t\tif (ch === endChar) {\n\t\t\t\t\t\tstate.f = state.inline = inlineNormal;\n\t\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link-string\";\n\t\t\t\t\t\tvar returnState = getType(state);\n\t\t\t\t\t\tstate.linkHref = false;\n\t\t\t\t\t\treturn returnState;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stream.match(inlineRE(endChar), true)) {\n\t\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.linkHref = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction footnoteLink(stream, state) {\n\t\t\t\tif (stream.match(/^[^\\]]*\\]:/, false)) {\n\t\t\t\t\tstate.f = footnoteLinkInside;\n\t\t\t\t\tstream.next(); // Consume [\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tstate.linkText = true;\n\t\t\t\t\treturn getType(state);\n\t\t\t\t}\n\t\t\t\treturn switchInline(stream, state, inlineNormal);\n\t\t\t}\n\n\t\t\tfunction footnoteLinkInside(stream, state) {\n\t\t\t\tif (stream.match(/^\\]:/, true)) {\n\t\t\t\t\tstate.f = state.inline = footnoteUrl;\n\t\t\t\t\tif (modeCfg.highlightFormatting) state.formatting = \"link\";\n\t\t\t\t\tvar returnType = getType(state);\n\t\t\t\t\tstate.linkText = false;\n\t\t\t\t\treturn returnType;\n\t\t\t\t}\n\n\t\t\t\tstream.match(/^[^\\]]+/, true);\n\n\t\t\t\treturn linktext;\n\t\t\t}\n\n\t\t\tfunction footnoteUrl(stream, state) {\n\t\t\t\t// Check if space, and return NULL if so (to avoid marking the space)\n\t\t\t\tif (stream.eatSpace()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\t// Match URL\n\t\t\t\tstream.match(/^[^\\s]+/, true);\n\t\t\t\t// Check for link title\n\t\t\t\tif (stream.peek() === undefined) { // End of line, set flag to check next line\n\t\t\t\t\tstate.linkTitle = true;\n\t\t\t\t} else { // More content on line, check if link title\n\t\t\t\t\tstream.match(/^(?:\\s+(?:\"(?:[^\"\\\\]|\\\\\\\\|\\\\.)+\"|'(?:[^'\\\\]|\\\\\\\\|\\\\.)+'|\\((?:[^)\\\\]|\\\\\\\\|\\\\.)+\\)))?/, true);\n\t\t\t\t}\n\t\t\t\tstate.f = state.inline = inlineNormal;\n\t\t\t\treturn linkhref + \" url\";\n\t\t\t}\n\n\t\t\tvar savedInlineRE = [];\n\n\t\t\tfunction inlineRE(endChar) {\n\t\t\t\tif (!savedInlineRE[endChar]) {\n\t\t\t\t\t// Escape endChar for RegExp (taken from http://stackoverflow.com/a/494122/526741)\n\t\t\t\t\tendChar = (endChar + '').replace(/([.?*+^$[\\]\\\\(){}|-])/g, \"\\\\$1\");\n\t\t\t\t\t// Match any non-endChar, escaped character, as well as the closing\n\t\t\t\t\t// endChar.\n\t\t\t\t\tsavedInlineRE[endChar] = new RegExp('^(?:[^\\\\\\\\]|\\\\\\\\.)*?(' + endChar + ')');\n\t\t\t\t}\n\t\t\t\treturn savedInlineRE[endChar];\n\t\t\t}\n\n\t\t\tvar mode = {\n\t\t\t\tstartState: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tf: blockNormal,\n\n\t\t\t\t\t\tprevLineHasContent: false,\n\t\t\t\t\t\tthisLineHasContent: false,\n\n\t\t\t\t\t\tblock: blockNormal,\n\t\t\t\t\t\thtmlState: null,\n\t\t\t\t\t\tindentation: 0,\n\n\t\t\t\t\t\tinline: inlineNormal,\n\t\t\t\t\t\ttext: handleText,\n\n\t\t\t\t\t\tformatting: false,\n\t\t\t\t\t\tlinkText: false,\n\t\t\t\t\t\tlinkHref: false,\n\t\t\t\t\t\tlinkTitle: false,\n\t\t\t\t\t\tem: false,\n\t\t\t\t\t\tstrong: false,\n\t\t\t\t\t\theader: 0,\n\t\t\t\t\t\thr: false,\n\t\t\t\t\t\ttaskList: false,\n\t\t\t\t\t\tlist: false,\n\t\t\t\t\t\tlistDepth: 0,\n\t\t\t\t\t\tquote: 0,\n\t\t\t\t\t\ttrailingSpace: 0,\n\t\t\t\t\t\ttrailingSpaceNewLine: false,\n\t\t\t\t\t\tstrikethrough: false\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tcopyState: function(s) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tf: s.f,\n\n\t\t\t\t\t\tprevLineHasContent: s.prevLineHasContent,\n\t\t\t\t\t\tthisLineHasContent: s.thisLineHasContent,\n\n\t\t\t\t\t\tblock: s.block,\n\t\t\t\t\t\thtmlState: s.htmlState && CodeMirror.copyState(htmlMode, s.htmlState),\n\t\t\t\t\t\tindentation: s.indentation,\n\n\t\t\t\t\t\tlocalMode: s.localMode,\n\t\t\t\t\t\tlocalState: s.localMode ? CodeMirror.copyState(s.localMode, s.localState) : null,\n\n\t\t\t\t\t\tinline: s.inline,\n\t\t\t\t\t\ttext: s.text,\n\t\t\t\t\t\tformatting: false,\n\t\t\t\t\t\tlinkTitle: s.linkTitle,\n\t\t\t\t\t\tem: s.em,\n\t\t\t\t\t\tstrong: s.strong,\n\t\t\t\t\t\tstrikethrough: s.strikethrough,\n\t\t\t\t\t\theader: s.header,\n\t\t\t\t\t\thr: s.hr,\n\t\t\t\t\t\ttaskList: s.taskList,\n\t\t\t\t\t\tlist: s.list,\n\t\t\t\t\t\tlistDepth: s.listDepth,\n\t\t\t\t\t\tquote: s.quote,\n\t\t\t\t\t\tindentedCode: s.indentedCode,\n\t\t\t\t\t\ttrailingSpace: s.trailingSpace,\n\t\t\t\t\t\ttrailingSpaceNewLine: s.trailingSpaceNewLine,\n\t\t\t\t\t\tmd_inside: s.md_inside\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\ttoken: function(stream, state) {\n\n\t\t\t\t\t// Reset state.formatting\n\t\t\t\t\tstate.formatting = false;\n\n\t\t\t\t\tif (stream.sol()) {\n\t\t\t\t\t\tvar forceBlankLine = !! state.header || state.hr;\n\n\t\t\t\t\t\t// Reset state.header and state.hr\n\t\t\t\t\t\tstate.header = 0;\n\t\t\t\t\t\tstate.hr = false;\n\n\t\t\t\t\t\tif (stream.match(/^\\s*$/, true) || forceBlankLine) {\n\t\t\t\t\t\t\tstate.prevLineHasContent = false;\n\t\t\t\t\t\t\tblankLine(state);\n\t\t\t\t\t\t\treturn forceBlankLine ? this.token(stream, state) : null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate.prevLineHasContent = state.thisLineHasContent;\n\t\t\t\t\t\t\tstate.thisLineHasContent = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Reset state.taskList\n\t\t\t\t\t\tstate.taskList = false;\n\n\t\t\t\t\t\t// Reset state.code\n\t\t\t\t\t\tstate.code = false;\n\n\t\t\t\t\t\t// Reset state.trailingSpace\n\t\t\t\t\t\tstate.trailingSpace = 0;\n\t\t\t\t\t\tstate.trailingSpaceNewLine = false;\n\n\t\t\t\t\t\tstate.f = state.block;\n\t\t\t\t\t\tvar indentation = stream.match(/^\\s*/, true)[0].replace(/\\t/g, '    ').length;\n\t\t\t\t\t\tvar difference = Math.floor((indentation - state.indentation) / 4) * 4;\n\t\t\t\t\t\tif (difference > 4) difference = 4;\n\t\t\t\t\t\tvar adjustedIndentation = state.indentation + difference;\n\t\t\t\t\t\tstate.indentationDiff = adjustedIndentation - state.indentation;\n\t\t\t\t\t\tstate.indentation = adjustedIndentation;\n\t\t\t\t\t\tif (indentation > 0) return null;\n\t\t\t\t\t}\n\t\t\t\t\treturn state.f(stream, state);\n\t\t\t\t},\n\n\t\t\t\tinnerMode: function(state) {\n\t\t\t\t\tif (state.block == htmlBlock) return {\n\t\t\t\t\t\tstate: state.htmlState,\n\t\t\t\t\t\tmode: htmlMode\n\t\t\t\t\t};\n\t\t\t\t\tif (state.localState) return {\n\t\t\t\t\t\tstate: state.localState,\n\t\t\t\t\t\tmode: state.localMode\n\t\t\t\t\t};\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstate: state,\n\t\t\t\t\t\tmode: mode\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tblankLine: blankLine,\n\n\t\t\t\tgetType: getType,\n\n\t\t\t\tfold: \"markdown\"\n\t\t\t};\n\t\t\treturn mode;\n\t\t}, \"xml\");\n\n\t\tCodeMirror.defineMIME(\"text/x-markdown\", \"markdown\");\n\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1439308330205","id": ".Marked","type": "js","data": "(function (global) {\n\t/**\n * marked - a markdown parser\n * Copyright (c) 2011-2014, Christopher Jeffrey. (MIT Licensed)\n * https://github.com/chjj/marked\n */\n\n\tvar block = {\n\t\tnewline: /^\\n+/,\n\t\tcode: /^( {4}[^\\n]+\\n*)+/,\n\t\tfences: noop,\n\t\thr: /^( *[-*_]){3,} *(?:\\n+|$)/,\n\t\theading: /^ *(#{1,6}) *([^\\n]+?) *#* *(?:\\n+|$)/,\n\t\tnptable: noop,\n\t\tlheading: /^([^\\n]+)\\n *(=|-){2,} *(?:\\n+|$)/,\n\t\tblockquote: /^( *>[^\\n]+(\\n(?!def)[^\\n]+)*\\n*)+/,\n\t\tlist: /^( *)(bull) [\\s\\S]+?(?:hr|def|\\n{2,}(?! )(?!\\1bull )\\n*|\\s*$)/,\n\t\thtml: /^ *(?:comment *(?:\\n|\\s*$)|closed *(?:\\n{2,}|\\s*$)|closing *(?:\\n{2,}|\\s*$))/,\n\t\tdef: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +[\"(]([^\\n]+)[\")])? *(?:\\n+|$)/,\n\t\ttable: noop,\n\t\tparagraph: /^((?:[^\\n]+\\n?(?!hr|heading|lheading|blockquote|tag|def))+)\\n*/,\n\t\ttext: /^[^\\n]+/\n\t};\n\n\tblock.bullet = /(?:[*+-]|\\d+\\.)/;\n\tblock.item = /^( *)(bull) [^\\n]*(?:\\n(?!\\1bull )[^\\n]*)*/;\n\tblock.item = replace(block.item, 'gm')\n\t(/bull/g, block.bullet)\n\t();\n\n\tblock.list = replace(block.list)\n\t(/bull/g, block.bullet)\n\t('hr', '\\\\n+(?=\\\\1?(?:[-*_] *){3,}(?:\\\\n+|$))')\n\t('def', '\\\\n+(?=' + block.def.source + ')')\n\t();\n\n\tblock.blockquote = replace(block.blockquote)\n\t('def', block.def)\n\t();\n\n\tblock._tag = '(?!(?:'\n\t+ 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code'\n\t+ '|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo'\n\t+ '|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:/|[^\\\\w\\\\s@]*@)\\\\b';\n\n\tblock.html = replace(block.html)\n\t('comment', /<!--[\\s\\S]*?-->/)\n\t('closed', /<(tag)[\\s\\S]+?<\\/\\1>/)\n\t('closing', /<tag(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/)\n\t(/tag/g, block._tag)\n\t();\n\n\tblock.paragraph = replace(block.paragraph)\n\t('hr', block.hr)\n\t('heading', block.heading)\n\t('lheading', block.lheading)\n\t('blockquote', block.blockquote)\n\t('tag', '<' + block._tag)\n\t('def', block.def)\n\t();\n\n\t/**\n * Normal Block Grammar\n */\n\n\tblock.normal = merge({}, block);\n\n\t/**\n * GFM Block Grammar\n */\n\n\tblock.gfm = merge({}, block.normal, {\n\t\tfences: /^ *(`{3,}|~{3,})[ \\.]*(\\S+)? *\\n([\\s\\S]*?)\\s*\\1 *(?:\\n+|$)/,\n\t\tparagraph: /^/,\n\t\theading: /^ *(#{1,6}) +([^\\n]+?) *#* *(?:\\n+|$)/\n\t});\n\n\tblock.gfm.paragraph = replace(block.paragraph)\n\t('(?!', '(?!'\n\t + block.gfm.fences.source.replace('\\\\1', '\\\\2') + '|'\n\t + block.list.source.replace('\\\\1', '\\\\3') + '|')\n\t();\n\n\t/**\n * GFM + Tables Block Grammar\n */\n\n\tblock.tables = merge({}, block.gfm, {\n\t\tnptable: /^ *(\\S.*\\|.*)\\n *([-:]+ *\\|[-| :]*)\\n((?:.*\\|.*(?:\\n|$))*)\\n*/,\n\t\ttable: /^ *\\|(.+)\\n *\\|( *[-:]+[-| :]*)\\n((?: *\\|.*(?:\\n|$))*)\\n*/\n\t});\n\n\t/**\n * Block Lexer\n */\n\n\tfunction Lexer(options) {\n\t\tthis.tokens = [];\n\t\tthis.tokens.links = {};\n\t\tthis.options = options || marked.defaults;\n\t\tthis.rules = block.normal;\n\n\t\tif (this.options.gfm) {\n\t\t\tif (this.options.tables) {\n\t\t\t\tthis.rules = block.tables;\n\t\t\t} else {\n\t\t\t\tthis.rules = block.gfm;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n * Expose Block Rules\n */\n\n\tLexer.rules = block;\n\n\t/**\n * Static Lex Method\n */\n\n\tLexer.lex = function(src, options) {\n\t\tvar lexer = new Lexer(options);\n\t\treturn lexer.lex(src);\n\t};\n\n\t/**\n * Preprocessing\n */\n\n\tLexer.prototype.lex = function(src) {\n\t\tsrc = src\n\t\t.replace(/\\r\\n|\\r/g, '\\n')\n\t\t.replace(/\\t/g, '    ')\n\t\t.replace(/\\u00a0/g, ' ')\n\t\t.replace(/\\u2424/g, '\\n');\n\n\t\treturn this.token(src, true);\n\t};\n\n\t/**\n * Lexing\n */\n\n\tLexer.prototype.token = function(src, top, bq) {\n\t\tvar src = src.replace(/^ +$/gm, '')\n\t\t, next\n\t\t, loose\n\t\t, cap\n\t\t, bull\n\t\t, b\n\t\t, item\n\t\t, space\n\t\t, i\n\t\t, l;\n\n\t\twhile (src) {\n\t\t\t// newline\n\t\t\tif (cap = this.rules.newline.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tif (cap[0].length > 1) {\n\t\t\t\t\tthis.tokens.push({\n\t\t\t\t\t\ttype: 'space'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// code\n\t\t\tif (cap = this.rules.code.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tcap = cap[0].replace(/^ {4}/gm, '');\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'code',\n\t\t\t\t\ttext: !this.options.pedantic\n\t\t\t\t\t? cap.replace(/\\n+$/, '')\n\t\t\t\t\t: cap\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// fences (gfm)\n\t\t\tif (cap = this.rules.fences.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'code',\n\t\t\t\t\tlang: cap[2],\n\t\t\t\t\ttext: cap[3] || ''\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// heading\n\t\t\tif (cap = this.rules.heading.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'heading',\n\t\t\t\t\tdepth: cap[1].length,\n\t\t\t\t\ttext: cap[2]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// table no leading pipe (gfm)\n\t\t\tif (top && (cap = this.rules.nptable.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\n\t\t\t\titem = {\n\t\t\t\t\ttype: 'table',\n\t\t\t\t\theader: cap[1].replace(/^ *| *\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\talign: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\tcells: cap[3].replace(/\\n$/, '').split('\\n')\n\t\t\t\t};\n\n\t\t\t\tfor (i = 0; i < item.align.length; i++) {\n\t\t\t\t\tif (/^ *-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'right';\n\t\t\t\t\t} else if (/^ *:-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'center';\n\t\t\t\t\t} else if (/^ *:-+ *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'left';\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.align[i] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < item.cells.length; i++) {\n\t\t\t\t\titem.cells[i] = item.cells[i].split(/ *\\| */);\n\t\t\t\t}\n\n\t\t\t\tthis.tokens.push(item);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// lheading\n\t\t\tif (cap = this.rules.lheading.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'heading',\n\t\t\t\t\tdepth: cap[2] === '=' ? 1 : 2,\n\t\t\t\t\ttext: cap[1]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// hr\n\t\t\tif (cap = this.rules.hr.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'hr'\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// blockquote\n\t\t\tif (cap = this.rules.blockquote.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'blockquote_start'\n\t\t\t\t});\n\n\t\t\t\tcap = cap[0].replace(/^ *> ?/gm, '');\n\n\t\t\t\t// Pass `top` to keep the current\n\t\t\t\t// \"toplevel\" state. This is exactly\n\t\t\t\t// how markdown.pl works.\n\t\t\t\tthis.token(cap, top, true);\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'blockquote_end'\n\t\t\t\t});\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// list\n\t\t\tif (cap = this.rules.list.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tbull = cap[2];\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'list_start',\n\t\t\t\t\tordered: bull.length > 1\n\t\t\t\t});\n\n\t\t\t\t// Get each top-level item.\n\t\t\t\tcap = cap[0].match(this.rules.item);\n\n\t\t\t\tnext = false;\n\t\t\t\tl = cap.length;\n\t\t\t\ti = 0;\n\n\t\t\t\tfor (; i < l; i++) {\n\t\t\t\t\titem = cap[i];\n\n\t\t\t\t\t// Remove the list item's bullet\n\t\t\t\t\t// so it is seen as the next token.\n\t\t\t\t\tspace = item.length;\n\t\t\t\t\titem = item.replace(/^ *([*+-]|\\d+\\.) +/, '');\n\n\t\t\t\t\t// Outdent whatever the\n\t\t\t\t\t// list item contains. Hacky.\n\t\t\t\t\tif (~item.indexOf('\\n ')) {\n\t\t\t\t\t\tspace -= item.length;\n\t\t\t\t\t\titem = !this.options.pedantic\n\t\t\t\t\t\t? item.replace(new RegExp('^ {1,' + space + '}', 'gm'), '')\n\t\t\t\t\t\t: item.replace(/^ {1,4}/gm, '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Determine whether the next list item belongs here.\n\t\t\t\t\t// Backpedal if it does not belong in this list.\n\t\t\t\t\tif (this.options.smartLists && i !== l - 1) {\n\t\t\t\t\t\tb = block.bullet.exec(cap[i + 1])[0];\n\t\t\t\t\t\tif (bull !== b && !(bull.length > 1 && b.length > 1)) {\n\t\t\t\t\t\t\tsrc = cap.slice(i + 1).join('\\n') + src;\n\t\t\t\t\t\t\ti = l - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Determine whether item is loose or not.\n\t\t\t\t\t// Use: /(^|\\n)(?! )[^\\n]+\\n\\n(?!\\s*$)/\n\t\t\t\t\t// for discount behavior.\n\t\t\t\t\tloose = next || /\\n\\n(?!\\s*$)/.test(item);\n\t\t\t\t\tif (i !== l - 1) {\n\t\t\t\t\t\tnext = item.charAt(item.length - 1) === '\\n';\n\t\t\t\t\t\tif (!loose) loose = next;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.tokens.push({\n\t\t\t\t\t\ttype: loose\n\t\t\t\t\t\t? 'loose_item_start'\n\t\t\t\t\t\t: 'list_item_start'\n\t\t\t\t\t});\n\n\t\t\t\t\t// Recurse.\n\t\t\t\t\tthis.token(item, false, bq);\n\n\t\t\t\t\tthis.tokens.push({\n\t\t\t\t\t\ttype: 'list_item_end'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'list_end'\n\t\t\t\t});\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// html\n\t\t\tif (cap = this.rules.html.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: this.options.sanitize\n\t\t\t\t\t? 'paragraph'\n\t\t\t\t\t: 'html',\n\t\t\t\t\tpre: !this.options.sanitizer\n\t\t\t\t\t&& (cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style'),\n\t\t\t\t\ttext: cap[0]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// def\n\t\t\tif ((!bq && top) && (cap = this.rules.def.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.links[cap[1].toLowerCase()] = {\n\t\t\t\t\thref: cap[2],\n\t\t\t\t\ttitle: cap[3]\n\t\t\t\t};\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// table (gfm)\n\t\t\tif (top && (cap = this.rules.table.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\n\t\t\t\titem = {\n\t\t\t\t\ttype: 'table',\n\t\t\t\t\theader: cap[1].replace(/^ *| *\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\talign: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n\t\t\t\t\tcells: cap[3].replace(/(?: *\\| *)?\\n$/, '').split('\\n')\n\t\t\t\t};\n\n\t\t\t\tfor (i = 0; i < item.align.length; i++) {\n\t\t\t\t\tif (/^ *-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'right';\n\t\t\t\t\t} else if (/^ *:-+: *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'center';\n\t\t\t\t\t} else if (/^ *:-+ *$/.test(item.align[i])) {\n\t\t\t\t\t\titem.align[i] = 'left';\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.align[i] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < item.cells.length; i++) {\n\t\t\t\t\titem.cells[i] = item.cells[i]\n\t\t\t\t\t.replace(/^ *\\| *| *\\| *$/g, '')\n\t\t\t\t\t.split(/ *\\| */);\n\t\t\t\t}\n\n\t\t\t\tthis.tokens.push(item);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// top-level paragraph\n\t\t\tif (top && (cap = this.rules.paragraph.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'paragraph',\n\t\t\t\t\ttext: cap[1].charAt(cap[1].length - 1) === '\\n'\n\t\t\t\t\t? cap[1].slice(0, -1)\n\t\t\t\t\t: cap[1]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// text\n\t\t\tif (cap = this.rules.text.exec(src)) {\n\t\t\t\t// Top-level should never reach here.\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.tokens.push({\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\ttext: cap[0]\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (src) {\n\t\t\t\tthrow new\n\t\t\t\tError('Infinite loop on byte: ' + src.charCodeAt(0));\n\t\t\t}\n\t\t}\n\n\t\treturn this.tokens;\n\t};\n\n\t/**\n * Inline-Level Grammar\n */\n\n\tvar inline = {\n\t\tescape: /^\\\\([\\\\`*{}\\[\\]()#+\\-.!_>])/,\n\t\tautolink: /^<([^ >]+(@|:\\/)[^ >]+)>/,\n\t\turl: noop,\n\t\ttag: /^<!--[\\s\\S]*?-->|^<\\/?\\w+(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/,\n\t\tlink: /^!?\\[(inside)\\]\\(href\\)/,\n\t\treflink: /^!?\\[(inside)\\]\\s*\\[([^\\]]*)\\]/,\n\t\tnolink: /^!?\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\]/,\n\t\tstrong: /^__([\\s\\S]+?)__(?!_)|^\\*\\*([\\s\\S]+?)\\*\\*(?!\\*)/,\n\t\tem: /^\\b_((?:[^_]|__)+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,\n\t\tcode: /^(`+)\\s*([\\s\\S]*?[^`])\\s*\\1(?!`)/,\n\t\tbr: /^ {2,}\\n(?!\\s*$)/,\n\t\tdel: noop,\n\t\ttext: /^[\\s\\S]+?(?=[\\\\<!\\[_*`]| {2,}\\n|$)/\n\t};\n\n\tinline._inside = /(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*/;\n\tinline._href = /\\s*<?([\\s\\S]*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*/;\n\n\tinline.link = replace(inline.link)\n\t('inside', inline._inside)\n\t('href', inline._href)\n\t();\n\n\tinline.reflink = replace(inline.reflink)\n\t('inside', inline._inside)\n\t();\n\n\t/**\n * Normal Inline Grammar\n */\n\n\tinline.normal = merge({}, inline);\n\n\t/**\n * Pedantic Inline Grammar\n */\n\n\tinline.pedantic = merge({}, inline.normal, {\n\t\tstrong: /^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,\n\t\tem: /^_(?=\\S)([\\s\\S]*?\\S)_(?!_)|^\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)/\n\t});\n\n\t/**\n * GFM Inline Grammar\n */\n\n\tinline.gfm = merge({}, inline.normal, {\n\t\tescape: replace(inline.escape)('])', '~|])')(),\n\t\turl: /^(https?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])/,\n\t\tdel: /^~~(?=\\S)([\\s\\S]*?\\S)~~/,\n\t\ttext: replace(inline.text)\n\t\t(']|', '~]|')\n\t\t('|', '|https?://|')\n\t\t()\n\t});\n\n\t/**\n * GFM + Line Breaks Inline Grammar\n */\n\n\tinline.breaks = merge({}, inline.gfm, {\n\t\tbr: replace(inline.br)('{2,}', '*')(),\n\t\ttext: replace(inline.gfm.text)('{2,}', '*')()\n\t});\n\n\t/**\n * Inline Lexer & Compiler\n */\n\n\tfunction InlineLexer(links, options) {\n\t\tthis.options = options || marked.defaults;\n\t\tthis.links = links;\n\t\tthis.rules = inline.normal;\n\t\tthis.renderer = this.options.renderer || new Renderer;\n\t\tthis.renderer.options = this.options;\n\n\t\tif (!this.links) {\n\t\t\tthrow new\n\t\t\tError('Tokens array requires a `links` property.');\n\t\t}\n\n\t\tif (this.options.gfm) {\n\t\t\tif (this.options.breaks) {\n\t\t\t\tthis.rules = inline.breaks;\n\t\t\t} else {\n\t\t\t\tthis.rules = inline.gfm;\n\t\t\t}\n\t\t} else if (this.options.pedantic) {\n\t\t\tthis.rules = inline.pedantic;\n\t\t}\n\t}\n\n\t/**\n * Expose Inline Rules\n */\n\n\tInlineLexer.rules = inline;\n\n\t/**\n * Static Lexing/Compiling Method\n */\n\n\tInlineLexer.output = function(src, links, options) {\n\t\tvar inline = new InlineLexer(links, options);\n\t\treturn inline.output(src);\n\t};\n\n\t/**\n * Lexing/Compiling\n */\n\n\tInlineLexer.prototype.output = function(src) {\n\t\tvar out = ''\n\t\t, link\n\t\t, text\n\t\t, href\n\t\t, cap;\n\n\t\twhile (src) {\n\t\t\t// escape\n\t\t\tif (cap = this.rules.escape.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += cap[1];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// autolink\n\t\t\tif (cap = this.rules.autolink.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tif (cap[2] === '@') {\n\t\t\t\t\ttext = cap[1].charAt(6) === ':'\n\t\t\t\t\t? this.mangle(cap[1].substring(7))\n\t\t\t\t\t: this.mangle(cap[1]);\n\t\t\t\t\thref = this.mangle('mailto:') + text;\n\t\t\t\t} else {\n\t\t\t\t\ttext = escape(cap[1]);\n\t\t\t\t\thref = text;\n\t\t\t\t}\n\t\t\t\tout += this.renderer.link(href, null, text);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// url (gfm)\n\t\t\tif (!this.inLink && (cap = this.rules.url.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\ttext = escape(cap[1]);\n\t\t\t\thref = text;\n\t\t\t\tout += this.renderer.link(href, null, text);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// tag\n\t\t\tif (cap = this.rules.tag.exec(src)) {\n\t\t\t\tif (!this.inLink && /^<a /i.test(cap[0])) {\n\t\t\t\t\tthis.inLink = true;\n\t\t\t\t} else if (this.inLink && /^<\\/a>/i.test(cap[0])) {\n\t\t\t\t\tthis.inLink = false;\n\t\t\t\t}\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.options.sanitize\n\t\t\t\t? this.options.sanitizer\n\t\t\t\t? this.options.sanitizer(cap[0])\n\t\t\t\t: escape(cap[0])\n\t\t\t\t: cap[0]\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// link\n\t\t\tif (cap = this.rules.link.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tthis.inLink = true;\n\t\t\t\tout += this.outputLink(cap, {\n\t\t\t\t\thref: cap[2],\n\t\t\t\t\ttitle: cap[3]\n\t\t\t\t});\n\t\t\t\tthis.inLink = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// reflink, nolink\n\t\t\tif ((cap = this.rules.reflink.exec(src))\n\t\t\t\t\t|| (cap = this.rules.nolink.exec(src))) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tlink = (cap[2] || cap[1]).replace(/\\s+/g, ' ');\n\t\t\t\tlink = this.links[link.toLowerCase()];\n\t\t\t\tif (!link || !link.href) {\n\t\t\t\t\tout += cap[0].charAt(0);\n\t\t\t\t\tsrc = cap[0].substring(1) + src;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.inLink = true;\n\t\t\t\tout += this.outputLink(cap, link);\n\t\t\t\tthis.inLink = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// strong\n\t\t\tif (cap = this.rules.strong.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.strong(this.output(cap[2] || cap[1]));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// em\n\t\t\tif (cap = this.rules.em.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.em(this.output(cap[2] || cap[1]));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// code\n\t\t\tif (cap = this.rules.code.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.codespan(escape(cap[2], true));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// br\n\t\t\tif (cap = this.rules.br.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.br();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// del (gfm)\n\t\t\tif (cap = this.rules.del.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.del(this.output(cap[1]));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// text\n\t\t\tif (cap = this.rules.text.exec(src)) {\n\t\t\t\tsrc = src.substring(cap[0].length);\n\t\t\t\tout += this.renderer.text(escape(this.smartypants(cap[0])));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (src) {\n\t\t\t\tthrow new\n\t\t\t\tError('Infinite loop on byte: ' + src.charCodeAt(0));\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t};\n\n\t/**\n * Compile Link\n */\n\n\tInlineLexer.prototype.outputLink = function(cap, link) {\n\t\tvar href = escape(link.href)\n\t\t, title = link.title ? escape(link.title) : null;\n\n\t\treturn cap[0].charAt(0) !== '!'\n\t\t? this.renderer.link(href, title, this.output(cap[1]))\n\t\t: this.renderer.image(href, title, escape(cap[1]));\n\t};\n\n\t/**\n * Smartypants Transformations\n */\n\n\tInlineLexer.prototype.smartypants = function(text) {\n\t\tif (!this.options.smartypants) return text;\n\t\treturn text\n\t\t// em-dashes\n\t\t.replace(/---/g, '\\u2014')\n\t\t// en-dashes\n\t\t.replace(/--/g, '\\u2013')\n\t\t// opening singles\n\t\t.replace(/(^|[-\\u2014/(\\[{\"\\s])'/g, '$1\\u2018')\n\t\t// closing singles & apostrophes\n\t\t.replace(/'/g, '\\u2019')\n\t\t// opening doubles\n\t\t.replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g, '$1\\u201c')\n\t\t// closing doubles\n\t\t.replace(/\"/g, '\\u201d')\n\t\t// ellipses\n\t\t.replace(/\\.{3}/g, '\\u2026');\n\t};\n\n\t/**\n * Mangle Links\n */\n\n\tInlineLexer.prototype.mangle = function(text) {\n\t\tif (!this.options.mangle) return text;\n\t\tvar out = ''\n\t\t, l = text.length\n\t\t, i = 0\n\t\t, ch;\n\n\t\tfor (; i < l; i++) {\n\t\t\tch = text.charCodeAt(i);\n\t\t\tif (Math.random() > 0.5) {\n\t\t\t\tch = 'x' + ch.toString(16);\n\t\t\t}\n\t\t\tout += '&#' + ch + ';';\n\t\t}\n\n\t\treturn out;\n\t};\n\n\t/**\n * Renderer\n */\n\n\tfunction Renderer(options) {\n\t\tthis.options = options || {};\n\t}\n\n\tRenderer.prototype.code = function(code, lang, escaped) {\n\t\tif (this.options.highlight) {\n\t\t\tvar out = this.options.highlight(code, lang);\n\t\t\tif (out != null && out !== code) {\n\t\t\t\tescaped = true;\n\t\t\t\tcode = out;\n\t\t\t}\n\t\t}\n\n\t\tif (!lang) {\n\t\t\treturn '<pre><code>'\n\t\t\t+ (escaped ? code : escape(code, true))\n\t\t\t+ '\\n</code></pre>';\n\t\t}\n\n\t\treturn '<pre><code class=\"'\n\t\t+ this.options.langPrefix\n\t\t+ escape(lang, true)\n\t\t+ '\">'\n\t\t+ (escaped ? code : escape(code, true))\n\t\t+ '\\n</code></pre>\\n';\n\t};\n\n\tRenderer.prototype.blockquote = function(quote) {\n\t\treturn '<blockquote>\\n' + quote + '</blockquote>\\n';\n\t};\n\n\tRenderer.prototype.html = function(html) {\n\t\treturn html;\n\t};\n\n\tRenderer.prototype.heading = function(text, level, raw) {\n\t\treturn '<h'\n\t\t+ level\n\t\t+ ' id=\"'\n\t\t+ this.options.headerPrefix\n\t\t+ raw.toLowerCase().replace(/[^\\w]+/g, '-')\n\t\t+ '\">'\n\t\t+ text\n\t\t+ '</h'\n\t\t+ level\n\t\t+ '>\\n';\n\t};\n\n\tRenderer.prototype.hr = function() {\n\t\treturn this.options.xhtml ? '<hr/>\\n' : '<hr>\\n';\n\t};\n\n\tRenderer.prototype.list = function(body, ordered) {\n\t\tvar type = ordered ? 'ol' : 'ul';\n\t\treturn '<' + type + '>\\n' + body + '</' + type + '>\\n';\n\t};\n\n\tRenderer.prototype.listitem = function(text) {\n\t\treturn '<li>' + text + '</li>\\n';\n\t};\n\n\tRenderer.prototype.paragraph = function(text) {\n\t\treturn '<p>' + text + '</p>\\n';\n\t};\n\n\tRenderer.prototype.table = function(header, body) {\n\t\treturn '<table>\\n'\n\t\t+ '<thead>\\n'\n\t\t+ header\n\t\t+ '</thead>\\n'\n\t\t+ '<tbody>\\n'\n\t\t+ body\n\t\t+ '</tbody>\\n'\n\t\t+ '</table>\\n';\n\t};\n\n\tRenderer.prototype.tablerow = function(content) {\n\t\treturn '<tr>\\n' + content + '</tr>\\n';\n\t};\n\n\tRenderer.prototype.tablecell = function(content, flags) {\n\t\tvar type = flags.header ? 'th' : 'td';\n\t\tvar tag = flags.align\n\t\t? '<' + type + ' style=\"text-align:' + flags.align + '\">'\n\t\t: '<' + type + '>';\n\t\treturn tag + content + '</' + type + '>\\n';\n\t};\n\n\t// span level renderer\n\tRenderer.prototype.strong = function(text) {\n\t\treturn '<strong>' + text + '</strong>';\n\t};\n\n\tRenderer.prototype.em = function(text) {\n\t\treturn '<em>' + text + '</em>';\n\t};\n\n\tRenderer.prototype.codespan = function(text) {\n\t\treturn '<code>' + text + '</code>';\n\t};\n\n\tRenderer.prototype.br = function() {\n\t\treturn this.options.xhtml ? '<br/>' : '<br>';\n\t};\n\n\tRenderer.prototype.del = function(text) {\n\t\treturn '<del>' + text + '</del>';\n\t};\n\n\tRenderer.prototype.link = function(href, title, text) {\n\t\tif (this.options.sanitize) {\n\t\t\ttry {\n\t\t\t\tvar prot = decodeURIComponent(unescape(href))\n\t\t\t\t.replace(/[^\\w:]/g, '')\n\t\t\t\t.toLowerCase();\n\t\t\t} catch (e) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tif (prot.indexOf('javascript:') === 0 || prot.indexOf('vbscript:') === 0) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\t\tvar out = '<a href=\"' + href + '\"';\n\t\tif (title) {\n\t\t\tout += ' title=\"' + title + '\"';\n\t\t}\n\t\tout += '>' + text + '</a>';\n\t\treturn out;\n\t};\n\n\tRenderer.prototype.image = function(href, title, text) {\n\t\tvar out = '<img src=\"' + href + '\" alt=\"' + text + '\"';\n\t\tif (title) {\n\t\t\tout += ' title=\"' + title + '\"';\n\t\t}\n\t\tout += this.options.xhtml ? '/>' : '>';\n\t\treturn out;\n\t};\n\n\tRenderer.prototype.text = function(text) {\n\t\treturn text;\n\t};\n\n\t/**\n * Parsing & Compiling\n */\n\n\tfunction Parser(options) {\n\t\tthis.tokens = [];\n\t\tthis.token = null;\n\t\tthis.options = options || marked.defaults;\n\t\tthis.options.renderer = this.options.renderer || new Renderer;\n\t\tthis.renderer = this.options.renderer;\n\t\tthis.renderer.options = this.options;\n\t}\n\n\t/**\n * Static Parse Method\n */\n\n\tParser.parse = function(src, options, renderer) {\n\t\tvar parser = new Parser(options, renderer);\n\t\treturn parser.parse(src);\n\t};\n\n\t/**\n * Parse Loop\n */\n\n\tParser.prototype.parse = function(src) {\n\t\tthis.inline = new InlineLexer(src.links, this.options, this.renderer);\n\t\tthis.tokens = src.reverse();\n\n\t\tvar out = '';\n\t\twhile (this.next()) {\n\t\t\tout += this.tok();\n\t\t}\n\n\t\treturn out;\n\t};\n\n\t/**\n * Next Token\n */\n\n\tParser.prototype.next = function() {\n\t\treturn this.token = this.tokens.pop();\n\t};\n\n\t/**\n * Preview Next Token\n */\n\n\tParser.prototype.peek = function() {\n\t\treturn this.tokens[this.tokens.length - 1] || 0;\n\t};\n\n\t/**\n * Parse Text Tokens\n */\n\n\tParser.prototype.parseText = function() {\n\t\tvar body = this.token.text;\n\n\t\twhile (this.peek().type === 'text') {\n\t\t\tbody += '\\n' + this.next().text;\n\t\t}\n\n\t\treturn this.inline.output(body);\n\t};\n\n\t/**\n * Parse Current Token\n */\n\n\tParser.prototype.tok = function() {\n\t\tswitch (this.token.type) {\n\t\t\tcase 'space': {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tcase 'hr': {\n\t\t\t\treturn this.renderer.hr();\n\t\t\t}\n\t\t\tcase 'heading': {\n\t\t\t\treturn this.renderer.heading(\n\t\t\t\t\tthis.inline.output(this.token.text),\n\t\t\t\t\tthis.token.depth,\n\t\t\t\t\tthis.token.text);\n\t\t\t}\n\t\t\tcase 'code': {\n\t\t\t\treturn this.renderer.code(this.token.text,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.token.lang,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.token.escaped);\n\t\t\t}\n\t\t\tcase 'table': {\n\t\t\t\tvar header = ''\n\t\t\t\t, body = ''\n\t\t\t\t, i\n\t\t\t\t, row\n\t\t\t\t, cell\n\t\t\t\t, flags\n\t\t\t\t, j;\n\n\t\t\t\t// header\n\t\t\t\tcell = '';\n\t\t\t\tfor (i = 0; i < this.token.header.length; i++) {\n\t\t\t\t\tflags = { header: true, align: this.token.align[i] };\n\t\t\t\t\tcell += this.renderer.tablecell(\n\t\t\t\t\t\tthis.inline.output(this.token.header[i]),\n\t\t\t\t\t\t{ header: true, align: this.token.align[i] }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\theader += this.renderer.tablerow(cell);\n\n\t\t\t\tfor (i = 0; i < this.token.cells.length; i++) {\n\t\t\t\t\trow = this.token.cells[i];\n\n\t\t\t\t\tcell = '';\n\t\t\t\t\tfor (j = 0; j < row.length; j++) {\n\t\t\t\t\t\tcell += this.renderer.tablecell(\n\t\t\t\t\t\t\tthis.inline.output(row[j]),\n\t\t\t\t\t\t\t{ header: false, align: this.token.align[j] }\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tbody += this.renderer.tablerow(cell);\n\t\t\t\t}\n\t\t\t\treturn this.renderer.table(header, body);\n\t\t\t}\n\t\t\tcase 'blockquote_start': {\n\t\t\t\tvar body = '';\n\n\t\t\t\twhile (this.next().type !== 'blockquote_end') {\n\t\t\t\t\tbody += this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.blockquote(body);\n\t\t\t}\n\t\t\tcase 'list_start': {\n\t\t\t\tvar body = ''\n\t\t\t\t, ordered = this.token.ordered;\n\n\t\t\t\twhile (this.next().type !== 'list_end') {\n\t\t\t\t\tbody += this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.list(body, ordered);\n\t\t\t}\n\t\t\tcase 'list_item_start': {\n\t\t\t\tvar body = '';\n\n\t\t\t\twhile (this.next().type !== 'list_item_end') {\n\t\t\t\t\tbody += this.token.type === 'text'\n\t\t\t\t\t? this.parseText()\n\t\t\t\t\t: this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.listitem(body);\n\t\t\t}\n\t\t\tcase 'loose_item_start': {\n\t\t\t\tvar body = '';\n\n\t\t\t\twhile (this.next().type !== 'list_item_end') {\n\t\t\t\t\tbody += this.tok();\n\t\t\t\t}\n\n\t\t\t\treturn this.renderer.listitem(body);\n\t\t\t}\n\t\t\tcase 'html': {\n\t\t\t\tvar html = !this.token.pre && !this.options.pedantic\n\t\t\t\t? this.inline.output(this.token.text)\n\t\t\t\t: this.token.text;\n\t\t\t\treturn this.renderer.html(html);\n\t\t\t}\n\t\t\tcase 'paragraph': {\n\t\t\t\treturn this.renderer.paragraph(this.inline.output(this.token.text));\n\t\t\t}\n\t\t\tcase 'text': {\n\t\t\t\treturn this.renderer.paragraph(this.parseText());\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n * Helpers\n */\n\n\tfunction escape(html, encode) {\n\t\treturn html\n\t\t.replace(!encode ? /&(?!#?\\w+;)/g : /&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/\"/g, '&quot;')\n\t\t.replace(/'/g, '&#39;');\n\t}\n\n\tfunction unescape(html) {\n\t\treturn html.replace(/&([#\\w]+);/g, function(_, n) {\n\t\t\tn = n.toLowerCase();\n\t\t\tif (n === 'colon') return ':';\n\t\t\tif (n.charAt(0) === '#') {\n\t\t\t\treturn n.charAt(1) === 'x'\n\t\t\t\t? String.fromCharCode(parseInt(n.substring(2), 16))\n\t\t\t\t: String.fromCharCode(+n.substring(1));\n\t\t\t}\n\t\t\treturn '';\n\t\t});\n\t}\n\n\tfunction replace(regex, opt) {\n\t\tregex = regex.source;\n\t\topt = opt || '';\n\t\treturn function self(name, val) {\n\t\t\tif (!name) return new RegExp(regex, opt);\n\t\t\tval = val.source || val;\n\t\t\tval = val.replace(/(^|[^\\[])\\^/g, '$1');\n\t\t\tregex = regex.replace(name, val);\n\t\t\treturn self;\n\t\t};\n\t}\n\n\tfunction noop() {}\n\tnoop.exec = noop;\n\n\tfunction merge(obj) {\n\t\tvar i = 1\n\t\t, target\n\t\t, key;\n\n\t\tfor (; i < arguments.length; i++) {\n\t\t\ttarget = arguments[i];\n\t\t\tfor (key in target) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\t\t\tobj[key] = target[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\n\t/**\n * Marked\n */\n\n\tfunction marked(src, opt, callback) {\n\t\tif (callback || typeof opt === 'function') {\n\t\t\tif (!callback) {\n\t\t\t\tcallback = opt;\n\t\t\t\topt = null;\n\t\t\t}\n\n\t\t\topt = merge({}, marked.defaults, opt || {});\n\n\t\t\tvar highlight = opt.highlight\n\t\t\t, tokens\n\t\t\t, pending\n\t\t\t, i = 0;\n\n\t\t\ttry {\n\t\t\t\ttokens = Lexer.lex(src, opt)\n\t\t\t} catch (e) {\n\t\t\t\treturn callback(e);\n\t\t\t}\n\n\t\t\tpending = tokens.length;\n\n\t\t\tvar done = function(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\topt.highlight = highlight;\n\t\t\t\t\treturn callback(err);\n\t\t\t\t}\n\n\t\t\t\tvar out;\n\n\t\t\t\ttry {\n\t\t\t\t\tout = Parser.parse(tokens, opt);\n\t\t\t\t} catch (e) {\n\t\t\t\t\terr = e;\n\t\t\t\t}\n\n\t\t\t\topt.highlight = highlight;\n\n\t\t\t\treturn err\n\t\t\t\t? callback(err)\n\t\t\t\t: callback(null, out);\n\t\t\t};\n\n\t\t\tif (!highlight || highlight.length < 3) {\n\t\t\t\treturn done();\n\t\t\t}\n\n\t\t\tdelete opt.highlight;\n\n\t\t\tif (!pending) return done();\n\n\t\t\tfor (; i < tokens.length; i++) {\n\t\t\t\t(function(token) {\n\t\t\t\t\tif (token.type !== 'code') {\n\t\t\t\t\t\treturn --pending || done();\n\t\t\t\t\t}\n\t\t\t\t\treturn highlight(token.text, token.lang, function(err, code) {\n\t\t\t\t\t\tif (err) return done(err);\n\t\t\t\t\t\tif (code == null || code === token.text) {\n\t\t\t\t\t\t\treturn --pending || done();\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttoken.text = code;\n\t\t\t\t\t\ttoken.escaped = true;\n\t\t\t\t\t\t--pending || done();\n\t\t\t\t\t});\n\t\t\t\t})(tokens[i]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tif (opt) opt = merge({}, marked.defaults, opt);\n\t\t\treturn Parser.parse(Lexer.lex(src, opt), opt);\n\t\t} catch (e) {\n\t\t\te.message += '\\nPlease report this to https://github.com/chjj/marked.';\n\t\t\tif ((opt || marked.defaults).silent) {\n\t\t\t\treturn '<p>An error occured:</p><pre>'\n\t\t\t\t+ escape(e.message + '', true)\n\t\t\t\t+ '</pre>';\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\t/**\n * Options\n */\n\n\tmarked.options =\n\t\tmarked.setOptions = function(opt) {\n\t\tmerge(marked.defaults, opt);\n\t\treturn marked;\n\t};\n\n\tmarked.defaults = {\n\t\tgfm: true,\n\t\ttables: true,\n\t\tbreaks: false,\n\t\tpedantic: false,\n\t\tsanitize: false,\n\t\tsanitizer: null,\n\t\tmangle: true,\n\t\tsmartLists: false,\n\t\tsilent: false,\n\t\thighlight: null,\n\t\tlangPrefix: 'lang-',\n\t\tsmartypants: false,\n\t\theaderPrefix: '',\n\t\trenderer: new Renderer,\n\t\txhtml: false\n\t};\n\n\t/**\n * Expose\n */\n\n\tmarked.Parser = Parser;\n\tmarked.parser = Parser.parse;\n\n\tmarked.Renderer = Renderer;\n\n\tmarked.Lexer = Lexer;\n\tmarked.lexer = Lexer.lex;\n\n\tmarked.InlineLexer = InlineLexer;\n\tmarked.inlineLexer = InlineLexer.output;\n\n\tmarked.parse = marked;\n\n\tglobal.marked = marked;\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1457989583195","id": ".Erlang","type": "js","data": "(function(global) {\n\n\tvar CodeMirror = global.CodeMirror;\n\n\tCodeMirror.defineMIME(\"text/x-erlang\", \"erlang\");\n\n\tCodeMirror.defineMode(\"erlang\", function(cmCfg) {\n\t\t\"use strict\";\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// constants\n\n\t\tvar typeWords = [\n\t\t\t\"-type\", \"-spec\", \"-export_type\", \"-opaque\"\n\t\t];\n\n\t\tvar keywordWords = [\n\t\t\t\"after\", \"begin\", \"catch\", \"case\", \"cond\", \"end\", \"fun\", \"if\",\n\t\t\t\"let\", \"of\", \"query\", \"receive\", \"try\", \"when\"\n\t\t];\n\n\t\tvar separatorRE = /[\\->,;]/;\n\t\tvar separatorWords = [\n\t\t\t\"->\", \";\", \",\"\n\t\t];\n\n\t\tvar operatorAtomWords = [\n\t\t\t\"and\", \"andalso\", \"band\", \"bnot\", \"bor\", \"bsl\", \"bsr\", \"bxor\",\n\t\t\t\"div\", \"not\", \"or\", \"orelse\", \"rem\", \"xor\"\n\t\t];\n\n\t\tvar operatorSymbolRE = /[\\+\\-\\*\\/<>=\\|:!]/;\n\t\tvar operatorSymbolWords = [\n\t\t\t\"=\", \"+\", \"-\", \"*\", \"/\", \">\", \">=\", \"<\", \"=<\", \"=:=\", \"==\", \"=/=\", \"/=\", \"||\", \"<-\", \"!\"\n\t\t];\n\n\t\tvar openParenRE = /[<\\(\\[\\{]/;\n\t\tvar openParenWords = [\n\t\t\t\"<<\", \"(\", \"[\", \"{\"\n\t\t];\n\n\t\tvar closeParenRE = /[>\\)\\]\\}]/;\n\t\tvar closeParenWords = [\n\t\t\t\"}\", \"]\", \")\", \">>\"\n\t\t];\n\n\t\tvar guardWords = [\n\t\t\t\"is_atom\", \"is_binary\", \"is_bitstring\", \"is_boolean\", \"is_float\",\n\t\t\t\"is_function\", \"is_integer\", \"is_list\", \"is_number\", \"is_pid\",\n\t\t\t\"is_port\", \"is_record\", \"is_reference\", \"is_tuple\",\n\t\t\t\"atom\", \"binary\", \"bitstring\", \"boolean\", \"function\", \"integer\", \"list\",\n\t\t\t\"number\", \"pid\", \"port\", \"record\", \"reference\", \"tuple\"\n\t\t];\n\n\t\tvar bifWords = [\n\t\t\t\"abs\", \"adler32\", \"adler32_combine\", \"alive\", \"apply\", \"atom_to_binary\",\n\t\t\t\"atom_to_list\", \"binary_to_atom\", \"binary_to_existing_atom\",\n\t\t\t\"binary_to_list\", \"binary_to_term\", \"bit_size\", \"bitstring_to_list\",\n\t\t\t\"byte_size\", \"check_process_code\", \"contact_binary\", \"crc32\",\n\t\t\t\"crc32_combine\", \"date\", \"decode_packet\", \"delete_module\",\n\t\t\t\"disconnect_node\", \"element\", \"erase\", \"exit\", \"float\", \"float_to_list\",\n\t\t\t\"garbage_collect\", \"get\", \"get_keys\", \"group_leader\", \"halt\", \"hd\",\n\t\t\t\"integer_to_list\", \"internal_bif\", \"iolist_size\", \"iolist_to_binary\",\n\t\t\t\"is_alive\", \"is_atom\", \"is_binary\", \"is_bitstring\", \"is_boolean\",\n\t\t\t\"is_float\", \"is_function\", \"is_integer\", \"is_list\", \"is_number\", \"is_pid\",\n\t\t\t\"is_port\", \"is_process_alive\", \"is_record\", \"is_reference\", \"is_tuple\",\n\t\t\t\"length\", \"link\", \"list_to_atom\", \"list_to_binary\", \"list_to_bitstring\",\n\t\t\t\"list_to_existing_atom\", \"list_to_float\", \"list_to_integer\",\n\t\t\t\"list_to_pid\", \"list_to_tuple\", \"load_module\", \"make_ref\", \"module_loaded\",\n\t\t\t\"monitor_node\", \"node\", \"node_link\", \"node_unlink\", \"nodes\", \"notalive\",\n\t\t\t\"now\", \"open_port\", \"pid_to_list\", \"port_close\", \"port_command\",\n\t\t\t\"port_connect\", \"port_control\", \"pre_loaded\", \"process_flag\",\n\t\t\t\"process_info\", \"processes\", \"purge_module\", \"put\", \"register\",\n\t\t\t\"registered\", \"round\", \"self\", \"setelement\", \"size\", \"spawn\", \"spawn_link\",\n\t\t\t\"spawn_monitor\", \"spawn_opt\", \"split_binary\", \"statistics\",\n\t\t\t\"term_to_binary\", \"time\", \"throw\", \"tl\", \"trunc\", \"tuple_size\",\n\t\t\t\"tuple_to_list\", \"unlink\", \"unregister\", \"whereis\"\n\t\t];\n\n\t\t// upper case: [A-Z] [Ø-Þ] [À-Ö]\n\t\t// lower case: [a-z] [ß-ö] [ø-ÿ]\n\t\tvar anumRE = /[\\w@Ø-ÞÀ-Öß-öø-ÿ]/;\n\t\tvar escapesRE =\n\t\t\t\t/[0-7]{1,3}|[bdefnrstv\\\\\"']|\\^[a-zA-Z]|x[0-9a-zA-Z]{2}|x{[0-9a-zA-Z]+}/;\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// tokenizer\n\n\t\tfunction tokenizer(stream, state) {\n\t\t\t// in multi-line string\n\t\t\tif (state.in_string) {\n\t\t\t\tstate.in_string = (!doubleQuote(stream));\n\t\t\t\treturn rval(state, stream, \"string\");\n\t\t\t}\n\n\t\t\t// in multi-line atom\n\t\t\tif (state.in_atom) {\n\t\t\t\tstate.in_atom = (!singleQuote(stream));\n\t\t\t\treturn rval(state, stream, \"atom\");\n\t\t\t}\n\n\t\t\t// whitespace\n\t\t\tif (stream.eatSpace()) {\n\t\t\t\treturn rval(state, stream, \"whitespace\");\n\t\t\t}\n\n\t\t\t// attributes and type specs\n\t\t\tif (!peekToken(state) &&\n\t\t\t\t\tstream.match(/-\\s*[a-zß-öø-ÿ][\\wØ-ÞÀ-Öß-öø-ÿ]*/)) {\n\t\t\t\tif (is_member(stream.current(), typeWords)) {\n\t\t\t\t\treturn rval(state, stream, \"type\");\n\t\t\t\t} else {\n\t\t\t\t\treturn rval(state, stream, \"attribute\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar ch = stream.next();\n\n\t\t\t// comment\n\t\t\tif (ch == '%') {\n\t\t\t\tstream.skipToEnd();\n\t\t\t\treturn rval(state, stream, \"comment\");\n\t\t\t}\n\n\t\t\t// colon\n\t\t\tif (ch == \":\") {\n\t\t\t\treturn rval(state, stream, \"colon\");\n\t\t\t}\n\n\t\t\t// macro\n\t\t\tif (ch == '?') {\n\t\t\t\tstream.eatSpace();\n\t\t\t\tstream.eatWhile(anumRE);\n\t\t\t\treturn rval(state, stream, \"macro\");\n\t\t\t}\n\n\t\t\t// record\n\t\t\tif (ch == \"#\") {\n\t\t\t\tstream.eatSpace();\n\t\t\t\tstream.eatWhile(anumRE);\n\t\t\t\treturn rval(state, stream, \"record\");\n\t\t\t}\n\n\t\t\t// dollar escape\n\t\t\tif (ch == \"$\") {\n\t\t\t\tif (stream.next() == \"\\\\\" && !stream.match(escapesRE)) {\n\t\t\t\t\treturn rval(state, stream, \"error\");\n\t\t\t\t}\n\t\t\t\treturn rval(state, stream, \"number\");\n\t\t\t}\n\n\t\t\t// dot\n\t\t\tif (ch == \".\") {\n\t\t\t\treturn rval(state, stream, \"dot\");\n\t\t\t}\n\n\t\t\t// quoted atom\n\t\t\tif (ch == '\\'') {\n\t\t\t\tif (!(state.in_atom = (!singleQuote(stream)))) {\n\t\t\t\t\tif (stream.match(/\\s*\\/\\s*[0-9]/, false)) {\n\t\t\t\t\t\tstream.match(/\\s*\\/\\s*[0-9]/, true);\n\t\t\t\t\t\treturn rval(state, stream, \"fun\"); // 'f'/0 style fun\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.match(/\\s*\\(/, false) || stream.match(/\\s*:/, false)) {\n\t\t\t\t\t\treturn rval(state, stream, \"function\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rval(state, stream, \"atom\");\n\t\t\t}\n\n\t\t\t// string\n\t\t\tif (ch == '\"') {\n\t\t\t\tstate.in_string = (!doubleQuote(stream));\n\t\t\t\treturn rval(state, stream, \"string\");\n\t\t\t}\n\n\t\t\t// variable\n\t\t\tif (/[A-Z_Ø-ÞÀ-Ö]/.test(ch)) {\n\t\t\t\tstream.eatWhile(anumRE);\n\t\t\t\treturn rval(state, stream, \"variable\");\n\t\t\t}\n\n\t\t\t// atom/keyword/BIF/function\n\t\t\tif (/[a-z_ß-öø-ÿ]/.test(ch)) {\n\t\t\t\tstream.eatWhile(anumRE);\n\n\t\t\t\tif (stream.match(/\\s*\\/\\s*[0-9]/, false)) {\n\t\t\t\t\tstream.match(/\\s*\\/\\s*[0-9]/, true);\n\t\t\t\t\treturn rval(state, stream, \"fun\"); // f/0 style fun\n\t\t\t\t}\n\n\t\t\t\tvar w = stream.current();\n\n\t\t\t\tif (is_member(w, keywordWords)) {\n\t\t\t\t\treturn rval(state, stream, \"keyword\");\n\t\t\t\t} else if (is_member(w, operatorAtomWords)) {\n\t\t\t\t\treturn rval(state, stream, \"operator\");\n\t\t\t\t} else if (stream.match(/\\s*\\(/, false)) {\n\t\t\t\t\t// 'put' and 'erlang:put' are bifs, 'foo:put' is not\n\t\t\t\t\tif (is_member(w, bifWords) &&\n\t\t\t\t\t\t\t((peekToken(state).token != \":\") ||\n\t\t\t\t\t\t\t (peekToken(state, 2).token == \"erlang\"))) {\n\t\t\t\t\t\treturn rval(state, stream, \"builtin\");\n\t\t\t\t\t} else if (is_member(w, guardWords)) {\n\t\t\t\t\t\treturn rval(state, stream, \"guard\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn rval(state, stream, \"function\");\n\t\t\t\t\t}\n\t\t\t\t} else if (lookahead(stream) == \":\") {\n\t\t\t\t\tif (w == \"erlang\") {\n\t\t\t\t\t\treturn rval(state, stream, \"builtin\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn rval(state, stream, \"function\");\n\t\t\t\t\t}\n\t\t\t\t} else if (is_member(w, [\"true\", \"false\"])) {\n\t\t\t\t\treturn rval(state, stream, \"boolean\");\n\t\t\t\t} else {\n\t\t\t\t\treturn rval(state, stream, \"atom\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// number\n\t\t\tvar digitRE = /[0-9]/;\n\t\t\tvar radixRE = /[0-9a-zA-Z]/; // 36#zZ style int\n\t\t\tif (digitRE.test(ch)) {\n\t\t\t\tstream.eatWhile(digitRE);\n\t\t\t\tif (stream.eat('#')) { // 36#aZ  style integer\n\t\t\t\t\tif (!stream.eatWhile(radixRE)) {\n\t\t\t\t\t\tstream.backUp(1); //\"36#\" - syntax error\n\t\t\t\t\t}\n\t\t\t\t} else if (stream.eat('.')) { // float\n\t\t\t\t\tif (!stream.eatWhile(digitRE)) {\n\t\t\t\t\t\tstream.backUp(1); // \"3.\" - probably end of function\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (stream.eat(/[eE]/)) { // float with exponent\n\t\t\t\t\t\t\tif (stream.eat(/[-+]/)) {\n\t\t\t\t\t\t\t\tif (!stream.eatWhile(digitRE)) {\n\t\t\t\t\t\t\t\t\tstream.backUp(2); // \"2e-\" - syntax error\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (!stream.eatWhile(digitRE)) {\n\t\t\t\t\t\t\t\t\tstream.backUp(1); // \"2e\" - syntax error\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rval(state, stream, \"number\"); // normal integer\n\t\t\t}\n\n\t\t\t// open parens\n\t\t\tif (nongreedy(stream, openParenRE, openParenWords)) {\n\t\t\t\treturn rval(state, stream, \"open_paren\");\n\t\t\t}\n\n\t\t\t// close parens\n\t\t\tif (nongreedy(stream, closeParenRE, closeParenWords)) {\n\t\t\t\treturn rval(state, stream, \"close_paren\");\n\t\t\t}\n\n\t\t\t// separators\n\t\t\tif (greedy(stream, separatorRE, separatorWords)) {\n\t\t\t\treturn rval(state, stream, \"separator\");\n\t\t\t}\n\n\t\t\t// operators\n\t\t\tif (greedy(stream, operatorSymbolRE, operatorSymbolWords)) {\n\t\t\t\treturn rval(state, stream, \"operator\");\n\t\t\t}\n\n\t\t\treturn rval(state, stream, null);\n\t\t}\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// utilities\n\n\t\tfunction nongreedy(stream, re, words) {\n\t\t\tif (stream.current().length == 1 && re.test(stream.current())) {\n\t\t\t\tstream.backUp(1);\n\t\t\t\twhile (re.test(stream.peek())) {\n\t\t\t\t\tstream.next();\n\t\t\t\t\tif (is_member(stream.current(), words)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstream.backUp(stream.current().length - 1);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction greedy(stream, re, words) {\n\t\t\tif (stream.current().length == 1 && re.test(stream.current())) {\n\t\t\t\twhile (re.test(stream.peek())) {\n\t\t\t\t\tstream.next();\n\t\t\t\t}\n\t\t\t\twhile (0 < stream.current().length) {\n\t\t\t\t\tif (is_member(stream.current(), words)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.backUp(1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstream.next();\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction doubleQuote(stream) {\n\t\t\treturn quote(stream, '\"', '\\\\');\n\t\t}\n\n\t\tfunction singleQuote(stream) {\n\t\t\treturn quote(stream, '\\'', '\\\\');\n\t\t}\n\n\t\tfunction quote(stream, quoteChar, escapeChar) {\n\t\t\twhile (!stream.eol()) {\n\t\t\t\tvar ch = stream.next();\n\t\t\t\tif (ch == quoteChar) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (ch == escapeChar) {\n\t\t\t\t\tstream.next();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction lookahead(stream) {\n\t\t\tvar m = stream.match(/([\\n\\s]+|%[^\\n]*\\n)*(.)/, false);\n\t\t\treturn m ? m.pop() : \"\";\n\t\t}\n\n\t\tfunction is_member(element, list) {\n\t\t\treturn (-1 < list.indexOf(element));\n\t\t}\n\n\t\tfunction rval(state, stream, type) {\n\n\t\t\t// parse stack\n\t\t\tpushToken(state, realToken(type, stream));\n\n\t\t\t// map erlang token type to CodeMirror style class\n\t\t\t//     erlang             -> CodeMirror tag\n\t\t\tswitch (type) {\n\t\t\t\tcase \"atom\":\n\t\t\t\t\treturn \"atom\";\n\t\t\t\tcase \"attribute\":\n\t\t\t\t\treturn \"attribute\";\n\t\t\t\tcase \"boolean\":\n\t\t\t\t\treturn \"atom\";\n\t\t\t\tcase \"builtin\":\n\t\t\t\t\treturn \"builtin\";\n\t\t\t\tcase \"close_paren\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"colon\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"comment\":\n\t\t\t\t\treturn \"comment\";\n\t\t\t\tcase \"dot\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"error\":\n\t\t\t\t\treturn \"error\";\n\t\t\t\tcase \"fun\":\n\t\t\t\t\treturn \"meta\";\n\t\t\t\tcase \"function\":\n\t\t\t\t\treturn \"tag\";\n\t\t\t\tcase \"guard\":\n\t\t\t\t\treturn \"property\";\n\t\t\t\tcase \"keyword\":\n\t\t\t\t\treturn \"keyword\";\n\t\t\t\tcase \"macro\":\n\t\t\t\t\treturn \"variable-2\";\n\t\t\t\tcase \"number\":\n\t\t\t\t\treturn \"number\";\n\t\t\t\tcase \"open_paren\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"operator\":\n\t\t\t\t\treturn \"operator\";\n\t\t\t\tcase \"record\":\n\t\t\t\t\treturn \"bracket\";\n\t\t\t\tcase \"separator\":\n\t\t\t\t\treturn null;\n\t\t\t\tcase \"string\":\n\t\t\t\t\treturn \"string\";\n\t\t\t\tcase \"type\":\n\t\t\t\t\treturn \"def\";\n\t\t\t\tcase \"variable\":\n\t\t\t\t\treturn \"variable\";\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction aToken(tok, col, ind, typ) {\n\t\t\treturn {\n\t\t\t\ttoken: tok,\n\t\t\t\tcolumn: col,\n\t\t\t\tindent: ind,\n\t\t\t\ttype: typ\n\t\t\t};\n\t\t}\n\n\t\tfunction realToken(type, stream) {\n\t\t\treturn aToken(stream.current(),\n\t\t\t\t\t\t\t\t\t\tstream.column(),\n\t\t\t\t\t\t\t\t\t\tstream.indentation(),\n\t\t\t\t\t\t\t\t\t\ttype);\n\t\t}\n\n\t\tfunction fakeToken(type) {\n\t\t\treturn aToken(type, 0, 0, type);\n\t\t}\n\n\t\tfunction peekToken(state, depth) {\n\t\t\tvar len = state.tokenStack.length;\n\t\t\tvar dep = (depth ? depth : 1);\n\n\t\t\tif (len < dep) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn state.tokenStack[len - dep];\n\t\t\t}\n\t\t}\n\n\t\tfunction pushToken(state, token) {\n\n\t\t\tif (!(token.type == \"comment\" || token.type == \"whitespace\")) {\n\t\t\t\tstate.tokenStack = maybe_drop_pre(state.tokenStack, token);\n\t\t\t\tstate.tokenStack = maybe_drop_post(state.tokenStack);\n\t\t\t}\n\t\t}\n\n\t\tfunction maybe_drop_pre(s, token) {\n\t\t\tvar last = s.length - 1;\n\n\t\t\tif (0 < last && s[last].type === \"record\" && token.type === \"dot\") {\n\t\t\t\ts.pop();\n\t\t\t} else if (0 < last && s[last].type === \"group\") {\n\t\t\t\ts.pop();\n\t\t\t\ts.push(token);\n\t\t\t} else {\n\t\t\t\ts.push(token);\n\t\t\t}\n\t\t\treturn s;\n\t\t}\n\n\t\tfunction maybe_drop_post(s) {\n\t\t\tvar last = s.length - 1;\n\n\t\t\tif (s[last].type === \"dot\") {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tif (s[last].type === \"fun\" && s[last - 1].token === \"fun\") {\n\t\t\t\treturn s.slice(0, last - 1);\n\t\t\t}\n\t\t\tswitch (s[s.length - 1].token) {\n\t\t\t\tcase \"}\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\tg: [\"{\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"]\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"[\"]\n\t\t\t\t\t});\n\t\t\t\tcase \")\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"(\"]\n\t\t\t\t\t});\n\t\t\t\tcase \">>\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"<<\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"end\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\ti: [\"begin\", \"case\", \"fun\", \"if\", \"receive\", \"try\"]\n\t\t\t\t\t});\n\t\t\t\tcase \",\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"begin\", \"try\", \"when\", \"->\",\n\t\t\t\t\t\t\t\t\",\", \"(\", \"[\", \"{\", \"<<\"\n\t\t\t\t\t\t\t ]\n\t\t\t\t\t});\n\t\t\t\tcase \"->\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\tr: [\"when\"],\n\t\t\t\t\t\tm: [\"try\", \"if\", \"case\", \"receive\"]\n\t\t\t\t\t});\n\t\t\t\tcase \";\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\tE: [\"case\", \"fun\", \"if\", \"receive\", \"try\", \"when\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"catch\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"try\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"of\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"case\"]\n\t\t\t\t\t});\n\t\t\t\tcase \"after\":\n\t\t\t\t\treturn d(s, {\n\t\t\t\t\t\te: [\"receive\", \"try\"]\n\t\t\t\t\t});\n\t\t\t\tdefault:\n\t\t\t\t\treturn s;\n\t\t\t}\n\t\t}\n\n\t\tfunction d(stack, tt) {\n\t\t\t// stack is a stack of Token objects.\n\t\t\t// tt is an object; {type:tokens}\n\t\t\t// type is a char, tokens is a list of token strings.\n\t\t\t// The function returns (possibly truncated) stack.\n\t\t\t// It will descend the stack, looking for a Token such that Token.token\n\t\t\t//  is a member of tokens. If it does not find that, it will normally (but\n\t\t\t//  see \"E\" below) return stack. If it does find a match, it will remove\n\t\t\t//  all the Tokens between the top and the matched Token.\n\t\t\t// If type is \"m\", that is all it does.\n\t\t\t// If type is \"i\", it will also remove the matched Token and the top Token.\n\t\t\t// If type is \"g\", like \"i\", but add a fake \"group\" token at the top.\n\t\t\t// If type is \"r\", it will remove the matched Token, but not the top Token.\n\t\t\t// If type is \"e\", it will keep the matched Token but not the top Token.\n\t\t\t// If type is \"E\", it behaves as for type \"e\", except if there is no match,\n\t\t\t//  in which case it will return an empty stack.\n\n\t\t\tfor (var type in tt) {\n\t\t\t\tvar len = stack.length - 1;\n\t\t\t\tvar tokens = tt[type];\n\t\t\t\tfor (var i = len - 1; - 1 < i; i--) {\n\t\t\t\t\tif (is_member(stack[i].token, tokens)) {\n\t\t\t\t\t\tvar ss = stack.slice(0, i);\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase \"m\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[i]).concat(stack[len]);\n\t\t\t\t\t\t\tcase \"r\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[len]);\n\t\t\t\t\t\t\tcase \"i\":\n\t\t\t\t\t\t\t\treturn ss;\n\t\t\t\t\t\t\tcase \"g\":\n\t\t\t\t\t\t\t\treturn ss.concat(fakeToken(\"group\"));\n\t\t\t\t\t\t\tcase \"E\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[i]);\n\t\t\t\t\t\t\tcase \"e\":\n\t\t\t\t\t\t\t\treturn ss.concat(stack[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (type == \"E\" ? [] : stack);\n\t\t}\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// indenter\n\n\t\tfunction indenter(state, textAfter) {\n\t\t\tvar t;\n\t\t\tvar unit = cmCfg.indentUnit;\n\t\t\tvar wordAfter = wordafter(textAfter);\n\t\t\tvar currT = peekToken(state, 1);\n\t\t\tvar prevT = peekToken(state, 2);\n\n\t\t\tif (state.in_string || state.in_atom) {\n\t\t\t\treturn CodeMirror.Pass;\n\t\t\t} else if (!prevT) {\n\t\t\t\treturn 0;\n\t\t\t} else if (currT.token == \"when\") {\n\t\t\t\treturn currT.column + unit;\n\t\t\t} else if (wordAfter === \"when\" && prevT.type === \"function\") {\n\t\t\t\treturn prevT.indent + unit;\n\t\t\t} else if (wordAfter === \"(\" && currT.token === \"fun\") {\n\t\t\t\treturn currT.column + 3;\n\t\t\t} else if (wordAfter === \"catch\" && (t = getToken(state, [\"try\"]))) {\n\t\t\t\treturn t.column;\n\t\t\t} else if (is_member(wordAfter, [\"end\", \"after\", \"of\"])) {\n\t\t\t\tt = getToken(state, [\"begin\", \"case\", \"fun\", \"if\", \"receive\", \"try\"]);\n\t\t\t\treturn t ? t.column : CodeMirror.Pass;\n\t\t\t} else if (is_member(wordAfter, closeParenWords)) {\n\t\t\t\tt = getToken(state, openParenWords);\n\t\t\t\treturn t ? t.column : CodeMirror.Pass;\n\t\t\t} else if (is_member(currT.token, [\",\", \"|\", \"||\"]) ||\n\t\t\t\t\t\t\t\t is_member(wordAfter, [\",\", \"|\", \"||\"])) {\n\t\t\t\tt = postcommaToken(state);\n\t\t\t\treturn t ? t.column + t.token.length : unit;\n\t\t\t} else if (currT.token == \"->\") {\n\t\t\t\tif (is_member(prevT.token, [\"receive\", \"case\", \"if\", \"try\"])) {\n\t\t\t\t\treturn prevT.column + unit + unit;\n\t\t\t\t} else {\n\t\t\t\t\treturn prevT.column + unit;\n\t\t\t\t}\n\t\t\t} else if (is_member(currT.token, openParenWords)) {\n\t\t\t\treturn currT.column + currT.token.length;\n\t\t\t} else {\n\t\t\t\tt = defaultToken(state);\n\t\t\t\treturn truthy(t) ? t.column + unit : 0;\n\t\t\t}\n\t\t}\n\n\t\tfunction wordafter(str) {\n\t\t\tvar m = str.match(/,|[a-z]+|\\}|\\]|\\)|>>|\\|+|\\(/);\n\n\t\t\treturn truthy(m) && (m.index === 0) ? m[0] : \"\";\n\t\t}\n\n\t\tfunction postcommaToken(state) {\n\t\t\tvar objs = state.tokenStack.slice(0, -1);\n\t\t\tvar i = getTokenIndex(objs, \"type\", [\"open_paren\"]);\n\n\t\t\treturn truthy(objs[i]) ? objs[i] : false;\n\t\t}\n\n\t\tfunction defaultToken(state) {\n\t\t\tvar objs = state.tokenStack;\n\t\t\tvar stop = getTokenIndex(objs, \"type\", [\"open_paren\", \"separator\", \"keyword\"]);\n\t\t\tvar oper = getTokenIndex(objs, \"type\", [\"operator\"]);\n\n\t\t\tif (truthy(stop) && truthy(oper) && stop < oper) {\n\t\t\t\treturn objs[stop + 1];\n\t\t\t} else if (truthy(stop)) {\n\t\t\t\treturn objs[stop];\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction getToken(state, tokens) {\n\t\t\tvar objs = state.tokenStack;\n\t\t\tvar i = getTokenIndex(objs, \"token\", tokens);\n\n\t\t\treturn truthy(objs[i]) ? objs[i] : false;\n\t\t}\n\n\t\tfunction getTokenIndex(objs, propname, propvals) {\n\n\t\t\tfor (var i = objs.length - 1; - 1 < i; i--) {\n\t\t\t\tif (is_member(objs[i][propname], propvals)) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction truthy(x) {\n\t\t\treturn (x !== false) && (x != null);\n\t\t}\n\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\t// this object defines the mode\n\n\t\treturn {\n\t\t\tstartState: function() {\n\t\t\t\treturn {\n\t\t\t\t\ttokenStack: [],\n\t\t\t\t\tin_string: false,\n\t\t\t\t\tin_atom: false\n\t\t\t\t};\n\t\t\t},\n\n\t\t\ttoken: function(stream, state) {\n\t\t\t\treturn tokenizer(stream, state);\n\t\t\t},\n\n\t\t\tindent: function(state, textAfter) {\n\t\t\t\treturn indenter(state, textAfter);\n\t\t\t},\n\n\t\t\tlineComment: \"%\"\n\t\t};\n\t});\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1520719584735","id": ".Highlighter","type": "js","data": "(function(CodeMirror){\n\n  // https://codemirror.net/addon/selection/mark-selection.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Because sometimes you need to mark the selected *text*.\n  //\n  // Adds an option 'styleSelectedText' which, when enabled, gives\n  // selected text the CSS class given as option value, or\n  // \"CodeMirror-selectedtext\" when the value is not a string.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineOption(\"styleSelectedText\", false, function(cm, val, old) {\n      var prev = old && old != CodeMirror.Init;\n      if (val && !prev) {\n        cm.state.markedSelection = [];\n        cm.state.markedSelectionStyle = typeof val == \"string\" ? val : \"CodeMirror-selectedtext\";\n        reset(cm);\n        cm.on(\"cursorActivity\", onCursorActivity);\n        cm.on(\"change\", onChange);\n      } else if (!val && prev) {\n        cm.off(\"cursorActivity\", onCursorActivity);\n        cm.off(\"change\", onChange);\n        clear(cm);\n        cm.state.markedSelection = cm.state.markedSelectionStyle = null;\n      }\n    });\n\n    function onCursorActivity(cm) {\n      if (cm.state.markedSelection)\n        cm.operation(function() {\n          update(cm);\n        });\n    }\n\n    function onChange(cm) {\n      if (cm.state.markedSelection && cm.state.markedSelection.length)\n        cm.operation(function() {\n          clear(cm);\n        });\n    }\n\n    var CHUNK_SIZE = 8;\n    var Pos = CodeMirror.Pos;\n    var cmp = CodeMirror.cmpPos;\n\n    function coverRange(cm, from, to, addAt) {\n      if (cmp(from, to) == 0) return;\n      var array = cm.state.markedSelection;\n      var cls = cm.state.markedSelectionStyle;\n      for (var line = from.line;;) {\n        var start = line == from.line ? from : Pos(line, 0);\n        var endLine = line + CHUNK_SIZE,\n            atEnd = endLine >= to.line;\n        var end = atEnd ? to : Pos(endLine, 0);\n        var mark = cm.markText(start, end, {\n          className: cls\n        });\n        if (addAt == null) array.push(mark);\n        else array.splice(addAt++, 0, mark);\n        if (atEnd) break;\n        line = endLine;\n      }\n    }\n\n    function clear(cm) {\n      var array = cm.state.markedSelection;\n      for (var i = 0; i < array.length; ++i) array[i].clear();\n      array.length = 0;\n    }\n\n    function reset(cm) {\n      clear(cm);\n      var ranges = cm.listSelections();\n      for (var i = 0; i < ranges.length; i++)\n        coverRange(cm, ranges[i].from(), ranges[i].to());\n    }\n\n    function update(cm) {\n      if (!cm.somethingSelected()) return clear(cm);\n      if (cm.listSelections().length > 1) return reset(cm);\n\n      var from = cm.getCursor(\"start\"),\n          to = cm.getCursor(\"end\");\n\n      var array = cm.state.markedSelection;\n      if (!array.length) return coverRange(cm, from, to);\n\n      var coverStart = array[0].find(),\n          coverEnd = array[array.length - 1].find();\n      if (!coverStart || !coverEnd || to.line - from.line <= CHUNK_SIZE ||\n          cmp(from, coverEnd.to) >= 0 || cmp(to, coverStart.from) <= 0)\n        return reset(cm);\n\n      while (cmp(from, coverStart.from) > 0) {\n        array.shift().clear();\n        coverStart = array[0].find();\n      }\n      if (cmp(from, coverStart.from) < 0) {\n        if (coverStart.to.line - from.line < CHUNK_SIZE) {\n          array.shift().clear();\n          coverRange(cm, from, coverStart.to, 0);\n        } else {\n          coverRange(cm, from, coverStart.from, 0);\n        }\n      }\n\n      while (cmp(to, coverEnd.to) < 0) {\n        array.pop().clear();\n        coverEnd = array[array.length - 1].find();\n      }\n      if (cmp(to, coverEnd.to) > 0) {\n        if (to.line - coverEnd.from.line < CHUNK_SIZE) {\n          array.pop().clear();\n          coverRange(cm, coverEnd.from, to);\n        } else {\n          coverRange(cm, coverEnd.to, to);\n        }\n      }\n    }\n  });\n\n  //===================================================\n\n  // https://codemirror.net/addon/scroll/annotatescrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"annotateScrollbar\", function(options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      return new Annotation(this, options);\n    });\n\n    CodeMirror.defineOption(\"scrollButtonHeight\", 0);\n\n    function Annotation(cm, options) {\n      this.cm = cm;\n      this.options = options;\n      this.buttonHeight = options.scrollButtonHeight || cm.getOption(\"scrollButtonHeight\");\n      this.annotations = [];\n      this.doRedraw = this.doUpdate = null;\n      this.div = cm.getWrapperElement().appendChild(document.createElement(\"div\"));\n      this.div.style.cssText = \"position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none\";\n      this.computeScale();\n\n      function scheduleRedraw(delay) {\n        clearTimeout(self.doRedraw);\n        self.doRedraw = setTimeout(function() {\n          self.redraw();\n        }, delay);\n      }\n\n      var self = this;\n      cm.on(\"refresh\", this.resizeHandler = function() {\n        clearTimeout(self.doUpdate);\n        self.doUpdate = setTimeout(function() {\n          if (self.computeScale()) scheduleRedraw(20);\n        }, 100);\n      });\n      cm.on(\"markerAdded\", this.resizeHandler);\n      cm.on(\"markerCleared\", this.resizeHandler);\n      if (options.listenForChanges !== false)\n        cm.on(\"change\", this.changeHandler = function() {\n          scheduleRedraw(250);\n        });\n    }\n\n    Annotation.prototype.computeScale = function() {\n      var cm = this.cm;\n      var hScale = (cm.getWrapperElement().clientHeight - cm.display.barHeight - this.buttonHeight * 2) /\n          cm.getScrollerElement().scrollHeight\n      if (hScale != this.hScale) {\n        this.hScale = hScale;\n        return true;\n      }\n    };\n\n    Annotation.prototype.update = function(annotations) {\n      this.annotations = annotations;\n      this.redraw();\n    };\n\n    Annotation.prototype.redraw = function(compute) {\n      if (compute !== false) this.computeScale();\n      var cm = this.cm,\n          hScale = this.hScale;\n\n      var frag = document.createDocumentFragment(),\n          anns = this.annotations;\n\n      var wrapping = cm.getOption(\"lineWrapping\");\n      var singleLineH = wrapping && cm.defaultTextHeight() * 1.5;\n      var curLine = null,\n          curLineObj = null;\n\n      function getY(pos, top) {\n        if (curLine != pos.line) {\n          curLine = pos.line;\n          curLineObj = cm.getLineHandle(curLine);\n        }\n        if ((curLineObj.widgets && curLineObj.widgets.length) ||\n            (wrapping && curLineObj.height > singleLineH))\n          return cm.charCoords(pos, \"local\")[top ? \"top\" : \"bottom\"];\n        var topY = cm.heightAtLine(curLineObj, \"local\");\n        return topY + (top ? 0 : curLineObj.height);\n      }\n\n      var lastLine = cm.lastLine()\n      if (cm.display.barWidth)\n        for (var i = 0, nextTop; i < anns.length; i++) {\n          var ann = anns[i];\n          if (ann.to.line > lastLine) continue;\n          var top = nextTop || getY(ann.from, true) * hScale;\n          var bottom = getY(ann.to, false) * hScale;\n          while (i < anns.length - 1) {\n            if (anns[i + 1].to.line > lastLine) break;\n            nextTop = getY(anns[i + 1].from, true) * hScale;\n            if (nextTop > bottom + .9) break;\n            ann = anns[++i];\n            bottom = getY(ann.to, false) * hScale;\n          }\n          if (bottom == top) continue;\n          var height = Math.max(bottom - top, 3);\n\n          var elt = frag.appendChild(document.createElement(\"div\"));\n          elt.style.cssText = \"position: absolute; right: 0px; width: \" + Math.max(cm.display.barWidth - 1, 2) + \"px; top: \" + (top + this.buttonHeight) + \"px; height: \" + height + \"px\";\n          elt.className = this.options.className;\n          if (ann.id) {\n            elt.setAttribute(\"annotation-id\", ann.id);\n          }\n        }\n      this.div.textContent = \"\";\n      this.div.appendChild(frag);\n    };\n\n    Annotation.prototype.clear = function() {\n      this.cm.off(\"refresh\", this.resizeHandler);\n      this.cm.off(\"markerAdded\", this.resizeHandler);\n      this.cm.off(\"markerCleared\", this.resizeHandler);\n      if (this.changeHandler) this.cm.off(\"change\", this.changeHandler);\n      this.div.parentNode.removeChild(this.div);\n    };\n  });\n\n\n\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/matchesonscrollbar.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    CodeMirror.defineExtension(\"showMatchesOnScrollbar\", function(query, caseFold, options) {\n      if (typeof options == \"string\") options = {\n        className: options\n      };\n      if (!options) options = {};\n      return new SearchAnnotation(this, query, caseFold, options);\n    });\n\n    function SearchAnnotation(cm, query, caseFold, options) {\n      this.cm = cm;\n      this.options = options;\n      var annotateOptions = {\n        listenForChanges: false\n      };\n      for (var prop in options) annotateOptions[prop] = options[prop];\n      if (!annotateOptions.className) annotateOptions.className = \"CodeMirror-search-match\";\n      this.annotation = cm.annotateScrollbar(annotateOptions);\n      this.query = query;\n      this.caseFold = caseFold;\n      this.gap = {\n        from: cm.firstLine(),\n        to: cm.lastLine() + 1\n      };\n      this.matches = [];\n      this.update = null;\n\n      this.findMatches();\n      this.annotation.update(this.matches);\n\n      var self = this;\n      cm.on(\"change\", this.changeHandler = function(_cm, change) {\n        self.onChange(change);\n      });\n    }\n\n    var MAX_MATCHES = 1000;\n\n    SearchAnnotation.prototype.findMatches = function() {\n      if (!this.gap) return;\n      for (var i = 0; i < this.matches.length; i++) {\n        var match = this.matches[i];\n        if (match.from.line >= this.gap.to) break;\n        if (match.to.line >= this.gap.from) this.matches.splice(i--, 1);\n      }\n      var cursor = this.cm.getSearchCursor(this.query, CodeMirror.Pos(this.gap.from, 0), this.caseFold);\n      var maxMatches = this.options && this.options.maxMatches || MAX_MATCHES;\n      while (cursor.findNext()) {\n        var match = {\n          from: cursor.from(),\n          to: cursor.to()\n        };\n        if (match.from.line >= this.gap.to) break;\n        this.matches.splice(i++, 0, match);\n        if (this.matches.length > maxMatches) break;\n      }\n      this.gap = null;\n    };\n\n    function offsetLine(line, changeStart, sizeChange) {\n      if (line <= changeStart) return line;\n      return Math.max(changeStart, line + sizeChange);\n    }\n\n    SearchAnnotation.prototype.onChange = function(change) {\n      var startLine = change.from.line;\n      var endLine = CodeMirror.changeEnd(change).line;\n      var sizeChange = endLine - change.to.line;\n      if (this.gap) {\n        this.gap.from = Math.min(offsetLine(this.gap.from, startLine, sizeChange), change.from.line);\n        this.gap.to = Math.max(offsetLine(this.gap.to, startLine, sizeChange), change.from.line);\n      } else {\n        this.gap = {\n          from: change.from.line,\n          to: endLine + 1\n        };\n      }\n\n      if (sizeChange)\n        for (var i = 0; i < this.matches.length; i++) {\n          var match = this.matches[i];\n          var newFrom = offsetLine(match.from.line, startLine, sizeChange);\n          if (newFrom != match.from.line) match.from = CodeMirror.Pos(newFrom, match.from.ch);\n          var newTo = offsetLine(match.to.line, startLine, sizeChange);\n          if (newTo != match.to.line) match.to = CodeMirror.Pos(newTo, match.to.ch);\n        }\n      clearTimeout(this.update);\n      var self = this;\n      this.update = setTimeout(function() {\n        self.updateAfterChange();\n      }, 250);\n    };\n\n    SearchAnnotation.prototype.updateAfterChange = function() {\n      this.findMatches();\n      this.annotation.update(this.matches);\n    };\n\n    SearchAnnotation.prototype.clear = function() {\n      this.cm.off(\"change\", this.changeHandler);\n      this.annotation.clear();\n    };\n  });\n\n\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/searchcursor.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  (function(mod) {\n    mod(CodeMirror)\n  })(function(CodeMirror) {\n    \"use strict\"\n    var Pos = CodeMirror.Pos\n\n    function regexpFlags(regexp) {\n      var flags = regexp.flags\n      return flags != null ? flags : (regexp.ignoreCase ? \"i\" : \"\") + (regexp.global ? \"g\" : \"\") + (regexp.multiline ? \"m\" : \"\")\n    }\n\n    function ensureFlags(regexp, flags) {\n      var current = regexpFlags(regexp),\n          target = current\n      for (var i = 0; i < flags.length; i++)\n        if (target.indexOf(flags.charAt(i)) == -1)\n          target += flags.charAt(i)\n          return current == target ? regexp : new RegExp(regexp.source, target)\n    }\n\n    function maybeMultiline(regexp) {\n      return /\\\\s|\\\\n|\\n|\\\\W|\\\\D|\\[\\^/.test(regexp.source)\n    }\n\n    function searchRegexpForward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {\n        regexp.lastIndex = ch\n        var string = doc.getLine(line),\n            match = regexp.exec(string)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpForwardMultiline(doc, regexp, start) {\n      if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)\n\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, last = doc.lastLine(); line <= last;) {\n        // This grows the search buffer in exponentially-sized chunks\n        // between matches, so that nearby matches are fast and don't\n        // require concatenating the whole document (in case we're\n        // searching for something that has tons of matches), but at the\n        // same time, the amount of retries is limited.\n        for (var i = 0; i < chunk; i++) {\n          if (line > last) break\n          var curLine = doc.getLine(line++)\n          string = string == null ? curLine : string + \"\\n\" + curLine\n        }\n        chunk = chunk * 2\n        regexp.lastIndex = start.ch\n        var match = regexp.exec(string)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = start.line + before.length - 1,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    function lastMatchIn(string, regexp) {\n      var cutOff = 0,\n          match\n      for (;;) {\n        regexp.lastIndex = cutOff\n        var newMatch = regexp.exec(string)\n        if (!newMatch) return match\n        match = newMatch\n        cutOff = match.index + (match[0].length || 1)\n        if (cutOff == string.length) return match\n          }\n    }\n\n    function searchRegexpBackward(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"g\")\n      for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {\n        var string = doc.getLine(line)\n        if (ch > -1) string = string.slice(0, ch)\n        var match = lastMatchIn(string, regexp)\n        if (match)\n          return {\n            from: Pos(line, match.index),\n            to: Pos(line, match.index + match[0].length),\n            match: match\n          }\n          }\n    }\n\n    function searchRegexpBackwardMultiline(doc, regexp, start) {\n      regexp = ensureFlags(regexp, \"gm\")\n      var string, chunk = 1\n      for (var line = start.line, first = doc.firstLine(); line >= first;) {\n        for (var i = 0; i < chunk; i++) {\n          var curLine = doc.getLine(line--)\n          string = string == null ? curLine.slice(0, start.ch) : curLine + \"\\n\" + string\n        }\n        chunk *= 2\n\n        var match = lastMatchIn(string, regexp)\n        if (match) {\n          var before = string.slice(0, match.index).split(\"\\n\"),\n              inside = match[0].split(\"\\n\")\n          var startLine = line + before.length,\n              startCh = before[before.length - 1].length\n          return {\n            from: Pos(startLine, startCh),\n            to: Pos(startLine + inside.length - 1,\n                    inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\n            match: match\n          }\n        }\n      }\n    }\n\n    var doFold, noFold\n    if (String.prototype.normalize) {\n      doFold = function(str) {\n        return str.normalize(\"NFD\").toLowerCase()\n      }\n      noFold = function(str) {\n        return str.normalize(\"NFD\")\n      }\n    } else {\n      doFold = function(str) {\n        return str.toLowerCase()\n      }\n      noFold = function(str) {\n        return str\n      }\n    }\n\n    // Maps a position in a case-folded line back to a position in the original line\n    // (compensating for codepoints increasing in number during folding)\n\n    function adjustPos(orig, folded, pos, foldFunc) {\n      if (orig.length == folded.length) return pos\n      for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {\n        if (min == max) return min\n        var mid = (min + max) >> 1\n        var len = foldFunc(orig.slice(0, mid)).length\n        if (len == pos) return mid\n        else if (len > pos) max = mid\n        else min = mid + 1\n          }\n    }\n\n    function searchStringForward(doc, query, start, caseFold) {\n      // Empty string would match anything and never progress, so we\n      // define it to match nothing instead.\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {\n        var orig = doc.getLine(line).slice(ch),\n            string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.indexOf(lines[0])\n          if (found == -1) continue search\n          var start = adjustPos(orig, string, found, fold) + ch\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold) + ch),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)\n          }\n        } else {\n          var cutFrom = string.length - lines[0].length\n          if (string.slice(cutFrom) != lines[0]) continue search\n          for (var i = 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(line + i)) != lines[i]) continue search\n            var end = doc.getLine(line + lines.length - 1),\n                endString = fold(end),\n                lastLine = lines[lines.length - 1]\n            if (endString.slice(0, lastLine.length) != lastLine) continue search\n            return {\n              from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),\n              to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function searchStringBackward(doc, query, start, caseFold) {\n      if (!query.length) return null\n      var fold = caseFold ? doFold : noFold\n      var lines = fold(query).split(/\\r|\\n\\r?/)\n\n      search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {\n        var orig = doc.getLine(line)\n        if (ch > -1) orig = orig.slice(0, ch)\n        var string = fold(orig)\n        if (lines.length == 1) {\n          var found = string.lastIndexOf(lines[0])\n          if (found == -1) continue search\n          return {\n            from: Pos(line, adjustPos(orig, string, found, fold)),\n            to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))\n          }\n        } else {\n          var lastLine = lines[lines.length - 1]\n          if (string.slice(0, lastLine.length) != lastLine) continue search\n          for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)\n            if (fold(doc.getLine(start + i)) != lines[i]) continue search\n            var top = doc.getLine(line + 1 - lines.length),\n                topString = fold(top)\n            if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search\n            return {\n              from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),\n              to: Pos(line, adjustPos(orig, string, lastLine.length, fold))\n            }\n        }\n      }\n    }\n\n    function SearchCursor(doc, query, pos, options) {\n      this.atOccurrence = false\n      this.doc = doc\n      pos = pos ? doc.clipPos(pos) : Pos(0, 0)\n      this.pos = {\n        from: pos,\n        to: pos\n      }\n\n      var caseFold\n      if (typeof options == \"object\") {\n        caseFold = options.caseFold\n      } else { // Backwards compat for when caseFold was the 4th argument\n        caseFold = options\n        options = null\n      }\n\n      if (typeof query == \"string\") {\n        if (caseFold == null) caseFold = false\n        this.matches = function(reverse, pos) {\n          return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)\n        }\n      } else {\n        query = ensureFlags(query, \"gm\")\n        if (!options || options.multiline !== false)\n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)\n          }; \n        else \n          this.matches = function(reverse, pos) {\n            return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)\n          };\n      }\n    }\n\n    SearchCursor.prototype = {\n      findNext: function() {\n        return this.find(false)\n      },\n      findPrevious: function() {\n        return this.find(true)\n      },\n\n      find: function(reverse) {\n        var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))\n\n        // Implements weird auto-growing behavior on null-matches for\n        // backwards-compatiblity with the vim code (unfortunately)\n        while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {\n          if (reverse) {\n            if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)\n            else if (result.from.line == this.doc.firstLine()) result = null\n            else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))\n              } else {\n                if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)\n                else if (result.to.line == this.doc.lastLine()) result = null\n                else result = this.matches(reverse, Pos(result.to.line + 1, 0))\n                  }\n        }\n\n        if (result) {\n          this.pos = result\n          this.atOccurrence = true\n          return this.pos.match || true\n        } else {\n          var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)\n          this.pos = {\n            from: end,\n            to: end\n          }\n          return this.atOccurrence = false\n        }\n      },\n\n      from: function() {\n        if (this.atOccurrence) return this.pos.from\n          },\n      to: function() {\n        if (this.atOccurrence) return this.pos.to\n          },\n\n      replace: function(newText, origin) {\n        if (!this.atOccurrence) return\n        var lines = CodeMirror.splitLines(newText)\n        this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)\n        this.pos.to = Pos(this.pos.from.line + lines.length - 1,\n                          lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))\n      }\n    }\n\n    CodeMirror.defineExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this.doc, query, pos, caseFold)\n    })\n    CodeMirror.defineDocExtension(\"getSearchCursor\", function(query, pos, caseFold) {\n      return new SearchCursor(this, query, pos, caseFold)\n    })\n\n    CodeMirror.defineExtension(\"selectMatches\", function(query, caseFold) {\n      var ranges = []\n      var cur = this.getSearchCursor(query, this.getCursor(\"from\"), caseFold)\n      while (cur.findNext()) {\n        if (CodeMirror.cmpPos(cur.to(), this.getCursor(\"to\")) > 0) break\n        ranges.push({\n          anchor: cur.from(),\n          head: cur.to()\n        })\n          }\n      if (ranges.length)\n        this.setSelections(ranges, 0)\n        })\n  });\n\n\n\n\n  //===================================================\n\n  // https://codemirror.net/addon/search/match-highlighter.js\n  // CodeMirror, copyright (c) by Marijn Haverbeke and others\n  // Distributed under an MIT license: http://codemirror.net/LICENSE\n\n  // Highlighting text that matches the selection\n  //\n  // Defines an option highlightSelectionMatches, which, when enabled,\n  // will style strings that match the selection throughout the\n  // document.\n  //\n  // The option can be set to true to simply enable it, or to a\n  // {minChars, style, wordsOnly, showToken, delay} object to explicitly\n  // configure it. minChars is the minimum amount of characters that should be\n  // selected for the behavior to occur, and style is the token style to\n  // apply to the matches. This will be prefixed by \"cm-\" to create an\n  // actual CSS class name. If wordsOnly is enabled, the matches will be\n  // highlighted only if the selected text is a word. showToken, when enabled,\n  // will cause the current token to be highlighted when nothing is selected.\n  // delay is used to specify how much time to wait, in milliseconds, before\n  // highlighting the matches. If annotateScrollbar is enabled, the occurences\n  // will be highlighted on the scrollbar via the matchesonscrollbar addon.\n\n  (function(mod) {\n    mod(CodeMirror);\n  })(function(CodeMirror) {\n    \"use strict\";\n\n    var defaults = {\n      style: \"matchhighlight\",\n      minChars: 2,\n      maxChars: 200,\n      delay: 100,\n      wordsOnly: false,\n      annotateScrollbar: false,\n      showToken: false,\n      trim: true\n    }\n\n    function State(options) {\n      this.options = {}\n      for (var name in defaults)\n        this.options[name] = (options && options.hasOwnProperty(name) ? options : defaults)[name]\n        this.overlay = this.timeout = null;\n      this.matchesonscroll = null;\n      this.active = false;\n    }\n\n    CodeMirror.defineOption(\"highlightSelectionMatches\", false, function(cm, val, old) {\n      if (old && old != CodeMirror.Init) {\n        removeOverlay(cm);\n        clearTimeout(cm.state.matchHighlighter.timeout);\n        cm.state.matchHighlighter = null;\n        cm.off(\"cursorActivity\", cursorActivity);\n        cm.off(\"focus\", onFocus)\n      }\n      if (val) {\n        var state = cm.state.matchHighlighter = new State(val);\n        if (cm.hasFocus()) {\n          state.active = true\n          highlightMatches(cm)\n        } else {\n          cm.on(\"focus\", onFocus)\n        }\n        cm.on(\"cursorActivity\", cursorActivity);\n      }\n    });\n\n    function cursorActivity(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.active || cm.hasFocus()) scheduleHighlight(cm, state)\n        }\n\n    function onFocus(cm) {\n      var state = cm.state.matchHighlighter\n      if (!state.active) {\n        state.active = true\n        scheduleHighlight(cm, state)\n      }\n    }\n\n    function scheduleHighlight(cm, state) {\n      clearTimeout(state.timeout);\n      state.timeout = setTimeout(function() {\n        highlightMatches(cm);\n      }, state.options.delay);\n    }\n\n    function addOverlay(cm, query, hasBoundary, style) {\n      var state = cm.state.matchHighlighter;\n      cm.addOverlay(state.overlay = makeOverlay(query, hasBoundary, style));\n      if (state.options.annotateScrollbar && cm.showMatchesOnScrollbar) {\n        var searchFor = hasBoundary ? new RegExp(\"\\\\b\" + query.replace(/[\\\\\\[.+*?(){|^$]/g, \"\\\\$&\") + \"\\\\b\") : query;\n        state.matchesonscroll = cm.showMatchesOnScrollbar(searchFor, false, {\n          className: \"CodeMirror-selection-highlight-scrollbar\"\n        });\n      }\n    }\n\n    function removeOverlay(cm) {\n      var state = cm.state.matchHighlighter;\n      if (state.overlay) {\n        cm.removeOverlay(state.overlay);\n        state.overlay = null;\n        if (state.matchesonscroll) {\n          state.matchesonscroll.clear();\n          state.matchesonscroll = null;\n        }\n      }\n    }\n\n    function highlightMatches(cm) {\n      cm.operation(function() {\n        var state = cm.state.matchHighlighter;\n        removeOverlay(cm);\n        if (!cm.somethingSelected() && state.options.showToken) {\n          var re = state.options.showToken === true ? /[\\w$]/ : state.options.showToken;\n          var cur = cm.getCursor(),\n              line = cm.getLine(cur.line),\n              start = cur.ch,\n              end = start;\n          while (start && re.test(line.charAt(start - 1)))--start;\n          while (end < line.length && re.test(line.charAt(end)))++end;\n          if (start < end)\n            addOverlay(cm, line.slice(start, end), re, state.options.style);\n          return;\n        }\n        var from = cm.getCursor(\"from\"),\n            to = cm.getCursor(\"to\");\n        if (from.line != to.line) return;\n        if (state.options.wordsOnly && !isWord(cm, from, to)) return;\n        var selection = cm.getRange(from, to);\n        if (selection.length > state.options.maxChars) return;\n        if (state.options.trim) selection = selection.replace(/^\\s+|\\s+$/g, \"\")\n        if (selection.length >= state.options.minChars)\n          addOverlay(cm, selection, false, state.options.style);\n      });\n    }\n\n    function isWord(cm, from, to) {\n      var str = cm.getRange(from, to);\n      if (str.match(/^\\w+$/) !== null) {\n        if (from.ch > 0) {\n          var pos = {\n            line: from.line,\n            ch: from.ch - 1\n          };\n          var chr = cm.getRange(pos, from);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        if (to.ch < cm.getLine(from.line).length) {\n          var pos = {\n            line: to.line,\n            ch: to.ch + 1\n          };\n          var chr = cm.getRange(to, pos);\n          if (chr.match(/\\W/) === null) return false;\n        }\n        return true;\n      } else return false;\n    }\n\n    function boundariesAround(stream, re) {\n      return (!stream.start || !re.test(stream.string.charAt(stream.start - 1))) &&\n        (stream.pos == stream.string.length || !re.test(stream.string.charAt(stream.pos)));\n    }\n\n    function makeOverlay(query, hasBoundary, style) {\n      return {\n        token: function(stream) {\n          if (stream.match(query) &&\n              (!hasBoundary || boundariesAround(stream, hasBoundary)))\n            return style;\n          stream.next();\n          stream.skipTo(query.charAt(0)) || stream.skipToEnd();\n        }\n      };\n    }\n  });\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1457281902061","id": ".CMoverlays","type": "js","data": "(function(){\n\n\t// Extends CM with includes {{.x.y }} syntax highlighter\n\t// and supplementary highlighting for color picker\n\t\n\tvar re_clr = /^(rgb[a]?\\s*\\([\\s0-9,\\.]+\\)|#[0-9a-fA-F]{8}|#[0-9a-fA-F]{6}|#[0-9a-fA-F]{3})/\n\n\tfunction _parseStream (stream, state) {\n\t\tvar ch, n1, n2;\n\n\t\tif (stream.match(/^\\{\\{[\\/\\.]/)) {\n\t\t\twhile ((ch = stream.next()) != null) {\n\t\t\t\tif (ch == \"}\" && stream.next() == \"}\") {\n\t\t\t\t\treturn \"include\";\n\t\t\t\t}\n\t\t\t\tif (!/[a-z0-9_\\/\\.\\-]/i.test(ch)) break;\n\t\t\t}\n\t\t} \n\t\telse if (n1 = stream.match(/^[\\[\\{\"]\\/\\*{{[\\.\\/]/)) {\n\t\t\tn2 = n1[0].to(1);\n\t\t\twhile (ch = stream.next()) {\n\t\t\t\tif (\n\t\t\t\t\tch == \"}\"  \n\t\t\t\t\t&& stream.next() == '}'\n\t\t\t\t\t&& stream.next() == '*'\n\t\t\t\t\t&& stream.next() == '/'\n\t\t\t\t\t&& stream.next() == (n2=='{'?'}':n2=='['?']':n2=='\"'?'\"':'')\n\t\t\t\t) {\n\t\t\t\t\treturn \"include\";\n\t\t\t\t}\n\t\t\t\telse if (!/[a-z0-9_\\/\\.\\-]/i.test(ch)) break;\n\t\t\t}\n\t\t} else if (stream.match(re_clr)){\n\t\t\tstream.eat(re_clr);\n\t\t\treturn \"csscolor\";\n\t\t}\n\t\twhile (\n\t\t\tstream.next() != null \n\t\t\t&& !stream.match(/^\\{\\{[\\/\\.]/, false) \n\t\t\t&& !stream.match(/^[\\[\\{\"]\\/\\*{{[\\/\\.]/, false)\n\t\t\t&& !stream.match(re_clr, false)\n\t\t) {}\n\t\treturn null;\n\t}\n\n\t// - - - - - - - - - - - - -\n\t\n\t[\n\t\t[\"ddtext\", \"text\"],\n\t\t[\"ddjs\", \"javascript\"],\n\t\t[\"ddhtml\", \"htmlmixed\"],\n\t\t[\"ddcss\", \"text/css\"],\n\t\t[\"ddless\", \"text/x-less\"],\n\t\t[\"ddmd\", \"gfm\"]\n\t].forEach(function(e){\n\t\tif (\n\t\t\t//true || \n\t\t\t!CodeMirror.modes[e[0]]\n\t\t) CodeMirror.defineMode(e[0], function(config, parserConfig) {\n\t\t\treturn CodeMirror.overlayMode(CodeMirror.getMode(config,e[1]), {token: _parseStream});\n\t\t});\n\t})\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1440906045198","id": ".CloseTabs","type": "js","data": "(function (mask0) {\n\t// removes tabs that matches mask,\n\t// does not redraw UI\n\t\n\tvar that = this,\n\t\t\tmask = Object.isFunction(mask0)?mask0:function(){return false},\n\t\t\td = that.data.doc,\n\t\t\tl1 = that.List.length,\n\t\t\tl2 = that.Tablist.length;\n\t\n\tthat.List.remove(mask);\n\tthat.Tablist.remove(mask);\n\t\n\tif (that.List.length != l1 || that.Tablist.length != l2) {\n\t\n\t\tif (that.Tablist[0] && that.List.indexOf(that.Tablist[0])==-1) that.List.push(that.Tablist[0]);\n\t\tif (that.List.length) that.Active = that.List[0].id;\n\t\telse {\n\t\t\tthat.Active = d.items[0].id;\n\t\t\tthat.List.push(d.items[0]);\n\t\t\tthat.Tablist.push(d.items[0]);\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1439496822834","id": ".X.inliner.html","type": "js","data": "(function (data, item, oitems){\n\t// data is ext json of type==\"inliner\",\n\t// item is dest point, \n\t// oitems is {itemId:{item}, itemId1:{item}}\n\n\t// Can modify oitems obj –\n\t// add or remove items of type:\"attachment\".\n\t// attachment obj itself must be put into item‘s .data.\n\t// For remove appropriate key must be set to null.\n\n\t// Empty item of type:\"attachments\" –\n\t// this.Types.attachment.manifest.data\n\t// id generator – this.GenId()\n\n\t// this points to core app manifest.\n\n\t//console.log(\"Inliner2Html converter running, build 30\");\n\n\tvar that = this,\n\t\t\tatt0 = {\n\t\t\t\tid:\"\", folder:\"\", name:\"\", mime:\"\", parser:\"\", parserActive:false,\n\t\t\t\text:\"\", cache:\"864000\", data:\"\", snippet:false, size:\"?\",\n\t\t\t\ttype:\"attachment\",\n\t\t\t\tdesc:\"\", \n\t\t\t\tstate:{\n\t\t\t\t\tsavedSdbm:\"\", sdbm:\"Z\",\n\t\t\t\t\tdepends:{}, impacts:{}\n\t\t\t\t}\n\t\t\t},\n\t\t\tattKeys = Object.keys(oitems).filter(function(e){\n\t\t\t\treturn /inliner\\//.test(e);\n\t\t\t}), html = \"\",\n\t\t\tF = {\n\t\t\t\tleft1000:\"max\",\n\t\t\t\tleft750:\"wide\",\n\t\t\t\tleft500:\"medium\",\n\t\t\t\tleft300:\"small\",\n\t\t\t\tleft200:\"tiny\",\n\t\t\t\tright300:\"small-right\",\n\t\t\t\tright200:\"tiny-right\"\n\t\t\t},\n\t\t\tdocid = data._id;\n\n\t// mark unexisting appropriate items keys to null\n\tattKeys.forEach(function(id){\n\t\tif (data._id == id.split('/').last(2)[0] && !cw.lib.getref(data, \"content._stamp=\"+id.split('/').last())) {\n\t\t\toitems[id] = null;\n\t\t}\n\t});\n\n\t// get meta\n\tvar metakeys,\n\t\t\tmeta = '<meta inliner data-id=\"' + data._id + \n\t\t\t'\" data-name=\"'+(data.title||data.name||\"\").escapeHTML()+\n\t\t\t'\" data-tags=\"'+(JSON.stringify(data.tags)||\"\").escapeHTML() + '\"';\n\n\tmetakeys = data.meta && Object.isObject(data.meta)?Object.keys(data.meta):[];\n\tmetakeys.forEach(function(key){\n\t\tif (/^[a-z0-9]+$/i.test(key) \n\t\t\t\t&& !/^id$|^name$|^tags$/.test(key)) meta += ' data-' + key + '=\"' + data.meta[key].escapeHTML() + '\"';\n\t});\n\n\tmeta += '/>';\n\n\t// get html\n\tvar resrc = {};\n\tdata.content.forEach(function(elt){\n\n\t\tvar css = Object.isArray(elt.css)?elt.css:[];\n\n\t\t// add html\n\t\tif (elt.type == \"html\") {\n\t\t\tif (css.length) {\n\t\t\t\thtml+='<section class=\"'+css.map(function(e){\n\t\t\t\t\treturn \"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-');\n\t\t\t\t}).join(\" \")+'\">'\n\t\t\t}\n\t\t\thtml += elt.data;\n\t\t\tif (css.length) html+='</section>'\n\t\t\thtml+= '\\n\\n';\n\t\t\treturn;\n\t\t}\n\n\t\t// elt.format should be array\n\t\t// gen classes for sections\n\t\tvar classes = '';\n\t\tif (Object.isString(elt.format)) elt.format = [elt.format];\n\t\tif (Object.isArray(elt.format)) {\n\t\t\tclasses = elt.format.reduce(function(res,e){ \n\t\t\t\treturn res + ' in-item-' + (F[e]?F[e]:e);\n\t\t\t},'')\n\t\t}\n\t\tif (css.length) {\n\t\t\tclasses +=' '+css.map(function(e){return \"in-\"+e.toLowerCase().replace(/[^a-z0-9]+/ig,'-');}).join(\" \");\n\t\t} \n\n\t\t// add embed\n\t\tif (elt.type == \"embed\") {\n\t\t\thtml += '<figure class=\"' + classes + '\">' +\n\t\t\t\t'<section>' + elt.data + '</section>' +\n\t\t\t\t(elt.showdesc+\"\" == \"show\" ? ('<figcaption class=\"in-item-desc\">' + elt.desc + '</figcaption>') : '') +\n\t\t\t\t'</figure>' + '\\n\\n';\n\t\t}\n\n\t\t// add img\n\n\t\tif (elt.type == \"img\") {\n\t\t\t\n\t\t\tvar obj, id, file, ref;\n\t\t\t\n\t\t\t// Create item of type:\"attachment\"\n\t\t\tif (elt.ref) {\n\t\t\t\t// image is attached\n\t\t\t\tref = elt.ref.replace(\"inliner/\"+docid+\"/\",'');\n\t\t\t\tid = cw.lib.hash8(\"inliner/\" + docid +\"/\"+ref);\n\t\t\t\t\n\t\t\t\tif (data._attachments && data._attachments[elt.ref]) {\n\t\t\t\t\tfile = data._attachments[elt.ref];\n\t\t\t\t\tobj = $.extend(true, {}, att0, {\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tfolder: \"/inliner\",\n\t\t\t\t\t\tname: docid+\"/\"+ref,\n\t\t\t\t\t\tmime: file.content_type,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tcontent_type: file.content_type,\n\t\t\t\t\t\t\tdata: file.data\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstate:{\n\t\t\t\t\t\t\tcrc:cw.lib.sdbm(file.data)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\telt.ref = \"inliner/\"+ obj.name;\n\t\t\t\t} \n\t\t\t\telse {\n\t\t\t\t\tobj = $.extend(true, {}, att0, {\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tfolder: \"/inliner\",\n\t\t\t\t\t\tname: docid+\"/\"+ref,\n\t\t\t\t\t\tstate:{ crc:false }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t// image is inlined\n\t\t\t\tid = cw.lib.hash8(\"inliner/\" + docid +\"/\"+elt._stamp);\n\t\t\t\tobj = $.extend(true, {}, att0, {\n\t\t\t\t\tid: id,\n\t\t\t\t\tfolder: \"/inliner\",\n\t\t\t\t\tname: docid+\"/\"+elt._stamp+\".jpg\",\n\t\t\t\t\tmime: \"image/jpeg\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcontent_type: \"image/jpeg\",\n\t\t\t\t\t\tdata: elt.data\n\t\t\t\t\t},\n\t\t\t\t\tstate:{\n\t\t\t\t\t\tcrc:cw.lib.sdbm(elt.data)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\telt.data = \" \";\n\t\t\t\telt.ref = \"inliner/\"+ obj.name;\n\t\t\t}\n\t\t\t\n\t\t\tif (obj) {\n\t\t\t\t// put new type:\"attachment\" item into main doc\n\t\t\t\tresrc[obj.name] = obj.id;\n\t\t\t\tif (\n\t\t\t\t\t obj.state.crc && (\n\t\t\t\t\t\t!oitems[id] || \n\t\t\t\t\t\toitems[id].state.crc != obj.state.crc\n\t\t\t\t\t )\n\t\t\t\t) oitems[id] = obj;\n\t\t\t}\n\t\t\t\n\t\t\tif (obj) html += '<figure class=\"' + classes + '\">' +\n\t\t\t\t'<img src=\"' + obj.folder.slice(1) + '/' + obj.name + '\"/>' +\n\t\t\t\t(elt.showdesc+\"\" == \"show\" ? ('<figcaption class=\"in-item-desc\">' + elt.desc + '</figcaption>') : '') +\n\t\t\t\t'</figure>' + '\\n\\n';\n\t\t}\n\n\t\t// add widget-code\n\t\tif (elt.type == \"code\" && elt.tab && elt.tab.length) {\n\t\t\thtml += '<div id=\"inliner-widget-code-'+elt._stamp+'\" class=\"inliner-widget-code\">';\n\t\t\telt.tab.forEach(function(type){\n\t\t\t\thtml += '<div id=\"x'+type+'\" class=\"dib vat oh w750\">' +\n\t\t\t\t\t'<textarea id=\"' + type + '\" class=\"w750 fs80\"></textarea>' +\n\t\t\t\t\t'</div>';\n\t\t\t});\n\n\t\t\thtml += '</div>';\n\n\t\t\thtml += '<script>' + \n\t\t\t\t'$(function(){' +\n\t\t\t\t// TODO cut useless elt fields\n\t\t\t\t'var elt=' + cw.lib.js2txt(elt) + ';\\n' +\n\t\t\t\t'initCode(elt);\\n' +\n\t\t\t\tcw.lib.js2txt(initCode) +\n\t\t\t\t'})' +\n\t\t\t\t'</scr' + 'ipt>';\n\t\t}\n\n\t\t// add widget\n\t\tif (elt.type == \"widget\") {\n\t\t\thtml += '<div id=\"inliner-widget-'+elt._stamp+'\" class=\"inliner-widget\"></div>';\n\n\t\t\thtml += '<scr' + 'ipt>' + \n\t\t\t\t'$(function(){' +\n\t\t\t\t'var elt=' + cw.lib.js2txt(elt) + ';\\n' +\n\t\t\t\t'initWidget(elt);\\n' +\n\t\t\t\tcw.lib.js2txt(initWidget) +\n\t\t\t\t'})' +\n\t\t\t\t'</scr' + 'ipt>';\n\t\t}\n\t});\n\n\tObject.keys(oitems).forEach(function(i){\n\t\tvar it = oitems[i];\n\t\tif (it && it.folder==\"/inliner\" && it.name.startsWith(docid+\"/\")) {\n\t\t\tif (!resrc[it.name] || resrc[it.name] != it.id) oitems[i] = null;\n\t\t}\n\t});\n\n\t//item.data = JSON.stringify(data, null, '\\t');\n\titem.data = meta + '\\n' + html;\n\n\treturn undefined;\n\n\n\t//= = = = = = = = = = = = = = =\n\n\n\t// Must return undefined if all is ok\n\t// or error message if failed.\n\n\n\t// init widget code\n\tfunction initCode(elt) {\n\t\tvar $elt = $('#inliner-widget-code-'+elt._stamp),\n\t\t\t\tman = {\n\t\t\t\t\tparams:{strict:true},\n\t\t\t\t\tid:\"cw.Inliner.Editor.Items.code\",\n\t\t\t\t\tName:\"Code\",\n\t\t\t\t\tHoverpane:\".cw-widget-code\",\n\t\t\t\t\tCompiler: function ($form, html, css, repo, manifest) {\n\t\t\t\t\t\tvar h = $form[0].outerHTML, $h = $(h); \n\t\t\t\t\t\t$h.find(\"#tab\").remove();\n\t\t\t\t\t\t$h.find(\"input\").remove();\n\t\t\t\t\t\t$h.find(\".CodeMirror-sizer\").css({\"min-height\":\"none\"});\n\t\t\t\t\t\thtml.push($h[0].outerHTML);\n\t\t\t\t\t\tthis.CSSCompiler($form, css);\n\t\t\t\t\t},\n\t\t\t\t\tdata:{\n\t\t\t\t\t\ttype:\"code\", \n\t\t\t\t\t\tcode:\"Place your code\\nhere\", \n\t\t\t\t\t\ttab:[\"js\",\"css\",\"html\"],\n\t\t\t\t\t\toptions:[\"noedit\"],\n\t\t\t\t\t\tjs:\"// Place your javascript here\\n\",\n\t\t\t\t\t\thtml:\"<!-- Put HTML code here -->\\n\",\n\t\t\t\t\t\tcss:\"/* Container for CSS code */\\n\"\n\t\t\t\t\t},\n\t\t\t\t\tinit:function($o, form) {\n\t\t\t\t\t\t$o.formgen(this.HTML);\n\t\t\t\t\t},\n\t\t\t\t\tui:{\n\t\t\t\t\t\t\"#tab\":{\n\t\t\t\t\t\t\tbind:\"tab\",\n\t\t\t\t\t\t\tinit: function ($o) {\n\t\t\t\t\t\t\t\t$o.tags({tags:[{\"HTML\":\"html\"},{\"JS\":\"js\"}, {\"CSS\":\"css\"}]})\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trecalc:\"#xjs,#xhtml,#xcss\"\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\"#xjs\":{css:{hide: function (d) { return d.tab.indexOf(\"js\")==-1;}}},\n\t\t\t\t\t\t\"#js\":{\n\t\t\t\t\t\t\tbind:\"js\",\n\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\tif (!this.Runtime || form.data.tab.indexOf(\"js\")>-1) this.Cm($o, \"javascript\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\"#xcss\":{\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"css\")==-1;},\n\t\t\t\t\t\t\t\tbt1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#css\":{\n\t\t\t\t\t\t\tbind:\"css\",\n\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\tif (!this.Runtime || form.data.tab.indexOf(\"css\")>-1) this.Cm($o, \"css\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\"#xhtml\":{\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"html\")==-1;},\n\t\t\t\t\t\t\t\tbb1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#html\":{\n\t\t\t\t\t\t\tbind:\"html\",\n\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\tif (!this.Runtime || form.data.tab.indexOf(\"html\")>-1) this.Cm($o, \"htmlmixed\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\ttheme: theme||\"default\"\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tHTML:[\n\t\t\t\t\t\t{row:\"750px\", label:\"0px\"},\n\t\t\t\t\t\t'<div class=\"cw-widget-code\">',\n\t\t\t\t\t\t'<div class=\"w180 db oh fs90 lh130 tar\" id=\"ovl\">',\n\t\t\t\t\t\t'<div class=\"w180 dib vat\">',\n\t\t\t\t\t\t'<span id=\"tab\" class=\"fs85\"></span>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xcode\" class=\"w750\">',\n\t\t\t\t\t\t'<div id=\"xhtml\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"html\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xjs\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"js\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\t\n\t\t\t\t\t\t'<div id=\"xcss\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"css\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t],\n\t\t\t\t\tstyle:{\n\t\t\t\t\t\t\" .b0\": \"border:none!important;\",\n\t\t\t\t\t\t\" .CodeMirror\":\"line-height:1.4em;font:14px Cousine,'PT Mono', Monaco,monospace;height:auto;padding:5px 5px 5px 6px;\",\n\t\t\t\t\t\t\" #ovl\" :\"transition: opacity 0.3s; opacity:0.4;position:absolute; top:3px;right:4px;z-index:+5;\",\n\t\t\t\t\t\t\" .bb1\":\"border-bottom:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\" .bt1\":\"border-top:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\"\":{\n\t\t\t\t\t\t\t\"\": \"border:1px solid #C1D0DA; border-radius:4px;overflow:hidden; display:block; min-height:48px;\"\n\t\t\t\t\t\t\t+\"clear:both;margin: 0 0 0.9em 0;padding-bottom:0!important;\",\n\t\t\t\t\t\t\t\":hover #ovl\":\"opacity:1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" label\":\"display:inline-block; color:#777; margin-right:20px;\"\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t//update man\n\t\t$.extend(true, man, {\n\t\t\tui: { \n\t\t\t\t\"#tab\" : {\n\t\t\t\t\tcss: {\n\t\t\t\t\t\thide:function () {return true}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: mode,\n\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\tindentUnit:2,\n\t\t\t\t\ttabSize:2,\n\t\t\t\t\ttheme: theme||\"default\",\n\t\t\t\t\t// edit\n\t\t\t\t\treadOnly: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$elt.my(man, elt);\n\t}\n\n\t// init widget\n\tfunction initWidget(elt) {\n\t\tvar $elt = $('#inliner-widget-'+elt._stamp),\n\t\t\t\tman = {\n\t\t\t\t\tparams:{strict:true},\n\t\t\t\t\tid:\"cw.Inliner.Editor.Items.widget\",\n\t\t\t\t\tName:\"App\",\n\t\t\t\t\tHoverpane:\".cw-widget\",\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\ttype: \"widget\",\n\t\t\t\t\t\ttab:[\"manifest\"],\n\t\t\t\t\t\tjs:\"// Widget manifest\\n({\\n\\tinit: function ($form, form) {\\n\\t\\t// Init code\\n\\t},\\n\\tui: \"\n\t\t\t\t\t\t+\"{\\n\\t\\t// UI bindings\\n\\t}\\t,\\n\\tstyle: {\\n\\t\\t// Local CSS rules\\n\\t}\\n})\",\n\t\t\t\t\t\thtml:\"\",\n\t\t\t\t\t\tdata:\"({\\n\\t//Put default data here\\n})\",\n\t\t\t\t\t\tstate:\"\",\n\t\t\t\t\t\tvalid:false,\n\t\t\t\t\t\terr:[],\n\t\t\t\t\t\toptions:[]\n\t\t\t\t\t},\n\t\t\t\t\tinit: function ($o, form) {\n\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t$o.formgen(this.HTML);\n\t\t\t\t\t\t$o.then(function(){\n\t\t\t\t\t\t\tif (form.data.state) {\n\t\t\t\t\t\t\t\t$o.find(\"#btn-run\").trigger(\"click\");\n\t\t\t\t\t\t\t} else that.XCode($o, form.data);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tui:{\n\t\t\t\t\t\t\"#tab\":{\n\t\t\t\t\t\t\tbind:function (d,v,$o){\n\t\t\t\t\t\t\t\tif (null!=v) {\n\t\t\t\t\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\t\t\t\t\tif ($x.is(\".my-form\")) $x.my(\"redraw\");\n\t\t\t\t\t\t\t\t\td.tab = v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn d.tab;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinit: function ($o) {\n\t\t\t\t\t\t\t\t$o.tags({tags:[{\"HTML\":\"html\"}, {\"Manifest\":\"manifest\"}, {\"Defaults\":\"data\"}]})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#btn-run\":{\n\t\t\t\t\t\t\tbind: function (d,v,$o){\n\t\t\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\t\t\tif (d.valid) {\n\t\t\t\t\t\t\t\t\t\td.state = \"running\";\n\t\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xcode,#tab\").addClass(\"hide\");\n\t\t\t\t\t\t\t\t\t\tvar $a = $o.my(\"find\",\"#xapp\"),\n\t\t\t\t\t\t\t\t\t\t\t\t$v = $o.my(\"find\",\"#xreflect\");\n\t\t\t\t\t\t\t\t\t\t$a.removeClass(\"hide\")\n\t\t\t\t\t\t\t\t\t\t.html(d.html)\n\t\t\t\t\t\t\t\t\t\t.my(eval(d.js),eval(d.data)||{})\n\t\t\t\t\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t\t\t\t\t$a.trigger(\"change\");\n\t\t\t\t\t\t\t\t\t\t}.debounce(50));\n\n\t\t\t\t\t\t\t\t\t\tif (d.options.indexOf(\"show data\")!=-1) {\n\t\t\t\t\t\t\t\t\t\t\t$a.on(\"change.my\", function(){\n\t\t\t\t\t\t\t\t\t\t\t\t$v.html(\n\t\t\t\t\t\t\t\t\t\t\t\t\tcw.lib.js2txt(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$a.my(\"data\"),\"  \")\n\t\t\t\t\t\t\t\t\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/^\\{/,'{ <span class=\"green\">// Form data</span>')\t\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}.debounce(2));\n\t\t\t\t\t\t\t\t\t\t\t$a.addClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t\t$v.addClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t$a.removeClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t\t$v.removeClass(\"xdata\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcw.lib.note(d.err.join(\".<br>\")+\".\", \"error\", 5000);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function(d){return !!d.state},\n\t\t\t\t\t\t\t\t\"red\": function (d) {return !d.valid},\n\t\t\t\t\t\t\t\t\"green\": function (d) {return d.valid}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents:\"click.my\",\n\t\t\t\t\t\t\twatch:\"#btn-code\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#btn-code\":{\n\t\t\t\t\t\t\tbind: function(d,v, $o){\n\t\t\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\t\t\td.state = \"\";\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xapp\").addClass(\"hide\").my(\"remove\");\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xcode, #tab\").removeClass(\"hide\");\n\t\t\t\t\t\t\t\t\t$o.my(\"find\",\"#xreflect\").removeClass(\"xdata\");\n\t\t\t\t\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\t\t\t\t\tif (!$x.is(\".my-form\")) {\n\t\t\t\t\t\t\t\t\t\tthis.XCode($o.my().root, d);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\thide: function(d){return !d.state}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents:\"click.my\",\n\t\t\t\t\t\t\twatch:\"#btn-run\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"#warn\":{\n\t\t\t\t\t\t\tbind:function (d) {\n\t\t\t\t\t\t\t\tvar t=d.js, o, err=[], data;\n\t\t\t\t\t\t\t\ttry { o = eval(t); } catch (e) {}\n\t\t\t\t\t\t\t\ttry { data = eval(d.data); } catch (e) {}\n\t\t\t\t\t\t\t\td.valid=false;\n\t\t\t\t\t\t\t\tif (!Object.isObject(o)) err.push(\"Invalid manifest\");\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tif ( !Object.isObject(o.ui)) err.push(\"No ui section\");\n\t\t\t\t\t\t\t\t\telse if ( !Object.size(o.ui)) err.push(\"No bindings in ui section\");\n\n\t\t\t\t\t\t\t\t\tif  ( !Object.isFunction(o.init) && !Object.isArray(o.init) && !(d.html+\"\").length)\n\t\t\t\t\t\t\t\t\t\terr.push(\"No HTML defined in init function or HTML tab\");\n\n\t\t\t\t\t\t\t\t\tif (!Object.isObject(data))  err.push(\"Defaults must be an object\");\n\n\t\t\t\t\t\t\t\t\tif (o.data!==undefined && !Object.isObject(o.data)) err.push(\"Section ‘data’ must be an object\");\n\t\t\t\t\t\t\t\t\tif (o.params!==undefined && !Object.isObject(o.params)) err.push(\"Section ‘params’ must be an object\");\n\t\t\t\t\t\t\t\t\tif (o.style!==undefined && !Object.isObject(o.style)) err.push(\"Section ‘style’ must be an object\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!err.length) d.valid = true;\n\t\t\t\t\t\t\t\td.err=err;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdelay:500,\n\t\t\t\t\t\t\trecalc:\"#btn-run\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tXCode: function ($form, d){\n\t\t\t\t\t\tthis.XCode3._compiled = this._compiled;\n\t\t\t\t\t\t$form.find(\"#xcode\")\n\t\t\t\t\t\t.my (this.XCode3, d)\n\t\t\t\t\t\t.on(\"change\", function(){\n\t\t\t\t\t\t\t$form.find(\"#warn\").trigger(\"check.my\");\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tXCode3:{\n\t\t\t\t\t\tui:{\n\t\t\t\t\t\t\t\"#xjs\":{css:{hide: function (d) { return d.tab.indexOf(\"manifest\")==-1;}}},\n\t\t\t\t\t\t\t\"#js\":{\n\t\t\t\t\t\t\t\tbind:\"js\",\n\t\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"manifest\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t\"#xdata\":{\n\t\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"data\")==-1;},\n\t\t\t\t\t\t\t\t\tbt1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"#data\":{\n\t\t\t\t\t\t\t\tbind:\"data\",\n\t\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"data\")>-1) this.Cm($o, \"javascript\", true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t\"#xhtml\":{\n\t\t\t\t\t\t\t\tcss:{\n\t\t\t\t\t\t\t\t\thide: function (d) { return d.tab.indexOf(\"html\")==-1;},\n\t\t\t\t\t\t\t\t\tbb1: function (d)  { return d.tab.length>1;}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"#html\":{\n\t\t\t\t\t\t\t\tbind:\"html\",\n\t\t\t\t\t\t\t\tinit: function ($o, form){ \n\t\t\t\t\t\t\t\t\tif (!this._compiled || form.data.tab.indexOf(\"html\")>-1) \n\t\t\t\t\t\t\t\t\t\tthis.Cm($o, \"htmlmixed\", true, \"base16-light\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t\"input[name=options]\":\"options\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\t\t\t\tindentUnit:2,\n\t\t\t\t\t\t\t\ttabSize:2,\n\t\t\t\t\t\t\t\ttheme: theme||\"default\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tCompiler: function ($form, html, css, repo, manifest) {\n\t\t\t\t\t\tvar man = Object.clone(Object.reject(manifest, [\"Compiler\",\"Hoverpane\", /^_/]), true),\n\t\t\t\t\t\t\t\tdata = $form.my(\"data\"),\n\t\t\t\t\t\t\t\ttid = \"form\"+Number.random(1e6,1e7),\n\t\t\t\t\t\t\t\th=\"\", height,\n\t\t\t\t\t\t\t\tinsync=false;\n\t\t\t\t\t\tman.style[\" #xoptions\"] = \"display:none;\";\n\t\t\t\t\t\tman.style[\" #tab\"] = \"display:none;\";\n\t\t\t\t\t\tman._compiled = true;\n\n\t\t\t\t\t\theight = $form.height() - (!data.state?18:-7);\n\t\t\t\t\t\tinsync = data.options.indexOf(\"init sync\")>-1;\n\n\t\t\t\t\t\tif (data.options.indexOf(\"noedit\")>-1) {\n\t\t\t\t\t\t\t// Include only executable manifest\n\t\t\t\t\t\t\tif (data.err.length) throw (new Error (\"Error compiling widget manifest\") );\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tthis.CSSCompiler($form, css);\n\n\t\t\t\t\t\t\t\tvar refl = data.options.indexOf(\"show data\")>-1;\n\n\t\t\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t\t\t'<span id=\"'+tid+'\" class=\"db '+$form.attr(\"class\")+'\" '\n\t\t\t\t\t\t\t\t\t+'style=\"height:'+height+'px;overflow:hidden;\">',\n\t\t\t\t\t\t\t\t\t'<div class=\"cw-widget\">',\n\t\t\t\t\t\t\t\t\t'<div id=\"xapp\" class=\"oh vat'+(refl?' xdata':'')+'\">'+data.html+'</div>',\n\t\t\t\t\t\t\t\t\t(refl?'<div id=\"xreflect\" class=\"oh vat xdata\"></div>':\"\"),\n\t\t\t\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t\t\t\t'</span>',\n\t\t\t\t\t\t\t\t\t'<script>',\n\t\t\t\t\t\t\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t\t\t\t\t\t\t+'(function(){var $f=$(\"#'+tid+'\");$f.find(\"#xapp\").my('+data.js+\", \",\n\t\t\t\t\t\t\t\t\tdata.data+')',\n\t\t\t\t\t\t\t\t\t(refl?'.on(\"change.my\", function(){'\n\t\t\t\t\t\t\t\t\t +'$(this).parent().find(\"#xreflect\").html('\n\t\t\t\t\t\t\t\t\t +'cw.lib.js2txt($(this).my(\"data\"),\"  \").replace(/^\\{/,\\'{ <span class=\"green\">// App data</span>\\')'\n\t\t\t\t\t\t\t\t\t +');'\n\t\t\t\t\t\t\t\t\t +'}.debounce(20))':\"\"),\n\t\t\t\t\t\t\t\t\t'.then(function(){$f.css({\"height\":\"none\", overflow:\"none\"});}.debounce(100))',\n\t\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t\t'<'+'/script>'\n\t\t\t\t\t\t\t\t].join(\"\\n\");\n\n\t\t\t\t\t\t\t\thtml.push(h);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Include full code\n\t\t\t\t\t\t\tvar norepo = !repo[man.id];\n\t\t\t\t\t\t\trepo[man.id]=true;\n\t\t\t\t\t\t\th+=[\n\t\t\t\t\t\t\t\t'<span id=\"'+tid+'\" class=\"db cw-item\" style=\"height:'\n\t\t\t\t\t\t\t\t+height+'px;overflow:hidden;\"></span>',\n\t\t\t\t\t\t\t\t'<script>',\n\t\t\t\t\t\t\t\t(norepo?'$.my.cache('+cw.lib.js2txt(man,\"  \")+');' : ''),\n\t\t\t\t\t\t\t\t'$'+(insync?'':'.my.chain')\n\t\t\t\t\t\t\t\t+'(function(){var $f=$(\"#'+tid+'\"); $f.my(\"'+man.id+'\", ',\n\t\t\t\t\t\t\t\tcw.lib.js2txt(data,\"  \").replace(/<\\//g, '<\\\\u002F')+')',\n\t\t\t\t\t\t\t\t'.then(function(){$f.css({\"height\":\"none\", overflow:\"none\"});}.debounce(100))',\n\t\t\t\t\t\t\t\t'});',\n\t\t\t\t\t\t\t\t'<'+'/script>'\n\t\t\t\t\t\t\t].join('\\n');\n\t\t\t\t\t\t\thtml.push(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tHTML:[\n\t\t\t\t\t\t{row:\"750px\", label:\"0px\"},\n\t\t\t\t\t\t'<div class=\"cw-widget\">',\n\t\t\t\t\t\t'<div class=\"w280 db oh fs90 lh130\" id=\"ovl\">',\n\t\t\t\t\t\t'<div class=\"w200 dib pt7 vat\">',\n\t\t\t\t\t\t'<span id=\"tab\" class=\"fs85\"></span>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div  class=\"w80 dib vat fs95\">',\n\t\t\t\t\t\t'<span id=\"btn-run\" class=\"button fs80 lh130 pb6 fi-play-circle green br100 mr0 fr\"> ',\n\t\t\t\t\t\t'<span class=\"fs110\">Run&nbsp;</span>',\n\t\t\t\t\t\t'</span>',\n\t\t\t\t\t\t'<span id=\"btn-code\" class=\"hide button fs80 fi-pencil lh130 green br100 mr0 fr\">&thinsp;&thinsp;',\n\t\t\t\t\t\t'<span class=\"fs110\">Code</span>',\n\t\t\t\t\t\t'</span>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xcode\" class=\"w750\">',\n\t\t\t\t\t\t'<div id=\"xhtml\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"html\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xjs\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"js\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\t\n\t\t\t\t\t\t'<div id=\"xdata\" class=\"dib vat oh w750 \">',\n\t\t\t\t\t\t'<textarea id=\"data\" class=\"w750 fs80\"></textarea>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xoptions\" class=\"fs75 bt1 pl7 pt3 pb3\">',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"noedit\" />',\n\t\t\t\t\t\t' &nbsp;Disable editor at runtime',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"show data\" />',\n\t\t\t\t\t\t' &nbsp;Reflect form’s data',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t\t'<label>',\n\t\t\t\t\t\t'<input name=\"options\" type=\"checkbox\" value=\"init sync\" />',\n\t\t\t\t\t\t' &nbsp;Init sync',\n\t\t\t\t\t\t'</label>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div id=\"xapp\" class=\"oh hide vat fs80\"></div>',\n\t\t\t\t\t\t'<div id=\"xreflect\" class=\"oh vat\"></div>',\n\t\t\t\t\t\t'<div id=\"warn\" class=\"hide\"></div>',\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t],\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\" .b0\": \"border:none!important;\",\n\t\t\t\t\t\t\" .CodeMirror\":\"font:14px Cousine,'PT Mono',Monaco,monospace;line-height:1.4em;height:auto;\",\n\t\t\t\t\t\t\" #xapp\": {\n\t\t\t\t\t\t\t\"\":\"padding:20px 25px 25px 25px;display:inline-block;\",\n\t\t\t\t\t\t\t\".xdata\" :\"width:445px;padding-right:20px\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" #ovl\" :\"transition: opacity 0.3s; opacity:0.6;position:absolute; top:2px;right:5px;z-index:+2;\",\n\t\t\t\t\t\t\" .bb1\":\"border-bottom:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\" .bt1\":\"border-top:1px solid #C1D0DA;\",\n\t\t\t\t\t\t\"\":{\n\t\t\t\t\t\t\t\"\": \"border:1px solid #C1D0DA; border-radius:4px;overflow:hidden; display:block; min-height:48px;\"\n\t\t\t\t\t\t\t+\"clear:both;margin: 0 0 0.9em 0;padding-bottom:0!important;\",\n\t\t\t\t\t\t\t\":hover #ovl\":\"opacity:1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" label\":\"display:inline-block; color:#777; margin-right:20px;\",\n\t\t\t\t\t\t\" #xreflect\":{\n\t\t\t\t\t\t\t\"\":\"padding:0px 7px 0px 15px; 10px; font:12px Cousine,'PT Mono',Monaco,monospace;line-height:1.2em;height:auto;\"\n\t\t\t\t\t\t\t+\"margin:18px 0 18px 0; border-left:1px dotted #C1D0DA; opacity:0.7;\"\n\t\t\t\t\t\t\t+\"white-space: pre-wrap;word-wrap: break-word;display:none;\",\n\t\t\t\t\t\t\t\".xdata\": \"display:inline-block;width:297px;\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" .my-form-list .fi-list\":\"opacity:0.8;cursor:move\"\n\t\t\t\t\t}\t\n\t\t\t\t};\t\n\n\t\t//update man\n\t\t$.extend(true, man, {\n\t\t\tinit: function ($o, form) {\n\t\t\t\tvar that = this;\n\t\t\t\t$o.formgen(this.HTML);\n\t\t\t\t$o.then(function(){\n\t\t\t\t\tif (form.data.state || form.data.options.find('noedit')) {\n\t\t\t\t\t\t$o.find(\"#btn-run\").trigger(\"click\");\n\t\t\t\t\t\tif (form.data.options.find('noedit')) {\n\t\t\t\t\t\t\t$o.find(\"#btn-run, #btn-code\").css({'display':'none;'});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else that.XCode($o, form.data);\n\t\t\t\t\t$o.find(\"#tab, #xoptions\").addClass('hide');\n\t\t\t\t});\n\t\t\t},\n\t\t\tui: {\n\t\t\t\t\"#btn-run\":{\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){return !!d.state}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"#btn-code\":{\n\t\t\t\t\tbind: function(d,v, $o){\n\t\t\t\t\t\tif (v!=null) {\n\t\t\t\t\t\t\td.state = \"\";\n\t\t\t\t\t\t\t$o.my(\"find\",\"#xapp\").addClass(\"hide\").my(\"remove\");\n\t\t\t\t\t\t\t//edit\n\t\t\t\t\t\t\t$o.my(\"find\",\"#xcode\").removeClass(\"hide\");\n\t\t\t\t\t\t\t$o.my(\"find\",\"#xreflect\").removeClass(\"xdata\");\n\t\t\t\t\t\t\tvar $x = $o.my(\"find\",\"#xcode\");\n\t\t\t\t\t\t\tif (!$x.is(\".my-form\")) {\n\t\t\t\t\t\t\t\tthis.XCode($o.my().root, d);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcss:{\n\t\t\t\t\t\thide: function(d){return (!d.state || !!d.options.find('noedit'))}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tCm: function ($o, mode, lineNums, theme) {\n\t\t\t\tCodeMirror.fromTextArea($o[0], {\n\t\t\t\t\tmode: mode,\n\t\t\t\t\tlineNumbers:lineNums,\n\t\t\t\t\tlineWrapping:true,\n\t\t\t\t\tindentWithTabs:!0,\n\t\t\t\t\tindentUnit:2,\n\t\t\t\t\ttabSize:2,\n\t\t\t\t\ttheme: theme||\"default\",\n\t\t\t\t\treadOnly: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$elt.my(man, elt);\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1458962302544","id": ".X.inliner.rtf","type": "js","data": "(function (data, item, oitems){\n  \n  var that = this,\n      widgets = that.Types.rtf.extend.Inliner.Ed.Widgets;\n\n\t// Converts inliner docs to internal representation,\n\t// \n\titem.doc = $.extend(!0, {}, Object.reject(data,['_attachments','previews']), {_id:item.id, previews:{}});\n\titem.data = \"\";\n\n\t// Reformat references\n\t// and move attachments from imported doc\n\t// to local\n\n\tvar resrc = {}, \n\t\t\tatt0 = {\n\t\t\t\tid:\"\", folder:\"\", name:\"\", mime:\"\", parser:\"\", parserActive:false,\n\t\t\t\text:\"\", cache:\"864000\", data:\"\", snippet:false, size:\"?\",\n\t\t\t\ttype:\"attachment\",\n\t\t\t\tdesc:\"\", \n\t\t\t\tstate:{\n\t\t\t\t\tsavedSdbm:\"\", sdbm:\"Z\",\n\t\t\t\t\tdepends:{}, impacts:{}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdocid = item.doc._id;\n\n\titem.doc.content.forEach(function(elt){\n\t\t\n    _grabFiles(elt)\n\n\t});\n\t\n\tObject.keys(oitems).forEach(function(i){\n\t\tvar it = oitems[i];\n\t\tif (it && it.folder==\"/inliner\" && it.name.startsWith(docid+\"/\")) {\n\t\t\tif (!resrc[it.name] || resrc[it.name] != it.id) oitems[i] = null;\n\t\t}\n\t});\n\t\n\treturn undefined;\n  \n  // - - - - - - - - - - -\n  \n  function _grabFiles(elt) {\n    \n    // Grabs attaches from doc and replace pointers\n    \n    // Widget ====================\n    \n    if (elt.type == 'widget') {\n      var w;\n      if (\n        elt.source && elt.options.indexOf('autoupdate')>-1 \n        && (w = widgets[elt.source])\n        && w.To && w.To.files && w.To.data\n      ) {\n        var wdata = JSON.parse(elt.data.replace(/^\\(|\\)$/g,'')),\n            files = w.To.files(wdata);\n        \n        Object.keys(files).forEach(function(fname){\n        \tif (!data._attachments || !data._attachments[fname]) return;\n          var obj = _copyFile(fname);\n          files[fname] = (obj.folder+'/'+obj.name).substr(1);\n        });\n        \n        elt.data = w.To.data(elt, {Urls:files});\n      }\n    }\n    \n    // Image ====================\n    \n    if (elt.type == \"img\") { \n\n      var obj, id, file;\n\n      // Create item of type:\"attachment\"\n      if (elt.ref && data._attachments && data._attachments[elt.ref]) {\n        // image is attached\n        obj = _copyFile(elt.ref);\n        elt.ref = (obj.folder+'/'+obj.name).substr(1);\n      } \n      else {\n        // image is inlined\n        id = cw.lib.hash8(\"inliner/\" + docid +\"/\"+elt._stamp);\n        obj = $.extend(true, {}, att0, {\n          id: id,\n          folder: \"/inliner\",\n          name: docid+\"/\"+elt._stamp+\".jpg\",\n          mime: \"image/jpeg\",\n          data: {content_type: \"image/jpeg\", data: elt.data},\n          state:{ crc:cw.lib.sdbm(elt.data)}\n        });\n\n        elt.data = \" \";\n        elt.ref = \"inliner/\"+ obj.name;\n\n      }\n\n      if (obj) {\n        // put new type:\"attachment\" item into main doc\n        resrc[obj.name] = obj.id;\n        if (!oitems[id] || oitems[id].state.crc != obj.state.crc) oitems[id] = obj;\n      }\n\n    }\n    \n  }\n  \n  // - - - - - - - - - - -\n  \n  function _copyFile (fname) {\n    \n    // copies attach from inliner to doc,\n    // returns new fname\n    \n  \tvar id = cw.lib.hash8(\"inliner/\" + docid +\"/\"+fname),\n        file = data._attachments[fname];\n    \n    var obj = $.extend(true, {}, att0, {\n      id: id,\n      folder: \"/inliner\",\n      name: docid+\"/\"+fname,\n      mime: file.content_type,\n      data: {\n        content_type: file.content_type,\n        data: file.data\n      },\n      state:{\n        crc:cw.lib.sdbm(file.data)\n      }\n    });\n    \n    // put new type:\"attachment\" item into main doc\n    resrc[obj.name] = obj.id;\n    if (!oitems[id] || oitems[id].state.crc != obj.state.crc) oitems[id] = obj;\n    \n    return obj;\n  }\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1440842075265","id": ".data","type": "js","data": "({\n\t\"doc\": {\n\t\t\"_id\": \"\",\n\t\t\"name\": \"Unnamed _ddoc\",\n\t\t\"type\": \"ddlab\",\n\t\t\"owners\": [],\n\t\t\"acl\": [],\n\t\t\"export\": {\n\t\t\t\"path\": \"\",\n\t\t\t\"options\": [],\n\t\t\t\"lastrev\": \"\",\n\t\t\t\"lastcrc\": \"\"\n\t\t},\n\t\t\"items\": [{\n\t\t\t\t\"id\": \"15tx1fb1\",\n\t\t\t\t\"type\": \"html\",\n\t\t\t\t\"snippet\": false,\n\t\t\t\t\"folder\": \"/\",\n\t\t\t\t\"name\": \"index.html\",\n\t\t\t\t\"ext\": \"\",\n\t\t\t\t\"mime\": \"text/html\",\n\t\t\t\t\"desc\": \"\",\n\t\t\t\t\"external\": \"\",\n\t\t\t\t\"data\": \"<!DOCTYPE html>\\n<html>\\n\\t<head>\\n\\t\\t<title> Insert title </title>\\n\\t</head>\\n\\t<body>\\n\\t\\tHello!\\n\\t</body>\\n</html>\",\n\t\t\t\t\"parser\": \"// Parser receives (item, items)\\n// and must return string representation of item\\n(function (item, items){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n\t\t\t\t\"parserActive\": false,\n\t\t\t\t\"stashResolved\": false,\n\t\t\t\t\"state\": {\n\t\t\t\t\t\"savedSdbm\": \"\",\n\t\t\t\t\t\"sdbm\": \"pnt2wfv\",\n\t\t\t\t\t\"depends\": {\n\t\t\t\t\t},\n\t\t\t\t\t\"impacts\": {\n\t\t\t\t\t},\n\t\t\t\t\t\"crc\": \"\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"1870xsca\",\n\t\t\t\t\"type\": \"rtf\",\n\t\t\t\t\"snippet\": false,\n\t\t\t\t\"folder\": \"/\",\n\t\t\t\t\"name\": \"ww.html\",\n\t\t\t\t\"ext\": \"\",\n\t\t\t\t\"mime\": \"application/json\",\n\t\t\t\t\"desc\": \"\",\n\t\t\t\t\"external\": \"\",\n\t\t\t\t\"data\": \"\",\n\t\t\t\t\"parser\": \"// Parser receives (item, items)\\n// and must return string representation of item\\n(function (item, items){\\n\\n\\treturn item.data+\\\"\\\";\\n})\",\n\t\t\t\t\"parserActive\": false,\n\t\t\t\t\"stashResolved\": false,\n\t\t\t\t\"state\": {\n\t\t\t\t\t\"savedSdbm\": \"\",\n\t\t\t\t\t\"sdbm\": \"\",\n\t\t\t\t\t\"depends\": {\n\t\t\t\t\t},\n\t\t\t\t\t\"impacts\": {\n\t\t\t\t\t},\n\t\t\t\t\t\"crc\": \"\"\n\t\t\t\t},\n\t\t\t\t\"doc\": {\n\t\t\t\t}\n\t\t\t}],\n\t\t\"tabs\": [],\n\t\t\"expanded\": {\n\t\t},\n\t\t\"creds\": {\n\t\t\t\"crypto\": \"\"\n\t\t},\n\t\t\"couch\": {\n\t\t\t\"dburl\": \"\",\n\t\t\t\"docid\": \"\",\n\t\t\t\"login\": \"\",\n\t\t\t\"pwd\": \"\"\n\t\t},\n\t\t\"site\": {\n\t\t\t\"siteBase\": \"\",\n\t\t\t\"previewBase\": \"\"\n\t\t},\n\t\t\"log\": []\n\t},\n\t\"cmd\": \"\"\n})","active": false,"err": [],"opts": ["nocompile"],"color": []},{"stamp": "1438040189199","id": ".HTMLParser","type": "js","data": "(function(global) {\n\t\n\t/*!\n\t * HTML Parser By John Resig (ejohn.org)\n\t * Modified by Juriy \"kangax\" Zaytsev\n\t * Original code by Erik Arvidsson, Mozilla Public License\n\t * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js\n\t */\n\t\n\t'use strict';\n\n\t// Regular Expressions for parsing tags and attributes\n\tvar singleAttrIdentifier = /([\\w:\\.-]+)/,\n\t\t\tsingleAttrAssign = /=/,\n\t\t\tsingleAttrAssigns = [ singleAttrAssign ],\n\t\t\tsingleAttrValues = [\n\t\t\t\t/\"((?:\\\\.|[^\"])*)\"/.source, // attr value double quotes\n\t\t\t\t/'((?:\\\\.|[^'])*)'/.source, // attr value, single quotes\n\t\t\t\t/([^>\\s]+)/.source          // attr value, no quotes\n\t\t\t],\n\t\t\tstartTagOpen = /^<([\\w:-]+)/,\n\t\t\tstartTagClose = /\\s*(\\/?)>/,\n\t\t\tendTag = /^<\\/([\\w:-]+)[^>]*>/,\n\t\t\tendingSlash = /\\/>$/,\n\t\t\tdoctype = /^<!DOCTYPE [^>]+>/i;\n\n\tvar IS_REGEX_CAPTURING_BROKEN = false;\n\t'x'.replace(/x(.)?/g, function(m, g) {\n\t\tIS_REGEX_CAPTURING_BROKEN = g === '';\n\t});\n\n\t// Empty Elements - HTML 4.01\n\tvar empty = makeMap('area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,wbr');\n\n\t// Block Elements - HTML 4.01\n\tvar block = makeMap('a,address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul');\n\n\t// Inline Elements - HTML 4.01\n\tvar inline = makeMap('abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,noscript,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,svg,textarea,tt,u,var');\n\n\t// Elements that you can, intentionally, leave open\n\t// (and which close themselves)\n\tvar closeSelf = makeMap('colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source');\n\n\t// Attributes that have their values filled in disabled='disabled'\n\tvar fillAttrs = makeMap('checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected');\n\n\t// Special Elements (can contain anything)\n\tvar special = makeMap('script,style,noscript,svg');\n\n\tvar reCache = {}, stackedTag, reStackedTag, tagMatch;\n\n\tfunction startTagForHandler( handler ) {\n\t\tvar customStartTagAttrs;\n\n\t\tvar startTagAttrs = new RegExp(\n\t\t\t'(?:\\\\s*[\\\\w:\\\\.-]+'\n\t\t\t+   '(?:\\\\s*'\n\t\t\t+     '(?:' + joinSingleAttrAssigns(handler) + ')'\n\t\t\t+     '\\\\s*(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>\\\\s]+)'\n\t\t\t+   ')?'\n\t\t\t+ ')*'\n\t\t);\n\n\t\tif ( handler.customAttrSurround ) {\n\t\t\tvar attrClauses = [];\n\n\t\t\tfor ( var i = handler.customAttrSurround.length - 1; i >= 0; i-- ) {\n\t\t\t\t// Capture the custom attribute opening and closing markup surrounding the standard attribute rules\n\t\t\t\tattrClauses[i] = '(?:\\\\s*'\n\t\t\t\t+ handler.customAttrSurround[i][0].source\n\t\t\t\t+ startTagAttrs.source\n\t\t\t\t+ handler.customAttrSurround[i][1].source\n\t\t\t\t+ ')';\n\t\t\t}\n\t\t\tattrClauses.unshift(startTagAttrs.source);\n\n\t\t\tcustomStartTagAttrs = new RegExp(\n\t\t\t\t'((?:' + attrClauses.join('|') + ')*)'\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\t// No custom attribute wrappers specified, so just capture the standard attribute rules\n\t\t\tcustomStartTagAttrs = new RegExp('(' + startTagAttrs.source + ')');\n\t\t}\n\n\t\treturn new RegExp(startTagOpen.source + customStartTagAttrs.source + startTagClose.source);\n\t}\n\n\tfunction attrForHandler( handler ) {\n\t\tvar singleAttr = new RegExp(\n\t\t\tsingleAttrIdentifier.source\n\t\t\t+ '(?:\\\\s*'\n\t\t\t+ '(' + joinSingleAttrAssigns( handler ) + ')'\n\t\t\t+ '\\\\s*'\n\t\t\t+ '(?:'\n\t\t\t+ singleAttrValues.join('|')\n\t\t\t+ ')'\n\t\t\t+ ')?'\n\t\t);\n\n\t\tif ( handler.customAttrSurround ) {\n\t\t\tvar attrClauses = [];\n\t\t\tfor ( var i = handler.customAttrSurround.length - 1; i >= 0; i-- ) {\n\t\t\t\tattrClauses[i] = '(?:'\n\t\t\t\t+ '(' + handler.customAttrSurround[i][0].source + ')'\n\t\t\t\t+ singleAttr.source\n\t\t\t\t+ '(' + handler.customAttrSurround[i][1].source + ')'\n\t\t\t\t+ ')';\n\t\t\t}\n\t\t\tattrClauses.unshift('(?:' + singleAttr.source + ')');\n\n\t\t\treturn new RegExp(attrClauses.join('|'), 'g');\n\t\t}\n\t\telse {\n\t\t\treturn new RegExp(singleAttr.source, 'g');\n\t\t}\n\t}\n\n\tfunction joinSingleAttrAssigns( handler ) {\n\t\treturn singleAttrAssigns.concat(\n\t\t\thandler.customAttrAssign || []\n\t\t).map(function (assign) {\n\t\t\treturn '(?:' + assign.source + ')';\n\t\t}).join('|');\n\t}\n\n\tvar HTMLParser = global.HTMLParser = function( html, handler ) {\n\t\tvar index, chars, match, stack = [], last = html, prevTag, nextTag;\n\t\tstack.last = function() {\n\t\t\tvar last = this[ this.length - 1 ];\n\t\t\treturn last && last.tag;\n\t\t};\n\n\t\tvar startTag = startTagForHandler(handler);\n\t\tvar attr = attrForHandler(handler);\n\n\t\twhile ( html ) {\n\t\t\tchars = true;\n\n\t\t\t// Make sure we're not in a script or style element\n\t\t\tif ( !stack.last() || !special[ stack.last() ] ) {\n\n\t\t\t\t// Comment:\n\t\t\t\tif ( /^<!--/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf('-->');\n\n\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\tif ( handler.comment ) {\n\t\t\t\t\t\t\thandler.comment( html.substring( 4, index ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 3 );\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// http://en.wikipedia.org/wiki/Conditional_comment#Downlevel-revealed_conditional_comment\n\t\t\t\tif ( /^<!\\[/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf(']>');\n\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tif ( handler.comment ) {\n\t\t\t\t\t\t\thandler.comment( html.substring(2, index + 1 ), true /* non-standard */ );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 2 );\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ignored elements?\n\t\t\t\telse if ( /^<\\?/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf( '?>', 2 );\n\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\t\thandler.chars( html.substring( 0, index + 2 ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 2 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telse if ( /^<%/.test( html ) ) {\n\t\t\t\t\tindex = html.indexOf( '%>', 2 );\n\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\t\thandler.chars(html.substring( 0, index + 2) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml = html.substring( index + 2 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Doctype:\n\t\t\t\telse if ( (match = doctype.exec( html )) ) {\n\t\t\t\t\tif ( handler.doctype ) {\n\t\t\t\t\t\thandler.doctype( match[0] );\n\t\t\t\t\t}\n\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\tchars = false;\n\t\t\t\t}\n\n\t\t\t\t// End tag:\n\t\t\t\telse if ( /^<\\//.test( html ) ) {\n\t\t\t\t\tmatch = html.match( endTag );\n\n\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\tmatch[0].replace( endTag, parseEndTag );\n\t\t\t\t\t\tprevTag = '/' + match[1].toLowerCase();\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t// Start tag:\n\t\t\t\telse if ( /^</.test( html ) ) {\n\t\t\t\t\tmatch = html.match( startTag );\n\t\t\t\t\tif ( match ) {\n\t\t\t\t\t\thtml = html.substring( match[0].length );\n\t\t\t\t\t\tmatch[0].replace( startTag, parseStartTag );\n\t\t\t\t\t\tprevTag = match[1].toLowerCase();\n\t\t\t\t\t\tchars = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( chars ) {\n\t\t\t\t\tindex = html.indexOf('<');\n\n\t\t\t\t\tvar text = index < 0 ? html : html.substring( 0, index );\n\t\t\t\t\thtml = index < 0 ? '' : html.substring( index );\n\n\t\t\t\t\t// next tag\n\t\t\t\t\ttagMatch = html.match( startTag );\n\t\t\t\t\tif (tagMatch) {\n\t\t\t\t\t\tnextTag = tagMatch[1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ttagMatch = html.match( endTag );\n\t\t\t\t\t\tif (tagMatch) {\n\t\t\t\t\t\t\tnextTag = '/' + tagMatch[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnextTag = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\thandler.chars(text, prevTag, nextTag);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse {\n\n\t\t\t\tstackedTag = stack.last().toLowerCase();\n\t\t\t\treStackedTag = reCache[stackedTag] || (reCache[stackedTag] = new RegExp('([\\\\s\\\\S]*?)<\\/' + stackedTag + '[^>]*>', 'i'));\n\n\t\t\t\thtml = html.replace(reStackedTag, function(all, text) {\n\t\t\t\t\tif (stackedTag !== 'script' && stackedTag !== 'style' && stackedTag !== 'noscript') {\n\t\t\t\t\t\ttext = text\n\t\t\t\t\t\t.replace(/<!--([\\s\\S]*?)-->/g, '$1')\n\t\t\t\t\t\t.replace(/<!\\[CDATA\\[([\\s\\S]*?)\\]\\]>/g, '$1');\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( handler.chars ) {\n\t\t\t\t\t\thandler.chars( text );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '';\n\t\t\t\t});\n\n\t\t\t\tparseEndTag( '', stackedTag );\n\t\t\t}\n\n\t\t\tif ( html === last ) {\n\t\t\t\tthrow 'Parse Error: ' + html;\n\t\t\t}\n\t\t\tlast = html;\n\t\t}\n\n\t\t// Clean up any remaining tags\n\t\tparseEndTag();\n\n\t\tfunction parseStartTag( tag, tagName, rest, unary ) {\n\t\t\tvar unarySlash = false;\n\t\t\t\n\t\t\tif (block[tagName]) {\n\t\t\t\twhile ( !handler.html5 && stack.last() && inline[ stack.last() ]) {\n\t\t\t\t\tparseEndTag( '', stack.last() );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( closeSelf[ tagName ] && stack.last() === tagName ) {\n\t\t\t\tparseEndTag( '', tagName );\n\t\t\t}\n\n\t\t\tunary = empty[ tagName ] || !!unary;\n\n\t\t\tvar attrs = [];\n\n\t\t\trest.replace(attr, function () {\n\t\t\t\tvar name, value, fallbackValue, customOpen, customClose, customAssign, quote;\n\t\t\t\tvar ncp = 7; // number of captured parts, scalar\n\n\t\t\t\t// hackish work around FF bug https://bugzilla.mozilla.org/show_bug.cgi?id=369778\n\t\t\t\tif (IS_REGEX_CAPTURING_BROKEN && arguments[0].indexOf('\"\"') === -1) {\n\t\t\t\t\tif (arguments[3] === '') { arguments[3] = undefined; }\n\t\t\t\t\tif (arguments[4] === '') { arguments[4] = undefined; }\n\t\t\t\t\tif (arguments[5] === '') { arguments[5] = undefined; }\n\t\t\t\t}\n\n\t\t\t\tname = arguments[1];\n\t\t\t\tif ( name ) {\n\t\t\t\t\tcustomAssign = arguments[2];\n\t\t\t\t\tfallbackValue = arguments[3];\n\t\t\t\t\tvalue = fallbackValue || arguments[4] || arguments[5];\n\n\t\t\t\t\tif (customAssign) {\n\t\t\t\t\t\tquote = arguments[0].charAt(name.length + customAssign.length);\n\t\t\t\t\t\tquote = (quote === '\\'' || quote === '\"') ? quote : '';\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse if ( handler.customAttrSurround ) {\n\t\t\t\t\tfor ( var i = handler.customAttrSurround.length - 1; i >= 0; i-- ) {\n\t\t\t\t\t\tname = arguments[i * ncp + 7];\n\t\t\t\t\t\tcustomAssign = arguments[i * ncp + 8];\n\t\t\t\t\t\tif ( name ) {\n\t\t\t\t\t\t\tfallbackValue = arguments[i * ncp + 9];\n\t\t\t\t\t\t\tvalue = fallbackValue\n\t\t\t\t\t\t\t|| arguments[i * ncp + 10]\n\t\t\t\t\t\t\t|| arguments[i * ncp + 11];\n\t\t\t\t\t\t\tcustomOpen = arguments[i * ncp + 6];\n\t\t\t\t\t\t\tcustomClose = arguments[i * ncp + 12];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( value === undefined ) {\n\t\t\t\t\tvalue = fillAttrs[name] ? name : fallbackValue;\n\t\t\t\t}\n\n\t\t\t\tattrs.push({\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\tescaped: value && value.replace(/(^|.)(\"+)/g, function(match) {\n\t\t\t\t\t\treturn match.replace(/\"/g, '&quot;');\n\t\t\t\t\t}),\n\t\t\t\t\tcustomAssign: customAssign || '=',\n\t\t\t\t\tcustomOpen:  customOpen || '',\n\t\t\t\t\tcustomClose: customClose || '',\n\t\t\t\t\tquote: quote || ''\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif ( !unary ) {\n\t\t\t\tstack.push( { tag: tagName, attrs: attrs } );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tunarySlash = tag.match( endingSlash );\n\t\t\t}\n\n\n\t\t\tif ( handler.start ) {\n\t\t\t\thandler.start( tagName, attrs, unary, unarySlash );\n\t\t\t}\n\t\t}\n\n\t\tfunction parseEndTag( tag, tagName ) {\n\t\t\tvar pos;\n\n\t\t\t// If no tag name is provided, clean shop\n\t\t\tif ( !tagName ) {\n\t\t\t\tpos = 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Find the closest opened tag of the same type\n\t\t\t\tvar needle = tagName.toLowerCase();\n\t\t\t\tfor ( pos = stack.length - 1; pos >= 0; pos-- ) {\n\t\t\t\t\tif ( stack[ pos ].tag.toLowerCase() === needle ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( pos >= 0 ) {\n\t\t\t\t// Close all the open elements, up the stack\n\t\t\t\tfor ( var i = stack.length - 1; i >= pos; i-- ) {\n\t\t\t\t\tif ( handler.end ) {\n\t\t\t\t\t\thandler.end( stack[ i ].tag, stack[ i ].attrs );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Remove the open elements from the stack\n\t\t\t\tstack.length = pos;\n\t\t\t}\n\t\t}\n\t};\n\n\tglobal.HTMLtoXML = function( html ) {\n\t\tvar results = '';\n\n\t\tnew HTMLParser(html, {\n\t\t\tstart: function( tag, attrs, unary ) {\n\t\t\t\tresults += '<' + tag;\n\n\t\t\t\tfor ( var i = 0; i < attrs.length; i++ ) {\n\t\t\t\t\tresults += ' ' + attrs[i].name + '=\"' + attrs[i].escaped + '\"';\n\t\t\t\t}\n\n\t\t\t\tresults += (unary ? '/' : '') + '>';\n\t\t\t},\n\t\t\tend: function( tag ) {\n\t\t\t\tresults += '</' + tag + '>';\n\t\t\t},\n\t\t\tchars: function( text ) {\n\t\t\t\tresults += text;\n\t\t\t},\n\t\t\tcomment: function( text ) {\n\t\t\t\tresults += '<!--' + text + '-->';\n\t\t\t},\n\t\t\tignore: function(text) {\n\t\t\t\tresults += text;\n\t\t\t}\n\t\t});\n\n\t\treturn results;\n\t};\n\n\t/*global.HTMLtoDOM = function( html, doc ) {\n\t\t// There can be only one of these elements\n\t\tvar one = makeMap('html,head,body,title');\n\n\t\t// Enforce a structure for the document\n\t\tvar structure = {\n\t\t\tlink: 'head',\n\t\t\tbase: 'head'\n\t\t};\n\n\t\tif ( !doc ) {\n\t\t\tif ( typeof DOMDocument !== 'undefined' ) {\n\t\t\t\tdoc = new DOMDocument();\n\t\t\t}\n\t\t\telse if ( typeof document !== 'undefined' && document.implementation && document.implementation.createDocument ) {\n\t\t\t\tdoc = document.implementation.createDocument('', '', null);\n\t\t\t}\n\t\t\telse if ( typeof ActiveX !== 'undefined' ) {\n\t\t\t\tdoc = new ActiveXObject('Msxml.DOMDocument');\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\tdoc = doc.ownerDocument ||\n\t\t\t\tdoc.getOwnerDocument && doc.getOwnerDocument() ||\n\t\t\t\tdoc;\n\t\t}\n\n\t\tvar elems = [],\n\t\t\t\tdocumentElement = doc.documentElement ||\n\t\t\t\tdoc.getDocumentElement && doc.getDocumentElement();\n\n\t\t// If we're dealing with an empty document then we\n\t\t// need to pre-populate it with the HTML document structure\n\t\tif ( !documentElement && doc.createElement ) {\n\t\t\t(function() {\n\t\t\t\tvar html = doc.createElement('html');\n\t\t\t\tvar head = doc.createElement('head');\n\t\t\t\thead.appendChild( doc.createElement('title') );\n\t\t\t\thtml.appendChild( head );\n\t\t\t\thtml.appendChild( doc.createElement('body') );\n\t\t\t\tdoc.appendChild( html );\n\t\t\t})();\n\t\t}\n\n\t\t// Find all the unique elements\n\t\tif ( doc.getElementsByTagName ) {\n\t\t\tfor ( var i in one ) {\n\t\t\t\tone[ i ] = doc.getElementsByTagName( i )[0];\n\t\t\t}\n\t\t}\n\n\t\t// If we're working with a document, inject contents into\n\t\t// the body element\n\t\tvar curParentNode = one.body;\n\n\t\tnew HTMLParser( html, {\n\t\t\tstart: function( tagName, attrs, unary ) {\n\t\t\t\t// If it's a pre-built element, then we can ignore\n\t\t\t\t// its construction\n\t\t\t\tif ( one[ tagName ] ) {\n\t\t\t\t\tcurParentNode = one[ tagName ];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar elem = doc.createElement( tagName );\n\n\t\t\t\tfor ( var attr in attrs ) {\n\t\t\t\t\telem.setAttribute( attrs[ attr ].name, attrs[ attr ].value );\n\t\t\t\t}\n\n\t\t\t\tif ( structure[ tagName ] && typeof one[ structure[ tagName ] ] !== 'boolean' ) {\n\t\t\t\t\tone[ structure[ tagName ] ].appendChild( elem );\n\t\t\t\t}\n\t\t\t\telse if ( curParentNode && curParentNode.appendChild ) {\n\t\t\t\t\tcurParentNode.appendChild( elem );\n\t\t\t\t}\n\n\t\t\t\tif ( !unary ) {\n\t\t\t\t\telems.push( elem );\n\t\t\t\t\tcurParentNode = elem;\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: function( //tag ) {\n\t\t\t\telems.length -= 1;\n\n\t\t\t\t// Init the new parentNode\n\t\t\t\tcurParentNode = elems[ elems.length - 1 ];\n\t\t\t},\n\t\t\tchars: function( text ) {\n\t\t\t\tcurParentNode.appendChild( doc.createTextNode( text ) );\n\t\t\t},\n\t\t\tcomment: function( // ) {\n\t\t\t\t// create comment node\n\t\t\t},\n\t\t\tignore: function( // ) {\n\t\t\t\t// What to do here?\n\t\t\t}\n\t\t});\n\n\t\treturn doc;\n\t};*/\n\n\tfunction makeMap(str) {\n\t\tvar obj = {}, items = str.split(',');\n\t\tfor ( var i = 0; i < items.length; i++ ) {\n\t\t\tobj[ items[i] ] = true;\n\t\t\tobj[ items[i].toUpperCase() ] = true;\n\t\t}\n\t\treturn obj;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1458874053232","id": ".Att","type": "js","data": "(function (fname, rtype) {\n\t//return undefined;\n\t\n\t// Returns attach in appropriate format, defined by rtype,\n\t// \"url\" returns session or data URL,\n\t// \"data\" returns data URL.\n\t// If rtype is object {content_type:\"mime/type\", data:\"b64\"},\n\t// appends this object to doc attachments.\n\t\n\tvar that = this,\n\t\t\tu = that.SessionUrls || (that.SessionUrls = {}),\n\t\t\td = that.data.doc,\n\t\t\ta = d._attachments || (d._attachments = {}),\n\t\t\tpending = that.PendingUrls || (that.PendingUrls = {});\n\t\n\t// Store\n\tif (fname && Object.isObject(rtype)) {\n\t\ta[fname] = rtype;\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t\treturn a;\n\t}\n\t\n\t// Recalc atts\n\tif (fname === true) {\n\t\tthat.my.find(\"#atts\").trigger(\"recalc\");\n\t}\n\t\n\tif (fname == null) return a;\n\t\n\tif (rtype == \"session\") return u;\n\t\n\tif (rtype==\"url\" && u[fname]) return u[fname];\n\telse {\n\t\tvar pi = $.Deferred(),\n\t\t\t\tid = that.data.doc._id,\n\t\t\t\tdb = that.db;\n\t\t\n\t\tif (!id) pi.reject();\n\t\telse {\n\t\t\t\n\t\t\t//-------------------\n\t\t\t\n\t\t\tif (rtype==\"url\") {\n\t\t\t\t\n\t\t\t\tif (a && a[fname] && a[fname].data) {\n\t\t\t\t\treturn 'data:'+a[fname].content_type+';base64,'+a[fname].data;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (pending[fname]) {\n\t\t\t\t\tpi.resolve();\n\t\t\t\t\treturn pending[fname];\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tpending[fname] = pi.promise();\n\t\t\t\t\tcw.db(that.db.name)\n\t\t\t\t\t.getAttachment(id, fname)\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\tvar url = URL.createObjectURL(blob);\n\t\t\t\t\t\t\tu[fname] = url;\n\t\t\t\t\t\t\tpi.resolve(url);\n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ \n\t\t\t\t\t\t\tpi.reject(); \n\t\t\t\t\t\t\tpending[fname] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//-------------------\n\t\t\t\n\t\t\telse if (rtype==\"data\") {\n\t\t\t\t\n\t\t\t\tif (a && a[fname] && a[fname].data) {\n\t\t\t\t\tpi.resolve (a[fname].data);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcw.db(that.db.name).getAttachment(id, fname)\n\t\t\t\t\t.then (\n\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ pi.resolve(data); });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(){ pi.reject(); }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//-------------------\n\n\t\t\telse if (rtype == \"preview\") {\n\t\t\t\tvar names = [],\n\t\t\t\t\t\tres = [];\n\t\t\t\tif (Object.isString(fname)) names.push(fname);\n\t\t\t\telse if (Object.isArray(fname)) names = fname;\n\t\t\t\telse if (Object.isRegExp(fname)) {\n\t\t\t\t\tnames = Object.keys(a).filter(fname).sortBy();\n\t\t\t\t}\n\t\t\t\tif (!names.length) pi.resolve([]);\n\t\t\t\telse {\n\t\t\t\t\tvar icos = d.previews || (d.previews = {}),\n\t\t\t\t\t\t\tsubnames = Object.keys(icos).intersect(names);\n\t\t\t\t\tif (subnames.length == names.length) {\n\t\t\t\t\t\t// we have all previews\n\t\t\t\t\t\tnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// we have to generate previews\n\t\t\t\t\t\tsubnames.forEach(function(i){\n\t\t\t\t\t\t\tres.push($.extend({fname:i}, icos[i]));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar missing = names.subtract(subnames),\n\t\t\t\t\t\t\t\tpis = [];\n\t\t\t\t\t\t\n\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\tvar pi0 = $.Deferred();\n\t\t\t\t\t\t\tpis.push(pi0);\n\t\t\t\t\t\t\tif (a[i] && a[i].data) {\n\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, a[i].data, pi0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// load attach\n\t\t\t\t\t\t\t\tcw.db(that.db.name).getAttachment(id, i)\n\t\t\t\t\t\t\t\t.then (\n\t\t\t\t\t\t\t\t\tfunction(blob){\n\t\t\t\t\t\t\t\t\t\t$.my.f.blob2base64(blob, function(data){ \n\t\t\t\t\t\t\t\t\t\t\t_genPreview(i, a[i].content_type, data, pi0);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfunction(){ pi0.resolve(null); }\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}); // end forEach\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now pis is list of promises\n\t\t\t\t\t\t$.when.apply(null, pis)\n\t\t\t\t\t\t.done(function(){\n\t\t\t\t\t\t\tfor (var t, j=0; j<arguments.length;j++) {\n\t\t\t\t\t\t\t\tvar t = arguments[j];\n\t\t\t\t\t\t\t\tif (t != null) icos[t.fname] = t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmissing.forEach(function(i){\n\t\t\t\t\t\t\t\tif (icos[i]) res.push(icos[i]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tres.sortBy('fname');\n\t\t\t\t\t\t\tpi.resolve(res);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn pi.promise();\n\n\t\t// - - - - - - - - - - - - - - - \n\n\t\tfunction _genPreview(name,mime, data, pi0){\n\t\t\tvar $i = $('<img src=\"\"/>'),\n\t\t\t\t\tpv = {\n\t\t\t\t\t\tfname:name,\n\t\t\t\t\t\tsize:'?',\n\t\t\t\t\t\tdesc:'',\n\t\t\t\t\t\tdim:'?×?',\n\t\t\t\t\t\tdata:''\n\t\t\t\t\t};\n\t\t\t$i.attr(\"src\",'data:'+mime+';base64,'+data);\n\t\t\t$i.load(function(){\n\t\t\t\tvar ico, \n\t\t\t\t\t\timg = cw.lib.image($i,\"white\");\n\t\t\t\tpv.dim = img.width() + '×'+ img.height();\n\t\t\t\tvar l = (data.length/4*3).round();\n\t\t\t\tpv.size = l.metric(l>1e6?2:0,false).replace(/([a-z])$/i,' $1')+\"b\";\n\t\t\t\tico = img.resample(150);\n\t\t\t\tif (ico.height()>150) ico.resample(22500/ico.height());\n\t\t\t\tpv.data = ico.sharpen(0.2).contrast(1.05).jpeg(0.65);\n\t\t\t\t$i.remove();\n\t\t\t\tpi0.resolve(pv);\n\t\t\t});\n\t\t} \n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9IkdyYWRpZW50XzEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjEuMTMiIHkxPSI5MC40NDEiIHgyPSI2MS4xMyIgeTI9IjExMy4wMDIiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNGRkZGRkYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjZERkJEIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZyBpZD0iTGF5ZXJfMSI+CiAgICA8Zz4KICAgICAgPHBhdGggZD0iTTEyMy42ODYsNi42MzMgQzEyMy42ODYsNi42MzMgMTIzLjk0MSwxNy4xODUgMTIzLjk0MSwxNy4xODUgTDEwNC42NTgsMjYuNDU5IEMxMTMuOTcsMzcuMTAxIDExOC4zNTYsNTAuMDA1IDExOC43MSw2NC4wMzUgQzExOC43MSw5NS43MzcgOTMuMDQ1LDEyMS40MzcgNjEuMzg1LDEyMS40MzcgQzI5LjcyNSwxMjEuNDM3IDQuMDU5LDk1LjczNyA0LjA1OSw2NC4wMzUgQzQuNDU5LDMyLjA5NCAzMC45MDcsNi44MjQgNjAuOTgsNi42NDMgQzkxLjA1Myw2LjQ2MyAxMjMuNjg2LDYuNjMzIDEyMy42ODYsNi42MzMgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgICA8cGF0aCBkPSJNODUuMDM1LDMuNSBDMTA2LjY3OSwzLjUwNyA5Ni44NjgsMy40OTEgMTE0LjQ3LDMuNTMzIEMxMTYuOTgzLDMuNTQxIDExOS4yNTIsMy41NSAxMjEuMjM5LDMuNTU5IEMxMjEuOTM1LDMuNTYxIDEyMi41NDUsMy41NjQgMTIzLjA2NiwzLjU2NyBDMTIzLjM1NCwzLjU2OCAxMjMuMzU0LDMuNTY4IDEyMy41NCwzLjU2OSBDMTIzLjY3NCwzLjU3IDEyMy42NzQsMy41NyAxMjMuNzAyLDMuNTcgQzEyNS4zNTYsMy41NzggMTI2LjcwNCw0LjkwMyAxMjYuNzQ0LDYuNTU5IEMxMjYuNzUyLDYuODg5IDEyNi43NTIsNi44ODkgMTI2Ljc4NCw4LjIwOCBDMTI2LjgyNCw5Ljg1NyAxMjYuODI0LDkuODU3IDEyNi44NzIsMTEuODM1IEMxMjYuOTE5LDEzLjgxMyAxMjYuOTE5LDEzLjgxMyAxMjYuOTU5LDE1LjQ2MiBDMTI2Ljk5MSwxNi43ODEgMTI2Ljk5MSwxNi43ODEgMTI2Ljk5OSwxNy4xMTEgQzEyNy4wMjgsMTguMzE1IDEyNi4zNSwxOS40MjUgMTI1LjI2NSwxOS45NDYgTDEwOS40NDksMjcuNTUzIEMxMTcuNjU4LDM4LjAxOSAxMjEuMTg5LDUwLjgzNyAxMjEuNzY4LDYzLjk1NyBMMTIxLjc2OSw2NC4wMzUgQzEyMS43Nyw5Ny40MjkgOTQuNzM0LDEyNC41IDYxLjM4NSwxMjQuNSBDMjguMDM1LDEyNC41IDEsOTcuNDI5IDEsNjMuOTk2IEMxLjQxNSwzMC44NjcgMjguNzQsMy43NzQgNjAuOTYyLDMuNTggQzYzLjExMSwzLjU2NyA2NS4zMTEsMy41NTYgNjcuNTU3LDMuNTQ2IEM3Ny4yMjIsMy41MSA3MS4zOTYsMy41MjggODUuMDM1LDMuNSB6IE04NS4wNDMsOS42MjcgQzcxLjQxOCw5LjY1NSA3Ny4yMzgsOS42MzcgNjcuNTgzLDkuNjczIEM2NS4zNDEsOS42ODMgNjMuMTQ0LDkuNjk0IDYwLjk5OCw5LjcwNyBDMzIuMTA3LDkuODggNy40OTEsMzQuMjg3IDcuMTE4LDY0LjAzNSBDNy4xMTgsOTQuMDQ1IDMxLjQxNCwxMTguMzczIDYxLjM4NSwxMTguMzczIEM5MS44NzksMTE3Ljk3NiAxMTQuODg1LDk0LjMzOSAxMTUuNjUsNjQuMDcgQzExNS40MDQsNTAuNzA0IDExMC45MDUsMzguNjk5IDEwMi4zNTcsMjguNDc4IEMxMDEuMDIzLDI2Ljk1MyAxMDEuNTA5LDI0LjU3NSAxMDMuMzM0LDIzLjY5NyBMMTIwLjgzNCwxNS4yOCBDMTIwLjgwOCwxNC4xODEgMTIwLjc4MSwxMy4wODIgMTIwLjc1NSwxMS45ODMgQzEyMC43MzYsMTEuMjE3IDEyMC43MTcsMTAuNDUgMTIwLjY5OSw5LjY4MyBDMTE4LjYxNiw5LjY3NCAxMTYuNTM0LDkuNjY3IDExNC40NTEsOS42NiBDOTYuODY1LDkuNjE4IDEwNi42NjcsOS42MzQgODUuMDQzLDkuNjI3IHoiIGZpbGw9IiM2NURGQkQiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik0xMDIuMTM4LDkwLjQ0MSBDOTIuODgyLDEwNC43ODggNzguMDU5LDExMi41NzMgNjEuMTMsMTEzLjAwMiBDNDQuMDE3LDExMi44OTIgMjkuNTk3LDEwNC40ODYgMjAuMTIyLDkwLjQ0MSBMMTAyLjEzOCw5MC40NDEgeiIgZmlsbD0idXJsKCNHcmFkaWVudF8xKSIvPgogICAgPHBhdGggZD0iTTYxLjkxOSw4MSBDNzMuNzc1LDgxIDgyLDczLjY3OCA4Miw2Mi41MjggQzgyLDUxLjM3OCA3My43NzUsNDQgNjEuOTE5LDQ0IEw0Nyw0NCBMNDcsODEgeiBNNjEuOTE5LDc0LjA2NiBMNTUuMDU1LDc0LjA2NiBMNTUuMDU1LDUwLjkzNCBMNjEuOTE5LDUwLjkzNCBDNjkuNjksNTAuOTM0IDczLjc3NSw1NS45ODIgNzMuNzc1LDYyLjUyOCBDNzMuNzc1LDY4Ljc5NiA2OS40MDcsNzQuMDY2IDYxLjkxOSw3NC4wNjYgeiIgZmlsbD0iI0ZGNjU4QiIvPgogIDwvZz4KPC9zdmc+Cg==","_type": ["editor"],"_err": [],"_search": "","_cmd": [{"type": "ddlab","actions": ["create","edit"]}],"_opts": {"compileTo": ["js"],"runWidth": "1350","runMode": ["fullscreen"],"runCss": "","runId": "ddlab"},"_src": "","_new": false,"_desc": "Ddoc source file editor","timeout": "15000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9IkdyYWRpZW50XzEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjEuMTMiIHkxPSI5MC40NDEiIHgyPSI2MS4xMyIgeTI9IjExMy4wMDIiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNGRkZGRkYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjZERkJEIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZyBpZD0iTGF5ZXJfMSI+CiAgICA8Zz4KICAgICAgPHBhdGggZD0iTTEyMy42ODYsNi42MzMgQzEyMy42ODYsNi42MzMgMTIzLjk0MSwxNy4xODUgMTIzLjk0MSwxNy4xODUgTDEwNC42NTgsMjYuNDU5IEMxMTMuOTcsMzcuMTAxIDExOC4zNTYsNTAuMDA1IDExOC43MSw2NC4wMzUgQzExOC43MSw5NS43MzcgOTMuMDQ1LDEyMS40MzcgNjEuMzg1LDEyMS40MzcgQzI5LjcyNSwxMjEuNDM3IDQuMDU5LDk1LjczNyA0LjA1OSw2NC4wMzUgQzQuNDU5LDMyLjA5NCAzMC45MDcsNi44MjQgNjAuOTgsNi42NDMgQzkxLjA1Myw2LjQ2MyAxMjMuNjg2LDYuNjMzIDEyMy42ODYsNi42MzMgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgICA8cGF0aCBkPSJNODUuMDM1LDMuNSBDMTA2LjY3OSwzLjUwNyA5Ni44NjgsMy40OTEgMTE0LjQ3LDMuNTMzIEMxMTYuOTgzLDMuNTQxIDExOS4yNTIsMy41NSAxMjEuMjM5LDMuNTU5IEMxMjEuOTM1LDMuNTYxIDEyMi41NDUsMy41NjQgMTIzLjA2NiwzLjU2NyBDMTIzLjM1NCwzLjU2OCAxMjMuMzU0LDMuNTY4IDEyMy41NCwzLjU2OSBDMTIzLjY3NCwzLjU3IDEyMy42NzQsMy41NyAxMjMuNzAyLDMuNTcgQzEyNS4zNTYsMy41NzggMTI2LjcwNCw0LjkwMyAxMjYuNzQ0LDYuNTU5IEMxMjYuNzUyLDYuODg5IDEyNi43NTIsNi44ODkgMTI2Ljc4NCw4LjIwOCBDMTI2LjgyNCw5Ljg1NyAxMjYuODI0LDkuODU3IDEyNi44NzIsMTEuODM1IEMxMjYuOTE5LDEzLjgxMyAxMjYuOTE5LDEzLjgxMyAxMjYuOTU5LDE1LjQ2MiBDMTI2Ljk5MSwxNi43ODEgMTI2Ljk5MSwxNi43ODEgMTI2Ljk5OSwxNy4xMTEgQzEyNy4wMjgsMTguMzE1IDEyNi4zNSwxOS40MjUgMTI1LjI2NSwxOS45NDYgTDEwOS40NDksMjcuNTUzIEMxMTcuNjU4LDM4LjAxOSAxMjEuMTg5LDUwLjgzNyAxMjEuNzY4LDYzLjk1NyBMMTIxLjc2OSw2NC4wMzUgQzEyMS43Nyw5Ny40MjkgOTQuNzM0LDEyNC41IDYxLjM4NSwxMjQuNSBDMjguMDM1LDEyNC41IDEsOTcuNDI5IDEsNjMuOTk2IEMxLjQxNSwzMC44NjcgMjguNzQsMy43NzQgNjAuOTYyLDMuNTggQzYzLjExMSwzLjU2NyA2NS4zMTEsMy41NTYgNjcuNTU3LDMuNTQ2IEM3Ny4yMjIsMy41MSA3MS4zOTYsMy41MjggODUuMDM1LDMuNSB6IE04NS4wNDMsOS42MjcgQzcxLjQxOCw5LjY1NSA3Ny4yMzgsOS42MzcgNjcuNTgzLDkuNjczIEM2NS4zNDEsOS42ODMgNjMuMTQ0LDkuNjk0IDYwLjk5OCw5LjcwNyBDMzIuMTA3LDkuODggNy40OTEsMzQuMjg3IDcuMTE4LDY0LjAzNSBDNy4xMTgsOTQuMDQ1IDMxLjQxNCwxMTguMzczIDYxLjM4NSwxMTguMzczIEM5MS44NzksMTE3Ljk3NiAxMTQuODg1LDk0LjMzOSAxMTUuNjUsNjQuMDcgQzExNS40MDQsNTAuNzA0IDExMC45MDUsMzguNjk5IDEwMi4zNTcsMjguNDc4IEMxMDEuMDIzLDI2Ljk1MyAxMDEuNTA5LDI0LjU3NSAxMDMuMzM0LDIzLjY5NyBMMTIwLjgzNCwxNS4yOCBDMTIwLjgwOCwxNC4xODEgMTIwLjc4MSwxMy4wODIgMTIwLjc1NSwxMS45ODMgQzEyMC43MzYsMTEuMjE3IDEyMC43MTcsMTAuNDUgMTIwLjY5OSw5LjY4MyBDMTE4LjYxNiw5LjY3NCAxMTYuNTM0LDkuNjY3IDExNC40NTEsOS42NiBDOTYuODY1LDkuNjE4IDEwNi42NjcsOS42MzQgODUuMDQzLDkuNjI3IHoiIGZpbGw9IiM2NURGQkQiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik0xMDIuMTM4LDkwLjQ0MSBDOTIuODgyLDEwNC43ODggNzguMDU5LDExMi41NzMgNjEuMTMsMTEzLjAwMiBDNDQuMDE3LDExMi44OTIgMjkuNTk3LDEwNC40ODYgMjAuMTIyLDkwLjQ0MSBMMTAyLjEzOCw5MC40NDEgeiIgZmlsbD0idXJsKCNHcmFkaWVudF8xKSIvPgogICAgPHBhdGggZD0iTTYxLjkxOSw4MSBDNzMuNzc1LDgxIDgyLDczLjY3OCA4Miw2Mi41MjggQzgyLDUxLjM3OCA3My43NzUsNDQgNjEuOTE5LDQ0IEw0Nyw0NCBMNDcsODEgeiBNNjEuOTE5LDc0LjA2NiBMNTUuMDU1LDc0LjA2NiBMNTUuMDU1LDUwLjkzNCBMNjEuOTE5LDUwLjkzNCBDNjkuNjksNTAuOTM0IDczLjc3NSw1NS45ODIgNzMuNzc1LDYyLjUyOCBDNzMuNzc1LDY4Ljc5NiA2OS40MDcsNzQuMDY2IDYxLjkxOSw3NC4wNjYgeiIgZmlsbD0iI0ZGNjU4QiIvPgogIDwvZz4KPC9zdmc+Cg==","maskstate": "","nodetitle": "doc.name","nodedoc": "doc","nodecmd": "cmd","types": "","width": [[980,1420],1200,1420],"collapsed": [".AddImage",".DocParams"],"padding": "auto"},"log": [[1539883544606,"update","ermouth-524yb546",637,"dev-cloudwall2"]],"id": "cw.DdocLab.Editor","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9IkdyYWRpZW50XzEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjEuMTMiIHkxPSI5MC40NDEiIHgyPSI2MS4xMyIgeTI9IjExMy4wMDIiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNGRkZGRkYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjZERkJEIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZyBpZD0iTGF5ZXJfMSI+CiAgICA8Zz4KICAgICAgPHBhdGggZD0iTTEyMy42ODYsNi42MzMgQzEyMy42ODYsNi42MzMgMTIzLjk0MSwxNy4xODUgMTIzLjk0MSwxNy4xODUgTDEwNC42NTgsMjYuNDU5IEMxMTMuOTcsMzcuMTAxIDExOC4zNTYsNTAuMDA1IDExOC43MSw2NC4wMzUgQzExOC43MSw5NS43MzcgOTMuMDQ1LDEyMS40MzcgNjEuMzg1LDEyMS40MzcgQzI5LjcyNSwxMjEuNDM3IDQuMDU5LDk1LjczNyA0LjA1OSw2NC4wMzUgQzQuNDU5LDMyLjA5NCAzMC45MDcsNi44MjQgNjAuOTgsNi42NDMgQzkxLjA1Myw2LjQ2MyAxMjMuNjg2LDYuNjMzIDEyMy42ODYsNi42MzMgeiIgZmlsbD0iI0ZGRkZGRiIvPgogICAgICA8cGF0aCBkPSJNODUuMDM1LDMuNSBDMTA2LjY3OSwzLjUwNyA5Ni44NjgsMy40OTEgMTE0LjQ3LDMuNTMzIEMxMTYuOTgzLDMuNTQxIDExOS4yNTIsMy41NSAxMjEuMjM5LDMuNTU5IEMxMjEuOTM1LDMuNTYxIDEyMi41NDUsMy41NjQgMTIzLjA2NiwzLjU2NyBDMTIzLjM1NCwzLjU2OCAxMjMuMzU0LDMuNTY4IDEyMy41NCwzLjU2OSBDMTIzLjY3NCwzLjU3IDEyMy42NzQsMy41NyAxMjMuNzAyLDMuNTcgQzEyNS4zNTYsMy41NzggMTI2LjcwNCw0LjkwMyAxMjYuNzQ0LDYuNTU5IEMxMjYuNzUyLDYuODg5IDEyNi43NTIsNi44ODkgMTI2Ljc4NCw4LjIwOCBDMTI2LjgyNCw5Ljg1NyAxMjYuODI0LDkuODU3IDEyNi44NzIsMTEuODM1IEMxMjYuOTE5LDEzLjgxMyAxMjYuOTE5LDEzLjgxMyAxMjYuOTU5LDE1LjQ2MiBDMTI2Ljk5MSwxNi43ODEgMTI2Ljk5MSwxNi43ODEgMTI2Ljk5OSwxNy4xMTEgQzEyNy4wMjgsMTguMzE1IDEyNi4zNSwxOS40MjUgMTI1LjI2NSwxOS45NDYgTDEwOS40NDksMjcuNTUzIEMxMTcuNjU4LDM4LjAxOSAxMjEuMTg5LDUwLjgzNyAxMjEuNzY4LDYzLjk1NyBMMTIxLjc2OSw2NC4wMzUgQzEyMS43Nyw5Ny40MjkgOTQuNzM0LDEyNC41IDYxLjM4NSwxMjQuNSBDMjguMDM1LDEyNC41IDEsOTcuNDI5IDEsNjMuOTk2IEMxLjQxNSwzMC44NjcgMjguNzQsMy43NzQgNjAuOTYyLDMuNTggQzYzLjExMSwzLjU2NyA2NS4zMTEsMy41NTYgNjcuNTU3LDMuNTQ2IEM3Ny4yMjIsMy41MSA3MS4zOTYsMy41MjggODUuMDM1LDMuNSB6IE04NS4wNDMsOS42MjcgQzcxLjQxOCw5LjY1NSA3Ny4yMzgsOS42MzcgNjcuNTgzLDkuNjczIEM2NS4zNDEsOS42ODMgNjMuMTQ0LDkuNjk0IDYwLjk5OCw5LjcwNyBDMzIuMTA3LDkuODggNy40OTEsMzQuMjg3IDcuMTE4LDY0LjAzNSBDNy4xMTgsOTQuMDQ1IDMxLjQxNCwxMTguMzczIDYxLjM4NSwxMTguMzczIEM5MS44NzksMTE3Ljk3NiAxMTQuODg1LDk0LjMzOSAxMTUuNjUsNjQuMDcgQzExNS40MDQsNTAuNzA0IDExMC45MDUsMzguNjk5IDEwMi4zNTcsMjguNDc4IEMxMDEuMDIzLDI2Ljk1MyAxMDEuNTA5LDI0LjU3NSAxMDMuMzM0LDIzLjY5NyBMMTIwLjgzNCwxNS4yOCBDMTIwLjgwOCwxNC4xODEgMTIwLjc4MSwxMy4wODIgMTIwLjc1NSwxMS45ODMgQzEyMC43MzYsMTEuMjE3IDEyMC43MTcsMTAuNDUgMTIwLjY5OSw5LjY4MyBDMTE4LjYxNiw5LjY3NCAxMTYuNTM0LDkuNjY3IDExNC40NTEsOS42NiBDOTYuODY1LDkuNjE4IDEwNi42NjcsOS42MzQgODUuMDQzLDkuNjI3IHoiIGZpbGw9IiM2NURGQkQiLz4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik0xMDIuMTM4LDkwLjQ0MSBDOTIuODgyLDEwNC43ODggNzguMDU5LDExMi41NzMgNjEuMTMsMTEzLjAwMiBDNDQuMDE3LDExMi44OTIgMjkuNTk3LDEwNC40ODYgMjAuMTIyLDkwLjQ0MSBMMTAyLjEzOCw5MC40NDEgeiIgZmlsbD0idXJsKCNHcmFkaWVudF8xKSIvPgogICAgPHBhdGggZD0iTTYxLjkxOSw4MSBDNzMuNzc1LDgxIDgyLDczLjY3OCA4Miw2Mi41MjggQzgyLDUxLjM3OCA3My43NzUsNDQgNjEuOTE5LDQ0IEw0Nyw0NCBMNDcsODEgeiBNNjEuOTE5LDc0LjA2NiBMNTUuMDU1LDc0LjA2NiBMNTUuMDU1LDUwLjkzNCBMNjEuOTE5LDUwLjkzNCBDNjkuNjksNTAuOTM0IDczLjc3NSw1NS45ODIgNzMuNzc1LDYyLjUyOCBDNzMuNzc1LDY4Ljc5NiA2OS40MDcsNzQuMDY2IDYxLjkxOSw3NC4wNjYgeiIgZmlsbD0iI0ZGNjU4QiIvPgogIDwvZz4KPC9zdmc+Cg==","stamp": 1539883544604,"creator": "ermouth-1ermouth","_attachments": {"logo70.png": {"content_type": "image/png","data": "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAC7lJREFUeNrsW21sU9cZfh2O4SRcNzY4zEEOSqokCyzpQgsUNJigAi0gSKHVWNeNap00Wqb2B1X3Y5OmrvuxVZu0L7StU9WiCm3VihS2hI1sZBBUNNbBAI0IsiQiaZMt3mJmQ0x8Ux/wnvfe68R27CSOHeKIHen4nvvp+z7n/T7vtUWjUbqfWwHd5812r/5o/YfvFrqV9OqKHILIgUNFhAEpYxJscZ1SbCd73+gU42jCWNBdpai3rbqxk7l/1gDY2tVcA/o+heGj6NXoy+8l4FO0qCL1xZNVe/4qcvnUhqtN5STEkxjuRvfwMUHCXihoEbYL8WcLLbErEGnFT+QQJJVKwUUHld6P96nHODcANHQ1r8bmBfRP874kUVQohMZbQWT+B349QpKGs1II4+DYiRjpszDVKm48oEI0oIdioNiz/k+weQUe8E0MN/GMOoR0gugHmGgNRNZIN9VJJ5Wjl9oL55zvTwR66ZgesmUNQP3FX9g9WulXMdyPB0gQ7gLhxQxCveamTZqH6gpL8k/lCxGvTBfOCICGriYvbvsJhnUOsDlY2s0cvV56aJeznEryYKZTtQBFqFsPxkTNpmbCAQ1dv98EqfoRbnK6hFyGWdeYvZ911+QFi6dqQ5EwnQj10dmQj2D+ojqpYRB/F6ciGQEARfc4iH8Nk11UImSpFGT/rLOStjjK8pLwQRDeEuyjC0w4CAbht4aVCiqGgeiykvLItAEA8U9j8y3W6pj5UreQBS96aqnM7sg7wnsjwwbhHSF/jPCbw0oH4XQHp99Hf721uvGsaRCn4QiB+B3Y/BCmy+Ei6SmXmu1gaT1cOXvezfg7wU7qDAWZ8DsgPAjCb1rsfgbbn8H7u5jgEESjk3PAzq7mdbjx+5j5xUx8pXSC+NWUj9J+xA/i9eCdEOkBsPpNMgn/A5j8563VO66mNQyTEO8G8VB4IB5s7zVmvpbyU9URaaaJs4UVjVi+/1fA6mdmFg1Go2wmfoDRshIhSp1CFBx014N4O+Vr21dSQ6ybWEFbbvbzTMeMAGjobnkKmw2Y+RL24Q+4a8llz1/iubFOOgDFDEaw83vj0BrQ8UzGAGz98I9LsHkZcl+owa1l56aq0DUvYvsKWKVdWjnHIg62WDj00uarTUszAkDo+kvYFLOj45aSGlwV8yrBsQvv65EaWVxQBOv1wrQBwOyXYvMEXFwOaOz7nDVkp/nXPg8Hjd+f6cDu5yy6pgYAs/8cBwnw710webRynrB+cuP35vcHHSzOdqHU01MCsPNiM8vMHqDGKSuxB7I/n9t2p5e5QEAEFsP73Vtz9d2Fk/oBSqPthsxA8bEM5UzxhRFz9A2kD081SeR2Yp5yK2wcjsMskq5UMbzC2+VCbuwkOjWZI7Sb01cAQHI8n7MWDBG9cWKKOB29EkHVpnrwb+6Cq7WgwxfsK2S/AH7NZygFAAVx7P8Ix/e8v97hubf8yvFZZz+AaiF664TJNTloazS3EfsXshgQbU6rA8D+jxrKAiIAl3d2A51yKOTaCrPXYLbdWuL5jl6iw8etaD27xtGqZuQfBXvwSziFl04E1rEfjQtlnXTPsqFeD48lySr1DxEda4euGDL3ewaJ2s5Dk63N+u/YGgRDPmkR+whHzKmsQLU009Y2hLv3XmWXwWc5sJvIG5dHfO9STkShAgCwO2/lAavSmcFK8L9hJjxiDgDgxlZg+/rxfR2Koacv68dyKt6cfcFyPcG2F2w+dYrFYLlxAUZzmttjCyDiDNOAP+tHumMACEOxTTAxBcLjf8AaL9BmZWkiw+aU4+OQnv3j7ObzQP0CbFwTAZCaw1IQBTIfANBVoqOUZZPjFq2AzEXZCTpgkTW2CTHHAAwFEmedPcRsVcuYuRPxtMYBoPQRyxe5q5SaWwBOXkjcr/Fm/cjImK+lOEc4MhEAXd6OJcJ0mkMATsLuX+iOM+DQVyXZxyP6uEfFANyemP/wy2HpDXHOXIXAAZE4tpmV1ucbl3PmOH+Q6Pw1gtMeJ7gQxT0bcxOKRPQYJzCNwQkAtD/2mGroah4AixSzpPgj4dk1hS3nptBaIH4fAtPS3ESjPqXHsP4o2QuMd4WvhxVVOYW5hj5nvgDHB+wql+QuEePTQyzYXBESgVW5ng6ATlywhRVhtx4sWJvLpW2e0Zqy9OcKYae9iD8qvTklPNZ4RRi0jVps0JkOAObLA7gw3KkHFydfFIBY9IEzMg78hJNcLpje/bvmhKFYn/UoY6ksbBH7fhoAxEXAMworEAbLLGaCXXFiAFDosL8z4xfgPL3LPneFEp3hgKFnw0oxAN3Hqxv9KQFord4xCkX4Z+iBbZqgpX/Rfbbt9ooEf7pWyzxMdpKcU7finLk0zgulI6myQYkpMUHH4AhtYTF4L+gr2u4YB4Dzg1XzLEMchgBc1n3EBRGWFfhN2owQN4eu/wmbW1xI4IfpuBQeovnc2gMD7G5Eh5W6xXmmtlWNPZMCcHTVXraTv8INIXDBR1xkMF8bK7+ToQHW/reZFuy+le7ahIURpfTDzD2wnIEB2M/zSVwQyeMe344HeimoFM8+oiv6oLXq0u/SAZAQ/rWt2vtfKMMjuHG/FKr4HX+PrC1zji2Ls6Osp4o0+HREmY+zx52zJ1+T5Gfn6H4tbk2BK0VOhvoM2ddN+3+IbK/cnRYAxoEQ/VRptAsgLBKke48GemzPuFYa5xgIf2SYFxsSb1IZjFPFW1ncz1lfVxwqXCkC2b8zrHQ2eRdaqxt/O5m4TADg+MONI+CC7wC9Q+iBs0Hfkio4NBscZiaXU83XwFlzGjnGEV8aV6h1DKzfA58lRPoQ3m4Uru8rUz0jbQUFQPgeNntKhFyuCVn0NU+9sf4e47wO6IfQHOYPmPjVcS4766s3fB0gXt0MKJ2V12uY/Tcne8ak5fJc3+/UZRNY5OMlQvM6hbB/3bNmrBKUQbiMPw0qkxeyySVlej9neuNLca/B4zvkv8wTEh5S+j9x6DSI3z/Vc6b8XsAqf/+1ILEMnOCFRygOghPio0VG/hqXoDI3iCSKkrfJ8pzumjT38xoPL9zUxTllJvEdkHt9dFDpvArbhSufgnd7K2sATBCa6/C/R/DnLlMchHgRIFTFyR5r3rOwuwE1UTOINHov1blU18aOlQmNNrq8CQrv3PAgHQ52Ans1ipn/F67r13Xa2/5Q47+nw0nT/mJka1fTOgDwugmCWA4MFnKZ7LakMln2Hs+H/GBFPWeyzmU6G6QnwRVn8Tsa6Kb24AAr4xEQP4hD/eDWL7U+uOOD6T47o09mGrqaYAvFm5iRj8UKpTlA2gcgXEkJlCsA4grEokcPzjCVLWildBoBWEVSOW4/zDBHpn16iHOYQXDdDRz+B97tWbB9Rv57xt8Mbe1qXg4AfoxhvUOIYo3kUilEAVeSbQU32FMEJB3hIH+lQb2Iyzk9ZfoQaozVmVgnlJoXLF4mNSoXqYszhvGslkCfMeu4V4Hw/1hR3gnI/zfaV+3NOGExo4+meClNekMvY/hl1ktcjcXcwGZpm9NLGx3eKZfXw5ZHqeG6qRKwnJtog345HTKDG900czeMhC/Rd6HtfzlT8crqqzFwwycBwKsYfgIALAJHLOGaYtZa9dDUXJ1RW+icUXVpIALOgSPH8XyPkdIy6/zZtzdyewj2wEzfbnuosT8b/ZL9Z3PRVwsautc+CY58HnsreBmai6y4UDH2sRQXXBjfDIHNeeWZOUWSGNPubDfYl2DxGISocArLr1uZXERyGIFw/ZZV7n6FfXvM+ulcKNjcfTdoALGaE39fQF9tybYsFILrc9AF4gpjcXIqh0gpMzU3ElYUtkJZxuksEHu79UGrzj9HbVY+nNx5vXkFqHgcw03odTH3RhjfChpr9AuwY8PAFuGqbkV3eXYt1o6OqQmiv6GfgdJsaV/1xI3ZcKdn9ctRA4yLzUWILJkjKtE5x7bC0H1mX2gpMl6u4vp+zsD0wpZ3+YL9f7/88HMRmuVmAPD/r8fv8/Y/AQYAE8iqJFe6aqQAAAAASUVORK5CYII="}}},{"_id": "cw-Photon-1ccd","_rev": "1912-1d16156f8e7c7c0f03e990bcd5f51a71","name": "Photon","title": "Photon","type": "manifest","desc": "","beta": false,"tags": ["CW","CW apps"],"manifest": {"id": "cw.Photon","build": 19,"app": {"name": "Photon","title": "Photon","version": "1.3","build": 19,"timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPGcgb3BhY2l0eT0iMC45Ij4KICAgICAgPHBhdGggZD0iTTEwNy4xMzgsNzQuNTY4IEwxMDcuMTM4LDg0LjY3OSBMMjAuODYyLDg0LjY3OSBMMjAuODYyLDc0LjU2OCBMMTA3LjEzOCw3NC41NjggeiIgZmlsbD0iI0U5MTMxMyIvPgogICAgICA8cGF0aCBkPSJNMjYuMDU5LDQ3Ljc1NiBMMjYuMTE1LDQ4LjE4OSBDMjYuMjU4LDQ5LjIzNCAyNi4zOTUsNTAuMTMxIDI2LjUyNyw1MC44NzggQzI3LjEzOSw1NC4zNCAyOC44MDIsNTcuMjA0IDMxLjMwMSw1OS4xODEgQzMzLjQ1Miw2MC44ODIgMzYuMDk0LDYxLjgyOCAzOC42MzUsNjEuNzk5IEMzOS44MzcsNjEuNzg2IDQxLjEyNSw2MS43OTMgNDYuNDA5LDYxLjgzNyBDNDcuMjQ4LDYxLjg0NCA0Ny44NzIsNjEuODQ5IDQ4LjQ4Niw2MS44NTMgQzUyLjY1Miw2MS44ODQgNTUuMzQzLDYxLjg4OSA1Ny4xNTIsNjEuODU5IEM1OS44MjUsNjIuMDQ4IDYxLjM2NCw2My41MzUgNjIuMjcsNjYuMDEyIEw2Mi4yNyw3MS4wMDQgTDIwLjg2Miw3MS4wMDQgTDIwLjg2Miw0OS45NTcgQzIyLjAwNCw0OS40NTEgMjMuMTQzLDQ4LjkzOSAyNC4yOCw0OC40MjMgQzI0Ljg1Niw0OC4xNTkgMjUuNDY4LDQ3Ljk4NCAyNi4wNTksNDcuNzU2IHogTTEwMS45NDEsNDcuNzU2IEwxMDEuODg0LDQ4LjE5MiBDMTAxLjc0Miw0OS4yMzQgMTAxLjYwNSw1MC4xMzEgMTAxLjQ3Myw1MC44NzggQzEwMC44NjEsNTQuMzQgOTkuMTk4LDU3LjIwNCA5Ni42OTksNTkuMTgxIEM5NC41NDgsNjAuODgyIDkxLjkwNiw2MS44MjggODkuMzY1LDYxLjc5OSBDODguMTYzLDYxLjc4NiA4Ni44NzUsNjEuNzkzIDgxLjU5MSw2MS44MzcgQzgwLjc1Miw2MS44NDQgODAuMTI4LDYxLjg0OSA3OS41MTQsNjEuODUzIEM3NS4zNDgsNjEuODg0IDcyLjY1Nyw2MS44ODkgNzAuODQ4LDYxLjg1OSBDNjguMjE4LDYxLjg3MSA2Ni42NTIsNjMuNzU0IDY1LjczLDY2LjAxMiBMNjUuNzMsNzEuMDA0IEwxMDcuMTM4LDcxLjAwNCBMMTA3LjEzOCw0OS45NTcgQzEwNS45OTYsNDkuNDUgMTA0Ljg1Nyw0OC45NCAxMDMuNzIsNDguNDIzIEMxMDMuMTQ0LDQ4LjE2MyAxMDIuNTM2LDQ3Ljk3MSAxMDEuOTQxLDQ3Ljc1NiBMMTAxLjk0MSw0Ny43NTYgeiIgZmlsbD0iI0ZGMzMzMyIvPgogICAgICA8cGF0aCBkPSJNNjIuMjcsNDEuMzIxIEw2Mi4yNyw2MC4xMDMgQzYxLjA4LDU5LjA0NiA1OS42MzEsNTguNDM3IDU4LjAzNCw1OC4zMTcgQzQ3LjU0NCw1OC4yNDcgNDQuMjYxLDU4LjIzNCA0MC4wODUsNTguMjM1IEMzOS4zNDcsNTguMjM2IDM5LjExMiw1OC4yMzYgMzguOTQ0LDU4LjIzNiBDMzQuNDcsNTguMjM2IDMwLjU3NSw1NC44OTMgMjkuNzM1LDUwLjA4NCBDMjkuNjE2LDQ5LjQgMjkuNDg5LDQ4LjU1NyAyOS4zNTcsNDcuNTc0IEwyOS4yNTUsNDYuNzc4IEMzOS45MTYsNDMuMjE2IDUxLjAxNiw0MS4zNTcgNjIuMjcsNDEuMzIxIHogTTY1LjczLDQxLjMyMSBMNjUuNzMsNjAuMTA1IEM2Ni44NzQsNTguOTQzIDY4LjQ0OCw1OC41MjEgNzAuMDEzLDU4LjMxNSBDODAuNDU2LDU4LjI0NyA4My43MzksNTguMjM0IDg3LjkxNSw1OC4yMzUgQzg4LjY1Myw1OC4yMzYgODguODg4LDU4LjIzNiA4OS4wNTYsNTguMjM2IEM5My41Myw1OC4yMzYgOTcuNDI1LDU0Ljg5MyA5OC4yNjQsNTAuMDg0IEM5OC4zODQsNDkuNCA5OC41MTEsNDguNTU3IDk4LjY0Myw0Ny41NzggTDk4Ljc0NSw0Ni43NzggQzg4LjE1NCw0Mi45NjcgNzYuOTMxLDQxLjU2MyA2NS43Myw0MS4zMjEgeiIgZmlsbD0iI0ZGNjc2NyIvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==","maskstate": ["path"],"nodetitle": "name","width": [[1024,2560],1200,1400],"collapsed": [".$about",".$config",".$doc",".$log",".$view",".Ed",".IndexEd",".MangoEd",".NewSync",".SVG",".UserDoc",".ViewEd"],"padding": "none"},"Version": "1.3","Cfg": {"rootRepo": "//s3-eu-west-1.amazonaws.com/cdn.cloudwall.me/photon/","maxWidth": "1600","listCols": ["info","security"],"font": "auto","fontWeight": "300","fontCode": "auto","icon": "","maxTabs": 15,"batchDbInfoDelay": 15,"batchCompactDelay": 500,"batchCreateDelay": 150,"batchUpdateCfg": 100,"loopActiveTasks": 10,"tasksReadReplicator": true},"lang": {"en": {"TIP_LOGIN": "Log in","TIP_PROFILE": "Edit user \nprofile doc","TIP_CONFIG": "CouchDB config","TIP_SHARE": "About Photon","ERR_REQ_INVALIDCALL": "Invalid request params, probably invalid command or we have a bug","ERR_REQ": {"0": "Offline","400": "Bad request","401": "Unauthorized","403": "Forbidden","404": "Not found","405": "Not allowed","408": "Timeout","409": "Conflict","429": "Too many requests","500": "Internal error","501": "Not implemented","503": "Service unavailable","504": "Gateway timeout","509": "Bandwidth quota","999": "Unknown error"},"FAIL_TOO_MANY_TABS": "{1} tabs maximum, please, close something or double-click the logo to close all tabs.","FAIL_TAB_APP": "Failed starting tab app. See console for details.","DLG_UNLOAD": "There are unsaved changes. Reload?","DLG_UNSAVED": "There are unsaved changes. Proceed?","IndexEd": {"TXT_TITLE": "Mango index {1} in _design/{2}","TXT_TITLE0": "Default Mango index","BTN_PANEL_CLOSE": "Close editor","TAG_MODE": {"tags": [{"JSON": "json"}],"empty": {"Source": "javascript"}},"ERR_NO_INDEX": "Must have .index.fields array","ERR_NO_TYPE": "Property .type should be \"json\"","ERR_NO_JSON": "Can’t convert to JSON","BTN_RUN": "Save and run","BTN_RUN0": "Create new and run","TIP_RUN": "Saves index and shows index entries","MSG_FAIL": "Failed saving {1}. Server responded ‘{2}: {3}’","MSG_SAVED": "Updated {1}, reloading index entries","BTN_SAVEAS": "Save as...","TIP_SAVEAS": "Saves index under different name and shows index entries","BTN_DEL": "Del...","TIP_DEL": "Deletes this Mango index","BTN_REVERT": "Revert","TIP_REVERT": "Reverts editor to saved index code","TXT_NEW": "<h3>Create new index</h3><p>Saves index into existing or new design document.</p>","LBL_DDOC": "Ddoc name","PLC_DDOC": "Short of full form","LBL_NEW": "Index name","PLC_NEW": "Key name in .views prop of ddoc","ERR_NEW_REQ": "Index name required","EXP_EXIST": "<span class=\"red1 fi-alert\"></span> Index already exists and will be replaced.","EXP_NDDOC": "Target design doc doesn’t exist and will be created.","EXP_NVIEW": "New index will be added to existing design doc.","BTN_NEW_OK": "Save index","BTN_NEW_CANCEL": "Cancel","ERR_NO_NAME": "Invalid ddoc or index name, can’t create index","ERR_ERRDOC": "Can’t save invalid index. {1}.","MSG_DEL_TEXT": "<span class=\"red1 fi-alert\"></span> Delete Mango index {1} from {2}?","BTN_DEL_YES": "Delete","BTN_DEL_NO": "Cancel","MSG_DEL_OK": "Index {1} deleted","MSG_DEL_FAIL": "Failed deleting {1}. Server responded ‘{2}: {3}’"},"ViewEd": {"TXT_TITLE": {"javascript": "JS view {1} / {2}","erlang": "Erlang view {1} / {2}"},"TAG_MODE": {"tags": [[{"Reduce": "reduce"},{"JSON": "json"}]],"empty": {"Map": "map"}},"BTN_PANEL_CLOSE": "Close editor","ERR_NO_MAP": "Map is not a function","ERR_NO_REDUCE": "Reduce is not a function","ERR_F_BUILTIN": "Unknown built-in reducer","ERR_ERRDOC": "Can’t save invalid design doc. {1}.","BTN_RUN": "Run view","TIP_RUN": "Runs saved view index query","BTN_SAVE": "Save and run","TIP_SAVE": "Saves view and shows the result","MSG_FAIL": "Failed saving {1}. Server responded ‘{2}: {3}’","MSG_SAVED": "Updated {1}, reloading view","BTN_SAVEAS": "Save as...","TIP_SAVEAS": "Saves view under different name and shows the result","BTN_REVERT": "Revert","TIP_REVERT": "Reverts editor to saved view code","BTN_DEL": "Del...","TIP_DEL": "Deletes this view index","TXT_NEW": "<h3>Create new view</h3><p>Saves view into existing or new design document.</p>","LBL_DDOC": "Ddoc _id","PLC_DDOC": "Fullform, like _design/ddocName","ERR_DDOC": "Valid _id-s are like _design/ddocName","LBL_NEW": "View name","PLC_NEW": "Key name in .views prop of ddoc","ERR_NEW_REQ": "View name required","ERR_NEW_SLASH": "Slashes are not allowed in view name","EXP_EXIST": "<span class=\"red1 fi-alert\"></span> View already exists and will be replaced.","EXP_NDDOC": "Target design doc doesn’t exist and will be created.","EXP_NVIEW": "New view will be added to existing design doc.","BTN_NEW_OK": "Save view","BTN_NEW_CANCEL": "Cancel","ERR_NO_NAME": "Invalid ddoc or view name, can’t create view","MSG_DEL_TEXT": "<span class=\"red1 fi-alert\"></span> Delete view index {1} from {2}?","BTN_DEL_YES": "Delete","BTN_DEL_NO": "Cancel","MSG_DEL_OK": "View {1} deleted","MSG_DEL_FAIL": "Failed deleting {1}. Server responded ‘{2}: {3}’"},"MangoEd": {"TXT_TITLE": "Mango qry {1}","TXT_TITLE0": "Untitled Mango qry","TAG_MODE": {"tags": [{"JSON": "json"}],"empty": {"Source": "javascript"}},"BTN_PANEL_CLOSE": "Close editor","ERR_NO_SELECTOR": "No .selector property","ERR_NO_JSON": "Can’t convert to JSON","BTN_RUN": "Run qry","TIP_RUN": "Executes query and shows the result","BTN_EXPL": "Explain","TIP_EXPL": "Explains query, all hidden params and indexes involved","BTN_SAVE": "Save as...","BTN_RENAME": "Rename...","TIP_SAVE": "Saves Mango query to localStorage for later re-use","BTN_DEL": "Del","TIP_DEL": "Deletes this Mango query from localStorage and switches to Default query","BTN_RESET": "Reset","TIP_RESET": "Resets to initial default query","TXT_STASH": "<h3>Memoize query</h3><p>Saves Mango query to localStorage for later re-use.</p>","PLC_STASH": "Query title, 3...30 chars","ERR_STASH_REQ": "Title required","ERR_STASH_LEN": "3...30 characters","ERR_STASH_EXIST": "Already exists","BTN_STASH_OK": "Save query","BTN_STASH_OK1": "Save & switch to new","BTN_STASH_CANCEL": "Cancel"},"UserDoc": {"TXT_TITLE": "Create new user","TXT_TITLE_ED": "Change password or roles","LBL_N": "Name","PLC_N": "User login","ERR_N": "Can’t start with _ or contain :","ERR_NX": "Username already exists","LBL_P": "Password","PLC_P": "User passsword","PLC_P_ED": "Change user passsword","ERR_P": "Required","LBL_R": "Roles","PLC_R": "Add roles","ERR_R": "Roles can’t start with _","BTN_SAVE": "Save user","BTN_DOC": "Create empty doc...","BTN_CANCEL": "Cancel","MSG_OK": "User {1} successfully saved","MSG_FAIL": "Failed saving user {1}. Server responded ‘{2}: {3}’"},"NewSync": {"TXT_TITLE": "New replication","LBL_MODE": "Sync mode","TAG_MODE": {"tags": [[{"Continuous": "live"},{"Forever": "doc"}]],"empty": {"One time": ""}},"LBL_ID": "Sync name","PLC_ID": "Doc _id for {1} DB","ERR_ID": "Required","ERR_ID_UND": "Doc name can’t start with underscore","LBL_FROM": "Source DB","PLC_FROM": "Local name or remote URL","ERR_FROM": "Existing DB name or valid URL","LBL_TO": "Target DB","PLC_TO": "Local name or remote URL","ERR_TO": "Existing DB name or valid URL","ERR_DUP": "Source and Target must be different","LBL_FN": "Filter fn","PLC_FN": "ddocName/filterFnName, filter function","ERR_FN_DESIGN": "No _design prefix, only ddocName/filter","ERR_FN": "Valid format is ddocName/filter","LBL_QRY": "Qry params","PLC_QRY": "Query params for filter fn, JSON object","ERR_QRY": "Must be non-empty JSON object","LBL_DOCS": "Docs to sync","PLC_DOCS": "JSON [] of doc _id-s to replicate","ERR_DOCS": "Must be non-empty JSON array of strings","BTN_START": "Start replication","BTN_START_DOC": "Create doc and start","BTN_CANCEL": "Cancel","BTN_CLEAR": "Clear","MSG_OK": "Successfully started new sync task","MSG_OK_ONCE": "Replication successfully finished","MSG_OK_DOC": "Successfully created doc ‘{2}’ in {1} DB","MSG_FAIL": "Failed starting replication. Server responded ‘{1}: {2}’"},"DelDB": {"TXT_TITLE": "Delete DBs","TXT_TITLE1": "Delete DB","PLC_DBS": "Select DBs to delete","ERR_DBS": "Select at least one DB","TXT_WARN": "function (obj) {\n\t\t\tvar c = Object.clone(obj);\n\t\t\tc.scount = c.count < 2?'':'s';\n\t\t\tc.size = (+c.size).bytes(1).replace(/B$/,'b');\n\t\t\tc.disk = (+c.disk).bytes(1).replace(/B$/,'b');\n\t\t\treturn 'You are deleting {count} DB{scount}, containing {size} of data. It will free ~{disk} of disk space.'.assign(c);\n\t\t}","BTN_START": "function (count) {\n\t\t\tif (!count) return 'Nothing to delete';\n\t\t\treturn 'Delete '+count+' DB'+(count>1?'s':'');\n\t\t}","BTN_CANCEL": "Cancel","MSG_OK": "Successfully deleted ‘{1}’ DB","MSG_FAIL": "Failed deleting DB ‘{1}’. Server responded ‘{2}: {3}’"},"SecObj": {"TXT_TITLE": "Access control","LBL_DBS": "DBs","PLC_DBS": "Select DB names to set ACL","ERR_DBS": "Select at least one DB","TXT_ADM": "Administrators","LBL_UADM": "Users","PLC_UADM": "User names","LBL_GADM": "Roles","PLC_GADM": "Roles with admin access","ERR_ADM": "Invalid name","ERR_UNAME": "Names can’t start with _ or contain :","TXT_MEM": "Members","PLC_UMEM": "User names","PLC_GMEM": "Roles with member access","BTN_START": "Set security","BTN_CANCEL": "Cancel","MSG_OK": "Security object for DB ‘{1}’ updated","MSG_FAIL": "Failed updating security object for DB ‘{1}’. Server responded ‘{2}: {3}’"},"Login": {"TXT_LOGIN": "Log in","PLC_UNAME": "Username","PLC_PWD": "Password","BTN_LOGIN": "Create session","BTN_CANCEL": "Cancel","MSG_AUTH_OK": "Authorized as {1}","MSG_AUTH_FAIL": "Authorization as {1} failed. Server responded {2}: {3}"},"Logout": {"TXT_LOGOUT": "Log out","TXT_PROFILE": "Profile","MSG_LOGOUT_START": "Logging out...","MSG_LOGOUT_OK": "You was logged out successfully","MSG_LOGOUT_FAIL": "Log out failed. Server responded {1}: {2}"},"Tab": {"BTN_CLOSETAB": "Close tab"},"NewDB": {"TXT_TITLE": "Create DBs","TXT_TITLE1": "Create DB","LBL_DBS": "Names","PLC_DBS": "DBs to create","ERR_DB_EXIST": "DB {1} already exists","ERR_DB_NAME": "Lowercase a-z, 0-9 and  _$()+- are only allowed in DB names","ERR_DB_UND": "DB names must start with lowercase a-z","TXT_ADM": "Administrators","LBL_UADM": "Users","PLC_UADM": "User names","LBL_GADM": "Roles","PLC_GADM": "Roles with admin access","ERR_ADM": "Invalid name","ERR_UNAME": "Names can’t start with _ or contain :","TXT_MEM": "Members","PLC_UMEM": "User names","PLC_GMEM": "Roles with member access","BTN_START": "Create DBs","BTN_START_PUBLIC": "Create public DBs","BTN_CANCEL": "Cancel","MSG_NEWDB_START": "Created new DB ‘{1}’","MSG_NEWDB_FAIL": "Failed creating DB ‘{1}’. Server responded ‘{2}: {3}’","MSG_NEWDB_NOACL": "DB ‘{1}’ created, but setting security config failed, so DB is public. Server responded ‘{2}: {3}’"},"Compact": {"TXT_TITLE": "Compact DBs","TXT_TITLE1": "Compact DB","TXT_DBLIST": "function (obj) {\n\t\t\tvar c = obj.length;\n      return 'You are going to compact {1} bucket{2}: '.assign(c, c<2?'':'s')+obj.map(function(e){return e.escapeHTML();}).join(', ');\n\t\t}","PLC_DBS": "Select DBs to compact","PLC_DDOCS": "Select ddocs for view compaction","ERR_DBS": "Select at least one DB","ERR_DDOCS": "Select at least one design doc","TAG_OP": [{"Strip old revs": "docs"},{"Strip old views": "views"},{"Compact views": "ddocs"}],"ERR_OP": "Select at least one action","ERR_VC": "View compaction requires selecting ddocs, so it’s unavailable for multiple DBs selected","BTN_START": "Start compaction","BTN_CANCEL": "Cancel","MSG_COMPACT_START": "Started compaction of ‘{1}’","MSG_COMPACT_FAIL": "Failed starting compaction of ‘{1}’. Server responded ‘{2}: {3}’","MSG_COMPACT_FAIL_SOME": "Errors occured during at least one compaction tasks, check console for details"},"$log": {"TXT_TITLE": "Logs","TXT_KB": "kb","TXT_SIZE": "Show","TXT_OFFSET": "offset","PLC_SEARCH": "Search in logs","PLC_RELOAD": "Reload"},"$config": {"PLC_SEARCH": "Search","PLC_RELOAD": "Reload","ERR_RELOAD": "Error reloading config. Server responded {1}: {2}","BTN_SAVE": "Save changes &nbsp;","BTN_REVERT": "Revert to saved ","BTN_CANCEL": "Cancel","BTN_CLOSE": "Close","TXT_SAVE_TITLE": "Save config","TXT_SAVE_SKIPERRORS": "Changes have errors, invalid keys will not be saved.","BTN_SAVE_START": "Save","TXT_ITITLE": "Changes","TXT_ITITLE_EMPTY": "You made no changes in the config yet","LBL_IUPD": "{1} updated","LBL_IADD": "{1} added","LBL_IDEL": "{1} deleted","LBL_IERR": "<span class=\"red1\">{1} invalid</span>","ERR_VAL": {"CHARS": "Forbidden chars in key, only a-z, 0-9 and _-! allowed","VALSTRING": "Value can’t be null, array or object"},"MSG_SAVE_OK": "Successfully updated config","MSG_SAVE_FAIL": "Failed updating some keys, see console, for details","MSG_CLUSTER": "You are operating cluster. Propagate config changes to all nodes?","BTN_SAVECLUSTER": "Save to all nodes","BTN_SAVENODE": "Save to {1} only","BAN_HTTP": "Key can’t be changed through HTTP, edit local.ini serverside. Reason is CVE-2017-12636."},"$about": {"L_PHO": "Photon version","L_PHOADD": "Photon addons","L_PHOLIBS": "Photon libs","L_PHOFONTS": "Fonts attached","L_VER": "CouchDB version","L_VENDOR": "Vendor","L_URL": "Node URL","L_COUCH": "Welcome msg","L_FEAT": "Aux features","BTN_LOGS": "View logs","L_GITHUB": "Photon at Github","L_DL": "Download this Photon build as a json","L_DLPREP": "Preparing json...","L_CHECK_UPDATES": "Check for updates...","TXT_UPD": "Update found. Local version is <nobr class=\"bolder\">{1}</nobr>, update is <nobr class=\"bolder\">{2}</nobr>. Update Photon?","MSG_UPD_NONEED": "No update needed","BTN_UPDATE": "Proceed","BTN_CANCEL": "Cancel","ERR_UPDATE_CHECK": "Failed reading new version, sorry","ERR_UPDATE": "Failed updating Photon. Server responded {1}: {2}","MSG_UPDATE_OK": "Photon was successfully updated, please reload the page!","S_TITLE": "Customize Photon","S_REPO": "Update repo URL","S_WIDTH": "Max width","S_FFAMILY": "Main font family","S_FWEIGHT": "Main font weight","S_FCFAMILY": "<code>Code</code> font family","S_POLL": "Task poll interval","S_ICON": "Browser tab icon","S_COLS": "DB list cols","TAG_COLS": [{"DB size": "info"},{"ACL info": "security"}],"BTN_ICON": "Upload new icon…","BTN_ICON_RESET": "Reset icon","BTN_APPLY": "Apply"},"$view": {"OPT_ALLDOCS": "All documents","OPT_DDOCS": "Design documents","TXT_FROM": "from","PLC_STARTKEY": "Start key or _skip","TIP_SHIFT_MINUS": "Shift frame backward","TIP_SHIFT_PLUS": "Shift frame forward","TIP_CLEAR_FILTER": "Clear startkey","TIP_RELOAD": "Reload","BTN_NEWDOC": "New doc ","BTN_NEWDOC_POPUP": "New doc…","BTN_COPYDOCS": "Copy…","BTN_DELDOCS": "Del docs…","BTN_ACL": "ACL…","BTN_COMPACT": "Compact…","BTN_CANCEL": "Cancel","TIP_CLOSEJSON": "Close JSON","PLC_SEARCH": "Search","ERR_GETVIEWS": "Failed reading list of view functions for {1} DB.","ERR_GETACL": "Failed reading security object","TXT_ALLDOCS": "function (a,b) {\n\t\t\treturn 'All docs'+(!a?'':', showing {1} of {2} entr'.assign(a,b)+(b%10==1 && b%100!=11?'y':'ies'));\n\t\t}","TXT_MAPVIEW": "function (a,b,c) {\n\t\t\tvar s = (!a && !b?'No rows':'{1} of {2} row'.assign(a,b)+(b!=1?'s':''));\n\t\t\tif (a && b && null != c) {\n\t\t\t\ts+=', filtered <span class=\"view-found pl3 pr3\">'+c+'</span> row'+(c!=1?'s':'');\n\t\t\t}\n\t\t\treturn s;\n\t\t}","BTN_VIEWCODE": "View code","MSG_STARTKEY_CHANGED": "Starting from key {1}","TXT_SELECT": "Select {1}","TXT_UNSELECT": "Unselect {1}","TXT_SELECT_ALL": "all","TXT_SELECT_FILTERED": "filtered","TIP_ANCHOR": "Open as a JSON in new browser tab","TXT_DEL_TITLE": "Bulk delete docs","TXT_DEL_WARN": "function (num,db) {\n\t\t\treturn 'You are going to delete '+num+' doc'+(num>1?'s':'')+' from the ‘'+db+'’ DB.'\n\t\t}","BTN_DEL_START": "Proceed","MSG_DEL_OK": "function (num,delnum,db) {\n\t\t\tvar h = ' from the ‘'+db+'’ DB';\n\t\t\tif (delnum == num ) h = 'Successfully deleted '+delnum+' doc'+(delnum>1?'s':'') + h;\n\t\t\telse {\n\t\t\t\th = 'Deleted '+delnum+' doc'+(delnum>1?'s':'') + h\n\t\t\t\t\t+', but failed to delete '+(num-delnum)+' doc'+((num-delnum)>1?'s':'');\n\t\t\t\t\n\t\t\t\th+='. Possibly, deletion was denied by validate function, see console for details.';\n\t\t\t}\n\t\t\treturn h;\n\t\t}","MSG_DEL_FAIL": "Failed deleting docs’. Server responded ‘{1}: {2}’"},"$dbs": {"TIP_RELOAD": "Reload DB list","BTN_NEWDB": "New DB…","BTN_COMPACT": "Compact…","BTN_DELDB": "Delete…","BTN_LOGS": "View logs","BTN_CANCEL": "Cancel","PLC_SEARCH": "Search","TXT_MAPVIEW": "function (a,b) {\n\t\t\treturn (!a && !b?'No DBs':(a==b?'{1} DB':'{1} of {2} DB').assign(a,b)+(b>1?'s':''));\n\t\t}","TXT_TASKVIEW": "function (a,b) {\n\t\t\treturn (!a&& !b?'No tasks':(a==b?'{1} task':'{1} of {2} task').assign(a,b)+(b>1?'s':''));\n\t\t}","TIP_DBSIZE": "Data: {1}\nDisk: {2}","MSG_NEWDB_START": "Created new DB ‘{1}’","MSG_NEWDB_FAIL": "Failed creating DB ‘{1}’. Server responded ‘{2}: {3}’","MSG_NEWDB_NOACL": "DB ‘{1}’ created, but setting security config failed, so DB is public. Server responded ‘{2}: {3}’","TXT_SELECT": "Select {1}","TXT_UNSELECT": "Unselect {1}","TXT_SELECT_ALL": "all","TXT_SELECT_FILTERED": "filtered","H_DOCS": "Docs","H_DELDOCS": "Deleted","H_SEQ": "Seq","H_SIZE": "Disk","TXT_TASK_TITLE": "Tasks","TAGS_TASK_TYPE": {"tags": [[{"Active": "active"}],[{"Sync": "replication"},{"Compaction": "compaction"}]],"empty": {" All ": ""}},"TIP_TASK_RELOAD": "Reload tasks","BTN_TASK_NEWSYNC": "New sync…","BTN_TASK_RESYNC": "Restart…","TXT_TASK_RESYNC_TITLE": "Restart replications","TXT_TASK_RESYNC_WARN": "function (num,tasks,db) {\n      var t = num+tasks;\n\t\t\treturn 'You are going to restart '+num+' sync task'+(num>1?'s':'')\n      \t+'. Task doc'+(num>1?'s':'')\n      \t+' in '+db+' DB will be deleted, and then re-created.';\n\t\t}","BTN_TASK_PROCEED": "Proceed","MSG_TASK_RESYNC": "Sync docs deleted, tasks stopped. Trying to restart sync tasks...","MSG_TASK_RESYNC_OK": "Sync tasks restarted","ERR_TASK_RESYNC": "Error restarting sync tasks, server responded {1}","BTN_TASK_STOP": "Stop…","TXT_TASK_STOP_TITLE": "Stop replications","TXT_TASK_STOP_WARN": "function (num,tasks,db) {\n      var t = num+tasks;\n\t\t\tvar s = 'You are going to stop '+t+' sync task'+(t>1?'s':'')+'. ';\n      \n      if (num > 0) {\n      \ts = s+'Task doc'+(num>1?'s':'')+' in '+db+' DB will be deleted.';\n      }\n      return s;\n\t\t}","MSG_TASK_STOP": "Sync docs deleted, tasks stopped","ERR_TASK_STOP": "Error stopping tasks, server responded {1}"},"$doc": {"TXT_REV": "Latest revision","PLC_SEARCH": "Search","PLC_RELOAD": "Reload","BTN_SAVE": "Save doc ","BTN_SAVEAS": "Save as…","BTN_DEL": "Delete…","BTN_CANCEL": "Cancel","MSG_SAVE": "Doc {1} was successfully saved with revision {2}","ERR_SAVE": "Error saving doc, server responded {1}","ERR_SAVELOAD": "Doc was saved, however loading it after save failed. Server responded {1}","MSG_EDS": "There are active editors containing not yet applied changes.","BTN_EDS_YES": "Apply changes and save ","BTN_EDS_NO": "Discard and save ","MSG_CONFLICT": "<div class=\"fs130 lh150 mb2 bolder orange\">Conflict</div>Conflict saving doc ‘{1}’ <br><span class=\"dib w140\">Your rev: </span><nobr>{2}</nobr> <br><span class=\"dib w140\">DB rev:   </span><nobr>{3}</nobr>.","BTN_CONFLICT_YES": "Overwrite DB doc","BTN_CONFLICT_NO": "Cancel save","MSG_CONFLICT_CANCELLED": "Cancelled, doc was not saved","MSG_CONFLICT_LOADFAIL": "Failed loading conflicting revision, doc can not be saved","TXT_DEL_TITLE": "Delete doc","TXT_DEL_TITLE_CONFLICT": "Delete doc conflict","TXT_DEL_WARN": "You are going to delete doc <nobr>‘{1}’</nobr> from the ‘{2}’ DB.","BTN_DEL_START": "Proceed","TXT_DEL_NODEL": "Note, that the doc has conflict revisions, and one of them probably become active after deletion.","TXT_DEL_CONFLICT": "Note, that you are deleting conflict revision, it will not affect active version of the doc.","LBL_DEL_ALL": "Del doc and its content","LBL_DEL_RETAIN": "Mark doc as deleted, but retain content","MSG_DEL_OK": "Successfully deleted doc ‘{1}’ from the ‘{2}’ DB","MSG_DEL_FAIL": "Failed deleting doc ‘{1}’. Server responded ‘{2}: {3}’","MSG_DEL_RELOAD": "Updated latest active revision of the doc","MSG_DEL_RELOAD_FAIL": "Failed reading active rev of doc ‘{1}’. Server responded ‘{2}: {3}’"},"$error": {"TXT_ERR": "<div class=\"w50p tal lh170 dib vat\">Error switching <i>{1}</i><br><span class=\"bolder\">{2}</span></div>"}}},"Base": "","All": {},"Tabs": [],"History": [],"DownloadURL": false,"ReplicatorDB": "","isCluster": true,"isIE": false,"Couch": {"version": ""},"Users": {"_seq": 0},"data": {"path": [],"name": ""},"params": {"restyle": 20},"init": "function ($o) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tcfg = that.Cfg;\n\t\n\t// is IE\n\tthat.isIE = !!navigator.userAgent.match(/Edge|Trident/);\n\n\t// isStandalone\n\tthat._compiled = that._compiled || !(cw.CW || typeof cw.debug == 'boolean');\n\t\n\t// init Photon local storage\n\tthat.Ls = that.Ls();\n\n\t// Base\n\tif (!that.Base) {\n\t\tthat.Base = window.DDOC ? window.DDOC._base : [location.protocol,'',location.host,''].compact().join('/');\n\t}\n\n\t// HTML\n\t$o.formgen('init', that.HTML.assign(that.lang));\n\t\t\n\t// Submanifests to preprocess\n  var childs = [\n    'Tab', \t\t\t'Login', \t'Logout', \n    'Compact', \t'NewDB', \t'DelDB', \t'SecObj', \n    'NewSync', \t'SetPwd', 'UserDoc', \n    'MangoEd', \t'ViewEd', 'IndexEd'\n   ].add(\n     Object.keys(that).filter(/^\\$/)\n   );\n\n\t// Mount editors, taken from global cache\n\tObject.keys(that.Ed).forEach(function(k){\n\t\tif (!that.Ed[k].id) return;\n\t\tthat.Ed[k] = $.extend(\n\t\t\ttrue, \n\t\t\t$.my.cache(that.Ed[k].id) || {}, \n\t\t\tthat.Ed[k], \n\t\t\t{Pho:that.Pho}\n\t\t);\n\t});\n\n\t// Mount lang and Pho on child manifests\n  var fkeys = ['Pho', 'Req', 'Sel2Scroll', 'p2u'];\n\tchilds.forEach(function(m){\n\t\tif (!that[m]) return;\n\t\tif (that[m].lang) $.extend(that[m].lang, that.lang[m] || {});\n    fkeys.forEach(function(i){that[m][i] = that[i]});\n\t});\n\t\n\t// j2h converter\n\tthat.j2h = that.Ed.jsontree.j2h;\n\n\t// Mount app/tab close event handler\n\t$o.on('tabclose.my', function(evt, tabid){ that.Close(tabid); });\n\t\n\t// on Standalone run\n\tif (that._compiled) {\n\t\t// Tab restore\n\t\tvar tabs = that.Ls('TabCloseHistory');\n\t\tif (tabs && tabs.length) {\n\t\t\tif (Date.now() - tabs[0].stamp < 30e3) that.Tabs = Object.clone(tabs[0].tabs, true);\n\t\t\telse {\n\t\t\t\t//search for most fat\n\t\t\t\tvar fat = [];\n\t\t\t\ttabs.forEach(function(e){\n\t\t\t\t\tif (Date.now() - e.stamp > 180*24*36e5) return;\n\t\t\t\t\tif (fat.length < e.tabs.length) fat = e.tabs;\n\t\t\t\t});\n\t\t\t\tif (fat.length) that.Tabs = Object.clone(tabs[0].tabs, true);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// Restore cfg\n\tvar pcfg = that.Ls('Cfg');\n\t$.extend(true, that.Cfg, Object.isObject(pcfg)?pcfg:{});\n\tif (pcfg && pcfg.listCols) that.Cfg.listCols = pcfg.listCols;\n\tcfg = that.Cfg;\n\n\t// After app init\n\t$o.then(function(){\n\t\t\n\t\t// Specific parts\n\t\t// for in-CloudWall exec...\n\t\tif (!that._compiled) {\n\t\t\tcw.log('Photon started in CloudWall');\n\t\t\t$o.on('click.my','a',function(evt){\n\t\t\t\tvar $a = $(evt.currentTarget),\n\t\t\t\t\t\thref = $a.attr('href');\n\t\t\t\tif (href[0]=='#') {\n\t\t\t\t\tvar path = decodeURIComponent(href.replace(/^#+\\/?/,'')).split('/').compact(true);\n\t\t\t\t\tthat.Switch(path);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// ... or Standalone run\n\t\tif (that._compiled) {\n\t\t\tcw.log('Photon couchapp started');\n\t\t\t// start router\n\t\t\t(function _Router (start) {\n\t\t\t\tfunction _route(){\n\t\t\t\t\tvar h = (location.hash+'').replace(/^#+/,'').split('/').map(decodeURIComponent);\n\t\t\t\t\tif (h[1]=='_design') { h[2] = '_design/'+h[2]; h.removeAt(1); }\n\t\t\t\t\tthat.Switch(h);\n\t\t\t\t}\n\t\t\t\tvar prevhash = start || '';\n\t\t\t\t$(window).on('hashchange.pho', _route.debounce(1000/60 + 3));\n\t\t\t\tif (start != null) location.hash = start+'';\n\t\t\t\t$(window).trigger('hashchange');\n\t\t\t})();\n\t\t\t\n\t\t\t// Icon image\n\t\t\t$('link[rel=\"icon\"]').attr('href', cfg.icon || that.files['favicon.png'].url);\n\t\t\t\n\t\t\t// beforeunload handler, checks if all tab changes are saved\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tvar dlg;\n\t\t\t\tif (that.Tabs.find(function(e){return e.hash0!=e.hash1})) {\n\t\t\t\t\tvar dlg = that.lang.DLG_UNLOAD;\n\t\t\t\t\te.returnValue = dlg;\n\t\t\t\t}\n\t\t\t\treturn dlg;\n\t\t\t};\n\t\t\t\n\t\t\t// stash tabs on unload\n\t\t\t$(window).on('unload', function(){\n\t\t\t\tvar tabs = Object.clone(that.Tabs, true),\n\t\t\t\t\t\thistory = that.Ls('TabCloseHistory') || [];\n\t\t\t\thistory.unshift({stamp:Date.now(), tabs:tabs.map(function(e){\n\t\t\t\t\te.run = false; \n\t\t\t\t\te.error = false; \n\t\t\t\t\te.hash0=e.hash1='';\n\t\t\t\t\treturn e;\n\t\t\t\t})});\n\t\t\t\tthat.Ls('TabCloseHistory',history.to(3));\n\t\t\t});\n\t\t}\n\n\t\t// rebuild styles\n\t\tthat.my.restyle();\n\t\t\n\t}.debounce(10));\n\t\n\treturn that.GetList();\n\t\n}","ui": {"#l-root": {"init": "function ($o) {\n      var that = this;\n      $o.on('dblclick.my', (function(){\n        var ids = that.Tabs.reduce(function(a,b){\n          if (!b.path.length || b.hash0 != b.hash1) return a;\n          a.push({tabid:b.id, enforce:true, silent:true});\n        \treturn a;\n        },[]);\n        ids.last().silent = false;\n        ids.map((function(e){ that.Close(e); }).lazy(30));\n      \treturn false;\n      }).debounce(50));\n    }","bind": "function (d) {\n    \treturn this.SVG.logo;\n    }"},"#btn-aside-auth": {"bind": "function (d,v,$o) {\n\t\t\tvar that = this,\n\t\t\t\t\tauth = cw.me(),\n\t\t\t\t\th = '';\n\t\t\t$o.attr('title', auth ? that.lang.TIP_PROFILE : that.lang.TIP_LOGIN);\n\t\t\t\n\t\t\th = '<span id=\"btn-auth-popup\">{1}</span>'.assign(auth ? that.SVG.user : that.SVG.login);\n\t\t\t\n\t\t\tif (v==null) return h;\n\t\t\t\t\n\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\n\t\t\t// Not authorized\n\t\t\telse if (!auth) {\n\t\t\t\tthat.my.modal('#btn-aside-auth',{\n\t\t\t\t\tmanifest:that.Login,\n\t\t\t\t\twidth:300,\n\t\t\t\t\tnose:'top',\n\t\t\t\t\talign:'top:105%;right:-44px;',\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tz:1996,\n\t\t\t\t\tcss:'xgray'\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// authorized\n\t\t\telse {\n\t\t\t\tvar rl = (cw.me('roles')||[]).length;\n\t\t\t\tthat.my.modal('#btn-aside-auth',{\n\t\t\t\t\tmanifest:that.Logout,\n\t\t\t\t\twidth:rl<5?200:rl<10?250:300,\n\t\t\t\t\tnose:'top',\n\t\t\t\t\talign:'top:105%;right:-44px;',\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tz:1996\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn h;\n\t\t}","events": "click.my","listen": {"userCtx": "function (d,v) {\n\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\tthis.my.check('#btn-aside-auth');\n\t\t\t}"}},"#btn-aside-config": {"bind": "function (d,v,$o) {\n\t\t\t$o.attr('title',this.lang.TIP_CONFIG);\n\t\t\treturn '<a href=\"#_config\">'+this.SVG.config+'</a>';\n\t\t}"},"#btn-aside-share": {"bind": "function (d,v,$o) {\n\t\t\t$o.attr('title',this.lang.TIP_SHARE);\n\t\t\treturn '<a href=\"#_about\">'+this.SVG.share+'</a>';\n\t\t}","events": "click.my"},"#l-apptabs": {"init": "function ($o) {\n\t\t\tvar that = this;\n\t\t\t$o.sortable({ axis:'x', distance: 5 });\n\t\t}","delay": 1,"merge": false,"id": ["id"],"hash": "function (e) {\n\t\t\treturn cw.lib.sdbm([ e.name, e.active, e.error, e.hash0, e.hash1 ]);\n\t\t}","list": "<div class=\"l-tab\"></div>","bind": "this.Tabs","manifest": "this.Tab"}},"style": {"   ": "function ($o) {\n\t\tvar that = this,\n\t\t\t\tw = $o.width(),\n\t\t\t\tcfg = that.Cfg;\n\n\t\t// Set font size\n\t\tvar fsize = w<1500?15:16;\n\t\tvar fcsize = fsize - 1.5;\n\n\t\t\n\t\t//var fweight = /Firefox/.test(window.navigator.userAgent || '')?'400':'300';\n\t\tvar fweight = cfg.fontWeight;\n\n\t\t// font family\n\t\tvar font = \"'-apple-system','BlinkMacSystemFont','Helvetica Neue','Segoe UI',Helvetica,Tahoma,Verdana,sans-serif\";\n\t\tif (cfg.font != 'auto') font = cfg.font+',sans-serif';\n\t\t\n\t\t// code font family\n\t\tvar cfont = \"Cousine,'PT Mono',Menlo,Monaco,monospace\";\n\t\tif (cfg.fontCode != 'auto') cfont = cfg.fontCode+',monospace';\n\t\t\n\t\tvar css = \"font-size:{1}px!important;font-family: \"+font+\";font-weight:{2};\";\n\t\t\n\t\t// Set font for body\n\t\tif (that._compiled) $('body').css({'font-family':font, 'font-weight':fweight});\n\n\t\t// Set for elts and controls\n\t\treturn {\n\t\t\t'':css.assign(fsize, fweight)+'line-height:1.6em;',\n\t\t\t' button, input, textarea':css.assign('-',fweight),\n\t\t\t// Code Mirror\n\t\t\t' .CodeMirror, .pre':\"font-size:{1}px!important; font-family:{2}!important;\".assign(fcsize, cfont),\n\t\t\t' code':'font-family:{1}!important;'.assign(cfont)\n\t\t};\n\t}"," .nocwmin": "display:none!important"," .notap": "-webkit-tap-highlight-color: rgba(0,0,0,0);"," .my-modal-overlay": "box-shadow: 2px 3px 22px -7px rgba(10, 20, 29, 0.8)!important;border-radius:2px!important;"," .dif": "display:inline-flex;"," .w12p": "width:12%;"," .w18p": "width:18%;"," .bolder": "font-weight:bolder;"," .lighter": "font-weight:lighter;"," .w2em": "width:2em;"," section": "outline: none;"," .my-tags.buttons": {" .tag": "border-radius:0; border: 1px solid #e3e5e7; transition:background-color 0.2s, color 0.2s;margin-left:-1px;color:#8c96a2;"," .tag:hover": "color:#27a;"," .tag.active": "border:1px solid transparent;background-color:#e3e5e7;color:white;color:#8c96a2;"," .tag:first-child": "border-radius:3px 0 0 3px; border-left: 1px solid #e3e5e7;"," .tag:last-child": "border-radius:0 3px 3px 0;"," .tag:first-child:last-child": "border-radius:3px;"}," div.my-modal": "border: 1px solid rgba(224, 228, 232, 0.55);"," .my-modal.modal-busy": {":after": "content:\" \";position:absolute;\t\t\t\ttop:-1px; left:0; width:100%; height:100%;\t\t\t\tz-index:5;border-radius:2px;\t\t\t\tbackground-color:rgba(255,255,255,0.6);\t\t\t\tbackground-image: url(i/loader-bar2.gif);\t\t\t\tbackground-repeat: repeat-x;\t\t\t\tbackground-position: center -7px;",".nose-top:before": "z-index:6;"}," .pre": "white-space:pre-wrap; word-wrap:break-word;"," #l-board": {"": "width:100%; padding:0; overflow:hidden; "," ": "function ($o) {\n\t\t\tvar m = $o.parent().hasClass('my-modal-form'),\n          h = (window.innerHeight/(m?1.3:1)|0)+'px';\n\t\t\treturn this._compiled?'height:calc('+h+' - 32px);':'height:calc('+h+' - 70px);'//'height:600px;'\n\t\t}"}," #l-apps": {"": "min-width:1020px;margin:0 auto;","  ": "function ($o) {\n\t\t\treturn 'max-width:'+this.Cfg.maxWidth+'px;'\n\t\t}"," .l-app": {"": "opacity:1; transition: opacity 0.5s; transition-timing-function: ease-out;"," ": "function ($o) {\n\t\t\t\tvar c = this._compiled,\n            m = $o.parent().hasClass('my-modal-form'),\n            h = ((window.innerHeight/(m?1.3:1)|0)-(c?0:32)) + 'px',\n\t\t\t\t\t\tt = 'height:calc('+h+' - ';\n\t\t\t\treturn {\n\t\t\t\t\t' .panelheight':t+'84px);',\n\t\t\t\t\t' .panelheight-4':t+'88px);',\n\t\t\t\t\t' .panelheight-8':t+'92px);',\n\t\t\t\t\t' .panelheight-16':t+'100px);',\n\t\t\t\t\t' .panelheight-32':t+'116px);',\n\t\t\t\t\t' .panelheight-48':t+'132px);',\n\t\t\t\t\t' .panelheight-64':t+'148px);',\n\t\t\t\t};\n\t\t\t}"," .app-head": {"": "display:block;height:52px;overflow:hidden;width:100%;"," button, .button": "height:2em;padding-top:0.2em;padding-bottom:4px;line-height:19px;text-align:center;"},".app-busy": "opacity:0.5;transition-timing-function: ease-in;"," .feather": {":before": {"": "content:\" \";position:absolute;top:0;left:0;width:calc(100% - 6px);height:15px;pointer-events: none;background-image: linear-gradient(to bottom, rgba(255,255,255,1), rgba(255,255,255,0));z-index:1990;"},":after": {"": "content:\" \";position:absolute;bottom:0;left:0;width:calc(100% - 6px);height:15px;background-image: linear-gradient(to top, rgba(255,255,255,1), rgba(255,255,255,0));z-index:1990;"}}}," .app-busy:after": "\t\t\t\tcontent:\" \";\t\t\t\tposition:absolute;\t\t\t\tz-index:+1993;\t\t\t\tbackground-color:rgba(255,255,255,0);\t\t\t\twidth:100%;\t\t\t\theight:110%;\t\t\t\ttop:0;\t\t\t\tleft:0;"}," .jval-bracket, .jval-key": "font-weight:bolder;"," .jval-trim": "display:inline-block;border-radius:2px;padding:1px 2px;line-height:1.1em;color:rgba(213, 48, 89, 0.63);background-color:rgba(43, 107, 192, 0.07);"," .jval-short": "color:rgba(88,101,123,0.63);xbackground-color:rgba(43, 107, 192, 0.07);"," .jval-key": "margin-left:2px;"," .jval-bracket+.jval-key": "margin-left:0px;"," .jval-simple": "color:rgba(52, 143, 27, 0.78);"," .jval-string": "color:#3b5e85;"," .CodeMirror-linenumber": "white-space:nowrap;"," .CodeMirror-gutters": "background:white;xborder-right:none;"," #l-header": {"": "width:100%;height:32px;overflow:hidden;background-size: 2px 32px;background-position:0 0;background-image: linear-gradient(to bottom, #0c1932, #4b627c);"," #l-tabs ": "function ($o) {\n\t\t\treturn 'max-width:'+this.Cfg.maxWidth+'px;'\n\t\t}"," #l-tabs": {"": "min-width:1020px;margin:0 auto;"," .ui-sortable-helper": "background-color:rgba(102,120,152,0.8);border-left:1px solid #9ea6b0;"," .ui-sortable-placeholder+.l-tab": "border-left:1px solid #9ea6b0;"," .tab-busy:after": "\t\t\t\tcontent:\" \";\t\t\t\tposition:absolute;\t\t\t\tz-index:+1980;\t\t\t\twidth:100%;\t\t\t\theight:2px;\t\t\t\tbottom:0;\t\t\t\tleft:0;\t\t\t\toverflow:hidden;\t\t\t\tbackground-image: url(i/loader-bar2.gif);\t\t\t\tbackground-repeat: repeat-x;\t\t\t\tbackground-position-y: -1px;"}," #l-roottab": {"": "border-left:1px solid #9ea6b0;"," #l-root": "padding:3px 10px 0 20px;width:72px;display:block;"}," #l-apptabs": "width:calc(100% - 72px - 96px);"," .l-tab": {"": "line-height:29px; height:32px; min-width:72px; max-width:220px; transition:width 0.2s;border-right:1px solid #9ea6b0;border-left:1px solid transparent;display:inline-block;vertical-align:top;overflow:hidden;"," ": "function () {\n\t\t\t\treturn 'width:calc(100% / '+(this.Tabs.length || 1)+');';\n\t\t\t}",":hover": {}," #btn-tabclose": "cursor:pointer;display:none;color:rgba(255,255,255,0.25);"," #l-tabstate": "color:rgba(141,209,255,0.92);"," #l-tabstate.hide+#btn-tabclose": "display:block;"," .l-tabmark": {"": "width:16px;position:absolute;line-height:20px;right:0;top:0;text-align:center;","  ": "transition: opacity 0.3s, color 0.3s;"},":hover ": {" #l-tabstate": "display:none!important;"," #btn-tabclose": "display:block!important;color:rgba(255,255,255,0.6);"}," #btn-tabclose:hover": "color:rgba(255,255,255,0.8);"," a": "text-decoration:none;transition: opacity 0.3s;color:white!important;opacity:0.8!important;",":hover a": "opacity:1!important;"," #l-tabname": {"": "width:calc(100% - 16px);display:inline-block;overflow:hidden;text-overflow:ellipsis;padding:0 0 4px 6px;white-space: nowrap;",".smaller": "font-size:0.95em;"},".active": {" a": "color:#001328!important;opacity:0.8!important;font-weight:bolder;",":hover a": "opacity:0.95!important;","": " background-size: 2px 32px;background-position:0 0;background-image: linear-gradient(to bottom, #a3b5cd, #d2deee);"," #l-tabstate": "color:rgba(37,137,215,0.8);"," #btn-tabclose": "color:rgba(0,18,40,0.3);",":hover #btn-tabclose": "color:rgba(0,18,40,0.6);"," #btn-tabclose:hover": "color:rgba(0,18,40,0.8);"}}," #l-aside": {"": "position:absolute;top:0;right:0;width:96px;border-right:1px solid #9ea6b0;white-space: nowrap;width:auto;z-index:2;",">div": "height:32px; width:32px; cursor:pointer;border-left:1px solid #9ea6b0;display:inline-block; vertical-align:top; overflow:hidden;transition: color 0.3s, opacity 0.3s; color:white!important;opacity:0.7!important;",">div:hover": "opacity:0.9!important;","a": "text-decoration:none;"}}},"require": [{"window.Q": "/lib/q.js"}],"Pho": "function (key) {\n\t\t// exposed to child apps, indeed Pho\n\t\t// return Shell resource by key, \n\t\t// which is null, [path] or string\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t}","SetTitle": "function (t) {\n\t\tvar that = this;\n\t\tif (that._compiled) $('head title').text(t+'');\n\t}","p2u": "function (path) {\n\t\treturn path.map(function(e, i){\n\t\t\tif (i==1 && /^_design\\/.+$/.test(e)) return '_design/'+encodeURIComponent(e.from(8));\n\t\t\treturn encodeURIComponent(e);\n\t\t})\n\t}","LibsUsed": {"jQuery": "https://jquery.com/","Q": "https://github.com/kriskowal/q","$.ui": "https://jqueryui.com/","$.my": "https://jquerymy.com/","$.tags": "","$.list": "","select2": "http://select2.github.io/select2/","CodeMirror": "https://codemirror.net/","niceScroll": "https://github.com/inuyaksa/jquery.nicescroll","Sugar": "http://sugarjs.com","JCrop": "https://github.com/tapmodo/Jcrop","URL polyfill": "https://github.com/github/url-polyfill","cw.lib": "http://cloudwall.me"},"FontsUsed": {"Cousine": "https://www.fontsquirrel.com/fonts/cousine","PT Mono": "https://www.fontsquirrel.com/fonts/pt-mono"},"die": "function ($o) {\n  \t$(window).off('.pho');\n    $o.find('#l-apps>div').each(function(){\n    \t$(this).my('remove');\n    });\n  }","dbType": {"sizesafe": "","syncstate": "","stamp": 0,"committed_update_seq": -1,"compact_running": false,"data_size": "","disk_size": 0,"sizetip": "","db_name": "","disk_format_version": "","doc_count": "","doc_del_count": "","instance_start_time": "","purge_seq": "","update_seq": "","update_seq_safe": "","security": {"stamp": 0,"seq": -1,"admins": {"names": [],"roles": []},"members": {"names": [],"roles": []}},"protected": "","tasks": {"stamp": 0,"pids": []},"syncs": {"stamp": 0,"docs": []}},"HTML": "<div id=\"l-header\">\n\t<div id=\"l-tabs\">\n\t\t\n\t\t<div id=\"l-roottab\" class=\"l-tab\" style=\"width:72px;\">\n\t\t\t<a id=\"l-root\" href=\"#\" class=\"\"></a>\n\t\t</div>\n\t\t\n\t\t<div id=\"l-apptabs\" class=\"dib vat nw oh\"></div>\n\t\t\n\t\t<div id=\"l-aside\">\n\t\t\t<div id=\"btn-aside-auth\"></div>\n\t\t\t<div id=\"btn-aside-config\"></div>\n\t\t\t<div id=\"btn-aside-share\"></div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"l-board\">\n\t<div id=\"l-apps\">\n\t</div>\n</div>","SVG": {"logo": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"31\" height=\"16\" viewBox=\"0, 0, 31, 16\">\n  <g id=\"PhotonLogo\">\n     <path d=\"M15.5,0 C20.3,0.0 24.2,0.6 27.8,1.9 L28.0,1.9 C29.6,2.5 29.2,2.4 29.4,2.4 L31,3.1 L31,16 L0,16 L0,3.1 C1.7,2.4 1.3,2.5 2.4,2.1 L2.9,1.9 C6.7,0.6 10.6,0.0 15.1,0.0 z\" \n\t\t\t\t\t fill=\" #FFFFFF\" fill-opacity=\"1\"/>\n     <path d=\"M30,12 L30,15 L1,15 L1,12 L30,12 z\" \n\t\t\t\t\t fill=\" #D51D1D\"/>\n     <path d=\"M3.0,3.0 C3.1,3.7 3.2,4.3 3.2,4.6 C3.4,5.7 3.9,6.6 4.7,7.2 C5.4,7.7 6.2,8.0 7.0,8.0 C8.0,7.9 11.6,8.0 13.1,8.0 C14.0,8.0 14.6,8.6 15,9.5 L15,11 L1,11 L1,3.8 C2.6,3.1 1.9,3.4 3.0,3.0 z\" \n\t\t\t\t\t fill=\" #FA4848\"/>\n     <path d=\"M15,1 L15,7.7 C14.6,7.1 14.0,6.9 13.4,6.8 C9.5,6.8 8.6,6.8 7.6,6.8 C7.4,6.8 7.3,6.8 7.3,6.8 C5.8,6.8 4.4,5.7 4.1,4.0 L4,2.8 C7.5,1.5 11.3,1.0 15,1 z\" \n\t\t\t\t\t fill=\" #FF6767\"/>\n     <path d=\"M27.9,3.0 C27.8,3.7 27.7,4.3 27.7,4.6 C27.5,5.7 27.0,6.6 26.2,7.2 C25.5,7.7 24.7,8.0 23.9,8.0 C22.9,7.9 19.3,8.0 17.8,8.0 C16.9,8.0 16.3,8.6 16,9.5 L16,11 L30,11 L30,3.8 C28.3,3.1 29.0,3.4 27.9,3.0 z\" \n\t\t\t\t\t fill=\" #FA4848\"/>\n     <path d=\"M16,1 L16,7.7 C16.3,7.1 16.9,6.9 17.5,6.8 C21.4,6.8 22.3,6.8 23.3,6.8 C23.5,6.8 23.6,6.8 23.6,6.8 C25.1,6.8 26.5,5.7 26.8,4.0 L27,2.8 C23.4,1.5 19.6,1.0 16,1 z\" \n\t\t\t\t\t fill=\" #FF6767\"/>\n  </g>\n</svg>","user": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"btn-user-svg\">\n    <g>\n      <path d=\"M26.25,20.65 L23.55,23.35 L21.75,21.55 M24,17.5 C21.51,17.5 19.5,19.51 19.5,22 C19.5,24.48 21.51,26.5 24,26.5 C26.48,26.5 28.5,24.48 28.5,22 C28.5,19.51 26.48,17.5 24,17.5 z\" fill-opacity=\"0\" \n      stroke=\" #B3FF94\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      <path d=\"M18.99,18.44 L16,17.36 L16,15.32 M17,22.5 L6.5,22.5 L6.5,21.01 C6.5,20.01 7.11,19.11 8.05,18.77 L12,17.36 L12,15.32 M17.94,11.23 C17.94,8.62 16.18,6.5 14,6.5 C11.81,6.5 10.05,8.62 10.05,11.23 C10.05,13.85 11.81,15.97 14,15.97 C16.17,15.97 17.94,13.85 17.94,11.23 z M10.09,10.47 C10.57,10.72 11.05,10.84 11.62,10.84 C12.76,10.84 14.14,10.17 14.59,9.31 C15.33,10.61 16.19,11.10 17.54,10.84 C17.67,10.81 17.78,10.82 17.91,10.81\" fill-opacity=\"0\" \n      stroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </g>\n  </g>\n</svg>","login": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"Layer_1\">\n    <g>\n      <path d=\"M16.5,19.5 L4.5,19.5 L4.5,10.5 L27.5,10.5 L27.5,16.52 M8.5,17 L8.5,13 M6.82,16.09 L10.17,13.90 M6.83,13.89 L10.16,16.11 M14.5,17 L14.5,13 M12.82,16.09 L16.17,13.90 M12.83,13.89 L16.16,16.11\" fill-opacity=\"0\" \n      stroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      <path d=\"M18.5,19.83 L27.5,19.83 L27.5,26.50 L18.5,26.50 z M22.97,22.57 L22.97,24.24 M25.67,19.83 L25.67,19.00 C25.67,17.62 24.46,16.50 22.97,16.50 C21.48,16.50 20.27,17.62 20.27,19.00 L20.27,19.83 M23.42,22.15 C23.42,21.92 23.22,21.74 22.97,21.74 C22.72,21.74 22.52,21.92 22.52,22.15 C22.52,22.38 22.72,22.57 22.97,22.57 C23.22,22.57 23.42,22.38 23.42,22.15 z\" fill-opacity=\"0\" \n      stroke=\" #FFC300\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </g>\n  </g>\n</svg>","config": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"Layer_1\">\n    <path d=\"M16.48,18.5 L16.48,11.5 M22.51,16.5 L22.51,18.5 M10.48,7.5 L10.48,12.5 M10.48,14.5 L10.48,18.5 M22.51,7.5 L22.51,14.5 M16.48,7.5 L16.48,9.5 M20.51,16.5 L24.51,16.5 L24.51,14.5 L20.51,14.5 z M14.48,11.5 L18.48,11.5 L18.48,9.5 L14.48,9.5 z M8.48,14.5 L12.48,14.5 L12.48,12.5 L8.48,12.5 z M22.52,21.5 C21.69,21.5 21.02,22.17 21.02,23 C21.02,23.82 21.69,24.5 22.52,24.5 C23.35,24.5 24.02,23.82 24.02,23 C24.02,22.17 23.35,21.5 22.52,21.5 z M16.48,21.5 C15.65,21.5 14.98,22.17 14.98,23 C14.98,23.82 15.65,24.5 16.48,24.5 C17.31,24.5 17.98,23.82 17.98,23 C17.98,22.17 17.31,21.5 16.48,21.5 z M10.48,21.5 C9.65,21.5 8.98,22.17 8.98,23 C8.98,23.82 9.65,24.5 10.48,24.5 C11.31,24.5 11.98,23.82 11.98,23 C11.98,22.17 11.31,21.5 10.48,21.5 z\" fill-opacity=\"0\" \n    stroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>","share": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"btn-share-svg\">\n    <path d=\"M25.5,15 C26.60,15 27.5,15.89 27.5,17 C27.5,18.10 26.60,19 25.5,19 C24.39,19 23.5,18.10 23.5,17 C23.5,15.89 24.39,15 25.5,15 z M25.5,22.5 C24.39,22.5 23.5,23.39 23.5,24.5 C23.5,25.60 24.39,26.5 25.5,26.5 C26.60,26.5 27.5,25.60 27.5,24.5 C27.5,23.39 26.60,22.5 25.5,22.5 z M17.5,19 C16.39,19 15.5,19.89 15.5,21 C15.5,22.10 16.39,23 17.5,23 C18.60,23 19.5,22.10 19.5,21 C19.5,19.89 18.60,19 17.5,19 z M23.71,17.89 L19.28,20.10 M23.5,23.5 L19.37,21.70 M12.5,16.5 L10.5,14.5 L12.5,12.5 M15.5,16.5 L17.5,14.5 L15.5,12.5 M20.5,14.5 L20.5,10.5 L17.5,7.5 L7.5,7.5 L7.5,22.5 L13.5,22.5 M20.5,10.5 L17.5,10.5 L17.5,7.5\" fill-opacity=\"0\" \n\t\t\t\t\tstroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>"},"Ed": {"jsontree": {"id": "cw.Sys.JSON","params": {},"ui": {"#btn-save": {"bind": "function (d,v) {\n\t\t\t\tif (v!=null) this.my.trigger('#btn-save','savedoc.my');\n\t\t\t}"}},"Lib": {"isSystem": "function (d) {\n\t\t\tvar that = this,\n\t\t\t\t\tisNew = that.my.root().parents('.l-app').eq(0).my('data').isNew;\n\t\t\tif (!isNew) return !!(\n\t\t\t\t(d.level==1 && /^(_id|_rev|_local_seq)$/.test(d.key) && d.value) \n\t\t\t\t||\n\t\t\t\t(d.level>2 && d.path[1] =='_revs_info')\n\t\t\t\t||\n\t\t\t\t(d.path[1] == '_conflicts')\n\t\t\t);\n\t\t\treturn false;\n\t\t}"},"style": {" ": ""},"Ls": "function () {\n\t\n\t\t// Local storage manager\n\t\tvar ls = window.localStorage;\n\n\t\tvar storage =  function LS (key0, data){\n\t\t\tvar x,  key = \"cw.Sys.JSON.\"+key0;\n\t\t\tif (data) {\n\t\t\t\treturn ls.setItem(key, JSON.stringify(data));\n\t\t\t}\n\t\t\telse if (data===null || data===false) {\n\t\t\t\treturn ls.removeItem(key);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar x = ls.getItem(key);\n\t\t\t\tif (Object.isString(x)) return JSON.parse(x);\n\t\t\t\telse return null;\n\t\t\t}\n\t\t};\n\n\t\treturn storage;\n\t}","MakeList": "function (data,key,state) {\n\n\t\t// Object/array processor,\n\t\t// generates typed metaobject\n\n\t\tvar that=this,\n\t\t\t\ta=[],  \n\t\t\t\tb = data.value,\n\t\t\t\tsdbm = cw.lib.sdbm,\n\t\t\t\tatob = window.atob,\n\t\t\t\tvs = that.data.viewstate || {},\n\t\t\t\tfound = that.data.found || {},\n\t\t\t\tlevel = data.level + 1,\n\t\t\t\tisSearch = that.data.search.length > 2;\n\n\t\tvar keys = Object.keys(b);\n    \n    if (data.key == '_attachments' && data.path.length == 1 && data.path[0] == 'Root'){\n    \tkeys = keys.sortBy(function(k){\n        var l0 = k.indexOf('/')>-1;\n        if (/^index\\.htm/.test(k)) return '0'+k;\n        if (!l0) return '1'+k;\n        return '2'+k;\n      });\n    }\n    \n\t\tkeys.forEach(function(i){\n\t\t\tvar val = b[i],\n\t\t\t\t\tdt = $.type(val),\n\t\t\t\t\tman = dt == 'object' || dt == 'array' ? 'multi' : dt,\n\t\t\t\t\thash,\n\t\t\t\t\tbin,\n          reimg = /^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/;\n\t\t\t\n\t\t\t// viewstate\n\t\t\tvar path = data.path.slice(0).add(data.key),\n\t\t\t\t\tvkey = cw.lib.sdbm(path.join('❀')+'❀'+i);\n\n\t\t\tif (isSearch && !found[vkey]) return;\n\n\t\t\t// Photon-related stuff\n\t\t\tif (man == 'multi') {\n\t\t\t\tif (data.key == 'Root' && !data.path.length && i=='_attachments') {\n\t\t\t\t\tman = 'files';\n\t\t\t\t}\n\t\t\t\telse if (data.key == '_attachments' && data.path.length == 1 && data.path[0] == 'Root') {\n\t\t\t\t\tman = 'file';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Detect string-derived types\n\t\t\tif (dt == 'string'){\n\t\t\t\tif (isSearch && (found[vkey] | 8)) {\n\t\t\t\t\tman = 'found';\n\t\t\t\t\thash = sdbm(val);\n\t\t\t\t}\n\t\t\t\telse if (val.length > 11 && val.to(8) == 'function' && /\\}[\\r\\n\\t\\s]*$/.test(val.substr(-10))) {\n\t\t\t\t\tman = 'function';\n\t\t\t\t}\n\t\t\t\telse if(\n\t\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+$/.test(val.substr(0,158))\n\t\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+={0,2}$/.test(val)\n\t\t\t\t) {\n\t\t\t\t\tbin = _atob(val);\n\t\t\t\t\thash = sdbm(val);\n\t\t\t\t\tman = 'base64';\n\t\t\t\t}\n\t\t\t\telse if(\n\t\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t\t&& reimg.test(val)\n\t\t\t\t) {\n\t\t\t\t\tbin = _atob(val.replace(reimg,''));\n\t\t\t\t\thash = sdbm(val);\n\t\t\t\t\tman = 'base64';\n\t\t\t\t}\n\t\t\t\telse hash = sdbm(val);\n\t\t\t}\n\n\t\t\tif (!isSearch || found[vkey]) a.push({\n\t\t\t\tstate:state?state:!isSearch?vs[vkey] || 1:found[vkey],\n\t\t\t\tlevel:level,\n\t\t\t\tmanifest:'$'+man,\n\t\t\t\tpath:path,\n\t\t\t\ttype:dt,\n\t\t\t\tkey:i,\n\t\t\t\tid:i,\n\t\t\t\tvalue:b[i],\n\t\t\t\tbin:bin,\n\t\t\t\thash:hash\n\t\t\t});\n\t\t});\n\n\t\treturn a;\n\n\t\t// - - -\n\n\t\tfunction _atob(s){\n\t\t\tvar bin = '';\n\t\t\ttry {\n\t\t\t\tbin = atob(s);\n\t\t\t} catch(e){}\n\t\t\treturn bin;\n\t\t}\n\t}","$files": {"id": "Sys.JSON.Files","data": {},"List": [],"Txt": {"object": ["Files {","}"],"array": ["Array [","]"]},"init": "function _init_files($o,form) {\n\t\t\n\t\t// Special replacement for ._atatchments branch\n\t\t\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\tif (d.state > 1) that.List = that.MakeList(d);\n\t\t\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.RT('Rejoin')(d, that.List);\n\t\t}.debounce(300));\n\t\t\n\t\t$o.on(\"click.my\", \".ilist:eq(0) .btn-del\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $f = $(this).parents(\".my-form\").eq(0);\t\t\n\t\t\tvar p = $f.parent().data(\"my\").data,\n\t\t\t\t\tt = $.type(p.value),\n\t\t\t\t\tkey = $f.my(\"data\").key;\n\t\t\t\n\t\t\tif (t==\"object\") delete p.value[key];\n\t\t\telse if (t==\"array\") p.value.removeAt(key);\n\t\t\t\n\t\t\tthat.RT('Lib').relist($o, that, form);\n\t\t});\n\t\t\n\t}","ShowItems": null,"ui": {".ivalue": {"css": {"hide": "function () {return !this.List.length}"},"watch": [".idesc"]},".ilist": {"delay": 0,"check": false,"bind": "this.List","list": "<div class=\"irow\"></div>","id": "function (e) {return e.id;}","hash": "function (e) {return e.hash;}","manifest": "function (e) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn that.RT(e.manifest)||that.RT('$string');\n\t\t\t}","watch": [".idesc"]},".ikey": {"delay": 10,"bind": "function (d,v) {\n\t\t\t\treturn (!/^(|\\s+)$/.test(d.key))?d.key.truncate(25,'right','…'):'\"'+d.key+'\"'; \n\t\t\t}","css": {"bold": "function (d) {return d.state!=1}"},"watch": [".idesc"]},"#btn-upload": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v==null) return;\n\t\t\t\tvar that = this;\n\t\t\t\tif ($o.data('modal')) {\n\t\t\t\t\t$o.modal(true);\n\t\t\t\t\t_close();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$o.parent().addClass('hover');\n\t\t\t\t\tthat.my.modal('#btn-upload',{\n\t\t\t\t\t\tmanifest:that.Add,\n\t\t\t\t\t\tdata:{},\n\t\t\t\t\t\twidth:500,\n\t\t\t\t\t\talign:'top:103%, right:-38px;',\n\t\t\t\t\t\tnose:'top'\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\tres.files.forEach(function(file){\n\t\t\t\t\t\t\td.value[file.name] = Object.select(file, ['content_type','data']);\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.state=2;\n            that.List = that.MakeList(d);\n\t\t\t\t\t\tthat.my.redraw();\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t_close();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// - - - - -\n\t\t\t\tfunction _close(){\n\t\t\t\t\t$o.parent().removeClass('hover');\n\t\t\t\t}\n\t\t\t}"},"#btn-b64": {"bind": "function (d,v) {\n      \tif (v==null) return;\n        var that = this;\n        that.RT('GetAtts')()\n        .then(function(){\n        \tthat.my.redraw();\n        });\n      }"},".idesc": {"delay": 10,"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tlist = this.List, \n\t\t\t\t\t\tt = that.Txt[d.type],\n\t\t\t\t\t\tds = Object.size(d.value),\n\t\t\t\t\t\th=\"\";\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = ((d.state==1 && !(d.manifest==\"$multi\" && !ds))|| !d.level?2:1);\n\t\t\t\t\tif (d.state==2) that.List = that.MakeList(d);\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.List = [];\n\t\t\t\t\t\tthat.ShowItems = null;\n\t\t\t\t\t}\n\t\t\t\t\tthat.RT('MemState')(d);\n\t\t\t\t}\n\n\t\t\t\tif (d.state==1 && that.ShowItems) {\n\t\t\t\t\th = that.ShowItems +(ds?\" ▸\":\"\");\n\t\t\t\t} else {\n\t\t\t\t\th = t[0]+ds+t[1] +\" \"\n\t\t\t\t\th += (!ds || !d.level?\"\":!that.List.length?\"▸\":\"▾\");\n\t\t\t\t\tif (d.state == 2) h = '<span class=\"o40\">'+h+'</span>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t}","events": "click.my"}},"style": {">.ivalue>.ilist>.irow": "function () {\n\t\t\tvar x = 250,\n\t\t\t\t\tx1 = x - 27;\n\t\t\treturn {\n\t\t\t\t' .inav':'padding-left:'+x1+'px;',\n\t\t\t\t' .inav>.ikey':'margin-left:-'+x1+'px;width:'+x1+'px;',\n\t\t\t\t'>.inav':'padding-left:'+x+'px;',\n\t\t\t\t'>.inav>.ikey':'margin-left:-'+x+'px;width:'+x+'px;',\n\t\t\t}\n\t\t}"," .ivalue .inav": "margin:0;"},"HTML": "<div class=\"inav\"><div class=\"ikey\"></div><div class=\"idesc cp\">–</div></div><div class=\"ivalue imulti hide\"><div class=\"ilist\"></div></div><div class=\"iact buttons\"><button id=\"btn-b64\" class=\"button\" title=\"Fetch attachments’ base64\">&thinsp;<span class=\"fi-archive\"></span>&thinsp;</button><button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button><button id=\"btn-upload\" class=\"button\" title=\"Add attachment\"><span class=\"fi-paperclip\"></span></button><button class=\"btn-del button red\"  title=\"Del all attachments\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button></div>","Add": {"init": "function ($o) {\n\t\tvar that = this;\n\t\t\n\t\t$o.html(that.HTML);\n\t}","data": {"files": []},"ui": {"#flist": {"bind": "files","list": ">div","merge": false,"id": ["name"],"hash": "function (e) {return cw.lib.sdbm([e.name, e.content_type, e.data.length, e.data.to(100)])}","manifest": {"ui": {"#fname": "name","#fsize": "function (d,v) {\n\t\t\t\t\t\treturn (d.data.length/4*3|0).bytes(1).replace(/B$/,'b').replace(\n\t\t\t\t\t\t\t/^([0-9\\.]+)([a-z]+)$/i,\n\t\t\t\t\t\t\t'$1<div class=\"w35 dib tal pl2\">$2</div>'\n\t\t\t\t\t\t);\n\t\t\t\t\t}","#ftype": "content_type","#btn-fdel": {"delay": 10,"bind": "function (d,v) {if (v!=null) this.my.remove();}","events": "click.my"}}}},"#btn-attadd": {"bind": "function (d,v) {if(v!=null) this.my.commit();}","css": {":disabled": "function (d) {return !d.files.length}"},"watch": "#flist"},"#btn-attcancel": "function (d,v) {if(v!=null) this.my.cancel();}","#mupload": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v==null || !v) return;\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tflist = $o[0].files,\n\t\t\t\t\t\tfiles = [],\n\t\t\t\t\t\tresult = d.files.reduce(function(a,b){a[b.name] = b;return a;},{}),\n\t\t\t\t\t\tpis = [];\n\t\t\t\t\n\t\t\t\tfor(var i=0; i<flist.length;i++) files.push(flist[i]);\n\t\t\t\t\n\t\t\t\tfiles.forEach(function(f, i){\n\t\t\t\t\tif (!f) return;\n\t\t\t\t\t//a.name = f.name;\n\t\t\t\t\tvar data,\n\t\t\t\t\t\t\ta = {\n\t\t\t\t\t\t\t\tname:f.name,\n\t\t\t\t\t\t\t\tcontent_type: f.type || 'application/octet-stream'\n\t\t\t\t\t\t\t}, \n\t\t\t\t\t\t\tpi = $.Deferred(),\n\t\t\t\t\t\t\tfr = new FileReader(), \n\t\t\t\t\t\t\tri, \n\t\t\t\t\t\t\tsb64 = [];\n\t\t\t\t\t\n\t\t\t\t\tfr.onload = function(e){\n\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\t//a.length = sb64.length;\n\t\t\t\t\t\tresult[f.name] = a;\n\t\t\t\t\t\tpi.resolve();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t\tpis.push(pi.promise())\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tQ.allSettled(pis)\n\t\t\t\t.then((function(){\n\t\t\t\t\td.files = Object.values(result);\n\t\t\t\t\t$o.wrap('<'+'form>').closest('form').get(0).reset();\n\t\t\t\t\t$o.unwrap('form');\n\t\t\t\t\tthat.my.recalc('#flist');\n\t\t\t\t}).debounce(0));\n\t\t\t}"}},"HTML": "<div class=\"fs130 lh160 bolder\">Add files</div><div id=\"flist\" class=\"fs95\"><div class=\"frow  mb6\"><div id=\"btn-fdel\" class=\"red2 w20 dib vat pt3 cp\">✕</div><div class=\"w220 dib vat\"><input type=\"text\" class=\"w100p\" id=\"fname\" placeholder=\"File path/name.ext\"></div><div id=\"fsize\" class=\"w90 dib vat pt3 gray tar\"></div><div id=\"ftype\" class=\"w150 dib vat pt3 gray nw ell\"></div></div></div><div class=\"mt10\"><input id=\"mupload\" type=\"file\" multiple class=\"h30 w100p cp\" style=\"position:absolute;z-index:1;opacity:0;\"><div class=\"h30 pseudolink tdn\">Select files to attach...</div></div><div class=\"mt5 pt10 btd\"><button id=\"btn-attadd\" class=\"green mr2\">Attach files</button><button id=\"btn-attcancel\">Cancel</button></div>"}},"$file": {"id": "Sys.JSON.File","data": {},"List": [],"init": "function _init_file($o,form) {\n\t\t\n\t\t// Special replacement for ._attachments member (a file)\n\t\t\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\t//if (d.state > 1) that.List = that.MakeList(d);\n\t\t\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.RT('Rejoin')(d, that.List);\n\t\t}.debounce(300));\n\t\t\n\t\t$o.on(\"click.my\", \".ilist:eq(0) .btn-del\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $f = $(this).parents(\".my-form\").eq(0);\t\t\n\t\t\tvar p = $f.parent().data(\"my\").data,\n\t\t\t\t\tt = $.type(p.value),\n\t\t\t\t\tkey = $f.my(\"data\").key;\n\t\t\t\n\t\t\tif (t==\"object\") delete p.value[key];\n\t\t\telse if (t==\"array\") p.value.removeAt(key);\n\t\t\t\n\t\t\tthat.RT('Lib').relist($o, that, form);\n\t\t});\n\t\t\n\t}","ShowItems": null,"ui": {".ikey": {"delay": 10,"bind": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tvar key = ( \n\t\t\t\t\t(!/^(|\\s+)$/.test(d.key))\n\t\t\t\t\t?d.key.truncate(50,/\\//.test(d.key)?'left':'middle','…')\n\t\t\t\t\t:'\"'+d.key+'\"' \n\t\t\t\t).replace(/\\//g,'\\u2009/\\u2009').escapeHTML(); \n\t\t\t\t\n\t\t\t\tif (d.value.revpos==null) return key;\n\t\t\t\t\n\t\t\t\tvar rd = that.RT('data'),\n\t\t\t\t\t\tlink = [rd.baseurl.replace(/\\/$/,''), rd.dbname, rd.doc._id, d.key ].join('/').escapeHTML();\n\t\t\t\t\n\t\t\t\treturn '<a href=\"{1}\" target=\"_blank\" class=\"tdn\">{2}</a>'.assign(link, key);\n\t\t\t}","watch": [".idesc"]},".idesc": {"delay": 10,"bind": "function (d,v,$o) {\n\n\t\t\t\tvar that = this,\n\t\t\t\t\t\trd = that.RT('data'),\n\t\t\t\t\t\tlink = [rd.baseurl.replace(/\\/$/,''), rd.dbname, rd.doc._id, d.key].join('/').escapeHTML(),\n\t\t\t\t\t\tv = d.value,\n\t\t\t\t\t\tsize = (\n\t\t\t\t\t\t\t(v.data?v.data.length/4*3|0:0) \n\t\t\t\t\t\t\t|| +v.length \n\t\t\t\t\t\t\t|| +v.size \n\t\t\t\t\t\t\t|| 0\n\t\t\t\t\t\t).bytes(1).replace(/B$/,'b').replace(\n\t\t\t\t\t\t\t/^([0-9\\.]+)([a-z]+)$/i,\n\t\t\t\t\t\t\t'$1<div class=\"w35 dib tal pl2\">$2</div>'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmime = (v.content_type || 'application/octet-stream').escapeHTML(),\n\t\t\t\t\t\tfname = d.key.split('/').last().escapeHTML(),\n\t\t\t\t\t\trevpos = (!v.digest || v.revpos==null)?'<span class=\"fi-burst-new green1\"></span> New':('r:  '+v.revpos),\n\t\t\t\t\t\th = [\n\t\t\t\t\t\t\t'<div class=\"dib vat w100 pr10 tar o90\">{1}</div>'.assign(size),\n\t\t\t\t\t\t\t'<div class=\"dib vat w200 pr10 nw ell o60\">{1}</div>'.assign(mime),\n\t\t\t\t\t\t\t'<div class=\"dib vat o60 fs95\">{1}</div>'.assign(revpos)\n\t\t\t\t\t\t].join('');\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t}","events": "click.my"},"#btn-download": {"bind": "function (d,v,$o) {\n\t\t\t\tif (d.value.revpos == null) return;\n\t\t\t\tvar rd = this.RT('data');\n\t\t\t\t$o.attr('download', d.key.split('/').last());\n\t\t\t\t$o.attr('href', [rd.baseurl.replace(/\\/$/,''), rd.dbname, rd.doc._id, d.key].join('/'));\n\t\t\t}","css": {":disabled": "function (d,v) {return d.value.revpos == null}"}}},"style": {" .ikey": "cursor:normal;"," .iact .button": "padding: 0.15em 0 0.05em 0;"},"HTML": "<div class=\"inav\"><div class=\"ikey xgray fs100\"></div><div class=\"idesc\">–</div></div><div class=\"iact buttons\"><button class=\"btn-takeout button\" title=\"View as JSON\"><span class=\"fi-shopping-bag\"></span></button><a id=\"btn-download\" class=\"button fs90 vat\" title=\"Download file\" download=\"file.dat\"><span class=\"fi-download\"></span></a><button class=\"btn-del button red vat\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button></div>"}},"jsontext": {}},"$about": {"id": "cw.Photon.$about","hash": "function () {return 'about';}","title": "function () {  return 'About this node'; }","lang": {},"JSON": false,"Blob": false,"Url": false,"data": {"photon": {},"service": {"couchdb": "No message","version": "??","vendor": {"name": "unknown","version": "","variant": ""},"features": []},"ddoc": {},"cfg": {"maxWidth": "1600","listCols": [],"rootRepo": "","font": "auto","fontWeight": "300","fontCode": "auto","icon": "","maxTabs": 15,"loopActiveTasks": 5}},"Link": "<a href=\"{1}\" target=\"_blank\" referrerpolicy=\"no-referrer\" class=\"tdn nw ml4\">{2}</a>","HTML": ["<div class=\"w850 xgray\" style=\"margin:60px auto 30px auto;\">","<div class=\"w450 dib vat\">",{"row": "450px","label": "120px","rowCss": "my-row pb2","labelCss": "my-label fs90"},"<div id=\"atitle\">","<span class=\"dib fs150 lh160 pr20\" style=\"min-width:120px;\">","CouchDB <span id=\"aver\"></span>","</span>","</div>",["{L_URL}","spn#anode"],["{L_VENDOR}","spn#avendor"],["{L_COUCH}","spn#awelcome"],["{L_FEAT}","spn#afeatures"],"<div id=\"atitle\" class=\"mt20\">","<span class=\"dib fs150 lh160 pr6 mb2\" style=\"min-width:120px;\">","Photon <span id=\"apho\"></span>","</span>","<span id=\"aphobuild\"></span>","</div>",{"rowCss": "my-row pb6"},["{L_PHOADD}","spn#aphoadd"],["{L_PHOLIBS}","spn#apholibs.dib.vat.ml-4"],["{L_PHOFONTS}","spn#aphofonts.dib.vat.ml-4"],{"rowCss": "my-row mt8"},"<div id=\"hidecouchapp\" class=\"hide\">",[" ","<span class=\"blue o50 fi-download fs95 mr2 fs90\"></span> <a href=\"\" id=\"adl\" class=\"tdn\" download=\"photon.json\"></a>"],{"rowCss": "my-row mt5"},[" ","<span class=\"blue o50 fi-cloud fs90 mr1\"></span> <span id=\"aupd\" class=\"pseudolink tdn\">{L_CHECK_UPDATES}</span>"],[" ","<span class=\"blue o60 fi-social-github mr2\"></span> ","<a href=\"https://github.com/ermouth/couch-photon\" referrerpolicy=\"no-referrer\" target=\"_blank\" class=\"tdn\">{L_GITHUB}</a>"],"</div>",{"rowCss": "my-row mt20"},[" ","<span class=\"gray fs90\">(c) 2018 ermouth. Photon is MIT licensed.</span>"],"</div>","<div class=\"w350 dib vat ml50\">",{"row": "350px","label": "130px","rowCss": "my-row pb10","labelCss": "my-label fs90"},"<div id=\"atitle\" class=\"fs150 lh160 pb6\">{S_TITLE}</div>",["{S_REPO}","inp#srepo.w100p"],["{S_FCFAMILY}","inp#scfont.w100p.fs110"],["{S_FFAMILY}","inp#sfont.w100p.fs110"],["{S_FWEIGHT}","div#sfweight.dib.vam.w100p"],["{S_WIDTH}","num#swidth.w65",{"min": "1200","max": "1900","step": "10"},"<span> px</span>"],["{S_COLS}","div#scols.dib.vam.w100p"],["{S_POLL}","num#spoll.w65",{"min": "1","max": "3600","step": "1"},"<span> s</span>"],{"labelCss": "my-label fs90 pt8"},["{S_ICON}","<img style=\"width:64px;height:64px;\" class=\"dib vat br2\" id=\"sicon\">","<div class=\"dib vat pt3 pl10\">","<span class=\"pseudolink tdn\" id=\"btn-seticon\">{BTN_ICON}</span> <br>","<span class=\"pseudolink tdn hide\" id=\"btn-reseticon\">{BTN_ICON_RESET}</span>"],"<div id=\"sproxy\" class=\"hide\"></div>","</div>"],"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\tpi = $.Deferred();\n\t\t\n\t\tthat.Url = that.Pho().DownloadURL;\n\t\t\n\t\t$.extend(true, that.data.cfg, that.Pho('Cfg'));\n\t\t\n\t\tthat.Req({url:[], contentType:'application/json', dataType:'json'})\n\t\t.then(function(res){\n\t\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n\t\t\t$.extend(true, that.data.service, res);\n\t\t})\n\t\t.always(function(){\n\t\t\tpi.resolve();\n\t\t\tthat.readPhoton();\n\t\t});\n\t\t\n\t\treturn pi.promise();\n\t}","readPhoton": "function () {\n\t\tvar that = this,\n\t\t\t\turl,\n\t\t\t\tddoc = window.DDOC;\n\t\tif (!that.Pho('_compiled') || ! ddoc) return '';\n\t\t\n\t\tif (!that.Url) {\n\t\t\tthat.Req({\n\t\t\t\turl:[ddoc._db || '_photon', ddoc._id, {attachments:true}],\n\t\t\t})\n\t\t\t.then(function(res0){\n\t\t\t\tthat.data.ddoc = res0;\n\t\t\t\tvar res = $.extend(\n\t\t\t\t\ttrue,\n\t\t\t\t\t{_id:'',name:'',version:that.Pho('Version')+'.'+that.Pho('build')},\n\t\t\t\t\tObject.reject(res0, ['_rev','_attachments'])\n\t\t\t\t);\n        res._attachments = {};\n        Object.keys(res0._attachments).forEach(function(fname){\n          var f = res0._attachments[fname];\n        \tres._attachments[fname] = {\n          \tcontent_type:\tf.content_type,\n            data:\t\t\t\t\tf.data\n          };\n        });\n\t\t\t\t\n\t\t\t\tthat.JSON = res;\n\t\t\t\tvar blob = cw.lib.base642blob(\n\t\t\t\t\tcw.lib.base64(JSON.stringify(res, null, '  ')),\n\t\t\t\t\tfunction (blob){\n\t\t\t\t\t\tthat.Blob = blob;\n\t\t\t\t\t\tthat.Url = URL.createObjectURL(blob);\n\t\t\t\t\t\tthat.Pho().DownloadURL = that.Url;\n\t\t\t\t\t\tthat.my.check('#adl');\n\t\t\t\t\t},\n\t\t\t\t\t'application/json'\n\t\t\t\t);\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\tthat.Url='';\n\t\t\t\tthat.my.check('#adl');\n\t\t\t});\n\t\t}\n\t}","ui": {"#apho": "function () {\n\t\tvar that = this;\n\t\treturn that.Pho('Version').replace(/[^0-9\\.]/g,'');\n\t}","#aphobuild": "function () {\n\t\tvar that = this,\n\t\t\t\tbuild = that.Pho('build'),\n\t\t\t\tdt = Date.create(that.Pho('stamp') || Date.now()).format('{yyyy}-{MM}-{dd}');\n\t\tif (!build) return '';\n\t\treturn '<span class=\"gray\">Build '+build+', '+dt+'</span>';\n\t}","#aphoadd": "function () {\n\t\tvar that = this,\n\t\t\t\tapps = (window.DDOC || {apps:{ed:{id:'cw.Sys.JSON'}}}).apps,\n\t\t\t\th = [];\n\t\tObject.keys(apps).forEach(function(k){\n\t\t\tvar app = apps[k];\n\t\t\tif (!app.id || app.id == 'cw.Photon') return;\n\t\t\th.push([\n\t\t\t\t(app.name || app.id)+'\\u00a0',\n\t\t\t\tapp.Version || app.version || null,\n\t\t\t\tapp.build?'.'+app.build:null\n\t\t\t].compact().join(''));\n\t\t})\n\t\treturn h.join('')\n\t}","#apholibs": "function () {\n\t\tvar that = this,\n\t\t\t\tlibs = that.Pho('LibsUsed');\n\n\t\treturn Object.keys(libs).map(function(k){\n\t\t\tif (!libs[k]) return '<span class=\"tdn nw ml4\">'+k+'</span>';\n\t\t\treturn that.Link.assign(libs[k], k);\n\t\t}).join(', ');\n\t}","#aphofonts": "function () {\n\t\tvar that = this,\n\t\t\t\tlibs = that.Pho('FontsUsed');\n\n\t\treturn Object.keys(libs).map(function(k){\n\t\t\tif (!libs[k]) return '<span class=\"tdn nw ml4\">'+k+'</span>';\n\t\t\treturn that.Link.assign(libs[k], k);\n\t\t}).join(', ');\n\t}","#aver": "service.version","#avendor": "function (d) {\n\t\tvar s = d.service.vendor;\n\t\treturn (s.name+' '+s.version +(s.variant?' ('+s.variant+')':'')).escapeHTML();\n\t}","#anode": "function (d) {\n\t\tvar base = this.Pho('Base');\n\t\treturn '<a href=\"{1}\" target=\"_blank\" class=\"tdn\">{2} {3}</a>'.assign(\n\t\t\tbase, \n\t\t\t'<span class=\"fs90 '+(/^https:/.test(base)? 'fi-lock blue2':'fi-unlock red2')+'\"></span>',\n\t\t\tbase.replace(/^http[s]?:\\/\\/|\\//g,'').escapeHTML()\n\t\t);\n\t}","#awelcome": "function (d) {return d.service.couchdb.escapeHTML()}","#afeatures": "function (d) {\n\t\tvar f = d.service.features;\n\t\tif (!Object.isArray(f) || !f.length) return '—';\n\t\treturn d.service.features.join (', ').escapeHTML()\n\t}","#hidecouchapp": {"css": {"hide": "function () {\n        return !this.Pho('_compiled') || (cw.me('roles')||[]).indexOf('_admin')==-1;\n      }"}},"#aupd": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\trepo = that.Pho('Cfg').rootRepo;\n\t\t\t$.ajax({url:repo+'version.json',dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\tfunction _n(s) {\n\t\t\t\t\tvar a = s.split('.'); return a[0]*1e12 + a[1]*1e6 + (isNaN(a[2])?999999:+a[2]);\n\t\t\t\t}\n\t\t\t\tvar v0 = that.Pho('Version')+'.'+that.Pho('build'),\n\t\t\t\t\t\tcurr = _n(v0),\n\t\t\t\t\t\tv1 = res.version || '0.0.0',\n\t\t\t\t\t\tremote = _n(v1);\n\n\t\t\t\tif (curr >= remote) return cw.lib.note(that.lang.MSG_UPD_NONEED);\n\n\t\t\t\treturn $.ajax({url:repo+'photon.json', dataType:'json'})\n\t\t\t\t.then(function(res){\n\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttext:that.lang.TXT_UPD.assign(v0, v1),\n\t\t\t\t\t\t\tyes:that.lang.BTN_UPDATE,\n\t\t\t\t\t\t\tno:that.lang.BTN_CANCEL,\n\t\t\t\t\t\t\tcancel:''\n\t\t\t\t\t\t},\n\t\t\t\t\t\twidth:300,\n\t\t\t\t\t\tcss:'p20 xgray lh170 pb25'\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(dlg){\n\t\t\t\t\t\tif (dlg.cmd != 'yes' ||  !window.DDOC) return;\n\t\t\t\t\t\tres._rev = that.data.ddoc._rev || window.DDOC._rev;\n\t\t\t\t\t\tthat.Req({\n\t\t\t\t\t\t\turl:\t\t\t\t[DDOC._db || '_photon', res._id],\n\t\t\t\t\t\t\tmethod:\t\t\t'PUT',\n\t\t\t\t\t\t\tdata:\t\t\t\tJSON.stringify(res),\n              contentType:'application/json',\n\t\t\t\t\t\t\theaders:\t\t{Accept:'application/json'},\n\t\t\t\t\t\t\tdataType:\t\t'text'\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\tcw.lib.note(that.lang.MSG_UPDATE_OK, '', 6000);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\t\t\tcw.lib.note(that.lang.ERR_UPDATE.assign(code, err), 'error');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\tcw.lib.note(that.lang.ERR_UPDATE_CHECK, 'error');\n\t\t\t});\n\t\t}","events": "click.my"},"#adl": {"bind": "function (d,v,$o) {\n      var that = this,\n          url = that.Url,\n          ddoc = window.DDOC;\n      if (!that.Pho('_compiled') || !ddoc || url==='') return '';\n      if (url===false) return '<span class=\"gray\">'+that.lang.L_DLPREP+'</span>';\n      $o.attr('href', url);\n      $o.attr('download','photon-'+that.Pho('Version').replace(/[^0-9\\.]/g,'')+'.'+that.Pho('build')+'.json');\n      return that.lang.L_DL;\n    }"},"#swidth": "cfg.maxWidth","#sfont": {"init": "function ($o) {\n\t\t\tvar that = this;\n\t\t\t$o.select2({\n\t\t\t\tdata:[\n\t\t\t\t\t{id:'auto', text:'Auto'},\n\t\t\t\t\t{id:\"'-apple-system','BlinkMacSystemFont'\", text:'Apple system font'},\n\t\t\t\t\t{id:\"'Segoe UI'\", text:'Segoe UI'},\n\t\t\t\t\t{id:\"'Helvetica Neue',Helvetica\", text:'Helvetica'},\n\t\t\t\t\t{id:\"Cousine\", text:'Cousine (monospaced)'},\n\t\t\t\t\t{id:\"'PT Mono'\", text:'PT Mono (monospaced)'}\n\t\t\t\t],\n\t\t\t\tminimumResultsForSearch:12\n\t\t\t})\n\t\t}","bind": "cfg.font"},"#sfweight": {"init": "function ($o) {\n\t\t\t$o.tags({\n\t\t\t\ttags:[['300','400']],\n\t\t\t\tempty:{'200':'200'}\n\t\t\t})\n\t\t}","bind": "function (d,v) {\n\t\t\tif (v==null) return [d.cfg.fontWeight+''];\n\t\t\td.cfg.fontWeight = v+'';\n\t\t\treturn v;\n\t\t}"},"#scfont": {"init": "function ($o) {\n\t\t\tvar that = this;\n\t\t\t$o.select2({\n\t\t\t\tdata:[\n\t\t\t\t\t{id:'auto', text:'Auto'},\n\t\t\t\t\t{id:\"Cousine\", text:'Cousine (monospaced)'},\n\t\t\t\t\t{id:\"'PT Mono'\", text:'PT Mono (monospaced)'}\n\t\t\t\t],\n\t\t\t\tminimumResultsForSearch:12\n\t\t\t})\n\t\t}","bind": "cfg.fontCode"},"#scols": {"init": "function ($o) {$o.tags({tags:this.lang.TAG_COLS})}","bind": "cfg.listCols"},"#spoll": {"bind": "function (d,v) {\n\t\t\tif (v!=null) {\n\t\t\t\td.cfg.loopActiveTasks = isNaN(v)?5:(+v | 0).clamp(1,3600);\n\t\t\t}\n\t\t\treturn d.cfg.loopActiveTasks+'';\n\t\t}"},"#srepo": {"bind": "function (d,v) {\n\t\t\tif (v!=null) {\n\t\t\t\td.cfg.rootRepo = v.replace(/\\s/g,'');\n\t\t\t}\n\t\t\treturn d.cfg.rootRepo;\n\t\t}"},"#sicon": {"bind": "function (d,v) {\n\t\t\tif (!d.cfg.icon) return this.Pho('files')['favicon.png'].url;\n\t\t\treturn d.cfg.icon;\n\t\t}","watch": ["#btn-reseticon"]},"#btn-seticon": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tthat.my.modal('#btn-seticon', {\n\t\t\t\tmanifest:that.Cropper,\n\t\t\t\tglobal:true,\n\t\t\t\tcss:'p25',\n\t\t\t\tscreen:true\n\t\t\t})\n\t\t\t.then(function(res){\n\t\t\t\td.cfg.icon = res.data;\n\t\t\t\tthat.my.check('#sicon');\n\t\t\t})\n\t\t}","events": "click.my"},"#btn-reseticon": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\td.cfg.icon = '';\n\t\t}","events": "click.my","watch": "#sicon","css": {"self:hide": "function (d) {return !d.cfg.icon}"}},"#sproxy": {"delay": 300,"bind": "function (d,v) {\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this;\n\t\t\t$.extend(true, that.Pho('Cfg'), d.cfg);\n\t\t\tif (that.Pho('_compiled')) {\n\t\t\t\tthat.Pho('Ls')('Cfg', d.cfg);\n\t\t\t\t$('link[rel=\"icon\"]').attr(\"href\", d.cfg.icon || that.Pho('files')['favicon.png'].url);\n\t\t\t\t$(window).trigger('resize');\n\t\t\t}\n\t\t}","watch": ["#sfont","#srepo","#scfont","#sfweight","#swidth","#spoll","#sicon","#btn-reseticon","#scols"]}},"style": {" code": "font-size:103%;"},"Cropper": {"params": {"width": 685},"data": {"filename": "","data": "","cropped": false,"size": 64},"init": "function ($o,form) {\n\t\tvar html = $.my.formgen([\n\t\t'<div class=\"fl mr20 tac vat bg-lgray\" style=\"width:600px;height:450px;' \n\t\t\t\t+'overflow:hidden;position:relative;line-height:450px;\" id=\"crop-frame\">',\n  \t\t\t'<img id=\"source\" class=\"vam\" style=\"max-width:600px; max-height:450px; background:white\" src=\"\" />',\n  \t\t\t'<div class=\"w600  dib\" style=\"height:450px;position:absolute;top:0;left:0\">',\n  \t\t\t\t'<span class=\"dib vam fs110 button\">',\n  \t\t\t\t\t'<span class=\"fi-photo\"><span class=\"fs110\"> &nbsp;Select Image</span></span>',\n  \t\t\t\t'</span>',\n\t    \t\t'<input type=\"file\" id=\"file\" class=\"w600 dib\" accept=\"image/jpeg,image/png\" '\n\t    \t\t\t+'style=\"height:450px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n\t    \t'</div>',\n  \t\t'</div>',\n\t\t\t'<div class=\"w65 dib vat\" id=\"xpreview\">',\n\t\t\t'<img id=\"ipreview\" style=\"width:64px;height:64px;border:none;\" class=\"bg-gray7\">',\n\t\t\t\n  \t\t\t\t{row:\"65px\",rowCss:\"mt5 fs90 tac\"},\n      \t\t[\"\",\"btn#btn-apply.w65.green\",{val:\"Set\"}],\n  \t\t'</div>',\n  \t\t'<div class=\"w65 dib vat\" id=\"xwarn\">',\n  \t\t\t\n  \t\t'</div>',\n  \t\t'<div class=\"hide\">',\n\t\t\t\t'<canvas id=\"x2\" width='+form.data.size*2+' height='+form.data.size*2+'></canvas>',\n\t\t\t\t'<canvas id=\"preview\" class=\"bg-lgray\" style=\"width:64px;height:64px\" width='\n\t\t\t\t\t\t+form.data.size+' height='+form.data.size+' style=\"overflow:hidden;\"></canvas>',\n\t\t\t'</div>'\n\t\t]);\n\t\t$o.html(html);\n\t}","style": {" .jcrop-holder": "display:inline-block;vertical-align:middle"},"ui": {"#file": {"bind": "function (d,v,$o) {\n\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tf,\n\t\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t\t$c = $r.find(\"#preview\"),\n\t\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\t\t$c2 = $r.find(\"#x2\"),\n\t\t\t\t\t\tn={k:1}, img=\"\";\n\n\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\td.filename = f.name;\n\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\timg = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tfr.onloadend = function (){\n\t\t\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\t\t\tn.k = $img[0].naturalWidth/$img.width();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$img.removeClass(\"hide\")\n\t\t\t\t\t\t\t.attr(\"src\",\"data:image/jpeg;base64,\"+img);\n\n\t\t\t\t\t\t\tn.k=$img[0].naturalWidth/$img.width();\t\n\t\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\t\taspectRatio: 1,\n\t\t\t\t\t\t\t\tminSize:[64,64],\n\t\t\t\t\t\t\t\tallowMove:true\n\t\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\t\tthis.animateTo([100,100,300,300]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\timg=\"\";\n\t\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\n\t\t\t\tfunction preview (c){\n\t\t\t\t\tif(parseInt(c.w) > 0) {\n\t\t\t\t\t\t// Show image preview\n\t\t\t\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\t\t\t\tk = n.k,\n\t\t\t\t\t\t\t\tw = c.w*k | 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\tctx.globalCompositeOperation = 'copy';\n\t\t\t\t\t\tctx.fillStyle='transparent';\n\t\t\t\t\t\tctx.fillRect(0,0, d.size, d.size);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (w>d.size*2) {\n\t\t\t\t\t\t\t// double downsample to remove\n\t\t\t\t\t\t\t// bilinear-scaler artifacts\n\t\t\t\t\t\t\tcs2 = $c2[0];\n\t\t\t\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\t\t\t\tctx2.globalCompositeOperation = 'copy';\n\t\t\t\t\t\t\tctx2.fillStyle='transparent';\n\t\t\t\t\t\t\tctx2.fillRect(0, 0, d.size*2, d.size*2);\n\t\t\t\t\t\t\tctx2.drawImage(img, c.x*k  |0, c.y*k |0, w, w, 0, 0, d.size*2, d.size*2);\n\t\t\t\t\t\t\tctx.drawImage(cs2, 0, 0, d.size*2, d.size*2, 0, 0, d.size, d.size);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tctx.drawImage(img, c.x*k  |0, c.y*k  |0, w, w, 0, 0, d.size, d.size);\n\t\t\t\t\t\t}\n\t\t\t\t\t\td.data = cw.lib.image($c).map(function(x){return ((x*255|0)>>2<<2)/255}).sharpen(1.6).brightness(1.1).png();\n\t\t\t\t\t\tthat.my.find('#ipreview').attr('src',d.data);\n\t\t\t\t\t\td.cropped=true;\n\t\t\t\t\t\tthat.my.check('#btn-apply');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}"},"#btn-apply": {"delay": 50,"bind": "function (d,v) {\n\t\t\t\tif (v!=null && d.cropped) this.my.commit();\n\t\t\t}","events": "click.my","css": {":disabled": "function (d,v) {return !d.cropped;}"}}}}},"$error": {"id": "cw.Photon.$error","lang": {},"data": {"error": "","path": []},"hash": "function () {\n\t\treturn 'error';\n\t}","title": "function () { return 'Error switching #'+this.data.path.join('/'); }","init": ["<div class=\"p100 tac\">","<div id=\"e-msg\" class=\"red\"></div>","<div class=\" w50p mt25 tal dib vat\">","<button id=\"btn-reload\" class=\"w120 pr15 fs95\"><span class=\"fi-refresh o60\"></span> Try again </button>","</div>","</div>"],"ui": {"#e-msg": "function (d,v) {\n\t\t\tvar m;\n\t\t\ttry { m = !Object.isString(d.error)?JSON.stringify(d.error):d.error+''; } catch(e){}\n\t\t\tif (!m) m = (d.error+'') || 'Undefined error';\n\t\t\treturn this.lang.TXT_ERR.assign( '#'+d.path.join('/').escapeHTML(), m );\n\t\t}","#btn-reload": {"bind": "function (d,v) {\n\t\t\t\tif (v == null) return;\n\t\t\t\t$.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t}","listen": {"userCtx": "function (d,v) {\n\t\t\t\t\tif (!Object.isObject(v) || !v.name) return;\n\t\t\t\t\tif (!/\\s40[31]\\s/.test(d.error)) return;\n\t\t\t\t\t$.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t\t}"}}}},"$doc": {"id": "cw.Photon.$doc","lang": {},"data": {"isNew": false,"path": [],"rev": "","revlast": "","revstart": "","search": "","doc": {"_id": ""},"conflicts": [],"revs": [],"atts": false},"hash": "function () { return cw.lib.crc2(this.data.doc); }","title": "function () { \n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tp = d.path,\n\t\t\t\tid = d.doc._id;\n\t\treturn [\n\t\t\tp[0],\n\t\t\t'\\u2009/\\u2009',\n\t\t\tid.to(8)=='_design/'?'_d'+id.from(7):p[0]=='_users'?id.from(17):id,\n\t\t\td.rev?'\\u2009@\\u2009'+d.rev:''\n\t\t].join(''); \n\t}","init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\tif (d.path.length > (d.path[1]=='_design'?3:2)) {\n\t\t\td.rev = d.path.last().replace(/^\\D+/,'');\n\t\t}\n\t\td.revstart = d.rev;\n\t\t\n\t\treturn that.GetDoc()\n\t\t.then(function(){\n\t\t\t$o.html(that.HTML.assign(that.lang));\n\t\t});\n\t}","ui": {"#app-title": {"delay": 50,"bind": "function (d) {\n\t\t\n\t\t\tvar db = '<a class=\"tdn\" href=\"#{1}\" title=\"{3}\">{2}</a>'.assign(\n\t\t\t\td.path[0], \n\t\t\t\td.path[0].truncate(15,'middle','…').escapeHTML(),\n\t\t\t\td.path[0].escapeHTML()\n\t\t\t);\n      \n      var id = (d.doc._id || (d.path[1]+(d.path[1]=='_design'?'/'+d.path[2]:'')));\n      \n      var doclink = '<a target=\"_blank\" class=\"tdn\" href=\"{1}\" title=\"{3}\">{2}</a>'.assign(\n        ['', d.path[0], id].join('/').escapeHTML(),\n\t\t\t\tid.escapeHTML(),\n        id.length>15?id.escapeHTML():''\n      );\n\n      return [\n        '<span class=\"fs150 lh130 xgray mt-1 o80\">',\n        \t'<span class=\"o80\">{2}</span>\\u2009/\\u2009<span class=\"\">{1}</span>',\n        '</span>'\n      ].join('')\n      .assign(doclink,db);\n\t\t}","watch": ["#app-rev","#jseditor"]},"#app-rev": {"init": "function ($o) { this.RevsList(); }","bind": "rev"},"#app-search": {"delay": 20,"bind": "function (d,v) {\n\t\t\tif (v==null) return d.search;\n\t\t\td.search = v.length<3?'':v;\n\t\t\tif (this.Doc[0] && this.Doc[0].search != d.search) {\n\t\t\t\tthis.my.find('#json-search').val(d.search).trigger('check');\n\t\t\t}\n\t\t\treturn v;\n\t\t}","css": {"my-search": "new RegExp(/^.{3,}$/)"}},"#jseditor": {"delay": 100,"check": false,"list": "<div></div>","merge": false,"init": "function ($o) {\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t}","id": "function (e) {return e.doc._id}","hash": "function (e) {return cw.lib.sdbm(e.doc)}","manifest": "function (elt) {\n\t\t\tvar that = this;\n\t\t\treturn $.extend(\n\t\t\t\ttrue, {}, \n\t\t\t\tthat.Pho('Ed').jsontree, \n\t\t\t\tthat.ExtEd,\n\t\t\t\t{\n          MRoot: function(){return that.my.root()},\n          GetAtts:that.GetAtts\n        }\n\t\t\t);\n\t\t}","bind": "this.Doc"},"#btn-reload": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tthis.GetDoc(true);\n\t\t}"},"#btn-doc-save": {"bind": "function (d,v) {\n\t\t\tvar that = this;\n\t\t\tif (v==null) return;\n\t\t\t\n\t\t\t// check if we have editors open\n      var $e = that.my.find('#jseditor button#btn-change:visible'),\n\t\t\t\t\tel = $e.length;\n\t\t\tif (!el) { _doSave(); return; }\n\t\t\t\n\t\t\t// popup, apply/discard editions\n\t\t\tthat.my.modal('#btn-doc-save', {\n\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\tdata:{\n\t\t\t\t\ttext:that.lang.MSG_EDS,\n\t\t\t\t\tyes:that.lang.BTN_EDS_YES,\n\t\t\t\t\tno:that.lang.BTN_EDS_NO\n\t\t\t\t},\n\t\t\t\twidth:500,\n\t\t\t\tz:1995,\n\t\t\t\tscreen:true,\n\t\t\t\tglobal:true\n\t\t\t})\n\t\t\t.then(function(res){\n\t\t\t\tif (res.cmd != 'yes') { _doSave(); return; }\n\t\t\t\t// apply editions\n\t\t\t\t$e.each(function(i,e){\n\t\t\t\t\t$(e).trigger('click');\n\t\t\t\t\tif (i==el-1) _doSave(400);\n\t\t\t\t}.lazy(20));\n\t\t\t});\n\t\t\t\n\t\t\t// - - - - - - - -\n\t\t\t\n\t\t\tfunction _doSave(delay) {\n\t\t\t\t// mark busy\n\t\t\t\tthat.my.root().addClass('app-busy');\n\t\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:true});\n\t\t\t\t// save\n\t\t\t\tif (!delay) _saveAll();\n\t\t\t\telse _saveAll.debounce(delay)();\n\t\t\t}\n\t\t\t\n\t\t\tfunction _saveAll(){\n\t\t\t\t// save attempt\n\t\t\t\tthat.SaveAll()\n\t\t\t\t.always(function(){\n\t\t\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:false});\n\t\t\t\t\tthat.my.root().removeClass('app-busy');\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-doc-del": {"delay": 20,"bind": "function (d,v) {\n\t\t\tvar that = this;\n\t\t\tif (v==null) return;\n\t\t\t\n\t\t\t// mark busy\n\t\t\tthat.my.root().addClass('app-busy');\n\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:true});\n\t\t\t// save attempt\n\t\t\t\n\t\t\tthat.DelDoc()\n\t\t\t.always(function(){\n\t\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:false});\n\t\t\t\tthat.my.root().removeClass('app-busy');\n\t\t\t});\n\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\tvar co = d.conflicts || [],\n\t\t\t\t\t\tislast = d.revs && d.revs[0] && d.revs[0] == d.doc._rev;\n\t\t\t\tif (co.length) {\n\t\t\t\t\t// cant del old revs\n\t\t\t\t\treturn  !islast && co.indexOf(d.doc._rev||'') == -1;\n\t\t\t\t}\n\t\t\t\treturn !d.doc._rev || !islast;\n\t\t\t}"},"watch": ["#app-rev"]},"#state-proxy": {"delay": 50,"bind": "function (d,v) {\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this;\n\t\t\t\n\t\t\t//console.log('before', d.path.slice(0), [d.rev, d.revlast, d.doc._rev])\n\t\t\t\n\t\t\tif (d.rev) {\n\t\t\t\tif (d.path.last() != d.doc._id) d.path[d.path.length-1] = '_'+d.rev;\n\t\t\t\telse d.path.push('_'+d.rev);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (d.path.last() != d.doc._id) d.path.length = (d.path.length-1).clamp(2,6);\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\tif (d.rev != d.revlast) {\n\t\t\t\t$.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\t\td.revlast2 = d.revlast;\n\t\t\t\td.revlast = d.rev;\n\t\t\t\tthat.GetDoc(true, true)\n\t\t\t\t.then(function(){\n\t\t\t\t\td.revlast2 = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}","watch": "#app-rev","listen": {"dbdeleted": "function (d,v) {\n\t\t\t\tif (v!=d.path[0]) return;\n\t\t\t\tvar that = this;\n\t\t\t\t(function(){\t\n\t\t\t\t\tthat.my.root().trigger('tabclose',{tabid:d.tabid, enforce:true});\n\t\t\t\t}).debounce(Number.random(10,50))();\n\t\t\t}"}}},"die": "function ($o) {\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#jseditor').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t}","HTML": "<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\"><div class=\"fr w155 fs95\"><div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div><input type=\"text\" id=\"app-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span></div><button id=\"btn-reload\" class=\"w40 mr8\" title=\"{PLC_RELOAD}\"><span class=\"fi-loop\"></span></button><div id=\"app-title\" class=\"dib vat ell mr20 nw\"></div><div class=\"dib vat w200 mr10\"><input id=\"app-rev\" type=\"text\" class=\"w100p fs110 vat\"></div><div class=\"nw dib vat\"><button id=\"btn-doc-save\" class=\"green mr2\">{BTN_SAVE}</button><button id=\"btn-doc-del\" class=\"red\">{BTN_DEL}</button></div></div><div class=\"panelheight feather\"><div id=\"jseditor\" class=\"panelheight pl20 pr20 pt10 pb16\" style=\"outline:none;\"></div></div><div id=\"state-proxy\" class=\"hide\"></div>","style": {" #jseditor": {">div": "min-height:99.9%;",">.my-form>section>#editor>#doc>.iact.buttons": "padding-right:3px;"," .iact .button": "  height: 1.7em;line-height: 1.1em;"}," .my-modal-form": {" .CodeMirror .CodeMirror-lines": "line-height:17px;"," .CodeMirror-scroll": "min-height:150px;max-height:calc(18 * 17px + 6px);"," .CodeMirror-linenumbers": "transition: background-color 0.3s;",".ed-error .CodeMirror-linenumbers": "background-color:rgba(255, 200, 200, 0.75);"," .CodeMirror .cm-property": "color:#434e5d;"," .CodeMirror .cm-variable": "color:#33bfad;"," .CodeMirror .cm-keyword": "color:#90259e;"," .CodeMirror": "min-height:150px; height:auto;"," .buttons button": "margin-right: 2px;padding: 0.4em 0.7em 0.4em 0.7em;font-size: 90%;"}," #app-title": "max-width:calc(100% - 630px);"},"ExtEd": {"HTML": {"ItemRoot": "<div class=\"inav\"><div class=\"ikey\"></div><div class=\"idesc cp\">–</div></div><div class=\"ivalue imulti hide\"><div class=\"ilist\"></div></div><div class=\"iact buttons\"><button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button><button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button><button class=\"btn-del button red hide\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button><button id=\"btn-attach\" class=\"button\" title=\"Add attachment\" style=\"width:74px\"><span class=\"fi-paperclip\"></span><span class=\"fs90 dib vat\"> Attach…</span></button></div>"},"ui": {"#doc": {"manifest": "function (e) {\n\t\t\t\tif (!this.HTML.ItemRoot) return this.$multi;\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tMAtt = that.$files.Add;\n\t\t\t\treturn $.extend(true, {}, that.$multi, {\n\t\t\t\t\tHTML:that.HTML.ItemRoot,\n\t\t\t\t\tui:{\n\t\t\t\t\t\t'#btn-attach':{\n\t\t\t\t\t\t\tbind:function(d,v,$o){\n\t\t\t\t\t\t\t\tif (v==null) return;\n\t\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t\tif ($o.data('modal')) {\n\t\t\t\t\t\t\t\t\t$o.modal(true);\n\t\t\t\t\t\t\t\t\t_close();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$o.parent().addClass('hover');\n\t\t\t\t\t\t\t\t\tthat.my.modal('#btn-attach',{\n\t\t\t\t\t\t\t\t\t\tmanifest:MAtt,\n\t\t\t\t\t\t\t\t\t\tdata:{},\n\t\t\t\t\t\t\t\t\t\twidth:500,\n\t\t\t\t\t\t\t\t\t\talign:'top:103%, right:0px;',\n\t\t\t\t\t\t\t\t\t\tnose:'top'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.then((function(res){\n\t\t\t\t\t\t\t\t\t\tif (!d.value._attachments) d.value._attachments = {};\n\t\t\t\t\t\t\t\t\t\tres.files.forEach(function(file){\n\t\t\t\t\t\t\t\t\t\t\td.value._attachments[file.name] = Object.select(file, ['content_type','data']);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (!that.RT('data').viewstate) that.RT('data').viewstate = {};\n\t\t\t\t\t\t\t\t\t\tthat.RT('data').viewstate['Root❀_attachments']=2;\n\t\t\t\t\t\t\t\t\t\tthat.List = that.MakeList(d);\n\t\t\t\t\t\t\t\t\t\tthat.my.redraw();\n\t\t\t\t\t\t\t\t\t}).debounce(20))\n\t\t\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\t\t\t_close();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// - - - - -\n\t\t\t\t\t\t\t\tfunction _close(){\n\t\t\t\t\t\t\t\t\t$o.parent().removeClass('hover');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}"}}},"SaveAll": "function _save_$doc(onlySave,silent) {\n\t\n\t// Std fn to be called from tab manager and on save btn click.\n\t// -- onlySave == true  means we must not load doc after save (when tab is closed ie),\n\t// -- silent == true    means we do not popup success or fail\n\t\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tdoc = Object.clone(cw.lib.dry(d.doc), true),\n\t\t\tpi = $.Deferred(),\n\t\t\tl = that.lang;\n\n\t// try to save\n\tvar method = 'POST',\n\t\t\turl = [d.path[0]],\n\t\t\theaders  = {\n\t\t\t\t// Ensures immediate commit\n\t\t\t\t'X-Couch-Full-Commit':'true'\n\t\t\t};\n\tif (typeof doc._id == 'string') {\n\t\t// method should be put\n\t\tmethod = 'PUT';\n\t\turl.push(doc._id);\n\t}\n\telse delete doc._id;\n\t\n\tif (undefined == doc._id) delete doc._rev;\n\t\n\t// trying to save 1st time\n\t\n\t_saveDoc(doc)\n\t.fail(function(code, err, msg){\n\t\tif (code != 409) {\n\t\t\t// if not a conflict, reject with an error\n\t\t\tif (!silent) cw.lib.note(l.ERR_SAVE.assign(code+': '+es(msg.reason || err)), 'error'); \n\t\t\tpi.reject(code, err, msg);\n\t\t} \n\t\telse {\n\t\t\t\n\t\t\t//load doc\n\t\t\tthat.Req({method:'GET',url:[d.path[0], doc._id]})\n\t\t\t.then(function(xdoc){\n\t\t\t\t\n\t\t\t\t// show conflict modal\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\t\twidth:500,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\ttext: l.MSG_CONFLICT.assign(_trunc(doc._id, 40), _trunc(doc._rev, 25), _trunc(xdoc._rev, 25)),\n\t\t\t\t\t\tyes:\tl.BTN_CONFLICT_YES,\n\t\t\t\t\t\tno: \tl.BTN_CONFLICT_NO,\n\t\t\t\t\t\tcancel:''\n\t\t\t\t\t},\n\t\t\t\t\tcss:'xgray lh170 p20 pb25',\n\t\t\t\t\tesc:false,\n\t\t\t\t\tenter:false\n\t\t\t\t})\n\t\t\t\t.then(function(result){\n\t\t\t\t\tif (result.cmd == 'yes') {\n\t\t\t\t\t\td.doc._rev = xdoc._rev;\n\t\t\t\t\t\tthat.SaveAll(onlySave, silent)\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\t_reloadDoc(true);\n\t\t\t\t\t\t\t//pi.resolve(res);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\t\t\tpi.reject(code, err, msg);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse _saveCancelled();\n\t\t\t\t})\n\t\t\t\t.fail(_saveCancelled);\n\t\t\t\t\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\t// have conflict, but failed loading doc\n\t\t\t\t// reject\n\t\t\t\tconsole.log(code,err,msg);\n\t\t\t\tif (!silent) cw.lib.note(l.MSG_CONFLICT_LOADFAIL);\n\t\t\t\tpi.reject(999, 'Cancelled by user', l.MSG_CONFLICT_LOADFAIL);\n\t\t\t})\n\t\t\t\n\t\t}\n\t});\n\n\treturn pi.promise();\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _saveDoc(doc){\n\t\treturn that.Req({\n\t\t\turl:\t\t\t\t\turl, \n\t\t\tmethod:\t\t\t\tmethod, \n\t\t\theaders:\t\t\theaders,\n      contentType:\t'application/json',\n\t\t\tdata:\t\t\t\t\tJSON.stringify(doc), \n\t\t\tdataType:\t\t\tmethod=='PUT'?'text':'json'\n\t\t})\n\t\t.then(function(res0){\n\t\t\tvar res = res0;\n\t\t\ttry {\n\t\t\t\tres = Object.isString(res0)?JSON.parse(res0):res0;\n\t\t\t}catch(e){}\n\t\t\t// we succeeded,\n\t\t\tif (onlySave) {\n\t\t\t\t_notifyDocSaved();\n\t\t\t\treturn pi.resolve ($.extend(doc,{_id:res.id, _rev:res.rev}));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// reload doc if not skipped\n\t\t\t\tif (d.doc._conflicts && d.doc._conflicts.indexOf(d.doc._rev)>-1 && d.rev) {\n\t\t\t\t\t_reloadDoc.debounce(20)(res.rev);\n\t\t\t\t}\n\t\t\t\telse _reloadDoc.debounce(20)(true);\n\t\t\t}\n\t\t});\n\t}\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _saveCancelled(){\n\t\tif (!silent) cw.lib.note(l.MSG_CONFLICT_CANCELLED);\n\t\tpi.reject(999, 'Cancelled by user', l.MSG_CONFLICT_CANCELLED);\n\t}\n\n\t// - - - - - - - - - - - - \n\t\n\tfunction es(s) {return (s+'').escapeHTML();}\n\tfunction _trunc(s, chars) {return es((s+'').truncate(chars || 15,'right','…'));}\n\t\n\t// - - - - - - - - - - - - \n\n\tfunction _notifyDocSaved(){\n\t\t$.my.radio('dbupdate', {db:d.path[0], cmd:'write', docs:[d.doc._id]});\n\t\t// check should we notify db list, for _replicator\n\t\tif (d.path[0] == that.Pho('ReplicatorDB') && d.doc.create_target) {\n\t\t\tif (/(localhost|127\\.0\\.0\\.1)/.test(d.doc.target+'') || (d.doc.target+'').indexOf('/')==-1) {\n\t\t\t\t(function(){\n\t\t\t\t\t$.my.radio('dblist', ['_replicator', (d.doc.target+'').split('/').last()].compact('true'));\n\t\t\t\t}).debounce(300)();\n\t\t\t}\n\t\t}\n    else {\n      // notify DB list\n    \t$.my.radio('dblist', [d.path[0]]);\n    }\n\t\tif (!silent) {\n\t\t\tcw.lib.note(\n\t\t\t\tl.MSG_SAVE.assign( _trunc(d.doc._id), _trunc(d.rev || d.doc._rev || '')) ,\n\t\t\t\t'ok'\n\t\t\t);\n\t\t}\n\t}\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _reloadDoc(reset){\n\t\tif (reset===true) {\n\t\t\t// reset to latest rev\n\t\t\td.path[1] = d.doc._id;\n\t\t\td.path.length = 2;\n\t\t\td.rev = '';\n\t\t\tif (d.isNew) {\n\t\t\t\td.isNew = false;\n\t\t\t\t$.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\t}\n\t\t\t// reload doc and rebuild revs list in ui\n\t\t\tthat.GetDoc(true, true)\n\t\t\t.then(function(){\n\t\t\t\t_notifyDocSaved();\n\t\t\t\tpi.resolve(d.doc);\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\t// fail to read doc back\n\t\t\t\tif (!silent) cw.lib.note(l.ERR_SAVELOAD.assign(code+': '+es(err)), 'error');\n\t\t\t\treturn pi.reject(code, l.ERR_SAVELOAD.assign(err), msg);\n\t\t\t});\n\t\t} \n\t\t// set new rev\n\t\telse if (d.rev && typeof reset == 'string') {\n\t\t\td.rev = reset;\n\t\t\td.path[d.path.length-1] = '_'+reset;\n\t\t\tthat.my.recalc('#state-proxy');\n\t\t\t_notifyDocSaved();\n\t\t\tpi.resolve(d.doc);\n\t\t}\n\t}\n}","GetDoc": "function (redraw,rebuildRevList) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tparams = {conflicts:true, local_seq:true, revs_info:true, att_encoding_info:true},\n      wasBusy = false,\n\t\t\turl, rev,\n\t\t\tpi;\n  \n  // mark busy\n\t_busy.debounce(100)(true);\n\n\t// if new, just generate _id\n\t\n\tif (d.isNew){\n\t\tvar pi = $.Deferred();\n\t\tthat.Req(['_uuids',{count:5}])\n\t\t.then(function(res){\n\t\t\td.doc._id = d.doc._id || (res.uuids||['']).sample();\n\t\t})\n\t\t.always(function(){\n\t\t\tif (!d.doc._id) d.doc._id = cw.lib.hash8(Date.now()+d.path[0]+Number.random(1,1e15));\n\t\t\tthat.Doc = [{dbname:d.path[0], revision:'', baseurl:that.Pho('Base'), doc:that.data.doc}];\n      _busy(false);\n\t\t\tpi.resolve();\n\t\t});\n\t\treturn pi.promise();\n\t}\n\t\n\t// if not new, start reading real doc\n\t\n\tif (d.path.length > (d.path[1]=='_design'?3:2)) {\n\t\trev = d.path.last().replace(/^\\D+/,'');\n\t\turl = d.path.to(-1);\n\t}\n\telse url = d.path;\n  \n  if (d.atts) url.push({attachments:true, att_encoding_info:true});\n\t\n\t// we have rev, need two requests\n\tif (rev) {\n\t\t// read reqested rev\n\t\tpi = that.Req(url.concat([$.extend(!0,{},params,{rev:rev})]))\n\t\t.then(function(res){\n\t\t\td.doc = _resort(res);\n\t\t\t// read actual doc revto have all sys props in place\n\t\t\treturn that.Req(url.concat([params]))\n\t\t\t.then(function(res){\n\t\t\t\td.doc = $.extend(d.doc, Object.select(res, ['_conflicts','_revs_info','_local_seq']));\n\t\t\t\t_cleanRevs(d.doc);\n\t\t\t\tif (rebuildRevList) that.RevsList();\n\t\t\t\tthat.Doc = [{dbname:d.path[0], revision:d.rev, baseurl:that.Pho('Base'), doc:that.data.doc}];\n\t\t\t\tthat.my.trigger('#state-proxy','resettabhash.my');\n\t\t\t\tif (redraw) that.my.redraw();\n\t\t\t});\n\t\t});\n\n\t} \n\t\n\t// no rev, return single request\n\telse {\n\t\t\n\t\tpi = that.Req(url.concat([params]))\n\t\t.then(function(res){\n\t\t\td.doc = _resort(res);\n\t\t\t_cleanRevs(d.doc);\n\t\t\tif (rebuildRevList) that.RevsList();\n\t\t\tthat.Doc = [{dbname:d.path[0], revision:d.rev, baseurl:that.Pho('Base'), doc:that.data.doc}];\n\t\t\tthat.my.trigger('#state-proxy','resettabhash.my');\n\t\t\tif (redraw) that.my.redraw();\n\t\t});\n\t}\n  \n  pi.always(_busy.fill(false).debounce(10));\n  \n  return pi;\n\t\n\t// - - - - - - - - - - -\n\t\n\tfunction _resort(res) {\n\t\t// moves id, rev and files to top of the tree\n\t\treturn $.extend(res._attachments?{_id:'',_rev:'',_attachments:{}}:{_id:'',_rev:''}, res);\n\t}\n  \n  // - - - - - - - - - - -\n\t\n\tfunction _cleanRevs(doc) {\n\t\tif (Object.isArray(doc._revs_info)) {\n\t\t\tdoc._revs_info = doc._revs_info.filter(function(r){return r.status=='available'});\n\t\t}\n\t\td.conflicts = doc._conflicts || [];\n\t\td.revs = (doc._revs_info||[]).map(function(r){return r.rev});\n\t}\n  \n  // - - - - - - - - - - -\n  \n  function _busy(busy){\n    if ((busy && !wasBusy)  || !busy) {\n      if (that.my) that.my.root().toggleClass('app-busy', busy);\n      $.my.radio('appbusy',{id:d.tabid, busy:busy});\n    }\n    wasBusy = true;\n\t}\n\n}","GetAtts": "function () {\n  var that = this,\n      d = that.data,\n      url = [], \n      rev,\n      pi;\n\n  if (d.path.length > (d.path[1]=='_design'?3:2)) {\n    rev = d.path.last().replace(/^\\D+/,'');\n    url = d.path.to(-1);\n  }\n  else url = d.path;\n\n  if (rev) url.push({rev:rev});\n  \n  url.push({attachments:true, att_encoding_info:true});\n  \n  _busy.debounce(10)(true);\n  \n  d.atts = true;\n\n  return that.Req(url)\n  .then(function(res){\n    if (res._attachments) d.doc._attachments = res._attachments;\n    that.Doc = [{dbname:d.path[0], revision:d.rev, baseurl:that.Pho('Base'), doc:that.data.doc}];\n    that.my.trigger('#state-proxy','resettabhash.my');\n    that.my.redraw();\n  })\n  .fail(function(){\n\n  })\n  .always((function(){\n  \t_busy(false);\n  }).debounce(15));\n  \n  function _busy(busy){\n  \tthat.my.root().toggleClass('app-busy', busy);\n\t\t$.my.radio('appbusy',{id:d.tabid, busy:busy});\n  }\n\n}","DelDoc": "function _del_doc() {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tdoc = Object.clone(cw.lib.dry(d.doc), true),\n\t\t\tislast = d.revs[0] && d.revs[0] == d.doc._rev,\n\t\t\tisconflict = d.conflicts.indexOf(d.doc._rev||'') != -1,\n\t\t\tl = that.lang,\n\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t_trunc = function (s, chars) {return es((s+'').truncate(chars || 15,'right','…'));};\n\n\tvar pi = $.Deferred(),\n\t\t\turl = [d.path[0], doc._id, {rev:doc._rev}];\n\n\tvar trow = '<div class=\"mb10\">{1}</div>';\n\t\n\t$.my.modal({\n\t\twidth:350,\n\t\tmanifest:$.extend(\n\t\t\ttrue, {}, that.Pho('Confirm'),\n\t\t\t{\n\t\t\t\tui:{'input[name=\"retain\"]':'retain'},\n\t\t\t\tstyle:{' label':'margin:0;line-height:inherit;color:inherit;'}\n\t\t\t}\n\t\t),\n\t\tdata:{\n\t\t\tretain:'no',\n\t\t\ttext:[\n\t\t\t\t!isconflict?'<div class=\"fs130 red mb5\">'+l.TXT_DEL_TITLE+'</div>':'',\n\t\t\t\tisconflict?'<div class=\"fs130 orange mb5\">'+l.TXT_DEL_TITLE_CONFLICT+'</div>':'',\n\t\t\t\ttrow.assign(l.TXT_DEL_WARN.assign(_trunc(doc._id, 25), _trunc(d.path[0], 25))),\n\t\t\t\ttrow.assign([\n\t\t\t\t\t'<label class=\"xgray\"><input type=\"radio\" name=\"retain\" value=\"no\" class=\"mr6\"> '+l.LBL_DEL_ALL+'</label>',\n\t\t\t\t\t'<label class=\"xgray\"><input type=\"radio\" name=\"retain\" value=\"retain\" class=\"mr6\"> '+l.LBL_DEL_RETAIN+'</label>'\n\t\t\t\t].join('')),\n\t\t\t\td.conflicts.length && islast?trow.assign(l.TXT_DEL_NODEL):'',\n\t\t\t\tisconflict?trow.assign(l.TXT_DEL_CONFLICT):''\n\t\t\t].compact(true).join(''),\n\t\t\tyescss:isconflict?'orange':'red',\n\t\t\tyes:l.BTN_DEL_START,\n\t\t\tno:l.BTN_CANCEL,\n\t\t\tcancel:''\n\t\t},\n\t\tcss:'lh160 xgray p20 pb25'\n\t})\n\t.then(function(res){\n\t\tif (res.cmd!='yes') return pi.reject(999, 'Cancelled', 'Cancelled');\n\t\t_delReq(res.retain=='retain');\n\t})\n\t.fail(function(){\n\t\tpi.reject(999, 'Cancelled', 'Cancelled');\n\t})\n\n\n\treturn pi.promise();\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _delReq(retain){\n\t\t\n\t\tvar req = !retain?{\n\t\t\turl:\t\t\turl,\n\t\t\tmethod:\t\t'DELETE',\n\t\t\theaders:\t{'X-Couch-Full-Commit':'true'}\n\t\t}:{\n\t\t\turl:\t\t\t[d.path[0],'_bulk_docs'],\n\t\t\tmethod:\t\t'POST',\n      contentType:'application/json',\n\t\t\theaders:\t{'X-Couch-Full-Commit':'true'},\n\t\t\tdata: \t\tJSON.stringify({docs:[Object.merge({_deleted:true}, doc)]})\n\t\t};\n\t\t\n\t\treturn that.Req(req)\n\t\t.then(function(res){\n\t\t\t\n\t\t\tcw.lib.note(l.MSG_DEL_OK.assign( _trunc(doc._id), _trunc(d.path[0])) , 'ok');\n\t\t\t\n\t\t\t// notify tabs\n\t\t\ttry {\n\t\t\t\t$.my.radio('dbupdate', {db:d.path[0], cmd:'delete', docs:[doc._id]});\n        $.my.radio('dblist', [d.path[0]]);\n\t\t\t}catch(e){\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\t\n\t\t\t// decide should we close tab or reload doc\n\t\t\tif (d.conflicts.length) _reloadDoc(true);\n\t\t\telse {\n\t\t\t\t(function(){\n\t\t\t\t\tthat.my.root().trigger('tabclose', {tabid:d.tabid, enforce:true});\n\t\t\t\t}).debounce(100)();\n\t\t\t\tpi.resolve(res);\n\t\t\t}\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\t// fail to read doc back\n\t\t\tcw.lib.note(l.MSG_DEL_FAIL.assign(_trunc(doc._id), code, es(err)), 'error');\n\t\t\t// however, notify tabs\n\t\t\t$.my.radio('dbupdate', d.path[0]);\n\t\t\t\n\t\t\treturn pi.reject(code, err, msg);\n\t\t});\n\t\t\n\t}\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _reloadDoc(reset){\n\t\t// reset to latest rev\n\t\td.path[1] = doc._id;\n\t\td.path.length = 2;\n\t\tvar wasrev = d.rev;\n\t\td.rev = '';\n\t\t\n\t\tif (wasrev) $.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\n\t\t// reload revs list and doc\n\t\tthat.GetDoc(true)\n\t\t.then(function(){\n\t\t\tcw.lib.note(l.MSG_DEL_RELOAD, '', 4000);\n\t\t\tthat.RevsList();\n\t\t\tpi.resolve(d.doc);\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\t// fail to read doc back\n\t\t\tcw.lib.note(l.MSG_DEL_RELOAD_FAIL.assign(_trunc(d.doc._id), code, es(err)), 'error');\n\t\t\tpi.reject(code, err, msg);\n\t\t\t// enforce tab close\n\t\t\tthat.my.trigger('#btn-del-doc', 'tabclose', {tabid:d.tabid, enforce:true});\n\t\t});\n\t}\n\n}","RevsList": "function () {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tvals = [{id:'',text:that.lang.TXT_REV}];\n\n\td.conflicts.forEach(function(r){ vals.push({id:r, text:'x'+r}) });\n\td.revs.forEach(function(r){ vals.push({id:r, text:r}) });\n\n\tthat.my.find('#app-rev').select2({\n\t\tdata:vals,\n\t\tformatResult: _formatOpt,\n\t\tformatSelection: _formatOpt\n\t});\n\n\tfunction _formatOpt (e) {\n\t\tvar t = e.text.replace('-','–').truncate(17,'middle','<span class=\"orange\">…</span>');\n\t\tif (t[0] == 'x') t = '<span class=\"red1 bolder\">†</span>\\u2009'+t.from(1);\n\t\treturn '<nobr>'+t+'</nobr>';\n\t}\n}"},"$config": {"id": "cw.Photon.$config","lang": {},"data": {"path": [],"node": "","doc": {},"cmp": {"added": [],"updated": [],"deleted": [],"invalid": {}},"stamp": 0},"Doc": [],"Old": {},"Nodes": [],"MembersChecked": false,"hash": "function () {\n\t\treturn cw.lib.crc2((this.Doc[0]||{}).doc||{});\n\t}","title": "function () { return 'Config'; }","init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\treturn that.Get(false, true)\n\t\t.then(function(res){\n\t\t\t$o.html(that.HTML.assign(that.lang).assign({TITLE_HTML:that.TitleHTML[that.Pho('isCluster')?1:0]}));\n\t\t});\n\t}","ui": {"#app-title": {"init": "function ($o) {\n\t\t\tvar that = this;\n\t\t\tif (that.Nodes.length > 1) {\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:that.Nodes.map(function(e){return {id:e, text:e}}),\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t}\n\t\t}","bind": "function (d,v) { \n\t\t\tif (this.Nodes.length<2) return location.host; \n\t\t\tif (v != null) {\n\t\t\t\tif (d.node != v) this.Get(true);\n\t\t\t\td.node = v;\n\t\t\t}\n\t\t\treturn d.node;\n\t\t}"},"#cfg-warn": {"delay": 100,"init": "function ($o) {\n\t\t\t$o.niceScroll({\n\t\t\t\tbouncescroll: true,\n\t\t\t\t//preservenativescrolling:false,\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t}","bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tc = that.Cmp(),\n\t\t\t\t\th = '',\n\t\t\t\t\tl = that.lang,\n\t\t\t\t\ttu = c.updated.length,\n\t\t\t\t\tta = c.added.length,\n\t\t\t\t\ttd = c.deleted.length,\n\t\t\t\t\tti = Object.size(c.invalid),\n\t\t\t\t\tts = '<div><div class=\"fs110 bolder mt8 \">{1}</div>{2}</div>';\n\t\t\t\n\t\t\th = [\n\t\t\t\tti?ts.assign(l.LBL_IERR.assign(ti), Object.keys(c.invalid).map(function(k){\n\t\t\t\t\treturn '<div class=\"lh130 mb5\"><span class=\"red1\">{1}:</span> {2}</div>'.assign(k, c.invalid[k]);\n\t\t\t\t}).join('')):null,\n\t\t\t\ttu?ts.assign(l.LBL_IUPD.assign(tu), c.updated.join('<br>')):null,\n\t\t\t\tta?ts.assign(l.LBL_IADD.assign(ta), c.added.join('<br>')):null,\n\t\t\t\ttd?ts.assign(l.LBL_IDEL.assign(td), c.deleted.join('<br>')):null\n\t\t\t].compact().join('').replace(/\\u2003/g,'<span class=\"o60\"> /&nbsp;</span>');\n\t\t\t\n\t\t\td.cmp = c;\n\t\t\t\n\t\t\tif (!h.length) return '<div class=\"mt8\">'+l.TXT_ITITLE_EMPTY+'</div>';\n\t\t\treturn h;\n\t\t}"},"#app-search": {"delay": 20,"bind": "function (d,v) {\n\t\t\tif (v==null) return d.search;\n\t\t\td.search = v.length<3?'':v;\n\t\t\tif (this.Doc[0] && this.Doc[0].search != d.search) {\n\t\t\t\tthis.my.find('#json-search').val(d.search).trigger('check');\n\t\t\t}\n\t\t\treturn v;\n\t\t}","css": {"my-search": "new RegExp(/^.{3,}$/)"}},"#cfg-proxy": {"bind": "function () {\n\t\t\tthis.my.check('#cfg-warn');\n\t\t}","watch": ["#jseditor"]},"#jseditor": {"delay": 100,"check": false,"list": "<div></div>","merge": false,"init": "function ($o) {\n\t\t\t$o.niceScroll({\n\t\t\t\tbouncescroll: true,\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t}","id": "function (e) {return this.data.stamp}","hash": "function (e) {return cw.lib.crc2(e.doc)}","manifest": "function (elt) {\n\t\t\tvar that = this;\n\t\t\tvar isSystem = function(d){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tver = that.Pho('Couch').version,\n\t\t\t\t\t\tbanned = [\n\t\t\t\t\t\t\t\"daemons\",\"external\",\n\t\t\t\t\t\t\t\"httpd_design_handlers\",\"httpd_db_handlers\",\"httpd_global_handlers\",\n\t\t\t\t\t\t\t\"native_query_servers\",\"os_daemons\",\"query_servers\"\n\t\t\t\t\t\t];\n\n\t\t\t\tif ((ver >= '1.7.0' && ver < '2.0.0') || ver >= '2.1.1') {\n\t\t\t\t\tif (banned.indexOf(d.path[1]) > -1) return that.lang.BAN_HTTP;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\treturn $.extend(\n\t\t\t\ttrue, {}, \n\t\t\t\tthat.Pho('Ed').jsontree, \n        that.ExtEd,\n\t\t\t\t{\n\t\t\t\t\tMEdit:{data:{commitKeys:['Enter']}},\n\t\t\t\t\tMRoot: function(){return that.my.root()},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tLib:{\tisSystem:isSystem}\n\t\t\t\t}\n\t\t\t);\n\t\t}","bind": "this.Doc"},"#btn-cfg-save": {"delay": 20,"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tl = that.lang;\n\t\t\t\n\t\t\tif (that.Nodes.length > 1) {\n\t\t\t\n\t\t\t\tthat.my.modal('#btn-cfg-save', {\n\t\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\t\twidth:500,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\ttext:l.MSG_CLUSTER,\n\t\t\t\t\t\tyes:l.BTN_SAVECLUSTER,\n\t\t\t\t\t\tyescss:'orange',\n\t\t\t\t\t\tno:l.BTN_SAVENODE.assign(d.node.split('@')[1].truncate(17,'middle','…').escapeHTML()),\n\t\t\t\t\t\tnocss:'green',\n\t\t\t\t\t},\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true,\n\t\t\t\t\tz:1992\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\tif (res.cmd == 'no') that.Save([d.node]);\n\t\t\t\t\telse that.Save();\n\t\t\t\t})\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.Save();\n\t\t\t}\n\t\t}","css": {":disabled": "function (d,v) {return d.cmp.updated+d.cmp.added+d.cmp.deleted=='';}"},"watch": ["#cfg-warn"]},"#btn-reload": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tthat.Get(true);\n\t\t}","listen": {"userCtx": "function (d,v) {\n\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\tif (!v.name) $.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t}","revert_config": "function () {this.Get.debounce(150)(true);}"}}},"die": "function ($o) {\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#jseditor').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t}","TitleHTML": ["<div id=\"app-title\" class=\"dib vat fs160 lh120 ell mr20\" style=\"max-width:40%\"></div>","<div class=\"dib vat fs115 mr20 w40p\"><input type=\"text\" id=\"app-title\" class=\"w100p bolder\"></div>"],"style": {" #jseditor>div": "font-size:14.5px!important;min-height:550px;"," #jseditor .inav": "margin:1px 0!important;"," .iact .button": "padding: 0.05em 0 0.1em 0!important;"," #jseditor>.my-form>section>#editor>#doc>.iact.buttons": "padding-right:3px;"," .CodeMirror-linenumber": "white-space:nowrap;"," .my-modal-form": {" .CodeMirror .CodeMirror-lines": "line-height:17px;"," .CodeMirror-scroll": "min-height:150px;max-height:calc(18 * 17px + 6px);"," .CodeMirror-linenumbers": "transition: background-color 0.3s;",".ed-error .CodeMirror-linenumbers": "background-color:rgba(255, 200, 200, 0.75);"," .CodeMirror .cm-property": "color:#434e5d;"," .CodeMirror .cm-variable": "color:#33bfad;"," .CodeMirror .cm-keyword": "color:#90259e;"," .CodeMirror": "min-height:150px; height:auto;"," .buttons button": "margin-right: 2px;padding: 0.4em 0.7em 0.4em 0.7em;font-size: 90%;"}},"ExtEd": {"HTML": {"ItemRoot": "<div class=\"inav\"><div class=\"ikey\"></div><div class=\"idesc cp\">–</div></div><div class=\"ivalue imulti hide\"><div class=\"ilist\"></div></div><div class=\"iact buttons\"><button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button><button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button><button class=\"btn-copy button\" title=\"Stash node as clip\"><span class=\"fi-clipboard\"></span></button><button class=\"btn-del button red hide\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button><button id=\"btn-revert\" class=\"button\"  title=\"Revert to saved\">&thinsp;<span class=\"fi-refresh\"></span>&thinsp;</button></div>"},"ui": {"#doc": {"manifest": "function (e) {\n\t\t\t\tif (!this.HTML.ItemRoot) return this.$multi;\n\t\t\t\tvar that = this;\n\t\t\t\treturn $.extend(true, {}, that.$multi, {\n\t\t\t\t\tHTML:that.HTML.ItemRoot,\n\t\t\t\t\tui:{\n\t\t\t\t\t\t'#btn-revert':{\n\t\t\t\t\t\t\tbind:function(d,v,$o){\n\t\t\t\t\t\t\t\tif (v==null) return;\n                $.my.radio('revert_config', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}"}}},"Get": "function (redraw,silent) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\tnodes = [];\n\t\n\t// check cluster\n\tif (that.Pho('isCluster') || !that.MembersChecked) {\n\t\tthat.Req(['_membership'])\n\t\t.then(function(res){\n\t\t\tif (!Object.isObject(res) || !Object.isArray(res.all_nodes) || !Object.isArray(res.cluster_nodes)) _readCfg();\n\t\t\telse {\n\t\t\t\t\n\t\t\t\tnodes = res.cluster_nodes.slice(0).intersect(res.all_nodes);\n\t\t\t\t\n\t\t\t\tif (nodes.length == 1) {\n\t\t\t\t\tthat.Pho().isCluster = false;\n\t\t\t\t}\n\t\t\t\tthat.Nodes = nodes;\n\t\t\t\tif (nodes.indexOf(d.node) == -1) d.node = nodes[0];\n\t\t\t\tthat.MembersChecked = true;\n\t\t\t\t_readCfg();\n\t\t\t}\n\t\t})\n\t\t.fail(function(code){\n\t\t\tif (code != 401 && code != 403) {\n\t\t\t\tthat.Pho().isCluster = false;\n\t\t\t\tthat.MembersChecked = true;\n\t\t\t}\n      console.log('This 400 is normal, we checked if we are in cluster.');\n\t\t\t_readCfg();\n\t\t});\n\t}\n\telse _readCfg();\n\t\n\treturn pi.promise();\n\t\n\t\n\t// read config\n\tfunction _readCfg() {\n\t\t\n\t\tvar path = ['_config'];\n\t\tif (that.Nodes.length) {\n\t\t\tif (that.Nodes.length == 1 || !d.node) path.unshift('_node', that.Nodes[0]);\n\t\t\telse path.unshift('_node', d.node);\n\t\t}\n\t\t\n\t\tthat.Req(path)\n\t\t.then(function(res){\n      var obj = {};\n\t\t\tObject.keys(res).sort().forEach(function(i){\n\t\t\t\tif (!Object.isObject(res[i])) obj[i] = res[i];\n        else obj[i] = Object.keys(res[i]).sort().reduce(function(a,b){\n          a[b] = _translate (res[i][b]); \n          return a;\n        },{});\n\t\t\t});\n      d.doc = obj;\n\t\t\tthat.Doc = [{labelWidth:200, doc:that.data.doc, _id:'_config'}];\n\t\t\tthat.Old = Object.clone(d.doc, true);\n\t\t\td.cmp = {added:[],updated:[],deleted:[],invalid:{}};\n\t\t\treturn res;\n\t\t})\n\t\t.then(function(res){\n\t\t\td.stamp = Date.now();\n\t\t\tif (redraw) that.my.recalc('#jseditor');\n\t\t\tthat.my.trigger('#cfg-proxy','resettabhash.my');\n\t\t\tpi.resolve(res);\n\t\t})\n\t\t.fail(function(code,err,msg){\n\t\t\tif (!silent) cw.lib.note(that.lang.ERR_RELOAD.assign(code, err.truncate(45,'right','…').escapeHTML()), 'error');\n\t\t\tpi.reject(code,err,msg);\n\t\t});\n\t}\n  \n  // translate nodes\n  function _translate (s) {\n  \tif (typeof s != 'string') return s;\n    if (s=='true') return true;\n    if (s=='false') return false;\n    if (/^\\d{1,15}$/.test(s)) return +s;\n    return s;\n  }\n  \n}","Cmp": "function _compare() {\n\t// compares this.Old and data.doc,\n\t// returns {updated, added, deleted, invalid}\n\t\n\tvar res = {\n\t\tupdated:[],\n\t\tadded:[],\n\t\tdeleted:[],\n\t\tinvalid:{},\n\t\toldcfg:{},\n\t\tnewcfg:{}\n\t};\n\t\n\tvar that = this,\n\t\t\tl = that.lang,\n\t\t\tle = l.ERR_VAL,\n\t\t\told = Object.clone(that.Old, true),\n\t\t\tcfg = Object.clone(that.data.doc, true),\n\t\t\tv0 = res.oldcfg = _keys(old, false),\n\t\t\tv1 = res.newcfg = _keys(cfg, true), \n\t\t\tinv = Object.keys(res.invalid),\n\t\t\tk0 = Object.keys(v0).subtract(inv),\n\t\t\tk1 = Object.keys(v1).subtract(inv);\n\t\n\t// deleted\n\tres.deleted = k0.subtract(k1);\n\tres.added = k1.subtract(k0);\n\tres.updated = k1.subtract(res.added).filter(function(k){\n\t\treturn JSON.stringify(v0[k]) != JSON.stringify(v1[k]);\n\t});\n\t\n\treturn res;\n\t\n\t// - - - - - - - - - - -\n\t\n\tfunction _keys(obj, check) {\n\t\tvar a = {},\n\t\t\t\tre = /^[a-z0-9:_\\-!\\.]+$/i,\n\t\t\t\trehkey0 = /^httpd_.+_handlers$/,\n\t\t\t\trehkey1 = /^[a-z0-9:_\\-!\\.\\/]+$/i;\n\t\t\n\t\tObject.keys(obj).forEach(function(lvl0){\n\t\t\tvar sobj = obj[lvl0];\n\t\t\tif (!Object.isObject(sobj)) return;\n\t\t\t\n\t\t\tObject.keys(sobj).forEach(function(lvl1){\n\t\t\t\tvar k = lvl0+'\\u2003'+lvl1;\n\t\t\t\tif (check) {\n\t\t\t\t\tif (rehkey0.test(lvl0) && !rehkey1.test(lvl1)) {\n\t\t\t\t\t\t//invalid key\n\t\t\t\t\t\tres.invalid[k] = le.CHARS;\n\t\t\t\t\t}\n\t\t\t\t\tif (!rehkey0.test(lvl0) && !re.test(lvl1)) {\n\t\t\t\t\t\t//invalid key\n\t\t\t\t\t\tres.invalid[k] = le.CHARS;\n\t\t\t\t\t}\n\t\t\t\t\telse if (/^(null|array|object)$/.test($.type(sobj[lvl1]))) {\n\t\t\t\t\t\t//invalid val\n\t\t\t\t\t\tres.invalid[k] = le.VALSTRING;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ta[k] = sobj[lvl1];\n\t\t\t});\n\t\t});\n\t\treturn a;\n\t}\n\t\n}","Save": "function _save_config(nodes0) {\n\tvar that = this,\n\t\t\tcfg = that.Cmp(),\n\t\t\tnc = cfg.newcfg,\n\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\tl = that.lang,\n\t\t\tsteps = [],\n\t\t\terrs = {},\n\t\t\tnodes = (nodes0 || that.Nodes).slice(0);\n\t\n\t// Pre 2.0\n\tif (!nodes.length) {\n\t\tcfg.deleted.forEach(function(k){\n\t\t\tsteps.push({ key:k, value:null })\n\t\t});\n\t\tcfg.added.concat(cfg.updated).forEach(function(k){\n\t\t\tsteps.push({ key:k, value:nc[k]+'' })\n\t\t});\n\t}\n\t// cluster\n\telse {\n\t\tnodes.forEach(function(node) {\n\t\t\tcfg.deleted.forEach(function(k){\n\t\t\t\tsteps.push({ url:['_node', node, '_config'], key:k, value:null });\n\t\t\t});\n\t\t\tcfg.added.concat(cfg.updated).forEach(function(k){\n\t\t\t\tsteps.push({ url:['_node', node, '_config'], key:k, value:nc[k]+'' })\n\t\t\t});\n\t\t});\n\t}\n\n\tvar ctr = steps.length;\n\tsteps.forEach(function(obj, i){\n\t\t\t\t\n\t\tthat.Req({\n\t\t\turl:(obj.url || ['_config']).concat(obj.key.split('\\u2003')), \n\t\t\tmethod:obj.value !== null?'PUT':'DELETE',\n      contentType: obj.value !== null?'application/json':null,\n\t\t\t//headers:obj.value !== null?{'Content-type':'application/json'}:{},\n\t\t\tdata:obj.value !== null?JSON.stringify(obj.value):undefined\n\t\t})\n\t\t.then(function(){\n\t\t\tif (obj.key == 'replicator\\u2003db') that.Pho().ReplicatorDB = obj.value;\n\t\t\tcw.log('Photon updated config key', obj.key.split('\\u2003'));\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\terrs[obj.key] = {code:code, error:err, reason:msg};\n\t\t})\n\t\t.always(function(){\n\t\t\tctr -= 1;\n\t\t\tif (!ctr) _end();\n\t\t});\n\n\t}.lazy(that.Pho('Cfg').batchUpdateCfg || 100));\n\t\n\t// - - - - - - - - - -\n\t\n\tfunction _end(){\n\t\tif (Object.size(errs)) {\n\t\t\tcw.lib.note(l.MSG_SAVE_FAIL, 'error');\n\t\t\tconsole.log ('Errors during config update:');\n\t\t\tconsole.log(errs);\n\t\t}\n\t\telse {\n\t\t\tcw.lib.note(l.MSG_SAVE_OK, 'ok');\n\t\t\tthat.Get(true);\n\t\t}\n\t}\n}","HTML": "<div class=\"w75p  dib vat\" id=\"cfg-panel-left\"><div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\"><div class=\"fr w155 fs95\"><div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div><input type=\"text\" id=\"app-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span></div>{TITLE_HTML}<div class=\"nw mr10 dib vat tac w40p\" ><button id=\"btn-reload\" class=\"w40 mr2\" title=\"{BTN_REVERT}\"><span class=\"fi-refresh\"></span></button><button id=\"btn-cfg-save\" class=\"green mr2\" disabled>{BTN_SAVE}</button></div></div><div class=\"panelheight feather\"><div id=\"jseditor\" class=\"panelheight pl20 pr20 pt10 pb16\" style=\"outline:none;\"></div></div></div><div class=\"w25p dib vat\"><div id=\"a-head\" class=\"app-head nw pt18 ml15 mr20\"><div class=\"dib vat fs150 lh120 xfray o70\">{TXT_ITITLE}</div></div><div class=\"ml15 panelheight feather fs95 lh150\"><div id=\"cfg-warn\" class=\"panelheight pr20 pb16\" style=\"outline:none;\"></div></div><div id=\"cfg-proxy\" class=\"hide\"></div></div>"},"$view": {"id": "cw.Photon.$view","lang": {},"Steps": [10,20,50,100,200,500],"Modals": {},"Result": [],"Rows": [],"Error": "","fRows": null,"Ddocs": {},"Views": [],"Vi": {},"ViEds": {},"Pending": {},"List": [],"Editor": [],"RT": "function (key) {return null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];}","Index": "function _indexRow(row) {return JSON.stringify(row, null, '  ');}","die": "function ($o) {\n    // Unmount niceScroll\n    var $v = $o.find('#view-results'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n    $v.list('remove');\n  }","s2p": "function _state2path() {\n    // converts curr state to path array\n\n    var that = this,\n        d = that.data,\n        db = d.path[0],\n        p = [db];\n\n    if (!d.start && !d.view) return [d.path[0]];\n\n    var view = that.Vi[d.view],\n        av = d.view.split('\\ufffd');\n    \n   if (d.view.to(5) == '_find') {\n      p.push('_find');\n      p.push(av[1] || 'Default query')\n    }\n    else if (d.view.to(4) == '_idx') {\n      p.push('_index');\n      if (d.view.to(6) != '_idx/\\ufffd') p.push(av[0].split('/')[1], av[1]);\n      else  p.push('Default index');\n    }\n    else if (view) p.push('_view', view.path[2], view.path[4]);\n    else p.push('_all_docs');\n\n    if (!d.start) return p;\n    p.push(d.start, (d.reverse?'-':'')+(+d.limit));\n    return p;\n  }","hash": "function () {return 'view';}","title": "function () { \n    var that = this, d = that.data, p = d.path,\n        isMango = d.view.to(5)=='_find',\n        view = !d.view?'':d.view=='_'?'_design/*':d.view.split('\\ufffd')[1],\n        slash = isMango?'⊶':'÷';\n    return p[0]+(view?'\\u2009'+slash+'\\u2009'+view:'');\n  }","jseval": "function (s) {\n  \t// ToDo: Put uglify in front of eval\n    var r;\n    try {r = eval('('+s+')')} catch(e){}\n    return r;\n  }","data": {"path": [],"search": "","view": "","start": "","limit": "+100","reverse": false,"reduce": "","state": "","selection": [],"link": "","total_rows": 0,"offset": 0,"seq": "","xkey": "0","editor": false,"mango": {"active": "Default query","mode": ["javascript"],"query": [{"name": "Default query","text": "({})","json": {},"errors": [],"stamp": 0}]}},"DefaultMangoQry": {"name": "Default query","type": "mango","text": "({\n  // Matching docs selector\n  selector: {\n    _id: {$gt: ''}\n  },\n  \n  // Doc fields to return, \n  // comment out to get whole docs\n  fields: ['_id', '_rev', /*'x.y'*/],\n  \n  // Sort order, like:\n  // sort: [{_id:'asc'}, {name: 'desc'}]\n  \n  // When edit, use Cmd-R to run query\n})","json": {"selector": {"_id": {"$gt": ""}},"fields": ["_id","_rev"]},"errors": [],"stamp": 0},"DefaultMangoIdx": {"name": "Default index","ddoc": "","type": "index","text": "({\n  index: {\n\t\tfields: [{_id: 'asc'}]\n\t},\n\t// partial_filter_selector:{\n\t// \t'foo.bar':{$gt:0}\n\t// }\n})","json": {"index": {"fields": [{"_id": "asc"}]}},"errors": [],"stamp": 0},"ui": {"#view-name": {"init": "function ($o) {\n\t\t\t$o.select2({\n\t\t\t\tdata:this.Views,\n\t\t\t\tminimumResultsForSearch:12\n\t\t\t})\n\t\t}","bind": "function (d,v) {\n\t\t\tif (v==null) return d.view;\n\t\t\tif (d.view != v) {\n\t\t\t\td.start = '';\n\t\t\t\tthis.Rows = [];\n        this.Error = '';\n        this.Editor = [];\n        if (v.to(5)=='_find' || v.to(4)=='_idx')  d.editor = true;\n        else if (!v) d.editor = false;\n\t\t\t}\n\t\t\td.view = v;\n      \n\t\t\treturn d.view;\n\t\t}"},"#view-limit": {"init": "function ($o) {\n\t\t\tvar that = this,\n\t\t\t\t\td = that.data,\n\t\t\t\t\tlim = (Math.abs(+d.limit) || 100).clamp(1,10000);\n\t\t\t$o.select2({\n\t\t\t\tdata:this.Steps.concat([lim]).unique().sortBy().map(function(e){\n\t\t\t\t\treturn {id:'+'+e, text:e+''}\n\t\t\t\t}),\n\t\t\t\tminimumResultsForSearch:1e4\n\t\t\t})\n\t\t}","bind": "function (d,v) {\n\t\t\tif (v==null) return d.limit;\n\t\t\td.limit = v;\n\t\t\treturn d.limit;\n\t\t}"},"#view-startkey": {"delay": 50,"bind": "start","events": "input.my","watch": ["#btn-clear-startkey","#btn-view-plus","#btn-view-minus","#view-name"],"css": {"my-search": "new RegExp(/^.{1,}$/)"}},"#btn-view-minus": {"delay": 1,"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tnewstart = d.start,\n\t\t\t\t\ttr = +d.total_rows,\n\t\t\t\t\tlim = +d.limit,\n\t\t\t\t\tisReduce = that.Vi[d.view] && that.Vi[d.view].reduce && d.reduce+'',\n          isMango = d.view.to(5) == '_find';\n\t\t\tif (!d.start) {\n\t\t\t\tif (tr > lim || isReduce || isMango) newstart = '_'+(tr - lim).clamp(0, 1e12);\n\t\t\t}\n\t\t\telse if (/^_\\d+$/.test(d.start)) {\n\t\t\t\tnewstart = '_'+((+d.start.substr(1)||0)-lim).clamp(0, isReduce || isMango?1e12:tr);\n\t\t\t}\n\t\t\tif (newstart=='_0') newstart = '';\n\t\t\td.start = newstart;\n\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn (d.start && !/^_\\d+$/.test(d.start)) || (!d.start && that.Rows.length <= +d.limit);\n\t\t\t}"},"watch": ["#view-startkey","#view-limit","#state-proxy"]},"#btn-view-plus": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tnewstart = d.start,\n\t\t\t\t\ttr = +d.total_rows,\n\t\t\t\t\tlim = +d.limit,\n\t\t\t\t\tisReduce = that.Vi[d.view] && that.Vi[d.view].reduce && d.reduce+'',\n          isMango = d.view.to(5) == '_find';\n\t\t\tif (!d.start) {\n\t\t\t\tif (tr > lim || isReduce|| isMango) newstart = '_'+lim;\n\t\t\t}\n\t\t\telse if (/^_\\d+$/.test(d.start)) {\n\t\t\t\tvar start = (+d.start.substr(1)||0) + lim;\n\t\t\t\tnewstart = '_'+(start >= tr && !isReduce && !isMango? 0:start);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// we have a key\n\t\t\t\tif (that.Rows.length <= lim) newstart = '';\n\t\t\t\telse newstart = JSON.stringify(that.Rows[lim].key).replace(/^\"|\"$/g,'');\n\t\t\t}\n\t\t\tif (newstart=='_0') newstart = '';\n\t\t\td.start = newstart;\n\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn !d.start && that.Rows.length <= +d.limit;\n\t\t\t}"},"watch": ["#view-limit","#state-proxy"]},"#app-search": {"delay": 150,"bind": "function (d,v) {\n\t\t\tif (v==null) return d.search;\n\t\t\tif (v.length < 3) {\n\t\t\t\tthis.fSearch = null;\n\t\t\t\td.search = '';\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\td.search = v;\n\t\t\tthis.fSearch = new RegExp('('+RegExp.escape(v)+')', 'i');\n\t\t\treturn v;\n\t\t}","css": {"my-search": "new RegExp(/^.{3,}$/)"}},"#view-panels": {"watch": ["#view-name","#btn-viewcode"],"css": {"view-editor": "function (d) {\n        return !!d.view && !!d.editor;\n      }","view-mango": "function (d) {\n        return d.view.to(5) == '_find';\n      }","view-index": "function (d) {\n        return d.view.to(4) == '_idx';\n      }"}},"#btn-reload": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tthis.GetView(true);\n\t\t\tthis.GetViews(true);\n\t\t}","listen": {"userCtx": "function (d,v) {\n\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\tif (!v.name && /^(_users|_replicator)$/.test(d.path[0])) $.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t}","dbupdate": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (!d.view || !Object.isObject(v) || !(v.cmd == 'write' || v.cmd == 'delete')) return;\n\t\t\t\tif (v.db != d.path[0] || (v.docs||[]).indexOf(d.view.split('\\ufffd')[0]) == -1) return;\n\t\t\t\tthat.GetViews(true);\n\t\t\t}"}},"#btn-view-compact": {"bind": "function (d,v,$o) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-view-compact', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\tthat.my.modal('#btn-view-compact',{\n\t\t\t\t\tmanifest:that.Pho('Compact'),\n\t\t\t\t\twidth:370,\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\t{ selection:[d.path[0]] }, \n\t\t\t\t\t\tObject.size(that.Vi)?{ddocs:Object.keys(that.Vi).map(function(e){\n\t\t\t\t\t\t\treturn e.split('\\ufffd')[0].split('/')[1]\n\t\t\t\t\t\t}).unique().sort()}:{}\n\t\t\t\t\t),\n\t\t\t\t\talign:'top:102%;',\n\t\t\t\t\tnose:'top',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tbound:20\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}"},"#btn-view-acl": {"bind": "function (d,v,$o) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-view-acl', true);\n\t\t\telse {\n\t\t\t\t// Read current sec obj\n\t\t\t\tthat.Req([d.path[0],'_security'])\n\t\t\t\t.then(function(res){\n\t\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\t\tthat.Modals.head = $o;\n\t\t\t\t\tthat.my.modal('#btn-view-acl',{\n\t\t\t\t\t\tmanifest:that.Pho('SecObj'),\n\t\t\t\t\t\twidth:380,\n\t\t\t\t\t\tdata:$.extend(true,{}, { \n\t\t\t\t\t\t\tdbs:[d.path[0]], \n\t\t\t\t\t\t\tadmins:res.admins||{names:[], roles:[]}, \n\t\t\t\t\t\t\tmembers:res.members||{names:[], roles:[]} \n\t\t\t\t\t\t}),\n\t\t\t\t\t\talign:'top:102%;',\n\t\t\t\t\t\tnose:'top',\n\t\t\t\t\t\tcss:'xgray',\n\t\t\t\t\t\tscreen:false,\n\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\tbound:20\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t\t});\n\n\t\t\t\t})\n\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\tcw.lib.note(that.lang.ERR_GETACL, 'error');\n\t\t\t\t});\n\n\t\t\t}\n\t\t}"},"#btn-view-newdoc": {"init": "function ($o) {\n      var that = this,\n          d = that.data;\n      \n      if (d.path[0] != '_users') return;\n      \n      $o.on('click.my',function(evt){\n        if ($o.data('modal')) {\n          that.my.modal('#btn-view-newdoc', true);\n          return false;\n        }\n        if (that.Modals.head) that.Modals.head.modal(true);\n        that.Modals.head = $o;\n        that.my.modal('#btn-view-newdoc',{\n          manifest:that.Pho('UserDoc'),\n          width:380,\n          data:{},\n          align:'top:102%;left:-147px;',\n          nose:'top',\n          css:'xgray',\n          screen:false,\n          esc:true,\n          focus:true,\n          bound:20\n        })\n        .always(function(){\n          that.Modals.head = null;\n        });\n\n        return false;\n      });\n      \n      $o.html('<span class=\"lh140\">'+that.lang.BTN_NEWDOC_POPUP+'</span>');\n    }","delay": 60,"bind": "function (d,v,$o) {\n\t\t\t$o.attr('href','#'+encodeURIComponent(d.path[0])+'/_new');\n\t\t}"},"#state-proxy": {"delay": 20,"bind": "function (d,v) {\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tp = d.path.slice(0);\n\t\t\t\n\t\t\td.path = that.s2p();\n      \n      var cstate = cw.lib.sdbm([d.view, d.start, d.limit, d.reverse, d.reduce+'']);\n\t\t\t\n\t\t\tif ( d.state != cstate ) {\n\t\t\t\t$.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\t\td.state = cstate;\n        \n        if (!d.view) d.editor = false;\n        \n        if (d.editor) that.EdSwitch();\n        else that.Editor.length = 0;\n        \n        that.GetView(true);\n        that.my.recalc('#view-ed-container');\n\t\t\t}\n\t\t}","watch": ["#view-startkey","#view-name","#view-limit","#btn-view-dir","#view-reduce"],"listen": {"dbupdate": "function (d,v) {\n\t\t\t\tvar db;\n\t\t\t\tif (Object.isObject(v)) db = v.db;\n\t\t\t\telse db = v+'';\n\t\t\t\tif (db!=d.path[0]) return;\n        var that = this;\n        // check should we rebuild view list\n        if ((v.docs || []).find(/^_design/)) {\n        \tv.docs.forEach(function(id){\n          \tif (that.Ddocs[id]) delete that.Ddocs[id];\n          });\n          that.GetViews(true)\n          that.GetView(true);\n        }\n\t\t\t\telse that.GetView(true);\n\t\t\t}","dbdeleted": "function (d,v) {\n\t\t\t\tif (v!=d.path[0]) return;\n\t\t\t\tvar that = this;\n\t\t\t\t(function(){\t\n\t\t\t\t\tthat.my.root().trigger('tabclose', {tabid:d.tabid, enforce:true});\n\t\t\t\t}).debounce(Number.random(10,50))();\n\t\t\t}"}},"#view-req-error": {"bind": "function (d) {return this.Error.escapeHTML();}","css": {"hide": "function () {return !this.Error}"},"watch": ["#state-proxy"]},"#view-ed-container": {"delay": 100,"init": "function ($o) {}","bind": "this.Editor","manifest": "function (d) {\n      if (d.type == 'view')  return this.Pho('ViewEd');\n      if (d.type == 'index') return this.Pho('IndexEd');\n      return this.Pho('MangoEd');\n    }","list": "<div></div>","id": ["name","type","ddoc","rev"],"watch": ["#btn-viewcode"]},"#view-results": {"init": "function ($o) {\n\t\t\tvar that = this,\n\t\t\t\t\ttdocs = that.TDocs,\n\t\t\t\t\ttmap = that.TMap,\n          tmango = that.TMango,\n\t\t\t\t\td = that.data;\n\t\t\t// init list manager\n\t\t\t$o.list({\n\t\t\t\tdata:that.Rows.to(+d.limit),\n\t\t\t\tdelay:0,\n\t\t\t\tchunk:50,\n\t\t\t\tsortBy:null,\n\t\t\t\tid: function(e){return e._idx},\n\t\t\t\thash:function(e) {\n\t\t\t\t\tvar h = cw.lib.sdbm([  d.view, d.seq, that.Rows.length, e._checked, d.search.length>1?d.search:' ' ]);\n\t\t\t\t\treturn h;\n\t\t\t\t},\n\t\t\t\ttemplate: function(e, i){ \n\t\t\t\t\tvar h = d.view==''?tdocs(e, i):d.view.to(5)=='_find'?tmango(e, i):tmap(e, i); \n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// init nicescroll\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n        //preservenativescrolling: false,\n\t\t\t});\n\t\t\t\n\t\t\t// append prewrapped\n\t\t\t$o.on('click.my','.col-vals', function(evt){\n\t\t\t\tvar $a = $(evt.currentTarget),\n\t\t\t\t\t\tkey = $a.parent().data('key'),\n\t\t\t\t\t\tskey = Object.isString(key)?key:JSON.stringify(key),\n\t\t\t\t\t\thold  = '',\n\t\t\t\t\t\ts, row,\n\t\t\t\t\t\t$e, ed;\n\t\t\t\tif (!$a.is('.col-json')) {\n\t\t\t\t\trow = (that.Rows || []).find(function(e){\n\t\t\t\t\t\treturn e._idx == skey;\n\t\t\t\t\t});\n\t\t\t\t\tif (!row) return false;\n\n\t\t\t\t\ts = row._index;\n\n\t\t\t\t\t$a.addClass('col-json');\n\n\t\t\t\t\tif (!$a.find('>.col-ed-close').length) {\n\t\t\t\t\t\t$e = $(\n\t\t\t\t\t\t\t'<div class=\"col-ed pre fs85 lh120 pl4\">'\n\t\t\t\t\t\t\t+row._kjson.escapeHTML()\n\t\t\t\t\t\t\t+(!that.fSearch\n\t\t\t\t\t\t\t\t?row._vjson.escapeHTML()\n\t\t\t\t\t\t\t\t:row._vjson.replace(that.fSearch, '\\ufff1$1\\ufff0')\n\t\t\t\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t\t\t\t.replace('\\ufff1','<span class=\"view-found\">')\n\t\t\t\t\t\t\t\t.replace('\\ufff0','</span>'))\n\t\t\t\t\t\t\t+'</div>'\n\t\t\t\t\t\t).appendTo($a);\n\t\t\t\t\t\t$a.append('<div class=\"col-ed-close fs130 lh130\" title=\"'+that.RT('lang').TIP_CLOSEJSON+'\">✕</div>');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Close CM on X click\n\t\t\t$o.on('click.my','.col-ed-close', function(evt){\n\t\t\t\t$(evt.currentTarget).parent().removeClass('col-json');\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}","delay": 10,"bind": "function (d,v,$o) {\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tre;\n\t\t\tif (!d.view) {\n\t\t\t\tvar osel = cw.lib.a2o(d.selection);\n\t\t\t\tthat.Rows.forEach(function(row){row._checked = osel[row.key]?'checked':''});\n\t\t\t}\n\t\t\tif (d.search.length > 2 && (re = that.fSearch)) {\n\t\t\t\tthat.fRows = that.Rows.to(+d.limit).filter(function(row){ return re.test(row._kjson) || re.test(row._vjson); });\n\t\t\t\t$o.list('data', that.fRows);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.fRows = null;\n\t\t\t\t$o.list('data', that.Rows.to(+d.limit));\n\t\t\t}\n\t\t}","watch": ["#state-proxy","#view-hasselection","#btn-select","#app-search"]},"#btn-view-dir": {"bind": "function (d,v) {\n\t\t\tif (v!=null) d.reverse = !d.reverse;\n\t\t\treturn !d.reverse?'▲':'▼';\n\t\t}","events": "click.my"},"#view-cols": {"delay": 30,"bind": "function (d,v) {\n\t\t\treturn this.lang.TXT_MAPVIEW(\n\t\t\t\tMath.min(this.Rows.length, +d.limit), \n\t\t\t\td.total_rows==-1 || d.view.to(5)=='_find'?'unknown':d.total_rows,\n\t\t\t\td.search.length > 2 && this.fRows? this.fRows.length:null\n\t\t\t)\n\t\t}","watch": ["#view-results","#state-proxy"]},"#view-links": {"bind": "function (d,v) {\n\t\t\tvar that = this,\n\t\t\t\t\tt = '<a class=\"tdn\" href=\"#{1}\">{2}</a>',\n\t\t\t\t\tp = d.path,\n\t\t\t\t\tview = d.view.split('\\ufffd');\n\t\t\t\n      // All docs\n\t\t\tif (!d.view) return [p[0].escapeHTML(),'/','<span class=\"xgray\">_all_docs</span>'].join('\\u2009')+' | ';\n      \n      // Mango qry\n      if (d.view.to(5) == '_find') return [\n        t.assign( p[0], p[0].escapeHTML() ),\n        '/',\n        '<span class=\"xgray\">_find</span>'\n      ].join('\\u2009');\n      \n      // Default index\n      if (d.view.to(6) == '_idx/\\ufffd') return [\n\t\t\t\tt.assign( p[0], p[0].escapeHTML() ),\n\t\t\t\t'/',\n\t\t\t\t'_all_docs'\n\t\t\t].join('\\u2009') + ' | ';\n      \n      // Index\n      if (d.view.to(4) == '_idx') return [\n\t\t\t\tt.assign( p[0], p[0].escapeHTML() ),\n\t\t\t\t'/',\n\t\t\t\tt.assign( p[0]+'/_design'+view[0].from(4), ('_design'+view[0].from(4)).escapeHTML() )\n\t\t\t].join('\\u2009') + ' | ';\n      \n      // View\n\t\t\treturn [\n\t\t\t\tt.assign( p[0], p[0].escapeHTML() ),\n\t\t\t\t'/',\n\t\t\t\tt.assign( p[0]+'/'+view[0], view[0].escapeHTML() )\n\t\t\t].join('\\u2009') + ' | ';\n\t\t}","watch": ["#view-results","#state-proxy"]},"#view-reduce": {"delay": 10,"init": "function ($o) {\n\t\t\t$o.tags({\n\t\t\t\ttags:[[\n\t\t\t\t\t{'Group none':'0'},\n\t\t\t\t\t{'\\u2009L1\\u2009':'1'},\n\t\t\t\t\t{'\\u2009L2\\u2009':'2'},\n\t\t\t\t\t{'\\u2009L3\\u2009':'3'},\n\t\t\t\t\t{'\\u2009L4\\u2009':'4'},\n\t\t\t\t\t{'\\u2009L5\\u2009':'5'},\n\t\t\t\t\t//{'\\u2009L6\\u2009':'6'},\n\t\t\t\t\t//{'\\u2009L7\\u2009':'7'},\n\t\t\t\t\t{'Exact':'99'}\n\t\t\t\t]],\n\t\t\t\tempty:{'No reduce':''},\n\t\t\t\tgroupshim:'',\n\t\t\t\ttagshim:''\n\t\t\t})\n\t\t}","bind": "reduce","css": {"self:hide": "function (d,v) {\n\t\t\t\treturn !this.Vi[d.view] || !this.Vi[d.view].reduce;\n\t\t\t}"},"watch": "#view-name"},"#btn-anchor": {"delay": 10,"bind": "function (d,v,$o) {\n\t\t\tvar a = $o.attr('href');\n\t\t\tif (a!=d.link) $o.attr('href', d.link);\n\t\t}","watch": "#state-proxy","css": {"hide": "function (d) {return d.view.to(5)=='_find'}"}},"#btn-select": {"delay": 50,"bind": "function (d,v) {\n\t\t\tif (!!d.view ) return '';\n\t\t\tvar that = this,\n\t\t\t\t\tall = that.Rows.to(+d.limit),\n\t\t\t\t\tlist = all.map(function(e){return e.id;}),\n\t\t\t\t\tsel = d.selection.intersect(list),\n\t\t\t\t\tsl = sel.length,\n\t\t\t\t\tl = that.lang,\n\t\t\t\t\tt;\n\t\t\t\n\t\t\tif (v!=null) {\n\t\t\t\t// unselect\n\t\t\t\tif (sl) d.selection = d.selection.subtract(list).unique();\n\t\t\t\t// select\n\t\t\t\telse d.selection = d.selection.concat(list).unique();\n\t\t\t\t\n\t\t\t\tsel = d.selection.intersect(list);\n\t\t\t\tsl = sel.length;\n\t\t\t}\n\n\t\t\tif (sl) t = l.TXT_UNSELECT.assign(sel.length == all.length?l.TXT_SELECT_ALL:sl);\n\t\t\telse t = l.TXT_SELECT.assign(list.length == all.length?l.TXT_SELECT_ALL:l.TXT_SELECT_FILTERED);\n\t\t\t\n\t\t\treturn t;\n\t\t}","events": "click.my","css": {"hide": "function (d,v) {return !!d.view || !this.Rows.length}"},"watch": ["#view-hasselection","#state-proxy"]},"#view-hasselection": {"delay": 10,"css": {"hide": "function (d) {\n        return !!d.view || !d.selection.intersect(this.Rows.to(+d.limit).map(function(row){return row.key;})).length;\n      }"},"watch": ["#view-name","#btn-select"]},"#btn-view-deldocs": {"delay": 20,"bind": "function (d,v) {\n      var that = this;\n      if (v==null) return;\n\n      // mark busy\n      that.my.root().addClass('app-busy');\n      $.my.radio('appbusy',{id:d.tabid, busy:true});\n      \n      // if we have copy modal, close it\n      var $copy = that.my.find('#btn-view-copydocs');\n      if ($copy.data('modal')) $copy.modal(true);\n      \n      // del attempt\n      that.DelDocs()\n      .always(function(){\n        $.my.radio('appbusy',{id:d.tabid, busy:false});\n        that.my.root().removeClass('app-busy');\n      });\n    }"},"#btn-view-copydocs": {"bind": "function (d,v) {\n      if (v==null) return;\n      var that = this,\n          $o = that.my.find('#btn-view-copydocs');\n      if ($o.data('modal')) {\n        $o.modal(true);\n        return;\n      }\n      $o.modal({\n        root:that.my.root(),\n        manifest:$.extend(\n          true, {}, \n          that.Pho('NewSync'), \n          {\n            DBs:Object.keys(that.Pho('All')).sortBy(function(e){return e[0]=='_'?'zzz'+e:e;}),\n            params:{width:500},\n            ui:{\n              '#rsource':\t\t{css:{'hide':function(){return true;}}},\n              '#rfilter':\t\t{css:{'hide':function(){return true;}}},\n              '#rmode':\t\t\t{css:{'hide':function(){return true;}}},\n              '#btn-clear':\t{css:{'self:hide':function(){return true;}}}\n            },\n            lang:{en:{\n              TXT_TITLE:'New one-time replication',\n              BTN_START:'Replicate docs',\n            }}\n          }\n        ),\n        data:{\n          source:d.path[0],\n          doc_ids:d.selection.slice(0)\n        },\n        focus:'#rtarget',\n        nose:'top',\n        align:'top:103%',\n        css:'xgray',\n        bound:0\n      });\n    }","css": {":disabled": "function (d,v) {return !cw.me();}"},"listen": {"userCtx": "function (d,v) {this.my.check('#btn-view-copydocs');}"}},"#btn-viewcode": {"bind": "function (d,v,$o) {\n      var that = this;\n      if (v==null || !d.view) return;\n      that.EdSwitch();\n      d.editor = true;\n    }","css": {"hide": "function (d) {return !!d.editor || ! d.view}"},"events": "click.my","watch": ["#view-name"]}},"HTML": "<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\"><div class=\"fr w12p fs95\"><div class=\"fi-magnifying-glass xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div><input type=\"text\" id=\"app-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span></div><div class=\"nw dib vat\" style=\"width:calc(35% + 230px);\"><button id=\"btn-reload\" class=\"w40 mr2\" title=\"{TIP_RELOAD}\"><span class=\"fi-loop\"></span></button><div class=\"dib vat mr2 bolder\" style=\"width:calc((100% - 204px) / 2 + 16px);\"><input id=\"view-name\" type=\"text\" class=\" w100p fs110 vat\"></div><div class=\"fs95 dib vat\" style=\"width:calc((100% - 204px) / 2);\"><div class=\"fi-filter xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 6px;top: 0.2em;\"></div><input id=\"view-startkey\" type=\"text\" class=\"vat ui-search w100p\" placeholder=\"{PLC_STARTKEY}\" style=\"background-image:none;padding-right:17px!important;padding-left:19px!important;border-radius:2px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue w15 pl2 ui-search-clear\" style=\"margin-left:-15px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').trigger('input')\"></span></div><span class=\"buttons ml2\"><button id=\"btn-view-minus\" class=\"w2em mr2 pl0 pr0\" title=\"{TIP_SHIFT_MINUS}\"><span class=\"fi-arrow-left o80\"></span></button><button id=\"btn-view-plus\" class=\"w2em mr2 pl0 pr0\" title=\"{TIP_SHIFT_PLUS}\"><span class=\"fi-arrow-right o80\"></span></button></span><div class=\"dib vat w65\"><input id=\"view-limit\" type=\"text\" class=\" w100p fs110 vat\"></div></div><div class=\"nw pl5 dib vat\" style=\"width:calc(53% - 250px);\"><a href=\"\" id=\"btn-view-newdoc\" class=\"button fs100 tdn dib green vat mr2\"><span class=\"lh140\">{BTN_NEWDOC}</span></a><span id=\"view-hasselection\" class=\"hide\"><button id=\"btn-view-copydocs\" class=\"mr2\" xdisabled>{BTN_COPYDOCS}</button><button id=\"btn-view-deldocs\" class=\"mr2 red\">{BTN_DELDOCS}</button></span><span id=\"view-noselection\"><button id=\"btn-view-acl\" class=\"mr2\">{BTN_ACL}</button><button id=\"btn-view-compact\" class=\"mr10\">{BTN_COMPACT}</button></span></div></div><section id=\"view-panels\" class=\"w100p pt16 pl20 pr20\"><section id=\"view-ed-container\" id=\"view-mango\" class=\"vat panelheight-32 br2 bas mr20\" style=\"outline:none;\"></section><div id=\"view-panel\" class=\"dib vat panelheight-32 br2 bas\"><div class=\"h30 bg-gray7 bbs lh160 pt1 nw oh ell\"><div class=\"hcolw1 dib vat nw oh ell\"><span id=\"btn-view-dir\" class=\"dib pl8 pr6 mr2 vat cp o50 fs80 pt2 pseudolink tdn h30\"></span><div id=\"view-cols\" class=\"dib vat nw xgray\"></div><div id=\"btn-select\" class=\"pseudolink tdn dib vat ml15 hide\"></div><div id=\"btn-viewcode\" class=\"pseudolink tdn dib vat ml15 hide\">{BTN_VIEWCODE}</div></div><div class=\"hcolw2 dib gray fs90\"><span class=\"gray fr pr8 w35p ell tar\"><span id=\"view-links\"></span><a href=\"\" id=\"btn-anchor\" class=\"tdn o70 dib vat mt1 mb-1\" target=\"_blank\" title=\"{TIP_ANCHOR}\"><span class=\"fi-anchor\"></span></a></span><span id=\"view-reduce\" class=\"dib vat pl7 hide\"></span></div></div><div id=\"view-req-error\" class=\"w100p hide red1 tac\" style=\"position:absolute;top:50px;left:0;\"></div><section id=\"view-results\" class=\"panelheight-64 gray-1 lh170\" style=\"outline:none;\"></section></div></section><div id=\"state-proxy\" class=\"hide\"></div>","style": {" #view-noselection": "display:none;"," #view-hasselection.hide+#view-noselection": "display:inline-block;"," #view-panels": {"": {" #view-panel": "width:100%;"," #view-ed-container": "display:none;width:35%;"," .hcolw1": "width:35%;"," .hcolw2": "width:65%;"},".view-editor": {" #view-panel": "width:calc(60% - 20px);"," #view-ed-container": "width:40%; display:inline-block; "," .hcolw1": "width:25%;"," .hcolw2": "width:75%;"},".view-editor.view-mango": {" #view-panel": "width:calc(65% - 20px);"," #view-ed-container": "width:35%; display:inline-block;"},".view-mango": {" #view-results": {" .col-ids": "width:7%;padding:3px 2px 3px 7px;"," .col-vals": "width:93%; padding-left:5px;"}," #btn-view-dir": "display:none!important;"," #view-cols": "padding-left:6px;"},".view-editor.view-index": {" #view-panel": "width:calc(65% - 20px);"," #view-ed-container": "width:35%; display:inline-block;"},".view-index": {" #btn-view-dir": "display:none!important;"," .view-tofilter": "display:none!important;"," #view-cols": "padding-left:6px;"}}," #view-results": {"": "line-height:1.4em;"," .view-row": "min-height:1.9em;"," .view-row:nth-child(2n+0)": "background-color:rgba(206, 214, 226, 0.2);"," .view-hoverbtn": "display:inline-block;width:20px;line-height:1.2em;opacity:0;transition:opacity 0.5s;text-align:center;cursor:pointer;"," .view-row:hover .view-hoverbtn": "opacity:0.5;"," .view-row:hover .view-hoverbtn:hover": "opacity:0.8;"," .view-hoverbtn.hover": "opacity:0.7;"," .view-row>div": "display:inline-block;vertical-align:top;word-wrap: break-word;"," input:checked+div": "font-weight:bolder"," .col-ids": "width:35%;padding:3px 20px 3px 8px;"," .col-vals": {"": "width:65%; padding-left:10px;"," .col-trim": "cursor:pointer"," .col-ed": "display:none;"," .col-ed-close": "display:none;",".col-json": {"": "padding:0 0 0 6px!important;word-wrap:normal;"," .CodeMirror": "background:none;font-size:12px!important;line-height:15px!important;",">div.col-trim": "display:none;",">div.col-ed": "display:block;",">div.col-ed-close": {"": "display:block;cursor:pointer;text-align:right;position:absolute;top:0;right:5px;width:95%;height:21px;z-index:+2;transition:color 0.5s; color:rgba(41,109,166,0.75);",":hover": "color:#12a5dc;"}}}," .w40p-30": "width:calc(40% - 30px);"}," .bbs": "border-bottom-color:rgba(211,217,222,0.7)"," .bas": "border-color:rgba(211,217,222,0.7)"," .brs": "border-right:1px solid rgba(211,217,222,0.7)"," .view-found": "background-color:rgba(255,232,121,0.94);border-radius:2px;"," .my-modal-form .CodeMirror-scroll": "min-height:150px;max-height:calc(20 * 16px + 6px);"," .my-modal-form .CodeMirror": {"": "min-height:150px;height:auto;font-size:13px!important"," .CodeMirror-lines": "line-height:17px!important;"," .cm-property": "color:#434e5d;"," .cm-variable": "color:#33bfad;"," .cm-keyword": "color:#90259e;"}},"init": "function ($o) {\n  var that = this,\n      d = that.data,\n      lang = that.lang;\n  \n  // Remap .F\n  Object.keys(that.F).forEach(function(k){\n  \tthat[k] = that.F[k].bind(that);\n  });\n\n  // Default views\n  that.Views = that.DefaultViews();\n\n  // init row renderer closures and debounce\n  that.TMap = that.TMap();\n  that.TDocs = that.TDocs();\n  that.TMango = that.TMango();\n\n  // Restore mango qries if any\n  var mango = that.Pho('Ls')('Mango.'+d.path[0]);\n  if (Object.isObject(mango) && mango.query) $.extend(d.mango, mango);\n\n  // startkey shortcut click handler\n  $o.on('click.my', '.view-tofilter', function(evt){\n    var key = $(evt.currentTarget).data('filter');\n    d.start = Object.isString(key)?key.replace(/^\"|\"$/g,''):JSON.stringify(key);\n\n    cw.lib.note(lang.MSG_STARTKEY_CHANGED.assign(d.start));\n\n    that.my.recalc('#view-startkey');\n    that.my.check('#view-startkey');\n  }.debounce(40));\n\n  // user edit click handler\n  $o.on('click.my', '.view-edituser', function(evt){\n    var $b = $(evt.currentTarget),\n        id = $(evt.currentTarget).data('user');\n\n    $b.addClass('hover');\n\n    that.Req(['_users',id])\n      .then(function(res){\n      // open modal editor\n      return $b.modal({\n        root:\t\t\t$o,\n        manifest:\tthat.Pho('UserDoc'),\n        data:\t\t\tres,\n        width:\t\t380,\n        bound:\t\t0,\n        nose:\t\t\t'left',\n        css:\t\t\t'xgray',\n        align:\t\t'left:100%;top:-57px;',\n        screen:\t\t'rgba(255,255,255,0)',\n        esc:\t\t\ttrue\n      });\n    })\n      .always(function(){\n      $b.removeClass('hover');\n    });\n\n  }.debounce(5));\n\n  // init selection\n  $o.on('click.my', 'input[name=\"docs-selection\"]', function(){\n    var v = [];\n    $o.find('input[name=\"docs-selection\"]').each(function(){\n      var $x = $(this);\n      if ($x.is(\":checked\")) v.push($x.val());\n    });\n    d.selection = v;\n    that.my.check('#view-hasselection');\n  });\n\n  if (d.path[0] == '_users' && that.Pho('Cfg').listCols.indexOf('security')>-1) {\n    $o.then(function(){\n      that.GetSec();\n    });\n  }\n\n  return that.Pho('PokeBucket')(d.path[0])\n  .then(function(){\n    return that.GetViews(false, true)\n    .then(function(){\n      var p2 = d.path[2],\n          p3 = d.path[3];\n      if (d.path[1] == '_find') {\n        var mname = p2+'';\n       \tif (!d.mango.query.find(function(e){return e.name == mname})) mname = 'Default query';\n        \n        d.view = '_find\\ufffd'+mname;\n        d.editor = true;\n      }\n      else if (d.path[1] == '_index') {\n        if (d.path[2] == 'Default index' && !d.path[3]) d.view = '_idx/\\ufffdDefault index';\n        else d.view = '_idx/{1}\\ufffd{2}'.assign(d.path[2],d.path[3]);\n        d.editor = true;\n      }\n      else if (p2 && p3) {\n        var vkey = '_design/'+p2+'\\ufffd'+p3;\n        d.view = that.Vi[vkey]?vkey:'';\n      }\n    });\n  })\n  //.then(that.GetView)\n  .then(function(){\n    $o.html(that.HTML.assign(lang));\n  });\n}","F": {"DefaultViews": "function () {\n    var that = this,\n        ver = parseFloat(this.Pho(['Couch','version'])),\n        views = [\n          {id:'', text:that.lang.OPT_ALLDOCS, order:'__1'},\n          //{id:'_ddocs', text:that.lang.OPT_ALLDOCS, order:'__2'}\n        ];\n    if (ver>1.9999) {\n      var g = {text:'Local Mango queries', children:[], order:'~2'}\n      that.data.mango.query.forEach(function(q){\n      \tg.children.push({id:'_find\\ufffd'+q.name,\ttext:'\\u00a0\\u00a0'+q.name, order:(q.name=='Default query'?'_1 ':'_2 ')+q.name});\n      });\n      g.children = g.children.sortBy('order');\n      views.push(g);\n      \n      var ix = {text:'Mango indexes', children:[{\n        id:'_idx/'+'\\ufffd'+that.DefaultMangoIdx.name,\n        text:'\\u00a0\\u00a0'+that.DefaultMangoIdx.name,\n        order:'_0'\n      }], order:'~3'};\n      views.push(ix);\n    }\n    return views;\n  }","TMap": "function () {\n    var that = this,\n        d = that.data,\n        j2h = that.Pho('j2h');\n\n    var t = that.T.view,\n        tf = that.T.view_filter;\n\n    // Renderer function\n\n    return function _tmap (row, i) {\n      var limit = that.Rows.length,\n        \tisIdx = d.view.to(4) == '_idx',\n          mapper = limit<120?_mapFull: limit<250?_mapMedium: _mapSimple,\n          chars = limit<40?2000: limit<60?500: limit<120?300: 200,\n          lvl = limit<40?5: limit<60?4: limit<120?3: limit<250?3: 2;\n\n      var v = isIdx?row.key:row.value, \n          a = j2h(v, chars, ['_id','id','name'], lvl),\n          s;\n      if (a.length==1 && a[0][0]=='short') {\n        if (a[0][1][0] == '{') a[0][1] ='Object '+a[0][1];\n        else if (a[0][1][0] == '[') a[0][1]='Array '+a[0][1];\n      }\n      s = a.map(mapper).join('');\n\n      if (that.fSearch && d.search.length > 2) {\n        return tf.assign({\n          _idx:row._idx,\n          _idxsafe:row._idxsafe,\n          id:row.key,\n\n          idsafefilter:(isIdx?row.id:JSON.stringify(row.key))\n          .replace(that.fSearch, '\\ufff1$1\\ufff0')\n          .escapeHTML()\n          .replace('\\ufff1','<span class=\"view-found\">')\n          .replace('\\ufff0','</span>'),\n\n          idsafe:(isIdx?row.id:JSON.stringify(row.key)).escapeHTML(),\n          href:row.id?that.p2u([d.path[0], row.id]).join('/').escapeHTML():'',\n          nodoc:row.id?'':'hide',\n          key:row.key,\n          //doc:'',\n          html:s,\n          css:s.length>250?'fs95 lh140 pt3 pb3':'lh140 pt2 pb2'\n        });\n\n      }\n      return t.assign({\n        _idx:row._idx,\n        _idxsafe:row._idxsafe,\n        id:row.key,\n        idsafe: (isIdx?row.id:JSON.stringify(row.key)).escapeHTML(),\n        href:row.id?that.p2u([d.path[0], row.id]).join('/').escapeHTML():'',\n        nodoc:row.id?'':'hide',\n        key:row.key,\n        //doc:'',\n        html:s,\n        css:s.length>250?'fs95 lh140 pt3 pb3':'lh140 pt2 pb2'\n      });\n    }\n\n\n    // - - - - - - \n\n    function _mapFull(row){\n      if (!row[0]) return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapMedium(row){\n      if (row[0]!='bracket' && row[0]!='key') return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapSimple(row){ return row[1];}\n  }","TDocs": "function () {\n    var that = this,\n        d = that.data;\n\n    var t = that.T.docs, \n        tu = that.T.user_docs;\n\n    // Renderer function for non-_users DBs\n\n    if (d.path[0] != '_users') return function _tdocs (row, i) {\n      return t.assign({\n        id:row.key,\n        idsafe:(row.key+'').escapeHTML(),\n        checked:row._checked,\n        href:that.p2u([d.path[0], row.key]).join('/').escapeHTML(),\n        rev:((row.value||{}).rev+'').escapeHTML()\n      });\n    };\n\n    // Renderer for _users DB\n    return function _tdocs_users (row, i) {\n      var obj = {\n        id:row.key,\n        idsafe:(row.key+'').escapeHTML(),\n        checked:row._checked,\n        href:that.p2u([d.path[0], row.key]).join('/').escapeHTML(),\n        rev:((row.value||{}).rev+'').escapeHTML()\n      };\n      if (row.key.substr(0,17) != 'org.couchdb.user:') return t.assign(obj);\n      // we have user doc\n      return tu.assign(obj);\n    };\n\n  }","TMango": "function () {\n    var that = this,\n        d = that.data,\n        j2h = that.Pho('j2h');\n\n    var t = that.T.mango,\n        tf = that.T.view_filter;\n\n    // Renderer function\n\n    return function _tmango (row, i) {\n      var limit = that.Rows.length,\n          mapper = limit<120?_mapFull: limit<250?_mapMedium: _mapSimple,\n          chars = limit<40?2000: limit<60?500: limit<120?300: 200,\n          lvl = limit<40?5: limit<60?4: limit<120?3: limit<250?3: 2;\n\n      var v = row.value, s;\n      var a = j2h(v, chars, ['_id','id','name'], lvl);\n      if (a.length==1 && a[0][0]=='short') {\n        if (a[0][1][0] == '{') a[0][1] ='Object '+a[0][1];\n        else if (a[0][1][0] == '[') a[0][1]='Array '+a[0][1];\n      }\n      s = a.map(mapper).join('');\n\n      return t.assign({\n        _idx:row._idx,\n        _idxsafe:row._idxsafe,\n        id:row.key+'',\n        idsafe:row.key+'',\n        href:'',\n        nodoc:'',//row.id?'':'hide',\n        key:i+'',\n        //doc:'',\n        html:s,\n        css:s.length>250?'fs95 lh140 pt3 pb3':'lh140 pt2 pb2'\n      });\n    }\n\n\n    // - - - - - - \n\n    function _mapFull(row){\n      if (!row[0]) return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapMedium(row){\n      if (row[0]!='bracket' && row[0]!='key') return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapSimple(row){ return row[1];}\n  }","GetSec": "function () {\n\n    // Runs in _user bucket to get secuirty\n\n    var that = this,\n        all = that.Pho('All'),\n        a = Object.keys(all),\n        dbs = [],\n        now = Date.now();\n\n    a.forEach(function(db){\n      if (!all[db].security || all[db].security.stamp + 3.6e6 < now) dbs.push(db);\n    });\n\n    var pis = that.Pho('$dbs').BatchInfo.call({\n      Pho:that.Pho,\n      Req:that.Req,\n      Batch:{},\n      All:all,\n      Relist:function(){},\n      RelistNow:function(){},\n    }, dbs, that.Pho('Cfg').batchDbInfoDelay, ['security']);\n\n    return Q.all(pis).then(function(){\n      //console.log('Read '+dbs);\n    });\n  }","DelDocs": "function _del_doc() {\n    var that = this,\n        d = that.data,\n        sel = d.selection.slice(0),\n        sl = sel.length,\n        l = that.lang,\n        es = function(s){return (s+'').escapeHTML()},\n        _trunc = function (s, chars) {return es((s+'').truncate(chars || 15,'right','…'));};\n\n    var pi = $.Deferred(),\n        trow = '<div class=\"mb10\">{1}</div>';\n\n    $.my.modal({\n      width:300,\n      manifest:that.Pho('Confirm'),\n      data:{\n        text:[\n          '<div class=\"fs130 red mb5\">'+l.TXT_DEL_TITLE+'</div>',\n          trow.assign(l.TXT_DEL_WARN(sl, _trunc(d.path[0], 25)))\n        ].join(''),\n        yescss:'red',\n        yes:l.BTN_DEL_START,\n        no:l.BTN_CANCEL,\n        cancel:''\n      },\n      css:'lh160 xgray p20 pb25',\n      esc:true,\n      enter:false\n    })\n      .then(function(res){\n      if (res.cmd!='yes') return pi.reject(999, 'Cancelled', 'Cancelled');\n      _delDocs();\n    })\n    .fail(function(){\n      pi.reject(999, 'Cancelled', 'Cancelled');\n    })\n\n\n    return pi.promise();\n\n\n    // - - - - - - - - - - - - \n\n    function _delDocs(){\n\n      var osel = cw.lib.a2o(sel),\n          keys = [],\n          docs = that.Rows.to(+d.limit).filter(function(d){\n            return osel[d.key]\n          }).map(function(row){\n            keys.push(row.key);\n            return {_id:row.key, _rev:row.value.rev, _deleted:true};\n          });\n\n      var req = {\n        url:[d.path[0],'_bulk_docs'],\n        method:'POST',\n        contentType:'application/json',\n        headers:{'X-Couch-Full-Commit':'true'},\n        data: JSON.stringify({docs:docs})\n      };\n\n      return that.Req(req)\n      .then(function(res){\n\n        // parse response\n        var num = res.length,\n            delnum = res.count(function(row){ return !row.error });\n\n        cw.lib.note(l.MSG_DEL_OK( num, delnum, _trunc(d.path[0])), num == delnum?'ok':'error', 5000);\n        if (num>delnum) console.log(res);\n\n        // notify tabs\n        $.my.radio('dbupdate', {db:d.path[0], cmd:'delete', docs:keys});\n        $.my.radio('dblist', [d.path[0]]);\n\n        d.selection.length = 0;\n        \n        // forget deleted ddocs\n        docs.forEach(function(row){\n          if (row._id[0]!='_') return;\n        \tif (that.Ddocs[row._id]) delete that.Ddocs[row._id];\n        });\n\n        // reload view\n        //that.GetView(true);\n        pi.resolve(res);\n      })\n      .fail(function(code, err, msg){\n        // fail to read doc back\n        cw.lib.note(l.MSG_DEL_FAIL.assign(code, es(err)), 'error');\n        return pi.reject(code, err, msg);\n      });\n\n    }\n  }"},"EdSwitch": "function () {\n  var that = this,\n      d = that.data;\n  \n  if (!d.view) {\n    that.Editor.length = 0;\n    return;\n  }\n  \n  // Ddoc view\n  if (d.view.to(2) == '_d') {\n\n    var vi = that.Vi[d.view],\n        eds = that.ViEds;\n    if (!eds[d.view]) {\n      var a = d.view.split('\\ufffd');\n      eds[d.view] = {\n        ddoc:\t\t\ta[0],\n        name:\t\t\ta[1],\n        type:\t\t\t'view',\n        mode:\t\t\t['map'],\n        language:\tvi.type=='js'?'javascript':vi.type,\n        map:\t\t\tvi.view.map||'',\n        reduce:\t\tvi.view.reduce||'',\n        json:\t\t\t{},\n        errors:\t\t[],\n        stamp:\t\tDate.now()\n      }\n    }\n\n    if (that.Editor[0] != eds[d.view]) that.Editor[0] = eds[d.view];\n  }\n\n  // Mango qry\n  if (d.view.to(5) == '_find') {\n    var m = d.mango,\n        qname = d.view.split('\\ufffd')[1] + '',\n        vi = m.query.find(function(e){return e.name == qname});\n    if (!vi) {\n      qname = 'Default query';\n      vi = m.query.find(function(e){return e.name == qname});\n    }\n    m.active = qname;\n    if (!vi.stamp) {\n      vi.stamp = Date.now();\n      vi.text = that.DefaultMangoQry.text;\n    }\n    if (that.Editor[0] != vi) {\n      that.Editor = [vi];\n      vi.json = that.jseval(vi.text);\n      if (!Object.isObject(vi.json)) vi.json = {};\n    }\n  }\n  \n  // Mango index\n  if (d.view.to(4) == '_idx') {\n    \n    var vi = that.Vi[d.view] || Object.clone(that.DefaultMangoIdx, true),\n        eds = that.ViEds;\n    if (!eds[d.view]) {\n      var a = d.view.split('\\ufffd');\n      eds[d.view] = {\n        ddoc:\t\t\t'_design/'+a[0].split('/')[1],\n        name:\t\t\ta[1],\n        type:\t\t\t'index',\n        mode:\t\t\t['javascript'],\n        text:\t\t\tvi.view?vi.view.source: vi.text,\n        json:\t\t\t{},\n        errors:\t\t[],\n        stamp:\t\tDate.now()\n      }\n    }\n\n    if (that.Editor[0] != eds[d.view]) that.Editor[0] = eds[d.view];\n  \t\n  }\n  \n  return that.Editor[0];\n}","GetView": "function _getView(redraw) {\n\t\n\t// gets viewdata according to current state,\n\t\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tdb = d.path[0],\n\t\t\tparams = {limit:100, update_seq:true},\n\t\t\tviewname = that.Vi[d.view]?that.Vi[d.view].path:[db, d.view+'' || '_all_docs'],\n      method = 'get',\n      mango = {},\n      isMango = d.view.to(5) == '_find',\n      isIdx = d.view.to(4) == '_idx',\n      body = null,\n\t\t\tpi = $.Deferred(),\n      wasBusy = false,\n\t\t\t_indexRow = that.Index;\n\t\n\tvar recalc = '#state-proxy',\n\t\t\trmethod = 'check'\n\t\n\tvar url = viewname;\n  \n  // We have view or Mango index\n  if (!isMango) {\n\t\n    if (d.reverse) params.descending = true;\n    params.limit = Math.abs(+d.limit) + 1;\n\n    if (d.start) {\n      if (/^_\\d+$/.test(d.start)) params.skip = +d.start.substr(1) || 0;\n      else {\n        var x;\n        try {\n          x = JSON.parse(d.start);\n        }catch(e){}\n        params.startkey = undefined!=x?x:d.start;\n      }\n    }\n\n    if (that.Vi[d.view] && that.Vi[d.view].reduce) {\n      var lvl = d.reduce+'';\n      if (!lvl) params.reduce=false;\n      else if (lvl == 0) params.group = false;\n      else if (lvl == 99) params.group = true;\n      else {\n        // params.group = true;\n        params.group_level = +lvl;\n      }\n    }\n    else if (isIdx) {\n      params.reduce = false;\n      if (d.view.to(6) == '_idx/\\ufffd') viewname[1] = '_all_docs';\n    }\n  }\n  \n  // We have mango qry\n  else {\n    viewname[1] = '_find';\n  \tmethod = 'post';\n    mango = that.Editor[0] \n    \t\t\t\t|| d.mango.query.find(function(e){return e.name == d.view.from(6)}) \n    \t\t\t\t|| d.mango.query.find(function(e){return e.name == 'Default query'});\n    body = JSON.stringify($.extend(true, {}, {\n    \tlimit: Math.abs(+d.limit) + 1,\n      skip: /^_\\d+$/.test(d.start)?+d.start.from(1):0\n    }, mango.json));\n    params = {};\n  }\n\t\n  // Join request params\n\tvar requrl = url.concat([params]);\n\t\n  // Check if we already have this req pending\n\tif (that.Pending[JSON.stringify(requrl)]) return that.Pending[JSON.stringify(requrl)];\n\t\n\t// mark busy\n\t_busy.debounce(100)(true);\n\t\n\t// request data\n\tthat.Pending[JSON.stringify(requrl)] = that.Req({\n    url:\t\trequrl,\n    headers:\t{accept:'application/json','Content-type':'application/json'},\n    method:\tmethod,\n    data:\t\tbody\n  })\n\t.then(function(res){\n\t\t\n\t\tthat.Pending[JSON.stringify(requrl)] = null;\n    that.Error = '';\n\n\t\tif (isMango) pi.resolve(_processMango(res));\n    else if (isIdx) pi.resolve(_processIndex(res))\n    else pi.resolve(_processView(res));\n    \n\t\tif (redraw) {\n\t\t\tthat.my.modal('#btn-viewcode', true);\n\t\t\tthat.my[rmethod](recalc);\n\t\t}\n\t}.debounce(10))\n\t.fail(function(code, err, msg){\n\t\t\n\t\tthat.Pending[JSON.stringify(requrl)] = null;\n\t\t\n\t\tcw.log('Photon failed to read view', db+'/'+viewname, code, err, msg);\n\t\tthat.Result[0] = {\n\t\t\turl:JSON.stringify(requrl),\n\t\t\tcode:code,\n\t\t\tstamp:Date.now()+'',\n\t\t\tok:false,\n\t\t\terror:err,\n\t\t\tmsg:msg\n\t\t};\n    that.Rows = [];\n    that.Error = 'Error '+code +': '+err;\n\t\tpi.resolve(that.Result[0]);\n\t\tif (redraw) that.my[rmethod](recalc);\n\t}.debounce(10))\n\t.always(_busy.fill(false).debounce(10));\n  \n  return pi.promise();\n  \n  // - - - - - - - - - - -\n  \n  function _processView(res){\n  \tres.stamp = Date.now()+'';\n\t\tres.url = url+'';\n\t\tthat.Result[0] = res;\n\t\td.total_rows = res.total_rows || -1;\n\t\td.offset = res.offset || -1;\n\t\td.seq = (res.update_seq || Date.now())+'';\n\t\t\n\t\t//console.time();\n\t\t\n\t\tres.rows.forEach(function(row,i){\n\t\t\trow._vjson = JSON.stringify(Object.reject(row,'key'), null, '  ').from(2);\n\t\t\trow._kjson = '{\\n  \"key\": '+JSON.stringify(row.key)+',\\n';\n\t\t\trow._idx = JSON.stringify([row.key, row.id, i]); \n\t\t\trow._idxsafe = row._idx.escapeHTML();\n\t\t});\n\t\t\n\t\t//console.timeEnd();\n\t\t\n\t\tthat.Rows = (res.rows || []).slice(0);\n\t\td.link = that.Req(requrl, true);\n    return res;\n  }\n  \n  // - - - - - - - - - - -\n  \n  function _processIndex(res){\n  \tres.stamp = Date.now()+'';\n\t\tres.url = url+'';\n\t\tthat.Result[0] = res;\n\t\td.total_rows = res.total_rows || -1;\n\t\td.offset = res.offset || -1;\n\t\td.seq = (res.update_seq || Date.now())+'';\n\t\t\n\t\t//console.time();\n\t\t\n\t\tres.rows.forEach(function(row,i){\n\t\t\trow._vjson = JSON.stringify(row, null, '  ').from(2);\n\t\t\trow._kjson = '{\\n';\n\t\t\trow._idx = JSON.stringify([row.key, row.id, i]); \n\t\t\trow._idxsafe = row._idx.escapeHTML();\n\t\t});\n\t\t\n\t\t//console.timeEnd();\n\t\t\n\t\tthat.Rows = (res.rows || []).slice(0);\n\t\td.link = that.Req(requrl, true);\n    return res;\n  }\n  \n  // - - - - - - - - - - -\n  \n  function _processMango(res){\n  \tres.stamp = Date.now()+'';\n\t\tres.url = url+'';\n\t\tthat.Result[0] = res;\n\t\td.total_rows = -1;\n\t\td.offset = mango.skip || -1;\n\t\td.seq = (res.update_seq || Date.now())+'';\n    \n    var skip = /^_\\d+$/.test(d.start)?+d.start.from(1):0;\n\t\t\n\t\t//console.time();\n\t\tvar a = [];\n\t\tres.docs.forEach(function(row0,i){\n      var row = {\n      \tid: (skip+i)+'',\n        key: (skip+i)+'',\n        value: row0\n      };\n\t\t\trow._vjson = JSON.stringify(row0, null, '  ').from(1);\n\t\t\trow._kjson = '{';\n\t\t\trow._idx = JSON.stringify([skip+i]); \n\t\t\trow._idxsafe = row._idx.escapeHTML();\n      a.push(row);\n\t\t});\n\t\t\n\t\t//console.timeEnd();\n\t\t\n\t\tthat.Rows = (a || []).slice(0);\n\t\td.link = that.Req(requrl, true);\n  \treturn res;\n  }\n  \n\t\n  // - - - - - - - - - - -\n  \n  function _busy(busy){\n    if ((busy && !wasBusy)  || !busy) {\n      if (that.my) that.my.root().toggleClass('app-busy', busy);\n      $.my.radio('appbusy',{id:d.tabid, busy:busy});\n    }\n    wasBusy = true;\n\t}\n\t\n}","GetViews": "function _getViewsList(redraw,silent,onlyMango) {\n\n\t// Gets list of all ddocs\n\n\tvar that = this,\n\t\t\td = that.data,\n      isS = Object.isString,\n      isO = Object.isObject,\n      isA = Object.isArray,\n      isF = Object.isFunction,\n\t\t\tdb = d.path[0],\n\t\t\turl = [db,'_all_docs',{startkey:'_design', endkey:'_design0',include_docs:true}],\n\t\t\tviewlist = that.DefaultViews(),\n      indexes = viewlist.find(function(e){return e.text == 'Mango indexes'}),\n\t\t\tvi = {},\n\t\t\tpi = $.Deferred();\n  \n  // Mango sync rebuild\n  if (onlyMango) {\n    viewlist.remove(indexes);\n    that.Views.forEach(function(e){\n    \tif (e.children && (e.text[0] == '_' || e.text.to(5)=='Mango')) viewlist.push(e);\n    });\n    that.Views = viewlist.sortBy(function(e){\n    \treturn (e.order || '') + e.text;\n    });\n  \tif (redraw) {\n\t\t\tthat.my.find('#view-name').select2({data:viewlist, minimumResultsForSearch:12});\n\t\t\tthat.my.recalc('#view-name');\n\t\t}\n    pi.resolve();\n    return viewlist;\n  }\n\t\n  \n  // Read ddocs\n  \n\tthat.Req(url).then(function(res){\n\t\tvar rows = res.rows||[];\n\t\tif (!rows.length && d.view.to(5) != '_find') {\n\t\t\td.view = '';\n\t\t\treturn;\n\t\t}\n\n\t\tvar reerl0 = /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/,\n\t\t\t\treerl1 = /\\.[\\r\\n\\s\\t]*$/;\n\t\t\n    // Start iterating ddocs\n    \n\t\trows.forEach(function(row){\n      \n\t\t\tvar ddoc = row.doc;\n      if (!ddoc) return;\n      \n      var views = ddoc.views || {},\n\t\t\t\t\tv = Object.keys(views),\n\t\t\t\t\tg = {text:row.id, children:[]},\n          vlang = ddoc.language || 'javascript';\n      \n      // Stash ddoc\n      if (!that.Ddocs[ddoc._id] || that.Ddocs[ddoc._id]._rev != ddoc._rev) {\n        that.Ddocs[ddoc._id] = $.extend(true, {}, ddoc);\n      }\n      \n      // skip if no views\n\t\t\tif (!v.length) return;\n      \n\t\t\tv.forEach(function(key){\n\t\t\t\tvar r = views[key];\n        \n        // ==== View index =====\n        \n        if (vlang == 'erlang' || vlang == 'javascript') {\n\t\t\t\t\n          // Detect map\n          if (!isO(r) || !isS(r.map)) return;\n\n          var vid = row.id+'\\ufffd'+key,\n              s0 = {id:vid, text:'\\u00a0\\u00a0'+key},\n              v0 = {path:[db,'_design',row.id.split('/')[1],'_view',key], reduce:false, type:''};\n\n\n          if (\n            /^[\\s\\r\\n\\t]*function[\\S\\s]+\\}[\\s\\r\\n\\t]*$/.test(r.map)\n            || isF(cw.lib.unjson([r.map])[0]) \n          ) v0.type = 'js';\n          else if(reerl0.test(r.map) && reerl1.test(r.map)) {\n            s0.text+= '\\u00a0(Erlang)';\n            v0.type = 'erlang';\n          }\n          else return;\n\n          v0.view = Object.clone(r, true);\n\n          // Detect reduce\n          var red = r.reduce,\n              fold = '';\n          if (isS(red)) {\n            if (red[0] == '_') red = red.from(1);\n            if (red == 'sum') fold = 'Σ';\n            else if (red = 'count') fold = '#';\n            else if (red = 'min') fold = '⊻';\n            else if (red = 'max') fold = '⊼';\n            else if (red = 'stats') fold = '=';\n            else if (red = 'sumsqr') fold = 'Σ²';\n            else if (isF(cw.lib.unjson([red])[0])) fold = 'f';\n            else if (reerl0.test(red) && reerl1.test(red)) fold = 'f\\u00a0(erl)';\n\n            if (fold) {\n              s0.text += '\\u2009•\\u2009'+fold;\n              v0.reduce = true;\n            }\n          }\n          g.children.push(s0);\n          vi[vid] = v0;\n      \t}\n        \n        // ==== Mango index =====\n        \n        else if (indexes && vlang == 'query') {\n          \n          if (\n            !isO(r) || !isO(r.map) || !isO(r.map.fields) \n            || !isO(r.options) || !isO(r.options.def) || !isA(r.options.def.fields)\n          ) return;\n          \n          var ddocid = row.id.split('/')[1],\n              vid = '_idx/'+ddocid+'\\ufffd'+key,\n              s0 = {id:vid, text:'\\u00a0\\u00a0'+key+'\\u00a0in\\u00a0_d/'+ddocid, order:'_1'},\n              v0 = {path:[db,'_design',row.id.split('/')[1],'_view',key], reduce:false, type:''};\n          \n          v0.view = Object.clone(r, true);\n          \n          // Rebuild source\n          var def = r.options.def;\n          v0.view.source = /*v0.view.source ||*/ [\n          \t'({',\n            '\\n\\tindex: {',\n            '\\n\\t\\tfields: [{1}]',\n            def.partial_filter_selector\n              ?',\\n\\t\\tpartial_filter_selector: '\n            \t\t+JSON.stringify(def.partial_filter_selector, null, '\\t')\n            \t\t.lines()\n            \t\t.map(function(e, i){return (i?'\\t\\t':'')+e})\n            \t\t.join('\\n')\n              :'',\n            '\\n\\t},\\n\\tname: {2},\\n\\tddoc: {3},\\n\\ttype: \"json\"',\n            '\\n})'\n          ].join('').assign(\n            def.fields.map(JSON.stringify).join(', '),\n            JSON.stringify(key),\n            JSON.stringify(row.id.split('/').from(1).join('/'))\n          );\n          vi[vid] = v0;\n          \n          indexes.children.push(s0);\n        }\n\t\t\t});\n\t\t\t\n\t\t\t// put in list if any\n\t\t\tif (g.children.length) {\n\t\t\t\tg.children = g.children.sortBy('text');\n\t\t\t\tviewlist.push(g);\n\t\t\t}\n      \n\t\t}); // --- end iterating ddocs\n    \n    // sort views list\n\t\tviewlist = viewlist.sortBy(function(e){\n    \treturn (e.order || '') + e.text;\n    });\n    \n    // sort indexes if any\n    if (indexes) {\n      indexes.children = indexes.children.sortBy(function(e){\n        return (e.order || '') + e.text;\n      });\n    }\n\t})\n\t.fail(function(code, err, msg){\n\t\tcw.log('Photon failed to read ddocs for the bucket', db, code, err, msg);\n\t\tif (!silent) cw.lib.note(that.lang.ERR_GETVIEWS.assign(db), 'error');\n\t})\n\t.always(function(){\n\t\tthat.Views = viewlist;\n\t\tthat.Vi = vi;\n\t\tif (d.view && !vi[d.view] && d.view.to(5)!='_find') {\n\t\t\td.view = '';\n\t\t}\n\t\tif (redraw) {\n\t\t\tthat.my.find('#view-name').select2({data:viewlist, minimumResultsForSearch:12});\n\t\t\tthat.my.recalc('#view-name');\n\t\t}\n\t\tpi.resolve(viewlist);\n\t});\n\t\n\t\n\treturn pi.promise();\n\n}","T": {"view": "<div class=\"view-row\" data-key=\"{_idxsafe}\"><div class=\"col-ids\">{idsafe}<div class=\"view-tofilter pseudolink view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter\"></span></div><div class=\"view-hoverbtn {nodoc}\"><a href=\"#{href}\" class=\"tdn\"><span class=\"fi-page-filled\"></span></a></div></div><div class=\"col-vals {css}\"><div class=\"col-trim\">{html}</div></div></div>","view_filter": "<div class=\"view-row\" data-key=\"{_idxsafe}\"><div class=\"col-ids\">{idsafefilter}<div class=\"view-tofilter pseudolink view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter\"></span></div><div class=\"view-hoverbtn {nodoc}\"><a href=\"#{href}\" class=\"tdn\"><span class=\"fi-page-filled\"></span></a></div></div><div class=\"col-vals {css}\"><div class=\"col-trim\">{html}</div></div></div>","mango": "<div class=\"view-row\" data-key=\"{_idxsafe}\"><div class=\"col-ids\">{idsafe}</div><div class=\"col-vals {css}\"><div class=\"col-trim\">{html}</div></div></div>","docs": "<div class=\"w100p view-row pt3\"><input class=\"w23 dib tac ml4 mr1 pt2\" type=\"checkbox\" name=\"docs-selection\" {checked} value=\"{idsafe}\"><div class=\"w40p-30 pr20\"><a href=\"#{href}\" class=\"tdn\">{idsafe}</a><div class=\"view-tofilter view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter o50 blue\"></span></div></div><div class=\"w60p pr10\">{rev}</div></div>","user_docs": "<div class=\"w100p view-row pt3\"><input class=\"w23 dib tac ml4 mr1 pt2\" type=\"checkbox\" name=\"docs-selection\" {checked} value=\"{idsafe}\"><div class=\"w40p-30 pr20\"><a href=\"#{href}\" class=\"tdn\">{idsafe}</a><div class=\"view-tofilter view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter o50 blue\"></span></div><div class=\"view-edituser view-hoverbtn\" data-user=\"{idsafe}\"><span class=\"fi-torso o50 fs110 blue\"></span></div></div><div class=\"w60p pr10\">{rev}</div></div>"}},"$dbs": {"id": "cw.Photon.$dbs","lang": {},"hash": "function () {return 'list';}","title": "function () {  return 'DB list and tasks'; }","data": {"reverse": false,"search": "","selection": [],"task": {"search": "","filter": [""],"list": [],"selection": [],"seq": 0},"service": {"version": ""}},"All": {},"List": [],"Batch": {},"Tasks": [],"RT": "function (key) {\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t}","Modals": {},"TaskLoop": false,"TaskLoopInterval": false,"LastSync": {},"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\tthat.RelistNow = that.Relist.debounce(10);\n\t\tthat.Relist = that.Relist.throttle(100);\n    \n    that.Arrows = that.Arrows.split('\\n\\n');\n\t\t\n\t\t$o.html(that.HTML.assign(that.lang));\n\t\t\n\t\t// init db selection\n\t\t$o.on('click.my','input[name=\"db-selection\"]', function(){\n\t\t\tvar v = [],\n\t\t\t\t\t$f = $o.find('input[name=\"db-selection\"]');\n\t\t\t$f.each(function () {\n\t\t\t\tvar $x = $(this);\n\t\t\t\tif ($x.is(\":checked\")) v.push($x.val());\n\t\t\t});\n\t\t\td.selection = v;\n\t\t\tthat.my.check('#view-hasselection');\n\t\t});\n    \n    // init task selection\n\t\t$o.on('click.my','input[name=\"task-selection\"]', function(evt){\n\t\t\tvar v = [],\n\t\t\t\t\t$f = $o.find('input[name=\"task-selection\"]'),\n          id = $(evt.target).val();\n\t\t\t$f.each(function () {\n\t\t\t\tvar $x = $(this);\n\t\t\t\tif ($x.is(\":checked\")) v.push($x.val());\n\t\t\t});\n\t\t\td.task.selection = v;\n      (that.Tasks.find(function(e){return e.replication_id == id}) || {})._selected = v.indexOf(id)>-1;\n\t\t\tthat.my.check('#task-list');\n\t\t});\n\t\t\n\t\t// init ACL\n\t\t$o.on('click.my', '#btn-dbacl', function(evt){\n\t\t\tvar $b = $(evt.currentTarget),\n\t\t\t\t\tdb = $b.data('db');\n\t\t\tthat.Req([db,'_security'])\n\t\t\t.then(function(res){\n\t\t\t\t$b.modal({\n\t\t\t\t\troot:$o,\n\t\t\t\t\tmanifest:that.Pho('SecObj'),\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tdbs:[db], \n\t\t\t\t\t\tadmins:res.admins||{names:[], roles:[]}, \n\t\t\t\t\t\tmembers:res.members||{names:[], roles:[]} \n\t\t\t\t\t},\n\t\t\t\t\twidth:380,\n\t\t\t\t\tbound:0,\n\t\t\t\t\tnose:'left',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\talign:'left:70%;top:-46px;',\n\t\t\t\t\tscreen:'rgba(255,255,255,0)',\n\t\t\t\t\tesc:true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\t\n\t\t$o.then(function(){\n\t\t\tthat.Req({url:[], dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\t$.extend(true, that.data.service, res);\n\t\t\t\tthat.my.check('#btn-logs');\n\t\t\t});\n\t\t}.debounce(200));\n\t\t\n\t\treturn that.GetList(true)\n\t\t.then(function(){\n\t\t\t// read task initially\n\t\t\tthat.TaskLoopInterval = that.Pho('Cfg').loopActiveTasks;\n\t\t\tthat.GetTasks(true);\n\t\t\t// start poll\n\t\t\tthat.RestartPoll();\n\t\t\t\n\t\t});\n\t\t\n\t}","Relist": "function () {\tthis.my.check('#db-proxy'); }","GetList": "function (redraw,subset) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\treturn that.Pho('GetList')()\n\t\t.then(function(){\n\t\t\tthat.All = that.Pho('All');\n\t\t\tif (redraw) that.Relist();\n\t\t\tthat.BatchInfo(subset || Object.keys(that.All), that.Pho('Cfg').batchDbInfoDelay);\n\t\t});\n\t}","ui": {"#db-search": {"delay": 150,"bind": "search","css": {"my-search": "new RegExp(/^.{2,}$/)"}},"#btn-reload": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tif (!d.selection.length) {\n\t\t\t\tthis.GetList(true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.BatchInfo(d.selection, this.Pho('Cfg').batchDbInfoDelay);\n\t\t\t}\n\t\t}"},"#btn-view-dir": {"bind": "function (d,v) {\n\t\t\tif (v!=null) d.reverse = !d.reverse;\n\t\t\treturn !d.reverse?'▲':'▼';\n\t\t}","events": "click.my"},"#btn-select": {"delay": 10,"bind": "function (d,v) {\n\t\t\tvar that = this,\n\t\t\t\t\tall = Object.keys(that.All),\n\t\t\t\t\tlist = that.List.map(function(e){return e.name}),\n\t\t\t\t\tsel = d.selection.intersect(list),\n\t\t\t\t\tsl = sel.length,\n\t\t\t\t\tl = that.lang,\n\t\t\t\t\tt;\n\t\t\t\n\t\t\tif (sl) t = l.TXT_UNSELECT.assign(sel.length == all.length?l.TXT_SELECT_ALL:sl);\n\t\t\telse t = l.TXT_SELECT.assign(list.length == all.length?l.TXT_SELECT_ALL:l.TXT_SELECT_FILTERED);\n\t\t\t\n\t\t\tif (v!=null) {\n\t\t\t\t// unselect\n\t\t\t\tif (sl) d.selection = d.selection.subtract(list).unique();\n\t\t\t\t// select\n\t\t\t\telse d.selection = d.selection.concat(list).unique();\n\t\t\t}\n\t\t\treturn t;\n\t\t}","events": "click.my","css": {"hide": "function (d,v) {return !this.List.length}"},"watch": ["#view-hasselection","#db-proxy"]},"#view-cols": {"bind": "function (d,v) {\n\t\t\treturn this.lang.TXT_MAPVIEW(this.List.length, Object.size(this.All))\n\t\t}","watch": ["#db-proxy"]},"#view-links": {"bind": "function (d,v) {\n\t\t\tvar that = this,\n\t\t\t\t\tbase = that.Pho('Base'),\n\t\t\t\t\tt = '<a target=\"_blank\" class=\"tdn\" href=\"{1}\">{2}</a>';\n\t\t\treturn [\n\t\t\t\tt.assign(base, base.replace(/^http[s]?:\\/\\/|\\//g,'').escapeHTML() )\n\t\t\t].join('\\u2009')\n\t\t}"},"#db-list": {"delay": 50,"init": "function ($o) {\n\t\t\tvar that = this,\n\t\t\t\t\tt = that.Row,\n\t\t\t\t\td = that.data;\n\t\t\t$o.list({\n\t\t\t\tdata:that.List,\n\t\t\t\tdelay:0,\n\t\t\t\tchunk:100,\n\t\t\t\tsortBy:null,\n\t\t\t\tid: function(e){return e.name},\n\t\t\t\thash:function(e) {\n\t\t\t\t\t\n\t\t\t\t\tvar h = cw.lib.sdbm([\n\t\t\t\t\t\te.name, \n\t\t\t\t\t\te.stamp, \n\t\t\t\t\t\te.update_seq + 'x',\n\t\t\t\t\t\te.checked+'x',\n\t\t\t\t\t\te.sizesafe, \n\t\t\t\t\t\te.security.stamp,\n\t\t\t\t\t\te.tasks.stamp, \n\t\t\t\t\t\te.syncs.stamp\n\t\t\t\t\t]);\n\n\t\t\t\t\treturn h;\n\t\t\t\t},\n\t\t\t\ttemplate: function(e){ \n\t\t\t\t\tvar h = t.assign(e); \n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t});\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t}","bind": "function (d,v,$o) {\n\t\t\tif (v!=null) return;\n\t\t\t$o.list('data', this.List)\n\t\t}","watch": ["#db-proxy","#view-hasselection"]},"#db-proxy": {"delay": 50,"bind": "function (d,v) {\n\t\t\t//if (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tt = that.Row,\n\t\t\t\t\tall = that.All,\n\t\t\t\t\tsel = cw.lib.a2o(d.selection);\n\t\t\t\n\t\t\tthat.List = Object.values(all).sortBy('name', d.reverse);\n\t\t\t\n\t\t\tif (d.search.length>1) {\n\t\t\t\tvar re = new RegExp(\n\t\t\t\t\td.search.toLowerCase()\n\t\t\t\t\t.split(' ')\n\t\t\t\t\t.compact(true)\n\t\t\t\t\t.map(function(t){return t.escapeRegExp()})\n\t\t\t\t\t.join('|')\n\t\t\t\t);\n\t\t\t\tthat.List = that.List.filter(function(e){\n\t\t\t\t\treturn re.test(e.name.toLowerCase())\n\t\t\t\t});\n\t\t\t}\n\t\t\tthat.List.forEach(function(r){\n\t\t\t\tvar das, dis;\n\t\t\t\tif ((dis = r.disk_size) && (das = r.data_size)) {\n\t\t\t\t\tr.sizesafe = '<span class=\"{1}\">{2}</span>'.assign(\n\t\t\t\t\t\t(das/dis<0.1?'red o70':das/dis<0.5?'orange o90':'xgray'),\n\t\t\t\t\t\tdis.bytes(1).replace(/B$/,'b')\n\t\t\t\t\t);\n\t\t\t\t\tr.sizetip = that.lang.TIP_DBSIZE.assign(\n\t\t\t\t\t\tdas.bytes(1).replace(/B$/,'b'),\n\t\t\t\t\t\tdis.bytes(1).replace(/B$/,'b')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tr.update_seq_safe = (r.update_seq+'').split('-')[0];\n\t\t\t\tr.checked = sel[r.name]?'checked':'';\n\t\t\t});\n\t\t\t//return Date.now()+'';\n\t\t}","listen": {"userCtx": "function (d,v) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (v) {\n\t\t\t\t\tif (v.name) {\n\t\t\t\t\t\tthat.GetList(true);\n\t\t\t\t\t\tthat.RestartPoll();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.All = {};\n\t\t\t\t\t\tthat.GetList(true);\n\t\t\t\t\t\tthat.RestartPoll();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}","dblist": "function (d,v) {\n\t\t\t\tif (!Object.isArray(v)) return;\n\t\t\t\tthis.GetList(true, v);\n\t\t\t}"},"watch": ["#btn-view-dir","#db-search","#btn-select"]},"#view-hasselection": {"css": {},"watch": ["#db-search","#btn-select"]},"#btn-logs": {"css": {"hide": "function (d) { return (d.service.version+'')[0] != '1'; }"}},"#btn-newdb": {"bind": "function (d,v,$o) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-newdb', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\tthat.my.modal('#btn-newdb',{\n\t\t\t\t\tmanifest:that.Pho('NewDB'),\n\t\t\t\t\twidth:380,\n\t\t\t\t\tdata:{},\n\t\t\t\t\talign:'top:102%;left:0;',\n\t\t\t\t\tnose:'top',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tesc:true,\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t});\t\t\t\t\n\t\t\t}\n\t\t}","css": {":disabled": "function (d) {\n\t\t\t\treturn !cw.me();\n\t\t\t}"},"listen": {"userCtx": "function (d,v) {this.my.check('#btn-newdb');}"}},"#btn-compact": {"bind": "function (d,v,$o) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-compact', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\tthat.my.modal('#btn-compact',{\n\t\t\t\t\tmanifest:that.Pho('Compact'),\n\t\t\t\t\twidth:380,\n\t\t\t\t\tdata:{ selection:d.selection.slice(0) },\n\t\t\t\t\talign:'top:102%;left:0;',\n\t\t\t\t\tnose:'top',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tesc:true,\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}","css": {":disabled": "function (d) {\n\t\t\t\treturn !cw.me() || !d.selection.length || !this.List.map(function(e){return e.name}).intersect(d.selection).length;\n\t\t\t}"},"watch": ["#view-hasselection"],"listen": {"userCtx": "function (d,v) {this.my.check('#btn-compact');}"}},"#btn-deldb": {"bind": "function (d,v,$o) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-deldb', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:that.Pho('DelDB'),\n\t\t\t\t\twidth:380,\n\t\t\t\t\tdata:{ dbs:d.selection.slice(0) },\n\t\t\t\t\tcss:'xgray p20',\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\td.selection.length = 0;\n\t\t\t\t})\n        .always(function(){\n        \tthat.Modals.head = null;\n        });\n\t\t\t}\n\t\t}","css": {":disabled": "function (d) {\n\t\t\t\treturn !cw.me() || !d.selection.length || !this.List.map(function(e){return e.name}).intersect(d.selection).length;\n\t\t\t}"},"watch": ["#view-hasselection"],"listen": {"userCtx": "function (d,v) {this.my.check('#btn-deldb');}"}},"#task-filter": {"init": "function ($o) {\n\t\t\t$o.tags($.extend(true, {}, this.lang.TAGS_TASK_TYPE, {tagshim:'\\u2009', groupshim:'\\u2009'}));\n\t\t}","bind": "task.filter"},"#task-cols": {"bind": "function (d,v) {\n\t\t\treturn this.lang.TXT_TASKVIEW(this.Tasks.length?d.task.list.length:0, this.Tasks.length)\n\t\t}","watch": ["#task-filter","#task-list","#task-search"]},"#task-search": {"delay": 150,"bind": "task.search","css": {"my-search": "new RegExp(/^.{2,}$/)"}},"#task-list": {"delay": 50,"init": "function ($o) {\n\t\t\tvar that = this,\n\t\t\t\t\tt = that.TTask,\n\t\t\t\t\td = that.data;\n\t\t\t$o.list({\n\t\t\t\tdata:that.Tasks,\n\t\t\t\tdelay:0,\n\t\t\t\tchunk:100,\n\t\t\t\tsortBy:null,\n\t\t\t\tid: function(e){return e.pid + e.doc_id;},\n\t\t\t\thash:function(e) {\n\t\t\t\t\treturn cw.lib.sdbm([\n\t\t\t\t\t\te.pid, \n\t\t\t\t\t\t//e.updated_on, \n            e._selected?'sel':'unsel',\n\t\t\t\t\t\te.type,\n\t\t\t\t\t\te._progress,\n\t\t\t\t\t\te._started, \n\t\t\t\t\t\te._desc,\n            e.filter\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\ttemplate: function(e){  return t(e); }\n\t\t\t});\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t}","bind": "function (d,v,$o) {\n\t\t\tif (v!=null) return;\n\t\t\tif (!d.task.search.from(1) && d.task.filter == '') d.task.list = this.Tasks;\n\t\t\telse {\n\t\t\t\tvar f = this.Tasks.slice(0),\n\t\t\t\t\t\tfl= d.task.filter.exclude('active');\n\t\t\t\tif (d.task.filter.indexOf('active')>-1) f = f.filter(function(e){return e.pid!='Error' && e.pid!='Done';});\n\t\t\t\tvar a = !(fl+'')?f:f.filter(function(row){\n\t\t\t\t\treturn (row.type+'').indexOf(fl+'') != -1;\n\t\t\t\t});\n\n\t\t\t\tif (d.task.search.length>1) {\n\t\t\t\t\tvar re = new RegExp(\n\t\t\t\t\t\td.task.search.toLowerCase()\n\t\t\t\t\t\t.split(' ').compact(true)\n\t\t\t\t\t\t.map(function(t){return t.escapeRegExp()})\n\t\t\t\t\t\t.join('|')\n\t\t\t\t\t);\n\t\t\t\t\ta = a.filter(function(e){ return re.test(e._index) });\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\td.task.list = a;\n\t\t\t}\n\t\t\tthis.my.find('#task-list').list('data', d.task.list);\n\t\t}","watch": ["#task-filter","#task-search"]},"#btn-reloadsync": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      var that = this;\n      that.RestartPoll.debounce(500)();\n    }","css": {":disabled": "function (d,v) {return !cw.me();}"},"watch": ["#task-list"],"listen": {"userCtx": "function (d,v) {\n        var that = this;\n        if (!Object.isObject(v)) return;\n        if (!v.name) {\n        \t// unauthorized, clear list immdeiately\n          that.Tasks.length = 0;\n          d.task.selection.length = 0;\n          that.my.recalc('#task-list');\n          that.my.check('#task-cols');\n          that.my.check('#task-list');\n        }\n        else that.my.check('#btn-reloadsync');\n      }"}},"#btn-resync": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      var that = this;\n      that.RestartTasks()\n      .then(function(){\n      \td.task.selection.length = 0;\n        that.my.check('#task-list');\n        that.RestartPoll.debounce(300)();\n        that.RestartPoll.debounce(1500)();\n      });\n    }","css": {":disabled": "function (d) {\n      \tif (!d.task.selection.length) return true;\n        var a = cw.lib.a2o(d.task.selection),\n            ok = true;\n        this.Tasks.forEach(function(e){\n        \tif (!e.doc_id && a[e.replication_id]) ok = false;\n        });\n        return !ok;\n      }"},"watch": ["#task-list"]},"#btn-stopsync": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      var that = this;\n      that.RestartTasks(true)\n      .then(function(){\n      \td.task.selection.length = 0;\n        that.my.check('#task-list');\n        that.RestartPoll.debounce(300)();\n        that.RestartPoll.debounce(1500)();\n      });\n    }","css": {":disabled": "function (d) {return !d.task.selection.length}"},"watch": ["#task-list"]},"#btn-newsync": {"bind": "function (d,v) {\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif (that.my.find('#btn-newsync').data('modal')) {\n\t\t\t\tthat.my.find('#btn-newsync').modal(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\tthat.my.find('#btn-newsync').modal({\n\t\t\t\troot:that.my.find('#rpanel'),\n\t\t\t\tmanifest:$.extend(\n\t\t\t\t\ttrue, {}, \n\t\t\t\t\tthat.Pho('NewSync'), \n\t\t\t\t\t{\n\t\t\t\t\t\tDBs:Object.keys(that.All).sortBy(function(e){return e[0]=='_'?'zzz'+e:e;}),\n            RestartPoll:that.RestartPoll,\n\t\t\t\t\t\tparams:{width:(that.my.find('#rpanel').width()-32).clamp(340,740)}\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\tdata:that.LastSync,\n\t\t\t\tnose:'top',\n\t\t\t\talign:'top:103%',\n\t\t\t\tcss:'xgray',\n\t\t\t\tbound:0\n\t\t\t});\n\t\t\t}catch(e){console.log(e)}\n\t\t}","css": {":disabled": "function (d,v) {return !cw.me();}"},"listen": {"userCtx": "function (d,v) {this.my.check('#btn-newsync');}"},"watch": ["#task-list"]}},"die": "function ($o) {\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#db-list').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t\tvar f = $o.find('#task-list').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t\t\n\t\t// stop tasks loop\n\t\tif (this.TaskLoop) this.TaskLoop.cancel();\n\t\t\n\t}","Row": "<div class=\"view-row\"><input class=\"w23 dib tac ml3 mr2 cp\" type=\"checkbox\" name=\"db-selection\" {checked} value=\"{namesafe}\"><div class=\"w100p-338 mh19em\"><div id=\"btn-dbacl\" class=\"fr o60 fs90 {protected} cp\" data-db=\"{namesafe}\"></div><a href=\"#{href}\" class=\"tdn pr20\">{namesafe}</a></div><div class=\"w310 view-aux fs95 pt1\"><div class=\"w80 tar  pr6\">{doc_count}</div><div class=\"w70 fs90 vat tal pt5 lh130 pl6 gray\">{doc_del_count}</div><div class=\"w80 tar  pr6\" title=\"{update_seq}\">{update_seq_safe}</div><div class=\"w80 tar pr6\" title=\"{sizetip}\">{sizesafe}</div></div></div>","style": {" .view-row": "width:100%;min-height:1.9em;"," .view-row:nth-child(2n+0)": "background-color:rgba(206, 214, 226, 0.2);"," .view-row svg": "margin-bottom:1px;"," .tarrow": "display:inline-block;width:31px;padding-right:1px;text-align:center;"," #db-list": {"": "outline:none;"," .view-row>div": "display:inline-block;vertical-align:top;word-wrap: break-word;"," .view-aux>div": "display:inline-block;vertical-align:top;min-height:1.9em;"," .mh19em": "min-height:1.9em;"," input:checked+div": "font-weight:bolder"," .col-ids": "width:30%;padding:0 20px 0 8px;"," .col-vals": "width:70%; padding-left:10px;"," .view-tofilter": "display:inline-block; margin-left:5px;width:20px;line-height:1.2em;opacity:0;transition:opacity 0.5s;"," .view-row:hover .view-tofilter": "opacity:0.5;cursor:pointer;"}," #task-panel": {"": "outline:none;"}," #db-panel": {":before": "content:\" \";position:absolute;top:0px;z-index:-1;height:100%;right:230px;width:80px;border-left:1px solid #e1e5e8;border-right:1px dotted #e1e5e8;",":after": "content:\" \";position:absolute;top:0px;z-index:-1;height:100%;right:80px;width:80px;border-left:1px solid #e1e5e8;border-right:1px solid #e1e5e8;"}," .bbs": "border-bottom-color:rgba(211,217,222,0.7);"," .bas": "border-color:rgba(211,217,222,0.7);"," .brs": "border-right:1px solid rgba(211,217,222,0.7);"," .brsl": "border-right:1px solid rgba(211,217,222,0.3);"," .w100p-338": "width:calc(100% - 338px);"," .w100p-310": "width:calc(100% - 311px);"},"HTML": "<div class=\"w55p dib vat\"><div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\"><div class=\"fr fs95\" style=\"max-width:200px;width:22%;\"><div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div><input type=\"text\" id=\"db-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span></div><div class=\"nw dib vat w75p pr10\"><button id=\"btn-reload\" class=\"w40 mr2\" title=\"{TIP_RELOAD}\"><span class=\"fi-loop\"></span></button><button id=\"btn-newdb\" class=\"green mr2\">{BTN_NEWDB}</button><span id=\"view-hasselection\"><button id=\"btn-compact\" class=\"mr2\" disabled>{BTN_COMPACT}</button><button id=\"btn-deldb\" class=\"mr2 red\" disabled>{BTN_DELDB}</button></span><span id=\"btn-logs\" class=\"hide pl12\"><a href=\"#_log\" class=\"tdn\">{BTN_LOGS}</a></span></div></div><div id=\"db-panel\" class=\"panelheight-32 br2 mt16 ml20 mr20 bas\"><div class=\"h30 bg-gray7 bbs lh160 pt1 nw oh ell\"><div class=\"w100p-310 dib vat nw oh ell\"><span id=\"btn-view-dir\" class=\"dib pl8 pr6 mr2 vat cp o50 fs80 pt2 pseudolink tdn h30\"></span><span id=\"view-links\" class=\"gray hide\"></span><div id=\"view-cols\" class=\"dib vat pr12 nw xgray\"></div><div id=\"btn-select\" class=\"pseudolink tdn dib vat\"></div></div><div class=\"w310 dib gray fs90\"><div class=\"w80 dib tar pr6\">{H_DOCS}</div><div class=\"w70 dib pl7\">{H_DELDOCS}</div><div class=\"w80 dib tar pr7\">{H_SEQ}</div><div class=\"w80 dib tar pr7\">{H_SIZE}</div></div></div><section id=\"db-list\" class=\"panelheight-64 xgray lh170\"></section></div><div id=\"db-proxy\" class=\"hide\"></div></div><div id=\"rpanel\" class=\"w45p dib vat pr20\"><div id=\"a-head\" class=\"app-head nw pt18 mb16 tal\"><div class=\"fr fs95 tal\" style=\"max-width:200px;width:26.4%;\"><div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div><input type=\"text\" id=\"task-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span></div><div class=\"w70p dib\"><button id=\"btn-reloadsync\" class=\"w40 mr2\" title=\"{TIP_TASK_RELOAD}\"><span class=\"fi-loop\"></span></button><button id=\"btn-newsync\" class=\"mr2\">{BTN_TASK_NEWSYNC}</button><button id=\"btn-resync\" class=\"orange mr2\" disabled>{BTN_TASK_RESYNC}</button><button id=\"btn-stopsync\" class=\"red\" disabled>{BTN_TASK_STOP}</button></div></div><div id=\"task-panel\" class=\"panelheight-32 br2 mt16 bas\"><div><div class=\"h30 bg-gray7 bbs lh170\"><div class=\"fr pr4 tar\"><span id=\"task-filter\" class=\"dib fs90 vam pl4\"></span></div><div id=\"task-cols\" class=\"dib vat pl8 nw xgray pt1\"></div></div><section id=\"task-list\" class=\"panelheight-64 xgray lh170\"></section></div></div><div id=\"status-proxy\" class=\"hide\"></div></div>","Arrows": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-0, -0)\">\n    <path d=\"M1.5,4.5 L15.5,4.5 M12.5,7.5 L15.5,4.5 L12.5,1.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16.375\" height=\"8\" viewBox=\"0, 0, 16.375, 8\">\n  <g id=\"Layer_1\" transform=\"translate(0.375, -10)\">\n    <path d=\"M6.75,14.5 L15.5,14.5 M12.5,17.5 L15.5,14.5 L12.5,11.5 M1.125,11.687 L3,14.813 L3,17.5 C3,17.5 5,17.5 5,17.5 C5,17.5 5,14.813 5,14.813 L6.875,11.687 L1.125,11.687 z\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-0, -20)\">\n    <path d=\"M4.5,21.5 L5.5,21.5 L5.5,27.5 L4.5,27.5 M2.5,21.5 L1.5,21.5 L1.5,27.5 L2.5,27.5 M15.5,24.5 L7,24.5 M12.5,27.5 L15.5,24.5 L12.5,21.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-16, -0)\">\n    <path d=\"M31.5,4.5 L17.5,4.5 M20.5,1.5 L17.5,4.5 L20.5,7.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16.375\" height=\"8\" viewBox=\"0, 0, 16.375, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-16, -10)\">\n    <path d=\"M26.25,14.5 L17.5,14.5 M20.5,17.5 L17.5,14.5 L20.5,11.5 M31.875,11.687 L30,14.813 L30,17.5 C30,17.5 28,17.5 28,17.5 C28,17.5 28,14.813 28,14.813 L26.125,11.687 L31.875,11.687 z\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-16, -20)\">\n    <path d=\"M28.5,27.5 L27.5,27.5 L27.5,21.5 L28.5,21.5 M30.5,27.5 L31.5,27.5 L31.5,21.5 L30.5,21.5 M17.5,24.5 L26,24.5 M20.5,21.5 L17.5,24.5 L20.5,27.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>","BatchInfo": "function _batch_info(list,delay,cols) {\n  var that = this,\n      result = [],\n      cols = cols || that.Pho('Cfg').listCols || [],\n      rInfo = cols.indexOf('info')>-1,\n      rSec = cols.indexOf('security')>-1,\n      ctr = list.length;\n\n  list.forEach(function(s, i){\n    var dbname = s;\n    if (that.Batch[dbname]) return result[i] = that.Batch[dbname];\n    result[i] = Q.delay(1+delay*i).then(_readInfo.fill(dbname));\n  });\n\n  return result;\n\n  // - - - - - - -\n\n  function _readInfo(dbname){\n\n    var pis = [];\n\n    if (rInfo || rSec) {\n      pis.push(\n        that.Req({url:[dbname]})\n        .then(\n          function(res){\n            if (!that.All[dbname]) return;\n            $.extend(that.All[dbname], res, {stamp:Date.now()});\n            // (re)read security if requested and DB was updated\n            if (rSec && that.All[dbname].security.seq < parseInt(that.All[dbname].update_seq)) {\n              return _readSec(dbname);\n            }\n          },\n          function(code){\n            if (code==404 && that.All[dbname]) delete that.All[dbname];\n            else $.extend (that.All[dbname], that.Pho('dbType'), {stamp:Date.now()});\n          }\n        )\n      );\n    }\n\n    if (pis.length) {\n      return Q.allSettled(pis)\n      .then(function(){\n        ctr -= 1;\n        !ctr?that.RelistNow():that.Relist();\n        delete that.Batch[dbname];\n      });\n    }\n    else return $.Deferred().resolve();\n\n  }\n\n  // - - - - - - - \n\n  function _readSec(dbname){\n    return that.Req({url:[dbname,'_security']})\n    .then(function(res0){\n      if (!that.All[dbname]) return;\n      var res = $.extend(true, {\n        stamp: Date.now(),\n        seq:parseInt(that.All[dbname].update_seq),\n        admins:{names:[],roles:[]},\n        members:{names:[],roles:[]}\n      }, res0);\n\n      if (dbname[0] == '_') res.members.roles.push('_admin');\n\n      var protected = '';\n      if (res.members.roles.length + res.members.names.length == 0) {\n        if (res.admins.roles.length + res.admins.names.length != 0) protected = 'pl10 pr10 orange1 fi-unlock';\n        else protected = 'pl10 pr10 red fi-unlock';\n      } else {\n        protected = 'pl10 pr10 gray3 fi-lock';\n      }\n\n      $.extend(that.All[dbname], {security:res, protected:protected}, {stamp:Date.now()});\n    });\n  }\n}","GetTasks": "function _get_tasks(redraw) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tall = that.All,\n\t\t\tl = that.lang,\n\t\t\tes = function(s0){\n       \tvar s = /^http[s]?\\:\\/\\//.test(s0)?_stripPwd(s0):s0; \n        return (s+'').escapeHTML();\n      },\n\t\t\t_trunc = function (s, chars) {\n        var  ln = chars || 20;\n        if (!/\\//.test(s)) return es((s+'').truncate(ln,'middle','…'));\n        var a = s.split('/');\n        if (a[0].length > ln*0.6) {\n        \treturn es((a[0]).truncate(ln*0.6|0,'middle','…')) +'/'+es(a.slice(1).join('/'));\n        } else {\n        \treturn es((s+'').truncate(ln,'middle','…'));\n        }\n      },\n\t\t\tspt = '<span title=\"{2}\">{1}</span>',\n      nw = '<nobr>{1}</nobr>',\n\t\t\tpi = $.Deferred(),\n      Ar = that.Arrows;\n\t\n\tif (\n    !that.my.indom() \n    || that.my.root().hasClass('hide')\n    || !!window.document.hidden\n  ) return pi.resolve().promise();\n\t\n  // if unauthorized, clear tasks\n\tif (!cw.me('name')) {\n\t\tthat.Tasks = [];\n\t\t_endUp.debounce(1)();\n\t\treturn pi.promise();\n\t}\n\t\n\tif (that.TaskLoopInterval != that.Pho('Cfg').loopActiveTasks) {\n\t\t// restart poll\n\t\tthat.RestartPoll.debounce(1)();\n\t\treturn pi.resolve().promise();\n\t}\n\t\n\tthat.Req({url:['_active_tasks']})\n\t.then(function(res0){\n\t\t//that.Tasks.length = 0;\n\t\t\n    // for debug\n\t\tvar res = res0.concat(that.TaskMock||[]);\n\t\t\n\t\t// preprocess tasks \n\t\tres.forEach(_processTask);\n\t\t\n\t\t// sort, make old appear at bottom,\n\t\t// and push to this.Tasks\n\t\tres.sortBy('started_on', true)\n    .forEach(function(row){\n      row._new = true;\n      if (row.doc_id) {\n        row._selected = d.task.selection.indexOf(row.replication_id) > -1;\n      \tvar i = that.Tasks.findIndex(function(e){return e.doc_id == row.doc_id});\n        if (i > -1) {\n          if (that.Tasks[i].filter) row.filter = that.Tasks[i].filter;\n          that.Tasks[i] = row;\n        }\n        else that.Tasks.push(row);\n      }\n      else if (row.replication_id) {\n        row._selected = d.task.selection.indexOf(row.replication_id) > -1;\n        var i = that.Tasks.findIndex(function(e){return e.replication_id == row.replication_id});\n        if (i > -1) {\n          if (that.Tasks[i].filter) row.filter = that.Tasks[i].filter;\n          that.Tasks[i] = row;\n        }\n        else that.Tasks.push(row);\n      }\n      else if (row.pid) {\n      \tvar i = that.Tasks.findIndex(function(e){return e.pid == row.pid});\n        if (i > -1) {\n          if (that.Tasks[i].filter) row.filter = that.Tasks[i].filter;\n          that.Tasks[i] = row;\n        }\n        else that.Tasks.push(row);\n      }\n    });\n    \n    // remove old rows\n    that.Tasks.remove(function(t){return !t._new && t.pid!='Error' && t.pid!='Done'});\n    that.Tasks.forEach(function(t){t._new = false;})\n\t\t\n\t})\n\t.then(function(){\n\t\tif (!that.Pho('Cfg').tasksReadReplicator || d.task.filter.indexOf('compaction')>-1) return _endUp();\n\t\t\n\t\t// Read _replicator DB or its substitute.\n    // If it‘s the first read, fetch _all_docs,\n    // otherwise use _changes feed for speed up\n    var req,\n        rdb = that.Pho('ReplicatorDB');\n    \n    if (d.task.seq) req = that.Req({\n      url:[rdb, '_changes', {include_docs:true, since: d.task.seq}],\n      dataType:'json'\n    });\n    else req = that.Req({\n      url:[rdb, '_all_docs', {include_docs:true, update_seq:true}],\n      dataType:'json'\n    });\n\t\t\n    req.then(function(res){\n\t\t\t// Save last seq\n      d.task.seq = res.last_seq || res.update_seq;\n      // Process sync docs\n\t\t\t(res.rows || res.results).forEach(function(row){\n        // Del doc from tasks\n        if (row.doc._deleted) {\n          that.Tasks.remove(function(t){return t.doc_id == row.doc._id});\n        \treturn;\n        }\n        // Add/update task\n        var state = row.doc._replication_state;\n        if (state == 'error') {\n          that.Tasks.remove(function(t){return t.doc_id == row.doc._id});\n          that.Tasks.push(_mimicTaskErr(row.doc));\n        }\n        if (state == 'completed') {\n          that.Tasks.remove(function(t){return t.doc_id == row.doc._id});\n          if (!row.doc._replication_id) row.doc._replication_id = cw.lib.sdbm(row.doc._id);\n          that.Tasks.push(_mimicTaskDone(row.doc));\n        }\n        else if (\n          state != 'completed' && \n          (Object.isString(row.doc.filter) || Object.isArray(row.doc.doc_ids))\n        ) {\n          var task = that.Tasks.find(function(e){return e.doc_id == row.doc._id});\n          if (task) task.filter = row.doc.filter || row.doc.doc_ids;\n        }\n\t\t\t});\n\t\t\t//_endUp();\n\t\t})\n\t\t.always(function(){\n\t\t\t_endUp();\n\t\t})\n\t})\n\t.fail(function(code, err, msg){\n\t\tif (code > 400 && code < 600 && !cw.me('name')) {\n\t\t\tthat.Tasks = [];\n\t\t\t_endUp();\n\t\t}\n\t\telse {\n\t\t\t// Swallow fail, we might be just offline\n\t\t\tconsole.log(code, err, msg)\n\t\t\t_endUp();\n\t\t}\n\t});\n\t\n\treturn pi.promise();\n\t\n\t// - - - - - - -\n\t\n\tfunction _mimicTaskErr(x) {\n\t\t\n\t\tvar dt = Date.create(x._replication_state_time).valueOf()/1000|0;\n\t\t\n\t\tvar t = {\n\t\t\tpid: 'Error',\n\t\t\tcontinuous: \t\t\tx.continuous,\n      replication_id:\t\tx._replication_id,\n      _selected: \t\t\t\td.task.selection.indexOf(x._replication_id) > -1,\n\t\t\tdoc_id: \t\t\t\t\tx._id,\n\t\t\tprogress: \t\t\t\t0,\n\t\t\tsource: \t\t\t\t\tx.source,\n      filter:\t\t\t\t\t\tx.filter || x.doc_ids || null,\n\t\t\ttarget: \t\t\t\t\tx.target,\n\t\t\tstarted_on: \t\t\tdt,\n\t\t\tupdated_on:\t\t\t\tdt,\n\t\t\ttype: \t\t\t\t\t\t'replication'\n\t\t}\n\t\t\n\t\treturn t; //_processTask(t);\n\t\n\t}\n  \n  // - - - - - - -\n\t\n\tfunction _mimicTaskDone(x) {\n\t\t\n\t\tvar dt = Date.create(x._replication_state_time).valueOf()/1000|0;\n\t\t\n\t\tvar t = {\n\t\t\tpid: \t\t\t\t\t\t'Done',\n\t\t\tcontinuous: \t\tx.continuous,\n      replication_id:\tx._replication_id,\n      _selected: \t\t\td.task.selection.indexOf(x._replication_id) > -1,\n\t\t\tdoc_id: \t\t\t\tx._id,\n\t\t\tprogress: \t\t\t100,\n\t\t\tsource: \t\t\t\tx.source,\n      filter:\t\t\t\t\tx.filter || x.doc_ids || null,\n\t\t\ttarget: \t\t\t\tx.target,\n\t\t\tstarted_on: \t\tdt,\n\t\t\tupdated_on:\t\t\tdt,\n\t\t\ttype: \t\t\t\t\t\"replication\"\n\t\t}\n\t\t\n\t\treturn t; //_processTask(t);\n\t\n\t}\n\t\n\t// - - - - - - - \n\t\n\tfunction _processTask(row){\n\n\t\t// clean task type\n\t\tvar ts = row.type.replace(/_/g,' ')\n\t\t.replace(/database/gi,'DB')\n\t\t.replace(/compaction/gi,'compact')\n\t\t.replace(/replication/gi,'');\n\t\tts = ts.compact();\n\t\tts = ts?ts+':':'';\n\t\trow._type = es(ts.to(1).toUpperCase()+(ts||'').from(1));\n\t\t\n    var arrow = '<div class=\"tarrow\">{1}</div>',\n        sfm \t= '<span class=\"fs80 o40 dib vat mt1 mb-1 fi-filter\"></span>',\n\t\t\t\tterr \t= '<span class=\"red1 fs95\">{1}</span>',\n        tdone = '<span class=\"green1 fs95\">{1}</span>';\n\n\t\t// full text index\n\t\trow._index = JSON.stringify(\n      Object.reject(row,['_index','_selected'])\n    )\n    .toLowerCase()\n    .replace(/[\",\\{\\}\\[\\]]/g,' ')\n    .compact()\n    .stripTags();\n\n\t\t// clean pid\n\t\t \n\t\tif (row.pid == 'Error') {\n\t\t\trow._pid = terr.assign('<span class=\"fi-alert red1 fs95\"></span> Error');\n\t\t\trow._pidsafe = 'Error';\n\t\t\tarrow = terr.assign(arrow);\n\t\t}\n    else if (row.pid == 'Done') {\n      row._pid = tdone.assign('<span class=\"fi-check green1 fs95\"></span> Done');\n\t\t\trow._pidsafe = 'Done';\n\t\t\tarrow = tdone.assign(arrow);\n    }\n    else {\n\t\t\trow._pid = '‹<span class=\"fs95\">'+row.pid.replace(/[<>]/g,'')+'</span>›';\n\t\t\trow._pidsafe = es(row.pid);\n\t\t}\n    \n    // detect filter type\n    if (row.filter && Object.isArray(row.filter)) row.docs = true;\n\n\t\t// task start time\n\t\tvar stamp = row.started_on;\n\t\tif (stamp) {\n\t\t\tvar dt = Date.create(+stamp*1000);\n\t\t\tif (!dt.isThisYear()) row._start = dt.format('{d} {Mon} {yyyy}');\n\t\t\telse if (!dt.isToday()) row._start = dt.format('{d} {Mon}, {H}:{mm}');\n\t\t\telse row._start = dt.format('{H}:{mm}:{ss}');\n\t\t}\n\t\telse row._start = '???';\n\n\t\t// progress %\n    \n    if (row.pid == 'Error') {\n\t\t\trow._progress = '';\n\t\t}\n    else if (row.pid == 'Done') {\n      row._progress = '100%';\n    }\n    else {\n\t\t\trow._progress = Object.isNumber(row.progress)?(row.progress.clamp(0,100)|0)+'%':'???';\n\t\t}\n\n\t\t// description\n\t\tif (row.source && row.target) {\n      \n      var p1 = _ord(row.source),\n          p2 = _ord(row.target);\n\n      if (/\\//.test(p1) && !/\\//.test(p2)) {\n        row._left = (row.pid=='Done'?'4-':row.pid=='Error'?'1-':row.doc_id?'2-':'3-')+p2+'2-'+p1;\n        row._desc = nw.assign(_trim(row.target, 30)) \n        + arrow.assign(row.docs?Ar[5]:row.filter?Ar[4]:Ar[3])\n        + nw.assign(_trim(row.source, 30));\n      }\n      else {\n        row._left = (row.pid=='Done'?'4-':row.pid=='Error'?'1-':row.doc_id?'2-':'3-')+p1+'1-'+p2;\n      \trow._desc = nw.assign(_trim(row.source, 30)) \n        + arrow.assign(row.docs?Ar[2]:row.filter?Ar[1]:Ar[0])\n        + nw.assign(_trim(row.target, 30));\n      }\n\t\t\tif (row.doc_id) row._desc = '<a class=\"tdn\" href=\"#_replicator/'+es(row.doc_id)+'\">'+row._desc+'</a>';\n\t\t}\n\t\telse if (/compaction/.test(row.type)) {\n\t\t\trow._desc = nw.assign(_trim(row.database));\n\t\t}\n\t\telse row._desc = row._pid;\n\n\t\treturn row;\n\t}\n\t\n\t// - - - - - - - \n\t\n\tfunction _endUp() {\n\t\t// sort, make old appear at bottom,\n\t\t// and push to this.Tasks\n\n    var a = that.Tasks.slice(0);\n\t\tthat.Tasks.length = 0;\n    \n    a.map(function(row){return _processTask(row);})\n    .sortBy('_left')\n\t\t.forEach(function(row){that.Tasks.push(row)});\n        \n\t\tif (redraw) {\n\t\t\tthat.my.recalc('#task-list');\n\t\t\tthat.my.check('#task-cols');\n      that.my.check('#task-list');\n\t\t}\n    d.task.selection.length = 0;\n    that.Tasks.forEach(function(e){if (e._selected) d.task.selection.push(e.replication_id)});\n\t\tpi.resolve(that.Tasks);\n\t}\n\t\n\t\n\t// - - - - - - - \n\t\n\tfunction _trim(path, chars, filter){\n    \n    var p = [],\n        tico = '<span class=\"ml3 fs95 o40 dib vat mt1 mb-1 fi-{1}\"></span>';\n\t\t\n    if (!Object.isString(path) || !/^http[s]?:\\//.test(path)) {\n      p.push( spt.assign(_trunc(path+'', chars), es(path+'')) );\n    }\n    else {\n      var u = new URL(path),\n          tpath = _ord(path);\n      p.push(spt.assign(_trunc(tpath, chars), es(path)));\n\n      if (/\\//.test(tpath) && u.protocol!='https:') {\n        p.push(tico.assign('unlock red1'));\n      }\n      if (u.username || u.password) {\n        p.push(tico.assign('torso'));\n      }\n    }\n\t\tif (filter) p.push(tico.assign('filter'));\n\t\t\n\t\treturn p.join('');\n\t\t\n\t}\n  \n  // - - - - - - - - - - - - - - - -\n  \n  function _ord(s) {\n    if (!/^http[s]?:\\/\\/.+/.test(s)) return s;\n    var u = new URL(s), \n        local = u.hostname =='127.0.0.1' || u.hostname == 'localhost';\n    var tpath = !local?u.hostname+u.pathname.replace(/\\/$/,''):u.pathname.replace(/^\\/|\\/$/g,'');\n  \treturn tpath;\n  }\n  \n  // - - - - - - - - - - - - - - - -\n\n  function _stripPwd(s) {\n    return s.replace(/^(http[s]?\\:\\/\\/[^\\:@\\/]+:)[^@]+(@.+)$/, '$1•••••$2');\n  }\n}","RestartPoll": "function _restart_poll() {\n\tvar that = this;\n\t\n\tthat.TaskLoopInterval = that.Pho('Cfg').loopActiveTasks;\n\tif (that.TaskLoop){\n\t\tthat.TaskLoop.cancel();\n\t\tthat.GetTasks(true);\n\t}\n\tthat.TaskLoop = that.GetTasks.fill(true).every(that.TaskLoopInterval*1e3);\n\t\n}","RestartTasks": "function _restart_tasks(onlyStop) {\n  var that = this,\n      d = that.data,\n      l = that.lang,\n      pi = $.Deferred(),\n      sel = that.data.task.selection.slice(0),\n      rdb = that.Pho('ReplicatorDB'),\n      tasks = [],\n      del = []; \n  \n  var ids = that.Tasks.filter(function(e){\n    return sel.indexOf(e.replication_id)>-1 && e.doc_id;\n  }).map(function(e){return e.doc_id;});\n  \n  var cancels = that.Tasks.filter(function(e){\n    return sel.indexOf(e.replication_id)>-1 && !e.doc_id;\n  }).map(function(e){return {cancel:true, replication_id:e.replication_id}});\n\n  $.my.modal({\n    width:300,\n    manifest:that.Pho('Confirm'),\n    data:{\n      text:[\n        '<div class=\"fs130 '+(onlyStop?'red':'orange')+' mb5\">'\n        +l[onlyStop?'TXT_TASK_STOP_TITLE':'TXT_TASK_RESYNC_TITLE']+'</div>',\n        l[onlyStop?'TXT_TASK_STOP_WARN':'TXT_TASK_RESYNC_WARN'](ids.length, cancels.length, rdb)\n      ].join(''),\n      yescss:onlyStop?'red':'orange',\n      yes:l.BTN_TASK_PROCEED,\n      no:l.BTN_CANCEL,\n      cancel:''\n    },\n    css:'lh160 xgray p20 pb25',\n    esc:true,\n    enter:false\n  })\n  .then(function(res){\n    if (res.cmd!='yes') return pi.reject(999, 'Cancelled', 'Cancelled');\n    _restart();\n  })\n  .fail(function(){\n  \tpi.reject(999, 'Cancelled', 'Cancelled');\n  });\n\n  return pi.promise();\n\n  // - - - - \n\n  function _restart(){\n    \n    var req;\n    \n    if (ids.length) {\n      req = that.Req({\n        url:\t\t\t\t\t[rdb,'_all_docs', {include_docs:true, attachments:true}],\n        method:\t\t\t\t'POST',\n        contentType:\t'application/json',\n        //headers:{'Content-type':'application/json'},\n        data: \t\t\t\tJSON.stringify({keys:ids})\n      })\n      .then(function(res){\n        res.rows.forEach(function(row){\n          var doc = row.doc;\n          del.push({_id:doc._id, _rev:doc._rev, _deleted:true});\n          var doc1 = {_id:doc._id};\n          if (doc._attachments) doc1._attachments=doc._attachments;\n          $.extend(doc1, Object.reject(doc, /^_/));\n          tasks.push(doc1);\n        });\n      })\n      .then(function(){\n        return that.Req({\n          url:\t\t\t\t[rdb,'_bulk_docs'],\n          method:\t\t\t'POST',\n          dataType:\t\t'json',\n          contentType:'application/json',\n          headers:\t\t{'X-Couch-Full-Commit':'true'},\n          data: \t\t\tJSON.stringify({docs:del})\n        });\n      })\n      .then(function(res){\n        if (onlyStop) return res;\n        cw.lib.note(that.lang.MSG_TASK_RESYNC);\n        var p = $.Deferred();\n        // inserting revs\n        //var revs = {};\n        //res.forEach(function(e){if (e.ok) revs[e.id] = e.rev;});\n        //tasks.forEach(function(e){if (revs[e._id]) e._rev = revs[e._id];});\n\n        (function(){\n          that.Req({\n            url:\t\t\t\t[rdb,'_bulk_docs'],\n            method:\t\t\t'POST',\n            contentType:'application/json',\n            headers:\t\t{'X-Couch-Full-Commit':'true'},\n            data: \t\t\tJSON.stringify({docs:tasks})\n          })\n          .then(function(a){p.resolve(a);})\n          .fail(function(a,b,c){p.reject(a,b,c);});\n        }).debounce(1000)();\n\n        return p.promise();\n      });\n    }\n    \n    if (cancels.length) {\n      (ids.length?req.then:(function(a){req = a();}))(function(){\n\t\t\t\t// emit tasks cancellations\n        var p = $.Deferred(),\n            reqs = cancels.map(function(e){\n            \treturn that.Req({\n                url:\t\t\t\t['_replicate'],\n                method:\t\t\t'POST',\n                dataType:\t\t'json',\n                contentType:'application/json',\n                //headers:{'Content-type':'application/json'},\n                data: \t\t\tJSON.stringify(e)\n              });\n            });\n        Q.allSettled(reqs).then(\n          function(result){p.resolve();},\n          function(){p.resolve();}\n        );\n        return p.promise();\n      });\n    }\n    \n    // Finalize\n    \n    req.then(function(){\n      cw.lib.note(l[onlyStop?'MSG_TASK_STOP':'MSG_TASK_RESYNC_OK'], 'ok');\n      $.my.radio('dblist', [rdb]);\n      pi.resolve(tasks);\n    })\n    .fail(function(code, err, msg){\n      // fail to read doc back\n      cw.lib.note(l[onlyStop?'ERR_TASK_STOP':'ERR_TASK_RESYNC'].assign(code+': '+err), 'error');\n      console.log(code, err, msg);\n      pi.reject(code, err, msg);\n    });\n  }\n}","TTask": "function (e) {\n\t// renders tasklist row from pre-processed data\n\tvar that = this,\n\t\t\td = that.data;\n  \n  var s = '<div class=\"w25 dib vat ml-25 pl5\">{1}</div>';\n  \n  /*if (e.pid == 'Error' && e.doc_id){\n  \ts = s.assign('<input type=\"checkbox\" name=\"task-selection\" class=\"cp\" value=\"doc {doc_id}\" '+(e._selected?'checked>':'>'));\n  }\n  else*/ \n  if (e.pid == 'Error' && !e.doc_id) {\n  \ts = s.assign('&nbsp;');\n  }\n  else if (e.replication_id) {\n  \ts = s.assign('<input type=\"checkbox\" name=\"task-selection\" class=\"cp\" value=\"{replication_id}\" '+(e._selected?'checked>':'>'));\n  }\n  else s = s.assign('&nbsp;');\n\t\n\tvar t = [\n\t\t'<div class=\"view-row pl25 pr8\">',\n    s,\n\t\t'<div class=\"dib w20p ell fs95 gray vat\" title=\"{_pidsafe}\">{_pid}</div>',\n\t\t\t'<div class=\"dib w70p ell pr10 vat lh140 pt2 pb2\">{_type} {_desc}</div>',\n\t\t\t'<div class=\"dib w10p vat tar\">{_progress}</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\treturn t.assign(e);\n\t\n}"},"$log": {"lang": {},"data": {"src": "couch","search": "","size": "10","offset": "0","lines": ""},"Prev": [],"hash": "function () { return 'log'; }","title": "function () { return 'Logs'; }","init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t$.extend(d, that.Pho('Ls')('Logs') || {});\n\t\tthat.Prev = [d.size,d.offset];\n\t\treturn that.Get(false, true)\n\t\t.then(function(res){\n\t\t\t$o.html(that.HTML.assign(that.lang));\n\t\t\t$o.find('#report').niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4\n\t\t\t});\n\t\t});\n\t}","ui": {"#lsize": {"bind": "function (d,v) {\n\t\t\tif (v!=null) {\n\t\t\t\td.size = (isNaN(v) || !v) ? '10': ((+v | 0).clamp(1,500)+'');\n\t\t\t\tthis.my.find('#loffset').attr('step', d.size);\n\t\t\t}\n\t\t\treturn d.size;\n\t\t}"},"#loffset": "offset","#log-search": {"delay": 150,"bind": "search","css": {"my-search": "new RegExp(/^.{2,}$/)"}},"#log-proxy": {"delay": 300,"bind": "function (d,v) {\n\t\t\tvar that = this;\n\t\t\tif ([d.size,d.offset]+'' != that.Prev+'') {\n\t\t\t\tthat.Get().then(function(){\n\t\t\t\t\tthat.my.recalc('#logs');\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Prev = [d.size,d.offset];\n\t\t\t\t\tthat.Pho('Ls')('Logs', {size:d.size});\n\t\t\t\t})\n\t\t\t}\n\t\t}","watch": ["#lsize","#loffset"]},"#logs": {"bind": "function (d,v) {\n\t\t\tvar that = this,\n\t\t\t\t\tre;\n\t\t\tif (d.search.length>1) {\n\t\t\t\tre = new RegExp('('+RegExp.escape(d.search)+')', 'i');\n\t\t\t\treturn d.lines.lines()\n\t\t\t\t.reduce(function(acc, s){\n\t\t\t\t\tif (s[0]!='[' && acc.length) {\n\t\t\t\t\t\tacc[acc.length - 1] += '\\n'+s;\n\t\t\t\t\t}\n\t\t\t\t\telse acc.push(s);\n\t\t\t\t\treturn acc;\n\t\t\t\t},[])\n\t\t\t\t.filter(function(s){\n\t\t\t\t\treturn re.test(s);\n\t\t\t\t})\n\t\t\t\t.map(function(s){\n\t\t\t\t\treturn s.replace(re, '\\ufff1$1\\ufff0')\n\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t.replace('\\ufff1','<span class=\"log-found\">')\n\t\t\t\t\t.replace('\\ufff0','</span>');\n\t\t\t\t})\n\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn d.lines.escapeHTML();\n\t\t}","watch": ["#log-search"]},"#btn-reload": "function (d,v) {\n\t\tif (v==null) return;\n\t\tvar that = this;\n\t\tthat.Get().then(function(){\n\t\t\tthat.my.recalc('#logs');\n\t\t});\n\t}","#btn-log-minus": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      d.offset = ((+d.offset) - (+d.size)).clamp(0,1e10)+'';\n    }","css": {":disabled": "function (d) {return !(+d.offset);}"},"watch": "#loffset","recalc": "#loffset"},"#btn-log-plus": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      d.offset = ((+d.offset) + (+d.size)).clamp(0,1e10)+'';\n    }","watch": "#loffset","recalc": "#loffset"}},"die": "function ($o) {\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#report').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t}","HTML": "<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\"><div class=\"fr w150 fs95\"><div class=\"fi-magnifying-glass xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div><input type=\"text\" id=\"log-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\"><span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span></div><div class=\"nw dib vat\"><button id=\"btn-reload\" class=\"w40 mr8 vat\" title=\"{PLC_RELOAD}\"><span class=\"fi-loop\"></span></button><span class=\"bolder fs150 lh130 xgray mr30 dib vat\">{TXT_TITLE}</span> <div class=\"dib vat\"><span>{TXT_SIZE}</span> <input id=\"lsize\" type=\"number\" class=\"w70\" min=\"1\" max=\"500\" step=\"1\"> <span>{TXT_KB}, {TXT_OFFSET}</span> <input id=\"loffset\" type=\"number\" class=\"w100\" min=\"0\" max=\"1000000\" step=\"10\"> <span>{TXT_KB}</span> </div><span class=\"buttons ml10\"><button id=\"btn-log-minus\" class=\"w40 mr2 pl0 pr0\"><span class=\"fi-arrow-left o80\"></span></button><button id=\"btn-log-plus\" class=\"w40 mr2 pl0 pr0\"><span class=\"fi-arrow-right o80\"></span></button></span></div></div><div class=\"panelheight-4 feather mt4\"><div id=\"report\" class=\"pl20 pr20 panelheight-4 pre\"><div id=\"logs\" class=\"fs90 lh140 pb12 pt8\"></div></div></div><div id=\"log-proxy\" class=\"hide\"></div>","style": {" pre": "white-space: pre-wrap;"," .log-found": "background-color:rgba(255,232,121,0.94);border-radius:2px;"},"Get": "function () {\n\tvar that = this,\n\t\t\tbytes = that.data.size*1024,\n\t\t\toffset = (that.data.offset || 0) * 1024;\n\t\n\tvar url = ['_log',{bytes:bytes},offset?{offset:offset}:null].compact();\n\t\n\treturn that.Req({\n\t\turl:url,\n\t\tdataType:'text'\n\t})\n\t.then(function(res){\n\t\tthat.data.lines = res;\n\t})\n}"},"Req": "function _Req(opts0,onlyURL) {\n\n\tvar isS = Object.isString,\n\t\t\tisO = Object.isObject,\n\t\t\tisA = Object.isArray,\n\t\t\tisIE = this.isIE;\n\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tcfg = that.Cfg,\n\t\t\tl = that.lang,\n\t\t\tpi = $.Deferred();\n\n\tvar opts = $.extend(\n\t\ttrue, \n\t\t{\n\t\t\tmethod:'GET',\n\t\t\tdataType:'json',\n\t\t\theaders:{ Accept:'application/json' },\n\t\t\tcache: !isIE\n\t\t},\n\t\tisO(opts0)?opts0:isA(opts0)?{url:opts0}:{url:opts0+''}\n\t);\n\n\tvar url = a2url(opts.url, that.Base);\n\t\n\tif (onlyURL) return url;\n\n\tif (!url) E(400, l.ERR_REQ_INVALIDCALL);\n\t\n\topts.url = url;\n\t\n\t$.ajax(opts)\n\t.then(function(res){\n\t\tpi.resolve(res);\n\t})\n\t.fail(function(res, b){\n\t\tvar data;\n\t\ttry {data = JSON.parse(res.responseText);} catch(e){}\n\t\tif (!Object.isObject(data)) data = {};\n\t\tdata.ok = false;\n\t\tvar code = res.status,\n\t\t\t\tmsg = data.reason || data.message || '';\n\t\t\n\t\tE(code, msg, data);\n\t\t\n\t\tif (that._compiled && cw.me('name') && (code == 401 || code == 403)) session();\n\t\t\n\t});\n\n\treturn pi.promise();\n\n\t// - - - - - - -\n\n\tfunction E(code0, msg0, data) {\n\t\tvar code = !isNaN(code0)?(+code0):500,\n\t\t\t\tmsg = (isNaN(code0) && !msg0)?code0:msg0;\n\t\tif (!msg) {\n\t\t\tmsg = l.ERR_REQ[code] || l.ERR_REQ[999];\n\t\t}\n\t\tmsg+='';\n\t\tpi.reject(code, msg, data);\n\t}\n\t\n\t// - - - - - - -\n\t\n\tfunction session(){\n\t\t// re-reads user session on 401 and 403\n\t\t$.ajax({\n\t\t\turl:that.Base.replace(/\\/+$/,'')+'/_session',\n\t\t\tmethod:'get', \n\t\t\tdataType:'json',\n\t\t\theaders:{Accept:'application/json'},\n\t\t\tcache:!isIE \n\t\t})\n\t\t.then(function(res){\n\t\t\tif (Object.isObject(res) && res.userCtx) {\n\t\t\t\tvar u = res.userCtx,\n\t\t\t\t\t\tme = {name:u.name || '', roles:u.roles || []};\n\t\t\t\tif (!u.name) {\n\t\t\t\t\tif (that.Pho('_compiled') && window.DDOC) $.extend(window.DDOC._me, me);\n\t\t\t\t\t$.my.radio('userCtx',me);\n\t\t\t\t\t// that.Pho('my').check('#btn-aside-auth');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t// - - - - - - - \n\n\tfunction a2url(a, base0) {\n\t\tvar p = [],\n\t\t\t\tq = {},\n\t\t\t\tqa = [],\n\t\t\t\turl = '',\n\t\t\t\tbase = base0?(base0+'').replace(/\\/+$/,'')+'/':'',\n\t\t\t\ttostr = {startkey:1,endkey:1,start_key:1,end_key:1,key:1},\n\t\t\t\treddoc = /^_design\\//;\n\n\t\tif (typeof a == 'string') {\n\t\t\turl = !/^http[s]?:/.test(a)?base+a.replace(/^\\/+/,''):a;\n\t\t}\n\t\telse if (Object.isArray(a)) {\n\t\t\ta.forEach(function(e, i){\n\t\t\t\tif(''===e || null==e) return;\n\t\t\t\tif (Object.isObject(e)) $.extend(true, q, e);\n\t\t\t\telse if (reddoc.test(e+'')) {\n          var parts = (e+'').split('/');\n          p.add([parts[0], parts.from(1).join('/')]);\n          //console.log(p, parts, e)\n        }\n\t\t\t\telse p.push(encodeURIComponent(e+''));\n\t\t\t});\n\n\t\t\tqa = Object.keys(q).map(function(key){\n\t\t\t\tvar v = q[key];\n\t\t\t\tif (tostr[key] || typeof v != 'string') v = JSON.stringify(v);\n\t\t\t\treturn encodeURIComponent(key)+'='+encodeURIComponent(v);\n\t\t\t});\n\t\t\t\n\t\t\turl = base+p.join('/')+(qa.length?'?'+qa.join('&'):'');\n\t\t}\n\n\t\treturn url;\n\t}\n}","PokeBucket": "function (bucket) {\n  var that = this;\n\treturn that.Req([bucket]);\n}","GetList": "function _GetDBList() {\n\t\n\t// Returns promise resolved with prefilled that.All{}\n\t\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\trname = '';\n\t\n\tvar pis = [\n\t\t\n\t\t// read DB list\n\t\tthat.Req(['_all_dbs'])\n\t\t.then(function(list){\n\t\t\tvar prev = Object.keys(that.All),\n\t\t\t\t\tcurr = list.slice(0);\n\n\t\t\t// Delete non existent\n\t\t\tprev.subtract(curr).forEach(function(i){ delete that.All[i]; });\n\n\t\t\tcurr.forEach(function(dbname){\n\t\t\t\t// construct db objs\n\t\t\t\tvar db = $.extend(true, {\n\t\t\t\t\tname:dbname,\n\t\t\t\t\tnamesafe:dbname.escapeHTML(),\n\t\t\t\t\thref:encodeURIComponent(dbname)\n\t\t\t\t}, that.dbType);\n\t\t\t\t// store\n\t\t\t\tthat.All[dbname] = $.extend( \n          true, \n          db, \n          that.All[dbname] || {}, \n          {stamp:Date.now()} \n        );\n\t\t\t});\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\tpi.reject(code, err, msg);\n\t\t})\n  ];\n  \n  if (!that.ReplicatorDB)  {\n  \t// read replicator DB name\n\t\tpis.push(that.Req(['_config', 'replicator', 'db'])\n\t\t.then (function(rnewname){\n\t\t\tif (typeof rnewname == 'string') rname = rnewname;\n\t\t}));\n  }\n\t\n\tif (!that.Couch.version) {\n\t\tpis.push(\n\t\t\tthat.Req({url:[], dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\tif (!that.Couch.version) $.extend(that.Couch, res);\n\t\t\t})\n    );\n    \n    if (that.Pho('_compiled') && !window.DDOC._db) pis.push(\n      that.Req({url:['_dbroot'], dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\t$.extend(that.Couch, res);\n\t\t\t})\n      .fail(function(){\n      \tconsole.log('This 400 is normal');\n      })\n\t\t);\n\t}\n\t\n\tQ.allSettled(pis)\n\t.then(function(){\n\t\tif (that.All[rname]) that.ReplicatorDB = rname;\n    else that.ReplicatorDB = that.ReplicatorDB || '_replicator';\n\t\tpi.resolve(that.All);\n\t});\n\t\n\treturn pi.promise();\n}","GetUsers": "function _GetUsersList() {\n  // returns promise resolved with \n  // [uname, uname1...]\n  var that = this,\n      pi = $.Deferred(),\n      req,\n      u = that.Users;\n\n  if (u._seq) req = that.Req({\n    url:['_users', '_changes', {since: u._seq}],\n    dataType:'json'\n  });\n  else req = that.Req({\n    url:['_users', '_all_docs', {update_seq:true}],\n    dataType:'json'\n  });\n  \n  req.then(function(res){\n    u._seq = res.last_seq || res.update_seq;\n    (res.rows || res.results || []).forEach(function(e){\n      if (e.id.to(17)=='org.couchdb.user:') {\n        var id = e.id.from(17);\n        if (e.deleted) delete u[id];\n        else u[id] = true;\n      }\n    });\n  })\n  .always(function(){\n  \tpi.resolve(Object.keys(u).sort().remove(/^_/));\n  });\n  \n  return pi.promise();\n}","Switch": "function _SwitchTab(path0,tabid) {\n\t\n\t// Switches tabs, called by flatiron on hash change\n\t// or internal router if env is CloudWall big\n\t\n\tcw.log('Photon tab switch attempt', path0, tabid||'')\n\t\n\tvar that = this,\n\t\t\t_redrawTabs = _redrawTabsSync,//.debounce(0),\n\t\t\td = that.data,\n\t\t\tcIdx = that.Tabs.findIndex(function(e){return e.active}) || 0,\n\t\t\tpath = (\n\t\t\t\tObject.isString(path0)\n\t\t\t\t? path0.replace(/^#/,'').split('/').compact(!0)\n\t\t\t\t: Object.isArray(path0)\n\t\t\t\t? path0.slice(0).compact(true)\n\t\t\t\t: []\n\t\t\t);\n\t\n\tif (path[1]=='_design') {path[2] = '_design/'+path[2]; path.removeAt(1);}\n\t\n\tvar spath = path.join('\\fffd'),\n\t\t\tswitcher = [],\n\t\t\tnewtab,\n\t\t\tisNew = false;\n\t\n\tthat.Tabs.forEach(function(t){\n\t\tif (t.path.join('\\fffd') == spath) switcher.push(t);\n\t});\n\tif (switcher.length > 1) {\n\t\tif (tabid) {\n\t\t\tswitcher[0] = switcher.find(function(tf){return tf.id == tabid}) || switcher[0];\n\t\t}\n\t}\n\tnewtab = switcher[0];\n\t\n\tif(newtab && newtab.active && newtab.run) return false;\n\t\n\t// Derive type\n\tvar type = 'error',\n\t\t\ttitle = 'Error',\n\t\t\tisDB = /^(_users|_replicator|_dbs|_nodes|_global_changes|[a-zA-Z0-9$\\(\\)\\+\\-][a-zA-Z0-9$\\(\\)\\+\\-\\/_\\.]*)$/.test(path[0]),\n\t\t\tappData,\n\t\t\tpl = path.length;\n\tif (!pl) {\n\t\ttitle = 'Photon';\n\t\ttype = 'dbs';\n\t}\n\telse if (pl == 1 && path[0]=='_config') {\n\t\ttitle = 'Config';\n\t\ttype  = 'config';\n\t}\n\telse if (pl == 1 && path[0]=='_about') {\n\t\ttitle = 'About';\n\t\ttype  = 'about';\n\t}\n\telse if (pl == 1 && path[0]=='_log') {\n\t\ttitle = 'Logs';\n\t\ttype  = 'log';\n\t}\n\telse if (isDB && path[1]=='_new') {\n\t\ttitle = 'New doc';\n\t\ttype  = 'doc';\n\t\tappData = {isNew:true};\n\t\tif (path[0]=='_users') appData.doc = {\n\t\t\t_id:'org.couchdb.user:_username_', type:'user', \n\t\t\tname:'_username_', password:'_password_', roles:[] \n\t\t};\n\t\telse if (path[0]==that.ReplicatorDB) appData.doc = {\n\t\t\t_id:'', source:'', target:'', create_target:false, continuous: false, \n\t\t\tdoc_ids:[], filter:'', user_ctx:{name:'',roles:[]}, query:{}\n\t\t};\n\t}\n\telse if (isDB &&  (pl == 1 || /^_(view|all_docs|find|index)$/.test(path[1]))) {\n\t\ttitle = path[0];\n\t\ttype = 'view';\n\t\tif (path[1] == '_all_docs') {\n\t\t\tif (pl!=4) path.length = 1;\n\t\t\telse {\n\t\t\t\tappData = {\n\t\t\t\t\tstart:path[2], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+path[5])) || '100'),\n\t\t\t\t\treverse:(path[3]+'')[0]=='-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    else if (path[1] == '_find') {\n\t\t\tif (pl>5) path.length = 5;\n\t\t\telse {\n\t\t\t\tappData = {\n\t\t\t\t\tstart:path[3], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+path[4])) || '100'),\n\t\t\t\t\treverse: (path[4]+'')[0] == '-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    else if (path[1] == '_index') {\n\t\t\tif (pl>6) path.length = 6;\n\t\t\telse {\n        var isDefault = (path[2] == 'Default index' && (pl == 3 || pl == 5));\n\t\t\t\tappData = {\n\t\t\t\t\tstart:isDefault?path[3]:path[4], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+(isDefault?path[4]:path[5]))) || '100'),\n\t\t\t\t\treverse: ((isDefault?path[4]:path[5])+'')[0] == '-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (path[1] == '_view') {\n\t\t\tif (pl!=6) path.length = 4;\n\t\t\telse {\n\t\t\t\tappData = {\n\t\t\t\t\tstart:path[4], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+path[5])) || '100'),\n\t\t\t\t\treverse:(path[5]+'')[0]=='-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse if (pl == 2 && isDB) {\n\t\ttitle = path[0].truncate(10,'right','…')+'\\u2009/\\u2009'+path[1];\n\t\ttype = 'doc';\n\t} \n\telse if (pl == 3 && path[1] == '_design') {\n\t\ttitle = path[0].truncate(10,'right','…')+'\\u2009/\\u2009'+'_d…'+path[2];\n\t\ttype = 'doc';\n\t}\n\telse if (pl == 3 && isDB) {\n\t\ttitle = path[0].truncate(10,'right','…')+'\\u2009/\\u2009'+path[1];\n\t\ttype = 'doc';\n\t\tappData={rev:path[2].replace(/^\\D+/,'')}\n\t}\n\t\n\tif (type=='error') appData = {error:'Unrecognized command'}\n\t\n\t\n\t// Switch off tabs\n\tthat.Tabs.forEach(function(t){\n\t\tif (t!==newtab) t.active = false;\n\t});\n\t\n\t// new tab not exists?\n\tif (!newtab) {\n\t\t\n\t\tif (that.Tabs.length >= that.Cfg.maxTabs && path.length) {\n\t\t\tcw.lib.note(that.lang.FAIL_TOO_MANY_TABS.assign(that.Cfg.maxTabs+''), 'error');\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tisNew = true;\n\t\tnewtab = {\n\t\t\tid:cw.lib.sdbm(Date.now()+path),\n\t\t\ttype:type,\n\t\t\thash0:'',hash1:'',\n\t\t\tactive:true,\n\t\t\tname:title,\n\t\t\tpath:path.slice(0),\n\t\t\terror:type=='error',\n\t\t\trun:false\n\t\t};\n\t\t// add tab to UI\n\t\tif (type!='dbs') that.Tabs.insert(newtab, cIdx + 1);\n\t\telse that.Tabs.unshift(newtab);\n\t}\n\t\n\tnewtab.active = true;\n\tthat.SetTitle(newtab.name);\n\tthat.my.restyle();\n\t_redrawTabs();\n\t\n\tvar app = _runApp(type, path, newtab.id, appData);\n\t\n\tif (app.then) {\n\t\tapp.then(function(){\n\t\t\tvar waschanged = false;\n\t\t\tnewtab.run = true;\n\t\t\t// we were able to start it\n\t\t\tcw.log('Photon tab of type ${1} started'.assign(type), path);\n\t\t\tnewtab.hash0 = newtab.hash1 = app.my('manifest').hash();\n\t\t\tnewtab.name = app.my('manifest').title();\n\t\t\tthat.SetTitle(newtab.name);\n\t\t\tif (that.History.last() != newtab.id) that.History.push(newtab.id);\n\t\t\t\n\t\t\t// Track app changes\n\t\t\tapp.on('change.my', function(){\n\t\t\t\tnewtab.hash1 = app.my('manifest').hash();\n\t\t\t\tvar name = app.my('manifest').title();\n\t\t\t\tif (newtab.hash0 != newtab.hash1 || name != newtab.name) {\n\t\t\t\t\tnewtab.name = name;\n\t\t\t\t\twaschanged = true;\n\t\t\t\t\t_redrawTabs();\n\t\t\t\t}\n\t\t\t\telse if (waschanged) {\n\t\t\t\t\t_redrawTabs();\n\t\t\t\t}\n\t\t\t\tif (newtab.active) that.SetTitle(newtab.name);\n        \n\t\t\t}.debounce(500));\n\t\t\t\n\t\t\t// Track hash reset\n\t\t\tapp.on('resettabhash.my', function(){\n\t\t\t\tnewtab.hash0 = newtab.hash1 = app.my('manifest').hash();\n\t\t\t\tnewtab.name = app.my('manifest').title();\n\t\t\t\t_redrawTabs();\n\t\t\t}.debounce(100));\n\t\t\t\n\t\t\t_redrawTabs();\n\t\t\t\n\t\t})\n\t\t.fail(function(a,b){\n\t\t\t// we could not start an app\n\t\t\tcw.lib.note(that.lang.FAIL_TAB_APP, 'error');\n\t\t\tthat.my.find('#l-apps>#app-'+tabid).remove();\n\t\t\tcw.log('Photon tab ${1} start fail'.assign(type), path, a);\n\t\t\tnewtab.error = true;\n\t\t\tconsole.log(a,b);\n\t\t\t// insert dummy\n\t\t\tnewtab.hash1 = newtab.hash0 = 'error';\n\t\t\t_runApp('error', path, newtab.id, {error:Object.isString(a)&& Object.isString(b)?a+' '+b:a});\n\t\t}.debounce(10));\n\t}\n\t\n\t\n\t// - - - - - - - -\n\t\n\tfunction _redrawTabsSync(){\n\t\tthat.my.recalc('#l-apptabs');\n    d.path = Object.clone(path, true);\n\t}\n\t\n\t// - - - - - - - -\n\t\n\tfunction _runApp(type, path, tabid, data) {\n\t\tvar man = that['$'+type],\n\t\t\t\t$app = that.my.find('#l-apps>#app-'+tabid),\n\t\t\t\t$appPromise;\n\t\t\n\t\tif (!$app.length || !$app.is('.my-form')) {\n\t\t\t\n\t\t\tif(!$app.length) {\n\t\t\t\t$app = $('<div class=\"l-app\" id=\"app-'+tabid+'\"></div>');\n\t\t\t\tthat.my.find('#l-apps').append($app);\n\t\t\t}\n\t\t\t\n\t\t\tthat.my.find('#l-apps>.l-app').addClass('hide');\n\t\t\t$app.removeClass('hide');\n\t\t\t$appPromise = $app.my(man, $.extend({path:path, tabid:tabid}, data || {}));\n\t\t}\n\t\telse {\n\t\t\tthat.my.find('#l-apps>.l-app').each(function(){\n\t\t\t\tvar $t = $(this);\n\t\t\t\tif ($t.is($app)) $t.removeClass('hide');\n\t\t\t\telse $t.addClass('hide');\n\t\t\t});\n\t\t}\n\n\t\treturn $appPromise || $app;\n\t}\n\t\n}","Close": "function _CloseTab(opts) {\n\t\n\t// 'closetab' event handler, \n\t// bound on app DOM root during app .init()\n\t\n\tvar that = this;\n\t\n\tvar tabid,\n\t\t\tenforce = false,\n      silent = false;\n\t\n\tif (Object.isObject(opts)) {\n\t\ttabid = opts.tabid || '';\n\t\tenforce = opts.enforce || false;\n    silent = opts.silent || false;\n\t}\n\telse tabid = opts+'';\n\t\n\tif (that.Tabs.length<2 || !tabid) return;\n\t\n\t// Search for tab\n\tvar tab = that.Tabs.find(function(t){return t.id == tabid});\n\tif (!tab) return;\n\t\n\t// Search for app DOM node\n\tvar $app = that.my.find('#l-apps>#app-'+tabid);\n\t\n\tif ($app.length && $app.is('.my-form')) {\n\t\ttab.hash1 = $app.my('manifest').hash();\n\t\tif (tab.hash1 == tab.hash0) {\n\t\t\t_unmount($app, tab)\n\t\t}\n\t\telse {\n\t\t\t// here we should check if doc was changed \n\t\t\t// and show modal popup 'Discard changes?'\n\t\t\t$.my.modal({\n\t\t\t\tmanifest:that.Confirm,\n\t\t\t\tdata:{yes:'Close tab&nbsp;',no:'Cancel close', cancel:'', text:that.lang.DLG_UNSAVED},\n\t\t\t\twidth:300,\n\t\t\t\tclose:true,\n\t\t\t\tesc:true,\n\t\t\t\tenter:false,\n\t\t\t\tcss:'lh170 xgray p20 pb25'\n\t\t\t})\n\t\t\t.then(function(res){\n\t\t\t\tif (res.cmd == 'yes') {\n\t\t\t\t\t_unmount($app, tab);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\telse _finalize(!tab.active);\n\t\n\t// - - - - - - -\n\t\n\tfunction _unmount($app, tab) {\n\t\t$app.my('remove');\n\t\t$app.remove();\n\t\t_finalize(!tab.active);\n\t}\n\t\n\t// - - - - - - -\n\t\n\tfunction _finalize(skipSwitch) {\n\t\t// Clean up history\n\t\tthat.History.remove(tabid);\n\t\tthat.Tabs.remove(tab);\n\t\t\n\t\tcw.log('Photon tab closed', tab.path);\n\t\t\n\t\tif (skipSwitch) {\n\t\t\tif (!silent) that.my.recalc('#l-apptabs');\n\t\t}\n\t\t\n\t\telse {\n\t\t\t// search for openable tab\n\t\t\t// and switch\n\t\t\t\n\t\t\tif (!that._compiled || window.history.length == 1) {\n\t\t\t\tvar ptab, tid;\n\t\t\t\twhile (that.History.length || ptab) {\n\t\t\t\t\ttid = that.History.pop();\n\t\t\t\t\tptab = that.Tabs.find(function(t){return t.id == tabid});\n\t\t\t\t}\n\n\t\t\t\tif (!ptab) ptab = that.Tabs[0];\n\t\t\t\tthat.Switch(ptab.path, ptab.id);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.my.recalc('#l-apptabs');\n\t\t\t\twindow.history.back();\n\t\t\t}\n\t\t}\n\t\tif (!silent) that.my.restyle();\n\t}\n\t\n}","Sel2Scroll": "function ($o,onoff) {\n  if (onoff) {\n  \t// nicescroll all select2-s\n    $o.find('.select2-container>.select2-choices').niceScroll({\n      bouncescroll: true,\n      cursorcolor:'#234',\n      cursoropacitymin:0.1,\n      cursoropacitymax:0.4,\n      railpadding: {right:1}\n    });\n  }\n  else {\n    // remove all nicescrolls\n  \t$o.find('.select2-container>.select2-choices').each(function(){\n    \tvar f = $(this).getNiceScroll;\n      if (typeof f == 'function') f().remove();\n    });\n  }\n}","Ls": "function (prefix0) {\n\t\n\t// Local storage manager\n\t// this.Ls(key) -> return value or null\n\t// this.Ls(key, null) -> deletes keys\n\t// this.Ls(key, any)  -> stores value under 'Photon.'+key\n\t\n\tvar that = this,\n\t\t\tls = window.localStorage,\n\t\t\tstorage = _photon_LS,\n\t\t\tprefix = prefix0 || that.id || 'X';\n\t\n\treturn storage;\n\t\n\t// - - - - - - - - -\n\t\n\tfunction _photon_LS (key0, data){\n\t\tvar x, \n\t\t\t\tkey = prefix+'.'+key0;\n\t\tif (null === data) return ls.removeItem(key);\n\t\telse if (undefined !== data) return ls.setItem(key, JSON.stringify(data));\n\t\telse {\n\t\t\tx = ls.getItem(key);\n\t\t\tif (Object.isString(x)) return _parse(x);\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\t// - - - - - - - - -\n\t\n\tfunction _parse(s) {\n\t\ttry{ return JSON.parse(s); } catch(e){}\n\t\treturn null;\n\t}\n}","IndexEd": {"id": "cw.Photon.IndexEd","inherit": ["RT"],"params": {"restyle": 50},"lang": {},"HTML": "<div class=\"h30 bg-gray7 bbs lh160 pt1 xgray nw oh ell\"><div class=\"fs90 fr pt1 tar\"><span id=\"view-mi-mode\"></span><span id=\"btn-view-mi-close\" class=\"pr8 pl8 ml6 pseudolink tdn\" style=\"border-left:1px solid #0002;\" title=\"{BTN_PANEL_CLOSE}\">✕</span></div><div id=\"view-mi-name\" class=\"bolder pl8 oh nw ell\"></div></div><section id=\"view-mi-proxy\" class=\"bbs\"><textarea id=\"view-mi-ed\" class=\"w100p\"></textarea></section><section id=\"view-ed-buttons\" class=\"nw p8\" style=\"\"><div class=\"fr\"><button id=\"btn-view-mi-revert\" class=\"orange hide\" title=\"{TIP_REVERT}\"><span class=\"fi-refresh fs95 o60\"></span> {BTN_REVERT} </button><button id=\"btn-view-mi-del\" class=\"red hide ml2\" title=\"{TIP_DEL}\"><span class=\"fi-trash fs95 o60\"></span> {BTN_DEL}</button></div><button id=\"btn-view-mi-run\" class=\"mr2 green\" disabled title=\"{TIP_RUN}\"><span class=\"fi-play fs95 o60\"></span> {BTN_RUN}</button><button id=\"btn-view-mi-saveas\" class=\"mr2\" title=\"{TIP_SAVEAS}\"><span class=\"fi-save fs95 o60\"></span> {BTN_SAVEAS}</button></section>","init": "function ($o) {\n  \tvar that = this;\n    $o.html(that.HTML.assign(that.lang));\n  }","data": {"ddoc": "","name": "","type": "index","mode": ["javascript"],"text": "","json": {},"errors": [],"stamp": 0,"rev": ""},"ui": {"#view-mi-ed": {"init": "function ($o) {\n      var that = this,\n          mode = (that.data.mode)+'';\n      CodeMirror.fromTextArea($o[0], {\n        mode:\t\t\t\t\t\tmode,\n        lineNumbers:\t\tfalse,\n        viewportMargin:\t100,\n        scrollbarStyle:\tnull,\n        lineWrapping:\t\ttrue,\n        tabSize:\t\t\t\t2,\n        theme: \t\t\t\t\t'default',\n        readOnly:\t\t\t\tmode == 'json',\n        extraKeys: {\n          'Ctrl-R':\tfunction(){that.SaveIndex()},\n          'Cmd-R': \tfunction(){that.SaveIndex()}\n        }\n      });\n    }","bind": "function (d,v) {\n      var that = this,\n          mode = d.mode+'';\n      if (v!=null && mode != 'json') d.text = v;\n      if (mode == 'json') return JSON.stringify(d.json, null, '\\t');\n      return d.text;\n    }"},"#view-mi-proxy": {"init": "function ($o) {\n      // init nicescroll\n      $o.niceScroll({\n        cursorcolor:'#234',\n        cursoropacitymin:0.07,\n        cursoropacitymax:0.4,\n      });\n    }","delay": 200,"bind": "function (d,v) {\n      var that = this,\n          isO = Object.isObject,\n          isA = Object.isArray,\n          t = d.text,\n          j = null;\n      d.errors = [];\n      j = that.RT('jseval')('('+t+')');\n      if (j == null || !isO(j)) {\n        d.errors.push(that.lang.ERR_NO_JSON);\n      }\n      else if (!isO(j.index) || !isA(j.index.fields)) {\n        d.errors.push(that.lang.ERR_NO_INDEX);\n      }\n      else if (j.type && j.type!==\"json\") {\n      \td.errors.push(that.lang.ERR_NO_TYPE);\n      }\n      d.json = !d.errors.length?j:{};\n    }","watch": ["#view-mi-ed"],"css": {"red": "function (d) {\n        return d.errors.length>0;\n      }"}},"#view-mi-mode": {"init": "function ($o) {\n      $o.tags(this.lang.TAG_MODE)\n    }","bind": "function (d,v) {\n      var that = this;\n      if (v == null) return d.mode;\n      d.mode = v;\n      var cm = that.my.find('#view-mi-ed').next()[0].CodeMirror;\n      cm.setOption('mode', v+'');\n      cm.setOption('readOnly', 'json' == v+'');\n      that.my.recalc('#view-mi-ed');\n      return v;\n    }"},"#view-mi-name": {"delay": 50,"bind": "function (d,v) {\n      var that = this,\n          m = that.RT('data'), mt = '';\n      if (!d.errors.length) {\n        if (! d.ddoc.split('/')[1]){\n        \tmt = 'Default Mango index';\n        }\n        else {\n        \t//mt = 'Index '+d.ddoc.split('/')[1].truncate(10,'right','…')+'\\u2009.\\u2009'+d.name;\n          mt = that.lang.TXT_TITLE.assign(d.name, d.ddoc.from(8))\n        }\n        return mt.escapeHTML();\n      }\n      return d.errors[0].escapeHTML();\n    }","css": {"red": "function (d) {\n        return d.errors.length>0;\n      }","bolder": "function (d) {\n        return d.errors.length==0;\n      }"},"watch": ["#view-mi-proxy"]},"#btn-view-mi-close": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      this.RT('data').editor = false;\n      this.RT('my').check('#btn-viewcode');\n    }"},"#btn-view-mi-run": {"bind": "function (d,v) {\n      var that = this,\n          i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text},\n          l = that.lang,\n          t = '<span class=\"fi-play fs95 o60\"></span>\\u00a0',\n          dirty = d.text != (vi.source || '');\n      \n      if (v!=null && dirty && d.ddoc!='_design/') that.SaveIndex();\n      // else if (v!=null) that.RT('GetView')(true);\n      \n      return t+l.BTN_RUN;\n    }","delay": 50,"css": {":disabled": "function (d) {\n        if (\n          d.ddoc=='_design/' || \n          !!d.errors.length ||\n          (d.json.ddoc && d.json.ddoc != d.ddoc.from(8)) || \n          (d.json.name && d.json.name != d.name)\n        ) return true;\n        var that = this,\n            i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text};\n        return d.text == (vi.source || '');\n      }"},"watch": ["#view-mi-proxy"]},"#btn-view-mi-revert": {"bind": "function (d,v) {\n      var that = this,\n          i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text};\n      if(v!=null){\n        d.text = vi.source;\n        //that.my.recalc('#view-mr-ed');\n      }\n    }","delay": 50,"css": {"self:hide": "function (d) {\n      \tvar that = this,\n          i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text};\n        return d.text == vi.source;\n      }"},"recalc": ["#view-mi-ed"],"watch": ["#view-mi-proxy"]},"#btn-view-mi-del": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      var that = this,\n          l = that.lang;\n      \n      $.my.modal({\n        data:{\n          yes:\t\tl.BTN_DEL_YES,\n          yescss:\t'red',\n          no:\t\t\tl.BTN_DEL_NO, \n          cancel:\t'',\n          text:\t\tl.MSG_DEL_TEXT.assign(d.name.escapeHTML(), d.ddoc.from(8).escapeHTML())\n        },\n        manifest: that.Pho('Confirm'),\n        esc:\t\ttrue,\n        global: true,\n        screen:\ttrue\n      })\n      .then(function(res){\n      \tif (res.cmd !='yes') return;\n        that.DelIndex();\n      });\n    }","delay": 20,"css": {"self:hide": "function (d) {\n      \tif (!d.ddoc.from(8)) return true;\n      }"},"watch": ["#view-mi-proxy"]},"#btn-view-mi-saveas": {"css": {":disabled": "function (d,v) {\n      \treturn !!d.errors.length;\n      }"},"watch": ["#view-mi-proxy"],"bind": "function (d,v,$o) {\n      var that = this;\n      \n      if (v==null) return;\n      \n      if ($o.data('modal')) {\n        $o.modal(true);\n        return;\n      }\n      \n      // Show select name dlg\n      $.my.modal({\n        data:$.extend(true, {}, that.RT(['data','mango'])),\n        manifest:{\n          data: $.extend(\n            true, \n            {_valid:true}, \n            d.ddoc!='_design/'\n            \t? d\n            \t: Object.reject(d, ['ddoc','name']),\n            Object.select(d.json,['ddoc','name'])\n          ),\n          Name:'',\n          init:function($o){\n            var self = this,\n                d = self.data;\n            $o.html($.my.formgen([\n              {row:'100%', label:'90px', labelCss:'my-label fs90 o80', rowCss:'my-row pt8'},\n              '<div class=\"mb8\">',\n              \t'<div id=\"ftitle\" class=\"xgray mb-8\">{TXT_NEW}</div>',\n              \t['{LBL_DDOC}','inp#mddoc.w100p',{plc:'{PLC_DDOC}'}, 'msg'],\n                ['{LBL_NEW}',\t'inp#mview.w100p',{plc:'{PLC_NEW}'}, 'msg'],\n              \t'<div id=\"fwarn\" class=\"xgray pt12 hide\"></div>',\n              '</div>',\n              '<div class=\"mt16 pt7 btd fs95\">',\n              \t[\n                  '', \n                  'btn#btn-new-ok.green.mr2',{val:'{BTN_NEW_OK}'},\n                \t'btn#btn-new-cancel',{val:'{BTN_NEW_CANCEL}'}\n                ],\n              '</div>'\n            ]).assign(that.lang))\n          },\n          ui:{\n            \n            '#mddoc':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.ddoc;\n                d.ddoc = v;\n              }\n            },\n            \n            '#mview':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.name;\n                d.name = v;\n              },\n              check: function(d,v){\n              \tif (!v) return that.lang.ERR_NEW_REQ;\n                if (v.indexOf('/')>-1) return that.lang.ERR_NEW_SLASH;\n              }\n            },\n            \n            '#fwarn':{\n              bind: function(d,v){\n                var n = '_design/'+d.ddoc.replace(/^_design\\//,'');\n            \t\tif (!that.RT(['Ddocs', n])) return that.lang.EXP_NDDOC;\n                if (that.RT(['Ddocs', n, 'views', d.name])) return that.lang.EXP_EXIST;\n                return that.lang.EXP_NVIEW;\n            \t},\n              watch:['#mddoc', '#mview'],\n            \tcss:{\n              \thide: function(d){\n                  d._valid = this.my.valid();\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n\n            '#btn-new-ok':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.commit();\n              },\n              watch:['#mddoc', '#mview'],\n              css:{\n              \t':disabled': function(d){\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n            '#btn-new-cancel':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.cancel();\n              }\n            }\n          },\n          style:{\n          \t'':'font-size:16px;line-height:22px;'\n          }\n        },\n        css:'p15',\n        global:true,\n        screen:true,\n        width:400,\n        esc:true,\n        focus:'#mview',\n        enter:true,\n        bound:0\n      })\n      .then(function(res){\n        if (!res._valid) {\n        \tcw.lib.note(that.lang.ERR_NO_NAME, 'error');\n          return;\n        }\n        \n        var idx = d.json;\n        if (res.ddoc) idx.ddoc = res.ddoc.replace(/^_design\\//,'');\n        if (!idx.ddoc) idx.ddoc = 'index_'+cw.lib.hash4('_design/'+Date.now());\n        if (res.name) idx.name = res.name;\n        \n        that.SaveIndex(idx);\n\n      });\n    }","events": "click.my"}},"style": {" .CodeMirror": "font-size:80%!important;padding:0px;min-height:300px;"," .CodeMirror-scroll": "min-height:300px;"," #view-mi-proxy": "function ($o) {\n    \treturn 'max-height:'+($o.parent().height() - 48 - 32)+'px;'\n    }"," #view-mi-proxy.red .CodeMirror-linenumbers": "background-color: rgba(255, 200, 200, 0.75);"," #btn-view-mi-del": "display:none;"," #btn-view-mi-revert.hide + #btn-view-mi-del": "display:inline-block;"},"die": "function ($o) {\n    // Unmount niceScroll\n    var $v = $o.find('#view-mi-proxy'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n  }","SaveIndex": "function (idx0,view0) {\n  \n  var that = this,\n      d = that.data,\n      view = view0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n  \n  if (d.errors.length) {\n    cw.lib.note(that.lang.ERR_ERRDOC.assign(d.errors[0]), 'error');\n    return $.Deferred().reject(d.errors[0]);\n  }\n  \n  var idx = $.extend(true, {},  idx0 || d.json);\n        \n  if (!idx.ddoc) idx.ddoc = d.ddoc.from(8);\n  if (!idx.name) idx.name = d.name;\n  \n  // mark busy\n  that.RT('my').root().addClass('app-busy');\n  $.my.radio('appbusy',{id:tabid, busy:true});\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], '_index'], \n    method:\t\t\t\t'POST', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    data:\t\t\t\t\tJSON.stringify(idx), \n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    cw.lib.note(that.lang.MSG_SAVED.assign(idx.ddoc+'.'+idx.name), 'ok');\n  \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[d.ddoc]});\n    \n    if (d.ddoc.from(8) == idx.ddoc && d.name == idx.name) {\n      // Update current editor\n      that.my.check('#btn-view-mi-revert');\n      that.my.check('#btn-view-mi-run');\n    }\n    else {\n    \t// Switch view\n      that.RT('data').view = '_idx/'+idx.ddoc+'\\ufffd'+idx.name;\n      that.RT('my').trigger('#btn-reload','click.my');\n    }\n    \n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_FAIL.assign(idx.ddoc+'.'+idx.name, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n}","DelIndex": "function (ddoc0,idx0) {\n  \n  var that = this,\n      d = that.data,\n      ddoc = ddoc0 || d.ddoc,\n      idx = idx0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], '_index', ddoc, 'json', idx], \n    method:\t\t\t\t'DELETE', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    cw.lib.note(that.lang.MSG_DEL_OK.assign(ddoc+'.'+idx), 'ok');\n    \n    // Switch index\n    that.RT('data').view = '';\n    that.RT('data').editor = false;\n    that.RT().Rows = [];\n    that.RT('my').recalc('#view-name');\n    that.RT('my').check('#view-name');\n    (function(){\n    \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[ddoc]});\n    }).debounce(100)();\n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_DEL_FAIL.assign(ddoc+'.'+idx, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n}"},"ViewEd": {"id": "cw.Photon.ViewEd","inherit": ["RT"],"params": {"restyle": 50},"lang": {},"HTML": "<div class=\"h30 bg-gray7 bbs lh160 pt1 xgray nw oh ell\"><div class=\"fs90 fr pt1 tar\"><span id=\"view-mr-mode\"></span><span id=\"btn-view-mr-close\" class=\"pr8 pl8 ml6 pseudolink tdn\" style=\"border-left:1px solid #0002;\" title=\"{BTN_PANEL_CLOSE}\">✕</span></div><div id=\"view-mr-name\" class=\"bolder pl8 oh nw ell\"></div></div><section id=\"view-mr-proxy\" class=\"bbs\"><textarea id=\"view-mr-ed\" class=\"w100p\"></textarea></section><section id=\"view-ed-buttons\" class=\"nw p8\" style=\"\"><div class=\"fr\"><button id=\"btn-view-mr-revert\" class=\"orange hide\" title=\"{TIP_REVERT}\"><span class=\"fi-refresh fs95 o60\"></span> {BTN_REVERT} </button><button id=\"btn-view-mr-del\" class=\"red hide ml2\" title=\"{TIP_DEL}\"><span class=\"fi-trash fs95 o60\"></span> {BTN_DEL}</button></div><button id=\"btn-view-mr-run\" class=\"mr2 green\" disabled title=\"{TIP_RUN}\"><span class=\"fi-play fs95 o60\"></span> {BTN_RUN}</button><button id=\"btn-view-mr-saveas\" class=\"mr2\" title=\"{TIP_SAVEAS}\"><span class=\"fi-save fs95 o60\"></span> {BTN_SAVEAS}</button></section>","init": "function ($o) {\n  \tvar that = this;\n    $o.html(that.HTML.assign(that.lang));\n  }","data": {"ddoc": "","name": "","type": "view","mode": ["map"],"map": "","reduce": "","json": {},"errors": [],"stamp": 0,"rev": ""},"ui": {"#view-mr-ed": {"init": "function ($o) {\n      var that = this,\n          d = that.data,\n          mode = (d.mode)+'';\n      CodeMirror.fromTextArea($o[0], {\n        mode:\t\t\t\t\t\tmode == 'json'?mode:d.language||'javascript',\n        lineNumbers:\t\ttrue,\n        viewportMargin:\t100,\n        scrollbarStyle:\tnull,\n        lineWrapping:\t\tfalse,\n        tabSize:\t\t\t\t2,\n        theme: \t\t\t\t\t'default',\n        readOnly:\t\t\t\tmode == 'json',\n        extraKeys: {\n          'Ctrl-R':\tfunction(){that.SaveDdoc()},\n          'Cmd-R': \tfunction(){that.SaveDdoc()}\n        }\n      });\n    }","bind": "function (d,v) {\n      var that = this,\n          mode = d.mode+'';\n      if (v!=null && mode != 'json') {\n        d[mode] = v;\n      }\n      if (mode == 'json') return JSON.stringify(d.json, null, '\\t');\n      return d[mode];\n    }"},"#view-mr-proxy": {"init": "function ($o) {\n      // init nicescroll\n      $o.niceScroll({\n        cursorcolor:'#234',\n        cursoropacitymin:0.07,\n        cursoropacitymax:0.4,\n      });\n    }","delay": 200,"bind": "function (d,v) {\n      var that = this,\n          isF = Object.isFunction,\n          tm = d.map,\n          tr = d.reduce || '',\n          j = null,\n          reerl0 = /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/,\n          reerl1 = /\\.[\\r\\n\\s\\t]*$/,\n          builtins = ['_sum','_count','_min','_max','_stats','_sumsqr'],\n          err = d.errors = [];\n      \n      // ==== JS ====\n      \n      if (d.language == 'javascript') {\n        \n        // Map\n        j = that.RT('jseval')('('+tm+')');\n        if (j == null || !isF(j)) err.push(that.lang.ERR_NO_MAP);\n        \n\t\t\t\t// Reduce\n        if (tr && tr[0]!='_') {\n          j = null;\n          j = that.RT('jseval')('('+tr+')');\n          if (j == null || !isF(j)) err.push(that.lang.ERR_NO_REDUCE);\n        }\n        if (tr[0]=='_' && builtins.indexOf(tr.trim()) == -1) err.push(that.lang.ERR_F_BUILTIN);\n      }\n      \n      // ==== ERLANG ====\n      \n      if (d.language == 'erlang') {\n        \n        // Map\n        if (!reerl0.test(tm) || !reerl1.test(tm)) err.push(that.lang.ERR_NO_MAP);\n        \n        // Reduce\n        if (tr[0]=='_' && builtins.indexOf(tr.trim()) == -1) err.push(that.lang.ERR_F_BUILTIN);\n        else if (tr && tr[0]!='_' && (!reerl0.test(tr) || !reerl1.test(tr))) err.push(that.lang.ERR_NO_REDUCE);\n      }\n      \n      // mount\n      \n      d.json = {};\n      if (!d.errors.length) {\n        if (tm.trim()) d.json.map = tm;\n        if (tr.trim()) d.json.reduce = tr;\n      }\n    }","watch": ["#view-mr-ed"],"css": {"red": "function (d) {\n        return d.errors.length>0;\n      }"}},"#view-mr-mode": {"init": "function ($o) {\n      $o.tags(this.lang.TAG_MODE)\n    }","bind": "function (d,v) {\n      var that = this;\n      if (v == null) return d.mode;\n      d.mode = v;\n      var cm = that.my.find('#view-mr-ed').next()[0].CodeMirror;\n      cm.setOption('mode', 'json' == v+''?'json':d.language);\n      cm.setOption('readOnly', 'json' == v+'');\n      that.my.recalc('#view-mr-ed');\n      return v;\n    }"},"#view-mr-name": {"delay": 50,"bind": "function (d,v) {\n      var that = this,\n          m = that.RT('data');\n      if (!d.errors.length) {\n        \n        //var mt = '_d/'+d.ddoc.split('/')[1].truncate(10,'right','…')+'\\u2009.views.'+d.name;\n        var mt = that.lang.TXT_TITLE[d.language].assign(d.ddoc.from(8), d.name);\n        return mt.escapeHTML();\n      }\n      return d.errors[0].escapeHTML();\n    }","css": {"red": "function (d) {\n        return d.errors.length>0;\n      }","bolder": "function (d) {\n        return d.errors.length==0;\n      }"},"watch": ["#view-mr-proxy"]},"#btn-view-mr-close": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      this.RT('data').editor = false;\n      this.RT('my').check('#btn-viewcode');\n    }"},"#btn-view-mr-run": {"bind": "function (d,v) {\n      var that = this,\n          i = d.ddoc+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {},\n          l = that.lang,\n          t = '<span class=\"fi-play fs95 o60\"></span>\\u00a0',\n          dirty = d.map != (vi.map || '') || d.reduce != (vi.reduce || '');\n      \n      if (v!=null && dirty) that.SaveDdoc();\n      else if (v!=null) that.RT('GetView')(true);\n      \n      return t+l.BTN_SAVE;\n    }","delay": 50,"css": {":disabled": "function (d) {\n        if (d.errors.length) return true;\n        var that = this,\n            i = d.ddoc+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {},\n            l = that.lang,\n            t = '<span class=\"fi-play fs95 o60\"></span>\\u00a0',\n            dirty = d.map != (vi.map || '') || d.reduce != (vi.reduce || '');\n        return !dirty;\n      }","self:green": "function (d) {\n        if (d.errors.length) return false;\n      \tvar that = this,\n            i = d.ddoc+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {};\n        return d.map != (vi.map || '') || d.reduce != (vi.reduce || '');\n      }"},"watch": ["#view-mr-proxy"]},"#btn-view-mr-revert": {"bind": "function (d,v) {\n      var that = this,\n          i = d.ddoc+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {};\n      if(v!=null){\n        d.map = (vi.map || '');\n        d.reduce = (vi.reduce || '');\n        //that.my.recalc('#view-mr-ed');\n      }\n    }","delay": 50,"css": {"self:hide": "function (d) {\n      \tvar that = this,\n            i = d.ddoc+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {};\n        return d.map == (vi.map || '') && d.reduce == (vi.reduce || '');\n      }"},"recalc": ["#view-mr-ed"],"watch": ["#view-mr-proxy"]},"#btn-view-mr-del": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      var that = this,\n          l = that.lang;\n      \n      $.my.modal({\n        data:{\n          yes:\t\tl.BTN_DEL_YES,\n          yescss:\t'red',\n          no:\t\t\tl.BTN_DEL_NO, \n          cancel:\t'',\n          text:\t\tl.MSG_DEL_TEXT.assign(d.name.escapeHTML(), d.ddoc.escapeHTML())\n        },\n        manifest: that.Pho('Confirm'),\n        esc:\t\ttrue,\n        global: true,\n        screen:\ttrue\n      })\n      .then(function(res){\n      \tif (res.cmd !='yes') return;\n        that.DelView();\n      });\n    }","delay": 20,"css": {"self:hide": "function (d) {\n      \tif (!d.ddoc.from(8)) return true;\n      }"},"watch": ["#view-mr-proxy"]},"#btn-view-mr-saveas": {"css": {":disabled": "function (d,v) {\n      \treturn !!d.errors.length;\n      }"},"watch": ["#view-mr-proxy"],"bind": "function (d,v,$o) {\n      var that = this;\n      \n      if (v==null) return;\n      \n      if ($o.data('modal')) {\n        $o.modal(true);\n        return;\n      }\n      \n      // Show select name dlg\n      $.my.modal({\n        data:$.extend(true, {}, that.RT(['data','mango'])),\n        manifest:{\n          data: $.extend(true, {_valid:true}, d),\n          Name:'',\n          init:function($o){\n            var self = this,\n                d = self.data;\n            $o.html($.my.formgen([\n              {row:'100%', label:'90px', labelCss:'my-label fs90 o80', rowCss:'my-row pt8'},\n              '<div class=\"mb8\">',\n              \t'<div id=\"ftitle\" class=\"xgray mb-8\">{TXT_NEW}</div>',\n              \t['{LBL_DDOC}','inp#mddoc.w100p',{plc:'{PLC_DDOC}'}, 'msg'],\n                ['{LBL_NEW}',\t'inp#mview.w100p',{plc:'{PLC_NEW}'}, 'msg'],\n              \t'<div id=\"fwarn\" class=\"xgray pt12 hide\"></div>',\n              '</div>',\n              '<div class=\"mt16 pt7 btd fs95\">',\n              \t[\n                  '', \n                  'btn#btn-new-ok.green.mr2',{val:'{BTN_NEW_OK}'},\n                \t'btn#btn-new-cancel',{val:'{BTN_NEW_CANCEL}'}\n                ],\n              '</div>'\n            ]).assign(that.lang))\n          },\n          ui:{\n            \n            '#mddoc':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.ddoc;\n                d.ddoc = v;\n              }\n            },\n            \n            '#mview':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.name;\n                d.name = v;\n              },\n              check: function(d,v){\n              \tif (!v) return that.lang.ERR_NEW_REQ;\n                if (v.indexOf('/')>-1) return that.lang.ERR_NEW_SLASH;\n                //if (v.indexOf(' ')>-1) return that.lang.ERR_NEW_SPACE;\n              }\n            },\n            \n            '#fwarn':{\n              bind: function(d,v){\n                var n = d.ddoc.to(8) != '_design/'?'_design/'+d.ddoc:d.ddoc;\n            \t\tif (!that.RT(['Ddocs', n])) return that.lang.EXP_NDDOC;\n                if ( that.RT(['Ddocs', n, 'views', d.name])) return that.lang.EXP_EXIST;\n                return that.lang.EXP_NVIEW;\n            \t},\n              watch:['#mddoc', '#mview'],\n            \tcss:{\n              \thide: function(d){\n                  d._valid = this.my.valid();\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n\n            '#btn-new-ok':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.commit();\n              },\n              watch:['#mddoc', '#mview'],\n              css:{\n              \t':disabled': function(d){\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n            '#btn-new-cancel':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.cancel();\n              }\n            }\n          },\n          style:{\n          \t'':'font-size:16px;line-height:22px;'\n          }\n        },\n        css:'p15',\n        global:true,\n        screen:true,\n        width:400,\n        esc:true,\n        focus:'#mview',\n        enter:true,\n        bound:0\n      })\n      .then(function(res){\n        if (!res._valid) {\n        \tcw.lib.note(that.lang.ERR_NO_NAME, 'error');\n          return;\n        }\n        \n        res.ddoc = res.ddoc.to(8) != '_design/'?'_design/'+res.ddoc:res.ddoc;;\n        var ddoc = that.RT(['Ddocs', res.ddoc]);\n        \n        if (!ddoc) ddoc = {\n        \t_id:\t\t\tres.ddoc,\n          language:\td.language,\n          views:\t\t{}\n        };\n        \n        that.SaveDdoc(ddoc, res.name)\n        .then(function(){\n        \tthat.RT('data').view = res.ddoc+'\\ufffd'+res.name;\n          that.RT('my').trigger('#btn-reload','click.my');\n        });\n\n      });\n    }","events": "click.my"}},"style": {" .CodeMirror": "font-size:80%!important;padding:0px;min-height:300px;"," .CodeMirror-scroll": "min-height:300px;"," #view-mr-proxy": "function ($o) {\n    \treturn 'max-height:'+($o.parent().height() - 48 - 32)+'px;'\n    }"," #view-mr-proxy.red .CodeMirror-linenumbers": "background-color: rgba(255, 200, 200, 0.75);"," #btn-view-mr-del": "display:none;"," #btn-view-mr-revert.hide + #btn-view-mr-del": "display:inline-block;"},"die": "function ($o) {\n    // Unmount niceScroll\n    var $v = $o.find('#view-mr-proxy'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n  }","SaveDdoc": "function (ddoc0,view0) {\n  \n  var that = this,\n      d = that.data,\n      view = view0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n  \n  if (d.errors.length) {\n    cw.lib.note(that.lang.ERR_ERRDOC.assign(d.errors[0]), 'error');\n    return $.Deferred().reject(d.errors[0]);\n  }\n  \n  var ddoc = $.extend(true, {}, ddoc0 || that.RT(['Ddocs',d.ddoc]));\n        \n  if (d.map.trim()) cw.lib.unmask(ddoc, [d.map], [['views', view, 'map']]);\n  else if (cw.lib.getref(ddoc, ['views', view, 'map'])) ddoc.views[view].map = undefined;\n\n  if (d.reduce.trim()) cw.lib.unmask(ddoc, [d.reduce], [['views', view, 'reduce']]);\n  else if (cw.lib.getref(ddoc, ['views', view, 'reduce'])) ddoc.views[view].reduce = undefined;\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], ddoc._id], \n    method:\t\t\t\t'PUT', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    data:\t\t\t\t\tJSON.stringify(ddoc), \n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    d.rev = res.rev;\n    cw.lib.note(that.lang.MSG_SAVED.assign(ddoc._id), 'ok');\n  \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[ddoc._id]});\n    that.my.check('#btn-view-mr-revert');\n    that.my.check('#btn-view-mr-run');\n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_FAIL.assign(ddoc._id, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n}","DelView": "function (ddoc0,view0) {\n  \n  var that = this,\n      d = that.data,\n      view = view0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n  \n  if (d.errors.length) {\n    cw.lib.note(that.lang.ERR_ERRDOC.assign(d.errors[0]), 'error');\n    return $.Deferred().reject(d.errors[0]);\n  }\n  \n  var ddoc = $.extend(true, {}, ddoc0 || that.RT(['Ddocs',d.ddoc]));\n        \n  if (cw.lib.getref(ddoc, ['views', view])) delete ddoc.views[view];\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], ddoc._id], \n    method:\t\t\t\t'PUT', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    data:\t\t\t\t\tJSON.stringify(ddoc), \n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    d.rev = res.rev;\n    \n    cw.lib.note(that.lang.MSG_DEL_OK.assign(ddoc._id+'.'+view), 'ok');\n    \n    // Switch index\n    that.RT('data').view = '';\n    that.RT('data').editor = false;\n    that.RT().Rows = [];\n    that.RT('my').recalc('#view-name');\n    that.RT('my').check('#view-name');\n    (function(){\n    \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[ddoc._id]});\n    }).debounce(100)();\n\n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_DEL_FAIL.assign(ddoc._id+'.'+view, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n}"},"MangoEd": {"id": "cw.Photon.MangoEd","inherit": ["RT"],"params": {"restyle": 50},"lang": {},"HTML": "<div class=\"h30 bg-gray7 bbs lh160 pt1 xgray nw oh ell\"><div class=\"fs90 tar fr pt1\"><span id=\"view-mango-mode\"></span><span id=\"btn-view-mango-close\" class=\"pr8 pl8 ml6 pseudolink tdn\" style=\"border-left:1px solid #0002;\" title=\"{BTN_PANEL_CLOSE}\">✕</span></div><div id=\"view-mango-name\" class=\"bolder pl8 oh nw ell\"></div></div><section id=\"view-mango-proxy\" class=\"bbs\"><textarea id=\"view-mango-ed\" class=\"w100p\"></textarea></section><section id=\"view-mango-buttons\" class=\"nw p8\" style=\"\"><div class=\"fr\"><button id=\"btn-view-mango-revert\" class=\"hide\" title=\"{TIP_RESET}\"><span class=\"fi-refresh fs95 o60\"></span> {BTN_RESET} </button><button id=\"btn-view-mango-del\" class=\"hide red\" title=\"{TIP_DEL}\"><span class=\"fi-trash fs95 o60\"></span> {BTN_DEL}</button></div><button id=\"btn-view-mango-run\" class=\"mr2 green\" title=\"{TIP_RUN}\"><span class=\"fi-play fs95 o60\"></span> {BTN_RUN}</button><button id=\"btn-view-mango-stash\" class=\"mr2\" title=\"{TIP_SAVE}\"><span class=\"fi-save fs95 o60\"></span> {BTN_SAVE}</button><button id=\"btn-view-mango-explain\" class=\"mr2\" title=\"{TIP_EXPL}\"><span class=\"fi-megaphone fs95 o60\"></span> {BTN_EXPL}</button></section>","init": "function ($o) {\n  \tvar that = this;\n    $o.html(that.HTML.assign(that.lang));\n    that.Text = that.data.text;\n  }","data": {"name": "Untitled query","type": "mango","text": "({\n\t// Write your mango query, JS syntax allowed\n})","json": {},"errors": [],"stamp": 0},"Mode": ["javascript"],"Text": "","ui": {"#view-mango-ed": {"init": "function ($o) {\n      var that = this,\n          mode = (that.Mode)+'';\n      CodeMirror.fromTextArea($o[0], {\n        mode:\t\t\t\t\t\tmode,\n        lineNumbers:\t\tfalse,\n        viewportMargin:\t100,\n        scrollbarStyle:\tnull,\n        lineWrapping:\t\ttrue,\n        tabSize:\t\t\t\t2,\n        theme: \t\t\t\t\t'default',\n        readOnly:\t\t\t\tmode == 'json',\n        extraKeys: {\n          'Ctrl-R':\tfunction(){that.RT('GetView')(true)},\n          'Cmd-R': \tfunction(){that.RT('GetView')(true)}\n        }\n      });\n    }","bind": "function (d,v) {\n      var that = this,\n          mode = that.Mode+'';\n      if (v!=null && mode != 'json') d.text = v;\n      if (mode == 'json') return JSON.stringify(d.json, null, '\\t');\n      return d.text;\n    }"},"#view-mango-proxy": {"init": "function ($o) {\n      // init nicescroll\n      $o.niceScroll({\n        cursorcolor:'#234',\n        cursoropacitymin:0.07,\n        cursoropacitymax:0.4,\n      });\n    }","delay": 200,"bind": "function (d,v) {\n      var that = this,\n          isO = Object.isObject,\n          isA = Object.isArray,\n          t = d.text,\n          j = null;\n      d.errors = [];\n      j = that.RT('jseval')('('+t+')');\n      if (j == null || !isO(j)) {\n        d.errors.push(that.lang.ERR_NO_JSON);\n      }\n      else if (!isO(j.selector)) {\n        d.errors.push(that.lang.ERR_NO_SELECTOR);\n      }\n      d.json = !d.errors.length?j:{};\n    }","watch": ["#view-mango-ed"],"css": {"red": "function (d) {\n        return d.errors.length>0;\n      }"}},"#btn-view-mango-run": {"bind": "function (d,v) {\n      var that = this;\n      if (v==null) return;\n      that.RT('GetView')(true);\n    }","css": {":disabled": "function (d) {\n        return d.errors.length > 0 || this.Text == d.text;\n      }"},"watch": ["#view-mango-proxy"]},"#btn-view-mango-explain": {"bind": "function (d,v,$o) {\n      var that = this;\n      if (v==null) return;\n      //that.RT('GetView')(true);\n      var $p = that.my.find('#view-mango-proxy'),\n          h = $p.outerHeight() - 3,\n          w = $p.outerWidth() - 32;\n      if ($o.data('modal')) {\n      \t$o.modal(true);\n        return;\n      }\n      $o.modal({\n        css:'p15 pt0', align:'bottom:140%', nose:'bottom',\n      \tdata:{t:'Loading...', h:h},\n        width: w, \n        drag:'#dragger',\n        bound: '0',\n        root:'',\n        manifest:{\n          init:function($o){\n            var self = this;\n          \t$o.html('<div id=\"dragger\"></div><textarea id=\"explain\" class=\"w100p\"></textarea>');\n            $o.then(function(){\n              that.Req({\n                url:\t\t[that.RT('data').path[0],'_explain'],\n                headers:\t{accept:'application/json','Content-type':'application/json'},\n                method:\t'post',\n                data:\t\tJSON.stringify(d.json)\n              })\n              .then((function(res){\n                self.data.t = JSON.stringify(res, null, '  ');\n                self.my.recalc('#explain')\n              }).debounce(50))\n              .fail(function(code, err, res){\n                self.data.t = JSON.stringify(err, null, '  ');\n                self.my.recalc('#explain');\n              })\n            });\n          },\n          ui:{\n          \t'#explain':{\n            \tbind:'t',\n              init: function($o){\n              \tCodeMirror.fromTextArea($o[0], {\n                  mode:\t\t\t\t\t\t'json',\n                  lineNumbers:\t\tfalse,\n                  scrollbarStyle:\tnull,\n                  lineWrapping:\t\ttrue,\n                  tabSize:\t\t\t\t2,\n                  theme: \t\t\t\t\t'default',\n                  readOnly:\t\t\t\ttrue\n                });\n              }\n            }\n          },\n        \tstyle:{\n            ' #dragger':'width:100%;height:15px;cursor:move;',\n          \t' .CodeMirror':function(){return 'padding:0px; height:'+this.data.h+'px!important;'}\n          }\n        }\n      })\n    }","css": {":disabled": "function (d) {\n        return false || d.errors.length > 0;\n      }"},"watch": ["#view-mango-proxy"]},"#view-mango-mode": {"init": "function ($o) {\n      $o.tags(this.lang.TAG_MODE)\n    }","bind": "function (d,v) {\n      var that = this;\n      if (v == null) return that.Mode;\n      that.Mode = v;\n      var cm = that.my.find('#view-mango-ed').next()[0].CodeMirror;\n      cm.setOption('mode', v+'');\n      cm.setOption('readOnly', 'json' == v+'');\n      that.my.recalc('#view-mango-ed');\n      return v;\n    }"},"#view-mango-name": {"delay": 250,"bind": "function (d,v) {\n      var that = this,\n          m = that.RT('data');\n      that.Pho('Ls')('Mango.'+m.path[0], m.mango);\n      if (!d.errors.length) {\n        var mt = d.name+'';\n        if ('Default query' == mt) return that.lang.TXT_TITLE0;\n        return that.lang.TXT_TITLE.assign(mt.escapeHTML());\n      }\n      return d.errors[0].escapeHTML();\n    }","css": {"red": "function (d) {\n        return d.errors.length>0;\n      }","bolder": "function (d) {\n        return d.errors.length==0;\n      }"},"watch": ["#view-mango-proxy"]},"#btn-view-mango-close": {"bind": "function (d,v) {\n    \tif (v==null) return;\n      this.RT('data').editor = false;\n      this.RT('my').check('#btn-viewcode');\n    }"},"#btn-view-mango-del": {"css": {"self:hide": "function () {\n      \treturn this.RT(['data','mango','active']) =='Default query';\n      }"},"bind": "function (d,v) {\n    \tif (v==null) return;\n      var that = this,\n          m = that.RT(['data','mango']);\n      m.active = 'Default query';\n      m.query.remove(function(e){\n      \treturn e.name == d.name;\n      });\n      that.RT('data').view = '_find\\ufffdDefault query';\n      that.RT('GetViews')(true, false, true);\n      that.RT('my').redraw.debounce(50)();\n    }"},"#btn-view-mango-revert": {"bind": "function (d,v) {\n      var that = this;\n      if(v!=null){\n        d.text = that.RT('DefaultMangoQry').text\n      }\n    }","delay": 100,"css": {"self:hide": "function (d) {\n      \treturn d.name != 'Default query';\n      }",":disabled": "function (d) {\n      \tvar that = this;\n        return d.text == that.RT('DefaultMangoQry').text;\n      }"},"recalc": ["#view-mango-ed"],"watch": ["#view-mango-proxy"]},"#btn-view-mango-stash": {"css": {":disabled": "function (d,v) {\n      \tif (d.name != 'Default query') return this.Text == d.text;\n        return d.text == this.RT('DefaultMangoQry').text;\n      }"},"watch": ["#view-mango-proxy"],"bind": "function (d,v,$o) {\n      var that = this,\n          active = that.RT(['data','mango','active']),\n        \tt = '<span class=\"fi-save fs95 o60\"></span>\\u00a0'+that.lang.BTN_SAVE;\n      \n      if (v==null) return t;\n      \n      if ($o.data('modal')) {\n        $o.modal(true);\n        return t;\n      }\n      \n      // Show select name dlg\n      that.my.modal('#btn-view-mango-stash', {\n        data:$.extend(true, {_new:{}}, that.RT(['data','mango'])),\n        manifest:{\n          data:{},\n          Name:'',\n          Qry:[],\n          init:function($o){\n            var self = this,\n                d = self.data;\n            self.Qry = Object.clone(d.query, true);\n            $o.html($.my.formgen([\n              '<div class=\"mb8\">',\n              \t'<div id=\"ftitle\" class=\"xgray\">{TXT_STASH}</div>',\n                ['','inp#mtitle.w100p',{plc:'{PLC_STASH}'}, 'msg'],\n              '</div>',\n              '<div class=\"mt15 pt15 btd fs95\">',\n              \t[\n                  '', \n                  //'<div class=\"fr\">', 'btn#btn-stash-cancel',{val:'{BTN_STASH_CANCEL}'}, '</div>',\n                  'btn#btn-stash-ok.green.mr2',{val:'{BTN_STASH_OK}'},\n                \t//'btn#btn-stash-ok1',{val:'{BTN_STASH_OK1}'}\n                ],\n              '</div>'\n            ]).assign(that.lang))\n          },\n          ui:{\n            '#mtitle':{\n              bind:function(d,v){\n              \tvar self = this;\n                if (v == null) return self.Name;\n                self.Name = v.compact();\n                if (self.Name.length>2 && self.Name.length<31) {\n                  \n                  var qry = Object.clone(d.query.find(function(e){\n                    return e.name == d.active\n                  }), true);\n\n                \tqry.name = self.Name;\n                  qry.stamp = Date.now();\n                  d._new = qry;\n                }\n                return v;\n              },\n            \tcheck:function(d,v){\n                var self = this;\n                if (!v.compact()) return that.lang.ERR_STASH_REQ;\n              \tif (v.compact().length<3 || v.length>30) return that.lang.ERR_STASH_LEN;\n                if (this.Qry.find(function(e){return e.name == v})) return that.lang.ERR_STASH_EXIST;\n              }\n            },\n            '#btn-stash-ok':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.commit();\n              },\n              watch:['#mtitle'],\n              css:{\n              \t':disabled':function(){\n                \treturn !this.my.valid();\n                }\n              }\n            },\n            /*'#btn-stash-ok1':{\n            \tbind: function(d,v){\n              \tif (v!=null) {\n                  d.active = that.RT('DefaultMangoQry').name;\n                \tthis.my.commit();\n                }\n              }\n            }*/\n          },\n          style:{\n          \t//'':'font-size:16px;line-height:22px;'\n          }\n        },\n        css:'p15',\n        global:true,\n        screen:true,\n        width:400,\n        esc:true,\n        enter:true,\n        bound:20\n      })\n      .then(function(res){\n        res.query.push(res._new);\n        res.active = res._new.name;\n      \t$.extend(that.RT('data').mango, Object.reject(res,'_new'));\n        that.RT('data').view = '_find\\ufffd'+res.active;\n        that.RT('GetViews')(true, false, true);\n        that.RT('my').redraw();\n      });\n      return t;\n    }","events": "click.my"}},"style": {" .CodeMirror": "font-size:80%!important;padding:4px;min-height:300px;"," #view-mango-proxy": "function ($o) {\n    \treturn 'max-height:'+($o.parent().height() - 48 - 32)+'px;'\n    }"," #view-mango-proxy.red .CodeMirror-linenumbers": "background-color: rgba(255, 200, 200, 0.75);"},"die": "function ($o) {\n    // Unmount niceScroll\n    var $v = $o.find('#view-mango-proxy'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n  }"},"Confirm": {"id": "cw.Photon.Confirm","params": {"delay": 5},"data": {"cmd": "","text": "","css": "xgray","yes": "Yes","no": "No","cancel": "Cancel","yescss": "green","nocss": ""},"init": "function ($o,form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t\t'<div class=\"'+d.css+'\">'+d.text+'</div>',\n\t\t\t{\n\t\t\t\tlabel:\t'70px', \n\t\t\t\trow:\t\tform.params.width+'px', \n\t\t\t\trowCss:\t'my-row mt15 pt15 mb-5 xgray btd'\n\t\t\t},\n\t\t\t[\n\t\t\t\t'', \n\t\t\t\t'spn#btn-yes.button.'+(d.yescss?d.yescss+'.':'')+'mr5.hide',\t{txt:(d.yes+'')}, \n\t\t\t\t'spn#btn-no.button.'+(d.nocss?d.nocss+'.':'')+'mr5.hide',\t\t\t{txt:(d.no+'')}, \n\t\t\t\t'spn#btn-cancel.button.fr.hide',\t\t\t{txt:(d.cancel+'')}\n\t\t\t]\n\t\t]);\n\t}","ui": {"#btn-yes": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"yes\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.yes}"}},"#btn-no": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"no\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.no}"}},"#btn-cancel": {"bind": "function (d,v,$o) {\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"cancel\";\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t}","events": "click.my","css": {"self:hide": "function (d) { return !d.cancel}"}}},"style": {"": "font-size:16px;line-height:22px;"}},"Tab": {"id": "cw.Photon.Tab","lang": {},"data": {"id": "","name": "","type": "","hash0": "","hash1": "","active": false,"path": [],"error": false,"run": false},"init": "function ($o) {\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang));\n\t}","ui": {"#l-tabname": {"bind": "function (d,v,$o) {\n\t\t\t\tvar that = this;\n\t\t\t\tthat.my.find('a#l-tabname').attr('href','#'+that.p2u(d.path||[]).join('/'));\n\t\t\t\tthat.my.root().toggleClass('active',!!d.active);\n\t\t\t\treturn d.name.escapeHTML();\n\t\t\t}","css": {"smaller": "function (d) {return d.name.length > 20}"},"events": "click.my"},"#l-tabstate": {"css": {"hide": "function (d) {return !d.error && d.hash0==d.hash1}","red": "function (d) {return !!d.error;}"},"watch": "#l-tabname"},"#btn-tabclose": {"bind": "function (d,v) {\n\t\t\t\tif(v!=null) this.my.trigger('#btn-tabclose', 'tabclose', d.id);\n\t\t\t}","events": "click.my"},"#tab-proxy": {"bind": "function () {}","listen": {"appbusy": "function (d,v) {\n\t\t\t\t\tif (!Object.isObject(v) || v.id != d.id) return;\n\t\t\t\t\tthis.my.root().toggleClass('tab-busy',!!v.busy);\n\t\t\t\t}","pathchange": "function (d,v) {\n\t\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\t\tvar that = this,\n\t\t\t\t\t\t\tnewpath = v.path.slice(0);\n\t\t\t\t\tif (v.id != d.id) {\n\t\t\t\t\t\t// other tab changed path, check is this tab a dup\n\t\t\t\t\t\tif (newpath.join('\\ufffd') != d.path.join('\\ufffd')) return;\n\t\t\t\t\t\t// decide should we close\n\t\t\t\t\t\tif (d.hash0 == d.hash1) that.Pho('Close')({tabid:d.id, enforce:true});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// it is all about this tab\n\t\t\t\t\t\td.path = newpath;\n\t\t\t\t\t\td.name = v.title || d.name;\n\t\t\t\t\t\tif(that.Pho('_compiled') && d.active) {\n\t\t\t\t\t\t\tlocation.replace('#'+that.p2u(newpath).join('/'));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthat.my.check('#l-tabname');\t\n\t\t\t\t\t}\n\t\t\t\t}","reload": "function (d,v) {\n\t\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\t\tif (v.id != d.id) return;\n\t\t\t\t\tvar that = this,\n\t\t\t\t\t\t\tnewpath = v.path.slice(0);\n\t\t\t\t\t// Search for app DOM node\n\t\t\t\t\tvar $app = $('#l-apps>#app-'+v.id);\n\n\t\t\t\t\tif ($app.length && $app.is('.my-form')) {\n\t\t\t\t\t\t$app.my('remove');\n\t\t\t\t\t\t$app.remove();\n\t\t\t\t\t\td.run = false;\n\t\t\t\t\t\td.error = false;\n\t\t\t\t\t\td.hash0 = d.hash1 = '';\n\t\t\t\t\t\tif (d.active) that.Pho('Switch')(newpath);\n\t\t\t\t\t}\t\t\n\t\t\t\t}"}}},"HTML": "<a href=\"\" id=\"l-tabname\"></a><div id=\"l-tabstate\" class=\"l-tabmark\">•</div><div id=\"btn-tabclose\" class=\"l-tabmark\" title=\"{BTN_CLOSETAB}\">✕</div><div id=\"tab-proxy\" class=\"hide\"></div>"},"UserDoc": {"id": "cw.Photon.UserDoc","lang": {},"data": {"_id": "org.couchdb.user:","type": "user","name": "","password": "","roles": []},"Roles": [],"Sec": {},"Users": {},"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data,\n        all = that.Pho('All');\n    \n    that.Sec = Object.keys(all).reduce(function(acc, i){\n      var a = all[i].security,\n          adm = a.admins.roles,\n          mem = a.members.roles;\n      adm.forEach(function(e){\n        if (!acc[e]) acc[e] ={a:{}, m:{}};\n        acc[e].a[i] = true;\n      });\n      mem.forEach(function(e){\n        if (!acc[e]) acc[e] ={a:{}, m:{}};\n        acc[e].m[i] = true;\n      });\n      return acc;\n    },{});\n    \n    that.Roles = Object.keys(that.Sec).remove(/^_/).sort();\n    \n    // Prepare HTML\n    if (d._rev) {\n      that.lang.TXT_TITLE = that.lang.TXT_TITLE_ED;\n      that.lang.PLC_P = that.lang.PLC_P_ED;\n    }\n    $o.html($.my.formgen(that.HTML).assign(that.lang));\n    \n    // Load existing users\n    that.Pho('GetUsers')()\n    .then(function(res){\n      that.Users = cw.lib.a2o(res);\n    });\n    \n    $o.then(function(){\n    \tthat.Sel2Scroll($o, true);\n    });\n  }","saveUser": "function (doc) {\n    var that = this,\n        d = doc || that.data,\n        es = function(s){return (s+'').escapeHTML()};\n\n    return that.Req({\n      url:['_users',d._id], \n      method:'PUT',\n      contentType:\t'application/json',\n      //headers:{'Content-type':'application/json'},\n      data:JSON.stringify(d)\n    })\n    .then(function(){\n      cw.lib.note(that.lang.MSG_OK.assign(es(d.name)), 'ok');\n      $.my.radio('dbupdate','_users');\n    })\n    .fail(function(code, err){\n      cw.lib.note(that.lang.MSG_FAIL.assign(es(d.name), code, es(err)), 'error');\n    })\n\n  }","ui": {"#uname": {"bind": "function (d,v) {\n      if (v!=null) {\n        d.name = v;\n        d._id = 'org.couchdb.user:'+v;\n      }\n      return d.name;\n    }","check": "function (d,v) {\n      if (v.has(':') || /^_/.test(v)) return this.lang.ERR_N;\n      if (this.Users[v] && !d._rev) return this.lang.ERR_NX;\n    }","css": {":disabled": "function (d) {return !!d._rev;}","self:xgray": "function (d) {return !!d._rev;}"}},"#upass": "password","#uroles": {"init": "function ($o) { this.S2('#uroles',this.Roles,'PLC_R'); }","bind": "roles","check": "function (d,v) {\n      if (v.find(/^_/)) return this.lang.ERR_R;\n    }"},"#uaccess": {"delay": 50,"bind": "function (d,v) {\n    \tif (!d.roles.length) return '';\n      var that=this,\n          sec = that.Sec,\n          a = {}, sa = [],\n          m = {}, sm = [],\n          h = [],\n          t = '<span class=\"fw500\">{1} </span> {2}';\n      d.roles.forEach(function(r){\n      \tif (!sec[r]) return;\n        $.extend(a, sec[r].a);\n        $.extend(m, sec[r].m);\n      });\n      \n      sa = Object.keys(a).sort();\n      sm = Object.keys(m).subtract(sa).sort();\n      if (sa.length) {\n        if (sa.length > 20) h.push (t.assign('Admin', 'of '+sa.length+' DBs'));\n        else h.push (t.assign('Admin:', sa.join(', ')));\n      }\n      if (sm.length) {\n        if (sm.length > 20) h.push (t.assign('Member', 'of '+sm.length+' DBs'));\n        else h.push (t.assign('Member:', sm.join(', ')));\n      }\n      if (v==null) that.my.trigger('#uaccess', 'layout');\n      return h.join('<br>');\n    }","watch": "#uroles","css": {"hide": "function (d) {return !d.roles.length}"}},"#btn-start": {"bind": "function (d,v) {\n      if (v==null) return;\n      var that = this;\n      if (!d._rev) {\n        // New user\n        that.saveUser().then(function(){that.my.cancel();});\n      }\n      else {\n      \tvar doc = cw.lib.dry(Object.clone(d,!0));\n        if (!doc.password) delete doc.password;\n        else {\n        \tdelete doc.derived_key;\n          delete doc.iterations;\n          delete doc.password_scheme;\n        }\n        that.saveUser(doc).then(function(){that.my.cancel();});\n      }\n    }","watch": ["#uname","#uroles","#upass"],"css": {":disabled": "function (d,v) {\n        return !this.my.valid() || !d.name || (!d.password && !d._rev);\n      }"}},"#btn-otherdoc": {"bind": "function (d,v) {if(v!=null) this.my.cancel()}","css": {"self:hide": "function (d,v) {return !!d._rev || !!d.name || !!d.password || d.roles.length>0;}"},"watch": ["#uname","#upass","#uroles"]},"#btn-cancel": "function (d,v) {if(v!=null) this.my.cancel()}"},"die": "function ($o) {\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  }","S2": "function (sel,tags,dict) {\n\t\tthis.my.find(sel).select2({\n\t\t\ttags:tags,\n\t\t\tplaceholder:this.lang[dict],\n\t\t\tminimumResultsForSearch:12,\n\t\t\ttokenSeparators:[' ',',']\n\t\t});\n\t}","HTML": ["<div id=\"ctitle\" class=\"fs130 mb2 lh160 bolder\">{TXT_TITLE}</div>",{"row": "100%","label": "75px","rowCss": "my-row pt3 pb3","labelCss": "my-label"},["{LBL_N}","inp#uname.fs110",{"plc": "{PLC_N}"},"msg"],["{LBL_P}","inp#upass.fs110",{"plc": "{PLC_P}"},"msg"],{"rowCss": "my-row pt7 pb3","labelCss": "my-label vat pt6"},["{LBL_R}","inp#uroles.fs105","msg"],"<div id=\"uaccess\" class=\"hide ell w100p fs90 gray lh130 mt4 mb-4 pl75\"></div>","<div class=\"mt12 pt15 btd\">","<button id=\"btn-start\" class=\"green mr2\">{BTN_SAVE}</button>","<button id=\"btn-cancel\">{BTN_CANCEL}</button>","<div class=\"fr\">","<a href=\"#_users/_new\" id=\"btn-otherdoc\" class=\"button tdn dib vat\">","<span class=\"\">{BTN_DOC}</span>","</a>","</div>","</div>"],"style": {" input": "display:inline-block;"," .select2-container>.select2-choices": "max-height:160px;"}},"Login": {"id": "cw.Photon.Login","lang": {},"data": {"name": "","password": ""},"init": "function ($o) {\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang));\n\t\t\n\t\t// Mount Enter keypress handlers\n\t\t$o.find('#upwd').on('keyup.my', function(event) {\n\t\t\tvar code = event.keyCode;\n\t\t\tif (code==13 || code==10) $o.find('#btn-send').trigger('click');\n\t\t});\n\t\t$o.find('#uname').on('keyup.my', function(event) {\n\t\t\tvar code = event.keyCode;\n\t\t\tif (code==13 || code==10) $o.find('#upwd').focus();\n\t\t});\n\t}","ui": {"#uname": "name","#upwd": "password","#btn-send": {"delay": 10,"bind": "function (d,v) {\n\t\t\t\tif(v==null) return;\n\t\t\t\tvar that = this;\n\t\t\t\tthat.doLogin()\n\t\t\t\t.then(function(){ that.my.cancel(); });\n\t\t\t}","css": {":disabled": "function (d,v) { return !d.name || !d.password; }"},"watch": ["#uname","#upwd"]},"#btn-cancel": "function (d,v) {\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}"},"HTML": "<div class=\"fs150 lh140 bolder mb8\">{TXT_LOGIN}</div><input class=\"w100p fs120 mb10\" id=\"uname\" type=\"text\" placeholder=\"{PLC_UNAME}\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><input class=\"w100p fs120 mb10\" id=\"upwd\" type=\"password\" placeholder=\"{PLC_PWD}\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><div class=\"pt10 btd\"><button id=\"btn-send\" class=\"green mr2\">{BTN_LOGIN}</button><button id=\"btn-cancel\">{BTN_CANCEL}</button></div>","doLogin": "function () {\n\t\tvar that = this,\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tcreds = $.extend(true,{},that.data),\n\t\t\t\tl = that.lang;\n    \n    that.my.root().parent().addClass('modal-busy');\n    \n\t\treturn that.Req({\n\t\t\turl:['_session'], method:'POST', dataType:'json',\n      contentType:\t'application/json',\n\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\tdata:JSON.stringify(creds)\n\t\t})\n\t\t.then(function(res){\n\t\t\t// reload db list and related\n\t\t\tvar me = {name:res.name || creds.name, roles:res.roles};\n\t\t\tif (compiled) $.extend(true, window.DDOC._me, me);\n\t\t\t$.my.radio('userCtx',me);\n\t\t\t//that.Pho('my').check('#btn-aside-auth');\n\t\t\tcw.lib.note(l.MSG_AUTH_OK.assign((creds.name||'').escapeHTML()), 'ok' );\n\t\t})\n\t\t.fail(function(code, err){\n\t\t\tif (compiled) $.extend(window.DDOC._me, {name:'',roles:[]});\n\t\t\t$.my.radio('userCtx',{name:null,roles:[]});\n\t\t\tthat.Pho('my').check('#btn-aside-auth');\n\t\t\tcw.lib.note(l.MSG_AUTH_FAIL.assign(\n\t\t\t\t(creds.name||'').escapeHTML(),\n\t\t\t\tcode,\n\t\t\t\terr.escapeHTML()\n\t\t\t), 'error' );\n\t\t})\n    .always(function(){\n    \tthat.my.root().parent().removeClass('modal-busy');\n    });\n\t}"},"Logout": {"id": "cw.Photon.Logout","lang": {},"data": {},"init": "function ($o) {\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang))\n\t}","HTML": "<div id=\"ltitle\" class=\"mb6 lh140\"></div><div class=\"gray pl1\"><div id=\"xprofile\"><span class=\"fi-torso\"></span> <a id=\"btn-profile\" href=\"\" class=\"pseudolink tdn\">{TXT_PROFILE}</a></div><div><span class=\"fi-power\"></span> <span id=\"btn-logout\" class=\"pseudolink tdn\">{TXT_LOGOUT}</span></div></div>","ui": {"#ltitle": {"bind": "function (d,v) {\n\t\t\t\tvar h = '<div class=\"fs130 xgray lh120 w100p oh ell\">{1}</div>'.assign(cw.me().escapeHTML());\n\t\t\t\tvar r = cw.me('roles') || [];\n\t\t\t\tif (r.length) {\n\t\t\t\t\th+='<div class=\"gray fs90\">{1}</div>'.assign(r.map(function(s){\n\t\t\t\t\t\treturn '<nobr>'+s.escapeHTML()+'</nobr>'\n\t\t\t\t\t}).join(', '));\n\t\t\t\t}\n\t\t\t\treturn h;\n\t\t\t}"},"#btn-profile": {"delay": 30,"bind": "function (d,v,$o) {\n\t\t\t\t$o.attr('href','#_users/'+('org.couchdb.user:'+cw.me()));\n\t\t\t\tif (v!=null) this.my.cancel();\n\t\t\t}"},"#btn-logout": {"delay": 30,"bind": "function (d,v,$o) {\n\t\t\t\tif (v==null) return;\n\t\t\t\tthis.doLogout();\n\t\t\t\tthis.my.cancel();\n\t\t\t}"}},"doLogout": "function () {\n\t\tvar that = this,\n\t\t\t\tl = that.lang,\n\t\t\t\tes = function(s){return (s+'').escapeHTML()};\n\t\tcw.lib.note(l.MSG_LOGOUT_START, '', 1000);\n\t\tthat.Req({\n\t\t\turl:['_session'], method:'POST', dataType:'json',\n      contentType:\t'application/json',\n\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\tdata:JSON.stringify({name:'0',password:'0'})\n\t\t})\n\t\t.then(function(res){\n\t\t\tcw.lib.note(l.MSG_LOGOUT_FAIL.assign(999,'Server returned invalid response'), 'error');\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\tif (code!=401 && code !=403) {\n\t\t\t\tcw.lib.note(l.MSG_LOGOUT_FAIL.assign(code,es(err)), 'error');\n\t\t\t\tthat.Pho('my').check('#btn-aside-auth');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcw.lib.note(l.MSG_LOGOUT_OK, 'ok');\n\t\t\t}\n\t\t})\n\t}"},"Compact": {"id": "cw.Photon.Compact","lang": {},"data": {"selection": [],"ops": ["docs"],"ddocs": [],"dselection": []},"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\td.All = that.Pho('All');\n\t\td.all = Object.keys(d.All).sort();\n\t\t$o.html(that.HTML.assign(that.lang));\n    $o.then((function(){\n    \tthat.Sel2Scroll($o, true);\n    }).debounce(15));\n\t}","ui": {"#ctitle": {"bind": "function (d) {\n\t\t\t\treturn d.selection.length==1?this.lang.TXT_TITLE1:this.lang.TXT_TITLE;\n\t\t\t}","watch": ["#dbs"]},"#dbs": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:this.data.all.map(function(e){return {id:e,text:e} }),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t}","bind": "selection","check": "function (d,v) {return !v.length?this.lang.ERR_DBS:''}","css": {":disabled": "function (d) {return d.ddocs.length>0}"}},"#dbops": {"init": "function ($o) {\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:this.lang.TAG_OP.to(this.data.ddocs.length?3:2)\n\t\t\t\t})\n\t\t\t}","bind": "ops","check": "function (d,v) {return !v.length?this.lang.ERR_OP:''}"},"#ddocs": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:this.data.ddocs.map(function(e){return {id: e,text:'_design/'+e} }),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DDOCS,\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t}","bind": "dselection","check": "function (d,v) {return !v.length && d.ops.indexOf('ddocs')>-1?this.lang.ERR_DDOCS:''}","css": {"hide": "function (d,v) {return d.ops.indexOf('ddocs')==-1 || d.selection.length!=1}"},"watch": ["#dbops","#dbs"]},"#btn-start": {"delay": 50,"bind": "function (d,v) {\n\t\t\t\tif(v==null) return;\n\t\t\t\ttry {\n\t\t\t\t\tthis.doCompact();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.cancel();\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn !d.selection.length || !d.ops.length || !this.my.valid();\n\t\t\t\t}"},"watch": ["#dbs","#dbops","#ddocs"]},"#btn-cancel": "function (d,v) {\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}"},"doCompact": "function () {\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.selection.length;\n\t\t\n\t\tif (!res.ops.length || !ctr || !Object.keys(res.All).intersect(res.selection).length) return;\n\n\t\tres.selection.forEach(function(db){\n\n\t\t\tvar pis = [];\n\t\t\t// compact docs\n\t\t\tif (res.ops.find('docs')) pis.push(\n\t\t\t\tthat.Req({\n\t\t\t\t\turl:[db,'_compact'], \n\t\t\t\t\tmethod:'POST',\n          contentType:\t'application/json',\n\t\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t\t}).\n\t\t\t\tfail(function(code, err, msg){\n\t\t\t\t\tconsole.log('Error starting data compaction of '+db, code, err, msg);\n\t\t\t\t})\n\t\t\t);\n\t\t\t// purge old views\n\t\t\tif (res.ops.find('views')) pis.push(\n\t\t\t\tthat.Req({\n\t\t\t\t\turl:[db,'_view_cleanup'], \n\t\t\t\t\tmethod:'POST', \n          contentType:\t'application/json',\n\t\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t\t}).\n\t\t\t\tfail(function(code, err, msg){\n\t\t\t\t\tconsole.log('Error starting purging old views of '+db, code, err, msg);\n\t\t\t\t})\n\t\t\t);\n\t\t\t\n\t\t\t// compact views\n\t\t\tif (res.ops.find('ddocs')) {\n\t\t\t\tres.dselection.compact(true)\n\t\t\t\t.forEach(function(ddoc){\n\t\t\t\t\tpis.push(\n\t\t\t\t\t\tthat.Req({\n\t\t\t\t\t\t\turl:[db,'_compact', ddoc], \n\t\t\t\t\t\t\tmethod:'POST',\n              contentType:\t'application/json',\n\t\t\t\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t\t\t\t}).\n\t\t\t\t\t\tfail(function(code, err, msg){\n\t\t\t\t\t\t\tconsole.log('Error starting view compaction of '+db+'/_design/'+ddoc, code, err, msg);\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tQ.all(pis)\n\t\t\t.then(function(res){\n\t\t\t\tcw.lib.note(l.MSG_COMPACT_START.assign(db));\n\t\t\t\t_end();\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(l.MSG_COMPACT_FAIL_SOME, 'error');\n\t\t\t\t_end();\n\t\t\t});\n\n\t\t}.lazy(that.Pho('Cfg').batchCompactDelay));\n\t\t\n\t\tfunction _end(){\n\t\t\tctr-=1;\n\t\t\tif (ctr>0) return;\n      [700, 2500, 7500, 15000].forEach(function(i){\n      \t_relist.debounce(i)();\n      });\n\t\t}\n\t\t\n\t\tfunction _relist(){ $.my.radio('dblist', res.selection); }\n\t}","die": "function ($o) {\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  }","HTML": "<div id=\"ctitle\" class=\"fs130 mb10 bolder\">{TXT_TITLE}</div><div class=\"mb10 fs105\"><input id=\"dbs\" class=\"w100p\"></div><div class=\"mb10\"><span id=\"dbops\"></span></div><div class=\"mb10 fs105 hide\"><input id=\"ddocs\" class=\"w100p\"></div><div class=\"mt10 pt10 btd\"><button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button><button id=\"btn-cancel\">{BTN_CANCEL}</button></div>","style": {" input": "display:inline-block;"," .select2-container>.select2-choices": "max-height:214px;"}},"NewDB": {"id": "cw.Photon.NewDB","lang": {},"data": {"dbs": [],"all": [],"allo": {},"users": [],"roles": [],"admins": {"names": [],"roles": []},"members": {"names": [],"roles": []}},"Users": [],"S2": "function (sel,tags,dict) {\n\t\tthis.my.find(sel).select2({\n\t\t\ttags:tags,\n\t\t\tplaceholder:this.lang[dict],\n\t\t\tminimumResultsForSearch:12,\n\t\t\ttokenSeparators:[' ',',']\n\t\t});\n\t}","init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data,\n        all = that.Pho('All');\n\t\td.all = Object.keys(all),\n\t\td.allo = cw.lib.a2o(d.all);\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n    \n    d.roles = Object.keys(Object.keys(all).reduce(function(acc, i){\n      var a = all[i].security,\n          b = [].add(a.admins.roles).add(a.members.roles);\n      b.forEach(function(e){acc[e]=true;})\n      return acc;\n    },{})).add('_admin').unique().sort();\n\t\t\n\t\tQ.all([that.Pho('GetUsers')().then(function(res){d.users = res; }), $o])\n\t\t.then(function(){\n\t\t\tthat.S2('#uadm',that.data.users,'PLC_UADM');\n\t\t\tthat.S2('#umem',that.data.users,'PLC_UMEM');\n      // nicescroll all select2-s\n      that.Sel2Scroll($o, true);\n\t\t});\n\t}","ui": {"#ctitle": {"bind": "function (d) {\n\t\t\t\treturn d.dbs.length==1?this.lang.TXT_TITLE1:this.lang.TXT_TITLE;\n\t\t\t}","watch": ["#dbs"]},"#dbs": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[],\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12,\n\t\t\t\t\ttokenSeparators:[' ',',']\n\t\t\t\t});\n\t\t\t}","bind": "dbs","check": "function (d,v) {\n\t\t\t\tvar exist = [],\n\t\t\t\t\t\tnames=[],\n\t\t\t\t\t\tund = [];\n\t\t\t\tv.forEach(function(e){\n\t\t\t\t\tif (d.allo[e]) exist.push(e);\n\t\t\t\t\tif (!/^[a-z0-9_$\\(\\)\\+\\-\\/]+$/.test(e)) names.push(e);\n\t\t\t\t\tif (!/^[a-z]/.test(e)) und.push(e);\n\t\t\t\t});\n\t\t\t\tif (exist.length) return this.lang.ERR_DB_EXIST.assign(exist.join(', ').escapeHTML());\n\t\t\t\tif (names.length) return this.lang.ERR_DB_NAME;\n\t\t\t\tif (und.length) return this.lang.ERR_DB_UND;\n\t\t\t}"},"#uadm": {"init": "function ($o) { this.S2('#uadm',this.data.users,'PLC_UADM'); }","bind": "admins.names","check": "function (d,v) {\n      \treturn this.isUnames(v);\n      }"},"#gadm": {"init": "function ($o) { this.S2('#gadm',this.data.roles,'PLC_GADM'); }","bind": "admins.roles"},"#umem": {"init": "function ($o) { this.S2('#umem',this.data.users,'PLC_UMEM'); }","bind": "members.names","check": "function (d,v) {\n      \treturn this.isUnames(v);\n      }"},"#gmem": {"init": "function ($o) { this.S2('#gmem',this.data.roles,'PLC_GMEM'); }","bind": "members.roles"},"#btn-start": {"bind": "function (d,v) {\n\t\t\t\tif(v==null) return this.lang['BTN_START'+(!(d.members.names+d.members.roles)?'_PUBLIC':'')];\n\t\t\t\ttry {\n\t\t\t\t\tthis.doCreate();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.cancel();\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn !d.dbs.length || !this.my.valid();\n\t\t\t\t}","self:orange": "function (d) {\n\t\t\t\t\treturn !(d.members.names+d.members.roles);\n\t\t\t\t}","self:green": "function (d) {\n\t\t\t\t\treturn !!(d.members.names+d.members.roles);\n\t\t\t\t}"},"watch": ["#dbs","#umem","#gmem"]},"#btn-cancel": "function (d,v) {\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}"},"doCreate": "function () {\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.dbs.length;\n\t\t\n\t\tvar acl = Object.select(res,['admins','members']),\n\t\t\t\tpublic = !(acl.members.names+acl.members.roles),\n\t\t\t\tnoacl = !(acl.admins.names+acl.admins.roles+acl.members.names+acl.members.roles),\n\t\t\t\tdbs = res.dbs;\n\t\tif (!ctr) return;\n\n\t\tdbs.forEach(function(db, i){\n\t\t\t// Create DB\n\t\t\tthat.Req({\n\t\t\t\turl:[db], \n\t\t\t\tmethod:'PUT',\n        contentType:\t'application/json',\n\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\t// set secObj\n\t\t\t\tif (!noacl) {\n\t\t\t\t\tthat.Req({\n\t\t\t\t\t\turl:[db,'_security'], \n\t\t\t\t\t\tmethod:'PUT', \n            contentType:\t'application/json',\n\t\t\t\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\t\t\t\tdata:JSON.stringify(acl)\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tcw.lib.note(l.MSG_NEWDB_START.assign(db));\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\t\tcw.lib.note(l.MSG_NEWDB_NOACL.assign(db, code, es(err)), 'warning');\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\tif (i==ctr-1) $.my.radio('dblist',dbs);;\n\t\t\t\t\t}); // -- end set secObj\n\t\t\t\t} \n\t\t\t\telse {\n\t\t\t\t\tcw.lib.note(l.MSG_NEWDB_START.assign(db));\n\t\t\t\t\tif (i==ctr-1) $.my.radio('dblist',dbs);;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(that.lang.MSG_NEWDB_FAIL.assign(db, code, es(err)), 'error');\n\t\t\t});\n\t\t\t\n\t\t}.lazy(that.Pho('Cfg').batchCreateDelay));\n\t}","isUnames": "function (a) {\n  \tvar e = '',\n        that = this;\n    a.forEach(function(v){\n      if (v=='_admin') return;\n    \tif (v.has(':') || /^_/.test(v)) e = that.lang.ERR_UNAME;  \n    });\n    return e;\n  }","die": "function ($o) {\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  }","HTML": ["<div id=\"ctitle\" class=\"fs130 mb2 lh160 bolder\">{TXT_TITLE}</div>",{"row": "100%","label": "60px","rowCss": "my-row pt3 pb3","labelCss": "my-label"},["{LBL_DBS}","inp#dbs.fs105","msg"],"<div class=\"fs120 mt10 mb2\">{TXT_ADM}</div>",["{LBL_UADM}","inp#uadm.fs105","msg"],["{LBL_GADM}","inp#gadm.fs105","msg"],"<div class=\"fs120 mt10 mb2\">{TXT_MEM}</div>",["{LBL_UADM}","inp#umem.fs105","msg"],["{LBL_GADM}","inp#gmem.fs105","msg"],"<div class=\"mt12 pt15 btd\">","<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>","<button id=\"btn-cancel\">{BTN_CANCEL}</button>","</div>"],"style": {" input": "display:inline-block;"," .select2-container>.select2-choices": "max-height:56px;"}},"DelDB": {"id": "cw.Photon.DelDB","lang": {},"data": {"dbs": [],"all": [],"allo": {}},"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\td.all = d.dbs.slice(0),\n\t\td.allo = cw.lib.a2o(d.all);\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n    $o.then((function(){\n    \tthat.Sel2Scroll($o, true);\n    }).debounce(15));\n\t}","ui": {"#ctitle": {"bind": "function (d) {\n\t\t\t\treturn d.dbs.length==1?this.lang.TXT_TITLE1:this.lang.TXT_TITLE;\n\t\t\t}","watch": ["#dbs"]},"#dbs": {"init": "function ($o) {\n\t\t\t\tvar dbs = this.data.all;\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:dbs.map(function(e){return {id:e,text:e} }),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12,\n\t\t\t\t\treadOnly:dbs.length == 1\n\t\t\t\t});\n\t\t\t}","bind": "dbs","check": "function (d,v) {return !v.length?this.lang.ERR_DBS:''}","css": {":disabled": "function (d) {return d.all.length==1}"}},"#delwarn": {"bind": "function (d,v) {\n\t\t\t\tvar that =this,\n\t\t\t\t\t\tc = { size:0, count:0, disk:0 },\n\t\t\t\t\t\tall = that.Pho('All');\n\t\t\t\td.dbs.forEach(function(k){\n\t\t\t\t\tvar db = all[k];\n\t\t\t\t\tif (!db) return;\n\t\t\t\t\tc.size += (+db.data_size || 0);\n\t\t\t\t\tc.disk += (+db.disk_size || 0);\n\t\t\t\t});\n\t\t\t\tc.count = d.dbs.length;\n\t\t\t\tif (!d.dbs.length) return '';\n\t\t\t\treturn that.lang.TXT_WARN(c);\n\t\t\t}","watch": "#dbs"},"#btn-start": {"bind": "function (d,v) {\n\t\t\t\tif(v==null) return this.lang.BTN_START(d.dbs.length);\n\t\t\t\ttry {\n\t\t\t\t\tthis.doDeleteZ();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.commit();\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn !d.dbs.length || !this.my.valid();\n\t\t\t\t}"},"watch": ["#dbs"]},"#btn-cancel": "function (d,v) {\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}"},"doDeleteZ": "function () {\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.dbs.length;\n\t\t\n\t\tvar dbs = res.dbs;\n\t\tif (!ctr) return;\n\n\t\tdbs.forEach(function(db, i){\n\t\t\tthat.Req({\n\t\t\t\turl:[db], \n\t\t\t\tmethod:'DELETE', \n\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tcw.lib.note(l.MSG_OK.assign(db), 'ok');\n\t\t\t\t$.my.radio('dbdeleted', db);\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(l.MSG_FAIL.assign(db, code, es(err)), 'error');\n\t\t\t})\n\t\t\t.always(function(){\n\t\t\t\tif (i==ctr-1) {\n\t\t\t\t\t$.my.radio('dblist',[]);\n\t\t\t\t}\n\t\t\t}); // -- end set secObj\n\t\t\t\n\t\t}.lazy(that.Pho('Cfg').batchCreateDelay));\n\t}","die": "function ($o) {\n  \t// Unmount niceScroll\n\t\tthis.Sel2Scroll($o, false);\n  }","HTML": ["<div id=\"ctitle\" class=\"fs130 mb2 lh160 bolder red\">{TXT_TITLE}</div>","<div class=\"mb10 fs105\"><input id=\"dbs\" class=\"w100p\"></div>","<div class=\"mb10\"><span id=\"delwarn\"></span></div>","<div class=\"mt12 pt15 btd\">","<button id=\"btn-start\" class=\"red mr2\">{BTN_START}</button>","<button id=\"btn-cancel\">{BTN_CANCEL}</button>","</div>"],"style": {" .select2-container>.select2-choices": "max-height:214px;"}},"SecObj": {"id": "cw.Photon.SecObj","lang": {},"data": {"dbs": [],"all": [],"allo": {},"users": [],"roles": [],"admins": {"names": [],"roles": []},"members": {"names": [],"roles": []}},"Users": [],"S2": "function (sel,tags,dict) {\n\t\tthis.my.find(sel).select2({\n\t\t\ttags:tags,\n\t\t\tplaceholder:this.lang[dict],\n\t\t\tminimumResultsForSearch:12\n\t\t});\n\t}","init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data,\n        all = that.Pho('All');\n\t\td.all = Object.keys(all).sort(),\n\t\td.allo = cw.lib.a2o(d.all);\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n    \n    d.roles = Object.keys(Object.keys(all).reduce(function(acc, i){\n      var a = all[i].security,\n          b = [].add(a.admins.roles).add(a.members.roles);\n      b.forEach(function(e){acc[e]=true;})\n      return acc;\n    },{}))\n    .add('_admin')\n    .unique()\n    .sort();\n\t\t\n\t\tQ.all([that.Pho('GetUsers')().then(function(res){d.users = res; }), $o])\n\t\t.then(function(){\n      // add users to dropdowns\n\t\t\tthat.S2('#uadm',that.data.users,'PLC_UADM');\n\t\t\tthat.S2('#umem',that.data.users,'PLC_UMEM');\n      // re-layout\n\t\t\t$o.trigger('layout');\n      // nicescroll all select2-s\n      that.Sel2Scroll($o, true);\n\t\t});\n\t}","ui": {"#dbs": {"init": "function ($o) {\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:this.data.all.map(function(e){\n\t\t\t\t\t\treturn {id:e,text:e}\n\t\t\t\t\t}),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t}","bind": "dbs","check": "function (d,v) {return !v.length?this.lang.ERR_DBS:''}"},"#uadm": {"init": "function ($o) { this.S2('#uadm',this.data.users,'PLC_UADM'); }","bind": "admins.names","check": "function (d,v) {\n      \treturn this.isUnames(v);\n      }"},"#gadm": {"init": "function ($o) { this.S2('#gadm',this.data.roles,'PLC_GADM'); }","bind": "admins.roles"},"#umem": {"init": "function ($o) { this.S2('#umem',this.data.users,'PLC_UMEM'); }","bind": "members.names","check": "function (d,v) {\n      \treturn this.isUnames(v);\n      }"},"#gmem": {"init": "function ($o) { this.S2('#gmem',this.data.roles,'PLC_GMEM'); }","bind": "members.roles"},"#btn-start": {"bind": "function (d,v) {\n\t\t\t\tif(v==null) return this.lang.BTN_START;\n\t\t\t\ttry {\n\t\t\t\t\tthis.doSecUpdate();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.cancel();\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn !d.dbs.length || !this.my.valid();\n\t\t\t\t}"},"watch": ["#dbs","#umem","#gmem"]},"#btn-cancel": "function (d,v) { if(v!=null) this.my.cancel(); }","#layproxy": {"delay": 150,"watch": ["#dbs","#uadm","#gadm","#umem","#gmem"],"bind": "function () {\n      \tthis.my.trigger('#layproxy', 'layout');\n      }"}},"isUnames": "function (a) {\n  \tvar e = '',\n        that = this;\n    a.forEach(function(v){\n      if (v=='_admin') return;\n    \tif (v.has(':') || /^_/.test(v)) e = that.lang.ERR_UNAME;  \n    });\n    return e;\n  }","doSecUpdate": "function () {\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.dbs.length;\n\t\t\n\t\tvar acl = Object.select(res,['admins','members']),\n\t\t\t\tpublic = !(acl.members.names+acl.members.roles),\n\t\t\t\tnoacl = !(acl.admins.names+acl.admins.roles+acl.members.names+acl.members.roles),\n\t\t\t\tdbs = res.dbs;\n\t\tif (!ctr) return;\n\n\t\tdbs.forEach(function(db, i){\n\t\t\tthat.Req({\n\t\t\t\turl:\t\t\t\t\t[db,'_security'], \n\t\t\t\tmethod:\t\t\t\t'PUT',\n        contentType:\t'application/json',\n\t\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\t\tdata:\t\t\t\t\tJSON.stringify(acl)\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tcw.lib.note(l.MSG_OK.assign(db), 'ok');\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(l.MSG_FAIL.assign(db, code, es(err)), 'error');\n\t\t\t})\n\t\t\t.always(function(){\n\t\t\t\tif (i==ctr-1) $.my.radio('dblist',dbs);;\n\t\t\t}); // -- end set secObj\n\t\t\t\n\t\t}.lazy(that.Pho('Cfg').batchCreateDelay));\n\t}","die": "function ($o) {\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  }","HTML": ["<div class=\"fs130 mb2 lh160 bolder\">{TXT_TITLE}</div>",{"row": "100%","label": "60px","rowCss": "my-row pt3 pb3","labelCss": "my-label"},["{LBL_DBS}","inp#dbs.fs105","msg"],"<div class=\"fs120 mt10 mb2\">{TXT_ADM}</div>",["{LBL_UADM}","inp#uadm.fs105","msg"],["{LBL_GADM}","inp#gadm.fs105","msg"],"<div class=\"fs120 mt10 mb2\">{TXT_MEM}</div>",["{LBL_UADM}","inp#umem.fs105","msg"],["{LBL_GADM}","inp#gmem.fs105","msg"],"<div class=\"mt12 pt15 btd\">","<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>","<button id=\"btn-cancel\">{BTN_CANCEL}</button>","</div>","<div id=\"layproxy\" class=\"hide\"></div>"],"style": {" input": "display:inline-block;"," .select2-container>.select2-choices": "max-height:56px;"}},"NewSync": {"id": "cw.Photon.NewSync","lang": {},"data": {"doc": "","mode": "","source": "","target": "","filter": "","doc_ids": [],"query": {}},"init": "function ($o) {\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\t// align width and generate HTML\n\t\t// that.HTML[0].row = that.params.width+'px';\n\t\tthat.HTML[0].label = that.params.width>450?'115px':'95px';\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang).assign(that.Pho('ReplicatorDB')));\n\t\t\n\t\t// autosize textareas\n\t\t$o.find('textarea').each(function(){\n\t\t\t$(this).on('input.my,keyup.my',function(){\n\t\t\t\t$(this).height(0).height((this.scrollHeight-10).clamp(19,100));\n\t\t\t});\n\t\t})\n\t\t\n\t\t$o.then(function(){\n\t\t\t$o.find('textarea').each(function(){$(this).trigger('input')});\n\t\t}.debounce(20))\n\t}","die": "function ($o) {\n\t\t$o.find( \"#rsource\" ).autocomplete( 'destroy' );\n\t\t$o.find( \"#rtarget\" ).autocomplete( 'destroy' );\n\t}","ui": {"#rmode": {"init": "function ($o) {$o.tags(this.lang.TAG_MODE)}","bind": "mode"},"#xrdocid": {"css": {"hide": "function (d,v) {return d.mode!='doc'}"},"watch": "#rmode"},"#rdocid": {"bind": "doc","check": "function (d,v) {\n\t\t\t\tif (d.mode != 'doc') return;\n\t\t\t\tif (!v) return this.lang.ERR_ID;\n\t\t\t\tif (v[0] == '_') return this.lang.ERR_ID_UND;\n\t\t\t}","watch": "#rmode"},"#rsource": {"init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (!that.data.source) $o.autocomplete({\n\t\t\t\t\tsource: this.DBs, \n\t\t\t\t\tselect: (function(o, ui){that.my.check('#rtarget') }).debounce(10),\n\t\t\t\t\tappendTo: that.my.root()\n\t\t\t\t});\n\t\t\t}","bind": "source","check": "function (d,v) {\n\t\t\t\tif (!v) return;\n\t\t\t\tif (this.DBs.indexOf(v)==-1 && !/^http[s]?:\\/\\/.+$/.test(v)) return this.lang.ERR_FROM;\n\t\t\t}","events": "blur.my"},"#rtarget": {"init": "function ($o) {\n\t\t\t\tvar that = this;\n\t\t\t\tif (!that.data.target) $o.autocomplete({\n\t\t\t\t\tsource: this.DBs, \n\t\t\t\t\tselect: (function(o, ui){that.my.check('#rtarget') }).debounce(10),\n\t\t\t\t\tappendTo: that.my.root()\n\t\t\t\t});\n\t\t\t}","bind": "target","check": "function (d,v) {\n\t\t\t\tif (!v) return;\n\t\t\t\tif (this.DBs.indexOf(v)==-1 && !/^http[s]?:\\/\\/.+$/.test(v)) return this.lang.ERR_TO;\n\t\t\t\tif (v && v==d.source) return this.lang.ERR_DUP;\n\t\t\t}","watch": "#rsource"},"#rdocs": {"check": "function (d,v) {\n\t\t\t\tif (!v) return;\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isArray(j) || !j.length || j.find(function(e){return typeof e!='string';}))\n\t\t\t\t\treturn this.lang.ERR_DOCS;\n\t\t\t}","bind": "function (d,v) {\n\t\t\t\tif (v==null) return !d.doc_ids.length?'':cw.lib.json(d.doc_ids,'  ');\n\t\t\t\tif (v=='') {\n\t\t\t\t\td.doc_ids = [];\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isArray(j) || !j.length || j.find(function(e){return typeof e!='string';})) return v;\n\t\t\t\td.doc_ids = j;\n\t\t\t\treturn v;\n\t\t\t}"},"#rfilter": {"bind": "filter","check": "function (d,v) {\n\t\t\t\tif (!v) return;\n\t\t\t\tif (v[0] == '_') return this.lang.ERR_FN_DESIGN;\n\t\t\t\tif (!/^[^_].*\\/[^\\/]+$/.test(v)) return this.lang.ERR_FN;\n\t\t\t}"},"#xrquery": {"css": {"hide": "function (d,v) {return d.mode != 'doc' || !/^[^_].*\\/[^\\/]+$/.test(d.filter)}"},"watch": ["#dmode","#rfilter","#rdocid"]},"#rquery": {"check": "function (d,v) {\n\t\t\t\tif (!v) return;\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isObject(j) || !Object.size(j)) return this.lang.ERR_QRY;\n\t\t\t}","bind": "function (d,v) {\n\t\t\t\tif (v==null) return !Object.size(d.query)?'':cw.lib.json(d.query,'  ');\n\t\t\t\tif (v=='') {\n\t\t\t\t\td.query = {};\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isObject(j) || !Object.size(j)) return v;\n\t\t\t\td.query = j;\n\t\t\t\treturn v;\n\t\t\t}"},"#btn-start": {"delay": 60,"bind": "function (d,v) { \n\t\t\t\tif(v!=null) {\n\t\t\t\t\ttry {this.doSync();}catch(e){console.log(e);}\n\t\t\t\t\tthis.my.cancel();\n\t\t\t\t}\n\t\t\t\treturn d.mode=='doc'?this.lang.BTN_START_DOC:this.lang.BTN_START;\n\t\t\t}","css": {":disabled": "function (d,v) {\n\t\t\t\t\treturn !this.my.valid() || !d.source || !d.target;\n\t\t\t\t}"},"watch": ["#rsource","#rtarget","#rfilter","#rdocs","#rdocid","#rquery"]},"#btn-clear": {"delay": 60,"bind": "function (d,v) { \n\t\t\t\tif(v!=null) {\n\t\t\t\t\t$.extend(d,{doc:'', mode:'', source:'', target:'', filter:'', doc_ids:[], query:{} });\n\t\t\t\t\tthis.my.cancel();\n\t\t\t\t}; \n\t\t\t}"},"#btn-cancel": "function (d,v) { if(v!=null) this.my.cancel(); }"},"DBs": [],"HTML": [{"row": "100%","rowCss": "my-row pt3 pb3","label": "100px","labelCss": "my-label dib vat mt8"},"<div class=\"fs130 lh160 bolder\">{TXT_TITLE}</div>",["{LBL_MODE}","div#rmode.dib.vat.fs105.lh180"],"<div id=\"xrdocid\" class=\"hide\">",["{LBL_ID}","inp#rdocid.w100p.fs105.bolder",{"plc": "{PLC_ID}"},"msg"],"</div>",["{LBL_FROM}","txt#rsource.w100p.fs100.lh130",{"plc": "{PLC_FROM}"},"msg"],["{LBL_TO}","txt#rtarget.w100p.fs100.lh130",{"plc": "{PLC_TO}"},"msg"],["{LBL_DOCS}","txt#rdocs.w100p.fs90.lh130",{"plc": "{PLC_DOCS}"},"msg"],["{LBL_FN}","inp#rfilter.w100p",{"plc": "{PLC_FN}"},"msg"],"<div id=\"xrquery\" class=\"hide\">",["{LBL_QRY}","txt#rquery.w100p.fs90.lh130",{"plc": "{PLC_QRY}"},"msg"],"</div>","<div class=\"mt12 pt15 btd\">","<div class=\"fr\"><button id=\"btn-clear\">{BTN_CLEAR}</button></div>","<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>","<button id=\"btn-cancel\">{BTN_CANCEL}</button>","</div>"],"style": {" textarea": "resize:none;word-wrap:break-word;"," .my-error-tip": "padding:0.1em 0 0.2em 0;"," .ui-widget": "font-size:100%"},"doSync": "function () {\n\tvar that = this,\n\t\t\td = $.extend(true, {}, that.data),\n\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\tl = that.lang,\n\t\t\treq, doc,\n\t\t\trname = that.Pho('ReplicatorDB'),\n      remote = /^http[s]?:\\/\\//.test(d.target);\n\t\n\tdoc = {\n\t\tsource:d.source,\n\t\ttarget:d.target,\n\t\tcontinuous:(d.mode+'')!=''\n\t};\n\tif (d.doc_ids.length) doc.doc_ids = Object.clone(d.doc_ids);\n\tif (d.filter) doc.filter = d.filter;\n\tif (Object.size(d.query)) doc.query = Object.clone(d.query, true);\n\t\n\t\n\tif (d.mode == 'doc') {\n\t\t// construct doc & url\n\t\treq = {\n\t\t\turl:[rname, d.doc],\n\t\t\tmethod:'PUT',\n\t\t\theaders:{Accept:'application/json', 'X-Couch-Full-Commit':'true'},\n\t\t\tdataType:'text',\n\t\t\tdata:JSON.stringify($.extend({_id:d.doc, owner:cw.me()}, doc))\n\t\t};\n\t}\n\telse {\n    \n    if (d.mode+'' == '') cw.lib.note(that.lang.MSG_OK, 'ok');\n    \n\t\treq = {\n\t\t\turl:['_replicate'],\n\t\t\tmethod:\t\t\t\t'POST',\n      contentType:\t'application/json',\n\t\t\theaders:\t\t\t{Accept:'application/json', 'X-Couch-Full-Commit':'true'},\n\t\t\tdataType:\t\t\t'text',\n\t\t\tdata:\t\t\t\t\tJSON.stringify(doc)\n\t\t}\n\t}\n\n\treturn that.Req(req)\n\t.then(function(res0){\n\t\tvar res = res0, \n        msg = that.lang.MSG_OK;\n\t\ttry {\n\t\t\tres = Object.isString(res0)?JSON.parse(res0):res0;\n\t\t}catch(e){}\n    \n    if (d.mode=='doc') {\n      msg = that.lang.MSG_OK_DOC.assign(rname, es(d.doc));\n      $.my.radio('dbupdate', {db:rname, cmd:'write', docs:[d.doc]});\n    }\n    else if (d.mode+'' == '') {\n      msg = that.lang.MSG_OK_ONCE; \n      if (!remote) {\n        $.my.radio('dblist', [d.target]);\n        $.my.radio('dbupdate', {db:d.target, cmd:'write', docs:d.doc_ids.slice(0)});\n      }\n    }\n    \n\t\tcw.lib.note(msg, 'ok');\n\t\t\n\t\t// remove last sync data on success\n\t\t$.extend(that.data, { doc:'', mode:'', source:'', target:'', filter:'', doc_ids:[], query:{}});\n    \n    if (Object.isFunction(that.RestartPoll)) that.RestartPoll();\n\t})\n\t.fail(function(code, err, msg){\n\t\tcw.lib.note(that.lang.MSG_FAIL.assign(code, err), 'error');\n\t});\n}"}},"raw": {"name": "Photon","title": "Photon","version": "1.3","build": 19,"com": [{"stamp": "1503455153612","id": "Root","type": "js","data": "({\n\t\n\t// Photon Shell and specific views\n\t// (c) 2018 ermouth\n\t\n\tVersion:'1.3', \n\tbuild:'dev',\n\tCfg:{ /*See tab */},\t// App config\n\tlang:{/*See tab */},\t// locales section\n\t\n\t// State objs and consts\n\t\n\t_compiled: false,\t\t\t// is runtime?\n\tBase:'',\t\t\t\t\t\t\t// CouchDB root, xhr requests base + trailing /\n\tAll:{},\t\t\t\t\t\t\t\t// All DBs\n\tTabs:\t[],\t\t\t\t\t\t\t// array of tabs opened\n\tHistory:[],\t\t\t\t\t\t// array of history steps, which are tabids\n\tDownloadURL:false,\t\t// url for downloading Photon\n\tReplicatorDB:'',\t\t\t// replicator DB name, updated on get DB list\n\tisCluster:true,\t\t\t\t// indicates is current system a cluster\n\tisIE:false,\t\t\t\t\t\t// is IE or Edge, for enforcing no cache\n\tCouch:{version:''},\t\t// Couch welcome json and info, read on start\n  Users:{_seq:0},\t\t\t\t// username list, keys are logins, vals are revs\n\t// Data\n\tdata:{\n\t\tpath:[],\n\t\tname:''\n\t},\n\t\n\t// Service fns and params\n\tparams:{restyle:20},\n\tinit:'',\n\tui:{ /* See tabs */ },\n\tstyle:{/* See tabs */ },\n\t\n\t// require is removed for standalone ver\n\trequire:[ {'window.Q':'/lib/q.js'} ],\n\t\n\tPho: function(key){\n\t\t// exposed to child apps, indeed Pho\n\t\t// return Shell resource by key, \n\t\t// which is null, [path] or string\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t},\n\t\n\tSetTitle:function (t){\n\t\tvar that = this;\n\t\tif (that._compiled) $('head title').text(t+'');\n\t},\n\t\n\tp2u:function(path){\n\t\treturn path.map(function(e, i){\n\t\t\tif (i==1 && /^_design\\/.+$/.test(e)) return '_design/'+encodeURIComponent(e.from(8));\n\t\t\treturn encodeURIComponent(e);\n\t\t})\n\t},\n\t\n  // Libs used\n\tLibsUsed:{\n\t\t'jQuery':\t\t\t\t'https://jquery.com/',\n\t\t'Q':\t\t\t\t\t\t'https://github.com/kriskowal/q',\n\t\t'$.ui':\t\t\t\t\t'https://jqueryui.com/',\n\t\t'$.my':\t\t\t\t\t'https://jquerymy.com/',\n\t\t'$.tags':\t\t\t\t'',\n\t\t'$.list':\t\t\t\t'',\n\t\t'select2':\t\t\t'http://select2.github.io/select2/',\n\t\t'CodeMirror':\t\t'https://codemirror.net/',\n\t\t'niceScroll':\t\t'https://github.com/inuyaksa/jquery.nicescroll',\n\t\t'Sugar':\t\t\t\t'http://sugarjs.com',\n\t\t'JCrop':\t\t\t\t'https://github.com/tapmodo/Jcrop',\n\t\t'URL polyfill':\t'https://github.com/github/url-polyfill',\n\t\t'cw.lib':\t\t\t\t'http://cloudwall.me'\n\t},\n  \n  // Libs used\n\tFontsUsed:{\n\t\t'Cousine':'https://www.fontsquirrel.com/fonts/cousine',\n\t\t'PT Mono':'https://www.fontsquirrel.com/fonts/pt-mono'\n\t},\n  \n  die:function($o){\n  \t$(window).off('.pho');\n    $o.find('#l-apps>div').each(function(){\n    \t$(this).my('remove');\n    });\n  }\n})","active": false,"opts": [],"err": [],"color": ["blue"]},{"stamp": "1503534706706","id": ".Cfg","type": "js","data": "({\n\trootRepo:'//s3-eu-west-1.amazonaws.com/cdn.cloudwall.me/photon/',\n\tmaxWidth:'1600',\t\t\t\t// max width\n\tlistCols:['info','security'],\t\t\t// columns for DB list\n\tfont:'auto',\t\t\t\t\t\t// font\n\tfontWeight:'300',\t\t\t\t// font weight\n\tfontCode:'auto',\t\t\t\t// monospaced font family\n\ticon:'',\t\t\t\t\t\t\t\t// icon base64 dataURL\n\t\n\tmaxTabs:15,\t\t\t\t\t\t\t// max tabs opened\n\tbatchDbInfoDelay:15, \t\t// ms between requests to /db info\n\tbatchCompactDelay:500, \t// ms between starting new compactions\n\tbatchCreateDelay:150,  \t// ms, batch DB creation interval\n\tbatchUpdateCfg:100,\t\t\t// ms between subsequent saving cfg keys\t\n\t\n\t// Task list\n\tloopActiveTasks:10,\t\t\t// seconds, interval between task status update\n\ttasksReadReplicator:!0,\t// does tasks poll _replicator db\n\t\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1503540518661","id": ".lang.en","type": "js","data": "({\n\t\n\t// Aside\n\tTIP_LOGIN:\t'Log in',\n\tTIP_PROFILE:'Edit user \\nprofile doc',\n\tTIP_CONFIG:\t'CouchDB config',\n\tTIP_SHARE:\t'About Photon',\n\t\n\t// Request\n\tERR_REQ_INVALIDCALL:'Invalid request params, probably invalid command or we have a bug',\n\tERR_REQ:{\n\t\t0  :\t'Offline',\n\t\t999:\t'Unknown error',\n\t\t400:\t'Bad request',\n\t\t401:\t'Unauthorized',\n\t\t403:\t'Forbidden',\n\t\t404:\t'Not found',\n\t\t405:\t'Not allowed',\n\t\t408:\t'Timeout',\n\t\t409:\t'Conflict',\n\t\t429:\t'Too many requests',\n\t\t500:\t'Internal error',\n\t\t501:\t'Not implemented',\n\t\t503:\t'Service unavailable',\n\t\t504:\t'Gateway timeout',\n\t\t509:\t'Bandwidth quota'\n\t},\n\t\n\t// Tab panel\n\tFAIL_TOO_MANY_TABS:'{1} tabs maximum, please, close something or double-click the logo to close all tabs.',\n\tFAIL_TAB_APP:'Failed starting tab app. See console for details.',\n\tDLG_UNLOAD:'There are unsaved changes. Reload?',\n\tDLG_UNSAVED:'There are unsaved changes. Proceed?',\n\t\n\t// Change password\n\t/*SetPwd:{\n\t\tTXT_TITLE:'Change password',\n\t\tPLC_PWD1:'Type new password',\n\t\tPLC_PWD2:'Repeat password',\n\t\tERR_PWD:'Passwords not match',\n\t\tBTN_SET:'Set new password',\n\t\tBTN_CANCEL:'Cancel',\n\t\tMSG_OK:'Password changed',\n\t\tMSG_FAIL:'Failed changing password. Server responded {1}:\\u00a0{2}'\n\t},*/\n  \n  // Mango Index Ed\n  IndexEd:{\n  \tTXT_TITLE:\t\t'Mango index {1}\\u00a0in\\u00a0_design/{2}',\n    TXT_TITLE0:\t\t'Default Mango index',\n    BTN_PANEL_CLOSE:\t'Close editor',\n    TAG_MODE:{\n    \ttags:[{'JSON':'json'}],\n      empty:{'Source':'javascript'}\n    },\n    \n    ERR_NO_INDEX:\t\t'Must have .index.fields array',\n    ERR_NO_TYPE:\t\t'Property .type should be \"json\"',\n    ERR_NO_JSON:\t\t'Can’t convert to JSON',\n    \n    BTN_RUN:\t\t\t\t'Save and run',\n    BTN_RUN0:\t\t\t\t'Create new and run',\n    TIP_RUN:\t\t\t\t'Saves index and shows index entries',\n    MSG_FAIL:\t\t\t\t'Failed saving {1}. Server responded ‘{2}:\\u00a0{3}’',\n    MSG_SAVED:\t\t\t'Updated {1}, reloading index entries',\n    \n    BTN_SAVEAS:\t\t\t'Save as...',\n    TIP_SAVEAS:\t\t\t'Saves index under different name and shows index entries',\n    \n    BTN_DEL:\t\t\t\t'Del...',\n    TIP_DEL:\t\t\t\t'Deletes this Mango index',\n    \n    BTN_REVERT:\t\t\t'Revert',\n    TIP_REVERT:\t\t\t'Reverts editor to saved index code',\n    \n    //---- Save as popup\n    \n    TXT_NEW:\t\t\t\t[\n      '<h3>Create new index</h3>',\n      '<p>Saves index into existing or new design document.</p>'\n    ].join(''),\n    \n    LBL_DDOC:\t\t\t\t'Ddoc name',\n    PLC_DDOC:\t\t\t\t'Short of full form',\n    \n    LBL_NEW:\t\t\t\t'Index name',\n    PLC_NEW:\t\t\t\t'Key name in .views prop of ddoc',\n    ERR_NEW_REQ:\t\t'Index name required',\n    \n    EXP_EXIST:\t\t\t'<span class=\"red1 fi-alert\"></span> Index already exists and will be replaced.',\n    EXP_NDDOC:\t\t\t'Target design doc doesn’t exist and will be created.',\n    EXP_NVIEW:\t\t\t'New index will be added to existing design doc.',\n    \n    BTN_NEW_OK:\t\t\t'Save index',\n    BTN_NEW_CANCEL:\t'Cancel',\n    \n    ERR_NO_NAME:\t\t'Invalid ddoc or index name, can’t create index',\n    ERR_ERRDOC:\t\t\t'Can’t save invalid index. {1}.',\n    \n    //---- Del popup\n    MSG_DEL_TEXT:\t\t'<span class=\"red1 fi-alert\"></span> Delete Mango index {1} from {2}?',\n    BTN_DEL_YES:\t\t'Delete',\n    BTN_DEL_NO:\t\t\t'Cancel',\n    \n    MSG_DEL_OK:\t\t\t'Index {1} deleted',\n    MSG_DEL_FAIL:\t\t'Failed deleting {1}. Server responded ‘{2}:\\u00a0{3}’',\n  },\n  \n  // View Ed\n  ViewEd:{\n  \tTXT_TITLE:{\n      javascript:\t'JS view {1}\\u2009/\\u2009{2}',\n      erlang:\t\t\t'Erlang view {1}\\u2009/\\u2009{2}'\n    },\n    TAG_MODE:{\n    \ttags:\t\t[[{'Reduce':'reduce'}, {'JSON':'json'}]],\n      empty:\t{'Map':'map'}\n    },\n    \n    BTN_PANEL_CLOSE:\t'Close editor',\n    \n    ERR_NO_MAP:\t\t\t'Map is not a function',\n    ERR_NO_REDUCE:\t'Reduce is not a function',\n    ERR_F_BUILTIN:\t'Unknown built-in reducer',\n    ERR_ERRDOC:\t\t\t'Can’t save invalid design doc. {1}.',\n    \n    BTN_RUN:\t\t\t\t'Run view',\n    TIP_RUN:\t\t\t\t'Runs saved view index query',\n    \n    BTN_SAVE:\t\t\t\t'Save and run',\n    TIP_SAVE:\t\t\t\t'Saves view and shows the result',\n    MSG_FAIL:\t\t\t\t'Failed saving {1}. Server responded ‘{2}:\\u00a0{3}’',\n    MSG_SAVED:\t\t\t'Updated {1}, reloading view',\n    \n    BTN_SAVEAS:\t\t\t'Save as...',\n    TIP_SAVEAS:\t\t\t'Saves view under different name and shows the result',\n    \n    BTN_REVERT:\t\t\t'Revert',\n    TIP_REVERT:\t\t\t'Reverts editor to saved view code',\n    \n    BTN_DEL:\t\t\t\t'Del...',\n    TIP_DEL:\t\t\t\t'Deletes this view index',\n    \n    //---- Save As popup\n    \n    TXT_NEW:\t\t\t\t[\n      '<h3>Create new view</h3>',\n      '<p>Saves view into existing or new design document.</p>'\n    ].join(''),\n    \n    LBL_DDOC:\t\t\t\t'Ddoc _id',\n    PLC_DDOC:\t\t\t\t'Fullform, like _design/ddocName',\n    ERR_DDOC:\t\t\t\t'Valid _id-s are like _design/ddocName',\n    \n    LBL_NEW:\t\t\t\t'View name',\n    PLC_NEW:\t\t\t\t'Key name in .views prop of ddoc',\n    ERR_NEW_REQ:\t\t'View name required',\n    ERR_NEW_SLASH:\t'Slashes are not allowed in view name',\n    \n    EXP_EXIST:\t\t\t'<span class=\"red1 fi-alert\"></span> View already exists and will be replaced.',\n    EXP_NDDOC:\t\t\t'Target design doc doesn’t exist and will be created.',\n    EXP_NVIEW:\t\t\t'New view will be added to existing design doc.',\n    \n    BTN_NEW_OK:\t\t\t'Save view',\n    BTN_NEW_CANCEL:\t'Cancel',\n    \n    ERR_NO_NAME:\t\t'Invalid ddoc or view name, can’t create view',\n    \n    //---- Del popup\n    \n    MSG_DEL_TEXT:\t\t'<span class=\"red1 fi-alert\"></span> Delete view index {1} from {2}?',\n    BTN_DEL_YES:\t\t'Delete',\n    BTN_DEL_NO:\t\t\t'Cancel',\n    \n    MSG_DEL_OK:\t\t\t'View {1} deleted',\n    MSG_DEL_FAIL:\t\t'Failed deleting {1}. Server responded ‘{2}:\\u00a0{3}’',\n  },\n  \n  // Mango Ed\n  MangoEd:{\n  \tTXT_TITLE:\t\t'Mango qry {1}',\n    TXT_TITLE0:\t\t'Untitled Mango qry',\n    TAG_MODE:{\n    \ttags:[{'JSON':'json'}],\n      empty:{'Source':'javascript'}\n    },\n    BTN_PANEL_CLOSE:\t'Close editor',\n    \n    ERR_NO_SELECTOR:\t'No .selector property',\n    ERR_NO_JSON:\t'Can’t convert to JSON',\n    \n    BTN_RUN:\t\t\t'Run qry',\n    TIP_RUN:\t\t\t'Executes query and shows the result',\n    \n    BTN_EXPL:\t\t\t'Explain',\n    TIP_EXPL:\t\t\t'Explains query, all hidden params and indexes involved',\n    \n    BTN_SAVE:\t\t\t'Save as...',\n    BTN_RENAME:\t\t'Rename...',\n    TIP_SAVE:\t\t\t'Saves Mango query to localStorage for later re-use',\n    \n    BTN_DEL:\t\t\t'Del',\n    TIP_DEL:\t\t\t'Deletes this Mango query from localStorage and switches to Default query',\n    \n    BTN_DEL:\t\t\t'Del',\n    TIP_DEL:\t\t\t'Deletes this Mango query from localStorage and switches to Default query',\n    \n    BTN_RESET:\t\t'Reset',\n    TIP_RESET:\t\t'Resets to initial default query',\n    \n    TXT_STASH:\t\t[\n      '<h3>Memoize query</h3>',\n      '<p>Saves Mango query to localStorage for later re-use.</p>'\n    ].join(''),\n    \n    PLC_STASH:\t\t\t\t'Query title, 3...30 chars',\n    ERR_STASH_REQ:\t\t'Title required',\n    ERR_STASH_LEN:\t\t'3...30 characters',\n    ERR_STASH_EXIST:\t'Already exists',\n    BTN_STASH_OK:\t\t\t'Save query',\n    BTN_STASH_OK1:\t\t'Save & switch to new',\n    BTN_STASH_CANCEL:\t'Cancel',\n  },\n  \n  // User basic editor\n\tUserDoc:{\n    TXT_TITLE:\t\t'Create new user',\n    TXT_TITLE_ED:\t'Change password or roles',\n    \n    LBL_N:\t\t\t\t'Name',\n\t\tPLC_N:\t\t\t\t'User login',\n    ERR_N:\t\t\t\t'Can’t start with _ or contain :',\n    ERR_NX:\t\t\t\t'Username already exists',\n    \n    LBL_P:\t\t\t\t'Password',\n\t\tPLC_P:\t\t\t\t'User passsword',\n    PLC_P_ED:\t\t\t'Change user passsword',\n    ERR_P:\t\t\t\t'Required',\n    \n    LBL_R:\t\t\t\t'Roles',\n\t\tPLC_R:\t\t\t\t'Add roles',\n    ERR_R:\t\t\t\t'Roles can’t start with _',\n    \n    BTN_SAVE:\t\t\t'Save user',\n    BTN_DOC:\t\t\t'Create empty doc...',\n    BTN_CANCEL:\t\t'Cancel',\n    \n    MSG_OK:\t\t\t\t'User {1} successfully saved',\n    MSG_FAIL:\t\t\t'Failed saving user {1}. Server responded ‘{2}:\\u00a0{3}’'\n  },\n\t\n\t// Sync task\n\tNewSync:{\n\t\tTXT_TITLE:'New replication',\n\t\t\n\t\tLBL_MODE:'Sync mode',\n\t\tTAG_MODE:{\n\t\t\ttags:[[{'Continuous':'live'},{'Forever':'doc'}]],\n\t\t\tempty:{'One time':''}\n\t\t},\n\t\t\n\t\tLBL_ID:'Sync name',\n\t\tPLC_ID:'Doc _id for {1} DB',\n\t\tERR_ID:'Required',\n\t\tERR_ID_UND:'Doc name can’t start with underscore',\n\t\t\n\t\tLBL_FROM:'Source DB',\n\t\tPLC_FROM:'Local name or remote URL',\n\t\tERR_FROM:'Existing DB name or valid URL',\n\t\t\n\t\tLBL_TO:'Target DB',\n\t\tPLC_TO:'Local name or remote URL',\n\t\tERR_TO:'Existing DB name or valid URL',\n\t\tERR_DUP:'Source and Target must be different',\n\t\t\n\t\tLBL_FN:'Filter fn',\n\t\tPLC_FN:'ddocName/filterFnName, filter function',\n\t\tERR_FN_DESIGN:'No _design prefix, only ddocName/filter',\n\t\tERR_FN:'Valid format is ddocName/filter',\n\t\t\n\t\tLBL_QRY:'Qry params',\n\t\tPLC_QRY:'Query params for filter fn, JSON object',\n\t\tERR_QRY:'Must be non-empty JSON object',\n\t\t\n\t\tLBL_DOCS:'Docs to sync',\n\t\tPLC_DOCS:'JSON [] of doc _id-s to replicate',\n\t\tERR_DOCS:'Must be non-empty JSON array of strings',\n\t\t\n\t\tBTN_START:'Start replication',\n\t\tBTN_START_DOC:'Create doc and start',\n\t\tBTN_CANCEL:'Cancel',\n\t\tBTN_CLEAR:'Clear',\n\t\t\n\t\tMSG_OK:'Successfully started new sync task',\n    MSG_OK_ONCE:'Replication successfully finished',\n\t\tMSG_OK_DOC:'Successfully created doc ‘{2}’ in {1} DB',\n\t\tMSG_FAIL:'Failed starting replication. Server responded ‘{1}:\\u00a0{2}’'\n\n\t},\n\t\n\t// DelDB manifest\n\tDelDB:{\n\t\t\n\t\tTXT_TITLE:'Delete DBs',\n\t\tTXT_TITLE1:'Delete DB',\n\t\tPLC_DBS:'Select DBs to delete',\n\t\tERR_DBS:'Select at least one DB',\n\t\t\n\t\tTXT_WARN:function(obj){\n\t\t\tvar c = Object.clone(obj);\n\t\t\tc.scount = c.count < 2?'':'s';\n\t\t\tc.size = (+c.size).bytes(1).replace(/B$/,'b');\n\t\t\tc.disk = (+c.disk).bytes(1).replace(/B$/,'b');\n\t\t\treturn 'You are deleting {count} DB{scount}, containing {size} of data. It will free ~{disk} of disk space.'.assign(c);\n\t\t},\n\t\t\n\t\tBTN_START:function(count) {\n\t\t\tif (!count) return 'Nothing to delete';\n\t\t\treturn 'Delete '+count+' DB'+(count>1?'s':'');\n\t\t},\n\t\tBTN_CANCEL:'Cancel',\n\t\t\n\t\tMSG_OK:'Successfully deleted ‘{1}’ DB',\n\t\tMSG_FAIL:'Failed deleting DB ‘{1}’. Server responded ‘{2}: {3}’'\n\t},\n\t\n\t// SecObj manifest\n\tSecObj:{\n\t\t\n\t\tTXT_TITLE:'Access control',\n\t\tLBL_DBS:'DBs',\n\t\tPLC_DBS:'Select DB names to set ACL',\n\t\tERR_DBS:'Select at least one DB',\n\t\t\n\t\tTXT_ADM:'Administrators',\n\t\t\n\t\tLBL_UADM:'Users',\n\t\tPLC_UADM:'User names',\n\t\tLBL_GADM:'Roles',\n\t\tPLC_GADM:'Roles with admin access',\n\t\tERR_ADM:'Invalid name',\n    ERR_UNAME:'Names can’t start with _ or contain :',\n\t\t\n\t\tTXT_MEM:'Members',\n\t\t\n\t\tPLC_UMEM:'User names',\n\t\tPLC_GMEM:'Roles with member access',\n\t\t\n\t\tBTN_START:'Set security',\n\t\tBTN_CANCEL:'Cancel',\n\t\t\n\t\tMSG_OK:'Security object for DB ‘{1}’ updated',\n\t\tMSG_FAIL:'Failed updating security object for DB ‘{1}’. Server responded ‘{2}: {3}’'\n\t},\n\t\n\t// Login manifest\n\tLogin:{\n\t\tTXT_LOGIN:'Log in',\n\t\tPLC_UNAME:'Username',\n\t\tPLC_PWD:'Password',\n\t\tBTN_LOGIN:'Create session',\n\t\tBTN_CANCEL:'Cancel',\n\t\tMSG_AUTH_OK:'Authorized as {1}',\n\t\tMSG_AUTH_FAIL:'Authorization as {1} failed. Server responded {2}:\\u00a0{3}',\n\t},\n\t// Logout manifest\n\tLogout:{\n\t\tTXT_LOGOUT:'Log out',\n\t\tTXT_PROFILE:'Profile',\n\t\tMSG_LOGOUT_START:'Logging out...',\n\t\tMSG_LOGOUT_OK:'You was logged out successfully',\n\t\tMSG_LOGOUT_FAIL:'Log out failed. Server responded {1}:\\u00a0{2}'\n\t},\n\t\n\t// Tab manifest\n\tTab:{\n\t\tBTN_CLOSETAB:'Close tab'\n\t},\n\t\n\t// New DB(s) dialog\n\tNewDB:{\n\t\tTXT_TITLE:'Create DBs',\n\t\tTXT_TITLE1:'Create DB',\n\t\t\n\t\tLBL_DBS:'Names',\n\t\tPLC_DBS:'DBs to create',\n\t\tERR_DB_EXIST:'DB {1} already exists',\n\t\tERR_DB_NAME:'Lowercase a-z, 0-9 and  _$()+- are only allowed in DB names',\n\t\tERR_DB_UND:'DB names must start with lowercase a-z',\n\t\t\n\t\tTXT_ADM:'Administrators',\n\t\t\n\t\tLBL_UADM:'Users',\n\t\tPLC_UADM:'User names',\n\t\tLBL_GADM:'Roles',\n\t\tPLC_GADM:'Roles with admin access',\n\t\tERR_ADM:'Invalid name',\n    ERR_UNAME:'Names can’t start with _ or contain :',\n\t\t\n\t\tTXT_MEM:'Members',\n\t\t\n\t\tPLC_UMEM:'User names',\n\t\tPLC_GMEM:'Roles with member access',\n\t\t\n\t\tBTN_START:'Create DBs',\n\t\tBTN_START_PUBLIC:'Create public DBs',\n\t\tBTN_CANCEL:'Cancel',\n\t\t\n\t\tMSG_NEWDB_START:'Created new DB ‘{1}’',\n\t\tMSG_NEWDB_FAIL:'Failed creating DB ‘{1}’. Server responded ‘{2}: {3}’',\n\t\tMSG_NEWDB_NOACL:'DB ‘{1}’ created, but setting security config failed, so DB is public. Server responded ‘{2}:\\u00a0{3}’',\n\t},\n\t\n\t// Compact dialog\n\tCompact:{\n\t\tTXT_TITLE:'Compact DBs',\n\t\tTXT_TITLE1:'Compact DB',\n    \n    TXT_DBLIST:function(obj){\n\t\t\tvar c = obj.length;\n      return 'You are going to compact {1} bucket{2}: '.assign(c, c<2?'':'s')+obj.map(function(e){return e.escapeHTML();}).join(', ');\n\t\t},\n    \n    \n\t\tPLC_DBS:'Select DBs to compact',\n\t\tPLC_DDOCS:'Select ddocs for view compaction',\n\t\tERR_DBS:'Select at least one DB',\n\t\tERR_DDOCS:'Select at least one design doc',\n\t\tTAG_OP:[{'Strip old revs':'docs'},{'Strip old views':'views'},{'Compact views':'ddocs'}],\n\t\tERR_OP:'Select at least one action',\n\t\tERR_VC:'View compaction requires selecting ddocs, so it’s unavailable for multiple DBs selected',\n\t\tBTN_START:'Start compaction',\n\t\tBTN_CANCEL:'Cancel',\n\t\t\n\t\tMSG_COMPACT_START:'Started compaction of ‘{1}’',\n\t\tMSG_COMPACT_FAIL:'Failed starting compaction of ‘{1}’. Server responded ‘{2}:\\u00a0{3}’',\n\t\tMSG_COMPACT_FAIL_SOME:'Errors occured during at least one compaction tasks, check console for details',\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1504309052636","id": ".lang.en","type": "js","data": "({\n\t// Type $log manifest\n\t$log:{\n\t\tTXT_TITLE:'Logs',\n\t\tTXT_KB:'kb',\n\t\tTXT_SIZE:'Show',\n\t\tTXT_OFFSET:'offset',\n\t\t\n\t\tPLC_SEARCH:'Search in logs',\n\t\tPLC_RELOAD:'Reload'\n\t},\n\t\n\t// Type $config manifest\n\t$config:{\n\t\tPLC_SEARCH:'Search',\n\t\tPLC_RELOAD:'Reload',\n\t\tERR_RELOAD:'Error reloading config. Server responded {1}: {2}',\n\n\t\tBTN_SAVE:'Save changes &nbsp;',\n\t\tBTN_REVERT:'Revert to saved ',\n\t\tBTN_CANCEL:'Cancel',\n\t\tBTN_CLOSE:'Close',\n\t\t\n\t\tTXT_SAVE_TITLE:'Save config',\n\t\tTXT_SAVE_SKIPERRORS:'Changes have errors, invalid keys will not be saved.',\n\t\tBTN_SAVE_START:'Save',\n\t\tTXT_ITITLE:'Changes',\n\t\tTXT_ITITLE_EMPTY:'You made no changes in the config yet',\n\t\tLBL_IUPD:'{1}\\u00a0updated',\n\t\tLBL_IADD:'{1}\\u00a0added',\n\t\tLBL_IDEL:'{1}\\u00a0deleted',\n\t\tLBL_IERR:'<span class=\"red1\">{1}\\u00a0invalid</span>',\n\t\t\n\t\tERR_VAL:{\n\t\t\tCHARS:'Forbidden chars in key, only a-z, 0-9 and _-! allowed',\n\t\t\tVALSTRING:'Value can’t be null, array or object'\n\t\t},\n\t\t\n\t\tMSG_SAVE_OK:'Successfully updated config',\n\t\tMSG_SAVE_FAIL:'Failed updating some keys, see console, for details',\n\t\t\n\t\tMSG_CLUSTER:'You are operating cluster. Propagate config changes to all nodes?',\n\t\tBTN_SAVECLUSTER:'Save to all nodes',\n\t\tBTN_SAVENODE:'Save to {1} only',\n\t\t\n\t\tBAN_HTTP:'Key can’t be changed through HTTP, edit local.ini serverside. Reason is CVE-2017-12636.'\n\t},\n\t\n\t// Type $about manifest\n\t$about:{\n\t\tL_PHO:\t\t\t\t\t\t'Photon version',\n\t\tL_PHOADD:\t\t\t\t\t'Photon addons',\n\t\tL_PHOLIBS:\t\t\t\t'Photon libs',\n    L_PHOFONTS:\t\t\t\t'Fonts attached',\n\t\t\n\t\tL_VER:\t\t\t\t\t\t'CouchDB version',\n\t\tL_VENDOR:\t\t\t\t\t'Vendor',\n\t\tL_URL:\t\t\t\t\t\t'Node URL',\n\t\tL_COUCH:\t\t\t\t\t'Welcome msg',\n\t\tL_FEAT:\t\t\t\t\t\t'Aux features',\n\t\tBTN_LOGS:\t\t\t\t\t'View logs',\n\t\t\n    L_GITHUB:\t\t\t\t\t'Photon at Github',\n\t\tL_DL:\t\t\t\t\t\t\t'Download this Photon build as a json',\n\t\tL_DLPREP:\t\t\t\t\t'Preparing json...',\n\t\t\n\t\tL_CHECK_UPDATES:\t'Check for updates...',\n\t\tTXT_UPD:\t\t\t\t\t'Update found. Local version is <nobr class=\"bolder\">{1}</nobr>, '\n    \t\t\t\t\t\t\t\t\t+'update is <nobr class=\"bolder\">{2}</nobr>. Update Photon?',\n\t\tMSG_UPD_NONEED:\t\t'No update needed',\n\t\tBTN_UPDATE:\t\t\t\t'Proceed',\n\t\tBTN_CANCEL:\t\t\t\t'Cancel',\n\t\tERR_UPDATE_CHECK:\t'Failed reading new version, sorry',\n\t\tERR_UPDATE:\t\t\t\t'Failed updating Photon. Server responded {1}:\\u00a0{2}',\n\t\tMSG_UPDATE_OK:\t\t'Photon was successfully updated, please reload the page!',\n\t\t\n\t\t// Local settings\n\t\tS_TITLE:\t\t\t\t\t'Customize Photon',\n\t\tS_REPO:\t\t\t\t\t\t'Update repo URL',\n\t\tS_WIDTH:\t\t\t\t\t'Max width',\n\t\tS_FFAMILY:\t\t\t\t'Main font family',\n\t\tS_FWEIGHT:\t\t\t\t'Main font weight',\n\t\tS_FCFAMILY:\t\t\t\t'<code>Code</code> font family',\n\t\tS_POLL:\t\t\t\t\t\t'Task poll interval',\n\t\tS_ICON:\t\t\t\t\t\t'Browser tab icon',\n\t\tS_COLS:\t\t\t\t\t\t'DB list cols',\n\t\tTAG_COLS:\t\t\t\t\t[{'DB size':'info'},{'ACL info':'security'}],\n\t\tBTN_ICON:\t\t\t\t\t'Upload new icon…',\n\t\tBTN_ICON_RESET:\t\t'Reset icon',\n\t\n\t\t\n\t\tBTN_APPLY:'Apply'\n\t},\n\t\n\t// Type $view manifest\n\t$view:{\n    OPT_ALLDOCS:\t\t\t'All documents',\n    OPT_DDOCS:\t\t\t\t'Design documents',\n\t\tTXT_FROM:\t\t\t\t\t'from',\n\t\tPLC_STARTKEY:\t\t\t'Start key or _skip',\n\t\tTIP_SHIFT_MINUS:\t'Shift frame backward',\n\t\tTIP_SHIFT_PLUS:\t\t'Shift frame forward',\n\t\tTIP_CLEAR_FILTER:\t'Clear startkey',\n\n\t\tTIP_RELOAD:\t\t\t\t'Reload',\n\t\t\n\t\tBTN_NEWDOC:\t\t\t\t'New doc\\u00a0',\n    BTN_NEWDOC_POPUP:\t'New doc…',\n\t\tBTN_COPYDOCS:\t\t\t'Copy…',\n\t\tBTN_DELDOCS:\t\t\t'Del docs…',\n\t\tBTN_ACL:\t\t\t\t\t'ACL…',\n\t\tBTN_COMPACT:\t\t\t'Compact…',\n\t\tBTN_CANCEL:\t\t\t\t'Cancel',\n\t\t\n\t\tTIP_CLOSEJSON:\t\t'Close JSON',\n\n\t\tPLC_SEARCH:\t\t\t\t'Search',\n\n\t\tERR_GETVIEWS:\t\t\t'Failed reading list of view functions for {1} DB.',\n\t\tERR_GETACL:\t\t\t\t'Failed reading security object',\n\n\t\tTXT_ALLDOCS:function(a,b){\n\t\t\treturn 'All docs'+(!a?'':', showing {1} of {2} entr'.assign(a,b)+(b%10==1 && b%100!=11?'y':'ies'));\n\t\t},\n\n\t\tTXT_MAPVIEW:function(a, b, c){\n\t\t\tvar s = (!a && !b?'No rows':'{1} of {2} row'.assign(a,b)+(b!=1?'s':''));\n\t\t\tif (a && b && null != c) {\n\t\t\t\ts+=', filtered <span class=\"view-found pl3 pr3\">'+c+'</span> row'+(c!=1?'s':'');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t\n\t\tBTN_VIEWCODE:\t\t\t'View code',\n\n\t\tMSG_STARTKEY_CHANGED:\t'Starting from key {1}',\n\t\t\n\t\tTXT_SELECT:\t\t\t\t'Select {1}',\n\t\tTXT_UNSELECT:\t\t\t'Unselect {1}',\n\t\tTXT_SELECT_ALL:\t\t'all',\n\t\tTXT_SELECT_FILTERED:'filtered',\n\t\tTIP_ANCHOR:\t\t\t\t'Open as a JSON in new browser tab',\n\t\t\n\t\tTXT_DEL_TITLE:\t\t'Bulk delete docs',\n\t\tTXT_DEL_WARN:function(num, db){\n\t\t\treturn 'You are going to delete '+num+' doc'+(num>1?'s':'')+' from the ‘'+db+'’ DB.'\n\t\t},\n\t\tBTN_DEL_START:\t\t'Proceed',\n\t\t\n\t\tMSG_DEL_OK:function(num, delnum, db){\n\t\t\tvar h = ' from the ‘'+db+'’ DB';\n\t\t\tif (delnum == num ) h = 'Successfully deleted '+delnum+' doc'+(delnum>1?'s':'') + h;\n\t\t\telse {\n\t\t\t\th = 'Deleted '+delnum+' doc'+(delnum>1?'s':'') + h\n\t\t\t\t\t+', but failed to delete '+(num-delnum)+' doc'+((num-delnum)>1?'s':'');\n\t\t\t\t\n\t\t\t\th+='. Possibly, deletion was denied by validate function, see console for details.';\n\t\t\t}\n\t\t\treturn h;\n\t\t},\n\t\tMSG_DEL_FAIL:\t\t\t\t'Failed deleting docs’. Server responded ‘{1}: {2}’',\n    \n    /*TXT_MANGO_TITLE:\t\t'Mango qry “{1}”',\n    TXT_MANGO_TITLE0:\t\t'Untitled Mango qry',\n    TAG_MANGO_MODE:{\n    \ttags:[{'JSON':'json'}],\n      empty:{'Raw source':'javascript'}\n    },\n    \n    BTN_MANGO_RUN:\t\t\t'Run query',\n    TIP_MANGO_RUN:\t\t\t'Executes query and shows the result',\n    \n    BTN_MANGO_EXPL:\t\t\t'Explain',\n    TIP_MANGO_EXPL:\t\t\t'Explains query, all hidden params and indexes involved',\n    \n    BTN_MANGO_SAVE:\t\t\t'Stash...',\n    BTN_MANGO_RENAME:\t\t'Rename...',\n    TIP_MANGO_SAVE:\t\t\t'Saves Mango query to localStorage for later re-use',\n    \n    BTN_MANGO_DEL:\t\t\t'Del',\n    TIP_MANGO_DEL:\t\t\t'Deletes this Mango query from localStorage and switches to default query',\n    \n    TXT_MANGO_STASH:\t\t'<h3>Memoize query</h3><p>Saves Mango query to localStorage for later re-use</p>',\n    PLC_MANGO_STASH:\t\t'Query title, 3...30 chars',\n    ERR_MANGO_STASH_REQUIRED:'Title required',\n    ERR_MANGO_STASH_LENGTH:'3...30 characters',\n    ERR_MANGO_STASH_EXIST:'Already exists',\n    BTN_MANGO_STASH_OK:\t'Save query',\n    BTN_MANGO_STASH_OK1:'Save & switch to new',\n    BTN_MANGO_STASH_CANCEL:\t'Cancel',*/\n    \n\t},\n\n\t// Type $dbs manifest\n\t$dbs:{\n\t\tTIP_RELOAD:'Reload DB list',\n\t\t\n\t\tBTN_NEWDB:'New DB…',\n\t\tBTN_COMPACT:'Compact…',\n\t\tBTN_DELDB:'Delete…',\n\t\tBTN_LOGS:'View logs',\n\t\tBTN_CANCEL:'Cancel',\n\t\t\n\t\tPLC_SEARCH:'Search',\n\t\tTXT_MAPVIEW:function(a,b){\n\t\t\treturn (!a && !b?'No DBs':(a==b?'{1} DB':'{1} of {2} DB').assign(a,b)+(b>1?'s':''));\n\t\t},\n\t\tTXT_TASKVIEW:function(a,b){\n\t\t\treturn (!a&& !b?'No tasks':(a==b?'{1} task':'{1} of {2} task').assign(a,b)+(b>1?'s':''));\n\t\t},\n\n\t\tTIP_DBSIZE:'Data: {1}\\nDisk: {2}',\n\t\t\n\t\tMSG_NEWDB_START:'Created new DB ‘{1}’',\n\t\tMSG_NEWDB_FAIL:'Failed creating DB ‘{1}’. Server responded ‘{2}: {3}’',\n\t\tMSG_NEWDB_NOACL:'DB ‘{1}’ created, but setting security config failed, so DB is public. Server responded ‘{2}:\\u00a0{3}’',\n\t\t\n\t\tTXT_SELECT:'Select {1}',\n\t\tTXT_UNSELECT:'Unselect {1}',\n\t\tTXT_SELECT_ALL:'all',\n\t\tTXT_SELECT_FILTERED:'filtered',\n\t\t\n\t\tH_DOCS:'Docs',\n\t\tH_DELDOCS:'Deleted',\n\t\tH_SEQ:'Seq',\n\t\tH_SIZE:'Disk',\n\t\t\n\t\tTXT_TASK_TITLE:'Tasks',\n\t\tTAGS_TASK_TYPE:{\n\t\t\ttags:[[{'Active':'active'}],[{'Sync':'replication'}, {'Compaction':'compaction'}]],\n\t\t\tempty:{'\\u2009All\\u2009':''}\n\t\t},\n    TIP_TASK_RELOAD:'Reload tasks',\n\t\tBTN_TASK_NEWSYNC:'New sync…',\n    \n    BTN_TASK_RESYNC:'Restart…',\n    \n    TXT_TASK_RESYNC_TITLE:'Restart replications',\n\t\tTXT_TASK_RESYNC_WARN:function(num, tasks, db){\n      var t = num+tasks;\n\t\t\treturn 'You are going to restart '+num+' sync task'+(num>1?'s':'')\n      \t+'. Task doc'+(num>1?'s':'')\n      \t+' in '+db+' DB will be deleted, and then re-created.';\n\t\t},\n\t\tBTN_TASK_PROCEED:'Proceed',\n    \n    MSG_TASK_RESYNC:'Sync docs deleted, tasks stopped. Trying to restart sync tasks...',\n    MSG_TASK_RESYNC_OK:'Sync tasks restarted',\n    ERR_TASK_RESYNC:'Error restarting sync tasks, server responded {1}',\n    \n    BTN_TASK_STOP:'Stop…',\n    TXT_TASK_STOP_TITLE:'Stop replications',\n\t\tTXT_TASK_STOP_WARN:function(num, tasks, db){\n      var t = num+tasks;\n\t\t\tvar s = 'You are going to stop '+t+' sync task'+(t>1?'s':'')+'. ';\n      \n      if (num > 0) {\n      \ts = s+'Task doc'+(num>1?'s':'')+' in '+db+' DB will be deleted.';\n      }\n      return s;\n\t\t},\n    MSG_TASK_STOP:'Sync docs deleted, tasks stopped',\n    ERR_TASK_STOP:'Error stopping tasks, server responded {1}',\n\t},\n\n\t// Type $doc manifest\n\t$doc:{\n\t\tTXT_REV:'Latest revision',\n\n\t\tPLC_SEARCH:'Search',\n\t\tPLC_RELOAD:'Reload',\n\n\t\tBTN_SAVE:'Save doc ',\n\t\tBTN_SAVEAS:'Save as…',\n\t\tBTN_DEL:'Delete…',\n\t\tBTN_CANCEL:'Cancel',\n\n\t\tMSG_SAVE:'Doc {1} was successfully saved with revision {2}',\n\t\tERR_SAVE:'Error saving doc, server responded {1}',\n\t\tERR_SAVELOAD:'Doc was saved, however loading it after save failed. Server responded {1}',\n\t\t\n\t\tMSG_EDS:'There are active editors containing not yet applied changes.',\n\t\tBTN_EDS_YES:'Apply changes and save\\u00a0',\n\t\tBTN_EDS_NO:'Discard and save\\u00a0',\n\n\t\tMSG_CONFLICT:[\n\t\t\t'<div class=\"fs130 lh150 mb2 bolder orange\">Conflict</div>',\n\t\t\t'Conflict saving doc ‘{1}’ ',\n\t\t\t'<br><span class=\"dib w140\">Your rev: </span><nobr>{2}</nobr> ',\n\t\t\t'<br><span class=\"dib w140\">DB rev:   </span><nobr>{3}</nobr>.'\n\t\t].join(''),\n\t\tBTN_CONFLICT_YES:'Overwrite DB doc',\n\t\tBTN_CONFLICT_NO:'Cancel save',\n\t\tMSG_CONFLICT_CANCELLED:'Cancelled, doc was not saved',\n\t\tMSG_CONFLICT_LOADFAIL:'Failed loading conflicting revision, doc can not be saved',\n\t\t\n\t\tTXT_DEL_TITLE:'Delete doc',\n\t\tTXT_DEL_TITLE_CONFLICT:'Delete doc conflict',\n\t\t\n\t\tTXT_DEL_WARN:'You are going to delete doc <nobr>‘{1}’</nobr> from the ‘{2}’ DB.',\n\t\tBTN_DEL_START:'Proceed',\n\t\tTXT_DEL_NODEL:'Note, that the doc has conflict revisions, and one of them probably become active after deletion.',\n\t\tTXT_DEL_CONFLICT:'Note, that you are deleting conflict revision, it will not affect active version of the doc.',\n\n\t\tLBL_DEL_ALL:'Del doc and its content',\n\t\tLBL_DEL_RETAIN:'Mark doc as deleted, but retain content',\n\t\t\n\t\tMSG_DEL_OK:'Successfully deleted doc ‘{1}’ from the ‘{2}’ DB',\n\t\tMSG_DEL_FAIL:'Failed deleting doc ‘{1}’. Server responded ‘{2}: {3}’',\n\t\tMSG_DEL_RELOAD:'Updated latest active revision of the doc',\n\t\tMSG_DEL_RELOAD_FAIL:'Failed reading active rev of doc ‘{1}’. Server responded ‘{2}: {3}’'\n\t},\n\t\n\t// Type $error manifest\n\t$error:{\n\t\tTXT_ERR:'<div class=\"w50p tal lh170 dib vat\">Error switching <i>{1}</i><br><span class=\"bolder\">{2}</span></div>'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1510930116996","id": ".dbType","type": "js","data": "({\n\tsizesafe:'',\n\tsyncstate:'',\n\n\tstamp:0,\n\t\n\tcommitted_update_seq:-1,\n\tcompact_running:false,\n\t\n\tdata_size:'',\n\tdisk_size:0,\n\tsizesafe:'',\n\tsizetip:'',\n\t\n\tdb_name:'',\n\tdisk_format_version:'',\n\tdoc_count:'',\n\tdoc_del_count:'',\n\tinstance_start_time:'',\n\tpurge_seq:'',\n\t\n\tupdate_seq:'',\n\tupdate_seq_safe:'',\n\n\tsecurity:{\n\t\tstamp:0,\n    seq:-1,\n\t\tadmins:{names:[],roles:[]},\n\t\tmembers:{names:[],roles:[]}\n\t},\n\tprotected:'',\n\n\ttasks:{ stamp:0, pids:[] },\n\tsyncs:{ stamp:0, docs:[] }\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1503540912075","id": ".init","type": "js","data": "(function ($o) {\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tcfg = that.Cfg;\n\t\n\t// is IE\n\tthat.isIE = !!navigator.userAgent.match(/Edge|Trident/);\n\n\t// isStandalone\n\tthat._compiled = that._compiled || !(cw.CW || typeof cw.debug == 'boolean');\n\t\n\t// init Photon local storage\n\tthat.Ls = that.Ls();\n\n\t// Base\n\tif (!that.Base) {\n\t\tthat.Base = window.DDOC ? window.DDOC._base : [location.protocol,'',location.host,''].compact().join('/');\n\t}\n\n\t// HTML\n\t$o.formgen('init', that.HTML.assign(that.lang));\n\t\t\n\t// Submanifests to preprocess\n  var childs = [\n    'Tab', \t\t\t'Login', \t'Logout', \n    'Compact', \t'NewDB', \t'DelDB', \t'SecObj', \n    'NewSync', \t'SetPwd', 'UserDoc', \n    'MangoEd', \t'ViewEd', 'IndexEd'\n   ].add(\n     Object.keys(that).filter(/^\\$/)\n   );\n\n\t// Mount editors, taken from global cache\n\tObject.keys(that.Ed).forEach(function(k){\n\t\tif (!that.Ed[k].id) return;\n\t\tthat.Ed[k] = $.extend(\n\t\t\ttrue, \n\t\t\t$.my.cache(that.Ed[k].id) || {}, \n\t\t\tthat.Ed[k], \n\t\t\t{Pho:that.Pho}\n\t\t);\n\t});\n\n\t// Mount lang and Pho on child manifests\n  var fkeys = ['Pho', 'Req', 'Sel2Scroll', 'p2u'];\n\tchilds.forEach(function(m){\n\t\tif (!that[m]) return;\n\t\tif (that[m].lang) $.extend(that[m].lang, that.lang[m] || {});\n    fkeys.forEach(function(i){that[m][i] = that[i]});\n\t});\n\t\n\t// j2h converter\n\tthat.j2h = that.Ed.jsontree.j2h;\n\n\t// Mount app/tab close event handler\n\t$o.on('tabclose.my', function(evt, tabid){ that.Close(tabid); });\n\t\n\t// on Standalone run\n\tif (that._compiled) {\n\t\t// Tab restore\n\t\tvar tabs = that.Ls('TabCloseHistory');\n\t\tif (tabs && tabs.length) {\n\t\t\tif (Date.now() - tabs[0].stamp < 30e3) that.Tabs = Object.clone(tabs[0].tabs, true);\n\t\t\telse {\n\t\t\t\t//search for most fat\n\t\t\t\tvar fat = [];\n\t\t\t\ttabs.forEach(function(e){\n\t\t\t\t\tif (Date.now() - e.stamp > 180*24*36e5) return;\n\t\t\t\t\tif (fat.length < e.tabs.length) fat = e.tabs;\n\t\t\t\t});\n\t\t\t\tif (fat.length) that.Tabs = Object.clone(tabs[0].tabs, true);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// Restore cfg\n\tvar pcfg = that.Ls('Cfg');\n\t$.extend(true, that.Cfg, Object.isObject(pcfg)?pcfg:{});\n\tif (pcfg && pcfg.listCols) that.Cfg.listCols = pcfg.listCols;\n\tcfg = that.Cfg;\n\n\t// After app init\n\t$o.then(function(){\n\t\t\n\t\t// Specific parts\n\t\t// for in-CloudWall exec...\n\t\tif (!that._compiled) {\n\t\t\tcw.log('Photon started in CloudWall');\n\t\t\t$o.on('click.my','a',function(evt){\n\t\t\t\tvar $a = $(evt.currentTarget),\n\t\t\t\t\t\thref = $a.attr('href');\n\t\t\t\tif (href[0]=='#') {\n\t\t\t\t\tvar path = decodeURIComponent(href.replace(/^#+\\/?/,'')).split('/').compact(true);\n\t\t\t\t\tthat.Switch(path);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// ... or Standalone run\n\t\tif (that._compiled) {\n\t\t\tcw.log('Photon couchapp started');\n\t\t\t// start router\n\t\t\t(function _Router (start) {\n\t\t\t\tfunction _route(){\n\t\t\t\t\tvar h = (location.hash+'').replace(/^#+/,'').split('/').map(decodeURIComponent);\n\t\t\t\t\tif (h[1]=='_design') { h[2] = '_design/'+h[2]; h.removeAt(1); }\n\t\t\t\t\tthat.Switch(h);\n\t\t\t\t}\n\t\t\t\tvar prevhash = start || '';\n\t\t\t\t$(window).on('hashchange.pho', _route.debounce(1000/60 + 3));\n\t\t\t\tif (start != null) location.hash = start+'';\n\t\t\t\t$(window).trigger('hashchange');\n\t\t\t})();\n\t\t\t\n\t\t\t// Icon image\n\t\t\t$('link[rel=\"icon\"]').attr('href', cfg.icon || that.files['favicon.png'].url);\n\t\t\t\n\t\t\t// beforeunload handler, checks if all tab changes are saved\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tvar dlg;\n\t\t\t\tif (that.Tabs.find(function(e){return e.hash0!=e.hash1})) {\n\t\t\t\t\tvar dlg = that.lang.DLG_UNLOAD;\n\t\t\t\t\te.returnValue = dlg;\n\t\t\t\t}\n\t\t\t\treturn dlg;\n\t\t\t};\n\t\t\t\n\t\t\t// stash tabs on unload\n\t\t\t$(window).on('unload', function(){\n\t\t\t\tvar tabs = Object.clone(that.Tabs, true),\n\t\t\t\t\t\thistory = that.Ls('TabCloseHistory') || [];\n\t\t\t\thistory.unshift({stamp:Date.now(), tabs:tabs.map(function(e){\n\t\t\t\t\te.run = false; \n\t\t\t\t\te.error = false; \n\t\t\t\t\te.hash0=e.hash1='';\n\t\t\t\t\treturn e;\n\t\t\t\t})});\n\t\t\t\tthat.Ls('TabCloseHistory',history.to(3));\n\t\t\t});\n\t\t}\n\n\t\t// rebuild styles\n\t\tthat.my.restyle();\n\t\t\n\t}.debounce(10));\n\t\n\treturn that.GetList();\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503540938839","id": ".ui","type": "js","data": "({\n  '#l-root':{\n    init:function($o){\n      var that = this;\n      $o.on('dblclick.my', (function(){\n        var ids = that.Tabs.reduce(function(a,b){\n          if (!b.path.length || b.hash0 != b.hash1) return a;\n          a.push({tabid:b.id, enforce:true, silent:true});\n        \treturn a;\n        },[]);\n        ids.last().silent = false;\n        ids.map((function(e){ that.Close(e); }).lazy(30));\n      \treturn false;\n      }).debounce(50));\n    },\n    bind:function(d){\n    \treturn this.SVG.logo;\n    }\n  },\n\t\n\t'#btn-aside-auth':{\n\t\tbind: function(d,v,$o){\n\t\t\tvar that = this,\n\t\t\t\t\tauth = cw.me(),\n\t\t\t\t\th = '';\n\t\t\t$o.attr('title', auth ? that.lang.TIP_PROFILE : that.lang.TIP_LOGIN);\n\t\t\t\n\t\t\th = '<span id=\"btn-auth-popup\">{1}</span>'.assign(auth ? that.SVG.user : that.SVG.login);\n\t\t\t\n\t\t\tif (v==null) return h;\n\t\t\t\t\n\t\t\tif ($o.data('modal')) $o.modal(true);\n\t\t\t\n\t\t\t// Not authorized\n\t\t\telse if (!auth) {\n\t\t\t\tthat.my.modal('#btn-aside-auth',{\n\t\t\t\t\tmanifest:that.Login,\n\t\t\t\t\twidth:300,\n\t\t\t\t\tnose:'top',\n\t\t\t\t\talign:'top:105%;right:-44px;',\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tz:1996,\n\t\t\t\t\tcss:'xgray'\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// authorized\n\t\t\telse {\n\t\t\t\tvar rl = (cw.me('roles')||[]).length;\n\t\t\t\tthat.my.modal('#btn-aside-auth',{\n\t\t\t\t\tmanifest:that.Logout,\n\t\t\t\t\twidth:rl<5?200:rl<10?250:300,\n\t\t\t\t\tnose:'top',\n\t\t\t\t\talign:'top:105%;right:-44px;',\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false,\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tz:1996\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn h;\n\t\t},\n\t\tevents:'click.my',\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){\n\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\tthis.my.check('#btn-aside-auth');\n\t\t\t}\n\t\t}\n\t},\n\t'#btn-aside-config':{\n\t\tbind: function(d,v,$o){\n\t\t\t$o.attr('title',this.lang.TIP_CONFIG);\n\t\t\treturn '<a href=\"#_config\">'+this.SVG.config+'</a>';\n\t\t}\n\t},\n\t'#btn-aside-share':{\n\t\tbind: function(d,v,$o){\n\t\t\t$o.attr('title',this.lang.TIP_SHARE);\n\t\t\treturn '<a href=\"#_about\">'+this.SVG.share+'</a>';\n\t\t},\n\t\tevents:'click.my'\n\t},\n\t\n\t'#l-apptabs':{\n\t\tinit: function($o){\n\t\t\tvar that = this;\n\t\t\t$o.sortable({ axis:'x', distance: 5 });\n\t\t},\n\t\tdelay:1,\n\t\tmerge:false,\n\t\tid:['id'],\n\t\thash:function(e){\n\t\t\treturn cw.lib.sdbm([ e.name, e.active, e.error, e.hash0, e.hash1 ]);\n\t\t},\n\t\tlist:'<div class=\"l-tab\"></div>',\n\t\tbind:'this.Tabs',\n\t\tmanifest:'this.Tab'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1503520189755","id": ".HTML","type": "html","data": "<div id=\"l-header\">\n\t<div id=\"l-tabs\">\n\t\t\n\t\t<div id=\"l-roottab\" class=\"l-tab\" style=\"width:72px;\">\n\t\t\t<a id=\"l-root\" href=\"#\" class=\"\"></a>\n\t\t</div>\n\t\t\n\t\t<div id=\"l-apptabs\" class=\"dib vat nw oh\"></div>\n\t\t\n\t\t<div id=\"l-aside\">\n\t\t\t<div id=\"btn-aside-auth\"></div>\n\t\t\t<div id=\"btn-aside-config\"></div>\n\t\t\t<div id=\"btn-aside-share\"></div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"l-board\">\n\t<div id=\"l-apps\">\n\t</div>\n</div>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503519805836","id": ".style","type": "js","data": "({\n\n\t// General section\n\n\t'   ':function($o){\n\t\tvar that = this,\n\t\t\t\tw = $o.width(),\n\t\t\t\tcfg = that.Cfg;\n\n\t\t// Set font size\n\t\tvar fsize = w<1500?15:16;\n\t\tvar fcsize = fsize - 1.5;\n\n\t\t\n\t\t//var fweight = /Firefox/.test(window.navigator.userAgent || '')?'400':'300';\n\t\tvar fweight = cfg.fontWeight;\n\n\t\t// font family\n\t\tvar font = \"'-apple-system','BlinkMacSystemFont','Helvetica Neue','Segoe UI',Helvetica,Tahoma,Verdana,sans-serif\";\n\t\tif (cfg.font != 'auto') font = cfg.font+',sans-serif';\n\t\t\n\t\t// code font family\n\t\tvar cfont = \"Cousine,'PT Mono',Menlo,Monaco,monospace\";\n\t\tif (cfg.fontCode != 'auto') cfont = cfg.fontCode+',monospace';\n\t\t\n\t\tvar css = \"font-size:{1}px!important;font-family: \"+font+\";font-weight:{2};\";\n\t\t\n\t\t// Set font for body\n\t\tif (that._compiled) $('body').css({'font-family':font, 'font-weight':fweight});\n\n\t\t// Set for elts and controls\n\t\treturn {\n\t\t\t'':css.assign(fsize, fweight)+'line-height:1.6em;',\n\t\t\t' button, input, textarea':css.assign('-',fweight),\n\t\t\t// Code Mirror\n\t\t\t' .CodeMirror, .pre':\"font-size:{1}px!important; font-family:{2}!important;\".assign(fcsize, cfont),\n\t\t\t' code':'font-family:{1}!important;'.assign(cfont)\n\t\t};\n\t},\n\n\t' .nocwmin':'display:none!important',\n\t' .notap':'-webkit-tap-highlight-color: rgba(0,0,0,0);',\n\t' .my-modal-overlay': 'box-shadow: 2px 3px 22px -7px rgba(10, 20, 29, 0.8)!important;border-radius:2px!important;',\n\t' .dif':'display:inline-flex;',\n\t' .w12p':'width:12%;',\n\t' .w18p':'width:18%;',\n\t' .bolder':'font-weight:bolder;',\n\t' .lighter':'font-weight:lighter;',\n\t' .w2em':'width:2em;',\n  \n  ' section':'outline: none;',\n\n\t' .my-tags.buttons':{\n\t\t' .tag':'border-radius:0; border: 1px solid #e3e5e7; transition:background-color 0.2s, color 0.2s;'\n\t\t\t+'margin-left:-1px;color:#8c96a2;',\n\t\t' .tag:hover':'color:#27a;',\n\t\t' .tag.active':'border:1px solid transparent;background-color:#e3e5e7;color:white;color:#8c96a2;',\n\t\t' .tag:first-child':'border-radius:3px 0 0 3px; border-left: 1px solid #e3e5e7;',\n\t\t' .tag:last-child':'border-radius:0 3px 3px 0;',\n\t\t' .tag:first-child:last-child':'border-radius:3px;'\n\t},\n\t\n\t' div.my-modal':'border: 1px solid rgba(224, 228, 232, 0.55);',\n  \n  ' .my-modal.modal-busy':{\n    ':after':'content:\" \";position:absolute;\\\n\t\t\t\ttop:-1px; left:0; width:100%; height:100%;\\\n\t\t\t\tz-index:5;border-radius:2px;\\\n\t\t\t\tbackground-color:rgba(255,255,255,0.6);\\\n\t\t\t\tbackground-image: url(i/loader-bar2.gif);\\\n\t\t\t\tbackground-repeat: repeat-x;\\\n\t\t\t\tbackground-position: center -7px;',\n    '.nose-top:before':'z-index:6;'\n  },\n\t\n\t' .pre':'white-space:pre-wrap; word-wrap:break-word;',\n  \n  /*' .tarrow':function(){\n    return [\n      'background-image:url(\"data:image/svg+xml;base64,'+btoa(this.SVG.arrows)+'\");',\n      'background-repet:no-repeat;',\n      'display:inline-block;width:15px;height:8px;overflow:hidden;'\n     ].join('')\n  },*/\n\n\t// Apps board\n\n\t' #l-board':{\n\t\t'':'width:100%; padding:0; overflow:hidden; ',\n\t\t' ':function($o){\n\t\t\tvar m = $o.parent().hasClass('my-modal-form'),\n          h = (window.innerHeight/(m?1.3:1)|0)+'px';\n\t\t\treturn this._compiled?'height:calc('+h+' - 32px);':'height:calc('+h+' - 70px);'//'height:600px;'\n\t\t}\n\t},\n\n\t// Apps\n\n\t' #l-apps':{\n\n\t\t'':'min-width:1020px;margin:0 auto;',\n\t\t\n\t\t'  ':function($o){\n\t\t\treturn 'max-width:'+this.Cfg.maxWidth+'px;'\n\t\t},\n\n\t\t' .l-app':{\n\t\t\t'':'opacity:1; transition: opacity 0.5s; transition-timing-function: ease-out;',\n\t\t\t' ':function($o){\n\t\t\t\tvar c = this._compiled,\n            m = $o.parent().hasClass('my-modal-form'),\n            h = ((window.innerHeight/(m?1.3:1)|0)-(c?0:32)) + 'px',\n\t\t\t\t\t\tt = 'height:calc('+h+' - ';\n\t\t\t\treturn {\n\t\t\t\t\t' .panelheight':t+'84px);',\n\t\t\t\t\t' .panelheight-4':t+'88px);',\n\t\t\t\t\t' .panelheight-8':t+'92px);',\n\t\t\t\t\t' .panelheight-16':t+'100px);',\n\t\t\t\t\t' .panelheight-32':t+'116px);',\n\t\t\t\t\t' .panelheight-48':t+'132px);',\n\t\t\t\t\t' .panelheight-64':t+'148px);',\n\t\t\t\t};\n\t\t\t},\n\t\t\t' .app-head':{\n\t\t\t\t'':'display:block;height:52px;overflow:hidden;width:100%;',\n\t\t\t\t\n\t\t\t\t' button, .button':'height:2em;padding-top:0.2em;padding-bottom:4px;line-height:19px;text-align:center;'\n\t\t\t},\n\t\t\t'.app-busy':'opacity:0.5;transition-timing-function: ease-in;',\n\t\t\t\n\t\t\t' .feather':{\n\t\t\t\t':before':{\n\t\t\t\t\t'':'content:\" \";position:absolute;top:0;left:0;width:calc(100% - 6px);height:15px;pointer-events: none;'\n\t\t\t\t\t+'background-image: linear-gradient(to bottom, rgba(255,255,255,1), rgba(255,255,255,0));z-index:1990;'\n\t\t\t\t},\n\t\t\t\t':after':{\n\t\t\t\t\t'':'content:\" \";position:absolute;bottom:0;left:0;width:calc(100% - 6px);height:15px;'\n\t\t\t\t\t+'background-image: linear-gradient(to top, rgba(255,255,255,1), rgba(255,255,255,0));z-index:1990;'\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t' .app-busy:after':'\\\n\t\t\t\tcontent:\" \";\\\n\t\t\t\tposition:absolute;\\\n\t\t\t\tz-index:+1993;\\\n\t\t\t\tbackground-color:rgba(255,255,255,0);\\\n\t\t\t\twidth:100%;\\\n\t\t\t\theight:110%;\\\n\t\t\t\ttop:0;\\\n\t\t\t\tleft:0;'\n\t},\n\t\n\t// Jval\n\t\n\t' .jval-bracket, .jval-key':'font-weight:bolder;',\n\t' .jval-trim':'display:inline-block;border-radius:2px;padding:1px 2px;line-height:1.1em;'\n\t+'color:rgba(213, 48, 89, 0.63);background-color:rgba(43, 107, 192, 0.07);',\n\t' .jval-short':'color:rgba(88,101,123,0.63);xbackground-color:rgba(43, 107, 192, 0.07);',\n\t' .jval-key':'margin-left:2px;',\n\t' .jval-bracket+.jval-key':'margin-left:0px;',\n\t' .jval-simple':'color:rgba(52, 143, 27, 0.78);',\n\t' .jval-string':'color:#3b5e85;',\n\n\t// CM\n\t' .CodeMirror-linenumber':'white-space:nowrap;',\n  ' .CodeMirror-gutters':'background:white;xborder-right:none;'\n\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503519671804","id": ".style","type": "js","data": "({\n\n\t// Header and tabs \n\n\t' #l-header':{\n\n\t\t'':[\n\t\t\t'width:100%;height:32px;overflow:hidden;',\n\t\t\t'background-size: 2px 32px;background-position:0 0;',\n\t\t\t'background-image: linear-gradient(to bottom, #0c1932, #4b627c);'\n\t\t].join(''),\n\t\t\n\t\t' #l-tabs ':function($o){\n\t\t\treturn 'max-width:'+this.Cfg.maxWidth+'px;'\n\t\t},\n\n\t\t' #l-tabs':{\n\t\t\t'':'min-width:1020px;margin:0 auto;',\n\t\t\t' .ui-sortable-helper':'background-color:rgba(102,120,152,0.8);border-left:1px solid #9ea6b0;',\n\t\t\t' .ui-sortable-placeholder+.l-tab':'border-left:1px solid #9ea6b0;',\n\t\t\t\n\t\t' .tab-busy:after':'\\\n\t\t\t\tcontent:\" \";\\\n\t\t\t\tposition:absolute;\\\n\t\t\t\tz-index:+1980;\\\n\t\t\t\twidth:100%;\\\n\t\t\t\theight:2px;\\\n\t\t\t\tbottom:0;\\\n\t\t\t\tleft:0;\\\n\t\t\t\toverflow:hidden;\\\n\t\t\t\tbackground-image: url(i/loader-bar2.gif);\\\n\t\t\t\tbackground-repeat: repeat-x;\\\n\t\t\t\tbackground-position-y: -1px;',\n\t\t},\n\n\t\t' #l-roottab':{\n\t\t\t'':'border-left:1px solid #9ea6b0;',\n\t\t\t' #l-root':'padding:3px 10px 0 20px;width:72px;display:block;'\n\t\t},\n\n\t\t' #l-apptabs':'width:calc(100% - 72px - 96px);',\n\n\t\t// Tab\n\t\t' .l-tab':{\n\n\t\t\t'':[\n\t\t\t\t'line-height:29px; height:32px; min-width:72px; max-width:220px; transition:width 0.2s;',\n\t\t\t\t'border-right:1px solid #9ea6b0;',\n\t\t\t\t'border-left:1px solid transparent;',\n\t\t\t\t'display:inline-block;vertical-align:top;overflow:hidden;'\n\t\t\t].join(''),\n\n\t\t\t' ':function(){\n\t\t\t\treturn 'width:calc(100% / '+(this.Tabs.length || 1)+');';\n\t\t\t},\n\n\t\t\t':hover':{\n\t\t\t\t//'':'background-position:0 -64px;',\n\t\t\t},\n\t\t\t\n\t\t\t// tab marks\n\t\t\t' #btn-tabclose':'cursor:pointer;display:none;color:rgba(255,255,255,0.25);',\n\t\t\t' #l-tabstate':'color:rgba(141,209,255,0.92);',\n\t\t\t' #l-tabstate.hide+#btn-tabclose':'display:block;',\n\t\t\t' .l-tabmark':{\n\t\t\t\t'':'width:16px;position:absolute;line-height:20px;right:0;top:0;text-align:center;',\n\t\t\t\t'  ':'transition: opacity 0.3s, color 0.3s;'\n\t\t\t},\n\t\t\t':hover ':{\n\t\t\t\t' #l-tabstate':'display:none!important;',\n\t\t\t\t' #btn-tabclose':'display:block!important;color:rgba(255,255,255,0.6);'\n\t\t\t},\n\t\t\t' #btn-tabclose:hover':'color:rgba(255,255,255,0.8);',\n\t\t\t\n\n\t\t\t// links\n\t\t\t' a':'text-decoration:none;transition: opacity 0.3s;color:white!important;opacity:0.8!important;',\n\t\t\t':hover a':'opacity:1!important;',\n\n\t\t\t' #l-tabname':{\n\t\t\t\t'':'width:calc(100% - 16px);display:inline-block;overflow:hidden;text-overflow:ellipsis;'\n\t\t\t\t+'padding:0 0 4px 6px;white-space: nowrap;',\n\t\t\t\t'.smaller':'font-size:0.95em;'\n\t\t\t},\n\n\t\t\t// Active tab\n\t\t\t'.active':{\n\t\t\t\t' a':'color:#001328!important;opacity:0.8!important;font-weight:bolder;',\n\t\t\t\t':hover a':'opacity:0.95!important;',\n\t\t\t\t'':[\n\t\t\t\t\t' background-size: 2px 32px;background-position:0 0;',\n\t\t\t\t\t'background-image: linear-gradient(to bottom, #a3b5cd, #d2deee);'\n\t\t\t\t].join(''),\n\t\t\t\t' #l-tabstate':'color:rgba(37,137,215,0.8);',\n\t\t\t\t' #btn-tabclose':'color:rgba(0,18,40,0.3);',\n\t\t\t\t':hover #btn-tabclose':'color:rgba(0,18,40,0.6);',\n\t\t\t\t' #btn-tabclose:hover':'color:rgba(0,18,40,0.8);',\n\t\t\t}\n\t\t}, // -- end Tab\n\n\t\t// Right tabs\n\t\t' #l-aside':{\n\t\t\t'':'position:absolute;top:0;right:0;width:96px;border-right:1px solid #9ea6b0;'\n\t\t\t+'white-space: nowrap;width:auto;z-index:2;',\n\t\t\t'>div':[\n\t\t\t\t'height:32px; width:32px; cursor:pointer;',\n\t\t\t\t'border-left:1px solid #9ea6b0;',\n\t\t\t\t'display:inline-block; vertical-align:top; overflow:hidden;',\n\t\t\t\t'transition: color 0.3s, opacity 0.3s; color:white!important;',\n\t\t\t\t'opacity:0.7!important;'\n\t\t\t].join(''),\n\t\t\t'>div:hover':'opacity:0.9!important;',\n\t\t\t\n\t\t\t 'a':'text-decoration:none;'\n\t\t} \n\t\t\n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503538143099","id": ".SVG","type": "js","data": "({\n\t// SVG icons and other images\n})","active": false,"err": [],"opts": [],"color": []},{"stamp": "1503524102852","id": ".SVG.logo","type": "html","data": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"31\" height=\"16\" viewBox=\"0, 0, 31, 16\">\n  <g id=\"PhotonLogo\">\n     <path d=\"M15.5,0 C20.3,0.0 24.2,0.6 27.8,1.9 L28.0,1.9 C29.6,2.5 29.2,2.4 29.4,2.4 L31,3.1 L31,16 L0,16 L0,3.1 C1.7,2.4 1.3,2.5 2.4,2.1 L2.9,1.9 C6.7,0.6 10.6,0.0 15.1,0.0 z\" \n\t\t\t\t\t fill=\" #FFFFFF\" fill-opacity=\"1\"/>\n     <path d=\"M30,12 L30,15 L1,15 L1,12 L30,12 z\" \n\t\t\t\t\t fill=\" #D51D1D\"/>\n     <path d=\"M3.0,3.0 C3.1,3.7 3.2,4.3 3.2,4.6 C3.4,5.7 3.9,6.6 4.7,7.2 C5.4,7.7 6.2,8.0 7.0,8.0 C8.0,7.9 11.6,8.0 13.1,8.0 C14.0,8.0 14.6,8.6 15,9.5 L15,11 L1,11 L1,3.8 C2.6,3.1 1.9,3.4 3.0,3.0 z\" \n\t\t\t\t\t fill=\" #FA4848\"/>\n     <path d=\"M15,1 L15,7.7 C14.6,7.1 14.0,6.9 13.4,6.8 C9.5,6.8 8.6,6.8 7.6,6.8 C7.4,6.8 7.3,6.8 7.3,6.8 C5.8,6.8 4.4,5.7 4.1,4.0 L4,2.8 C7.5,1.5 11.3,1.0 15,1 z\" \n\t\t\t\t\t fill=\" #FF6767\"/>\n     <path d=\"M27.9,3.0 C27.8,3.7 27.7,4.3 27.7,4.6 C27.5,5.7 27.0,6.6 26.2,7.2 C25.5,7.7 24.7,8.0 23.9,8.0 C22.9,7.9 19.3,8.0 17.8,8.0 C16.9,8.0 16.3,8.6 16,9.5 L16,11 L30,11 L30,3.8 C28.3,3.1 29.0,3.4 27.9,3.0 z\" \n\t\t\t\t\t fill=\" #FA4848\"/>\n     <path d=\"M16,1 L16,7.7 C16.3,7.1 16.9,6.9 17.5,6.8 C21.4,6.8 22.3,6.8 23.3,6.8 C23.5,6.8 23.6,6.8 23.6,6.8 C25.1,6.8 26.5,5.7 26.8,4.0 L27,2.8 C23.4,1.5 19.6,1.0 16,1 z\" \n\t\t\t\t\t fill=\" #FF6767\"/>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": []},{"stamp": "1503538292860","id": ".SVG.user","type": "html","data": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"btn-user-svg\">\n    <g>\n      <path d=\"M26.25,20.65 L23.55,23.35 L21.75,21.55 M24,17.5 C21.51,17.5 19.5,19.51 19.5,22 C19.5,24.48 21.51,26.5 24,26.5 C26.48,26.5 28.5,24.48 28.5,22 C28.5,19.51 26.48,17.5 24,17.5 z\" fill-opacity=\"0\" \n      stroke=\" #B3FF94\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      <path d=\"M18.99,18.44 L16,17.36 L16,15.32 M17,22.5 L6.5,22.5 L6.5,21.01 C6.5,20.01 7.11,19.11 8.05,18.77 L12,17.36 L12,15.32 M17.94,11.23 C17.94,8.62 16.18,6.5 14,6.5 C11.81,6.5 10.05,8.62 10.05,11.23 C10.05,13.85 11.81,15.97 14,15.97 C16.17,15.97 17.94,13.85 17.94,11.23 z M10.09,10.47 C10.57,10.72 11.05,10.84 11.62,10.84 C12.76,10.84 14.14,10.17 14.59,9.31 C15.33,10.61 16.19,11.10 17.54,10.84 C17.67,10.81 17.78,10.82 17.91,10.81\" fill-opacity=\"0\" \n      stroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </g>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": []},{"stamp": "1503538162663","id": ".SVG.login","type": "html","data": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"Layer_1\">\n    <g>\n      <path d=\"M16.5,19.5 L4.5,19.5 L4.5,10.5 L27.5,10.5 L27.5,16.52 M8.5,17 L8.5,13 M6.82,16.09 L10.17,13.90 M6.83,13.89 L10.16,16.11 M14.5,17 L14.5,13 M12.82,16.09 L16.17,13.90 M12.83,13.89 L16.16,16.11\" fill-opacity=\"0\" \n      stroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      <path d=\"M18.5,19.83 L27.5,19.83 L27.5,26.50 L18.5,26.50 z M22.97,22.57 L22.97,24.24 M25.67,19.83 L25.67,19.00 C25.67,17.62 24.46,16.50 22.97,16.50 C21.48,16.50 20.27,17.62 20.27,19.00 L20.27,19.83 M23.42,22.15 C23.42,21.92 23.22,21.74 22.97,21.74 C22.72,21.74 22.52,21.92 22.52,22.15 C22.52,22.38 22.72,22.57 22.97,22.57 C23.22,22.57 23.42,22.38 23.42,22.15 z\" fill-opacity=\"0\" \n      stroke=\" #FFC300\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </g>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": []},{"stamp": "1503538361216","id": ".SVG.config","type": "html","data": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"Layer_1\">\n    <path d=\"M16.48,18.5 L16.48,11.5 M22.51,16.5 L22.51,18.5 M10.48,7.5 L10.48,12.5 M10.48,14.5 L10.48,18.5 M22.51,7.5 L22.51,14.5 M16.48,7.5 L16.48,9.5 M20.51,16.5 L24.51,16.5 L24.51,14.5 L20.51,14.5 z M14.48,11.5 L18.48,11.5 L18.48,9.5 L14.48,9.5 z M8.48,14.5 L12.48,14.5 L12.48,12.5 L8.48,12.5 z M22.52,21.5 C21.69,21.5 21.02,22.17 21.02,23 C21.02,23.82 21.69,24.5 22.52,24.5 C23.35,24.5 24.02,23.82 24.02,23 C24.02,22.17 23.35,21.5 22.52,21.5 z M16.48,21.5 C15.65,21.5 14.98,22.17 14.98,23 C14.98,23.82 15.65,24.5 16.48,24.5 C17.31,24.5 17.98,23.82 17.98,23 C17.98,22.17 17.31,21.5 16.48,21.5 z M10.48,21.5 C9.65,21.5 8.98,22.17 8.98,23 C8.98,23.82 9.65,24.5 10.48,24.5 C11.31,24.5 11.98,23.82 11.98,23 C11.98,22.17 11.31,21.5 10.48,21.5 z\" fill-opacity=\"0\" \n    stroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": []},{"stamp": "1503538227959","id": ".SVG.share","type": "html","data": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"32\" height=\"32\" viewBox=\"0, 0, 32, 32\">\n  <g id=\"btn-share-svg\">\n    <path d=\"M25.5,15 C26.60,15 27.5,15.89 27.5,17 C27.5,18.10 26.60,19 25.5,19 C24.39,19 23.5,18.10 23.5,17 C23.5,15.89 24.39,15 25.5,15 z M25.5,22.5 C24.39,22.5 23.5,23.39 23.5,24.5 C23.5,25.60 24.39,26.5 25.5,26.5 C26.60,26.5 27.5,25.60 27.5,24.5 C27.5,23.39 26.60,22.5 25.5,22.5 z M17.5,19 C16.39,19 15.5,19.89 15.5,21 C15.5,22.10 16.39,23 17.5,23 C18.60,23 19.5,22.10 19.5,21 C19.5,19.89 18.60,19 17.5,19 z M23.71,17.89 L19.28,20.10 M23.5,23.5 L19.37,21.70 M12.5,16.5 L10.5,14.5 L12.5,12.5 M15.5,16.5 L17.5,14.5 L15.5,12.5 M20.5,14.5 L20.5,10.5 L17.5,7.5 L7.5,7.5 L7.5,22.5 L13.5,22.5 M20.5,10.5 L17.5,10.5 L17.5,7.5\" fill-opacity=\"0\" \n\t\t\t\t\tstroke=\" #FFFFFF\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": []},{"stamp": "1503611680742","id": ".Ed","type": "js","data": "({\n\t// Overlaps for cw.Sys.JSON, \n\t// which is stashed here on init\n\t\"jsontree\": { /* See tabs */ },\n\t\n\t// Overlaps for JSON plain editor,\n\t// not yet known\n\t\"jsontext\":{}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1503805119058","id": ".Ed.jsontree","type": "js","data": "({\n\t// Redefines parts of JSON Editor\n\t// to adapt it for Photon runtime environment\n\t\n\tid:'cw.Sys.JSON',\t// id in manifest cache\n\tparams:{},\n\tui:{\n\t\t\"#btn-save\":{\n\t\t\tbind:function(d,v){\n\t\t\t\tif (v!=null) this.my.trigger('#btn-save','savedoc.my');\n\t\t\t}\n\t\t}\n\t},\n\t\n\tLib:{\n\t\tisSystem:function (d){\n\t\t\tvar that = this,\n\t\t\t\t\tisNew = that.my.root().parents('.l-app').eq(0).my('data').isNew;\n\t\t\tif (!isNew) return !!(\n\t\t\t\t(d.level==1 && /^(_id|_rev|_local_seq)$/.test(d.key) && d.value) \n\t\t\t\t||\n\t\t\t\t(d.level>2 && d.path[1] =='_revs_info')\n\t\t\t\t||\n\t\t\t\t(d.path[1] == '_conflicts')\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\t},\n\t\n\tstyle:{\n\t\t' ':'',\n\t},\n\t\n\t/*HTML:{\n\t\tItemRoot:[\n\t\t\t'<div class=\"inav\">',\n\t\t\t\t'<div class=\"ikey\"></div>',\n\t\t\t\t'<div class=\"idesc cp\">–</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"ivalue imulti hide\">',\n\t\t\t\t'<div class=\"ilist\"></div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"iact buttons\">',\n\t\t\t\t'<button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button>',\n\t\t\t\t'<button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button>',\n\t\t\t\t//'<button class=\"btn-copy button\" title=\"Stash node as clip\"><span class=\"fi-clipboard\"></span></button>',\n\t\t\t\t'<button class=\"btn-del button red hide\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n\t\t\t\t'<button id=\"btn-attach\" class=\"button\" title=\"Add attachment\" style=\"width:74px\">',\n\t\t\t\t\t'<span class=\"fi-paperclip\"></span><span class=\"fs90\"> Attach…</span>',\n\t\t\t\t'</button>',\n\t\t\t'</div>'\n\t\t].join('')\n\t},*/\n\t\n\tLs: function(){\n\t\n\t\t// Local storage manager\n\t\tvar ls = window.localStorage;\n\n\t\tvar storage =  function LS (key0, data){\n\t\t\tvar x,  key = \"cw.Sys.JSON.\"+key0;\n\t\t\tif (data) {\n\t\t\t\treturn ls.setItem(key, JSON.stringify(data));\n\t\t\t}\n\t\t\telse if (data===null || data===false) {\n\t\t\t\treturn ls.removeItem(key);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar x = ls.getItem(key);\n\t\t\t\tif (Object.isString(x)) return JSON.parse(x);\n\t\t\t\telse return null;\n\t\t\t}\n\t\t};\n\n\t\treturn storage;\n\t},\n\t\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1505881099675","id": ".Ed.jsontree","type": "js","data": "({\n\tMakeList:\tfunction(data, key, state){\n\n\t\t// Object/array processor,\n\t\t// generates typed metaobject\n\n\t\tvar that=this,\n\t\t\t\ta=[],  \n\t\t\t\tb = data.value,\n\t\t\t\tsdbm = cw.lib.sdbm,\n\t\t\t\tatob = window.atob,\n\t\t\t\tvs = that.data.viewstate || {},\n\t\t\t\tfound = that.data.found || {},\n\t\t\t\tlevel = data.level + 1,\n\t\t\t\tisSearch = that.data.search.length > 2;\n\n\t\tvar keys = Object.keys(b);\n    \n    if (data.key == '_attachments' && data.path.length == 1 && data.path[0] == 'Root'){\n    \tkeys = keys.sortBy(function(k){\n        var l0 = k.indexOf('/')>-1;\n        if (/^index\\.htm/.test(k)) return '0'+k;\n        if (!l0) return '1'+k;\n        return '2'+k;\n      });\n    }\n    \n\t\tkeys.forEach(function(i){\n\t\t\tvar val = b[i],\n\t\t\t\t\tdt = $.type(val),\n\t\t\t\t\tman = dt == 'object' || dt == 'array' ? 'multi' : dt,\n\t\t\t\t\thash,\n\t\t\t\t\tbin,\n          reimg = /^data:image\\/(jpeg|png|gif|svg\\+xml);base64,/;\n\t\t\t\n\t\t\t// viewstate\n\t\t\tvar path = data.path.slice(0).add(data.key),\n\t\t\t\t\tvkey = cw.lib.sdbm(path.join('❀')+'❀'+i);\n\n\t\t\tif (isSearch && !found[vkey]) return;\n\n\t\t\t// Photon-related stuff\n\t\t\tif (man == 'multi') {\n\t\t\t\tif (data.key == 'Root' && !data.path.length && i=='_attachments') {\n\t\t\t\t\tman = 'files';\n\t\t\t\t}\n\t\t\t\telse if (data.key == '_attachments' && data.path.length == 1 && data.path[0] == 'Root') {\n\t\t\t\t\tman = 'file';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Detect string-derived types\n\t\t\tif (dt == 'string'){\n\t\t\t\tif (isSearch && (found[vkey] | 8)) {\n\t\t\t\t\tman = 'found';\n\t\t\t\t\thash = sdbm(val);\n\t\t\t\t}\n\t\t\t\telse if (val.length > 11 && val.to(8) == 'function' && /\\}[\\r\\n\\t\\s]*$/.test(val.substr(-10))) {\n\t\t\t\t\tman = 'function';\n\t\t\t\t}\n\t\t\t\telse if(\n\t\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+$/.test(val.substr(0,158))\n\t\t\t\t\t&& /^[a-zA-Z0-9\\+\\/]+={0,2}$/.test(val)\n\t\t\t\t) {\n\t\t\t\t\tbin = _atob(val);\n\t\t\t\t\thash = sdbm(val);\n\t\t\t\t\tman = 'base64';\n\t\t\t\t}\n\t\t\t\telse if(\n\t\t\t\t\tval.length>160 && val.length < 150e3\n\t\t\t\t\t&& reimg.test(val)\n\t\t\t\t) {\n\t\t\t\t\tbin = _atob(val.replace(reimg,''));\n\t\t\t\t\thash = sdbm(val);\n\t\t\t\t\tman = 'base64';\n\t\t\t\t}\n\t\t\t\telse hash = sdbm(val);\n\t\t\t}\n\n\t\t\tif (!isSearch || found[vkey]) a.push({\n\t\t\t\tstate:state?state:!isSearch?vs[vkey] || 1:found[vkey],\n\t\t\t\tlevel:level,\n\t\t\t\tmanifest:'$'+man,\n\t\t\t\tpath:path,\n\t\t\t\ttype:dt,\n\t\t\t\tkey:i,\n\t\t\t\tid:i,\n\t\t\t\tvalue:b[i],\n\t\t\t\tbin:bin,\n\t\t\t\thash:hash\n\t\t\t});\n\t\t});\n\n\t\treturn a;\n\n\t\t// - - -\n\n\t\tfunction _atob(s){\n\t\t\tvar bin = '';\n\t\t\ttry {\n\t\t\t\tbin = atob(s);\n\t\t\t} catch(e){}\n\t\t\treturn bin;\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1503805767293","id": ".Ed.jsontree.$files","type": "js","data": "({\n\tid:\"Sys.JSON.Files\",\n\tdata:{},\n\tList:[],\n\tTxt:{\n\t\tobject:\t[\"Files {\",\"}\"],\n\t\tarray:\t[\"Array [\",\"]\"]\n\t},\n\tinit: function _init_files($o, form){\n\t\t\n\t\t// Special replacement for ._atatchments branch\n\t\t\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\tif (d.state > 1) that.List = that.MakeList(d);\n\t\t\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.RT('Rejoin')(d, that.List);\n\t\t}.debounce(300));\n\t\t\n\t\t$o.on(\"click.my\", \".ilist:eq(0) .btn-del\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $f = $(this).parents(\".my-form\").eq(0);\t\t\n\t\t\tvar p = $f.parent().data(\"my\").data,\n\t\t\t\t\tt = $.type(p.value),\n\t\t\t\t\tkey = $f.my(\"data\").key;\n\t\t\t\n\t\t\tif (t==\"object\") delete p.value[key];\n\t\t\telse if (t==\"array\") p.value.removeAt(key);\n\t\t\t\n\t\t\tthat.RT('Lib').relist($o, that, form);\n\t\t});\n\t\t\n\t},\n\tShowItems:null,\n\tui:{\n\t\t\".ivalue\":{\n\t\t\tcss:{\n\t\t\t\thide:function(){return !this.List.length}\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t\".ilist\":{\n\t\t\tdelay:0,\n\t\t\tcheck:false,\n\t\t\tbind:\"this.List\",\n\t\t\tlist:'<div class=\"irow\"></div>',\n\t\t\tid:function(e){return e.id;},\n\t\t\thash:function(e){return e.hash;},\n\t\t\tmanifest: function(e) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn that.RT(e.manifest)||that.RT('$string');\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t\".ikey\":{\n\t\t\tdelay:10,\n\t\t\tbind:function(d,v){\n\t\t\t\treturn (!/^(|\\s+)$/.test(d.key))?d.key.truncate(25,'right','…'):'\"'+d.key+'\"'; \n\t\t\t},\n\t\t\tcss:{\n\t\t\t\tbold:function(d){return d.state!=1}\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t'#btn-upload':{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v==null) return;\n\t\t\t\tvar that = this;\n\t\t\t\tif ($o.data('modal')) {\n\t\t\t\t\t$o.modal(true);\n\t\t\t\t\t_close();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$o.parent().addClass('hover');\n\t\t\t\t\tthat.my.modal('#btn-upload',{\n\t\t\t\t\t\tmanifest:that.Add,\n\t\t\t\t\t\tdata:{},\n\t\t\t\t\t\twidth:500,\n\t\t\t\t\t\talign:'top:103%, right:-38px;',\n\t\t\t\t\t\tnose:'top'\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\tres.files.forEach(function(file){\n\t\t\t\t\t\t\td.value[file.name] = Object.select(file, ['content_type','data']);\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.state=2;\n            that.List = that.MakeList(d);\n\t\t\t\t\t\tthat.my.redraw();\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t_close();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// - - - - -\n\t\t\t\tfunction _close(){\n\t\t\t\t\t$o.parent().removeClass('hover');\n\t\t\t\t}\n\t\t\t},\n\t\t},\n    \n    '#btn-b64':{\n      bind: function(d,v){\n      \tif (v==null) return;\n        var that = this;\n        that.RT('GetAtts')()\n        .then(function(){\n        \tthat.my.redraw();\n        });\n      }\n    },\n\t\t\n\t\t\".idesc\":{\n\t\t\tdelay:10,\n\t\t\tbind: function(d,v,$o) {\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tlist = this.List, \n\t\t\t\t\t\tt = that.Txt[d.type],\n\t\t\t\t\t\tds = Object.size(d.value),\n\t\t\t\t\t\th=\"\";\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.state = ((d.state==1 && !(d.manifest==\"$multi\" && !ds))|| !d.level?2:1);\n\t\t\t\t\tif (d.state==2) that.List = that.MakeList(d);\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.List = [];\n\t\t\t\t\t\tthat.ShowItems = null;\n\t\t\t\t\t}\n\t\t\t\t\tthat.RT('MemState')(d);\n\t\t\t\t}\n\n\t\t\t\tif (d.state==1 && that.ShowItems) {\n\t\t\t\t\th = that.ShowItems +(ds?\" ▸\":\"\");\n\t\t\t\t} else {\n\t\t\t\t\th = t[0]+ds+t[1] +\" \"\n\t\t\t\t\th += (!ds || !d.level?\"\":!that.List.length?\"▸\":\"▾\");\n\t\t\t\t\tif (d.state == 2) h = '<span class=\"o40\">'+h+'</span>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t}\n\t},\n\tstyle:{\n\t\t'>.ivalue>.ilist>.irow':function(){\n\t\t\tvar x = 250,\n\t\t\t\t\tx1 = x - 27;\n\t\t\treturn {\n\t\t\t\t' .inav':'padding-left:'+x1+'px;',\n\t\t\t\t' .inav>.ikey':'margin-left:-'+x1+'px;width:'+x1+'px;',\n\t\t\t\t'>.inav':'padding-left:'+x+'px;',\n\t\t\t\t'>.inav>.ikey':'margin-left:-'+x+'px;width:'+x+'px;',\n\t\t\t}\n\t\t},\n\t\t' .ivalue .inav':'margin:0;'\n\t},\n\tHTML:([\n\t\t'<div class=\"inav\">',\n\t\t\t'<div class=\"ikey\"></div>',\n\t\t\t'<div class=\"idesc cp\">–</div>',\n\t\t'</div>',\n\t\t'<div class=\"ivalue imulti hide\">',\n\t\t\t'<div class=\"ilist\"></div>',\n\t\t'</div>',\n\t\t'<div class=\"iact buttons\">',\n\t\t\t//'<button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button>',\n    \t'<button id=\"btn-b64\" class=\"button\" title=\"Fetch attachments’ base64\">&thinsp;<span class=\"fi-archive\"></span>&thinsp;</button>',\n\t\t\t'<button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button>',\n\t\t\t'<button id=\"btn-upload\" class=\"button\" title=\"Add attachment\"><span class=\"fi-paperclip\"></span></button>',\n\t\t\t'<button class=\"btn-del button red\"  title=\"Del all attachments\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n\t\t'</div>'\n\t].join(''))\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504815400562","id": ".Ed.jsontree.$files.Add","type": "js","data": "({\n\tinit: function($o){\n\t\tvar that = this;\n\t\t\n\t\t$o.html(that.HTML);\n\t},\n\tdata:{\n\t\tfiles:[]\n\t},\n\tui:{\n\t\t'#flist':{\n\t\t\tbind:'files',\n\t\t\tlist:'>div',\n\t\t\tmerge:false,\n\t\t\tid:['name'],\n\t\t\thash:function(e){return cw.lib.sdbm([e.name, e.content_type, e.data.length, e.data.to(100)])},\n\t\t\tmanifest:{\n\t\t\t\tui:{\n\t\t\t\t\t'#fname':'name',\n\t\t\t\t\t'#fsize':function(d,v){\n\t\t\t\t\t\treturn (d.data.length/4*3|0).bytes(1).replace(/B$/,'b').replace(\n\t\t\t\t\t\t\t/^([0-9\\.]+)([a-z]+)$/i,\n\t\t\t\t\t\t\t'$1<div class=\"w35 dib tal pl2\">$2</div>'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\t'#ftype':'content_type',\n\t\t\t\t\t'#btn-fdel':{\n\t\t\t\t\t\tdelay:10,\n\t\t\t\t\t\tbind:function(d,v){if (v!=null) this.my.remove();},\n\t\t\t\t\t\tevents:'click.my'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'#btn-attadd':{\n\t\t\tbind:function(d,v){if(v!=null) this.my.commit();},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d){return !d.files.length}\n\t\t\t},\n\t\t\twatch:'#flist'\n\t\t},\n\t\t'#btn-attcancel':function(d,v){if(v!=null) this.my.cancel();},\n\t\t'#mupload':{\n\t\t\tbind:function(d,v,$o) {\n\t\t\t\tif (v==null || !v) return;\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tflist = $o[0].files,\n\t\t\t\t\t\tfiles = [],\n\t\t\t\t\t\tresult = d.files.reduce(function(a,b){a[b.name] = b;return a;},{}),\n\t\t\t\t\t\tpis = [];\n\t\t\t\t\n\t\t\t\tfor(var i=0; i<flist.length;i++) files.push(flist[i]);\n\t\t\t\t\n\t\t\t\tfiles.forEach(function(f, i){\n\t\t\t\t\tif (!f) return;\n\t\t\t\t\t//a.name = f.name;\n\t\t\t\t\tvar data,\n\t\t\t\t\t\t\ta = {\n\t\t\t\t\t\t\t\tname:f.name,\n\t\t\t\t\t\t\t\tcontent_type: f.type || 'application/octet-stream'\n\t\t\t\t\t\t\t}, \n\t\t\t\t\t\t\tpi = $.Deferred(),\n\t\t\t\t\t\t\tfr = new FileReader(), \n\t\t\t\t\t\t\tri, \n\t\t\t\t\t\t\tsb64 = [];\n\t\t\t\t\t\n\t\t\t\t\tfr.onload = function(e){\n\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\tdata = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\ta.data = data;\n\t\t\t\t\t\t//a.length = sb64.length;\n\t\t\t\t\t\tresult[f.name] = a;\n\t\t\t\t\t\tpi.resolve();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tfr.readAsArrayBuffer(f);\n\t\t\t\t\tpis.push(pi.promise())\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tQ.allSettled(pis)\n\t\t\t\t.then((function(){\n\t\t\t\t\td.files = Object.values(result);\n\t\t\t\t\t$o.wrap('<'+'form>').closest('form').get(0).reset();\n\t\t\t\t\t$o.unwrap('form');\n\t\t\t\t\tthat.my.recalc('#flist');\n\t\t\t\t}).debounce(0));\n\t\t\t}\n\t\t}\n\t},\n\t\n\tHTML:[\n\t\t'<div class=\"fs130 lh160 bolder\">Add files</div>',\n\t\t\n\t\t'<div id=\"flist\" class=\"fs95\">',\n\t\t\t'<div class=\"frow  mb6\">',\n\t\t\t\t'<div id=\"btn-fdel\" class=\"red2 w20 dib vat pt3 cp\">✕</div>',\n\t\t\t\t'<div class=\"w220 dib vat\"><input type=\"text\" class=\"w100p\" id=\"fname\" placeholder=\"File path/name.ext\"></div>',\n\t\t\t\t'<div id=\"fsize\" class=\"w90 dib vat pt3 gray tar\"></div>',\n\t\t\t\t'<div id=\"ftype\" class=\"w150 dib vat pt3 gray nw ell\"></div>',\n\t\t\t'</div>',\n\t\t'</div>',\n\t\t'<div class=\"mt10\">',\n\t\t\t'<input id=\"mupload\" type=\"file\" multiple class=\"h30 w100p cp\" style=\"position:absolute;z-index:1;opacity:0;\">',\n\t\t\t'<div class=\"h30 pseudolink tdn\">Select files to attach...</div>',\n\t\t'</div>',\n\t\t'<div class=\"mt5 pt10 btd\">',\n\t\t\t'<button id=\"btn-attadd\" class=\"green mr2\">Attach files</button>',\n\t\t\t'<button id=\"btn-attcancel\">Cancel</button>',\n\t\t'</div>'\n\t].join(''),\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504808550672","id": ".Ed.jsontree.$file","type": "js","data": "({\n\tid:\"Sys.JSON.File\",\n\tdata:{},\n\tList:[],\n\t//Txt:{object:\t[\"Files {\",\"}\"],array:\t[\"Array [\",\"]\"]},\n\tinit: function _init_file($o, form){\n\t\t\n\t\t// Special replacement for ._attachments member (a file)\n\t\t\n\t\tvar that = this, \n\t\t\t\td = form.data;\n\t\t$o.html(that.HTML);\n\t\t\n\t\t//if (d.state > 1) that.List = that.MakeList(d);\n\t\t\n\t\t$o.find(\".ilist:eq(0)\").on(\"change.my\", function(){\n\t\t\tthat.RT('Rejoin')(d, that.List);\n\t\t}.debounce(300));\n\t\t\n\t\t$o.on(\"click.my\", \".ilist:eq(0) .btn-del\", function(evt){\n\t\t\tevt.stopPropagation();\n\t\t\tvar $f = $(this).parents(\".my-form\").eq(0);\t\t\n\t\t\tvar p = $f.parent().data(\"my\").data,\n\t\t\t\t\tt = $.type(p.value),\n\t\t\t\t\tkey = $f.my(\"data\").key;\n\t\t\t\n\t\t\tif (t==\"object\") delete p.value[key];\n\t\t\telse if (t==\"array\") p.value.removeAt(key);\n\t\t\t\n\t\t\tthat.RT('Lib').relist($o, that, form);\n\t\t});\n\t\t\n\t},\n\tShowItems:null,\n\tui:{\n\t\t\n\t\t\".ikey\":{\n\t\t\tdelay:10,\n\t\t\tbind:function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tvar key = ( \n\t\t\t\t\t(!/^(|\\s+)$/.test(d.key))\n\t\t\t\t\t?d.key.truncate(50,/\\//.test(d.key)?'left':'middle','…')\n\t\t\t\t\t:'\"'+d.key+'\"' \n\t\t\t\t).replace(/\\//g,'\\u2009/\\u2009').escapeHTML(); \n\t\t\t\t\n\t\t\t\tif (d.value.revpos==null) return key;\n\t\t\t\t\n\t\t\t\tvar rd = that.RT('data'),\n\t\t\t\t\t\tlink = [rd.baseurl.replace(/\\/$/,''), rd.dbname, rd.doc._id, d.key ].join('/').escapeHTML();\n\t\t\t\t\n\t\t\t\treturn '<a href=\"{1}\" target=\"_blank\" class=\"tdn\">{2}</a>'.assign(link, key);\n\t\t\t},\n\t\t\twatch:[\".idesc\"]\n\t\t},\n\t\t\n\t\t\".idesc\":{\n\t\t\tdelay:10,\n\t\t\tbind: function(d,v,$o) {\n\n\t\t\t\tvar that = this,\n\t\t\t\t\t\trd = that.RT('data'),\n\t\t\t\t\t\tlink = [rd.baseurl.replace(/\\/$/,''), rd.dbname, rd.doc._id, d.key].join('/').escapeHTML(),\n\t\t\t\t\t\tv = d.value,\n\t\t\t\t\t\tsize = (\n\t\t\t\t\t\t\t(v.data?v.data.length/4*3|0:0) \n\t\t\t\t\t\t\t|| +v.length \n\t\t\t\t\t\t\t|| +v.size \n\t\t\t\t\t\t\t|| 0\n\t\t\t\t\t\t).bytes(1).replace(/B$/,'b').replace(\n\t\t\t\t\t\t\t/^([0-9\\.]+)([a-z]+)$/i,\n\t\t\t\t\t\t\t'$1<div class=\"w35 dib tal pl2\">$2</div>'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmime = (v.content_type || 'application/octet-stream').escapeHTML(),\n\t\t\t\t\t\tfname = d.key.split('/').last().escapeHTML(),\n\t\t\t\t\t\trevpos = (!v.digest || v.revpos==null)?'<span class=\"fi-burst-new green1\"></span> New':('r:  '+v.revpos),\n\t\t\t\t\t\th = [\n\t\t\t\t\t\t\t'<div class=\"dib vat w100 pr10 tar o90\">{1}</div>'.assign(size),\n\t\t\t\t\t\t\t'<div class=\"dib vat w200 pr10 nw ell o60\">{1}</div>'.assign(mime),\n\t\t\t\t\t\t\t'<div class=\"dib vat o60 fs95\">{1}</div>'.assign(revpos)\n\t\t\t\t\t\t].join('');\n\t\t\t\t\n\t\t\t\treturn h;\n\t\t\t},\n\t\t\tevents:\"click.my\"\n\t\t},\n\t\t'#btn-download':{\n\t\t\t//init: function(){},\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (d.value.revpos == null) return;\n\t\t\t\tvar rd = this.RT('data');\n\t\t\t\t$o.attr('download', d.key.split('/').last());\n\t\t\t\t$o.attr('href', [rd.baseurl.replace(/\\/$/,''), rd.dbname, rd.doc._id, d.key].join('/'));\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){return d.value.revpos == null}\n\t\t\t}\n\t\t}\n\t},\n\tstyle:{\n\t\t' .ikey':'cursor:normal;',\n\t\t' .iact .button':'padding: 0.15em 0 0.05em 0;'\n\t},\n\tHTML:([\n\t\t'<div class=\"inav\">',\n\t\t\t'<div class=\"ikey xgray fs100\"></div>',\n\t\t\t'<div class=\"idesc\">–</div>',\n\t\t'</div>',\n\t\t'<div class=\"iact buttons\">',\n    \t'<button class=\"btn-takeout button\" title=\"View as JSON\"><span class=\"fi-shopping-bag\"></span></button>',\n\t\t\t'<a id=\"btn-download\" class=\"button fs90 vat\" title=\"Download file\" download=\"file.dat\"><span class=\"fi-download\"></span></a>',\n\t\t\t'<button class=\"btn-del button red vat\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n\t\t'</div>'\n\t].join(''))\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504385779049","id": ".$about","type": "js","data": "({\n\tid:'cw.Photon.$about',\n\thash:function(){return 'about';},\n\ttitle:function(){  return 'About this node'; },\n\tlang:{},\n\tJSON:false,\n\tBlob:false,\n\tUrl:false,\n\tdata:{\n\t\tphoton:{},\n\t\tservice:{\n\t\t\tcouchdb: \"No message\",\n\t\t\tversion: \"??\",\n\t\t\tvendor: {\n\t\t\t\tname: \"unknown\",\n\t\t\t\tversion: \"\",\n\t\t\t\tvariant: \"\"\n\t\t\t},\n\t\t\tfeatures: []\n\t\t},\n\t\tddoc:{},\n\t\tcfg:{\n\t\t\tmaxWidth:'1600',\n\t\t\tlistCols:[],\n\t\t\trootRepo:'',\n\t\t\tfont:'auto',\t\t\t\t\t\t// font\n\t\t\tfontWeight:'300',\t\t\t\t// font weight\n\t\t\tfontCode:'auto',\n\t\t\ticon:'',\t\t\t\t\t\t\t\t//\n\t\t\tmaxTabs:15,\t\t\t\t\t\t\t// max tabs opened\n\t\t\tloopActiveTasks:5,\t\t\t// seconds, interval between task status update\n\t\t}\n\t},\n  \n  Link:'<a href=\"{1}\" target=\"_blank\" referrerpolicy=\"no-referrer\" class=\"tdn nw ml4\">{2}</a>',\n\t\n\tHTML:[\n\t\t'<div class=\"w850 xgray\" style=\"margin:60px auto 30px auto;\">',\n\t\t'<div class=\"w450 dib vat\">',\n\t\t\t{row:\"450px\", label:\"120px\", rowCss:'my-row pb2', labelCss:'my-label fs90'},\n\t\t\n\t\t\t'<div id=\"atitle\">',\n\t\t\t\t'<span class=\"dib fs150 lh160 pr20\" style=\"min-width:120px;\">',\n\t\t\t\t\t'CouchDB <span id=\"aver\"></span>',\n\t\t\t\t'</span>',\n\t\t\t\t//'<span id=\"btn-logs\" class=\"hide\"><a href=\"#_log\" class=\"tdn\">{BTN_LOGS}</a></span>',\n\t\t\t'</div>',\n\t\t\t['{L_URL}','spn#anode'],\n\t\t\t['{L_VENDOR}','spn#avendor'],\n\t\t\t['{L_COUCH}','spn#awelcome'],\n\t\t\t['{L_FEAT}','spn#afeatures'],\n\t\t\n\t\t\t'<div id=\"atitle\" class=\"mt20\">',\n\t\t\t\t'<span class=\"dib fs150 lh160 pr6 mb2\" style=\"min-width:120px;\">',\n\t\t\t\t\t'Photon\\u00a0<span id=\"apho\"></span>',\n\t\t\t\t'</span>',\n\t\t\t\t'<span id=\"aphobuild\"></span>',\n\t\t\t'</div>',\n    \t{rowCss:'my-row pb6'},\n\t\t\t['{L_PHOADD}','spn#aphoadd'],\n\t\t\t['{L_PHOLIBS}','spn#apholibs.dib.vat.ml-4'],\n    \t['{L_PHOFONTS}','spn#aphofonts.dib.vat.ml-4'],\n\t\t\n\t\t\t{rowCss:'my-row mt8'},\n    \t'<div id=\"hidecouchapp\" class=\"hide\">',\n        [' ', '<span class=\"blue o50 fi-download fs95 mr2 fs90\"></span> <a href=\"\" id=\"adl\" class=\"tdn\" download=\"photon.json\"></a>'],\n    \t\t{rowCss:'my-row mt5'},\n        [' ', '<span class=\"blue o50 fi-cloud fs90 mr1\"></span> <span id=\"aupd\" class=\"pseudolink tdn\">{L_CHECK_UPDATES}</span>'],\n    \t\t[' ', '<span class=\"blue o60 fi-social-github mr2\"></span> ',\n         '<a href=\"https://github.com/ermouth/couch-photon\" referrerpolicy=\"no-referrer\" target=\"_blank\" class=\"tdn\">{L_GITHUB}</a>'],\n    \t'</div>',\n    \t{rowCss:'my-row mt20'},\n\t\t\t[' ', '<span class=\"gray fs90\">(c) 2018 ermouth. Photon is MIT licensed.</span>'],\n\t\t\n\t\t'</div>',\n\t\t\n\t\t'<div class=\"w350 dib vat ml50\">',\n\t\t\t{row:\"350px\", label:\"130px\", rowCss:'my-row pb10', labelCss:'my-label fs90'},\n\t\t\t'<div id=\"atitle\" class=\"fs150 lh160 pb6\">{S_TITLE}</div>',\n\t\t\t['{S_REPO}','inp#srepo.w100p'],\n\t\t\t['{S_FCFAMILY}','inp#scfont.w100p.fs110'],\n\t\t\t['{S_FFAMILY}','inp#sfont.w100p.fs110'],\n\t\t\t['{S_FWEIGHT}','div#sfweight.dib.vam.w100p'],\n\t\t\t['{S_WIDTH}','num#swidth.w65', {min:'1200', max:'1900',step:'10'}, '<span> px</span>'],\n\t\t\t['{S_COLS}','div#scols.dib.vam.w100p'],\n\t\t\t['{S_POLL}','num#spoll.w65', {min:'1', max:'3600',step:'1'}, '<span> s</span>'],\n\t\t\n\t\t\t{labelCss:'my-label fs90 pt8'},\n\t\t\t[\n\t\t\t\t'{S_ICON}',\n\t\t\t\t'<img style=\"width:64px;height:64px;\" class=\"dib vat br2\" id=\"sicon\">', \n\t\t\t\t'<div class=\"dib vat pt3 pl10\">',\n\t\t\t\t'<span class=\"pseudolink tdn\" id=\"btn-seticon\">{BTN_ICON}</span> <br>',\n\t\t\t\t'<span class=\"pseudolink tdn hide\" id=\"btn-reseticon\">{BTN_ICON_RESET}</span>'\n\t\t\t],\n\t\t\t'<div id=\"sproxy\" class=\"hide\"></div>',\n\t\t\t//[' ', 'but#btn-apply.mt10.w100.tac'],\n\t\t'</div>'\n\t],\n\t\n\tinit: function($o){\n\t\tvar that = this,\n\t\t\t\tpi = $.Deferred();\n\t\t\n\t\tthat.Url = that.Pho().DownloadURL;\n\t\t\n\t\t$.extend(true, that.data.cfg, that.Pho('Cfg'));\n\t\t\n\t\tthat.Req({url:[], contentType:'application/json', dataType:'json'})\n\t\t.then(function(res){\n\t\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n\t\t\t$.extend(true, that.data.service, res);\n\t\t})\n\t\t.always(function(){\n\t\t\tpi.resolve();\n\t\t\tthat.readPhoton();\n\t\t});\n\t\t\n\t\treturn pi.promise();\n\t},\n\t\n\treadPhoton:function(){\n\t\tvar that = this,\n\t\t\t\turl,\n\t\t\t\tddoc = window.DDOC;\n\t\tif (!that.Pho('_compiled') || ! ddoc) return '';\n\t\t\n\t\tif (!that.Url) {\n\t\t\tthat.Req({\n\t\t\t\turl:[ddoc._db || '_photon', ddoc._id, {attachments:true}],\n\t\t\t})\n\t\t\t.then(function(res0){\n\t\t\t\tthat.data.ddoc = res0;\n\t\t\t\tvar res = $.extend(\n\t\t\t\t\ttrue,\n\t\t\t\t\t{_id:'',name:'',version:that.Pho('Version')+'.'+that.Pho('build')},\n\t\t\t\t\tObject.reject(res0, ['_rev','_attachments'])\n\t\t\t\t);\n        res._attachments = {};\n        Object.keys(res0._attachments).forEach(function(fname){\n          var f = res0._attachments[fname];\n        \tres._attachments[fname] = {\n          \tcontent_type:\tf.content_type,\n            data:\t\t\t\t\tf.data\n          };\n        });\n\t\t\t\t\n\t\t\t\tthat.JSON = res;\n\t\t\t\tvar blob = cw.lib.base642blob(\n\t\t\t\t\tcw.lib.base64(JSON.stringify(res, null, '  ')),\n\t\t\t\t\tfunction (blob){\n\t\t\t\t\t\tthat.Blob = blob;\n\t\t\t\t\t\tthat.Url = URL.createObjectURL(blob);\n\t\t\t\t\t\tthat.Pho().DownloadURL = that.Url;\n\t\t\t\t\t\tthat.my.check('#adl');\n\t\t\t\t\t},\n\t\t\t\t\t'application/json'\n\t\t\t\t);\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\tthat.Url='';\n\t\t\t\tthat.my.check('#adl');\n\t\t\t});\n\t\t}\n\t},\n\tui:{ /* See tab */ },\n\tstyle:{\n\t\t' code':'font-size:103%;'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1505368509790","id": ".$about.ui","type": "js","data": "({\n\t'#apho':function(){\n\t\tvar that = this;\n\t\treturn that.Pho('Version').replace(/[^0-9\\.]/g,'');\n\t},\n\n\t'#aphobuild':function(){\n\t\tvar that = this,\n\t\t\t\tbuild = that.Pho('build'),\n\t\t\t\tdt = Date.create(that.Pho('stamp') || Date.now()).format('{yyyy}-{MM}-{dd}');\n\t\tif (!build) return '';\n\t\treturn '<span class=\"gray\">Build '+build+', '+dt+'</span>';\n\t},\n\n\t'#aphoadd':function(){\n\t\tvar that = this,\n\t\t\t\tapps = (window.DDOC || {apps:{ed:{id:'cw.Sys.JSON'}}}).apps,\n\t\t\t\th = [];\n\t\tObject.keys(apps).forEach(function(k){\n\t\t\tvar app = apps[k];\n\t\t\tif (!app.id || app.id == 'cw.Photon') return;\n\t\t\th.push([\n\t\t\t\t(app.name || app.id)+'\\u00a0',\n\t\t\t\tapp.Version || app.version || null,\n\t\t\t\tapp.build?'.'+app.build:null\n\t\t\t].compact().join(''));\n\t\t})\n\t\treturn h.join('')\n\t},\n\n\t'#apholibs':function(){\n\t\tvar that = this,\n\t\t\t\tlibs = that.Pho('LibsUsed');\n\n\t\treturn Object.keys(libs).map(function(k){\n\t\t\tif (!libs[k]) return '<span class=\"tdn nw ml4\">'+k+'</span>';\n\t\t\treturn that.Link.assign(libs[k], k);\n\t\t}).join(', ');\n\t},\n  \n  '#aphofonts':function(){\n\t\tvar that = this,\n\t\t\t\tlibs = that.Pho('FontsUsed');\n\n\t\treturn Object.keys(libs).map(function(k){\n\t\t\tif (!libs[k]) return '<span class=\"tdn nw ml4\">'+k+'</span>';\n\t\t\treturn that.Link.assign(libs[k], k);\n\t\t}).join(', ');\n\t},\n\n\t'#aver':'service.version',\n\t\n\t'#avendor':function(d){\n\t\tvar s = d.service.vendor;\n\t\treturn (s.name+' '+s.version +(s.variant?' ('+s.variant+')':'')).escapeHTML();\n\t},\n\t\n\t'#anode':function(d){\n\t\tvar base = this.Pho('Base');\n\t\treturn '<a href=\"{1}\" target=\"_blank\" class=\"tdn\">{2} {3}</a>'.assign(\n\t\t\tbase, \n\t\t\t'<span class=\"fs90 '+(/^https:/.test(base)? 'fi-lock blue2':'fi-unlock red2')+'\"></span>',\n\t\t\tbase.replace(/^http[s]?:\\/\\/|\\//g,'').escapeHTML()\n\t\t);\n\t},\n\n\t'#awelcome':function(d){return d.service.couchdb.escapeHTML()},\n\t\n\t'#afeatures':function(d){\n\t\tvar f = d.service.features;\n\t\tif (!Object.isArray(f) || !f.length) return '—';\n\t\treturn d.service.features.join (', ').escapeHTML()\n\t},\n  \n  '#hidecouchapp':{\n    css:{\n\t\t\thide:function(){\n        return !this.Pho('_compiled') || (cw.me('roles')||[]).indexOf('_admin')==-1;\n      }\n\t\t}\n  },\n\t\n\t'#aupd':{\n\t\tbind:function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\trepo = that.Pho('Cfg').rootRepo;\n\t\t\t$.ajax({url:repo+'version.json',dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\tfunction _n(s) {\n\t\t\t\t\tvar a = s.split('.'); return a[0]*1e12 + a[1]*1e6 + (isNaN(a[2])?999999:+a[2]);\n\t\t\t\t}\n\t\t\t\tvar v0 = that.Pho('Version')+'.'+that.Pho('build'),\n\t\t\t\t\t\tcurr = _n(v0),\n\t\t\t\t\t\tv1 = res.version || '0.0.0',\n\t\t\t\t\t\tremote = _n(v1);\n\n\t\t\t\tif (curr >= remote) return cw.lib.note(that.lang.MSG_UPD_NONEED);\n\n\t\t\t\treturn $.ajax({url:repo+'photon.json', dataType:'json'})\n\t\t\t\t.then(function(res){\n\t\t\t\t\t$.my.modal({\n\t\t\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttext:that.lang.TXT_UPD.assign(v0, v1),\n\t\t\t\t\t\t\tyes:that.lang.BTN_UPDATE,\n\t\t\t\t\t\t\tno:that.lang.BTN_CANCEL,\n\t\t\t\t\t\t\tcancel:''\n\t\t\t\t\t\t},\n\t\t\t\t\t\twidth:300,\n\t\t\t\t\t\tcss:'p20 xgray lh170 pb25'\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(dlg){\n\t\t\t\t\t\tif (dlg.cmd != 'yes' ||  !window.DDOC) return;\n\t\t\t\t\t\tres._rev = that.data.ddoc._rev || window.DDOC._rev;\n\t\t\t\t\t\tthat.Req({\n\t\t\t\t\t\t\turl:\t\t\t\t[DDOC._db || '_photon', res._id],\n\t\t\t\t\t\t\tmethod:\t\t\t'PUT',\n\t\t\t\t\t\t\tdata:\t\t\t\tJSON.stringify(res),\n              contentType:'application/json',\n\t\t\t\t\t\t\theaders:\t\t{Accept:'application/json'},\n\t\t\t\t\t\t\tdataType:\t\t'text'\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\tcw.lib.note(that.lang.MSG_UPDATE_OK, '', 6000);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\t\t\tcw.lib.note(that.lang.ERR_UPDATE.assign(code, err), 'error');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\tcw.lib.note(that.lang.ERR_UPDATE_CHECK, 'error');\n\t\t\t});\n\t\t},\n\t\tevents:'click.my'\n\t},\n\t\n  '#adl':{\n    bind:function(d,v,$o){\n      var that = this,\n          url = that.Url,\n          ddoc = window.DDOC;\n      if (!that.Pho('_compiled') || !ddoc || url==='') return '';\n      if (url===false) return '<span class=\"gray\">'+that.lang.L_DLPREP+'</span>';\n      $o.attr('href', url);\n      $o.attr('download','photon-'+that.Pho('Version').replace(/[^0-9\\.]/g,'')+'.'+that.Pho('build')+'.json');\n      return that.lang.L_DL;\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1505816910360","id": ".$about.ui","type": "js","data": "({\n\t'#swidth':'cfg.maxWidth',\n\t\n\t'#sfont':{\n\t\tinit: function($o){\n\t\t\tvar that = this;\n\t\t\t$o.select2({\n\t\t\t\tdata:[\n\t\t\t\t\t{id:'auto', text:'Auto'},\n\t\t\t\t\t{id:\"'-apple-system','BlinkMacSystemFont'\", text:'Apple system font'},\n\t\t\t\t\t{id:\"'Segoe UI'\", text:'Segoe UI'},\n\t\t\t\t\t{id:\"'Helvetica Neue',Helvetica\", text:'Helvetica'},\n\t\t\t\t\t{id:\"Cousine\", text:'Cousine (monospaced)'},\n\t\t\t\t\t{id:\"'PT Mono'\", text:'PT Mono (monospaced)'}\n\t\t\t\t],\n\t\t\t\tminimumResultsForSearch:12\n\t\t\t})\n\t\t},\n\t\tbind:'cfg.font'\n\t},\n\t\n\t'#sfweight':{\n\t\tinit: function($o){\n\t\t\t$o.tags({\n\t\t\t\ttags:[['300','400']],\n\t\t\t\tempty:{'200':'200'}\n\t\t\t})\n\t\t},\n\t\tbind:function(d,v){\n\t\t\tif (v==null) return [d.cfg.fontWeight+''];\n\t\t\td.cfg.fontWeight = v+'';\n\t\t\treturn v;\n\t\t}\n\t},\n\t\n\t'#scfont':{\n\t\tinit: function($o){\n\t\t\tvar that = this;\n\t\t\t$o.select2({\n\t\t\t\tdata:[\n\t\t\t\t\t{id:'auto', text:'Auto'},\n\t\t\t\t\t{id:\"Cousine\", text:'Cousine (monospaced)'},\n\t\t\t\t\t{id:\"'PT Mono'\", text:'PT Mono (monospaced)'}\n\t\t\t\t],\n\t\t\t\tminimumResultsForSearch:12\n\t\t\t})\n\t\t},\n\t\tbind:'cfg.fontCode'\n\t},\n\t\n\t'#scols':{\n\t\tinit: function($o){$o.tags({tags:this.lang.TAG_COLS})},\n\t\tbind:'cfg.listCols'\n\t},\n\t\n\t'#spoll':{\n\t\tbind:function(d,v){\n\t\t\tif (v!=null) {\n\t\t\t\td.cfg.loopActiveTasks = isNaN(v)?5:(+v | 0).clamp(1,3600);\n\t\t\t}\n\t\t\treturn d.cfg.loopActiveTasks+'';\n\t\t}\n\t},\n\t\n\t'#srepo':{\n\t\tbind:function(d,v){\n\t\t\tif (v!=null) {\n\t\t\t\td.cfg.rootRepo = v.replace(/\\s/g,'');\n\t\t\t}\n\t\t\treturn d.cfg.rootRepo;\n\t\t}\n\t},\n\t\n\t'#sicon':{\n\t\tbind: function(d,v){\n\t\t\tif (!d.cfg.icon) return this.Pho('files')['favicon.png'].url;\n\t\t\treturn d.cfg.icon;\n\t\t},\n\t\twatch:['#btn-reseticon']\n\t},\n\t\n\t'#btn-seticon':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tthat.my.modal('#btn-seticon', {\n\t\t\t\tmanifest:that.Cropper,\n\t\t\t\tglobal:true,\n\t\t\t\tcss:'p25',\n\t\t\t\tscreen:true\n\t\t\t})\n\t\t\t.then(function(res){\n\t\t\t\td.cfg.icon = res.data;\n\t\t\t\tthat.my.check('#sicon');\n\t\t\t})\n\t\t},\n\t\tevents:'click.my'\n\t},\n\t\n\t'#btn-reseticon':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\td.cfg.icon = '';\n\t\t},\n\t\tevents:'click.my',\n\t\twatch:'#sicon',\n\t\tcss:{\n\t\t\t'self:hide':function(d){return !d.cfg.icon}\n\t\t}\n\t},\n\t\n\t'#sproxy':{\n\t\tdelay:300,\n\t\tbind:function(d,v){\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this;\n\t\t\t$.extend(true, that.Pho('Cfg'), d.cfg);\n\t\t\tif (that.Pho('_compiled')) {\n\t\t\t\tthat.Pho('Ls')('Cfg', d.cfg);\n\t\t\t\t$('link[rel=\"icon\"]').attr(\"href\", d.cfg.icon || that.Pho('files')['favicon.png'].url);\n\t\t\t\t$(window).trigger('resize');\n\t\t\t}\n\t\t},\n\t\twatch:['#sfont','#srepo','#scfont','#sfweight','#swidth','#spoll','#sicon','#btn-reseticon','#scols']\n\t},\n\t\n\t/*'#btn-apply':{\n\t\tbind: function(d,v){\n\t\t\tvar that = this;\n\t\t\tif (v!=null) {$.extend(true, that.Pho('Cfg'), d.cfg);$(window).trigger('resize');}\n\t\t\treturn that.lang.BTN_APPLY\n\t\t}\n\t},*/\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1506011556080","id": ".$about.Cropper","type": "js","data": "({\n\tparams:{\n\t\twidth:685\n\t},\n\tdata:{\n\t\tfilename:\"\",\n\t\tdata:\"\",\n\t\tcropped:false,\n\t\tsize:64\n\t},\n\tinit:function ($o, form) {\n\t\tvar html = $.my.formgen([\n\t\t'<div class=\"fl mr20 tac vat bg-lgray\" style=\"width:600px;height:450px;' \n\t\t\t\t+'overflow:hidden;position:relative;line-height:450px;\" id=\"crop-frame\">',\n  \t\t\t'<img id=\"source\" class=\"vam\" style=\"max-width:600px; max-height:450px; background:white\" src=\"\" />',\n  \t\t\t'<div class=\"w600  dib\" style=\"height:450px;position:absolute;top:0;left:0\">',\n  \t\t\t\t'<span class=\"dib vam fs110 button\">',\n  \t\t\t\t\t'<span class=\"fi-photo\"><span class=\"fs110\"> &nbsp;Select Image</span></span>',\n  \t\t\t\t'</span>',\n\t    \t\t'<input type=\"file\" id=\"file\" class=\"w600 dib\" accept=\"image/jpeg,image/png\" '\n\t    \t\t\t+'style=\"height:450px;cursor:pointer;opacity:0; position:absolute;top:0;left:0\">',\n\t    \t'</div>',\n  \t\t'</div>',\n\t\t\t'<div class=\"w65 dib vat\" id=\"xpreview\">',\n\t\t\t'<img id=\"ipreview\" style=\"width:64px;height:64px;border:none;\" class=\"bg-gray7\">',\n\t\t\t\n  \t\t\t\t{row:\"65px\",rowCss:\"mt5 fs90 tac\"},\n      \t\t[\"\",\"btn#btn-apply.w65.green\",{val:\"Set\"}],\n  \t\t'</div>',\n  \t\t'<div class=\"w65 dib vat\" id=\"xwarn\">',\n  \t\t\t\n  \t\t'</div>',\n  \t\t'<div class=\"hide\">',\n\t\t\t\t'<canvas id=\"x2\" width='+form.data.size*2+' height='+form.data.size*2+'></canvas>',\n\t\t\t\t'<canvas id=\"preview\" class=\"bg-lgray\" style=\"width:64px;height:64px\" width='\n\t\t\t\t\t\t+form.data.size+' height='+form.data.size+' style=\"overflow:hidden;\"></canvas>',\n\t\t\t'</div>'\n\t\t]);\n\t\t$o.html(html);\n\t},\n\tstyle:{\n\t\t\" .jcrop-holder\":\"display:inline-block;vertical-align:middle\"\n\t},\n\tui:{\n\t\t\"#file\":{\n\t\t\tbind:function (d, v, $o){\n\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tf,\n\t\t\t\t\t\t$r = $o.my().root,\n\t\t\t\t\t\t$c = $r.find(\"#preview\"),\n\t\t\t\t\t\t$img = $r.find(\"#source\"),\n\t\t\t\t\t\t$c2 = $r.find(\"#x2\"),\n\t\t\t\t\t\tn={k:1}, img=\"\";\n\n\n\t\t\t\tif (v!=null && v) {\n\t\t\t\t\tf = $o[0].files[0];\n\t\t\t\t\tif (f) (function(){\n\t\t\t\t\t\td.filename = f.name;\n\n\t\t\t\t\t\tvar fr = new FileReader(), ri, sb64 = [];\n\t\t\t\t\t\tfr.onload=function(e){\n\t\t\t\t\t\t\tri = new Uint8Array(e.target.result);\n\t\t\t\t\t\t\tfor (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));\n\t\t\t\t\t\t\timg = window.btoa(sb64.join(\"\"));\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tfr.onloadend = function (){\n\t\t\t\t\t\t\t$img.load(function(){\n\t\t\t\t\t\t\t\tn.k = $img[0].naturalWidth/$img.width();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$img.removeClass(\"hide\")\n\t\t\t\t\t\t\t.attr(\"src\",\"data:image/jpeg;base64,\"+img);\n\n\t\t\t\t\t\t\tn.k=$img[0].naturalWidth/$img.width();\t\n\t\t\t\t\t\t\t$img.Jcrop({\n\t\t\t\t\t\t\t\tonChange: preview,\n\t\t\t\t\t\t\t\tonSelect: preview.debounce(20),\n\t\t\t\t\t\t\t\taspectRatio: 1,\n\t\t\t\t\t\t\t\tminSize:[64,64],\n\t\t\t\t\t\t\t\tallowMove:true\n\t\t\t\t\t\t\t}, function (){\n\t\t\t\t\t\t\t\tthis.animateTo([100,100,300,300]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\timg=\"\";\n\t\t\t\t\t\t\t$o.parent().addClass(\"hide\");\n\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfr.readAsArrayBuffer(f);\t\n\t\t\t\t\t})();\n\t\t\t\t}\n\n\t\t\t\tfunction preview (c){\n\t\t\t\t\tif(parseInt(c.w) > 0) {\n\t\t\t\t\t\t// Show image preview\n\t\t\t\t\t\tvar img = $img[0], cs, ctx, cs2, ctx2, \n\t\t\t\t\t\t\t\tk = n.k,\n\t\t\t\t\t\t\t\tw = c.w*k | 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tcs = $c[0];\n\t\t\t\t\t\tctx = cs.getContext(\"2d\");\n\t\t\t\t\t\tctx.globalCompositeOperation = 'copy';\n\t\t\t\t\t\tctx.fillStyle='transparent';\n\t\t\t\t\t\tctx.fillRect(0,0, d.size, d.size);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (w>d.size*2) {\n\t\t\t\t\t\t\t// double downsample to remove\n\t\t\t\t\t\t\t// bilinear-scaler artifacts\n\t\t\t\t\t\t\tcs2 = $c2[0];\n\t\t\t\t\t\t\tctx2 = cs2.getContext(\"2d\");\n\t\t\t\t\t\t\tctx2.globalCompositeOperation = 'copy';\n\t\t\t\t\t\t\tctx2.fillStyle='transparent';\n\t\t\t\t\t\t\tctx2.fillRect(0, 0, d.size*2, d.size*2);\n\t\t\t\t\t\t\tctx2.drawImage(img, c.x*k  |0, c.y*k |0, w, w, 0, 0, d.size*2, d.size*2);\n\t\t\t\t\t\t\tctx.drawImage(cs2, 0, 0, d.size*2, d.size*2, 0, 0, d.size, d.size);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tctx.drawImage(img, c.x*k  |0, c.y*k  |0, w, w, 0, 0, d.size, d.size);\n\t\t\t\t\t\t}\n\t\t\t\t\t\td.data = cw.lib.image($c).map(function(x){return ((x*255|0)>>2<<2)/255}).sharpen(1.6).brightness(1.1).png();\n\t\t\t\t\t\tthat.my.find('#ipreview').attr('src',d.data);\n\t\t\t\t\t\td.cropped=true;\n\t\t\t\t\t\tthat.my.check('#btn-apply');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'#btn-apply':{\n\t\t\tdelay:50,\n\t\t\tbind:function (d,v) {\n\t\t\t\tif (v!=null && d.cropped) this.my.commit();\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){return !d.cropped;}\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1503710670805","id": ".$error","type": "js","data": "({\n\t// error stub\n\tid:'cw.Photon.$error',\n\tlang:{},\n\tdata:{error:'',path:[]},\n\thash:function(){\n\t\treturn 'error';\n\t},\n\ttitle:function(){ return 'Error switching #'+this.data.path.join('/'); },\n\tinit:[\n\t\t'<div class=\"p100 tac\">',\n\t\t\t'<div id=\"e-msg\" class=\"red\"></div>',\n\t\t\t'<div class=\" w50p mt25 tal dib vat\">',\n\t\t\t\t'<button id=\"btn-reload\" class=\"w120 pr15 fs95\"><span class=\"fi-refresh o60\"></span> Try again </button>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t],\n\tui:{\n\t\t'#e-msg':function(d,v){\n\t\t\tvar m;\n\t\t\ttry { m = !Object.isString(d.error)?JSON.stringify(d.error):d.error+''; } catch(e){}\n\t\t\tif (!m) m = (d.error+'') || 'Undefined error';\n\t\t\treturn this.lang.TXT_ERR.assign( '#'+d.path.join('/').escapeHTML(), m );\n\t\t},\n\t\t\n\t\t'#btn-reload':{\n\t\t\tbind: function(d,v){\n\t\t\t\tif (v == null) return;\n\t\t\t\t$.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t},\n\t\t\tlisten:{\n\t\t\t\tuserCtx:function(d,v){\n\t\t\t\t\tif (!Object.isObject(v) || !v.name) return;\n\t\t\t\t\tif (!/\\s40[31]\\s/.test(d.error)) return;\n\t\t\t\t\t$.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1503611645753","id": ".$doc","type": "js","data": "({\n\tid:'cw.Photon.$doc',\n\tlang:{},\n\tdata:{\n\t\tisNew:false,\n\t\tpath:[],\n\t\trev:'',\n\t\trevlast:'',\n\t\trevstart:'',\n\t\tsearch:'',\n\t\tdoc:{\n\t\t\t_id:''\n\t\t},\n\t\tconflicts:[],\n\t\trevs:[],\n    atts:false\n\t},\n\t// returns tab CRC\n\thash:function(){ return cw.lib.crc2(this.data.doc); },\n\t\n\t// returns tab title\n\ttitle:function(){ \n\t\tvar that = this,\n\t\t\t\td = that.data,\n\t\t\t\tp = d.path,\n\t\t\t\tid = d.doc._id;\n\t\treturn [\n\t\t\tp[0],\n\t\t\t'\\u2009/\\u2009',\n\t\t\tid.to(8)=='_design/'?'_d'+id.from(7):p[0]=='_users'?id.from(17):id,\n\t\t\td.rev?'\\u2009@\\u2009'+d.rev:''\n\t\t].join(''); \n\t},\n\t\n\t// init app\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\tif (d.path.length > (d.path[1]=='_design'?3:2)) {\n\t\t\td.rev = d.path.last().replace(/^\\D+/,'');\n\t\t}\n\t\td.revstart = d.rev;\n\t\t\n\t\treturn that.GetDoc()\n\t\t.then(function(){\n\t\t\t$o.html(that.HTML.assign(that.lang));\n\t\t});\n\t},\n\tui:{ /* See tabs */ },\n\t\n\tdie: function($o){\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#jseditor').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t},\n\t\n\tHTML:'', // See tab\n\t\n\tstyle:{\n\t\t//'':'max-width:1400px;',\n    ' #jseditor':{\n      '>div':'min-height:99.9%;',\n\t\t\t'>.my-form>section>#editor>#doc>.iact.buttons':'padding-right:3px;',\n      ' .iact .button':'  height: 1.7em;line-height: 1.1em;'\n    },\n\t\t\n\t\t' .my-modal-form':{\n\t\t\t\" .CodeMirror .CodeMirror-lines\": \"line-height:17px;\",\n\t\t\t\" .CodeMirror-scroll\": \"min-height:150px;max-height:calc(18 * 17px + 6px);\",\n\t\t\t\" .CodeMirror-linenumbers\": \"transition: background-color 0.3s;\",\n\t\t\t\".ed-error .CodeMirror-linenumbers\": \"background-color:rgba(255, 200, 200, 0.75);\",\n\t\t\t\" .CodeMirror .cm-property\": \"color:#434e5d;\",\n\t\t\t\" .CodeMirror .cm-variable\": \"color:#33bfad;\",\n\t\t\t\" .CodeMirror .cm-keyword\": \"color:#90259e;\",\n\t\t\t\" .CodeMirror\": \"min-height:150px; height:auto;\",\n\t\t\t' .buttons button': 'margin-right: 2px;padding: 0.4em 0.7em 0.4em 0.7em;font-size: 90%;'\n\t\t},\n\t\t\n\t\t//' #app-title':'max-width:calc(88% - 570px);'\n    ' #app-title':'max-width:calc(100% - 630px);'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1504829185755","id": ".$doc.ExtEd","type": "js","data": "({\n  HTML:{\n\t\tItemRoot:[\n\t\t\t'<div class=\"inav\">',\n\t\t\t\t'<div class=\"ikey\"></div>',\n\t\t\t\t'<div class=\"idesc cp\">–</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"ivalue imulti hide\">',\n\t\t\t\t'<div class=\"ilist\"></div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"iact buttons\">',\n\t\t\t\t'<button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button>',\n\t\t\t\t'<button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button>',\n\t\t\t\t//'<button class=\"btn-copy button\" title=\"Stash node as clip\"><span class=\"fi-clipboard\"></span></button>',\n\t\t\t\t'<button class=\"btn-del button red hide\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n\t\t\t\t'<button id=\"btn-attach\" class=\"button\" title=\"Add attachment\" style=\"width:74px\">',\n\t\t\t\t\t'<span class=\"fi-paperclip\"></span><span class=\"fs90 dib vat\"> Attach…</span>',\n\t\t\t\t'</button>',\n\t\t\t'</div>'\n\t\t].join('')\n\t},\n\tui:{\n\t\t\"#doc\":{\n\t\t\tmanifest:function(e){\n\t\t\t\tif (!this.HTML.ItemRoot) return this.$multi;\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tMAtt = that.$files.Add;\n\t\t\t\treturn $.extend(true, {}, that.$multi, {\n\t\t\t\t\tHTML:that.HTML.ItemRoot,\n\t\t\t\t\tui:{\n\t\t\t\t\t\t'#btn-attach':{\n\t\t\t\t\t\t\tbind:function(d,v,$o){\n\t\t\t\t\t\t\t\tif (v==null) return;\n\t\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t\tif ($o.data('modal')) {\n\t\t\t\t\t\t\t\t\t$o.modal(true);\n\t\t\t\t\t\t\t\t\t_close();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t$o.parent().addClass('hover');\n\t\t\t\t\t\t\t\t\tthat.my.modal('#btn-attach',{\n\t\t\t\t\t\t\t\t\t\tmanifest:MAtt,\n\t\t\t\t\t\t\t\t\t\tdata:{},\n\t\t\t\t\t\t\t\t\t\twidth:500,\n\t\t\t\t\t\t\t\t\t\talign:'top:103%, right:0px;',\n\t\t\t\t\t\t\t\t\t\tnose:'top'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.then((function(res){\n\t\t\t\t\t\t\t\t\t\tif (!d.value._attachments) d.value._attachments = {};\n\t\t\t\t\t\t\t\t\t\tres.files.forEach(function(file){\n\t\t\t\t\t\t\t\t\t\t\td.value._attachments[file.name] = Object.select(file, ['content_type','data']);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (!that.RT('data').viewstate) that.RT('data').viewstate = {};\n\t\t\t\t\t\t\t\t\t\tthat.RT('data').viewstate['Root❀_attachments']=2;\n\t\t\t\t\t\t\t\t\t\tthat.List = that.MakeList(d);\n\t\t\t\t\t\t\t\t\t\tthat.my.redraw();\n\t\t\t\t\t\t\t\t\t}).debounce(20))\n\t\t\t\t\t\t\t\t\t.always(function(){\n\t\t\t\t\t\t\t\t\t\t_close();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// - - - - -\n\t\t\t\t\t\t\t\tfunction _close(){\n\t\t\t\t\t\t\t\t\t$o.parent().removeClass('hover');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1503719040425","id": ".$doc.ui","type": "js","data": "({\n\t'#app-title':{\n    delay:50,\n\t\tbind:function(d){\n\t\t\n\t\t\tvar db = '<a class=\"tdn\" href=\"#{1}\" title=\"{3}\">{2}</a>'.assign(\n\t\t\t\td.path[0], \n\t\t\t\td.path[0].truncate(15,'middle','…').escapeHTML(),\n\t\t\t\td.path[0].escapeHTML()\n\t\t\t);\n      \n      var id = (d.doc._id || (d.path[1]+(d.path[1]=='_design'?'/'+d.path[2]:'')));\n      \n      var doclink = '<a target=\"_blank\" class=\"tdn\" href=\"{1}\" title=\"{3}\">{2}</a>'.assign(\n        ['', d.path[0], id].join('/').escapeHTML(),\n\t\t\t\tid.escapeHTML(),\n        id.length>15?id.escapeHTML():''\n      );\n\n      return [\n        '<span class=\"fs150 lh130 xgray mt-1 o80\">',\n        \t'<span class=\"o80\">{2}</span>\\u2009/\\u2009<span class=\"\">{1}</span>',\n        '</span>'\n      ].join('')\n      .assign(doclink,db);\n\t\t},\n\t\twatch:['#app-rev', '#jseditor']\n\t},\n\t\n\t'#app-rev':{\n\t\tinit:function($o){ this.RevsList(); },\n\t\tbind:'rev',\n\t},\n\t\n\t\"#app-search\":{\n\t\tdelay:20,\n\t\tbind:function(d,v){\n\t\t\tif (v==null) return d.search;\n\t\t\td.search = v.length<3?'':v;\n\t\t\tif (this.Doc[0] && this.Doc[0].search != d.search) {\n\t\t\t\tthis.my.find('#json-search').val(d.search).trigger('check');\n\t\t\t}\n\t\t\treturn v;\n\t\t},\n\t\tcss: { \t\"my-search\": /^.{3,}$/ }\n\t},\n\t\n\t'#jseditor':{\n\t\tdelay:100,\n\t\tcheck:false,\n\t\tlist:'<div></div>',\n\t\tmerge:false,\n\t\tinit:function($o){\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t},\n\t\tid:function(e){return e.doc._id},\n\t\thash:function(e){return cw.lib.sdbm(e.doc)},\n\t\tmanifest: function(elt){\n\t\t\tvar that = this;\n\t\t\treturn $.extend(\n\t\t\t\ttrue, {}, \n\t\t\t\tthat.Pho('Ed').jsontree, \n\t\t\t\tthat.ExtEd,\n\t\t\t\t{\n          MRoot: function(){return that.my.root()},\n          GetAtts:that.GetAtts\n        }\n\t\t\t);\n\t\t},\n\t\tbind:'this.Doc'\n\t},\n\t\n\t'#btn-reload':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tthis.GetDoc(true);\n\t\t}\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504129024950","id": ".$doc.ui","type": "js","data": "({\n\t'#btn-doc-save':{\n\t\tbind: function(d,v){\n\t\t\tvar that = this;\n\t\t\tif (v==null) return;\n\t\t\t\n\t\t\t// check if we have editors open\n      var $e = that.my.find('#jseditor button#btn-change:visible'),\n\t\t\t\t\tel = $e.length;\n\t\t\tif (!el) { _doSave(); return; }\n\t\t\t\n\t\t\t// popup, apply/discard editions\n\t\t\tthat.my.modal('#btn-doc-save', {\n\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\tdata:{\n\t\t\t\t\ttext:that.lang.MSG_EDS,\n\t\t\t\t\tyes:that.lang.BTN_EDS_YES,\n\t\t\t\t\tno:that.lang.BTN_EDS_NO\n\t\t\t\t},\n\t\t\t\twidth:500,\n\t\t\t\tz:1995,\n\t\t\t\tscreen:true,\n\t\t\t\tglobal:true\n\t\t\t})\n\t\t\t.then(function(res){\n\t\t\t\tif (res.cmd != 'yes') { _doSave(); return; }\n\t\t\t\t// apply editions\n\t\t\t\t$e.each(function(i,e){\n\t\t\t\t\t$(e).trigger('click');\n\t\t\t\t\tif (i==el-1) _doSave(400);\n\t\t\t\t}.lazy(20));\n\t\t\t});\n\t\t\t\n\t\t\t// - - - - - - - -\n\t\t\t\n\t\t\tfunction _doSave(delay) {\n\t\t\t\t// mark busy\n\t\t\t\tthat.my.root().addClass('app-busy');\n\t\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:true});\n\t\t\t\t// save\n\t\t\t\tif (!delay) _saveAll();\n\t\t\t\telse _saveAll.debounce(delay)();\n\t\t\t}\n\t\t\t\n\t\t\tfunction _saveAll(){\n\t\t\t\t// save attempt\n\t\t\t\tthat.SaveAll()\n\t\t\t\t.always(function(){\n\t\t\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:false});\n\t\t\t\t\tthat.my.root().removeClass('app-busy');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t\n\t'#btn-doc-del':{\n\t\tdelay:20,\n\t\tbind: function(d,v){\n\t\t\tvar that = this;\n\t\t\tif (v==null) return;\n\t\t\t\n\t\t\t// mark busy\n\t\t\tthat.my.root().addClass('app-busy');\n\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:true});\n\t\t\t// save attempt\n\t\t\t\n\t\t\tthat.DelDoc()\n\t\t\t.always(function(){\n\t\t\t\t$.my.radio('appbusy',{id:d.tabid, busy:false});\n\t\t\t\tthat.my.root().removeClass('app-busy');\n\t\t\t});\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d,v){\n\t\t\t\tvar co = d.conflicts || [],\n\t\t\t\t\t\tislast = d.revs && d.revs[0] && d.revs[0] == d.doc._rev;\n\t\t\t\tif (co.length) {\n\t\t\t\t\t// cant del old revs\n\t\t\t\t\treturn  !islast && co.indexOf(d.doc._rev||'') == -1;\n\t\t\t\t}\n\t\t\t\treturn !d.doc._rev || !islast;\n\t\t\t}\n\t\t},\n\t\twatch:['#app-rev']\n\t},\n\t\n\t\t\n\t'#state-proxy':{\n\t\tdelay:50,\n\t\tbind: function(d,v){\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this;\n\t\t\t\n\t\t\t//console.log('before', d.path.slice(0), [d.rev, d.revlast, d.doc._rev])\n\t\t\t\n\t\t\tif (d.rev) {\n\t\t\t\tif (d.path.last() != d.doc._id) d.path[d.path.length-1] = '_'+d.rev;\n\t\t\t\telse d.path.push('_'+d.rev);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (d.path.last() != d.doc._id) d.path.length = (d.path.length-1).clamp(2,6);\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\tif (d.rev != d.revlast) {\n\t\t\t\t$.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\t\td.revlast2 = d.revlast;\n\t\t\t\td.revlast = d.rev;\n\t\t\t\tthat.GetDoc(true, true)\n\t\t\t\t.then(function(){\n\t\t\t\t\td.revlast2 = null;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\twatch:'#app-rev',\n\t\tlisten:{\n\t\t\tdbdeleted:function(d,v){\n\t\t\t\tif (v!=d.path[0]) return;\n\t\t\t\tvar that = this;\n\t\t\t\t(function(){\t\n\t\t\t\t\tthat.my.root().trigger('tabclose',{tabid:d.tabid, enforce:true});\n\t\t\t\t}).debounce(Number.random(10,50))();\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504122057329","id": ".$doc.SaveAll","type": "js","data": "(function _save_$doc (onlySave, silent){\n\t\n\t// Std fn to be called from tab manager and on save btn click.\n\t// -- onlySave == true  means we must not load doc after save (when tab is closed ie),\n\t// -- silent == true    means we do not popup success or fail\n\t\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tdoc = Object.clone(cw.lib.dry(d.doc), true),\n\t\t\tpi = $.Deferred(),\n\t\t\tl = that.lang;\n\n\t// try to save\n\tvar method = 'POST',\n\t\t\turl = [d.path[0]],\n\t\t\theaders  = {\n\t\t\t\t// Ensures immediate commit\n\t\t\t\t'X-Couch-Full-Commit':'true'\n\t\t\t};\n\tif (typeof doc._id == 'string') {\n\t\t// method should be put\n\t\tmethod = 'PUT';\n\t\turl.push(doc._id);\n\t}\n\telse delete doc._id;\n\t\n\tif (undefined == doc._id) delete doc._rev;\n\t\n\t// trying to save 1st time\n\t\n\t_saveDoc(doc)\n\t.fail(function(code, err, msg){\n\t\tif (code != 409) {\n\t\t\t// if not a conflict, reject with an error\n\t\t\tif (!silent) cw.lib.note(l.ERR_SAVE.assign(code+': '+es(msg.reason || err)), 'error'); \n\t\t\tpi.reject(code, err, msg);\n\t\t} \n\t\telse {\n\t\t\t\n\t\t\t//load doc\n\t\t\tthat.Req({method:'GET',url:[d.path[0], doc._id]})\n\t\t\t.then(function(xdoc){\n\t\t\t\t\n\t\t\t\t// show conflict modal\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\t\twidth:500,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\ttext: l.MSG_CONFLICT.assign(_trunc(doc._id, 40), _trunc(doc._rev, 25), _trunc(xdoc._rev, 25)),\n\t\t\t\t\t\tyes:\tl.BTN_CONFLICT_YES,\n\t\t\t\t\t\tno: \tl.BTN_CONFLICT_NO,\n\t\t\t\t\t\tcancel:''\n\t\t\t\t\t},\n\t\t\t\t\tcss:'xgray lh170 p20 pb25',\n\t\t\t\t\tesc:false,\n\t\t\t\t\tenter:false\n\t\t\t\t})\n\t\t\t\t.then(function(result){\n\t\t\t\t\tif (result.cmd == 'yes') {\n\t\t\t\t\t\td.doc._rev = xdoc._rev;\n\t\t\t\t\t\tthat.SaveAll(onlySave, silent)\n\t\t\t\t\t\t.then(function(res){\n\t\t\t\t\t\t\t_reloadDoc(true);\n\t\t\t\t\t\t\t//pi.resolve(res);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\t\t\tpi.reject(code, err, msg);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse _saveCancelled();\n\t\t\t\t})\n\t\t\t\t.fail(_saveCancelled);\n\t\t\t\t\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\t// have conflict, but failed loading doc\n\t\t\t\t// reject\n\t\t\t\tconsole.log(code,err,msg);\n\t\t\t\tif (!silent) cw.lib.note(l.MSG_CONFLICT_LOADFAIL);\n\t\t\t\tpi.reject(999, 'Cancelled by user', l.MSG_CONFLICT_LOADFAIL);\n\t\t\t})\n\t\t\t\n\t\t}\n\t});\n\n\treturn pi.promise();\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _saveDoc(doc){\n\t\treturn that.Req({\n\t\t\turl:\t\t\t\t\turl, \n\t\t\tmethod:\t\t\t\tmethod, \n\t\t\theaders:\t\t\theaders,\n      contentType:\t'application/json',\n\t\t\tdata:\t\t\t\t\tJSON.stringify(doc), \n\t\t\tdataType:\t\t\tmethod=='PUT'?'text':'json'\n\t\t})\n\t\t.then(function(res0){\n\t\t\tvar res = res0;\n\t\t\ttry {\n\t\t\t\tres = Object.isString(res0)?JSON.parse(res0):res0;\n\t\t\t}catch(e){}\n\t\t\t// we succeeded,\n\t\t\tif (onlySave) {\n\t\t\t\t_notifyDocSaved();\n\t\t\t\treturn pi.resolve ($.extend(doc,{_id:res.id, _rev:res.rev}));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// reload doc if not skipped\n\t\t\t\tif (d.doc._conflicts && d.doc._conflicts.indexOf(d.doc._rev)>-1 && d.rev) {\n\t\t\t\t\t_reloadDoc.debounce(20)(res.rev);\n\t\t\t\t}\n\t\t\t\telse _reloadDoc.debounce(20)(true);\n\t\t\t}\n\t\t});\n\t}\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _saveCancelled(){\n\t\tif (!silent) cw.lib.note(l.MSG_CONFLICT_CANCELLED);\n\t\tpi.reject(999, 'Cancelled by user', l.MSG_CONFLICT_CANCELLED);\n\t}\n\n\t// - - - - - - - - - - - - \n\t\n\tfunction es(s) {return (s+'').escapeHTML();}\n\tfunction _trunc(s, chars) {return es((s+'').truncate(chars || 15,'right','…'));}\n\t\n\t// - - - - - - - - - - - - \n\n\tfunction _notifyDocSaved(){\n\t\t$.my.radio('dbupdate', {db:d.path[0], cmd:'write', docs:[d.doc._id]});\n\t\t// check should we notify db list, for _replicator\n\t\tif (d.path[0] == that.Pho('ReplicatorDB') && d.doc.create_target) {\n\t\t\tif (/(localhost|127\\.0\\.0\\.1)/.test(d.doc.target+'') || (d.doc.target+'').indexOf('/')==-1) {\n\t\t\t\t(function(){\n\t\t\t\t\t$.my.radio('dblist', ['_replicator', (d.doc.target+'').split('/').last()].compact('true'));\n\t\t\t\t}).debounce(300)();\n\t\t\t}\n\t\t}\n    else {\n      // notify DB list\n    \t$.my.radio('dblist', [d.path[0]]);\n    }\n\t\tif (!silent) {\n\t\t\tcw.lib.note(\n\t\t\t\tl.MSG_SAVE.assign( _trunc(d.doc._id), _trunc(d.rev || d.doc._rev || '')) ,\n\t\t\t\t'ok'\n\t\t\t);\n\t\t}\n\t}\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _reloadDoc(reset){\n\t\tif (reset===true) {\n\t\t\t// reset to latest rev\n\t\t\td.path[1] = d.doc._id;\n\t\t\td.path.length = 2;\n\t\t\td.rev = '';\n\t\t\tif (d.isNew) {\n\t\t\t\td.isNew = false;\n\t\t\t\t$.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\t}\n\t\t\t// reload doc and rebuild revs list in ui\n\t\t\tthat.GetDoc(true, true)\n\t\t\t.then(function(){\n\t\t\t\t_notifyDocSaved();\n\t\t\t\tpi.resolve(d.doc);\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\t// fail to read doc back\n\t\t\t\tif (!silent) cw.lib.note(l.ERR_SAVELOAD.assign(code+': '+es(err)), 'error');\n\t\t\t\treturn pi.reject(code, l.ERR_SAVELOAD.assign(err), msg);\n\t\t\t});\n\t\t} \n\t\t// set new rev\n\t\telse if (d.rev && typeof reset == 'string') {\n\t\t\td.rev = reset;\n\t\t\td.path[d.path.length-1] = '_'+reset;\n\t\t\tthat.my.recalc('#state-proxy');\n\t\t\t_notifyDocSaved();\n\t\t\tpi.resolve(d.doc);\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503802592699","id": ".$doc.GetDoc","type": "js","data": "(function(redraw, rebuildRevList){\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tparams = {conflicts:true, local_seq:true, revs_info:true, att_encoding_info:true},\n      wasBusy = false,\n\t\t\turl, rev,\n\t\t\tpi;\n  \n  // mark busy\n\t_busy.debounce(100)(true);\n\n\t// if new, just generate _id\n\t\n\tif (d.isNew){\n\t\tvar pi = $.Deferred();\n\t\tthat.Req(['_uuids',{count:5}])\n\t\t.then(function(res){\n\t\t\td.doc._id = d.doc._id || (res.uuids||['']).sample();\n\t\t})\n\t\t.always(function(){\n\t\t\tif (!d.doc._id) d.doc._id = cw.lib.hash8(Date.now()+d.path[0]+Number.random(1,1e15));\n\t\t\tthat.Doc = [{dbname:d.path[0], revision:'', baseurl:that.Pho('Base'), doc:that.data.doc}];\n      _busy(false);\n\t\t\tpi.resolve();\n\t\t});\n\t\treturn pi.promise();\n\t}\n\t\n\t// if not new, start reading real doc\n\t\n\tif (d.path.length > (d.path[1]=='_design'?3:2)) {\n\t\trev = d.path.last().replace(/^\\D+/,'');\n\t\turl = d.path.to(-1);\n\t}\n\telse url = d.path;\n  \n  if (d.atts) url.push({attachments:true, att_encoding_info:true});\n\t\n\t// we have rev, need two requests\n\tif (rev) {\n\t\t// read reqested rev\n\t\tpi = that.Req(url.concat([$.extend(!0,{},params,{rev:rev})]))\n\t\t.then(function(res){\n\t\t\td.doc = _resort(res);\n\t\t\t// read actual doc revto have all sys props in place\n\t\t\treturn that.Req(url.concat([params]))\n\t\t\t.then(function(res){\n\t\t\t\td.doc = $.extend(d.doc, Object.select(res, ['_conflicts','_revs_info','_local_seq']));\n\t\t\t\t_cleanRevs(d.doc);\n\t\t\t\tif (rebuildRevList) that.RevsList();\n\t\t\t\tthat.Doc = [{dbname:d.path[0], revision:d.rev, baseurl:that.Pho('Base'), doc:that.data.doc}];\n\t\t\t\tthat.my.trigger('#state-proxy','resettabhash.my');\n\t\t\t\tif (redraw) that.my.redraw();\n\t\t\t});\n\t\t});\n\n\t} \n\t\n\t// no rev, return single request\n\telse {\n\t\t\n\t\tpi = that.Req(url.concat([params]))\n\t\t.then(function(res){\n\t\t\td.doc = _resort(res);\n\t\t\t_cleanRevs(d.doc);\n\t\t\tif (rebuildRevList) that.RevsList();\n\t\t\tthat.Doc = [{dbname:d.path[0], revision:d.rev, baseurl:that.Pho('Base'), doc:that.data.doc}];\n\t\t\tthat.my.trigger('#state-proxy','resettabhash.my');\n\t\t\tif (redraw) that.my.redraw();\n\t\t});\n\t}\n  \n  pi.always(_busy.fill(false).debounce(10));\n  \n  return pi;\n\t\n\t// - - - - - - - - - - -\n\t\n\tfunction _resort(res) {\n\t\t// moves id, rev and files to top of the tree\n\t\treturn $.extend(res._attachments?{_id:'',_rev:'',_attachments:{}}:{_id:'',_rev:''}, res);\n\t}\n  \n  // - - - - - - - - - - -\n\t\n\tfunction _cleanRevs(doc) {\n\t\tif (Object.isArray(doc._revs_info)) {\n\t\t\tdoc._revs_info = doc._revs_info.filter(function(r){return r.status=='available'});\n\t\t}\n\t\td.conflicts = doc._conflicts || [];\n\t\td.revs = (doc._revs_info||[]).map(function(r){return r.rev});\n\t}\n  \n  // - - - - - - - - - - -\n  \n  function _busy(busy){\n    if ((busy && !wasBusy)  || !busy) {\n      if (that.my) that.my.root().toggleClass('app-busy', busy);\n      $.my.radio('appbusy',{id:d.tabid, busy:busy});\n    }\n    wasBusy = true;\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1514480561433","id": ".$doc.GetAtts","type": "js","data": "(function(){\n  var that = this,\n      d = that.data,\n      url = [], \n      rev,\n      pi;\n\n  if (d.path.length > (d.path[1]=='_design'?3:2)) {\n    rev = d.path.last().replace(/^\\D+/,'');\n    url = d.path.to(-1);\n  }\n  else url = d.path;\n\n  if (rev) url.push({rev:rev});\n  \n  url.push({attachments:true, att_encoding_info:true});\n  \n  _busy.debounce(10)(true);\n  \n  d.atts = true;\n\n  return that.Req(url)\n  .then(function(res){\n    if (res._attachments) d.doc._attachments = res._attachments;\n    that.Doc = [{dbname:d.path[0], revision:d.rev, baseurl:that.Pho('Base'), doc:that.data.doc}];\n    that.my.trigger('#state-proxy','resettabhash.my');\n    that.my.redraw();\n  })\n  .fail(function(){\n\n  })\n  .always((function(){\n  \t_busy(false);\n  }).debounce(15));\n  \n  function _busy(busy){\n  \tthat.my.root().toggleClass('app-busy', busy);\n\t\t$.my.radio('appbusy',{id:d.tabid, busy:busy});\n  }\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504532213224","id": ".$doc.DelDoc","type": "js","data": "(function _del_doc (){\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tdoc = Object.clone(cw.lib.dry(d.doc), true),\n\t\t\tislast = d.revs[0] && d.revs[0] == d.doc._rev,\n\t\t\tisconflict = d.conflicts.indexOf(d.doc._rev||'') != -1,\n\t\t\tl = that.lang,\n\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t_trunc = function (s, chars) {return es((s+'').truncate(chars || 15,'right','…'));};\n\n\tvar pi = $.Deferred(),\n\t\t\turl = [d.path[0], doc._id, {rev:doc._rev}];\n\n\tvar trow = '<div class=\"mb10\">{1}</div>';\n\t\n\t$.my.modal({\n\t\twidth:350,\n\t\tmanifest:$.extend(\n\t\t\ttrue, {}, that.Pho('Confirm'),\n\t\t\t{\n\t\t\t\tui:{'input[name=\"retain\"]':'retain'},\n\t\t\t\tstyle:{' label':'margin:0;line-height:inherit;color:inherit;'}\n\t\t\t}\n\t\t),\n\t\tdata:{\n\t\t\tretain:'no',\n\t\t\ttext:[\n\t\t\t\t!isconflict?'<div class=\"fs130 red mb5\">'+l.TXT_DEL_TITLE+'</div>':'',\n\t\t\t\tisconflict?'<div class=\"fs130 orange mb5\">'+l.TXT_DEL_TITLE_CONFLICT+'</div>':'',\n\t\t\t\ttrow.assign(l.TXT_DEL_WARN.assign(_trunc(doc._id, 25), _trunc(d.path[0], 25))),\n\t\t\t\ttrow.assign([\n\t\t\t\t\t'<label class=\"xgray\"><input type=\"radio\" name=\"retain\" value=\"no\" class=\"mr6\"> '+l.LBL_DEL_ALL+'</label>',\n\t\t\t\t\t'<label class=\"xgray\"><input type=\"radio\" name=\"retain\" value=\"retain\" class=\"mr6\"> '+l.LBL_DEL_RETAIN+'</label>'\n\t\t\t\t].join('')),\n\t\t\t\td.conflicts.length && islast?trow.assign(l.TXT_DEL_NODEL):'',\n\t\t\t\tisconflict?trow.assign(l.TXT_DEL_CONFLICT):''\n\t\t\t].compact(true).join(''),\n\t\t\tyescss:isconflict?'orange':'red',\n\t\t\tyes:l.BTN_DEL_START,\n\t\t\tno:l.BTN_CANCEL,\n\t\t\tcancel:''\n\t\t},\n\t\tcss:'lh160 xgray p20 pb25'\n\t})\n\t.then(function(res){\n\t\tif (res.cmd!='yes') return pi.reject(999, 'Cancelled', 'Cancelled');\n\t\t_delReq(res.retain=='retain');\n\t})\n\t.fail(function(){\n\t\tpi.reject(999, 'Cancelled', 'Cancelled');\n\t})\n\n\n\treturn pi.promise();\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _delReq(retain){\n\t\t\n\t\tvar req = !retain?{\n\t\t\turl:\t\t\turl,\n\t\t\tmethod:\t\t'DELETE',\n\t\t\theaders:\t{'X-Couch-Full-Commit':'true'}\n\t\t}:{\n\t\t\turl:\t\t\t[d.path[0],'_bulk_docs'],\n\t\t\tmethod:\t\t'POST',\n      contentType:'application/json',\n\t\t\theaders:\t{'X-Couch-Full-Commit':'true'},\n\t\t\tdata: \t\tJSON.stringify({docs:[Object.merge({_deleted:true}, doc)]})\n\t\t};\n\t\t\n\t\treturn that.Req(req)\n\t\t.then(function(res){\n\t\t\t\n\t\t\tcw.lib.note(l.MSG_DEL_OK.assign( _trunc(doc._id), _trunc(d.path[0])) , 'ok');\n\t\t\t\n\t\t\t// notify tabs\n\t\t\ttry {\n\t\t\t\t$.my.radio('dbupdate', {db:d.path[0], cmd:'delete', docs:[doc._id]});\n        $.my.radio('dblist', [d.path[0]]);\n\t\t\t}catch(e){\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t\t\n\t\t\t// decide should we close tab or reload doc\n\t\t\tif (d.conflicts.length) _reloadDoc(true);\n\t\t\telse {\n\t\t\t\t(function(){\n\t\t\t\t\tthat.my.root().trigger('tabclose', {tabid:d.tabid, enforce:true});\n\t\t\t\t}).debounce(100)();\n\t\t\t\tpi.resolve(res);\n\t\t\t}\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\t// fail to read doc back\n\t\t\tcw.lib.note(l.MSG_DEL_FAIL.assign(_trunc(doc._id), code, es(err)), 'error');\n\t\t\t// however, notify tabs\n\t\t\t$.my.radio('dbupdate', d.path[0]);\n\t\t\t\n\t\t\treturn pi.reject(code, err, msg);\n\t\t});\n\t\t\n\t}\n\t\n\t// - - - - - - - - - - - - \n\t\n\tfunction _reloadDoc(reset){\n\t\t// reset to latest rev\n\t\td.path[1] = doc._id;\n\t\td.path.length = 2;\n\t\tvar wasrev = d.rev;\n\t\td.rev = '';\n\t\t\n\t\tif (wasrev) $.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\n\t\t// reload revs list and doc\n\t\tthat.GetDoc(true)\n\t\t.then(function(){\n\t\t\tcw.lib.note(l.MSG_DEL_RELOAD, '', 4000);\n\t\t\tthat.RevsList();\n\t\t\tpi.resolve(d.doc);\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\t// fail to read doc back\n\t\t\tcw.lib.note(l.MSG_DEL_RELOAD_FAIL.assign(_trunc(d.doc._id), code, es(err)), 'error');\n\t\t\tpi.reject(code, err, msg);\n\t\t\t// enforce tab close\n\t\t\tthat.my.trigger('#btn-del-doc', 'tabclose', {tabid:d.tabid, enforce:true});\n\t\t});\n\t}\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504543082693","id": ".$doc.RevsList","type": "js","data": "(function(){\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tvals = [{id:'',text:that.lang.TXT_REV}];\n\n\td.conflicts.forEach(function(r){ vals.push({id:r, text:'x'+r}) });\n\td.revs.forEach(function(r){ vals.push({id:r, text:r}) });\n\n\tthat.my.find('#app-rev').select2({\n\t\tdata:vals,\n\t\tformatResult: _formatOpt,\n\t\tformatSelection: _formatOpt\n\t});\n\n\tfunction _formatOpt (e) {\n\t\tvar t = e.text.replace('-','–').truncate(17,'middle','<span class=\"orange\">…</span>');\n\t\tif (t[0] == 'x') t = '<span class=\"red1 bolder\">†</span>\\u2009'+t.from(1);\n\t\treturn '<nobr>'+t+'</nobr>';\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504121325816","id": ".$doc.HTML","type": "js","data": "([\n\t'<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\">',\n\t\t\n\t\t// Search\n\t\t'<div class=\"fr w155 fs95\">',\n\t\t\t'<div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>',\n\t\t\t'<input type=\"text\" id=\"app-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" '\n\t\t\t\t+'placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\">',\n\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"'\n\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').blur()\"></span>',\n\t\t'</div>',\n\t\t\n\t\t// Reload\n\t\t'<button id=\"btn-reload\" class=\"w40 mr8\" title=\"{PLC_RELOAD}\"><span class=\"fi-loop\"></span></button>',\n\t\n\t\t// Title\n\t\t'<div id=\"app-title\" class=\"dib vat ell mr20 nw\"></div>',\n\n\t\t// Revision select\n\t\t'<div class=\"dib vat w200 mr10\"><input id=\"app-rev\" type=\"text\" class=\"w100p fs110 vat\"></div>',\n\t\n\t\t// Control buttons\n\t\t'<div class=\"nw dib vat\">',\n\t\t\t'<button id=\"btn-doc-save\" class=\"green mr2\">{BTN_SAVE}</button>',\n\t\t\t//'<button id=\"btn-doc-saveas\" class=\"mr10\" disabled>{BTN_SAVEAS}</button>',\n\t\t\t'<button id=\"btn-doc-del\" class=\"red\">{BTN_DEL}</button>',\n\t\t'</div>',\n\n\t\t//'<button id=\"btn-undo\" class=\"w40 mr10\"><span class=\"fi-arrow-left\"></span></button>',\n\n\t'</div>',\n\t\n\t// Panel with viewer/editor\n\t'<div class=\"panelheight feather\">',\n\t\t'<div id=\"jseditor\" class=\"panelheight pl20 pr20 pt10 pb16\" style=\"outline:none;\"></div>',\n\t'</div>',\n\t\n\t'<div id=\"state-proxy\" class=\"hide\"></div>'\n].join(''))","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503727841991","id": ".$config","type": "js","data": "({\n\tid:'cw.Photon.$config',\n\tlang:{},\n\tdata:{\n\t\tpath:[],\n\t\tnode:'',\n\t\tdoc:{},\n\t\tcmp:{added:[],updated:[],deleted:[],invalid:{}},\n\t\tstamp:0\n\t},\n\t\n\tDoc:[],\n\tOld:{},\n\tNodes:[],\n\tMembersChecked:false,\n\t\n\thash:function(){\n\t\treturn cw.lib.crc2((this.Doc[0]||{}).doc||{});\n\t},\n\ttitle:function(){ return 'Config'; },\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\treturn that.Get(false, true)\n\t\t.then(function(res){\n\t\t\t$o.html(that.HTML.assign(that.lang).assign({TITLE_HTML:that.TitleHTML[that.Pho('isCluster')?1:0]}));\n\t\t});\n\t},\n\tui:{ /* See tabs */ },\n\t\n\tdie: function($o){\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#jseditor').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t},\n\t\n\tTitleHTML:[\n\t\t'<div id=\"app-title\" class=\"dib vat fs160 lh120 ell mr20\" style=\"max-width:40%\"></div>',\n\t\t'<div class=\"dib vat fs115 mr20 w40p\"><input type=\"text\" id=\"app-title\" class=\"w100p bolder\"></div>'\n\t],\n\t\n\tstyle:{\n\t\t' #jseditor>div':'font-size:14.5px!important;min-height:550px;',\n\t\t' #jseditor .inav':'margin:1px 0!important;',\n\t\t' .iact .button':'padding: 0.05em 0 0.1em 0!important;',\n\t\t\n\t\t' #jseditor>.my-form>section>#editor>#doc>.iact.buttons':'padding-right:3px;',\n\t\t\n\t\t' .CodeMirror-linenumber':'white-space:nowrap;',\n\t\t\n\t\t' .my-modal-form':{\n\t\t\t\" .CodeMirror .CodeMirror-lines\": \"line-height:17px;\",\n\t\t\t\" .CodeMirror-scroll\": \"min-height:150px;max-height:calc(18 * 17px + 6px);\",\n\t\t\t\" .CodeMirror-linenumbers\": \"transition: background-color 0.3s;\",\n\t\t\t\".ed-error .CodeMirror-linenumbers\": \"background-color:rgba(255, 200, 200, 0.75);\",\n\t\t\t\" .CodeMirror .cm-property\": \"color:#434e5d;\",\n\t\t\t\" .CodeMirror .cm-variable\": \"color:#33bfad;\",\n\t\t\t\" .CodeMirror .cm-keyword\": \"color:#90259e;\",\n\t\t\t\" .CodeMirror\": \"min-height:150px; height:auto;\",\n\t\t\t' .buttons button': 'margin-right: 2px;padding: 0.4em 0.7em 0.4em 0.7em;font-size: 90%;'\n\t\t},\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1512747107128","id": ".$config.ExtEd","type": "js","data": "({\n  HTML:{\n\t\tItemRoot:[\n\t\t\t'<div class=\"inav\">',\n\t\t\t\t'<div class=\"ikey\"></div>',\n\t\t\t\t'<div class=\"idesc cp\">–</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"ivalue imulti hide\">',\n\t\t\t\t'<div class=\"ilist\"></div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"iact buttons\">',\n\t\t\t\t'<button class=\"btn-add button green\" title=\"Add new property\">&thinsp;<span class=\"fi-plus\"></span>&thinsp;</button>',\n\t\t\t\t'<button class=\"btn-takeout button\" title=\"Copy / paste / edit as JSON\"><span class=\"fi-shopping-bag\"></span></button>',\n\t\t\t\t'<button class=\"btn-copy button\" title=\"Stash node as clip\"><span class=\"fi-clipboard\"></span></button>',\n\t\t\t\t'<button class=\"btn-del button red hide\"  title=\"Del node\">&thinsp;<span class=\"fi-x\"></span>&thinsp;</button>',\n      \t'<button id=\"btn-revert\" class=\"button\"  title=\"Revert to saved\">',\n      \t\t'&thinsp;<span class=\"fi-refresh\"></span>&thinsp;',\n      \t'</button>',\n\t\t\t'</div>'\n\t\t].join('')\n\t},\n\tui:{\n\t\t\"#doc\":{\n\t\t\tmanifest:function(e){\n\t\t\t\tif (!this.HTML.ItemRoot) return this.$multi;\n\t\t\t\tvar that = this;\n\t\t\t\treturn $.extend(true, {}, that.$multi, {\n\t\t\t\t\tHTML:that.HTML.ItemRoot,\n\t\t\t\t\tui:{\n\t\t\t\t\t\t'#btn-revert':{\n\t\t\t\t\t\t\tbind:function(d,v,$o){\n\t\t\t\t\t\t\t\tif (v==null) return;\n                $.my.radio('revert_config', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["green"]},{"stamp": "1503728284852","id": ".$config.ui","type": "js","data": "({\n\t'#app-title':{\n\t\tinit:function($o){\n\t\t\tvar that = this;\n\t\t\tif (that.Nodes.length > 1) {\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:that.Nodes.map(function(e){return {id:e, text:e}}),\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tbind:function(d, v){ \n\t\t\tif (this.Nodes.length<2) return location.host; \n\t\t\tif (v != null) {\n\t\t\t\tif (d.node != v) this.Get(true);\n\t\t\t\td.node = v;\n\t\t\t}\n\t\t\treturn d.node;\n\t\t},\n\t},\n\t\n\t'#cfg-warn':{\n\t\tdelay:100,\n\t\tinit:function($o){\n\t\t\t$o.niceScroll({\n\t\t\t\tbouncescroll: true,\n\t\t\t\t//preservenativescrolling:false,\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t},\n\t\tbind: function (d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tc = that.Cmp(),\n\t\t\t\t\th = '',\n\t\t\t\t\tl = that.lang,\n\t\t\t\t\ttu = c.updated.length,\n\t\t\t\t\tta = c.added.length,\n\t\t\t\t\ttd = c.deleted.length,\n\t\t\t\t\tti = Object.size(c.invalid),\n\t\t\t\t\tts = '<div><div class=\"fs110 bolder mt8 \">{1}</div>{2}</div>';\n\t\t\t\n\t\t\th = [\n\t\t\t\tti?ts.assign(l.LBL_IERR.assign(ti), Object.keys(c.invalid).map(function(k){\n\t\t\t\t\treturn '<div class=\"lh130 mb5\"><span class=\"red1\">{1}:</span> {2}</div>'.assign(k, c.invalid[k]);\n\t\t\t\t}).join('')):null,\n\t\t\t\ttu?ts.assign(l.LBL_IUPD.assign(tu), c.updated.join('<br>')):null,\n\t\t\t\tta?ts.assign(l.LBL_IADD.assign(ta), c.added.join('<br>')):null,\n\t\t\t\ttd?ts.assign(l.LBL_IDEL.assign(td), c.deleted.join('<br>')):null\n\t\t\t].compact().join('').replace(/\\u2003/g,'<span class=\"o60\"> /&nbsp;</span>');\n\t\t\t\n\t\t\td.cmp = c;\n\t\t\t\n\t\t\tif (!h.length) return '<div class=\"mt8\">'+l.TXT_ITITLE_EMPTY+'</div>';\n\t\t\treturn h;\n\t\t}\n\t},\n\t\n\t\"#app-search\":{\n\t\tdelay:20,\n\t\tbind:function(d,v){\n\t\t\tif (v==null) return d.search;\n\t\t\td.search = v.length<3?'':v;\n\t\t\tif (this.Doc[0] && this.Doc[0].search != d.search) {\n\t\t\t\tthis.my.find('#json-search').val(d.search).trigger('check');\n\t\t\t}\n\t\t\treturn v;\n\t\t},\n\t\tcss: { \t\"my-search\": /^.{3,}$/ }\n\t},\n\t\n\t'#cfg-proxy':{\n\t\tbind: function(){\n\t\t\tthis.my.check('#cfg-warn');\n\t\t},\n\t\twatch:['#jseditor']\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1506727725089","id": ".$config.ui","type": "js","data": "({\n\t'#jseditor':{\n\t\tdelay:100,\n\t\tcheck:false,\n\t\tlist:'<div></div>',\n\t\tmerge:false,\n\t\tinit:function($o){\n\t\t\t$o.niceScroll({\n\t\t\t\tbouncescroll: true,\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t},\n\t\tid:function(e){return this.data.stamp},\n\t\thash:function(e){return cw.lib.crc2(e.doc)},\n\t\tmanifest: function(elt){\n\t\t\tvar that = this;\n\t\t\tvar isSystem = function(d){\n\t\t\t\tvar that = this,\n\t\t\t\t\t\tver = that.Pho('Couch').version,\n\t\t\t\t\t\tbanned = [\n\t\t\t\t\t\t\t\"daemons\",\"external\",\n\t\t\t\t\t\t\t\"httpd_design_handlers\",\"httpd_db_handlers\",\"httpd_global_handlers\",\n\t\t\t\t\t\t\t\"native_query_servers\",\"os_daemons\",\"query_servers\"\n\t\t\t\t\t\t];\n\n\t\t\t\tif ((ver >= '1.7.0' && ver < '2.0.0') || ver >= '2.1.1') {\n\t\t\t\t\tif (banned.indexOf(d.path[1]) > -1) return that.lang.BAN_HTTP;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\treturn $.extend(\n\t\t\t\ttrue, {}, \n\t\t\t\tthat.Pho('Ed').jsontree, \n        that.ExtEd,\n\t\t\t\t{\n\t\t\t\t\tMEdit:{data:{commitKeys:['Enter']}},\n\t\t\t\t\tMRoot: function(){return that.my.root()},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tLib:{\tisSystem:isSystem}\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tbind:'this.Doc'\n\t},\n\t\n\t'#btn-cfg-save':{\n\t\tdelay:20,\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tl = that.lang;\n\t\t\t\n\t\t\tif (that.Nodes.length > 1) {\n\t\t\t\n\t\t\t\tthat.my.modal('#btn-cfg-save', {\n\t\t\t\t\tmanifest:that.Pho('Confirm'),\n\t\t\t\t\twidth:500,\n\t\t\t\t\tdata:{\n\t\t\t\t\t\ttext:l.MSG_CLUSTER,\n\t\t\t\t\t\tyes:l.BTN_SAVECLUSTER,\n\t\t\t\t\t\tyescss:'orange',\n\t\t\t\t\t\tno:l.BTN_SAVENODE.assign(d.node.split('@')[1].truncate(17,'middle','…').escapeHTML()),\n\t\t\t\t\t\tnocss:'green',\n\t\t\t\t\t},\n\t\t\t\t\tglobal:true,\n\t\t\t\t\tscreen:true,\n\t\t\t\t\tz:1992\n\t\t\t\t})\n\t\t\t\t.then(function(res){\n\t\t\t\t\tif (res.cmd == 'no') that.Save([d.node]);\n\t\t\t\t\telse that.Save();\n\t\t\t\t})\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.Save();\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d,v){return d.cmp.updated+d.cmp.added+d.cmp.deleted=='';}\n\t\t},\n\t\twatch:['#cfg-warn']\n\t},\n\n\t'#btn-reload':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tthat.Get(true);\n\t\t},\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){\n\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\tif (!v.name) $.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t},\n      revert_config:function(){this.Get.debounce(150)(true);}\n\t\t}\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504576883652","id": ".$config.Get","type": "js","data": "(function (redraw, silent){\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\tnodes = [];\n\t\n\t// check cluster\n\tif (that.Pho('isCluster') || !that.MembersChecked) {\n\t\tthat.Req(['_membership'])\n\t\t.then(function(res){\n\t\t\tif (!Object.isObject(res) || !Object.isArray(res.all_nodes) || !Object.isArray(res.cluster_nodes)) _readCfg();\n\t\t\telse {\n\t\t\t\t\n\t\t\t\tnodes = res.cluster_nodes.slice(0).intersect(res.all_nodes);\n\t\t\t\t\n\t\t\t\tif (nodes.length == 1) {\n\t\t\t\t\tthat.Pho().isCluster = false;\n\t\t\t\t}\n\t\t\t\tthat.Nodes = nodes;\n\t\t\t\tif (nodes.indexOf(d.node) == -1) d.node = nodes[0];\n\t\t\t\tthat.MembersChecked = true;\n\t\t\t\t_readCfg();\n\t\t\t}\n\t\t})\n\t\t.fail(function(code){\n\t\t\tif (code != 401 && code != 403) {\n\t\t\t\tthat.Pho().isCluster = false;\n\t\t\t\tthat.MembersChecked = true;\n\t\t\t}\n      console.log('This 400 is normal, we checked if we are in cluster.');\n\t\t\t_readCfg();\n\t\t});\n\t}\n\telse _readCfg();\n\t\n\treturn pi.promise();\n\t\n\t\n\t// read config\n\tfunction _readCfg() {\n\t\t\n\t\tvar path = ['_config'];\n\t\tif (that.Nodes.length) {\n\t\t\tif (that.Nodes.length == 1 || !d.node) path.unshift('_node', that.Nodes[0]);\n\t\t\telse path.unshift('_node', d.node);\n\t\t}\n\t\t\n\t\tthat.Req(path)\n\t\t.then(function(res){\n      var obj = {};\n\t\t\tObject.keys(res).sort().forEach(function(i){\n\t\t\t\tif (!Object.isObject(res[i])) obj[i] = res[i];\n        else obj[i] = Object.keys(res[i]).sort().reduce(function(a,b){\n          a[b] = _translate (res[i][b]); \n          return a;\n        },{});\n\t\t\t});\n      d.doc = obj;\n\t\t\tthat.Doc = [{labelWidth:200, doc:that.data.doc, _id:'_config'}];\n\t\t\tthat.Old = Object.clone(d.doc, true);\n\t\t\td.cmp = {added:[],updated:[],deleted:[],invalid:{}};\n\t\t\treturn res;\n\t\t})\n\t\t.then(function(res){\n\t\t\td.stamp = Date.now();\n\t\t\tif (redraw) that.my.recalc('#jseditor');\n\t\t\tthat.my.trigger('#cfg-proxy','resettabhash.my');\n\t\t\tpi.resolve(res);\n\t\t})\n\t\t.fail(function(code,err,msg){\n\t\t\tif (!silent) cw.lib.note(that.lang.ERR_RELOAD.assign(code, err.truncate(45,'right','…').escapeHTML()), 'error');\n\t\t\tpi.reject(code,err,msg);\n\t\t});\n\t}\n  \n  // translate nodes\n  function _translate (s) {\n  \tif (typeof s != 'string') return s;\n    if (s=='true') return true;\n    if (s=='false') return false;\n    if (/^\\d{1,15}$/.test(s)) return +s;\n    return s;\n  }\n  \n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504639113854","id": ".$config.Cmp","type": "js","data": "(function _compare(){\n\t// compares this.Old and data.doc,\n\t// returns {updated, added, deleted, invalid}\n\t\n\tvar res = {\n\t\tupdated:[],\n\t\tadded:[],\n\t\tdeleted:[],\n\t\tinvalid:{},\n\t\toldcfg:{},\n\t\tnewcfg:{}\n\t};\n\t\n\tvar that = this,\n\t\t\tl = that.lang,\n\t\t\tle = l.ERR_VAL,\n\t\t\told = Object.clone(that.Old, true),\n\t\t\tcfg = Object.clone(that.data.doc, true),\n\t\t\tv0 = res.oldcfg = _keys(old, false),\n\t\t\tv1 = res.newcfg = _keys(cfg, true), \n\t\t\tinv = Object.keys(res.invalid),\n\t\t\tk0 = Object.keys(v0).subtract(inv),\n\t\t\tk1 = Object.keys(v1).subtract(inv);\n\t\n\t// deleted\n\tres.deleted = k0.subtract(k1);\n\tres.added = k1.subtract(k0);\n\tres.updated = k1.subtract(res.added).filter(function(k){\n\t\treturn JSON.stringify(v0[k]) != JSON.stringify(v1[k]);\n\t});\n\t\n\treturn res;\n\t\n\t// - - - - - - - - - - -\n\t\n\tfunction _keys(obj, check) {\n\t\tvar a = {},\n\t\t\t\tre = /^[a-z0-9:_\\-!\\.]+$/i,\n\t\t\t\trehkey0 = /^httpd_.+_handlers$/,\n\t\t\t\trehkey1 = /^[a-z0-9:_\\-!\\.\\/]+$/i;\n\t\t\n\t\tObject.keys(obj).forEach(function(lvl0){\n\t\t\tvar sobj = obj[lvl0];\n\t\t\tif (!Object.isObject(sobj)) return;\n\t\t\t\n\t\t\tObject.keys(sobj).forEach(function(lvl1){\n\t\t\t\tvar k = lvl0+'\\u2003'+lvl1;\n\t\t\t\tif (check) {\n\t\t\t\t\tif (rehkey0.test(lvl0) && !rehkey1.test(lvl1)) {\n\t\t\t\t\t\t//invalid key\n\t\t\t\t\t\tres.invalid[k] = le.CHARS;\n\t\t\t\t\t}\n\t\t\t\t\tif (!rehkey0.test(lvl0) && !re.test(lvl1)) {\n\t\t\t\t\t\t//invalid key\n\t\t\t\t\t\tres.invalid[k] = le.CHARS;\n\t\t\t\t\t}\n\t\t\t\t\telse if (/^(null|array|object)$/.test($.type(sobj[lvl1]))) {\n\t\t\t\t\t\t//invalid val\n\t\t\t\t\t\tres.invalid[k] = le.VALSTRING;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ta[k] = sobj[lvl1];\n\t\t\t});\n\t\t});\n\t\treturn a;\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504653583909","id": ".$config.Save","type": "js","data": "(function _save_config(nodes0){\n\tvar that = this,\n\t\t\tcfg = that.Cmp(),\n\t\t\tnc = cfg.newcfg,\n\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\tl = that.lang,\n\t\t\tsteps = [],\n\t\t\terrs = {},\n\t\t\tnodes = (nodes0 || that.Nodes).slice(0);\n\t\n\t// Pre 2.0\n\tif (!nodes.length) {\n\t\tcfg.deleted.forEach(function(k){\n\t\t\tsteps.push({ key:k, value:null })\n\t\t});\n\t\tcfg.added.concat(cfg.updated).forEach(function(k){\n\t\t\tsteps.push({ key:k, value:nc[k]+'' })\n\t\t});\n\t}\n\t// cluster\n\telse {\n\t\tnodes.forEach(function(node) {\n\t\t\tcfg.deleted.forEach(function(k){\n\t\t\t\tsteps.push({ url:['_node', node, '_config'], key:k, value:null });\n\t\t\t});\n\t\t\tcfg.added.concat(cfg.updated).forEach(function(k){\n\t\t\t\tsteps.push({ url:['_node', node, '_config'], key:k, value:nc[k]+'' })\n\t\t\t});\n\t\t});\n\t}\n\n\tvar ctr = steps.length;\n\tsteps.forEach(function(obj, i){\n\t\t\t\t\n\t\tthat.Req({\n\t\t\turl:(obj.url || ['_config']).concat(obj.key.split('\\u2003')), \n\t\t\tmethod:obj.value !== null?'PUT':'DELETE',\n      contentType: obj.value !== null?'application/json':null,\n\t\t\t//headers:obj.value !== null?{'Content-type':'application/json'}:{},\n\t\t\tdata:obj.value !== null?JSON.stringify(obj.value):undefined\n\t\t})\n\t\t.then(function(){\n\t\t\tif (obj.key == 'replicator\\u2003db') that.Pho().ReplicatorDB = obj.value;\n\t\t\tcw.log('Photon updated config key', obj.key.split('\\u2003'));\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\terrs[obj.key] = {code:code, error:err, reason:msg};\n\t\t})\n\t\t.always(function(){\n\t\t\tctr -= 1;\n\t\t\tif (!ctr) _end();\n\t\t});\n\n\t}.lazy(that.Pho('Cfg').batchUpdateCfg || 100));\n\t\n\t// - - - - - - - - - -\n\t\n\tfunction _end(){\n\t\tif (Object.size(errs)) {\n\t\t\tcw.lib.note(l.MSG_SAVE_FAIL, 'error');\n\t\t\tconsole.log ('Errors during config update:');\n\t\t\tconsole.log(errs);\n\t\t}\n\t\telse {\n\t\t\tcw.lib.note(l.MSG_SAVE_OK, 'ok');\n\t\t\tthat.Get(true);\n\t\t}\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504645284211","id": ".$config.HTML","type": "js","data": "([\n\t'<div class=\"w75p  dib vat\" id=\"cfg-panel-left\">',\n\t\t'<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\">',\n\t\n\t\t\t'<div class=\"fr w155 fs95\">',\n\t\t\t\t'<div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>',\n\t\t\t\t'<input type=\"text\" id=\"app-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" '\n\t\t\t\t\t+'placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\">',\n\t\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"'\n\t\t\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').blur()\"></span>',\n\t\t\t'</div>',\n\t\n\t\t\t\n\t\t\t'{TITLE_HTML}',\n\t\t\t\n\t\t\t'<div class=\"nw mr10 dib vat tac w40p\" >',\n\t\t\t\t'<button id=\"btn-reload\" class=\"w40 mr2\" title=\"{BTN_REVERT}\"><span class=\"fi-refresh\"></span></button>',\n\t\t\t\t'<button id=\"btn-cfg-save\" class=\"green mr2\" disabled>{BTN_SAVE}</button>',\n\t\t\t'</div>',\n\n\t\t//'<button id=\"btn-undo\" class=\"w40 mr10\"><span class=\"fi-arrow-left\"></span></button>',\n\n\t\t'</div>',\n\t\t'<div class=\"panelheight feather\">',\n\t\t\t'<div id=\"jseditor\" class=\"panelheight pl20 pr20 pt10 pb16\" style=\"outline:none;\"></div>',\n\t\t'</div>',\n\t'</div>',\n\t\n\t'<div class=\"w25p dib vat\">',\n\t\t'<div id=\"a-head\" class=\"app-head nw pt18 ml15 mr20\">',\n\t\t\t'<div class=\"dib vat fs150 lh120 xfray o70\">{TXT_ITITLE}</div>',\n\t\t'</div>',\t\n\t\t'<div class=\"ml15 panelheight feather fs95 lh150\">',\n\t\t\t\t'<div id=\"cfg-warn\" class=\"panelheight pr20 pb16\" style=\"outline:none;\"></div>',\n\t\t'</div>',\n\t\t'<div id=\"cfg-proxy\" class=\"hide\"></div>',\n\t'</div>'\n].join(''))","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503866218825","id": ".$view","type": "js","data": "({\n  id:\t\t\t'cw.Photon.$view',\n  lang:\t\t{},\n  Steps:\t[10,20,50,100,200,500],\n  Modals:\t{},\n  \n  Result:\t[],\t\t// received result at 0 index\n  Rows:\t\t[],\t\t// received rows\n  Error:\t'',\t\t// Request error\n  fRows:\tnull,\t// rows filtered by search\n\n  Ddocs:\t{},\t\t// raw ddocs by _id\n  Views:\t[],\t\t// view info grouped by ddoc, for select2\n  Vi:\t\t\t{},\t\t// views by with ext params (reduce and so on)\n  ViEds:\t{},\t\t// stashed view editors, to keep between ed switch\n  Pending:{},\t\t// pending requests\n  \n  List:\t\t[],\t\t// filtered and processed list\n  Editor:\t[],\t\t// Current query ed\n\n  // - - - - - - - - - - - - - - -\n\n  RT: function(key){return null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];},\n\n  // - - - - - - - - - - - - - - -\n\n  Index: function _indexRow (row) {return JSON.stringify(row, null, '  ');},\n\n  // - - - - - - - - - - - - - - -\n\n  die: function($o){\n    // Unmount niceScroll\n    var $v = $o.find('#view-results'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n    $v.list('remove');\n  },\n\n  // - - - - - - - - - - - - - - -\n\n  s2p:\tfunction _state2path(){\n    // converts curr state to path array\n\n    var that = this,\n        d = that.data,\n        db = d.path[0],\n        p = [db];\n\n    if (!d.start && !d.view) return [d.path[0]];\n\n    var view = that.Vi[d.view],\n        av = d.view.split('\\ufffd');\n    \n   if (d.view.to(5) == '_find') {\n      p.push('_find');\n      p.push(av[1] || 'Default query')\n    }\n    else if (d.view.to(4) == '_idx') {\n      p.push('_index');\n      if (d.view.to(6) != '_idx/\\ufffd') p.push(av[0].split('/')[1], av[1]);\n      else  p.push('Default index');\n    }\n    else if (view) p.push('_view', view.path[2], view.path[4]);\n    else p.push('_all_docs');\n\n    if (!d.start) return p;\n    p.push(d.start, (d.reverse?'-':'')+(+d.limit));\n    return p;\n  },\n  \n  // - - - - - - - - - - - - - - -\n\n  hash:function(){return 'view';},\n\n  title:function(){ \n    var that = this, d = that.data, p = d.path,\n        isMango = d.view.to(5)=='_find',\n        view = !d.view?'':d.view=='_'?'_design/*':d.view.split('\\ufffd')[1],\n        slash = isMango?'⊶':'÷';\n    return p[0]+(view?'\\u2009'+slash+'\\u2009'+view:'');\n  },\n  \n  // - - - - - - - - - - - - - - -\n  \n  jseval: function(s){\n  \t// ToDo: Put uglify in front of eval\n    var r;\n    try {r = eval('('+s+')')} catch(e){}\n    return r;\n  },\n\n  // - - - - - - - - - - - - - - -\n\n  data:{\n    path:[],\n    search:'',\n    view:'',\n    start:'',\n    limit:'+100',\n    reverse:false,\n    reduce:'',\n    state:'',\n\n    selection:[],\n    link:'',\n\n    total_rows:0,\n    offset:0,\n    seq:'',\n\n    xkey:'0',\n    \n    editor: false,\n\n    mango:{\n      active:'Default query',\n      mode:['javascript'],\n      query:[{\n        name:'Default query',\n        text:'({})',\n        json:{},\n        errors:[],\n        stamp:0\n      }]\n    }\n  },\n  \n  // - - - - - - - - - - - - - - -\n  \n  DefaultMangoQry: {\n    name:'Default query',\n    type:'mango',\n    text:''+\n`({\n  // Matching docs selector\n  selector: {\n    _id: {$gt: ''}\n  },\n  \n  // Doc fields to return, \n  // comment out to get whole docs\n  fields: ['_id', '_rev', /*'x.y'*/],\n  \n  // Sort order, like:\n  // sort: [{_id:'asc'}, {name: 'desc'}]\n  \n  // When edit, use Cmd-R to run query\n})`,\n    json:{selector:{_id:{$gt:''}}, fields:['_id','_rev']},\n    errors:[],\n    stamp:0\n  },\n  \n  // - - - - - - - - - - - - - - -\n  \n  DefaultMangoIdx: {\n    name:'Default index',\n    ddoc:'',\n    type:'index',\n    text:''+\n`({\n  index: {\n\t\tfields: [{_id: 'asc'}]\n\t},\n\t// partial_filter_selector:{\n\t// \t'foo.bar':{$gt:0}\n\t// }\n})`,\n    json:{index:{fields:[{_id:'asc'}]}},\n    errors:[],\n    stamp:0\n  },\n\n  ui:{ /* See tabs */ },\n  HTML: '', // See tab\n  style:{ /* See tab */ }\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1532114789988","id": ".$view.init","type": "js","data": "(function($o){\n  var that = this,\n      d = that.data,\n      lang = that.lang;\n  \n  // Remap .F\n  Object.keys(that.F).forEach(function(k){\n  \tthat[k] = that.F[k].bind(that);\n  });\n\n  // Default views\n  that.Views = that.DefaultViews();\n\n  // init row renderer closures and debounce\n  that.TMap = that.TMap();\n  that.TDocs = that.TDocs();\n  that.TMango = that.TMango();\n\n  // Restore mango qries if any\n  var mango = that.Pho('Ls')('Mango.'+d.path[0]);\n  if (Object.isObject(mango) && mango.query) $.extend(d.mango, mango);\n\n  // startkey shortcut click handler\n  $o.on('click.my', '.view-tofilter', function(evt){\n    var key = $(evt.currentTarget).data('filter');\n    d.start = Object.isString(key)?key.replace(/^\"|\"$/g,''):JSON.stringify(key);\n\n    cw.lib.note(lang.MSG_STARTKEY_CHANGED.assign(d.start));\n\n    that.my.recalc('#view-startkey');\n    that.my.check('#view-startkey');\n  }.debounce(40));\n\n  // user edit click handler\n  $o.on('click.my', '.view-edituser', function(evt){\n    var $b = $(evt.currentTarget),\n        id = $(evt.currentTarget).data('user');\n\n    $b.addClass('hover');\n\n    that.Req(['_users',id])\n      .then(function(res){\n      // open modal editor\n      return $b.modal({\n        root:\t\t\t$o,\n        manifest:\tthat.Pho('UserDoc'),\n        data:\t\t\tres,\n        width:\t\t380,\n        bound:\t\t0,\n        nose:\t\t\t'left',\n        css:\t\t\t'xgray',\n        align:\t\t'left:100%;top:-57px;',\n        screen:\t\t'rgba(255,255,255,0)',\n        esc:\t\t\ttrue\n      });\n    })\n      .always(function(){\n      $b.removeClass('hover');\n    });\n\n  }.debounce(5));\n\n  // init selection\n  $o.on('click.my', 'input[name=\"docs-selection\"]', function(){\n    var v = [];\n    $o.find('input[name=\"docs-selection\"]').each(function(){\n      var $x = $(this);\n      if ($x.is(\":checked\")) v.push($x.val());\n    });\n    d.selection = v;\n    that.my.check('#view-hasselection');\n  });\n\n  if (d.path[0] == '_users' && that.Pho('Cfg').listCols.indexOf('security')>-1) {\n    $o.then(function(){\n      that.GetSec();\n    });\n  }\n\n  return that.Pho('PokeBucket')(d.path[0])\n  .then(function(){\n    return that.GetViews(false, true)\n    .then(function(){\n      var p2 = d.path[2],\n          p3 = d.path[3];\n      if (d.path[1] == '_find') {\n        var mname = p2+'';\n       \tif (!d.mango.query.find(function(e){return e.name == mname})) mname = 'Default query';\n        \n        d.view = '_find\\ufffd'+mname;\n        d.editor = true;\n      }\n      else if (d.path[1] == '_index') {\n        if (d.path[2] == 'Default index' && !d.path[3]) d.view = '_idx/\\ufffdDefault index';\n        else d.view = '_idx/{1}\\ufffd{2}'.assign(d.path[2],d.path[3]);\n        d.editor = true;\n      }\n      else if (p2 && p3) {\n        var vkey = '_design/'+p2+'\\ufffd'+p3;\n        d.view = that.Vi[vkey]?vkey:'';\n      }\n    });\n  })\n  //.then(that.GetView)\n  .then(function(){\n    $o.html(that.HTML.assign(lang));\n  });\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532115238011","id": ".$view.F","type": "js","data": "({\n  // Renderers and default view list generator\n  \n  //==================================\n\n  DefaultViews: function(){\n    var that = this,\n        ver = parseFloat(this.Pho(['Couch','version'])),\n        views = [\n          {id:'', text:that.lang.OPT_ALLDOCS, order:'__1'},\n          //{id:'_ddocs', text:that.lang.OPT_ALLDOCS, order:'__2'}\n        ];\n    if (ver>1.9999) {\n      var g = {text:'Local Mango queries', children:[], order:'~2'}\n      that.data.mango.query.forEach(function(q){\n      \tg.children.push({id:'_find\\ufffd'+q.name,\ttext:'\\u00a0\\u00a0'+q.name, order:(q.name=='Default query'?'_1 ':'_2 ')+q.name});\n      });\n      g.children = g.children.sortBy('order');\n      views.push(g);\n      \n      var ix = {text:'Mango indexes', children:[{\n        id:'_idx/'+'\\ufffd'+that.DefaultMangoIdx.name,\n        text:'\\u00a0\\u00a0'+that.DefaultMangoIdx.name,\n        order:'_0'\n      }], order:'~3'};\n      views.push(ix);\n    }\n    return views;\n  },\n\n  //==================================\n\n  TMap: function (){\n    var that = this,\n        d = that.data,\n        j2h = that.Pho('j2h');\n\n    var t = that.T.view,\n        tf = that.T.view_filter;\n\n    // Renderer function\n\n    return function _tmap (row, i) {\n      var limit = that.Rows.length,\n        \tisIdx = d.view.to(4) == '_idx',\n          mapper = limit<120?_mapFull: limit<250?_mapMedium: _mapSimple,\n          chars = limit<40?2000: limit<60?500: limit<120?300: 200,\n          lvl = limit<40?5: limit<60?4: limit<120?3: limit<250?3: 2;\n\n      var v = isIdx?row.key:row.value, \n          a = j2h(v, chars, ['_id','id','name'], lvl),\n          s;\n      if (a.length==1 && a[0][0]=='short') {\n        if (a[0][1][0] == '{') a[0][1] ='Object '+a[0][1];\n        else if (a[0][1][0] == '[') a[0][1]='Array '+a[0][1];\n      }\n      s = a.map(mapper).join('');\n\n      if (that.fSearch && d.search.length > 2) {\n        return tf.assign({\n          _idx:row._idx,\n          _idxsafe:row._idxsafe,\n          id:row.key,\n\n          idsafefilter:(isIdx?row.id:JSON.stringify(row.key))\n          .replace(that.fSearch, '\\ufff1$1\\ufff0')\n          .escapeHTML()\n          .replace('\\ufff1','<span class=\"view-found\">')\n          .replace('\\ufff0','</span>'),\n\n          idsafe:(isIdx?row.id:JSON.stringify(row.key)).escapeHTML(),\n          href:row.id?that.p2u([d.path[0], row.id]).join('/').escapeHTML():'',\n          nodoc:row.id?'':'hide',\n          key:row.key,\n          //doc:'',\n          html:s,\n          css:s.length>250?'fs95 lh140 pt3 pb3':'lh140 pt2 pb2'\n        });\n\n      }\n      return t.assign({\n        _idx:row._idx,\n        _idxsafe:row._idxsafe,\n        id:row.key,\n        idsafe: (isIdx?row.id:JSON.stringify(row.key)).escapeHTML(),\n        href:row.id?that.p2u([d.path[0], row.id]).join('/').escapeHTML():'',\n        nodoc:row.id?'':'hide',\n        key:row.key,\n        //doc:'',\n        html:s,\n        css:s.length>250?'fs95 lh140 pt3 pb3':'lh140 pt2 pb2'\n      });\n    }\n\n\n    // - - - - - - \n\n    function _mapFull(row){\n      if (!row[0]) return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapMedium(row){\n      if (row[0]!='bracket' && row[0]!='key') return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapSimple(row){ return row[1];}\n  },\n\n  //==================================\n\n  TDocs: function (){\n    var that = this,\n        d = that.data;\n\n    var t = that.T.docs, \n        tu = that.T.user_docs;\n\n    // Renderer function for non-_users DBs\n\n    if (d.path[0] != '_users') return function _tdocs (row, i) {\n      return t.assign({\n        id:row.key,\n        idsafe:(row.key+'').escapeHTML(),\n        checked:row._checked,\n        href:that.p2u([d.path[0], row.key]).join('/').escapeHTML(),\n        rev:((row.value||{}).rev+'').escapeHTML()\n      });\n    };\n\n    // Renderer for _users DB\n    return function _tdocs_users (row, i) {\n      var obj = {\n        id:row.key,\n        idsafe:(row.key+'').escapeHTML(),\n        checked:row._checked,\n        href:that.p2u([d.path[0], row.key]).join('/').escapeHTML(),\n        rev:((row.value||{}).rev+'').escapeHTML()\n      };\n      if (row.key.substr(0,17) != 'org.couchdb.user:') return t.assign(obj);\n      // we have user doc\n      return tu.assign(obj);\n    };\n\n  },\n  \n  //==================================\n\n  TMango:function (){\n    var that = this,\n        d = that.data,\n        j2h = that.Pho('j2h');\n\n    var t = that.T.mango,\n        tf = that.T.view_filter;\n\n    // Renderer function\n\n    return function _tmango (row, i) {\n      var limit = that.Rows.length,\n          mapper = limit<120?_mapFull: limit<250?_mapMedium: _mapSimple,\n          chars = limit<40?2000: limit<60?500: limit<120?300: 200,\n          lvl = limit<40?5: limit<60?4: limit<120?3: limit<250?3: 2;\n\n      var v = row.value, s;\n      var a = j2h(v, chars, ['_id','id','name'], lvl);\n      if (a.length==1 && a[0][0]=='short') {\n        if (a[0][1][0] == '{') a[0][1] ='Object '+a[0][1];\n        else if (a[0][1][0] == '[') a[0][1]='Array '+a[0][1];\n      }\n      s = a.map(mapper).join('');\n\n      return t.assign({\n        _idx:row._idx,\n        _idxsafe:row._idxsafe,\n        id:row.key+'',\n        idsafe:row.key+'',\n        href:'',\n        nodoc:'',//row.id?'':'hide',\n        key:i+'',\n        //doc:'',\n        html:s,\n        css:s.length>250?'fs95 lh140 pt3 pb3':'lh140 pt2 pb2'\n      });\n    }\n\n\n    // - - - - - - \n\n    function _mapFull(row){\n      if (!row[0]) return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapMedium(row){\n      if (row[0]!='bracket' && row[0]!='key') return row[1];\n      return '<span class=\"jval-'+row[0]+'\">'+row[1]+'</span>';\n    }\n\n    // - - - - - - \n\n    function _mapSimple(row){ return row[1];}\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532115578530","id": ".$view.F","type": "js","data": "({\n  // GetSec, DelDocs\n\n  //==================================\n\n  GetSec:function(){\n\n    // Runs in _user bucket to get secuirty\n\n    var that = this,\n        all = that.Pho('All'),\n        a = Object.keys(all),\n        dbs = [],\n        now = Date.now();\n\n    a.forEach(function(db){\n      if (!all[db].security || all[db].security.stamp + 3.6e6 < now) dbs.push(db);\n    });\n\n    var pis = that.Pho('$dbs').BatchInfo.call({\n      Pho:that.Pho,\n      Req:that.Req,\n      Batch:{},\n      All:all,\n      Relist:function(){},\n      RelistNow:function(){},\n    }, dbs, that.Pho('Cfg').batchDbInfoDelay, ['security']);\n\n    return Q.all(pis).then(function(){\n      //console.log('Read '+dbs);\n    });\n  },\n\n  //==================================\n\n  DelDocs:function _del_doc (){\n    var that = this,\n        d = that.data,\n        sel = d.selection.slice(0),\n        sl = sel.length,\n        l = that.lang,\n        es = function(s){return (s+'').escapeHTML()},\n        _trunc = function (s, chars) {return es((s+'').truncate(chars || 15,'right','…'));};\n\n    var pi = $.Deferred(),\n        trow = '<div class=\"mb10\">{1}</div>';\n\n    $.my.modal({\n      width:300,\n      manifest:that.Pho('Confirm'),\n      data:{\n        text:[\n          '<div class=\"fs130 red mb5\">'+l.TXT_DEL_TITLE+'</div>',\n          trow.assign(l.TXT_DEL_WARN(sl, _trunc(d.path[0], 25)))\n        ].join(''),\n        yescss:'red',\n        yes:l.BTN_DEL_START,\n        no:l.BTN_CANCEL,\n        cancel:''\n      },\n      css:'lh160 xgray p20 pb25',\n      esc:true,\n      enter:false\n    })\n      .then(function(res){\n      if (res.cmd!='yes') return pi.reject(999, 'Cancelled', 'Cancelled');\n      _delDocs();\n    })\n    .fail(function(){\n      pi.reject(999, 'Cancelled', 'Cancelled');\n    })\n\n\n    return pi.promise();\n\n\n    // - - - - - - - - - - - - \n\n    function _delDocs(){\n\n      var osel = cw.lib.a2o(sel),\n          keys = [],\n          docs = that.Rows.to(+d.limit).filter(function(d){\n            return osel[d.key]\n          }).map(function(row){\n            keys.push(row.key);\n            return {_id:row.key, _rev:row.value.rev, _deleted:true};\n          });\n\n      var req = {\n        url:[d.path[0],'_bulk_docs'],\n        method:'POST',\n        contentType:'application/json',\n        headers:{'X-Couch-Full-Commit':'true'},\n        data: JSON.stringify({docs:docs})\n      };\n\n      return that.Req(req)\n      .then(function(res){\n\n        // parse response\n        var num = res.length,\n            delnum = res.count(function(row){ return !row.error });\n\n        cw.lib.note(l.MSG_DEL_OK( num, delnum, _trunc(d.path[0])), num == delnum?'ok':'error', 5000);\n        if (num>delnum) console.log(res);\n\n        // notify tabs\n        $.my.radio('dbupdate', {db:d.path[0], cmd:'delete', docs:keys});\n        $.my.radio('dblist', [d.path[0]]);\n\n        d.selection.length = 0;\n        \n        // forget deleted ddocs\n        docs.forEach(function(row){\n          if (row._id[0]!='_') return;\n        \tif (that.Ddocs[row._id]) delete that.Ddocs[row._id];\n        });\n\n        // reload view\n        //that.GetView(true);\n        pi.resolve(res);\n      })\n      .fail(function(code, err, msg){\n        // fail to read doc back\n        cw.lib.note(l.MSG_DEL_FAIL.assign(code, es(err)), 'error');\n        return pi.reject(code, err, msg);\n      });\n\n    }\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532297782462","id": ".$view.EdSwitch","type": "js","data": "(function (){\n  var that = this,\n      d = that.data;\n  \n  if (!d.view) {\n    that.Editor.length = 0;\n    return;\n  }\n  \n  // Ddoc view\n  if (d.view.to(2) == '_d') {\n\n    var vi = that.Vi[d.view],\n        eds = that.ViEds;\n    if (!eds[d.view]) {\n      var a = d.view.split('\\ufffd');\n      eds[d.view] = {\n        ddoc:\t\t\ta[0],\n        name:\t\t\ta[1],\n        type:\t\t\t'view',\n        mode:\t\t\t['map'],\n        language:\tvi.type=='js'?'javascript':vi.type,\n        map:\t\t\tvi.view.map||'',\n        reduce:\t\tvi.view.reduce||'',\n        json:\t\t\t{},\n        errors:\t\t[],\n        stamp:\t\tDate.now()\n      }\n    }\n\n    if (that.Editor[0] != eds[d.view]) that.Editor[0] = eds[d.view];\n  }\n\n  // Mango qry\n  if (d.view.to(5) == '_find') {\n    var m = d.mango,\n        qname = d.view.split('\\ufffd')[1] + '',\n        vi = m.query.find(function(e){return e.name == qname});\n    if (!vi) {\n      qname = 'Default query';\n      vi = m.query.find(function(e){return e.name == qname});\n    }\n    m.active = qname;\n    if (!vi.stamp) {\n      vi.stamp = Date.now();\n      vi.text = that.DefaultMangoQry.text;\n    }\n    if (that.Editor[0] != vi) {\n      that.Editor = [vi];\n      vi.json = that.jseval(vi.text);\n      if (!Object.isObject(vi.json)) vi.json = {};\n    }\n  }\n  \n  // Mango index\n  if (d.view.to(4) == '_idx') {\n    \n    var vi = that.Vi[d.view] || Object.clone(that.DefaultMangoIdx, true),\n        eds = that.ViEds;\n    if (!eds[d.view]) {\n      var a = d.view.split('\\ufffd');\n      eds[d.view] = {\n        ddoc:\t\t\t'_design/'+a[0].split('/')[1],\n        name:\t\t\ta[1],\n        type:\t\t\t'index',\n        mode:\t\t\t['javascript'],\n        text:\t\t\tvi.view?vi.view.source: vi.text,\n        json:\t\t\t{},\n        errors:\t\t[],\n        stamp:\t\tDate.now()\n      }\n    }\n\n    if (that.Editor[0] != eds[d.view]) that.Editor[0] = eds[d.view];\n  \t\n  }\n  \n  return that.Editor[0];\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503878743241","id": ".$view.GetView","type": "js","data": "(function _getView(redraw){\n\t\n\t// gets viewdata according to current state,\n\t\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tdb = d.path[0],\n\t\t\tparams = {limit:100, update_seq:true},\n\t\t\tviewname = that.Vi[d.view]?that.Vi[d.view].path:[db, d.view+'' || '_all_docs'],\n      method = 'get',\n      mango = {},\n      isMango = d.view.to(5) == '_find',\n      isIdx = d.view.to(4) == '_idx',\n      body = null,\n\t\t\tpi = $.Deferred(),\n      wasBusy = false,\n\t\t\t_indexRow = that.Index;\n\t\n\tvar recalc = '#state-proxy',\n\t\t\trmethod = 'check'\n\t\n\tvar url = viewname;\n  \n  // We have view or Mango index\n  if (!isMango) {\n\t\n    if (d.reverse) params.descending = true;\n    params.limit = Math.abs(+d.limit) + 1;\n\n    if (d.start) {\n      if (/^_\\d+$/.test(d.start)) params.skip = +d.start.substr(1) || 0;\n      else {\n        var x;\n        try {\n          x = JSON.parse(d.start);\n        }catch(e){}\n        params.startkey = undefined!=x?x:d.start;\n      }\n    }\n\n    if (that.Vi[d.view] && that.Vi[d.view].reduce) {\n      var lvl = d.reduce+'';\n      if (!lvl) params.reduce=false;\n      else if (lvl == 0) params.group = false;\n      else if (lvl == 99) params.group = true;\n      else {\n        // params.group = true;\n        params.group_level = +lvl;\n      }\n    }\n    else if (isIdx) {\n      params.reduce = false;\n      if (d.view.to(6) == '_idx/\\ufffd') viewname[1] = '_all_docs';\n    }\n  }\n  \n  // We have mango qry\n  else {\n    viewname[1] = '_find';\n  \tmethod = 'post';\n    mango = that.Editor[0] \n    \t\t\t\t|| d.mango.query.find(function(e){return e.name == d.view.from(6)}) \n    \t\t\t\t|| d.mango.query.find(function(e){return e.name == 'Default query'});\n    body = JSON.stringify($.extend(true, {}, {\n    \tlimit: Math.abs(+d.limit) + 1,\n      skip: /^_\\d+$/.test(d.start)?+d.start.from(1):0\n    }, mango.json));\n    params = {};\n  }\n\t\n  // Join request params\n\tvar requrl = url.concat([params]);\n\t\n  // Check if we already have this req pending\n\tif (that.Pending[JSON.stringify(requrl)]) return that.Pending[JSON.stringify(requrl)];\n\t\n\t// mark busy\n\t_busy.debounce(100)(true);\n\t\n\t// request data\n\tthat.Pending[JSON.stringify(requrl)] = that.Req({\n    url:\t\trequrl,\n    headers:\t{accept:'application/json','Content-type':'application/json'},\n    method:\tmethod,\n    data:\t\tbody\n  })\n\t.then(function(res){\n\t\t\n\t\tthat.Pending[JSON.stringify(requrl)] = null;\n    that.Error = '';\n\n\t\tif (isMango) pi.resolve(_processMango(res));\n    else if (isIdx) pi.resolve(_processIndex(res))\n    else pi.resolve(_processView(res));\n    \n\t\tif (redraw) {\n\t\t\tthat.my.modal('#btn-viewcode', true);\n\t\t\tthat.my[rmethod](recalc);\n\t\t}\n\t}.debounce(10))\n\t.fail(function(code, err, msg){\n\t\t\n\t\tthat.Pending[JSON.stringify(requrl)] = null;\n\t\t\n\t\tcw.log('Photon failed to read view', db+'/'+viewname, code, err, msg);\n\t\tthat.Result[0] = {\n\t\t\turl:JSON.stringify(requrl),\n\t\t\tcode:code,\n\t\t\tstamp:Date.now()+'',\n\t\t\tok:false,\n\t\t\terror:err,\n\t\t\tmsg:msg\n\t\t};\n    that.Rows = [];\n    that.Error = 'Error '+code +': '+err;\n\t\tpi.resolve(that.Result[0]);\n\t\tif (redraw) that.my[rmethod](recalc);\n\t}.debounce(10))\n\t.always(_busy.fill(false).debounce(10));\n  \n  return pi.promise();\n  \n  // - - - - - - - - - - -\n  \n  function _processView(res){\n  \tres.stamp = Date.now()+'';\n\t\tres.url = url+'';\n\t\tthat.Result[0] = res;\n\t\td.total_rows = res.total_rows || -1;\n\t\td.offset = res.offset || -1;\n\t\td.seq = (res.update_seq || Date.now())+'';\n\t\t\n\t\t//console.time();\n\t\t\n\t\tres.rows.forEach(function(row,i){\n\t\t\trow._vjson = JSON.stringify(Object.reject(row,'key'), null, '  ').from(2);\n\t\t\trow._kjson = '{\\n  \"key\": '+JSON.stringify(row.key)+',\\n';\n\t\t\trow._idx = JSON.stringify([row.key, row.id, i]); \n\t\t\trow._idxsafe = row._idx.escapeHTML();\n\t\t});\n\t\t\n\t\t//console.timeEnd();\n\t\t\n\t\tthat.Rows = (res.rows || []).slice(0);\n\t\td.link = that.Req(requrl, true);\n    return res;\n  }\n  \n  // - - - - - - - - - - -\n  \n  function _processIndex(res){\n  \tres.stamp = Date.now()+'';\n\t\tres.url = url+'';\n\t\tthat.Result[0] = res;\n\t\td.total_rows = res.total_rows || -1;\n\t\td.offset = res.offset || -1;\n\t\td.seq = (res.update_seq || Date.now())+'';\n\t\t\n\t\t//console.time();\n\t\t\n\t\tres.rows.forEach(function(row,i){\n\t\t\trow._vjson = JSON.stringify(row, null, '  ').from(2);\n\t\t\trow._kjson = '{\\n';\n\t\t\trow._idx = JSON.stringify([row.key, row.id, i]); \n\t\t\trow._idxsafe = row._idx.escapeHTML();\n\t\t});\n\t\t\n\t\t//console.timeEnd();\n\t\t\n\t\tthat.Rows = (res.rows || []).slice(0);\n\t\td.link = that.Req(requrl, true);\n    return res;\n  }\n  \n  // - - - - - - - - - - -\n  \n  function _processMango(res){\n  \tres.stamp = Date.now()+'';\n\t\tres.url = url+'';\n\t\tthat.Result[0] = res;\n\t\td.total_rows = -1;\n\t\td.offset = mango.skip || -1;\n\t\td.seq = (res.update_seq || Date.now())+'';\n    \n    var skip = /^_\\d+$/.test(d.start)?+d.start.from(1):0;\n\t\t\n\t\t//console.time();\n\t\tvar a = [];\n\t\tres.docs.forEach(function(row0,i){\n      var row = {\n      \tid: (skip+i)+'',\n        key: (skip+i)+'',\n        value: row0\n      };\n\t\t\trow._vjson = JSON.stringify(row0, null, '  ').from(1);\n\t\t\trow._kjson = '{';\n\t\t\trow._idx = JSON.stringify([skip+i]); \n\t\t\trow._idxsafe = row._idx.escapeHTML();\n      a.push(row);\n\t\t});\n\t\t\n\t\t//console.timeEnd();\n\t\t\n\t\tthat.Rows = (a || []).slice(0);\n\t\td.link = that.Req(requrl, true);\n  \treturn res;\n  }\n  \n\t\n  // - - - - - - - - - - -\n  \n  function _busy(busy){\n    if ((busy && !wasBusy)  || !busy) {\n      if (that.my) that.my.root().toggleClass('app-busy', busy);\n      $.my.radio('appbusy',{id:d.tabid, busy:busy});\n    }\n    wasBusy = true;\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503945963651","id": ".$view.GetViews","type": "js","data": "(function _getViewsList (redraw, silent, onlyMango){\n\n\t// Gets list of all ddocs\n\n\tvar that = this,\n\t\t\td = that.data,\n      isS = Object.isString,\n      isO = Object.isObject,\n      isA = Object.isArray,\n      isF = Object.isFunction,\n\t\t\tdb = d.path[0],\n\t\t\turl = [db,'_all_docs',{startkey:'_design', endkey:'_design0',include_docs:true}],\n\t\t\tviewlist = that.DefaultViews(),\n      indexes = viewlist.find(function(e){return e.text == 'Mango indexes'}),\n\t\t\tvi = {},\n\t\t\tpi = $.Deferred();\n  \n  // Mango sync rebuild\n  if (onlyMango) {\n    viewlist.remove(indexes);\n    that.Views.forEach(function(e){\n    \tif (e.children && (e.text[0] == '_' || e.text.to(5)=='Mango')) viewlist.push(e);\n    });\n    that.Views = viewlist.sortBy(function(e){\n    \treturn (e.order || '') + e.text;\n    });\n  \tif (redraw) {\n\t\t\tthat.my.find('#view-name').select2({data:viewlist, minimumResultsForSearch:12});\n\t\t\tthat.my.recalc('#view-name');\n\t\t}\n    pi.resolve();\n    return viewlist;\n  }\n\t\n  \n  // Read ddocs\n  \n\tthat.Req(url).then(function(res){\n\t\tvar rows = res.rows||[];\n\t\tif (!rows.length && d.view.to(5) != '_find') {\n\t\t\td.view = '';\n\t\t\treturn;\n\t\t}\n\n\t\tvar reerl0 = /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/,\n\t\t\t\treerl1 = /\\.[\\r\\n\\s\\t]*$/;\n\t\t\n    // Start iterating ddocs\n    \n\t\trows.forEach(function(row){\n      \n\t\t\tvar ddoc = row.doc;\n      if (!ddoc) return;\n      \n      var views = ddoc.views || {},\n\t\t\t\t\tv = Object.keys(views),\n\t\t\t\t\tg = {text:row.id, children:[]},\n          vlang = ddoc.language || 'javascript';\n      \n      // Stash ddoc\n      if (!that.Ddocs[ddoc._id] || that.Ddocs[ddoc._id]._rev != ddoc._rev) {\n        that.Ddocs[ddoc._id] = $.extend(true, {}, ddoc);\n      }\n      \n      // skip if no views\n\t\t\tif (!v.length) return;\n      \n\t\t\tv.forEach(function(key){\n\t\t\t\tvar r = views[key];\n        \n        // ==== View index =====\n        \n        if (vlang == 'erlang' || vlang == 'javascript') {\n\t\t\t\t\n          // Detect map\n          if (!isO(r) || !isS(r.map)) return;\n\n          var vid = row.id+'\\ufffd'+key,\n              s0 = {id:vid, text:'\\u00a0\\u00a0'+key},\n              v0 = {path:[db,'_design',row.id.split('/')[1],'_view',key], reduce:false, type:''};\n\n\n          if (\n            /^[\\s\\r\\n\\t]*function[\\S\\s]+\\}[\\s\\r\\n\\t]*$/.test(r.map)\n            || isF(cw.lib.unjson([r.map])[0]) \n          ) v0.type = 'js';\n          else if(reerl0.test(r.map) && reerl1.test(r.map)) {\n            s0.text+= '\\u00a0(Erlang)';\n            v0.type = 'erlang';\n          }\n          else return;\n\n          v0.view = Object.clone(r, true);\n\n          // Detect reduce\n          var red = r.reduce,\n              fold = '';\n          if (isS(red)) {\n            if (red[0] == '_') red = red.from(1);\n            if (red == 'sum') fold = 'Σ';\n            else if (red = 'count') fold = '#';\n            else if (red = 'min') fold = '⊻';\n            else if (red = 'max') fold = '⊼';\n            else if (red = 'stats') fold = '=';\n            else if (red = 'sumsqr') fold = 'Σ²';\n            else if (isF(cw.lib.unjson([red])[0])) fold = 'f';\n            else if (reerl0.test(red) && reerl1.test(red)) fold = 'f\\u00a0(erl)';\n\n            if (fold) {\n              s0.text += '\\u2009•\\u2009'+fold;\n              v0.reduce = true;\n            }\n          }\n          g.children.push(s0);\n          vi[vid] = v0;\n      \t}\n        \n        // ==== Mango index =====\n        \n        else if (indexes && vlang == 'query') {\n          \n          if (\n            !isO(r) || !isO(r.map) || !isO(r.map.fields) \n            || !isO(r.options) || !isO(r.options.def) || !isA(r.options.def.fields)\n          ) return;\n          \n          var ddocid = row.id.split('/')[1],\n              vid = '_idx/'+ddocid+'\\ufffd'+key,\n              s0 = {id:vid, text:'\\u00a0\\u00a0'+key+'\\u00a0in\\u00a0_d/'+ddocid, order:'_1'},\n              v0 = {path:[db,'_design',row.id.split('/')[1],'_view',key], reduce:false, type:''};\n          \n          v0.view = Object.clone(r, true);\n          \n          // Rebuild source\n          var def = r.options.def;\n          v0.view.source = /*v0.view.source ||*/ [\n          \t'({',\n            '\\n\\tindex: {',\n            '\\n\\t\\tfields: [{1}]',\n            def.partial_filter_selector\n              ?',\\n\\t\\tpartial_filter_selector: '\n            \t\t+JSON.stringify(def.partial_filter_selector, null, '\\t')\n            \t\t.lines()\n            \t\t.map(function(e, i){return (i?'\\t\\t':'')+e})\n            \t\t.join('\\n')\n              :'',\n            '\\n\\t},\\n\\tname: {2},\\n\\tddoc: {3},\\n\\ttype: \"json\"',\n            '\\n})'\n          ].join('').assign(\n            def.fields.map(JSON.stringify).join(', '),\n            JSON.stringify(key),\n            JSON.stringify(row.id.split('/').from(1).join('/'))\n          );\n          vi[vid] = v0;\n          \n          indexes.children.push(s0);\n        }\n\t\t\t});\n\t\t\t\n\t\t\t// put in list if any\n\t\t\tif (g.children.length) {\n\t\t\t\tg.children = g.children.sortBy('text');\n\t\t\t\tviewlist.push(g);\n\t\t\t}\n      \n\t\t}); // --- end iterating ddocs\n    \n    // sort views list\n\t\tviewlist = viewlist.sortBy(function(e){\n    \treturn (e.order || '') + e.text;\n    });\n    \n    // sort indexes if any\n    if (indexes) {\n      indexes.children = indexes.children.sortBy(function(e){\n        return (e.order || '') + e.text;\n      });\n    }\n\t})\n\t.fail(function(code, err, msg){\n\t\tcw.log('Photon failed to read ddocs for the bucket', db, code, err, msg);\n\t\tif (!silent) cw.lib.note(that.lang.ERR_GETVIEWS.assign(db), 'error');\n\t})\n\t.always(function(){\n\t\tthat.Views = viewlist;\n\t\tthat.Vi = vi;\n\t\tif (d.view && !vi[d.view] && d.view.to(5)!='_find') {\n\t\t\td.view = '';\n\t\t}\n\t\tif (redraw) {\n\t\t\tthat.my.find('#view-name').select2({data:viewlist, minimumResultsForSearch:12});\n\t\t\tthat.my.recalc('#view-name');\n\t\t}\n\t\tpi.resolve(viewlist);\n\t});\n\t\n\t\n\treturn pi.promise();\n\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503866235518","id": ".$view.ui","type": "js","data": "({\n\t'#view-name':{\n\t\tinit: function($o){\n\t\t\t$o.select2({\n\t\t\t\tdata:this.Views,\n\t\t\t\tminimumResultsForSearch:12\n\t\t\t})\n\t\t},\n\t\tbind:function(d,v) {\n\t\t\tif (v==null) return d.view;\n\t\t\tif (d.view != v) {\n\t\t\t\td.start = '';\n\t\t\t\tthis.Rows = [];\n        this.Error = '';\n        this.Editor = [];\n        if (v.to(5)=='_find' || v.to(4)=='_idx')  d.editor = true;\n        else if (!v) d.editor = false;\n\t\t\t}\n\t\t\td.view = v;\n      \n\t\t\treturn d.view;\n\t\t}\n\t},\n\t\n\t'#view-limit':{\n\t\tinit: function($o){\n\t\t\tvar that = this,\n\t\t\t\t\td = that.data,\n\t\t\t\t\tlim = (Math.abs(+d.limit) || 100).clamp(1,10000);\n\t\t\t$o.select2({\n\t\t\t\tdata:this.Steps.concat([lim]).unique().sortBy().map(function(e){\n\t\t\t\t\treturn {id:'+'+e, text:e+''}\n\t\t\t\t}),\n\t\t\t\tminimumResultsForSearch:1e4\n\t\t\t})\n\t\t},\n\t\tbind:function(d,v) {\n\t\t\tif (v==null) return d.limit;\n\t\t\td.limit = v;\n\t\t\treturn d.limit;\n\t\t}\n\t},\n\t\n\t'#view-startkey':{\n\t\tdelay:50,\n\t\tbind:'start',\n    events:'input.my',\n\t\twatch:['#btn-clear-startkey','#btn-view-plus','#btn-view-minus','#view-name'],\n\t\tcss: {  \"my-search\": /^.{1,}$/  }\n\t},\n\t\n\t'#btn-view-minus':{\n\t\tdelay:1,\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tnewstart = d.start,\n\t\t\t\t\ttr = +d.total_rows,\n\t\t\t\t\tlim = +d.limit,\n\t\t\t\t\tisReduce = that.Vi[d.view] && that.Vi[d.view].reduce && d.reduce+'',\n          isMango = d.view.to(5) == '_find';\n\t\t\tif (!d.start) {\n\t\t\t\tif (tr > lim || isReduce || isMango) newstart = '_'+(tr - lim).clamp(0, 1e12);\n\t\t\t}\n\t\t\telse if (/^_\\d+$/.test(d.start)) {\n\t\t\t\tnewstart = '_'+((+d.start.substr(1)||0)-lim).clamp(0, isReduce || isMango?1e12:tr);\n\t\t\t}\n\t\t\tif (newstart=='_0') newstart = '';\n\t\t\td.start = newstart;\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\treturn (d.start && !/^_\\d+$/.test(d.start)) || (!d.start && that.Rows.length <= +d.limit);\n\t\t\t}\n\t\t},\n\t\twatch:['#view-startkey','#view-limit','#state-proxy']\n\t},\n\t\n\t'#btn-view-plus':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tnewstart = d.start,\n\t\t\t\t\ttr = +d.total_rows,\n\t\t\t\t\tlim = +d.limit,\n\t\t\t\t\tisReduce = that.Vi[d.view] && that.Vi[d.view].reduce && d.reduce+'',\n          isMango = d.view.to(5) == '_find';\n\t\t\tif (!d.start) {\n\t\t\t\tif (tr > lim || isReduce|| isMango) newstart = '_'+lim;\n\t\t\t}\n\t\t\telse if (/^_\\d+$/.test(d.start)) {\n\t\t\t\tvar start = (+d.start.substr(1)||0) + lim;\n\t\t\t\tnewstart = '_'+(start >= tr && !isReduce && !isMango? 0:start);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// we have a key\n\t\t\t\tif (that.Rows.length <= lim) newstart = '';\n\t\t\t\telse newstart = JSON.stringify(that.Rows[lim].key).replace(/^\"|\"$/g,'');\n\t\t\t}\n\t\t\tif (newstart=='_0') newstart = '';\n\t\t\td.start = newstart;\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\treturn !d.start && that.Rows.length <= +d.limit;\n\t\t\t}\n\t\t},\n\t\twatch:['#view-limit','#state-proxy']\n\t},\n\t\n\t'#app-search':{\n\t\tdelay:150,\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return d.search;\n\t\t\tif (v.length < 3) {\n\t\t\t\tthis.fSearch = null;\n\t\t\t\td.search = '';\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\td.search = v;\n\t\t\tthis.fSearch = new RegExp('('+RegExp.escape(v)+')', 'i');\n\t\t\treturn v;\n\t\t},\n\t\tcss: { \t'my-search': /^.{3,}$/ }\n\t},\n \n  '#view-panels':{\n    watch:['#view-name','#btn-viewcode'/*,'#btn-reload'*/],\n    css:{\n      'view-editor':function(d){\n        return !!d.view && !!d.editor;\n      },\n      'view-mango':function(d){\n        return d.view.to(5) == '_find';\n      },\n      'view-index':function(d){\n        return d.view.to(4) == '_idx';\n      }\n    }\n  }\n  \n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1503879579686","id": ".$view.ui","type": "js","data": "({\n\t'#btn-reload':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tthis.GetView(true);\n\t\t\tthis.GetViews(true);\n\t\t},\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){\n\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\tif (!v.name && /^(_users|_replicator)$/.test(d.path[0])) $.my.radio('reload', {id:d.tabid, path:d.path});\n\t\t\t},\n\t\t\tdbupdate:function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (!d.view || !Object.isObject(v) || !(v.cmd == 'write' || v.cmd == 'delete')) return;\n\t\t\t\tif (v.db != d.path[0] || (v.docs||[]).indexOf(d.view.split('\\ufffd')[0]) == -1) return;\n\t\t\t\tthat.GetViews(true);\n\t\t\t}\n\t\t}\n\t},\n\t\n\t\n\t'#btn-view-compact':{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-view-compact', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\tthat.my.modal('#btn-view-compact',{\n\t\t\t\t\tmanifest:that.Pho('Compact'),\n\t\t\t\t\twidth:370,\n\t\t\t\t\tdata:$.extend(\n\t\t\t\t\t\t{ selection:[d.path[0]] }, \n\t\t\t\t\t\tObject.size(that.Vi)?{ddocs:Object.keys(that.Vi).map(function(e){\n\t\t\t\t\t\t\treturn e.split('\\ufffd')[0].split('/')[1]\n\t\t\t\t\t\t}).unique().sort()}:{}\n\t\t\t\t\t),\n\t\t\t\t\talign:'top:102%;',\n\t\t\t\t\tnose:'top',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tesc:true,\n\t\t\t\t\tbound:20\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\t'#btn-view-acl':{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-view-acl', true);\n\t\t\telse {\n\t\t\t\t// Read current sec obj\n\t\t\t\tthat.Req([d.path[0],'_security'])\n\t\t\t\t.then(function(res){\n\t\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\t\tthat.Modals.head = $o;\n\t\t\t\t\tthat.my.modal('#btn-view-acl',{\n\t\t\t\t\t\tmanifest:that.Pho('SecObj'),\n\t\t\t\t\t\twidth:380,\n\t\t\t\t\t\tdata:$.extend(true,{}, { \n\t\t\t\t\t\t\tdbs:[d.path[0]], \n\t\t\t\t\t\t\tadmins:res.admins||{names:[], roles:[]}, \n\t\t\t\t\t\t\tmembers:res.members||{names:[], roles:[]} \n\t\t\t\t\t\t}),\n\t\t\t\t\t\talign:'top:102%;',\n\t\t\t\t\t\tnose:'top',\n\t\t\t\t\t\tcss:'xgray',\n\t\t\t\t\t\tscreen:false,\n\t\t\t\t\t\tesc:true,\n\t\t\t\t\t\tbound:20\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t\t});\n\n\t\t\t\t})\n\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\tcw.lib.note(that.lang.ERR_GETACL, 'error');\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t},\n\t\n\t'#btn-view-newdoc':{\n    init:function($o){\n      var that = this,\n          d = that.data;\n      \n      if (d.path[0] != '_users') return;\n      \n      $o.on('click.my',function(evt){\n        if ($o.data('modal')) {\n          that.my.modal('#btn-view-newdoc', true);\n          return false;\n        }\n        if (that.Modals.head) that.Modals.head.modal(true);\n        that.Modals.head = $o;\n        that.my.modal('#btn-view-newdoc',{\n          manifest:that.Pho('UserDoc'),\n          width:380,\n          data:{},\n          align:'top:102%;left:-147px;',\n          nose:'top',\n          css:'xgray',\n          screen:false,\n          esc:true,\n          focus:true,\n          bound:20\n        })\n        .always(function(){\n          that.Modals.head = null;\n        });\n\n        return false;\n      });\n      \n      $o.html('<span class=\"lh140\">'+that.lang.BTN_NEWDOC_POPUP+'</span>');\n    },\n\t\tdelay:60,\n\t\tbind:function(d,v,$o){\n\t\t\t$o.attr('href','#'+encodeURIComponent(d.path[0])+'/_new');\n\t\t}\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504411643983","id": ".$view.ui","type": "js","data": "({\n\t'#state-proxy':{\n\t\tdelay:20,\n\t\tbind: function(d,v){\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tp = d.path.slice(0);\n\t\t\t\n\t\t\td.path = that.s2p();\n      \n      var cstate = cw.lib.sdbm([d.view, d.start, d.limit, d.reverse, d.reduce+'']);\n\t\t\t\n\t\t\tif ( d.state != cstate ) {\n\t\t\t\t$.my.radio('pathchange', {id:d.tabid, path:d.path, title:that.title()});\n\t\t\t\td.state = cstate;\n        \n        if (!d.view) d.editor = false;\n        \n        if (d.editor) that.EdSwitch();\n        else that.Editor.length = 0;\n        \n        that.GetView(true);\n        that.my.recalc('#view-ed-container');\n\t\t\t}\n\t\t},\n\t\twatch:['#view-startkey','#view-name','#view-limit','#btn-view-dir','#view-reduce'],\n\t\tlisten:{\n\t\t\tdbupdate:function(d,v){\n\t\t\t\tvar db;\n\t\t\t\tif (Object.isObject(v)) db = v.db;\n\t\t\t\telse db = v+'';\n\t\t\t\tif (db!=d.path[0]) return;\n        var that = this;\n        // check should we rebuild view list\n        if ((v.docs || []).find(/^_design/)) {\n        \tv.docs.forEach(function(id){\n          \tif (that.Ddocs[id]) delete that.Ddocs[id];\n          });\n          that.GetViews(true)\n          that.GetView(true);\n        }\n\t\t\t\telse that.GetView(true);\n\t\t\t},\n\t\t\tdbdeleted:function(d,v){\n\t\t\t\tif (v!=d.path[0]) return;\n\t\t\t\tvar that = this;\n\t\t\t\t(function(){\t\n\t\t\t\t\tthat.my.root().trigger('tabclose', {tabid:d.tabid, enforce:true});\n\t\t\t\t}).debounce(Number.random(10,50))();\n\t\t\t}\n\t\t}\n\t},\n  \n  '#view-req-error':{\n    bind: function(d){return this.Error.escapeHTML();},\n  \tcss:{\n    \thide: function(){return !this.Error}\n    },\n    watch:['#state-proxy']\n  },\n  \n  '#view-ed-container':{\n    delay:100,\n  \tinit: function($o){},\n    bind:\t'this.Editor',\n    manifest:function(d){\n      if (d.type == 'view')  return this.Pho('ViewEd');\n      if (d.type == 'index') return this.Pho('IndexEd');\n      return this.Pho('MangoEd');\n    },\n    list:\t'<div></div>',\n    id:\t\t['name','type','ddoc','rev'],\n    watch:['#btn-viewcode']\n  },\n\t\n\t'#view-results':{\n\t\tinit: function($o){\n\t\t\tvar that = this,\n\t\t\t\t\ttdocs = that.TDocs,\n\t\t\t\t\ttmap = that.TMap,\n          tmango = that.TMango,\n\t\t\t\t\td = that.data;\n\t\t\t// init list manager\n\t\t\t$o.list({\n\t\t\t\tdata:that.Rows.to(+d.limit),\n\t\t\t\tdelay:0,\n\t\t\t\tchunk:50,\n\t\t\t\tsortBy:null,\n\t\t\t\tid: function(e){return e._idx},\n\t\t\t\thash:function(e) {\n\t\t\t\t\tvar h = cw.lib.sdbm([  d.view, d.seq, that.Rows.length, e._checked, d.search.length>1?d.search:' ' ]);\n\t\t\t\t\treturn h;\n\t\t\t\t},\n\t\t\t\ttemplate: function(e, i){ \n\t\t\t\t\tvar h = d.view==''?tdocs(e, i):d.view.to(5)=='_find'?tmango(e, i):tmap(e, i); \n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// init nicescroll\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n        //preservenativescrolling: false,\n\t\t\t});\n\t\t\t\n\t\t\t// append prewrapped\n\t\t\t$o.on('click.my','.col-vals', function(evt){\n\t\t\t\tvar $a = $(evt.currentTarget),\n\t\t\t\t\t\tkey = $a.parent().data('key'),\n\t\t\t\t\t\tskey = Object.isString(key)?key:JSON.stringify(key),\n\t\t\t\t\t\thold  = '',\n\t\t\t\t\t\ts, row,\n\t\t\t\t\t\t$e, ed;\n\t\t\t\tif (!$a.is('.col-json')) {\n\t\t\t\t\trow = (that.Rows || []).find(function(e){\n\t\t\t\t\t\treturn e._idx == skey;\n\t\t\t\t\t});\n\t\t\t\t\tif (!row) return false;\n\n\t\t\t\t\ts = row._index;\n\n\t\t\t\t\t$a.addClass('col-json');\n\n\t\t\t\t\tif (!$a.find('>.col-ed-close').length) {\n\t\t\t\t\t\t$e = $(\n\t\t\t\t\t\t\t'<div class=\"col-ed pre fs85 lh120 pl4\">'\n\t\t\t\t\t\t\t+row._kjson.escapeHTML()\n\t\t\t\t\t\t\t+(!that.fSearch\n\t\t\t\t\t\t\t\t?row._vjson.escapeHTML()\n\t\t\t\t\t\t\t\t:row._vjson.replace(that.fSearch, '\\ufff1$1\\ufff0')\n\t\t\t\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t\t\t\t.replace('\\ufff1','<span class=\"view-found\">')\n\t\t\t\t\t\t\t\t.replace('\\ufff0','</span>'))\n\t\t\t\t\t\t\t+'</div>'\n\t\t\t\t\t\t).appendTo($a);\n\t\t\t\t\t\t$a.append('<div class=\"col-ed-close fs130 lh130\" title=\"'+that.RT('lang').TIP_CLOSEJSON+'\">✕</div>');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Close CM on X click\n\t\t\t$o.on('click.my','.col-ed-close', function(evt){\n\t\t\t\t$(evt.currentTarget).parent().removeClass('col-json');\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\t\tdelay:10,\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tre;\n\t\t\tif (!d.view) {\n\t\t\t\tvar osel = cw.lib.a2o(d.selection);\n\t\t\t\tthat.Rows.forEach(function(row){row._checked = osel[row.key]?'checked':''});\n\t\t\t}\n\t\t\tif (d.search.length > 2 && (re = that.fSearch)) {\n\t\t\t\tthat.fRows = that.Rows.to(+d.limit).filter(function(row){ return re.test(row._kjson) || re.test(row._vjson); });\n\t\t\t\t$o.list('data', that.fRows);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.fRows = null;\n\t\t\t\t$o.list('data', that.Rows.to(+d.limit));\n\t\t\t}\n\t\t},\n\t\twatch:['#state-proxy','#view-hasselection','#btn-select','#app-search']\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504555070303","id": ".$view.ui","type": "js","data": "({\n\t'#btn-view-dir':{\n\t\tbind: function(d,v){\n\t\t\tif (v!=null) d.reverse = !d.reverse;\n\t\t\treturn !d.reverse?'▲':'▼';\n\t\t},\n\t\tevents:'click.my'\n\t},\n\t\n\t'#view-cols':{\n\t\tdelay:30,\n\t\tbind:function(d,v){\n\t\t\treturn this.lang.TXT_MAPVIEW(\n\t\t\t\tMath.min(this.Rows.length, +d.limit), \n\t\t\t\td.total_rows==-1 || d.view.to(5)=='_find'?'unknown':d.total_rows,\n\t\t\t\td.search.length > 2 && this.fRows? this.fRows.length:null\n\t\t\t)\n\t\t},\n\t\twatch:['#view-results','#state-proxy']\n\t},\n\t\n\t'#view-links':{\n\t\tbind: function(d,v){\n\t\t\tvar that = this,\n\t\t\t\t\tt = '<a class=\"tdn\" href=\"#{1}\">{2}</a>',\n\t\t\t\t\tp = d.path,\n\t\t\t\t\tview = d.view.split('\\ufffd');\n\t\t\t\n      // All docs\n\t\t\tif (!d.view) return [p[0].escapeHTML(),'/','<span class=\"xgray\">_all_docs</span>'].join('\\u2009')+' | ';\n      \n      // Mango qry\n      if (d.view.to(5) == '_find') return [\n        t.assign( p[0], p[0].escapeHTML() ),\n        '/',\n        '<span class=\"xgray\">_find</span>'\n      ].join('\\u2009');\n      \n      // Default index\n      if (d.view.to(6) == '_idx/\\ufffd') return [\n\t\t\t\tt.assign( p[0], p[0].escapeHTML() ),\n\t\t\t\t'/',\n\t\t\t\t'_all_docs'\n\t\t\t].join('\\u2009') + ' | ';\n      \n      // Index\n      if (d.view.to(4) == '_idx') return [\n\t\t\t\tt.assign( p[0], p[0].escapeHTML() ),\n\t\t\t\t'/',\n\t\t\t\tt.assign( p[0]+'/_design'+view[0].from(4), ('_design'+view[0].from(4)).escapeHTML() )\n\t\t\t].join('\\u2009') + ' | ';\n      \n      // View\n\t\t\treturn [\n\t\t\t\tt.assign( p[0], p[0].escapeHTML() ),\n\t\t\t\t'/',\n\t\t\t\tt.assign( p[0]+'/'+view[0], view[0].escapeHTML() )\n\t\t\t].join('\\u2009') + ' | ';\n\t\t},\n\t\twatch:['#view-results','#state-proxy']\n\t},\n\t\n\t'#view-reduce':{\n\t\tdelay:10,\n\t\tinit: function($o){\n\t\t\t$o.tags({\n\t\t\t\ttags:[[\n\t\t\t\t\t{'Group none':'0'},\n\t\t\t\t\t{'\\u2009L1\\u2009':'1'},\n\t\t\t\t\t{'\\u2009L2\\u2009':'2'},\n\t\t\t\t\t{'\\u2009L3\\u2009':'3'},\n\t\t\t\t\t{'\\u2009L4\\u2009':'4'},\n\t\t\t\t\t{'\\u2009L5\\u2009':'5'},\n\t\t\t\t\t//{'\\u2009L6\\u2009':'6'},\n\t\t\t\t\t//{'\\u2009L7\\u2009':'7'},\n\t\t\t\t\t{'Exact':'99'}\n\t\t\t\t]],\n\t\t\t\tempty:{'No reduce':''},\n\t\t\t\tgroupshim:'',\n\t\t\t\ttagshim:''\n\t\t\t})\n\t\t},\n\t\tbind:'reduce',\n\t\tcss:{\n\t\t\t'self:hide':function(d,v){\n\t\t\t\treturn !this.Vi[d.view] || !this.Vi[d.view].reduce;\n\t\t\t}\n\t\t},\n\t\twatch:'#view-name'\n\t},\n\t\n\t'#btn-anchor':{\n\t\tdelay:10,\n\t\tbind:function(d,v,$o){\n\t\t\tvar a = $o.attr('href');\n\t\t\tif (a!=d.link) $o.attr('href', d.link);\n\t\t},\n\t\twatch:'#state-proxy',\n    css:{\n    \thide: function(d){return d.view.to(5)=='_find'}\n    }\n\t},\n\t\n\t'#btn-select':{\n\t\tdelay:50,\n\t\tbind:function(d,v){\n\t\t\tif (!!d.view ) return '';\n\t\t\tvar that = this,\n\t\t\t\t\tall = that.Rows.to(+d.limit),\n\t\t\t\t\tlist = all.map(function(e){return e.id;}),\n\t\t\t\t\tsel = d.selection.intersect(list),\n\t\t\t\t\tsl = sel.length,\n\t\t\t\t\tl = that.lang,\n\t\t\t\t\tt;\n\t\t\t\n\t\t\tif (v!=null) {\n\t\t\t\t// unselect\n\t\t\t\tif (sl) d.selection = d.selection.subtract(list).unique();\n\t\t\t\t// select\n\t\t\t\telse d.selection = d.selection.concat(list).unique();\n\t\t\t\t\n\t\t\t\tsel = d.selection.intersect(list);\n\t\t\t\tsl = sel.length;\n\t\t\t}\n\n\t\t\tif (sl) t = l.TXT_UNSELECT.assign(sel.length == all.length?l.TXT_SELECT_ALL:sl);\n\t\t\telse t = l.TXT_SELECT.assign(list.length == all.length?l.TXT_SELECT_ALL:l.TXT_SELECT_FILTERED);\n\t\t\t\n\t\t\treturn t;\n\t\t},\n\t\tevents:'click.my',\n\t\tcss:{\n\t\t\thide:function(d,v){return !!d.view || !this.Rows.length}\n\t\t},\n\t\twatch:['#view-hasselection','#state-proxy']\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1507168846206","id": ".$view.ui","type": "js","data": "({\n\n  '#view-hasselection':{\n    delay:10,\n    css: {\n      hide:function(d){\n        return !!d.view || !d.selection.intersect(this.Rows.to(+d.limit).map(function(row){return row.key;})).length;\n      }\n    },\n    watch:['#view-name','#btn-select']\n  },\n\n  '#btn-view-deldocs':{\n    delay:20,\n    bind: function(d,v){\n      var that = this;\n      if (v==null) return;\n\n      // mark busy\n      that.my.root().addClass('app-busy');\n      $.my.radio('appbusy',{id:d.tabid, busy:true});\n      \n      // if we have copy modal, close it\n      var $copy = that.my.find('#btn-view-copydocs');\n      if ($copy.data('modal')) $copy.modal(true);\n      \n      // del attempt\n      that.DelDocs()\n      .always(function(){\n        $.my.radio('appbusy',{id:d.tabid, busy:false});\n        that.my.root().removeClass('app-busy');\n      });\n    }\n  },\n\n  '#btn-view-copydocs':{\n    bind: function(d,v){\n      if (v==null) return;\n      var that = this,\n          $o = that.my.find('#btn-view-copydocs');\n      if ($o.data('modal')) {\n        $o.modal(true);\n        return;\n      }\n      $o.modal({\n        root:that.my.root(),\n        manifest:$.extend(\n          true, {}, \n          that.Pho('NewSync'), \n          {\n            DBs:Object.keys(that.Pho('All')).sortBy(function(e){return e[0]=='_'?'zzz'+e:e;}),\n            params:{width:500},\n            ui:{\n              '#rsource':\t\t{css:{'hide':function(){return true;}}},\n              '#rfilter':\t\t{css:{'hide':function(){return true;}}},\n              '#rmode':\t\t\t{css:{'hide':function(){return true;}}},\n              '#btn-clear':\t{css:{'self:hide':function(){return true;}}}\n            },\n            lang:{en:{\n              TXT_TITLE:'New one-time replication',\n              BTN_START:'Replicate docs',\n            }}\n          }\n        ),\n        data:{\n          source:d.path[0],\n          doc_ids:d.selection.slice(0)\n        },\n        focus:'#rtarget',\n        nose:'top',\n        align:'top:103%',\n        css:'xgray',\n        bound:0\n      });\n    },\n    css:{\n      ':disabled':function(d,v){return !cw.me();}\n    },\n    listen:{\n      userCtx:function(d,v){this.my.check('#btn-view-copydocs');}\n    }\n  },\n\n  '#btn-viewcode':{\n    bind:function(d,v,$o){\n      var that = this;\n      if (v==null || !d.view) return;\n      that.EdSwitch();\n      d.editor = true;\n    },\n    css:{\n      hide:function(d){return !!d.editor || ! d.view}\n    },\n    events:'click.my',\n    watch:['#view-name']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1505086021269","id": ".$view.T","type": "js","data": "({\n\tview:[\n\t\t'<div class=\"view-row\" data-key=\"{_idxsafe}\">',\n\t\t\t'<div class=\"col-ids\">',\n\t\t\t\t'{idsafe}',\n\t\t\t\t//'<a href=\"#{href}\" class=\"tdn\">{id}</a>',\n\t\t\t\t'<div class=\"view-tofilter pseudolink view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter\"></span></div>',\n\t\t\t\t'<div class=\"view-hoverbtn {nodoc}\">',\n\t\t\t\t\t'<a href=\"#{href}\" class=\"tdn\"><span class=\"fi-page-filled\"></span></a>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"col-vals {css}\"><div class=\"col-trim\">{html}</div></div>',\n\t\t'</div>'\n\t].join(''),\n\t\n\tview_filter:[\n\t\t'<div class=\"view-row\" data-key=\"{_idxsafe}\">',\n\t\t\t'<div class=\"col-ids\">',\n\t\t\t\t'{idsafefilter}',\n\t\t\t\t//'<a href=\"#{href}\" class=\"tdn\">{id}</a>',\n\t\t\t\t'<div class=\"view-tofilter pseudolink view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter\"></span></div>',\n\t\t\t\t'<div class=\"view-hoverbtn {nodoc}\">',\n\t\t\t\t\t'<a href=\"#{href}\" class=\"tdn\"><span class=\"fi-page-filled\"></span></a>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"col-vals {css}\"><div class=\"col-trim\">{html}</div></div>',\n\t\t'</div>'\n\t].join(''),\n  \n  mango:[\n\t\t'<div class=\"view-row\" data-key=\"{_idxsafe}\">',\n\t\t\t'<div class=\"col-ids\">{idsafe}</div>',\n\t\t\t'<div class=\"col-vals {css}\"><div class=\"col-trim\">{html}</div></div>',\n\t\t'</div>'\n\t].join(''),\n\t\n\tdocs:[\n\t\t'<div class=\"w100p view-row pt3\">',\n\t\t\t'<input class=\"w23 dib tac ml4 mr1 pt2\" type=\"checkbox\" name=\"docs-selection\" {checked} value=\"{idsafe}\">',\n\t\t\t'<div class=\"w40p-30 pr20\">',\n\t\t\t\t'<a href=\"#{href}\" class=\"tdn\">{idsafe}</a>',\n\t\t\t\t'<div class=\"view-tofilter view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter o50 blue\"></span></div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w60p pr10\">{rev}</div>',\n\t\t'</div>'\n\t].join(''),\n  \n  user_docs:[\n\t\t'<div class=\"w100p view-row pt3\">',\n\t\t\t'<input class=\"w23 dib tac ml4 mr1 pt2\" type=\"checkbox\" name=\"docs-selection\" {checked} value=\"{idsafe}\">',\n\t\t\t'<div class=\"w40p-30 pr20\">',\n\t\t\t\t'<a href=\"#{href}\" class=\"tdn\">{idsafe}</a>',\n\t\t\t\t'<div class=\"view-tofilter view-hoverbtn ml5\" data-filter=\"{idsafe}\"><span class=\"fi-filter o50 blue\"></span></div>',\n    \t\t'<div class=\"view-edituser view-hoverbtn\" data-user=\"{idsafe}\"><span class=\"fi-torso o50 fs110 blue\"></span></div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w60p pr10\">{rev}</div>',\n\t\t'</div>'\n\t].join('')\n  \n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1503887520700","id": ".$view.HTML","type": "js","data": "([\n\t'<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\">',\n\t\t\n\t\t\t// search\n\t\t'<div class=\"fr w12p fs95\">',\n\t\t\t'<div class=\"fi-magnifying-glass xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>',\n\t\t\t'<input type=\"text\" id=\"app-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" '\n\t\t\t\t+'placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\">',\n\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"'\n\t\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').blur()\"></span>',\n\t\t'</div>',\t\n\t\t\n\t\t'<div class=\"nw dib vat\" style=\"width:calc(35% + 230px);\">',\n\t\t\n\t\t\t// reload\n\t\t\t'<button id=\"btn-reload\" class=\"w40 mr2\" title=\"{TIP_RELOAD}\"><span class=\"fi-loop\"></span></button>',\n\t\t\n\t\t\t// view name\n\t\t\t'<div class=\"dib vat mr2 bolder\" style=\"width:calc((100% - 204px) / 2 + 16px);\">',\n\t\t\t\t'<input id=\"view-name\" type=\"text\" class=\" w100p fs110 vat\">',\n\t\t\t'</div>',\n\t\t\n\t\t\t// startkey\n\t\t\t'<div class=\"fs95 dib vat\" style=\"width:calc((100% - 204px) / 2);\">',\n\t\t\t\t'<div class=\"fi-filter xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 6px;top: 0.2em;\"></div>',\n\t\t\t\t'<input id=\"view-startkey\" type=\"text\" class=\"vat ui-search w100p\" placeholder=\"{PLC_STARTKEY}\" '\n\t\t\t\t\t+'style=\"background-image:none;padding-right:17px!important;padding-left:19px!important;border-radius:2px!important;\">',\n\t\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue w15 pl2 ui-search-clear\" style=\"margin-left:-15px!important;\"'\n\t\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').trigger(\\'input\\')\"></span>',\n\t\t\t'</div>',\n\t\t\n\t\t\t// buttons left-right\n\t\t\t'<span class=\"buttons ml2\">',\n\t\t\t\t'<button id=\"btn-view-minus\" class=\"w2em mr2 pl0 pr0\" title=\"{TIP_SHIFT_MINUS}\">',\n\t\t\t\t\t'<span class=\"fi-arrow-left o80\"></span>',\n\t\t\t\t'</button>',\n\t\t\t\t'<button id=\"btn-view-plus\" class=\"w2em mr2 pl0 pr0\" title=\"{TIP_SHIFT_PLUS}\">',\n\t\t\t\t\t'<span class=\"fi-arrow-right o80\"></span>',\n\t\t\t\t'</button>',\n\t\t\t'</span>',\n\t\t\n\t\t\t// limit\n\t\t\t'<div class=\"dib vat w65\"><input id=\"view-limit\" type=\"text\" class=\" w100p fs110 vat\"></div>',\n\t\t'</div>',\n\t\t\n\t\t// Doc(s) action buttons\n\t\t'<div class=\"nw pl5 dib vat\" style=\"width:calc(53% - 250px);\">',\n\t\t\n\t\t\t//newdoc\n\t\t\t'<a href=\"\" id=\"btn-view-newdoc\" class=\"button fs100 tdn dib green vat mr2\"><span class=\"lh140\">{BTN_NEWDOC}</span></a>',\n\t\t\n\t\t\t// group action buttons\n\t\t\t'<span id=\"view-hasselection\" class=\"hide\">',\n\t\t\t\t'<button id=\"btn-view-copydocs\" class=\"mr2\" xdisabled>{BTN_COPYDOCS}</button>',\n\t\t\t\t'<button id=\"btn-view-deldocs\" class=\"mr2 red\">{BTN_DELDOCS}</button>',\n\t\t\t'</span>',\n\t\t\n\t\t\t// DB-related actions\n\t\t\t'<span id=\"view-noselection\">',\n\t\t\t\t'<button id=\"btn-view-acl\" class=\"mr2\">{BTN_ACL}</button>',\n\t\t\t\t'<button id=\"btn-view-compact\" class=\"mr10\">{BTN_COMPACT}</button>',\n\t\t\t'</span>',\n\t\t'</div>',\n\n\t'</div>',\n  \n  '<section id=\"view-panels\" class=\"w100p pt16 pl20 pr20\">',\n  \n  \t// Query editor\n\t\t'<section id=\"view-ed-container\" id=\"view-mango\" class=\"vat panelheight-32 br2 bas mr20\" style=\"outline:none;\">',\n  \t\t//'<section id=\"view-mango-ed-container\" class=\"panelheight-32 gray-1\" style=\"outline:none;\">',\n  \t\t//'</section>',\n  \t'</section>',\n  \n  \t// View result\n    '<div id=\"view-panel\" class=\"dib vat panelheight-32 br2 bas\">',\n      '<div class=\"h30 bg-gray7 bbs lh160 pt1 nw oh ell\">',\n        '<div class=\"hcolw1 dib vat nw oh ell\">',\n            '<span id=\"btn-view-dir\" class=\"dib pl8 pr6 mr2 vat cp o50 fs80 pt2 pseudolink tdn h30\"></span>',\n            '<div id=\"view-cols\" class=\"dib vat nw xgray\"></div>',\n            '<div id=\"btn-select\" class=\"pseudolink tdn dib vat ml15 hide\"></div>',\n            '<div id=\"btn-viewcode\" class=\"pseudolink tdn dib vat ml15 hide\">{BTN_VIEWCODE}</div>',\n        '</div>',\n        '<div class=\"hcolw2 dib gray fs90\">',\n          '<span class=\"gray fr pr8 w35p ell tar\">',\n            '<span id=\"view-links\"></span>',\n            '<a href=\"\" id=\"btn-anchor\" class=\"tdn o70 dib vat mt1 mb-1\" target=\"_blank\" title=\"{TIP_ANCHOR}\">',\n              '<span class=\"fi-anchor\"></span>',\n            '</a>',\n          '</span>',\n          '<span id=\"view-reduce\" class=\"dib vat pl7 hide\"></span>',\n        '</div>',\n      '</div>',\n  \t\t'<div id=\"view-req-error\" class=\"w100p hide red1 tac\" style=\"position:absolute;top:50px;left:0;\"></div>',\n      '<section id=\"view-results\" class=\"panelheight-64 gray-1 lh170\" style=\"outline:none;\"></section>',\n    '</div>',\n  \n  '</section>',\n  \n\t'<div id=\"state-proxy\" class=\"hide\"></div>'\n].join(''))","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1504554862784","id": ".$view.style","type": "js","data": "({\n\t\n\t' #view-noselection':'display:none;',\n\t' #view-hasselection.hide+#view-noselection':'display:inline-block;',\n  \n  ' #view-panels':{\n    '':{\n    \t' #view-panel':'width:100%;',\n      ' #view-ed-container':'display:none;width:35%;',\n      ' .hcolw1':'width:35%;',\n      ' .hcolw2':'width:65%;'\n    },\n  \t'.view-editor':{\n    \t' #view-panel':'width:calc(60% - 20px);',\n      ' #view-ed-container':'width:40%; display:inline-block; ',\n      ' .hcolw1':'width:25%;',\n      ' .hcolw2':'width:75%;'\n    },\n    '.view-editor.view-mango':{\n      ' #view-panel':'width:calc(65% - 20px);',\n      ' #view-ed-container':'width:35%; display:inline-block;'\n    },\n    '.view-mango':{\n      ' #view-results' :{\n        ' .col-ids':'width:7%;padding:3px 2px 3px 7px;',\n        ' .col-vals':'width:93%; padding-left:5px;',\n      },\n      ' #btn-view-dir':'display:none!important;',\n      ' #view-cols':'padding-left:6px;'\n    },\n    '.view-editor.view-index':{\n      ' #view-panel':'width:calc(65% - 20px);',\n      ' #view-ed-container':'width:35%; display:inline-block;',\n    },\n    '.view-index':{\n      ' #btn-view-dir':'display:none!important;',\n      ' .view-tofilter':'display:none!important;',\n      ' #view-cols':'padding-left:6px;'\n    }\n  },\n\t\n\t' #view-results':{\n\t\t'':'line-height:1.4em;',\n\t\t' .view-row':'min-height:1.9em;',\n\t\t' .view-row:nth-child(2n+0)':'background-color:rgba(206, 214, 226, 0.2);',\n\t\t\n\t\t' .view-hoverbtn':'display:inline-block;width:20px;line-height:1.2em;'\n\t\t\t\t+'opacity:0;transition:opacity 0.5s;text-align:center;cursor:pointer;',\n\t\t' .view-row:hover .view-hoverbtn':'opacity:0.5;',\n    ' .view-row:hover .view-hoverbtn:hover':'opacity:0.8;',\n    ' .view-hoverbtn.hover':'opacity:0.7;',\n\t\t\n\t\t' .view-row>div':'display:inline-block;vertical-align:top;word-wrap: break-word;',\n\t\t\n\t\t' input:checked+div':'font-weight:bolder',\n\t\t' .col-ids':'width:35%;padding:3px 20px 3px 8px;',\n\t\t' .col-vals':{\n\t\t\t'':'width:65%; padding-left:10px;',\n\t\t\t' .col-trim':'cursor:pointer',\n\t\t\t' .col-ed':'display:none;',\n\t\t\t' .col-ed-close':'display:none;',\n\t\t\t'.col-json':{\n\t\t\t\t'':'padding:0 0 0 6px!important;word-wrap:normal;',\n\t\t\t\t' .CodeMirror':'background:none;font-size:12px!important;line-height:15px!important;',\n\t\t\t\t'>div.col-trim':'display:none;',\n\t\t\t\t'>div.col-ed':'display:block;',\n\n\t\t\t\t'>div.col-ed-close':{\n\t\t\t\t\t'':'display:block;cursor:pointer;text-align:right;position:absolute;top:0;right:5px;'\n\t\t\t\t\t+'width:95%;height:21px;z-index:+2;transition:color 0.5s; color:rgba(41,109,166,0.75);',\n\t\t\t\t\t':hover':'color:#12a5dc;'\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t' .w40p-30':'width:calc(40% - 30px);'\n\t\t\n\t},\n\t' .bbs':'border-bottom-color:rgba(211,217,222,0.7)',\n\t' .bas':'border-color:rgba(211,217,222,0.7)',\n\t' .brs':'border-right:1px solid rgba(211,217,222,0.7)',\n\t\n\t' .view-found':'background-color:rgba(255,232,121,0.94);border-radius:2px;',\n\t' .my-modal-form .CodeMirror-scroll':'min-height:150px;max-height:calc(20 * 16px + 6px);',\n\t' .my-modal-form .CodeMirror':{\n\t\t'':'min-height:150px;height:auto;font-size:13px!important',\n\t\t\t' .CodeMirror-lines':'line-height:17px!important;',\n\t\t\t' .cm-property':'color:#434e5d;',' .cm-variable':'color:#33bfad;',' .cm-keyword':'color:#90259e;' \n\t}\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1504214131855","id": ".$dbs","type": "js","data": "// DB list\n({\n\tid:'cw.Photon.$dbs',\n\t\n\tlang:{},\n\thash:function(){return 'list';},\n\ttitle:function(){  return 'DB list and tasks'; },\n\t\n\tdata:{\n\t\treverse:false,\n\t\tsearch:'',\n\t\tselection:[],\n\t\t\n\t\ttask:{\n\t\t\tsearch:'',\n\t\t\tfilter:[''],\n\t\t\tlist:[],\n      selection:[],\n      seq:0\n\t\t},\n\t\tservice:{version:''}\n\t},\n\t\n\tAll:{},\n\tList:[],\n\tBatch:{}, //batch actions to go\n\tTasks:[], // tasks list\n\t\n\tRT: function(key){\n\t\treturn null==key?this:Object.isArray(key)?cw.lib.getref(this,key):this[key];\n\t},\n\t\n\tModals:{},\n\tTaskLoop:false,\n\tTaskLoopInterval:false,\n\tLastSync:{},\n\t\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\tthat.RelistNow = that.Relist.debounce(10);\n\t\tthat.Relist = that.Relist.throttle(100);\n    \n    that.Arrows = that.Arrows.split('\\n\\n');\n\t\t\n\t\t$o.html(that.HTML.assign(that.lang));\n\t\t\n\t\t// init db selection\n\t\t$o.on('click.my','input[name=\"db-selection\"]', function(){\n\t\t\tvar v = [],\n\t\t\t\t\t$f = $o.find('input[name=\"db-selection\"]');\n\t\t\t$f.each(function () {\n\t\t\t\tvar $x = $(this);\n\t\t\t\tif ($x.is(\":checked\")) v.push($x.val());\n\t\t\t});\n\t\t\td.selection = v;\n\t\t\tthat.my.check('#view-hasselection');\n\t\t});\n    \n    // init task selection\n\t\t$o.on('click.my','input[name=\"task-selection\"]', function(evt){\n\t\t\tvar v = [],\n\t\t\t\t\t$f = $o.find('input[name=\"task-selection\"]'),\n          id = $(evt.target).val();\n\t\t\t$f.each(function () {\n\t\t\t\tvar $x = $(this);\n\t\t\t\tif ($x.is(\":checked\")) v.push($x.val());\n\t\t\t});\n\t\t\td.task.selection = v;\n      (that.Tasks.find(function(e){return e.replication_id == id}) || {})._selected = v.indexOf(id)>-1;\n\t\t\tthat.my.check('#task-list');\n\t\t});\n\t\t\n\t\t// init ACL\n\t\t$o.on('click.my', '#btn-dbacl', function(evt){\n\t\t\tvar $b = $(evt.currentTarget),\n\t\t\t\t\tdb = $b.data('db');\n\t\t\tthat.Req([db,'_security'])\n\t\t\t.then(function(res){\n\t\t\t\t$b.modal({\n\t\t\t\t\troot:$o,\n\t\t\t\t\tmanifest:that.Pho('SecObj'),\n\t\t\t\t\tdata:{\n\t\t\t\t\t\tdbs:[db], \n\t\t\t\t\t\tadmins:res.admins||{names:[], roles:[]}, \n\t\t\t\t\t\tmembers:res.members||{names:[], roles:[]} \n\t\t\t\t\t},\n\t\t\t\t\twidth:380,\n\t\t\t\t\tbound:0,\n\t\t\t\t\tnose:'left',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\talign:'left:70%;top:-46px;',\n\t\t\t\t\tscreen:'rgba(255,255,255,0)',\n\t\t\t\t\tesc:true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\t\n\t\t$o.then(function(){\n\t\t\tthat.Req({url:[], dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\t$.extend(true, that.data.service, res);\n\t\t\t\tthat.my.check('#btn-logs');\n\t\t\t});\n\t\t}.debounce(200));\n\t\t\n\t\treturn that.GetList(true)\n\t\t.then(function(){\n\t\t\t// read task initially\n\t\t\tthat.TaskLoopInterval = that.Pho('Cfg').loopActiveTasks;\n\t\t\tthat.GetTasks(true);\n\t\t\t// start poll\n\t\t\tthat.RestartPoll();\n\t\t\t\n\t\t});\n\t\t\n\t},\n\t\n\tRelist: function(){\tthis.my.check('#db-proxy'); },\n\t\n\tGetList:function (redraw, subset){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\treturn that.Pho('GetList')()\n\t\t.then(function(){\n\t\t\tthat.All = that.Pho('All');\n\t\t\tif (redraw) that.Relist();\n\t\t\tthat.BatchInfo(subset || Object.keys(that.All), that.Pho('Cfg').batchDbInfoDelay);\n\t\t});\n\t},\n\t\n\tui:{},\n\t\n\tdie: function($o){\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#db-list').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t\tvar f = $o.find('#task-list').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t\t\n\t\t// stop tasks loop\n\t\tif (this.TaskLoop) this.TaskLoop.cancel();\n\t\t\n\t},\n\t\n\tRow: [\n\t\t'<div class=\"view-row\">',\n\t\t\t'<input class=\"w23 dib tac ml3 mr2 cp\" type=\"checkbox\" name=\"db-selection\" {checked} value=\"{namesafe}\">',\n\t\t\t'<div class=\"w100p-338 mh19em\">',\n\t\t\t\t'<div id=\"btn-dbacl\" class=\"fr o60 fs90 {protected} cp\" data-db=\"{namesafe}\"></div>',\n\t\t\t\t'<a href=\"#{href}\" class=\"tdn pr20\">{namesafe}</a>',\n\t\t\t\t//'<div class=\"view-tofilter pseudolink\" data-filter=\"{namesafe}\"><span class=\"fi-filter\"></span></div>',\n\t\t\t'</div>',\n\t\t\t'<div class=\"w310 view-aux fs95 pt1\">',\n\t\t\t\t//'<div class=\"w30 tac \">{syncstate}</div>',\n\t\t\t\t'<div class=\"w80 tar  pr6\">{doc_count}</div>',\n\t\t\t\t'<div class=\"w70 fs90 vat tal pt5 lh130 pl6 gray\">{doc_del_count}</div>',\n\t\t\t\t'<div class=\"w80 tar  pr6\" title=\"{update_seq}\">{update_seq_safe}</div>',\n\t\t\t\t'<div class=\"w80 tar pr6\" title=\"{sizetip}\">{sizesafe}</div>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join(''),\n\t\n\tstyle:{ /* See tab */ }\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1504221916619","id": ".$dbs.ui","type": "js","data": "// select & search\n({\n\t\n\t'#db-search':{\n\t\tdelay:150,\n\t\tbind:\"search\",\n\t\tcss: { \t\"my-search\": /^.{2,}$/ }\n\t},\n\t\n\t'#btn-reload':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tif (!d.selection.length) {\n\t\t\t\tthis.GetList(true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.BatchInfo(d.selection, this.Pho('Cfg').batchDbInfoDelay);\n\t\t\t}\n\t\t}\n\t},\n\t\n\t'#btn-view-dir':{\n\t\tbind: function(d,v){\n\t\t\tif (v!=null) d.reverse = !d.reverse;\n\t\t\treturn !d.reverse?'▲':'▼';\n\t\t},\n\t\tevents:'click.my'\n\t},\n\t\n\t'#btn-select':{\n\t\tdelay:10,\n\t\tbind:function(d,v){\n\t\t\tvar that = this,\n\t\t\t\t\tall = Object.keys(that.All),\n\t\t\t\t\tlist = that.List.map(function(e){return e.name}),\n\t\t\t\t\tsel = d.selection.intersect(list),\n\t\t\t\t\tsl = sel.length,\n\t\t\t\t\tl = that.lang,\n\t\t\t\t\tt;\n\t\t\t\n\t\t\tif (sl) t = l.TXT_UNSELECT.assign(sel.length == all.length?l.TXT_SELECT_ALL:sl);\n\t\t\telse t = l.TXT_SELECT.assign(list.length == all.length?l.TXT_SELECT_ALL:l.TXT_SELECT_FILTERED);\n\t\t\t\n\t\t\tif (v!=null) {\n\t\t\t\t// unselect\n\t\t\t\tif (sl) d.selection = d.selection.subtract(list).unique();\n\t\t\t\t// select\n\t\t\t\telse d.selection = d.selection.concat(list).unique();\n\t\t\t}\n\t\t\treturn t;\n\t\t},\n\t\tevents:'click.my',\n\t\tcss:{\n\t\t\thide:function(d,v){return !this.List.length}\n\t\t},\n\t\twatch:['#view-hasselection','#db-proxy']\n\t},\n\t\n\t'#view-cols':{\n\t\tbind:function(d,v){\n\t\t\treturn this.lang.TXT_MAPVIEW(this.List.length, Object.size(this.All))\n\t\t},\n\t\twatch:['#db-proxy']\n\t},\n\t'#view-links':{\n\t\tbind: function(d,v){\n\t\t\tvar that = this,\n\t\t\t\t\tbase = that.Pho('Base'),\n\t\t\t\t\tt = '<a target=\"_blank\" class=\"tdn\" href=\"{1}\">{2}</a>';\n\t\t\treturn [\n\t\t\t\tt.assign(base, base.replace(/^http[s]?:\\/\\/|\\//g,'').escapeHTML() )\n\t\t\t].join('\\u2009')\n\t\t}\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504304322010","id": ".$dbs.ui","type": "js","data": "// bucket list\n({\n /* $(node).list({\n * \t\tdata*:[],\n * \t\ttemplate*: string for sugarjs .assign() | $.tmpl object | function (elt, idx) {},\n * \t\tevents:{\n * \t\t\t\"#selector\": function (event, $node, value) { click event },\n * \t\t\t\"#selector2\": {\n * \t\t\t\tclick:function...\n * \t\t\t\tdblclick: function...\n * \t\t\t}\n * \t\t},\n * \t\tdelay: num in ms between chunks render,\n *\t \tchunk: items to draw in one cycle (0 - full sync loop),\n *\t  sortBy: null | string | function – sort, if string – field name, \n *  \t\tif function – func for sugarjs .sortBy()\n * \t  id: function (any) {returns id of object or just obj hash},\n * \t  hash: function (any) {returns object hash}\n * });\n * \n * #### UPDATE ####\n * $(node).list(\"data\", newData);*/\n\t\n\t'#db-list':{\n\t\tdelay:50,\n\t\tinit: function($o){\n\t\t\tvar that = this,\n\t\t\t\t\tt = that.Row,\n\t\t\t\t\td = that.data;\n\t\t\t$o.list({\n\t\t\t\tdata:that.List,\n\t\t\t\tdelay:0,\n\t\t\t\tchunk:100,\n\t\t\t\tsortBy:null,\n\t\t\t\tid: function(e){return e.name},\n\t\t\t\thash:function(e) {\n\t\t\t\t\t\n\t\t\t\t\tvar h = cw.lib.sdbm([\n\t\t\t\t\t\te.name, \n\t\t\t\t\t\te.stamp, \n\t\t\t\t\t\te.update_seq + 'x',\n\t\t\t\t\t\te.checked+'x',\n\t\t\t\t\t\te.sizesafe, \n\t\t\t\t\t\te.security.stamp,\n\t\t\t\t\t\te.tasks.stamp, \n\t\t\t\t\t\te.syncs.stamp\n\t\t\t\t\t]);\n\n\t\t\t\t\treturn h;\n\t\t\t\t},\n\t\t\t\ttemplate: function(e){ \n\t\t\t\t\tvar h = t.assign(e); \n\t\t\t\t\treturn h;\n\t\t\t\t}\n\t\t\t});\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t},\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) return;\n\t\t\t$o.list('data', this.List)\n\t\t},\n\t\twatch:['#db-proxy','#view-hasselection']\n\t},\n\t\n\t'#db-proxy':{\n\t\tdelay:50,\n\t\tbind: function(d,v){\n\t\t\t//if (v==null) return;\n\t\t\tvar that = this,\n\t\t\t\t\tt = that.Row,\n\t\t\t\t\tall = that.All,\n\t\t\t\t\tsel = cw.lib.a2o(d.selection);\n\t\t\t\n\t\t\tthat.List = Object.values(all).sortBy('name', d.reverse);\n\t\t\t\n\t\t\tif (d.search.length>1) {\n\t\t\t\tvar re = new RegExp(\n\t\t\t\t\td.search.toLowerCase()\n\t\t\t\t\t.split(' ')\n\t\t\t\t\t.compact(true)\n\t\t\t\t\t.map(function(t){return t.escapeRegExp()})\n\t\t\t\t\t.join('|')\n\t\t\t\t);\n\t\t\t\tthat.List = that.List.filter(function(e){\n\t\t\t\t\treturn re.test(e.name.toLowerCase())\n\t\t\t\t});\n\t\t\t}\n\t\t\tthat.List.forEach(function(r){\n\t\t\t\tvar das, dis;\n\t\t\t\tif ((dis = r.disk_size) && (das = r.data_size)) {\n\t\t\t\t\tr.sizesafe = '<span class=\"{1}\">{2}</span>'.assign(\n\t\t\t\t\t\t(das/dis<0.1?'red o70':das/dis<0.5?'orange o90':'xgray'),\n\t\t\t\t\t\tdis.bytes(1).replace(/B$/,'b')\n\t\t\t\t\t);\n\t\t\t\t\tr.sizetip = that.lang.TIP_DBSIZE.assign(\n\t\t\t\t\t\tdas.bytes(1).replace(/B$/,'b'),\n\t\t\t\t\t\tdis.bytes(1).replace(/B$/,'b')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tr.update_seq_safe = (r.update_seq+'').split('-')[0];\n\t\t\t\tr.checked = sel[r.name]?'checked':'';\n\t\t\t});\n\t\t\t//return Date.now()+'';\n\t\t},\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){\n\t\t\t\tvar that = this;\n\t\t\t\tif (v) {\n\t\t\t\t\tif (v.name) {\n\t\t\t\t\t\tthat.GetList(true);\n\t\t\t\t\t\tthat.RestartPoll();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.All = {};\n\t\t\t\t\t\tthat.GetList(true);\n\t\t\t\t\t\tthat.RestartPoll();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdblist:function(d,v){\n\t\t\t\tif (!Object.isArray(v)) return;\n\t\t\t\tthis.GetList(true, v);\n\t\t\t}\n\t\t},\n\t\twatch:['#btn-view-dir','#db-search','#btn-select'],\n\t},\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504306051292","id": ".$dbs.ui","type": "js","data": "// new,cmpct,del\n({\n\t'#view-hasselection':{\n\t\tcss:{},\n\t\twatch:['#db-search','#btn-select']\n\t},\n\t\n\t'#btn-logs':{\n\t\tcss:{\n\t\t\thide:function(d){ return (d.service.version+'')[0] != '1'; }\n\t\t}\n\t},\n\t\n\t'#btn-newdb':{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-newdb', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\tthat.my.modal('#btn-newdb',{\n\t\t\t\t\tmanifest:that.Pho('NewDB'),\n\t\t\t\t\twidth:380,\n\t\t\t\t\tdata:{},\n\t\t\t\t\talign:'top:102%;left:0;',\n\t\t\t\t\tnose:'top',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tesc:true,\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t});\t\t\t\t\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d){\n\t\t\t\treturn !cw.me();\n\t\t\t}\n\t\t},\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){this.my.check('#btn-newdb');}\n\t\t}\n\t},\n\t\n\t'#btn-compact':{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-compact', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\tthat.my.modal('#btn-compact',{\n\t\t\t\t\tmanifest:that.Pho('Compact'),\n\t\t\t\t\twidth:380,\n\t\t\t\t\tdata:{ selection:d.selection.slice(0) },\n\t\t\t\t\talign:'top:102%;left:0;',\n\t\t\t\t\tnose:'top',\n\t\t\t\t\tcss:'xgray',\n\t\t\t\t\tscreen:false,\n\t\t\t\t\tesc:true,\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Modals.head = null;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d){\n\t\t\t\treturn !cw.me() || !d.selection.length || !this.List.map(function(e){return e.name}).intersect(d.selection).length;\n\t\t\t}\n\t\t},\n\t\twatch:['#view-hasselection'],\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){this.my.check('#btn-compact');}\n\t\t}\n\t},\n\t\n\t'#btn-deldb':{\n\t\tbind: function(d,v,$o){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif ($o.data('modal')) that.my.modal('#btn-deldb', true);\n\t\t\telse {\n\t\t\t\tif (that.Modals.head) that.Modals.head.modal(true);\n\t\t\t\tthat.Modals.head = $o;\n\t\t\t\t$.my.modal({\n\t\t\t\t\tmanifest:that.Pho('DelDB'),\n\t\t\t\t\twidth:380,\n\t\t\t\t\tdata:{ dbs:d.selection.slice(0) },\n\t\t\t\t\tcss:'xgray p20',\n\t\t\t\t\tesc:true,\n\t\t\t\t\tenter:false\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\td.selection.length = 0;\n\t\t\t\t})\n        .always(function(){\n        \tthat.Modals.head = null;\n        });\n\t\t\t}\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d){\n\t\t\t\treturn !cw.me() || !d.selection.length || !this.List.map(function(e){return e.name}).intersect(d.selection).length;\n\t\t\t}\n\t\t},\n\t\twatch:['#view-hasselection'],\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){this.my.check('#btn-deldb');}\n\t\t}\n\t},\n\t\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504740120851","id": ".$dbs.ui","type": "js","data": "// tasks\n({\n\t'#task-filter':{\n\t\tinit:function($o){\n\t\t\t$o.tags($.extend(true, {}, this.lang.TAGS_TASK_TYPE, {tagshim:'\\u2009', groupshim:'\\u2009'}));\n\t\t},\n\t\tbind:'task.filter'\n\t},\n\t\n\t'#task-cols':{\n\t\tbind:function(d,v){\n\t\t\treturn this.lang.TXT_TASKVIEW(this.Tasks.length?d.task.list.length:0, this.Tasks.length)\n\t\t},\n\t\twatch:['#task-filter','#task-list','#task-search']\n\t},\n\t\n\t'#task-search':{\n\t\tdelay:150,\n\t\tbind:\"task.search\",\n\t\tcss: { \t\"my-search\": /^.{2,}$/ }\n\t},\n\t\n\t'#task-list':{\n\t\tdelay:50,\n\t\tinit: function($o){\n\t\t\tvar that = this,\n\t\t\t\t\tt = that.TTask,\n\t\t\t\t\td = that.data;\n\t\t\t$o.list({\n\t\t\t\tdata:that.Tasks,\n\t\t\t\tdelay:0,\n\t\t\t\tchunk:100,\n\t\t\t\tsortBy:null,\n\t\t\t\tid: function(e){return e.pid + e.doc_id;},\n\t\t\t\thash:function(e) {\n\t\t\t\t\treturn cw.lib.sdbm([\n\t\t\t\t\t\te.pid, \n\t\t\t\t\t\t//e.updated_on, \n            e._selected?'sel':'unsel',\n\t\t\t\t\t\te.type,\n\t\t\t\t\t\te._progress,\n\t\t\t\t\t\te._started, \n\t\t\t\t\t\te._desc,\n            e.filter\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\ttemplate: function(e){  return t(e); }\n\t\t\t});\n\t\t\t$o.niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4,\n\t\t\t});\n\t\t},\n\t\tbind: function(d,v,$o){\n\t\t\tif (v!=null) return;\n\t\t\tif (!d.task.search.from(1) && d.task.filter == '') d.task.list = this.Tasks;\n\t\t\telse {\n\t\t\t\tvar f = this.Tasks.slice(0),\n\t\t\t\t\t\tfl= d.task.filter.exclude('active');\n\t\t\t\tif (d.task.filter.indexOf('active')>-1) f = f.filter(function(e){return e.pid!='Error' && e.pid!='Done';});\n\t\t\t\tvar a = !(fl+'')?f:f.filter(function(row){\n\t\t\t\t\treturn (row.type+'').indexOf(fl+'') != -1;\n\t\t\t\t});\n\n\t\t\t\tif (d.task.search.length>1) {\n\t\t\t\t\tvar re = new RegExp(\n\t\t\t\t\t\td.task.search.toLowerCase()\n\t\t\t\t\t\t.split(' ').compact(true)\n\t\t\t\t\t\t.map(function(t){return t.escapeRegExp()})\n\t\t\t\t\t\t.join('|')\n\t\t\t\t\t);\n\t\t\t\t\ta = a.filter(function(e){ return re.test(e._index) });\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\td.task.list = a;\n\t\t\t}\n\t\t\tthis.my.find('#task-list').list('data', d.task.list);\n\t\t},\n\t\twatch:['#task-filter','#task-search']\n\t},\n  \n  '#btn-reloadsync':{\n  \tbind:function(d,v){\n    \tif (v==null) return;\n      var that = this;\n      that.RestartPoll.debounce(500)();\n    },\n    css:{\n      ':disabled':function(d,v){return !cw.me();},\n      //'self:hide':function(d){return !!d.task.selection.length}\n    },\n    watch:['#task-list'],\n    listen:{\n\t\t\tuserCtx:function(d,v){\n        var that = this;\n        if (!Object.isObject(v)) return;\n        if (!v.name) {\n        \t// unauthorized, clear list immdeiately\n          that.Tasks.length = 0;\n          d.task.selection.length = 0;\n          that.my.recalc('#task-list');\n          that.my.check('#task-cols');\n          that.my.check('#task-list');\n        }\n        else that.my.check('#btn-reloadsync');\n      }\n\t\t},\n  },\n  \n  '#btn-resync':{\n    bind:function(d,v){\n    \tif (v==null) return;\n      var that = this;\n      that.RestartTasks()\n      .then(function(){\n      \td.task.selection.length = 0;\n        that.my.check('#task-list');\n        that.RestartPoll.debounce(300)();\n        that.RestartPoll.debounce(1500)();\n      });\n    },\n    css:{\n      //'self:hide':function(d){return !d.task.selection.length},\n      ':disabled':function(d){\n      \tif (!d.task.selection.length) return true;\n        var a = cw.lib.a2o(d.task.selection),\n            ok = true;\n        this.Tasks.forEach(function(e){\n        \tif (!e.doc_id && a[e.replication_id]) ok = false;\n        });\n        return !ok;\n      }\n    },\n    watch:['#task-list']\n  },\n  \n  '#btn-stopsync':{\n    bind:function(d,v){\n    \tif (v==null) return;\n      var that = this;\n      that.RestartTasks(true)\n      .then(function(){\n      \td.task.selection.length = 0;\n        that.my.check('#task-list');\n        that.RestartPoll.debounce(300)();\n        that.RestartPoll.debounce(1500)();\n      });\n    },\n    css:{\n      ':disabled':function(d){return !d.task.selection.length}\n      //'self:hide':function(d){return !d.task.selection.length}\n    },\n    watch:['#task-list']\n  },\n\t\n\t'#btn-newsync':{\n\t\tbind: function(d,v){\n\t\t\tif (v==null) return;\n\t\t\tvar that = this;\n\t\t\tif (that.my.find('#btn-newsync').data('modal')) {\n\t\t\t\tthat.my.find('#btn-newsync').modal(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\tthat.my.find('#btn-newsync').modal({\n\t\t\t\troot:that.my.find('#rpanel'),\n\t\t\t\tmanifest:$.extend(\n\t\t\t\t\ttrue, {}, \n\t\t\t\t\tthat.Pho('NewSync'), \n\t\t\t\t\t{\n\t\t\t\t\t\tDBs:Object.keys(that.All).sortBy(function(e){return e[0]=='_'?'zzz'+e:e;}),\n            RestartPoll:that.RestartPoll,\n\t\t\t\t\t\tparams:{width:(that.my.find('#rpanel').width()-32).clamp(340,740)}\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\tdata:that.LastSync,\n\t\t\t\tnose:'top',\n\t\t\t\talign:'top:103%',\n\t\t\t\tcss:'xgray',\n\t\t\t\tbound:0\n\t\t\t});\n\t\t\t}catch(e){console.log(e)}\n\t\t},\n\t\tcss:{\n\t\t\t':disabled':function(d,v){return !cw.me();},\n      //'self:hide':function(d){return !!d.task.selection.length}\n\t\t},\n\t\tlisten:{\n\t\t\tuserCtx:function(d,v){this.my.check('#btn-newsync');}\n\t\t},\n    watch:['#task-list']\n\t}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504214245434","id": ".$dbs.HTML","type": "js","data": "([\n\t'<div class=\"w55p dib vat\">',\n\t\n\t\t// left pahel head\n\t\t'<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\">',\n\t\t\n\t\t\t// search\n  '<div class=\"fr fs95\" style=\"max-width:200px;width:22%;\">',\n\t\t\t\t'<div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>',\n\t\t\t\t'<input type=\"text\" id=\"db-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" '\n\t\t\t\t\t+'placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\">',\n\t\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"'\n\t\t\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').blur()\"></span>',\n\t\t\t'</div>',\t\n\t\t\n\t\t\t'<div class=\"nw dib vat w75p pr10\">',\n\t\t\t\t// reload\n\t\t\t\t'<button id=\"btn-reload\" class=\"w40 mr2\" title=\"{TIP_RELOAD}\"><span class=\"fi-loop\"></span></button>',\n\t\t\t\t\n\t\t\t\t//newdb\n\t\t\t\t'<button id=\"btn-newdb\" class=\"green mr2\">{BTN_NEWDB}</button>',\n\t\n\t\t\t\t// group action buttons\n\t\t\t\t'<span id=\"view-hasselection\">',\n\t\t\t\t\t'<button id=\"btn-compact\" class=\"mr2\" disabled>{BTN_COMPACT}</button>',\n\t\t\t\t\t'<button id=\"btn-deldb\" class=\"mr2 red\" disabled>{BTN_DELDB}</button>',\n\t\t\t\t'</span>',\n\t\n\t\t\t\t'<span id=\"btn-logs\" class=\"hide pl12\"><a href=\"#_log\" class=\"tdn\">{BTN_LOGS}</a></span>',\n\t\t\t'</div>',\n\t\t'</div>', // --- end left panel head\n\t\n\t\t// DB list (left panel results)\n\t\t'<div id=\"db-panel\" class=\"panelheight-32 br2 mt16 ml20 mr20 bas\">',\n\t\t\t//'<div class=\"hide\"><input class=\"w23 dib tac ml4 mr1\" type=\"checkbox\" name=\"db-selection\" value=\"\"></div>',\n\t\t\t'<div class=\"h30 bg-gray7 bbs lh160 pt1 nw oh ell\">',\n\t\t\t\t'<div class=\"w100p-310 dib vat nw oh ell\">',\n\t\t\t\t\t\t'<span id=\"btn-view-dir\" class=\"dib pl8 pr6 mr2 vat cp o50 fs80 pt2 pseudolink tdn h30\"></span>',\n\t\t\t\t\t\t'<span id=\"view-links\" class=\"gray hide\"></span>',\n\t\t\t\t\t\t'<div id=\"view-cols\" class=\"dib vat pr12 nw xgray\"></div>',\n\t\t\t\t\t\t'<div id=\"btn-select\" class=\"pseudolink tdn dib vat\"></div>',\n\t\t\t\t'</div>',\n\t\t\t\t'<div class=\"w310 dib gray fs90\">',\n\t\t\t\t\t'<div class=\"w80 dib tar pr6\">{H_DOCS}</div>',\n\t\t\t\t\t'<div class=\"w70 dib pl7\">{H_DELDOCS}</div>',\n\t\t\t\t\t'<div class=\"w80 dib tar pr7\">{H_SEQ}</div>',\n\t\t\t\t\t'<div class=\"w80 dib tar pr7\">{H_SIZE}</div>',\n\t\t\t\t'</div>',\n\t\t\t'</div>',\n\t\t\t'<section id=\"db-list\" class=\"panelheight-64 xgray lh170\"></section>',\n\t\t'</div>',\n\t\t'<div id=\"db-proxy\" class=\"hide\"></div>',\n\t'</div>', // -- end left panel\n\t\n\t// Right panel STUB\n\t\n\t'<div id=\"rpanel\" class=\"w45p dib vat pr20\">',\n\t\t'<div id=\"a-head\" class=\"app-head nw pt18 mb16 tal\">',\n\t\t\t// task search\n  \t\t'<div class=\"fr fs95 tal\" style=\"max-width:200px;width:26.4%;\">',\n\t\t\t\t'<div class=\"fi-magnifying-glass blue o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>',\n\t\t\t\t'<input type=\"text\" id=\"task-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" '\n\t\t\t\t\t+'placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\">',\n\t\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"'\n\t\t\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').blur()\"></span>',\n\t\t\t'</div>',\n\t\t\t//'<div class=\"fl tal fs160 lh120 ell xgray o70\">{TXT_TASK_TITLE}</div>',\n\t\t\t'<div class=\"w70p dib\">',\n  \t\t\t'<button id=\"btn-reloadsync\" class=\"w40 mr2\" title=\"{TIP_TASK_RELOAD}\"><span class=\"fi-loop\"></span></button>',\n\t\t\t\t'<button id=\"btn-newsync\" class=\"mr2\">{BTN_TASK_NEWSYNC}</button>',\n  \t\t\t'<button id=\"btn-resync\" class=\"orange mr2\" disabled>{BTN_TASK_RESYNC}</button>',\n  \t\t\t'<button id=\"btn-stopsync\" class=\"red\" disabled>{BTN_TASK_STOP}</button>',\n\t\t\t'</div>',\n\t\t'</div>',\t\n\t\t// Status list (right panel results)\n\t\t'<div id=\"task-panel\" class=\"panelheight-32 br2 mt16 bas\">',\n\t\t\t'<div>',\n\t\t\t\t// Columns name and nav\n\t\t\t\t'<div class=\"h30 bg-gray7 bbs lh170\">',\n\t\t\t\t\t'<div class=\"fr pr4 tar\"><span id=\"task-filter\" class=\"dib fs90 vam pl4\"></span></div>',\n\t\t\t\t\t'<div id=\"task-cols\" class=\"dib vat pl8 nw xgray pt1\"></div>',\n\t\t\t\t'</div>',\n\t\t\t\t// Result rows\n\t\t\t\t'<section id=\"task-list\" class=\"panelheight-64 xgray lh170\">',\n\t\t\t\t\t\n\t\t\t\t\t//'<div class=\"tac p30 gray\">Here should be _active_tasks list plus _replicator DB content.</div>',\n\t\t\t\t\t\n\t\t\t\t'</section>',\n\t\t\t'</div>',\n\t\t'</div>',\n\t\t'<div id=\"status-proxy\" class=\"hide\"></div>',\n\t'</div>'\n].join(''))","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1523284530381","id": ".$dbs.Arrows","type": "html","data": "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-0, -0)\">\n    <path d=\"M1.5,4.5 L15.5,4.5 M12.5,7.5 L15.5,4.5 L12.5,1.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16.375\" height=\"8\" viewBox=\"0, 0, 16.375, 8\">\n  <g id=\"Layer_1\" transform=\"translate(0.375, -10)\">\n    <path d=\"M6.75,14.5 L15.5,14.5 M12.5,17.5 L15.5,14.5 L12.5,11.5 M1.125,11.687 L3,14.813 L3,17.5 C3,17.5 5,17.5 5,17.5 C5,17.5 5,14.813 5,14.813 L6.875,11.687 L1.125,11.687 z\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-0, -20)\">\n    <path d=\"M4.5,21.5 L5.5,21.5 L5.5,27.5 L4.5,27.5 M2.5,21.5 L1.5,21.5 L1.5,27.5 L2.5,27.5 M15.5,24.5 L7,24.5 M12.5,27.5 L15.5,24.5 L12.5,21.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-16, -0)\">\n    <path d=\"M31.5,4.5 L17.5,4.5 M20.5,1.5 L17.5,4.5 L20.5,7.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16.375\" height=\"8\" viewBox=\"0, 0, 16.375, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-16, -10)\">\n    <path d=\"M26.25,14.5 L17.5,14.5 M20.5,17.5 L17.5,14.5 L20.5,11.5 M31.875,11.687 L30,14.813 L30,17.5 C30,17.5 28,17.5 28,17.5 C28,17.5 28,14.813 28,14.813 L26.125,11.687 L31.875,11.687 z\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0\" y=\"0\" width=\"16\" height=\"8\" viewBox=\"0, 0, 16, 8\">\n  <g id=\"Layer_1\" transform=\"translate(-16, -20)\">\n    <path d=\"M28.5,27.5 L27.5,27.5 L27.5,21.5 L28.5,21.5 M30.5,27.5 L31.5,27.5 L31.5,21.5 L30.5,21.5 M17.5,24.5 L26,24.5 M20.5,21.5 L17.5,24.5 L20.5,27.5\" fill-opacity=\"0\" stroke=\"currentColor\" stroke-width=\"0.75\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  </g>\n</svg>","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1504410059036","id": ".$dbs.style","type": "js","data": "({\n\t' .view-row':'width:100%;min-height:1.9em;',\n\t' .view-row:nth-child(2n+0)':'background-color:rgba(206, 214, 226, 0.2);',\n  \n  ' .view-row svg':'margin-bottom:1px;',\n  \n  ' .tarrow':'display:inline-block;width:31px;padding-right:1px;text-align:center;',\n\t\n\t' #db-list':{\n\t\t'':'outline:none;',\n\n\t\t' .view-row>div':'display:inline-block;vertical-align:top;word-wrap: break-word;',\n\t\t' .view-aux>div':'display:inline-block;vertical-align:top;min-height:1.9em;',\n\n\t\t' .mh19em':'min-height:1.9em;',\n\n\t\t' input:checked+div':'font-weight:bolder',\n\t\t' .col-ids':'width:30%;padding:0 20px 0 8px;',\n\t\t' .col-vals':'width:70%; padding-left:10px;',\n\n\n\t\t' .view-tofilter':'display:inline-block; margin-left:5px;width:20px;line-height:1.2em;opacity:0;transition:opacity 0.5s;',\n\t\t' .view-row:hover .view-tofilter':'opacity:0.5;cursor:pointer;',\n\n\t},\n\t\n\t' #task-panel':{\n\t\t'':'outline:none;',\n\t},\n\n\t' #db-panel':{\n\t\t':before':'content:\" \";position:absolute;top:0px;z-index:-1;height:100%;'\n\t\t+'right:230px;width:80px;border-left:1px solid #e1e5e8;border-right:1px dotted #e1e5e8;',\n\n\t\t':after':'content:\" \";position:absolute;top:0px;z-index:-1;height:100%;'\n\t\t+'right:80px;width:80px;border-left:1px solid #e1e5e8;border-right:1px solid #e1e5e8;'\n\t},\n\n\t' .bbs':'border-bottom-color:rgba(211,217,222,0.7);',\n\t' .bas':'border-color:rgba(211,217,222,0.7);',\n\t' .brs':'border-right:1px solid rgba(211,217,222,0.7);',\n\t' .brsl':'border-right:1px solid rgba(211,217,222,0.3);',\n\n\t' .w100p-338':'width:calc(100% - 338px);',\n\t' .w100p-310':'width:calc(100% - 311px);',\n\n})","active": false,"err": [],"opts": [],"color": ["orange"]},{"stamp": "1507769780687","id": ".$dbs.BatchInfo","type": "js","data": "(function _batch_info(list, delay, cols){\n  var that = this,\n      result = [],\n      cols = cols || that.Pho('Cfg').listCols || [],\n      rInfo = cols.indexOf('info')>-1,\n      rSec = cols.indexOf('security')>-1,\n      ctr = list.length;\n\n  list.forEach(function(s, i){\n    var dbname = s;\n    if (that.Batch[dbname]) return result[i] = that.Batch[dbname];\n    result[i] = Q.delay(1+delay*i).then(_readInfo.fill(dbname));\n  });\n\n  return result;\n\n  // - - - - - - -\n\n  function _readInfo(dbname){\n\n    var pis = [];\n\n    if (rInfo || rSec) {\n      pis.push(\n        that.Req({url:[dbname]})\n        .then(\n          function(res){\n            if (!that.All[dbname]) return;\n            $.extend(that.All[dbname], res, {stamp:Date.now()});\n            // (re)read security if requested and DB was updated\n            if (rSec && that.All[dbname].security.seq < parseInt(that.All[dbname].update_seq)) {\n              return _readSec(dbname);\n            }\n          },\n          function(code){\n            if (code==404 && that.All[dbname]) delete that.All[dbname];\n            else $.extend (that.All[dbname], that.Pho('dbType'), {stamp:Date.now()});\n          }\n        )\n      );\n    }\n\n    if (pis.length) {\n      return Q.allSettled(pis)\n      .then(function(){\n        ctr -= 1;\n        !ctr?that.RelistNow():that.Relist();\n        delete that.Batch[dbname];\n      });\n    }\n    else return $.Deferred().resolve();\n\n  }\n\n  // - - - - - - - \n\n  function _readSec(dbname){\n    return that.Req({url:[dbname,'_security']})\n    .then(function(res0){\n      if (!that.All[dbname]) return;\n      var res = $.extend(true, {\n        stamp: Date.now(),\n        seq:parseInt(that.All[dbname].update_seq),\n        admins:{names:[],roles:[]},\n        members:{names:[],roles:[]}\n      }, res0);\n\n      if (dbname[0] == '_') res.members.roles.push('_admin');\n\n      var protected = '';\n      if (res.members.roles.length + res.members.names.length == 0) {\n        if (res.admins.roles.length + res.admins.names.length != 0) protected = 'pl10 pr10 orange1 fi-unlock';\n        else protected = 'pl10 pr10 red fi-unlock';\n      } else {\n        protected = 'pl10 pr10 gray3 fi-lock';\n      }\n\n      $.extend(that.All[dbname], {security:res, protected:protected}, {stamp:Date.now()});\n    });\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504736286652","id": ".$dbs.GetTasks","type": "js","data": "(function _get_tasks(redraw){\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tall = that.All,\n\t\t\tl = that.lang,\n\t\t\tes = function(s0){\n       \tvar s = /^http[s]?\\:\\/\\//.test(s0)?_stripPwd(s0):s0; \n        return (s+'').escapeHTML();\n      },\n\t\t\t_trunc = function (s, chars) {\n        var  ln = chars || 20;\n        if (!/\\//.test(s)) return es((s+'').truncate(ln,'middle','…'));\n        var a = s.split('/');\n        if (a[0].length > ln*0.6) {\n        \treturn es((a[0]).truncate(ln*0.6|0,'middle','…')) +'/'+es(a.slice(1).join('/'));\n        } else {\n        \treturn es((s+'').truncate(ln,'middle','…'));\n        }\n      },\n\t\t\tspt = '<span title=\"{2}\">{1}</span>',\n      nw = '<nobr>{1}</nobr>',\n\t\t\tpi = $.Deferred(),\n      Ar = that.Arrows;\n\t\n\tif (\n    !that.my.indom() \n    || that.my.root().hasClass('hide')\n    || !!window.document.hidden\n  ) return pi.resolve().promise();\n\t\n  // if unauthorized, clear tasks\n\tif (!cw.me('name')) {\n\t\tthat.Tasks = [];\n\t\t_endUp.debounce(1)();\n\t\treturn pi.promise();\n\t}\n\t\n\tif (that.TaskLoopInterval != that.Pho('Cfg').loopActiveTasks) {\n\t\t// restart poll\n\t\tthat.RestartPoll.debounce(1)();\n\t\treturn pi.resolve().promise();\n\t}\n\t\n\tthat.Req({url:['_active_tasks']})\n\t.then(function(res0){\n\t\t//that.Tasks.length = 0;\n\t\t\n    // for debug\n\t\tvar res = res0.concat(that.TaskMock||[]);\n\t\t\n\t\t// preprocess tasks \n\t\tres.forEach(_processTask);\n\t\t\n\t\t// sort, make old appear at bottom,\n\t\t// and push to this.Tasks\n\t\tres.sortBy('started_on', true)\n    .forEach(function(row){\n      row._new = true;\n      if (row.doc_id) {\n        row._selected = d.task.selection.indexOf(row.replication_id) > -1;\n      \tvar i = that.Tasks.findIndex(function(e){return e.doc_id == row.doc_id});\n        if (i > -1) {\n          if (that.Tasks[i].filter) row.filter = that.Tasks[i].filter;\n          that.Tasks[i] = row;\n        }\n        else that.Tasks.push(row);\n      }\n      else if (row.replication_id) {\n        row._selected = d.task.selection.indexOf(row.replication_id) > -1;\n        var i = that.Tasks.findIndex(function(e){return e.replication_id == row.replication_id});\n        if (i > -1) {\n          if (that.Tasks[i].filter) row.filter = that.Tasks[i].filter;\n          that.Tasks[i] = row;\n        }\n        else that.Tasks.push(row);\n      }\n      else if (row.pid) {\n      \tvar i = that.Tasks.findIndex(function(e){return e.pid == row.pid});\n        if (i > -1) {\n          if (that.Tasks[i].filter) row.filter = that.Tasks[i].filter;\n          that.Tasks[i] = row;\n        }\n        else that.Tasks.push(row);\n      }\n    });\n    \n    // remove old rows\n    that.Tasks.remove(function(t){return !t._new && t.pid!='Error' && t.pid!='Done'});\n    that.Tasks.forEach(function(t){t._new = false;})\n\t\t\n\t})\n\t.then(function(){\n\t\tif (!that.Pho('Cfg').tasksReadReplicator || d.task.filter.indexOf('compaction')>-1) return _endUp();\n\t\t\n\t\t// Read _replicator DB or its substitute.\n    // If it‘s the first read, fetch _all_docs,\n    // otherwise use _changes feed for speed up\n    var req,\n        rdb = that.Pho('ReplicatorDB');\n    \n    if (d.task.seq) req = that.Req({\n      url:[rdb, '_changes', {include_docs:true, since: d.task.seq}],\n      dataType:'json'\n    });\n    else req = that.Req({\n      url:[rdb, '_all_docs', {include_docs:true, update_seq:true}],\n      dataType:'json'\n    });\n\t\t\n    req.then(function(res){\n\t\t\t// Save last seq\n      d.task.seq = res.last_seq || res.update_seq;\n      // Process sync docs\n\t\t\t(res.rows || res.results).forEach(function(row){\n        // Del doc from tasks\n        if (row.doc._deleted) {\n          that.Tasks.remove(function(t){return t.doc_id == row.doc._id});\n        \treturn;\n        }\n        // Add/update task\n        var state = row.doc._replication_state;\n        if (state == 'error') {\n          that.Tasks.remove(function(t){return t.doc_id == row.doc._id});\n          that.Tasks.push(_mimicTaskErr(row.doc));\n        }\n        if (state == 'completed') {\n          that.Tasks.remove(function(t){return t.doc_id == row.doc._id});\n          if (!row.doc._replication_id) row.doc._replication_id = cw.lib.sdbm(row.doc._id);\n          that.Tasks.push(_mimicTaskDone(row.doc));\n        }\n        else if (\n          state != 'completed' && \n          (Object.isString(row.doc.filter) || Object.isArray(row.doc.doc_ids))\n        ) {\n          var task = that.Tasks.find(function(e){return e.doc_id == row.doc._id});\n          if (task) task.filter = row.doc.filter || row.doc.doc_ids;\n        }\n\t\t\t});\n\t\t\t//_endUp();\n\t\t})\n\t\t.always(function(){\n\t\t\t_endUp();\n\t\t})\n\t})\n\t.fail(function(code, err, msg){\n\t\tif (code > 400 && code < 600 && !cw.me('name')) {\n\t\t\tthat.Tasks = [];\n\t\t\t_endUp();\n\t\t}\n\t\telse {\n\t\t\t// Swallow fail, we might be just offline\n\t\t\tconsole.log(code, err, msg)\n\t\t\t_endUp();\n\t\t}\n\t});\n\t\n\treturn pi.promise();\n\t\n\t// - - - - - - -\n\t\n\tfunction _mimicTaskErr(x) {\n\t\t\n\t\tvar dt = Date.create(x._replication_state_time).valueOf()/1000|0;\n\t\t\n\t\tvar t = {\n\t\t\tpid: 'Error',\n\t\t\tcontinuous: \t\t\tx.continuous,\n      replication_id:\t\tx._replication_id,\n      _selected: \t\t\t\td.task.selection.indexOf(x._replication_id) > -1,\n\t\t\tdoc_id: \t\t\t\t\tx._id,\n\t\t\tprogress: \t\t\t\t0,\n\t\t\tsource: \t\t\t\t\tx.source,\n      filter:\t\t\t\t\t\tx.filter || x.doc_ids || null,\n\t\t\ttarget: \t\t\t\t\tx.target,\n\t\t\tstarted_on: \t\t\tdt,\n\t\t\tupdated_on:\t\t\t\tdt,\n\t\t\ttype: \t\t\t\t\t\t'replication'\n\t\t}\n\t\t\n\t\treturn t; //_processTask(t);\n\t\n\t}\n  \n  // - - - - - - -\n\t\n\tfunction _mimicTaskDone(x) {\n\t\t\n\t\tvar dt = Date.create(x._replication_state_time).valueOf()/1000|0;\n\t\t\n\t\tvar t = {\n\t\t\tpid: \t\t\t\t\t\t'Done',\n\t\t\tcontinuous: \t\tx.continuous,\n      replication_id:\tx._replication_id,\n      _selected: \t\t\td.task.selection.indexOf(x._replication_id) > -1,\n\t\t\tdoc_id: \t\t\t\tx._id,\n\t\t\tprogress: \t\t\t100,\n\t\t\tsource: \t\t\t\tx.source,\n      filter:\t\t\t\t\tx.filter || x.doc_ids || null,\n\t\t\ttarget: \t\t\t\tx.target,\n\t\t\tstarted_on: \t\tdt,\n\t\t\tupdated_on:\t\t\tdt,\n\t\t\ttype: \t\t\t\t\t\"replication\"\n\t\t}\n\t\t\n\t\treturn t; //_processTask(t);\n\t\n\t}\n\t\n\t// - - - - - - - \n\t\n\tfunction _processTask(row){\n\n\t\t// clean task type\n\t\tvar ts = row.type.replace(/_/g,' ')\n\t\t.replace(/database/gi,'DB')\n\t\t.replace(/compaction/gi,'compact')\n\t\t.replace(/replication/gi,'');\n\t\tts = ts.compact();\n\t\tts = ts?ts+':':'';\n\t\trow._type = es(ts.to(1).toUpperCase()+(ts||'').from(1));\n\t\t\n    var arrow = '<div class=\"tarrow\">{1}</div>',\n        sfm \t= '<span class=\"fs80 o40 dib vat mt1 mb-1 fi-filter\"></span>',\n\t\t\t\tterr \t= '<span class=\"red1 fs95\">{1}</span>',\n        tdone = '<span class=\"green1 fs95\">{1}</span>';\n\n\t\t// full text index\n\t\trow._index = JSON.stringify(\n      Object.reject(row,['_index','_selected'])\n    )\n    .toLowerCase()\n    .replace(/[\",\\{\\}\\[\\]]/g,' ')\n    .compact()\n    .stripTags();\n\n\t\t// clean pid\n\t\t \n\t\tif (row.pid == 'Error') {\n\t\t\trow._pid = terr.assign('<span class=\"fi-alert red1 fs95\"></span> Error');\n\t\t\trow._pidsafe = 'Error';\n\t\t\tarrow = terr.assign(arrow);\n\t\t}\n    else if (row.pid == 'Done') {\n      row._pid = tdone.assign('<span class=\"fi-check green1 fs95\"></span> Done');\n\t\t\trow._pidsafe = 'Done';\n\t\t\tarrow = tdone.assign(arrow);\n    }\n    else {\n\t\t\trow._pid = '‹<span class=\"fs95\">'+row.pid.replace(/[<>]/g,'')+'</span>›';\n\t\t\trow._pidsafe = es(row.pid);\n\t\t}\n    \n    // detect filter type\n    if (row.filter && Object.isArray(row.filter)) row.docs = true;\n\n\t\t// task start time\n\t\tvar stamp = row.started_on;\n\t\tif (stamp) {\n\t\t\tvar dt = Date.create(+stamp*1000);\n\t\t\tif (!dt.isThisYear()) row._start = dt.format('{d} {Mon} {yyyy}');\n\t\t\telse if (!dt.isToday()) row._start = dt.format('{d} {Mon}, {H}:{mm}');\n\t\t\telse row._start = dt.format('{H}:{mm}:{ss}');\n\t\t}\n\t\telse row._start = '???';\n\n\t\t// progress %\n    \n    if (row.pid == 'Error') {\n\t\t\trow._progress = '';\n\t\t}\n    else if (row.pid == 'Done') {\n      row._progress = '100%';\n    }\n    else {\n\t\t\trow._progress = Object.isNumber(row.progress)?(row.progress.clamp(0,100)|0)+'%':'???';\n\t\t}\n\n\t\t// description\n\t\tif (row.source && row.target) {\n      \n      var p1 = _ord(row.source),\n          p2 = _ord(row.target);\n\n      if (/\\//.test(p1) && !/\\//.test(p2)) {\n        row._left = (row.pid=='Done'?'4-':row.pid=='Error'?'1-':row.doc_id?'2-':'3-')+p2+'2-'+p1;\n        row._desc = nw.assign(_trim(row.target, 30)) \n        + arrow.assign(row.docs?Ar[5]:row.filter?Ar[4]:Ar[3])\n        + nw.assign(_trim(row.source, 30));\n      }\n      else {\n        row._left = (row.pid=='Done'?'4-':row.pid=='Error'?'1-':row.doc_id?'2-':'3-')+p1+'1-'+p2;\n      \trow._desc = nw.assign(_trim(row.source, 30)) \n        + arrow.assign(row.docs?Ar[2]:row.filter?Ar[1]:Ar[0])\n        + nw.assign(_trim(row.target, 30));\n      }\n\t\t\tif (row.doc_id) row._desc = '<a class=\"tdn\" href=\"#_replicator/'+es(row.doc_id)+'\">'+row._desc+'</a>';\n\t\t}\n\t\telse if (/compaction/.test(row.type)) {\n\t\t\trow._desc = nw.assign(_trim(row.database));\n\t\t}\n\t\telse row._desc = row._pid;\n\n\t\treturn row;\n\t}\n\t\n\t// - - - - - - - \n\t\n\tfunction _endUp() {\n\t\t// sort, make old appear at bottom,\n\t\t// and push to this.Tasks\n\n    var a = that.Tasks.slice(0);\n\t\tthat.Tasks.length = 0;\n    \n    a.map(function(row){return _processTask(row);})\n    .sortBy('_left')\n\t\t.forEach(function(row){that.Tasks.push(row)});\n        \n\t\tif (redraw) {\n\t\t\tthat.my.recalc('#task-list');\n\t\t\tthat.my.check('#task-cols');\n      that.my.check('#task-list');\n\t\t}\n    d.task.selection.length = 0;\n    that.Tasks.forEach(function(e){if (e._selected) d.task.selection.push(e.replication_id)});\n\t\tpi.resolve(that.Tasks);\n\t}\n\t\n\t\n\t// - - - - - - - \n\t\n\tfunction _trim(path, chars, filter){\n    \n    var p = [],\n        tico = '<span class=\"ml3 fs95 o40 dib vat mt1 mb-1 fi-{1}\"></span>';\n\t\t\n    if (!Object.isString(path) || !/^http[s]?:\\//.test(path)) {\n      p.push( spt.assign(_trunc(path+'', chars), es(path+'')) );\n    }\n    else {\n      var u = new URL(path),\n          tpath = _ord(path);\n      p.push(spt.assign(_trunc(tpath, chars), es(path)));\n\n      if (/\\//.test(tpath) && u.protocol!='https:') {\n        p.push(tico.assign('unlock red1'));\n      }\n      if (u.username || u.password) {\n        p.push(tico.assign('torso'));\n      }\n    }\n\t\tif (filter) p.push(tico.assign('filter'));\n\t\t\n\t\treturn p.join('');\n\t\t\n\t}\n  \n  // - - - - - - - - - - - - - - - -\n  \n  function _ord(s) {\n    if (!/^http[s]?:\\/\\/.+/.test(s)) return s;\n    var u = new URL(s), \n        local = u.hostname =='127.0.0.1' || u.hostname == 'localhost';\n    var tpath = !local?u.hostname+u.pathname.replace(/\\/$/,''):u.pathname.replace(/^\\/|\\/$/g,'');\n  \treturn tpath;\n  }\n  \n  // - - - - - - - - - - - - - - - -\n\n  function _stripPwd(s) {\n    return s.replace(/^(http[s]?\\:\\/\\/[^\\:@\\/]+:)[^@]+(@.+)$/, '$1•••••$2');\n  }\n})","active": true,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1505866905370","id": ".$dbs.RestartPoll","type": "js","data": "(function _restart_poll(){\n\tvar that = this;\n\t\n\tthat.TaskLoopInterval = that.Pho('Cfg').loopActiveTasks;\n\tif (that.TaskLoop){\n\t\tthat.TaskLoop.cancel();\n\t\tthat.GetTasks(true);\n\t}\n\tthat.TaskLoop = that.GetTasks.fill(true).every(that.TaskLoopInterval*1e3);\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1520075330735","id": ".$dbs.RestartTasks","type": "js","data": "(function _restart_tasks(onlyStop){\n  var that = this,\n      d = that.data,\n      l = that.lang,\n      pi = $.Deferred(),\n      sel = that.data.task.selection.slice(0),\n      rdb = that.Pho('ReplicatorDB'),\n      tasks = [],\n      del = []; \n  \n  var ids = that.Tasks.filter(function(e){\n    return sel.indexOf(e.replication_id)>-1 && e.doc_id;\n  }).map(function(e){return e.doc_id;});\n  \n  var cancels = that.Tasks.filter(function(e){\n    return sel.indexOf(e.replication_id)>-1 && !e.doc_id;\n  }).map(function(e){return {cancel:true, replication_id:e.replication_id}});\n\n  $.my.modal({\n    width:300,\n    manifest:that.Pho('Confirm'),\n    data:{\n      text:[\n        '<div class=\"fs130 '+(onlyStop?'red':'orange')+' mb5\">'\n        +l[onlyStop?'TXT_TASK_STOP_TITLE':'TXT_TASK_RESYNC_TITLE']+'</div>',\n        l[onlyStop?'TXT_TASK_STOP_WARN':'TXT_TASK_RESYNC_WARN'](ids.length, cancels.length, rdb)\n      ].join(''),\n      yescss:onlyStop?'red':'orange',\n      yes:l.BTN_TASK_PROCEED,\n      no:l.BTN_CANCEL,\n      cancel:''\n    },\n    css:'lh160 xgray p20 pb25',\n    esc:true,\n    enter:false\n  })\n  .then(function(res){\n    if (res.cmd!='yes') return pi.reject(999, 'Cancelled', 'Cancelled');\n    _restart();\n  })\n  .fail(function(){\n  \tpi.reject(999, 'Cancelled', 'Cancelled');\n  });\n\n  return pi.promise();\n\n  // - - - - \n\n  function _restart(){\n    \n    var req;\n    \n    if (ids.length) {\n      req = that.Req({\n        url:\t\t\t\t\t[rdb,'_all_docs', {include_docs:true, attachments:true}],\n        method:\t\t\t\t'POST',\n        contentType:\t'application/json',\n        //headers:{'Content-type':'application/json'},\n        data: \t\t\t\tJSON.stringify({keys:ids})\n      })\n      .then(function(res){\n        res.rows.forEach(function(row){\n          var doc = row.doc;\n          del.push({_id:doc._id, _rev:doc._rev, _deleted:true});\n          var doc1 = {_id:doc._id};\n          if (doc._attachments) doc1._attachments=doc._attachments;\n          $.extend(doc1, Object.reject(doc, /^_/));\n          tasks.push(doc1);\n        });\n      })\n      .then(function(){\n        return that.Req({\n          url:\t\t\t\t[rdb,'_bulk_docs'],\n          method:\t\t\t'POST',\n          dataType:\t\t'json',\n          contentType:'application/json',\n          headers:\t\t{'X-Couch-Full-Commit':'true'},\n          data: \t\t\tJSON.stringify({docs:del})\n        });\n      })\n      .then(function(res){\n        if (onlyStop) return res;\n        cw.lib.note(that.lang.MSG_TASK_RESYNC);\n        var p = $.Deferred();\n        // inserting revs\n        //var revs = {};\n        //res.forEach(function(e){if (e.ok) revs[e.id] = e.rev;});\n        //tasks.forEach(function(e){if (revs[e._id]) e._rev = revs[e._id];});\n\n        (function(){\n          that.Req({\n            url:\t\t\t\t[rdb,'_bulk_docs'],\n            method:\t\t\t'POST',\n            contentType:'application/json',\n            headers:\t\t{'X-Couch-Full-Commit':'true'},\n            data: \t\t\tJSON.stringify({docs:tasks})\n          })\n          .then(function(a){p.resolve(a);})\n          .fail(function(a,b,c){p.reject(a,b,c);});\n        }).debounce(1000)();\n\n        return p.promise();\n      });\n    }\n    \n    if (cancels.length) {\n      (ids.length?req.then:(function(a){req = a();}))(function(){\n\t\t\t\t// emit tasks cancellations\n        var p = $.Deferred(),\n            reqs = cancels.map(function(e){\n            \treturn that.Req({\n                url:\t\t\t\t['_replicate'],\n                method:\t\t\t'POST',\n                dataType:\t\t'json',\n                contentType:'application/json',\n                //headers:{'Content-type':'application/json'},\n                data: \t\t\tJSON.stringify(e)\n              });\n            });\n        Q.allSettled(reqs).then(\n          function(result){p.resolve();},\n          function(){p.resolve();}\n        );\n        return p.promise();\n      });\n    }\n    \n    // Finalize\n    \n    req.then(function(){\n      cw.lib.note(l[onlyStop?'MSG_TASK_STOP':'MSG_TASK_RESYNC_OK'], 'ok');\n      $.my.radio('dblist', [rdb]);\n      pi.resolve(tasks);\n    })\n    .fail(function(code, err, msg){\n      // fail to read doc back\n      cw.lib.note(l[onlyStop?'ERR_TASK_STOP':'ERR_TASK_RESYNC'].assign(code+': '+err), 'error');\n      console.log(code, err, msg);\n      pi.reject(code, err, msg);\n    });\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504735526418","id": ".$dbs.TTask","type": "js","data": "(function (e){\n\t// renders tasklist row from pre-processed data\n\tvar that = this,\n\t\t\td = that.data;\n  \n  var s = '<div class=\"w25 dib vat ml-25 pl5\">{1}</div>';\n  \n  /*if (e.pid == 'Error' && e.doc_id){\n  \ts = s.assign('<input type=\"checkbox\" name=\"task-selection\" class=\"cp\" value=\"doc {doc_id}\" '+(e._selected?'checked>':'>'));\n  }\n  else*/ \n  if (e.pid == 'Error' && !e.doc_id) {\n  \ts = s.assign('&nbsp;');\n  }\n  else if (e.replication_id) {\n  \ts = s.assign('<input type=\"checkbox\" name=\"task-selection\" class=\"cp\" value=\"{replication_id}\" '+(e._selected?'checked>':'>'));\n  }\n  else s = s.assign('&nbsp;');\n\t\n\tvar t = [\n\t\t'<div class=\"view-row pl25 pr8\">',\n    s,\n\t\t'<div class=\"dib w20p ell fs95 gray vat\" title=\"{_pidsafe}\">{_pid}</div>',\n\t\t\t'<div class=\"dib w70p ell pr10 vat lh140 pt2 pb2\">{_type} {_desc}</div>',\n\t\t\t'<div class=\"dib w10p vat tar\">{_progress}</div>',\n\t\t'</div>'\n\t].join('');\n\t\n\treturn t.assign(e);\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504748209426","id": ".$dbs.TaskMock","type": "js","data": "([\n\t{\n\t\t\"pid\":\"<0.15795.6>\",\n\t\t\"changes_done\":4109,\n\t\t\"database\":\"wallks5763874539893485769\",\n\t\t\"progress\":42,\n\t\t\"started_on\":1504732136,\n\t\t\"total_changes\":9700,\n\t\t\"type\":\"database_compaction\",\n\t\t\"updated_on\":1504732160\n\t}\n])","active": false,"err": [],"opts": ["nocompile"],"color": ["green"]},{"stamp": "1509038055260","id": ".$log","type": "js","data": "({\n\t//id:'cw.Photon.$log',\n\tlang:{},\n\tdata:{\n\t\tsrc:'couch',\n\t\tsearch:'',\n\t\tsize:'10',\n\t\toffset:'0',\n\t\tlines:''\n\t},\n\t\n\tPrev:[],\n\thash:function(){ return 'log'; },\n\ttitle:function(){ return 'Logs'; },\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t$.extend(d, that.Pho('Ls')('Logs') || {});\n\t\tthat.Prev = [d.size,d.offset];\n\t\treturn that.Get(false, true)\n\t\t.then(function(res){\n\t\t\t$o.html(that.HTML.assign(that.lang));\n\t\t\t$o.find('#report').niceScroll({\n\t\t\t\tcursorcolor:'#234',\n\t\t\t\tcursoropacitymin:0.07,\n\t\t\t\tcursoropacitymax:0.4\n\t\t\t});\n\t\t});\n\t},\n\tui:{ /* See tabs */ },\n\t\n\tdie: function($o){\n\t\t// Unmount niceScroll\n\t\tvar f = $o.find('#report').getNiceScroll;\n\t\tif (typeof f == 'function') f().remove();\n\t},\n\tHTML:[\n\t\t'<div id=\"a-head\" class=\"app-head nw pt18 pl20 pr20 lh160\">',\n\t\t\n\t\t\t// search\n\t\t'<div class=\"fr w150 fs95\">',\n\t\t\t'<div class=\"fi-magnifying-glass xgray o50 fs95\" style=\"position: absolute; z-index: +1; left: 8px;top: 0.2em;\"></div>',\n\t\t\t'<input type=\"text\" id=\"log-search\" class=\"ui-search w100p ml0 mr0 mt0 pr10\" '\n\t\t\t\t+'placeholder=\"{PLC_SEARCH}\" style=\"background-image:none;padding-right:19px!important;\">',\n\t\t\t'<span class=\"fi-x fs80 dib vat pt2 blue ui-search-clear\" style=\"margin-left:-19px!important;\"'\n\t\t\t\t+'onclick=\"$(this).siblings(\\'input:eq(0)\\').val(\\'\\').blur()\"></span>',\n\t\t'</div>',\t\n\t\t\n\t\t'<div class=\"nw dib vat\">',\n\t\t\t// Reload\n\t\t\t'<button id=\"btn-reload\" class=\"w40 mr8 vat\" title=\"{PLC_RELOAD}\"><span class=\"fi-loop\"></span></button>',\n\t\t\n\t\t\t'<span class=\"bolder fs150 lh130 xgray mr30 dib vat\">{TXT_TITLE}</span> ',\n\t\t\t'<div class=\"dib vat\">',\n\t\t\t\t'<span>{TXT_SIZE}</span> <input id=\"lsize\" type=\"number\" class=\"w70\" min=\"1\" max=\"500\" step=\"1\"> <span>{TXT_KB}, ',\n\t\t\t\t'{TXT_OFFSET}</span> <input id=\"loffset\" type=\"number\" class=\"w100\" min=\"0\" max=\"1000000\" step=\"10\"> <span>{TXT_KB}</span> ',\n\t\t\t'</div>',\n    \n    \t// buttons left-right\n\t\t\t'<span class=\"buttons ml10\">',\n\t\t\t\t'<button id=\"btn-log-minus\" class=\"w40 mr2 pl0 pr0\">',\n\t\t\t\t\t'<span class=\"fi-arrow-left o80\"></span>',\n\t\t\t\t'</button>',\n\t\t\t\t'<button id=\"btn-log-plus\" class=\"w40 mr2 pl0 pr0\">',\n\t\t\t\t\t'<span class=\"fi-arrow-right o80\"></span>',\n\t\t\t\t'</button>',\n\t\t\t'</span>',\n\t\t'</div>',\n\t\t\n\t\t'</div>',\n\t\t\n\t\t'<div class=\"panelheight-4 feather mt4\">',\n\t\t\t'<div id=\"report\" class=\"pl20 pr20 panelheight-4 pre\">',\n\t\t\t\t'<div id=\"logs\" class=\"fs90 lh140 pb12 pt8\"></div>',\n\t\t\t'</div>',\n\t\t'</div>',\n\t\t\n\t\t'<div id=\"log-proxy\" class=\"hide\"></div>'\n\t].join(''),\n\tstyle:{\n\t\t' pre':'white-space: pre-wrap;',\n\t\t' .log-found':'background-color:rgba(255,232,121,0.94);border-radius:2px;'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["red"]},{"stamp": "1509041024858","id": ".$log.ui","type": "js","data": "({\n\t'#lsize':{\n\t\tbind: function(d,v){\n\t\t\tif (v!=null) {\n\t\t\t\td.size = (isNaN(v) || !v) ? '10': ((+v | 0).clamp(1,500)+'');\n\t\t\t\tthis.my.find('#loffset').attr('step', d.size);\n\t\t\t}\n\t\t\treturn d.size;\n\t\t},\n\t},\n\t\n\t'#loffset':'offset',\n\t\n\t'#log-search':{\n\t\tdelay:150,\n\t\tbind:\"search\",\n\t\tcss: { \t\"my-search\": /^.{2,}$/ }\n\t},\n\t\n\t\t\n\t'#log-proxy':{\n\t\tdelay:300,\n\t\tbind: function(d,v){\n\t\t\tvar that = this;\n\t\t\tif ([d.size,d.offset]+'' != that.Prev+'') {\n\t\t\t\tthat.Get().then(function(){\n\t\t\t\t\tthat.my.recalc('#logs');\n\t\t\t\t})\n\t\t\t\t.always(function(){\n\t\t\t\t\tthat.Prev = [d.size,d.offset];\n\t\t\t\t\tthat.Pho('Ls')('Logs', {size:d.size});\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\twatch:['#lsize','#loffset']\n\t},\n\t\n\t'#logs':{\n\t\tbind:function(d,v){\n\t\t\tvar that = this,\n\t\t\t\t\tre;\n\t\t\tif (d.search.length>1) {\n\t\t\t\tre = new RegExp('('+RegExp.escape(d.search)+')', 'i');\n\t\t\t\treturn d.lines.lines()\n\t\t\t\t.reduce(function(acc, s){\n\t\t\t\t\tif (s[0]!='[' && acc.length) {\n\t\t\t\t\t\tacc[acc.length - 1] += '\\n'+s;\n\t\t\t\t\t}\n\t\t\t\t\telse acc.push(s);\n\t\t\t\t\treturn acc;\n\t\t\t\t},[])\n\t\t\t\t.filter(function(s){\n\t\t\t\t\treturn re.test(s);\n\t\t\t\t})\n\t\t\t\t.map(function(s){\n\t\t\t\t\treturn s.replace(re, '\\ufff1$1\\ufff0')\n\t\t\t\t\t.escapeHTML()\n\t\t\t\t\t.replace('\\ufff1','<span class=\"log-found\">')\n\t\t\t\t\t.replace('\\ufff0','</span>');\n\t\t\t\t})\n\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn d.lines.escapeHTML();\n\t\t},\n\t\twatch:['#log-search']\n\t},\n\t\n\t'#btn-reload':function(d,v){\n\t\tif (v==null) return;\n\t\tvar that = this;\n\t\tthat.Get().then(function(){\n\t\t\tthat.my.recalc('#logs');\n\t\t});\n\t},\n  \n  '#btn-log-minus':{\n    bind:function(d,v){\n    \tif (v==null) return;\n      d.offset = ((+d.offset) - (+d.size)).clamp(0,1e10)+'';\n    },\n    css:{\n      ':disabled':function(d){return !(+d.offset);}\n    },\n    watch:'#loffset',\n    recalc:'#loffset'\n  },\n  \n  '#btn-log-plus':{\n    bind:function(d,v){\n    \tif (v==null) return;\n      d.offset = ((+d.offset) + (+d.size)).clamp(0,1e10)+'';\n    },\n    watch:'#loffset',\n    recalc:'#loffset'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1509040530153","id": ".$log.Get","type": "js","data": "(function (){\n\tvar that = this,\n\t\t\tbytes = that.data.size*1024,\n\t\t\toffset = (that.data.offset || 0) * 1024;\n\t\n\tvar url = ['_log',{bytes:bytes},offset?{offset:offset}:null].compact();\n\t\n\treturn that.Req({\n\t\turl:url,\n\t\tdataType:'text'\n\t})\n\t.then(function(res){\n\t\tthat.data.lines = res;\n\t})\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503524553992","id": ".Req","type": "js","data": "(function _Req(opts0, onlyURL){\n\n\tvar isS = Object.isString,\n\t\t\tisO = Object.isObject,\n\t\t\tisA = Object.isArray,\n\t\t\tisIE = this.isIE;\n\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tcfg = that.Cfg,\n\t\t\tl = that.lang,\n\t\t\tpi = $.Deferred();\n\n\tvar opts = $.extend(\n\t\ttrue, \n\t\t{\n\t\t\tmethod:'GET',\n\t\t\tdataType:'json',\n\t\t\theaders:{ Accept:'application/json' },\n\t\t\tcache: !isIE\n\t\t},\n\t\tisO(opts0)?opts0:isA(opts0)?{url:opts0}:{url:opts0+''}\n\t);\n\n\tvar url = a2url(opts.url, that.Base);\n\t\n\tif (onlyURL) return url;\n\n\tif (!url) E(400, l.ERR_REQ_INVALIDCALL);\n\t\n\topts.url = url;\n\t\n\t$.ajax(opts)\n\t.then(function(res){\n\t\tpi.resolve(res);\n\t})\n\t.fail(function(res, b){\n\t\tvar data;\n\t\ttry {data = JSON.parse(res.responseText);} catch(e){}\n\t\tif (!Object.isObject(data)) data = {};\n\t\tdata.ok = false;\n\t\tvar code = res.status,\n\t\t\t\tmsg = data.reason || data.message || '';\n\t\t\n\t\tE(code, msg, data);\n\t\t\n\t\tif (that._compiled && cw.me('name') && (code == 401 || code == 403)) session();\n\t\t\n\t});\n\n\treturn pi.promise();\n\n\t// - - - - - - -\n\n\tfunction E(code0, msg0, data) {\n\t\tvar code = !isNaN(code0)?(+code0):500,\n\t\t\t\tmsg = (isNaN(code0) && !msg0)?code0:msg0;\n\t\tif (!msg) {\n\t\t\tmsg = l.ERR_REQ[code] || l.ERR_REQ[999];\n\t\t}\n\t\tmsg+='';\n\t\tpi.reject(code, msg, data);\n\t}\n\t\n\t// - - - - - - -\n\t\n\tfunction session(){\n\t\t// re-reads user session on 401 and 403\n\t\t$.ajax({\n\t\t\turl:that.Base.replace(/\\/+$/,'')+'/_session',\n\t\t\tmethod:'get', \n\t\t\tdataType:'json',\n\t\t\theaders:{Accept:'application/json'},\n\t\t\tcache:!isIE \n\t\t})\n\t\t.then(function(res){\n\t\t\tif (Object.isObject(res) && res.userCtx) {\n\t\t\t\tvar u = res.userCtx,\n\t\t\t\t\t\tme = {name:u.name || '', roles:u.roles || []};\n\t\t\t\tif (!u.name) {\n\t\t\t\t\tif (that.Pho('_compiled') && window.DDOC) $.extend(window.DDOC._me, me);\n\t\t\t\t\t$.my.radio('userCtx',me);\n\t\t\t\t\t// that.Pho('my').check('#btn-aside-auth');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t// - - - - - - - \n\n\tfunction a2url(a, base0) {\n\t\tvar p = [],\n\t\t\t\tq = {},\n\t\t\t\tqa = [],\n\t\t\t\turl = '',\n\t\t\t\tbase = base0?(base0+'').replace(/\\/+$/,'')+'/':'',\n\t\t\t\ttostr = {startkey:1,endkey:1,start_key:1,end_key:1,key:1},\n\t\t\t\treddoc = /^_design\\//;\n\n\t\tif (typeof a == 'string') {\n\t\t\turl = !/^http[s]?:/.test(a)?base+a.replace(/^\\/+/,''):a;\n\t\t}\n\t\telse if (Object.isArray(a)) {\n\t\t\ta.forEach(function(e, i){\n\t\t\t\tif(''===e || null==e) return;\n\t\t\t\tif (Object.isObject(e)) $.extend(true, q, e);\n\t\t\t\telse if (reddoc.test(e+'')) {\n          var parts = (e+'').split('/');\n          p.add([parts[0], parts.from(1).join('/')]);\n          //console.log(p, parts, e)\n        }\n\t\t\t\telse p.push(encodeURIComponent(e+''));\n\t\t\t});\n\n\t\t\tqa = Object.keys(q).map(function(key){\n\t\t\t\tvar v = q[key];\n\t\t\t\tif (tostr[key] || typeof v != 'string') v = JSON.stringify(v);\n\t\t\t\treturn encodeURIComponent(key)+'='+encodeURIComponent(v);\n\t\t\t});\n\t\t\t\n\t\t\turl = base+p.join('/')+(qa.length?'?'+qa.join('&'):'');\n\t\t}\n\n\t\treturn url;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1527637523931","id": ".PokeBucket","type": "js","data": "(function(bucket){\n  var that = this;\n\treturn that.Req([bucket]);\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504408809562","id": ".GetList","type": "js","data": "(function _GetDBList (){\n\t\n\t// Returns promise resolved with prefilled that.All{}\n\t\n\tvar that = this,\n\t\t\td = that.data,\n\t\t\tpi = $.Deferred(),\n\t\t\trname = '';\n\t\n\tvar pis = [\n\t\t\n\t\t// read DB list\n\t\tthat.Req(['_all_dbs'])\n\t\t.then(function(list){\n\t\t\tvar prev = Object.keys(that.All),\n\t\t\t\t\tcurr = list.slice(0);\n\n\t\t\t// Delete non existent\n\t\t\tprev.subtract(curr).forEach(function(i){ delete that.All[i]; });\n\n\t\t\tcurr.forEach(function(dbname){\n\t\t\t\t// construct db objs\n\t\t\t\tvar db = $.extend(true, {\n\t\t\t\t\tname:dbname,\n\t\t\t\t\tnamesafe:dbname.escapeHTML(),\n\t\t\t\t\thref:encodeURIComponent(dbname)\n\t\t\t\t}, that.dbType);\n\t\t\t\t// store\n\t\t\t\tthat.All[dbname] = $.extend( \n          true, \n          db, \n          that.All[dbname] || {}, \n          {stamp:Date.now()} \n        );\n\t\t\t});\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\tpi.reject(code, err, msg);\n\t\t})\n  ];\n  \n  if (!that.ReplicatorDB)  {\n  \t// read replicator DB name\n\t\tpis.push(that.Req(['_config', 'replicator', 'db'])\n\t\t.then (function(rnewname){\n\t\t\tif (typeof rnewname == 'string') rname = rnewname;\n\t\t}));\n  }\n\t\n\tif (!that.Couch.version) {\n\t\tpis.push(\n\t\t\tthat.Req({url:[], dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\tif (!that.Couch.version) $.extend(that.Couch, res);\n\t\t\t})\n    );\n    \n    if (that.Pho('_compiled') && !window.DDOC._db) pis.push(\n      that.Req({url:['_dbroot'], dataType:'json'})\n\t\t\t.then(function(res){\n\t\t\t\t$.extend(that.Couch, res);\n\t\t\t})\n      .fail(function(){\n      \tconsole.log('This 400 is normal');\n      })\n\t\t);\n\t}\n\t\n\tQ.allSettled(pis)\n\t.then(function(){\n\t\tif (that.All[rname]) that.ReplicatorDB = rname;\n    else that.ReplicatorDB = that.ReplicatorDB || '_replicator';\n\t\tpi.resolve(that.All);\n\t});\n\t\n\treturn pi.promise();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1513620090744","id": ".GetUsers","type": "js","data": "(function _GetUsersList (){\n  // returns promise resolved with \n  // [uname, uname1...]\n  var that = this,\n      pi = $.Deferred(),\n      req,\n      u = that.Users;\n\n  if (u._seq) req = that.Req({\n    url:['_users', '_changes', {since: u._seq}],\n    dataType:'json'\n  });\n  else req = that.Req({\n    url:['_users', '_all_docs', {update_seq:true}],\n    dataType:'json'\n  });\n  \n  req.then(function(res){\n    u._seq = res.last_seq || res.update_seq;\n    (res.rows || res.results || []).forEach(function(e){\n      if (e.id.to(17)=='org.couchdb.user:') {\n        var id = e.id.from(17);\n        if (e.deleted) delete u[id];\n        else u[id] = true;\n      }\n    });\n  })\n  .always(function(){\n  \tpi.resolve(Object.keys(u).sort().remove(/^_/));\n  });\n  \n  return pi.promise();\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503609559581","id": ".Switch","type": "js","data": "(function _SwitchTab (path0, tabid){\n\t\n\t// Switches tabs, called by flatiron on hash change\n\t// or internal router if env is CloudWall big\n\t\n\tcw.log('Photon tab switch attempt', path0, tabid||'')\n\t\n\tvar that = this,\n\t\t\t_redrawTabs = _redrawTabsSync,//.debounce(0),\n\t\t\td = that.data,\n\t\t\tcIdx = that.Tabs.findIndex(function(e){return e.active}) || 0,\n\t\t\tpath = (\n\t\t\t\tObject.isString(path0)\n\t\t\t\t? path0.replace(/^#/,'').split('/').compact(!0)\n\t\t\t\t: Object.isArray(path0)\n\t\t\t\t? path0.slice(0).compact(true)\n\t\t\t\t: []\n\t\t\t);\n\t\n\tif (path[1]=='_design') {path[2] = '_design/'+path[2]; path.removeAt(1);}\n\t\n\tvar spath = path.join('\\fffd'),\n\t\t\tswitcher = [],\n\t\t\tnewtab,\n\t\t\tisNew = false;\n\t\n\tthat.Tabs.forEach(function(t){\n\t\tif (t.path.join('\\fffd') == spath) switcher.push(t);\n\t});\n\tif (switcher.length > 1) {\n\t\tif (tabid) {\n\t\t\tswitcher[0] = switcher.find(function(tf){return tf.id == tabid}) || switcher[0];\n\t\t}\n\t}\n\tnewtab = switcher[0];\n\t\n\tif(newtab && newtab.active && newtab.run) return false;\n\t\n\t// Derive type\n\tvar type = 'error',\n\t\t\ttitle = 'Error',\n\t\t\tisDB = /^(_users|_replicator|_dbs|_nodes|_global_changes|[a-zA-Z0-9$\\(\\)\\+\\-][a-zA-Z0-9$\\(\\)\\+\\-\\/_\\.]*)$/.test(path[0]),\n\t\t\tappData,\n\t\t\tpl = path.length;\n\tif (!pl) {\n\t\ttitle = 'Photon';\n\t\ttype = 'dbs';\n\t}\n\telse if (pl == 1 && path[0]=='_config') {\n\t\ttitle = 'Config';\n\t\ttype  = 'config';\n\t}\n\telse if (pl == 1 && path[0]=='_about') {\n\t\ttitle = 'About';\n\t\ttype  = 'about';\n\t}\n\telse if (pl == 1 && path[0]=='_log') {\n\t\ttitle = 'Logs';\n\t\ttype  = 'log';\n\t}\n\telse if (isDB && path[1]=='_new') {\n\t\ttitle = 'New doc';\n\t\ttype  = 'doc';\n\t\tappData = {isNew:true};\n\t\tif (path[0]=='_users') appData.doc = {\n\t\t\t_id:'org.couchdb.user:_username_', type:'user', \n\t\t\tname:'_username_', password:'_password_', roles:[] \n\t\t};\n\t\telse if (path[0]==that.ReplicatorDB) appData.doc = {\n\t\t\t_id:'', source:'', target:'', create_target:false, continuous: false, \n\t\t\tdoc_ids:[], filter:'', user_ctx:{name:'',roles:[]}, query:{}\n\t\t};\n\t}\n\telse if (isDB &&  (pl == 1 || /^_(view|all_docs|find|index)$/.test(path[1]))) {\n\t\ttitle = path[0];\n\t\ttype = 'view';\n\t\tif (path[1] == '_all_docs') {\n\t\t\tif (pl!=4) path.length = 1;\n\t\t\telse {\n\t\t\t\tappData = {\n\t\t\t\t\tstart:path[2], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+path[5])) || '100'),\n\t\t\t\t\treverse:(path[3]+'')[0]=='-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    else if (path[1] == '_find') {\n\t\t\tif (pl>5) path.length = 5;\n\t\t\telse {\n\t\t\t\tappData = {\n\t\t\t\t\tstart:path[3], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+path[4])) || '100'),\n\t\t\t\t\treverse: (path[4]+'')[0] == '-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    else if (path[1] == '_index') {\n\t\t\tif (pl>6) path.length = 6;\n\t\t\telse {\n        var isDefault = (path[2] == 'Default index' && (pl == 3 || pl == 5));\n\t\t\t\tappData = {\n\t\t\t\t\tstart:isDefault?path[3]:path[4], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+(isDefault?path[4]:path[5]))) || '100'),\n\t\t\t\t\treverse: ((isDefault?path[4]:path[5])+'')[0] == '-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (path[1] == '_view') {\n\t\t\tif (pl!=6) path.length = 4;\n\t\t\telse {\n\t\t\t\tappData = {\n\t\t\t\t\tstart:path[4], \n\t\t\t\t\tlimit:'+'+(that.$view.Steps.find(Math.abs(+path[5])) || '100'),\n\t\t\t\t\treverse:(path[5]+'')[0]=='-'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse if (pl == 2 && isDB) {\n\t\ttitle = path[0].truncate(10,'right','…')+'\\u2009/\\u2009'+path[1];\n\t\ttype = 'doc';\n\t} \n\telse if (pl == 3 && path[1] == '_design') {\n\t\ttitle = path[0].truncate(10,'right','…')+'\\u2009/\\u2009'+'_d…'+path[2];\n\t\ttype = 'doc';\n\t}\n\telse if (pl == 3 && isDB) {\n\t\ttitle = path[0].truncate(10,'right','…')+'\\u2009/\\u2009'+path[1];\n\t\ttype = 'doc';\n\t\tappData={rev:path[2].replace(/^\\D+/,'')}\n\t}\n\t\n\tif (type=='error') appData = {error:'Unrecognized command'}\n\t\n\t\n\t// Switch off tabs\n\tthat.Tabs.forEach(function(t){\n\t\tif (t!==newtab) t.active = false;\n\t});\n\t\n\t// new tab not exists?\n\tif (!newtab) {\n\t\t\n\t\tif (that.Tabs.length >= that.Cfg.maxTabs && path.length) {\n\t\t\tcw.lib.note(that.lang.FAIL_TOO_MANY_TABS.assign(that.Cfg.maxTabs+''), 'error');\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tisNew = true;\n\t\tnewtab = {\n\t\t\tid:cw.lib.sdbm(Date.now()+path),\n\t\t\ttype:type,\n\t\t\thash0:'',hash1:'',\n\t\t\tactive:true,\n\t\t\tname:title,\n\t\t\tpath:path.slice(0),\n\t\t\terror:type=='error',\n\t\t\trun:false\n\t\t};\n\t\t// add tab to UI\n\t\tif (type!='dbs') that.Tabs.insert(newtab, cIdx + 1);\n\t\telse that.Tabs.unshift(newtab);\n\t}\n\t\n\tnewtab.active = true;\n\tthat.SetTitle(newtab.name);\n\tthat.my.restyle();\n\t_redrawTabs();\n\t\n\tvar app = _runApp(type, path, newtab.id, appData);\n\t\n\tif (app.then) {\n\t\tapp.then(function(){\n\t\t\tvar waschanged = false;\n\t\t\tnewtab.run = true;\n\t\t\t// we were able to start it\n\t\t\tcw.log('Photon tab of type ${1} started'.assign(type), path);\n\t\t\tnewtab.hash0 = newtab.hash1 = app.my('manifest').hash();\n\t\t\tnewtab.name = app.my('manifest').title();\n\t\t\tthat.SetTitle(newtab.name);\n\t\t\tif (that.History.last() != newtab.id) that.History.push(newtab.id);\n\t\t\t\n\t\t\t// Track app changes\n\t\t\tapp.on('change.my', function(){\n\t\t\t\tnewtab.hash1 = app.my('manifest').hash();\n\t\t\t\tvar name = app.my('manifest').title();\n\t\t\t\tif (newtab.hash0 != newtab.hash1 || name != newtab.name) {\n\t\t\t\t\tnewtab.name = name;\n\t\t\t\t\twaschanged = true;\n\t\t\t\t\t_redrawTabs();\n\t\t\t\t}\n\t\t\t\telse if (waschanged) {\n\t\t\t\t\t_redrawTabs();\n\t\t\t\t}\n\t\t\t\tif (newtab.active) that.SetTitle(newtab.name);\n        \n\t\t\t}.debounce(500));\n\t\t\t\n\t\t\t// Track hash reset\n\t\t\tapp.on('resettabhash.my', function(){\n\t\t\t\tnewtab.hash0 = newtab.hash1 = app.my('manifest').hash();\n\t\t\t\tnewtab.name = app.my('manifest').title();\n\t\t\t\t_redrawTabs();\n\t\t\t}.debounce(100));\n\t\t\t\n\t\t\t_redrawTabs();\n\t\t\t\n\t\t})\n\t\t.fail(function(a,b){\n\t\t\t// we could not start an app\n\t\t\tcw.lib.note(that.lang.FAIL_TAB_APP, 'error');\n\t\t\tthat.my.find('#l-apps>#app-'+tabid).remove();\n\t\t\tcw.log('Photon tab ${1} start fail'.assign(type), path, a);\n\t\t\tnewtab.error = true;\n\t\t\tconsole.log(a,b);\n\t\t\t// insert dummy\n\t\t\tnewtab.hash1 = newtab.hash0 = 'error';\n\t\t\t_runApp('error', path, newtab.id, {error:Object.isString(a)&& Object.isString(b)?a+' '+b:a});\n\t\t}.debounce(10));\n\t}\n\t\n\t\n\t// - - - - - - - -\n\t\n\tfunction _redrawTabsSync(){\n\t\tthat.my.recalc('#l-apptabs');\n    d.path = Object.clone(path, true);\n\t}\n\t\n\t// - - - - - - - -\n\t\n\tfunction _runApp(type, path, tabid, data) {\n\t\tvar man = that['$'+type],\n\t\t\t\t$app = that.my.find('#l-apps>#app-'+tabid),\n\t\t\t\t$appPromise;\n\t\t\n\t\tif (!$app.length || !$app.is('.my-form')) {\n\t\t\t\n\t\t\tif(!$app.length) {\n\t\t\t\t$app = $('<div class=\"l-app\" id=\"app-'+tabid+'\"></div>');\n\t\t\t\tthat.my.find('#l-apps').append($app);\n\t\t\t}\n\t\t\t\n\t\t\tthat.my.find('#l-apps>.l-app').addClass('hide');\n\t\t\t$app.removeClass('hide');\n\t\t\t$appPromise = $app.my(man, $.extend({path:path, tabid:tabid}, data || {}));\n\t\t}\n\t\telse {\n\t\t\tthat.my.find('#l-apps>.l-app').each(function(){\n\t\t\t\tvar $t = $(this);\n\t\t\t\tif ($t.is($app)) $t.removeClass('hide');\n\t\t\t\telse $t.addClass('hide');\n\t\t\t});\n\t\t}\n\n\t\treturn $appPromise || $app;\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503789730341","id": ".Close","type": "js","data": "(function _CloseTab (opts){\n\t\n\t// 'closetab' event handler, \n\t// bound on app DOM root during app .init()\n\t\n\tvar that = this;\n\t\n\tvar tabid,\n\t\t\tenforce = false,\n      silent = false;\n\t\n\tif (Object.isObject(opts)) {\n\t\ttabid = opts.tabid || '';\n\t\tenforce = opts.enforce || false;\n    silent = opts.silent || false;\n\t}\n\telse tabid = opts+'';\n\t\n\tif (that.Tabs.length<2 || !tabid) return;\n\t\n\t// Search for tab\n\tvar tab = that.Tabs.find(function(t){return t.id == tabid});\n\tif (!tab) return;\n\t\n\t// Search for app DOM node\n\tvar $app = that.my.find('#l-apps>#app-'+tabid);\n\t\n\tif ($app.length && $app.is('.my-form')) {\n\t\ttab.hash1 = $app.my('manifest').hash();\n\t\tif (tab.hash1 == tab.hash0) {\n\t\t\t_unmount($app, tab)\n\t\t}\n\t\telse {\n\t\t\t// here we should check if doc was changed \n\t\t\t// and show modal popup 'Discard changes?'\n\t\t\t$.my.modal({\n\t\t\t\tmanifest:that.Confirm,\n\t\t\t\tdata:{yes:'Close tab&nbsp;',no:'Cancel close', cancel:'', text:that.lang.DLG_UNSAVED},\n\t\t\t\twidth:300,\n\t\t\t\tclose:true,\n\t\t\t\tesc:true,\n\t\t\t\tenter:false,\n\t\t\t\tcss:'lh170 xgray p20 pb25'\n\t\t\t})\n\t\t\t.then(function(res){\n\t\t\t\tif (res.cmd == 'yes') {\n\t\t\t\t\t_unmount($app, tab);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\telse _finalize(!tab.active);\n\t\n\t// - - - - - - -\n\t\n\tfunction _unmount($app, tab) {\n\t\t$app.my('remove');\n\t\t$app.remove();\n\t\t_finalize(!tab.active);\n\t}\n\t\n\t// - - - - - - -\n\t\n\tfunction _finalize(skipSwitch) {\n\t\t// Clean up history\n\t\tthat.History.remove(tabid);\n\t\tthat.Tabs.remove(tab);\n\t\t\n\t\tcw.log('Photon tab closed', tab.path);\n\t\t\n\t\tif (skipSwitch) {\n\t\t\tif (!silent) that.my.recalc('#l-apptabs');\n\t\t}\n\t\t\n\t\telse {\n\t\t\t// search for openable tab\n\t\t\t// and switch\n\t\t\t\n\t\t\tif (!that._compiled || window.history.length == 1) {\n\t\t\t\tvar ptab, tid;\n\t\t\t\twhile (that.History.length || ptab) {\n\t\t\t\t\ttid = that.History.pop();\n\t\t\t\t\tptab = that.Tabs.find(function(t){return t.id == tabid});\n\t\t\t\t}\n\n\t\t\t\tif (!ptab) ptab = that.Tabs[0];\n\t\t\t\tthat.Switch(ptab.path, ptab.id);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthat.my.recalc('#l-apptabs');\n\t\t\t\twindow.history.back();\n\t\t\t}\n\t\t}\n\t\tif (!silent) that.my.restyle();\n\t}\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1529274460842","id": ".Sel2Scroll","type": "js","data": "(function ($o, onoff){\n  if (onoff) {\n  \t// nicescroll all select2-s\n    $o.find('.select2-container>.select2-choices').niceScroll({\n      bouncescroll: true,\n      cursorcolor:'#234',\n      cursoropacitymin:0.1,\n      cursoropacitymax:0.4,\n      railpadding: {right:1}\n    });\n  }\n  else {\n    // remove all nicescrolls\n  \t$o.find('.select2-container>.select2-choices').each(function(){\n    \tvar f = $(this).getNiceScroll;\n      if (typeof f == 'function') f().remove();\n    });\n  }\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1504203240363","id": ".Ls","type": "js","data": "(function (prefix0){\n\t\n\t// Local storage manager\n\t// this.Ls(key) -> return value or null\n\t// this.Ls(key, null) -> deletes keys\n\t// this.Ls(key, any)  -> stores value under 'Photon.'+key\n\t\n\tvar that = this,\n\t\t\tls = window.localStorage,\n\t\t\tstorage = _photon_LS,\n\t\t\tprefix = prefix0 || that.id || 'X';\n\t\n\treturn storage;\n\t\n\t// - - - - - - - - -\n\t\n\tfunction _photon_LS (key0, data){\n\t\tvar x, \n\t\t\t\tkey = prefix+'.'+key0;\n\t\tif (null === data) return ls.removeItem(key);\n\t\telse if (undefined !== data) return ls.setItem(key, JSON.stringify(data));\n\t\telse {\n\t\t\tx = ls.getItem(key);\n\t\t\tif (Object.isString(x)) return _parse(x);\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\t// - - - - - - - - -\n\t\n\tfunction _parse(s) {\n\t\ttry{ return JSON.parse(s); } catch(e){}\n\t\treturn null;\n\t}\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532556042972","id": ".IndexEd","type": "js","data": "({\n  id:'cw.Photon.IndexEd',\n  inherit:['RT'],\n  params:{restyle:50},\n  lang:{},\n  HTML:[\n    '<div class=\"h30 bg-gray7 bbs lh160 pt1 xgray nw oh ell\">',\n      '<div class=\"fs90 fr pt1 tar\">',\n      \t'<span id=\"view-mi-mode\"></span>',\n    \t\t'<span id=\"btn-view-mi-close\" class=\"pr8 pl8 ml6 pseudolink tdn\" '\n    \t\t\t+'style=\"border-left:1px solid #0002;\" title=\"{BTN_PANEL_CLOSE}\">✕</span>',\n      '</div>',\n      '<div id=\"view-mi-name\" class=\"bolder pl8 oh nw ell\"></div>',\n    '</div>',\n    '<section id=\"view-mi-proxy\" class=\"bbs\">',\n    \t'<textarea id=\"view-mi-ed\" class=\"w100p\"></textarea>',\n    '</section>',\n    // Run, Save\n    '<section id=\"view-ed-buttons\" class=\"nw p8\" style=\"\">',\n    \t'<div class=\"fr\">',\n    \t\t'<button id=\"btn-view-mi-revert\" class=\"orange hide\" title=\"{TIP_REVERT}\">',\n          '<span class=\"fi-refresh fs95 o60\"></span>\\u00a0{BTN_REVERT}\\u00a0',\n        '</button>',\n    \t\t'<button id=\"btn-view-mi-del\" class=\"red hide ml2\" title=\"{TIP_DEL}\">',\n          '<span class=\"fi-trash fs95 o60\"></span>\\u00a0{BTN_DEL}',\n        '</button>',\n    \t'</div>',\n    \n      '<button id=\"btn-view-mi-run\" class=\"mr2 green\" disabled title=\"{TIP_RUN}\">',\n    \t\t'<span class=\"fi-play fs95 o60\"></span>\\u00a0{BTN_RUN}',\n    \t'</button>',\n    \n    \t'<button id=\"btn-view-mi-saveas\" class=\"mr2\" title=\"{TIP_SAVEAS}\">',\n    \t\t'<span class=\"fi-save fs95 o60\"></span>\\u00a0{BTN_SAVEAS}',\n    \t'</button>',\n      \n    '</section>',\n  ].join(''),\n  \n  init: function($o){\n  \tvar that = this;\n    $o.html(that.HTML.assign(that.lang));\n  },\n  \n  data:{\n    ddoc:\t\t\t'',\n    name:\t\t\t'',\n    type:\t\t\t'index',\n    mode:\t\t\t['javascript'],\n    text:\t\t\t'',\n    json:\t\t\t{},\n    errors:\t\t[],\n    stamp:\t\t0,\n    rev: \t\t\t''\n  },\n  \n  ui: { /* See tab */ },\n  \n  style:{\n  \t' .CodeMirror':'font-size:80%!important;padding:0px;min-height:300px;',\n    ' .CodeMirror-scroll':'min-height:300px;',\n    \n    ' #view-mi-proxy':function($o){\n    \treturn 'max-height:'+($o.parent().height() - 48 - 32)+'px;'\n    },\n    ' #view-mi-proxy.red .CodeMirror-linenumbers':'background-color: rgba(255, 200, 200, 0.75);',\n    \n    ' #btn-view-mi-del': 'display:none;',\n    ' #btn-view-mi-revert.hide + #btn-view-mi-del': 'display:inline-block;'\n  },\n  \n  die: function($o){\n    // Unmount niceScroll\n    var $v = $o.find('#view-mi-proxy'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n  },\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1532568184716","id": ".IndexEd.ui","type": "js","data": "({\n\t'#view-mi-ed':{\n    init: function($o){\n      var that = this,\n          mode = (that.data.mode)+'';\n      CodeMirror.fromTextArea($o[0], {\n        mode:\t\t\t\t\t\tmode,\n        lineNumbers:\t\tfalse,\n        viewportMargin:\t100,\n        scrollbarStyle:\tnull,\n        lineWrapping:\t\ttrue,\n        tabSize:\t\t\t\t2,\n        theme: \t\t\t\t\t'default',\n        readOnly:\t\t\t\tmode == 'json',\n        extraKeys: {\n          'Ctrl-R':\tfunction(){that.SaveIndex()},\n          'Cmd-R': \tfunction(){that.SaveIndex()}\n        }\n      });\n    },\n    bind:function(d,v){\n      var that = this,\n          mode = d.mode+'';\n      if (v!=null && mode != 'json') d.text = v;\n      if (mode == 'json') return JSON.stringify(d.json, null, '\\t');\n      return d.text;\n    }\n  },\n  \n  '#view-mi-proxy':{\n    init: function($o){\n      // init nicescroll\n      $o.niceScroll({\n        cursorcolor:'#234',\n        cursoropacitymin:0.07,\n        cursoropacitymax:0.4,\n      });\n    },\n    delay:200,\n    bind:function(d,v){\n      var that = this,\n          isO = Object.isObject,\n          isA = Object.isArray,\n          t = d.text,\n          j = null;\n      d.errors = [];\n      j = that.RT('jseval')('('+t+')');\n      if (j == null || !isO(j)) {\n        d.errors.push(that.lang.ERR_NO_JSON);\n      }\n      else if (!isO(j.index) || !isA(j.index.fields)) {\n        d.errors.push(that.lang.ERR_NO_INDEX);\n      }\n      else if (j.type && j.type!==\"json\") {\n      \td.errors.push(that.lang.ERR_NO_TYPE);\n      }\n      d.json = !d.errors.length?j:{};\n    },\n    watch:['#view-mi-ed'],\n    css:{\n      red:function(d){\n        return d.errors.length>0;\n      }\n    }\n  },\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532568399111","id": ".IndexEd.ui","type": "js","data": "({\n\t'#view-mi-mode':{\n    init: function($o){\n      $o.tags(this.lang.TAG_MODE)\n    },\n    bind:function(d,v){\n      var that = this;\n      if (v == null) return d.mode;\n      d.mode = v;\n      var cm = that.my.find('#view-mi-ed').next()[0].CodeMirror;\n      cm.setOption('mode', v+'');\n      cm.setOption('readOnly', 'json' == v+'');\n      that.my.recalc('#view-mi-ed');\n      return v;\n    }\n  },\n  \n  '#view-mi-name':{\n    delay:50,\n    bind:function(d,v){\n      var that = this,\n          m = that.RT('data'), mt = '';\n      if (!d.errors.length) {\n        if (! d.ddoc.split('/')[1]){\n        \tmt = 'Default Mango index';\n        }\n        else {\n        \t//mt = 'Index '+d.ddoc.split('/')[1].truncate(10,'right','…')+'\\u2009.\\u2009'+d.name;\n          mt = that.lang.TXT_TITLE.assign(d.name, d.ddoc.from(8))\n        }\n        return mt.escapeHTML();\n      }\n      return d.errors[0].escapeHTML();\n    },\n    css:{\n      'red':function(d){\n        return d.errors.length>0;\n      },\n      bolder:function(d){\n        return d.errors.length==0;\n      }\n    },\n    watch:['#view-mi-proxy']\n  },\n  \n  '#btn-view-mi-close':{\n  \tbind: function(d,v){\n    \tif (v==null) return;\n      this.RT('data').editor = false;\n      this.RT('my').check('#btn-viewcode');\n    }\n  },\n  \n  '#btn-view-mi-run':{\n    bind: function(d,v){\n      var that = this,\n          i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text},\n          l = that.lang,\n          t = '<span class=\"fi-play fs95 o60\"></span>\\u00a0',\n          dirty = d.text != (vi.source || '');\n      \n      if (v!=null && dirty && d.ddoc!='_design/') that.SaveIndex();\n      // else if (v!=null) that.RT('GetView')(true);\n      \n      return t+l.BTN_RUN;\n    },\n    delay:50,\n  \tcss:{\n      ':disabled':function(d){\n        if (\n          d.ddoc=='_design/' || \n          !!d.errors.length ||\n          (d.json.ddoc && d.json.ddoc != d.ddoc.from(8)) || \n          (d.json.name && d.json.name != d.name)\n        ) return true;\n        var that = this,\n            i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text};\n        return d.text == (vi.source || '');\n      }\n    },\n    watch:['#view-mi-proxy']\n  },\n  \n  '#btn-view-mi-revert':{\n    bind: function(d,v){\n      var that = this,\n          i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text};\n      if(v!=null){\n        d.text = vi.source;\n        //that.my.recalc('#view-mr-ed');\n      }\n    },\n    delay:50,\n  \tcss:{\n    \t'self:hide':function(d){\n      \tvar that = this,\n          i = '_idx/'+d.ddoc.from(8)+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {source:that.RT('DefaultMangoIdx').text};\n        return d.text == vi.source;\n      }\n    },\n    recalc:['#view-mi-ed'],\n    watch:['#view-mi-proxy']\n  },\n  \n  '#btn-view-mi-del':{\n    bind: function(d,v){\n    \tif (v==null) return;\n      var that = this,\n          l = that.lang;\n      \n      $.my.modal({\n        data:{\n          yes:\t\tl.BTN_DEL_YES,\n          yescss:\t'red',\n          no:\t\t\tl.BTN_DEL_NO, \n          cancel:\t'',\n          text:\t\tl.MSG_DEL_TEXT.assign(d.name.escapeHTML(), d.ddoc.from(8).escapeHTML())\n        },\n        manifest: that.Pho('Confirm'),\n        esc:\t\ttrue,\n        global: true,\n        screen:\ttrue\n      })\n      .then(function(res){\n      \tif (res.cmd !='yes') return;\n        that.DelIndex();\n      });\n    },\n    delay:20,\n  \tcss:{\n    \t'self:hide':function(d){\n      \tif (!d.ddoc.from(8)) return true;\n      }\n    },\n    watch:['#view-mi-proxy']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532645811045","id": ".IndexEd.ui","type": "js","data": "({\n\t'#btn-view-mi-saveas':{\n    css:{\n      ':disabled':function(d,v){\n      \treturn !!d.errors.length;\n      }\n    },\n    watch:['#view-mi-proxy'],\n    bind:function(d,v,$o){\n      var that = this;\n      \n      if (v==null) return;\n      \n      if ($o.data('modal')) {\n        $o.modal(true);\n        return;\n      }\n      \n      // Show select name dlg\n      $.my.modal({\n        data:$.extend(true, {}, that.RT(['data','mango'])),\n        manifest:{\n          data: $.extend(\n            true, \n            {_valid:true}, \n            d.ddoc!='_design/'\n            \t? d\n            \t: Object.reject(d, ['ddoc','name']),\n            Object.select(d.json,['ddoc','name'])\n          ),\n          Name:'',\n          init:function($o){\n            var self = this,\n                d = self.data;\n            $o.html($.my.formgen([\n              {row:'100%', label:'90px', labelCss:'my-label fs90 o80', rowCss:'my-row pt8'},\n              '<div class=\"mb8\">',\n              \t'<div id=\"ftitle\" class=\"xgray mb-8\">{TXT_NEW}</div>',\n              \t['{LBL_DDOC}','inp#mddoc.w100p',{plc:'{PLC_DDOC}'}, 'msg'],\n                ['{LBL_NEW}',\t'inp#mview.w100p',{plc:'{PLC_NEW}'}, 'msg'],\n              \t'<div id=\"fwarn\" class=\"xgray pt12 hide\"></div>',\n              '</div>',\n              '<div class=\"mt16 pt7 btd fs95\">',\n              \t[\n                  '', \n                  'btn#btn-new-ok.green.mr2',{val:'{BTN_NEW_OK}'},\n                \t'btn#btn-new-cancel',{val:'{BTN_NEW_CANCEL}'}\n                ],\n              '</div>'\n            ]).assign(that.lang))\n          },\n          ui:{\n            \n            '#mddoc':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.ddoc;\n                d.ddoc = v;\n              }\n            },\n            \n            '#mview':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.name;\n                d.name = v;\n              },\n              check: function(d,v){\n              \tif (!v) return that.lang.ERR_NEW_REQ;\n                if (v.indexOf('/')>-1) return that.lang.ERR_NEW_SLASH;\n              }\n            },\n            \n            '#fwarn':{\n              bind: function(d,v){\n                var n = '_design/'+d.ddoc.replace(/^_design\\//,'');\n            \t\tif (!that.RT(['Ddocs', n])) return that.lang.EXP_NDDOC;\n                if (that.RT(['Ddocs', n, 'views', d.name])) return that.lang.EXP_EXIST;\n                return that.lang.EXP_NVIEW;\n            \t},\n              watch:['#mddoc', '#mview'],\n            \tcss:{\n              \thide: function(d){\n                  d._valid = this.my.valid();\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n\n            '#btn-new-ok':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.commit();\n              },\n              watch:['#mddoc', '#mview'],\n              css:{\n              \t':disabled': function(d){\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n            '#btn-new-cancel':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.cancel();\n              }\n            }\n          },\n          style:{\n          \t'':'font-size:16px;line-height:22px;'\n          }\n        },\n        css:'p15',\n        global:true,\n        screen:true,\n        width:400,\n        esc:true,\n        focus:'#mview',\n        enter:true,\n        bound:0\n      })\n      .then(function(res){\n        if (!res._valid) {\n        \tcw.lib.note(that.lang.ERR_NO_NAME, 'error');\n          return;\n        }\n        \n        var idx = d.json;\n        if (res.ddoc) idx.ddoc = res.ddoc.replace(/^_design\\//,'');\n        if (!idx.ddoc) idx.ddoc = 'index_'+cw.lib.hash4('_design/'+Date.now());\n        if (res.name) idx.name = res.name;\n        \n        that.SaveIndex(idx);\n\n      });\n    },\n    events:'click.my'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532557955040","id": ".IndexEd.SaveIndex","type": "js","data": "(function (idx0, view0){\n  \n  var that = this,\n      d = that.data,\n      view = view0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n  \n  if (d.errors.length) {\n    cw.lib.note(that.lang.ERR_ERRDOC.assign(d.errors[0]), 'error');\n    return $.Deferred().reject(d.errors[0]);\n  }\n  \n  var idx = $.extend(true, {},  idx0 || d.json);\n        \n  if (!idx.ddoc) idx.ddoc = d.ddoc.from(8);\n  if (!idx.name) idx.name = d.name;\n  \n  // mark busy\n  that.RT('my').root().addClass('app-busy');\n  $.my.radio('appbusy',{id:tabid, busy:true});\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], '_index'], \n    method:\t\t\t\t'POST', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    data:\t\t\t\t\tJSON.stringify(idx), \n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    cw.lib.note(that.lang.MSG_SAVED.assign(idx.ddoc+'.'+idx.name), 'ok');\n  \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[d.ddoc]});\n    \n    if (d.ddoc.from(8) == idx.ddoc && d.name == idx.name) {\n      // Update current editor\n      that.my.check('#btn-view-mi-revert');\n      that.my.check('#btn-view-mi-run');\n    }\n    else {\n    \t// Switch view\n      that.RT('data').view = '_idx/'+idx.ddoc+'\\ufffd'+idx.name;\n      that.RT('my').trigger('#btn-reload','click.my');\n    }\n    \n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_FAIL.assign(idx.ddoc+'.'+idx.name, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532908915185","id": ".IndexEd.DelIndex","type": "js","data": "(function (ddoc0, idx0){\n  \n  var that = this,\n      d = that.data,\n      ddoc = ddoc0 || d.ddoc,\n      idx = idx0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], '_index', ddoc, 'json', idx], \n    method:\t\t\t\t'DELETE', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    cw.lib.note(that.lang.MSG_DEL_OK.assign(ddoc+'.'+idx), 'ok');\n    \n    // Switch index\n    that.RT('data').view = '';\n    that.RT('data').editor = false;\n    that.RT().Rows = [];\n    that.RT('my').recalc('#view-name');\n    that.RT('my').check('#view-name');\n    (function(){\n    \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[ddoc]});\n    }).debounce(100)();\n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_DEL_FAIL.assign(ddoc+'.'+idx, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532215252843","id": ".ViewEd","type": "js","data": "({\n  id:'cw.Photon.ViewEd',\n  inherit:['RT'],\n  params:{restyle:50},\n  lang:{},\n  HTML:[\n    '<div class=\"h30 bg-gray7 bbs lh160 pt1 xgray nw oh ell\">',\n      '<div class=\"fs90 fr pt1 tar\">',\n      \t'<span id=\"view-mr-mode\"></span>',\n    \t\t'<span id=\"btn-view-mr-close\" class=\"pr8 pl8 ml6 pseudolink tdn\" '\n    \t\t\t+'style=\"border-left:1px solid #0002;\" title=\"{BTN_PANEL_CLOSE}\">✕</span>',\n      '</div>',\n      '<div id=\"view-mr-name\" class=\"bolder pl8 oh nw ell\"></div>',\n    '</div>',\n    '<section id=\"view-mr-proxy\" class=\"bbs\">',\n    \t'<textarea id=\"view-mr-ed\" class=\"w100p\"></textarea>',\n    '</section>',\n    // Run, Save\n    '<section id=\"view-ed-buttons\" class=\"nw p8\" style=\"\">',\n    \t'<div class=\"fr\">',\n    \t\t'<button id=\"btn-view-mr-revert\" class=\"orange hide\" title=\"{TIP_REVERT}\">',\n          '<span class=\"fi-refresh fs95 o60\"></span>\\u00a0{BTN_REVERT}\\u00a0',\n        '</button>',\n    \t\t'<button id=\"btn-view-mr-del\" class=\"red hide ml2\" title=\"{TIP_DEL}\">',\n          '<span class=\"fi-trash fs95 o60\"></span>\\u00a0{BTN_DEL}',\n        '</button>',\n    \t'</div>',\n    \n      '<button id=\"btn-view-mr-run\" class=\"mr2 green\" disabled title=\"{TIP_RUN}\">',\n    \t\t'<span class=\"fi-play fs95 o60\"></span>\\u00a0{BTN_RUN}',\n    \t'</button>',\n    \n    \t'<button id=\"btn-view-mr-saveas\" class=\"mr2\" title=\"{TIP_SAVEAS}\">',\n        '<span class=\"fi-save fs95 o60\"></span>\\u00a0{BTN_SAVEAS}',\n      '</button>',\n      \n    '</section>',\n  ].join(''),\n  \n  init: function($o){\n  \tvar that = this;\n    $o.html(that.HTML.assign(that.lang));\n  },\n  \n  data:{\n    ddoc:'',\n    name:'',\n    type:'view',\n    mode:['map'],\n    map:'',\n    reduce:'',\n    json:{},\n    errors:[],\n    stamp:0,\n    rev:''\n  },\n  \n  ui: { /* See tab */ },\n  \n  style:{\n  \t' .CodeMirror':'font-size:80%!important;padding:0px;min-height:300px;',\n    ' .CodeMirror-scroll':'min-height:300px;',\n    \n    ' #view-mr-proxy':function($o){\n    \treturn 'max-height:'+($o.parent().height() - 48 - 32)+'px;'\n    },\n    ' #view-mr-proxy.red .CodeMirror-linenumbers':'background-color: rgba(255, 200, 200, 0.75);',\n    \n    ' #btn-view-mr-del': 'display:none;',\n    ' #btn-view-mr-revert.hide + #btn-view-mr-del': 'display:inline-block;'\n  },\n  \n  die: function($o){\n    // Unmount niceScroll\n    var $v = $o.find('#view-mr-proxy'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n  },\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1532217611823","id": ".ViewEd.ui","type": "js","data": "({\n  '#view-mr-ed':{\n    init: function($o){\n      var that = this,\n          d = that.data,\n          mode = (d.mode)+'';\n      CodeMirror.fromTextArea($o[0], {\n        mode:\t\t\t\t\t\tmode == 'json'?mode:d.language||'javascript',\n        lineNumbers:\t\ttrue,\n        viewportMargin:\t100,\n        scrollbarStyle:\tnull,\n        lineWrapping:\t\tfalse,\n        tabSize:\t\t\t\t2,\n        theme: \t\t\t\t\t'default',\n        readOnly:\t\t\t\tmode == 'json',\n        extraKeys: {\n          'Ctrl-R':\tfunction(){that.SaveDdoc()},\n          'Cmd-R': \tfunction(){that.SaveDdoc()}\n        }\n      });\n    },\n    bind:function(d,v){\n      var that = this,\n          mode = d.mode+'';\n      if (v!=null && mode != 'json') {\n        d[mode] = v;\n      }\n      if (mode == 'json') return JSON.stringify(d.json, null, '\\t');\n      return d[mode];\n    }\n  },\n\n  '#view-mr-proxy':{\n    init: function($o){\n      // init nicescroll\n      $o.niceScroll({\n        cursorcolor:'#234',\n        cursoropacitymin:0.07,\n        cursoropacitymax:0.4,\n      });\n    },\n    delay:200,\n    bind:function(d,v){\n      var that = this,\n          isF = Object.isFunction,\n          tm = d.map,\n          tr = d.reduce || '',\n          j = null,\n          reerl0 = /^[\\r\\n\\s\\t]*fun[\\r\\n\\s\\t]*\\([\\r\\n\\s\\t]*\\{/,\n          reerl1 = /\\.[\\r\\n\\s\\t]*$/,\n          builtins = ['_sum','_count','_min','_max','_stats','_sumsqr'],\n          err = d.errors = [];\n      \n      // ==== JS ====\n      \n      if (d.language == 'javascript') {\n        \n        // Map\n        j = that.RT('jseval')('('+tm+')');\n        if (j == null || !isF(j)) err.push(that.lang.ERR_NO_MAP);\n        \n\t\t\t\t// Reduce\n        if (tr && tr[0]!='_') {\n          j = null;\n          j = that.RT('jseval')('('+tr+')');\n          if (j == null || !isF(j)) err.push(that.lang.ERR_NO_REDUCE);\n        }\n        if (tr[0]=='_' && builtins.indexOf(tr.trim()) == -1) err.push(that.lang.ERR_F_BUILTIN);\n      }\n      \n      // ==== ERLANG ====\n      \n      if (d.language == 'erlang') {\n        \n        // Map\n        if (!reerl0.test(tm) || !reerl1.test(tm)) err.push(that.lang.ERR_NO_MAP);\n        \n        // Reduce\n        if (tr[0]=='_' && builtins.indexOf(tr.trim()) == -1) err.push(that.lang.ERR_F_BUILTIN);\n        else if (tr && tr[0]!='_' && (!reerl0.test(tr) || !reerl1.test(tr))) err.push(that.lang.ERR_NO_REDUCE);\n      }\n      \n      // mount\n      \n      d.json = {};\n      if (!d.errors.length) {\n        if (tm.trim()) d.json.map = tm;\n        if (tr.trim()) d.json.reduce = tr;\n      }\n    },\n    watch:['#view-mr-ed'],\n    css:{\n      red:function(d){\n        return d.errors.length>0;\n      }\n    }\n  },\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532230948508","id": ".ViewEd.ui","type": "js","data": "({\n  '#view-mr-mode':{\n    init: function($o){\n      $o.tags(this.lang.TAG_MODE)\n    },\n    bind:function(d,v){\n      var that = this;\n      if (v == null) return d.mode;\n      d.mode = v;\n      var cm = that.my.find('#view-mr-ed').next()[0].CodeMirror;\n      cm.setOption('mode', 'json' == v+''?'json':d.language);\n      cm.setOption('readOnly', 'json' == v+'');\n      that.my.recalc('#view-mr-ed');\n      return v;\n    }\n  },\n  \n  '#view-mr-name':{\n    delay:50,\n    bind:function(d,v){\n      var that = this,\n          m = that.RT('data');\n      if (!d.errors.length) {\n        \n        //var mt = '_d/'+d.ddoc.split('/')[1].truncate(10,'right','…')+'\\u2009.views.'+d.name;\n        var mt = that.lang.TXT_TITLE[d.language].assign(d.ddoc.from(8), d.name);\n        return mt.escapeHTML();\n      }\n      return d.errors[0].escapeHTML();\n    },\n    css:{\n      'red':function(d){\n        return d.errors.length>0;\n      },\n      bolder:function(d){\n        return d.errors.length==0;\n      }\n    },\n    watch:['#view-mr-proxy']\n  },\n  \n  '#btn-view-mr-close':{\n  \tbind: function(d,v){\n    \tif (v==null) return;\n      this.RT('data').editor = false;\n      this.RT('my').check('#btn-viewcode');\n    }\n  },\n  \n  '#btn-view-mr-run':{\n    bind: function(d,v){\n      var that = this,\n          i = d.ddoc+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {},\n          l = that.lang,\n          t = '<span class=\"fi-play fs95 o60\"></span>\\u00a0',\n          dirty = d.map != (vi.map || '') || d.reduce != (vi.reduce || '');\n      \n      if (v!=null && dirty) that.SaveDdoc();\n      else if (v!=null) that.RT('GetView')(true);\n      \n      return t+l.BTN_SAVE;\n    },\n    delay:50,\n  \tcss:{\n      ':disabled':function(d){\n        if (d.errors.length) return true;\n        var that = this,\n            i = d.ddoc+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {},\n            l = that.lang,\n            t = '<span class=\"fi-play fs95 o60\"></span>\\u00a0',\n            dirty = d.map != (vi.map || '') || d.reduce != (vi.reduce || '');\n        return !dirty;\n      },\n      'self:green':function(d){\n        if (d.errors.length) return false;\n      \tvar that = this,\n            i = d.ddoc+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {};\n        return d.map != (vi.map || '') || d.reduce != (vi.reduce || '');\n      }\n    },\n    watch:['#view-mr-proxy']\n  },\n  \n  '#btn-view-mr-revert':{\n    bind: function(d,v){\n      var that = this,\n          i = d.ddoc+'\\ufffd'+d.name,\n          vi = that.RT(['Vi',i, 'view']) || {};\n      if(v!=null){\n        d.map = (vi.map || '');\n        d.reduce = (vi.reduce || '');\n        //that.my.recalc('#view-mr-ed');\n      }\n    },\n    delay:50,\n  \tcss:{\n    \t'self:hide':function(d){\n      \tvar that = this,\n            i = d.ddoc+'\\ufffd'+d.name,\n            vi = that.RT(['Vi',i, 'view']) || {};\n        return d.map == (vi.map || '') && d.reduce == (vi.reduce || '');\n      }\n    },\n    recalc:['#view-mr-ed'],\n    watch:['#view-mr-proxy']\n  },\n  \n  '#btn-view-mr-del':{\n    bind: function(d,v){\n    \tif (v==null) return;\n      var that = this,\n          l = that.lang;\n      \n      $.my.modal({\n        data:{\n          yes:\t\tl.BTN_DEL_YES,\n          yescss:\t'red',\n          no:\t\t\tl.BTN_DEL_NO, \n          cancel:\t'',\n          text:\t\tl.MSG_DEL_TEXT.assign(d.name.escapeHTML(), d.ddoc.escapeHTML())\n        },\n        manifest: that.Pho('Confirm'),\n        esc:\t\ttrue,\n        global: true,\n        screen:\ttrue\n      })\n      .then(function(res){\n      \tif (res.cmd !='yes') return;\n        that.DelView();\n      });\n    },\n    delay:20,\n  \tcss:{\n    \t'self:hide':function(d){\n      \tif (!d.ddoc.from(8)) return true;\n      }\n    },\n    watch:['#view-mr-proxy']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532383492385","id": ".ViewEd.ui","type": "js","data": "({\n\t'#btn-view-mr-saveas':{\n    css:{\n      ':disabled':function(d,v){\n      \treturn !!d.errors.length;\n      }\n    },\n    watch:['#view-mr-proxy'],\n    bind:function(d,v,$o){\n      var that = this;\n      \n      if (v==null) return;\n      \n      if ($o.data('modal')) {\n        $o.modal(true);\n        return;\n      }\n      \n      // Show select name dlg\n      $.my.modal({\n        data:$.extend(true, {}, that.RT(['data','mango'])),\n        manifest:{\n          data: $.extend(true, {_valid:true}, d),\n          Name:'',\n          init:function($o){\n            var self = this,\n                d = self.data;\n            $o.html($.my.formgen([\n              {row:'100%', label:'90px', labelCss:'my-label fs90 o80', rowCss:'my-row pt8'},\n              '<div class=\"mb8\">',\n              \t'<div id=\"ftitle\" class=\"xgray mb-8\">{TXT_NEW}</div>',\n              \t['{LBL_DDOC}','inp#mddoc.w100p',{plc:'{PLC_DDOC}'}, 'msg'],\n                ['{LBL_NEW}',\t'inp#mview.w100p',{plc:'{PLC_NEW}'}, 'msg'],\n              \t'<div id=\"fwarn\" class=\"xgray pt12 hide\"></div>',\n              '</div>',\n              '<div class=\"mt16 pt7 btd fs95\">',\n              \t[\n                  '', \n                  'btn#btn-new-ok.green.mr2',{val:'{BTN_NEW_OK}'},\n                \t'btn#btn-new-cancel',{val:'{BTN_NEW_CANCEL}'}\n                ],\n              '</div>'\n            ]).assign(that.lang))\n          },\n          ui:{\n            \n            '#mddoc':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.ddoc;\n                d.ddoc = v;\n              }\n            },\n            \n            '#mview':{\n            \tbind: function(d,v){\n              \tif (v==null) return d.name;\n                d.name = v;\n              },\n              check: function(d,v){\n              \tif (!v) return that.lang.ERR_NEW_REQ;\n                if (v.indexOf('/')>-1) return that.lang.ERR_NEW_SLASH;\n                //if (v.indexOf(' ')>-1) return that.lang.ERR_NEW_SPACE;\n              }\n            },\n            \n            '#fwarn':{\n              bind: function(d,v){\n                var n = d.ddoc.to(8) != '_design/'?'_design/'+d.ddoc:d.ddoc;\n            \t\tif (!that.RT(['Ddocs', n])) return that.lang.EXP_NDDOC;\n                if ( that.RT(['Ddocs', n, 'views', d.name])) return that.lang.EXP_EXIST;\n                return that.lang.EXP_NVIEW;\n            \t},\n              watch:['#mddoc', '#mview'],\n            \tcss:{\n              \thide: function(d){\n                  d._valid = this.my.valid();\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n\n            '#btn-new-ok':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.commit();\n              },\n              watch:['#mddoc', '#mview'],\n              css:{\n              \t':disabled': function(d){\n                  if (!d._valid) return true;\n                }\n              }\n            },\n            \n            '#btn-new-cancel':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.cancel();\n              }\n            }\n          },\n          style:{\n          \t'':'font-size:16px;line-height:22px;'\n          }\n        },\n        css:'p15',\n        global:true,\n        screen:true,\n        width:400,\n        esc:true,\n        focus:'#mview',\n        enter:true,\n        bound:0\n      })\n      .then(function(res){\n        if (!res._valid) {\n        \tcw.lib.note(that.lang.ERR_NO_NAME, 'error');\n          return;\n        }\n        \n        res.ddoc = res.ddoc.to(8) != '_design/'?'_design/'+res.ddoc:res.ddoc;;\n        var ddoc = that.RT(['Ddocs', res.ddoc]);\n        \n        if (!ddoc) ddoc = {\n        \t_id:\t\t\tres.ddoc,\n          language:\td.language,\n          views:\t\t{}\n        };\n        \n        that.SaveDdoc(ddoc, res.name)\n        .then(function(){\n        \tthat.RT('data').view = res.ddoc+'\\ufffd'+res.name;\n          that.RT('my').trigger('#btn-reload','click.my');\n        });\n\n      });\n    },\n    events:'click.my'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532307883659","id": ".ViewEd.SaveDdoc","type": "js","data": "(function (ddoc0, view0){\n  \n  var that = this,\n      d = that.data,\n      view = view0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n  \n  if (d.errors.length) {\n    cw.lib.note(that.lang.ERR_ERRDOC.assign(d.errors[0]), 'error');\n    return $.Deferred().reject(d.errors[0]);\n  }\n  \n  var ddoc = $.extend(true, {}, ddoc0 || that.RT(['Ddocs',d.ddoc]));\n        \n  if (d.map.trim()) cw.lib.unmask(ddoc, [d.map], [['views', view, 'map']]);\n  else if (cw.lib.getref(ddoc, ['views', view, 'map'])) ddoc.views[view].map = undefined;\n\n  if (d.reduce.trim()) cw.lib.unmask(ddoc, [d.reduce], [['views', view, 'reduce']]);\n  else if (cw.lib.getref(ddoc, ['views', view, 'reduce'])) ddoc.views[view].reduce = undefined;\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], ddoc._id], \n    method:\t\t\t\t'PUT', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    data:\t\t\t\t\tJSON.stringify(ddoc), \n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    d.rev = res.rev;\n    cw.lib.note(that.lang.MSG_SAVED.assign(ddoc._id), 'ok');\n  \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[ddoc._id]});\n    that.my.check('#btn-view-mr-revert');\n    that.my.check('#btn-view-mr-run');\n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_FAIL.assign(ddoc._id, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1532914928829","id": ".ViewEd.DelView","type": "js","data": "(function (ddoc0, view0){\n  \n  var that = this,\n      d = that.data,\n      view = view0 || d.name,\n      path = that.RT(['data','path']),\n      tabid = that.RT(['data','tabid']);\n  \n  if (d.errors.length) {\n    cw.lib.note(that.lang.ERR_ERRDOC.assign(d.errors[0]), 'error');\n    return $.Deferred().reject(d.errors[0]);\n  }\n  \n  var ddoc = $.extend(true, {}, ddoc0 || that.RT(['Ddocs',d.ddoc]));\n        \n  if (cw.lib.getref(ddoc, ['views', view])) delete ddoc.views[view];\n\n  var r = that.Req({\n    url:\t\t\t\t\t[path[0], ddoc._id], \n    method:\t\t\t\t'PUT', \n    headers:\t\t\t{'X-Couch-Full-Commit':'true'},\n    contentType:\t'application/json',\n    data:\t\t\t\t\tJSON.stringify(ddoc), \n    dataType:\t\t\t'json'\n  })\n  .then(function(res){\n    d.rev = res.rev;\n    \n    cw.lib.note(that.lang.MSG_DEL_OK.assign(ddoc._id+'.'+view), 'ok');\n    \n    // Switch index\n    that.RT('data').view = '';\n    that.RT('data').editor = false;\n    that.RT().Rows = [];\n    that.RT('my').recalc('#view-name');\n    that.RT('my').check('#view-name');\n    (function(){\n    \t$.my.radio('dbupdate', {db:path[0], cmd:'write', docs:[ddoc._id]});\n    }).debounce(100)();\n\n  })\n  .fail(function(code, err) {\n  \tcw.lib.note(that.lang.MSG_DEL_FAIL.assign(ddoc._id+'.'+view, code, err), 'error');\n  })\n  .always(function(){\n  \tthat.RT('my').root().removeClass('app-busy');\n  \t$.my.radio('appbusy',{id:tabid, busy:false});\n  });\n  \n  return r;\n\t\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1531953370583","id": ".MangoEd","type": "js","data": "({\n  id:'cw.Photon.MangoEd',\n  inherit:['RT'],\n  params:{restyle:50},\n  lang:{},\n  HTML:[\n    '<div class=\"h30 bg-gray7 bbs lh160 pt1 xgray nw oh ell\">',\n      '<div class=\"fs90 tar fr pt1\">',\n      \t'<span id=\"view-mango-mode\"></span>',\n    \t\t'<span id=\"btn-view-mango-close\" class=\"pr8 pl8 ml6 pseudolink tdn\" '\n    \t\t\t+'style=\"border-left:1px solid #0002;\" title=\"{BTN_PANEL_CLOSE}\">✕</span>',\n      '</div>',\n      '<div id=\"view-mango-name\" class=\"bolder pl8 oh nw ell\"></div>',\n    '</div>',\n    '<section id=\"view-mango-proxy\" class=\"bbs\">',\n    \t'<textarea id=\"view-mango-ed\" class=\"w100p\"></textarea>',\n    '</section>',\n    // Run, Save\n    '<section id=\"view-mango-buttons\" class=\"nw p8\" style=\"\">',\n    \t'<div class=\"fr\">',\n    \t\t'<button id=\"btn-view-mango-revert\" class=\"hide\" title=\"{TIP_RESET}\">',\n          '<span class=\"fi-refresh fs95 o60\"></span>\\u00a0{BTN_RESET}\\u00a0',\n        '</button>',\n    \t\t'<button id=\"btn-view-mango-del\" class=\"hide red\" title=\"{TIP_DEL}\">',\n          '<span class=\"fi-trash fs95 o60\"></span>\\u00a0{BTN_DEL}',\n        '</button>',\n    \t'</div>',\n    \n      '<button id=\"btn-view-mango-run\" class=\"mr2 green\" title=\"{TIP_RUN}\">',\n    \t\t'<span class=\"fi-play fs95 o60\"></span>\\u00a0{BTN_RUN}',\n    \t'</button>',\n    \n    \t'<button id=\"btn-view-mango-stash\" class=\"mr2\" title=\"{TIP_SAVE}\">',\n        '<span class=\"fi-save fs95 o60\"></span>\\u00a0{BTN_SAVE}',\n      '</button>',\n    \n    \t'<button id=\"btn-view-mango-explain\" class=\"mr2\" title=\"{TIP_EXPL}\">',\n        '<span class=\"fi-megaphone fs95 o60\"></span>\\u00a0{BTN_EXPL}',\n      '</button>',\n      \n    '</section>',\n  ].join(''),\n  \n  init: function($o){\n  \tvar that = this;\n    $o.html(that.HTML.assign(that.lang));\n    that.Text = that.data.text;\n  },\n  \n  data:{\n    name:'Untitled query',\n    type:'mango',\n    text:'({\\n\\t// Write your mango query, JS syntax allowed\\n})',\n    json:{},\n    errors:[],\n    stamp:0\n  },\n  Mode:['javascript'],\n  Text:'',\n  ui: { /* See tab */ },\n  \n  style:{\n  \t' .CodeMirror':'font-size:80%!important;padding:4px;min-height:300px;',\n    \n    ' #view-mango-proxy':function($o){\n    \treturn 'max-height:'+($o.parent().height() - 48 - 32)+'px;'\n    },\n    ' #view-mango-proxy.red .CodeMirror-linenumbers':'background-color: rgba(255, 200, 200, 0.75);'\n  },\n  \n  die: function($o){\n    // Unmount niceScroll\n    var $v = $o.find('#view-mango-proxy'),\n        f = $v.getNiceScroll;\n    if (typeof f == 'function') f().remove();\n  },\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1532050502913","id": ".MangoEd.ui","type": "js","data": "({\n  '#view-mango-ed':{\n    init: function($o){\n      var that = this,\n          mode = (that.Mode)+'';\n      CodeMirror.fromTextArea($o[0], {\n        mode:\t\t\t\t\t\tmode,\n        lineNumbers:\t\tfalse,\n        viewportMargin:\t100,\n        scrollbarStyle:\tnull,\n        lineWrapping:\t\ttrue,\n        tabSize:\t\t\t\t2,\n        theme: \t\t\t\t\t'default',\n        readOnly:\t\t\t\tmode == 'json',\n        extraKeys: {\n          'Ctrl-R':\tfunction(){that.RT('GetView')(true)},\n          'Cmd-R': \tfunction(){that.RT('GetView')(true)}\n        }\n      });\n    },\n    bind:function(d,v){\n      var that = this,\n          mode = that.Mode+'';\n      if (v!=null && mode != 'json') d.text = v;\n      if (mode == 'json') return JSON.stringify(d.json, null, '\\t');\n      return d.text;\n    }\n  },\n\n  '#view-mango-proxy':{\n    init: function($o){\n      // init nicescroll\n      $o.niceScroll({\n        cursorcolor:'#234',\n        cursoropacitymin:0.07,\n        cursoropacitymax:0.4,\n      });\n    },\n    delay:200,\n    bind:function(d,v){\n      var that = this,\n          isO = Object.isObject,\n          isA = Object.isArray,\n          t = d.text,\n          j = null;\n      d.errors = [];\n      j = that.RT('jseval')('('+t+')');\n      if (j == null || !isO(j)) {\n        d.errors.push(that.lang.ERR_NO_JSON);\n      }\n      else if (!isO(j.selector)) {\n        d.errors.push(that.lang.ERR_NO_SELECTOR);\n      }\n      d.json = !d.errors.length?j:{};\n    },\n    watch:['#view-mango-ed'],\n    css:{\n      red:function(d){\n        return d.errors.length>0;\n      }\n    }\n  },\n\n  '#btn-view-mango-run':{\n    bind: function(d,v){\n      var that = this;\n      if (v==null) return;\n      that.RT('GetView')(true);\n    },\n    css:{\n      ':disabled':function(d){\n        return d.errors.length > 0 || this.Text == d.text;\n      }\n    },\n    watch:['#view-mango-proxy']\n  },\n\n  '#btn-view-mango-explain':{\n    bind: function(d,v,$o){\n      var that = this;\n      if (v==null) return;\n      //that.RT('GetView')(true);\n      var $p = that.my.find('#view-mango-proxy'),\n          h = $p.outerHeight() - 3,\n          w = $p.outerWidth() - 32;\n      if ($o.data('modal')) {\n      \t$o.modal(true);\n        return;\n      }\n      $o.modal({\n        css:'p15 pt0', align:'bottom:140%', nose:'bottom',\n      \tdata:{t:'Loading...', h:h},\n        width: w, \n        drag:'#dragger',\n        bound: '0',\n        root:'',\n        manifest:{\n          init:function($o){\n            var self = this;\n          \t$o.html('<div id=\"dragger\"></div><textarea id=\"explain\" class=\"w100p\"></textarea>');\n            $o.then(function(){\n              that.Req({\n                url:\t\t[that.RT('data').path[0],'_explain'],\n                headers:\t{accept:'application/json','Content-type':'application/json'},\n                method:\t'post',\n                data:\t\tJSON.stringify(d.json)\n              })\n              .then((function(res){\n                self.data.t = JSON.stringify(res, null, '  ');\n                self.my.recalc('#explain')\n              }).debounce(50))\n              .fail(function(code, err, res){\n                self.data.t = JSON.stringify(err, null, '  ');\n                self.my.recalc('#explain');\n              })\n            });\n          },\n          ui:{\n          \t'#explain':{\n            \tbind:'t',\n              init: function($o){\n              \tCodeMirror.fromTextArea($o[0], {\n                  mode:\t\t\t\t\t\t'json',\n                  lineNumbers:\t\tfalse,\n                  scrollbarStyle:\tnull,\n                  lineWrapping:\t\ttrue,\n                  tabSize:\t\t\t\t2,\n                  theme: \t\t\t\t\t'default',\n                  readOnly:\t\t\t\ttrue\n                });\n              }\n            }\n          },\n        \tstyle:{\n            ' #dragger':'width:100%;height:15px;cursor:move;',\n          \t' .CodeMirror':function(){return 'padding:0px; height:'+this.data.h+'px!important;'}\n          }\n        }\n      })\n    },\n    css:{\n      ':disabled':function(d){\n        return false || d.errors.length > 0;\n      }\n    },\n    watch:['#view-mango-proxy']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532211640712","id": ".MangoEd.ui","type": "js","data": "({\n  '#view-mango-mode':{\n    init: function($o){\n      $o.tags(this.lang.TAG_MODE)\n    },\n    bind:function(d,v){\n      var that = this;\n      if (v == null) return that.Mode;\n      that.Mode = v;\n      var cm = that.my.find('#view-mango-ed').next()[0].CodeMirror;\n      cm.setOption('mode', v+'');\n      cm.setOption('readOnly', 'json' == v+'');\n      that.my.recalc('#view-mango-ed');\n      return v;\n    }\n  },\n\n  '#view-mango-name':{\n    delay:250,\n    bind:function(d,v){\n      var that = this,\n          m = that.RT('data');\n      that.Pho('Ls')('Mango.'+m.path[0], m.mango);\n      if (!d.errors.length) {\n        var mt = d.name+'';\n        if ('Default query' == mt) return that.lang.TXT_TITLE0;\n        return that.lang.TXT_TITLE.assign(mt.escapeHTML());\n      }\n      return d.errors[0].escapeHTML();\n    },\n    css:{\n      'red':function(d){\n        return d.errors.length>0;\n      },\n      bolder:function(d){\n        return d.errors.length==0;\n      }\n    },\n    watch:['#view-mango-proxy']\n  },\n  \n  '#btn-view-mango-close':{\n  \tbind: function(d,v){\n    \tif (v==null) return;\n      this.RT('data').editor = false;\n      this.RT('my').check('#btn-viewcode');\n    }\n  },\n  \n  '#btn-view-mango-del':{\n  \tcss:{\n    \t'self:hide':function(){\n      \treturn this.RT(['data','mango','active']) =='Default query';\n      },\n    },\n  \tbind: function(d,v){\n    \tif (v==null) return;\n      var that = this,\n          m = that.RT(['data','mango']);\n      m.active = 'Default query';\n      m.query.remove(function(e){\n      \treturn e.name == d.name;\n      });\n      that.RT('data').view = '_find\\ufffdDefault query';\n      that.RT('GetViews')(true, false, true);\n      that.RT('my').redraw.debounce(50)();\n    }\n  },\n  \n  '#btn-view-mango-revert':{\n    bind: function(d,v){\n      var that = this;\n      if(v!=null){\n        d.text = that.RT('DefaultMangoQry').text\n      }\n    },\n    delay:100,\n  \tcss:{\n      'self:hide':function(d){\n      \treturn d.name != 'Default query';\n      },\n    \t':disabled':function(d){\n      \tvar that = this;\n        return d.text == that.RT('DefaultMangoQry').text;\n      }\n    },\n    recalc:['#view-mango-ed'],\n    watch:['#view-mango-proxy']\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1532051599489","id": ".MangoEd.ui","type": "js","data": "({\n\t'#btn-view-mango-stash':{\n    css:{\n    \t/*'self:hide':function(){\n      \treturn this.RT(['data','mango','active']) !='Default query';\n      },*/\n      ':disabled':function(d,v){\n      \tif (d.name != 'Default query') return this.Text == d.text;\n        return d.text == this.RT('DefaultMangoQry').text;\n      }\n    },\n    watch:['#view-mango-proxy'],\n    bind:function(d,v,$o){\n      var that = this,\n          active = that.RT(['data','mango','active']),\n        \tt = '<span class=\"fi-save fs95 o60\"></span>\\u00a0'+that.lang.BTN_SAVE;\n      \n      if (v==null) return t;\n      \n      if ($o.data('modal')) {\n        $o.modal(true);\n        return t;\n      }\n      \n      // Show select name dlg\n      that.my.modal('#btn-view-mango-stash', {\n        data:$.extend(true, {_new:{}}, that.RT(['data','mango'])),\n        manifest:{\n          data:{},\n          Name:'',\n          Qry:[],\n          init:function($o){\n            var self = this,\n                d = self.data;\n            self.Qry = Object.clone(d.query, true);\n            $o.html($.my.formgen([\n              '<div class=\"mb8\">',\n              \t'<div id=\"ftitle\" class=\"xgray\">{TXT_STASH}</div>',\n                ['','inp#mtitle.w100p',{plc:'{PLC_STASH}'}, 'msg'],\n              '</div>',\n              '<div class=\"mt15 pt15 btd fs95\">',\n              \t[\n                  '', \n                  //'<div class=\"fr\">', 'btn#btn-stash-cancel',{val:'{BTN_STASH_CANCEL}'}, '</div>',\n                  'btn#btn-stash-ok.green.mr2',{val:'{BTN_STASH_OK}'},\n                \t//'btn#btn-stash-ok1',{val:'{BTN_STASH_OK1}'}\n                ],\n              '</div>'\n            ]).assign(that.lang))\n          },\n          ui:{\n            '#mtitle':{\n              bind:function(d,v){\n              \tvar self = this;\n                if (v == null) return self.Name;\n                self.Name = v.compact();\n                if (self.Name.length>2 && self.Name.length<31) {\n                  \n                  var qry = Object.clone(d.query.find(function(e){\n                    return e.name == d.active\n                  }), true);\n\n                \tqry.name = self.Name;\n                  qry.stamp = Date.now();\n                  d._new = qry;\n                }\n                return v;\n              },\n            \tcheck:function(d,v){\n                var self = this;\n                if (!v.compact()) return that.lang.ERR_STASH_REQ;\n              \tif (v.compact().length<3 || v.length>30) return that.lang.ERR_STASH_LEN;\n                if (this.Qry.find(function(e){return e.name == v})) return that.lang.ERR_STASH_EXIST;\n              }\n            },\n            '#btn-stash-ok':{\n            \tbind: function(d,v){\n              \tif (v!=null) this.my.commit();\n              },\n              watch:['#mtitle'],\n              css:{\n              \t':disabled':function(){\n                \treturn !this.my.valid();\n                }\n              }\n            },\n            /*'#btn-stash-ok1':{\n            \tbind: function(d,v){\n              \tif (v!=null) {\n                  d.active = that.RT('DefaultMangoQry').name;\n                \tthis.my.commit();\n                }\n              }\n            }*/\n          },\n          style:{\n          \t//'':'font-size:16px;line-height:22px;'\n          }\n        },\n        css:'p15',\n        global:true,\n        screen:true,\n        width:400,\n        esc:true,\n        enter:true,\n        bound:20\n      })\n      .then(function(res){\n        res.query.push(res._new);\n        res.active = res._new.name;\n      \t$.extend(that.RT('data').mango, Object.reject(res,'_new'));\n        that.RT('data').view = '_find\\ufffd'+res.active;\n        that.RT('GetViews')(true, false, true);\n        that.RT('my').redraw();\n      });\n      return t;\n    },\n    events:'click.my'\n  }\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504126299140","id": ".Confirm","type": "js","data": "({\n\tid:'cw.Photon.Confirm',\n\tparams:{\n\t\tdelay:5, \n\t\t//width:450\n\t},\n\tdata:{\n\t\t\n\t\tcmd:\"\",\n\t\t\n\t\ttext:\"\",\n\t\tcss:\"xgray\",\n\t\tyes:\"Yes\",\n\t\tno:\"No\",\n\t\tcancel:\"Cancel\",\n\t\tyescss:'green',\n\t\tnocss:''\n\t},\n\tinit: function ($o, form) {\n\t\tvar d=form.data;\n\t\t$o.formgen([\n\t\t\t'<div class=\"'+d.css+'\">'+d.text+'</div>',\n\t\t\t{\n\t\t\t\tlabel:\t'70px', \n\t\t\t\trow:\t\tform.params.width+'px', \n\t\t\t\trowCss:\t'my-row mt15 pt15 mb-5 xgray btd'\n\t\t\t},\n\t\t\t[\n\t\t\t\t'', \n\t\t\t\t'spn#btn-yes.button.'+(d.yescss?d.yescss+'.':'')+'mr5.hide',\t{txt:(d.yes+'')}, \n\t\t\t\t'spn#btn-no.button.'+(d.nocss?d.nocss+'.':'')+'mr5.hide',\t\t\t{txt:(d.no+'')}, \n\t\t\t\t'spn#btn-cancel.button.fr.hide',\t\t\t{txt:(d.cancel+'')}\n\t\t\t]\n\t\t]);\n\t},\n\tui:{\n\t\t'#btn-yes':{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"yes\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.yes}\n\t\t\t}\n\t\t},\n    \n\t\t'#btn-no':{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"no\";\n\t\t\t\t\t$o.trigger(\"commit\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.no}\n\t\t\t}\n\t\t},\n    \n\t\t'#btn-cancel':{\n\t\t\tbind: function(d,v,$o){\n\t\t\t\tif (v!=null) {\n\t\t\t\t\td.cmd=\"cancel\";\n\t\t\t\t\t$o.trigger(\"cancel\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents:\"click.my\",\n\t\t\tcss:{\n\t\t\t\t\"self:hide\": function(d){ return !d.cancel}\n\t\t\t}\n\t\t}\n\t},\n  style:{\n  \t'':'font-size:16px;line-height:22px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1503602769297","id": ".Tab","type": "js","data": "({\n\tid:'cw.Photon.Tab',\n\tlang:{},\n\tdata:{\n\t\t//id:'',name:'',path:'',active:false,error:false\n\t\tid:'',\n\t\tname:'',\n\t\ttype:'',\n\t\thash0:'', hash1:'',\n\t\tactive:false,\n\t\tpath:[],\n\t\terror:false,\n\t\trun:false\n\t},\n \tinit:function($o){\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang));\n\t},\n\tui:{\n\t\t'#l-tabname':{\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tvar that = this;\n\t\t\t\tthat.my.find('a#l-tabname').attr('href','#'+that.p2u(d.path||[]).join('/'));\n\t\t\t\tthat.my.root().toggleClass('active',!!d.active);\n\t\t\t\treturn d.name.escapeHTML();\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\tsmaller:function(d){return d.name.length > 20}\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t},\n\t\t'#l-tabstate':{\n\t\t\tcss:{\n\t\t\t\thide:function(d){return !d.error && d.hash0==d.hash1},\n\t\t\t\tred:function(d){return !!d.error;}\n\t\t\t},\n\t\t\twatch:'#l-tabname'\n\t\t},\n\t\t'#btn-tabclose':{\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v!=null) this.my.trigger('#btn-tabclose', 'tabclose', d.id);\n\t\t\t},\n\t\t\tevents:'click.my'\n\t\t},\n\t\t'#tab-proxy':{\n\t\t\tbind:function(){},\n\t\t\tlisten:{\n\t\t\t\tappbusy:function(d,v){\n\t\t\t\t\tif (!Object.isObject(v) || v.id != d.id) return;\n\t\t\t\t\tthis.my.root().toggleClass('tab-busy',!!v.busy);\n\t\t\t\t},\n\t\t\t\tpathchange: function (d,v) {\n\t\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\t\tvar that = this,\n\t\t\t\t\t\t\tnewpath = v.path.slice(0);\n\t\t\t\t\tif (v.id != d.id) {\n\t\t\t\t\t\t// other tab changed path, check is this tab a dup\n\t\t\t\t\t\tif (newpath.join('\\ufffd') != d.path.join('\\ufffd')) return;\n\t\t\t\t\t\t// decide should we close\n\t\t\t\t\t\tif (d.hash0 == d.hash1) that.Pho('Close')({tabid:d.id, enforce:true});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// it is all about this tab\n\t\t\t\t\t\td.path = newpath;\n\t\t\t\t\t\td.name = v.title || d.name;\n\t\t\t\t\t\tif(that.Pho('_compiled') && d.active) {\n\t\t\t\t\t\t\tlocation.replace('#'+that.p2u(newpath).join('/'));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthat.my.check('#l-tabname');\t\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treload: function(d,v){\n\t\t\t\t\tif (!Object.isObject(v)) return;\n\t\t\t\t\tif (v.id != d.id) return;\n\t\t\t\t\tvar that = this,\n\t\t\t\t\t\t\tnewpath = v.path.slice(0);\n\t\t\t\t\t// Search for app DOM node\n\t\t\t\t\tvar $app = $('#l-apps>#app-'+v.id);\n\n\t\t\t\t\tif ($app.length && $app.is('.my-form')) {\n\t\t\t\t\t\t$app.my('remove');\n\t\t\t\t\t\t$app.remove();\n\t\t\t\t\t\td.run = false;\n\t\t\t\t\t\td.error = false;\n\t\t\t\t\t\td.hash0 = d.hash1 = '';\n\t\t\t\t\t\tif (d.active) that.Pho('Switch')(newpath);\n\t\t\t\t\t}\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tHTML:[\n\t\t'<a href=\"\" id=\"l-tabname\"></a>',\n\t\t'<div id=\"l-tabstate\" class=\"l-tabmark\">•</div>',\n\t\t'<div id=\"btn-tabclose\" class=\"l-tabmark\" title=\"{BTN_CLOSETAB}\">✕</div>',\n\t\t'<div id=\"tab-proxy\" class=\"hide\"></div>'\n\t].join('')\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1512869022767","id": ".UserDoc","type": "js","data": "({\n\tid:'cw.Photon.UserDoc',\n\tlang:{},\n  data:{\n    _id:'org.couchdb.user:',\n    type:'user',\n    name:'',\n    password:'',\n    roles:[]\n  },\n  Roles:[],\n  Sec:{},\n  Users:{},\n  init:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data,\n        all = that.Pho('All');\n    \n    that.Sec = Object.keys(all).reduce(function(acc, i){\n      var a = all[i].security,\n          adm = a.admins.roles,\n          mem = a.members.roles;\n      adm.forEach(function(e){\n        if (!acc[e]) acc[e] ={a:{}, m:{}};\n        acc[e].a[i] = true;\n      });\n      mem.forEach(function(e){\n        if (!acc[e]) acc[e] ={a:{}, m:{}};\n        acc[e].m[i] = true;\n      });\n      return acc;\n    },{});\n    \n    that.Roles = Object.keys(that.Sec).remove(/^_/).sort();\n    \n    // Prepare HTML\n    if (d._rev) {\n      that.lang.TXT_TITLE = that.lang.TXT_TITLE_ED;\n      that.lang.PLC_P = that.lang.PLC_P_ED;\n    }\n    $o.html($.my.formgen(that.HTML).assign(that.lang));\n    \n    // Load existing users\n    that.Pho('GetUsers')()\n    .then(function(res){\n      that.Users = cw.lib.a2o(res);\n    });\n    \n    $o.then(function(){\n    \tthat.Sel2Scroll($o, true);\n    });\n  },\n  \n  saveUser:function(doc){\n    var that = this,\n        d = doc || that.data,\n        es = function(s){return (s+'').escapeHTML()};\n\n    return that.Req({\n      url:['_users',d._id], \n      method:'PUT',\n      contentType:\t'application/json',\n      //headers:{'Content-type':'application/json'},\n      data:JSON.stringify(d)\n    })\n    .then(function(){\n      cw.lib.note(that.lang.MSG_OK.assign(es(d.name)), 'ok');\n      $.my.radio('dbupdate','_users');\n    })\n    .fail(function(code, err){\n      cw.lib.note(that.lang.MSG_FAIL.assign(es(d.name), code, es(err)), 'error');\n    })\n\n  },\n  \n  ui:{ /* See tab */ },\n  \n  die:function($o){\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  },\n  \n  S2:function(sel, tags, dict){\n\t\tthis.my.find(sel).select2({\n\t\t\ttags:tags,\n\t\t\tplaceholder:this.lang[dict],\n\t\t\tminimumResultsForSearch:12,\n\t\t\ttokenSeparators:[' ',',']\n\t\t});\n\t},\n  \n  HTML:[\n\t\t'<div id=\"ctitle\" class=\"fs130 mb2 lh160 bolder\">{TXT_TITLE}</div>',\n\t\t{row:'100%', label:'75px', rowCss:'my-row pt3 pb3',labelCss:'my-label'},\n    ['{LBL_N}','inp#uname.fs110',{plc:'{PLC_N}'},'msg'],\n\t\t['{LBL_P}','inp#upass.fs110',{plc:'{PLC_P}'},'msg'],\n    \n    {rowCss:'my-row pt7 pb3', labelCss:'my-label vat pt6'},\n\t\t['{LBL_R}','inp#uroles.fs105','msg'],\n\t\t\n    '<div id=\"uaccess\" class=\"hide ell w100p fs90 gray lh130 mt4 mb-4 pl75\"></div>',\n    \n\t\t'<div class=\"mt12 pt15 btd\">',\n\t\t\t'<button id=\"btn-start\" class=\"green mr2\">{BTN_SAVE}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n    \n    \t'<div class=\"fr\">',\n    \t\t'<a href=\"#_users/_new\" id=\"btn-otherdoc\" class=\"button tdn dib vat\">',\n    \t\t\t'<span class=\"\">{BTN_DOC}</span>',\n    \t\t'</a>',\n    \t'</div>',\n\t\t'</div>'\n\t],\n\tstyle:{ \n    ' input':'display:inline-block;',\n    ' .select2-container>.select2-choices':'max-height:160px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1512874100818","id": ".UserDoc.ui","type": "js","data": "({\n  '#uname':{\n    bind:function(d,v){\n      if (v!=null) {\n        d.name = v;\n        d._id = 'org.couchdb.user:'+v;\n      }\n      return d.name;\n    },\n    check:function(d,v){\n      if (v.has(':') || /^_/.test(v)) return this.lang.ERR_N;\n      if (this.Users[v] && !d._rev) return this.lang.ERR_NX;\n    },\n    css:{\n      ':disabled':function(d){return !!d._rev;},\n      'self:xgray':function(d){return !!d._rev;}\n    }\n  },\n  \n  '#upass':'password',\n  \n  '#uroles':{\n    init:function($o){ this.S2('#uroles',this.Roles,'PLC_R'); },\n    bind:'roles',\n    check:function(d,v){\n      if (v.find(/^_/)) return this.lang.ERR_R;\n    }\n  },\n  \n  '#uaccess':{\n    delay:50,\n    bind:function(d,v){\n    \tif (!d.roles.length) return '';\n      var that=this,\n          sec = that.Sec,\n          a = {}, sa = [],\n          m = {}, sm = [],\n          h = [],\n          t = '<span class=\"fw500\">{1} </span> {2}';\n      d.roles.forEach(function(r){\n      \tif (!sec[r]) return;\n        $.extend(a, sec[r].a);\n        $.extend(m, sec[r].m);\n      });\n      \n      sa = Object.keys(a).sort();\n      sm = Object.keys(m).subtract(sa).sort();\n      if (sa.length) {\n        if (sa.length > 20) h.push (t.assign('Admin', 'of '+sa.length+' DBs'));\n        else h.push (t.assign('Admin:', sa.join(', ')));\n      }\n      if (sm.length) {\n        if (sm.length > 20) h.push (t.assign('Member', 'of '+sm.length+' DBs'));\n        else h.push (t.assign('Member:', sm.join(', ')));\n      }\n      if (v==null) that.my.trigger('#uaccess', 'layout');\n      return h.join('<br>');\n    },\n    watch:'#uroles',\n    css:{\n      hide:function(d){return !d.roles.length}\n    }\n  },\n  \n  '#btn-start':{\n    bind:function(d,v){\n      if (v==null) return;\n      var that = this;\n      if (!d._rev) {\n        // New user\n        that.saveUser().then(function(){that.my.cancel();});\n      }\n      else {\n      \tvar doc = cw.lib.dry(Object.clone(d,!0));\n        if (!doc.password) delete doc.password;\n        else {\n        \tdelete doc.derived_key;\n          delete doc.iterations;\n          delete doc.password_scheme;\n        }\n        that.saveUser(doc).then(function(){that.my.cancel();});\n      }\n    },\n    watch:['#uname','#uroles','#upass'],\n    css:{\n      ':disabled':function(d,v){\n        return !this.my.valid() || !d.name || (!d.password && !d._rev);\n      }\n    }\n  },\n  \n  '#btn-otherdoc':{\n    bind:function(d,v){if(v!=null) this.my.cancel()},\n    css:{\n      'self:hide':function(d,v){return !!d._rev || !!d.name || !!d.password || d.roles.length>0;}\n    },\n    watch:['#uname','#upass','#uroles'],\n  },\n  \n  '#btn-cancel':function(d,v){if(v!=null) this.my.cancel()}\n})","active": false,"err": [],"opts": [],"color": ["blue"]},{"stamp": "1504333581324","id": ".Login","type": "js","data": "({\n\tid:'cw.Photon.Login',\n\tlang:{},\n\tdata:{\n\t\tname:'',\n\t\tpassword:''\n\t},\n\tinit:function($o){\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang));\n\t\t\n\t\t// Mount Enter keypress handlers\n\t\t$o.find('#upwd').on('keyup.my', function(event) {\n\t\t\tvar code = event.keyCode;\n\t\t\tif (code==13 || code==10) $o.find('#btn-send').trigger('click');\n\t\t});\n\t\t$o.find('#uname').on('keyup.my', function(event) {\n\t\t\tvar code = event.keyCode;\n\t\t\tif (code==13 || code==10) $o.find('#upwd').focus();\n\t\t});\n\t},\n\tui:{\n\t\t'#uname':'name',\n\t\t'#upwd':'password',\n\t\t'#btn-send':{\n\t\t\tdelay:10,\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v==null) return;\n\t\t\t\tvar that = this;\n\t\t\t\tthat.doLogin()\n\t\t\t\t.then(function(){ that.my.cancel(); });\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){ return !d.name || !d.password; }\n\t\t\t},\n\t\t\twatch:['#uname','#upwd']\n\t\t},\n\t\t'#btn-cancel':function(d,v){\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div class=\"fs150 lh140 bolder mb8\">{TXT_LOGIN}</div>',\n\n\t\t'<input class=\"w100p fs120 mb10\" id=\"uname\" type=\"text\" placeholder=\"{PLC_UNAME}\" '\n\t\t+'autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\">',\n\n\t\t'<input class=\"w100p fs120 mb10\" id=\"upwd\" type=\"password\" placeholder=\"{PLC_PWD}\" '\n\t\t+'autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\">',\n\n\t\t'<div class=\"pt10 btd\">',\n\t\t\t'<button id=\"btn-send\" class=\"green mr2\">{BTN_LOGIN}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>'\n\t].join(''),\n\t\n\tdoLogin:function(){\n\t\tvar that = this,\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tcreds = $.extend(true,{},that.data),\n\t\t\t\tl = that.lang;\n    \n    that.my.root().parent().addClass('modal-busy');\n    \n\t\treturn that.Req({\n\t\t\turl:['_session'], method:'POST', dataType:'json',\n      contentType:\t'application/json',\n\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\tdata:JSON.stringify(creds)\n\t\t})\n\t\t.then(function(res){\n\t\t\t// reload db list and related\n\t\t\tvar me = {name:res.name || creds.name, roles:res.roles};\n\t\t\tif (compiled) $.extend(true, window.DDOC._me, me);\n\t\t\t$.my.radio('userCtx',me);\n\t\t\t//that.Pho('my').check('#btn-aside-auth');\n\t\t\tcw.lib.note(l.MSG_AUTH_OK.assign((creds.name||'').escapeHTML()), 'ok' );\n\t\t})\n\t\t.fail(function(code, err){\n\t\t\tif (compiled) $.extend(window.DDOC._me, {name:'',roles:[]});\n\t\t\t$.my.radio('userCtx',{name:null,roles:[]});\n\t\t\tthat.Pho('my').check('#btn-aside-auth');\n\t\t\tcw.lib.note(l.MSG_AUTH_FAIL.assign(\n\t\t\t\t(creds.name||'').escapeHTML(),\n\t\t\t\tcode,\n\t\t\t\terr.escapeHTML()\n\t\t\t), 'error' );\n\t\t})\n    .always(function(){\n    \tthat.my.root().parent().removeClass('modal-busy');\n    });\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504399531781","id": ".Logout","type": "js","data": "({\n\tid:'cw.Photon.Logout',\n\tlang:{},\n\tdata:{},\n\tinit:function($o){\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang))\n\t},\n\tHTML:[\n\t\t'<div id=\"ltitle\" class=\"mb6 lh140\"></div>',\n\t\t'<div class=\"gray pl1\">',\n\t\t\t'<div id=\"xprofile\">',\n\t\t\t\t'<span class=\"fi-torso\"></span> <a id=\"btn-profile\" href=\"\" class=\"pseudolink tdn\">{TXT_PROFILE}</a>',\n\t\t\t'</div>',\n\t\t\t'<div>',\n\t\t\t\t'<span class=\"fi-power\"></span> <span id=\"btn-logout\" class=\"pseudolink tdn\">{TXT_LOGOUT}</span>',\n\t\t\t'</div>',\n\t\t'</div>'\n\t].join(''),\n\tui:{\n\t\t'#ltitle':{\n\t\t\tbind:function(d,v){\n\t\t\t\tvar h = '<div class=\"fs130 xgray lh120 w100p oh ell\">{1}</div>'.assign(cw.me().escapeHTML());\n\t\t\t\tvar r = cw.me('roles') || [];\n\t\t\t\tif (r.length) {\n\t\t\t\t\th+='<div class=\"gray fs90\">{1}</div>'.assign(r.map(function(s){\n\t\t\t\t\t\treturn '<nobr>'+s.escapeHTML()+'</nobr>'\n\t\t\t\t\t}).join(', '));\n\t\t\t\t}\n\t\t\t\treturn h;\n\t\t\t}\n\t\t},\n\t\t'#btn-profile':{\n\t\t\tdelay:30,\n\t\t\tbind:function(d,v,$o){\n\t\t\t\t$o.attr('href','#_users/'+('org.couchdb.user:'+cw.me()));\n\t\t\t\tif (v!=null) this.my.cancel();\n\t\t\t}\n\t\t},\n\t\t'#btn-logout':{\n\t\t\tdelay:30,\n\t\t\tbind:function(d,v,$o){\n\t\t\t\tif (v==null) return;\n\t\t\t\tthis.doLogout();\n\t\t\t\tthis.my.cancel();\n\t\t\t}\n\t\t}\n\t},\n\tdoLogout:function(){\n\t\tvar that = this,\n\t\t\t\tl = that.lang,\n\t\t\t\tes = function(s){return (s+'').escapeHTML()};\n\t\tcw.lib.note(l.MSG_LOGOUT_START, '', 1000);\n\t\tthat.Req({\n\t\t\turl:['_session'], method:'POST', dataType:'json',\n      contentType:\t'application/json',\n\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\tdata:JSON.stringify({name:'0',password:'0'})\n\t\t})\n\t\t.then(function(res){\n\t\t\tcw.lib.note(l.MSG_LOGOUT_FAIL.assign(999,'Server returned invalid response'), 'error');\n\t\t})\n\t\t.fail(function(code, err, msg){\n\t\t\tif (code!=401 && code !=403) {\n\t\t\t\tcw.lib.note(l.MSG_LOGOUT_FAIL.assign(code,es(err)), 'error');\n\t\t\t\tthat.Pho('my').check('#btn-aside-auth');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcw.lib.note(l.MSG_LOGOUT_OK, 'ok');\n\t\t\t}\n\t\t})\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1506894254495","id": ".SetPwd","type": "js","data": "({\n\tid:'cw.Photon.SetPwd',\n\tlang:{},\n\tdata:{\n\t\tpassword1:'',\n\t\tpassword2:''\n\t},\n\tinit:function($o){\n\t\tvar that = this;\n\t\t$o.html(that.HTML.assign(that.lang));\n\t},\n\tui:{\n\t\t'#upwd1':'password1',\n\t\t'#upwd2':{\n\t\t\tbind:'password2',\n\t\t\tcheck:function(d,v){\n\t\t\t\tif (d.password1 && (d.password2||v) && d.password1 != (d.password2||v)) return this.lang.ERR_PWD;\n\t\t\t},\n\t\t\twatch:'#upwd1'\n\t\t},\n\t\t'#btn-send':{\n\t\t\tdelay:10,\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v==null) return;\n\t\t\t\tvar that = this;\n\t\t\t\tthat.setPwd()\n\t\t\t\t.then(function(){ that.my.cancel(); });\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){ return !d.password1 || !d.password2 || !this.my.valid(); }\n\t\t\t},\n\t\t\twatch:['#upwd1','#upwd2']\n\t\t},\n\t\t'#btn-cancel':function(d,v){\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}\n\t},\n\tHTML:[\n\t\t'<div class=\"fs150 lh140 bolder mb8\">{TXT_TITLE}</div>',\n\t\t'<div>',\n\t\t\t'<input class=\"w100p fs120 mb10\" id=\"upwd1\" type=\"password\" placeholder=\"{PLC_PWD1}\" '\n\t\t\t+'autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\">',\n\t\t'</div>',\n\t\t'<div>',\n\t\t\t'<input class=\"w100p fs120 mb10\" id=\"upwd2\" type=\"password\" placeholder=\"{PLC_PWD2}\" '\n\t\t\t+'autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\">',\n\t\t\t'<div class=\"my-error-tip\" style=\"display:none\">',\n\t\t'</div>',\n\n\t\t'<div class=\"pt10 btd\">',\n\t\t\t'<button id=\"btn-send\" class=\"green mr2\">{BTN_SET}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>'\n\t].join(''),\n\t\n\tsetPwdZ:function(){\n\t\tvar that = this,\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tcreds = $.extend(true,{},that.data),\n\t\t\t\tl = that.lang;\n\t\treturn that.Req({\n\t\t\turl:['_session'], method:'POST', dataType:'json',\n\t\t\theaders:{'Content-type':'application/json'},\n\t\t\tdata:JSON.stringify(creds)\n\t\t})\n\t\t.then(function(res){\n\t\t\t// reload db list and related\n\t\t\tvar me = {name:res.name || creds.name, roles:res.roles};\n\t\t\tif (compiled) $.extend(true, window.DDOC._me, me);\n\t\t\t$.my.radio('userCtx',me);\n\t\t\tthat.Pho('my').check('#btn-aside-auth');\n\t\t\tcw.lib.note(l.MSG_AUTH_OK.assign((creds.name||'').escapeHTML()), 'ok' );\n\t\t})\n\t\t.fail(function(code, err){\n\t\t\tif (compiled) $.extend(window.DDOC._me, {name:'',roles:[]});\n\t\t\t$.my.radio('userCtx',{name:null,roles:[]});\n\t\t\tthat.Pho('my').check('#btn-aside-auth');\n\t\t\tcw.lib.note(l.MSG_AUTH_FAIL.assign(\n\t\t\t\t(creds.name||'').escapeHTML(),\n\t\t\t\tcode,\n\t\t\t\terr.escapeHTML()\n\t\t\t), 'error' );\n\t\t});\n\t}\n})","active": false,"err": [],"opts": ["nocompile"],"color": ["teal"]},{"stamp": "1504307072565","id": ".Compact","type": "js","data": "({\n\tid:'cw.Photon.Compact',\n\tlang:{},\n\tdata:{selection:[], ops:['docs'], ddocs:[], dselection:[]},\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\td.All = that.Pho('All');\n\t\td.all = Object.keys(d.All).sort();\n\t\t$o.html(that.HTML.assign(that.lang));\n    $o.then((function(){\n    \tthat.Sel2Scroll($o, true);\n    }).debounce(15));\n\t},\n\tui:{\n\t\t'#ctitle':{\n\t\t\tbind: function(d){\n\t\t\t\treturn d.selection.length==1?this.lang.TXT_TITLE1:this.lang.TXT_TITLE;\n\t\t\t},\n\t\t\twatch:['#dbs']\n\t\t},\n\t\t'#dbs':{\n\t\t\tinit:function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:this.data.all.map(function(e){return {id:e,text:e} }),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'selection',\n\t\t\tcheck:function(d,v){return !v.length?this.lang.ERR_DBS:''},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d){return d.ddocs.length>0},\n        //hide: function(d){ return d.selection.length > 20}\n\t\t\t}\n\t\t},\n    \n\t\t'#dbops':{\n\t\t\tinit:function($o){\n\t\t\t\t$o.tags({\n\t\t\t\t\ttags:this.lang.TAG_OP.to(this.data.ddocs.length?3:2)\n\t\t\t\t})\n\t\t\t},\n\t\t\tbind:'ops',\n\t\t\tcheck:function(d,v){return !v.length?this.lang.ERR_OP:''}\n\t\t},\n\t\t'#ddocs':{\n\t\t\tinit:function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:this.data.ddocs.map(function(e){return {id: e,text:'_design/'+e} }),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DDOCS,\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'dselection',\n\t\t\tcheck:function(d,v){return !v.length && d.ops.indexOf('ddocs')>-1?this.lang.ERR_DDOCS:''},\n\t\t\tcss:{\n\t\t\t\thide:function(d,v){return d.ops.indexOf('ddocs')==-1 || d.selection.length!=1}\n\t\t\t},\n\t\t\twatch:['#dbops','#dbs']\n\t\t},\n\t\t'#btn-start':{\n\t\t\tdelay:50,\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v==null) return;\n\t\t\t\ttry {\n\t\t\t\t\tthis.doCompact();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.cancel();\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){\n\t\t\t\t\treturn !d.selection.length || !d.ops.length || !this.my.valid();\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:['#dbs','#dbops','#ddocs']\n\t\t},\n\t\t'#btn-cancel':function(d,v){\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}\n\t},\n\t\n\t// Performs compact \n\t// when popup is already closed\n\t// TODO: report progress\n\tdoCompact:function(){\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.selection.length;\n\t\t\n\t\tif (!res.ops.length || !ctr || !Object.keys(res.All).intersect(res.selection).length) return;\n\n\t\tres.selection.forEach(function(db){\n\n\t\t\tvar pis = [];\n\t\t\t// compact docs\n\t\t\tif (res.ops.find('docs')) pis.push(\n\t\t\t\tthat.Req({\n\t\t\t\t\turl:[db,'_compact'], \n\t\t\t\t\tmethod:'POST',\n          contentType:\t'application/json',\n\t\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t\t}).\n\t\t\t\tfail(function(code, err, msg){\n\t\t\t\t\tconsole.log('Error starting data compaction of '+db, code, err, msg);\n\t\t\t\t})\n\t\t\t);\n\t\t\t// purge old views\n\t\t\tif (res.ops.find('views')) pis.push(\n\t\t\t\tthat.Req({\n\t\t\t\t\turl:[db,'_view_cleanup'], \n\t\t\t\t\tmethod:'POST', \n          contentType:\t'application/json',\n\t\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t\t}).\n\t\t\t\tfail(function(code, err, msg){\n\t\t\t\t\tconsole.log('Error starting purging old views of '+db, code, err, msg);\n\t\t\t\t})\n\t\t\t);\n\t\t\t\n\t\t\t// compact views\n\t\t\tif (res.ops.find('ddocs')) {\n\t\t\t\tres.dselection.compact(true)\n\t\t\t\t.forEach(function(ddoc){\n\t\t\t\t\tpis.push(\n\t\t\t\t\t\tthat.Req({\n\t\t\t\t\t\t\turl:[db,'_compact', ddoc], \n\t\t\t\t\t\t\tmethod:'POST',\n              contentType:\t'application/json',\n\t\t\t\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t\t\t\t}).\n\t\t\t\t\t\tfail(function(code, err, msg){\n\t\t\t\t\t\t\tconsole.log('Error starting view compaction of '+db+'/_design/'+ddoc, code, err, msg);\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tQ.all(pis)\n\t\t\t.then(function(res){\n\t\t\t\tcw.lib.note(l.MSG_COMPACT_START.assign(db));\n\t\t\t\t_end();\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(l.MSG_COMPACT_FAIL_SOME, 'error');\n\t\t\t\t_end();\n\t\t\t});\n\n\t\t}.lazy(that.Pho('Cfg').batchCompactDelay));\n\t\t\n\t\tfunction _end(){\n\t\t\tctr-=1;\n\t\t\tif (ctr>0) return;\n      [700, 2500, 7500, 15000].forEach(function(i){\n      \t_relist.debounce(i)();\n      });\n\t\t}\n\t\t\n\t\tfunction _relist(){ $.my.radio('dblist', res.selection); }\n\t},\n  \n  die:function($o){\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  },\n\t\n\tHTML:[\n\t\t'<div id=\"ctitle\" class=\"fs130 mb10 bolder\">{TXT_TITLE}</div>',\n\t\t'<div class=\"mb10 fs105\"><input id=\"dbs\" class=\"w100p\"></div>',\n\t\t'<div class=\"mb10\"><span id=\"dbops\"></span></div>',\n\t\t'<div class=\"mb10 fs105 hide\"><input id=\"ddocs\" class=\"w100p\"></div>',\n\t\t'<div class=\"mt10 pt10 btd\">',\n\t\t\t'<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>'\n\t].join(''),\n\tstyle:{ \n    ' input':'display:inline-block;',\n    ' .select2-container>.select2-choices':'max-height:214px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504321028941","id": ".NewDB","type": "js","data": "({\n\tid:'cw.Photon.NewDB',\n\tlang:{},\n\t//inherit:['Req'],\n\tdata:{\n\t\tdbs:[], all:[],allo:{},\n\t\tusers:[], roles:[],\n\t\t\n\t\tadmins:{names:[],roles:[]},\n\t\tmembers:{names:[],roles:[]}\n\t},\n\tUsers:[],\n\tS2:function(sel, tags, dict){\n\t\tthis.my.find(sel).select2({\n\t\t\ttags:tags,\n\t\t\tplaceholder:this.lang[dict],\n\t\t\tminimumResultsForSearch:12,\n\t\t\ttokenSeparators:[' ',',']\n\t\t});\n\t},\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data,\n        all = that.Pho('All');\n\t\td.all = Object.keys(all),\n\t\td.allo = cw.lib.a2o(d.all);\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n    \n    d.roles = Object.keys(Object.keys(all).reduce(function(acc, i){\n      var a = all[i].security,\n          b = [].add(a.admins.roles).add(a.members.roles);\n      b.forEach(function(e){acc[e]=true;})\n      return acc;\n    },{})).add('_admin').unique().sort();\n\t\t\n\t\tQ.all([that.Pho('GetUsers')().then(function(res){d.users = res; }), $o])\n\t\t.then(function(){\n\t\t\tthat.S2('#uadm',that.data.users,'PLC_UADM');\n\t\t\tthat.S2('#umem',that.data.users,'PLC_UMEM');\n      // nicescroll all select2-s\n      that.Sel2Scroll($o, true);\n\t\t});\n\t},\n\tui:{\n\t\t'#ctitle':{\n      bind: function(d){\n\t\t\t\treturn d.dbs.length==1?this.lang.TXT_TITLE1:this.lang.TXT_TITLE;\n\t\t\t},\n\t\t\twatch:['#dbs']\n\t\t},\n\t\t'#dbs':{\n\t\t\tinit:function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:[],\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12,\n\t\t\t\t\ttokenSeparators:[' ',',']\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'dbs',\n\t\t\tcheck:function(d,v){\n\t\t\t\tvar exist = [],\n\t\t\t\t\t\tnames=[],\n\t\t\t\t\t\tund = [];\n\t\t\t\tv.forEach(function(e){\n\t\t\t\t\tif (d.allo[e]) exist.push(e);\n\t\t\t\t\tif (!/^[a-z0-9_$\\(\\)\\+\\-\\/]+$/.test(e)) names.push(e);\n\t\t\t\t\tif (!/^[a-z]/.test(e)) und.push(e);\n\t\t\t\t});\n\t\t\t\tif (exist.length) return this.lang.ERR_DB_EXIST.assign(exist.join(', ').escapeHTML());\n\t\t\t\tif (names.length) return this.lang.ERR_DB_NAME;\n\t\t\t\tif (und.length) return this.lang.ERR_DB_UND;\n\t\t\t}\n\t\t},\n\t\t\n\t\t'#uadm':{\n\t\t\tinit:function($o){ this.S2('#uadm',this.data.users,'PLC_UADM'); },\n\t\t\tbind:'admins.names',\n      check: function(d,v){\n      \treturn this.isUnames(v);\n      }\n\t\t},\n\t\t'#gadm':{\n\t\t\tinit:function($o){ this.S2('#gadm',this.data.roles,'PLC_GADM'); },\n\t\t\tbind:'admins.roles'\n\t\t},\n\t\t\n\t\t'#umem':{\n\t\t\tinit:function($o){ this.S2('#umem',this.data.users,'PLC_UMEM'); },\n\t\t\tbind:'members.names',\n      check: function(d,v){\n      \treturn this.isUnames(v);\n      }\n\t\t},\n\t\t'#gmem':{\n\t\t\tinit:function($o){ this.S2('#gmem',this.data.roles,'PLC_GMEM'); },\n\t\t\tbind:'members.roles'\n\t\t},\n\n\t\t'#btn-start':{\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v==null) return this.lang['BTN_START'+(!(d.members.names+d.members.roles)?'_PUBLIC':'')];\n\t\t\t\ttry {\n\t\t\t\t\tthis.doCreate();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.cancel();\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){\n\t\t\t\t\treturn !d.dbs.length || !this.my.valid();\n\t\t\t\t},\n\t\t\t\t'self:orange':function(d){\n\t\t\t\t\treturn !(d.members.names+d.members.roles);\n\t\t\t\t},\n\t\t\t\t'self:green':function(d){\n\t\t\t\t\treturn !!(d.members.names+d.members.roles);\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:['#dbs','#umem','#gmem']\n\t\t},\n\t\t'#btn-cancel':function(d,v){\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}\n\t},\n\t\n\t// Creates DBs \n\t// when popup is already closed\n\t// TODO: report progress\n\tdoCreate:function(){\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.dbs.length;\n\t\t\n\t\tvar acl = Object.select(res,['admins','members']),\n\t\t\t\tpublic = !(acl.members.names+acl.members.roles),\n\t\t\t\tnoacl = !(acl.admins.names+acl.admins.roles+acl.members.names+acl.members.roles),\n\t\t\t\tdbs = res.dbs;\n\t\tif (!ctr) return;\n\n\t\tdbs.forEach(function(db, i){\n\t\t\t// Create DB\n\t\t\tthat.Req({\n\t\t\t\turl:[db], \n\t\t\t\tmethod:'PUT',\n        contentType:\t'application/json',\n\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\t// set secObj\n\t\t\t\tif (!noacl) {\n\t\t\t\t\tthat.Req({\n\t\t\t\t\t\turl:[db,'_security'], \n\t\t\t\t\t\tmethod:'PUT', \n            contentType:\t'application/json',\n\t\t\t\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\t\t\t\tdata:JSON.stringify(acl)\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tcw.lib.note(l.MSG_NEWDB_START.assign(db));\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(code, err, msg){\n\t\t\t\t\t\tcw.lib.note(l.MSG_NEWDB_NOACL.assign(db, code, es(err)), 'warning');\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(){\n\t\t\t\t\t\tif (i==ctr-1) $.my.radio('dblist',dbs);;\n\t\t\t\t\t}); // -- end set secObj\n\t\t\t\t} \n\t\t\t\telse {\n\t\t\t\t\tcw.lib.note(l.MSG_NEWDB_START.assign(db));\n\t\t\t\t\tif (i==ctr-1) $.my.radio('dblist',dbs);;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(that.lang.MSG_NEWDB_FAIL.assign(db, code, es(err)), 'error');\n\t\t\t});\n\t\t\t\n\t\t}.lazy(that.Pho('Cfg').batchCreateDelay));\n\t},\n  isUnames:function(a){\n  \tvar e = '',\n        that = this;\n    a.forEach(function(v){\n      if (v=='_admin') return;\n    \tif (v.has(':') || /^_/.test(v)) e = that.lang.ERR_UNAME;  \n    });\n    return e;\n  },\n  die:function($o){\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  },\n\tHTML:[\n\t\t'<div id=\"ctitle\" class=\"fs130 mb2 lh160 bolder\">{TXT_TITLE}</div>',\n\t\t{row:'100%', label:'60px', rowCss:'my-row pt3 pb3',labelCss:'my-label'},\n\t\t['{LBL_DBS}','inp#dbs.fs105','msg'],\n\t\t\n\t\t'<div class=\"fs120 mt10 mb2\">{TXT_ADM}</div>',\n\t\t['{LBL_UADM}','inp#uadm.fs105','msg'],\n\t\t['{LBL_GADM}','inp#gadm.fs105','msg'],\n\t\t\n\t\t'<div class=\"fs120 mt10 mb2\">{TXT_MEM}</div>',\n\t\t['{LBL_UADM}','inp#umem.fs105','msg'],\n\t\t['{LBL_GADM}','inp#gmem.fs105','msg'],\n\t\t\n\t\t'<div class=\"mt12 pt15 btd\">',\n\t\t\t'<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>'\n\t],\n\tstyle:{ \n    ' input':'display:inline-block;',\n    ' .select2-container>.select2-choices':'max-height:56px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504481659882","id": ".DelDB","type": "js","data": "({\n\tid:'cw.Photon.DelDB',\n\tlang:{},\n\tdata:{\n\t\tdbs:[], all:[],allo:{},\n\t},\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\td.all = d.dbs.slice(0),\n\t\td.allo = cw.lib.a2o(d.all);\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n    $o.then((function(){\n    \tthat.Sel2Scroll($o, true);\n    }).debounce(15));\n\t},\n\tui:{\n\t\t'#ctitle':{\n\t\t\tbind: function(d){\n\t\t\t\treturn d.dbs.length==1?this.lang.TXT_TITLE1:this.lang.TXT_TITLE;\n\t\t\t},\n\t\t\twatch:['#dbs']\n\t\t},\n\t\t'#dbs':{\n\t\t\tinit:function($o){\n\t\t\t\tvar dbs = this.data.all;\n\t\t\t\t$o.select2({\n\t\t\t\t\tdata:dbs.map(function(e){return {id:e,text:e} }),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12,\n\t\t\t\t\treadOnly:dbs.length == 1\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'dbs',\n\t\t\tcheck:function(d,v){return !v.length?this.lang.ERR_DBS:''},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d){return d.all.length==1},\n        //hide: function(d){return d.all.length > 15}\n\t\t\t}\n\t\t},\n\t\t\n\t\t'#delwarn':{\n\t\t\tbind:function(d,v){\n\t\t\t\tvar that =this,\n\t\t\t\t\t\tc = { size:0, count:0, disk:0 },\n\t\t\t\t\t\tall = that.Pho('All');\n\t\t\t\td.dbs.forEach(function(k){\n\t\t\t\t\tvar db = all[k];\n\t\t\t\t\tif (!db) return;\n\t\t\t\t\tc.size += (+db.data_size || 0);\n\t\t\t\t\tc.disk += (+db.disk_size || 0);\n\t\t\t\t});\n\t\t\t\tc.count = d.dbs.length;\n\t\t\t\tif (!d.dbs.length) return '';\n\t\t\t\treturn that.lang.TXT_WARN(c);\n\t\t\t},\n\t\t\twatch:'#dbs'\n\t\t},\n\n\t\t'#btn-start':{\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v==null) return this.lang.BTN_START(d.dbs.length);\n\t\t\t\ttry {\n\t\t\t\t\tthis.doDeleteZ();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.commit();\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){\n\t\t\t\t\treturn !d.dbs.length || !this.my.valid();\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:['#dbs']\n\t\t},\n\t\t'#btn-cancel':function(d,v){\n\t\t\tif(v==null) return;\n\t\t\tthis.my.cancel();\n\t\t}\n\t},\n\t\n\t// Deletes DBs  when popup is already closed\n\t// TODO: report progress\n\tdoDeleteZ:function(){\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.dbs.length;\n\t\t\n\t\tvar dbs = res.dbs;\n\t\tif (!ctr) return;\n\n\t\tdbs.forEach(function(db, i){\n\t\t\tthat.Req({\n\t\t\t\turl:[db], \n\t\t\t\tmethod:'DELETE', \n\t\t\t\t//headers:{'Content-type':'application/json'}\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tcw.lib.note(l.MSG_OK.assign(db), 'ok');\n\t\t\t\t$.my.radio('dbdeleted', db);\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(l.MSG_FAIL.assign(db, code, es(err)), 'error');\n\t\t\t})\n\t\t\t.always(function(){\n\t\t\t\tif (i==ctr-1) {\n\t\t\t\t\t$.my.radio('dblist',[]);\n\t\t\t\t}\n\t\t\t}); // -- end set secObj\n\t\t\t\n\t\t}.lazy(that.Pho('Cfg').batchCreateDelay));\n\t},\n  \n  die:function($o){\n  \t// Unmount niceScroll\n\t\tthis.Sel2Scroll($o, false);\n  },\n\t\n\tHTML:[\n\t\t'<div id=\"ctitle\" class=\"fs130 mb2 lh160 bolder red\">{TXT_TITLE}</div>',\n\t\t'<div class=\"mb10 fs105\"><input id=\"dbs\" class=\"w100p\"></div>',\n\t\t'<div class=\"mb10\"><span id=\"delwarn\"></span></div>',\n\t\t\n\t\t'<div class=\"mt12 pt15 btd\">',\n\t\t\t'<button id=\"btn-start\" class=\"red mr2\">{BTN_START}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>'\n\t],\n  \n  style:{\n  \t' .select2-container>.select2-choices':'max-height:214px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504413431270","id": ".SecObj","type": "js","data": "({\n\tid:'cw.Photon.SecObj',\n\tlang:{},\n\t//inherit:['Req','Sel2Scroll'],\n\tdata:{\n\t\tdbs:[], all:[],allo:{},\n\t\tusers:[], roles:[],\n\t\t\n\t\tadmins:{names:[],roles:[]},\n\t\tmembers:{names:[],roles:[]}\n\t},\n\tUsers:[],\n\tS2:function(sel, tags, dict){\n\t\tthis.my.find(sel).select2({\n\t\t\ttags:tags,\n\t\t\tplaceholder:this.lang[dict],\n\t\t\tminimumResultsForSearch:12\n\t\t});\n\t},\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data,\n        all = that.Pho('All');\n\t\td.all = Object.keys(all).sort(),\n\t\td.allo = cw.lib.a2o(d.all);\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang));\n    \n    d.roles = Object.keys(Object.keys(all).reduce(function(acc, i){\n      var a = all[i].security,\n          b = [].add(a.admins.roles).add(a.members.roles);\n      b.forEach(function(e){acc[e]=true;})\n      return acc;\n    },{}))\n    .add('_admin')\n    .unique()\n    .sort();\n\t\t\n\t\tQ.all([that.Pho('GetUsers')().then(function(res){d.users = res; }), $o])\n\t\t.then(function(){\n      // add users to dropdowns\n\t\t\tthat.S2('#uadm',that.data.users,'PLC_UADM');\n\t\t\tthat.S2('#umem',that.data.users,'PLC_UMEM');\n      // re-layout\n\t\t\t$o.trigger('layout');\n      // nicescroll all select2-s\n      that.Sel2Scroll($o, true);\n\t\t});\n\t},\n\tui:{\n\t\t'#dbs':{\n\t\t\tinit:function($o){\n\t\t\t\t$o.select2({\n\t\t\t\t\ttags:this.data.all.map(function(e){\n\t\t\t\t\t\treturn {id:e,text:e}\n\t\t\t\t\t}),\n\t\t\t\t\tmultiple:true,\n\t\t\t\t\tplaceholder:this.lang.PLC_DBS,\n\t\t\t\t\tminimumResultsForSearch:12\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'dbs',\n\t\t\tcheck:function(d,v){return !v.length?this.lang.ERR_DBS:''}\n\t\t},\n\t\t\n\t\t'#uadm':{\n\t\t\tinit:function($o){ this.S2('#uadm',this.data.users,'PLC_UADM'); },\n\t\t\tbind:'admins.names',\n      check: function(d,v){\n      \treturn this.isUnames(v);\n      }\n\t\t},\n\t\t'#gadm':{\n\t\t\tinit:function($o){ this.S2('#gadm',this.data.roles,'PLC_GADM'); },\n\t\t\tbind:'admins.roles'\n\t\t},\n\t\t\n\t\t'#umem':{\n\t\t\tinit:function($o){ this.S2('#umem',this.data.users,'PLC_UMEM'); },\n\t\t\tbind:'members.names',\n      check: function(d,v){\n      \treturn this.isUnames(v);\n      }\n\t\t},\n\t\t'#gmem':{\n\t\t\tinit:function($o){ this.S2('#gmem',this.data.roles,'PLC_GMEM'); },\n\t\t\tbind:'members.roles'\n\t\t},\n\n\t\t'#btn-start':{\n\t\t\tbind:function(d,v){\n\t\t\t\tif(v==null) return this.lang.BTN_START;\n\t\t\t\ttry {\n\t\t\t\t\tthis.doSecUpdate();\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t\tthis.my.cancel();\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){\n\t\t\t\t\treturn !d.dbs.length || !this.my.valid();\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:['#dbs','#umem','#gmem']\n\t\t},\n\t\t\n\t\t'#btn-cancel':function(d,v){ if(v!=null) this.my.cancel(); },\n    \n    '#layproxy':{\n      delay:150,\n      watch:['#dbs','#uadm','#gadm','#umem','#gmem'],\n      bind:function(){\n      \tthis.my.trigger('#layproxy', 'layout');\n      }\n    }\n\t},\n  \n  isUnames:function(a){\n  \tvar e = '',\n        that = this;\n    a.forEach(function(v){\n      if (v=='_admin') return;\n    \tif (v.has(':') || /^_/.test(v)) e = that.lang.ERR_UNAME;  \n    });\n    return e;\n  },\n\t\n\t// Performs security descriptor updates \n\t// when popup is already closed\n\t// TODO: report progress\n\tdoSecUpdate:function(){\n\t\tvar that = this,\n\t\t\t\tres = $.extend(true, {}, that.data),\n\t\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\t\tl = that.lang,\n\t\t\t\tctr = res.dbs.length;\n\t\t\n\t\tvar acl = Object.select(res,['admins','members']),\n\t\t\t\tpublic = !(acl.members.names+acl.members.roles),\n\t\t\t\tnoacl = !(acl.admins.names+acl.admins.roles+acl.members.names+acl.members.roles),\n\t\t\t\tdbs = res.dbs;\n\t\tif (!ctr) return;\n\n\t\tdbs.forEach(function(db, i){\n\t\t\tthat.Req({\n\t\t\t\turl:\t\t\t\t\t[db,'_security'], \n\t\t\t\tmethod:\t\t\t\t'PUT',\n        contentType:\t'application/json',\n\t\t\t\t//headers:{'Content-type':'application/json'},\n\t\t\t\tdata:\t\t\t\t\tJSON.stringify(acl)\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\tcw.lib.note(l.MSG_OK.assign(db), 'ok');\n\t\t\t})\n\t\t\t.fail(function(code, err, msg){\n\t\t\t\tcw.lib.note(l.MSG_FAIL.assign(db, code, es(err)), 'error');\n\t\t\t})\n\t\t\t.always(function(){\n\t\t\t\tif (i==ctr-1) $.my.radio('dblist',dbs);;\n\t\t\t}); // -- end set secObj\n\t\t\t\n\t\t}.lazy(that.Pho('Cfg').batchCreateDelay));\n\t},\n  \n  die:function($o){\n  \t// Unmount niceScroll\n    this.Sel2Scroll($o, false);\n  },\n\t\n\tHTML:[\n\t\t'<div class=\"fs130 mb2 lh160 bolder\">{TXT_TITLE}</div>',\n\t\t{row:'100%', label:'60px', rowCss:'my-row pt3 pb3',labelCss:'my-label'},\n\t\t['{LBL_DBS}','inp#dbs.fs105','msg'],\n\t\t\n\t\t'<div class=\"fs120 mt10 mb2\">{TXT_ADM}</div>',\n\t\t['{LBL_UADM}','inp#uadm.fs105','msg'],\n\t\t['{LBL_GADM}','inp#gadm.fs105','msg'],\n\t\t\n\t\t'<div class=\"fs120 mt10 mb2\">{TXT_MEM}</div>',\n\t\t['{LBL_UADM}','inp#umem.fs105','msg'],\n\t\t['{LBL_GADM}','inp#gmem.fs105','msg'],\n\t\t\n\t\t'<div class=\"mt12 pt15 btd\">',\n\t\t\t'<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>',\n    '<div id=\"layproxy\" class=\"hide\"></div>'\n\t],\n\tstyle:{ \n    ' input':'display:inline-block;',\n    ' .select2-container>.select2-choices':'max-height:56px;'\n  }\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504900125906","id": ".NewSync","type": "js","data": "({\n\tid:'cw.Photon.NewSync',\n\tlang:{},\n\t//params:{width:350},\n\tdata:{\n\t\tdoc:'',\n\t\tmode:'',\n\t\tsource:'',\n\t\ttarget:'',\n\t\tfilter:'',\n\t\tdoc_ids:[],\n\t\tquery:{}\n\t},\n\tinit:function($o){\n\t\tvar that = this,\n\t\t\t\td = that.data;\n\t\t\n\t\t// align width and generate HTML\n\t\t// that.HTML[0].row = that.params.width+'px';\n\t\tthat.HTML[0].label = that.params.width>450?'115px':'95px';\n\t\t$o.html($.my.formgen(that.HTML).assign(that.lang).assign(that.Pho('ReplicatorDB')));\n\t\t\n\t\t// autosize textareas\n\t\t$o.find('textarea').each(function(){\n\t\t\t$(this).on('input.my,keyup.my',function(){\n\t\t\t\t$(this).height(0).height((this.scrollHeight-10).clamp(19,100));\n\t\t\t});\n\t\t})\n\t\t\n\t\t$o.then(function(){\n\t\t\t$o.find('textarea').each(function(){$(this).trigger('input')});\n\t\t}.debounce(20))\n\t},\n\t\n\tdie:function($o){\n\t\t$o.find( \"#rsource\" ).autocomplete( 'destroy' );\n\t\t$o.find( \"#rtarget\" ).autocomplete( 'destroy' );\n\t},\n\t\n\tui:{\n\t\t'#rmode':{\n\t\t\tinit: function($o){$o.tags(this.lang.TAG_MODE)},\n\t\t\tbind:'mode'\n\t\t},\n\t\t\n\t\t'#xrdocid':{\n\t\t\tcss:{hide:function(d,v){return d.mode!='doc'}},\n\t\t\twatch:'#rmode'\n\t\t},\n\t\t'#rdocid':{\n\t\t\tbind:'doc',\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (d.mode != 'doc') return;\n\t\t\t\tif (!v) return this.lang.ERR_ID;\n\t\t\t\tif (v[0] == '_') return this.lang.ERR_ID_UND;\n\t\t\t},\n\t\t\twatch:'#rmode'\n\t\t},\n\t\t\n\t\t'#rsource':{\n\t\t\tinit:function($o){\n\t\t\t\tvar that = this;\n\t\t\t\tif (!that.data.source) $o.autocomplete({\n\t\t\t\t\tsource: this.DBs, \n\t\t\t\t\tselect: (function(o, ui){that.my.check('#rtarget') }).debounce(10),\n\t\t\t\t\tappendTo: that.my.root()\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'source',\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return;\n\t\t\t\tif (this.DBs.indexOf(v)==-1 && !/^http[s]?:\\/\\/.+$/.test(v)) return this.lang.ERR_FROM;\n\t\t\t},\n\t\t\tevents:'blur.my'\n\t\t},\n\t\t'#rtarget':{\n\t\t\tinit:function($o){\n\t\t\t\tvar that = this;\n\t\t\t\tif (!that.data.target) $o.autocomplete({\n\t\t\t\t\tsource: this.DBs, \n\t\t\t\t\tselect: (function(o, ui){that.my.check('#rtarget') }).debounce(10),\n\t\t\t\t\tappendTo: that.my.root()\n\t\t\t\t});\n\t\t\t},\n\t\t\tbind:'target',\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return;\n\t\t\t\tif (this.DBs.indexOf(v)==-1 && !/^http[s]?:\\/\\/.+$/.test(v)) return this.lang.ERR_TO;\n\t\t\t\tif (v && v==d.source) return this.lang.ERR_DUP;\n\t\t\t},\n\t\t\twatch:'#rsource',\n\t\t\t//events:'blur.my'\n\t\t},\n\t\t\n\t\t'#rdocs':{\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return;\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isArray(j) || !j.length || j.find(function(e){return typeof e!='string';}))\n\t\t\t\t\treturn this.lang.ERR_DOCS;\n\t\t\t},\n\t\t\tbind:function(d,v){\n\t\t\t\tif (v==null) return !d.doc_ids.length?'':cw.lib.json(d.doc_ids,'  ');\n\t\t\t\tif (v=='') {\n\t\t\t\t\td.doc_ids = [];\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isArray(j) || !j.length || j.find(function(e){return typeof e!='string';})) return v;\n\t\t\t\td.doc_ids = j;\n\t\t\t\treturn v;\n\t\t\t}\n\t\t},\n\t\t\n\t\t'#rfilter':{\n\t\t\tbind:'filter',\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return;\n\t\t\t\tif (v[0] == '_') return this.lang.ERR_FN_DESIGN;\n\t\t\t\tif (!/^[^_].*\\/[^\\/]+$/.test(v)) return this.lang.ERR_FN;\n\t\t\t},\n\t\t},\n\t\t\n\t\t'#xrquery':{\n\t\t\tcss:{hide:function(d,v){return d.mode != 'doc' || !/^[^_].*\\/[^\\/]+$/.test(d.filter)}},\n\t\t\twatch:['#dmode','#rfilter','#rdocid']\n\t\t},\n\t\t\n\t\t'#rquery':{\n\t\t\tcheck: function(d,v){\n\t\t\t\tif (!v) return;\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isObject(j) || !Object.size(j)) return this.lang.ERR_QRY;\n\t\t\t},\n\t\t\tbind:function(d,v){\n\t\t\t\tif (v==null) return !Object.size(d.query)?'':cw.lib.json(d.query,'  ');\n\t\t\t\tif (v=='') {\n\t\t\t\t\td.query = {};\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\tvar j;\n\t\t\t\ttry{j=JSON.parse(v);}catch(e){}\n\t\t\t\tif (!Object.isObject(j) || !Object.size(j)) return v;\n\t\t\t\td.query = j;\n\t\t\t\treturn v;\n\t\t\t}\n\t\t},\n\t\t\n\t\t'#btn-start':{\n\t\t\tdelay:60,\n\t\t\tbind:function(d,v){ \n\t\t\t\tif(v!=null) {\n\t\t\t\t\ttry {this.doSync();}catch(e){console.log(e);}\n\t\t\t\t\tthis.my.cancel();\n\t\t\t\t}\n\t\t\t\treturn d.mode=='doc'?this.lang.BTN_START_DOC:this.lang.BTN_START;\n\t\t\t},\n\t\t\tcss:{\n\t\t\t\t':disabled':function(d,v){\n\t\t\t\t\treturn !this.my.valid() || !d.source || !d.target;\n\t\t\t\t}\n\t\t\t},\n\t\t\twatch:['#rsource','#rtarget','#rfilter','#rdocs','#rdocid','#rquery']\n\t\t},\n\t\t\n\t\t'#btn-clear':{\n\t\t\tdelay:60,\n\t\t\tbind:function(d,v){ \n\t\t\t\tif(v!=null) {\n\t\t\t\t\t$.extend(d,{doc:'', mode:'', source:'', target:'', filter:'', doc_ids:[], query:{} });\n\t\t\t\t\tthis.my.cancel();\n\t\t\t\t}; \n\t\t\t}\n\t\t},\n\t\t\n\t\t'#btn-cancel':function(d,v){ if(v!=null) this.my.cancel(); }\n\t},\n\t\t\n\tDBs:[],\n\t\n\tHTML:[\n\t\t{\n\t\t\trow:'100%', //'350px', \n\t\t\trowCss:'my-row pt3 pb3',\n\t\t\tlabel:'100px', \n\t\t\tlabelCss:'my-label dib vat mt8'},\n\t\t'<div class=\"fs130 lh160 bolder\">{TXT_TITLE}</div>',\n\t\t\n\t\t['{LBL_MODE}', 'div#rmode.dib.vat.fs105.lh180'],\n\t\t\n\t\t'<div id=\"xrdocid\" class=\"hide\">',\n\t\t['{LBL_ID}', 'inp#rdocid.w100p.fs105.bolder',{plc:'{PLC_ID}'}, 'msg'],\n\t\t'</div>',\n\t\t\n\t\t['{LBL_FROM}','txt#rsource.w100p.fs100.lh130',{plc:'{PLC_FROM}'},'msg'],\n\t\t['{LBL_TO}','txt#rtarget.w100p.fs100.lh130',{plc:'{PLC_TO}'},'msg'],\n\t\t\n\t\t['{LBL_DOCS}', 'txt#rdocs.w100p.fs90.lh130',{plc:'{PLC_DOCS}'}, 'msg'],\n\t\t\n\t\t['{LBL_FN}','inp#rfilter.w100p',{plc:'{PLC_FN}'},'msg'],\n\t\t\n\t\t'<div id=\"xrquery\" class=\"hide\">',\n\t\t['{LBL_QRY}','txt#rquery.w100p.fs90.lh130',{plc:'{PLC_QRY}'},'msg'],\n\t\t'</div>',\n\t\t\n\t\t'<div class=\"mt12 pt15 btd\">',\n\t\t\t'<div class=\"fr\"><button id=\"btn-clear\">{BTN_CLEAR}</button></div>',\n\t\t\t'<button id=\"btn-start\" class=\"green mr2\">{BTN_START}</button>',\n\t\t\t'<button id=\"btn-cancel\">{BTN_CANCEL}</button>',\n\t\t'</div>'\n\t],\n\t\n\tstyle:{\n\t\t' textarea':'resize:none;word-wrap:break-word;',\n\t\t' .my-error-tip':'padding:0.1em 0 0.2em 0;',\n\t\t' .ui-widget':'font-size:100%'\n\t}\n})","active": false,"err": [],"opts": [],"color": ["teal"]},{"stamp": "1504918359428","id": ".NewSync.doSync","type": "js","data": "(function (){\n\tvar that = this,\n\t\t\td = $.extend(true, {}, that.data),\n\t\t\tcompiled = that.Pho('_compiled'),\n\t\t\tes = function(s){return (s+'').escapeHTML()},\n\t\t\tl = that.lang,\n\t\t\treq, doc,\n\t\t\trname = that.Pho('ReplicatorDB'),\n      remote = /^http[s]?:\\/\\//.test(d.target);\n\t\n\tdoc = {\n\t\tsource:d.source,\n\t\ttarget:d.target,\n\t\tcontinuous:(d.mode+'')!=''\n\t};\n\tif (d.doc_ids.length) doc.doc_ids = Object.clone(d.doc_ids);\n\tif (d.filter) doc.filter = d.filter;\n\tif (Object.size(d.query)) doc.query = Object.clone(d.query, true);\n\t\n\t\n\tif (d.mode == 'doc') {\n\t\t// construct doc & url\n\t\treq = {\n\t\t\turl:[rname, d.doc],\n\t\t\tmethod:'PUT',\n\t\t\theaders:{Accept:'application/json', 'X-Couch-Full-Commit':'true'},\n\t\t\tdataType:'text',\n\t\t\tdata:JSON.stringify($.extend({_id:d.doc, owner:cw.me()}, doc))\n\t\t};\n\t}\n\telse {\n    \n    if (d.mode+'' == '') cw.lib.note(that.lang.MSG_OK, 'ok');\n    \n\t\treq = {\n\t\t\turl:['_replicate'],\n\t\t\tmethod:\t\t\t\t'POST',\n      contentType:\t'application/json',\n\t\t\theaders:\t\t\t{Accept:'application/json', 'X-Couch-Full-Commit':'true'},\n\t\t\tdataType:\t\t\t'text',\n\t\t\tdata:\t\t\t\t\tJSON.stringify(doc)\n\t\t}\n\t}\n\n\treturn that.Req(req)\n\t.then(function(res0){\n\t\tvar res = res0, \n        msg = that.lang.MSG_OK;\n\t\ttry {\n\t\t\tres = Object.isString(res0)?JSON.parse(res0):res0;\n\t\t}catch(e){}\n    \n    if (d.mode=='doc') {\n      msg = that.lang.MSG_OK_DOC.assign(rname, es(d.doc));\n      $.my.radio('dbupdate', {db:rname, cmd:'write', docs:[d.doc]});\n    }\n    else if (d.mode+'' == '') {\n      msg = that.lang.MSG_OK_ONCE; \n      if (!remote) {\n        $.my.radio('dblist', [d.target]);\n        $.my.radio('dbupdate', {db:d.target, cmd:'write', docs:d.doc_ids.slice(0)});\n      }\n    }\n    \n\t\tcw.lib.note(msg, 'ok');\n\t\t\n\t\t// remove last sync data on success\n\t\t$.extend(that.data, { doc:'', mode:'', source:'', target:'', filter:'', doc_ids:[], query:{}});\n    \n    if (Object.isFunction(that.RestartPoll)) that.RestartPoll();\n\t})\n\t.fail(function(code, err, msg){\n\t\tcw.lib.note(that.lang.MSG_FAIL.assign(code, err), 'error');\n\t});\n})","active": false,"err": [],"opts": [],"color": ["violet"]},{"stamp": "1503694070505","id": ".Tabs","type": "js","data": "([\n\t{\n\t\t\"id\": \"6\",\n\t\t\"name\": \"_users\",\n\t\t\"hash0\": \"abc\",\n\t\t\"hash1\": \"def\",\n\t\t\"active\": false,\n\t\t//\"path\": [\"dev-mb\",'_view','cwmini','backendApps']\n\t\t\"path\": [\"_users\"]\n\t},\n\t{\n\t\t\"id\": \"7\",\n\t\t\"name\": \"zx\",\n\t\t\"hash0\": \"abc\",\n\t\t\"hash1\": \"def\",\n\t\t\"active\": true,\n\t\t\"path\": ['zx']\n\t},\n\t{\n\t\t\"id\": \"8\",\n\t\t\"name\": \"Log\",\n\t\t\"hash0\": \"log\",\n\t\t\"hash1\": \"log\",\n\t\t\"active\": false,\n\t\t\"path\": [\"_log\"]\n\t}\n])","active": false,"err": [],"opts": ["nocompile"],"color": ["green"]}],"pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPGcgb3BhY2l0eT0iMC45Ij4KICAgICAgPHBhdGggZD0iTTEwNy4xMzgsNzQuNTY4IEwxMDcuMTM4LDg0LjY3OSBMMjAuODYyLDg0LjY3OSBMMjAuODYyLDc0LjU2OCBMMTA3LjEzOCw3NC41NjggeiIgZmlsbD0iI0U5MTMxMyIvPgogICAgICA8cGF0aCBkPSJNMjYuMDU5LDQ3Ljc1NiBMMjYuMTE1LDQ4LjE4OSBDMjYuMjU4LDQ5LjIzNCAyNi4zOTUsNTAuMTMxIDI2LjUyNyw1MC44NzggQzI3LjEzOSw1NC4zNCAyOC44MDIsNTcuMjA0IDMxLjMwMSw1OS4xODEgQzMzLjQ1Miw2MC44ODIgMzYuMDk0LDYxLjgyOCAzOC42MzUsNjEuNzk5IEMzOS44MzcsNjEuNzg2IDQxLjEyNSw2MS43OTMgNDYuNDA5LDYxLjgzNyBDNDcuMjQ4LDYxLjg0NCA0Ny44NzIsNjEuODQ5IDQ4LjQ4Niw2MS44NTMgQzUyLjY1Miw2MS44ODQgNTUuMzQzLDYxLjg4OSA1Ny4xNTIsNjEuODU5IEM1OS44MjUsNjIuMDQ4IDYxLjM2NCw2My41MzUgNjIuMjcsNjYuMDEyIEw2Mi4yNyw3MS4wMDQgTDIwLjg2Miw3MS4wMDQgTDIwLjg2Miw0OS45NTcgQzIyLjAwNCw0OS40NTEgMjMuMTQzLDQ4LjkzOSAyNC4yOCw0OC40MjMgQzI0Ljg1Niw0OC4xNTkgMjUuNDY4LDQ3Ljk4NCAyNi4wNTksNDcuNzU2IHogTTEwMS45NDEsNDcuNzU2IEwxMDEuODg0LDQ4LjE5MiBDMTAxLjc0Miw0OS4yMzQgMTAxLjYwNSw1MC4xMzEgMTAxLjQ3Myw1MC44NzggQzEwMC44NjEsNTQuMzQgOTkuMTk4LDU3LjIwNCA5Ni42OTksNTkuMTgxIEM5NC41NDgsNjAuODgyIDkxLjkwNiw2MS44MjggODkuMzY1LDYxLjc5OSBDODguMTYzLDYxLjc4NiA4Ni44NzUsNjEuNzkzIDgxLjU5MSw2MS44MzcgQzgwLjc1Miw2MS44NDQgODAuMTI4LDYxLjg0OSA3OS41MTQsNjEuODUzIEM3NS4zNDgsNjEuODg0IDcyLjY1Nyw2MS44ODkgNzAuODQ4LDYxLjg1OSBDNjguMjE4LDYxLjg3MSA2Ni42NTIsNjMuNzU0IDY1LjczLDY2LjAxMiBMNjUuNzMsNzEuMDA0IEwxMDcuMTM4LDcxLjAwNCBMMTA3LjEzOCw0OS45NTcgQzEwNS45OTYsNDkuNDUgMTA0Ljg1Nyw0OC45NCAxMDMuNzIsNDguNDIzIEMxMDMuMTQ0LDQ4LjE2MyAxMDIuNTM2LDQ3Ljk3MSAxMDEuOTQxLDQ3Ljc1NiBMMTAxLjk0MSw0Ny43NTYgeiIgZmlsbD0iI0ZGMzMzMyIvPgogICAgICA8cGF0aCBkPSJNNjIuMjcsNDEuMzIxIEw2Mi4yNyw2MC4xMDMgQzYxLjA4LDU5LjA0NiA1OS42MzEsNTguNDM3IDU4LjAzNCw1OC4zMTcgQzQ3LjU0NCw1OC4yNDcgNDQuMjYxLDU4LjIzNCA0MC4wODUsNTguMjM1IEMzOS4zNDcsNTguMjM2IDM5LjExMiw1OC4yMzYgMzguOTQ0LDU4LjIzNiBDMzQuNDcsNTguMjM2IDMwLjU3NSw1NC44OTMgMjkuNzM1LDUwLjA4NCBDMjkuNjE2LDQ5LjQgMjkuNDg5LDQ4LjU1NyAyOS4zNTcsNDcuNTc0IEwyOS4yNTUsNDYuNzc4IEMzOS45MTYsNDMuMjE2IDUxLjAxNiw0MS4zNTcgNjIuMjcsNDEuMzIxIHogTTY1LjczLDQxLjMyMSBMNjUuNzMsNjAuMTA1IEM2Ni44NzQsNTguOTQzIDY4LjQ0OCw1OC41MjEgNzAuMDEzLDU4LjMxNSBDODAuNDU2LDU4LjI0NyA4My43MzksNTguMjM0IDg3LjkxNSw1OC4yMzUgQzg4LjY1Myw1OC4yMzYgODguODg4LDU4LjIzNiA4OS4wNTYsNTguMjM2IEM5My41Myw1OC4yMzYgOTcuNDI1LDU0Ljg5MyA5OC4yNjQsNTAuMDg0IEM5OC4zODQsNDkuNCA5OC41MTEsNDguNTU3IDk4LjY0Myw0Ny41NzggTDk4Ljc0NSw0Ni43NzggQzg4LjE1NCw0Mi45NjcgNzYuOTMxLDQxLjU2MyA2NS43Myw0MS4zMjEgeiIgZmlsbD0iI0ZGNjc2NyIvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==","_type": ["app"],"_err": [],"_search": "","_cmd": [],"_opts": {"compileTo": ["js"],"runWidth": "1280","runMode": ["modal"],"runCss": "","runId": "manifest-preview"},"_src": "","_new": false,"_desc": "","timeout": "3000","author": "ermouth","ico": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPGcgb3BhY2l0eT0iMC45Ij4KICAgICAgPHBhdGggZD0iTTEwNy4xMzgsNzQuNTY4IEwxMDcuMTM4LDg0LjY3OSBMMjAuODYyLDg0LjY3OSBMMjAuODYyLDc0LjU2OCBMMTA3LjEzOCw3NC41NjggeiIgZmlsbD0iI0U5MTMxMyIvPgogICAgICA8cGF0aCBkPSJNMjYuMDU5LDQ3Ljc1NiBMMjYuMTE1LDQ4LjE4OSBDMjYuMjU4LDQ5LjIzNCAyNi4zOTUsNTAuMTMxIDI2LjUyNyw1MC44NzggQzI3LjEzOSw1NC4zNCAyOC44MDIsNTcuMjA0IDMxLjMwMSw1OS4xODEgQzMzLjQ1Miw2MC44ODIgMzYuMDk0LDYxLjgyOCAzOC42MzUsNjEuNzk5IEMzOS44MzcsNjEuNzg2IDQxLjEyNSw2MS43OTMgNDYuNDA5LDYxLjgzNyBDNDcuMjQ4LDYxLjg0NCA0Ny44NzIsNjEuODQ5IDQ4LjQ4Niw2MS44NTMgQzUyLjY1Miw2MS44ODQgNTUuMzQzLDYxLjg4OSA1Ny4xNTIsNjEuODU5IEM1OS44MjUsNjIuMDQ4IDYxLjM2NCw2My41MzUgNjIuMjcsNjYuMDEyIEw2Mi4yNyw3MS4wMDQgTDIwLjg2Miw3MS4wMDQgTDIwLjg2Miw0OS45NTcgQzIyLjAwNCw0OS40NTEgMjMuMTQzLDQ4LjkzOSAyNC4yOCw0OC40MjMgQzI0Ljg1Niw0OC4xNTkgMjUuNDY4LDQ3Ljk4NCAyNi4wNTksNDcuNzU2IHogTTEwMS45NDEsNDcuNzU2IEwxMDEuODg0LDQ4LjE5MiBDMTAxLjc0Miw0OS4yMzQgMTAxLjYwNSw1MC4xMzEgMTAxLjQ3Myw1MC44NzggQzEwMC44NjEsNTQuMzQgOTkuMTk4LDU3LjIwNCA5Ni42OTksNTkuMTgxIEM5NC41NDgsNjAuODgyIDkxLjkwNiw2MS44MjggODkuMzY1LDYxLjc5OSBDODguMTYzLDYxLjc4NiA4Ni44NzUsNjEuNzkzIDgxLjU5MSw2MS44MzcgQzgwLjc1Miw2MS44NDQgODAuMTI4LDYxLjg0OSA3OS41MTQsNjEuODUzIEM3NS4zNDgsNjEuODg0IDcyLjY1Nyw2MS44ODkgNzAuODQ4LDYxLjg1OSBDNjguMjE4LDYxLjg3MSA2Ni42NTIsNjMuNzU0IDY1LjczLDY2LjAxMiBMNjUuNzMsNzEuMDA0IEwxMDcuMTM4LDcxLjAwNCBMMTA3LjEzOCw0OS45NTcgQzEwNS45OTYsNDkuNDUgMTA0Ljg1Nyw0OC45NCAxMDMuNzIsNDguNDIzIEMxMDMuMTQ0LDQ4LjE2MyAxMDIuNTM2LDQ3Ljk3MSAxMDEuOTQxLDQ3Ljc1NiBMMTAxLjk0MSw0Ny43NTYgeiIgZmlsbD0iI0ZGMzMzMyIvPgogICAgICA8cGF0aCBkPSJNNjIuMjcsNDEuMzIxIEw2Mi4yNyw2MC4xMDMgQzYxLjA4LDU5LjA0NiA1OS42MzEsNTguNDM3IDU4LjAzNCw1OC4zMTcgQzQ3LjU0NCw1OC4yNDcgNDQuMjYxLDU4LjIzNCA0MC4wODUsNTguMjM1IEMzOS4zNDcsNTguMjM2IDM5LjExMiw1OC4yMzYgMzguOTQ0LDU4LjIzNiBDMzQuNDcsNTguMjM2IDMwLjU3NSw1NC44OTMgMjkuNzM1LDUwLjA4NCBDMjkuNjE2LDQ5LjQgMjkuNDg5LDQ4LjU1NyAyOS4zNTcsNDcuNTc0IEwyOS4yNTUsNDYuNzc4IEMzOS45MTYsNDMuMjE2IDUxLjAxNiw0MS4zNTcgNjIuMjcsNDEuMzIxIHogTTY1LjczLDQxLjMyMSBMNjUuNzMsNjAuMTA1IEM2Ni44NzQsNTguOTQzIDY4LjQ0OCw1OC41MjEgNzAuMDEzLDU4LjMxNSBDODAuNDU2LDU4LjI0NyA4My43MzksNTguMjM0IDg3LjkxNSw1OC4yMzUgQzg4LjY1Myw1OC4yMzYgODguODg4LDU4LjIzNiA4OS4wNTYsNTguMjM2IEM5My41Myw1OC4yMzYgOTcuNDI1LDU0Ljg5MyA5OC4yNjQsNTAuMDg0IEM5OC4zODQsNDkuNCA5OC41MTEsNDguNTU3IDk4LjY0Myw0Ny41NzggTDk4Ljc0NSw0Ni43NzggQzg4LjE1NCw0Mi45NjcgNzYuOTMxLDQxLjU2MyA2NS43Myw0MS4zMjEgeiIgZmlsbD0iI0ZGNjc2NyIvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==","maskstate": "[\"path\"]","nodetitle": "name","nodedoc": "","nodecmd": "","types": "","width": [[1024,2560],1200,1400],"collapsed": [".$about",".$config",".$doc",".$log",".$view",".Ed",".IndexEd",".MangoEd",".NewSync",".SVG",".UserDoc",".ViewEd"],"padding": "none"},"log": [[1537484119276,"update","admin-czpbhuup",1912,"dev-cloudwall2"]],"id": "cw.Photon","stamp": 1537484119276,"creator": "ermouth-hsux6b2a","pic": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwLCAwLCAxMjgsIDEyOCI+CiAgPGcgaWQ9IkxheWVyXzEiPgogICAgPGc+CiAgICAgIDxwYXRoIGQ9Ik02NCwxMjIuODU5IEMzMS40OTMsMTIyLjg1OSA1LjE0MSw5Ni41MDcgNS4xNDEsNjQgQzUuMTQxLDMxLjQ5MyAzMS40OTMsNS4xNDEgNjQsNS4xNDEgQzk2LjUwNyw1LjE0MSAxMjIuODU5LDMxLjQ5MyAxMjIuODU5LDY0IEMxMjIuODU5LDk2LjUwNyA5Ni41MDcsMTIyLjg1OSA2NCwxMjIuODU5IHoiIGZpbGw9IiNGRkZGRkYiLz4KICAgICAgPHBhdGggZD0iTTY0LDIgQzk4LjI0MiwyIDEyNiwyOS43NTggMTI2LDY0IEMxMjYsOTguMjQyIDk4LjI0MiwxMjYgNjQsMTI2IEMyOS43NTgsMTI2IDIsOTguMjQyIDIsNjQgQzIsMjkuNzU4IDI5Ljc1OCwyIDY0LDIgeiBNNjQsOC4yODIgQzMzLjIyOCw4LjI4MiA4LjI4MiwzMy4yMjggOC4yODIsNjQgQzguMjgyLDk0Ljc3MiAzMy4yMjgsMTE5LjcxOCA2NCwxMTkuNzE4IEM5NC43NzIsMTE5LjcxOCAxMTkuNzE4LDk0Ljc3MiAxMTkuNzE4LDY0IEMxMTkuNzE4LDMzLjIyOCA5NC43NzIsOC4yODIgNjQsOC4yODIgeiIgZmlsbD0iI0E2QjZDMCIvPgogICAgPC9nPgogICAgPGcgb3BhY2l0eT0iMC45Ij4KICAgICAgPHBhdGggZD0iTTEwNy4xMzgsNzQuNTY4IEwxMDcuMTM4LDg0LjY3OSBMMjAuODYyLDg0LjY3OSBMMjAuODYyLDc0LjU2OCBMMTA3LjEzOCw3NC41NjggeiIgZmlsbD0iI0U5MTMxMyIvPgogICAgICA8cGF0aCBkPSJNMjYuMDU5LDQ3Ljc1NiBMMjYuMTE1LDQ4LjE4OSBDMjYuMjU4LDQ5LjIzNCAyNi4zOTUsNTAuMTMxIDI2LjUyNyw1MC44NzggQzI3LjEzOSw1NC4zNCAyOC44MDIsNTcuMjA0IDMxLjMwMSw1OS4xODEgQzMzLjQ1Miw2MC44ODIgMzYuMDk0LDYxLjgyOCAzOC42MzUsNjEuNzk5IEMzOS44MzcsNjEuNzg2IDQxLjEyNSw2MS43OTMgNDYuNDA5LDYxLjgzNyBDNDcuMjQ4LDYxLjg0NCA0Ny44NzIsNjEuODQ5IDQ4LjQ4Niw2MS44NTMgQzUyLjY1Miw2MS44ODQgNTUuMzQzLDYxLjg4OSA1Ny4xNTIsNjEuODU5IEM1OS44MjUsNjIuMDQ4IDYxLjM2NCw2My41MzUgNjIuMjcsNjYuMDEyIEw2Mi4yNyw3MS4wMDQgTDIwLjg2Miw3MS4wMDQgTDIwLjg2Miw0OS45NTcgQzIyLjAwNCw0OS40NTEgMjMuMTQzLDQ4LjkzOSAyNC4yOCw0OC40MjMgQzI0Ljg1Niw0OC4xNTkgMjUuNDY4LDQ3Ljk4NCAyNi4wNTksNDcuNzU2IHogTTEwMS45NDEsNDcuNzU2IEwxMDEuODg0LDQ4LjE5MiBDMTAxLjc0Miw0OS4yMzQgMTAxLjYwNSw1MC4xMzEgMTAxLjQ3Myw1MC44NzggQzEwMC44NjEsNTQuMzQgOTkuMTk4LDU3LjIwNCA5Ni42OTksNTkuMTgxIEM5NC41NDgsNjAuODgyIDkxLjkwNiw2MS44MjggODkuMzY1LDYxLjc5OSBDODguMTYzLDYxLjc4NiA4Ni44NzUsNjEuNzkzIDgxLjU5MSw2MS44MzcgQzgwLjc1Miw2MS44NDQgODAuMTI4LDYxLjg0OSA3OS41MTQsNjEuODUzIEM3NS4zNDgsNjEuODg0IDcyLjY1Nyw2MS44ODkgNzAuODQ4LDYxLjg1OSBDNjguMjE4LDYxLjg3MSA2Ni42NTIsNjMuNzU0IDY1LjczLDY2LjAxMiBMNjUuNzMsNzEuMDA0IEwxMDcuMTM4LDcxLjAwNCBMMTA3LjEzOCw0OS45NTcgQzEwNS45OTYsNDkuNDUgMTA0Ljg1Nyw0OC45NCAxMDMuNzIsNDguNDIzIEMxMDMuMTQ0LDQ4LjE2MyAxMDIuNTM2LDQ3Ljk3MSAxMDEuOTQxLDQ3Ljc1NiBMMTAxLjk0MSw0Ny43NTYgeiIgZmlsbD0iI0ZGMzMzMyIvPgogICAgICA8cGF0aCBkPSJNNjIuMjcsNDEuMzIxIEw2Mi4yNyw2MC4xMDMgQzYxLjA4LDU5LjA0NiA1OS42MzEsNTguNDM3IDU4LjAzNCw1OC4zMTcgQzQ3LjU0NCw1OC4yNDcgNDQuMjYxLDU4LjIzNCA0MC4wODUsNTguMjM1IEMzOS4zNDcsNTguMjM2IDM5LjExMiw1OC4yMzYgMzguOTQ0LDU4LjIzNiBDMzQuNDcsNTguMjM2IDMwLjU3NSw1NC44OTMgMjkuNzM1LDUwLjA4NCBDMjkuNjE2LDQ5LjQgMjkuNDg5LDQ4LjU1NyAyOS4zNTcsNDcuNTc0IEwyOS4yNTUsNDYuNzc4IEMzOS45MTYsNDMuMjE2IDUxLjAxNiw0MS4zNTcgNjIuMjcsNDEuMzIxIHogTTY1LjczLDQxLjMyMSBMNjUuNzMsNjAuMTA1IEM2Ni44NzQsNTguOTQzIDY4LjQ0OCw1OC41MjEgNzAuMDEzLDU4LjMxNSBDODAuNDU2LDU4LjI0NyA4My43MzksNTguMjM0IDg3LjkxNSw1OC4yMzUgQzg4LjY1Myw1OC4yMzYgODguODg4LDU4LjIzNiA4OS4wNTYsNTguMjM2IEM5My41Myw1OC4yMzYgOTcuNDI1LDU0Ljg5MyA5OC4yNjQsNTAuMDg0IEM5OC4zODQsNDkuNCA5OC41MTEsNDguNTU3IDk4LjY0Myw0Ny41NzggTDk4Ljc0NSw0Ni43NzggQzg4LjE1NCw0Mi45NjcgNzYuOTMxLDQxLjU2MyA2NS43Myw0MS4zMjEgeiIgZmlsbD0iI0ZGNjc2NyIvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==","_attachments": {"favicon.png": {"content_type": "image/png","data": "iVBORw0KGgoAAAANSUhEUgAAAD8AAABACAYAAACtK6/LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAD5pJREFUeNrcWw14VFV6/s69dyYzk8xMQn6AhEASCD+WByxdVskuKiKidoksrVa2WC1tn/qDsuuDu0tbbf3Z7db1WVt3UXZrQZDqs1pR0a4riqKuKLpaQARakB9DQgiEZCbJ/N57Tr/33twwiUlIMMHE7+FwZyb3nvO+53zn+7v3ihU/vId6FCFIT6XINDTSTI0I/zwaRVotqjug6I+qBLU0Eem6oBQp8vAJbak05fh1IknU0iYoJ0eRtLgrA79J/lmRrpRPSi2bKO0n8sQ1TbZZQiQ0EjyARsq0SOPTW1sFBbMlwzAoHpeUlcVX8PVePs+yFAXziD7cpqh4gqBwjk4yLe1xpSHJMCVZXi+RUj3SM2gQhXkwQbqBsV7FtC7gY4FgLBaaNNvPMkkXGubZbiwnlaDtfPwNX7+Oj22DhW/AyWtCFPHhJ7xAN3q9lmhtTVAigZbiyRDp3NxQU052diIUCpLXl0WpRJLisRi1trX5mpujeVKqAp/P+8c+nw9tFSlN8aSt5YlZyf02DEnyvGgL+bDBo4vsU6eivDVa1KiiotqLLqoKzPjD6Xll40rJ4zE8fE5Rb/2k0yYdPlJDH/3PzqZt734QO3rsWHE4GFwazAku5Q3GG0kt4dOeHxLkeUUW839rrVQ6q6buBI0qzm+49k+uDs2Z8w2fbhgl/e2PJ4gqJ5Sj5f3ZNQvzLNOkN954J7Hp5VeiNTX1RcXFhc95vN6kEOov+fSnzjl52BBewzIlxdspKzXmyOHjNGP6pOYfrLgtZ3TxyKKBVE2eQLps3sU+tGN1x83H1qxv/Wjn/+aOKx35pJLeBwyPms14Dp878pL+tfI8cfuePbVi7NgxkVUP/8hfPHpkLg2y8MQad/3Dnbl1x46nHvr5L+N79h4dU3leycGmqHqY//zdfmttP12dLgxtRyIRn8qr0Lrs9r/Jnj3rAiHazfS5FMUr8PbvtqtfrPpVfHTx6IDP59+tTHk+uzqrr65O64dFyzM8WmNdbd1Un5EVeWTVg1kXVV34pRB31kWji2bPEo+s+pkHeIAL+ICzz56pTwMpmqZ7tKP7DhwKz517Seq++/8upyA/z0NDQIADeIAL+IATeAeEvBJinKEb732y7/8Cf/Gda83r//waw+v16DSEBHiAC/iAE3iB+8wGryetVfbGCmhZ3t179+733/K3S835l1/CMYzQaAiKrmva1dXzyefLMlf/6nH/lCmVu6UlR/KfYj1xNFRK9tCZTkKXBw/sP5zzncWLUvMvv9j7Ze3vvtsBoTFOLdoSTT3zzIs548eXHlSWNsqyrB7UXjjhWTftN42nmkfOunBGbNHCb3mG6IJ3awiBt2rWjDbgB4+eOGrCTioymqMjS0wzfaUprcjNNy/1GoYuaBgJ8N5801JvmvGDB/iAV1euWqTlOLmtOVpPyrD3z5qDh46of1y5Isfv8xk0DIWTIs8/MX7wAB/FJjrS0kDR1hMdrcvKCxi6jU3NUc+C6ssTZeVjdRrGAvzgAT5MbCP4dVp5GDY0TbN/CHHa+e1YWyyyZPG1PvoKCHiAjya0bzv8NHI563kjRtOpUxFqONFIlRWT/7uxsbFi8XULadKkCYMXxLghp61pGZ8HxQVyjp3tow8//NjIH1H09R27dq1vbo4y52YyXDfgy8ryKyHnxuKpyLx5l4bPerTWVqKaGqLjx4kaGohHcX5LJOwylt1qa4mqq4kWLCB66SWiTZuISkrs0o/dfKx0OTlEI0Zw9s9J4kh216Wlzm9nIczHt37DsxFF1lzwTKVScdswXnb5lXZEY5rmvfVHa9hNXOVh1e97z59+SrRvn3ME0bY2Ik6GKJk83Tgn76hTcYpKR44QzZ7tXN/U5FwfjzvnQRPsnJnPQ9HObUhSsrOdCRk/nmjyZOfYp3KaoIVXX+HZuvV3VPXNi+41DONO+DqjvramPUTM+t7JE01UvWB+gHovtRDt2kX0+98THTvGJjRCFI0StbQ45DweBzhWEJ8BXNM6Ffbs80HGGZgoj3OR3FxHK1xxtQQTCa3BxGBsTMzOnUShEFGYFXT0aKKvfY1o2jRnvB6kuvrKwH89s4kC2dnfS6WSd9or71hAMZlXXh8/YexJjpMLul5o7dhBWmEhCajmgw8SHTjgrDAE5DBoQUHn/Zz5WXaJIrv77rYuFVC7/4wU2xZMCLQMkw+tef99ogkTiFauJMVbSp44Qfr553fqKsvrIfCLJ9IFbPQmK6X2aZ4sDxle46Y4q91ll83Jzgzt5TvvUPqee0gtW0Zq2zbnD/v3O6sM9UMLBBzyLnhXbXvJo/ttHN3mjoHxMK6LAXiAC6czTuAFbuDPRAF+4Am+4A3DT4bmuSEabaFvzPq6v2OSWc3MH/+Y6Nln7dm0GtoLpxMnOnsPhjKT7LmtZJyeDOAAHuCCljJO4AVu4AcPV8APPMEXvLWcYD6qIrl+vz+a5ctQMVzE6mPvKW6CjZRNcebM7lX3yxIXB+MCPuB0Mdv4M8iDH3iCL3hr/KEkzYakvKz01Of2G1QLnfPMyjffJIHPc+cS9+C4L9eC96X1syTc5wYcwMO4gA84bU0AVuDXOidk4Am+4K1FIiemJxJJqqwcH+ylWkDi5Emytm93vn//+07HUC9YbljhMzV3mwjxOUD2d/zuqnFf+sO4GB84gAcqz/iAs8OTdCPgCb7gzfmPmsaWnirKx/ZefeUgQ919N8kXXyStrIzorruIfvtbok8+cSxvZrSWaekz9yfOgT+vqzutrjjiOwQriHPdyXA1JlNz3HFg6BArXHEFB/FlJNkdAp8dDPUi4Pn6G28TeLND9pSkLUn5+fl6r/uKVUkdPkzyjjuIHnjAmYCbbnIiOQQq7sp1NUqZEwFSCHo2bHAmAYLjxRdzEL7EcWtuH5nEM8mjD/SH2ACRH+Cx6ktefYVJBK5e7BF4gi94G4KsoOIvPn9nVZFdLTg6LC8ntXUrydtuI1q4kMQllzgA2kF0cwure5k0yQl9oeKwIYsXO+rbQzWtR+EAS23ZYmujwpasqHD67C3VZZ7gC94IxfKUsnjsPsTN6BgTwBGWuXs3aS+84MTkbn3c3c/trVPZC3/H9WyFNSYrsEJ23llGilVWrl3rBC2cbXWsNF+jugZB7jgIdBDQfPwxiXZcZyIOAU/wZcnrsVCh9WShAQCujwdX2O8Ic7uqe8dH1XmvAjA3uXcvGffeS4ITGBA3sVd//WtnEjNvNHTF0FX92UYIhMW4pp+uV2qaZPKySQidYrFWyg0H+x5kuCFtf9wYzoVh2riR1IwZJK67jtTzz9vfBYIUZHP9CZjOIpoET/DliyKGIr1F6Bol4snuOx/oKI6NmoCfra93huAjvtvGDpoxMFXM07i7SJx5gq+Q1MIrn6718JfGxlNWRUWZ3ml/s89UUC9jAMt46AuZYLJ9svmo8B1eIyMa+8KCvty4IUPAk/kyT6vWsJTYxfktHTz0WfPMmTPyMwMbD3y5YThGaCCF4wJRVeVUWqqrScP2gd8eSAFpTECXgOcQ82S++TbvcLhwJ6kGToo+bYEbzKj/kOI9OVg1a9m+6jRlCglug5L/dONuwdPny8oHb87ntVoPG69Dh2s6Tb3i/Xf0xhsdd2UMQvW6qxscaOFVh7cpffxxEhmrD56Fhfko1tYarS2NqNw2c56bm+SY183s8DjISXY/SBaG+m2q7h2Bsu1V8WOPcf7ukAc/5hli4s3gbUiy2C5Y60Kh4PJ33n0/fumc2XZOr7HaZ/E+FLDOvSQKQ5Y84hDeVlqGvQI/5uk3ZXqdbXvTyTRWdjXnuctfe+2NNpc8VNHCxW5kNtyE3aeE68zYUuDHPP1mylwNzTBs9VBqn9ebZX164LOCZCpt17uUm13BYmra8CPfjtuNMsEL/MaWlVqpVHKfvfKjSkrd0vVDBW1tKzZtejl2zZ9WBzRW9VErV3JAoA9P8myrFGus1r5lwaugcEQglJf3kGEbcEHi0nkL2t261z992vRYTc2xyBPrVoX7Vbsf8vOg6Pobbo2Ulo4O79y1M+DetOi4V5dIJuNCaVv8fm/41VdfT9BXSMDH7/eFBelbwNPlLG5etrzDNUgpQ+HcwkhdTX1kzX/8W8jr9Qz75U+l0mrpXy2PFo8ZFY5GG1mjtajrujXcq0OT2CNKRllFngtkB8Ibnnr6K7H64AE+UsnnHH6SXM6o3tLphkIBLcrLDaVf3LTZd/jQZ9ZwJg784AE+TGyR49lO89XCwZHkttzQKBIm3LpcWlE+Ttzzzw+2xhMJczgSB27gBw/wEbyM4WARhXIKO1qXlcd7ELZf3GAYnpcNTQ8/+uialGlaajgRB17gBn7wAB/w6spVc56367ZdlT8i9/i7730U2Pj8S2mcPDxieknAC9zADx49cTSEt/sAxq7eKlExobLs+JNPbcwJhULm/HlD9yHEdo8lX9n8pmS83ilTKltNS1YQXtTQu4fc88o7aWdMJlNTp0yaEF/9yzXGC5tekbx/hqQKABfwPcI4gRe4gb8jse+mnXEVhVJHTMu8cMqkibH1Tz5tPPGfz5jsO4eUFwAe4AK+P5g8MQa8wH3Gilqf1EnQListx0yeUH5oy5at4b2790Xu/MHtgaHw5PXJxqb0T//l4Vjd8fow44uYKVmudGrqy7V937+Kmsy0zC8uKd6dMJPhW25dkXxr23tKKfVl7W/C+LfcekcaeIAL+ICzr33oVd+c02upSUP0x0mOkLhnRkrTxaOtMS2veFR49uZX3hLvf7AjMnXqZC0YzDlnDyziNZP77v9Z62uvvumrqBhrtMb0h/0+7WolnVs8eBtN42RGnaHwelaWm+39d/fvURXnnVdyNJ1Ohpfd/vfe++7/aTNeABpM0ugf42A8jIvx9++RFcBzNv2dVWUSeYGZpsM8aCkHEksmVo57rPFUJHf5HXfbr5ZVXznffbXsi1vxjFfL6usa8WpZLo+XNFPpv+bxN5jps39+8QujY1XbgAhKz/IsKh9Xst6UVtHTz75A/75ugxpVWFRXVTUz86XCPlSfMl4q3PZBrP5EQ3E4J+gLBoM+7r/NJGm/VMjjfuGJHbCaNHuEjXho2bJU0YgRoZ/k5YVv5Myp5K23ttHmza9/7nVSfyDQ0+ukHp/Pi6em8zgHzysrHaOEUGtjCflDQ6MGRQNnYI1BsMJ4bGspY1waI5kd9AevDwQC39J0/QJWkwK2SUVp06JEU4Tc2wo6R2A+v5+KcY9eaCc5ktquKf2lFko+EVR6G+48yEHwKoP6LL1FCk8qrmaSq1V7pIWjLsgnNKP9FXIjrgnZxlFTQnXcYlHu9YPqNf5fgAEAv4MXMF635wkAAAAASUVORK5CYII="}}}]