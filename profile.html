<!DOCTYPE html>
<html>
<head>
<title>Edit your profile</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="icon"  type="image/png" href="i/favicon.png">

<!-- CSS first for correct pixel measuring during start -->

<link rel="stylesheet" type="text/css" href="css/general.css" />
<link rel="stylesheet" type="text/css" href="css/cw.css" />

<!-- Base lib -->

<script src="lib/general.js"></script>
<script src="lib/pouchdb.js"></script>
<script src="lib/plugins.js"></script>
	
<!-- CloudWall.me -->
<script src="sys/crypto.js"></script>

</head>

<body>
<div id="cw-notes"></div>
<div id="cw-body" style="width:600px" class="pt25 pb15">
<div id="cw-header" class="cb fs90 blue pb20 mb30" style="width:100%;border-bottom: 1px solid rgba(35, 118, 200, 0.25);">
	<a href="../" class="dib vat tdn w240 ml-40 o80"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
		 x="0" y="0" width="100%" viewBox="0, 0, 400, 32">
 <defs>
   <linearGradient id="G_2" gradientUnits="userSpaceOnUse" x1="3.962" y1="24" x2="55.184" y2="8">
     <stop offset="0" stop-color="#ACD6FF"/>
     <stop offset="0.455" stop-color="#9AC4F5"/>
     <stop offset="1" stop-color="#7494D0"/>
   </linearGradient>
 </defs>
     <path d="M36,0 C45,-0 51,7 50,14 C58,15 59,20 59,22 C59,28 54,31 48,31 L9,31 C4,31 0,28 0,23 C-0,18 3,15 7,14 C7,8 13,3 20,3 C23,3 25,4 26,5 C26,3 30,0 36,0 z" fill="#FFFFFF"/>
     <path d="M8,32 L8,31 L8,31 C7,31 6,31 6,31 C3,30 1,28 0,26 C0,26 0,26 0,26 L10,26 L10,32 z M38,32 L38,26 L11,26 L11,32 z M50,32 L50,31 C50,31 51,31 52,31 C52,31 53,31 53,31 C55,30 56,29 57,27 C57,27 58,27 58,26 C58,26 58,26 58,26 L39,26 L39,32 z M58,24 C59,23 59,21 58,19 C58,18 57,18 57,17 C57,17 57,17 57,17 L54,17 L54,24 z M53,24 L53,17 L26,17 L26,24 z M24,24 L24,17 L2,17 C1,18 0,20 0,22 C-0,22 -0,23 0,24 C0,24 0,24 0,24 z M55,15 C55,15 55,15 54,15 C54,15 53,14 52,14 C51,14 51,14 50,14 C50,13 50,13 50,12 C50,11 50,9 50,8 L50,8 L39,8 L39,15 z M38,15 L38,8 L11,8 L11,15 z M10,15 L10,8 L9,8 C9,8 9,8 9,8 C8,10 7,12 7,14 C7,15 6,15 6,15 C5,15 5,15 4,15 z M49,6 C49,6 49,6 48,6 C48,5 47,4 47,4 C45,2 42,0 39,0 C38,0 37,-0 36,0 C34,0 32,0 30,1 C28,2 27,3 26,4 L26,4 L26,6 z M24,6 L24,4 C23,4 23,3 22,3 C21,3 21,3 20,3 C20,3 19,3 19,3 C18,3 17,3 16,3 C15,4 13,5 11,6 C11,6 11,6 11,6 z" fill="url(#G_2)"/>
   <path d="M107,7 L102,9 Q97,4 89,4 Q83,4 79,7 Q75,11 75,15 Q75,21 79,24 Q83,27 89,27 Q98,27 102,22 L107,24 Q103,28 99,30 Q95,32 89,32 Q81,32 75,27 Q69,23 69,15 Q69,8 75,4 Q81,-0 89,-0 Q101,-0 107,7 z M166,18 Q166,22 163,24 Q160,27 154,27 Q149,27 146,24 Q142,22 142,18 Q142,14 146,11 Q149,9 154,9 Q160,9 163,11 Q166,14 166,18 z M172,18 Q172,12 166,8 Q161,4 154,4 Q147,4 143,8 Q137,12 137,18 Q137,24 143,28 Q147,31 154,31 Q161,31 166,28 Q172,24 172,18 z M207,5 L202,5 L202,21 Q202,27 192,27 Q182,27 182,21 L182,5 L177,5 L177,22 Q177,26 181,29 Q185,31 192,31 Q199,31 203,29 Q207,26 207,22 z M221,26 L221,10 L233,10 Q237,10 240,12 Q242,14 242,18 Q242,22 240,24 Q238,26 234,26 z M216,5 L216,31 L233,31 Q237,31 240,30 Q242,29 244,27 Q248,23 248,18 Q248,12 244,9 Q240,5 233,5 z M295,0 L288,26 L280,0 L273,0 L266,26 L258,0 L252,0 L262,31 L269,31 L277,5 L284,31 L291,31 L301,0 z M313,21 L319,9 L326,21 z M322,5 L316,5 L302,31 L307,31 L310,25 L328,25 L331,31 L337,31 z M366,26 L349,26 L349,5 L344,5 L344,31 L366,31 z M400,26 L379,26 L379,5 L374,5 L374,31 L400,31 z M135,26 L118,26 L118,5 L113,5 L113,31 L135,31 z" fill="#719BD3"/>
</svg></a>
</div>
<div id="cw-space" class="tac"></div>
</div>
</body>

<script>
$(function(){
	$.my.modal.parent("#cw-body");
	PouchDB.enableAllDbs = true;
	$("#cw-space")
		.my(
			{
	"id": "cw.Sys.Profile.Editor",
	"build": 10,
	"params": {
		"animate": 100,
		"effect": function ($e,onoff,duration) {

			      if (onoff) { $e.slideDown(duration); return; }
			      $e.slideUp(duration);
			    
			}
	},
	"error": "<span class=\"xgray fs110\">Sorry, no CloudWall profile found.</span><br><a href=\"./index.html\" class=\"button tdn lh160 pl30 pr30 mt20\"><span class=\"fi-torso o70 mr5\"></span>Create profile...</a>",
	"ui": {
		"#pic": {
			"bind": function (d,v,$o) {

				      if (v!=null) {
				        $.my.modal({
				          manifest:this.Cropper,
				          data:{data:"",filename:""}
				        }).then(function (crop) {
				          if (crop && crop.data) {
				            d.doc.pic="data:image/jpeg;base64,"+crop.data;
				            $o.trigger("recalc");
				            crop.data="";
				          }
				        });
				      }
				      return d.doc.pic;
				    
				},
			"events": "click.my"
		},
		"#name": {
			"bind": "doc.name",
			"check": /^(|[a-z0-9]{3,40})$/i,
			"error": "3–40 latins and nums",
			"css": {
				":disabled": function (d) {
					return !d.isnew
					}
			},
			"recalc": "#pin"
		},
		"#pin": {
			"bind": "pin"
		},
		"#btn-create": {
			"delay": 50,
			"bind": function (d,v,$o) {

				    var db, d2, that=this, uname = d.doc.name+"-"+d.doc.uid;
				    if (v!=null && $o.my().root.my("valid") && this.db) {
				      if (cw.lib.sdbm($o.my("find","#pic").attr("src"))=="79adusu9") {
				        cw.lib.note("Please change userpic","error");
				      }
				      else {

				        if (d.isnew) {
				          d.doc.pin = _pin();
				          d.doc.dbs[0].creator = uname;
				          d.doc.keys = d.doc.keys.map(function(e){
				            e.emitter=uname; 
				            e.link=d.doc.contact;
				            return e;
				          });
				        } else if (d.pin) d.doc.pin = _pin();

				        try{cw.crypto.enc(d.doc)}
				        catch(e) {console.log(e.message, e.stack, e);}

				        if (d.isnew) {							

				          $.my.modal(
				            '<div class=" pt20 pb15 w350 tac blue">'
				            +'Loading system apps, it can take a time. '
				            +'<br>Please, wait.'
				            +'<br><div class="cw-busy w50 mt10"></div>'
				            +'</div>'
				            ,function(){},500);

				          // Read app list

				          $.ajax({ url:"cw.apps.json", type:"GET", dataType:"json", cache:false })
				          .then(function(a){
				            var b, i, j, o;
				            if (!Object.isArray(a) || !a.length) {
				              $.my.modal();
				              cw.lib.note("Oops, server responded with error. Please retry in 5-10 minutes.", "error", 5000);
				              console.log(a);
				            }
				            else {
				              b = Object.clone(a, !0)
				              for (var i=0;i<b.length;i++) {
				                o=b[i];
				                o.srcrev = o._rev;
				                delete o._rev;
				                if (o._attachments) for (j in o._attachments) {
				                  o._attachments[j] = Object.select(o._attachments[j],["content_type","data"]);
				                }
				              }
				              // encrypt settings doc
				              b.push(cw.crypto.enc(d.doc));
				              that.db.bulkDocs({docs:b})
				              .then(
				                function(a){
				                  // everything is ok, reload page	
				                  $.my.modal();
				                  cw.lib.note("Account created, reloading page.", "ok", 5000);
				                  window.location.replace("./index.html");
				                },
				                function(a){
				                  $.my.modal();
				                  cw.lib.note("Saving account info and apps failed. Try again, please.", "error", 5000);
				                  console.log(a);
				                }
				              )
				            }
				          })
				          .fail(function(e){
				            $.my.modal();
				            cw.lib.note("Error loading apps. Try again, please.", "error", 5000);
				            console.log(e);
				          });

				        } else {

				          this.db.put(cw.crypto.enc(d.doc), function (){
				            window.location.replace("./")
				          });

				        }
				      }

				    }

				    function _pin() {
				      return cw.lib.md5(cw.lib.md5(cw.lib.md5(d.pin)+cw.lib.hash8(d.pin))+d.doc.name);
				    }
				  
				},
			"events": "click.my",
			"watch": "#name",
			"css": {
				":disabled": function (d) {
					return !d.doc.name || !/^(|[a-z0-9]{3,40})$/i.test(d.doc.name)
					}
			}
		},
		"#keylist": {
			"manifest": "Keys",
			"bind": "doc.keys",
			"check": true,
			"list": "<div class=\"mb20 pt20 btd\"></div>"
		},
		"#btn-addkey": {
			"bind": function (d,v,$o) {

				    if (v!=null) {
				      $.my.modal({
				        manifest:cw.lib.fuse(
				          {},
				          this.Confirm,
				          {ui:{
				            "#key":{
				              bind:function(d,v){
				                var that=this;
				                if (v!=null) {
				                  if (/^.{3,40}$/.test(v.compact())) {
				                    d.key = cw.lib.fuse(
				                      {},
				                      d.empty,
				                      {
				                        id: cw.lib.hash8(Number.random(-1e13,1e13)+Date.now()+""),
				                        key: cw.lib.key16(Number.random(-1e13,1e13)),
				                        stamp:Date.now(),
				                        emitter:('{name}-{uid}').assign(cw.crypto.me()),
				                        link:cw.crypto.me().contact,
				                        local:false,
				                        name:v.compact(),
				                        desc:v.compact()
				                      }
				                    )
				                  }
				                  else if (v.length>100) {
				                    try{
				                      var key = cw.lib.base64(v,true);
				                      if (Object.isObject(key) 
				                          && key.name 
				                          && key.id 
				                          && key.emitter 
				                          && key.key
				                          && !key.local
				                         ) {
				                        d.key = cw.lib.fuse(
				                          {},
				                          d.empty,
				                          key,
				                          {stamp:Date.now()}
				                        )
				                      } else delete d.key;
				                    }catch(e){
				                      delete d.key;
				                    }
				                  } else {
				                    delete d.key;
				                  }
				                }},
				              check: function (d,v0) {
				                var that=this, isName=false, isKey = false, v=(v0||"").compact();
				                if (/^.{3,40}$/.test(v)) {
				                  if (d.names.indexOf(v+"|"+cw.crypto.me().name)>-1) 
				                    return "Name already exists, no dupes allowed";
				                  isName=1;
				                }
				                else if (v.length>100) {
				                  try{
				                    var key = cw.lib.base64(v,true);
				                    if (Object.isObject(key) 
				                        && key.name 
				                        && key.id 
				                        && key.emitter 
				                        && key.key
				                       ) {
				                      if (key.local) return "This is non-public key, unable to install";
				                      if (d.ids.indexOf(key.id)>-1) return "Key already installed";
				                      if (d.names.indexOf(key.name+"|"+key.emitter.split("-")[0])>-1) 
				                        return "Key with this name/user pair already exist, no dupes allowed";
				                      isKey=1;
				                    }
				                    else return "Invalid key structure";
				                  }catch(e){
				                    return "Invalid key code";
				                  }
				                }
				                if (!isName && !isKey) return "Input required";
				                return "";
				              }
				            }
				          }}
				        ),
				        data:{
				          empty:this.Keys.data,
				          names:d.doc.keys.map(function(e){return e.name+"|"+e.emitter.split("-")[0]}),
				          ids:d.doc.keys.map(function(e){return e.id}),
				          text:'<p>Enter key name or key share code</p>'
				          +'<div><input type="text" id="key" placeholder="Short name or long code" class="w350 fs120">'
				          +'<div class="my-error-tip fs80"></div></div>',
				          ok:"Add key"
				        },
				        esc:true
				      })
				      .then(function(data){
				        if (Object.isObject(data) 
				            && data.key) {
				          //d.doc.keys.insert(Object.clone(data.key,true),0);
				          $o.my("find","#keylist")
				          .trigger("insert",{
				            where:0, 
				            what:Object.clone(data.key,true)
				          });
				        }
				      })
				    }
				  
				},
			"events": "click.my"
		}
	},
	"data": {
		"isnew": false,
		"dburl": "",
		"dbpwd": "",
		"dblogin": "",
		"prevpin": "",
		"pin": "",
		"doc": {
			"_id": "cw",
			"type": "settings",
			"stamp": 0,
			"name": "",
			"pin": "",
			"uid": "",
			"contact": "",
			"crypto": "PIN",
			"tags": {
			},
			"keys": [],
			"dbs": [],
			"pic": ""
		}
	},
	"init": function ($o,form) {

	var db, 
		      that=this,
		      pi=$.Deferred(), 
		      _isnew=false, 
		      _settings = cw.crypto._settings;

	that.Pouch = PouchDB;
	that.Settings = _settings; 
	form.data.isnew = _isnew;

	cw.log("~~~ Profile editor started ~~~");
		  
		  var db = new PouchDB("cw");
		  db.get('cw')
		  .then(function(doc){
		  	if (!doc.CRYPTO) {
		      cw.log("Profile is not encrypted");
		      _new(doc);
		    } else {
		      cw.log("PIN requested.");
		      cw.crypto._init(doc)
		      .then(function(){
		        cw.log("PIN ok.");
		        _new(_settings());
		      })
		      .fail(function(){
		        cw.log("Error: can‘t decrypt profile");
		        pi.reject("Invalid PIN");
		      });
		    }
		  })
		  .catch(function(){
		  	_new();
		  });
		  
	return pi.promise();

	//- - - - - - - - - - - - - - - - - 

	function _new(doc){
		
		if (doc) {
			
			// Start editor
			
			cw.log("Starting cw.SysProfile.Editor");
			
			$.extend(true, form.data.doc, doc);

			that.db = db;
			if (!form.data.doc.uid) form.data.doc.uid=cw.lib.hash8(Date.now()+Number.random(1e30));
			$o.formgen(that.FormHTML);
			$o.find("#abouttext").html(that.Intro);
			if (!_isnew) {
				$o.find("#btn-create").val("Save");
				$o.find(".btn-link").hide();
				$o.find ("#keys").show();
				$o.find ("#abouttext").hide();
			}
			pi.resolve();

		}
		else {
			
			// No profile, fail

			$("#cw-header img").animate({
				"margin-left":"162px",
				"margin-top":"40px"
			},200)

			pi.reject('No CloudWall profile found.');
		}
	}

		},
	"Confirm": {
		"id": "cw.Sys.Confirm",
		"params": {
			"delay": 20,
			"strict": true,
			"width": 350
		},
		"data": {
			"text": "",
			"css": "xgray",
			"ok": "Ok",
			"cancel": "Cancel"
		},
		"init": function ($o,form) {

		var d=form.data;
		$o.formgen([
			'<div class="'+d.css+'">'+d.text+'</div>',
			{label:"70px", row:"350px", rowCss:"my-row mt15 pt15 fs90 mb-5 xgray btd"},
			['', 'btn#btn-ok.green.mr5',{val:d.ok}, 
			 'btn#btn-cancel',{val:d.cancel}]
		]);
	
			},
		"ui": {
			"#btn-ok": {
				"bind": function (d,v,$o) {

				if (v!=null) {
					$o.trigger("commit");
				}
			
					},
				"events": "click"
			},
			"#btn-cancel": {
				"bind": function (d,v,$o) {

				if (v!=null) {
					$o.trigger("cancel");
				}
			
					},
				"events": "click"
			}
		}
	},
	"Cropper": {
		"params": {
			"strict": true,
			"width": 820
		},
		"data": {
			"filename": "",
			"data": "",
			"cropped": false,
			"size": 200
		},
		"init": function ($o,form) {

		var html = $.my.formgen([
			'<div class="fl mr20 tac vat bg-lgray" style="width:600px;height:450px;'
			+'overflow:hidden;position:relative;line-height:450px;" id="crop-frame">',
			'<img id="source" class="vam" style="max-width:600px; max-height:450px; background:white" src="" />',
			'<div class="w600  dib" style="height:450px;position:absolute;top:0;left:0">',
			'<span class="dib vam fs110 button">',
			'<span class="fi-photo"><span class="fs110"> &nbsp;Select Image</span></span>',
			'</span>',
			'<input type="file" id="file" class="w600 dib" accept="image/jpeg,image/png" '
			+'style="height:450px;cursor:pointer;opacity:0; position:absolute;top:0;left:0">',
			'</div>',
			'</div>',
			'<div class="w200 dib vat" id="xpreview">',
			'<canvas id="preview" class="bg-lgray" style="width:200px;height:200px" width='
			+form.data.size+' height='+form.data.size+' style="overflow:hidden;"></canvas>',
			{row:"200px",rowCss:"mt10 pt15 btd fs90 tac"},
			["","btn#btn-apply.mr5.green",{val:"Apply"}, "btn#btn-close.mr0",{val:"Cancel"}],
			'</div>',
			'<div class="w200 dib vat" id="xwarn">',		
			'</div>',
			'<div class="hide"><canvas id="x2" width='+form.data.size*2+' height='+form.data.size*2+'></canvas></div>'
		]);
		$o.html(html);
	
			},
		"style": {
			" .jcrop-holder": "display:inline-block;vertical-align:middle"
		},
		"ui": {
			"#file": {
				"bind": function (d,v,$o) {


				var f,
						$r = $o.my().root,
						$c = $r.find("#preview"),
						$img = $r.find("#source"),
						$c2 = $r.find("#x2"),
						n={k:1}, img="";


				if (v!=null && v) {
					f = $o[0].files[0];
					if (f) (function(){
						d.filename = f.name;

						var fr = new FileReader(), ri, sb64 = [];
						fr.onload=function(e){
							ri = new Uint8Array(e.target.result);
							for (var i=0; i<ri.length; i++) sb64.push(String.fromCharCode(ri[i]));
							img = window.btoa(sb64.join(""));
						};

						fr.onloadend = function (){
							$img.load(function(){
								n.k = $img[0].naturalWidth/$img.width();
							});
							$img.removeClass("hide")
							.attr("src","data:image/jpeg;base64,"+img);

							n.k=$img[0].naturalWidth/$img.width();	
							$img.Jcrop({
								onChange: preview,
								onSelect: preview.debounce(20),
								aspectRatio: 1,
								allowMove:true
							}, function (){
								this.animateTo([100,100,300,300]);
							});
							img="";
							$o.parent().addClass("hide");

						};
						fr.readAsArrayBuffer(f);	
					})();
				}

				function preview (c){
					if(parseInt(c.w) > 0) {
						// Show image preview
						var img = $img[0], cs, ctx, cs2, ctx2, 
								k = n.k,
								w = c.w*k; //width to scale in 200px
						if (w>d.size*2) {
							// double downsample to remove
							// bilinear-scaler artifacts
							cs2 = $c2[0];
							ctx2 = cs2.getContext("2d");
							ctx2.fillStyle="white";
							ctx2.fillRect(0,0,d.size*2, d.size*2);
							ctx2.drawImage(img, c.x*k, c.y*k, w, w, 0, 0, d.size*2, d.size*2);
							cs = $c[0];
							ctx = cs.getContext("2d");
							ctx.drawImage(cs2, 0, 0, d.size*2, d.size*2, 0, 0, d.size, d.size);
						} else {
							cs = $c[0];
							ctx = cs.getContext("2d");
							ctx.fillStyle="white";
							ctx.fillRect(0,0,d.size, d.size);
							ctx.drawImage(img, c.x*k, c.y*k, w, w, 0, 0, d.size, d.size);
						}
						d.cropped=true;
					}
				}
			
					}
			},
			"#btn-apply": {
				"bind": function (d,v,$o) {

				if (v!=null && d.cropped) {
					d.data = $o.my().root.find("#preview")[0]
					.toDataURL('image/jpeg',0.93)
					.substr(23);
					$o.my().root.trigger("commit");
				}
			
					},
				"events": "click.my"
			},
			"#btn-close": {
				"bind": function (d,v,$o) {
					if (v!=null) $o.my().root.trigger("cancel");
					},
				"events": "click.my"
			}
		}
	},
	"Keys": {
		"data": {
			"id": "",
			"key": "",
			"stamp": 0,
			"name": "Noname",
			"emitter": "",
			"link": "",
			"desc": "",
			"local": false,
			"shared": []
		},
		"init": function ($o) {

		$o.html($.my.formgen([
			{row:"350px", label:"0px", rowCss:"my-row pb5"},
			["",'<span class="mr10">','inp#keyid.w90.xgray.bold',{disabled:"disabled"},
			 '</span><span>','inp#keyname.w250',{plc:"3-40 chars key name"},'</span>'],
			'<div class="ml6"  style="word-break:break-all">Key is <span id="keyval"></span></div>',
			'<div class="ml6">',
			'<div class="fr w120 hoverlink blue tar fs90 lh120 o80 hide mt3" id="xbtn">',
			'<span id="xshare"><span class="fs90 fi-share o70"></span> ',
			'<span id="btn-share" class="pseudolink mr10">Share</span></span>',
			'<span class="fs80 fi-minus o70"></span> ',
			'<span id="btn-delkey" class="pseudolink">Del</span>',
			'</div>',
			'Emitted by <span id="emitter"></span>',
			'</div>'
		]));
	
			},
		"ui": {
			"#keyid": "id",
			"#keyname": {
				"bind": "name",
				"check": /^.{3,40}$/
			},
			"#keyval": "key",
			"#emitter": function (d) {

			return d.emitter.split("-")[0];
		
				},
			"#xbtn": {
				"bind": function () {

					},
				"css": {
					"hide": function (d) {
						return d.local && d.emitter==cw.crypto.me().name
						}
				}
			},
			"#xshare": {
				"bind": function () {

					},
				"css": {
					"hide": function (d) {
						return d.emitter.split("-")[0]!=cw.crypto.me().name
						}
				}
			},
			"#btn-delkey": {
				"bind": function (d,v,$o) {

				if (v!=null) $o.trigger("remove");
			
					},
				"events": "click.my"
			},
			"#btn-share": {
				"bind": function (d,v,$o) {

				if (v!=null) {
					$.my.modal(
						'<p>Copy and send this code:</p>'+
						'<textarea class="w500 fs80 lh120" rows=7>'+
						cw.lib.base64(d)+
						'</textarea>'
						,500);
				}
			
					},
				"events": "click.my"
			}
		}
	},
	"FormHTML": ["<div id=\"cw-reg\" class=\"w600 vat dib tal\" style=\"margin:0px auto 100px auto\">",
		"<div id=\"left\" class=\"w250 dib vat pr50\">",
		{
			"row": "200px",
			"rowCss": "my-row pb10 tac"
		},
		"<div class=\"slide\">",
		"<img id=\"pic\" src=\"\" style=\"width:200px;height:200px;cursor:pointer\" class=\"db mb2 br4\">",
		"<div class=\"fs70 lgray mb10 tac\">Click to change pic</div>",
		["",
			"inp#name.w200.fs130.pb5.tac.bg-gray6.xgray",
			{
				"plc": "Login",
				"autocorrect": "off",
				"autocapitalize": "off",
				"autocomplete": "off"
			},
			"msg"],
		["",
			"pwd#pin.w200.fs130.tac",
			{
				"plc": "New PIN code",
				"title": "Leave blank to skip previous PIN.",
				"autocorrect": "off",
				"autocapitalize": "off",
				"autocomplete": "off"
			}],
		["",
			"btn#btn-create.w180.fs100.tac.mt10.mb20",
			{
				"val": "Create profile",
				"style": "border-radius:100px"
			}],
		"</div>",
		"</div>",
		"<div id=\"right\" class=\"w350 dib vat\">",
		"<div class=\"fs90 gray slide\" id=\"about\">",
		"<div class=\"fs90 w350\" id=\"keys\" style=\"display:none\">",
		"<div class=\"pb10\">",
		"<div class=\"fr w120 hoverlink blue tar\">",
		"<span class=\"fs90 fi-plus o70\"></span> ",
		"<span id=\"btn-addkey\" class=\"pseudolink\">Add key</span>",
		"</div>",
		"<h3 class=\"xgray mb0 mt0\">Cryptokeys</h3>",
		"</div>",
		"<div id=\"keylist\" class=\"lh150\"></div>",
		"</div>",
		"<div class=\"w350\" id=\"abouttext\"></div>",
		"</div>",
		"<div class=\"fs90 gray slide\" style=\"display:none\" id=\"aboutLink\"></div>",
		"</div>",
		"</div>"]
},
			{doc: {} }
		)
		.fail(function (msg){
			cw.lib.note(msg, "error")
		});
	
});

</script>

</html>