/*PouchDB 3.3.3, custom fork*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.PouchDB=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c)===!0)return a[c];return!1}function e(a){return function(b,c){b||c[0]&&c[0].error?a(b||c[0]):a(null,c.length?c[0]:c)}}function f(a){var b={},c=[];return j.traverseRevTree(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){void 0===b[a.from]?b[a.from]=1+b[a.to]:b[a.from]=Math.min(b[a.from],1+b[a.to])}),b}function g(a,b,c){var d="limit"in b?b.keys.slice(b.skip,b.limit+b.skip):b.skip>0?b.keys.slice(b.skip):b.keys;if(b.descending&&d.reverse(),!d.length)return a._allDocs({limit:0},c);var e={offset:b.skip};return o.all(d.map(function(c){var d=i.extend(!0,{key:c,deleted:"ok"},b);return["limit","skip","keys"].forEach(function(a){delete d[a]}),new o(function(b,f){a._allDocs(d,function(a,d){return a?f(a):(e.total_rows=d.total_rows,b(d.rows[0]||{key:c,error:"not_found"}),void 0)})})})).then(function(a){return e.rows=a,e})}function h(){var a=this;l.call(this);var b,c=0,d=["change","delete","create","update"];this.on("newListener",function(e){if(~d.indexOf(e)){if(c)return c++,void 0;c++;var f=0;b=this.changes({conflicts:!0,include_docs:!0,continuous:!0,since:"now",onChange:function(b){b.seq<=f||(f=b.seq,a.emit("change",b),b.doc._deleted?a.emit("delete",b):"1"===b.doc._rev.split("-")[0]?a.emit("create",b):a.emit("update",b))}})}}),this.on("removeListener",function(a){~d.indexOf(a)&&(c--,c||b.cancel())})}var i=a(34),j=a(29),k=a(19),l=a(38).EventEmitter,m=a(25),n=a(13),o=i.Promise;i.inherits(h,l),b.exports=h,h.prototype.post=i.adapterFun("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a)?c(k.error(k.NOT_AN_OBJECT)):(this.bulkDocs({docs:[a]},b,e(c)),void 0)}),h.prototype.put=i.adapterFun("put",i.getArguments(function(a){var b,c,d,f,g=a.shift(),h="_id"in g;if("object"!=typeof g||Array.isArray(g))return f=a.pop(),f(k.error(k.NOT_AN_OBJECT));for(g=i.clone(g);;)if(b=a.shift(),c=typeof b,"string"!==c||h?"string"!==c||!h||"_rev"in g?"object"===c?d=b:"function"===c&&(f=b):g._rev=b:(g._id=b,h=!0),!a.length)break;d=d||{};var j=i.invalidIdError(g._id);return j?f(j):i.isLocalId(g._id)&&"function"==typeof this._putLocal?g._deleted?this._removeLocal(g,f):this._putLocal(g,f):(this.bulkDocs({docs:[g]},d,e(f)),void 0)})),h.prototype.putAttachment=i.adapterFun("putAttachment",function(a,b,c,d,e,f){function g(a){return a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d},h.put(a)}var h=this;return"function"==typeof e&&(f=e,e=d,d=c,c=null),"undefined"==typeof e&&(e=d,d=c,c=null),h.get(a).then(function(a){if(a._rev!==c)throw k.error(k.REV_CONFLICT);return g(a)},function(b){if(b.reason===k.MISSING_DOC.message)return g({_id:a});throw b})}),h.prototype.removeAttachment=i.adapterFun("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){return a?(d(a),void 0):f._rev!==c?(d(k.error(k.REV_CONFLICT)),void 0):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,e.put(f,d),void 0):d()})}),h.prototype.remove=i.adapterFun("remove",function(a,b,c,d){var f;"string"==typeof b?(f={_id:a,_rev:b},"function"==typeof c&&(d=c,c={})):(f=a,"function"==typeof b?(d=b,c={}):(d=c,c=b)),c=i.clone(c||{}),c.was_delete=!0;var g={_id:f._id,_rev:f._rev||c.rev};return g._deleted=!0,i.isLocalId(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(f,d):(this.bulkDocs({docs:[g]},c,e(d)),void 0)}),h.prototype.revsDiff=i.adapterFun("revsDiff",function(a,b,c){function d(a,b){h.has(a)||h.set(a,{missing:[]}),h.get(a).missing.push(b)}function e(b,c){var e=a[b].slice(0);j.traverseRevTree(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);j!==-1&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={}),b=i.clone(b);var f=Object.keys(a);if(!f.length)return c(null,{});var g=0,h=new i.Map;f.map(function(b){this._getRevisionTree(b,function(d,i){if(d&&404===d.status&&"missing"===d.message)h.set(b,{missing:a[b]});else{if(d)return c(d);e(b,i)}if(++g===f.length){var j={};return h.forEach(function(a,b){j[b]=a}),c(null,j)}})},this)}),h.prototype.compactDocument=i.adapterFun("compactDocument",function(a,b,c){var d=this;this._getRevisionTree(a,function(e,g){if(e)return c(e);var h=f(g),i=[],k=[];Object.keys(h).forEach(function(a){h[a]>b&&i.push(a)}),j.traverseRevTree(g,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&i.indexOf(f)!==-1&&k.push(f)}),d._doCompaction(a,k,c)})}),h.prototype.compact=i.adapterFun("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;a=i.clone(a||{}),c.get("_local/compaction").catch(function(){return!1}).then(function(d){if("function"==typeof c._compact)return d&&d.last_seq&&(a.last_seq=d.last_seq),c._compact(a,b)})}),h.prototype._compact=function(a,b){function c(a){g.push(e.compactDocument(a.id,0))}function d(a){var c=a.last_seq;o.all(g).then(function(){return m(e,"_local/compaction",function(a){return(!a.last_seq||a.last_seq<c)&&(a.last_seq=c,a)})}).then(function(){b(null,{ok:!0})}).catch(b)}var e=this,f={returnDocs:!1,last_seq:a.last_seq||0},g=[];e.changes(f).on("change",c).on("complete",d).on("error",b)},h.prototype.get=i.adapterFun("get",function(a,b,c){function e(){var d=[],e=f.length;return e?(f.forEach(function(f){g.get(a,{rev:f,revs:b.revs,attachments:b.attachments},function(a,b){a?d.push({missing:f}):d.push({ok:b}),e--,e||c(null,d)})}),void 0):c(null,d)}if("function"==typeof b&&(c=b,b={}),"string"!=typeof a)return c(k.error(k.INVALID_ID));if(i.isLocalId(a)&&"function"==typeof this._getLocal)return this._getLocal(a,c);var f=[],g=this;if(!b.open_revs)return this._get(a,b,function(a,e){if(b=i.clone(b),a)return c(a);var f=e.doc,h=e.metadata,k=e.ctx;if(b.conflicts){var l=j.collectConflicts(h);l.length&&(f._conflicts=l)}if(i.isDeleted(h,f._rev)&&(f._deleted=!0),b.revs||b.revs_info){var m=j.rootToLeaf(h.rev_tree),n=d(m,function(a){return a.ids.map(function(a){return a.id}).indexOf(f._rev.split("-")[1])!==-1}),o=n.ids.map(function(a){return a.id}).indexOf(f._rev.split("-")[1])+1,p=n.ids.length-o;if(n.ids.splice(o,p),n.ids.reverse(),b.revs&&(f._revisions={start:n.pos+n.ids.length-1,ids:n.ids.map(function(a){return a.id})}),b.revs_info){var q=n.pos+n.ids.length;f._revs_info=n.ids.map(function(a){return q--,{rev:q+"-"+a.id,status:a.opts.status}})}}if(b.local_seq&&(i.info('The "local_seq" option is deprecated and will be removed'),f._local_seq=e.metadata.seq),b.attachments&&f._attachments){var r=f._attachments,s=Object.keys(r).length;if(0===s)return c(null,f);Object.keys(r).forEach(function(a){this._getAttachment(r[a],{encode:!0,ctx:k},function(b,d){var e=f._attachments[a];e.data=d,delete e.stub,delete e.length,--s||c(null,f)})},g)}else{if(f._attachments)for(var t in f._attachments)f._attachments.hasOwnProperty(t)&&(f._attachments[t].stub=!0);c(null,f)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){return a?c(a):(f=j.collectLeaves(b).map(function(a){return a.rev}),e(),void 0)});else{if(!Array.isArray(b.open_revs))return c(k.error(k.UNKNOWN_ERROR,"function_clause"));f=b.open_revs;for(var h=0;h<f.length;h++){var l=f[h];if("string"!=typeof l||!/^\d+-/.test(l))return c(k.error(k.INVALID_REV))}e()}}),h.prototype.getAttachment=i.adapterFun("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),c=i.clone(c),this._get(a,c,function(a,f){return a?d(a):f.doc._attachments&&f.doc._attachments[b]?(c.ctx=f.ctx,e._getAttachment(f.doc._attachments[b],c,d),void 0):d(k.error(k.MISSING_DOC))})}),h.prototype.allDocs=i.adapterFun("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a=i.clone(a),a.skip="undefined"!=typeof a.skip?a.skip:0,"keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return b(k.error(k.QUERY_PARSE_ERROR,"Query parameter `"+c+"` is not compatible with multi-get")),void 0;if("http"!==this.type())return g(this,a,b)}return this._allDocs(a,b)}),h.prototype.changes=function(a,b){return"function"==typeof a&&(b=a,a={}),new n(this,a,b)},h.prototype.close=i.adapterFun("close",function(a){return this._closed=!0,this._close(a)}),h.prototype.info=i.adapterFun("info",function(a){var b=this;this._info(function(c,d){return c?a(c):(d.db_name=d.db_name||b._db_name,d.auto_compaction=!(!b.auto_compaction||"http"===b.type()),a(null,d),void 0)})}),h.prototype.id=i.adapterFun("id",function(a){return this._id(a)}),h.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},h.prototype.bulkDocs=i.adapterFun("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=i.clone(b),Array.isArray(a)&&(a={docs:a}),!a||!a.docs||!Array.isArray(a.docs))return c(k.error(k.MISSING_BULK_DOCS));for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(k.error(k.NOT_AN_OBJECT));return a=i.clone(a),"new_edits"in b||("new_edits"in a?b.new_edits=a.new_edits:b.new_edits=!0),b.new_edits||"http"===this.type()||a.docs.sort(function(a,b){var c=i.compare(a._id,b._id);if(0!==c)return c;var d=a._revisions?a._revisions.start:0,e=b._revisions?b._revisions.start:0;return i.compare(d,e)}),a.docs.forEach(function(a){a._deleted&&delete a._attachments}),this._bulkDocs(a,b,function(a,d){return a?c(a):(b.new_edits||(d=d.filter(function(a){return a.error})),c(null,d),void 0)})}),h.prototype.registerDependentDatabase=i.adapterFun("registerDependentDatabase",function(a,b){function c(b){return b.dependentDbs=b.dependentDbs||{},!b.dependentDbs[a]&&(b.dependentDbs[a]=!0,b)}var d=new this.constructor(a,this.__opts||{});m(this,"_local/_pouch_dependentDbs",c,function(a){return a?b(a):b(null,{db:d})})})},{}],2:[function(a,b,c){(function(c){"use strict";function d(a){return/^_(design|local)/.test(a)?a:encodeURIComponent(a)}function e(a){return a._attachments&&Object.keys(a._attachments)?l.Promise.all(Object.keys(a._attachments).map(function(b){var c=a._attachments[b];if(c.data&&"string"!=typeof c.data){if(o)return new l.Promise(function(a){l.readAsBinaryString(c.data,function(b){c.data=l.btoa(b),a()})});c.data=c.data.toString("base64")}})):l.Promise.resolve()}function f(a,b){if(/http(s?):/.test(a)){var c=l.parseUri(a);c.remote=!0,(c.user||c.password)&&(c.auth={username:c.user,password:c.password});var d=c.path.replace(/(^\/|\/$)/g,"").split("/");if(c.db=d.pop(),c.path=d.join("/"),b=b||{},b=l.clone(b),c.headers=b.headers||b.ajax&&b.ajax.headers||{},b.auth||c.auth){var e=b.auth||c.auth,f=l.btoa(e.username+":"+e.password);c.headers.Authorization="Basic "+f}return b.headers&&(c.headers=b.headers),c}return{host:"",path:"/",db:a,auth:!1}}function g(a,b){return h(a,a.db+"/"+b)}function h(a,b){if(a.remote){var c=a.path?"/":"";return a.protocol+"://"+a.host+":"+a.port+"/"+a.path+c+b}return"/"+b}function i(a,b){function c(a,b){var c=l.extend({},t,a);return n(c.method+" "+c.url),l.ajax(c,b)}function i(a){return a.split("/").map(encodeURIComponent).join("/")}var q=this;q.getHost=a.getHost?a.getHost:f;var r=q.getHost(a.name,a),s=g(r,"");q.getUrl=function(){return s},q.getHeaders=function(){return l.clone(r.headers)};var t=a.ajax||{};a=l.clone(a);var u=function(){c({headers:r.headers,method:"PUT",url:s},function(a){a&&401===a.status?c({headers:r.headers,method:"HEAD",url:s},function(a){a?b(a):b(null,q)}):a&&412!==a.status?b(a):b(null,q)})};a.skipSetup||c({headers:r.headers,method:"GET",url:s},function(a){a?404===a.status?(l.explain404("PouchDB is just detecting if the remote DB exists."),u()):b(a):b(null,q)}),q.type=function(){return"http"},q.id=l.adapterFun("id",function(a){c({headers:r.headers,method:"GET",url:h(r,"")},function(b,c){var d=c&&c.uuid?c.uuid+r.db:g(r,"");a(null,d)})}),q.request=l.adapterFun("request",function(a,b){a.headers=r.headers,a.url=g(r,a.url),c(a,b)}),q.compact=l.adapterFun("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=l.clone(a),c({headers:r.headers,url:g(r,"_compact"),method:"POST"},function(){function c(){q.info(function(d,e){e.compact_running?setTimeout(c,a.interval||200):b(null,{ok:!0})})}"function"==typeof b&&c()})}),q._info=function(a){c({headers:r.headers,method:"GET",url:g(r,"")},function(b,c){b?a(b):(c.host=g(r,""),a(null,c))})},q.get=l.adapterFun("get",function(a,b,e){"function"==typeof b&&(e=b,b={}),b=l.clone(b),void 0===b.auto_encode&&(b.auto_encode=!0);var f=[];b.revs&&f.push("revs=true"),b.revs_info&&f.push("revs_info=true"),b.local_seq&&f.push("local_seq=true"),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),f.push("open_revs="+b.open_revs)),b.attachments&&f.push("attachments=true"),b.rev&&f.push("rev="+b.rev),b.conflicts&&f.push("conflicts="+b.conflicts),f=f.join("&"),f=""===f?"":"?"+f,b.auto_encode&&(a=d(a));var h={headers:r.headers,method:"GET",url:g(r,a+f)},i=a.split("/");(i.length>1&&"_design"!==i[0]&&"_local"!==i[0]||i.length>2&&"_design"===i[0]&&"_local"!==i[0])&&(h.binary=!0),c(h,function(a,b,c){return a?e(a):(e(null,b,c),void 0)})}),q.remove=l.adapterFun("remove",function(a,b,e,f){var h;"string"==typeof b?(h={_id:a,_rev:b},"function"==typeof e&&(f=e,e={})):(h=a,"function"==typeof b?(f=b,e={}):(f=e,e=b));var i=h._rev||e.rev;c({headers:r.headers,method:"DELETE",url:g(r,d(h._id))+"?rev="+i},f)}),q.getAttachment=l.adapterFun("getAttachment",function(a,b,c,e){"function"==typeof c&&(e=c,c={}),c=l.clone(c),void 0===c.auto_encode&&(c.auto_encode=!0),c.auto_encode&&(a=d(a)),c.auto_encode=!1,q.get(a+"/"+i(b),c,e)}),q.removeAttachment=l.adapterFun("removeAttachment",function(a,b,e,f){var h=g(r,d(a)+"/"+i(b))+"?rev="+e;c({headers:r.headers,method:"DELETE",url:h},f)}),q.putAttachment=l.adapterFun("putAttachment",function(a,b,e,f,h,j){"function"==typeof h&&(j=h,h=f,f=e,e=null),"undefined"==typeof h&&(h=f,f=e,e=null);var k=d(a)+"/"+i(b),n=g(r,k);if(e&&(n+="?rev="+e),"string"==typeof f){var q;try{q=l.atob(f)}catch(a){return j(m.error(m.BAD_ARG,"Attachments need to be base64 encoded"))}f=o?l.createBlob([l.fixBinary(q)],{type:h}):q?new p(q,"binary"):""}var s={headers:l.clone(r.headers),method:"PUT",url:n,processData:!1,body:f,timeout:3e5};s.headers["Content-Type"]=h,c(s,j)}),q.put=l.adapterFun("put",l.getArguments(function(a){var b,f,h,i=a.shift(),j="_id"in i,k=a.pop();return"object"!=typeof i||Array.isArray(i)?k(m.error(m.NOT_AN_OBJECT)):(i=l.clone(i),e(i).then(function(){for(;;)if(b=a.shift(),f=typeof b,"string"!==f||j?"string"!==f||!j||"_rev"in i?"object"===f&&(h=l.clone(b)):i._rev=b:(i._id=b,j=!0),!a.length)break;h=h||{};var e=l.invalidIdError(i._id);if(e)throw e;var m=[];h&&"undefined"!=typeof h.new_edits&&m.push("new_edits="+h.new_edits),m=m.join("&"),""!==m&&(m="?"+m),c({headers:r.headers,method:"PUT",url:g(r,d(i._id))+m,body:i},function(a,b){return a?k(a):(b.ok=!0,k(null,b),void 0)})}).catch(k),void 0)})),q.post=l.adapterFun("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),b=l.clone(b),"object"!=typeof a?c(m.error(m.NOT_AN_OBJECT)):("_id"in a||(a._id=l.uuid()),q.put(a,b,function(a,b){return a?c(a):(b.ok=!0,c(null,b),void 0)}),void 0)}),q._bulkDocs=function(a,b,d){"undefined"!=typeof b.new_edits&&(a.new_edits=b.new_edits),l.Promise.all(a.docs.map(e)).then(function(){c({headers:r.headers,method:"POST",url:g(r,"_bulk_docs"),body:a},function(a,b){return a?d(a):(b.forEach(function(a){a.ok=!0}),d(null,b),void 0)})}).catch(d)},q.allDocs=l.adapterFun("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=l.clone(a);var d,e=[],f="GET";if(a.conflicts&&e.push("conflicts=true"),a.descending&&e.push("descending=true"),a.include_docs&&e.push("include_docs=true"),a.attachments&&e.push("attachments=true"),a.key&&e.push("key="+encodeURIComponent(JSON.stringify(a.key))),a.startkey&&e.push("startkey="+encodeURIComponent(JSON.stringify(a.startkey))),a.endkey&&e.push("endkey="+encodeURIComponent(JSON.stringify(a.endkey))),"undefined"!=typeof a.inclusive_end&&e.push("inclusive_end="+!!a.inclusive_end),"undefined"!=typeof a.limit&&e.push("limit="+a.limit),"undefined"!=typeof a.skip&&e.push("skip="+a.skip),e=e.join("&"),""!==e&&(e="?"+e),"undefined"!=typeof a.keys){var h="keys="+encodeURIComponent(JSON.stringify(a.keys));h.length+e.length+1<=k?e+=(e.indexOf("?")!==-1?"&":"?")+h:(f="POST",d=JSON.stringify({keys:a.keys}))}c({headers:r.headers,method:f,url:g(r,"_all_docs"+e),body:d},b)}),q._changes=function(a){var b="batch_size"in a?a.batch_size:j;a=l.clone(a),a.timeout=a.timeout||12e4;var d={timeout:a.timeout-5e3},e="undefined"!=typeof a.limit&&a.limit;0===e&&(e=1);var f;f=!("returnDocs"in a)||a.returnDocs;var h=e;if(a.style&&(d.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(d.include_docs=!0),a.attachments&&(d.attachments=!0),a.continuous&&(d.feed="longpoll"),a.conflicts&&(d.conflicts=!0),a.descending&&(d.descending=!0),a.filter&&"string"==typeof a.filter&&(d.filter=a.filter,"_view"===a.filter&&a.view&&"string"==typeof a.view&&(d.view=a.view)),a.query_params&&"object"==typeof a.query_params)for(var i in a.query_params)a.query_params.hasOwnProperty(i)&&(d[i]=a.query_params[i]);var n,o="GET";if(a.doc_ids){d.filter="_doc_ids";var p=JSON.stringify(a.doc_ids);p.length<k?d.doc_ids=p:(o="POST",n={doc_ids:a.doc_ids})}if(a.continuous&&q._useSSE)return q.sse(a,d,f);var s,t,u=function(f,i){if(!a.aborted){d.since=f,"object"==typeof d.since&&(d.since=JSON.stringify(d.since)),a.descending?e&&(d.limit=h):d.limit=!e||h>b?b:h;var j="?"+Object.keys(d).map(function(a){return a+"="+d[a]}).join("&"),k={headers:r.headers,method:o,url:g(r,"_changes"+j),timeout:a.timeout,body:n};t=f,a.aborted||(s=c(k,i))}},v=10,w=0,x={results:[]},y=function(c,d){if(!a.aborted){var g=0;if(d&&d.results){g=d.results.length,x.last_seq=d.last_seq;var i={};i.query=a.query_params,d.results=d.results.filter(function(b){h--;var c=l.filterChange(a)(b);return c&&(f&&x.results.push(b),l.call(a.onChange,b)),c})}else if(c)return a.aborted=!0,l.call(a.complete,c),void 0;d&&d.last_seq&&(t=d.last_seq);var j=e&&h<=0||d&&g<b||a.descending;if((!a.continuous||e&&h<=0)&&j)l.call(a.complete,null,x);else{c?w+=1:w=0;var k=1<<w,n=v*k,o=a.maximumWait||3e4;if(n>o)return l.call(a.complete,c||m.error(m.UNKNOWN_ERROR)),void 0;setTimeout(function(){u(t,y)},n)}}};return u(a.since||0,y),{cancel:function(){a.aborted=!0,s&&s.abort()}}},q.sse=function(a,b,c){function d(b){var d=JSON.parse(b.data);c&&j.results.push(d),j.last_seq=d.seq,l.call(a.onChange,d)}function e(b){return i.removeEventListener("message",d,!1),m===!1?(q._useSSE=!1,k=q._changes(a),void 0):(i.close(),l.call(a.complete,b),void 0)}b.feed="eventsource",b.since=a.since||0,b.limit=a.limit,delete b.timeout;var f="?"+Object.keys(b).map(function(a){return a+"="+b[a]}).join("&"),h=g(r,"_changes"+f),i=new EventSource(h),j={results:[],last_seq:!1},k=!1,m=!1;return i.addEventListener("message",d,!1),i.onopen=function(){m=!0},i.onerror=e,{cancel:function(){return k?k.cancel():(i.removeEventListener("message",d,!1),i.close(),void 0)}}},q._useSSE=!1,q.revsDiff=l.adapterFun("revsDiff",function(a,b,d){"function"==typeof b&&(d=b,b={}),c({headers:r.headers,method:"POST",url:g(r,"_revs_diff"),body:JSON.stringify(a)},d)}),q._close=function(a){a()},q.destroy=l.adapterFun("destroy",function(a){c({url:g(r,""),method:"DELETE",headers:r.headers},function(b,c){b?(q.emit("error",b),a(b)):(q.emit("destroyed"),a(null,c))})})}var j=25,k=1800,l=a(34),m=a(19),n=a(40)("pouchdb:http"),o="undefined"==typeof c||c.browser,p=a(18);i.destroy=l.toPromise(function(a,b,c){var d=f(a,b);b=b||{},"function"==typeof b&&(c=b,b={}),b=l.clone(b),b.headers=d.headers,b.method="DELETE",b.url=g(d,"");var e=b.ajax||{};b=l.extend({},b,e),l.ajax(b,c)}),i.valid=function(){return!0},b.exports=i}).call(this,a(39))},{}],3:[function(a,b,c){"use strict";function d(a,b){return new e.Promise(function(c,d){var f=e.createBlob([""],{type:"image/png"});a.objectStore(g).put(f,"key"),a.oncomplete=function(){var a=b.transaction([g],"readwrite"),f=a.objectStore(g).get("key");f.onerror=d,f.onsuccess=function(a){var b=a.target.result,d=URL.createObjectURL(b);e.ajax({url:d,cache:!0,binary:!0},function(a,b){a&&405===a.status?c(!0):(c(!1),a&&404===a.status&&e.explain404("PouchDB is just detecting blob URL support.")),URL.revokeObjectURL(d)})}}}).catch(function(){return!1})}var e=a(34),f=a(5),g=f.DETECT_BLOB_SUPPORT_STORE;b.exports=d},{}],4:[function(a,b,c){"use strict";function d(a,b,c,d,g,h){function t(){var a=[l,k,j,n,m,i],b=s(d,a,"readwrite");return b.error?h(b.error):(F=b.txn,F.onerror=r(h),F.ontimeout=r(h),F.oncomplete=w,G=F.objectStore(l),H=F.objectStore(k),I=F.objectStore(j),J=F.objectStore(i),y(function(a){return a?(R=!0,h(a)):(v(),void 0)}),void 0)}function u(){e.processDocs(L,c,Q,F,P,z,b)}function v(){function a(){++c===L.length&&u()}function b(b){var c=p(b.target.result);c&&Q.set(c.id,c),a()}if(L.length)for(var c=0,d=0,f=L.length;d<f;d++){var g=L[d];if(g._id&&e.isLocalId(g._id))a();else{var h=G.get(g.metadata.id);h.onsuccess=b}}}function w(){R||(g.notify(c._name),c._docCount=-1,h(null,P))}function x(a,b){var c=I.get(a);c.onsuccess=function(c){if(c.target.result)b();else{var d=f.error(f.MISSING_STUB,"unknown stub attachment with digest "+a);d.status=412,b(d)}}}function y(a){function b(){++e===c.length&&a(d)}var c=[];if(L.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){x(a,function(a){a&&!d&&(d=a),b()})})}function z(a,b,c,d,e,f,g){var h=a.data;h._id=a.metadata.id,h._rev=a.metadata.rev,c&&(h._deleted=!0);var i=h._attachments&&Object.keys(h._attachments).length;return i?C(a,b,c,d,e,g):(B(a,b,c,d,e,g),void 0)}function A(a){var b=e.compactTree(a.metadata);o(b,a.metadata.id,F)}function B(a,b,d,e,f,g){function h(e){f&&c.auto_compaction&&A(a),l.seq=e.target.result,delete l.rev;var g=q(l,b,d),h=G.put(g);h.onsuccess=j}function i(a){a.preventDefault(),a.stopPropagation();var b=H.index("_doc_id_rev"),c=b.getKey(k._doc_id_rev);c.onsuccess=function(a){var b=H.put(k,a.target.result);b.onsuccess=h}}function j(){P[g]={ok:!0,id:l.id,rev:b},Q.set(a.metadata.id,a.metadata),D(a,l.seq,e)}var k=a.data,l=a.metadata;k._doc_id_rev=l.id+"::"+l.rev,delete k._id,delete k._rev;var m=H.put(k);m.onsuccess=h,m.onerror=i}function C(a,b,c,d,e,f){function g(){j===k.length&&B(a,b,c,d,e,f)}function h(){j++,g()}var i=a.data,j=0,k=Object.keys(i._attachments);k.forEach(function(b){var c=a.data._attachments[b];if(c.stub)j++,g();else{var d=c.data;delete c.data;var e=c.digest;E(e,d,h)}})}function D(a,b,c){function d(){++f===g.length&&c()}function e(c){var e=a.data._attachments[c].digest,f=J.put({seq:b,digestSeq:e+"::"+b});f.onsuccess=d,f.onerror=function(a){a.preventDefault(),a.stopPropagation(),d()}}var f=0,g=Object.keys(a.data._attachments||{});if(!g.length)return c();for(var h=0;h<g.length;h++)e(g[h])}function E(a,b,c){var d=I.count(a);d.onsuccess=function(d){var e=d.target.result;if(e)return c();var f={digest:a,body:b},g=I.put(f);g.onsuccess=c}}for(var F,G,H,I,J,K,L=a.docs,M=0,N=L.length;M<N;M++){var O=L[M];O._id&&e.isLocalId(O._id)||(O=L[M]=e.parseDoc(O,b.new_edits),O.error&&!K&&(K=O))}if(K)return h(K);var P=new Array(L.length),Q=new e.Map,R=!1,S=c._blobSupport?"blob":"base64";e.preprocessAttachments(L,S,function(a){return a?h(a):(t(),void 0)})}var e=a(34),f=a(19),g=a(6),h=a(5),i=h.ATTACH_AND_SEQ_STORE,j=h.ATTACH_STORE,k=h.BY_SEQ_STORE,l=h.DOC_STORE,m=h.LOCAL_STORE,n=h.META_STORE,o=g.compactRevs,p=g.decodeMetadata,q=g.encodeMetadata,r=g.idbError,s=g.openTransactionSafely;b.exports=d},{}],5:[function(a,b,c){"use strict";c.ADAPTER_VERSION=5,c.DOC_STORE="document-store",c.BY_SEQ_STORE="by-sequence",c.ATTACH_STORE="attach-store",c.ATTACH_AND_SEQ_STORE="attach-seq-store",c.META_STORE="meta-store",c.LOCAL_STORE="local-store",c.DETECT_BLOB_SUPPORT_STORE="detect-blob-support"},{}],6:[function(a,b,c){(function(b){"use strict";function d(a,b,c){try{a.apply(b,c)}catch(a){"undefined"!=typeof PouchDB&&PouchDB.emit("error",a)}}var e=a(19),f=a(34),g=a(5);c.taskQueue={running:!1,queue:[]},c.applyNext=function(){if(!c.taskQueue.running&&c.taskQueue.queue.length){c.taskQueue.running=!0;var a=c.taskQueue.queue.shift();a.action(function(e,f){d(a.callback,this,[e,f]),c.taskQueue.running=!1,b.nextTick(c.applyNext)})}},c.idbError=function(a){return function(b){var c=b.target&&b.target.error&&b.target.error.name||b.target;a(e.error(e.IDB_ERROR,c,b.type))}},c.encodeMetadata=function(a,b,c){return{data:f.safeJsonStringify(a),winningRev:b,deletedOrLocal:c?"1":"0",seq:a.seq,id:a.id}},c.decodeMetadata=function(a){if(!a)return null;var b=f.safeJsonParse(a.data);return b.winningRev=a.winningRev,b.deletedOrLocal="1"===a.deletedOrLocal,b.seq=a.seq,b},c.decodeDoc=function(a){if(!a)return a;var b=f.lastIndexOf(a._doc_id_rev,":");return a._id=a._doc_id_rev.substring(0,b-1),a._rev=a._doc_id_rev.substring(b+1),delete a._doc_id_rev,a},c.readBlobData=function(a,b,c,d){c?a?"string"!=typeof a?f.readAsBinaryString(a,function(a){d(f.btoa(a))}):d(a):d(""):a?"string"!=typeof a?d(a):(a=f.fixBinary(atob(a)),d(f.createBlob([a],{type:b}))):d(f.createBlob([""],{type:b}))},c.fetchAttachmentsIfNecessary=function(a,b,c,d){function e(){++i===h.length&&d&&d()}function f(a,b){var d=a._attachments[b],f=d.digest,h=c.objectStore(g.ATTACH_STORE).get(f);h.onsuccess=function(a){d.body=a.target.result.body,e()}}var h=Object.keys(a._attachments||{});if(!h.length)return d&&d();var i=0;h.forEach(function(c){b.attachments&&b.include_docs?f(a,c):(a._attachments[c].stub=!0,e())})},c.postProcessAttachments=function(a){return f.Promise.all(a.map(function(a){if(a.doc&&a.doc._attachments){var b=Object.keys(a.doc._attachments);return f.Promise.all(b.map(function(b){var d=a.doc._attachments[b];if("body"in d){var e=d.body,g=d.content_type;return new f.Promise(function(h){c.readBlobData(e,g,!0,function(c){a.doc._attachments[b]=f.extend(f.pick(d,["digest","content_type"]),{data:c}),h()})})}}))}}))},c.compactRevs=function(a,b,c){function d(){k--,k||e()}function e(){f.length&&f.forEach(function(a){var b=j.index("digestSeq").count(IDBKeyRange.bound(a+"::",a+"::￿",!1,!1));b.onsuccess=function(b){var c=b.target.result;c||i.delete(a)}})}var f=[],h=c.objectStore(g.BY_SEQ_STORE),i=c.objectStore(g.ATTACH_STORE),j=c.objectStore(g.ATTACH_AND_SEQ_STORE),k=a.length;a.forEach(function(a){var c=h.index("_doc_id_rev"),e=b+"::"+a;c.getKey(e).onsuccess=function(a){var b=a.target.result;if("number"!=typeof b)return d();h.delete(b);var c=j.index("seq").openCursor(IDBKeyRange.only(b));c.onsuccess=function(a){var b=a.target.result;if(b){var c=b.value.digestSeq.split("::")[0];f.push(c),j.delete(b.primaryKey),b.continue()}else d()}}})},c.openTransactionSafely=function(a,b,c){try{return{txn:a.transaction(b,c)}}catch(a){return{error:a}}}}).call(this,a(39))},{}],7:[function(a,b,c){(function(c){"use strict";function d(a,b){var c=this;F.queue.push({action:function(b){e(c,a,b)},callback:b}),w()}function e(a,b,e){function f(a){var b=a.createObjectStore(t,{keyPath:"id"});a.createObjectStore(r,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(q,{keyPath:"digest"}),a.createObjectStore(v,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(s),b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),a.createObjectStore(u,{keyPath:"_id"});var c=a.createObjectStore(p,{autoIncrement:!0});c.createIndex("seq","seq"),c.createIndex("digestSeq","digestSeq",{unique:!0})}function k(a,b){var c=a.objectStore(t);c.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),c.openCursor().onsuccess=function(a){var d=a.target.result;if(d){var e=d.value,f=h.isDeleted(e);e.deletedOrLocal=f?"1":"0",c.put(e),d.continue()}else b()}}function l(a){a.createObjectStore(u,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function w(a,b){var c=a.objectStore(u),d=a.objectStore(t),e=a.objectStore(r),f=d.openCursor();f.onsuccess=function(a){var f=a.target.result;if(f){var g=f.value,j=g.id,k=h.isLocalId(j),l=i.winningRev(g);if(k){var m=j+"::"+l,n=j+"::",o=j+"::~",p=e.index("_doc_id_rev"),q=IDBKeyRange.bound(n,o,!1,!1),r=p.openCursor(q);r.onsuccess=function(a){if(r=a.target.result,r){var b=r.value;b._doc_id_rev===m&&c.put(b),e.delete(r.primaryKey),r.continue()}else d.delete(f.primaryKey),f.continue()}}else f.continue()}else b&&b()}}function F(a){var b=a.createObjectStore(p,{autoIncrement:!0});b.createIndex("seq","seq"),b.createIndex("digestSeq","digestSeq",{unique:!0})}function I(a,b){var c=a.objectStore(r),d=a.objectStore(q),e=a.objectStore(p),f=d.count();f.onsuccess=function(a){var d=a.target.result;return d?(c.openCursor().onsuccess=function(a){var c=a.target.result;if(!c)return b();for(var d=c.value,f=c.primaryKey,g=Object.keys(d._attachments||{}),h={},i=0;i<g.length;i++){var j=d._attachments[g[i]];h[j.digest]=!0}var k=Object.keys(h);for(i=0;i<k.length;i++){var l=k[i];e.put({seq:f,digestSeq:l+"::"+f})}c.continue()},void 0):b()}}function J(a){function b(a){return a.data?z(a):(a.deletedOrLocal="1"===a.deletedOrLocal,a)}var c=a.objectStore(r),d=a.objectStore(t),e=d.openCursor();e.onsuccess=function(a){function e(){var a=h.id+"::",b=h.id+"::￿",d=c.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,b)),e=0;d.onsuccess=function(a){var b=a.target.result;if(!b)return h.seq=e,f();var c=b.primaryKey;c>e&&(e=c),b.continue()}}function f(){var a=A(h,h.winningRev,h.deletedOrLocal),b=d.put(a);b.onsuccess=function(){g.continue()}}var g=a.target.result;if(g){var h=b(g.value);return h.winningRev=h.winningRev||i.winningRev(h),h.seq?f():(e(),void 0)}}}function K(a,b,c,d,e){try{if(a&&b)return e?IDBKeyRange.bound(b,a,!c,!1):IDBKeyRange.bound(a,b,!1,!c);if(a)return e?IDBKeyRange.upperBound(a):IDBKeyRange.lowerBound(a);if(b)return e?IDBKeyRange.lowerBound(b,!c):IDBKeyRange.upperBound(b,!c);if(d)return IDBKeyRange.only(d)}catch(a){return{error:a}}return null}function L(a,b,c){function d(){c(null,{total_rows:a,offset:b.skip,rows:A})}var e="startkey"in b&&b.startkey,f="endkey"in b&&b.endkey,g="key"in b&&b.key,k=b.skip||0,l="number"==typeof b.limit?b.limit:-1,m=b.inclusive_end!==!1,n="descending"in b&&b.descending?"prev":null,o=K(e,f,m,g,n);if(o&&o.error){var p=o.error;return"DataError"===p.name&&0===p.code?c(null,{total_rows:a,offset:b.skip,rows:[]}):c(j.error(j.IDB_ERROR,p.name,p.message))}var s=[t,r];b.attachments&&s.push(q);var u=G(Q,s,"readonly");if(u.error)return c(u.error);var v=u.txn;v.oncomplete=function(){b.attachments?D(A).then(d):d()};var w=v.objectStore(t),x=n?w.openCursor(o,n):w.openCursor(o),A=[];x.onsuccess=function(a){function c(a,c){var e={id:a.id,key:a.id,value:{rev:f}};b.include_docs&&(e.doc=c,b.conflicts&&(e.doc._conflicts=i.collectConflicts(a)),B(e.doc,b,v));var g=h.isDeleted(a,f);if("ok"===b.deleted)g&&(e.value.deleted=!0,e.doc=null),A.push(e);else if(!g&&k--<=0&&(A.push(e),0===--l))return;d.continue()}if(a.target.result){var d=a.target.result,e=z(d.value),f=e.winningRev;if(b.include_docs){var g=v.objectStore(r).index("_doc_id_rev"),j=e.id+"::"+f;g.get(j).onsuccess=function(a){c(z(d.value),y(a.target.result))}}else c(e)}}}function M(b){if(a._docCount!==-1)return b(null,a._docCount);var c,d=G(Q,[t],"readonly");if(d.error)return b(d.error);var e=d.txn,f=e.objectStore(t).index("deletedOrLocal");f.count(IDBKeyRange.only("0")).onsuccess=function(a){
c=a.target.result},e.onerror=C(b),e.oncomplete=function(){a._docCount=c,b(null,a._docCount)}}var N=b.name,O=null,P=!1,Q=null;a._docCount=-1,a._blobSupport=null,a._name=N,a.type=function(){return"idb"},a._id=h.toPromise(function(a){a(null,O)}),a._bulkDocs=function(b,c,e){m(b,c,a,Q,d.Changes,e)},a._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:i})}var e,f,g,i;if(b=h.clone(b),b.ctx)i=b.ctx;else{var k=G(Q,[t,r,q],"readonly");if(k.error)return c(k.error);i=k.txn}i.objectStore(t).get(a).onsuccess=function(a){if(f=z(a.target.result),!f)return g=j.error(j.MISSING_DOC,"missing"),d();if(h.isDeleted(f)&&!b.rev)return g=j.error(j.MISSING_DOC,"deleted"),d();var c=i.objectStore(r),k=b.rev||f.winningRev,l=f.id+"::"+k;c.index("_doc_id_rev").get(l).onsuccess=function(a){return e=a.target.result,e&&(e=y(e)),e?(d(),void 0):(g=j.error(j.MISSING_DOC,"missing"),d())}}},a._getAttachment=function(a,b,c){var d;if(b=h.clone(b),b.ctx)d=b.ctx;else{var e=G(Q,[t,r,q],"readonly");if(e.error)return c(e.error);d=e.txn}var f=a.digest,g=a.content_type;d.objectStore(q).get(f).onsuccess=function(a){var d=a.target.result.body;E(d,g,b.encode,function(a){c(null,a)})}},a._allDocs=function(a,b){M(function(c,d){return c?b(c):0===a.limit?b(null,{total_rows:d,offset:a.skip,rows:[]}):(L(d,a,b),void 0)})},a._info=function(b){M(function(c,d){if(c)return b(c);if(null===Q||!H[a._name]){var e=new Error("db isn't open");return e.id="idbNull",b(e)}var f=0,g=G(Q,[r],"readonly");if(g.error)return b(g.error);var h=g.txn;h.objectStore(r).openCursor(null,"prev").onsuccess=function(a){var b=a.target.result;f=b?b.key:0},h.oncomplete=function(){b(null,{doc_count:d,update_seq:f,idb_attachment_format:a._blobSupport?"binary":"base64"})}})},a._changes=function(b){function c(a){function c(){return h.seq!==g?a.continue():(l=g,h.winningRev===f._rev?e(f):(d(),void 0))}function d(){var a=f._id+"::"+h.winningRev,b=p.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,a+"￿"));b.onsuccess=function(a){e(y(a.target.result.value))}}function e(c){var d=b.processChange(c,h,b);d.seq=h.seq,w(d)&&(v++,n&&u.push(d),b.attachments&&b.include_docs?B(c,b,o,function(){D([d]).then(function(){b.onChange(d)})}):b.onChange(d)),v!==m&&a.continue()}var f=y(a.value),g=a.key;if(j&&!j.has(f._id))return a.continue();var h;return h=x.get(f._id),h?c():(s.get(f._id).onsuccess=function(a){h=z(a.target.result),x.set(f._id,h),c()},void 0)}function e(a){var b=a.target.result;b&&c(b)}function f(){var a=[t,r];b.attachments&&a.push(q);var c=G(Q,a,"readonly");if(c.error)return b.complete(c.error);o=c.txn,o.onerror=C(b.complete),o.oncomplete=g,p=o.objectStore(r),s=o.objectStore(t);var d;d=k?p.openCursor(null,k):p.openCursor(IDBKeyRange.lowerBound(b.since,!0)),d.onsuccess=e}function g(){function a(){b.complete(null,{results:u,last_seq:l})}!b.continuous&&b.attachments?D(u).then(a):a()}if(b=h.clone(b),b.continuous){var i=N+":"+h.uuid();return d.Changes.addListener(N,i,a,b),d.Changes.notify(N),{cancel:function(){d.Changes.removeListener(N,i)}}}var j=b.doc_ids&&new h.Set(b.doc_ids),k=b.descending?"prev":null;b.since=b.since||0;var l=b.since,m="limit"in b?b.limit:-1;0===m&&(m=1);var n;n=!("returnDocs"in b)||b.returnDocs;var o,p,s,u=[],v=0,w=h.filterChange(b),x=new h.Map;f()},a._close=function(a){return null===Q?a(j.error(j.NOT_OPEN)):(Q.close(),delete H[N],Q=null,a(),void 0)},a._getRevisionTree=function(a,b){var c=G(Q,[t],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(t).get(a);e.onsuccess=function(a){var c=z(a.target.result);c?b(null,c.rev_tree):b(j.error(j.MISSING_DOC))}},a._doCompaction=function(a,b,c){var d=[t,r,q,p],e=G(Q,d,"readwrite");if(e.error)return c(e.error);var f=e.txn,g=f.objectStore(t);g.get(a).onsuccess=function(c){var d=z(c.target.result);i.traverseRevTree(d.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;b.indexOf(g)!==-1&&(f.status="missing")}),x(b,a,f);var e=d.winningRev,g=d.deletedOrLocal;f.objectStore(t).put(A(d,e,g))},f.onerror=C(c),f.oncomplete=function(){h.call(c)}},a._getLocal=function(a,b){var c=G(Q,[u],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(u).get(a);e.onerror=C(b),e.onsuccess=function(a){var c=a.target.result;c?(delete c._doc_id_rev,b(null,c)):b(j.error(j.MISSING_DOC))}},a._putLocal=function(a,b,c){"function"==typeof b&&(c=b,b={}),delete a._revisions;var d=a._rev,e=a._id;d?a._rev="0-"+(parseInt(d.split("-")[1],10)+1):a._rev="0-1";var f,g=b.ctx;if(!g){var h=G(Q,[u],"readwrite");if(h.error)return c(h.error);g=h.txn,g.onerror=C(c),g.oncomplete=function(){f&&c(null,f)}}var i,k=g.objectStore(u);d?(i=k.get(e),i.onsuccess=function(e){var g=e.target.result;if(g&&g._rev===d){var h=k.put(a);h.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)}}else c(j.error(j.REV_CONFLICT))}):(i=k.add(a),i.onerror=function(a){c(j.error(j.REV_CONFLICT)),a.preventDefault(),a.stopPropagation()},i.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)})},a._removeLocal=function(a,b){var c=G(Q,[u],"readwrite");if(c.error)return b(c.error);var d,e=c.txn;e.oncomplete=function(){d&&b(null,d)};var f=a._id,g=e.objectStore(u),h=g.get(f);h.onerror=C(b),h.onsuccess=function(c){var e=c.target.result;e&&e._rev===a._rev?(g.delete(f),d={ok:!0,id:f,rev:"0-0"}):b(j.error(j.MISSING_DOC))}};var R=H[N];if(R)return Q=R.idb,O=R.instanceId,a._blobSupport=R.blobSupport,c.nextTick(function(){e(null,a)}),void 0;var S=indexedDB.open(N,o);"openReqList"in d||(d.openReqList={}),d.openReqList[N]=S,S.onupgradeneeded=function(a){function b(){var a=e[g-1];g++,a&&a(d,b)}var c=a.target.result;if(a.oldVersion<1)return f(c);var d=a.currentTarget.transaction;a.oldVersion<3&&l(c),a.oldVersion<4&&F(c);var e=[k,w,I,J],g=a.oldVersion;b()},S.onsuccess=function(b){Q=b.target.result,Q.onversionchange=function(){Q.close(),delete H[N]},Q.onabort=function(){Q.close(),delete H[N]};var c=Q.transaction([v,s],"readwrite"),d=c.objectStore(v).get(v);d.onsuccess=function(b){var d=function(){null!==a._blobSupport&&P&&(H[N]={idb:Q,instanceId:O,blobSupport:a._blobSupport,loaded:!0},e(null,a))},f=b.target.result||{id:v};N+"_id"in f?(O=f[N+"_id"],P=!0,d()):(O=h.uuid(),f[N+"_id"]=O,c.objectStore(v).put(f).onsuccess=function(){P=!0,d()}),g||(g=n(c,Q)),g.then(function(b){a._blobSupport=b,d()})}},S.onerror=C(e)}function f(a,b,c){"openReqList"in d||(d.openReqList={}),d.Changes.removeAllListeners(a),d.openReqList[a]&&d.openReqList[a].result&&(d.openReqList[a].result.close(),delete H[a]);var e=indexedDB.deleteDatabase(a);e.onsuccess=function(){d.openReqList[a]&&(d.openReqList[a]=null),h.hasLocalStorage()&&a in localStorage&&delete localStorage[a],c(null,{ok:!0})},e.onerror=C(c)}var g,h=a(34),i=a(29),j=a(19),k=a(6),l=a(5),m=a(4),n=a(3),o=l.ADAPTER_VERSION,p=l.ATTACH_AND_SEQ_STORE,q=l.ATTACH_STORE,r=l.BY_SEQ_STORE,s=l.DETECT_BLOB_SUPPORT_STORE,t=l.DOC_STORE,u=l.LOCAL_STORE,v=l.META_STORE,w=k.applyNext,x=k.compactRevs,y=k.decodeDoc,z=k.decodeMetadata,A=k.encodeMetadata,B=k.fetchAttachmentsIfNecessary,C=k.idbError,D=k.postProcessAttachments,E=k.readBlobData,F=k.taskQueue,G=k.openTransactionSafely,H={};d.valid=function(){var a="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);return!a&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},d.destroy=h.toPromise(function(a,b,c){F.queue.push({action:function(c){f(a,b,c)},callback:c}),w()}),d.Changes=new h.Changes,b.exports=d}).call(this,a(39))},{}],8:[function(a,b,c){b.exports=["idb","websql"]},{}],9:[function(a,b,c){"use strict";function d(a,b,c,d,h,q){function r(){return D?q(D):(h.notify(c._name),c._docCount=-1,q(null,E),void 0)}function s(a,b){var c="SELECT count(*) as cnt FROM "+k+" WHERE digest=?";C.executeSql(c,[a],function(c,d){if(0===d.rows.item(0).cnt){var e=f.error(f.MISSING_STUB,"unknown stub attachment with digest "+a);b(e)}else b()})}function t(a){function b(){++e===c.length&&a(d)}var c=[];if(A.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){s(a,function(a){a&&!d&&(d=a),b()})})}function u(a,b,d,f,g,h,k){function p(){function b(a,b){function d(){return++f===g.length&&b(),!1}function e(b){var e="INSERT INTO "+l+" (digest, seq) VALUES (?,?)",f=[c._attachments[b].digest,a];C.executeSql(e,f,d,d)}var f=0,g=Object.keys(c._attachments||{});if(!g.length)return b();for(var h=0;h<g.length;h++)e(g[h])}var c=a.data,e=d?1:0,f=c._id,g=c._rev,h=n(c),i="INSERT INTO "+j+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",k=[f,g,h,e];C.executeSql(i,k,function(a,c){var d=c.insertId;b(d,function(){t(a,d)})},function(){var a=m("seq",j,null,"doc_id=? AND rev=?");return C.executeSql(a,[f,g],function(a,c){var d=c.rows.item(0).seq,i="UPDATE "+j+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",k=[h,e,f,g];a.executeSql(i,k,function(a){b(d,function(){t(a,d)})})}),!1})}function q(a){u||(a?(u=a,f(u)):v===w.length&&p())}function r(a){v++,q(a)}function s(){if(g&&c.auto_compaction){var b=a.metadata.id,d=e.compactTree(a.metadata);o(d,b,C)}}function t(c,d){s(),a.metadata.seq=d,delete a.metadata.rev;var h=g?"UPDATE "+i+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+j+" WHERE doc_id="+i+".id AND rev=?) WHERE id=?":"INSERT INTO "+i+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",l=e.safeJsonStringify(a.metadata),m=a.metadata.id,n=g?[l,d,b,m]:[m,d,d,l];c.executeSql(h,n,function(){E[k]={ok:!0,id:a.metadata.id,rev:b},F.set(m,a.metadata),f()})}var u=null,v=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev;var w=Object.keys(a.data._attachments||{});d&&(a.data._deleted=!0),w.forEach(function(b){var c=a.data._attachments[b];if(c.stub)v++,q();else{var d=c.data;delete c.data;var e=c.digest;x(e,d,r)}}),w.length||p()}function v(){e.processDocs(A,c,F,C,E,u,b)}function w(a){function b(){++c===A.length&&a()}if(!A.length)return a();var c=0;A.forEach(function(a){if(a._id&&e.isLocalId(a._id))return b();var c=a.metadata.id;C.executeSql("SELECT json FROM "+i+" WHERE id = ?",[c],function(a,d){if(d.rows.length){var f=e.safeJsonParse(d.rows.item(0).json);F.set(c,f)}b()})})}function x(a,b,c){var d="SELECT digest FROM "+k+" WHERE digest=?";C.executeSql(d,[a],function(e,f){return f.rows.length?c():(d="INSERT INTO "+k+" (digest, body, escaped) VALUES (?,?,1)",e.executeSql(d,[a,g.escapeBlob(b)],function(){c()},function(){return c(),!1}),void 0)})}var y=b.new_edits,z=a.docs,A=z.map(function(a){if(a._id&&e.isLocalId(a._id))return a;var b=e.parseDoc(a,y);return b}),B=A.filter(function(a){return a.error});if(B.length)return q(B[0]);var C,D,E=new Array(A.length),F=new e.Map;e.preprocessAttachments(A,"binary",function(a){return a?q(a):(d.transaction(function(a){C=a,t(function(a){a?D=a:w(v)})},p(q),r),void 0)})}var e=a(34),f=a(19),g=a(11),h=a(10),i=h.DOC_STORE,j=h.BY_SEQ_STORE,k=h.ATTACH_STORE,l=h.ATTACH_AND_SEQ_STORE,m=g.select,n=g.stringifyDoc,o=g.compactRevs,p=g.unknownError;b.exports=d},{}],10:[function(a,b,c){"use strict";function d(a){return"'"+a+"'"}c.ADAPTER_VERSION=7,c.DOC_STORE=d("document-store"),c.BY_SEQ_STORE=d("by-sequence"),c.ATTACH_STORE=d("attach-store"),c.LOCAL_STORE=d("local-store"),c.META_STORE=d("metadata-store"),c.ATTACH_AND_SEQ_STORE=d("attach-seq-store")},{}],11:[function(a,b,c){"use strict";function d(a){return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function e(a){return a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function f(a){return delete a._id,delete a._rev,JSON.stringify(a)}function g(a,b,c){return a=JSON.parse(a),a._id=b,a._rev=c,a}function h(a){for(var b="(";a--;)b+="?",a&&(b+=",");return b+")"}function i(a,b,c,d,e){return"SELECT "+a+" FROM "+("string"==typeof b?b:b.join(" JOIN "))+(c?" ON "+c:"")+(d?" WHERE "+("string"==typeof d?d:d.join(" AND ")):"")+(e?" ORDER BY "+e:"")}function j(a,b,c){function d(){++f===a.length&&e()}function e(){if(g.length){var a="SELECT DISTINCT digest AS digest FROM "+t+" WHERE seq IN "+h(g.length);c.executeSql(a,g,function(a,b){for(var c=[],d=0;d<b.rows.length;d++)c.push(b.rows.item(d).digest);if(c.length){var e="DELETE FROM "+t+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";a.executeSql(e,g,function(a){var b="SELECT digest FROM "+t+" WHERE digest IN ("+c.map(function(){return"?"}).join(",")+")";a.executeSql(b,c,function(a,b){for(var d=new o.Set,e=0;e<b.rows.length;e++)d.add(b.rows.item(e).digest);c.forEach(function(b){d.has(b)||(a.executeSql("DELETE FROM "+t+" WHERE digest=?",[b]),a.executeSql("DELETE FROM "+s+" WHERE digest=?",[b]))})})})}})}}if(a.length){var f=0,g=[];a.forEach(function(a){var e="SELECT seq FROM "+r+" WHERE doc_id=? AND rev=?";c.executeSql(e,[b,a],function(a,b){if(!b.rows.length)return d();var c=b.rows.item(0).seq;g.push(c),a.executeSql("DELETE FROM "+r+" WHERE seq=?",[c],d)})})}}function k(a){return function(b){var c=b&&b.constructor.toString().match(/function ([^\(]+)/),d=c&&c[1]||b.type,e=b.target||b.message;a(p.error(p.WSQ_ERROR,e,d))}}function l(a){if("size"in a)return 1e6*a.size;var b=/Android/.test(window.navigator.userAgent);return b?5e6:1}function m(a,b,c,d){var e="undefined"!=typeof sqlitePlugin&&sqlitePlugin.openDatabase&&sqlitePlugin.openDatabase.bind(sqlitePlugin),f=e||"undefined"!=typeof openDatabase&&openDatabase,g=u[a];return g||(g=u[a]=f(a,b,c,d),g._sqlitePlugin=!!e),g}function n(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}var o=a(34),p=a(19),q=a(10),r=q.BY_SEQ_STORE,s=q.ATTACH_STORE,t=q.ATTACH_AND_SEQ_STORE,u={};b.exports={escapeBlob:d,unescapeBlob:e,stringifyDoc:f,unstringifyDoc:g,qMarks:h,select:i,compactRevs:j,unknownError:k,getSize:l,openDB:m,valid:n}},{}],12:[function(a,b,c){"use strict";function d(a,b,c,d,e){function g(){++j===i.length&&e&&e()}function h(a,b){var e=a._attachments[b],h={encode:!0,ctx:d};c._getAttachment(e,h,function(c,d){a._attachments[b]=f.extend(f.pick(e,["digest","content_type"]),{data:d}),g()})}var i=Object.keys(a._attachments||{});if(!i.length)return e&&e();var j=0;i.forEach(function(c){b.attachments&&b.include_docs?h(a,c):(a._attachments[c].stub=!0,g())})}function e(a,b){function c(){f.hasLocalStorage()&&(window.localStorage["_pouch__websqldb_"+V._name]=!0),b(null,V)}function j(a,b){a.executeSql(E),a.executeSql("ALTER TABLE "+o+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){a.executeSql(C),a.executeSql("ALTER TABLE "+n+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){a.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+n+" (local, id)");var c="SELECT "+n+".winningseq AS seq, "+n+".json AS metadata FROM "+o+" JOIN "+n+" ON "+o+".seq = "+n+".winningseq";a.executeSql(c,[],function(a,c){for(var d=[],e=[],g=0;g<c.rows.length;g++){var h=c.rows.item(g),i=h.seq,j=JSON.parse(h.metadata);f.isDeleted(j)&&d.push(i),f.isLocalId(j.id)&&e.push(j.id)}a.executeSql("UPDATE "+n+"SET local = 1 WHERE id IN "+t(e.length),e,function(){a.executeSql("UPDATE "+o+" SET deleted = 1 WHERE seq IN "+t(d.length),d,b)})})})})}function J(a,b){var c="CREATE TABLE IF NOT EXISTS "+q+" (id UNIQUE, rev, json)";a.executeSql(c,[],function(){var c="SELECT "+n+".id AS id, "+o+".json AS data FROM "+o+" JOIN "+n+" ON "+o+".seq = "+n+".winningseq WHERE local = 1";a.executeSql(c,[],function(a,c){function d(){if(!e.length)return b(a);var c=e.shift(),f=JSON.parse(c.data)._rev;a.executeSql("INSERT INTO "+q+" (id, rev, json) VALUES (?,?,?)",[c.id,f,c.data],function(a){a.executeSql("DELETE FROM "+n+" WHERE id=?",[c.id],function(a){a.executeSql("DELETE FROM "+o+" WHERE seq=?",[c.seq],function(){d()})})})}for(var e=[],f=0;f<c.rows.length;f++)e.push(c.rows.item(f));d()})})}function K(a,b){function c(c){function d(){if(!c.length)return b(a);var e=c.shift(),f=i(e.hex,U),g=f.lastIndexOf("::"),h=f.substring(0,g),j=f.substring(g+2),k="UPDATE "+o+" SET doc_id=?, rev=? WHERE doc_id_rev=?";a.executeSql(k,[h,j,f],function(){d()})}d()}var d="ALTER TABLE "+o+" ADD COLUMN doc_id";a.executeSql(d,[],function(a){var b="ALTER TABLE "+o+" ADD COLUMN rev";a.executeSql(b,[],function(a){a.executeSql(D,[],function(a){var b="SELECT hex(doc_id_rev) as hex FROM "+o;a.executeSql(b,[],function(a,b){for(var d=[],e=0;e<b.rows.length;e++)d.push(b.rows.item(e));c(d)})})})})}function L(a,b){function c(a){var c="SELECT COUNT(*) AS cnt FROM "+p;a.executeSql(c,[],function(a,c){function d(){var c=w(I+", "+n+".id AS id",[n,o],H,null,n+".id ");c+=" LIMIT "+g+" OFFSET "+f,f+=g,a.executeSql(c,[],function(a,c){function e(a,b){var c=f[a]=f[a]||[];c.indexOf(b)===-1&&c.push(b)}if(!c.rows.length)return b(a);for(var f={},g=0;g<c.rows.length;g++)for(var h=c.rows.item(g),i=v(h.data,h.id,h.rev),j=Object.keys(i._attachments||{}),k=0;k<j.length;k++){var l=i._attachments[j[k]];e(l.digest,h.seq)}var m=[];if(Object.keys(f).forEach(function(a){var b=f[a];b.forEach(function(b){m.push([a,b])})}),!m.length)return d();var n=0;m.forEach(function(b){var c="INSERT INTO "+s+" (digest, seq) VALUES (?,?)";a.executeSql(c,b,function(){++n===m.length&&d()})})})}var e=c.rows.item(0).cnt;if(!e)return b(a);var f=0,g=10;d()})}var d="CREATE TABLE IF NOT EXISTS "+s+" (digest, seq INTEGER)";a.executeSql(d,[],function(a){a.executeSql(G,[],function(a){a.executeSql(F,[],c)})})}function M(a,b){var c="ALTER TABLE "+p+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";a.executeSql(c,[],b)}function N(a,b){var c="ALTER TABLE "+n+" ADD COLUMN max_seq INTEGER";a.executeSql(c,[],function(a){var c="UPDATE "+n+" SET max_seq=(SELECT MAX(seq) FROM "+o+" WHERE doc_id=id)";a.executeSql(c,[],function(a){var c="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+n+" (max_seq)";a.executeSql(c,[],b)})})}function O(a,b){a.executeSql('SELECT HEX("a") AS hex',[],function(a,c){var d=c.rows.item(0).hex;U=2===d.length?"UTF-8":"UTF-16",b()})}function P(){for(;Y.length>0;){var a=Y.pop();a(null,W)}}function Q(a,b){if(0===b){var c="CREATE TABLE IF NOT EXISTS "+r+" (dbid, db_version INTEGER)",d="CREATE TABLE IF NOT EXISTS "+p+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",e="CREATE TABLE IF NOT EXISTS "+s+" (digest, seq INTEGER)",g="CREATE TABLE IF NOT EXISTS "+n+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",h="CREATE TABLE IF NOT EXISTS "+o+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",i="CREATE TABLE IF NOT EXISTS "+q+" (id UNIQUE, rev, json)";a.executeSql(d),a.executeSql(i),a.executeSql(e,[],function(){a.executeSql(F),a.executeSql(G)}),a.executeSql(g,[],function(){a.executeSql(E),a.executeSql(h,[],function(){a.executeSql(C),a.executeSql(D),a.executeSql(c,[],function(){var b="INSERT INTO "+r+" (db_version, dbid) VALUES (?,?)";W=f.uuid();var c=[m,W];a.executeSql(b,c,function(){P()})})})})}else{var k=function(){var c=b<m;c&&a.executeSql("UPDATE "+r+" SET db_version = "+m);var d="SELECT dbid FROM "+r;a.executeSql(d,[],function(a,b){W=b.rows.item(0).dbid,P()})},l=[j,J,K,L,M,N,k],t=b,u=function(a){l[t-1](a,u),t++};u(a)}}function R(){Z.transaction(function(a){O(a,function(){S(a)})},y(b),c)}function S(a){var b="SELECT sql FROM sqlite_master WHERE tbl_name = "+r;a.executeSql(b,[],function(a,b){b.rows.length?/db_version/.test(b.rows.item(0).sql)?a.executeSql("SELECT db_version FROM "+r,[],function(a,b){var c=b.rows.item(0).db_version;Q(a,c)}):a.executeSql("ALTER TABLE "+r+" ADD COLUMN db_version INTEGER",[],function(){Q(a,1)}):Q(a,0)})}function T(a,b){if(V._docCount!==-1)return b(V._docCount);var c=w("COUNT("+n+".id) AS 'num'",[n,o],H,o+".deleted=0");a.executeSql(c,[],function(a,c){V._docCount=c.rows.item(0).num,b(V._docCount)})}var U,V=this,W=null,X=z(a),Y=[];V._docCount=-1,V._name=a.name;var Z=A(V._name,B,V._name,X);return Z?("function"!=typeof Z.readTransaction&&(Z.readTransaction=Z.transaction),f.isCordova()?window.addEventListener(V._name+"_pouch",function a(){window.removeEventListener(V._name+"_pouch",a,!1),R()},!1):R(),V.type=function(){return"websql"},V._id=f.toPromise(function(a){a(null,W)}),V._info=function(a){Z.readTransaction(function(b){T(b,function(c){var d="SELECT MAX(seq) AS seq FROM "+o;b.executeSql(d,[],function(b,d){var e=d.rows.item(0).seq||0;a(null,{doc_count:c,update_seq:e,sqlite_plugin:Z._sqlitePlugin,websql_encoding:U})})})},y(a))},V._bulkDocs=function(a,b,c){l(a,b,V,Z,e.Changes,c)},V._get=function(a,b,c){function d(){c(i,{doc:e,metadata:g,ctx:l})}b=f.clone(b);var e,g,i;if(!b.ctx)return Z.readTransaction(function(d){b.ctx=d,V._get(a,b,c)}),void 0;var j,k,l=b.ctx;b.rev?(j=w(I,[n,o],n+".id="+o+".doc_id",[o+".doc_id=?",o+".rev=?"]),k=[a,b.rev]):(j=w(I,[n,o],H,n+".id=?"),k=[a]),l.executeSql(j,k,function(a,c){if(!c.rows.length)return i=h.error(h.MISSING_DOC,"missing"),d();var j=c.rows.item(0);return g=f.safeJsonParse(j.metadata),j.deleted&&!b.rev?(i=h.error(h.MISSING_DOC,"deleted"),d()):(e=v(j.data,g.id,j.rev),d(),void 0)})},V._allDocs=function(a,b){var c,e=[],h="startkey"in a&&a.startkey,i="endkey"in a&&a.endkey,j="key"in a&&a.key,k="descending"in a&&a.descending,l="limit"in a?a.limit:-1,m="skip"in a?a.skip:0,p=a.inclusive_end!==!1,q=[],r=[];if(j!==!1)r.push(n+".id = ?"),q.push(j);else if(h!==!1||i!==!1){if(h!==!1&&(r.push(n+".id "+(k?"<=":">=")+" ?"),q.push(h)),i!==!1){var s=k?">":"<";p&&(s+="="),r.push(n+".id "+s+" ?"),q.push(i)}j!==!1&&(r.push(n+".id = ?"),q.push(j))}"ok"!==a.deleted&&r.push(o+".deleted = 0"),Z.readTransaction(function(b){T(b,function(h){if(c=h,0!==l){var i=w(I,[n,o],H,r,n+".id "+(k?"DESC":"ASC"));i+=" LIMIT "+l+" OFFSET "+m,b.executeSql(i,q,function(b,c){for(var h=0,i=c.rows.length;h<i;h++){var j=c.rows.item(h),k=f.safeJsonParse(j.metadata),l=k.id,m=v(j.data,l,j.rev),n=m._rev,o={id:l,key:l,value:{rev:n}};if(a.include_docs&&(o.doc=m,o.doc._rev=n,a.conflicts&&(o.doc._conflicts=g.collectConflicts(k)),d(o.doc,a,V,b)),j.deleted){if("ok"!==a.deleted)continue;o.value.deleted=!0,o.doc=null}e.push(o)}})}})},y(b),function(){b(null,{total_rows:c,offset:a.skip,rows:e})})},V._changes=function(a){function b(){var b=n+".json AS metadata, "+n+".max_seq AS maxSeq, "+o+".json AS winningDoc, "+o+".rev AS winningRev ",c=n+" JOIN "+o,e=n+".id="+o+".doc_id AND "+n+".winningseq="+o+".seq",l=["maxSeq > ?"],m=[a.since];a.doc_ids&&(l.push(n+".id IN "+t(a.doc_ids.length)),m=m.concat(a.doc_ids));var p="maxSeq "+(g?"DESC":"ASC"),q=w(b,c,e,l,p),r=f.filterChange(a);a.view||a.filter||(q+=" LIMIT "+h);var s=a.since||0;Z.readTransaction(function(b){b.executeSql(q,m,function(b,c){function e(b){return function(){a.onChange(b)}}for(var g=0,l=c.rows.length;g<l;g++){var m=c.rows.item(g),n=f.safeJsonParse(m.metadata);s=m.maxSeq;var o=v(m.winningDoc,n.id,m.winningRev),p=a.processChange(o,n,a);if(p.seq=m.maxSeq,r(p)&&(k++,i&&j.push(p),a.attachments&&a.include_docs?d(o,a,V,b,e(p)):e(p)()),k===h)break}})},y(a.complete),function(){a.continuous||a.complete(null,{results:j,last_seq:s})})}if(a=f.clone(a),a.continuous){var c=V._name+":"+f.uuid();return e.Changes.addListener(V._name,c,V,a),e.Changes.notify(V._name),{cancel:function(){e.Changes.removeListener(V._name,c)}}}var g=a.descending;a.since=a.since&&!g?a.since:0;var h="limit"in a?a.limit:-1;0===h&&(h=1);var i;i=!("returnDocs"in a)||a.returnDocs;var j=[],k=0;b()},V._close=function(a){a()},V._getAttachment=function(a,b,c){var d,e=b.ctx,g=a.digest,h=a.content_type,j="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+p+" WHERE digest=?";e.executeSql(j,[g],function(a,e){var g=e.rows.item(0),j=g.escaped?k.unescapeBlob(g.body):i(g.body,U);b.encode?d=btoa(j):(j=f.fixBinary(j),d=f.createBlob([j],{type:h})),c(null,d)})},V._getRevisionTree=function(a,b){Z.readTransaction(function(c){var d="SELECT json AS metadata FROM "+n+" WHERE id = ?";c.executeSql(d,[a],function(a,c){if(c.rows.length){var d=f.safeJsonParse(c.rows.item(0).metadata);b(null,d.rev_tree)}else b(h.error(h.MISSING_DOC))})})},V._doCompaction=function(a,b,c){return b.length?(Z.transaction(function(c){var d="SELECT json AS metadata FROM "+n+" WHERE id = ?";c.executeSql(d,[a],function(c,d){var e=f.safeJsonParse(d.rows.item(0).metadata);g.traverseRevTree(e.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;b.indexOf(g)!==-1&&(f.status="missing")});var h="UPDATE "+n+" SET json = ? WHERE id = ?";c.executeSql(h,[f.safeJsonStringify(e),a])}),x(b,a,c)},y(c),function(){c()}),void 0):c()},V._getLocal=function(a,b){Z.readTransaction(function(c){var d="SELECT json, rev FROM "+q+" WHERE id=?";c.executeSql(d,[a],function(c,d){if(d.rows.length){var e=d.rows.item(0),f=v(e.json,a,e.rev);b(null,f)}else b(h.error(h.MISSING_DOC))})})},V._putLocal=function(a,b,c){function d(a){var d,k;f?(d="UPDATE "+q+" SET rev=?, json=? WHERE id=? AND rev=?",k=[e,j,g,f]):(d="INSERT INTO "+q+" (id, rev, json) VALUES (?,?,?)",k=[g,e,j]),a.executeSql(d,k,function(a,d){d.rowsAffected?(i={ok:!0,id:g,rev:e},b.ctx&&c(null,i)):c(h.error(h.REV_CONFLICT))},function(){return c(h.error(h.REV_CONFLICT)),!1})}"function"==typeof b&&(c=b,b={}),delete a._revisions;var e,f=a._rev,g=a._id;e=f?a._rev="0-"+(parseInt(f.split("-")[1],10)+1):a._rev="0-1";var i,j=u(a);b.ctx?d(b.ctx):Z.transaction(function(a){d(a)},y(c),function(){i&&c(null,i)})},V._removeLocal=function(a,b){var c;Z.transaction(function(d){var e="DELETE FROM "+q+" WHERE id=? AND rev=?",f=[a._id,a._rev];d.executeSql(e,f,function(d,e){return e.rowsAffected?(c={ok:!0,id:a._id,rev:"0-0"},void 0):b(h.error(h.MISSING_DOC))})},y(b),function(){c&&b(null,c)})},void 0):b(h.error(h.UNKNOWN_ERROR))}var f=a(34),g=a(29),h=a(19),i=a(22),j=a(10),k=a(11),l=a(9),m=j.ADAPTER_VERSION,n=j.DOC_STORE,o=j.BY_SEQ_STORE,p=j.ATTACH_STORE,q=j.LOCAL_STORE,r=j.META_STORE,s=j.ATTACH_AND_SEQ_STORE,t=k.qMarks,u=k.stringifyDoc,v=k.unstringifyDoc,w=k.select,x=k.compactRevs,y=k.unknownError,z=k.getSize,A=k.openDB,B=1,C="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+o+" (seq, deleted)",D="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+o+" (doc_id, rev)",E="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+n+" (winningseq)",F="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+s+" (seq)",G="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+s+" (digest, seq)",H=o+".seq = "+n+".winningseq",I=o+".seq AS seq, "+o+".deleted AS deleted, "+o+".json AS data, "+o+".rev AS rev, "+n+".json AS metadata";e.valid=k.valid,e.destroy=f.toPromise(function(a,b,c){e.Changes.removeAllListeners(a);var d=z(b),g=A(a,B,a,d);g.transaction(function(a){var b=[n,o,p,r,q,s];b.forEach(function(b){a.executeSql("DROP TABLE IF EXISTS "+b,[])})},y(c),function(){f.hasLocalStorage()&&(delete window.localStorage["_pouch__websqldb_"+a],delete window.localStorage[a]),c(null,{ok:!0})})}),e.Changes=new f.Changes,b.exports=e},{}],13:[function(a,b,c){"use strict";function d(a,b,c){function d(){e.cancel()}i.call(this);var e=this;this.db=a,b=b?f.clone(b):{};var g=c||b.complete||function(){},h=b.complete=f.once(function(b,c){b?e.emit("error",b):e.emit("complete",c),e.removeAllListeners(),a.removeListener("destroyed",d)});g&&(e.on("complete",function(a){g(null,a)}),e.on("error",function(a){g(a)}));var j=b.onChange;j&&e.on("change",j),a.once("destroyed",d),b.onChange=function(a){b.isCancelled||(e.emit("change",a),e.startSeq&&e.startSeq<=a.seq&&(e.emit("uptodate"),e.startSeq=!1),a.deleted?e.emit("delete",a):1===a.changes.length&&"1-"===a.changes[0].rev.slice(0,2)?e.emit("create",a):e.emit("update",a))};var k=new f.Promise(function(a,c){b.complete=function(b,d){b?c(b):a(d)}});e.once("cancel",function(){j&&e.removeListener("change",j),b.complete(null,{status:"cancelled"})}),this.then=k.then.bind(k),this.catch=k.catch.bind(k),this.then(function(a){h(null,a)},h),a.taskqueue.isReady?e.doChanges(b):a.taskqueue.addTask(function(){e.isCancelled?e.emit("cancel"):e.doChanges(b)})}function e(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=g.collectLeaves(b.rev_tree).map(function(a){return{rev:a.rev}}));var e={id:b.id,changes:d,doc:a};return f.isDeleted(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=g.collectConflicts(b),e.doc._conflicts.length||delete e.doc._conflicts),e}var f=a(34),g=a(29),h=a(19),i=a(38).EventEmitter,j=a(27),k=a(28);b.exports=d,f.inherits(d,i),d.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},d.prototype.doChanges=function(a){var b=this,c=a.complete;if(a=f.clone(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=e,"latest"===a.since&&(a.since="now"),a.since||(a.since=0),"now"===a.since)return this.db.info().then(function(d){return b.isCancelled?(c(null,{status:"cancelled"}),void 0):(a.since=d.update_seq,b.doChanges(a),void 0)},c),void 0;if(a.continuous&&"now"!==a.since&&this.db.info().then(function(a){b.startSeq=a.update_seq},function(a){if("idbNull"!==a.id)throw a}),"http"!==this.db.type()&&a.filter&&"string"==typeof a.filter&&!a.doc_ids)return this.filterChanges(a);"descending"in a||(a.descending=!1),a.limit=0===a.limit?1:a.limit,a.complete=c;var d=this.db._changes(a);if(d&&"function"==typeof d.cancel){var g=b.cancel;b.cancel=f.getArguments(function(a){d.cancel(),g.apply(this,a)})}},d.prototype.filterChanges=function(a){var b=this,c=a.complete;if("_view"===a.filter){if(!a.view||"string"!=typeof a.view){var d=h.error(h.BAD_REQUEST,"`view` filter parameter is not provided.");return c(d),void 0}var e=a.view.split("/");this.db.get("_design/"+e[0],function(d,f){if(b.isCancelled)return c(null,{status:"cancelled"}),void 0;if(d)return c(h.generateErrorFromResponse(d)),void 0;if(f&&f.views&&f.views[e[1]]){var g=k(f.views[e[1]].map);return a.filter=g,b.doChanges(a),void 0}var i=f.views?"missing json key: "+e[1]:"missing json key: views";d||(d=h.error(h.MISSING_DOC,i)),c(d)})}else{var f=a.filter.split("/");this.db.get("_design/"+f[0],function(d,e){if(b.isCancelled)return c(null,{status:"cancelled"}),void 0;if(d)return c(h.generateErrorFromResponse(d)),void 0;if(e&&e.filters&&e.filters[f[1]]){var g=j(e.filters[f[1]]);return a.filter=g,b.doChanges(a),void 0}var i=e&&e.filters?"missing json key: "+f[1]:"missing json key: filters";return d||(d=h.error(h.MISSING_DOC,i)),c(d),void 0})}}},{}],14:[function(a,b,c){"use strict";function d(a,b,c,d){return a.get(b).catch(function(c){if(404===c.status)return"http"===a.type()&&f.explain404("PouchDB is just checking if a remote checkpoint exists."),{_id:b};throw c}).then(function(b){if(!d.cancelled)return b.last_seq=c,a.put(b)})}function e(a,b,c,d){this.src=a,this.target=b,this.id=c,this.returnValue=d}var f=a(34),g=a(62),h=g.collate;e.prototype.writeCheckpoint=function(a){var b=this;return this.updateTarget(a).then(function(){return b.updateSource(a)})},e.prototype.updateTarget=function(a){return d(this.target,this.id,a,this.returnValue)},e.prototype.updateSource=function(a){var b=this;return this.readOnlySource?f.Promise.resolve(!0):d(this.src,this.id,a,this.returnValue).catch(function(a){var c="number"==typeof a.status&&4===Math.floor(a.status/100);if(c)return b.readOnlySource=!0,!0;throw a})},e.prototype.getCheckpoint=function(){var a=this;return a.target.get(a.id).then(function(b){return a.src.get(a.id).then(function(a){return 0===h(b.last_seq,a.last_seq)?a.last_seq:0},function(c){if(404===c.status&&b.last_seq)return a.src.put({_id:a.id,last_seq:0}).then(function(){return 0},function(c){return 401===c.status?(a.readOnlySource=!0,b.last_seq):0});throw c})}).catch(function(a){if(404!==a.status)throw a;return 0})},b.exports=e},{}],15:[function(a,b,c){(function(c,d){"use strict";function e(a){a&&d.debug&&console.error(a)}function f(a,b,d){if(!(this instanceof f))return new f(a,b,d);var k=this;"function"!=typeof b&&"undefined"!=typeof b||(d=b,b={}),a&&"object"==typeof a&&(b=a,a=void 0),"undefined"==typeof d&&(d=e),b=b||{},this.__opts=b;var l=d;k.auto_compaction=b.auto_compaction,k.prefix=f.prefix,g.call(k),k.taskqueue=new i;var m=new j(function(e,g){d=function(a,b){return a?g(a):(delete b.then,e(b),void 0)},b=h.clone(b);var i,j,l=b.name||a;return function(){try{if("string"!=typeof l)throw j=new Error("Missing/invalid DB name"),j.code=400,j;if(i=f.parseAdapter(l,b),b.originalName=l,b.name=i.name,b.prefix&&"http"!==i.adapter&&"https"!==i.adapter&&(b.name=b.prefix+b.name),
b.adapter=b.adapter||i.adapter,k._adapter=b.adapter,k._db_name=l,!f.adapters[b.adapter])throw j=new Error("Adapter is missing"),j.code=404,j;if(!f.adapters[b.adapter].valid())throw j=new Error("Invalid Adapter"),j.code=404,j}catch(a){k.taskqueue.fail(a),k.changes=h.toPromise(function(b){b.complete&&b.complete(a)})}}(),j?g(j):(k.adapter=b.adapter,k.replicate={},k.replicate.from=function(a,b,c){return k.constructor.replicate(a,k,b,c)},k.replicate.to=function(a,b,c){return k.constructor.replicate(k,a,b,c)},k.sync=function(a,b,c){return k.constructor.sync(k,a,b,c)},k.replicate.sync=k.sync,k.destroy=h.adapterFun("destroy",function(a){var b=this,c=this.__opts||{};b.info(function(d,e){return d?a(d):(c.internal=!0,b.constructor.destroy(e.db_name,c,a),void 0)})}),f.adapters[b.adapter].call(k,b,function(a){function c(a){"destroyed"===a&&(k.emit("destroyed"),f.removeListener(l,c))}return a?(d&&(k.taskqueue.fail(a),d(a)),void 0):(f.on(l,c),k.emit("created",k),f.emit("created",b.originalName),k.taskqueue.ready(k),d(null,k),void 0)}),b.skipSetup&&(k.taskqueue.ready(k),c.nextTick(function(){d(null,k)})),h.isCordova()&&cordova.fireWindowEvent(b.name+"_pouch",{}),void 0)});m.then(function(a){l(null,a)},l),k.then=m.then.bind(m),k.catch=m.catch.bind(m)}var g=a(1),h=a(34),i=a(33),j=h.Promise;h.inherits(f,g),f.debug=a(40),b.exports=f}).call(this,a(39),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(a,b,c){(function(c){"use strict";function d(a,b){function d(b,c,d){if(a.binary||a.json||!a.processData||"string"==typeof b){if(!a.binary&&a.json&&"string"==typeof b)try{b=JSON.parse(b)}catch(a){return d(a)}}else b=JSON.stringify(b);Array.isArray(b)&&(b=b.map(function(a){return a.error||a.missing?g.generateErrorFromResponse(a):a})),d(null,b,c)}function i(a,b){var c,d;if(a.code&&a.status){var e=new Error(a.message||a.code);return e.status=a.status,b(e)}try{c=JSON.parse(a.responseText),d=g.generateErrorFromResponse(c)}catch(b){d=g.generateErrorFromResponse(a)}b(d)}function j(a){return c.browser?"":new f("","binary")}var k=!1,l=h.getArguments(function(a){k||(b.apply(this,a),k=!0)});"function"==typeof a&&(l=a,a={}),a=h.clone(a);var m={method:"GET",headers:{},json:!0,processData:!0,timeout:3e5,cache:!1};return a=h.extend(!0,m,a),a.json&&(a.binary||(a.headers.Accept="application/json"),a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"),a.binary&&(a.encoding=null,a.json=!1),a.processData||(a.json=!1),e(a,function(b,c,e){if(b)return b.status=c?c.statusCode:400,i(b,l);var f,h=c.headers&&c.headers["content-type"],k=e||j();a.binary||!a.json&&a.processData||"object"==typeof k||!(/json/.test(h)||/^[\s]*\{/.test(k)&&/\}[\s]*$/.test(k))||(k=JSON.parse(k)),c.statusCode>=200&&c.statusCode<300?d(k,c,l):(a.binary&&(k=JSON.parse(k.toString())),f=g.generateErrorFromResponse(k),f.status=c.statusCode,l(f))})}var e=a(24),f=a(18),g=a(19),h=a(34);b.exports=d}).call(this,a(39))},{}],17:[function(a,b,c){(function(a){"use strict";function c(b,c){b=b||[],c=c||{};try{return new Blob(b,c)}catch(g){if("TypeError"!==g.name)throw g;for(var d=a.BlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder||a.WebKitBlobBuilder,e=new d,f=0;f<b.length;f+=1)e.append(b[f]);return e.getBlob(c.type)}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(a,b,c){b.exports={}},{}],19:[function(a,b,c){"use strict";function d(a){Error.call(a.reason),this.status=a.status,this.name=a.error,this.message=a.reason,this.error=!0}var e=a(43);e(d,Error),d.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},c.UNAUTHORIZED=new d({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),c.MISSING_BULK_DOCS=new d({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),c.MISSING_DOC=new d({status:404,error:"not_found",reason:"missing"}),c.REV_CONFLICT=new d({status:409,error:"conflict",reason:"Document update conflict"}),c.INVALID_ID=new d({status:400,error:"invalid_id",reason:"_id field must contain a string"}),c.MISSING_ID=new d({status:412,error:"missing_id",reason:"_id is required for puts"}),c.RESERVED_ID=new d({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),c.NOT_OPEN=new d({status:412,error:"precondition_failed",reason:"Database not open"}),c.UNKNOWN_ERROR=new d({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),c.BAD_ARG=new d({status:500,error:"badarg",reason:"Some query argument is invalid"}),c.INVALID_REQUEST=new d({status:400,error:"invalid_request",reason:"Request was invalid"}),c.QUERY_PARSE_ERROR=new d({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),c.DOC_VALIDATION=new d({status:500,error:"doc_validation",reason:"Bad special document member"}),c.BAD_REQUEST=new d({status:400,error:"bad_request",reason:"Something wrong with the request"}),c.NOT_AN_OBJECT=new d({status:400,error:"bad_request",reason:"Document must be a JSON object"}),c.DB_MISSING=new d({status:404,error:"not_found",reason:"Database not found"}),c.IDB_ERROR=new d({status:500,error:"indexed_db_went_bad",reason:"unknown"}),c.WSQ_ERROR=new d({status:500,error:"web_sql_went_bad",reason:"unknown"}),c.LDB_ERROR=new d({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),c.FORBIDDEN=new d({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),c.INVALID_REV=new d({status:400,error:"bad_request",reason:"Invalid rev format"}),c.FILE_EXISTS=new d({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),c.MISSING_STUB=new d({status:412,error:"missing_stub"}),c.error=function(a,b,c){function e(b){for(var d in a)"function"!=typeof a[d]&&(this[d]=a[d]);void 0!==c&&(this.name=c),void 0!==b&&(this.reason=b)}return e.prototype=d.prototype,new e(b)},c.getErrorTypeByProp=function(a,b,d){var e=c,f=Object.keys(e).filter(function(c){var d=e[c];return"function"!=typeof d&&d[a]===b}),g=d&&f.filter(function(a){var b=e[a];return b.message===d})[0]||f[0];return g?e[g]:null},c.generateErrorFromResponse=function(a){var b,d,e,f,g,h=c;return d=a.error===!0&&"string"==typeof a.name?a.name:a.error,g=a.reason,e=h.getErrorTypeByProp("name",d,g),a.missing||"missing"===g||"deleted"===g||"not_found"===d?e=h.MISSING_DOC:"doc_validation"===d?(e=h.DOC_VALIDATION,f=g):"bad_request"===d&&e.message!==g&&(0===g.indexOf("unknown stub attachment")?(e=h.MISSING_STUB,f=g):e=h.BAD_REQUEST),e||(e=h.getErrorTypeByProp("status",a.status,g)||h.UNKNOWN_ERROR),b=h.error(e,g,d),f&&(b.message=f),a.id&&(b.id=a.id),a.status&&(b.status=a.status),a.statusText&&(b.name=a.statusText),a.missing&&(b.missing=a.missing),b}},{}],20:[function(a,b,c){(function(c,d){"use strict";function e(a,b,c){if("function"==typeof a.slice)return b||c?c?a.slice(b,c):a.slice(b):a.slice();b=Math.floor(b||0),c=Math.floor(c||0);var d=a.byteLength;if(b=b<0?Math.max(b+d,0):Math.min(d,b),c=c<0?Math.max(c+d,0):Math.min(d,c),c-b<=0)return new ArrayBuffer(0);var e=new ArrayBuffer(c-b),f=new Uint8Array(e),g=new Uint8Array(a,b,c-b);return f.set(g),e}function f(a){var b=[255&a,a>>>8&255,a>>>16&255,a>>>24&255];return b.map(function(a){return String.fromCharCode(a)}).join("")}function g(a){for(var b="",c=0;c<a.length;c++)b+=f(a[c]);return btoa(b)}var h=a(37),i=a(73),j=d.setImmediate||d.setTimeout,k=65536;b.exports=function(a,b){function d(a,b,c,d){m?a.appendBinary(b.substring(c,d)):a.append(e(b,c,d))}function f(){var c=q*o,e=c+o;if(q++,q<p)d(r,a,c,e),j(f);else{d(r,a,c,e);var h=r.end(!0),i=g(h);b(null,i),r.destroy()}}if(!c.browser){var l=h.createHash("md5").update(a).digest("base64");return b(null,l),void 0}var m="string"==typeof a,n=m?a.length:a.byteLength,o=Math.min(k,n),p=Math.ceil(n/o),q=0,r=m?new i:new i.ArrayBuffer;f()}}).call(this,a(39),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(a,b,c){"use strict";function d(a){return a.reduce(function(a,b){return a[b]=!0,a},{})}function e(a){if(!/^\d+\-./.test(a))return g.error(g.INVALID_REV);var b=a.indexOf("-"),c=a.substring(0,b),d=a.substring(b+1);return{prefix:parseInt(c,10),id:d}}function f(a,b){for(var c=a.start-a.ids.length+1,d=a.ids,e=[d[0],b,[]],f=1,g=d.length;f<g;f++)e=[d[f],{status:"missing"},[e]];return[{pos:c,ids:e}]}var g=a(19),h=a(26),i=d(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),j=d(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);c.invalidIdError=function(a){var b;if(a?"string"!=typeof a?b=g.error(g.INVALID_ID):/^_/.test(a)&&!/^_(design|local)/.test(a)&&(b=g.error(g.RESERVED_ID)):b=g.error(g.MISSING_ID),b)throw b},c.parseDoc=function(a,b){var d,k,l,m={status:"available"};if(a._deleted&&(m.deleted=!0),b)if(a._id||(a._id=h()),k=h(32,16).toLowerCase(),a._rev){if(l=e(a._rev),l.error)return l;a._rev_tree=[{pos:l.prefix,ids:[l.id,{status:"missing"},[[k,m,[]]]]}],d=l.prefix+1}else a._rev_tree=[{pos:1,ids:[k,m,[]]}],d=1;else if(a._revisions&&(a._rev_tree=f(a._revisions,m),d=a._revisions.start,k=a._revisions.ids[0]),!a._rev_tree){if(l=e(a._rev),l.error)return l;d=l.prefix,k=l.id,a._rev_tree=[{pos:d,ids:[k,m,[]]}]}c.invalidIdError(a._id),a._rev=d+"-"+k;var n={metadata:{},data:{}};for(var o in a)if(a.hasOwnProperty(o)){var p="_"===o[0];if(p&&!i[o]){var q=g.error(g.DOC_VALIDATION,o);throw q.message=g.DOC_VALIDATION.message+": "+o,q}p&&!j[o]?n.metadata[o.slice(1)]=a[o]:n.data[o]=a[o]}return n}},{}],22:[function(a,b,c){"use strict";function d(a){return decodeURIComponent(window.escape(a))}function e(a){return a<65?a-48:a-55}function f(a,b,c){for(var d="";b<c;)d+=String.fromCharCode(e(a.charCodeAt(b++))<<4|e(a.charCodeAt(b++)));return d}function g(a,b,c){for(var d="";b<c;)d+=String.fromCharCode(e(a.charCodeAt(b+2))<<12|e(a.charCodeAt(b+3))<<8|e(a.charCodeAt(b))<<4|e(a.charCodeAt(b+1))),b+=4;return d}function h(a,b){return"UTF-8"===b?d(f(a,0,a.length)):g(a,0,a.length)}b.exports=h},{}],23:[function(a,b,c){"use strict";function d(a){for(var b=e,c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},f=14;f--;){var g=b.key[f],h=c[f]||"",i=["user","password"].indexOf(g)!==-1;d[g]=i?decodeURIComponent(h):h}return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d}var e={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};b.exports=d},{}],24:[function(a,b,c){"use strict";var d=a(17),e=a(34);b.exports=function(a,b){var c,f,g,h=function(){c.abort()};if(c=a.xhr?new a.xhr:new XMLHttpRequest,"GET"===a.method&&!a.cache){var i=a.url.indexOf("?")!==-1;a.url+=(i?"&":"?")+"_nonce="+Date.now()}c.open(a.method,a.url),c.withCredentials=!0,a.json&&(a.headers.Accept="application/json",a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json",a.body&&a.processData&&"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.binary&&(c.responseType="arraybuffer"),"body"in a||(a.body=null);for(var j in a.headers)a.headers.hasOwnProperty(j)&&c.setRequestHeader(j,a.headers[j]);return a.timeout>0&&(f=setTimeout(h,a.timeout),c.onprogress=function(){clearTimeout(f),f=setTimeout(h,a.timeout)},"undefined"==typeof g&&(g=Object.keys(c).indexOf("upload")!==-1),g&&(c.upload.onprogress=c.onprogress)),c.onreadystatechange=function(){if(4===c.readyState){var e={statusCode:c.status};if(c.status>=200&&c.status<300){var f;f=a.binary?d([c.response||""],{type:c.getResponseHeader("Content-Type")}):c.responseText,b(null,e,f)}else{var g={};try{g=JSON.parse(c.response)}catch(a){}b(g,e)}}},a.body&&a.body instanceof Blob?e.readAsBinaryString(a.body,function(a){c.send(e.fixBinary(a))}):c.send(a.body),{abort:h}}},{}],25:[function(a,b,c){"use strict";var d=a(72).upsert;b.exports=function(a,b,c,e){return d.call(a,b,c,e)}},{}],26:[function(a,b,c){"use strict";function d(a){return 0|Math.random()*a}function e(a,b){b=b||f.length;var c="",e=-1;if(a){for(;++e<a;)c+=f[d(b)];return c}for(;++e<36;)switch(e){case 8:case 13:case 18:case 23:c+="-";break;case 19:c+=f[3&d(16)|8];break;default:c+=f[d(16)]}return c}var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");b.exports=e},{}],27:[function(_dereq_,module,exports){"use strict";function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}module.exports=evalFilter},{}],28:[function(_dereq_,module,exports){"use strict";function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}module.exports=evalView},{}],29:[function(a,b,c){"use strict";function d(a,b,c){for(var d,e=0,f=a.length;e<f;)d=e+f>>>1,c(a[d],b)<0?e=d+1:f=d;return e}function e(a,b,c){var e=d(a,b,c);a.splice(e,0,b)}function f(a){for(var b,c=a.shift(),d=[c.id,c.opts,[]],e=d;a.length;)c=a.shift(),b=[c.id,c.opts,[]],e[2].push(b),e=b;return d}function g(a,b){return a[0]<b[0]?-1:1}function h(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var f=c.pop(),h=f.tree1,i=f.tree2;(h[1].status||i[1].status)&&(h[1].status="available"===h[1].status||"available"===i[1].status?"available":"missing");for(var j=0;j<i[2].length;j++)if(h[2][0]){for(var k=!1,l=0;l<h[2].length;l++)h[2][l][0]===i[2][j][0]&&(c.push({tree1:h[2][l],tree2:i[2][j]}),k=!0);k||(d="new_branch",e(h[2],i[2][j],g))}else d="new_leaf",h[2][0]=i[2][j]}return{conflicts:d,tree:a}}function i(a,b,c){var d,e=[],f=!1,g=!1;return a.length?(a.forEach(function(a){if(a.pos===b.pos&&a.ids[0]===b.ids[0])d=h(a.ids,b.ids),e.push({pos:a.pos,ids:d.tree}),f=f||d.conflicts,g=!0;else if(c!==!0){var i=a.pos<b.pos?a:b,j=a.pos<b.pos?b:a,k=j.pos-i.pos,l=[],m=[];for(m.push({ids:i.ids,diff:k,parent:null,parentIdx:null});m.length>0;){var n=m.pop();0!==n.diff?n.ids&&n.ids[2].forEach(function(a,b){m.push({ids:a,diff:n.diff-1,parent:n.ids,parentIdx:b})}):n.ids[0]===j.ids[0]&&l.push(n)}var o=l[0];o?(d=h(o.ids,j.ids),o.parent[2][o.parentIdx]=d.tree,e.push({pos:i.pos,ids:i.ids}),f=f||d.conflicts,g=!0):e.push(a)}else e.push(a)}),g||e.push(b),e.sort(function(a,b){return a.pos-b.pos}),{tree:e,conflicts:f||"internal_node"}):{tree:[b],conflicts:"new_leaf"}}function j(a,b){var c=l.rootToLeaf(a).map(function(a){var c=a.ids.slice(-b);return{pos:a.pos+(a.ids.length-c.length),ids:f(c)}});return c.reduce(function(a,b){return i(a,b,!0).tree},[c.shift()])}var k=a(65),l={};l.merge=function(a,b,c){a=k(!0,[],a),b=k(!0,{},b);var d=i(a,b);return{tree:j(d.tree,c),conflicts:d.conflicts}},l.winningRev=function(a){var b=[];return l.traverseRevTree(a.rev_tree,function(a,c,d,e,f){a&&b.push({pos:c,id:d,deleted:!!f.deleted})}),b.sort(function(a,b){return a.deleted!==b.deleted?a.deleted>b.deleted?1:-1:a.pos!==b.pos?b.pos-a.pos:a.id<b.id?1:-1}),b[0].pos+"-"+b[0].id},l.traverseRevTree=function(a,b){for(var c,d=a.slice();c=d.pop();)for(var e=c.pos,f=c.ids,g=f[2],h=b(0===g.length,e,f[0],c.ctx,f[1]),i=0,j=g.length;i<j;i++)d.push({pos:e+1,ids:g[i],ctx:h})},l.collectLeaves=function(a){var b=[];return l.traverseRevTree(a,function(a,c,d,e,f){a&&b.push({rev:c+"-"+d,pos:c,opts:f})}),b.sort(function(a,b){return b.pos-a.pos}),b.forEach(function(a){delete a.pos}),b},l.collectConflicts=function(a){var b=l.winningRev(a),c=l.collectLeaves(a.rev_tree),d=[];return c.forEach(function(a){a.rev===b||a.opts.deleted||d.push(a.rev)}),d},l.rootToLeaf=function(a){var b=[];return l.traverseRevTree(a,function(a,c,d,e,f){if(e=e?e.slice(0):[],e.push({id:d,opts:f}),a){var g=c+1-e.length;b.unshift({pos:g,ids:e})}return e}),b},b.exports=l},{}],30:[function(a,b,c){"use strict";function d(a,b){a=parseInt(a,10),b=parseInt(b,10),a!==a&&(a=0),b!==b||b<=a?b=(a||1)<<1:b+=1;var c=Math.random(),d=b-a;return~~(d*c+a)}function e(a){var b=0;return a||(b=2e3),d(a,b)}function f(a,b,c,d,f,g,h){return d.retry===!1?(f.emit("error",h),f.removeAllListeners(),void 0):(d.default_back_off=d.default_back_off||0,d.retries=d.retries||0,"function"!=typeof d.back_off_function&&(d.back_off_function=e),d.retries++,d.max_retries&&d.retries>d.max_retries?(f.emit("error",new Error("tried "+d.retries+" times but replication failed")),f.removeAllListeners(),void 0):(f.emit("requestError",h),"active"===f.state&&(f.emit("paused",h),f.state="stopped",f.once("active",function(){d.current_back_off=d.default_back_off})),d.current_back_off=d.current_back_off||d.default_back_off,d.current_back_off=d.back_off_function(d.current_back_off),setTimeout(function(){i(a,b,c,d,f)},d.current_back_off),void 0))}function g(){m.call(this),this.cancelled=!1,this.state="pending";var a=this,b=new l.Promise(function(b,c){a.once("complete",b),a.once("error",c)});a.then=function(a,c){return b.then(a,c)},a.catch=function(a){return b.catch(a)},a.catch(function(){})}function h(a,b,c){var d=c.filter?c.filter.toString():"";return a.id().then(function(a){return b.id().then(function(b){var e=a+b+d+JSON.stringify(c.query_params)+c.doc_ids;return l.MD5(e).then(function(a){return a=a.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+a})})})}function i(a,b,c,d,e,g){function h(){if(0!==A.docs.length){var a=A.docs;return c.bulkDocs({docs:a,new_edits:!1}).then(function(b){if(M.cancelled)throw u(),new Error("cancelled");var c=[],d={};b.forEach(function(a){a.error&&(g.doc_write_failures++,c.push(a),d[a.id]=a)}),g.errors=c,O=O.concat(c),g.docs_written+=A.docs.length-c.length;var f=c.filter(function(a){return"unauthorized"!==a.name&&"forbidden"!==a.name});if(P=[],a.forEach(function(a){var b=d[a._id];b?e.emit("denied",l.clone(b)):P.push(a)}),f.length>0){var h=new Error("bulkDocs error");throw h.other_errors=c,t("target.bulkDocs failed to write docs",h),new Error("bulkWrite partial failure")}},function(b){throw g.doc_write_failures+=a.length,b})}}function i(a){for(var c=A.diffs,d=c[a].missing,e=[],f=0;f<d.length;f+=o)e.push(d.slice(f,Math.min(d.length,f+o)));return l.Promise.all(e.map(function(d){var e={revs:!0,open_revs:d,attachments:!0};return b.get(a,e).then(function(b){b.forEach(function(a){return M.cancelled?u():(a.ok&&(g.docs_read++,A.pendingRevs++,A.docs.push(a.ok)),void 0)}),delete c[a]})}))}function j(){var a=Object.keys(A.diffs);return l.Promise.all(a.map(i))}function k(){var a=Object.keys(A.diffs).filter(function(a){var b=A.diffs[a].missing;return 1===b.length&&"1-"===b[0].slice(0,2)});return a.length?b.allDocs({keys:a,include_docs:!0}).then(function(a){if(M.cancelled)throw u(),new Error("cancelled");a.rows.forEach(function(a){!a.doc||a.deleted||"1-"!==a.value.rev.slice(0,2)||a.doc._attachments&&0!==Object.keys(a.doc._attachments).length||(g.docs_read++,A.pendingRevs++,A.docs.push(a.doc),delete A.diffs[a.id])})}):l.Promise.resolve()}function m(){return k().then(j)}function p(){return D=!0,N.writeCheckpoint(A.seq).then(function(){if(D=!1,M.cancelled)throw u(),new Error("cancelled");g.last_seq=G=A.seq;var a=l.clone(g);a.docs=P,e.emit("change",a),A=void 0,y()}).catch(function(a){throw D=!1,t("writeCheckpoint completed with error",a),a})}function q(){var a={};return A.changes.forEach(function(b){a[b.id]=b.changes.map(function(a){return a.rev})}),c.revsDiff(a).then(function(a){if(M.cancelled)throw u(),new Error("cancelled");A.diffs=a,A.pendingRevs=0})}function r(){if(!M.cancelled&&!A){if(0===B.length)return s(!0),void 0;A=B.shift(),q().then(m).then(h).then(p).then(r).catch(function(a){t("batch processing terminated with error",a)})}}function s(a){return 0===C.changes.length?(0!==B.length||A||((H&&Q.live||E)&&(e.emit("paused"),e.emit("uptodate",g)),E&&u()),void 0):((a||E||C.changes.length>=I)&&(B.push(C),C={seq:0,changes:[],docs:[]},r()),void 0)}function t(a,b){F||(b.message||(b.message=a),g.ok=!1,g.status="aborting",g.errors.push(b),O=O.concat(b),B=[],C={seq:0,changes:[],docs:[]},u())}function u(){if(!(F||M.cancelled&&(g.status="cancelled",D))){g.status=g.status||"complete",g.end_time=new Date,g.last_seq=G,F=M.cancelled=!0;var h=O.filter(function(a){return"unauthorized"!==a.name&&"forbidden"!==a.name});if(h.length>0){var i=O.pop();O.length>0&&(i.other_errors=O),i.result=g,f(a,b,c,d,e,g,i)}else g.errors=O,e.emit("complete",g),e.removeAllListeners()}}function v(a){if(M.cancelled)return u();var b=l.filterChange(d)(a);b&&(0!==C.changes.length||0!==B.length||A||e.emit("outofdate",g),C.seq=a.seq,C.changes.push(a),s(0===B.length))}function w(a){return K=!1,M.cancelled?u():(a.results.length>0?(Q.since=a.last_seq,y()):H?(Q.live=!0,y()):E=!0,s(!0),void 0)}function x(a){return K=!1,M.cancelled?u():(t("changes rejected",a),void 0)}function y(){function a(){d.cancel()}function c(){e.removeListener("cancel",a)}if(!K&&!E&&B.length<J){K=!0,e.once("cancel",a);var d=b.changes(Q).on("change",v);d.then(c,c),d.then(w).catch(x)}}function z(){N.getCheckpoint().then(function(a){G=a,Q={since:G,limit:I,batch_size:I,style:"all_docs",doc_ids:L,returnDocs:!0},d.filter&&(Q.include_docs=!0),d.query_params&&(Q.query_params=d.query_params),y()}).catch(function(a){t("getCheckpoint rejected with ",a)})}var A,B=[],C={seq:0,changes:[],docs:[]},D=!1,E=!1,F=!1,G=0,H=d.continuous||d.live||!1,I=d.batch_size||100,J=d.batches_limit||10,K=!1,L=d.doc_ids,M={cancelled:!1},N=new n(b,c,a,M),O=[],P=[];g=g||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var Q={};e.ready(b,c),e.once("cancel",u),"function"==typeof d.onChange&&e.on("change",d.onChange),"function"==typeof d.complete&&(e.once("error",d.complete),e.once("complete",function(a){d.complete(null,a)})),"undefined"==typeof d.since?z():(D=!0,N.writeCheckpoint(d.since).then(function(){return D=!1,M.cancelled?(u(),void 0):(G=d.since,z(),void 0)}).catch(function(a){throw D=!1,t("writeCheckpoint completed with error",a),a}))}function j(a,b){var c=b.PouchConstructor;return"string"==typeof a?new c(a):a.then?a:l.Promise.resolve(a)}function k(a,b,c,d){"function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c.complete||(c.complete=d||function(){}),c=l.clone(c),c.continuous=c.continuous||c.live,c.retry="retry"in c?c.retry:p,c.PouchConstructor=c.PouchConstructor||this;var e=new g(c);return j(a,c).then(function(a){return j(b,c).then(function(b){return h(a,b,c).then(function(d){i(d,a,b,c,e)})})}).catch(function(a){e.emit("error",a),c.complete(a)}),e}var l=a(34),m=a(38).EventEmitter,n=a(14),o=50,p=!1;l.inherits(g,m),g.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},g.prototype.ready=function(a,b){function c(){e.cancel()}function d(){a.removeListener("destroyed",c),b.removeListener("destroyed",c)}var e=this;this.once("change",function(){"pending"!==this.state&&"stopped"!==this.state||(e.state="active",e.emit("active"))}),a.once("destroyed",c),b.once("destroyed",c),this.then(d,d)},c.toPouch=j,c.replicate=k},{}],31:[function(a,b,c){"use strict";var d=a(15),e=a(34),f=e.Promise,g=a(38).EventEmitter;d.adapters={},d.preferredAdapters=a(8),d.prefix="_pouch_";var h=new g,i=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"];i.forEach(function(a){d[a]=h[a].bind(h)}),d.setMaxListeners(0),d.parseAdapter=function(a,b){var c,f,g=a.match(/([a-z\-]*):\/\/(.*)/);if(g){if(a=/http(s?)/.test(g[1])?g[1]+"://"+g[2]:g[2],c=g[1],!d.adapters[c].valid())throw"Invalid adapter";return{name:a,adapter:g[1]}}var h="idb"in d.adapters&&"websql"in d.adapters&&e.hasLocalStorage()&&localStorage["_pouch__websqldb_"+d.prefix+a];if("undefined"!=typeof b&&b.db)f="leveldb";else for(var i=0;i<d.preferredAdapters.length;++i)if(f=d.preferredAdapters[i],f in d.adapters){if(h&&"idb"===f)continue;break}if(c=d.adapters[f],f&&c){var j=!("use_prefix"in c)||c.use_prefix;return{name:j?d.prefix+a:a,adapter:f}}throw"No valid adapter found"},d.destroy=e.toPromise(function(a,b,c){function g(){j.destroy(m,b,function(b,e){b?c(b):(d.emit("destroyed",a),d.emit(a,"destroyed"),c(null,e||{ok:!0}))})}"function"!=typeof b&&"undefined"!=typeof b||(c=b,b={}),a&&"object"==typeof a&&(b=a,a=void 0),b.internal||console.log("PouchDB.destroy() is deprecated and will be removed. Please use db.destroy() instead.");var h=d.parseAdapter(b.name||a,b),i=h.name,j=d.adapters[h.adapter],k=!("use_prefix"in j)||j.use_prefix,l=k?i.replace(new RegExp("^"+d.prefix),""):i,m=("http"===h.adapter||"https"===h.adapter?"":b.prefix||"")+i,n=e.extend(!0,{},b,{adapter:h.adapter});new d(l,n,function(a,h){return a?c(a):(h.get("_local/_pouch_dependentDbs",function(a,i){if(a)return 404!==a.status?c(a):g();var j=i.dependentDbs,l=Object.keys(j).map(function(a){var c=k?a.replace(new RegExp("^"+d.prefix),""):a,f=e.extend(!0,b,h.__opts||{});return h.constructor.destroy(c,f)});f.all(l).then(g,function(a){c(a)})}),void 0)})}),d.adapter=function(a,b){b.valid()&&(d.adapters[a]=b)},d.plugin=function(a){Object.keys(a).forEach(function(b){d.prototype[b]=a[b]})},d.defaults=function(a){function b(b,c,f){"function"!=typeof c&&"undefined"!=typeof c||(f=c,c={}),b&&"object"==typeof b&&(c=b,b=void 0),c=e.extend(!0,{},a,c),d.call(this,b,c,f)}return e.inherits(b,d),b.destroy=e.toPromise(function(b,c,f){return"function"!=typeof c&&"undefined"!=typeof c||(f=c,c={}),b&&"object"==typeof b&&(c=b,b=void 0),c=e.extend(!0,{},a,c),d.destroy(b,c,f)}),i.forEach(function(a){b[a]=h[a].bind(h)}),b.setMaxListeners(0),b.preferredAdapters=d.preferredAdapters.slice(),Object.keys(d).forEach(function(a){a in b||(b[a]=d[a])}),b},b.exports=d},{}],32:[function(a,b,c){"use strict";function d(a,b,c,d){return"function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c=f.clone(c),c.PouchConstructor=c.PouchConstructor||this,a=g.toPouch(a,c),b=g.toPouch(b,c),new e(a,b,c,d)}function e(a,b,c,d){function e(a){p||(p=!0,m.emit("cancel",a))}function g(a){m.emit("change",{direction:"pull",change:a})}function i(a){m.emit("change",{direction:"push",change:a})}function j(a){m.emit("denied",{direction:"push",doc:a})}function k(a){m.emit("denied",{direction:"pull",doc:a})}function l(a){return function(b,c){var d="change"===b&&(c===g||c===i),f="cancel"===b&&c===e,h=b in q&&c===q[b];(d||f||h)&&(b in r||(r[b]={}),r[b][a]=!0,2===Object.keys(r[b]).length&&m.removeAllListeners(b))}}var m=this;this.canceled=!1;var n,o;"onChange"in c&&(n=c.onChange,delete c.onChange),"function"!=typeof d||c.complete?"complete"in c&&(o=c.complete,delete c.complete):o=d,this.push=h(a,b,c),this.pull=h(b,a,c);var p=!1,q={},r={};c.live&&(this.push.on("complete",m.pull.cancel.bind(m.pull)),this.pull.on("complete",m.push.cancel.bind(m.push))),this.on("newListener",function(a){"change"===a?(m.pull.on("change",g),m.push.on("change",i)):"denied"===a?(m.pull.on("denied",k),m.push.on("denied",j)):"cancel"===a?(m.pull.on("cancel",e),m.push.on("cancel",e)):"error"===a||"removeListener"===a||"complete"===a||a in q||(q[a]=function(b){m.emit(a,b)},m.pull.on(a,q[a]),m.push.on(a,q[a]))}),this.on("removeListener",function(a){"change"===a?(m.pull.removeListener("change",g),m.push.removeListener("change",i)):"cancel"===a?(m.pull.removeListener("cancel",e),m.push.removeListener("cancel",e)):a in q&&"function"==typeof q[a]&&(m.pull.removeListener(a,q[a]),m.push.removeListener(a,q[a]),delete q[a])}),this.pull.on("removeListener",l("pull")),this.push.on("removeListener",l("push"));var s=f.Promise.all([this.push,this.pull]).then(function(a){var b={push:a[0],pull:a[1]};return m.emit("complete",b),o&&o(null,b),m.removeAllListeners(),b},function(a){throw m.cancel(),m.emit("error",a),o&&o(a),m.removeAllListeners(),a});this.then=function(a,b){return s.then(a,b)},this.catch=function(a){return s.catch(a)}}var f=a(34),g=a(30),h=g.replicate,i=a(38).EventEmitter;f.inherits(e,i),b.exports=d,e.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}},{}],33:[function(a,b,c){"use strict";function d(){this.isReady=!1,this.failed=!1,this.queue=[]}b.exports=d,d.prototype.execute=function(){var a,b;if(this.failed)for(;a=this.queue.shift();)"function"!=typeof a?(b=a.parameters[a.parameters.length-1],"function"==typeof b?b(this.failed):"changes"===a.name&&"function"==typeof b.complete&&b.complete(this.failed)):a(this.failed);else if(this.isReady)for(;a=this.queue.shift();)"function"==typeof a?a():a.task=this.db[a.name].apply(this.db,a.parameters)},d.prototype.fail=function(a){this.failed=a,this.execute()},d.prototype.ready=function(a){return!this.failed&&(0===arguments.length?this.isReady:(this.isReady=!!a,this.db=a,this.execute(),void 0))},d.prototype.addTask=function(a,b){if("function"!=typeof a){var c={name:a,parameters:b};return this.queue.push(c),this.failed&&this.execute(),c}this.queue.push(a),this.failed&&this.execute()}},{}],34:[function(a,b,c){(function(b,d){function e(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function f(){if(!(this instanceof f))return new f;var a=this;j.call(this),this.isChrome=e(),this.listeners={},this.hasLocal=!1,this.isChrome||(this.hasLocal=c.hasLocalStorage()),this.isChrome?chrome.storage.onChanged.addListener(function(b){null!=b.db_name&&a.emit(b.dbName.newValue)}):this.hasLocal&&("undefined"!=typeof addEventListener?addEventListener("storage",function(b){a.emit(b.key)}):window.attachEvent("storage",function(b){a.emit(b.key)}))}var g=a(29);c.extend=a(65),c.ajax=a(16),c.createBlob=a(17),c.uuid=a(26),c.getArguments=a(36);var h=a(18),i=a(19),j=a(38).EventEmitter,k=a(64);c.Map=k.Map,c.Set=k.Set;var l=a(21);"function"==typeof d.Promise?c.Promise=d.Promise:c.Promise=a(47);var m=c.Promise;c.lastIndexOf=function(a,b){for(var c=a.length-1;c>=0;c--)if(a.charAt(c)===b)return c;return-1},c.clone=function(a){return c.extend(!0,{},a)},c.pick=function(a,b){for(var c={},d=0,e=b.length;d<e;d++){var f=b[d];c[f]=a[f]}return c},c.inherits=a(43),c.call=c.getArguments(function(a){if(a.length){var b=a.shift();"function"==typeof b&&b.apply(this,a)}}),c.isLocalId=function(a){return/^_local/.test(a)},c.isDeleted=function(a,b){b||(b=g.winningRev(a));var c=b.indexOf("-");c!==-1&&(b=b.substring(c+1));var d=!1;return g.traverseRevTree(a.rev_tree,function(a,c,e,f,g){e===b&&(d=!!g.deleted)}),d},c.revExists=function(a,b){var c=!1;return g.traverseRevTree(a.rev_tree,function(a,d,e){d+"-"+e===b&&(c=!0)}),c},c.filterChange=function(a){var b={},c=a.filter&&"function"==typeof a.filter;return b.query=a.query_params,function(d){if(a.filter&&c&&!a.filter.call(this,d.doc,b))return!1;if(a.include_docs){if(!a.attachments)for(var e in d.doc._attachments)d.doc._attachments.hasOwnProperty(e)&&(d.doc._attachments[e].stub=!0)}else delete d.doc;return!0}},c.parseDoc=l.parseDoc,c.invalidIdError=l.invalidIdError,c.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},c.hasLocalStorage=function(){if(e())return!1;try{return localStorage}catch(a){return!1}},c.Changes=f,c.inherits(f,j),f.prototype.addListener=function(a,d,e,f){function g(){if(h.listeners[d]){if(i)return i="waiting",void 0;i=!0,e.changes({style:f.style,include_docs:f.include_docs,attachments:f.attachments,conflicts:f.conflicts,continuous:!1,descending:!1,filter:f.filter,doc_ids:f.doc_ids,view:f.view,since:f.since,query_params:f.query_params}).on("change",function(a){a.seq>f.since&&!f.cancelled&&(f.since=a.seq,c.call(f.onChange,a))}).on("complete",function(){
"waiting"===i&&b.nextTick(function(){h.notify(a)}),i=!1}).on("error",function(){i=!1})}}if(!this.listeners[d]){var h=this,i=!1;this.listeners[d]=g,this.on(a,g)}},f.prototype.removeListener=function(a,b){b in this.listeners&&j.prototype.removeListener.call(this,a,this.listeners[b])},f.prototype.notifyLocalWindows=function(a){this.isChrome?chrome.storage.local.set({dbName:a}):this.hasLocal&&(localStorage[a]="a"===localStorage[a]?"b":"a")},f.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)},"function"==typeof atob?c.atob=function(a){return atob(a)}:c.atob=function(a){var b=new h(a,"base64");if(b.toString("base64")!==a)throw"Cannot base64 encode full string";return b.toString("binary")},"function"==typeof btoa?c.btoa=function(a){return btoa(a)}:c.btoa=function(a){return new h(a,"binary").toString("base64")},c.fixBinary=function(a){if(!b.browser)return a;for(var c=a.length,d=new ArrayBuffer(c),e=new Uint8Array(d),f=0;f<c;f++)e[f]=a.charCodeAt(f);return d},c.readAsBinaryString=function(a,b){var d=new FileReader,e="function"==typeof d.readAsBinaryString;d.onloadend=function(a){var d=a.target.result||"";return e?b(d):(b(c.arrayBufferToBinaryString(d)),void 0)},e?d.readAsBinaryString(a):d.readAsArrayBuffer(a)},c.readAsArrayBuffer=function(a,b){var c=new FileReader;c.onloadend=function(a){var c=a.target.result||new ArrayBuffer(0);b(c)},c.readAsArrayBuffer(a)},c.once=function(a){var b=!1;return c.getArguments(function(c){if(b)throw new Error("once called  more than once");b=!0,a.apply(this,c)})},c.toPromise=function(a){return c.getArguments(function(d){var e,f=this,g="function"==typeof d[d.length-1]&&d.pop();g&&(e=function(a,c){b.nextTick(function(){g(a,c)})});var h=new m(function(b,e){var g;try{var h=c.once(function(a,c){a?e(a):b(c)});d.push(h),g=a.apply(f,d),g&&"function"==typeof g.then&&b(g)}catch(a){e(a)}});return e&&h.then(function(a){e(null,a)},e),h.cancel=function(){return this},h})},c.adapterFun=function(b,d){function e(a,b,c){if(f.enabled){for(var d=[a._db_name,b],e=0;e<c.length-1;e++)d.push(c[e]);f.apply(null,d);var g=c[c.length-1];c[c.length-1]=function(c,d){var e=[a._db_name,b];e=e.concat(c?["error",c]:["success",d]),f.apply(null,e),g(c,d)}}}var f=a(40)("pouchdb:api");return c.toPromise(c.getArguments(function(a){if(this._closed)return m.reject(new Error("database is closed"));var f=this;return e(f,b,a),this.taskqueue.isReady?d.apply(this,a):new c.Promise(function(c,d){f.taskqueue.addTask(function(e){e?d(e):c(f[b].apply(f,a))})})}))},c.arrayBufferToBinaryString=function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return b},c.cancellableFun=function(a,b,d){d=d?c.clone(!0,{},d):{};var e=new j,f=d.complete||function(){},g=d.complete=c.once(function(a,b){a?f(a):(e.emit("end",b),f(null,b)),e.removeAllListeners()}),h=d.onChange||function(){},i=0;b.on("destroyed",function(){e.removeAllListeners()}),d.onChange=function(a){h(a),a.seq<=i||(i=a.seq,e.emit("change",a),a.deleted?e.emit("delete",a):1===a.changes.length&&"1-"===a.changes[0].rev.slice(0,1)?e.emit("create",a):e.emit("update",a))};var k=new m(function(a,b){d.complete=function(c,d){c?b(c):a(d)}});return k.then(function(a){g(null,a)},g),k.cancel=function(){k.isCancelled=!0,b.taskqueue.isReady&&d.complete(null,{status:"cancelled"})},b.taskqueue.isReady?a(b,d,k):b.taskqueue.addTask(function(){k.isCancelled?d.complete(null,{status:"cancelled"}):a(b,d,k)}),k.on=e.on.bind(e),k.once=e.once.bind(e),k.addListener=e.addListener.bind(e),k.removeListener=e.removeListener.bind(e),k.removeAllListeners=e.removeAllListeners.bind(e),k.setMaxListeners=e.setMaxListeners.bind(e),k.listeners=e.listeners.bind(e),k.emit=e.emit.bind(e),k},c.MD5=c.toPromise(a(20)),c.explain404=function(a){b.browser&&"console"in d&&"info"in console&&console.info("The above 404 is totally normal. "+a)},c.info=function(a){"undefined"!=typeof console&&"info"in console&&console.info(a)},c.parseUri=a(23),c.compare=function(a,b){return a<b?-1:a>b?1:0},c.updateDoc=function(a,b,d,e,f,h,j){if(c.revExists(a,b.metadata.rev))return d[e]=b,f();var k=c.isDeleted(a),l=c.isDeleted(b.metadata),m=/^1-/.test(b.metadata.rev);if(k&&!l&&j&&m){var n=b.data;n._rev=g.winningRev(a),n._id=b.metadata.id,b=c.parseDoc(n,j)}var o=g.merge(a.rev_tree,b.metadata.rev_tree[0],1e3),p=j&&(k&&l||!k&&"new_leaf"!==o.conflicts||k&&!l&&"new_branch"===o.conflicts);if(p){var q=i.error(i.REV_CONFLICT);return d[e]=q,f()}var r=b.metadata.rev;b.metadata.rev_tree=o.tree,a.rev_map&&(b.metadata.rev_map=a.rev_map);var s=g.winningRev(b.metadata);l=c.isDeleted(b.metadata,s);var t=0;(j||s===r)&&(t=k===l?0:k<l?-1:1),h(b,s,l,f,!0,t,e)},c.processDocs=function(a,b,d,e,f,h,j,k){function l(a,b,d){var e=g.winningRev(a.metadata),k=c.isDeleted(a.metadata,e);if("was_delete"in j&&k)return f[b]=i.error(i.MISSING_DOC,"deleted"),d();var l=k?0:1;h(a,e,k,d,!1,l,b)}function m(){++p===q&&k&&k()}if(a.length){var n=j.new_edits,o=new c.Map,p=0,q=a.length;a.forEach(function(a,d){if(a._id&&c.isLocalId(a._id))return b[a._deleted?"_removeLocal":"_putLocal"](a,{ctx:e},function(a){a?f[d]=a:f[d]={ok:!0},m()}),void 0;var g=a.metadata.id;o.has(g)?(q--,o.get(g).push([a,d])):o.set(g,[[a,d]])}),o.forEach(function(a,b){function e(){++i<a.length?g():m()}function g(){var g=a[i],j=g[0],k=g[1];d.has(b)?c.updateDoc(d.get(b),j,f,k,e,h,n):l(j,k,e)}var i=0;g()})}},c.preprocessAttachments=function(a,b,d){function e(a){try{return c.atob(a)}catch(a){var b=i.error(i.BAD_ARG,"Attachments need to be base64 encoded");return{error:b}}}function f(a,d){if(a.stub)return d();if("string"==typeof a.data){var f=e(a.data);if(f.error)return d(f.error);a.length=f.length,"blob"===b?a.data=c.createBlob([c.fixBinary(f)],{type:a.content_type}):"base64"===b?a.data=c.btoa(f):a.data=f,c.MD5(f).then(function(b){a.digest="md5-"+b,d()})}else c.readAsArrayBuffer(a.data,function(e){"binary"===b?a.data=c.arrayBufferToBinaryString(e):"base64"===b&&(a.data=c.btoa(c.arrayBufferToBinaryString(e))),c.MD5(e).then(function(b){a.digest="md5-"+b,a.length=e.byteLength,d()})})}function g(){j++,a.length===j&&(h?d(h):d())}if(!a.length)return d();var h,j=0;a.forEach(function(a){function b(a){h=a,d++,d===c.length&&g()}var c=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],d=0;if(!c.length)return g();for(var e in a.data._attachments)a.data._attachments.hasOwnProperty(e)&&f(a.data._attachments[e],b)})},c.compactTree=function(a){var b=[];return g.traverseRevTree(a.rev_tree,function(a,c,d,e,f){"available"!==f.status||a||(b.push(c+"-"+d),f.status="missing")}),b};var n=a(74);c.safeJsonParse=function(a){try{return JSON.parse(a)}catch(b){return n.parse(a)}},c.safeJsonStringify=function(a){try{return JSON.stringify(a)}catch(b){return n.stringify(a)}}}).call(this,a(39),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){b.exports="3.3.3"},{}],36:[function(a,b,c){"use strict";function d(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=d},{}],37:[function(a,b,c){},{}],38:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[],b},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0,c}},{}],39:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],40:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?j.removeItem("debug"):j.debug=a}catch(a){}}function h(){var a;try{a=j.debug}catch(a){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a(41),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d;var j;j="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{}],41:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a(42),c.names=[],c.skips=[],c.formatters={};var j,k=0},{}],42:[function(a,b,c){function d(a){var b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"h":return c*j;case"minutes":case"minute":case"m":return c*i;case"seconds":case"second":case"s":return c*h;case"ms":return c}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b.long?f(a):e(a)}},{}],43:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],44:[function(a,b,c){"use strict";function d(){}b.exports=d},{}],45:[function(a,b,c){"use strict";function d(a){function b(a,b){function e(a){j[b]=a,++k===c&!d&&(d=!0,i.resolve(m,j))}g(a).then(e,function(a){d||(d=!0,i.reject(m,a))})}if("[object Array]"!==Object.prototype.toString.call(a))return f(new TypeError("must be an array"));var c=a.length,d=!1;if(!c)return g([]);for(var j=new Array(c),k=0,l=-1,m=new e(h);++l<c;)b(a[l],l);return m}var e=a(48),f=a(51),g=a(52),h=a(44),i=a(46);b.exports=d},{}],46:[function(a,b,c){"use strict";function d(a){var b=a&&a.then;if(a&&"object"==typeof a&&"function"==typeof b)return function(){b.apply(a,arguments)}}var e=a(55),f=a(53),g=a(54);c.resolve=function(a,b){var h=e(d,b);if("error"===h.status)return c.reject(a,h.value);var i=h.value;if(i)f.safely(a,i);else{a.state=g.FULFILLED,a.outcome=b;for(var j=-1,k=a.queue.length;++j<k;)a.queue[j].callFulfilled(b)}return a},c.reject=function(a,b){a.state=g.REJECTED,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a}},{}],47:[function(a,b,c){b.exports=c=a(48),c.resolve=a(52),c.reject=a(51),c.all=a(45),c.race=a(50)},{}],48:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=h.PENDING,this.queue=[],this.outcome=void 0,a!==f&&g.safely(this,a)}var e=a(56),f=a(44),g=a(53),h=a(54),i=a(49);b.exports=d,d.prototype.catch=function(a){return this.then(null,a)},d.prototype.then=function(a,b){if("function"!=typeof a&&this.state===h.FULFILLED||"function"!=typeof b&&this.state===h.REJECTED)return this;var c=new d(f);if(this.state!==h.PENDING){var g=this.state===h.FULFILLED?a:b;e(c,g,this.outcome)}else this.queue.push(new i(c,a,b));return c}},{}],49:[function(a,b,c){"use strict";function d(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}var e=a(46),f=a(56);b.exports=d,d.prototype.callFulfilled=function(a){e.resolve(this.promise,a)},d.prototype.otherCallFulfilled=function(a){f(this.promise,this.onFulfilled,a)},d.prototype.callRejected=function(a){e.reject(this.promise,a)},d.prototype.otherCallRejected=function(a){f(this.promise,this.onRejected,a)}},{}],50:[function(a,b,c){"use strict";function d(a){function b(a){g(a).then(function(a){d||(d=!0,i.resolve(k,a))},function(a){d||(d=!0,i.reject(k,a))})}if("[object Array]"!==Object.prototype.toString.call(a))return f(new TypeError("must be an array"));var c=a.length,d=!1;if(!c)return g([]);for(var j=-1,k=new e(h);++j<c;)b(a[j]);return k}var e=a(48),f=a(51),g=a(52),h=a(44),i=a(46);b.exports=d},{}],51:[function(a,b,c){"use strict";function d(a){var b=new e(f);return g.reject(b,a)}var e=a(48),f=a(44),g=a(46);b.exports=d},{}],52:[function(a,b,c){"use strict";function d(a){if(a)return a instanceof e?a:g.resolve(new e(f),a);var b=typeof a;switch(b){case"boolean":return h;case"undefined":return j;case"object":return i;case"number":return k;case"string":return l}}var e=a(48),f=a(44),g=a(46);b.exports=d;var h=g.resolve(new e(f),!1),i=g.resolve(new e(f),null),j=g.resolve(new e(f),void 0),k=g.resolve(new e(f),0),l=g.resolve(new e(f),"")},{}],53:[function(a,b,c){"use strict";function d(a,b){function c(b){h||(h=!0,e.reject(a,b))}function d(b){h||(h=!0,e.resolve(a,b))}function g(){b(d,c)}var h=!1,i=f(g);"error"===i.status&&c(i.value)}var e=a(46),f=a(55);c.safely=d},{}],54:[function(a,b,c){c.REJECTED=["REJECTED"],c.FULFILLED=["FULFILLED"],c.PENDING=["PENDING"]},{}],55:[function(a,b,c){"use strict";function d(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}b.exports=d},{}],56:[function(a,b,c){"use strict";function d(a,b,c){e(function(){var d;try{d=b(c)}catch(b){return f.reject(a,b)}d===a?f.reject(a,new TypeError("Cannot resolve promise with itself")):f.resolve(a,d)})}var e=a(57),f=a(46);b.exports=d},{}],57:[function(a,b,c){"use strict";function d(){f=!0;for(var a,b,c=i.length;c;){for(b=i,i=[],a=-1;++a<c;)b[a]();c=i.length}f=!1}function e(a){1!==i.push(a)||f||g()}for(var f,g,h=[a(37),a(59),a(58),a(60),a(61)],i=[],j=-1,k=h.length;++j<k;)if(h[j]&&h[j].test&&h[j].test()){g=h[j].install(d);break}b.exports=e},{}],58:[function(a,b,c){(function(a){"use strict";c.test=function(){return!a.setImmediate&&"undefined"!=typeof a.MessageChannel},c.install=function(b){var c=new a.MessageChannel;return c.port1.onmessage=b,function(){c.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],59:[function(a,b,c){(function(a){"use strict";var b=a.MutationObserver||a.WebKitMutationObserver;c.test=function(){return b},c.install=function(c){var d=0,e=new b(c),f=a.document.createTextNode("");return e.observe(f,{characterData:!0}),function(){f.data=d=++d%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],60:[function(a,b,c){(function(a){"use strict";c.test=function(){return"document"in a&&"onreadystatechange"in a.document.createElement("script")},c.install=function(b){return function(){var c=a.document.createElement("script");return c.onreadystatechange=function(){b(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},a.document.documentElement.appendChild(c),b}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],61:[function(a,b,c){"use strict";c.test=function(){return!0},c.install=function(a){return function(){setTimeout(a,0)}}},{}],62:[function(a,b,c){"use strict";function d(a){if(null!==a)switch(typeof a){case"boolean":return a?1:0;case"number":return k(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),d=b?a:Object.keys(a),e=-1,f=d.length,g="";if(b)for(;++e<f;)g+=c.toIndexableString(d[e]);else for(;++e<f;){var h=d[e];g+=c.toIndexableString(h)+c.toIndexableString(a[h])}return g}return""}function e(a,b){var c,d=b,e="1"===a[b];if(e)c=0,b++;else{var f="0"===a[b];b++;var g="",h=a.substring(b,b+m),i=parseInt(h,10)+l;for(f&&(i=-i),b+=m;;){var j=a[b];if("\0"===j)break;g+=j,b++}g=g.split("."),c=1===g.length?parseInt(g,10):parseFloat(g[0]+"."+g[1]),f&&(c-=10),0!==i&&(c=parseFloat(c+"e"+i))}return{num:c,length:b-d}}function f(a,b){var c=a.pop();if(b.length){var d=b[b.length-1];c===d.element&&(b.pop(),d=b[b.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(c);else if(f===a.length-2){var g=a.pop();e[g]=c}else a.push(c)}}function g(a,b){for(var d=Math.min(a.length,b.length),e=0;e<d;e++){var f=c.collate(a[e],b[e]);if(0!==f)return f}return a.length===b.length?0:a.length>b.length?1:-1}function h(a,b){return a===b?0:a>b?1:-1}function i(a,b){for(var d=Object.keys(a),e=Object.keys(b),f=Math.min(d.length,e.length),g=0;g<f;g++){var h=c.collate(d[g],e[g]);if(0!==h)return h;if(h=c.collate(a[d[g]],b[e[g]]),0!==h)return h}return d.length===e.length?0:d.length>e.length?1:-1}function j(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);return~c?null===a?1:Array.isArray(a)?5:c<3?c+2:c+3:Array.isArray(a)?5:void 0}function k(a){if(0===a)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=a<0,e=d?"0":"2",f=(d?-c:c)-l,g=o.padLeft(f.toString(),"0",m);e+=n+g;var h=Math.abs(parseFloat(b[0]));d&&(h=10-h);var i=h.toFixed(20);return i=i.replace(/\.?0+$/,""),e+=n+i,e}var l=-324,m=3,n="",o=a(63);c.collate=function(a,b){if(a===b)return 0;a=c.normalizeKey(a),b=c.normalizeKey(b);var d=j(a),e=j(b);if(d-e!==0)return d-e;if(null===a)return 0;switch(typeof a){case"number":return a-b;case"boolean":return a===b?0:a<b?-1:1;case"string":return h(a,b)}return Array.isArray(a)?g(a,b):i(a,b)},c.normalizeKey=function(a){switch(typeof a){case"undefined":return null;case"number":return a===1/0||a===-(1/0)||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var d=a.length;a=new Array(d);for(var e=0;e<d;e++)a[e]=c.normalizeKey(b[e])}else{if(a instanceof Date)return a.toJSON();if(null!==a){a={};for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];"undefined"!=typeof g&&(a[f]=c.normalizeKey(g))}}}}return a},c.toIndexableString=function(a){var b="\0";return a=c.normalizeKey(a),j(a)+n+d(a)+b},c.parseIndexableString=function(a){for(var b=[],c=[],d=0;;){var g=a[d++];if("\0"!==g)switch(g){case"1":b.push(null);break;case"2":b.push("1"===a[d]),d++;break;case"3":var h=e(a,d);b.push(h.num),d+=h.length;break;case"4":for(var i="";;){var j=a[d];if("\0"===j)break;i+=j,d++}i=i.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),b.push(i);break;case"5":var k={element:[],index:b.length};b.push(k.element),c.push(k);break;case"6":var l={element:{},index:b.length};b.push(l.element),c.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+g)}else{if(1===b.length)return b.pop();f(b,c)}}}},{}],63:[function(a,b,c){"use strict";function d(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}c.padLeft=function(a,b,c){var e=d(a,b,c);return e+a},c.padRight=function(a,b,c){var e=d(a,b,c);return a+e},c.stringLexCompare=function(a,b){var c,d=a.length,e=b.length;for(c=0;c<d;c++){if(c===e)return 1;var f=a.charAt(c),g=b.charAt(c);if(f!==g)return f<g?-1:1}return d<e?-1:0},c.intToDecimalForm=function(a){var b=a<0,c="";do{var d=b?-Math.ceil(a%10):Math.floor(a%10);c=d+c,a=b?Math.ceil(a/10):Math.floor(a/10)}while(a);return b&&"0"!==c&&(c="-"+c),c}},{}],64:[function(a,b,c){"use strict";function d(){this.store={}}function e(a){if(this.store=new d,a&&Array.isArray(a))for(var b=0,c=a.length;b<c;b++)this.add(a[b])}c.Map=d,c.Set=e,d.prototype.mangle=function(a){if("string"!=typeof a)throw new TypeError("key must be a string but Got "+a);return"$"+a},d.prototype.unmangle=function(a){return a.substring(1)},d.prototype.get=function(a){var b=this.mangle(a);return b in this.store?this.store[b]:void 0},d.prototype.set=function(a,b){var c=this.mangle(a);return this.store[c]=b,!0},d.prototype.has=function(a){var b=this.mangle(a);return b in this.store},d.prototype.delete=function(a){var b=this.mangle(a);return b in this.store&&(delete this.store[b],!0)},d.prototype.forEach=function(a){var b=this,c=Object.keys(b.store);c.forEach(function(c){var d=b.store[c];c=b.unmangle(c),a(d,c)})},e.prototype.add=function(a){return this.store.set(a,!0)},e.prototype.has=function(a){return this.store.has(a)},e.prototype.delete=function(a){return this.store.delete(a)}},{}],65:[function(a,b,c){function d(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||jQuery.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(jQuery.isPlainObject(d)||(e=jQuery.isArray(d)))?(e?(e=!1,f=c&&jQuery.isArray(c)?c:[]):f=c&&jQuery.isPlainObject(c)?c:{},g[b]=jQuery.extend(j,f,d)):void 0!==d&&(g[b]=d));return g}function e(a){return null===a?String(a):"object"==typeof a||"function"==typeof a?k[o.call(a)]||"object":typeof a}function f(a){return null!==a&&a===a.window}function g(a){if(!a||"object"!==e(a)||a.nodeType||f(a))return!1;try{if(a.constructor&&!p.call(a,"constructor")&&!p.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(a){return!1}var b;for(b in a);return void 0===b||p.call(a,b)}function h(a){return"function"===e(a)}function i(){for(var a=[],b=-1,c=arguments.length,d=new Array(c);++b<c;)d[b]=arguments[b];var e={};a.push({args:d,result:{container:e,key:"key"}});for(var f;f=a.shift();)j(a,f.args,f.result);return e.key}function j(a,b,c){var d,e,f,i,j,k,l,m=b[0]||{},n=1,o=b.length,p=!1,r=/^(0|[1-9]\d{0,9})$/;for("boolean"==typeof m&&(p=m,m=b[1]||{},n=2),"object"==typeof m||h(m)||(m={}),o===n&&(m=this,--n);n<o;n++)if(null!=(d=b[n])){l=q(d);for(e in d)if(!(e in Object.prototype)){if(l&&!r.test(e))continue;if(f=m[e],i=d[e],m===i)continue;p&&i&&(g(i)||(j=q(i)))?(j?(j=!1,k=f&&q(f)?f:[]):k=f&&g(f)?f:{},m[e]=null,a.push({args:[p,k,i],result:{container:m,key:e}})):void 0!==i&&(q(d)&&h(i)||(m[e]=i))}}c.container[c.key]=m}for(var k={},l=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],m=0;m<l.length;m++){var n=l[m];k["[object "+n+"]"]=n.toLowerCase()}var o=k.toString,p=k.hasOwnProperty,q=Array.isArray||function(a){return"array"===e(a)};/Firefox/.test(navigator.userAgent)?b.exports=d:b.exports=i},{}],66:[function(a,b,c){"use strict";var d=a(70),e=a(71),f=e.Promise;b.exports=function(a){var b=a.db,c=a.viewName,g=a.map,h=a.reduce,i=a.temporary,j=g.toString()+(h&&h.toString())+"undefined";if(!i&&b._cachedViews){var k=b._cachedViews[j];if(k)return f.resolve(k)}return b.info().then(function(a){function f(a){a.views=a.views||{};var b=c;b.indexOf("/")===-1&&(b=c+"/"+c);var d=a.views[b]=a.views[b]||{};if(!d[k])return d[k]=!0,a}var k=a.db_name+"-mrview-"+(i?"temp":e.MD5(j));return d(b,"_local/mrviews",f).then(function(){return b.registerDependentDatabase(k).then(function(a){var c=a.db;c.auto_compaction=!0;var d={name:k,db:c,sourceDB:b,adapter:b.adapter,mapFun:g,reduceFun:h};return d.db.get("_local/lastSeq").catch(function(a){if(404!==a.status)throw a}).then(function(a){return d.seq=a?a.seq:0,i||(b._cachedViews=b._cachedViews||{},b._cachedViews[j]=d,d.db.on("destroyed",function(){delete b._cachedViews[j]})),d})})})})}},{}],67:[function(_dereq_,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func.replace(/;\s*$/,"")+");")}},{}],68:[function(a,b,c){(function(b){"use strict";function d(a){return a.indexOf("/")===-1?[a,a]:a.split("/")}function e(a){return 1===a.length&&/^1-/.test(a[0].rev)}function f(a,b,c){try{return{output:b.apply(null,c)}}catch(b){return a.emit("error",b),{error:b}}}function g(a,b){var c=F(a.key,b.key);return 0!==c?c:F(a.value,b.value)}function h(a,b,c){return c=c||0,"number"==typeof b?a.slice(c,b+c):c>0?a.slice(c):a}function i(a){var b=a.value,c=b&&"object"==typeof b&&b._id||a.id;return c}function j(a){var b=new Error("builtin "+a+" function requires map values to be numbers or number arrays");return b.name="invalid_value",b.status=500,b}function k(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];if("number"!=typeof e){if(!Array.isArray(e))throw j("_sum");b="number"==typeof b?[b]:b;for(var f=0,g=e.length;f<g;f++){var h=e[f];if("number"!=typeof h)throw j("_sum");"undefined"==typeof b[f]?b.push(h):b[f]+=h}}else"number"==typeof b?b+=e:b[0]+=e}return b}function l(a,b,c,d){var e=b[a];"undefined"!=typeof e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function m(a,b){var c=a.descending?"endkey":"startkey",d=a.descending?"startkey":"endkey";if("undefined"!=typeof a[c]&&"undefined"!=typeof a[d]&&F(a[c],a[d])>0)throw new A("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(b.reduce&&a.reduce!==!1){if(a.include_docs)throw new A("{include_docs:true} is invalid for reduce");if(a.keys&&a.keys.length>1&&!a.group&&!a.group_level)throw new A("Multi-key fetches for reduce views must use {group: true}")}if(a.group_level){if("number"!=typeof a.group_level)throw new A('Invalid value for integer: "'+a.group_level+'"');if(a.group_level<0)throw new A('Invalid value for positive integer: "'+a.group_level+'"')}}function n(a,b,c){var e,f=[],g="GET";if(l("reduce",c,f),l("include_docs",c,f),l("attachments",c,f),l("limit",c,f),l("descending",c,f),l("group",c,f),l("group_level",c,f),l("skip",c,f),l("stale",c,f),l("conflicts",c,f),l("startkey",c,f,!0),l("endkey",c,f,!0),l("inclusive_end",c,f),l("key",c,f,!0),f=f.join("&"),f=""===f?"":"?"+f,"undefined"!=typeof c.keys){var h=2e3,i="keys="+encodeURIComponent(JSON.stringify(c.keys));i.length+f.length+1<=h?f+=("?"===f[0]?"&":"?")+i:(g="POST","string"==typeof b?e=JSON.stringify({keys:c.keys}):b.keys=c.keys)}if("string"==typeof b){var j=d(b);return a.request({method:g,url:"_design/"+j[0]+"/_view/"+j[1]+f,body:e})}return e=e||{},Object.keys(b).forEach(function(a){Array.isArray(b[a])?e[a]=b[a]:e[a]=b[a].toString()}),a.request({method:"POST",url:"_temp_view"+f,body:e})}function o(a){return function(b){if(404===b.status)return a;throw b}}function p(a,b,c){function d(){return e(l)?L.resolve(i):b.db.get(h).catch(o(i))}function f(a){return a.keys.length?b.db.allDocs({keys:a.keys,include_docs:!0}):L.resolve({rows:[]
})}function g(a,b){for(var c=[],d={},e=0,f=b.rows.length;e<f;e++){var g=b.rows[e],h=g.doc;if(h&&(c.push(h),d[h._id]=!0,h._deleted=!k[h._id],!h._deleted)){var i=k[h._id];"value"in i&&(h.value=i.value)}}var j=Object.keys(k);return j.forEach(function(a){if(!d[a]){var b={_id:a},e=k[a];"value"in e&&(b.value=e.value),c.push(b)}}),a.keys=K.uniq(j.concat(a.keys)),c.push(a),c}var h="_local/doc_"+a,i={_id:h,keys:[]},j=c[a],k=j.indexableKeysToKeyValues,l=j.changes;return d().then(function(a){return f(a).then(function(b){return g(a,b)})})}function q(a,b,c){var d="_local/lastSeq";return a.db.get(d).catch(o({_id:d,seq:0})).then(function(d){var e=Object.keys(b);return L.all(e.map(function(c){return p(c,a,b)})).then(function(b){var e=K.flatten(b);return d.seq=c,e.push(d),a.db.bulkDocs({docs:e})})})}function r(a){var b="string"==typeof a?a:a.name,c=M[b];return c||(c=M[b]=new E),c}function s(a){return K.sequentialize(r(a),function(){return t(a)})()}function t(a){function b(a,b){var c={id:e._id,key:H(a)};"undefined"!=typeof b&&null!==b&&(c.value=H(b)),d.push(c)}function c(b,c){return function(){return q(a,b,c)}}var d,e,h;if("function"==typeof a.mapFun&&2===a.mapFun.length){var i=a.mapFun;h=function(a){return i(a,b)}}else h=J(a.mapFun.toString(),b,k,C,Array.isArray,JSON.parse);var j=a.seq||0,l=new E;return new L(function(b,i){function k(){l.finish().then(function(){a.seq=j,b()})}function m(){function b(a){i(a)}a.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:j,limit:O}).on("complete",function(b){var i=b.results;if(!i.length)return k();for(var n={},o=0,p=i.length;o<p;o++){var q=i[o];if("_"!==q.doc._id[0]){d=[],e=q.doc,e._deleted||f(a.sourceDB,h,[e]),d.sort(g);for(var r,s={},t=0,u=d.length;t<u;t++){var v=d[t],w=[v.key,v.id];v.key===r&&w.push(t);var x=G(w);s[x]=v,r=v.key}n[q.doc._id]={indexableKeysToKeyValues:s,changes:q.changes}}j=q.seq}return l.add(c(n,j)),i.length<O?k():m()}).on("error",b)}m()})}function u(a,b,c){0===c.group_level&&delete c.group_level;var d,e=c.group||c.group_level;d=P[a.reduceFun]?P[a.reduceFun]:J(a.reduceFun.toString(),null,k,C,Array.isArray,JSON.parse);var g=[],i=c.group_level;b.forEach(function(a){var b=g[g.length-1],c=e?a.key:null;return e&&Array.isArray(c)&&"number"==typeof i&&(c=c.length>i?c.slice(0,i):c),b&&0===F(b.key[0][0],c)?(b.key.push([c,a.id]),b.value.push(a.value),void 0):(g.push({key:[[c,a.id]],value:[a.value]}),void 0)});for(var j=0,l=g.length;j<l;j++){var m=g[j],n=f(a.sourceDB,d,[m.key,m.value,!1]);m.value=n.error?null:n.output,m.key=m.key[0][0]}return{rows:h(g,c.limit,c.skip)}}function v(a,b){return K.sequentialize(r(a),function(){return w(a,b)})()}function w(a,b){function c(b){return b.include_docs=!0,a.db.allDocs(b).then(function(a){return e=a.total_rows,a.rows.map(function(a){if("value"in a.doc&&"object"==typeof a.doc.value&&null!==a.doc.value){var b=Object.keys(a.doc.value).sort(),c=["id","key","value"];if(!(b<c||b>c))return a.doc.value}var d=D.parseIndexableString(a.doc._id);return{key:d[0],id:d[1],value:"value"in a.doc?a.doc.value:null}})})}function d(c){var d;if(d=f?u(a,c,b):{total_rows:e,offset:g,rows:c},b.include_docs){var h=K.uniq(c.map(i));return a.sourceDB.allDocs({keys:h,include_docs:!0,conflicts:b.conflicts,attachments:b.attachments}).then(function(a){var b={};return a.rows.forEach(function(a){a.doc&&(b["$"+a.id]=a.doc)}),c.forEach(function(a){var c=i(a),d=b["$"+c];d&&(a.doc=d)}),d})}return d}var e,f=a.reduceFun&&b.reduce!==!1,g=b.skip||0;"undefined"==typeof b.keys||b.keys.length||(b.limit=0,delete b.keys);var h=function(a){return a.reduce(function(a,b){return a.concat(b)})};if("undefined"!=typeof b.keys){var j=b.keys,k=j.map(function(a){var b={startkey:G([a]),endkey:G([a,{}])};return c(b)});return L.all(k).then(h).then(d)}var l={descending:b.descending};if("undefined"!=typeof b.startkey&&(l.startkey=G(b.descending?[b.startkey,{}]:[b.startkey])),"undefined"!=typeof b.endkey){var m=b.inclusive_end!==!1;b.descending&&(m=!m),l.endkey=G(m?[b.endkey,{}]:[b.endkey])}if("undefined"!=typeof b.key){var n=G([b.key]),o=G([b.key,{}]);l.descending?(l.endkey=n,l.startkey=o):(l.startkey=n,l.endkey=o)}return f||("number"==typeof b.limit&&(l.limit=b.limit),l.skip=g),c(l).then(d)}function x(a){return a.request({method:"POST",url:"_view_cleanup"})}function y(a){return a.get("_local/mrviews").then(function(b){var c={};Object.keys(b.views).forEach(function(a){var b=d(a),e="_design/"+b[0],f=b[1];c[e]=c[e]||{},c[e][f]=!0});var e={keys:Object.keys(c),include_docs:!0};return a.allDocs(e).then(function(d){var e={};d.rows.forEach(function(a){var d=a.key.substring(8);Object.keys(c[a.key]).forEach(function(c){var f=d+"/"+c;b.views[f]||(f=c);var g=Object.keys(b.views[f]),h=a.doc&&a.doc.views&&a.doc.views[c];g.forEach(function(a){e[a]=e[a]||h})})});var f=Object.keys(e).filter(function(a){return!e[a]}),g=f.map(function(b){return K.sequentialize(r(b),function(){return a.constructor.destroy(b,a.__opts)})()});return L.all(g).then(function(){return{ok:!0}})})},o({ok:!0}))}function z(a,c,e){if("http"===a.type())return n(a,c,e);if("string"!=typeof c){m(e,c);var f={db:a,viewName:"temp_view/temp_view",map:c.map,reduce:c.reduce,temporary:!0};return N.add(function(){return I(f).then(function(a){function b(){return a.db.destroy()}return K.fin(s(a).then(function(){return v(a,e)}),b)})}),N.finish()}var g=c,h=d(g),i=h[0],j=h[1];return a.get("_design/"+i).then(function(c){var d=c.views&&c.views[j];if(!d||"string"!=typeof d.map)throw new B("ddoc "+i+" has no view named "+j);m(e,d);var f={db:a,viewName:g,map:d.map,reduce:d.reduce};return I(f).then(function(a){return"ok"===e.stale||"update_after"===e.stale?("update_after"===e.stale&&b.nextTick(function(){s(a)}),v(a,e)):s(a).then(function(){return v(a,e)})})})}function A(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,A)}catch(a){}}function B(a){this.status=404,this.name="not_found",this.message=a,this.error=!0;try{Error.captureStackTrace(this,B)}catch(a){}}var C,D=a(62),E=a(69),F=D.collate,G=D.toIndexableString,H=D.normalizeKey,I=a(66),J=a(67);C="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var K=a(71),L=K.Promise,M={},N=new E,O=50,P={_sum:function(a,b){return k(b)},_count:function(a,b){return b.length},_stats:function(a,b){function c(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];b+=e*e}return b}return{sum:k(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:c(b)}}};c.viewCleanup=K.callbackify(function(){var a=this;return"http"===a.type()?x(a):y(a)}),c.query=function(a,b,c){"function"==typeof b&&(c=b,b={}),b=K.extend(!0,{},b),"function"==typeof a&&(a={map:a});var d=this,e=L.resolve().then(function(){return z(d,a,b)});return K.promisedCallback(e,c),e},K.inherits(A,Error),K.inherits(B,Error)}).call(this,a(39))},{}],69:[function(a,b,c){"use strict";function d(){this.promise=new e(function(a){a()})}var e=a(71).Promise;d.prototype.add=function(a){return this.promise=this.promise.catch(function(){}).then(function(){return a()}),this.promise},d.prototype.finish=function(){return this.promise},b.exports=d},{}],70:[function(a,b,c){"use strict";var d=a(72).upsert;b.exports=function(a,b,c){return d.apply(a,[b,c])}},{}],71:[function(a,b,c){(function(b,d){"use strict";"function"==typeof d.Promise?c.Promise=d.Promise:c.Promise=a(47),c.inherits=a(43),c.extend=a(65);var e=a(36);c.promisedCallback=function(a,c){return c&&a.then(function(a){b.nextTick(function(){c(null,a)})},function(a){b.nextTick(function(){c(a)})}),a},c.callbackify=function(a){return e(function(b){var d=b.pop(),e=a.apply(this,b);return"function"==typeof d&&c.promisedCallback(e,d),e})},c.fin=function(a,b){return a.then(function(a){var c=b();return"function"==typeof c.then?c.then(function(){return a}):a},function(a){var c=b();if("function"==typeof c.then)return c.then(function(){throw a});throw a})},c.sequentialize=function(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}},c.flatten=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b=b.concat(a[c]);return b},c.uniq=function(a){for(var b={},c=0,d=a.length;c<d;c++)b["$"+a[c]]=!0;var e=Object.keys(b),f=new Array(e.length);for(c=0,d=e.length;c<d;c++)f[c]=e[c].substring(1);return f};var f=a(37),g=a(73);c.MD5=function(a){return b.browser?g.hash(a):f.createHash("md5").update(a).digest("hex")}}).call(this,a(39),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],72:[function(a,b,c){(function(b){"use strict";function d(a,b,c){return new f(function(d,f){return"string"!=typeof b?f(new Error("doc id is required")):(a.get(b,function(g,h){if(g){if(404!==g.status)return f(g);h={}}var i=c(h);return i?(i._id=b,i._rev=h._rev,d(e(a,i,c)),void 0):d({updated:!1,rev:h._rev})}),void 0)})}function e(a,b,c){return a.put(b).then(function(a){return{updated:!0,rev:a.rev}},function(e){if(409!==e.status)throw e;return d(a,b._id,c)})}var f;f="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof b.Promise?b.Promise:a(47),c.upsert=function(a,b,c){var e=this,f=d(e,a,b);return"function"!=typeof c?f:(f.then(function(a){c(null,a)},c),void 0)},c.putIfNotExists=function(a,b,c){var e=this;"string"!=typeof a&&(c=b,b=a,a=b._id);var f=function(a){return!a._rev&&b},g=d(e,a,f);return"function"!=typeof c?g:(g.then(function(a){c(null,a)},c),void 0)},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(c)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],73:[function(a,b,c){!function(a){if("object"==typeof c)b.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var d;try{d=window}catch(a){d=self}d.SparkMD5=a()}}(function(a){"use strict";var b=function(a,b){return a+b&4294967295},c=function(a,c,d,e,f,g){return c=b(b(c,a),b(e,g)),b(c<<f|c>>>32-f,d)},d=function(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)},e=function(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)},f=function(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)},g=function(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)},h=function(a,c){var h=a[0],i=a[1],j=a[2],k=a[3];h=d(h,i,j,k,c[0],7,-680876936),k=d(k,h,i,j,c[1],12,-389564586),j=d(j,k,h,i,c[2],17,606105819),i=d(i,j,k,h,c[3],22,-1044525330),h=d(h,i,j,k,c[4],7,-176418897),k=d(k,h,i,j,c[5],12,1200080426),j=d(j,k,h,i,c[6],17,-1473231341),i=d(i,j,k,h,c[7],22,-45705983),h=d(h,i,j,k,c[8],7,1770035416),k=d(k,h,i,j,c[9],12,-1958414417),j=d(j,k,h,i,c[10],17,-42063),i=d(i,j,k,h,c[11],22,-1990404162),h=d(h,i,j,k,c[12],7,1804603682),k=d(k,h,i,j,c[13],12,-40341101),j=d(j,k,h,i,c[14],17,-1502002290),i=d(i,j,k,h,c[15],22,1236535329),h=e(h,i,j,k,c[1],5,-165796510),k=e(k,h,i,j,c[6],9,-1069501632),j=e(j,k,h,i,c[11],14,643717713),i=e(i,j,k,h,c[0],20,-373897302),h=e(h,i,j,k,c[5],5,-701558691),k=e(k,h,i,j,c[10],9,38016083),j=e(j,k,h,i,c[15],14,-660478335),i=e(i,j,k,h,c[4],20,-405537848),h=e(h,i,j,k,c[9],5,568446438),k=e(k,h,i,j,c[14],9,-1019803690),j=e(j,k,h,i,c[3],14,-187363961),i=e(i,j,k,h,c[8],20,1163531501),h=e(h,i,j,k,c[13],5,-1444681467),k=e(k,h,i,j,c[2],9,-51403784),j=e(j,k,h,i,c[7],14,1735328473),i=e(i,j,k,h,c[12],20,-1926607734),h=f(h,i,j,k,c[5],4,-378558),k=f(k,h,i,j,c[8],11,-2022574463),j=f(j,k,h,i,c[11],16,1839030562),i=f(i,j,k,h,c[14],23,-35309556),h=f(h,i,j,k,c[1],4,-1530992060),k=f(k,h,i,j,c[4],11,1272893353),j=f(j,k,h,i,c[7],16,-155497632),i=f(i,j,k,h,c[10],23,-1094730640),h=f(h,i,j,k,c[13],4,681279174),k=f(k,h,i,j,c[0],11,-358537222),j=f(j,k,h,i,c[3],16,-722521979),i=f(i,j,k,h,c[6],23,76029189),h=f(h,i,j,k,c[9],4,-640364487),k=f(k,h,i,j,c[12],11,-421815835),j=f(j,k,h,i,c[15],16,530742520),i=f(i,j,k,h,c[2],23,-995338651),h=g(h,i,j,k,c[0],6,-198630844),k=g(k,h,i,j,c[7],10,1126891415),j=g(j,k,h,i,c[14],15,-1416354905),i=g(i,j,k,h,c[5],21,-57434055),h=g(h,i,j,k,c[12],6,1700485571),k=g(k,h,i,j,c[3],10,-1894986606),j=g(j,k,h,i,c[10],15,-1051523),i=g(i,j,k,h,c[1],21,-2054922799),h=g(h,i,j,k,c[8],6,1873313359),k=g(k,h,i,j,c[15],10,-30611744),j=g(j,k,h,i,c[6],15,-1560198380),i=g(i,j,k,h,c[13],21,1309151649),h=g(h,i,j,k,c[4],6,-145523070),k=g(k,h,i,j,c[11],10,-1120210379),j=g(j,k,h,i,c[2],15,718787259),i=g(i,j,k,h,c[9],21,-343485551),a[0]=b(h,a[0]),a[1]=b(i,a[1]),a[2]=b(j,a[2]),a[3]=b(k,a[3])},i=function(a){var b,c=[];for(b=0;b<64;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c},j=function(a){var b,c=[];for(b=0;b<64;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},k=function(a){var b,c,d,e,f,g,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;b<=j;b+=64)h(k,i(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;b<c;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(h(k,d),b=0;b<16;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),g=parseInt(e[1],16)||0,d[14]=f,d[15]=g,h(k,d),k},l=function(a){var b,c,d,e,f,g,i=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;b<=i;b+=64)h(k,j(a.subarray(b-64,b)));for(a=b-64<i?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;b<c;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(h(k,d),b=0;b<16;b+=1)d[b]=0;return e=8*i,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),g=parseInt(e[1],16)||0,d[14]=f,d[15]=g,h(k,d),k},m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=function(a){var b,c="";for(b=0;b<4;b+=1)c+=m[a>>8*b+4&15]+m[a>>8*b&15];return c},o=function(a){var b;for(b=0;b<a.length;b+=1)a[b]=n(a[b]);return a.join("")},p=function(a){return o(k(a))},q=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==p("hello")&&(b=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),q.prototype.append=function(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),this.appendBinary(a),this},q.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;b<=c;b+=64)h(this._state,i(this._buff.substring(b-64,b)));return this._buff=this._buff.substr(b-64),this},q.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<e;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=a?this._state:o(this._state),this.reset(),c},q.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(h(this._state,a),f=0;f<16;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,h(this._state,a)},q.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},q.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},q.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=k(a);return b?c:o(c)},q.hashBinary=function(a,b){var c=k(a);return b?c:o(c)},q.ArrayBuffer=function(){this.reset()},q.ArrayBuffer.prototype.append=function(a){var b,c=this._concatArrayBuffer(this._buff,a),d=c.length;for(this._length+=a.byteLength,b=64;b<=d;b+=64)h(this._state,j(c.subarray(b-64,b)));return this._buff=b-64<d?c.subarray(b-64):new Uint8Array(0),this},q.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<e;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=a?this._state:o(this._state),this.reset(),c},q.ArrayBuffer.prototype._finish=q.prototype._finish,q.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},q.ArrayBuffer.prototype.destroy=q.prototype.destroy,q.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);return d.set(a),d.set(new Uint8Array(b),c),d},q.ArrayBuffer.hash=function(a,b){var c=l(new Uint8Array(a));return b?c:o(c)},q})},{}],74:[function(a,b,c){"use strict";function d(a,b,c){var d=c[c.length-1];a===d.element&&(c.pop(),d=c[c.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(a);else if(f===b.length-2){var g=b.pop();e[g]=a}else b.push(a)}c.stringify=function(a){var b=[];b.push({obj:a});for(var c,d,e,f,g,h,i,j,k,l,m,n="";c=b.pop();)if(d=c.obj,e=c.prefix||"",f=c.val||"",n+=e,f)n+=f;else if("object"!=typeof d)n+="undefined"==typeof d?null:JSON.stringify(d);else if(null===d)n+="null";else if(Array.isArray(d)){for(b.push({val:"]"}),g=d.length-1;g>=0;g--)h=0===g?"":",",b.push({obj:d[g],prefix:h});b.push({val:"["})}else{i=[];for(j in d)d.hasOwnProperty(j)&&i.push(j);for(b.push({val:"}"}),g=i.length-1;g>=0;g--)k=i[g],l=d[k],m=g>0?",":"",m+=JSON.stringify(k)+":",b.push({obj:l,prefix:m});b.push({val:"{"})}return n},c.parse=function(a){for(var b,c,e,f,g,h,i,j,k,l=[],m=[],n=0;;)if(b=a[n++],"}"!==b&&"]"!==b&&"undefined"!=typeof b)switch(b){case" ":case"\t":case"\n":case":":case",":break;case"n":n+=3,d(null,l,m);break;case"t":n+=3,d(!0,l,m);break;case"f":n+=4,d(!1,l,m);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(c="",n--;;){if(e=a[n++],!/[\d\.\-e\+]/.test(e)){n--;break}c+=e}d(parseFloat(c),l,m);break;case'"':for(f="",g=void 0,h=0;;){if(i=a[n++],'"'===i&&("\\"!==g||h%2!==1))break;f+=i,g=i,"\\"===g?h++:h=0}d(JSON.parse('"'+f+'"'),l,m);break;case"[":j={element:[],index:l.length},l.push(j.element),m.push(j);break;case"{":k={element:{},index:l.length},l.push(k.element),m.push(k);break;default:throw new Error("unexpectedly reached end of input: "+b)}else{if(1===l.length)return l.pop();d(l.pop(),l,m)}}},{}],75:[function(a,b,c){(function(c){"use strict";var d=a(31);b.exports=d,d.ajax=a(16),d.utils=a(34),d.Errors=a(19),d.replicate=a(30).replicate,d.sync=a(32),d.version=a(35);var e=a(2);if(d.adapter("http",e),d.adapter("https",e),d.adapter("idb",a(7)),d.adapter("websql",a(12)),d.plugin(a(68)),!c.browser){var f=a(37);d.adapter("ldb",f),d.adapter("leveldb",f)}}).call(this,a(39))},{}]},{},[75])(75)});