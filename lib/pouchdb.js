/*PouchDB 7.0.0 (c) 2012-2018 Dale Harvey and the PouchDB team*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.PouchDB=a()}}(function(){var a;return function(){function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}return a}()({1:[function(a,b,c){"use strict";function d(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=d},{}],2:[function(a,b,c){function d(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=v(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function e(a){return void 0===a._maxListeners?d.defaultMaxListeners:a._maxListeners}function f(a,b,c){if(b)a.call(c);else for(var d=a.length,e=q(a,d),f=0;f<d;++f)e[f].call(c)}function g(a,b,c,d){if(b)a.call(c,d);else for(var e=a.length,f=q(a,e),g=0;g<e;++g)f[g].call(c,d)}function h(a,b,c,d,e){if(b)a.call(c,d,e);else for(var f=a.length,g=q(a,f),h=0;h<f;++h)g[h].call(c,d,e)}function i(a,b,c,d,e,f){if(b)a.call(c,d,e,f);else for(var g=a.length,h=q(a,g),i=0;i<g;++i)h[i].call(c,d,e,f)}function j(a,b,c,d){if(b)a.apply(c,d);else for(var e=a.length,f=q(a,e),g=0;g<e;++g)f[g].apply(c,d)}function k(a,b,c,d){var f,g,h;if("function"!=typeof c)throw new TypeError('"listener" argument must be a function');if(g=a._events,g?(g.newListener&&(a.emit("newListener",b,c.listener?c.listener:c),g=a._events),h=g[b]):(g=a._events=v(null),a._eventsCount=0),h){if("function"==typeof h?h=g[b]=d?[c,h]:[h,c]:d?h.unshift(c):h.push(c),!h.warned&&(f=e(a),f&&f>0&&h.length>f)){h.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+h.length+' "'+String(b)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');i.name="MaxListenersExceededWarning",i.emitter=a,i.type=b,i.count=h.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",i.name,i.message)}}else h=g[b]=c,++a._eventsCount;return a}function l(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var a=new Array(arguments.length),b=0;b<a.length;++b)a[b]=arguments[b];this.listener.apply(this.target,a)}}function m(a,b,c){var d={fired:!1,wrapFn:void 0,target:a,type:b,listener:c},e=x.call(l,d);return e.listener=c,d.wrapFn=e,e}function n(a,b,c){var d=a._events;if(!d)return[];var e=d[b];return e?"function"==typeof e?c?[e.listener||e]:[e]:c?r(e):q(e,e.length):[]}function o(a){var b=this._events;if(b){var c=b[a];if("function"==typeof c)return 1;if(c)return c.length}return 0}function p(a,b){for(var c=b,d=c+1,e=a.length;d<e;c+=1,d+=1)a[c]=a[d];a.pop()}function q(a,b){for(var c=new Array(b),d=0;d<b;++d)c[d]=a[d];return c}function r(a){for(var b=new Array(a.length),c=0;c<b.length;++c)b[c]=a[c].listener||a[c];return b}function s(a){var b=function(){};return b.prototype=a,new b}function t(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return c}function u(a){var b=this;return function(){return b.apply(a,arguments)}}var v=Object.create||s,w=Object.keys||t,x=Function.prototype.bind||u;b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0;var y,z=10;try{var A={};Object.defineProperty&&Object.defineProperty(A,"x",{value:0}),y=0===A.x}catch(a){y=!1}y?Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return z},set:function(a){if("number"!=typeof a||a<0||a!==a)throw new TypeError('"defaultMaxListeners" must be a positive number');z=a}}):d.defaultMaxListeners=z,d.prototype.setMaxListeners=function(a){if("number"!=typeof a||a<0||isNaN(a))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=a,this},d.prototype.getMaxListeners=function(){return e(this)},d.prototype.emit=function(a){var b,c,d,e,k,l,m="error"===a;if(l=this._events,l)m=m&&null==l.error;else if(!m)return!1;if(m){if(arguments.length>1&&(b=arguments[1]),b instanceof Error)throw b;var n=new Error('Unhandled "error" event. ('+b+")");throw n.context=b,n}if(c=l[a],!c)return!1;var o="function"==typeof c;switch(d=arguments.length,d){case 1:f(c,o,this);break;case 2:g(c,o,this,arguments[1]);break;case 3:h(c,o,this,arguments[1],arguments[2]);break;case 4:i(c,o,this,arguments[1],arguments[2],arguments[3]);break;default:for(e=new Array(d-1),k=1;k<d;k++)e[k-1]=arguments[k];j(c,o,this,e)}return!0},d.prototype.addListener=function(a,b){return k(this,a,b,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(a,b){return k(this,a,b,!0)},d.prototype.once=function(a,b){if("function"!=typeof b)throw new TypeError('"listener" argument must be a function');return this.on(a,m(this,a,b)),this},d.prototype.prependOnceListener=function(a,b){if("function"!=typeof b)throw new TypeError('"listener" argument must be a function');return this.prependListener(a,m(this,a,b)),this},d.prototype.removeListener=function(a,b){var c,d,e,f,g;if("function"!=typeof b)throw new TypeError('"listener" argument must be a function');if(d=this._events,!d)return this;if(c=d[a],!c)return this;if(c===b||c.listener===b)0===--this._eventsCount?this._events=v(null):(delete d[a],d.removeListener&&this.emit("removeListener",a,c.listener||b));else if("function"!=typeof c){for(e=-1,f=c.length-1;f>=0;f--)if(c[f]===b||c[f].listener===b){g=c[f].listener,e=f;break}if(e<0)return this;0===e?c.shift():p(c,e),1===c.length&&(d[a]=c[0]),d.removeListener&&this.emit("removeListener",a,g||b)}return this},d.prototype.removeAllListeners=function(a){var b,c,d;if(c=this._events,!c)return this;if(!c.removeListener)return 0===arguments.length?(this._events=v(null),this._eventsCount=0):c[a]&&(0===--this._eventsCount?this._events=v(null):delete c[a]),this;if(0===arguments.length){var e,f=w(c);for(d=0;d<f.length;++d)e=f[d],"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events=v(null),this._eventsCount=0,this}if(b=c[a],"function"==typeof b)this.removeListener(a,b);else if(b)for(d=b.length-1;d>=0;d--)this.removeListener(a,b[d]);return this},d.prototype.listeners=function(a){return n(this,a,!0)},d.prototype.rawListeners=function(a){return n(this,a,!1)},d.listenerCount=function(a,b){return"function"==typeof a.listenerCount?a.listenerCount(b):o.call(a,b)},d.prototype.listenerCount=o,d.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],3:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],5:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],6:[function(b,c,d){!function(b){if("object"==typeof d)c.exports=b();else if("function"==typeof a&&a.amd)a(b);else{var e;try{e=window}catch(a){e=self}e.SparkMD5=b()}}(function(a){"use strict";function b(a,b){var c=a[0],d=a[1],e=a[2],f=a[3];c+=(d&e|~d&f)+b[0]-680876936|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[1]-389564586|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[2]+606105819|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[3]-1044525330|0,d=(d<<22|d>>>10)+e|0,c+=(d&e|~d&f)+b[4]-176418897|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[5]+1200080426|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[6]-1473231341|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[7]-45705983|0,d=(d<<22|d>>>10)+e|0,c+=(d&e|~d&f)+b[8]+1770035416|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[9]-1958414417|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[10]-42063|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[11]-1990404162|0,d=(d<<22|d>>>10)+e|0,c+=(d&e|~d&f)+b[12]+1804603682|0,c=(c<<7|c>>>25)+d|0,f+=(c&d|~c&e)+b[13]-40341101|0,f=(f<<12|f>>>20)+c|0,e+=(f&c|~f&d)+b[14]-1502002290|0,e=(e<<17|e>>>15)+f|0,d+=(e&f|~e&c)+b[15]+1236535329|0,d=(d<<22|d>>>10)+e|0,c+=(d&f|e&~f)+b[1]-165796510|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[6]-1069501632|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[11]+643717713|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[0]-373897302|0,d=(d<<20|d>>>12)+e|0,c+=(d&f|e&~f)+b[5]-701558691|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[10]+38016083|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[15]-660478335|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[4]-405537848|0,d=(d<<20|d>>>12)+e|0,c+=(d&f|e&~f)+b[9]+568446438|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[14]-1019803690|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[3]-187363961|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[8]+1163531501|0,d=(d<<20|d>>>12)+e|0,c+=(d&f|e&~f)+b[13]-1444681467|0,c=(c<<5|c>>>27)+d|0,f+=(c&e|d&~e)+b[2]-51403784|0,f=(f<<9|f>>>23)+c|0,e+=(f&d|c&~d)+b[7]+1735328473|0,e=(e<<14|e>>>18)+f|0,d+=(e&c|f&~c)+b[12]-1926607734|0,d=(d<<20|d>>>12)+e|0,c+=(d^e^f)+b[5]-378558|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[8]-2022574463|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[11]+1839030562|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[14]-35309556|0,d=(d<<23|d>>>9)+e|0,c+=(d^e^f)+b[1]-1530992060|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[4]+1272893353|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[7]-155497632|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[10]-1094730640|0,d=(d<<23|d>>>9)+e|0,c+=(d^e^f)+b[13]+681279174|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[0]-358537222|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[3]-722521979|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[6]+76029189|0,d=(d<<23|d>>>9)+e|0,c+=(d^e^f)+b[9]-640364487|0,c=(c<<4|c>>>28)+d|0,f+=(c^d^e)+b[12]-421815835|0,f=(f<<11|f>>>21)+c|0,e+=(f^c^d)+b[15]+530742520|0,e=(e<<16|e>>>16)+f|0,d+=(e^f^c)+b[2]-995338651|0,d=(d<<23|d>>>9)+e|0,c+=(e^(d|~f))+b[0]-198630844|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[7]+1126891415|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[14]-1416354905|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[5]-57434055|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[12]+1700485571|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[3]-1894986606|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[10]-1051523|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[1]-2054922799|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[8]+1873313359|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[15]-30611744|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[6]-1560198380|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[13]+1309151649|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[4]-145523070|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[11]-1120210379|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[2]+718787259|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[9]-343485551|0,d=(d<<21|d>>>11)+e|0,a[0]=c+a[0]|0,a[1]=d+a[1]|0,a[2]=e+a[2]|0,a[3]=f+a[3]|0}function c(a){var b,c=[];for(b=0;b<64;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function d(a){var b,c=[];for(b=0;b<64;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c}function e(a){var d,e,f,g,h,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(d=64;d<=j;d+=64)b(k,c(a.substring(d-64,d)));for(a=a.substring(d-64),e=a.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0;d<e;d+=1)f[d>>2]|=a.charCodeAt(d)<<(d%4<<3);if(f[d>>2]|=128<<(d%4<<3),d>55)for(b(k,f),d=0;d<16;d+=1)f[d]=0;return g=8*j,g=g.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(g[2],16),i=parseInt(g[1],16)||0,f[14]=h,f[15]=i,b(k,f),k}function f(a){var c,e,f,g,h,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(c=64;c<=j;c+=64)b(k,d(a.subarray(c-64,c)));for(a=c-64<j?a.subarray(c-64):new Uint8Array(0),e=a.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0;c<e;c+=1)f[c>>2]|=a[c]<<(c%4<<3);if(f[c>>2]|=128<<(c%4<<3),c>55)for(b(k,f),c=0;c<16;c+=1)f[c]=0;return g=8*j,g=g.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(g[2],16),i=parseInt(g[1],16)||0,f[14]=h,f[15]=i,b(k,f),k}function g(a){var b,c="";for(b=0;b<4;b+=1)c+=p[a>>8*b+4&15]+p[a>>8*b&15];return c}function h(a){var b;for(b=0;b<a.length;b+=1)a[b]=g(a[b]);return a.join("")}function i(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),a}function j(a,b){var c,d=a.length,e=new ArrayBuffer(d),f=new Uint8Array(e);for(c=0;c<d;c+=1)f[c]=a.charCodeAt(c);return b?f:e}function k(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function l(a,b,c){var d=new Uint8Array(a.byteLength+b.byteLength);return d.set(new Uint8Array(a)),d.set(new Uint8Array(b),a.byteLength),c?d:d.buffer}function m(a){var b,c=[],d=a.length;for(b=0;b<d-1;b+=2)c.push(parseInt(a.substr(b,2),16));return String.fromCharCode.apply(String,c)}function n(){this.reset()}var o=function(a,b){return a+b&4294967295},p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==h(e("hello"))&&(o=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function b(a,b){return a=0|a||0,a<0?Math.max(a+b,0):Math.min(a,b)}ArrayBuffer.prototype.slice=function(c,d){var e,f,g,h,i=this.byteLength,j=b(c,i),k=i;return d!==a&&(k=b(d,i)),j>k?new ArrayBuffer(0):(e=k-j,f=new ArrayBuffer(e),g=new Uint8Array(f),h=new Uint8Array(this,j,e),g.set(h),f)}}(),n.prototype.append=function(a){return this.appendBinary(i(a)),this},n.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var d,e=this._buff.length;for(d=64;d<=e;d+=64)b(this._hash,c(this._buff.substring(d-64,d)));return this._buff=this._buff.substring(d-64),this},n.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<e;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=h(this._hash),a&&(c=m(c)),this.reset(),c},n.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},n.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},n.prototype.setState=function(a){return this._buff=a.buff,this._length=a.length,this._hash=a.hash,this},n.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},n.prototype._finish=function(a,c){var d,e,f,g=c;if(a[g>>2]|=128<<(g%4<<3),g>55)for(b(this._hash,a),g=0;g<16;g+=1)a[g]=0;d=8*this._length,d=d.toString(16).match(/(.*?)(.{0,8})$/),e=parseInt(d[2],16),f=parseInt(d[1],16)||0,a[14]=e,a[15]=f,b(this._hash,a)},n.hash=function(a,b){return n.hashBinary(i(a),b)},n.hashBinary=function(a,b){var c=e(a),d=h(c);return b?m(d):d},n.ArrayBuffer=function(){this.reset()},n.ArrayBuffer.prototype.append=function(a){var c,e=l(this._buff.buffer,a,!0),f=e.length;for(this._length+=a.byteLength,c=64;c<=f;c+=64)b(this._hash,d(e.subarray(c-64,c)));return this._buff=c-64<f?new Uint8Array(e.buffer.slice(c-64)):new Uint8Array(0),this},n.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<e;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=h(this._hash),a&&(c=m(c)),this.reset(),c},n.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},n.ArrayBuffer.prototype.getState=function(){var a=n.prototype.getState.call(this);return a.buff=k(a.buff),a},n.ArrayBuffer.prototype.setState=function(a){return a.buff=j(a.buff,!0),n.prototype.setState.call(this,a)},n.ArrayBuffer.prototype.destroy=n.prototype.destroy,n.ArrayBuffer.prototype._finish=n.prototype._finish,n.ArrayBuffer.hash=function(a,b){var c=f(new Uint8Array(a)),d=h(c);return b?m(d):d},n})},{}],7:[function(a,b,c){var d=a(10),e=a(11),f=e;f.v1=d,f.v4=e,b.exports=f},{10:10,11:11}],8:[function(a,b,c){function d(a,b){var c=b||0,d=e;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}for(var e=[],f=0;f<256;++f)e[f]=(f+256).toString(16).substr(1);b.exports=d},{}],9:[function(a,b,c){var d="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(d){var e=new Uint8Array(16);b.exports=function(){return d(e),e}}else{var f=new Array(16);b.exports=function(){for(var a,b=0;b<16;b++)0===(3&b)&&(a=4294967296*Math.random()),f[b]=a>>>((3&b)<<3)&255;return f}}},{}],10:[function(a,b,c){function d(a,b,c){var d=b&&c||0,k=b||[];a=a||{};var l=a.node||e,m=void 0!==a.clockseq?a.clockseq:f;if(null==l||null==m){var n=g();null==l&&(l=e=[1|n[0],n[1],n[2],n[3],n[4],n[5]]),null==m&&(m=f=16383&(n[6]<<8|n[7]))}var o=void 0!==a.msecs?a.msecs:(new Date).getTime(),p=void 0!==a.nsecs?a.nsecs:j+1,q=o-i+(p-j)/1e4;if(q<0&&void 0===a.clockseq&&(m=m+1&16383),(q<0||o>i)&&void 0===a.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");i=o,j=p,f=m,o+=122192928e5;var r=(1e4*(268435455&o)+p)%4294967296;k[d++]=r>>>24&255,k[d++]=r>>>16&255,k[d++]=r>>>8&255,k[d++]=255&r;var s=o/4294967296*1e4&268435455;k[d++]=s>>>8&255,k[d++]=255&s,k[d++]=s>>>24&15|16,k[d++]=s>>>16&255,k[d++]=m>>>8|128,k[d++]=255&m;for(var t=0;t<6;++t)k[d+t]=l[t];return b?b:h(k)}var e,f,g=a(9),h=a(8),i=0,j=0;b.exports=d},{8:8,9:9}],11:[function(a,b,c){function d(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new Array(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;++h)b[d+h]=g[h];return b||f(g)}var e=a(9),f=a(8);b.exports=d},{8:8,9:9}],12:[function(a,b,c){"use strict";function d(a,b,c){var d=c[c.length-1];a===d.element&&(c.pop(),d=c[c.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(a);else if(f===b.length-2){var g=b.pop();e[g]=a}else b.push(a)}c.stringify=function(a){var b=[];b.push({obj:a});for(var c,d,e,f,g,h,i,j,k,l,m,n="";c=b.pop();)if(d=c.obj,e=c.prefix||"",f=c.val||"",n+=e,f)n+=f;else if("object"!=typeof d)n+="undefined"==typeof d?null:JSON.stringify(d);else if(null===d)n+="null";else if(Array.isArray(d)){for(b.push({val:"]"}),g=d.length-1;g>=0;g--)h=0===g?"":",",b.push({obj:d[g],prefix:h});b.push({val:"["})}else{i=[];for(j in d)d.hasOwnProperty(j)&&i.push(j);for(b.push({val:"}"}),g=i.length-1;g>=0;g--)k=i[g],l=d[k],m=g>0?",":"",m+=JSON.stringify(k)+":",b.push({obj:l,prefix:m});b.push({val:"{"})}return n},c.parse=function(a){for(var b,c,e,f,g,h,i,j,k,l=[],m=[],n=0;;)if(b=a[n++],"}"!==b&&"]"!==b&&"undefined"!=typeof b)switch(b){case" ":case"\t":case"\n":case":":case",":break;case"n":n+=3,d(null,l,m);break;case"t":n+=3,d(!0,l,m);break;case"f":n+=4,d(!1,l,m);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(c="",n--;;){if(e=a[n++],!/[\d\.\-e\+]/.test(e)){n--;break}c+=e}d(parseFloat(c),l,m);break;case'"':for(f="",g=void 0,h=0;;){if(i=a[n++],'"'===i&&("\\"!==g||h%2!==1))break;f+=i,g=i,"\\"===g?h++:h=0}d(JSON.parse('"'+f+'"'),l,m);break;case"[":j={element:[],index:l.length},l.push(j.element),m.push(j);break;case"{":k={element:{},index:l.length},l.push(k.element),m.push(k);break;default:throw new Error("unexpectedly reached end of input: "+b)}else{if(1===l.length)return l.pop();d(l.pop(),l,m)}}},{}],13:[function(a,b,c){(function(c,d){"use strict";function e(a){return a&&"object"==typeof a&&"default"in a?a.default:a}function f(a){return"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer||"undefined"!=typeof Blob&&a instanceof Blob}function g(a){if("function"==typeof a.slice)return a.slice(0);var b=new ArrayBuffer(a.byteLength),c=new Uint8Array(b),d=new Uint8Array(a);return c.set(d),b}function h(a){if(a instanceof ArrayBuffer)return g(a);var b=a.size,c=a.type;return"function"==typeof a.slice?a.slice(0,b,c):a.webkitSlice(0,b,c)}function i(a){var b=Object.getPrototypeOf(a);if(null===b)return!0;var c=b.constructor;return"function"==typeof c&&c instanceof c&&Kd.call(c)==Ld}function j(a){var b,c,d;if(!a||"object"!=typeof a)return a;if(Array.isArray(a)){for(b=[],c=0,d=a.length;c<d;c++)b[c]=j(a[c]);return b}if(a instanceof Date)return a.toISOString();if(f(a))return h(a);if(!i(a))return a;b={};for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var e=j(a[c]);"undefined"!=typeof e&&(b[c]=e)}return b}function k(a){var b=!1;return Dd(function(c){if(b)throw new Error("once called more than once");b=!0,a.apply(this,c)})}function l(a){return Dd(function(b){b=j(b);var c=this,d="function"==typeof b[b.length-1]&&b.pop(),e=new Promise(function(d,e){var f;try{var g=k(function(a,b){a?e(a):d(b)});b.push(g),f=a.apply(c,b),f&&"function"==typeof f.then&&d(f)}catch(a){e(a)}});return d&&e.then(function(a){d(null,a)},d),e})}function m(a,b,c){if(a.constructor.listeners("debug").length){for(var d=["api",a.name,b],e=0;e<c.length-1;e++)d.push(c[e]);a.constructor.emit("debug",d);var f=c[c.length-1];c[c.length-1]=function(c,d){var e=["api",a.name,b];e=e.concat(c?["error",c]:["success",d]),a.constructor.emit("debug",e),f(c,d)}}}function n(a,b){return l(Dd(function(c){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var d=this;return m(d,a,c),this.taskqueue.isReady?b.apply(this,c):new Promise(function(b,e){d.taskqueue.addTask(function(f){f?e(f):b(d[a].apply(d,c))})})}))}function o(a){return"$"+a}function p(a){return a.substring(1)}function q(){this._store={}}function r(a){if(this._store=new q,a&&Array.isArray(a))for(var b=0,c=a.length;b<c;b++)this.add(a[b])}function s(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var a=Object.getOwnPropertyDescriptor(Map,Symbol.species);return a&&"get"in a&&Map[Symbol.species]===Map}function t(a,b){for(var c={},d=0,e=b.length;d<e;d++){var f=b[d];f in a&&(c[f]=a[f])}return c}function u(a){return a}function v(a){return[{ok:a}]}function w(a,b,c){function d(){var a=[];m.forEach(function(b){b.docs.forEach(function(c){a.push({id:b.id,docs:[c]})})}),c(null,{results:a})}function e(){++l===k&&d()}function f(a,b,c){m[a]={id:b,docs:c},e()}function g(){if(!(o>=n.length)){var a=Math.min(o+Pd,n.length),b=n.slice(o,a);h(b,o),o+=b.length}}function h(c,d){c.forEach(function(c,e){var h=d+e,i=j.get(c),k=t(i[0],["atts_since","attachments"]);k.open_revs=i.map(function(a){return a.rev}),k.open_revs=k.open_revs.filter(u);var l=u;0===k.open_revs.length&&(delete k.open_revs,l=v),["revs","attachments","binary","ajax","latest"].forEach(function(a){a in b&&(k[a]=b[a])}),a.get(c,k,function(a,b){var d;d=a?[{error:a}]:l(b),f(h,c,d),g()})})}var i=b.docs,j=new Nd;i.forEach(function(a){j.has(a.id)?j.get(a.id).push(a):j.set(a.id,[a])});var k=j.size,l=0,m=new Array(k),n=[];j.forEach(function(a,b){n.push(b)});var o=0;g()}function x(){return Od}function y(a){x()&&addEventListener("storage",function(b){a.emit(b.key)})}function z(){Fd.EventEmitter.call(this),this._listeners={},y(this)}function A(a){if("undefined"!=typeof console&&"function"==typeof console[a]){var b=Array.prototype.slice.call(arguments,1);console[a].apply(console,b)}}function B(a,b){var c=6e5;a=parseInt(a,10)||0,b=parseInt(b,10),b!==b||b<=a?b=(a||1)<<1:b+=1,b>c&&(a=c>>1,b=c);var d=Math.random(),e=b-a;return~~(e*d+a)}function C(a){var b=0;return a||(b=2e3),B(a,b)}function D(a,b){A("info","The above "+a+" is totally normal. "+b)}function E(a,b,c){Error.call(this,c),this.status=a,this.name=b,this.message=c,this.error=!0}function F(a,b){function c(b){for(var c in a)"function"!=typeof a[c]&&(this[c]=a[c]);void 0!==b&&(this.reason=b)}return c.prototype=E.prototype,new c(b)}function G(a){if("object"!=typeof a){var b=a;a=Yd,a.data=b}return"error"in a&&"conflict"===a.error&&(a.name="conflict",a.status=409),"name"in a||(a.name=a.error||"unknown"),"status"in a||(a.status=500),"message"in a||(a.message=a.message||a.reason),a}function H(a,b,c){try{return!a(b,c)}catch(a){var d="Filter function threw: "+a.toString();return F(ae,d)}}function I(a){var b={},c=a.filter&&"function"==typeof a.filter;return b.query=a.query_params,function(d){d.doc||(d.doc={});var e=c&&H(a.filter,d.doc,b);if("object"==typeof e)return e;if(e)return!1;if(a.include_docs){if(!a.attachments)for(var f in d.doc._attachments)d.doc._attachments.hasOwnProperty(f)&&(d.doc._attachments[f].stub=!0)}else delete d.doc;return!0}}function J(a){for(var b=[],c=0,d=a.length;c<d;c++)b=b.concat(a[c]);return b}function K(a){var b;if(a?"string"!=typeof a?b=F(Vd):/^_/.test(a)&&!/^_(design|local)/.test(a)&&(b=F(Xd)):b=F(Wd),b)throw b}function L(a){return"boolean"==typeof a._remote?a._remote:"function"==typeof a.type&&(A("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===a.type())}function M(a,b){return"listenerCount"in a?a.listenerCount(b):Fd.EventEmitter.listenerCount(a,b)}function N(a){if(!a)return null;var b=a.split("/");return 2===b.length?b:1===b.length?[a,a]:null}function O(a){var b=N(a);return b?b.join("/"):null}function P(a){for(var b=ie.exec(a),c={},d=14;d--;){var e=fe[d],f=b[d]||"",g=["user","password"].indexOf(e)!==-1;c[e]=g?decodeURIComponent(f):f}return c[ge]={},c[fe[12]].replace(he,function(a,b,d){b&&(c[ge][b]=d)}),c}function Q(a,b){var c=[],d=[];for(var e in b)b.hasOwnProperty(e)&&(c.push(e),d.push(b[e]));return c.push(a),Function.apply(null,c).apply(null,d)}function R(a,b,c){return new Promise(function(d,e){a.get(b,function(f,g){if(f){if(404!==f.status)return e(f);g={}}var h=g._rev,i=c(g);return i?(i._id=b,i._rev=h,d(S(a,i,c)),void 0):d({updated:!1,rev:h})})})}function S(a,b,c){return a.put(b).then(function(a){return{updated:!0,rev:a.rev}},function(d){if(409!==d.status)throw d;return R(a,b._id,c)})}function T(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(f){if("TypeError"!==f.name)throw f;for(var c="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,d=new c,e=0;e<a.length;e+=1)d.append(a[e]);return d.getBlob(b.type)}}function U(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function V(a,b){return T([U(a)],{type:b})}function W(a,b){return V(je(a),b)}function X(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return b}function Y(a,b){var c=new FileReader,d="function"==typeof c.readAsBinaryString;c.onloadend=function(a){var c=a.target.result||"";return d?b(c):(b(X(c)),void 0)},d?c.readAsBinaryString(a):c.readAsArrayBuffer(a)}function Z(a,b){Y(a,function(a){b(a)})}function $(a,b){Z(a,function(a){b(ke(a))})}function _(a,b){var c=new FileReader;c.onloadend=function(a){var c=a.target.result||new ArrayBuffer(0);b(c)},c.readAsArrayBuffer(a)}function aa(a){return ke(a)}function ba(a,b,c){return a.webkitSlice?a.webkitSlice(b,c):a.slice(b,c)}function ca(a,b,c,d,e){(c>0||d<b.size)&&(b=ba(b,c,d)),_(b,function(b){a.append(b),e()})}function da(a,b,c,d,e){(c>0||d<b.length)&&(b=b.substring(c,d)),a.appendBinary(b),e()}function ea(a,b){function c(){le(e)}function d(){var a=k.end(!0),c=aa(a);b(c),k.destroy()}function e(){var b=j*h,e=b+h;j++,j<i?l(k,a,b,e,c):l(k,a,b,e,d)}var f="string"==typeof a,g=f?a.length:a.size,h=Math.min(me,g),i=Math.ceil(g/h),j=0,k=f?new Hd:new Hd.ArrayBuffer,l=f?da:ca;e()}function fa(a){return Hd.hash(a)}function ga(a,b){var c=j(a);return b?(delete c._rev_tree,fa(JSON.stringify(c))):Id.v4().replace(/-/g,"").toLowerCase()}function ha(a){for(var b,c,d,e,f=a.rev_tree.slice();e=f.pop();){var g=e.ids,h=g[2],i=e.pos;if(h.length)for(var j=0,k=h.length;j<k;j++)f.push({pos:i+1,ids:h[j]});else{var l=!!g[1].deleted,m=g[0];b&&!(d!==l?d:c!==i?c<i:b<m)||(b=m,c=i,d=l)}}return c+"-"+b}function ia(a,b){for(var c,d=a.slice();c=d.pop();)for(var e=c.pos,f=c.ids,g=f[2],h=b(0===g.length,e,f[0],c.ctx,f[1]),i=0,j=g.length;i<j;i++)d.push({pos:e+1,ids:g[i],ctx:h})}function ja(a,b){return a.pos-b.pos}function ka(a){var b=[];ia(a,function(a,c,d,e,f){a&&b.push({rev:c+"-"+d,pos:c,opts:f})}),b.sort(ja).reverse();for(var c=0,d=b.length;c<d;c++)delete b[c].pos;return b}function la(a){for(var b=ha(a),c=ka(a.rev_tree),d=[],e=0,f=c.length;e<f;e++){var g=c[e];g.rev===b||g.opts.deleted||d.push(g.rev)}return d}function ma(a){var b=[];return ia(a.rev_tree,function(a,c,d,e,f){"available"!==f.status||a||(b.push(c+"-"+d),f.status="missing")}),b}function na(a){for(var b,c=[],d=a.slice();b=d.pop();){var e=b.pos,f=b.ids,g=f[0],h=f[1],i=f[2],j=0===i.length,k=b.history?b.history.slice():[];k.push({id:g,opts:h}),j&&c.push({pos:e+1-k.length,ids:k});for(var l=0,m=i.length;l<m;l++)d.push({pos:e+1,ids:i[l],history:k})}return c.reverse()}function oa(a,b){return a.pos-b.pos}function pa(a,b,c){for(var d,e=0,f=a.length;e<f;)d=e+f>>>1,c(a[d],b)<0?e=d+1:f=d;return e}function qa(a,b,c){var d=pa(a,b,c);a.splice(d,0,b)}function ra(a,b){for(var c,d,e=b,f=a.length;e<f;e++){var g=a[e],h=[g.id,g.opts,[]];d?(d[2].push(h),d=h):c=d=h}return c}function sa(a,b){return a[0]<b[0]?-1:1}function ta(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status="available"===f[1].status||"available"===g[1].status?"available":"missing");
for(var h=0;h<g[2].length;h++)if(f[2][0]){for(var i=!1,j=0;j<f[2].length;j++)f[2][j][0]===g[2][h][0]&&(c.push({tree1:f[2][j],tree2:g[2][h]}),i=!0);i||(d="new_branch",qa(f[2],g[2][h],sa))}else d="new_leaf",f[2][0]=g[2][h]}return{conflicts:d,tree:a}}function ua(a,b,c){var d,e=[],f=!1,g=!1;if(!a.length)return{tree:[b],conflicts:"new_leaf"};for(var h=0,i=a.length;h<i;h++){var j=a[h];if(j.pos===b.pos&&j.ids[0]===b.ids[0])d=ta(j.ids,b.ids),e.push({pos:j.pos,ids:d.tree}),f=f||d.conflicts,g=!0;else if(c!==!0){var k=j.pos<b.pos?j:b,l=j.pos<b.pos?b:j,m=l.pos-k.pos,n=[],o=[];for(o.push({ids:k.ids,diff:m,parent:null,parentIdx:null});o.length>0;){var p=o.pop();if(0!==p.diff)for(var q=p.ids[2],r=0,s=q.length;r<s;r++)o.push({ids:q[r],diff:p.diff-1,parent:p.ids,parentIdx:r});else p.ids[0]===l.ids[0]&&n.push(p)}var t=n[0];t?(d=ta(t.ids,l.ids),t.parent[2][t.parentIdx]=d.tree,e.push({pos:k.pos,ids:k.ids}),f=f||d.conflicts,g=!0):e.push(j)}else e.push(j)}return g||e.push(b),e.sort(oa),{tree:e,conflicts:f||"internal_node"}}function va(a,b){for(var c,d,e=na(a),f=0,g=e.length;f<g;f++){var h,i=e[f],j=i.ids;if(j.length>b){c||(c={});var k=j.length-b;h={pos:i.pos+k,ids:ra(j,k)};for(var l=0;l<k;l++){var m=i.pos+l+"-"+j[l].id;c[m]=!0}}else h={pos:i.pos,ids:ra(j,0)};d=d?ua(d,h,!0).tree:[h]}return c&&ia(d,function(a,b,d){delete c[b+"-"+d]}),{tree:d,revs:c?Object.keys(c):[]}}function wa(a,b,c){var d=ua(a,b),e=va(d.tree,c);return{tree:e.tree,stemmedRevs:e.revs,conflicts:d.conflicts}}function xa(a,b){for(var c,d=a.slice(),e=b.split("-"),f=parseInt(e[0],10),g=e[1];c=d.pop();){if(c.pos===f&&c.ids[0]===g)return!0;for(var h=c.ids[2],i=0,j=h.length;i<j;i++)d.push({pos:c.pos+1,ids:h[i]})}return!1}function ya(a){return a.ids}function za(a,b){b||(b=ha(a));for(var c,d=b.substring(b.indexOf("-")+1),e=a.rev_tree.map(ya);c=e.pop();){if(c[0]===d)return!!c[1].deleted;e=e.concat(c[2])}}function Aa(a){return/^_local/.test(a)}function Ba(a,b){for(var c,d=b.rev_tree.slice();c=d.pop();){var e=c.pos,f=c.ids,g=f[0],h=f[1],i=f[2],j=0===i.length,k=c.history?c.history.slice():[];if(k.push({id:g,pos:e,opts:h}),j)for(var l=0,m=k.length;l<m;l++){var n=k[l],o=n.pos+"-"+n.id;if(o===a)return e+"-"+g}for(var p=0,q=i.length;p<q;p++)d.push({pos:e+1,ids:i[p],history:k})}throw new Error("Unable to resolve latest revision for id "+b.id+", rev "+a)}function Ca(a,b,c,d){try{a.emit("change",b,c,d)}catch(a){A("error",'Error in .on("change", function):',a)}}function Da(a,b,c){function d(){e.cancel()}Fd.EventEmitter.call(this);var e=this;this.db=a,b=b?j(b):{};var f=b.complete=k(function(b,c){b?M(e,"error")>0&&e.emit("error",b):e.emit("complete",c),e.removeAllListeners(),a.removeListener("destroyed",d)});c&&(e.on("complete",function(a){c(null,a)}),e.on("error",c)),a.once("destroyed",d),b.onChange=function(a,b,c){e.isCancelled||Ca(e,a,b,c)};var g=new Promise(function(a,c){b.complete=function(b,d){b?c(b):a(d)}});e.once("cancel",function(){a.removeListener("destroyed",d),b.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this.catch=g.catch.bind(g),this.then(function(a){f(null,a)},f),a.taskqueue.isReady?e.validateChanges(b):a.taskqueue.addTask(function(a){a?b.complete(a):e.isCancelled?e.emit("cancel"):e.validateChanges(b)})}function Ea(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=ka(b.rev_tree).map(function(a){return{rev:a.rev}}));var e={id:b.id,changes:d,doc:a};return za(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=la(b),e.doc._conflicts.length||delete e.doc._conflicts),e}function Fa(a,b){return a<b?-1:a>b?1:0}function Ga(a,b){return function(c,d){c||d[0]&&d[0].error?(c=c||d[0],c.docId=b,a(c)):a(null,d.length?d[0]:d)}}function Ha(a){for(var b=0;b<a.length;b++){var c=a[b];if(c._deleted)delete c._attachments;else if(c._attachments)for(var d=Object.keys(c._attachments),e=0;e<d.length;e++){var f=d[e];c._attachments[f]=t(c._attachments[f],["data","digest","content_type","length","revpos","stub"])}}}function Ia(a,b){var c=Fa(a._id,b._id);if(0!==c)return c;var d=a._revisions?a._revisions.start:0,e=b._revisions?b._revisions.start:0;return Fa(d,e)}function Ja(a){var b={},c=[];return ia(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){void 0===b[a.from]?b[a.from]=1+b[a.to]:b[a.from]=Math.min(b[a.from],1+b[a.to])}),b}function Ka(a){var b="limit"in a?a.keys.slice(a.skip,a.limit+a.skip):a.skip>0?a.keys.slice(a.skip):a.keys;a.keys=b,a.skip=0,delete a.limit,a.descending&&(b.reverse(),a.descending=!1)}function La(a){var b=a._compactionQueue[0],c=b.opts,d=b.callback;a.get("_local/compaction").catch(function(){return!1}).then(function(b){b&&b.last_seq&&(c.last_seq=b.last_seq),a._compact(c,function(b,c){b?d(b):d(null,c),Ed(function(){a._compactionQueue.shift(),a._compactionQueue.length&&La(a)})})})}function Ma(a){return"_"===a.charAt(0)&&a+" is not a valid attachment name, attachment names cannot start with '_'"}function Na(){Fd.EventEmitter.call(this);for(var a in Na.prototype)"function"==typeof this[a]&&(this[a]=this[a].bind(this))}function Oa(){this.isReady=!1,this.failed=!1,this.queue=[]}function Pa(a,b){var c=a.match(/([a-z-]*):\/\/(.*)/);if(c)return{name:/https?/.test(c[1])?c[1]+"://"+c[2]:c[2],adapter:c[1]};var d=Ra.adapters,e=Ra.preferredAdapters,f=Ra.prefix,g=b.adapter;if(!g)for(var h=0;h<e.length;++h){g=e[h];if(!("idb"===g&&"websql"in d&&x()&&localStorage["_pouch__websqldb_"+f+a]))break;A("log",'PouchDB is downgrading "'+a+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.')}var i=d[g],j=!(i&&"use_prefix"in i)||i.use_prefix;return{name:j?f+a:a,adapter:g}}function Qa(a){function b(b){a.removeListener("closed",c),b||a.constructor.emit("destroyed",a.name)}function c(){a.removeListener("destroyed",b),a.constructor.emit("unref",a)}a.once("destroyed",b),a.once("closed",c),a.constructor.emit("ref",a)}function Ra(a,b){if(!(this instanceof Ra))return new Ra(a,b);var c=this;if(b=b||{},a&&"object"==typeof a&&(b=a,a=b.name,delete b.name),void 0===b.deterministic_revs&&(b.deterministic_revs=!0),this.__opts=b=j(b),c.auto_compaction=b.auto_compaction,c.prefix=Ra.prefix,"string"!=typeof a)throw new Error("Missing/invalid DB name");var d=(b.prefix||"")+a,e=Pa(d,b);if(b.name=e.name,b.adapter=b.adapter||e.adapter,c.name=a,c._adapter=b.adapter,Ra.emit("debug",["adapter","Picked adapter: ",b.adapter]),!Ra.adapters[b.adapter]||!Ra.adapters[b.adapter].valid())throw new Error("Invalid Adapter: "+b.adapter);Na.call(c),c.taskqueue=new Oa,c.adapter=b.adapter,Ra.adapters[b.adapter].call(c,b,function(a){return a?c.taskqueue.fail(a):(Qa(c),c.emit("created",c),Ra.emit("created",c.name),c.taskqueue.ready(c),void 0)})}function Sa(a){Object.keys(Fd.EventEmitter.prototype).forEach(function(b){"function"==typeof Fd.EventEmitter.prototype[b]&&(a[b]=re[b].bind(re))});var b=a._destructionListeners=new Nd;a.on("ref",function(a){b.has(a.name)||b.set(a.name,[]),b.get(a.name).push(a)}),a.on("unref",function(a){if(b.has(a.name)){var c=b.get(a.name),d=c.indexOf(a);d<0||(c.splice(d,1),c.length>1?b.set(a.name,c):b.delete(a.name))}}),a.on("destroyed",function(a){if(b.has(a)){var c=b.get(a);b.delete(a),c.forEach(function(a){a.emit("destroyed",!0)})}})}function Ta(a,b){for(var c=a,d=0,e=b.length;d<e;d++){var f=b[d];if(c=c[f],!c)break}return c}function Ua(a,b){return a<b?-1:a>b?1:0}function Va(a){for(var b=[],c="",d=0,e=a.length;d<e;d++){var f=a[d];"."===f?d>0&&"\\"===a[d-1]?c=c.substring(0,c.length-1)+".":(b.push(c),c=""):c+=f}return b.push(c),b}function Wa(a){return te.indexOf(a)>-1}function Xa(a){return Object.keys(a)[0]}function Ya(a){return a[Xa(a)]}function Za(a){var b={};return a.forEach(function(a){Object.keys(a).forEach(function(c){var d=a[c];if("object"!=typeof d&&(d={$eq:d}),Wa(c))d instanceof Array?b[c]=d.map(function(a){return Za([a])}):b[c]=Za([d]);else{var e=b[c]=b[c]||{};Object.keys(d).forEach(function(a){var b=d[a];return"$gt"===a||"$gte"===a?$a(a,b,e):"$lt"===a||"$lte"===a?_a(a,b,e):"$ne"===a?ab(b,e):"$eq"===a?bb(b,e):(e[a]=b,void 0)})}})}),b}function $a(a,b,c){"undefined"==typeof c.$eq&&("undefined"!=typeof c.$gte?"$gte"===a?b>c.$gte&&(c.$gte=b):b>=c.$gte&&(delete c.$gte,c.$gt=b):"undefined"!=typeof c.$gt?"$gte"===a?b>c.$gt&&(delete c.$gt,c.$gte=b):b>c.$gt&&(c.$gt=b):c[a]=b)}function _a(a,b,c){"undefined"==typeof c.$eq&&("undefined"!=typeof c.$lte?"$lte"===a?b<c.$lte&&(c.$lte=b):b<=c.$lte&&(delete c.$lte,c.$lt=b):"undefined"!=typeof c.$lt?"$lte"===a?b<c.$lt&&(delete c.$lt,c.$lte=b):b<c.$lt&&(c.$lt=b):c[a]=b)}function ab(a,b){"$ne"in b?b.$ne.push(a):b.$ne=[a]}function bb(a,b){delete b.$gt,delete b.$gte,delete b.$lt,delete b.$lte,delete b.$ne,b.$eq=a}function cb(a){var b=j(a),c=!1;"$and"in b&&(b=Za(b.$and),c=!0),["$or","$nor"].forEach(function(a){a in b&&b[a].forEach(function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c],e=a[d];"object"==typeof e&&null!==e||(a[d]={$eq:e})}})}),"$not"in b&&(b.$not=Za([b.$not]));for(var d=Object.keys(b),e=0;e<d.length;e++){var f=d[e],g=b[f];"object"!=typeof g||null===g?g={$eq:g}:"$ne"in g&&!c&&(g.$ne=[g.$ne]),b[f]=g}return b}function db(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}function eb(a,b,c){var d=db(a,b,c);return d+a}function fb(a,b){if(a===b)return 0;a=gb(a),b=gb(b);var c=pb(a),d=pb(b);if(c-d!==0)return c-d;switch(typeof a){case"number":return a-b;case"boolean":return a<b?-1:1;case"string":return nb(a,b)}return Array.isArray(a)?mb(a,b):ob(a,b)}function gb(a){switch(typeof a){case"undefined":return null;case"number":return a===1/0||a===-(1/0)||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var c=a.length;a=new Array(c);for(var d=0;d<c;d++)a[d]=gb(b[d])}else{if(a instanceof Date)return a.toJSON();if(null!==a){a={};for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];"undefined"!=typeof f&&(a[e]=gb(f))}}}}return a}function hb(a){if(null!==a)switch(typeof a){case"boolean":return a?1:0;case"number":return qb(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),c=b?a:Object.keys(a),d=-1,e=c.length,f="";if(b)for(;++d<e;)f+=ib(c[d]);else for(;++d<e;){var g=c[d];f+=ib(g)+ib(a[g])}return f}return""}function ib(a){var b="\0";return a=gb(a),pb(a)+we+hb(a)+b}function jb(a,b){var c,d=b,e="1"===a[b];if(e)c=0,b++;else{var f="0"===a[b];b++;var g="",h=a.substring(b,b+ve),i=parseInt(h,10)+ue;for(f&&(i=-i),b+=ve;;){var j=a[b];if("\0"===j)break;g+=j,b++}g=g.split("."),c=1===g.length?parseInt(g,10):parseFloat(g[0]+"."+g[1]),f&&(c-=10),0!==i&&(c=parseFloat(c+"e"+i))}return{num:c,length:b-d}}function kb(a,b){var c=a.pop();if(b.length){var d=b[b.length-1];c===d.element&&(b.pop(),d=b[b.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(c);else if(f===a.length-2){var g=a.pop();e[g]=c}else a.push(c)}}function lb(a){for(var b=[],c=[],d=0;;){var e=a[d++];if("\0"!==e)switch(e){case"1":b.push(null);break;case"2":b.push("1"===a[d]),d++;break;case"3":var f=jb(a,d);b.push(f.num),d+=f.length;break;case"4":for(var g="";;){var h=a[d];if("\0"===h)break;g+=h,d++}g=g.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),b.push(g);break;case"5":var i={element:[],index:b.length};b.push(i.element),c.push(i);break;case"6":var j={element:{},index:b.length};b.push(j.element),c.push(j);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+e)}else{if(1===b.length)return b.pop();kb(b,c)}}}function mb(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;d++){var e=fb(a[d],b[d]);if(0!==e)return e}return a.length===b.length?0:a.length>b.length?1:-1}function nb(a,b){return a===b?0:a>b?1:-1}function ob(a,b){for(var c=Object.keys(a),d=Object.keys(b),e=Math.min(c.length,d.length),f=0;f<e;f++){var g=fb(c[f],d[f]);if(0!==g)return g;if(g=fb(a[c[f]],b[d[f]]),0!==g)return g}return c.length===d.length?0:c.length>d.length?1:-1}function pb(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);return~c?null===a?1:Array.isArray(a)?5:c<3?c+2:c+3:Array.isArray(a)?5:void 0}function qb(a){if(0===a)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=a<0,e=d?"0":"2",f=(d?-c:c)-ue,g=eb(f.toString(),"0",ve);e+=we+g;var h=Math.abs(parseFloat(b[0]));d&&(h=10-h);var i=h.toFixed(20);return i=i.replace(/\.?0+$/,""),e+=we+i,e}function rb(a){function b(b){return a.map(function(a){var c=Xa(a),d=Va(c),e=Ta(b,d);return e})}return function(a,c){var d=b(a.doc),e=b(c.doc),f=fb(d,e);return 0!==f?f:Ua(a.doc._id,c.doc._id)}}function sb(a,b,c){if(a=a.filter(function(a){return tb(a.doc,b.selector,c)}),b.sort){var d=rb(b.sort);a=a.sort(d),"string"!=typeof b.sort[0]&&"desc"===Ya(b.sort[0])&&(a=a.reverse())}if("limit"in b||"skip"in b){var e=b.skip||0,f=("limit"in b?b.limit:a.length)+e;a=a.slice(e,f)}return a}function tb(a,b,c){return c.every(function(c){var d=b[c],e=Va(c),f=Ta(a,e);return Wa(c)?vb(c,d,a):ub(d,a,e,f)})}function ub(a,b,c,d){return!a||Object.keys(a).every(function(e){var f=a[e];return wb(e,b,f,c,d)})}function vb(a,b,c){return"$or"===a?b.some(function(a){return tb(c,a,Object.keys(a))}):"$not"===a?!tb(c,b,Object.keys(b)):!b.find(function(a){return tb(c,a,Object.keys(a))})}function wb(a,b,c,d,e){if(!xe[a])throw new Error('unknown operator "'+a+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return xe[a](b,c,d,e)}function xb(a){return"undefined"!=typeof a&&null!==a}function yb(a){return"undefined"!=typeof a}function zb(a,b){var c=b[0],d=b[1];if(0===c)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(c,10)!==c)throw new Error("Divisor is not an integer");if(parseInt(d,10)!==d)throw new Error("Modulus is not an integer");return parseInt(a,10)===a&&a%c===d}function Ab(a,b){return b.some(function(b){return a instanceof Array?a.indexOf(b)>-1:a===b})}function Bb(a,b){return b.every(function(b){return a.indexOf(b)>-1})}function Cb(a,b){return a.length===b}function Db(a,b){var c=new RegExp(b);return c.test(a)}function Eb(a,b){switch(b){case"null":return null===a;case"boolean":return"boolean"==typeof a;case"number":return"number"==typeof a;case"string":return"string"==typeof a;case"array":return a instanceof Array;case"object":return"[object Object]"==={}.toString.call(a)}throw new Error(b+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}function Fb(a,b){if("object"!=typeof b)throw new Error("Selector error: expected a JSON object");b=cb(b);var c={doc:a},d=sb([c],{selector:b},Object.keys(b));return d&&1===d.length}function Gb(a){return Q('"use strict";\nreturn '+a+";",{})}function Hb(a){var b=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+a+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return Q(b,{})}function Ib(a,b){if(a.selector&&a.filter&&"_selector"!==a.filter){var c="string"==typeof a.filter?a.filter:"function";return b(new Error('selector invalid for filter "'+c+'"'))}b()}function Jb(a){a.view&&!a.filter&&(a.filter="_view"),a.selector&&!a.filter&&(a.filter="_selector"),a.filter&&"string"==typeof a.filter&&("_view"===a.filter?a.view=O(a.view):a.filter=O(a.filter))}function Kb(a,b){return b.filter&&"string"==typeof b.filter&&!b.doc_ids&&!L(a.db)}function Lb(a,b){var c=b.complete;if("_view"===b.filter){if(!b.view||"string"!=typeof b.view){var d=F(ae,"`view` filter parameter not found or invalid.");return c(d)}var e=N(b.view);a.db.get("_design/"+e[0],function(d,f){if(a.isCancelled)return c(null,{status:"cancelled"});if(d)return c(G(d));var g=f&&f.views&&f.views[e[1]]&&f.views[e[1]].map;return g?(b.filter=Hb(g),a.doChanges(b),void 0):c(F(Td,f.views?"missing json key: "+e[1]:"missing json key: views"))})}else if(b.selector)b.filter=function(a){return Fb(a,b.selector)},a.doChanges(b);else{var f=N(b.filter);a.db.get("_design/"+f[0],function(d,e){if(a.isCancelled)return c(null,{status:"cancelled"});if(d)return c(G(d));var g=e&&e.filters&&e.filters[f[1]];return g?(b.filter=Gb(g),a.doChanges(b),void 0):c(F(Td,e&&e.filters?"missing json key: "+f[1]:"missing json key: filters"))})}}function Mb(a){a._changesFilterPlugin={validate:Ib,normalize:Jb,shouldFilter:Kb,filter:Lb}}function Nb(a){return a.reduce(function(a,b){return a[b]=!0,a},{})}function Ob(a){if(!/^\d+-./.test(a))return F(de);var b=a.indexOf("-"),c=a.substring(0,b),d=a.substring(b+1);return{prefix:parseInt(c,10),id:d}}function Pb(a,b){for(var c=a.start-a.ids.length+1,d=a.ids,e=[d[0],b,[]],f=1,g=d.length;f<g;f++)e=[d[f],{status:"missing"},[e]];return[{pos:c,ids:e}]}function Qb(a,b,c){c||(c={deterministic_revs:!0});var d,e,f,g={status:"available"};if(a._deleted&&(g.deleted=!0),b)if(a._id||(a._id=ne()),e=ga(a,c.deterministic_revs),a._rev){if(f=Ob(a._rev),f.error)return f;a._rev_tree=[{pos:f.prefix,ids:[f.id,{status:"missing"},[[e,g,[]]]]}],d=f.prefix+1}else a._rev_tree=[{pos:1,ids:[e,g,[]]}],d=1;else if(a._revisions&&(a._rev_tree=Pb(a._revisions,g),d=a._revisions.start,e=a._revisions.ids[0]),!a._rev_tree){if(f=Ob(a._rev),f.error)return f;d=f.prefix,e=f.id,a._rev_tree=[{pos:d,ids:[e,g,[]]}]}K(a._id),a._rev=d+"-"+e;var h={metadata:{},data:{}};for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var j="_"===i[0];if(j&&!ze[i]){var k=F(_d,i);throw k.message=_d.message+": "+i,k}j&&!Ae[i]?h.metadata[i.slice(1)]=a[i]:h.data[i]=a[i]}return h}function Rb(a){try{return je(a)}catch(a){var b=F(Zd,"Attachment is not a valid base64 string");return{error:b}}}function Sb(a,b,c){var d=Rb(a.data);return d.error?c(d.error):(a.length=d.length,"blob"===b?a.data=V(d,a.content_type):"base64"===b?a.data=ke(d):a.data=d,ea(d,function(b){a.digest="md5-"+b,c()}),void 0)}function Tb(a,b,c){ea(a.data,function(d){a.digest="md5-"+d,a.length=a.data.size||a.data.length||0,"binary"===b?Z(a.data,function(b){a.data=b,c()}):"base64"===b?$(a.data,function(b){a.data=b,c()}):c()})}function Ub(a,b,c){return a.stub?c():("string"==typeof a.data?Sb(a,b,c):Tb(a,b,c),void 0)}function Vb(a,b,c){function d(){f++,a.length===f&&(e?c(e):c())}if(!a.length)return c();var e,f=0;a.forEach(function(a){function c(a){e=a,g++,g===f.length&&d()}var f=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],g=0;if(!f.length)return d();for(var h in a.data._attachments)a.data._attachments.hasOwnProperty(h)&&Ub(a.data._attachments[h],b,c)})}function Wb(a,b,c,d,e,f,g,h){if(xa(b.rev_tree,c.metadata.rev)&&!h)return d[e]=c,f();var i=b.winningRev||ha(b),j="deleted"in b?b.deleted:za(b,i),k="deleted"in c.metadata?c.metadata.deleted:za(c.metadata),l=/^1-/.test(c.metadata.rev);if(j&&!k&&h&&l){var m=c.data;m._rev=i,m._id=c.metadata.id,c=Qb(m,h)}var n=wa(b.rev_tree,c.metadata.rev_tree[0],a),o=h&&(j&&k&&"new_leaf"!==n.conflicts||!j&&"new_leaf"!==n.conflicts||j&&!k&&"new_branch"===n.conflicts);if(o){var p=F(Ud);return d[e]=p,f()}var q=c.metadata.rev;c.metadata.rev_tree=n.tree,c.stemmedRevs=n.stemmedRevs||[],b.rev_map&&(c.metadata.rev_map=b.rev_map);var r,s=ha(c.metadata),t=za(c.metadata,s),u=j===t?0:j<t?-1:1;r=q===s?t:za(c.metadata,q),g(c,s,t,r,!0,u,e,f)}function Xb(a){return"missing"===a.metadata.rev_tree[0].ids[1].status}function Yb(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=ha(a.metadata),e=za(a.metadata,d);if("was_delete"in h&&e)return f[b]=F(Td,"deleted"),c();var i=l&&Xb(a);if(i){var j=F(Ud);return f[b]=j,c()}var k=e?0:1;g(a,d,e,e,!1,k,b,c)}function k(){++n===o&&i&&i()}a=a||1e3;var l=h.new_edits,m=new Nd,n=0,o=b.length;b.forEach(function(a,b){if(a._id&&Aa(a._id)){var d=a._deleted?"_removeLocal":"_putLocal";return c[d](a,{ctx:e},function(a,c){f[b]=a||c,k()}),void 0}var g=a.metadata.id;m.has(g)?(o--,m.get(g).push([a,b])):m.set(g,[[a,b]])}),m.forEach(function(b,c){function e(){++i<b.length?h():k()}function h(){var h=b[i],k=h[0],m=h[1];if(d.has(c))Wb(a,d.get(c),k,f,m,e,g,l);else{var n=wa([],k.metadata.rev_tree[0],a);k.metadata.rev_tree=n.tree,k.stemmedRevs=n.stemmedRevs||[],j(k,m,e)}}var i=0;h()})}function Zb(a){try{return JSON.parse(a)}catch(b){return Jd.parse(a)}}function $b(a){try{return JSON.stringify(a)}catch(b){return Jd.stringify(a)}}function _b(a){return function(b){var c="unknown_error";b.target&&b.target.error&&(c=b.target.error.name||b.target.error.message),a(F(ce,c,b.type))}}function ac(a,b,c){return{data:$b(a),winningRev:b,deletedOrLocal:c?"1":"0",seq:a.seq,id:a.id}}function bc(a){if(!a)return null;var b=Zb(a.data);return b.winningRev=a.winningRev,b.deleted="1"===a.deletedOrLocal,b.seq=a.seq,b}function cc(a){if(!a)return a;var b=a._doc_id_rev.lastIndexOf(":");return a._id=a._doc_id_rev.substring(0,b-1),a._rev=a._doc_id_rev.substring(b+1),delete a._doc_id_rev,a}function dc(a,b,c,d){c?d(a?"string"!=typeof a?a:W(a,b):T([""],{type:b})):a?"string"!=typeof a?Y(a,function(a){d(ke(a))}):d(a):d("")}function ec(a,b,c,d){function e(){++h===g.length&&d&&d()}function f(a,b){var d=a._attachments[b],f=d.digest,g=c.objectStore(Ee).get(f);g.onsuccess=function(a){d.body=a.target.result.body,e()}}var g=Object.keys(a._attachments||{});if(!g.length)return d&&d();var h=0;g.forEach(function(c){b.attachments&&b.include_docs?f(a,c):(a._attachments[c].stub=!0,e())})}function fc(a,b){return Promise.all(a.map(function(a){if(a.doc&&a.doc._attachments){var c=Object.keys(a.doc._attachments);return Promise.all(c.map(function(c){var d=a.doc._attachments[c];if("body"in d){var e=d.body,f=d.content_type;return new Promise(function(g){dc(e,f,b,function(b){a.doc._attachments[c]=Rd(t(d,["digest","content_type"]),{data:b}),g()})})}}))}}))}function gc(a,b,c){function d(){j--,j||e()}function e(){f.length&&f.forEach(function(a){var b=i.index("digestSeq").count(IDBKeyRange.bound(a+"::",a+"::￿",!1,!1));b.onsuccess=function(b){var c=b.target.result;c||h.delete(a)}})}var f=[],g=c.objectStore(De),h=c.objectStore(Ee),i=c.objectStore(Fe),j=a.length;a.forEach(function(a){var c=g.index("_doc_id_rev"),e=b+"::"+a;c.getKey(e).onsuccess=function(a){var b=a.target.result;if("number"!=typeof b)return d();g.delete(b);var c=i.index("seq").openCursor(IDBKeyRange.only(b));c.onsuccess=function(a){var b=a.target.result;if(b){var c=b.value.digestSeq.split("::")[0];f.push(c),i.delete(b.primaryKey),b.continue()}else d()}}})}function hc(a,b,c){try{return{txn:a.transaction(b,c)}}catch(a){return{error:a}}}function ic(a,b,c,d,e,f){function g(){var a=[Ce,De,Ee,He,Fe,Ge],b=hc(e,a,"readwrite");return b.error?f(b.error):(t=b.txn,t.onabort=_b(f),t.ontimeout=_b(f),t.oncomplete=l,u=t.objectStore(Ce),v=t.objectStore(De),w=t.objectStore(Ee),x=t.objectStore(Fe),y=t.objectStore(Ge),y.get(Ge).onsuccess=function(a){A=a.target.result,j()},n(function(a){return a?(K=!0,f(a)):(k(),void 0)}),void 0)}function h(){G=!0,j()}function i(){Yb(a.revs_limit,B,d,J,t,I,o,c,h)}function j(){A&&G&&(A.docCount+=H,y.put(A))}function k(){function a(){++c===B.length&&i()}function b(b){var c=bc(b.target.result);c&&J.set(c.id,c),a()}if(B.length)for(var c=0,d=0,e=B.length;d<e;d++){var f=B[d];if(f._id&&Aa(f._id))a();else{var g=u.get(f.metadata.id);g.onsuccess=b}}}function l(){K||(Je.notify(d._meta.name),f(null,I))}function m(a,b){var c=w.get(a);c.onsuccess=function(c){if(c.target.result)b();else{var d=F(ee,"unknown stub attachment with digest "+a);d.status=412,b(d)}}}function n(a){function b(){++e===c.length&&a(d)}var c=[];if(B.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){m(a,function(a){a&&!d&&(d=a),b()})})}function o(a,b,c,d,e,f,g,h){a.metadata.winningRev=b,a.metadata.deleted=c;var i=a.data;i._id=a.metadata.id,i._rev=a.metadata.rev,d&&(i._deleted=!0);var k=i._attachments&&Object.keys(i._attachments).length;return k?q(a,b,c,e,g,h):(H+=f,j(),p(a,b,c,e,g,h),void 0)}function p(a,b,c,e,f,g){function h(f){var g=a.stemmedRevs||[];e&&d.auto_compaction&&(g=g.concat(ma(a.metadata))),g&&g.length&&gc(g,a.metadata.id,t),l.seq=f.target.result;var h=ac(l,b,c),i=u.put(h);i.onsuccess=j}function i(a){a.preventDefault(),a.stopPropagation();var b=v.index("_doc_id_rev"),c=b.getKey(k._doc_id_rev);c.onsuccess=function(a){var b=v.put(k,a.target.result);b.onsuccess=h}}function j(){I[f]={ok:!0,id:l.id,rev:l.rev},J.set(a.metadata.id,a.metadata),r(a,l.seq,g)}var k=a.data,l=a.metadata;k._doc_id_rev=l.id+"::"+l.rev,delete k._id,delete k._rev;var m=v.put(k);m.onsuccess=h,m.onerror=i}function q(a,b,c,d,e,f){function g(){j===k.length&&p(a,b,c,d,e,f)}function h(){j++,g()}var i=a.data,j=0,k=Object.keys(i._attachments);k.forEach(function(c){var d=a.data._attachments[c];if(d.stub)j++,g();else{var e=d.data;delete d.data,d.revpos=parseInt(b,10);var f=d.digest;s(f,e,h)}})}function r(a,b,c){function d(){++f===g.length&&c()}function e(c){var e=a.data._attachments[c].digest,f=x.put({seq:b,digestSeq:e+"::"+b});f.onsuccess=d,f.onerror=function(a){a.preventDefault(),a.stopPropagation(),d()}}var f=0,g=Object.keys(a.data._attachments||{});if(!g.length)return c();for(var h=0;h<g.length;h++)e(g[h])}function s(a,b,c){var d=w.count(a);d.onsuccess=function(d){var e=d.target.result;if(e)return c();var f={digest:a,body:b},g=w.put(f);g.onsuccess=c}}for(var t,u,v,w,x,y,z,A,B=b.docs,C=0,D=B.length;C<D;C++){var E=B[C];E._id&&Aa(E._id)||(E=B[C]=Qb(E,c.new_edits,a),E.error&&!z&&(z=E))}if(z)return f(z);var G=!1,H=0,I=new Array(B.length),J=new Nd,K=!1,L=d._meta.blobSupport?"blob":"base64";Vb(B,L,function(a){return a?f(a):(g(),void 0)})}function jc(a,b,c,d,e){function f(a){k=a.target.result,j&&e(j,k,l)}function g(a){j=a.target.result,k&&e(j,k,l)}function h(){if(!j.length)return e();var c,h=j[j.length-1];if(b&&b.upper)try{c=IDBKeyRange.bound(h,b.upper,!0,b.upperOpen)}catch(a){if("DataError"===a.name&&0===a.code)return e()}else c=IDBKeyRange.lowerBound(h,!0);b=c,j=null,k=null,a.getAll(b,d).onsuccess=f,a.getAllKeys(b,d).onsuccess=g}function i(a){var b=a.target.result;return b?(e([b.key],[b.value],b),void 0):e()}d===-1&&(d=1e3);var j,k,l,m="function"==typeof a.getAll&&"function"==typeof a.getAllKeys&&d>1&&!c;m?(l={continue:h},a.getAll(b,d).onsuccess=f,a.getAllKeys(b,d).onsuccess=g):c?a.openCursor(b,"prev").onsuccess=i:a.openCursor(b).onsuccess=i}function kc(a,b,c){function d(a){var b=a.target.result;b?(e.push(b.value),b.continue()):c({target:{result:e}})}if("function"==typeof a.getAll)return a.getAll(b).onsuccess=c,void 0;var e=[];a.openCursor(b).onsuccess=d}function lc(a,b,c){var d=new Array(a.length),e=0;a.forEach(function(f,g){b.get(f).onsuccess=function(b){b.target.result?d[g]=b.target.result:d[g]={key:f,error:"not_found"},e++,e===a.length&&c(a,d,{})}})}function mc(a,b,c,d,e){try{if(a&&b)return e?IDBKeyRange.bound(b,a,!c,!1):IDBKeyRange.bound(a,b,!1,!c);if(a)return e?IDBKeyRange.upperBound(a):IDBKeyRange.lowerBound(a);if(b)return e?IDBKeyRange.lowerBound(b,!c):IDBKeyRange.upperBound(b,!c);if(d)return IDBKeyRange.only(d)}catch(a){return{error:a}}return null}function nc(a,b,c){function d(a,b){function c(a){var c=a.target.result,d=void 0;return c&&c.key&&(d=c.key),b({target:{result:[d]}})}a.openCursor(null,"prev").onsuccess=c}function e(b,c,d){var e=b.id+"::"+d;C.get(e).onsuccess=function(d){if(c.doc=cc(d.target.result)||{},a.conflicts){var e=la(b);e.length&&(c.doc._conflicts=e)}ec(c.doc,a,w)}}function f(b,c){var d={id:c.id,key:c.id,value:{rev:b}},f=c.deleted;f?q&&(D.push(d),d.value.deleted=!0,d.doc=null):r--<=0&&(D.push(d),a.include_docs&&e(c,d,b))}function g(a){for(var b=0,c=a.length;b<c&&D.length!==s;b++){var d=a[b];if(d.error&&q)D.push(d);else{var e=bc(d),g=e.winningRev;f(g,e)}}}function h(a,b,c){c&&(g(b),D.length<s&&c.continue())}function i(b){var c=b.target.result;a.descending&&(c=c.reverse()),g(c)}function j(){var b={total_rows:x,offset:a.skip,rows:D};a.update_seq&&void 0!==y&&(b.update_seq=y),c(null,b)}function k(){a.attachments?fc(D,a.binary).then(j):j()}var l,m,n="startkey"in a&&a.startkey,o="endkey"in a&&a.endkey,p="key"in a&&a.key,q="keys"in a&&a.keys,r=a.skip||0,s="number"==typeof a.limit?a.limit:-1,t=a.inclusive_end!==!1;if(!q&&(l=mc(n,o,t,p,a.descending),m=l&&l.error,m&&("DataError"!==m.name||0!==m.code)))return c(F(ce,m.name,m.message));var u=[Ce,De,Ge];a.attachments&&u.push(Ee);var v=hc(b,u,"readonly");if(v.error)return c(v.error);var w=v.txn;w.oncomplete=k,w.onabort=_b(c);var x,y,z=w.objectStore(Ce),A=w.objectStore(De),B=w.objectStore(Ge),C=A.index("_doc_id_rev"),D=[];return B.get(Ge).onsuccess=function(a){x=a.target.result.docCount},a.update_seq&&d(A,function(a){a.target.result&&a.target.result.length>0&&(y=a.target.result[0])}),m||0===s?void 0:q?lc(a.keys,z,h):s===-1?kc(z,l,i):(jc(z,l,a.descending,s+r,h),void 0)}function oc(a){return new Promise(function(b){var c=T([""]),d=a.objectStore(Ie).put(c,"key");d.onsuccess=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),c=navigator.userAgent.match(/Edge\//);b(c||!a||parseInt(a[1],10)>=43)},d.onerror=a.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)}}).catch(function(){return!1})}function pc(a,b){var c=a.objectStore(Ce).index("deletedOrLocal");c.count(IDBKeyRange.only("0")).onsuccess=function(a){b(a.target.result)}}function qc(a,b,c,d){try{a(b,c)}catch(a){d.emit("error",a)}}function rc(){!Ke&&Le.length&&(Ke=!0,Le.shift()())}function sc(a,b,c){Le.push(function(){a(function(a,d){qc(b,a,d,c),Ke=!1,Ed(function(){rc(c)})})}),rc()}function tc(a,b,c,d){function e(b,c,d){function e(b,c){var d=a.processChange(c,b,a);m=d.seq=b.seq;var e=u(d);return"object"==typeof e?Promise.reject(e):e?(t++,a.return_docs&&s.push(d),a.attachments&&a.include_docs?new Promise(function(b){ec(c,a,o,function(){fc([d],a.binary).then(function(){b(d)})})}):Promise.resolve(d)):Promise.resolve()}function f(){for(var b=[],c=0,f=h.length;c<f&&t!==n;c++){var g=h[c];if(g){var j=i[c];b.push(e(j,g))}}Promise.all(b).then(function(b){for(var c=0,d=b.length;c<d;c++)b[c]&&a.onChange(b[c])}).catch(a.complete),t!==n&&d.continue()}if(d&&b.length){var h=new Array(b.length),i=new Array(b.length),j=0;c.forEach(function(a,c){var d=cc(a),e=b[c];g(d,e,function(a,d){i[c]=a,h[c]=d,++j===b.length&&f()})})}}function f(a,b,c,d){if(c.seq!==b)return d();if(c.winningRev===a._rev)return d(c,a);var e=a._id+"::"+c.winningRev,f=r.get(e);f.onsuccess=function(a){d(c,cc(a.target.result))}}function g(a,b,c){if(l&&!l.has(a._id))return c();var d=v.get(a._id);return d?f(a,b,d,c):(q.get(a._id).onsuccess=function(e){d=bc(e.target.result),v.set(a._id,d),f(a,b,d,c)},void 0)}function h(){a.complete(null,{results:s,last_seq:m})}function i(){!a.continuous&&a.attachments?fc(s).then(h):h()}if(a=j(a),a.continuous){var k=c+":"+ne();return Je.addListener(c,k,b,a),Je.notify(c),{cancel:function(){Je.removeListener(c,k)}}}var l=a.doc_ids&&new Md(a.doc_ids);a.since=a.since||0;var m=a.since,n="limit"in a?a.limit:-1;0===n&&(n=1);var o,p,q,r,s=[],t=0,u=I(a),v=new Nd,w=[Ce,De];a.attachments&&w.push(Ee);var x=hc(d,w,"readonly");if(x.error)return a.complete(x.error);o=x.txn,o.onabort=_b(a.complete),o.oncomplete=i,p=o.objectStore(De),q=o.objectStore(Ce),r=p.index("_doc_id_rev");var y=a.since&&!a.descending?IDBKeyRange.lowerBound(a.since,!0):null;jc(p,y,a.descending,n,e)}function uc(a,b){var c=this;sc(function(b){vc(c,a,b)},b,c.constructor)}function vc(a,b,c){function d(a){var b=a.createObjectStore(Ce,{keyPath:"id"});a.createObjectStore(De,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(Ee,{keyPath:"digest"}),a.createObjectStore(Ge,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(Ie),b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),a.createObjectStore(He,{keyPath:"_id"});var c=a.createObjectStore(Fe,{autoIncrement:!0});c.createIndex("seq","seq"),c.createIndex("digestSeq","digestSeq",{unique:!0})}function e(a,b){var c=a.objectStore(Ce);c.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),c.openCursor().onsuccess=function(a){var d=a.target.result;if(d){var e=d.value,f=za(e);e.deletedOrLocal=f?"1":"0",c.put(e),d.continue()}else b()}}function f(a){a.createObjectStore(He,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function g(a,b){var c=a.objectStore(He),d=a.objectStore(Ce),e=a.objectStore(De),f=d.openCursor();
f.onsuccess=function(a){var f=a.target.result;if(f){var g=f.value,h=g.id,i=Aa(h),j=ha(g);if(i){var k=h+"::"+j,l=h+"::",m=h+"::~",n=e.index("_doc_id_rev"),o=IDBKeyRange.bound(l,m,!1,!1),p=n.openCursor(o);p.onsuccess=function(a){if(p=a.target.result,p){var b=p.value;b._doc_id_rev===k&&c.put(b),e.delete(p.primaryKey),p.continue()}else d.delete(f.primaryKey),f.continue()}}else f.continue()}else b&&b()}}function h(a){var b=a.createObjectStore(Fe,{autoIncrement:!0});b.createIndex("seq","seq"),b.createIndex("digestSeq","digestSeq",{unique:!0})}function i(a,b){var c=a.objectStore(De),d=a.objectStore(Ee),e=a.objectStore(Fe),f=d.count();f.onsuccess=function(a){var d=a.target.result;return d?(c.openCursor().onsuccess=function(a){var c=a.target.result;if(!c)return b();for(var d=c.value,f=c.primaryKey,g=Object.keys(d._attachments||{}),h={},i=0;i<g.length;i++){var j=d._attachments[g[i]];h[j.digest]=!0}var k=Object.keys(h);for(i=0;i<k.length;i++){var l=k[i];e.put({seq:f,digestSeq:l+"::"+f})}c.continue()},void 0):b()}}function j(a){function b(a){return a.data?bc(a):(a.deleted="1"===a.deletedOrLocal,a)}var c=a.objectStore(De),d=a.objectStore(Ce),e=d.openCursor();e.onsuccess=function(a){function e(){var a=h.id+"::",b=h.id+"::￿",d=c.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,b)),e=0;d.onsuccess=function(a){var b=a.target.result;if(!b)return h.seq=e,f();var c=b.primaryKey;c>e&&(e=c),b.continue()}}function f(){var a=ac(h,h.winningRev,h.deleted),b=d.put(a);b.onsuccess=function(){g.continue()}}var g=a.target.result;if(g){var h=b(g.value);return h.winningRev=h.winningRev||ha(h),h.seq?f():(e(),void 0)}}}var k=b.name,m=null;a._meta=null,a._remote=!1,a.type=function(){return"idb"},a._id=l(function(b){b(null,a._meta.instanceId)}),a._bulkDocs=function(c,d,e){ic(b,c,d,a,m,e)},a._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h=b.ctx;if(!h){var i=hc(m,[Ce,De,Ee],"readonly");if(i.error)return c(i.error);h=i.txn}h.objectStore(Ce).get(a).onsuccess=function(a){if(f=bc(a.target.result),!f)return g=F(Td,"missing"),d();var c;if(b.rev)c=b.latest?Ba(b.rev,f):b.rev;else{c=f.winningRev;var i=za(f);if(i)return g=F(Td,"deleted"),d()}var j=h.objectStore(De),k=f.id+"::"+c;j.index("_doc_id_rev").get(k).onsuccess=function(a){return e=a.target.result,e&&(e=cc(e)),e?(d(),void 0):(g=F(Td,"missing"),d())}}},a._getAttachment=function(a,b,c,d,e){var f;if(d.ctx)f=d.ctx;else{var g=hc(m,[Ce,De,Ee],"readonly");if(g.error)return e(g.error);f=g.txn}var h=c.digest,i=c.content_type;f.objectStore(Ee).get(h).onsuccess=function(a){var b=a.target.result.body;dc(b,i,d.binary,function(a){e(null,a)})}},a._info=function(b){var c,d,e=hc(m,[Ge,De],"readonly");if(e.error)return b(e.error);var f=e.txn;f.objectStore(Ge).get(Ge).onsuccess=function(a){d=a.target.result.docCount},f.objectStore(De).openCursor(null,"prev").onsuccess=function(a){var b=a.target.result;c=b?b.key:0},f.oncomplete=function(){b(null,{doc_count:d,update_seq:c,idb_attachment_format:a._meta.blobSupport?"binary":"base64"})}},a._allDocs=function(a,b){nc(a,m,b)},a._changes=function(b){return tc(b,a,k,m)},a._close=function(a){m.close(),Me.delete(k),a()},a._getRevisionTree=function(a,b){var c=hc(m,[Ce],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(Ce).get(a);e.onsuccess=function(a){var c=bc(a.target.result);c?b(null,c.rev_tree):b(F(Td))}},a._doCompaction=function(a,b,c){var d=[Ce,De,Ee,Fe],e=hc(m,d,"readwrite");if(e.error)return c(e.error);var f=e.txn,g=f.objectStore(Ce);g.get(a).onsuccess=function(c){var d=bc(c.target.result);ia(d.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;b.indexOf(g)!==-1&&(f.status="missing")}),gc(b,a,f);var e=d.winningRev,g=d.deleted;f.objectStore(Ce).put(ac(d,e,g))},f.onabort=_b(c),f.oncomplete=function(){c()}},a._getLocal=function(a,b){var c=hc(m,[He],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(He).get(a);e.onerror=_b(b),e.onsuccess=function(a){var c=a.target.result;c?(delete c._doc_id_rev,b(null,c)):b(F(Td))}},a._putLocal=function(a,b,c){"function"==typeof b&&(c=b,b={}),delete a._revisions;var d=a._rev,e=a._id;d?a._rev="0-"+(parseInt(d.split("-")[1],10)+1):a._rev="0-1";var f,g=b.ctx;if(!g){var h=hc(m,[He],"readwrite");if(h.error)return c(h.error);g=h.txn,g.onerror=_b(c),g.oncomplete=function(){f&&c(null,f)}}var i,j=g.objectStore(He);d?(i=j.get(e),i.onsuccess=function(e){var g=e.target.result;if(g&&g._rev===d){var h=j.put(a);h.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)}}else c(F(Ud))}):(i=j.add(a),i.onerror=function(a){c(F(Ud)),a.preventDefault(),a.stopPropagation()},i.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)})},a._removeLocal=function(a,b,c){"function"==typeof b&&(c=b,b={});var d=b.ctx;if(!d){var e=hc(m,[He],"readwrite");if(e.error)return c(e.error);d=e.txn,d.oncomplete=function(){f&&c(null,f)}}var f,g=a._id,h=d.objectStore(He),i=h.get(g);i.onerror=_b(c),i.onsuccess=function(d){var e=d.target.result;e&&e._rev===a._rev?(h.delete(g),f={ok:!0,id:g,rev:"0-0"},b.ctx&&c(null,f)):c(F(Td))}},a._destroy=function(a,b){Je.removeAllListeners(k);var c=Ne.get(k);c&&c.result&&(c.result.close(),Me.delete(k));var d=indexedDB.deleteDatabase(k);d.onsuccess=function(){Ne.delete(k),x()&&k in localStorage&&delete localStorage[k],b(null,{ok:!0})},d.onerror=_b(b)};var n=Me.get(k);if(n)return m=n.idb,a._meta=n.global,Ed(function(){c(null,a)});var o=indexedDB.open(k,Be);Ne.set(k,o),o.onupgradeneeded=function(a){function b(){var a=l[m-1];m++,a&&a(k,b)}var c=a.target.result;if(a.oldVersion<1)return d(c);var k=a.currentTarget.transaction;a.oldVersion<3&&f(c),a.oldVersion<4&&h(c);var l=[e,g,i,j],m=a.oldVersion;b()},o.onsuccess=function(b){function d(){"undefined"!=typeof h&&l&&(a._meta={name:k,instanceId:i,blobSupport:h},Me.set(k,{idb:m,global:a._meta}),c(null,a))}function e(){if("undefined"!=typeof g&&"undefined"!=typeof f){var a=k+"_id";a in f?i=f[a]:f[a]=i=ne(),f.docCount=g,j.objectStore(Ge).put(f)}}m=b.target.result,m.onversionchange=function(){m.close(),Me.delete(k)},m.onabort=function(a){A("error","Database has a global failure",a.target.error),m.close(),Me.delete(k)};var f,g,h,i,j=m.transaction([Ge,Ie,Ce],"readwrite"),l=!1;j.objectStore(Ge).get(Ge).onsuccess=function(a){f=a.target.result||{id:Ge},e()},pc(j,function(a){g=a,e()}),ye||(ye=oc(j)),ye.then(function(a){h=a,d()}),j.oncomplete=function(){l=!0,d()},j.onabort=_b(c)},o.onerror=function(){var a="Failed to open indexedDB, are you in private browsing mode?";A("error",a),c(F(ce,a))}}function wc(a){a.adapter("idb",uc,!0)}function xc(a,b){return new Promise(function(c,d){function e(){k++,a[l++]().then(g,h)}function f(){++m===n?j?d(j):c():i()}function g(){k--,f()}function h(a){k--,j=j||a,f()}function i(){for(;k<b&&l<n;)e()}var j,k=0,l=0,m=0,n=a.length;i()})}function yc(a){var b=a.doc||a.ok,c=b._attachments;c&&Object.keys(c).forEach(function(a){var b=c[a];b.data=W(b.data,b.content_type)})}function zc(a){return/^_design/.test(a)?"_design/"+encodeURIComponent(a.slice(8)):/^_local/.test(a)?"_local/"+encodeURIComponent(a.slice(7)):encodeURIComponent(a)}function Ac(a){return a._attachments&&Object.keys(a._attachments)?Promise.all(Object.keys(a._attachments).map(function(b){var c=a._attachments[b];if(c.data&&"string"!=typeof c.data)return new Promise(function(a){$(c.data,a)}).then(function(a){c.data=a})})):Promise.resolve()}function Bc(a){if(!a.prefix)return!1;var b=P(a.prefix).protocol;return"http"===b||"https"===b}function Cc(a,b){if(Bc(b)){var c=b.name.substr(b.prefix.length),d=b.prefix.replace(/\/?$/,"/");a=d+encodeURIComponent(c)}var e=P(a);(e.user||e.password)&&(e.auth={username:e.user,password:e.password});var f=e.path.replace(/(^\/|\/$)/g,"").split("/");return e.db=f.pop(),e.db.indexOf("%")===-1&&(e.db=encodeURIComponent(e.db)),e.path=f.join("/"),e}function Dc(a,b){return Ec(a,a.db+"/"+b)}function Ec(a,b){var c=a.path?"/":"";return a.protocol+"://"+a.host+(a.port?":"+a.port:"")+"/"+a.path+c+b}function Fc(a){return"?"+Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")}function Gc(a){var b="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",c=b.indexOf("msie")!==-1,d=b.indexOf("trident")!==-1,e=b.indexOf("edge")!==-1,f=!("method"in a)||"GET"===a.method;return(c||d||e)&&f}function Hc(a,b){function d(a,b){return n(a,Dd(function(a){f().then(function(){return b.apply(this,a)}).catch(function(b){var c=a.pop();c(b)})})).bind(h)}function e(a,b,c){var d={};return b=b||{},b.headers=b.headers||new qe,b.headers.get("Content-Type")||b.headers.set("Content-Type","application/json"),b.headers.get("Accept")||b.headers.set("Accept","application/json"),m(a,b).then(function(a){return d.ok=a.ok,d.status=a.status,a.json()}).then(function(a){if(d.data=a,!d.ok){d.data.status=d.status;var b=G(d.data);if(c)return c(b);throw b}return Array.isArray(d.data)&&(d.data=d.data.map(function(a){return a.error||a.missing?G(a):a})),c?(c(null,d.data),void 0):d})}function f(){return a.skip_setup?Promise.resolve():l?l:(l=e(k).catch(function(a){return a&&a.status&&404===a.status?(D(404,"PouchDB is just detecting if the remote exists."),e(k,{method:"PUT"})):Promise.reject(a)}).catch(function(a){return!(!a||!a.status||412!==a.status)||Promise.reject(a)}),l.catch(function(){l=null}),l)}function g(a){return a.split("/").map(encodeURIComponent).join("/")}var h=this,i=Cc(a.name,a),k=Dc(i,"");a=j(a);var l,m=function(b,c){if(c=c||{},c.headers=c.headers||new qe,a.auth||i.auth){var d=a.auth||i.auth,e=d.username+":"+d.password,f=ke(unescape(encodeURIComponent(e)));c.headers.set("Authorization","Basic "+f)}var g=a.headers||{};Object.keys(g).forEach(function(a){c.headers.append(a,g[a])}),Gc(c)&&(b+=(b.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now());var h=a.fetch||pe;return h(b,c)};Ed(function(){b(null,h)}),h._remote=!0,h.type=function(){return"http"},h.id=d("id",function(a){m(Ec(i,"")).then(function(a){return a.json()}).then(function(b){var c=b&&b.uuid?b.uuid+i.db:Dc(i,"");a(null,c)}).catch(function(b){a(b)})}),h.compact=d("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=j(a),e(Dc(i,"_compact"),{method:"POST"}).then(function(){function c(){h.info(function(d,e){e&&!e.compact_running?b(null,{ok:!0}):setTimeout(c,a.interval||200)})}c()})}),h.bulkGet=n("bulkGet",function(a,b){function c(b){var c={};a.revs&&(c.revs=!0),a.attachments&&(c.attachments=!0),a.latest&&(c.latest=!0),e(Dc(i,"_bulk_get"+Fc(c)),{method:"POST",body:JSON.stringify({docs:a.docs})}).then(function(c){a.attachments&&a.binary&&c.data.results.forEach(function(a){a.docs.forEach(yc)}),b(null,c.data)}).catch(b)}function d(){function c(a){return function(c,d){h[a]=d.results,++g===e&&b(null,{results:J(h)})}}for(var d=Pe,e=Math.ceil(a.docs.length/d),g=0,h=new Array(e),i=0;i<e;i++){var j=t(a,["revs","attachments","binary","latest"]);j.docs=a.docs.slice(i*d,Math.min(a.docs.length,(i+1)*d)),w(f,j,c(i))}}var f=this,g=Ec(i,""),h=Se[g];"boolean"!=typeof h?c(function(a,c){a?(Se[g]=!1,D(a.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),d()):(Se[g]=!0,b(null,c))}):h?c(b):d()}),h._info=function(a){f().then(function(){return m(Dc(i,""))}).then(function(a){return a.json()}).then(function(b){b.host=Dc(i,""),a(null,b)}).catch(a)},h.fetch=function(a,b){return f().then(function(){return m(Dc(i,a),b)})},h.get=d("get",function(a,b,d){function f(a){function d(d){var f=e[d],h=zc(a._id)+"/"+g(d)+"?rev="+a._rev;return m(Dc(i,h)).then(function(a){return"undefined"==typeof c||c.browser?a.blob():a.buffer()}).then(function(a){return b.binary?("undefined"==typeof c||c.browser||(a.type=f.content_type),a):new Promise(function(b){$(a,b)})}).then(function(a){delete f.stub,delete f.length,f.data=a})}var e=a._attachments,f=e&&Object.keys(e);if(e&&f.length){var h=f.map(function(a){return function(){return d(a)}});return xc(h,5)}}function h(a){return Array.isArray(a)?Promise.all(a.map(function(a){if(a.ok)return f(a.ok)})):f(a)}"function"==typeof b&&(d=b,b={}),b=j(b);var k={};b.revs&&(k.revs=!0),b.revs_info&&(k.revs_info=!0),b.latest&&(k.latest=!0),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),k.open_revs=b.open_revs),b.rev&&(k.rev=b.rev),b.conflicts&&(k.conflicts=b.conflicts),b.update_seq&&(k.update_seq=b.update_seq),a=zc(a);var l=Dc(i,a+Fc(k));e(l).then(function(a){return Promise.resolve().then(function(){if(b.attachments)return h(a.data)}).then(function(){d(null,a.data)})}).catch(function(b){b.docId=a,d(b)})}),h.remove=d("remove",function(a,b,c,d){var f;"string"==typeof b?(f={_id:a,_rev:b},"function"==typeof c&&(d=c,c={})):(f=a,"function"==typeof b?(d=b,c={}):(d=c,c=b));var g=f._rev||c.rev,h=Dc(i,zc(f._id))+"?rev="+g;e(h,{method:"DELETE"},d).catch(d)}),h.getAttachment=d("getAttachment",function(a,b,d,e){"function"==typeof d&&(e=d,d={});var f,h=d.rev?"?rev="+d.rev:"",j=Dc(i,zc(a))+"/"+g(b)+h;m(j,{method:"GET"}).then(function(a){if(f=a.headers.get("content-type"),a.ok)return"undefined"==typeof c||c.browser?a.blob():a.buffer();throw a}).then(function(a){"undefined"==typeof c||c.browser||(a.type=f),e(null,a)}).catch(function(a){e(a)})}),h.removeAttachment=d("removeAttachment",function(a,b,c,d){var f=Dc(i,zc(a)+"/"+g(b))+"?rev="+c;e(f,{method:"DELETE"},d).catch(d)}),h.putAttachment=d("putAttachment",function(a,b,c,d,f,h){"function"==typeof f&&(h=f,f=d,d=c,c=null);var j=zc(a)+"/"+g(b),k=Dc(i,j);if(c&&(k+="?rev="+c),"string"==typeof d){var l;try{l=je(d)}catch(a){return h(F(Zd,"Attachment is not a valid base64 string"))}d=l?V(l,f):""}e(k,{headers:new qe({"Content-Type":f}),method:"PUT",body:d},h).catch(h)}),h._bulkDocs=function(a,b,c){a.new_edits=b.new_edits,f().then(function(){return Promise.all(a.docs.map(Ac))}).then(function(){return e(Dc(i,"_bulk_docs"),{method:"POST",body:JSON.stringify(a)},c)}).catch(c)},h._put=function(a,b,c){f().then(function(){return Ac(a)}).then(function(){return e(Dc(i,zc(a._id)),{method:"PUT",body:JSON.stringify(a)})}).then(function(a){c(null,a.data)}).catch(function(b){b.docId=a&&a._id,c(b)})},h.allDocs=d("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=j(a);var c,d={},f="GET";a.conflicts&&(d.conflicts=!0),a.update_seq&&(d.update_seq=!0),a.descending&&(d.descending=!0),a.include_docs&&(d.include_docs=!0),a.attachments&&(d.attachments=!0),a.key&&(d.key=JSON.stringify(a.key)),a.start_key&&(a.startkey=a.start_key),a.startkey&&(d.startkey=JSON.stringify(a.startkey)),a.end_key&&(a.endkey=a.end_key),a.endkey&&(d.endkey=JSON.stringify(a.endkey)),"undefined"!=typeof a.inclusive_end&&(d.inclusive_end=!!a.inclusive_end),"undefined"!=typeof a.limit&&(d.limit=a.limit),"undefined"!=typeof a.skip&&(d.skip=a.skip);var g=Fc(d);"undefined"!=typeof a.keys&&(f="POST",c={keys:a.keys}),e(Dc(i,"_all_docs"+g),{method:f,body:JSON.stringify(c)}).then(function(c){a.include_docs&&a.attachments&&a.binary&&c.data.rows.forEach(yc),b(null,c.data)}).catch(b)}),h._changes=function(a){var b="batch_size"in a?a.batch_size:Oe;a=j(a),!a.continuous||"heartbeat"in a||(a.heartbeat=Re);var c="timeout"in a?a.timeout:3e4;"timeout"in a&&a.timeout&&c-a.timeout<Qe&&(c=a.timeout+Qe),"heartbeat"in a&&a.heartbeat&&c-a.heartbeat<Qe&&(c=a.heartbeat+Qe);var d={};"timeout"in a&&a.timeout&&(d.timeout=a.timeout);var g="undefined"!=typeof a.limit&&a.limit,h=g;if(a.style&&(d.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(d.include_docs=!0),a.attachments&&(d.attachments=!0),a.continuous&&(d.feed="longpoll"),a.seq_interval&&(d.seq_interval=a.seq_interval),a.conflicts&&(d.conflicts=!0),a.descending&&(d.descending=!0),a.update_seq&&(d.update_seq=!0),"heartbeat"in a&&a.heartbeat&&(d.heartbeat=a.heartbeat),a.filter&&"string"==typeof a.filter&&(d.filter=a.filter),a.view&&"string"==typeof a.view&&(d.filter="_view",d.view=a.view),a.query_params&&"object"==typeof a.query_params)for(var k in a.query_params)a.query_params.hasOwnProperty(k)&&(d[k]=a.query_params[k]);var l,m="GET";a.doc_ids?(d.filter="_doc_ids",m="POST",l={doc_ids:a.doc_ids}):a.selector&&(d.filter="_selector",m="POST",l={selector:a.selector});var n,o=new oe,p=function(c,j){if(!a.aborted){d.since=c,"object"==typeof d.since&&(d.since=JSON.stringify(d.since)),a.descending?g&&(d.limit=h):d.limit=!g||h>b?b:h;var k=Dc(i,"_changes"+Fc(d)),p={signal:o.signal,method:m,body:JSON.stringify(l)};n=c,a.aborted||f().then(function(){return e(k,p,j)}).catch(j)}},q={results:[]},r=function(c,d){if(!a.aborted){var e=0;if(d&&d.results){e=d.results.length,q.last_seq=d.last_seq;var f=null,i=null;"number"==typeof d.pending&&(f=d.pending),"string"!=typeof q.last_seq&&"number"!=typeof q.last_seq||(i=q.last_seq);var j={};j.query=a.query_params,d.results=d.results.filter(function(b){h--;var c=I(a)(b);return c&&(a.include_docs&&a.attachments&&a.binary&&yc(b),a.return_docs&&q.results.push(b),a.onChange(b,f,i)),c})}else if(c)return a.aborted=!0,a.complete(c),void 0;d&&d.last_seq&&(n=d.last_seq);var k=g&&h<=0||d&&e<b||a.descending;(!a.continuous||g&&h<=0)&&k?a.complete(null,q):Ed(function(){p(n,r)})}};return p(a.since||0,r),{cancel:function(){a.aborted=!0,o.abort()}}},h.revsDiff=d("revsDiff",function(a,b,c){"function"==typeof b&&(c=b,b={}),e(Dc(i,"_revs_diff"),{method:"POST",body:JSON.stringify(a)},c).catch(c)}),h._close=function(a){a()},h._destroy=function(a,b){e(Dc(i,""),{method:"DELETE"}).then(function(a){b(null,a)}).catch(function(a){404===a.status?b(null,{ok:!0}):b(a)})}}function Ic(a){a.adapter("http",Hc,!1),a.adapter("https",Hc,!1)}function Jc(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Jc)}catch(a){}}function Kc(a){this.status=404,this.name="not_found",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Kc)}catch(a){}}function Lc(a){this.status=500,this.name="invalid_value",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Lc)}catch(a){}}function Mc(a,b){return b&&a.then(function(a){Ed(function(){b(null,a)})},function(a){Ed(function(){b(a)})}),a}function Nc(a){return Dd(function(b){var c=b.pop(),d=a.apply(this,b);return"function"==typeof c&&Mc(d,c),d})}function Oc(a,b){return a.then(function(a){return b().then(function(){return a})},function(a){return b().then(function(){throw a})})}function Pc(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}}function Qc(a){var b=new Md(a),c=new Array(b.size),d=-1;return b.forEach(function(a){c[++d]=a}),c}function Rc(a){var b=new Array(a.size),c=-1;return a.forEach(function(a,d){b[++c]=d}),b}function Sc(a){var b="builtin "+a+" function requires map values to be numbers or number arrays";return new Lc(b)}function Tc(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];if("number"!=typeof e){if(!Array.isArray(e))throw Sc("_sum");b="number"==typeof b?[b]:b;for(var f=0,g=e.length;f<g;f++){var h=e[f];if("number"!=typeof h)throw Sc("_sum");"undefined"==typeof b[f]?b.push(h):b[f]+=h}}else"number"==typeof b?b+=e:b[0]+=e}return b}function Uc(a,b){return Q("return ("+a.replace(/;\s*$/,"")+");",{emit:b,sum:Tc,log:Te,isArray:Ue,toJSON:Ve})}function Vc(){this.promise=new Promise(function(a){a()})}function Wc(a){if(!a)return"undefined";switch(typeof a){case"function":return a.toString();case"string":return a.toString();default:return JSON.stringify(a)}}function Xc(a,b){return Wc(a)+Wc(b)+"undefined"}function Yc(a,b,c,d,e,f){var g,h=Xc(c,d);if(!e&&(g=a._cachedViews=a._cachedViews||{},g[h]))return g[h];var i=a.info().then(function(i){function j(a){a.views=a.views||{};var c=b;c.indexOf("/")===-1&&(c=b+"/"+b);var d=a.views[c]=a.views[c]||{};if(!d[k])return d[k]=!0,a}var k=i.db_name+"-mrview-"+(e?"temp":fa(h));return R(a,"_local/"+f,j).then(function(){return a.registerDependentDatabase(k).then(function(b){var e=b.db;e.auto_compaction=!0;var f={name:k,db:e,sourceDB:a,adapter:a.adapter,mapFun:c,reduceFun:d};return f.db.get("_local/lastSeq").catch(function(a){if(404!==a.status)throw a}).then(function(a){return f.seq=a?a.seq:0,g&&f.db.once("destroyed",function(){delete g[h]}),f})})})});return g&&(g[h]=i),i}function Zc(a){return a.indexOf("/")===-1?[a,a]:a.split("/")}function $c(a){return 1===a.length&&/^1-/.test(a[0].rev)}function _c(a,b){try{a.emit("error",b)}catch(a){A("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),A("error",b)}}function ad(a,b,c,d){function e(a,b,c){try{b(c)}catch(b){_c(a,b)}}function f(a,b,c,d,e){try{return{output:b(c,d,e)}}catch(b){return _c(a,b),{error:b}}}function g(a,b){var c=fb(a.key,b.key);return 0!==c?c:fb(a.value,b.value)}function h(a,b,c){return c=c||0,"number"==typeof b?a.slice(c,b+c):c>0?a.slice(c):a}function i(a){var b=a.value,c=b&&"object"==typeof b&&b._id||a.id;return c}function j(a){a.rows.forEach(function(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];b[a].data=W(c.data,c.content_type)})})}function k(a){return function(b){return a.include_docs&&a.attachments&&a.binary&&j(b),b}}function l(a,b,c,d){var e=b[a];"undefined"!=typeof e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function m(a){if("undefined"!=typeof a){var b=Number(a);return isNaN(b)||b!==parseInt(a,10)?a:b}}function n(a){return a.group_level=m(a.group_level),a.limit=m(a.limit),a.skip=m(a.skip),a}function o(a){if(a){if("number"!=typeof a)return new Jc('Invalid value for integer: "'+a+'"');if(a<0)return new Jc('Invalid value for positive integer: "'+a+'"')}}function p(a,b){var c=a.descending?"endkey":"startkey",d=a.descending?"startkey":"endkey";if("undefined"!=typeof a[c]&&"undefined"!=typeof a[d]&&fb(a[c],a[d])>0)throw new Jc("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(b.reduce&&a.reduce!==!1){if(a.include_docs)throw new Jc("{include_docs:true} is invalid for reduce");if(a.keys&&a.keys.length>1&&!a.group&&!a.group_level)throw new Jc("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(b){var c=o(a[b]);if(c)throw c})}function q(a,b,c){var d,e,f,g=[],h="GET";if(l("reduce",c,g),l("include_docs",c,g),l("attachments",c,g),l("limit",c,g),l("descending",c,g),l("group",c,g),l("group_level",c,g),l("skip",c,g),l("stale",c,g),l("conflicts",c,g),l("startkey",c,g,!0),l("start_key",c,g,!0),l("endkey",c,g,!0),l("end_key",c,g,!0),l("inclusive_end",c,g),l("key",c,g,!0),l("update_seq",c,g),g=g.join("&"),g=""===g?"":"?"+g,"undefined"!=typeof c.keys){var i=2e3,j="keys="+encodeURIComponent(JSON.stringify(c.keys));j.length+g.length+1<=i?g+=("?"===g[0]?"&":"?")+j:(h="POST","string"==typeof b?d={keys:c.keys}:b.keys=c.keys)}if("string"==typeof b){var m=Zc(b);return a.fetch("_design/"+m[0]+"/_view/"+m[1]+g,{headers:new qe({"Content-Type":"application/json"}),method:h,body:JSON.stringify(d)}).then(function(a){return e=a.ok,f=a.status,a.json()}).then(function(a){if(!e)throw a.status=f,G(a);return a.rows.forEach(function(a){if(a.value&&a.value.error&&"builtin_reduce_error"===a.value.error)throw new Error(a.reason)}),a}).then(k(c))}return d=d||{},Object.keys(b).forEach(function(a){Array.isArray(b[a])?d[a]=b[a]:d[a]=b[a].toString()}),a.fetch("_temp_view"+g,{headers:new qe({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(d)}).then(function(a){return e=a.ok,f=a.status,a.json()}).then(function(a){if(!e)throw a.status=f,G(a);return a}).then(k(c))}function r(a,b,c){return new Promise(function(d,e){a._query(b,c,function(a,b){return a?e(a):(d(b),void 0)})})}function s(a){return new Promise(function(b,c){a._viewCleanup(function(a,d){return a?c(a):(b(d),void 0)})})}function t(a){return function(b){if(404===b.status)return a;throw b}}function u(a,b,c){function d(){return $c(k)?Promise.resolve(h):b.db.get(g).catch(t(h))}function e(a){return a.keys.length?b.db.allDocs({keys:a.keys,include_docs:!0}):Promise.resolve({rows:[]})}function f(a,b){for(var c=[],d=new Md,e=0,f=b.rows.length;e<f;e++){var g=b.rows[e],h=g.doc;if(h&&(c.push(h),d.add(h._id),h._deleted=!j.has(h._id),!h._deleted)){var i=j.get(h._id);"value"in i&&(h.value=i.value)}}var k=Rc(j);return k.forEach(function(a){if(!d.has(a)){var b={_id:a},e=j.get(a);"value"in e&&(b.value=e.value),c.push(b)}}),a.keys=Qc(k.concat(a.keys)),c.push(a),c}var g="_local/doc_"+a,h={_id:g,keys:[]},i=c.get(a),j=i[0],k=i[1];return d().then(function(a){return e(a).then(function(b){return f(a,b)})})}function v(a,b,c){var d="_local/lastSeq";return a.db.get(d).catch(t({_id:d,seq:0})).then(function(d){var e=Rc(b);return Promise.all(e.map(function(c){return u(c,a,b)})).then(function(b){var e=J(b);return d.seq=c,e.push(d),a.db.bulkDocs({docs:e})})})}function w(a){var b="string"==typeof a?a:a.name,c=We[b];return c||(c=We[b]=new Vc),c}function x(a){return Pc(w(a),function(){return y(a)})()}function y(a){function c(a,b){var c={id:l._id,key:gb(a)};"undefined"!=typeof b&&null!==b&&(c.value=gb(b)),k.push(c)}function d(b,c){return function(){return v(a,b,c)}}function f(){return a.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:n,limit:Ye}).then(h)}function h(a){var b=a.results;if(b.length){var c=i(b);if(o.add(d(c,n)),!(b.length<Ye))return f()}}function i(b){for(var c=new Nd,d=0,f=b.length;d<f;d++){var h=b[d];if("_"!==h.doc._id[0]){k=[],l=h.doc,l._deleted||e(a.sourceDB,m,l),k.sort(g);var i=j(k);c.set(h.doc._id,[i,h.changes])}n=h.seq}return c}function j(a){for(var b,c=new Nd,d=0,e=a.length;d<e;d++){var f=a[d],g=[f.key,f.id];d>0&&0===fb(f.key,b)&&g.push(d),c.set(ib(g),f),b=f.key}return c}var k,l,m=b(a.mapFun,c),n=a.seq||0,o=new Vc;return f().then(function(){return o.finish()}).then(function(){a.seq=n})}function z(a,b,d){0===d.group_level&&delete d.group_level;var e=d.group||d.group_level,g=c(a.reduceFun),i=[],j=isNaN(d.group_level)?Number.POSITIVE_INFINITY:d.group_level;b.forEach(function(a){var b=i[i.length-1],c=e?a.key:null;return e&&Array.isArray(c)&&(c=c.slice(0,j)),b&&0===fb(b.groupKey,c)?(b.keys.push([a.key,a.id]),b.values.push(a.value),void 0):(i.push({keys:[[a.key,a.id]],values:[a.value],groupKey:c}),void 0)}),b=[];for(var k=0,l=i.length;k<l;k++){var m=i[k],n=f(a.sourceDB,g,m.keys,m.values,!1);if(n.error&&n.error instanceof Lc)throw n.error;b.push({value:n.error?null:n.output,key:m.groupKey})}return{rows:h(b,d.limit,d.skip)}}function A(a,b){return Pc(w(a),function(){return B(a,b)})()}function B(a,b){function c(b){return b.include_docs=!0,a.db.allDocs(b).then(function(a){return e=a.total_rows,a.rows.map(function(a){if("value"in a.doc&&"object"==typeof a.doc.value&&null!==a.doc.value){var b=Object.keys(a.doc.value).sort(),c=["id","key","value"];if(!(b<c||b>c))return a.doc.value}var d=lb(a.doc._id);return{key:d[0],id:d[1],value:"value"in a.doc?a.doc.value:null}})})}function d(c){var d;if(d=f?z(a,c,b):{total_rows:e,offset:g,rows:c},b.update_seq&&(d.update_seq=a.seq),b.include_docs){var h=Qc(c.map(i));return a.sourceDB.allDocs({keys:h,include_docs:!0,conflicts:b.conflicts,attachments:b.attachments,binary:b.binary}).then(function(a){var b=new Nd;return a.rows.forEach(function(a){b.set(a.id,a.doc)}),c.forEach(function(a){var c=i(a),d=b.get(c);d&&(a.doc=d)}),d})}return d}var e,f=a.reduceFun&&b.reduce!==!1,g=b.skip||0;if("undefined"==typeof b.keys||b.keys.length||(b.limit=0,delete b.keys),"undefined"!=typeof b.keys){var h=b.keys,j=h.map(function(a){var d={startkey:ib([a]),endkey:ib([a,{}])};return b.update_seq&&(d.update_seq=!0),c(d)});return Promise.all(j).then(J).then(d)}var k={descending:b.descending};b.update_seq&&(k.update_seq=!0);var l,m;if("start_key"in b&&(l=b.start_key),"startkey"in b&&(l=b.startkey),"end_key"in b&&(m=b.end_key),"endkey"in b&&(m=b.endkey),"undefined"!=typeof l&&(k.startkey=ib(b.descending?[l,{}]:[l])),"undefined"!=typeof m){var n=b.inclusive_end!==!1;b.descending&&(n=!n),k.endkey=ib(n?[m,{}]:[m])}if("undefined"!=typeof b.key){var o=ib([b.key]),p=ib([b.key,{}]);k.descending?(k.endkey=o,k.startkey=p):(k.startkey=o,k.endkey=p)}return f||("number"==typeof b.limit&&(k.limit=b.limit),k.skip=g),c(k).then(d)}function C(a){return a.fetch("_view_cleanup",{headers:new qe({"Content-Type":"application/json"}),method:"POST"}).then(function(a){return a.json()})}function D(b){return b.get("_local/"+a).then(function(a){var c=new Nd;Object.keys(a.views).forEach(function(a){var b=Zc(a),d="_design/"+b[0],e=b[1],f=c.get(d);f||(f=new Md,c.set(d,f)),f.add(e)});var d={keys:Rc(c),include_docs:!0};return b.allDocs(d).then(function(d){var e={};d.rows.forEach(function(b){var d=b.key.substring(8);c.get(b.key).forEach(function(c){var f=d+"/"+c;a.views[f]||(f=c);var g=Object.keys(a.views[f]),h=b.doc&&b.doc.views&&b.doc.views[c];g.forEach(function(a){e[a]=e[a]||h})})});var f=Object.keys(e).filter(function(a){return!e[a]}),g=f.map(function(a){return Pc(w(a),function(){return new b.constructor(a,b.__opts).destroy()})()});return Promise.all(g).then(function(){return{ok:!0}})})},t({ok:!0}))}function E(b,c,e){if("function"==typeof b._query)return r(b,c,e);if(L(b))return q(b,c,e);if("string"!=typeof c)return p(e,c),Xe.add(function(){var d=Yc(b,"temp_view/temp_view",c.map,c.reduce,!0,a);return d.then(function(a){return Oc(x(a).then(function(){return A(a,e)}),function(){return a.db.destroy()})})}),Xe.finish();var f=c,g=Zc(f),h=g[0],i=g[1];return b.get("_design/"+h).then(function(c){var g=c.views&&c.views[i];if(!g)throw new Kc("ddoc "+c._id+" has no view named "+i);d(c,i),p(e,g);var h=Yc(b,f,g.map,g.reduce,!1,a);return h.then(function(a){return"ok"===e.stale||"update_after"===e.stale?("update_after"===e.stale&&Ed(function(){x(a)}),A(a,e)):x(a).then(function(){return A(a,e)})})})}function F(a,b,c){var d=this;"function"==typeof b&&(c=b,b={}),b=b?n(b):{},"function"==typeof a&&(a={map:a});var e=Promise.resolve().then(function(){return E(d,a,b)});return Mc(e,c),e}var H=Nc(function(){var a=this;return"function"==typeof a._viewCleanup?s(a):L(a)?C(a):D(a)});return{query:F,viewCleanup:H}}function bd(a){if(/^_sum/.test(a))return Ze._sum;if(/^_count/.test(a))return Ze._count;if(/^_stats/.test(a))return Ze._stats;if(/^_/.test(a))throw new Error(a+" is not a supported reduce function.")}function cd(a,b){if("function"==typeof a&&2===a.length){var c=a;return function(a){return c(a,b)}}return Uc(a.toString(),b)}function dd(a){var b=a.toString(),c=bd(b);return c?c:Uc(b)}function ed(a,b){var c=a.views&&a.views[b];if("string"!=typeof c.map)throw new Kc("ddoc "+a._id+" has no string view named "+b+", instead found object of type: "+typeof c.map)}function fd(a,b,c){return _e.query.call(this,a,b,c)}function gd(a){return _e.viewCleanup.call(this,a)}function hd(a){return/^1-/.test(a)}function id(a,b,c){return!a._attachments||!a._attachments[c]||a._attachments[c].digest!==b._attachments[c].digest}function jd(a,b){var c=Object.keys(b._attachments);return Promise.all(c.map(function(c){return a.getAttachment(b._id,c,{rev:b._rev})}))}function kd(a,b,c){var d=L(b)&&!L(a),e=Object.keys(c._attachments);return d?a.get(c._id).then(function(d){return Promise.all(e.map(function(e){return id(d,c,e)?b.getAttachment(c._id,e):a.getAttachment(d._id,e)}))}).catch(function(a){if(404!==a.status)throw a;return jd(b,c)}):jd(b,c)}function ld(a){var b=[];return Object.keys(a).forEach(function(c){var d=a[c].missing;d.forEach(function(a){b.push({id:c,rev:a})})}),{docs:b,revs:!0,latest:!0}}function md(a,b,c,d){function e(){var e=ld(c);if(e.docs.length)return a.bulkGet(e).then(function(c){if(d.cancelled)throw new Error("cancelled");return Promise.all(c.results.map(function(c){return Promise.all(c.docs.map(function(c){var d=c.ok;return c.error&&(m=!1),d&&d._attachments?kd(b,a,d).then(function(a){var b=Object.keys(d._attachments);return a.forEach(function(a,c){var e=d._attachments[b[c]];delete e.stub,delete e.length,e.data=a}),d}):d}))})).then(function(a){l=l.concat(J(a).filter(Boolean))})})}function f(a){return a._attachments&&Object.keys(a._attachments).length>0}function g(a){return a._conflicts&&a._conflicts.length>0}function h(b){return a.allDocs({keys:b,include_docs:!0,conflicts:!0}).then(function(a){if(d.cancelled)throw new Error("cancelled");a.rows.forEach(function(a){
a.deleted||!a.doc||!hd(a.value.rev)||f(a.doc)||g(a.doc)||(a.doc._conflicts&&delete a.doc._conflicts,l.push(a.doc),delete c[a.id])})})}function i(){var a=Object.keys(c).filter(function(a){var b=c[a].missing;return 1===b.length&&hd(b[0])});if(a.length>0)return h(a)}function k(){return{ok:m,docs:l}}c=j(c);var l=[],m=!0;return Promise.resolve().then(i).then(e).then(k)}function nd(a,b,c,d,e){return a.get(b).catch(function(c){if(404===c.status)return"http"!==a.adapter&&"https"!==a.adapter||D(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:d,_id:b,history:[],replicator:cf,version:bf};throw c}).then(function(f){if(!e.cancelled&&f.last_seq!==c)return f.history=(f.history||[]).filter(function(a){return a.session_id!==d}),f.history.unshift({last_seq:c,session_id:d}),f.history=f.history.slice(0,df),f.version=bf,f.replicator=cf,f.session_id=d,f.last_seq=c,a.put(f).catch(function(f){if(409===f.status)return nd(a,b,c,d,e);throw f})})}function od(a,b,c,d,e){this.src=a,this.target=b,this.id=c,this.returnValue=d,this.opts=e||{}}function pd(a,b){return a.session_id===b.session_id?{last_seq:a.last_seq,history:a.history}:qd(a.history,b.history)}function qd(a,b){var c=a[0],d=a.slice(1),e=b[0],f=b.slice(1);if(!c||0===b.length)return{last_seq:ef,history:[]};var g=c.session_id;if(rd(g,b))return{last_seq:c.last_seq,history:a};var h=e.session_id;return rd(h,d)?{last_seq:e.last_seq,history:f}:qd(d,f)}function rd(a,b){var c=b[0],d=b.slice(1);return!(!a||0===b.length)&&(a===c.session_id||rd(a,d))}function sd(a){return"number"==typeof a.status&&4===Math.floor(a.status/100)}function td(a,b,c,d){if(a.retry===!1)return b.emit("error",c),b.removeAllListeners(),void 0;if("function"!=typeof a.back_off_function&&(a.back_off_function=C),b.emit("requestError",c),"active"===b.state||"pending"===b.state){b.emit("paused",c),b.state="stopped";var e=function(){a.current_back_off=gf},f=function(){b.removeListener("active",e)};b.once("paused",f),b.once("active",e)}a.current_back_off=a.current_back_off||gf,a.current_back_off=a.back_off_function(a.current_back_off),setTimeout(d,a.current_back_off)}function ud(a){return Object.keys(a).sort(fb).reduce(function(b,c){return b[c]=a[c],b},{})}function vd(a,b,c){var d=c.doc_ids?c.doc_ids.sort(fb):"",e=c.filter?c.filter.toString():"",f="",g="",h="";return c.selector&&(h=JSON.stringify(c.selector)),c.filter&&c.query_params&&(f=JSON.stringify(ud(c.query_params))),c.filter&&"_view"===c.filter&&(g=c.view.toString()),Promise.all([a.id(),b.id()]).then(function(a){var b=a[0]+a[1]+e+g+f+d+h;return new Promise(function(a){ea(b,a)})}).then(function(a){return a=a.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+a})}function wd(a,b,c,d,e){function f(){return x?Promise.resolve():vd(a,b,c).then(function(e){w=e;var f={};f=c.checkpoint===!1?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===c.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===c.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},x=new od(a,b,w,d,f)})}function g(){if(M=[],0!==v.docs.length){var a=v.docs,f={timeout:c.timeout};return b.bulkDocs({docs:a,new_edits:!1},f).then(function(b){if(d.cancelled)throw o(),new Error("cancelled");var c=Object.create(null);b.forEach(function(a){a.error&&(c[a.id]=a)});var f=Object.keys(c).length;e.doc_write_failures+=f,e.docs_written+=a.length-f,a.forEach(function(a){var b=c[a._id];if(b){e.errors.push(b);var f=(b.name||"").toLowerCase();if("unauthorized"!==f&&"forbidden"!==f)throw b;d.emit("denied",j(b))}else M.push(a)})},function(b){throw e.doc_write_failures+=a.length,b})}}function h(){if(v.error)throw new Error("There was a problem getting docs.");e.last_seq=D=v.seq;var a=j(e);return M.length&&(a.docs=M,"number"==typeof v.pending&&(a.pending=v.pending,delete v.pending),d.emit("change",a)),A=!0,x.writeCheckpoint(v.seq,N).then(function(){if(A=!1,d.cancelled)throw o(),new Error("cancelled");v=void 0,s()}).catch(function(a){throw u(a),a})}function i(){var a={};return v.changes.forEach(function(b){"_user/"!==b.id&&(a[b.id]=b.changes.map(function(a){return a.rev}))}),b.revsDiff(a).then(function(a){if(d.cancelled)throw o(),new Error("cancelled");v.diffs=a})}function k(){return md(a,b,v.diffs,d).then(function(a){v.error=!a.ok,a.docs.forEach(function(a){delete v.diffs[a._id],e.docs_read++,v.docs.push(a)})})}function l(){if(!d.cancelled&&!v){if(0===y.length)return m(!0),void 0;v=y.shift(),i().then(k).then(g).then(h).then(l).catch(function(a){n("batch processing terminated with error",a)})}}function m(a){return 0===z.changes.length?(0!==y.length||v||((E&&O.live||B)&&(d.state="pending",d.emit("paused")),B&&o()),void 0):((a||B||z.changes.length>=G)&&(y.push(z),z={seq:0,changes:[],docs:[]},"pending"!==d.state&&"stopped"!==d.state||(d.state="active",d.emit("active")),l()),void 0)}function n(a,b){C||(b.message||(b.message=a),e.ok=!1,e.status="aborting",y=[],z={seq:0,changes:[],docs:[]},o(b))}function o(f){if(!(C||d.cancelled&&(e.status="cancelled",A)))if(e.status=e.status||"complete",e.end_time=(new Date).toISOString(),e.last_seq=D,C=!0,f){f=F(f),f.result=e;var g=(f.name||"").toLowerCase();"unauthorized"===g||"forbidden"===g?(d.emit("error",f),d.removeAllListeners()):td(c,d,f,function(){wd(a,b,c,d)})}else d.emit("complete",e),d.removeAllListeners()}function p(a,b,e){if(d.cancelled)return o();"number"==typeof b&&(z.pending=b);var f=I(c)(a);f&&(z.seq=a.seq||e,z.changes.push(a),Ed(function(){m(0===y.length&&O.live)}))}function q(a){if(J=!1,d.cancelled)return o();if(a.results.length>0)O.since=a.results[a.results.length-1].seq,s(),m(!0);else{var b=function(){E?(O.live=!0,s()):B=!0,m(!0)};v||0!==a.results.length?b():(A=!0,x.writeCheckpoint(a.last_seq,N).then(function(){A=!1,e.last_seq=D=a.last_seq,b()}).catch(u))}}function r(a){return J=!1,d.cancelled?o():(n("changes rejected",a),void 0)}function s(){function b(){f.cancel()}function e(){d.removeListener("cancel",b)}if(!J&&!B&&y.length<H){J=!0,d._changes&&(d.removeListener("cancel",d._abortChanges),d._changes.cancel()),d.once("cancel",b);var f=a.changes(O).on("change",p);f.then(e,e),f.then(q).catch(r),c.retry&&(d._changes=f,d._abortChanges=b)}}function t(){f().then(function(){return d.cancelled?(o(),void 0):x.getCheckpoint().then(function(a){D=a,O={since:D,limit:G,batch_size:G,style:"all_docs",doc_ids:K,selector:L,return_docs:!0},c.filter&&("string"!=typeof c.filter?O.include_docs=!0:O.filter=c.filter),"heartbeat"in c&&(O.heartbeat=c.heartbeat),"timeout"in c&&(O.timeout=c.timeout),c.query_params&&(O.query_params=c.query_params),c.view&&(O.view=c.view),s()})}).catch(function(a){n("getCheckpoint rejected with ",a)})}function u(a){A=!1,n("writeCheckpoint completed with error",a)}var v,w,x,y=[],z={seq:0,changes:[],docs:[]},A=!1,B=!1,C=!1,D=0,E=c.continuous||c.live||!1,G=c.batch_size||100,H=c.batches_limit||10,J=!1,K=c.doc_ids,L=c.selector,M=[],N=ne();e=e||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var O={};return d.ready(a,b),d.cancelled?(o(),void 0):(d._addedListeners||(d.once("cancel",o),"function"==typeof c.complete&&(d.once("error",c.complete),d.once("complete",function(a){c.complete(null,a)})),d._addedListeners=!0),"undefined"==typeof c.since?t():f().then(function(){return A=!0,x.writeCheckpoint(c.since,N)}).then(function(){return A=!1,d.cancelled?(o(),void 0):(D=c.since,t(),void 0)}).catch(u),void 0)}function xd(){Fd.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var a=this,b=new Promise(function(b,c){a.once("complete",b),a.once("error",c)});a.then=function(a,c){return b.then(a,c)},a.catch=function(a){return b.catch(a)},a.catch(function(){})}function yd(a,b){var c=b.PouchConstructor;return"string"==typeof a?new c(a,b):a}function zd(a,b,c,d){if("function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c.doc_ids&&!Array.isArray(c.doc_ids))throw F(ae,"`doc_ids` filter parameter is not a list.");c.complete=d,c=j(c),c.continuous=c.continuous||c.live,c.retry="retry"in c&&c.retry,c.PouchConstructor=c.PouchConstructor||this;var e=new xd(c),f=yd(a,c),g=yd(b,c);return wd(f,g,c,e),e}function Ad(a,b,c,d){return"function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c=j(c),c.PouchConstructor=c.PouchConstructor||this,a=yd(a,c),b=yd(b,c),new Bd(a,b,c,d)}function Bd(a,b,c,d){function e(a){o.emit("change",{direction:"pull",change:a})}function f(a){o.emit("change",{direction:"push",change:a})}function g(a){o.emit("denied",{direction:"push",doc:a})}function h(a){o.emit("denied",{direction:"pull",doc:a})}function i(){o.pushPaused=!0,o.pullPaused&&o.emit("paused")}function j(){o.pullPaused=!0,o.pushPaused&&o.emit("paused")}function k(){o.pushPaused=!1,o.pullPaused&&o.emit("active",{direction:"push"})}function l(){o.pullPaused=!1,o.pushPaused&&o.emit("active",{direction:"pull"})}function m(a){return function(b,c){var d="change"===b&&(c===e||c===f),m="denied"===b&&(c===h||c===g),n="paused"===b&&(c===j||c===i),p="active"===b&&(c===l||c===k);(d||m||n||p)&&(b in r||(r[b]={}),r[b][a]=!0,2===Object.keys(r[b]).length&&o.removeAllListeners(b))}}function n(a,b,c){a.listeners(b).indexOf(c)==-1&&a.on(b,c)}var o=this;this.canceled=!1;var p=c.push?Rd({},c,c.push):c,q=c.pull?Rd({},c,c.pull):c;this.push=zd(a,b,p),this.pull=zd(b,a,q),this.pushPaused=!0,this.pullPaused=!0;var r={};c.live&&(this.push.on("complete",o.pull.cancel.bind(o.pull)),this.pull.on("complete",o.push.cancel.bind(o.push))),this.on("newListener",function(a){"change"===a?(n(o.pull,"change",e),n(o.push,"change",f)):"denied"===a?(n(o.pull,"denied",h),n(o.push,"denied",g)):"active"===a?(n(o.pull,"active",l),n(o.push,"active",k)):"paused"===a&&(n(o.pull,"paused",j),n(o.push,"paused",i))}),this.on("removeListener",function(a){"change"===a?(o.pull.removeListener("change",e),o.push.removeListener("change",f)):"denied"===a?(o.pull.removeListener("denied",h),o.push.removeListener("denied",g)):"active"===a?(o.pull.removeListener("active",l),o.push.removeListener("active",k)):"paused"===a&&(o.pull.removeListener("paused",j),o.push.removeListener("paused",i))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var s=Promise.all([this.push,this.pull]).then(function(a){var b={push:a[0],pull:a[1]};return o.emit("complete",b),d&&d(null,b),o.removeAllListeners(),b},function(a){if(o.cancel(),d?d(a):o.emit("error",a),o.removeAllListeners(),d)throw a});this.then=function(a,b){return s.then(a,b)},this.catch=function(a){return s.catch(a)}}function Cd(a){a.replicate=zd,a.sync=Ad,Object.defineProperty(a.prototype,"replicate",{get:function(){var a=this;return"undefined"==typeof this.replicateMethods&&(this.replicateMethods={from:function(b,c,d){return a.constructor.replicate(b,a,c,d)},to:function(b,c,d){return a.constructor.replicate(a,b,c,d)}}),this.replicateMethods}}),a.prototype.sync=function(a,b,c){return this.constructor.sync(this,a,b,c)}}var Dd=e(a(1)),Ed=e(a(3)),Fd=a(2),Gd=e(a(4)),Hd=e(a(6)),Id=e(a(7)),Jd=e(a(12)),Kd=Function.prototype.toString,Ld=Kd.call(Object);q.prototype.get=function(a){var b=o(a);return this._store[b]},q.prototype.set=function(a,b){var c=o(a);return this._store[c]=b,!0},q.prototype.has=function(a){var b=o(a);return b in this._store},q.prototype.delete=function(a){var b=o(a),c=b in this._store;return delete this._store[b],c},q.prototype.forEach=function(a){for(var b=Object.keys(this._store),c=0,d=b.length;c<d;c++){var e=b[c],f=this._store[e];e=p(e),a(f,e)}},Object.defineProperty(q.prototype,"size",{get:function(){return Object.keys(this._store).length}}),r.prototype.add=function(a){return this._store.set(a,!0)},r.prototype.has=function(a){return this._store.has(a)},r.prototype.forEach=function(a){this._store.forEach(function(b,c){a(c)})},Object.defineProperty(r.prototype,"size",{get:function(){return this._store.size}});var Md,Nd;s()?(Md=Set,Nd=Map):(Md=r,Nd=q);var Od,Pd=6;try{localStorage.setItem("_pouch_check_localstorage",1),Od=!!localStorage.getItem("_pouch_check_localstorage")}catch(a){Od=!1}Gd(z,Fd.EventEmitter),z.prototype.addListener=function(a,b,c,d){function e(){function a(){g=!1}if(f._listeners[b]){if(g)return g="waiting",void 0;g=!0;var h=t(d,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);c.changes(h).on("change",function(a){a.seq>d.since&&!d.cancelled&&(d.since=a.seq,d.onChange(a))}).on("complete",function(){"waiting"===g&&Ed(e),g=!1}).on("error",a)}}if(!this._listeners[b]){var f=this,g=!1;this._listeners[b]=e,this.on(a,e)}},z.prototype.removeListener=function(a,b){b in this._listeners&&(Fd.EventEmitter.prototype.removeListener.call(this,a,this._listeners[b]),delete this._listeners[b])},z.prototype.notifyLocalWindows=function(a){x()&&(localStorage[a]="a"===localStorage[a]?"b":"a")},z.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)};var Qd;Qd="function"==typeof Object.assign?Object.assign:function(a){for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(null!=d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b};var Rd=Qd;Gd(E,Error),E.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var Sd=(new E(401,"unauthorized","Name or password is incorrect."),new E(400,"bad_request","Missing JSON list of 'docs'")),Td=new E(404,"not_found","missing"),Ud=new E(409,"conflict","Document update conflict"),Vd=new E(400,"bad_request","_id field must contain a string"),Wd=new E(412,"missing_id","_id is required for puts"),Xd=new E(400,"bad_request","Only reserved document ids may start with underscore."),Yd=(new E(412,"precondition_failed","Database not open"),new E(500,"unknown_error","Database encountered an unknown error")),Zd=new E(500,"badarg","Some query argument is invalid"),$d=(new E(400,"invalid_request","Request was invalid"),new E(400,"query_parse_error","Some query parameter is invalid")),_d=new E(500,"doc_validation","Bad special document member"),ae=new E(400,"bad_request","Something wrong with the request"),be=new E(400,"bad_request","Document must be a JSON object"),ce=(new E(404,"not_found","Database not found"),new E(500,"indexed_db_went_bad","unknown")),de=(new E(500,"web_sql_went_bad","unknown"),new E(500,"levelDB_went_went_bad","unknown"),new E(403,"forbidden","Forbidden by design doc validate_doc_update function"),new E(400,"bad_request","Invalid rev format")),ee=(new E(412,"file_exists","The database could not be created, the file already exists."),new E(412,"missing_stub","A pre-existing attachment stub wasn't found")),fe=(new E(413,"invalid_url","Provided URL is invalid"),["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]),ge="queryKey",he=/(?:^|&)([^&=]*)=?([^&]*)/g,ie=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,je=function(a){return atob(a)},ke=function(a){return btoa(a)},le=d.setImmediate||d.setTimeout,me=32768,ne=Id.v4;Gd(Da,Fd.EventEmitter),Da.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Da.prototype.validateChanges=function(a){var b=a.complete,c=this;Ra._changesFilterPlugin?Ra._changesFilterPlugin.validate(a,function(d){return d?b(d):(c.doChanges(a),void 0)}):c.doChanges(a)},Da.prototype.doChanges=function(a){var b=this,c=a.complete;if(a=j(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=Ea,"latest"===a.since&&(a.since="now"),a.since||(a.since=0),"now"===a.since)return this.db.info().then(function(d){return b.isCancelled?(c(null,{status:"cancelled"}),void 0):(a.since=d.update_seq,b.doChanges(a),void 0)},c),void 0;if(Ra._changesFilterPlugin){if(Ra._changesFilterPlugin.normalize(a),Ra._changesFilterPlugin.shouldFilter(this,a))return Ra._changesFilterPlugin.filter(this,a)}else["doc_ids","filter","selector","view"].forEach(function(b){b in a&&A("warn",'The "'+b+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in a||(a.descending=!1),a.limit=0===a.limit?1:a.limit,a.complete=c;var d=this.db._changes(a);if(d&&"function"==typeof d.cancel){var e=b.cancel;b.cancel=Dd(function(a){d.cancel(),e.apply(this,a)})}},Gd(Na,Fd.EventEmitter),Na.prototype.post=n("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a)?c(F(be)):(this.bulkDocs({docs:[a]},b,Ga(c,a._id)),void 0)}),Na.prototype.put=n("put",function(a,b,c){function d(){var c=a._rev.split("-"),d=c[1],e=parseInt(c[0],10),f=e+1,g=ga();a._revisions={start:f,ids:[g,d]},a._rev=f+"-"+g,b.new_edits=!1}function e(c){"function"==typeof f._put&&b.new_edits!==!1?f._put(a,b,c):f.bulkDocs({docs:[a]},b,Ga(c,a._id))}if("function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a))return c(F(be));if(K(a._id),Aa(a._id)&&"function"==typeof this._putLocal)return a._deleted?this._removeLocal(a,c):this._putLocal(a,c);var f=this;b.force&&a._rev?(d(),e(function(b){var d=b?null:{ok:!0,id:a._id,rev:a._rev};c(b,d)})):e(c)}),Na.prototype.putAttachment=n("putAttachment",function(a,b,c,d,e){function f(a){var c="_rev"in a?parseInt(a._rev,10):0;return a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d,revpos:++c},g.put(a)}var g=this;return"function"==typeof e&&(e=d,d=c,c=null),"undefined"==typeof e&&(e=d,d=c,c=null),e||A("warn","Attachment",b,"on document",a,"is missing content_type"),g.get(a).then(function(a){if(a._rev!==c)throw F(Ud);return f(a)},function(b){if(b.reason===Td.message)return f({_id:a});throw b})}),Na.prototype.removeAttachment=n("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){return a?(d(a),void 0):f._rev!==c?(d(F(Ud)),void 0):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,e.put(f,d),void 0):d()})}),Na.prototype.remove=n("remove",function(a,b,c,d){var e;"string"==typeof b?(e={_id:a,_rev:b},"function"==typeof c&&(d=c,c={})):(e=a,"function"==typeof b?(d=b,c={}):(d=c,c=b)),c=c||{},c.was_delete=!0;var f={_id:e._id,_rev:e._rev||c.rev};return f._deleted=!0,Aa(f._id)&&"function"==typeof this._removeLocal?this._removeLocal(e,d):(this.bulkDocs({docs:[f]},c,Ga(d,f._id)),void 0)}),Na.prototype.revsDiff=n("revsDiff",function(a,b,c){function d(a,b){h.has(a)||h.set(a,{missing:[]}),h.get(a).missing.push(b)}function e(b,c){var e=a[b].slice(0);ia(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);j!==-1&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={});var f=Object.keys(a);if(!f.length)return c(null,{});var g=0,h=new Nd;f.map(function(b){this._getRevisionTree(b,function(d,i){if(d&&404===d.status&&"missing"===d.message)h.set(b,{missing:a[b]});else{if(d)return c(d);e(b,i)}if(++g===f.length){var j={};return h.forEach(function(a,b){j[b]=a}),c(null,j)}})},this)}),Na.prototype.bulkGet=n("bulkGet",function(a,b){w(this,a,b)}),Na.prototype.compactDocument=n("compactDocument",function(a,b,c){var d=this;this._getRevisionTree(a,function(e,f){if(e)return c(e);var g=Ja(f),h=[],i=[];Object.keys(g).forEach(function(a){g[a]>b&&h.push(a)}),ia(f,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&h.indexOf(f)!==-1&&i.push(f)}),d._doCompaction(a,i,c)})}),Na.prototype.compact=n("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;a=a||{},c._compactionQueue=c._compactionQueue||[],c._compactionQueue.push({opts:a,callback:b}),1===c._compactionQueue.length&&La(c)}),Na.prototype._compact=function(a,b){function c(a){g.push(e.compactDocument(a.id,0))}function d(a){var c=a.last_seq;Promise.all(g).then(function(){return R(e,"_local/compaction",function(a){return(!a.last_seq||a.last_seq<c)&&(a.last_seq=c,a)})}).then(function(){b(null,{ok:!0})}).catch(b)}var e=this,f={return_docs:!1,last_seq:a.last_seq||0},g=[];e.changes(f).on("change",c).on("complete",d).on("error",b)},Na.prototype.get=n("get",function(a,b,c){function d(){var d=[],g=e.length;return g?(e.forEach(function(e){f.get(a,{rev:e,revs:b.revs,latest:b.latest,attachments:b.attachments,binary:b.binary},function(a,b){if(a)d.push({missing:e});else{for(var f,h=0,i=d.length;h<i;h++)if(d[h].ok&&d[h].ok._rev===b._rev){f=!0;break}f||d.push({ok:b})}g--,g||c(null,d)})}),void 0):c(null,d)}if("function"==typeof b&&(c=b,b={}),"string"!=typeof a)return c(F(Vd));if(Aa(a)&&"function"==typeof this._getLocal)return this._getLocal(a,c);var e=[],f=this;if(!b.open_revs)return this._get(a,b,function(d,e){if(d)return d.docId=a,c(d);var g=e.doc,h=e.metadata,i=e.ctx;if(b.conflicts){var j=la(h);j.length&&(g._conflicts=j)}if(za(h,g._rev)&&(g._deleted=!0),b.revs||b.revs_info){for(var k=g._rev.split("-"),l=parseInt(k[0],10),m=k[1],n=na(h.rev_tree),o=null,p=0;p<n.length;p++){var q=n[p],r=q.ids.map(function(a){return a.id}).indexOf(m),s=r===l-1;(s||!o&&r!==-1)&&(o=q)}var t=o.ids.map(function(a){return a.id}).indexOf(g._rev.split("-")[1])+1,u=o.ids.length-t;if(o.ids.splice(t,u),o.ids.reverse(),b.revs&&(g._revisions={start:o.pos+o.ids.length-1,ids:o.ids.map(function(a){return a.id})}),b.revs_info){var v=o.pos+o.ids.length;g._revs_info=o.ids.map(function(a){return v--,{rev:v+"-"+a.id,status:a.opts.status}})}}if(b.attachments&&g._attachments){var w=g._attachments,x=Object.keys(w).length;if(0===x)return c(null,g);Object.keys(w).forEach(function(a){this._getAttachment(g._id,a,w[a],{rev:g._rev,binary:b.binary,ctx:i},function(b,d){var e=g._attachments[a];e.data=d,delete e.stub,delete e.length,--x||c(null,g)})},f)}else{if(g._attachments)for(var y in g._attachments)g._attachments.hasOwnProperty(y)&&(g._attachments[y].stub=!0);c(null,g)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){return a?c(a):(e=ka(b).map(function(a){return a.rev}),d(),void 0)});else{if(!Array.isArray(b.open_revs))return c(F(Yd,"function_clause"));e=b.open_revs;for(var g=0;g<e.length;g++){var h=e[g];if("string"!=typeof h||!/^\d+-/.test(h))return c(F(de))}d()}}),Na.prototype.getAttachment=n("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),this._get(a,c,function(f,g){return f?d(f):g.doc._attachments&&g.doc._attachments[b]?(c.ctx=g.ctx,c.binary=!0,e._getAttachment(a,b,g.doc._attachments[b],c,d),void 0):d(F(Td))})}),Na.prototype.allDocs=n("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a.skip="undefined"!=typeof a.skip?a.skip:0,a.start_key&&(a.startkey=a.start_key),a.end_key&&(a.endkey=a.end_key),"keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return b(F($d,"Query parameter `"+c+"` is not compatible with multi-get")),void 0;if(!L(this)&&(Ka(a),0===a.keys.length))return this._allDocs({limit:0},b)}return this._allDocs(a,b)}),Na.prototype.changes=function(a,b){return"function"==typeof a&&(b=a,a={}),a=a||{},a.return_docs="return_docs"in a?a.return_docs:!a.live,new Da(this,a,b)},Na.prototype.close=n("close",function(a){return this._closed=!0,this.emit("closed"),this._close(a)}),Na.prototype.info=n("info",function(a){var b=this;this._info(function(c,d){return c?a(c):(d.db_name=d.db_name||b.name,d.auto_compaction=!(!b.auto_compaction||L(b)),d.adapter=b.adapter,a(null,d),void 0)})}),Na.prototype.id=n("id",function(a){return this._id(a)}),Na.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Na.prototype.bulkDocs=n("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=b||{},Array.isArray(a)&&(a={docs:a}),!a||!a.docs||!Array.isArray(a.docs))return c(F(Sd));for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(F(be));var e;if(a.docs.forEach(function(a){a._attachments&&Object.keys(a._attachments).forEach(function(b){e=e||Ma(b),a._attachments[b].content_type||A("warn","Attachment",b,"on document",a._id,"is missing content_type")})}),e)return c(F(ae,e));"new_edits"in b||("new_edits"in a?b.new_edits=a.new_edits:b.new_edits=!0);var f=this;b.new_edits||L(f)||a.docs.sort(Ia),Ha(a.docs);var g=a.docs.map(function(a){return a._id});return this._bulkDocs(a,b,function(a,d){if(a)return c(a);if(b.new_edits||(d=d.filter(function(a){return a.error})),!L(f))for(var e=0,h=d.length;e<h;e++)d[e].id=d[e].id||g[e];c(null,d)})}),Na.prototype.registerDependentDatabase=n("registerDependentDatabase",function(a,b){function c(b){return b.dependentDbs=b.dependentDbs||{},!b.dependentDbs[a]&&(b.dependentDbs[a]=!0,b)}var d=new this.constructor(a,this.__opts);R(this,"_local/_pouch_dependentDbs",c).then(function(){b(null,{db:d})}).catch(b)}),Na.prototype.destroy=n("destroy",function(a,b){function c(){d._destroy(a,function(a,c){return a?b(a):(d._destroyed=!0,d.emit("destroyed"),b(null,c||{ok:!0}),void 0)})}"function"==typeof a&&(b=a,a={});var d=this,e=!("use_prefix"in d)||d.use_prefix;return L(d)?c():(d.get("_local/_pouch_dependentDbs",function(a,f){if(a)return 404!==a.status?b(a):c();var g=f.dependentDbs,h=d.constructor,i=Object.keys(g).map(function(a){var b=e?a.replace(new RegExp("^"+h.prefix),""):a;return new h(b,d.__opts).destroy()});Promise.all(i).then(c,b)}),void 0)}),Oa.prototype.execute=function(){var a;if(this.failed)for(;a=this.queue.shift();)a(this.failed);else for(;a=this.queue.shift();)a()},Oa.prototype.fail=function(a){this.failed=a,this.execute()},Oa.prototype.ready=function(a){this.isReady=!0,this.db=a,this.execute()},Oa.prototype.addTask=function(a){this.queue.push(a),this.failed&&this.execute()},Gd(Ra,Na);var oe="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},pe=fetch,qe=Headers;Ra.adapters={},Ra.preferredAdapters=[],Ra.prefix="_pouch_";var re=new Fd.EventEmitter;Sa(Ra),Ra.adapter=function(a,b,c){b.valid()&&(Ra.adapters[a]=b,c&&Ra.preferredAdapters.push(a))},Ra.plugin=function(a){if("function"==typeof a)a(Ra);else{if("object"!=typeof a||0===Object.keys(a).length)throw new Error('Invalid plugin: got "'+a+'", expected an object or a function');Object.keys(a).forEach(function(b){Ra.prototype[b]=a[b]})}return this.__defaults&&(Ra.__defaults=Rd({},this.__defaults)),Ra},Ra.defaults=function(a){function b(a,c){return this instanceof b?(c=c||{},a&&"object"==typeof a&&(c=a,a=c.name,delete c.name),c=Rd({},b.__defaults,c),Ra.call(this,a,c),void 0):new b(a,c)}return Gd(b,Ra),b.preferredAdapters=Ra.preferredAdapters.slice(),Object.keys(Ra).forEach(function(a){a in b||(b[a]=Ra[a])}),b.__defaults=Rd({},this.__defaults,a),b},Ra.fetch=function(a,b){return pe(a,b)};var se="7.0.0",te=["$or","$nor","$not"],ue=-324,ve=3,we="",xe={$elemMatch:function(a,b,c,d){return!!Array.isArray(d)&&(0!==d.length&&("object"==typeof d[0]?d.some(function(a){return tb(a,b,Object.keys(b))}):d.some(function(d){return ub(b,a,c,d)})))},$allMatch:function(a,b,c,d){return!!Array.isArray(d)&&(0!==d.length&&("object"==typeof d[0]?d.every(function(a){return tb(a,b,Object.keys(b))}):d.every(function(d){return ub(b,a,c,d)})))},$eq:function(a,b,c,d){return yb(d)&&0===fb(d,b)},$gte:function(a,b,c,d){return yb(d)&&fb(d,b)>=0},$gt:function(a,b,c,d){return yb(d)&&fb(d,b)>0},$lte:function(a,b,c,d){return yb(d)&&fb(d,b)<=0},$lt:function(a,b,c,d){return yb(d)&&fb(d,b)<0},$exists:function(a,b,c,d){return b?yb(d):!yb(d)},$mod:function(a,b,c,d){return xb(d)&&zb(d,b)},$ne:function(a,b,c,d){return b.every(function(a){return 0!==fb(d,a)})},$in:function(a,b,c,d){return xb(d)&&Ab(d,b)},$nin:function(a,b,c,d){return xb(d)&&!Ab(d,b)},$size:function(a,b,c,d){return xb(d)&&Cb(d,b)},$all:function(a,b,c,d){return Array.isArray(d)&&Bb(d,b)},$regex:function(a,b,c,d){return xb(d)&&Db(d,b)},$type:function(a,b,c,d){return Eb(d,b)}};Ra.plugin(Mb),Ra.version=se;var ye,ze=Nb(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Ae=Nb(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),Be=5,Ce="document-store",De="by-sequence",Ee="attach-store",Fe="attach-seq-store",Ge="meta-store",He="local-store",Ie="detect-blob-support",Je=new z,Ke=!1,Le=[],Me=new Nd,Ne=new Nd;uc.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(a){return!1}};var Oe=25,Pe=50,Qe=5e3,Re=1e4,Se={};Hc.valid=function(){return!0},Gd(Jc,Error),Gd(Kc,Error),Gd(Lc,Error);var Te=A.bind(null,"log"),Ue=Array.isArray,Ve=JSON.parse;Vc.prototype.add=function(a){return this.promise=this.promise.catch(function(){}).then(function(){return a()}),this.promise},Vc.prototype.finish=function(){return this.promise};var We={},Xe=new Vc,Ye=50,Ze={_sum:function(a,b){return Tc(b)},_count:function(a,b){return b.length},_stats:function(a,b){function c(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];b+=e*e}return b}return{sum:Tc(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:c(b)}}},$e="mrviews",_e=ad($e,cd,dd,ed),af={query:fd,viewCleanup:gd},bf=1,cf="pouchdb",df=5,ef=0;od.prototype.writeCheckpoint=function(a,b){var c=this;return this.updateTarget(a,b).then(function(){return c.updateSource(a,b)})},od.prototype.updateTarget=function(a,b){return this.opts.writeTargetCheckpoint?nd(this.target,this.id,a,b,this.returnValue):Promise.resolve(!0)},od.prototype.updateSource=function(a,b){if(this.opts.writeSourceCheckpoint){var c=this;return nd(this.src,this.id,a,b,this.returnValue).catch(function(a){if(sd(a))return c.opts.writeSourceCheckpoint=!1,!0;throw a})}return Promise.resolve(!0)};var ff={undefined:function(a,b){return 0===fb(a.last_seq,b.last_seq)?b.last_seq:0},1:function(a,b){return pd(b,a).last_seq}};od.prototype.getCheckpoint=function(){var a=this;return a.opts&&a.opts.writeSourceCheckpoint&&!a.opts.writeTargetCheckpoint?a.src.get(a.id).then(function(a){return a.last_seq||ef}).catch(function(a){if(404!==a.status)throw a;return ef}):a.target.get(a.id).then(function(b){return a.opts&&a.opts.writeTargetCheckpoint&&!a.opts.writeSourceCheckpoint?b.last_seq||ef:a.src.get(a.id).then(function(a){if(b.version!==a.version)return ef;var c;return c=b.version?b.version.toString():"undefined",c in ff?ff[c](b,a):ef},function(c){if(404===c.status&&b.last_seq)return a.src.put({_id:a.id,last_seq:ef}).then(function(){return ef},function(c){return sd(c)?(a.opts.writeSourceCheckpoint=!1,b.last_seq):ef});throw c})}).catch(function(a){if(404!==a.status)throw a;return ef})};var gf=0;Gd(xd,Fd.EventEmitter),xd.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},xd.prototype.ready=function(a,b){function c(){e.cancel()}function d(){a.removeListener("destroyed",c),b.removeListener("destroyed",c)}var e=this;e._readyCalled||(e._readyCalled=!0,a.once("destroyed",c),b.once("destroyed",c),e.once("complete",d))},Gd(Bd,Fd.EventEmitter),Bd.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Ra.plugin(wc).plugin(Ic).plugin(af).plugin(Cd),b.exports=Ra}).call(this,a(5),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,12:12,2:2,3:3,4:4,5:5,6:6,7:7}]},{},[13])(13)});