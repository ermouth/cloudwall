/*CloudWall 2.2.2 system manifests (c) 2017 ermouth*/
!function(a,b,c){var d=Object.merge({},a),e=Object.clone(b);[{id:"cw.Sys.Attachments",build:67,params:{width:400},data:{doc:{},sort:function(a,b,c){return b},width:200,truncate:200,limit:1e7,ico:function(a,b){var c="fi-paperclip",d={"fi-photo":/\.(png|jp[e]?g|gif|tif[f]?|bmp)$/i,"fi-social-adobe":/\.(pdf|ai|psd)$/i,"fi-page-doc":/\.(doc[x]?|txt|rtf)$/i,"fi-graph-pie":/\.(xls[x]?|csv)$/i,"fi-archive":/\.(zip|rar|7z|7zip)$/i,"fi-html5 pl2":/\.(htm[l]|php)$/i,"fi-css3 pl2":/\.css$/i,"fi-widget":/\.(js[on]?|php|asp|jar|c|erl)$/i,"fi-sound":/\.(wav|aiff|mp3|ogg|mpeg3)$/i};return a.digest?Object.each(d,function(a,d){d.test(b)&&(c=a)}):c="orange fi-burst-new",'<span class="'+c+' dib vam o80 lh110" style="width:1.3em;"></span>'},aux:function(a,b,c){return""},css:"cw-att-files",itemCss:"cw-att-item hoverlink",uploadCss:"mt5",accept:"",namePopup:!1,previews:null,files:[],noDelete:function(a,b){return!1}},init:function(a,b){function c(b,c){var d,h,i=450,j=e.extend({Lang:f.Lang},f.ModalManageAtt,!0),k=!1;if(Object.size(c)){d=c[Object.keys(c)[0]],h=d.url||"data:"+d.content_type+";base64,"+d.data,/^image/.test(d.content_type)&&(i=(e(window).width()-120).clamp(800,1200));try{k=!!g.noDelete(b,g.doc)}catch(a){}e.my.modal({manifest:j,data:{name:b,size:d.size,digest:d.digest,url:h,mime:d.content_type,noDelete:k},width:i,esc:!0}).then(function(c){Object.isObject(c)&&"delete"===c.cmd&&(delete g.doc._attachments[b],a.find("#att-fpanel").trigger("redraw"),a.trigger("change"))})}}var f=this,g=b.data;d.lib.unjson(g);var h=f.lang._LANG;f.Lang=f.Lang[h],g.download||(g.download=function(a,b,c){return f.Lang.MANAGE}),g.upload||(g.upload='<span class="pseudolink">'+f.Lang.UPLOAD+"</span>"),a.addClass(g.css),a.html('<div id="att-flist"></div><div id="att-fpanel"></div><div class="mt5 '+g.uploadCss+'"><span class="cw-att-upload"></span><input id="upload" type="file" '+(g.accept?'accept="'+g.accept+'" ':"")+"/></div>"),a.on("click.my",".cw-att-dl",function(){var a,b=e(this).data("fname");e(this).attr("title");if(g.doc._attachments&&g.doc._attachments[b]&&!g.doc._attachments[b].stub){var f={};f[b]=g.doc._attachments[b],null!=f[b].data&&c(b,f)}else{try{a=d.db(g.doc._db).att(g.doc._id)}catch(a){}a&&a.url(b).then(c.fill(b))}})},Unfold:function(a,b,c){var d;try{Object.isFunction(a)?d=a(b,b.name,c):"string"==typeof a&&(d=a)}catch(a){}return d},Attachment:{data:{name:"",title:"",ext:"",ico:"",aux:"",dl:"",desc:""},init:function(a,b){var c=b.data;a.html(c.ico+'<div class="dib vat oh"><div class="oh" style="white-space:nowrap">'+(c.dl?'<span class="cw-att-iblock pseudolink cw-att-dl lh110" title="'+c.dl+'" data-fname="'+c.name+'">':"")+'<span class="cw-att-fname"></span><span class="cw-att-ext"></span><div class="cw-att-desc"></div>'+(c.dl?"</span>":"")+"</div>"+(c.aux?'<div class="cw-att-aux">'+c.aux+"</div>":"")+"</div>")},ui:{".cw-att-fname":"title",".cw-att-ext":"ext",".cw-att-desc":"desc",".cw-att-iblock":{css:{fs90:function(a){var b=a.title||a.name,c=b.length,d=b.replace(/[^A-HJ-SU-Zmw02-9А-Яжмшщю]+/g,"").length;return c>15&&d>2&&d<6},fs85:function(a){var b=a.title||a.name,c=b.length,d=b.replace(/[^A-HJ-SU-Zmw02-9А-Яжмшщю]+/g,"").length;return c>15&&d>5}}}}},ModalManageAtt:{data:{name:"",size:"",url:"",mime:"",cmd:""},MaxH:600,init:function(a,b){var c=this,d="",f=b.data,g=+(f.size||f.length||0),h=c.Lang;/^image/.test(f.mime)&&(d+='<div class="w100p tac"><img src="'+f.url+'" class="dib mb15" id="iimg" style="max-width:100%; max-height:'+c.MaxH+'px;" /></div>'),d+='<div class="lh110 fs130 xgray" style="word-break: break-all;">'+f.name+"</div>",d+='<div class="lh110 fs90 gray mt5">'+g.format(0," ")+" byte"+(/(^1|[02-9]1)$/.test(g+"")?"":"s")+(f.digest?"":h.UNSAVED)+"</div>",d+='<div class="my-row pt15 mt20 btd fs85 mb-5"><span class="button teal hide mr5" id="btn-rot"><span class="fi-refresh fs90"></span> '+h.ROT90+'</span><a class="button tdn green mr5" href="'+f.url+'" target="_blank" download="'+f.name+'"><span class="fi-download fs90"></span> '+h.DOWNLOAD+"</a>"+(/.+\.(jp[e]?g|png|tif[f]?|pdf|txt|js|css|htm[l])$/i.test(f.name)?'<a class="button tdn green mr5" href="'+f.url+'" target="_blank"><span class="fi-eye fs90"></span> '+h.VIEW+"</a>":"")+'<span class="button red" id="btn-del"><span class="fi-trash fs90"></span> '+h.DEL+'</span><div class="fr"><span class="button" id="btn-cancel">'+h.CANCEL+"</span></div></div>",a.html(d),a.on("click","a",function(){(function(){a.trigger("cancel")}).delay(100)}),a.on("click","#iimg",function(b){var d=e(b.target);if(d.removeClass("irot1 irot2 irot3"),"3"==d.data("rot"))d.data("rot","0"),d.parent().css("padding-top","0px").innerHeight(d.data("dim").h.clamp(0,c.MaxH));else{d.data("rot")||(d.data("rot","0"),d.data("dim",{w:d.width(),h:d.height()})),d.data("rot",+d.data("rot")+1),d.addClass("irot"+d.data("rot"));var f=d.data("dim");d.data("rot")%2?(f.w>f.h&&d.parent().css("padding-top",(f.w-f.h)/2+"px"),d.parent().innerHeight(f.w.clamp(0,c.MaxH))):d.parent().innerHeight(f.h).css("padding-top","0px")}a.trigger("layout")})},ui:{"#btn-cancel":{bind:function(a,b,c){null!=b&&c.trigger("cancel")},events:"click.my"},"#btn-del":{bind:function(a,b,c){null!=b&&(a.cmd="delete",c.trigger("commit"))},events:"click.my",css:{"self:hide":function(a){return!!a.noDelete}}},"#btn-rot":{bind:function(a,b,c){null!=b&&this.my.find("#iimg").trigger("click")},events:"click.my",css:{"self:hide":function(a){return!/^image/.test(a.mime)}}}},style:{"":function(a){var b,c,d=this;return b=d.MaxH=e(window).height()-230,c=e(window).width()-200,{" #iimg":"transition: width 0.1s, height 0.1s;"," .irot1":"transform:rotate(90deg);max-height:"+c+"px!important;max-width:"+b+"px!important;"," .irot2":"transform:rotate(180deg);"," .irot3":"transform:rotate(270deg);max-height:"+c+"px!important;max-width:"+b+"px!important;"}}}},ui:{"#att-flist":{init:function(a){var b=navigator.userAgent,c="";/Mac.+Firefox/.test(b)?c="scroll":(/Mac.+Chrome\//.test(b)||/Mac.+Safari/.test(b)||/Mac.+Opera/.test(b))&&(c="overlay"),a.css({"overflow-x":"hidden"}),c?a.css({"overflow-y":c}):e.fn.niceScroll?a.niceScroll({zindex:7}):a.css({"overflow-y":"auto"})},bind:"files",check:!0,manifest:"Attachment",list:'<div class="cw-att-item hoverlink"></div>'},"#att-fpanel":{bind:function(a,b,c){var d,e=a.doc._attachments,f=[],g=this.Unfold;if(e&&Object.size(e)){for(d in e)f.push(Object.merge({name:d},e[d]));f=f.filter(function(b,c){var d=!0;try{Object.isFunction(a.sort)?d=!!a.sort(b,b.name,a.doc):Object.isRegExp(a.sort)&&(d=a.sort.test(b.name))}catch(a){}return d}).sortBy(function(b,c){var d=b.fname;if(Object.isFunction(a.sort))try{d=a.sort(b,b.name,a.doc)}catch(a){}return d});var h=a.previews&&a.doc[a.previews]?a.doc[a.previews]:{};a.files=f.map(function(b,c){var d={name:b.name,ext:(b.name.match(/\.[^\.]+$/)||[""])[0],aux:g(a.aux,b,a.doc),ico:g(a.ico,b,a.doc),dl:g(a.download,b,a.doc)};return d.title=(b.name.match(/(.+)(?:\.[^\.]+$)/)||[0,b.name])[1].truncate(a.truncate-d.ext.length,"middle"),h[b.name]&&(d.desc=[h[b.name].dim,h[b.name].size].compact(!0).join(", ")),null===d.data?null:d}).compact()}else a.files=[];c.my("find","#att-flist").trigger("redraw")}},"#upload":{bind:function(a,b,c){function f(a,b){var c=a+"",d=c.split("."),e=isNaN(b)?60:+b;c=d.length>1?d.to(-1).join(".").truncate(e,"middle","_")+"."+d.last().toLowerCase():c.toLowerCase().truncate(e,"middle","_");var f="аa бb вv гg дd еe ёyo жzh зz иi йiy кk лl мm нn оo пp рr сs тt уu фf хh цts чch шsh щsch ъ- ыy ь- эe юyu яya".split(" ").reduce(function(a,b){var c=b.to(1),d=b.from(1);return a[c]=d,a[c.toUpperCase()]=d.toUpperCase(),a},{});return c=c.split("").map(function(a){return f[a]?f[a]:/[a-z0-9\.\-_~]/i.test(a)?a:"-"}).join("").replace(/-+/g,"-").replace(/^_/,""),c}var g,h,i=this,j={};null!=b&&b&&(g=c[0].files[0],g.size>a.limit?(d.lib.note(i.Lang.TOO_LARGE.assign((1*a.limit).abbr(1)),"error"),c.wrap("<form>").closest("form").get(0).reset()):g&&function(){function b(){c.wrap("<form>").closest("form").get(0).reset(),c.my("find","#att-fpanel").trigger("redraw")}function d(c,d){c&&d&&(a.doc._attachments[c]=d),a.previews&&d?(a.doc[a.previews]||(a.doc[a.previews]={}),/^image\/(png|jpeg|gif|svg\+xml)$/.test(d.content_type)?i.GenPreview(c,d).always(b):(delete a.doc[a.previews][c],b())):b()}j.content_type=g.type||"application/octet-stream";var k,l=new FileReader,m=[];l.onload=function(b){k=new Uint8Array(b.target.result);for(var c=0;c<k.length;c++)m.push(String.fromCharCode(k[c]));h=window.btoa(m.join("")),j.data=h,j.size=m.length,a.doc._attachments||(a.doc._attachments={});var l=f(g.name);a.namePopup?e.my.modal({width:400,manifest:{init:['<div class="mb10 blue-1 fs110">'+i.Lang.ATTACHMENT+"</div>",{row:"400px"},["","inp#fname.w100p.fs90",{plc:i.Lang.FILENAME},"msg"],["","but#btn-fapply.mt15.mr4",{txt:"Ок"},"but#btn-fcancel.mt15",{txt:i.Lang.CANCEL}]],ui:{"#fname":{bind:"fname",check:function(a,b){return/^_/i.test(b)?i.Lang.FILENAME_ERR_U:/^[a-z0-9\-_~][a-z0-9\.\-_~]{2,64}$/i.test(b)?void 0:i.Lang.FILENAME_ERR}},"#btn-fapply":{bind:function(a,b){null!=b&&this.my.commit()},watch:"#fname",css:{":disabled":function(){return!this.my.valid()}}},"#btn-fcancel":function(a,b){null!=b&&this.my.cancel()}}},data:{fname:l.toLowerCase()},esc:!1,screen:!0,enter:!0,close:!1}).then(function(a){d(f(a.fname),j)},function(){j=null,d()}):d(l,j)},l.readAsArrayBuffer(g)}())},css:{hide:function(a){return!a.upload}}},".cw-att-upload":"upload"},style:{" .cw-att-item":"white-space:nowrap; overflow:hidden; padding:0.2em 0 0.2em 0; line-height:1.4em;"," input[type=file]":"width:100%;cursor:pointer;opacity:0; position:absolute;top:0;left:0;height:1.5em"},Lang:{en:{CANCEL:"Cancel",UPLOAD:"Upload file...",MANAGE:"Manage attachment...",ROT90:"Rot 90º",DOWNLOAD:"Download",VIEW:"View",DEL:"Delete",UNSAVED:", not yet stored to DB",TOO_LARGE:"Max upload file size is {1}b",ATTACHMENT:"Attachment",FILENAME:"New file name",FILENAME_ERR:"2…64 chars, a-z, 0-9 and -_~",FILENAME_ERR_U:"File name can’t start with underscore"},ru:{CANCEL:"Закрыть",UPLOAD:"Загрузить файл...",MANAGE:"Просмотр...",ROT90:"90º",DOWNLOAD:"Скачать",VIEW:"Просмотр",DEL:"Удалить",UNSAVED:", ещё не сохранён в БД",TOO_LARGE:"Максимальный размер файла {1}b",ATTACHMENT:"Новый файл",FILENAME:"Имя файла",FILENAME_ERR:"2…64 символа a-z, 0-9 и -_~",FILENAME_ERR_U:"Имя файла не может начинаться с _"}},GenPreview:function(a,b){var c=this,f=e('<img src=""/>'),g=e.Deferred();return f.attr("src","data:"+b.content_type+";base64,"+b.data),f.load(function(){var e=f[0].naturalWidth,h=f[0].naturalHeight,i=d.lib.image(f,"white").resample(150),j=b.data.length/4*3|0;i.height()>150&&i.resample(22500/i.height());var k=c.data.doc[c.data.previews];k||(k=c.data.doc[c.data.previews]={}),k[a]={fname:a,size:j.metric(j>1e6?2:0,!1).replace(/([a-z])$/i," $1")+"b",desc:"",dim:e+"×"+h,data:i.sharpen("image/jpeg"==b.content_type?.2:.4).contrast(1.05).jpeg(.75)},f.remove(),g.resolve(k[a])}),g.promise()},lang:{en:{},ru:{}}},{id:"cw.Sys.Colorpicker",build:63,Mode:!1,init:function(a,b){var c=this,d=b.data,e=this.HTML.assign(b.data);a.html(e),d.css&&(c.Mode="rgb"),a.then(function(){c.Mode=!1}.debounce(300))},Render:function(a,b){var c,d=this.data;this.Color;c=b?b:function(a){var b=a.max(),c=a.min();if(b==c)return[255,0,0];if(255==b&&0==c)return a;var d=255/(b-c);return a.map(function(a){return(d*(a-c)).clamp(0,255).round()})}(d.rgba.to(3).map(parseFloat)),a.my("find",".clr0").css({"background-color":"rgb("+c.join(",")+")"}),a.my("find",".clr1").css({"background-color":"rgb("+d.rgba.to(3).join(",")+")"}),a.my("find","#cpwatch").css({"background-color":"rgba("+d.rgba.join(",")+")"})},InitRgb:!1,HTML:'<div class="cpick">\n\t<div class="clr0"></div>\n\t<div class="clr1"></div>\n\t<div class="i2"></div>\n\t<div class="i1"></div>\n\t<div id="cpwatch"></div>\n\t<div class="slframe">\n\t\t<div class="slptr"></div>\n\t</div>\n\t<div class="hframe">\n\t\t<div class="hptr"></div>\n\t</div>\n\t<div class="aframe">\n\t\t<div class="aptr"></div>\n\t</div>\n\t<div class="cpinputs">\n\t\t<div><input type="text" id="cprgb" placeholder="#RRGGBBB or rgba(r, g, b, alpha)" \n\t\t\tstyle="width:256px;display:block;" value="{css}"/></div>\n\t\t<div><span class="cplabel">H</span><input type="number" id="cphue" \n\t\tmin="0" max="359" style="width:84px;padding-left:30px;margin-right:4px;" /><span \n\t\tclass="cplabel">S</span><input type="number" id="cpsat" \n\t\tmin="0" max="100" style="width:82px;padding-left:30px;margin-right:4px;" /><span \n\t\tclass="cplabel">B</span><input type="number" id="cpbri" \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t min="0" max="100" style="width:82px;padding-left:30px;" /></div>\n\t</div>\n\t<div style="display:none;" id="hsb2Color"></div>\n\t<div id="btnframe">\n\t\t<button id="btn-clrapply">Apply</button><button id="btn-clrcancel">Cancel</button>\n\t</div>\n</div>',Rgb2hsb:function(a){var b,c,d=[],e=(this.Color,Math.min(a[0],a[1],a[2])),f=Math.max(a[0],a[1],a[2]);if(c=100*f/255,b=0==c?0:100*(f-e)/f,0==b)d[0]=0;else{var g=255/(f-e),h=g*(a[0]-e),i=g*(a[1]-e),j=g*(a[2]-e),k=0;h>=254.99?k=+i-j:i>=254.99?k=510+j-h:j>=254.99&&(k=1020+h-i),d[0]=((360+360*k/1530)%360).round()}return d[1]=b.round(),d[2]=c.round(),d},params:{delay:5},data:{css:"#818283",apply:"Apply",cancel:"Cancel",rgba:[],hsb:[]},Color:{sl:{top:0,left:255},h:{top:0,left:.125},a:{top:0,left:191},base:[0,0,0]},ui:{"#cprgb":{init:function(a,b){a.on("blur.my",function(){e(this).val(b.data.css)})},recalcDepth:1,bind:function(a,b,c){var d,e=!1,f=b;if(this.InitRgb||(f=a.css,this.InitRgb=!0),null!=f){if(/^(#[0-9a-f]{3}|#[0-9a-f]{6})$/i.test(f))d=4==f.length?[parseInt(f[1]+f[1],16),parseInt(f[2]+f[2],16),parseInt(f[3]+f[3],16),1]:[parseInt(f[1]+f[2],16),parseInt(f[3]+f[4],16),parseInt(f[5]+f[6],16),1],e=!0;else if(/^rgb[a]?\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*(,\s*(0(\.\d+)?|1)\s*)?\)\s*$/.test(f)){var d=f.split("(")[1].split(")")[0].replace(/\s/g,"").split(",");4!=d.length&&(d[3]=1),e=!0}if(e){a.rgba=d.slice(0),a.hsb=this.Rgb2hsb(a.rgba),1==d[3]?a.css="#"+d.to(3).map(function(a){return a.toString(16).padLeft(2,"0")}).join("").toUpperCase():a.css="rgba("+d.join(",")+")";var g=this.Color;return g.h.left=a.hsb[0]/359*191,g.sl.left=a.hsb[1]/100*255,g.sl.top=128-a.hsb[2]/100*128,g.a.left=191*a.rgba[3],this.Render(c),f}return f}return a.css},watch:"#cpwatch",recalc:"#cphue,#cpsat,#cpbri,.slptr,.aptr,.hptr"},"#cpwatch":{bind:function(a,b,c){var d,e,f,g,h,i,j=this,k=j.Color,l=255-k.sl.left.clamp(0,255),m=128-k.sl.top,n=k.h.left,o=k.a.left;"rgb"!=j.Mode&&(d=n<32?255:n<64?256-8*(n-31):n<128?0:n<160?8*(n-128):255,e=n<32?8*n:n<96?255:n<128?256-8*(n-95):0,f=n<64?0:n<96?8*(n-63):n<160?255:256-8*(n-159),c.my("find",".clr0").css({"background-color":"rgb("+[0|d,0|e,0|f].join(",")+")"}),g=[0|d,0|e,0|f],h=[d,e,f].map(function(a){if(l<1)return 0|a;var b=255-a,c=l/255;return 0|(a+b*c).clamp(0,255.999)}).map(function(a){if(m>127)return a;var b=2*m/255;return 0|(a*b).clamp(0,255.999)}),i=h.slice(0).add(+(o/191).format(2)),191==o?a.css="#"+h.map(function(a){return a.toString(16).padLeft(2,"0")}).join("").toUpperCase():a.css="rgba("+i.join(",")+")",a.hsb=[(359*n/191).round(),((255-l)/2.55).round(),(m/1.28).round()],a.rgba=i.slice(0),this.Render(c,g))},watch:".slptr,.aptr,.hptr"},"#hsb2Color":{bind:function(a,b,c){var d=this.Color;d.h.left=a.hsb[0]/359*191,d.sl.left=a.hsb[1]/100*255,d.sl.top=128-a.hsb[2]/100*128},recalc:".slptr,.aptr,.hptr,#cpwatch,#cprgb",watch:"#cphue,#cpsat,#cpbri"},".slptr":{delay:0,bind:"this.Color.sl",init:function(a){a.draggable({containment:"parent"})}},".hptr":{delay:0,bind:"this.Color.h",init:function(a){a.draggable({containment:"parent",axis:"x"})}},".aptr":{delay:0,bind:"this.Color.a",init:function(a){a.draggable({containment:"parent",axis:"x"})}},"#cphue":{bind:function(a,b,c){return null!=b&&(isNaN(b)?a.hsb[0]=0:a.hsb[0]=parseInt(b+"").clamp(0,359)),a.hsb[0]},watch:"#cpwatch"},"#cpsat":{bind:function(a,b,c){return null!=b&&(isNaN(b)?a.hsb[1]=0:a.hsb[1]=parseInt(b+"").clamp(0,100)),a.hsb[1]},watch:"#cpwatch"},"#cpbri":{bind:function(a,b,c){return null!=b&&(isNaN(b)?a.hsb[2]=0:a.hsb[2]=parseInt(b+"").clamp(0,100)),a.hsb[2]},watch:"#cpwatch"},"#btn-clrcancel":{bind:function(a,b,c){return null!=b&&this.my.cancel(),a.cancel}},"#btn-clrapply":{bind:function(a,b,c){return null!=b&&this.my.commit(),a.apply}}},style:{"":'font-family:"PT Mono", Monaco, monospace;color:#89a;'," .i1":"z-index:+2;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/JJREFUeNrs2+tymkAAgNElsU00b8P7P4OPU3Jlq3ZJN9uF4OVHB86Z2cGAK4rkC9ZpEw/CH3OWY7fzdVP3P3fdOdtvNfor79OfsX7Oukvuc83Pt37sS+9z7rG81ft3y3HJOf3durHftbm/o1+WdwFYLQEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQABAABwCEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQACA/9PmMBqHAVwBAAIACACwin8DWLemiaej8DMbj9nYZmOXjaeR28PI5w2P9ZDt40cI8T6Et/B3vGTjORtdGr8qy3x0xXjOlsPjvqZx3N/7YfThPp0G6UmdnuQwtpUDkb/Asdvli98Wj5sdhOO+39MTGp5cfiC64iB0xYufut0VBzF/3GF/h33ffYQvp8DDyCmwq4ynkfW7yttfngKb01/gj/ROvFbOgm7kLJjzwsuz4KV6FrgCAB8BAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEAbqKJMToK4AoAEABAAIDl2zgEoU/LmI3Tz/v9PtbWH0fbtuW2z5HN68tt2bxyWz8xr0/z8vX9xLx+ZF6+HOZVt1Xm5furzkmvr585b2x//9wnzavOnTGvtn14ntVtI68v319tW21enJhXe9/jxLyp8+y78zMU80La7goAfAQABAAQAEAAAAEAFmv1XwMevxIZ07ateeYtep4rAPARABAAQAAAAQAEAFiq1X8N6Ksi89Y4b9juCgB8BAAEABAAQAAAAQCWyv8G9FWReSue5woAfAQABAAQAEAAAAEAlqqJMToK4AoAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAOBavwUYAJ4ctbuzEBaFAAAAAElFTkSuQmCC');"," .i2":"z-index:+3;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9FJREFUeNrs3X1nUAEchuH2Yk0ppcyUJJkkSRKZGUkkkUgi0WdLJJFIIokkkSRJkiQpSWlKqenlVPQVIu7r4nyBh3P7nb/OyDAMS4CmEQEAAQCKAfj7ANEAjJoBugEYMwN0AzBuBugGYMIM0A3AUjNANwCTZoBuAJaZAboBWG4G6AZghRmgG4CVZoBuAFaZAboBWG0G6AZgjRmgG4C1ZoBuAKbMAN0ATJsBugFYZwboBmC9GaAbgA1mgG4ANpoBugHYZAboBmCzGaAbgBkzQDcAW8wA3QBsNQN0A7DNDNANwHYzQDcAO8wA3QDsNAN0A7DLDNANwG4zQDcAe8wA3QDMmgG6AZgzA3QDMG8G6AZgrxmgG4B9ZoBuAPabAboBOGAG6AbgoBmgG4BDZoBuAA6bAboBOGIG6AbgqBmgG4BjZoBuAI6bAboBOGEG6AbgpBmgG4BTZoCm8d/PqBmgG4AxM4ALAHABAC4AwAUACADgEwBwAQAuAMAFALgAABcA4AIAXACACwBwAQAuAMAFAAgA4BMAcAEALgDABQC4AIB/4s+fgU6bAboBOGMG6AbgrBmgG4BzZoBuAM6bAboBuGAG6AbgohmgG4BLZoBuAC6bAboBuGIG6AbgqhmgG4BrZoBuAK6bAboBuGEG6AbgphmgG4BbZoBuAG6bAboBuGMG6AbgrhmgG4B7ZoBuAO6bAboBeGAG6AbgoRmgG4BHZoBuAB6bAboBeGIG6AbgqRmgG4BnZoBuAJ6bAboBeGEG6AbgpRmgG4BXZoBuAF6bAboBeGMG6AbgrRmgG4B3ZoBuAN6bAboBWDADdAPwwQzQDcBHM0A3AJ/MAN0AfDYDdAPwxQzQDcBXM0A3AItmgG4AvpkBugH4bgboBuCHGaAbgJ9mgG4ABjNANADD4P0HAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQABAAKwAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAP+FXwIMAIl7uz9axMOPAAAAAElFTkSuQmCC');"," .i1, .i2":"position:absolute;top:8px;left:8px;width:256px;height:256px;"," .cpick":"width:272px;height:290px;display:inline-block;overflow:hidden;"," #cpwatch":"position:absolute;z-index:+4;top:140px;left:8px;width:60px;height:60px;background-color:#CCC"," .clr0":"position:absolute;z-index:+1;top:8px;left:8px;width:256px;height:128px;"," .clr1":"position:absolute;z-index:+1;top:172px;left:72px;width:192px;height:28px;"," .slframe":"position:absolute; z-index:+5;top:0;left:0;width:272px;height:144px;overflow:hidden;"," .hframe":"position:absolute; z-index:+5;top:140px;left:66px;width:203px;height:28px;overflow:hidden;"," .aframe":"position:absolute; z-index:+5;top:172px;left:66px;width:203px;height:28px;overflow:hidden;"," .aptr:after, .hptr:after":'content:" ";width:8px;height:24px;border:1px solid rgba(255,255,255,0.8);border-radius:8px;position:absolute;z-index:+7;top:0px;left:0px;overflow:hidden;'," .slptr, .hptr, .aptr":"cursor:move"," .cplabel":"width:30px;display:inline-block;margin-right:-30px; padding-left:5px; font-size:14px;line-height: 27px;vertical-align: top;"," .slptr":{"":"width:16px;height:16px;border:1px solid rgba(0,0,0,0.5);border-radius:8px;position:absolute;z-index:+6;",":after":'content:" ";width:12px;height:12px;border:1px solid rgba(255,255,255,0.8);border-radius:8px;position:absolute;z-index:+7;top:0px;left:0px;overflow:hidden;'}," .hptr":{"":"width:12px;height:28px;border:1px solid rgba(0,0,0,0.5);border-radius:8px;position:absolute;z-index:+6;"}," .aptr":{"":"width:12px;height:28px;border:1px solid rgba(0,0,0,0.5);border-radius:8px;position:absolute;z-index:+6;"}," .cpinputs":{"":"position:absolute; top:204px;left:8px;height:52px;z-index:+8;"," input, button":'font-size:13px;text-align:center; line-height:19px;height:24px;vertical-align:top;padding:2px 5px;margin:0 0 4px 0;font-family:"PT Mono", Monaco, monospace;border-radius:1px;'," input":"background:transparent;",">div":"height:28px"}," #btnframe":{"":"position:absolute; top:260px; width:272px; padding:0 0 0 0px;text-align:center; "," button":'font-size:13px;text-align:center; line-height:22px;height:26px;border-radius:1px;vertical-align:top;padding:1px 15px 3px 15px;margin:0 2px; width:126px;font-family:"PT Mono", Monaco, monospace;'}}},{id:"cw.Sys.Confirm",build:3,params:{delay:5,width:350},data:{text:"",css:"xgray",ok:"Ok",cancel:"Cancel",cmd:""},init:function(a,b){var c=b.data;a.formgen(['<div class="'+c.css+'">'+c.text+"</div>",{label:"70px",row:"350px",rowCss:"my-row mt15 pt15 fs90 mb-5 xgray btd"},["","spn#btn-ok.mr5.button.green",{txt:c.ok},"span#btn-cancel.button",{txt:c.cancel}]])},ui:{"#btn-ok":{bind:function(a,b,c){null!=b&&(a.cmd="commit",c.trigger("commit"))},events:"click.my"},"#btn-cancel":{bind:function(a,b,c){null!=b&&(a.cmd="cancel",c.trigger("cancel"))},events:"click.my"}}},{id:"cw.Sys.Cropper.Square",init:function(a,b){var c=e.my.formgen(['<div class="fl mr20 tac vat bg-lgray" style="width:600px;height:450px;overflow:hidden;position:relative;line-height:450px;" id="crop-frame">','<img id="source" class="vam" style="max-width:600px; max-height:450px; background:white" src="" />','<div class="w600  dib" style="height:450px;position:absolute;top:0;left:0">','<span class="dib vam fs110 button">','<span class="fi-photo"><span class="fs110"> &nbsp;Select Image</span></span>',"</span>",'<input type="file" id="file" class="w600 dib" accept="image/jpeg,image/png" style="height:450px;cursor:pointer;opacity:0; position:absolute;top:0;left:0">',"</div>","</div>",'<div class="w200 dib vat" id="xpreview">','<canvas id="preview" class="bg-lgray" style="width:200px;height:200px" width='+b.data.size+" height="+b.data.size+' style="overflow:hidden;"></canvas>',{row:"200px",rowCss:"mt10 pt15 btd fs90 tac"},["","btn#btn-apply.mr5.green",{val:"Apply"},"btn#btn-close.mr0",{val:"Cancel"}],"</div>",'<div class="w200 dib vat" id="xwarn">',"</div>",'<div class="hide"><canvas id="x2" width='+2*b.data.size+" height="+2*b.data.size+"></canvas></div>"]);a.html(c)},params:{width:820},data:{filename:"",data:"",cropped:!1,size:200},style:{" .jcrop-holder":"display:inline-block;vertical-align:middle"},ui:{"#file":{bind:function(a,b,c){function d(b){if(parseInt(b.w)>0){var c,d,e,f,k=h[0],l=j.k,m=b.w*l;m>2*a.size?(e=i[0],f=e.getContext("2d"),f.fillStyle="white",f.fillRect(0,0,2*a.size,2*a.size),f.drawImage(k,b.x*l,b.y*l,m,m,0,0,2*a.size,2*a.size),c=g[0],d=c.getContext("2d"),d.drawImage(e,0,0,2*a.size,2*a.size,0,0,a.size,a.size)):(c=g[0],d=c.getContext("2d"),d.fillStyle="white",d.fillRect(0,0,a.size,a.size),d.drawImage(k,b.x*l,b.y*l,m,m,0,0,a.size,a.size)),a.cropped=!0}}var e,f=c.my().root,g=f.find("#preview"),h=f.find("#source"),i=f.find("#x2"),j={k:1},k="";null!=b&&b&&(e=c[0].files[0],e&&function(){a.filename=e.name;var b,f=new FileReader,g=[];f.onload=function(a){b=new Uint8Array(a.target.result);for(var c=0;c<b.length;c++)g.push(String.fromCharCode(b[c]));k=window.btoa(g.join(""))},f.onloadend=function(){h.load(function(){j.k=h[0].naturalWidth/h.width()}),h.removeClass("hide").attr("src","data:image/jpeg;base64,"+k),j.k=h[0].naturalWidth/h.width(),h.Jcrop({onChange:d,onSelect:d.debounce(20),aspectRatio:1,allowMove:!0},function(){this.animateTo([100,100,300,300])}),k="",c.parent().addClass("hide")},f.readAsArrayBuffer(e)}())}},"#btn-apply":{bind:function(a,b,c){null!=b&&a.cropped&&(a.data=c.my().root.find("#preview")[0].toDataURL("image/jpeg",.95).substr(23),c.my().root.trigger("commit"))},events:"click.my"},"#btn-close":{bind:function(a,b,c){null!=b&&c.my().root.trigger("cancel")},events:"click.my"}}},{id:"cw.Sys.Db.Ddocs",build:2,app:{build:2,name:"Sys.Db.Ddocs",version:"2",timeout:"3000",title:"Ddoc List",author:"ermouth",ico:"data:image/jpeg;base64,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",maskstate:"",nodetitle:"dbname",width:[1e3],collapsed:[]},data:{ddocs:[]},init:function(a,b){var c=this,f=e.Deferred(),g=d.db(c.db?c.db.name:"cw");return a.formgen(c.HTML),c.dbname=g.name,b.data.dbname=g.name+", ddocs",g.allDocs({startkey:"_design/",endkey:"_design0",include_docs:!0}).then(function(a){b.data.ddocs=a.rows,f.resolve()}),a.on("click.my",".ddoc",function(){var a=e(this).text();g.load(a,!0).then(function(b){d.state.set(g.name+"/Sys.JSON/"+d.lib.tourl64(["edit",a]))})}),f.promise()},ui:{"#dbname":"this.dbname","#dlist":{bind:"ddocs",manifest:{ui:{".ddocname":"id"}},list:'<div class="ddoc dib vat hoverlink w200 pr20 pt5 pb5 blue"><span class="pseudolink ddocname"></span></div>'}},HTML:['<h3>Ddocs in <i id="dbname"></i> DB</h3>','<div id="dlist"></div>']},{id:"cw.Sys.Db.DocInfo",build:15,params:{width:700},data:{db:null,id:"",info:[],doc:{},actions:{},actions2:{},cmd:""},ui:{"#pic":"doc.pic","#name":"doc.name","#list":function(a){return e.my.formgen(a.info.reduce(function(a,b){return a.push([b.n,"<span>"+b.v+"</span>"]),a},[{row:"560px",label:"110px",labelCss:"gray fs90",rowCss:"my-row pt8"}]))},"#actions":{bind:function(a){function b(b,e){var g,h="";for(g in b)c=f.Actions.fi[g]||"",d=f.Actions.name[g]||g.capitalize(),h+='<button data-action="'+g+'"  title="'+(f.Actions.tip[g]||"").assign(a.doc)+'" class="'+e+" button",h+=c?" fs90 "+c+'"> <span class="fs110">'+d+"</span></span>":'"> '+d+"</button>";return h}var c,d,e="",f=this;return Object.size(a.actions2)&&(e+='<div class="fr ml10">'+b(a.actions2,"ml5 mr0")+"</div>"),e+=b(a.actions,"mr5"),e},css:{hide:function(a){return!Object.size(a.actions)}}}},init:function(a,b){var c=e.Deferred(),f="name type crypto title _id _rev _read _nokey _conflicts contact creator stamp log created owners _attachments parent pic".split(" "),g="_id _rev parent title contact type creator created stamp _read crypto _conflicts _attachments".split(" "),h=b.data,i=h.db;if(!i||!Object.isObject(i)||!i.load)throw"No DB provided";return i.load(h.id,!0).fail(function(){c.reject("Doc does not exist")}).then(function(b){var j,k=[b];Object.merge(h.doc,Object.select(k[0],f));try{g.forEach(function(a){var b;if(j=h.doc[a])if(j=(j+"").escapeHTML(),"stamp"===a)h.info.push({n:"Modified",v:d.lib.date(1*h.doc[a],"full")});else if("created"===a)h.info.push({n:"Created",v:d.lib.date(1*h.doc[a],"full")});else if("crypto"===a)h.info.push({n:"Crypto",v:"AES256 key ID: "+j+(h.doc._nokey?", key is unknown":"")});else if("_read"===a&&j)b=i.isread(h.id),b&&h.info.push({n:"Read",v:(h.doc._rev===b.rev?"":"Rev "+b.rev.split("-")[0]+", ")+d.lib.date(1*b.stamp,"full")});else if("creator"===a||"author"===a)b=j.split("-"),h.info.push({n:"Creator",v:'<span class="fi-torso"> '+b[0]+"</span>"+(b[1]?' <i class="fs90 gray">('+b[1]+")</i>":"")});else if("_conflicts"===a)b=h.doc[a].length,b&&h.info.push({n:"Conflicts",v:b+" fork doc"+(b>1?"s":"")+" stored"});else if("_attachments"===a){if(b=Object.keys(h.doc[a]),b.sort(),b.length){var c='<div class="dib vat pt2 pr20" style="max-height:122px; overflow:scroll"><table>';c+=b.map(function(b){var c=b.escapeHTML(),d=h.doc[a][b],e=Math.round(d.data.length/4*3)-d.data.last(2).replace(/[^=]/g,"").length;return["<tr><td>",'<span title="'+c+'">'+c.truncate(45,"middle","…")+"</span>","</td>",'<td class="w100 pl20">','<span class="gray fs90" title="'+e+' bytes">',((e>9999?e.metric(2,!1):e)+"b").replace(/([a-z]+)$/i," $1")+"</span>","</td>"].join("")}).join(""),c+="</table></div>",h.info.push({n:(b.length>1?b.length+" a":"A")+"ttaches",v:c})}}else h.info.push({n:a.replace(/^_/,"Doc ").capitalize(),v:j})}),"manifest"===h.doc.type&&k[0].manifest&&k[0].manifest.app&&k[0].manifest.app.name&&(k[0].manifest.app.nodecmd?h.actions._runnew=[k[0].manifest.id]:h.actions._run=[k[0].manifest.id]),h.doc._nokey||Object.merge(h.actions,i.actions(h.doc.type)),"cw"!==h.id&&"readhidelist"!==h.doc.type&&(h.actions._export=!0,h.actions2._hide=!0,!h.doc._nokey&&("manifest"!==h.doc.type||Object.isArray(h.doc.log)&&h.doc.log.last()[2].startsWith(d.me()))&&(h.actions2._delete=!0)),"readhidelist"==h.doc.type&&(h.actions2._hide=!0),h.actions._json=!0,h.actions._diff=!0}catch(a){d.con("Error during doc info render.",a.message,a.stack)}var l=Object.size(h.actions);a.html(e.my.formgen(['<div class="w700">','<img src="" id="pic" class="br6 vat dib '+(h.doc.pic?"w50 mr20":"hide")+'">','<div class="ha dib vat '+(h.doc.pic?"w500":"w600")+' mt-2 ">','<div class="fs150 bold vat dib lh120 xgray ml-2 mb5" id="name"></div>','<div id="list" class="xgray fs90 cb"></div>',"</div>",'<div id="actions" class="my-row hide pt15 mt20 btd '+(l<5?"fs85":l<7?"fs80":"fs75")+'"></div>',"</div>"].compact())),
a.on("click",".button",function(){h.cmd=e(this).data("action"),function(){a.trigger("commit")}.delay()}),c.resolve()}),c.promise()},Actions:{fi:{edit:"fi-pencil",view:"fi-eye",create:"fi-page-copy",_more:"fi-info",_export:"fi-page-export",_run:"fi-play-circle green",_runnew:"fi-play-circle green",_delete:"fi-trash red",_hide:"fi-minus-circle orange",_json:"fi-indent-more",_diff:"fi-shuffle"},name:{create:"Clone",_more:"Info",_export:"Copy...",_run:"Run",_runnew:"Run",_delete:"Del",_hide:"Hide",_json:"JSON",_diff:"Diff"},tip:{edit:"Edit {type}",create:"Create new {type} with the content of this one",_run:"Run application",_runnew:"Open app and create empty {type}",_delete:"Delete {type} permanently",_hide:"Hide {type}. Doc remains in DB, \nbut you’ll never see it again.",_export:"Copy {type} to other DB",_json:"Edit as JSON",_diff:"Explore revisions"}}},{id:"cw.Sys.Db.List",build:77,app:{name:"List",title:"Doc List",version:"2",build:77,timeout:"15000",author:"ermouth",ico:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAm1JREFUeNrsmrFLHEEUxt+aEG2EbGEZAhu1kHRHUCEIAcUumMAdQloxjUW6pNJWsLBIkeT+AfUOLGxUvMpYpNnaImSxENRCBkmtk2/m3L09UfG49S7efMO9fbtzd7Pz/fbN2114ntZaXG5d4ngjAAJwvD02G8/zGvqTLskbuDnYAOxRE+c/hq1LWb57ZTlvtXhzA/DspgEAED8DVzTcMpzLhhRkCgPqVgPoavDKj8F9y1i8aW+lJPPtWAJ3jgCIfwYXwvpsh4JVgubOnsMggUpOAZvyCoiG/20J6B/SI77smSknncVAlPKbnoQ/C6a1Yf7ChgFhv20AILYbE3qP3RGpTa0fNpr8CFdehX4mk/B9RMBslO46gP3MWKtJsEewLcDdvREAwnwYbg32/MahIFw1G/pXIZhlkI9aFfnbsA8AcVqXBCF+CG7nVvGYY9bibTqJEE0Vv1UAJmGbelGeJM8Bl20Z1ltLUJ+vuVQ5fO5xokHl/saOMLYK46NXEshH+K92CUjR68NqP0lub+MliM133mNfWACIcnz0S/J6tLoEfJvkapmwE8XbCKuL6sH0u0B3Ki278hrQw5chAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAAiAAtwBcOKj9PA3gKOlWpnIz6kzJqq4Iy2quVosX5LcuyR/svrBfVSZEcouSLgx94Mqr4sMv6c4tqz0ulASAaRyvOBL+Z7CXkteHSRJEFKzCLTgi/h30HtZFQNwQCa/hPkm1NvipZF8a366EZ9b8JmwpFp/UCvM2SAAEQAAEQAAEQAAutn8CDABvs6te9AnJygAAAABJRU5ErkJggg==",maskstate:{mode:!0,search:!0,sort:!0},nodetitle:"title",width:[795,1060,1325],collapsed:[]},params:{delay:50},Show:[],All:{},Ico:{},die:function(){var a=this;Object.keys(a.Ico).forEach(function(b){URL.revokeObjectURL(a.Ico[b])})},data:{mode:["columns-brief"],search:"",reg:"",sort:["Type"],items:{},actions:{},apps:{},types:{},bytype:{},title:"List All DB Items",start:[]},init:function(a,b){function c(a,b){j.Filter(a,b),g.trigger("recalc")}var f,g,h=e.Deferred(),i=b.data,j=(i.items,i.actions,i.apps,i.types,i.bytype,this),k=this.db.settings(),l=this.db.name;return a.formgen(j.HTML),g=a.find("#brieflist"),f=a.find("#start"),j.db.query("cloudwall/info",{descending:!0}).then(function(a){(function(){h.resolve()}).delay(1),c(a),j.db.watch("").progress(function(a){var b,d=[],e=[];for(b=0;b<a.length;b++)a[b]._deleted||a[b]._hidden?e.push(a[b]._id):a[b].type&&d.push(a[b]._id);d.length?j.db.query("cloudwall/info",{keys:d}).then(function(a){c(a,e)}):e.length&&c({rows:[]},e)}.debounce(0))},function(a){h.reject(a,"Error reading docs info.")}),a.find("#btn-start").click(function(){f.parent().slideToggle(150),g.toggleClass("o50")}),a.then(function(){var b=function(){c()}.debounce(100);d.event(function(c,e){var f=c+"";/^(settings)/.test(c)?a.my("redraw"):/^(app\smanifest)/.test(c)?b():j.Syncing&&f.has(/^db/)&&f.has("replication")&&e==l&&(f.has("started")?d.note("Started replication of "+k.title,"ok"):f.has("finished")?(j.Syncing=!1,d.note("Replication of "+k.title+" finished succesfully","ok")):f.has("failed")&&(j.Syncing=!1,d.note("Replication of "+k.title+" failed","error")))}),j.app.watch.progress(function(a){"inactive"!=a&&"close"!=a&&g.trigger("check")}.debounce(100))}),a.on("click.my",".btag",function(){var b=e(this).data("search")||e(this).text();a.find("#search").val(b).blur()}),h.promise()},ui:{"#dbname":function(a){var b=this.db.settings().title,c="",d="</span>";return a.title=b,b.length>18?c+='<span class="fs75 lh130">'+b.truncate(18,"right","")+'<span class="fs80 lh120">...</span>':b.length>16?c+='<span class="fs75  lh130">'+b:b.length>14?c+='<span class="fs80  lh130">'+b:(c=b,d=""),c+'<span class="vam dib o40 blue fs60 lh110 pb4 pl5">▼</span>'+d},"#dbico":function(a){return a.ico=this.db.settings().ico||this.db.settings().pic},"#start":{init:function(a,b){var c=this;a.list({data:[],chunk:100,delay:1,template:function(a,b){var c="";return c+='<div class="dib vat w120 mr10 mb10 tac hoverlink blue fs80 lh120 cw-List-app" style="cursor:pointer" data-app="'+a.name+'"><img src="'+a.pic+'" class="w32"><div class="tac"><span class="pseudolink">'+a.title+"</span></div></div>",c},hash:function(a){return a.title+a.name+a.pic.length},id:function(a){return a.id}}),a.on("click.my",".cw-List-app",function(){a.my("find","#btn-start").click(),c.app.run(c.db.name+"/"+e(this).data("app"))}),d.event().progress(function(b){/^app/.test(b)&&a.trigger("check")})},bind:function(a,b,c){var d=this;null!=b&&(a.start=d.db.app().map(function(a){return"List"===a?null:d.db.app(a)}).compact().sortBy("title"),c.list("data",a.start))}},"#sort":{bind:"sort",init:function(a){a.tags({tags:[Object.keys(this.Sorters).slice(1)],empty:function(a){var b={},c=Object.keys(a.Sorters)[0];return b[c]=c,b}(this),groupshim:"",tagshim:""})}},"#mode":{bind:"mode",init:function(a){a.tags({empty:{'<span class="fi-list-thumbnails pl2 pr2"></span>':"columns-brief"},tags:[[{'<span class="fi-results"></span>':"grid-medium"}]],groupshim:""})}},"#search":{bind:function(a,b){return null!=b?(a.search=b.to(100),b.length>0&&(a.reg=new RegExp("("+a.search.toLowerCase().compact().split(/[\s,]/).compact(!0).map(function(a){return RegExp.escape(a)}).join("|")+")","i")),b):a.search},css:{"my-search":/^[^\s][^\s]+/}},"#xproxy":{delay:100,bind:function(a,b,c){this.Filter()},watch:"#filter,#search,#sort,#mode"},"#xstatus":{delay:100,bind:function(a,b,c){return this.Show.length?"":'<div class="p20 tac lh110 lgray">List is empty<br>— ※ —</div>'},watch:"#xproxy,#brieflist"},"#brieflist":{bind:"this.Show",id:function(a){return d.lib.sdbm([a.id,a.rev,(new Date).getDate(),a.read])},hash:function(a){return d.lib.sdbm([a.id,a.rev,a.read])},init:function(a,b){var c=this,d=c.Cmd.fill(c);a.on("click.my","#bimg,#btxt",function(){var f,g,h=e(this).parents(".my-form").eq(0),i=h.my("data"),j=i.id,k=c.db.name,l=e(this).data("action")||"_more",m=b.data.actions,n=b.data.apps;"_more"===l?c.app.modal({manifest:"cw.Sys.Db.DocInfo",width:700,data:{db:c.db,id:j},esc:!0}).always(function(b){var c;Object.isObject(b)&&b.cmd&&(c=b.cmd,f=a.my().data.apps[((m[i.type]||{})[c]||[])[0]],d(c,k,j,f))}):(g=((m[i.type]||{})[l]||[])[0],f=n[g],d(l,k,j,f))})},list:'<div class="bitem hoverlink gray1"></div>',manifest:"this.Item",watch:"#xproxy",css:{xcol5:function(a,b,c){var d=c.width();return d>=1099},xcol4:function(a,b,c){var d=c.width();return d>900&&d<1110},xcol3:function(a,b,c){var d=c.width();return d<=900},"columns-brief":function(a){return"columns-brief"==a.mode},"grid-medium":function(a){return"grid-medium"==a.mode}}},"#btn-sync":{bind:function(a,b){if(null!=b){var c=this;c.db.sync(!1),function(){c.db.sync(!0),c.Syncing=!0,d.note("Trying to resync...")}.delay(700)}},events:"click.my",css:{"self:hide":function(a){var b=this,c=(b.db.settings().sync||[]).reduce(function(a,b){return b.dir+""?a+1:a},0);return!c}}},"#btn-settings":{bind:function(a,b){null!=b&&this.app.run(this.db.name+"/DBSettings")},events:"click.my"}},Item:{id:"cw.Sys.Db.List3.Item",init:function(a){var b=this,c=b.data,e=c.read&&!c.read.rev.startsWith(c.rev)?"blue0":!c.read&&"user"!=c.type&&Object.size(c.actions)?"blue1":Object.size(c.actions)?"":"o90 trim lh110",f=function(a){var b="",c=[],e=a.type.capitalize();return a.app&&(e="App"),"Manifest"===e?b="fi-widget":"App"===e?b="fi-layout":"User"===e&&(b="fi-torso"),c.push((b?'<span class="mr5 '+b+'"></span>':"")+'<span class="pseudolink btag" data-search="='+e+'">'+e+"</span>"),a.stamp&&c.push('<span class=" " data-search="">'+d.lib.date(+a.stamp,"short")+"</span>"),a.files.length&&c.push('<span class="fi-paperclip"></span> '+a.files.length),c.length?c.join(" · "):""}(c),g="",h=function(a){var b="",c="",e="";return a.app?(b+="fs110 lh115 fw500 ",c="_run"):a.actions&&a.actions.edit&&(c="edit"),!a.app&&a.title.length>30&&Object.size(a.actions)&&(b+="lh130 fs95 "),c&&(g=c),e='<span class="'+b+'">',a.crypto&&(e+='<span class="fi-key '+(d.crypto.keys().findIndex(function(b){return b.id==a.crypto})>-1?"green":"red")+'"></span> '),e+=a.title+"</span>",e}(c);a.html(b.HTML.assign({binfo:e,btype:f,baction:g,btxt:h,pic:c.pic}))},ui:{},HTML:'<img src="{pic}" id="bimg"/><div id="binfo" class="{binfo}"><span id="btxt" class="pseudolink" data-action="{baction}">{btxt}</span><div id="btype" class="baux gray1 o80 pt2">{btype}</div></div>'},Filter:function(a,b){var c,d,f,g,h,i,j=this;if(a&&a.rows){for(i={},c=0;c<a.rows.length;c++)d=a.rows[c],d,g=e.extend(!0,{id:d.id},d.value),i[d.id]=g;e.extend(j.All,i),i=null}if(b&&b.length)for(c=0;c<b.length;c++)delete j.All[b[c]];for(c in j.All)d=j.All[c],Object.size(d.actions)&&d.pic.length||(i=j.GetActions(d.type),d.pic.length||(d.pic=i[0].app.ico||j.files["unknown.png"].url),d.actions=i[1]),d.index||(d.index=[d.title,"="+d.type+(d.app?" =app":""),d.id,"@"+d.creator].add(Object.keys(d.tags).map(function(a){return"#"+a})).compact(!0).join(" ")),d.read=j.db.isread(d.id);f=Object.values(j.All),j.data.search.compact().length&&(h=j.data.reg,f=f.filter(function(a){return h.test(a.index||"")})),f=f.sortBy(j.Sorters[j.data.sort]),j.Show=f},GetActions:function(a,b){var c,e,f,g,h=this,i=h.data.actions,j=h.data.apps;if(!i[a]||b)for(i[a]=h.db.actions(a),c=Object.values(i[a]).unique(),e=0;e<c.length;e++)if(j[c[e]]&&!b||(f=d.form(c[e][0],h.db.name)),f){if(f.app&&f.app.ico){var k=d.lib.sdbm(f.app.ico);if(!h.Ico[k]){var l=f.app.ico.split(";base64,");l[0]=l[0].from(5),h.Ico[k]=URL.createObjectURL(d.lib.base642blob(l[1],null,l[0]))}f.app.ico=h.Ico[k]}j[c[e]]=f}return g=i[a],g?[j[g.edit||g.view]||{app:{}},g]:(g={},void 0)},Sorters:{Type:function(a){var b="";return b="manifest"===a.type&&a.app?"0|"+a.title:"user"===a.type?"￣0|"+a.title:Object.size(a.actions)?"1|"+a.type+"|"+a.title:"￣1|"+a.type+"|"+a.title,b},AZ:function(a){return a.title},Modified:function(a){return 1e16-a.stamp}},Cmd:function(a,b,c,f,g){function h(b){a.app.run(b)}var i,j,k=d.ram(c,f);k&&"_"===b.to(1)?b.startsWith("_run")&&k?(i=c+"/"+k.manifest.app.name+"/",i+="_runnew"===b?d.lib.tourl64(["create",""]):""):"_delete"===b&&k?a.app.modal({manifest:"cw.Sys.Confirm",data:{text:" Delete doc?",css:"fi-x red",ok:"Delete"}}).always(function(a){Object.isObject(a)&&"commit"===a.cmd&&d.db(c).del(f).then(function(){d.note("Doc deleted","ok")},function(){d.note("Fail to delete doc","error")})}):"_json"===b&&k?i=c+"/Sys.JSON/"+d.lib.tourl64(["edit",f]):"_diff"===b&&k?i=c+"/Sys.Diff/"+d.lib.tourl64(["edit",f]):"_hide"===b&&k?a.app.modal({manifest:"cw.Sys.Confirm",data:{text:'<span class="fi-minus-circle orange"> Hide doc?</span><p class="fs90">You’ll never see this doc again, but it is not removed from DB. Useful for shared DBs.</p>',ok:"Mark as hidden"}}).always(function(a){Object.isObject(a)&&"commit"===a.cmd&&(d.db(c).hide(f),d.note("Doc hidden","ok"))}):"_export"===b&&k&&(j=d.dbs(),delete j[c],a.app.modal({manifest:Object.merge(d.db(a.db.name).form("cw.Sys.Confirm"),{ui:{"#dest":{init:function(a){var b=j;a.tags({tags:[Object.keys(b).map(function(a){var c={};return c[b[a].escapeHTML()]=a,c})]})},bind:"dest"},"#options":{init:function(a){var b=[[{"Restart revision":"newrev"}]];"manifest"!=k.type&&b.push([{"New doc ID":"newid"}]),a.tags({tags:b})},bind:"options"}}},!0),data:{text:'<span class="fi-page-copy"> Select destination DB</span><p class="mt15 mb15 fs90 ml-6"><span id="dest"></span></p><p class="mt15 mb20 fs80"><span class="gray">Options:</span> <span id="options"></span></p>',ok:'<span class="fi-page-copy"></span> Copy',dest:Object.keys(j)[0],options:["newrev"]},esc:!0}).always(function(a){Object.isObject(a)&&"commit"===a.cmd&&d.db(c).get(f,{attachments:!0}).then(function(b){function c(c,e){var g=Object.reject(b,"_db");e.indexOf("newid")>-1&&(g._id=d.lib.uuid()),c&&e.indexOf("newrev")>-1&&delete g._rev,d.db(a.dest+"").save(g,!0).then(function(a,b){f.resolve(a,b)}).fail(function(a,b){f.reject(a,b)})}var f=e.Deferred();return d.db(a.dest+"").get(b._id,function(d,g){!g||a.options.indexOf("newid")>-1?c(!0,a.options):e.my.modal({manifest:"cw.Sys.Confirm",data:{text:" Doc exists in destination DB. Saving will overwrite existing doc.",ok:"Overwrite"}}).then(function(d){Object.isObject(d)&&"commit"===d.cmd?(b._rev=g._rev,c(!1,a.options)):f.reject("Overwite cancelled")}).fail(function(){f.reject("Overwite cancelled")})}),f.then(function(b){d.note("Doc "+(b.title||b.name||b._id).stripTags()+" copied to "+j[a.dest],"ok")}).fail(function(){d.note("Copy failed","error")}),f.promise()},function(a,b){d.note("Failed reading file to copy","error")})})):g&&(i=c+"/"+g.app.name+"/"+d.lib.tourl64([b,f])),i&&h(i)},style:{" .columns-brief":{" .bitem":"padding:3px 0 5px 0;"," #bimg":"width:20px;height:20px;border-radius:2px;"," #binfo":"width:215px;font-size:85%;"," .baux":"display:none;opacity:0;"," #btxt":"white-space: nowrap;border:none!important;"," #btxt>span":"text-overflow: ellipsis;width: 100%;overflow: hidden;display: inline-block;vertical-align:top;"," #btxt>span>span":"position: initial;"}," .grid-medium":{" .bitem":"padding:7px 0 9px 0;"," #bimg":"width:25px;height:25px;border-radius:3px;margin:2px 18px 0 7px;"," #bimg.bapp":"width:38px;height:38px;border-radius:3px;margin:3px 12px 0 0;"," #binfo":"width:195px;font-size:90%;"," .baux":"display:block;opacity:1;"," #btags":"display:none;"}," .bitem":"transition:width 0.1s, padding:0.1s, margin:0.1s;width:245px;display:inline-block;vertical-align:top;"," #bimg":"transition:width 0.1s, height 0.1s, margin 0.1s;margin-right:10px;display:inline-block;vertical-align:top;border-radius:3px;cursor:help;cursor:context-menu;"," #binfo":"transition:width 0.1s, font-size 0.1s;display:inline-block;vertical-align:top;font-size:90%;line-height:1.2em;"," .baux":"transition:height 0.1s, opacity 0.1s; xoverflow:hidden; font-size:80%; padding-top: 0.1em;"," .pseudolink.btag":"border-bottom-style: dotted!important;"," .trim":"white-space:nowrap;width:100%;xoverflow:hidden;text-overflow:ellipsis"," .cw-List-nav .dbname":"margin:-4px 8px 0 10px;white-space:nowrap;width:220px;overflow:hidden;text-overflow:ellipsis"," .xcol5":"overflow-y: visible!important;clear: both;height: auto!important;-webkit-column-count: 5!important;-webkit-column-gap: 25px; column-count: 5!important; column-gap: 25px;-moz-column-count: 5!important;-moz-column-gap: 25px;"," .xcol4":"overflow-y: visible!important;clear: both;height: auto!important;-webkit-column-count: 4!important;-webkit-column-gap: 25px; column-count: 4!important; column-gap: 25px;-moz-column-count: 4!important;-moz-column-gap: 25px;"," .xcol3":"overflow-y: visible!important;clear: both;height: auto!important;-webkit-column-count: 3!important;-webkit-column-gap: 25px; column-count: 3!important; column-gap: 25px;-moz-column-count: 3!important;-moz-column-gap: 25px;"},HTML:['<div id="nav" class="cw-List-nav fs90 pb20 mb15 bbs">','<div id="xsearch" class="fr ha w170 mr-2">','<div class="fi-magnifying-glass blue o50 fs90" style="position: absolute; z-index: +1; left: 8px;top: 0.25em;"></div>','<input type="text" id="search" class="ui-search w170 ml0 mr0 mt0 small" style="background-image: none;">',"<span class=\"fi-x fs80 dib vat pt3 blue ui-search-clear\" onclick=\"$(this).siblings('input:eq(0)').val('').blur()\"></span>","</div>",'<div class="hoverlink dib vat w275" id="btn-start" style="cursor:pointer" title="Show/hide DB apps list">','<img src="" id="dbico" class="br4 vat dib mt-2" style="width:32px;height:32px;image-rendering:pixelated;image-rendering:-webkit-optimize-contrast;"/>','<h2 class="dbname dib vat fs150 lh130 blue"><span id="dbname" class="pseudolink"></span></h2>',"</div>",{label:"65px",row:"265px",labelCss:"fs90 lh110 gray",rowCss:"my-row dib vat mt2"},["","spn#mode.fs100.mr10",'<span class="fi-shuffle fs90 gray">&thinsp;</span>',"spn#sort.fs95"],'<div class="dib vat ml25">','<button id="btn-sync" class="button pt3 pb3 mt2 mb0 br100 w40" title="Sync now">','<span class="fi-loop"></span>',"</button>","</div>",'<span class="dib w150 vat fi-wrench mt2 gray ml5 hide"> <span class="pseudolink" id="btn-settings">Settings</span></span>',"</div>",'<div id="xstart" style="display:none"><div id="start" class="pb5 mb15 bbs" style="width:100%"></div></div>','<section id="brieflist" class="mt10 dib vat cw-List-col" style="width:100%"></section>','<div id="xproxy" class="hide"></div>','<div id="xstatus"></div>'],views:{info:{map:function(a){var b,c,d,e=0,f=a.type,g={},h="",i=[];if(f||"_design/"!=a._id.substr(0,8)||(f="ddoc"),"string"==typeof f&&f){if(e=a.stamp||a.created||e,"object"==typeof a.tags)if("function"==typeof a.tags.slice)for(b=0;b<a.tags.length;b++)g[a.tags[b]]=1;else for(b in a.tags)g[b]=1;if("manifest"===a.type&&a.manifest&&a.manifest.app&&a.manifest.app.name&&(h="object"==typeof a.manifest.app.types?"editor":"app"),c={rev:+a._rev.split("-")[0],type:f,app:h,crypto:a.crypto||"",title:a.title||a.name||f.substr(0,1).toUpperCase()+f.substr(1)+", ID "+a._id,stamp:e,tags:g,creator:a.creator||"",pic:"string"==typeof a.pic&&a.pic.length<20480&&"data:image"===a.pic.substr(0,10)?a.pic:"",owners:a.owners||[],acl:a.acl||[],parent:a.parent||"",files:[]},a._attachments){for(b in a._attachments)d=a._attachments[b],i.push([b,d.content_type,d.length||d.size||0,d.revpos]);c.files=i}emit(a._id,c)}}}},files:{"unknown.png":{digest:"md5-M6nwyK6OobaFbftCi9/raQ==",content_type:"image/png",data:"iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABJQTFRF////tre99fX219fa5eboy8zPIEyigwAAAL5JREFUeNqM1VEOxCAIBFAd4P5X3trdbgQGy3w2L1M12I6xBSGjiMwQq1ysMOs5LpljkrssKxdl7bw8uV0Gl476kc5BbEU0S+fUnkiU4M7MdV4I021/vVUlVSaI7+Lu5iPcliANeG9d36GmJXJIHIVIZ1NAJY5CMTLXVSM6cIii1UhDIZqN6O46DcT4zWJ8SiCmkKu7JkKZy53hbv1d9THK7iidO8jgSplcIYmjkjoiC3fJ+LGX8igOv4+PAAMAOM0EMf5JMSUAAAAASUVORK5CYII="}}},{id:"cw.Sys.Db.Settings",build:33,app:{name:"DBSettings",version:"2",timeout:"5000",title:"DB Settings",author:"ermouth",ico:"data:image/jpeg;base64,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",maskstate:{name:!0},nodetitle:"title",build:32,width:[800],collapsed:[]},params:{delay:20},data:{apps:[],ico:"",pic:"",name:"",title:"",desc:"",stamp:0,start:"",sync:[],creator:""},init:function(a,b){var c=this;a.html(e.my.formgen(c.HTML)),Object.merge(b.data,this.db.settings(),!0),this.App.db=this.db,b.data.pic||(b.data.pic=b.data.ico)},ui:{"#dbtitle":{bind:"title",watch:"#title"},"#title":{bind:"title",check:function(a,b){return b&&b.length<3?"At least 3 characters":b&&b.length>40?"40 chars maximum":""}},"#desc":{bind:"desc",check:/^[\s\S]{0,300}$/,error:"300 chars maximum"},"#dbinfo":{bind:function(a,b,c){var e=this;e.db.info().then(function(b){var f="",g=0,h=0;g=b.doc_count,h=b.update_seq,f="Internal ID: "+e.db.name+". ",a.stamp&&(f+="Created "+d.lib.date(1*a.stamp,"tiny")+(a.creator?" by "+a.creator+". ":". ")),f+=g?"Contains "+g+" doc"+(g>1?"s":"")+". ":"DB is empty. ",c.html(f)})}},"#pic":{bind:function(a,b){return a.ico.length||(a.ico=a.pic),a.pic}},"#apps":{bind:"apps",manifest:"App",check:!0,watch:"#btn-addapp"},"#sync":{bind:"sync",manifest:"Sync",check:!0,watch:"#btn-addsync"},"#start":{bind:function(a,b){if(null!=b){var c=b.split("#").last().split("/").slice(0,4).compact(!0);c[0]==this.db.name&&(c=c.slice(1)),a.start=c.join("/")}return a.start}},"#btn-close":{bind:function(a,b,c){null!=b&&this.app.close(!0)},events:"click.my"},"#btn-save":{bind:function(a,b,c){var e=this;if(null!=b){if(!c.my().root.my("valid"))return d.note("Save failed – some settings are invalid. Fix reds and try again.","error"),void 0;var f=d.db("cw");a._cmd="",f.settings(a).then(function(){d.note("Settings saved"),e.app.close(!0)}).fail(function(a){d.note(a,"error")})}},events:"click.my"},"#btn-addapp":{bind:function(a,b){null!=b&&a.apps.push(Object.merge({stamp:Date.now()},this.App.data,!0))},events:"click.my"},"#btn-compact":{bind:function(a,b,c){var e=this.db.name;null!=b&&(c.parent().find(".cw-busy").removeClass("hide"),d.db(e).compact().then(function(){c&&c.is(":visible")&&c.parent().find(".cw-busy").addClass("hide"),d.note("DB "+e+" sucessfully compacted.","ok")}))},events:"click.my"},"#btn-delete":{bind:function(a,b,c){if(null!=b){var e=d.db("cw");a._cmd="delete",e.settings(a).then(function(){d.note("Settings saved. DB is being removed.","warning")}).fail(function(a){d.note(a,"error")})}},events:"click.my"},"#btn-pic":{bind:function(a,b,c){null!=b&&e.my.modal({manifest:"cw.Sys.Cropper.Square",data:{data:"",filename:"",size:250}}).then(function(b){if(b&&b.data){var e=new Image;e.src="data:image/jpeg;base64,"+b.data,e.onload=function(){var f=d.lib.image(e);try{a.pic=f.resample(128).sharpen(.2).jpeg(.96,!0),a.ico=f.resample(50).sharpen(.2).jpeg(.96),c.my().root.trigger("change")}catch(a){console.log(a)}b.data="",c.my("find","#pic").trigger("check")}}})},events:"click.my"},"#btn-resync":{bind:function(a,b,c){if(null!=b){var e=d.db("cw");a._cmd="resync",e.settings(a).then(function(){d.note("Settings saved. DB is prepared to resync","warning")}).fail(function(a){d.note(a,"error")})}},events:"click.my",css:{hide:function(a,b,c){return!a.sync.length}}},"#btn-tosync":{bind:function(a,c,e){var f=this;if(null!=c){e.parent().find(".cw-busy").removeClass("hide"),a._cmd="sync";var g=f.db.settings().sync.filter(function(a){return!!a.dir.length}).length,h=function(){e&&b.contains(document,e[0])&&e.parent().find(".cw-busy").addClass("hide")},i=h.after(g);d.db("cw").settings(a,function(){i()}).then(function(a){d.note(a,"ok")}).fail(function(a){h(),d.note(a,"error")})}},events:"click.my",css:{hide:function(a){return!a.sync.length}}},"#btn-tosync0":{bind:function(a,c,e){var f=this;if(null!=c){e.parent().find(".cw-busy").removeClass("hide"),a._cmd="sync0";var g=f.db.settings().sync.filter(function(a){return!!a.dir.length}).length,h=function(){e&&b.contains(document,e[0])&&e.parent().find(".cw-busy").addClass("hide")},i=h.after(g);d.db("cw").settings(a,function(){i()}).then(function(a){d.note(a,"ok")}).fail(function(a){h(),d.note(a,"error")})}},events:"click.my",css:{hide:function(a){return!a.sync.length}}},"#btn-addsync":{bind:function(a,b){null!=b&&a.sync.push(Object.merge({stamp:Date.now()},this.Sync.data,!0))},events:"click.my"}},App:{data:{ico:"",title:"",url:""},init:[{row:"350px",rowCss:"my-row pb10"},["",'<div class="w125 mr5 dib">',"inp#apptitle.fs85.w125",{plc:"Title"},'</div><div class="dib">',"inp#appurl.fs75.w220.pt7.pb8.gray",{plc:"App URL hash"},"</div>"]],ui:{"#apptitle":{bind:"title",check:/^.{0,40}$/,error:"40 chars max"},"#appurl":{bind:function(a,b){if(null!=b){var c=b.split("#").last().split("/").slice(0,4).compact(!0);c[0]==this.db.name&&(c=c.slice(1)),a.url=c.join("/")}return a.url}}}},Sync:{data:{dir:["from"],url:"",interval:"0"},init:[{row:"350px",rowCss:"my-row pb15"},["",'<div class="w350 mb5 dib">',"inp#syncurl.fs80.w350",{plc:"CouchDB URL"},"</div>","spn#syncdir.dib.mt1.vat.fs80",'<div class="w250 dib vat">','<span class="fs80 gray ml2"> in </span>',"num#interval.fs80.w70.pt2.pb2",{min:0,max:7220},'<span class="fs80 gray"> minute intervals</span>',"</div>"]],ui:{"#syncurl":{bind:"url",check:/^(|http[s]?:\/\/([^\/]{1,100}\/){1,5}[a-z0-9_$\(\)+\-]{2,200}[\/]?)$/,error:"Invalid CouchDB URL"},"#syncdir":{bind:"dir",init:function(a){a.tags({tags:[{From:"from"},{To:"to"}]})}},"#interval":"interval"}},HTML:['<div class="pl50 pr50 cw-Settings">','<div id="nav" class="fs90 pb20 mb25 bbs">','<div id="xDbtitle" class="fi-wrench pr20 fs140 lh120 w250 dib vat gray"> <span class="fs110 bold" id="dbtitle"></span></div>','<div id="dbinfo" class="w230 dib vat fs80 lh120 gray"></div>','<div class="w200 ml20 dib vat">',{row:"200px",rowCss:"my-row"},["","btn#btn-save.fs100.w90.tac.mr5.green",{val:"Save",title:"Saves DB settings"},"btn#btn-close.fs100.w90.tac",{val:"Close",title:"Close and discards changes"}],"</div>","</div>",'<div id="sets" class="mb20">','<table width="100%"><tr>','<td class="w120 pr20 tac">','<img id="pic" class="db" style="width:100px;height:100px;border-radius:5px;"/>','<div style="z-index:+2;margin-top:-24px;height:24px;background-color:rgba(255,255,255,0.5)">','<span id="btn-pic" class="pseudolink dib vat fs70 lh140 o80">Change...</span>',"</div>","</td>",'<td style="width:580px">',{row:"580px",rowCss:"my-row pb10"},["","inp#title.fs120.w350",{plc:"DB title"},'<div class="tip">DB title as it will be shown in the left pane</div>',"msg"],["","txt#desc.fs90.w350",{plc:"Description"},'<div class="tip">Short memo about db source, owner if any and so on</div>',"msg"],"</td>","</tr></table>","</div>",'<div id="extsets">',{row:"700px",label:"120px",rowCss:"my-row pb10",labelCss:"my-label fs80 gray"},["Default app","inp#start.w350.fs90",{plc:"App name or app URL hash"},'<div class="tip">Default app to run when DB is clicked in left pane</div>',"msg"],["Other apps",'<div class="w350 dib vat">',"div#apps.w350",{style:"min-height: 9px;"},'<div class="mt-10">',"spn#btn-addapp.pseudolink.fs70",{txt:" Add application to left aside panel"},"</div>","</div>",'<div class="tip">Apps pinned in the left pane. Paste URL – and app is pinned.</div>'],'<div class="btd pb30 mt25"></div>',["External sync",'<div class="w350 dib vat">',"div#sync.w350",{style:"min-height: 9px;"},'<div class="mt-10">',"spn#btn-addsync.pseudolink.fs70",{txt:" Add link to external CouchDB"},"</div>","</div>",'<div class="tip">External DBs to replicate to/from</div>'],["Force sync","spn#btn-tosync.pseudolink.fs90.green.my-tags",{txt:"From checkpoint"},"spn#btn-tosync0.pseudolink.fs90.green.my-tags.ml20",{txt:"Full re-sync"},'<div class="cw-busy ml20 w40 hide"></div>','<div class="tip fr">Tries to make full sync, it can take time.</div>',"msg"],["Resync DB","spn#btn-resync.pseudolink.fs85.o80.red.my-tags",{txt:"Clear and resync DB"},'<div class="tip fr">Deletes DB and resyncs it back. No rollback if DB isn’t synced.</div>',"msg"],'<div class="btd pb30 mt25"></div>',["Compact","spn#btn-compact.pseudolink.fs90.green",{txt:"Start compaction"},'<div class="cw-busy ml20 w50 hide"></div>','<div class="tip fr">Performs DB compaction, can fix replication issues.</div>',"msg"],["Delete DB","spn#btn-delete.pseudolink.fs85.o80.red",{txt:"Delete DB permanently"},'<div class="tip fr">Deletes DB and all docs in it. No rollback if DB isn’t synced.</div>',"msg"],"</div>","</div>","<style>",".cw-Settings #xDbtitle{white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}",".cw-Settings .tip {width:200px; font-size:72%; opacity:0.6;line-height:1.2em;display:inline-block;vertical-align:top;margin:-2px 0 0 30px}",".cw-Settings .my-error .tip {display:none}",".cw-Settings .my-error div.my-error-tip {display:inline-block;font-size:75%!important;margin-left:30px;vertical-align: top;}","</style>"]},{id:"cw.Sys.Dock",build:33,params:{delay:50},data:{list:[]},init:function(a,b){var c=this,f=b.data;a.parent().parent().css({top:"20px"}),a.html('<div id="list" class="w200 oh pl25 fs80"></div>'),a.on("update.cw",function(){var a,b,g=[],h=d.state.slots(),i="";for(var j in h)a=h[j],b=a.app.isActive(),a.closing||g.push({url:a.app.url,initurl:j,active:b,ico:a.app.ico,title:a.title||a.app.title,born:a.app.born}),b&&(i=a.title);g=g.sortBy(function(a){return 1*a.born},!0),e("img#ico").each(function(){e(this).data("modal")&&e(this).modal()}),function(){f.list=g,c.my.recalc("#list")}.fill(g).delay(40),document.title=i}.debounce(105)),a.on("click.my","span#appname",function(){var a=e(this).data("url");d.state.set(a)}),a.on("click.my","img#ico",function(){var a=e(this);a.my().root,a.my("data");a.modal({root:a.parents(".my-form").eq(1),screen:"rgba(255,255,255,0.2)",close:'<div class="my-modal-close fs100" title="Close">×</div>',esc:!0,width:136,align:"left:66%; top:-5px;",nose:"left",css:"fs70 lh140 pl6 pt5 pr5 pb4 blue",data:a.my("data"),bound:1,manifest:c.MAppinfo}).always(function(a,b){console.log(a,b)})})},ui:{"#list":{manifest:"AppList",bind:"list",merge:!0,check:!0,list:'<div class="hoverlink blue cw-dock-item"></div>',id:["url"],hash:["url","active","title"]}},style:{" div.my-modal.my-modal-overlay":"box-shadow:0 0 0px 1px rgba(0, 20, 47, 0.2)!important;background-color:rgb(245,250,255);word-wrap: break-word;"," div.my-modal.nose-left:before":"background-color:rgb(245,250,255);"," #list":"min-height:200px"," #ico":"cursor: help;cursor:context-menu;width:25px; height:16px;padding-right:9px;margin:2px 1px -2px 0;"},AppList:{data:{},init:function(a,b){a.html('<div id="cont" class="blue"><img id="ico" src=""/><div class="w130 oh dib vat" style="text-overflow:ellipsis;white-space:nowrap;"><span id="appname" class="pseudolink" data-url="'+b.data.url+'"></span></div><span id="btn-closeapp" class="pseudolink ml5 pl2" title="Close app instance">×</span></div>')},ui:{"#appname":function(a,b){return a.title},"#cont":{bind:function(){},css:{blue:function(a){return a.active},"xgray o50":function(a){return!a.active}}},"#ico":"ico","#btn-closeapp":{bind:function(a,b,c){null!=b&&d.state.slots(a.initurl).app.close().then(function(){c.my()&&c.my().root.slideUp(150)})},events:"click.my"}}},MAppinfo:{init:['<div class="o90 bold fs110 lh100 pl15 mt1 mb2"><span class="fi-page dib vat w15 ml-15"></span>','<span id="docname"><span></div>','<div class="o70 pl15"><span class="fi-folder dib vat w15 ml-15"></span><span id="db"><span></div>','<div class="o70 pl15"><span class="fi-layout dib vat w15 ml-15"></span><span id="appname"><span></div>','<div class="o70 pl15"><span class="fi-clock dib vat w15 ml-15"></span><span id="started"><span></div>'],
data:{},ui:{"#db":function(a){return a.url.split("/")[0]},"#appname":function(a){return a.url.split("/")[1]},"#docname":function(a){return a.title.truncate(200,"middle"," … ")},"#started":function(a){return d.lib.date(a.born)}}}},{id:"cw.Sys.Side",build:54,params:{delay:50},data:{list:[],collapsed:{},title:""},ui:{"#list":{bind:"list",check:!0,merge:!0,list:'<div class="hoverlink blue cw-dock-item"></div>',manifest:"List"},"#sidelogo":{bind:function(a,b,c){null!=b&&d.lib.note("Here must be introducing app, not yet implemented.")},events:"click.my"},"#btn-sysdb":{bind:function(a,b,c){null!=b&&d.state.set("cw/List")},events:"click.my"},"#btn-update":{bind:function(a,b){if(null!=b){var c=e.Deferred();(d.CW.updateURL||"/x/")+"snapshot";e.my.modal('<div class=" pt20 pb15 w350 tac blue">Loading updates...<br><div class="cw-busy w90 mt10"></div></div>',function(){},300);var f=d.db("cw");e.ajax({url:"sys/apps.json",type:"GET",dataType:"json",cache:!1}).then(function(a){var b,g,h,i,j={},k={};if(Object.isArray(a)&&a.length){b=Object.clone(a,!0);for(var g=0;g<b.length;g++)if(i=b[g],Object.isString(i))k[i]=!0;else{if(i.srcrev=i._rev,delete i._rev,i._attachments)for(h in i._attachments)i._attachments[h]=Object.select(i._attachments[h],["content_type","data"]);j[i._id]=i}f.allDocs({keys:Object.keys(j).add(Object.keys(k)),include_docs:!0}).then(function(a){var b,g,h;for(b=0;b<a.rows.length;b++)g=a.rows[b].doc,g&&j[g._id]?j[g._id].srcrev==g.srcrev?delete j[g._id]:j[g._id]._rev=g._rev:g&&k[g._id]&&(j[g._id]={_id:g._id,_rev:g._rev,_deleted:!0,name:g.name});Object.size(j)?(h=Object.values(j),e.my.modal(!0),e.my.modal({manifest:Object.merge(e.my.cache("cw.Sys.Confirm"),{ui:{"input[name=apps]":"apps"}},!0),data:{text:'<p class="xgray">Select apps and docs to update</p>'+h.map(function(a){return'<div class="fs90 pb3"><label><input type="checkbox" class="mr5 w15" value="'+a._id+'" name="apps"/> <span class="'+(a._deleted?"tdl":"")+'">'+a.name+"</span></label></div>"}).join(""),apps:h.map(function(a){return a._id}),ok:"Update"},esc:!0}).always(function(a){if(Object.isObject(a)&&a.apps.length){for(var b=d.lib.a2o(a.apps),e=[],g=0;g<h.length;g++)b[h[g]._id]&&e.push(h[g]);f.bulkDocs({docs:e},function(a,b){a?(console.log(a,e),c.reject("Failed to write documents to local DB.")):c.resolve("Succesfully updated "+e.length+" doc"+(e.length>1?"s":"")+".")})}else console.log(a),c.reject("Update cancelled.")})):c.resolve("All system apps are up to date.","ok")},function(a){c.reject("Error fetching new docs. Retry later.")})}else e.my.modal(),d.lib.note("Oops, server responded with error. Please retry in 5-10 minutes.","error",5e3),console.log(a)}).fail(function(a,b){e.my.modal(),d.lib.note("Failed reading system apps set. Please, try again in several seconds.","error",5e3),console.log(a,b)}),c.then(function(a){e.my.modal(),d.lib.note(a,"ok",5e3)}).fail(function(a){e.my.modal(),d.lib.note(a,"error",3e3)})}},events:"click.my"},"#btn-newdb":{bind:function(a,b,c){var f=this;null!=b&&e.my.modal({manifest:Object.merge(d.form("cw.Sys.Confirm"),{ui:{"#name":{bind:function(a,b){return null!=b&&(a.name=b.compact()),a.name},check:function(a,b){if(b.length<2)return"2+ latins and nums";if(/^http[s]?:\/\//.test(b)){if(b.has("•"))return"Impossible password in URL";if(!/^http[s]?:\/\/([^\/]{2,100}\/){1,5}[a-z0-9_$\(\)+\-]{1,200}[\/]?$/.test(b))return"Invalid CouchDB URL"}else{if(!/^[a-z0-9\s\-]{2,30}$/i.test(b))return"2-30 latins and nums";if(a.dbs.indexOf(b.replace(/\s/g,"-").toLowerCase())!==-1)return"This name already exist"}return""}},"#btn-ok":{bind:function(a,b,c){null!=b&&(c.my().root.my("valid")?c.trigger("commit"):d.note("Correct name fist!","error"))}},"#syncdir":{bind:"dir",init:function(a){a.tags({tags:[{From:"from"},{To:"to"}]})}},"#interval":"interval","#sync":{watch:"#name",css:{hide:function(a,b,c){return!/^http[s]?:\/\/.+/.test(a.name)||c.my("errors")["#name"]}}}}},!0),data:{text:['<span class="fi-list gray fs90"></span> New DB title or URL ','<div class="mt10 mb10">','<textarea id="name" class="w350 fs110 lh120" style="word-wrap:break-all;" placeholder="Latins and nums"></textarea>','<div class="my-error-tip"></div>',"</div>",'<section id="sync" class="hide mt-5">',e.my.formgen([["","spn#syncdir.dib.mt1.vat.fs80",'<div class="w250 dib vat">','<span class="fs80 gray ml2"> in </span>',"num#interval.fs80.w70.pt2.pb2",{min:0,max:7220},'<span class="fs80 gray"> minute intervals</span>']]),"</section>"].join(""),ok:"Create DB",name:"",dir:["from"],interval:"5",dbs:Object.keys(d.dbs()).map(function(a){return a.toLowerCase()})}}).then(function(a){function b(a,b){return"_repl_"+b+"_"+a.replace(/^(http[s]?\:\/\/[^\:@\/]+:)[^@]+(@.+)$/,"$1•••••$2")}function c(a){var b=a;return b.replace(/[^a-z0-9\-]/gi,"").to(30)!==b&&(b=b.replace(/[^a-z0-9]/gi,"-").to(30),(b.length<2||d.dbs()[b])&&(b=d.lib.hash8(b+Number.random(1e12)))),b}var e,g;Object.isObject(a)&&(/^http[s]?:\/\//.test(a.name)?(g=a.name.split("/").compact(!0).last(),e=d.lib.fuse({},f.DB,{title:g.to(50).capitalize(),name:c(g),stamp:Date.now(),creator:d.me(),sync:[{url:a.name,dir:a.dir.slice(0),interval:a.interval}]})):e=d.lib.fuse({},f.DB,{title:a.name.to(50),name:c(a.name),stamp:Date.now(),creator:d.me(),sync:[]}),e.sync&&e.sync.length&&(localStorage.removeItem(b(e.sync[0].url,"to")),localStorage.removeItem(b(e.sync[0].url,"from"))),console.log(e),e&&d.db("cw").settings(e).then(function(){d.note("DB created","ok")}).fail(function(a){d.note("DB creation failed during settings update. "+a,"error")}))})},events:"click.my"}},List:{data:{},init:function(a,b){a.html('<div id="cont" class="xgray o50 ov '+(b.data.shift?"pl25":"")+'" style="white-space:nowrap;"><img id="ico" class="h16 mt3 mb-3 '+(b.data.shift?"w16 mr0":"w21 pr5 cp isdb")+'" '+(b.data.shift?"":'data-name="'+b.data.name+'" ')+' src="" /><div class="'+(b.data.shift?"w130":"w150")+' oh dib vat pl5" style="text-overflow:ellipsis;white-space:nowrap;">'+(b.data.sync>0?'<span class="fr pt8 pl3 fs90 lh90 replmarker cp" data-name="'+b.data.name+'">':"")+(2===b.data.sync?'<span class="salmon fi-minus-circle" title="Replication failed"></span>':"")+(1===b.data.sync?'<span class="green fi-loop" title="Replication started"></span>':"")+(b.data.sync>3?'<span class="sky fi-clock" title="Replication sheduled to '+d.lib.date(b.data.sync,"tiny")+'"></span>':"")+(b.data.sync>0?"</span>":"")+'<span id="appname" class="pseudolink" data-url="'+b.data.url+'"></span></div><span id="bubble"class="hide oh fs80" style="max-width:25px;position:absolute;top:0;right:0;"></span></div>')},ui:{"#appname":"title","#cont":{bind:function(){},css:{blue:function(a){return a.active},"xgray o50":function(a){return!a.active}}},"#ico":"ico","#bubble":{bind:function(a,b,c){}}}},style:{" .green":"color:#BEEA00!important"," #sidelogo":"cursor:pointer;"," #sidelogo img":"width:180px; opacity:0.8; transition:opacity 0.3s; display:block;"," #sidelogo:hover img":"opacity:1;"}," ":" ",init:function(a,b){var c=b.data;a.formgen(this.HTML),a.find("#sidelogo").append(e(this.Logo)),a.on("click","span#appname",function(){var a=e(this).data("url");d.state.set(a)}),a.on("click","img.isdb",function(){var a=e(this).data("name");d.state.set(a+"/DBSettings")}),a.on("click","span.replmarker",function(){var a,b=e(this).data("name"),c=(d.db(b).settings(),d.db(b).sync()),f="Sync status for "+b+":";for(a in c)f+='<br><div class="fs90 mt8 dib vat">'+a.split(/\/\/|@/).last().truncate(28,"middle","…")+'<br><span class="fi-clock fs95">&nbsp;'+d.lib.date(c[a],"short")+"</span></div>";d.lib.note(f)}),a.on("update.cw",function(){for(var b,e,f,g,h,i=[],j=d.crypto.dblist(),k=d.state.get()||{},l=k.initurl||"",m=k.url||"",n=0;n<j.length;n++)if("cw"!==j[n]){e=d.db(j[n]).settings(),f=e.name,g=f+"/"+e.start;var h=(e.ico,d.db(f).sync()),o=0,p=Object.values(h),q=p.map(function(a){return Object.isNumber(a)?a:null}).compact(!0);Object.size(h)>0&&(o=1,Object.size(h)!=p.compact(!0).length&&(o=2),q.length&&(o=q.min())),i.push({url:g,active:!(g!==l&&g!==m),ico:e.ico,title:e.title,name:e.name,bubble:"",bubbleCss:"",shift:!1,sync:o});for(var r in e.apps)b=e.apps[r],g=f+"/"+b.url,d.form(g,f)&&i.push({url:g,active:!(g!==l&&g!==m),ico:d.form(g,f).app.ico||"",title:b.title,bubble:"",bubbleCss:"",shift:!0})}c.list.length=0,c.list.add(i),a.find("#list").trigger("recalc")}.debounce(105))},DB:{ico:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABMpJREFUeNrsWU1oG1cQHoWndlWksoI1rEACGVSQWsV2wAEbkpC4bUhTVGhoc3GLDz34UHLN3efSY2kg+JASX0JTigI+tNQOpCWGBKK2KhHUJaIVREVLd4k2eEEPnJmVLK1Wq5/VjysHjVi93ff/vTfzzbxdz/7+PrwMcgxeEpkAmQCZAOksjP48Hk9Plde/24oKDF5z0fvz5YtLf+PdyKjxgHU9dNMNyI30D9OMCd/j7UwfY/3GDX5p5dLSX6ME0lW1NjY2X2eMbfYJgmSGCXD7y1u3fCNXrQ7igaD/JqZxAr+YjHkkUey5c0XT4H52l4aZlf3Sdbz5ZFRAWlSrZgdvIkQvPr6Nk7hC+cdjUTj+RsT1AI8eP4HH+UL1gfMvsN9fBpjvM02HB59fXtLb2sh6Oh0QmLiOeR/bW0dkCU6fSPQ9+vaD3+Gpog1r8cu4IFeXP1i65mgjCOKmE4igX4CFZGKgkU/NxSGA/QxJAsDY1xvprY9aVOubO9szaNC/UkYiGoZkLAxer3fsfEW5vAc/Z7Kg6obJhssXz8w27QiCmKWUpn4iMT2WIMytCPggjrZak+Ta2toxm2fnr/TEYePgwZklKkkk2CTWGutYaxCpVCpQRGqlS9GI3jn4/X6QJdG8Aj7f+AMpqWXI5HahhCC4NR8BPSkUTeqei8cgEppqAm4Sy5AJpW8gKlLhw2zOnHTbOkiT9zI5eA8BYeAImd08GJjST8Jdi4blJpD/C5B8sQii6DevXsTgpHICXo28Au6kbhgQC0dg0A3qC0h5bw9kW/AoYICG/gj0qrNqEo4gqDwqyw50ykwHVqn5sUMFks3lG4FgTU4mYyDicv+4k3Hn5HCXLpyaR5UzYCoYPFwgxE60ys2r3lAha6fcMgh3GLBSa1coKocLZA/VqoyrxzvU4R2eeZvausEPx0ZIhwtPS6DhbiSirbouodELggB4+HI9BbITEVWspKqYBvsyfNarcZMOh9HBMcdVrakV1hEdTpBEtaRyxFBOQs6UnCjtCueqmReaCg4fSBb5/898ET48uwDbD7OglXVXg6TOLVSPvY9yvU3KyyCFBODGx3QFQp6YQFiptNnOeZuubGbOwdaufXsagxZvqEDIE5PKMIHVh+UW5WpMldefeT3lNgvnLWrZrj1FDG58S1cgBGBxLtm4T8Y7WImziDUieHdxruc2VN+NzXcN431IIVItDNmtqxhrueg1UViSHMsKRQ00XXcsownH8HhNqTVfdHnG75l+7+NZWVF1cNAfMz13MmmCuXNvx9lsuG3UWjsx4IdPL5yF7R3qXzPz5KAIKSSWoR+siApT7yxANCJXbYRDS2r18Bws5dyWZ29Xaba7aEhGEPPo5QOj2ZEQhg9Ev0VFMX2CYfPEBw4xdXretScTWJVuia1kWTLVeaQhis/nhelIqGMdtytZfwnoG+xcMnn5MK5Ajs43aotpyqq63wQEy/49OBvQWXycRWm8I1BXV1crzcZe4ndhChR8lO7iCS+MzMHG8K0jRcf/FBXaBQ8u/7fWsvpnhRubW+/j3G8jmFePgH79Yej8zGeXz//n+A1xI71FH3iuIJi3sPIYvslmz9DZ/MRV/tXKyvnnpnFbgUzodwJkAmQC5MjICwEGAN+u7O9LPns7AAAAAElFTkSuQmCC",pic:"data:image/png;base64,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",apps:[],title:"",desc:"",stamp:"",start:"List/!eyJtb2RlIjogWyJjb2x1bW5zLWJyaWVmIl0sInNlYXJjaCI6ICIiLCJzb3J0IjogWyJUeXBlIl19",sync:[],creator:""},Sync:{init:['<h3>Sync state of <span id="dbtitle"></span></h3>'],ui:{"#dbtitle":"title"}},HTML:['<div id="sidelogo" class="w170 mt5 mb10"></div>','<div id="list" class="oh fs80"></div>','<div class="mt25 pt15 pb15 bts gray2 fs80 mr10 lh170">','<div id="btn-sysdb" class="fs100 fi-folder-lock hoverlink">','<span class="pseudolink fs95 ml6 ">System DB</span>',"</div>",'<div id="btn-newdb" class="fs80 fi-plus hoverlink ml2">','<span class="pseudolink fs120 ml7">Add new DB...</span>',"</div>",'<div id="btn-update" class="fs100 fi-lightbulb hoverlink">','<span class="pseudolink fs95 ml5 ">Check updates...</span>',"</div>",'<div id="btn-profile" class="fs100 fi-torso hoverlink ml2">','<a class="pseudolink fs95 ml7 " href="profile.html" target="_blank">Profile...</a>',"</div>","</div>"],Logo:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" width="100%" viewBox="0, 0, 1000, 80">\n  <defs>\n    <linearGradient id="G_3" gradientUnits="userSpaceOnUse" x1="9.905" y1="60" x2="137.96" y2="20">\n      <stop offset="0" stop-color="#ACD6FF"/>\n      <stop offset="0.455" stop-color="#9AC4F5"/>\n      <stop offset="1" stop-color="#7494D0"/>\n    </linearGradient>\n  </defs>\n      <path d="M92,0 C113,-0 128,17 127,35 C145,39 147,51 147,56 C147,71 136,79 122,79 L23,79 C10,79 0,70 0,58 C-0,46 9,38 19,37 C19,20 33,8 50,8 C58,8 63,11 65,13 C66,9 76,0 92,0 z" fill="#FFFFFF"/>\n      <path d="M22,80 L22,79 L21,79 C19,79 17,79 15,78 C9,76 4,72 1,67 C1,66 1,66 1,65 L25,65 L25,80 z M95,80 L95,65 L29,65 L29,80 z M125,80 L125,79 C127,79 127,79 130,79 C132,78 132,78 134,77 C138,75 142,72 144,69 C144,68 145,67 145,66 C146,66 146,65 146,65 L99,65 L99,80 z M147,61 C148,57 147,53 146,49 C145,47 144,46 143,44 C143,43 142,43 142,43 L136,43 L136,61 z M132,61 L132,43 L66,43 L66,61 z M62,61 L62,43 L6,43 C3,46 0,50 0,55 C-0,57 -0,58 0,60 C0,61 0,61 0,61 z M138,39 C138,39 137,39 137,38 C135,37 133,36 131,36 C129,35 129,35 127,35 C127,34 127,33 127,32 C127,28 126,24 125,21 L125,21 L99,21 L99,39 z M95,39 L95,21 L29,21 L29,39 z M25,39 L25,21 L24,21 C24,21 24,21 23,22 C21,26 19,32 19,37 C17,37 17,37 15,38 C13,39 14,38 12,39 z M123,17 C123,16 122,16 122,15 C121,13 119,12 118,10 C112,5 105,1 97,0 C96,0 94,-0 92,0 C86,0 80,1 75,4 C72,5 69,8 66,10 L66,11 L66,17 z M62,17 L62,11 C59,10 58,9 55,9 C54,9 53,8 51,8 C51,8 49,8 48,8 C46,8 44,9 42,9 C37,10 33,13 29,16 C28,16 28,16 28,17 z" fill="url(#G_3)"/>\n    <path d="M268,19 L256,23 Q244,11 223,11 Q207,11 197,19 Q187,27 187,39 Q187,52 197,60 Q207,68 224,68 Q245,68 256,56 L267,62 Q259,71 249,75 Q238,80 223,80 Q203,80 189,69 Q174,58 174,39 Q174,21 189,10 Q203,-0 223,-0 Q252,-0 268,19 z M416,45 Q416,55 408,62 Q400,68 387,68 Q373,68 365,62 Q357,55 357,45 Q357,35 365,29 Q373,22 387,22 Q400,22 408,29 Q416,35 416,45 z M430,45 Q430,30 416,20 Q404,11 387,11 Q369,11 357,20 Q343,30 343,45 Q343,61 357,71 Q369,79 387,79 Q404,79 416,71 Q430,61 430,45 z M519,13 L507,13 L507,54 Q507,68 481,68 Q456,68 456,54 L456,13 L443,13 L443,56 Q443,66 453,73 Q464,79 481,79 Q499,79 509,73 Q519,66 519,56 z M552,66 L552,25 L583,25 Q594,25 600,30 Q607,36 607,46 Q607,55 601,60 Q595,66 585,66 z M540,13 L540,77 L584,77 Q592,77 600,75 Q606,72 610,69 Q621,57 621,45 Q621,31 610,22 Q600,13 582,13 z M739,2 L720,65 L700,2 L684,2 L665,65 L645,2 L631,2 L656,77 L673,77 L692,14 L711,77 L728,77 L753,2 z M783,52 L799,24 L815,52 z M807,13 L791,13 L755,77 L769,77 L777,64 L821,64 L829,77 L843,77 z M916,66 L873,66 L873,13 L860,13 L860,77 L916,77 z M1000,66 L949,66 L949,13 L936,13 L936,77 L1000,77 z M339,66 L296,66 L296,13 L283,13 L283,77 L339,77 z" fill="#719BD3"/>\n</svg>'},{id:"cw.Sys.Trust",build:3,params:{delay:5,width:350},data:{trust:[]},init:function(a){a.formgen(['<h4 class="fi-check lgreen"> <span class="green">Confirm trust</span></h3>',{label:"70px",row:"350px",rowCss:"my-row mt10 fs80 xgray"},["","<p>These app components are untrusted or were changed since last used:</p>"],["","div#list.lh140"],{rowCss:"my-row mt20 pt15 fs80 xgray btd"},["","btn#btn-ok.green.mr5",{val:"Trust this version"},"btn#btn-all.green.mr5",{val:"Trust forever"},"btn#btn-cancel",{val:"Stop"}]])},ui:{"#btn-ok":{bind:function(a,b,c){null!=b&&c.trigger("commit")},events:"click"},"#btn-cancel":{bind:function(a,b,c){null!=b&&c.trigger("cancel")},events:"click"},"#btn-all":{bind:function(a,b,c){if(null!=b){for(var d=0;d<a.trust.length;d++)a.trust[d]._rev="*";c.trigger("commit")}},events:"click"},"#list":function(a){var b=0,c="";for(b;b<a.trust.length;b++)c+='<span class="orange">—</span> '+a.trust[b].id+"<br/>";return c}}},{id:"cw.Sys.YesNoCancel",build:9,params:{delay:5},data:{text:"",css:"xgray",yes:"Yes",no:"No",cancel:"Cancel",cmd:""},init:function(a,b){var c=b.data;a.formgen(['<div class="'+c.css+'">'+c.text+"</div>",{label:"70px",row:"100%",rowCss:"my-row mt15 pt15 fs90 mb-5 xgray btd"},["","spn#btn-yes.button.green.mr5",{txt:c.yes},"spn#btn-no.button.mr5",{txt:c.no},"spn#btn-cancel.button.fr",{txt:c.cancel}]])},ui:{"#btn-yes":{bind:function(a,b,c){null!=b&&(a.cmd="yes",c.trigger("commit"))},events:"click.my",css:{"self:hide":function(a){return!a.yes}}},"#btn-no":{bind:function(a,b,c){null!=b&&(a.cmd="no",c.trigger("commit"))},events:"click.my",css:{"self:hide":function(a){return!a.no}}},"#btn-cancel":{bind:function(a,b,c){null!=b&&(a.cmd="cancel",c.trigger("cancel"))},events:"click.my",css:{"self:hide":function(a){return!a.cancel}}}}}].forEach(function(a){d.reg(a)})}(cw,jQuery,PouchDB);